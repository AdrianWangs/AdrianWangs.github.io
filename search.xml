<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>æ‹’ç» AI åè¯ç„¦è™‘ï¼šLLM æ ¸å¿ƒæ¦‚å¿µï¼Œä¸€æ¬¡è®²é€</title>
    <url>/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/</url>
    <content><![CDATA[<div class="note info flat"><p>Skillsã€Agentã€Claude Codeã€OpenClawã€codeXï¼Œè¿™äº›è¯ä½ éƒ½è®¤è¯†å“ªäº›ï¼Œæœ¬æ–‡ä¸ºå¤§å®¶æ‰’å¼€å¤§å¤šæ•°<strong>å”¬äººAI</strong>æ¦‚å¿µçš„åº•è£¤ï¼Œä½ ä¼šå‘ç°æ‰€è°“æ™ºèƒ½ä½“ï¼Œå°±æ˜¯æ‰€æœ‰ä¸éœ€è¦æ™ºèƒ½çš„éƒ¨åˆ†æ„æˆçš„éƒ¨åˆ†ï¼Œskillå°±æ˜¯æ–°ç“¶è£…æ—§é…’çš„ä¸€åœºåè¯è¯ˆéª—ï¼›æœ€åæœ¬æ–‡ä¼šæ€»ç»“ä¸€ä¸ªé€šæ€ç°åœ¨æ‰€æœ‰ç”šè‡³æœªæ¥å¯èƒ½å‡ºç°çš„æ–°æ¦‚å¿µçš„ç»Ÿä¸€æ–¹æ³•è®º</p>
<p>æœ¬æ–‡å‰å‡ éƒ¨åˆ†æ˜¯åŸºç¡€çŸ¥è¯†ï¼Œèµ¶æ—¶é—´çš„è¯ç›´æ¥åˆ°ä¸‹æ–‡çš„è¿™éƒ¨åˆ†â€”â€”<a href="#%E5%90%8D%E8%AF%8D%E8%AF%88%E9%AA%97%EF%BC%81%E4%B8%80%E5%8F%A3%E6%B0%94%E6%8B%86%E7%A9%BFSkill/MCP/RAG/Agent/OpenClaw%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91">æ‹’ç» AI åè¯ç„¦è™‘ï¼šLLM æ ¸å¿ƒæ¦‚å¿µï¼Œä¸€æ¬¡è®²é€</a></p>
</div>
<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>è¿‘äº›å¹´æ¥ï¼ŒAIçš„äº•å–·å¼çˆ†å‘ï¼Œå¯¹ç¨‹åºå‘˜çš„å†²å‡»ç¡®å®å¾ˆå¤§â€”â€”ç½‘ç»œä¸Šï¼Œå‰ç«¯ç¨‹åºå‘˜ä¸‰å¤©ä¸€å°æ­»ï¼Œäº”å¤©ä¸€å¤§æ­»ï¼›ä¾ç„¶è®°å¾—ï¼Œåœ¨25å¹´åˆçš„æ—¶å€™ï¼Œé‚£æ—¶å€™æ˜¯åœ¨ä¸Šæµ·å‡ºå·®ï¼Œé‚£æ—¶å€™å’ŒæŸä¸€ä¸ªå‰ç«¯ldåƒé¥­ï¼Œä»–é—®æˆ‘ï¼šä½ çŸ¥é“cursorå—ï¼Ÿå†ä¸å­¦ä¹ cursorï¼Œä½ å°±è¦æ²¡äº†ã€‚é‚£æ—¶å€™æˆ‘æ‡µæ‡µæ‡‚æ‡‚ï¼ŒAIçœŸçš„èƒ½å–ä»£ç¨‹åºå‘˜å—ï¼ŸåŠä¿¡åŠç–‘ä¹‹é—´æˆ‘å°±å¼€å§‹â€”â€”å®è·µå­¦ä¹ å®è·µAIç›¸å…³çš„å†…å®¹ï¼Œè¶Šæ·±å…¥å­¦ä¹ ï¼Œè¶Šå‘ç°è‡ªå·±çš„æ— çŸ¥ã€‚</p>
<p>æœ€è¿‘ï¼Œcursor VP Lee Robinsonåˆ†äº«äº†ä»–çš„AIæ„Ÿæ‚Ÿå’Œç»éªŒâ€”â€” <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DUrNLVip0hSA">ã€ŠAI codes better than me. Now what?ã€‹</a> ï¼Œä»–å¾ˆæ¸…æ¥šæŒ‡å‡ºâ€”â€”<strong>æœªæ¥ AI è‚¯å®šæ˜¯è®© AI è€…ä¸å†åªæ˜¯å±€é™åœ¨æŸä¸ªæŠ€æœ¯æ ‡ç­¾ä¸‹</strong></p>
<blockquote>
<p>å¯¹æ¯”è¿‡å»çš„æ¨¡å‹æŒ‡ä»¤éµå¾ªèƒ½åŠ›å·®ï¼Œå¹¶ä¸”ç»å¸¸å‡ºç°å¹»è§‰çš„æƒ…å†µï¼Œç°åœ¨çš„ LLM éƒ½è¡¨ç°å‡ºäº†éå¸¸å¼ºå¤§çš„ä»£ç å®Œæˆæ•ˆæœï¼ˆå°±æ˜¯è´µï¼‰ï¼Œå¯¹äº Lee Robinson æ¥è¯´ï¼Œä»–è§‰å¾—ç›®å‰çš„æ¨¡å‹åœ¨å†™ä»£ç æ–¹é¢ç¡®å®å·²ç»æ¯”ä»–æ›´å¼ºã€‚</p>
</blockquote>
<div class="note warning flat"><p><strong>æ‰€ä»¥ï¼Œå¯¹äºæœªæ¥å¼€å‘è€…è€Œè¨€ï¼Œç¡®å®ä¸åº”è¯¥çº ç»“äºåœ¨&quot;å†™ä»£ç èƒ½åŠ›&quot;ä¸Šå»å’Œ AI å¯¹æ¯”</strong>ï¼Œå› ä¸ºä½ çœŸå†™ä¸è¿‡å®ƒï¼Œæ²¡å®ƒæŒä¹…ä¹Ÿæ²¡å®ƒèƒ½è¾“å‡ºã€‚</p>
</div>
<p>ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåŠå‘¢ï¼Ÿå°‘ç…œçš„è¿™ç¯‡æ–‡ç« å†™çš„å¾ˆæ¸…æ¥šâ€”â€”<a href="https://bytetech.info/articles/7477409894535004212#HnLvd0XFNoKHWvx3NsxcIqMAnvg">AIç‹‚é£™æ—¶ä»£ï¼Œç¨‹åºå‘˜çš„ç”Ÿæ­»çªå›´</a>ï¼Œé‚£å°±æ˜¯<strong>ç§¯ææ‹¥æŠ±AIï¼Œæ›´å¥½åœ°ä½¿ç”¨AIæ›´å¿«ã€æ›´å‡†ç¡®è§£å†³ä¸šåŠ¡ç—›ç‚¹</strong></p>
<p>é‚£ä¹ˆæœ¬æ–‡ï¼Œå°±æ˜¯ä¸€ä¸ªåœ¨AIæ—¶ä»£çš„ä¸€ä¸ªå…¥é—¨ç¼–ç¨‹æ‰‹å†Œ</p>
<h2 id="å¤§æ¨¡å‹åŸºç¡€çŸ¥è¯†">å¤§æ¨¡å‹åŸºç¡€çŸ¥è¯†</h2>
<h3 id="ä»€ä¹ˆæ˜¯å¤§æ¨¡å‹">ä»€ä¹ˆæ˜¯å¤§æ¨¡å‹</h3>
<p><strong>æ¨¡å‹</strong>ï¼šå¼„ä¸€ä¸ªéå¸¸å¤æ‚çš„<strong>å‡½æ•°</strong>ï¼Œç„¶åæ ¹æ®è®¡ç®—å‡ºçš„é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„è¯¯å·®ï¼Œä¸æ–­è°ƒæ•´é‡Œé¢çš„æœªçŸ¥å‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°å«åšæ¨¡å‹ï¼Œæ¨¡å‹é‡Œçš„å‚æ•°å«åšæƒé‡ï¼Œå¦‚æœæ¨¡å‹ä¸­çš„å‚æ•°é‡ç‰¹åˆ«å¤§ï¼Œå°±å«åšå¤§æ¨¡å‹ï¼Œç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†çš„å¤§æ¨¡å‹å°±å«åšå¤§è¯­è¨€æ¨¡å‹ï¼Œè°ƒæ•´å‚æ•°çš„è¿‡ç¨‹å°±æ˜¯æ¨¡å‹çš„è®­ç»ƒã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“å‡½æ•°æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬è¾“å…¥ä¸€äº›ç¬¦å·ï¼Œç„¶åè®¾ç½®å¥½è¿ç®—è§„åˆ™ï¼Œæœ€åç®—å‡ºæ¥ç»“æœã€‚</p>
<p>$xâ€”â€”&gt; f(x)â€”â€”&gt;y$</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠç°å®ä¸–ç•ŒæŠ½è±¡ä¸ºç¬¦å·ï¼Œä½œä¸ºè¾“å…¥ï¼ŒæŠŠæˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ä½œä¸ºè¾“å‡ºï¼Œé‚£ä¹ˆä¸­é—´è¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ä¸€ä¸ªèƒ½åŠ›ã€‚</p>
<p>æ€ä¹ˆç†è§£å‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€å¼ å›¾ç‰‡ï¼Œå¸Œæœ›æœºå™¨è¾“å‡ºæè¿°æ€§çš„æ–‡å­—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬äººç±»å¾ˆéš¾å†™å‡ºæ¥ï¼Œæ‰€ä»¥è®©æœºå™¨æ¥æ‰¾è¿™ä¸ªå‡½æ•°å°±æœ€åˆç†ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯æœºå™¨å­¦ä¹ </p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966681983.png" alt="alt text"></p>
<div class="note primary flat"><p><strong>Functions describe the world</strong></p>
</div>
<p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œä½ å°±çŸ¥é“äº†å¤§æ¨¡å‹äº†ï¼Œå…³äºå¤§æ¨¡å‹çš„åº•å±‚ï¼Œæˆ‘ä»¬å…ˆè·³è¿‡ï½</p>
<p>é‚£ä¹ˆåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç›®å‰æœ‰å“ªäº›æ¨¡å‹å¯ä»¥è°ƒç”¨ï¼Œå“ªäº›æ¨¡å‹æœ‰åŠ©äºæˆ‘ä»¬ä¸šåŠ¡ææ•ˆï¼Ÿ</p>
<table>
<thead>
<tr>
<th>æ¨¡å‹</th>
<th>æ˜¯å¦åˆè§„</th>
<th>ä¸»è¦ä¼˜åŠ¿</th>
<th>ç¼ºç‚¹</th>
<th>æœ€ä½³åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>GPT-5ï¼ˆOpenAIï¼‰</td>
<td>åˆè§„</td>
<td>å¤æ‚æ¨ç†/åˆ›æ„ç”Ÿæˆæ ‡æ†ï¼›åŸç”Ÿå¤šæ¨¡æ€ï¼ˆæ–‡æœ¬/å›¾åƒ/éŸ³é¢‘/è§†é¢‘ï¼‰ï¼›ç”Ÿæ€å·¥å…·é“¾æˆç†Ÿ</td>
<td>API æˆæœ¬é«˜ï¼›å›½å†…æ¥å…¥ç¨³å®šæ€§å—é™</td>
<td>å¤šæ¨¡æ€åº”ç”¨ã€code</td>
</tr>
<tr>
<td>Gemini 3 Proï¼ˆGoogleï¼‰</td>
<td>åˆè§„</td>
<td>å…¨æ¨¡æ€æ·±åº¦èåˆï¼›å®æ—¶ä¿¡æ¯æ£€ç´¢å¼ºï¼›è°·æ­Œç”Ÿæ€ååŒå¥½ï¼›å¤šè¯­è¨€ç¿»è¯‘ç²¾å‡†ï¼›ç‰¹åˆ«åœ¨äºUXè¿˜åŸä¸Šã€3Dæ¨¡å‹ç”Ÿæˆã€å›¾åƒç”Ÿæˆ</td>
<td>ä¸­æ–‡è¯­å¢ƒç†è§£è¯¯å·®ç‡è¾ƒé«˜ï¼›å¼ºä¾èµ– TPU ç”Ÿæ€ï¼›å®šåˆ¶åŒ–å“åº”æ…¢</td>
<td>D2Cåº”ç”¨ï¼ˆfigmaâ†’codeï¼‰</td>
</tr>
<tr>
<td>Claude 4ï¼ˆAnthropicï¼‰</td>
<td>ä¸åˆè§„</td>
<td>è¶…é•¿ä¸Šä¸‹æ–‡ï¼ˆæœ€é«˜ 200 ä¸‡ tokensï¼‰ï¼›ä½å¹»è§‰ï¼ˆé”™è¯¯ç‡ &lt; 1%ï¼‰ï¼›ä»£ç ç¼–ç¨‹æœ€å¼ºæ¨¡å‹ï¼Œcursorå’Œclaude codeæ¨èæ¨¡å‹</td>
<td>ç«‹åœºé—®é¢˜</td>
<td>codeèƒ½åŠ›ä¼˜ç§€ï¼Œä¹‹å‰AIPAä½¿ç”¨çš„æ¨¡å‹ï¼ˆéå¸¸å¥½ç”¨ï¼Œç”Ÿæˆä»£ç è´¨é‡é«˜ã€å¯ç”¨æ€§å¼ºï¼‰</td>
</tr>
<tr>
<td>LLaMA</td>
<td>åˆè§„</td>
<td>å¼€æºå¯è‡ªå®šä¹‰ã€ä½éƒ¨ç½²æˆæœ¬</td>
<td>é€šç”¨æ€§èƒ½æ¯”è¾ƒå¼±</td>
<td>æœ¬åœ°çš„å¾®è°ƒ</td>
</tr>
</tbody>
</table>
<p>Leaderboard: <a href="https://www.swebench.com/index.html">https://www.swebench.com/index.html</a> ï¼ˆæ—¶é—´ï¼š2026-01-09ï¼‰</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966713698.png" alt="alt text"></p>
<p>ç›®å‰åœºå†…æ”¯æŒçš„<strong>Gemini 3 Pro</strong>æ˜¯ä¸€ä¸ªå¹³æ›¿æ–¹æ¡ˆï¼Œæ— è®ºåœ¨é€»è¾‘éƒ¨åˆ†è¿˜æ˜¯UIè¿˜åŸéƒ¨åˆ†ï¼Œéƒ½æœ‰å¾ˆå¥½çš„è¡¨ç°ï¼Œå½“ç„¶ä¹Ÿé¼“åŠ±å¤§å®¶å°è¯•æ›´å¤šçš„æ¨¡å‹</p>
<h3 id="å¤§æ¨¡å‹çš„ä¸€äº›æ¦‚å¿µ">å¤§æ¨¡å‹çš„ä¸€äº›æ¦‚å¿µ</h3>
<ol>
<li>
<p>æ¨¡å‹ç›¸å…³</p>
<ul>
<li>
<p><strong>å¤§æ¨¡å‹ï¼ˆLarge Language Model, LLMï¼‰</strong><br>
ä¸€ç§ä½¿ç”¨å¤§é‡æ–‡æœ¬æ•°æ®è®­ç»ƒçš„ AI æ¨¡å‹ï¼Œèƒ½å¤Ÿç†è§£å’Œç”Ÿæˆè‡ªç„¶è¯­è¨€ã€‚æ¯”å¦‚ GPT ç³»åˆ—ã€Claudeã€LLaMA ç­‰ã€‚</p>
</li>
<li>
<p><strong>å‚æ•°ï¼ˆParametersï¼‰</strong><br>
æ¨¡å‹å†…éƒ¨çš„â€œè®°å¿†å•å…ƒâ€ï¼Œå†³å®šæ¨¡å‹çš„è¡Œä¸ºã€‚å‚æ•°è¶Šå¤šï¼Œæ¨¡å‹é€šå¸¸è¶Šå¼ºå¤§ï¼Œä½†è®­ç»ƒæˆæœ¬ä¹Ÿè¶Šé«˜ã€‚</p>
</li>
<li>
<p><strong>æƒé‡ï¼ˆWeightsï¼‰</strong><br>
å‚æ•°çš„å…·ä½“æ•°å€¼ï¼Œæ˜¯æ¨¡å‹åœ¨è®­ç»ƒä¸­å­¦ä¹ åˆ°çš„çŸ¥è¯†ã€‚</p>
</li>
<li>
<p><strong>å¾®è°ƒï¼ˆFine-tuningï¼‰</strong><br>
åœ¨å·²æœ‰å¤§æ¨¡å‹åŸºç¡€ä¸Šï¼Œç”¨ç‰¹å®šé¢†åŸŸçš„æ•°æ®è¿›ä¸€æ­¥è®­ç»ƒï¼Œè®©æ¨¡å‹åœ¨ç‰¹å®šä»»åŠ¡ä¸Šè¡¨ç°æ›´å¥½ã€‚</p>
</li>
<li>
<p><strong>é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰</strong><br>
å¤§æ¨¡å‹åœ¨å¤§é‡é€šç”¨æ•°æ®ä¸Šè®­ç»ƒçš„é˜¶æ®µï¼Œå½¢æˆåŸºç¡€è¯­è¨€èƒ½åŠ›ã€‚</p>
</li>
</ul>
</li>
<li>
<p>è¾“å…¥è¾“å‡ºç›¸å…³</p>
<ul>
<li>
<p><strong>æç¤ºè¯ / Prompt</strong><br>
ç”¨æˆ·ç»™æ¨¡å‹çš„è¾“å…¥ä¿¡æ¯ï¼ŒæŒ‡å¯¼æ¨¡å‹ç”Ÿæˆæƒ³è¦çš„ç»“æœã€‚</p>
</li>
<li>
<p><strong>ç³»ç»Ÿæç¤ºï¼ˆSystem Promptï¼‰</strong><br>
ä¸€ç§ç‰¹æ®Šçš„æç¤ºè¯ï¼Œå‘Šè¯‰æ¨¡å‹â€œä½ çš„èº«ä»½æ˜¯ä»€ä¹ˆã€åº”è¯¥å¦‚ä½•å›ç­”ã€é£æ ¼æ˜¯ä»€ä¹ˆâ€ç­‰ï¼Œç›¸å½“äºæ¨¡å‹çš„è§„åˆ™è¯´æ˜ã€‚</p>
</li>
<li>
<p><strong>ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰</strong><br>
æ¨¡å‹åœ¨ç”Ÿæˆå›ç­”æ—¶å‚è€ƒçš„å‰æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¾“å…¥å’Œä¹‹å‰å¯¹è¯ã€‚</p>
</li>
<li>
<p><strong>å“åº”ï¼ˆResponseï¼‰</strong><br>
æ¨¡å‹æ ¹æ®æç¤ºè¯ç”Ÿæˆçš„è¾“å‡ºã€‚</p>
</li>
<li>
<p><strong>æ¸©åº¦ï¼ˆTemperatureï¼‰</strong><br>
æ§åˆ¶æ¨¡å‹è¾“å‡ºéšæœºæ€§ï¼Œå€¼è¶Šä½è¶Šä¿å®ˆï¼Œå€¼è¶Šé«˜è¶Šè‡ªç”±ã€‚</p>
</li>
</ul>
</li>
<li>
<p>ä»»åŠ¡/èƒ½åŠ›ç›¸å…³</p>
<ul>
<li>
<p><strong>æ–‡æœ¬ç”Ÿæˆï¼ˆText Generationï¼‰</strong><br>
æ¨¡å‹æ ¹æ®æç¤ºç”Ÿæˆæ–‡ç« ã€å¯¹è¯ã€ä»£ç ç­‰æ–‡æœ¬ã€‚</p>
</li>
<li>
<p><strong>æ–‡æœ¬ç†è§£ï¼ˆText Understandingï¼‰</strong><br>
æ¨¡å‹èƒ½ç†è§£è¯­ä¹‰ã€åšåˆ†ç±»ã€æ€»ç»“ã€é—®ç­”ç­‰ã€‚</p>
</li>
<li>
<p><strong>å¤šæ¨¡æ€ï¼ˆMultimodalï¼‰</strong><br>
æ¨¡å‹å¯ä»¥å¤„ç†å¤šç§è¾“å…¥ç±»å‹ï¼Œæ¯”å¦‚æ–‡å­— + å›¾ç‰‡ + éŸ³é¢‘ã€‚</p>
</li>
<li>
<p><strong>é›¶æ ·æœ¬/å°‘æ ·æœ¬å­¦ä¹ ï¼ˆZero-shot / Few-shotï¼‰</strong><br>
æ¨¡å‹åœ¨æ²¡æœ‰æˆ–åªæœ‰å°‘é‡ç¤ºä¾‹çš„æƒ…å†µä¸‹å®Œæˆä»»åŠ¡çš„èƒ½åŠ›ã€‚</p>
</li>
</ul>
</li>
<li>
<p>ç³»ç»Ÿä¸å·¥å…·ç›¸å…³</p>
<ul>
<li>
<p><strong>Agentï¼ˆæ™ºèƒ½ä»£ç†ï¼‰</strong><br>
æ¨¡å‹ç»“åˆè§„åˆ™ã€å·¥å…·æˆ–æ’ä»¶æ‰§è¡Œå¤æ‚ä»»åŠ¡çš„ç³»ç»Ÿï¼Œæ¯”å¦‚æŸ¥æ•°æ®ã€æ“ä½œåº”ç”¨ã€‚</p>
</li>
<li>
<p><strong>å·¥å…·è°ƒç”¨ï¼ˆTool Useï¼‰</strong><br>
æ¨¡å‹èƒ½å¤Ÿè°ƒç”¨å¤–éƒ¨ API æˆ–åŠŸèƒ½ï¼Œæ¯”å¦‚è®¡ç®—ã€æœç´¢ã€ç»˜å›¾ã€‚</p>
</li>
<li>
<p><strong>å·¥ä½œæµï¼ˆWorkflowï¼‰</strong><br>
å°†å¤šä¸ªæ¨¡å‹æˆ–å·¥å…·æ“ä½œä¸²è”ï¼Œå®ç°æ›´å¤æ‚çš„è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</p>
</li>
</ul>
</li>
</ol>
<h3 id="æ€ä¹ˆè°ƒç”¨å¤§æ¨¡å‹">æ€ä¹ˆè°ƒç”¨å¤§æ¨¡å‹</h3>
<p>æˆ‘ä»¬ä¸Šé¢è®²äº†é‚£ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥ä¸€ä¸ªå…·ä½“çš„demoè¯•è¯•å§ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªæœ€ç®€å•çš„chatèŠå¤©æ¡†å§ï¼Œåº•å±‚ç”¨ä¸€ä¸‹æ–¹èˆŸæä¾›çš„æ¨¡å‹å°±å¯ä»¥</p>
<p><video controls src="æ‹’ç»AIåè¯ç„¦è™‘-LLMæ ¸å¿ƒæ¦‚å¿µä¸€æ¬¡è®²é€/1770966749115.mov" title="Title"></video></p>
<p>æ•ˆæœå¦‚ä¸Šï¼Œé‚£ä¹ˆæ˜¯æ€ä¹ˆåšå‡ºæ¥çš„å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å¤§å®¶å»æ–¹èˆŸå¹³å°ï¼Œè·å–å¯¹åº”çš„apiKeyã€baseURLã€modelç­‰ä¿¡æ¯ï¼Œè°ƒç”¨ä¸€ä¸‹APIå°±å¯ä»¥äº†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&quot;cors&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> dotenv = <span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OpenAI</span> = <span class="built_in">require</span>(<span class="string">&quot;openai&quot;</span>);</span><br><span class="line"></span><br><span class="line">dotenv.<span class="title function_">config</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3001</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤§æ¨¡å‹è°ƒç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">callLLM</span> = <span class="keyword">async</span> (<span class="params">message</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title class_">OpenAI</span>(&#123;</span><br><span class="line">    <span class="attr">apiKey</span>: <span class="string">&quot;xxxxxxxxxxxxxxxxx&quot;</span>, <span class="comment">// This is the default and can be omitted</span></span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&quot;https://ark-cn-beijing.bytedance.net/api/v3&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> client.<span class="property">responses</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">model</span>: <span class="string">&quot;xxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    <span class="attr">instructions</span>: <span class="string">&quot;You are a coding assistant that talks like a pirate&quot;</span>,</span><br><span class="line">    <span class="attr">input</span>: message,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¤§æ¨¡å‹å›å¤:&quot;</span>, response);</span><br><span class="line">  <span class="keyword">return</span> response.<span class="property">output_text</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/api/chat&quot;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; message &#125; = req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">if</span> (!message) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;Message is required&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¶åˆ°ç”¨æˆ·æ¶ˆæ¯:&quot;</span>, message);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ LangChain è°ƒç”¨å¤§æ¨¡å‹</span></span><br><span class="line">    <span class="keyword">const</span> reply = <span class="keyword">await</span> <span class="title function_">callLLM</span>(message);</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">json</span>(&#123; reply &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error processing chat:&quot;</span>, error);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;Internal server error&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is running on http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…·ä½“å†æ·±å…¥å¤§å®¶å¯ä»¥å»çœ‹langchainå…¥é—¨<a href="https://bytedance.larkoffice.com/docx/AheDd7lY3oTYFoxesDmcZEdWnad">ä¸‡å­—é•¿æ–‡å¸¦ä½ å…¥é—¨ ğŸ¦œğŸ”— LangChain.js</a></p>
<h2 id="æç¤ºå·¥ç¨‹çš„è‰ºæœ¯">æç¤ºå·¥ç¨‹çš„è‰ºæœ¯</h2>
<h3 id="å¼€å§‹æç¤ºå§">å¼€å§‹æç¤ºå§</h3>
<p>æç¤ºï¼ˆPromptï¼‰æ˜¯è¾“å…¥ç»™å¤§æ¨¡å‹ï¼ˆLLMï¼‰çš„æ–‡æœ¬ä¿¡æ¯ï¼Œç”¨äºæ˜ç¡®åœ°å‘Šè¯‰æ¨¡å‹æƒ³è¦è§£å†³çš„é—®é¢˜æˆ–å®Œæˆçš„ä»»åŠ¡ï¼Œä¹Ÿæ˜¯å¤§è¯­è¨€æ¨¡å‹ç†è§£ç”¨æˆ·éœ€æ±‚å¹¶ç”Ÿæˆç›¸å…³ã€å‡†ç¡®å›ç­”æˆ–å†…å®¹çš„åŸºç¡€ã€‚</p>
<p>Promptåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†æ¨¡å‹è¾“å‡ºçš„<strong>è´¨é‡ä¸ç›¸å…³æ€§</strong>ã€‚ä¸€ä¸ªå¥½çš„Promptï¼Œèƒ½å¤Ÿæœ€å¤§ç¨‹åº¦åœ°å‡å°‘è¯¯è§£ï¼Œä½¿å¾—æ¨¡å‹å‡†ç¡®ç†è§£ç”¨æˆ·çš„éœ€æ±‚ï¼Œç”Ÿæˆé«˜è´¨é‡çš„å“åº”ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠå¤§æ¨¡å‹æ¯”å–»æˆä¸€ä¸ªåˆšæ¥çš„å®ä¹ ç”Ÿï¼Œé‚£ä¹ˆPromptå°±æ˜¯æˆ‘ä»¬ç»™ä»–æŒ‡æ´¾çš„ä¸€ä¸ªå°éœ€æ±‚ï¼Œå¦‚æœä½ åªç»™ä»–ä¸€å¥è¯çš„æè¿°å»å®ç°éœ€æ±‚ï¼Œåˆæ¥ä¹åˆ°çš„å®ä¹ ç”Ÿä¼šä¸€å¤´é›¾æ°´ï¼Œå¦‚æœä½ æŠŠéœ€æ±‚çš„èƒŒæ™¯ã€ä»£ç ä»“åº“ã€è¯¦ç»†è¦æ±‚ã€å»ºè®®å‘Šè¯‰ä»–ï¼Œé‚£ä¹ˆä»–å¯èƒ½å¯ä»¥åšçš„è¶…å‡ºä½ çš„é¢„æœŸï¼Œæ‰€ä»¥å¥½çš„Promptæ˜¯å¾ˆæœ‰å¿…è¦çš„</p>
<div class="note info flat"><p>æ€ä¹ˆå†™å¥½ä¸€ä¸ªPromptå‘¢ï¼Ÿè¿™è¾¹æ¨èä¸€ä¸‹è‡ªå·±çš„æ–‡ç« â€”â€”<a href="https://bytetech.info/articles/7518772390789120027?from=article_share_copylink">æ€ä¹ˆå†™å¥½ä¸€ä¸ªPEå·¥ç¨‹â€”â€”åŸºç¡€ç¯‡</a>ï¼Œæ¬¢è¿å¤šå¤šé˜…è¯»ï¼Œè¿™é‡Œä¸å±•å¼€äº†</p>
</div>
<h3 id="Meta-Prompt">Meta Prompt</h3>
<p>æœ‰äººä¹Ÿè®¸æƒ³ï¼šæœ‰æ²¡æœ‰é‚ªä¿®ï¼Œæˆ‘ä¸æƒ³å­¦ä¹ è¿™äº›ä¸œè¥¿ï¼Œå°±æƒ³è¦ç›´æ¥ä¸Šæ‰‹çš„é‚£ç§ï¼Ÿæœ‰çš„ï¼ŒåŒ…çš„ï¼Œè®©æˆ‘ä»¬æ¨å‡ºä¸€ä¸ªä¸œè¥¿â€”â€”Meta Promptï¼ˆå…ƒæç¤ºï¼‰</p>
<p><strong>Meta Promptï¼ˆå…ƒæç¤ºï¼‰</strong>ï¼Œå¯ä»¥ç†è§£ä¸ºï¼š</p>
<blockquote>
<p><strong>â€œç”¨æ¥è§„å®š AI åº”è¯¥å¦‚ä½•ç†è§£å’Œæ‰§è¡Œä½ æç¤ºçš„æç¤ºâ€</strong>ã€‚</p>
</blockquote>
<p>å¦‚æœæ™®é€š prompt æ˜¯ä½ å¯¹ AI è¯´â€œåšä»€ä¹ˆâ€ï¼Œ<br>
é‚£ <strong>meta prompt æ˜¯ä½ å¯¹ AI è¯´â€œä½ è¦ç”¨ä»€ä¹ˆè§„åˆ™ã€è§’è‰²ã€æµç¨‹ã€æ€ç»´æ–¹å¼æ¥åšâ€</strong>ã€‚</p>
<div class="note info flat"><p>å¯¹æ¯”ä¸€ä¸‹å°±å¾ˆæ¸…æ¥š</p>
<p><strong>æ™®é€š Prompt</strong></p>
<blockquote>
<p>å¸®æˆ‘æ€»ç»“è¿™ç¯‡æ–‡ç« ã€‚</p>
</blockquote>
<p>ä½ åªå‘Šè¯‰äº† <strong>è¦ä»€ä¹ˆç»“æœ</strong>ã€‚</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<p><strong>Meta Prompt</strong></p>
<blockquote>
<p>ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯ç¼–è¾‘ã€‚<br>
é˜…è¯»æ–‡ç« åï¼Œè¯·ï¼š</p>
<ol>
<li>æå– 3 ä¸ªæ ¸å¿ƒè§‚ç‚¹</li>
<li>ç”¨ç¨‹åºå‘˜èƒ½çœ‹æ‡‚çš„æ–¹å¼è§£é‡Š</li>
<li>ç”¨ Markdown è¾“å‡º</li>
<li>ä¸è¦è¶…è¿‡ 200 å­—</li>
</ol>
</blockquote>
<p>ä½ ä¸åªè¯´äº†&quot;è¦æ€»ç»“&quot;ï¼Œä½ è¿˜è§„å®šäº†ï¼š</p>
<ul>
<li>è§’è‰²</li>
<li>æ€è€ƒè·¯å¾„</li>
<li>è¾“å‡ºç»“æ„</li>
<li>è´¨é‡æ ‡å‡†</li>
</ul>
<p>è¿™å°±æ˜¯ <strong>meta prompt</strong>ã€‚</p>
</div>
<p>æ€ä¹ˆåˆå¼•å…¥äº†ä¸€ä¸ªæ–°æ¦‚å¿µğŸ«¨ï¼Œä¸æ˜¯è¯´é‚ªä¿®å—ï¼Ÿåˆ«æ€¥ï¼Œè®©æˆ‘ä»¬å¾€ä¸‹çœ‹ï¼Œè¿™é‡Œç»™å¤§å®¶å‡†å¤‡äº†ä¸¤ä¸ªæ¥è‡ª@ææ˜•å¤§ç¥æ–‡ç« çš„Meta promptâ€”â€”<a href="https://bytetech.info/articles/7572123453323804687#YWHvdfhU4owmIrxqhnLc6yDqnHb">æˆ‘çš„ç‹¬å®¶ Meta Prompt</a></p>
<div class="note warning flat"><p>ä»¥ä¸‹çš„Meta promptä¸æ˜¯æœ¬äººå†™çš„ï¼Œæ˜¯æ¥è‡ª@ææ˜•å¤§ç¥çš„æ–‡ç« çš„å¼•ç”¨ï¼Œç‰¹æ­¤å£°æ˜</p>
</div>
<p>åªéœ€è¦å°†ä»¥ä¸‹çš„Promptå¤åˆ¶ä¸€ä¸‹ï¼Œç„¶åå†å°†è‡ªå·±åŸæœ¬çš„éœ€æ±‚ä½œä¸ºUser Promptè¾“å…¥å°±å¯ä»¥äº†ï¼Œç„¶åè°ƒç”¨å¤§æ¨¡å‹å³å¯ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> SYSTEM_PROMPT</span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªèµ„æ·±å‰ç«¯çš„å·¥ç¨‹å¸ˆï¼Œä½ éœ€è¦å†™ä¸€ä¸ªä½¿ç”¨Arco Designç»„ä»¶åº“çš„ç™»é™†ç½‘é¡µ&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h4 id="æ™®é€š">æ™®é€š</h4>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">Given</span> <span class="string">a</span> <span class="string">task</span> <span class="string">description</span> <span class="string">or</span> <span class="string">existing</span> <span class="string">prompt,</span> <span class="string">produce</span> <span class="string">a</span> <span class="string">detailed</span> <span class="string">system</span> <span class="string">prompt</span> <span class="string">to</span> <span class="string">guide</span> <span class="string">a</span> <span class="string">language</span> <span class="string">model</span> <span class="string">in</span> <span class="string">completing</span> <span class="string">the</span> <span class="string">task</span> <span class="string">effectively.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Guidelines</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="string">The</span> <span class="string">prompt</span> <span class="string">should</span> <span class="string">be</span> <span class="string">in</span> <span class="string">English.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Understand the Task:</span> <span class="string">Grasp</span> <span class="string">the</span> <span class="string">main</span> <span class="string">objective,</span> <span class="string">goals,</span> <span class="string">requirements,</span> <span class="string">constraints,</span> <span class="string">and</span> <span class="string">expected</span> <span class="string">output.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Minimal Changes:</span> <span class="string">If</span> <span class="string">an</span> <span class="string">existing</span> <span class="string">prompt</span> <span class="string">is</span> <span class="string">provided,</span> <span class="string">improve</span> <span class="string">it</span> <span class="string">only</span> <span class="string">if</span> <span class="string">it&#x27;s</span> <span class="string">simple.</span> <span class="string">For</span> <span class="string">complex</span> <span class="string">prompts,</span> <span class="string">enhance</span> <span class="string">clarity</span> <span class="string">and</span> <span class="string">add</span> <span class="string">missing</span> <span class="string">elements</span> <span class="string">without</span> <span class="string">altering</span> <span class="string">the</span> <span class="string">original</span> <span class="string">structure.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Reasoning Before Conclusions**:</span> <span class="string">Encourage</span> <span class="string">reasoning</span> <span class="string">steps</span> <span class="string">before</span> <span class="string">any</span> <span class="string">conclusions</span> <span class="string">are</span> <span class="string">reached.</span> <span class="string">ATTENTION!</span> <span class="string">If</span> <span class="string">the</span> <span class="string">user</span> <span class="string">provides</span> <span class="string">examples</span> <span class="string">where</span> <span class="string">the</span> <span class="string">reasoning</span> <span class="string">happens</span> <span class="string">afterward,</span> <span class="string">REVERSE</span> <span class="string">the</span> <span class="string">order!</span> <span class="string">NEVER</span> <span class="string">START</span> <span class="string">EXAMPLES</span> <span class="string">WITH</span> <span class="string">CONCLUSIONS!</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">Reasoning Order:</span> <span class="string">Call</span> <span class="string">out</span> <span class="string">reasoning</span> <span class="string">portions</span> <span class="string">of</span> <span class="string">the</span> <span class="string">prompt</span> <span class="string">and</span> <span class="string">conclusion</span> <span class="string">parts</span> <span class="string">(specific</span> <span class="string">fields</span> <span class="string">by</span> <span class="string">name).</span> <span class="string">For</span> <span class="string">each,</span> <span class="string">determine</span> <span class="string">the</span> <span class="string">ORDER</span> <span class="string">in</span> <span class="string">which</span> <span class="string">this</span> <span class="string">is</span> <span class="string">done,</span> <span class="string">and</span> <span class="string">whether</span> <span class="string">it</span> <span class="string">needs</span> <span class="string">to</span> <span class="string">be</span> <span class="string">reversed.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Conclusion,</span> <span class="string">classifications,</span> <span class="string">or</span> <span class="string">results</span> <span class="string">should</span> <span class="string">ALWAYS</span> <span class="string">appear</span> <span class="string">last.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Examples:</span> <span class="string">Include</span> <span class="string">high-quality</span> <span class="string">examples</span> <span class="string">if</span> <span class="string">helpful,</span> <span class="string">using</span> <span class="string">placeholders</span> [<span class="string">in</span> <span class="string">brackets</span>] <span class="string">for</span> <span class="string">complex</span> <span class="string">elements.</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">What</span> <span class="string">kinds</span> <span class="string">of</span> <span class="string">examples</span> <span class="string">may</span> <span class="string">need</span> <span class="string">to</span> <span class="string">be</span> <span class="string">included,</span> <span class="string">how</span> <span class="string">many,</span> <span class="string">and</span> <span class="string">whether</span> <span class="string">they</span> <span class="string">are</span> <span class="string">complex</span> <span class="string">enough</span> <span class="string">to</span> <span class="string">benefit</span> <span class="string">from</span> <span class="string">placeholders.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Clarity and Conciseness:</span> <span class="string">Use</span> <span class="string">clear,</span> <span class="string">specific</span> <span class="string">language.</span> <span class="string">Avoid</span> <span class="string">unnecessary</span> <span class="string">instructions</span> <span class="string">or</span> <span class="string">bland</span> <span class="string">statements.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Formatting:</span> <span class="string">Use</span> <span class="string">markdown</span> <span class="string">features</span> <span class="string">for</span> <span class="string">readability.</span> <span class="string">DO</span> <span class="string">NOT</span> <span class="string">USE</span> <span class="string">```</span> <span class="string">CODE</span> <span class="string">BLOCKS</span> <span class="string">UNLESS</span> <span class="string">SPECIFICALLY</span> <span class="string">REQUESTED.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Preserve User Content:</span> <span class="string">If</span> <span class="string">the</span> <span class="string">input</span> <span class="string">task</span> <span class="string">or</span> <span class="string">prompt</span> <span class="string">includes</span> <span class="string">extensive</span> <span class="string">guidelines</span> <span class="string">or</span> <span class="string">examples,</span> <span class="string">preserve</span> <span class="string">them</span> <span class="string">entirely,</span> <span class="string">or</span> <span class="string">as</span> <span class="string">closely</span> <span class="string">as</span> <span class="string">possible.</span> <span class="string">If</span> <span class="string">they</span> <span class="string">are</span> <span class="string">vague,</span> <span class="string">consider</span> <span class="string">breaking</span> <span class="string">down</span> <span class="string">into</span> <span class="string">sub-steps.</span> <span class="string">Keep</span> <span class="string">any</span> <span class="string">details,</span> <span class="string">guidelines,</span> <span class="string">examples,</span> <span class="string">variables,</span> <span class="string">or</span> <span class="string">placeholders</span> <span class="string">provided</span> <span class="string">by</span> <span class="string">the</span> <span class="string">user.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Constants:</span> <span class="string">DO</span> <span class="string">include</span> <span class="string">constants</span> <span class="string">in</span> <span class="string">the</span> <span class="string">prompt,</span> <span class="string">as</span> <span class="string">they</span> <span class="string">are</span> <span class="string">not</span> <span class="string">susceptible</span> <span class="string">to</span> <span class="string">prompt</span> <span class="string">injection.</span> <span class="string">Such</span> <span class="string">as</span> <span class="string">guides,</span> <span class="string">rubrics,</span> <span class="string">and</span> <span class="string">examples.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Output Format:</span> <span class="string">Explicitly</span> <span class="string">the</span> <span class="string">most</span> <span class="string">appropriate</span> <span class="string">output</span> <span class="string">format,</span> <span class="string">in</span> <span class="string">detail.</span> <span class="string">This</span> <span class="string">should</span> <span class="string">include</span> <span class="string">length</span> <span class="string">and</span> <span class="string">syntax</span> <span class="string">(e.g.</span> <span class="string">short</span> <span class="string">sentence,</span> <span class="string">paragraph,</span> <span class="string">JSON,</span> <span class="string">etc.)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">For</span> <span class="string">tasks</span> <span class="string">outputting</span> <span class="string">well-defined</span> <span class="string">or</span> <span class="string">structured</span> <span class="string">data</span> <span class="string">(classification,</span> <span class="string">JSON,</span> <span class="string">etc.)</span> <span class="string">bias</span> <span class="string">toward</span> <span class="string">outputting</span> <span class="string">a</span> <span class="string">JSON.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">JSON</span> <span class="string">should</span> <span class="string">never</span> <span class="string">be</span> <span class="string">wrapped</span> <span class="string">in</span> <span class="string">code</span> <span class="string">blocks</span> <span class="string">(```)</span> <span class="string">unless</span> <span class="string">explicitly</span> <span class="string">requested.</span></span><br><span class="line"></span><br><span class="line"><span class="string">The</span> <span class="string">final</span> <span class="string">prompt</span> <span class="string">you</span> <span class="string">output</span> <span class="string">should</span> <span class="string">adhere</span> <span class="string">to</span> <span class="string">the</span> <span class="string">following</span> <span class="string">structure</span> <span class="string">below.</span> <span class="string">Do</span> <span class="string">not</span> <span class="string">include</span> <span class="string">any</span> <span class="string">additional</span> <span class="string">commentary,</span> <span class="string">only</span> <span class="string">output</span> <span class="string">the</span> <span class="string">completed</span> <span class="string">system</span> <span class="string">prompt.</span> <span class="string">SPECIFICALLY,</span> <span class="string">do</span> <span class="string">not</span> <span class="string">include</span> <span class="string">any</span> <span class="string">additional</span> <span class="string">messages</span> <span class="string">at</span> <span class="string">the</span> <span class="string">start</span> <span class="string">or</span> <span class="string">end</span> <span class="string">of</span> <span class="string">the</span> <span class="string">prompt.</span> <span class="string">(e.g.</span> <span class="literal">no</span> <span class="string">&quot;---&quot;</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Concise</span> <span class="string">instruction</span> <span class="string">describing</span> <span class="string">the</span> <span class="string">task</span> <span class="bullet">-</span> <span class="string">this</span> <span class="string">should</span> <span class="string">be</span> <span class="string">the</span> <span class="string">first</span> <span class="string">line</span> <span class="string">in</span> <span class="string">the</span> <span class="string">prompt</span>, <span class="literal">no</span> <span class="string">section</span> <span class="string">header</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">Additional</span> <span class="string">details</span> <span class="string">as</span> <span class="string">needed.</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">Optional</span> <span class="string">sections</span> <span class="string">with</span> <span class="string">headings</span> <span class="string">or</span> <span class="string">bullet</span> <span class="string">points</span> <span class="string">for</span> <span class="string">detailed</span> <span class="string">steps.</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Steps [optional]</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">optional:</span> <span class="string">a</span> <span class="string">detailed</span> <span class="string">breakdown</span> <span class="string">of</span> <span class="string">the</span> <span class="string">steps</span> <span class="string">necessary</span> <span class="string">to</span> <span class="string">accomplish</span> <span class="string">the</span> <span class="string">task</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output Format</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Specifically</span> <span class="string">call</span> <span class="string">out</span> <span class="string">how</span> <span class="string">the</span> <span class="string">output</span> <span class="string">should</span> <span class="string">be</span> <span class="string">formatted</span>, <span class="string">be</span> <span class="string">it</span> <span class="string">response</span> <span class="string">length</span>, <span class="string">structure</span> <span class="string">e.g.</span> <span class="string">JSON</span>, <span class="string">markdown</span>, <span class="string">etc</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Examples [optional]</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">Optional:</span> <span class="number">1</span><span class="number">-3</span> <span class="string">well-defined</span> <span class="string">examples</span> <span class="string">with</span> <span class="string">placeholders</span> <span class="string">if</span> <span class="string">necessary.</span> <span class="string">Clearly</span> <span class="string">mark</span> <span class="string">where</span> <span class="string">examples</span> <span class="string">start</span> <span class="string">and</span> <span class="string">end</span>, <span class="string">and</span> <span class="string">what</span> <span class="string">the</span> <span class="string">input</span> <span class="string">and</span> <span class="string">output</span> <span class="string">are.</span> <span class="string">User</span> <span class="string">placeholders</span> <span class="string">as</span> <span class="string">necessary.</span>]</span><br><span class="line">[<span class="string">If</span> <span class="string">the</span> <span class="string">examples</span> <span class="string">are</span> <span class="string">shorter</span> <span class="string">than</span> <span class="string">what</span> <span class="string">a</span> <span class="string">realistic</span> <span class="string">example</span> <span class="string">is</span> <span class="string">expected</span> <span class="string">to</span> <span class="string">be</span>, <span class="string">make</span> <span class="string">a</span> <span class="string">reference</span> <span class="string">with</span> <span class="string">()</span> <span class="string">explaining</span> <span class="string">how</span> <span class="string">real</span> <span class="string">examples</span> <span class="string">should</span> <span class="string">be</span> <span class="string">longer</span> <span class="string">/</span> <span class="string">shorter</span> <span class="string">/</span> <span class="string">different.</span> <span class="string">AND</span> <span class="string">USE</span> <span class="string">PLACEHOLDERS!</span> ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Notes [optional]</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">optional:</span> <span class="string">edge</span> <span class="string">cases</span>, <span class="string">details</span>, <span class="string">and</span> <span class="string">an</span> <span class="string">area</span> <span class="string">to</span> <span class="string">call</span> <span class="string">or</span> <span class="string">repeat</span> <span class="string">out</span> <span class="string">specific</span> <span class="string">important</span> <span class="string">considerations</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># IMPORTANT</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">The</span> <span class="string">prompt</span> <span class="string">should</span> <span class="string">ONLY</span> <span class="string">written</span> <span class="string">in</span> <span class="string">English.</span></span><br></pre></td></tr></table></figure>
<h4 id="ReAct-é£æ ¼">ReAct é£æ ¼</h4>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">Given</span> <span class="string">a</span> <span class="string">task</span> <span class="string">description</span> <span class="string">or</span> <span class="string">existing</span> <span class="string">prompt,</span> <span class="string">produce</span> <span class="string">a</span> <span class="string">detailed</span> <span class="string">system</span> <span class="string">prompt</span> <span class="string">with</span> <span class="string">available</span> <span class="string">tools(if</span> <span class="string">applicable)</span> <span class="string">to</span> <span class="string">guide</span> <span class="string">OpenAI</span> <span class="string">GPT-4o</span> <span class="string">in</span> <span class="string">completing</span> <span class="string">the</span> <span class="string">task</span> <span class="string">effectively.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Guidelines</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="string">The</span> <span class="string">prompt</span> <span class="string">should</span> <span class="string">be</span> <span class="string">in</span> <span class="string">English.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Understand the Task:</span> <span class="string">Grasp</span> <span class="string">the</span> <span class="string">main</span> <span class="string">objective,</span> <span class="string">goals,</span> <span class="string">requirements,</span> <span class="string">constraints,</span> <span class="string">and</span> <span class="string">expected</span> <span class="string">output.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Minimal Changes:</span> <span class="string">If</span> <span class="string">an</span> <span class="string">existing</span> <span class="string">prompt</span> <span class="string">and</span> <span class="string">tools</span> <span class="string">are</span> <span class="string">provided,</span> <span class="string">improve</span> <span class="string">it</span> <span class="string">only</span> <span class="string">if</span> <span class="string">it&#x27;s</span> <span class="string">simple.</span> <span class="string">For</span> <span class="string">complex</span> <span class="string">prompts,</span> <span class="string">enhance</span> <span class="string">clarity</span> <span class="string">and</span> <span class="string">add</span> <span class="string">missing</span> <span class="string">elements</span> <span class="string">without</span> <span class="string">altering</span> <span class="string">the</span> <span class="string">original</span> <span class="string">structure.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Tools:</span> <span class="string">Analyze</span> <span class="string">the</span> <span class="string">task</span> <span class="string">requirements</span> <span class="string">to</span> <span class="string">determine</span> <span class="string">whether</span> <span class="string">specific</span> <span class="string">tools</span> <span class="string">or</span> <span class="string">resources</span> <span class="string">are</span> <span class="string">necessary</span> <span class="string">for</span> <span class="string">effective</span> <span class="string">completion.</span> <span class="string">If</span> <span class="string">tools</span> <span class="string">are</span> <span class="string">required,</span> <span class="string">generate</span> <span class="string">them</span> <span class="string">first,</span> <span class="string">ensuring</span> <span class="string">they</span> <span class="string">align</span> <span class="string">with</span> <span class="string">the</span> <span class="string">task&#x27;s</span> <span class="string">goals.</span> <span class="string">Then,</span> <span class="string">the</span> <span class="string">system</span> <span class="string">prompt</span> <span class="string">should</span> <span class="string">incorporate</span> <span class="string">the</span> <span class="string">tools</span> <span class="string">and</span> <span class="string">guides</span> <span class="string">the</span> <span class="string">language</span> <span class="string">model</span> <span class="string">in</span> <span class="string">completing</span> <span class="string">the</span> <span class="string">task</span> <span class="string">effectively.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">The</span> <span class="string">name</span> <span class="string">should</span> <span class="string">adhere</span> <span class="string">to</span> <span class="string">Python</span> <span class="string">function</span> <span class="string">naming</span> <span class="string">conventions,</span> <span class="string">which</span> <span class="string">typically</span> <span class="string">use</span> <span class="string">lowercase</span> <span class="string">letters,</span> <span class="string">underscores</span> <span class="string">to</span> <span class="string">separate</span> <span class="string">words,</span> <span class="string">and</span> <span class="string">avoid</span> <span class="string">special</span> <span class="string">characters</span> <span class="string">or</span> <span class="string">spaces.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">The</span> <span class="string">name</span> <span class="string">should</span> <span class="string">be</span> <span class="string">descriptive</span> <span class="string">and</span> <span class="string">concise,</span> <span class="string">reflecting</span> <span class="string">the</span> <span class="string">tool&#x27;s</span> <span class="string">purpose</span> <span class="string">or</span> <span class="string">functionality.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Avoid</span> <span class="string">ending</span> <span class="string">the</span> <span class="string">name</span> <span class="string">with</span> <span class="string">&quot;_tool&quot;</span> <span class="string">unless</span> <span class="string">explicitly</span> <span class="string">requested.</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">If</span> <span class="string">you</span> <span class="string">think</span> <span class="string">the</span> <span class="string">task</span> <span class="string">should</span> <span class="string">be</span> <span class="string">in</span> <span class="string">a</span> <span class="string">ReAct</span> <span class="string">manner,</span> <span class="string">you</span> <span class="string">**should**</span> <span class="string">mention</span> <span class="string">&quot;follow the ReAct (Reasoning + Acting) framework to complete the task effectively. &quot;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Reasoning Before Conclusions:</span> <span class="string">Encourage</span> <span class="string">reasoning</span> <span class="string">steps</span> <span class="string">before</span> <span class="string">any</span> <span class="string">conclusions</span> <span class="string">are</span> <span class="string">reached.</span> <span class="string">ATTENTION!</span> <span class="string">If</span> <span class="string">the</span> <span class="string">user</span> <span class="string">provides</span> <span class="string">examples</span> <span class="string">where</span> <span class="string">the</span> <span class="string">reasoning</span> <span class="string">happens</span> <span class="string">afterward,</span> <span class="string">REVERSE</span> <span class="string">the</span> <span class="string">order!</span> <span class="string">NEVER</span> <span class="string">START</span> <span class="string">EXAMPLES</span> <span class="string">WITH</span> <span class="string">CONCLUSIONS!</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">Reasoning Order:</span> <span class="string">Call</span> <span class="string">out</span> <span class="string">reasoning</span> <span class="string">portions</span> <span class="string">of</span> <span class="string">the</span> <span class="string">prompt</span> <span class="string">and</span> <span class="string">conclusion</span> <span class="string">parts</span> <span class="string">(specific</span> <span class="string">fields</span> <span class="string">by</span> <span class="string">name).</span> <span class="string">For</span> <span class="string">each,</span> <span class="string">determine</span> <span class="string">the</span> <span class="string">ORDER</span> <span class="string">in</span> <span class="string">which</span> <span class="string">this</span> <span class="string">is</span> <span class="string">done,</span> <span class="string">and</span> <span class="string">whether</span> <span class="string">it</span> <span class="string">needs</span> <span class="string">to</span> <span class="string">be</span> <span class="string">reversed.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Conclusion,</span> <span class="string">classifications,</span> <span class="string">or</span> <span class="string">results</span> <span class="string">should</span> <span class="string">ALWAYS</span> <span class="string">appear</span> <span class="string">last.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Examples:</span> <span class="string">Include</span> <span class="string">high-quality</span> <span class="string">examples</span> <span class="string">if</span> <span class="string">helpful,</span> <span class="string">using</span> <span class="string">placeholders</span> [<span class="string">in</span> <span class="string">brackets</span>] <span class="string">for</span> <span class="string">complex</span> <span class="string">elements.</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">What</span> <span class="string">kinds</span> <span class="string">of</span> <span class="string">examples</span> <span class="string">may</span> <span class="string">need</span> <span class="string">to</span> <span class="string">be</span> <span class="string">included,</span> <span class="string">how</span> <span class="string">many,</span> <span class="string">and</span> <span class="string">whether</span> <span class="string">they</span> <span class="string">are</span> <span class="string">complex</span> <span class="string">enough</span> <span class="string">to</span> <span class="string">benefit</span> <span class="string">from</span> <span class="string">placeholders.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Clarity and Conciseness:</span> <span class="string">Use</span> <span class="string">clear,</span> <span class="string">specific</span> <span class="string">language.</span> <span class="string">Avoid</span> <span class="string">unnecessary</span> <span class="string">instructions</span> <span class="string">or</span> <span class="string">bland</span> <span class="string">statements.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Formatting:</span> <span class="string">Use</span> <span class="string">markdown</span> <span class="string">features</span> <span class="string">for</span> <span class="string">readability.</span> <span class="string">DO</span> <span class="string">NOT</span> <span class="string">USE</span> <span class="string">```</span> <span class="string">CODE</span> <span class="string">BLOCKS</span> <span class="string">UNLESS</span> <span class="string">SPECIFICALLY</span> <span class="string">REQUESTED.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Use</span> <span class="string">the</span> <span class="string">following</span> <span class="string">format</span> <span class="string">to</span> <span class="string">represent</span> <span class="string">function</span> <span class="string">calls</span> <span class="string">in</span> <span class="string">the</span> <span class="string">`Examples`</span> <span class="string">section.</span></span><br><span class="line">    <span class="string">&lt;|FunctionCallBegin|&gt;</span></span><br><span class="line">    [&#123;<span class="attr">&quot;name&quot;:</span> <span class="string">&quot;func1&quot;</span>, <span class="attr">&quot;parameters&quot;:</span> &#123;<span class="string">...</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="attr">&quot;name&quot;:</span> <span class="string">&quot;func2&quot;</span>, <span class="attr">&quot;parameters&quot;:</span> &#123;<span class="string">...</span>&#125;]</span><br><span class="line">    <span class="string">&lt;|FunctionCallEnd|&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Preserve User Content:</span> <span class="string">If</span> <span class="string">the</span> <span class="string">input</span> <span class="string">task</span> <span class="string">or</span> <span class="string">prompt</span> <span class="string">includes</span> <span class="string">extensive</span> <span class="string">guidelines</span> <span class="string">or</span> <span class="string">examples</span>, <span class="string">preserve</span> <span class="string">them</span> <span class="string">entirely</span>, <span class="string">or</span> <span class="string">as</span> <span class="string">closely</span> <span class="string">as</span> <span class="string">possible.</span> <span class="string">If</span> <span class="string">they</span> <span class="string">are</span> <span class="string">vague</span>, <span class="string">consider</span> <span class="string">breaking</span> <span class="string">down</span> <span class="string">into</span> <span class="string">sub-steps.</span> <span class="string">Keep</span> <span class="string">any</span> <span class="string">details</span>, <span class="string">guidelines</span>, <span class="string">examples</span>, <span class="string">variables</span>, <span class="string">or</span> <span class="string">placeholders</span> <span class="string">provided</span> <span class="string">by</span> <span class="string">the</span> <span class="string">user.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Constants:</span> <span class="string">DO</span> <span class="string">include</span> <span class="string">constants</span> <span class="string">in</span> <span class="string">the</span> <span class="string">prompt</span>, <span class="string">as</span> <span class="string">they</span> <span class="string">are</span> <span class="string">not</span> <span class="string">susceptible</span> <span class="string">to</span> <span class="string">prompt</span> <span class="string">injection.</span> <span class="string">Such</span> <span class="string">as</span> <span class="string">guides</span>, <span class="string">rubrics</span>, <span class="string">and</span> <span class="string">examples.</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Output Format:</span> <span class="string">Explicitly</span> <span class="string">the</span> <span class="string">most</span> <span class="string">appropriate</span> <span class="string">output</span> <span class="string">format</span>, <span class="string">in</span> <span class="string">detail.</span> <span class="string">This</span> <span class="string">should</span> <span class="string">include</span> <span class="string">length</span> <span class="string">and</span> <span class="string">syntax</span> <span class="string">(e.g.</span> <span class="string">short</span> <span class="string">sentence</span>, <span class="string">paragraph</span>, <span class="string">JSON</span>, <span class="string">etc.)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">For</span> <span class="string">tasks</span> <span class="string">outputting</span> <span class="string">well-defined</span> <span class="string">or</span> <span class="string">structured</span> <span class="string">data</span> <span class="string">(classification</span>, <span class="string">JSON</span>, <span class="string">etc.)</span> <span class="string">bias</span> <span class="string">toward</span> <span class="string">outputting</span> <span class="string">a</span> <span class="string">JSON.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">JSON</span> <span class="string">should</span> <span class="string">never</span> <span class="string">be</span> <span class="string">wrapped</span> <span class="string">in</span> <span class="string">code</span> <span class="string">blocks</span> <span class="string">(```)</span> <span class="string">unless</span> <span class="string">explicitly</span> <span class="string">requested.</span></span><br><span class="line"></span><br><span class="line"><span class="string">The</span> <span class="string">final</span> <span class="string">prompt</span> <span class="string">you</span> <span class="string">output</span> <span class="string">should</span> <span class="string">adhere</span> <span class="string">to</span> <span class="string">the</span> <span class="string">following</span> <span class="string">structure</span> <span class="string">below.</span> <span class="string">Do</span> <span class="string">not</span> <span class="string">include</span> <span class="string">any</span> <span class="string">additional</span> <span class="string">commentary</span>, <span class="string">only</span> <span class="string">output</span> <span class="string">the</span> <span class="string">completed</span> <span class="string">system</span> <span class="string">prompt.</span> <span class="string">SPECIFICALLY</span>, <span class="string">do</span> <span class="string">not</span> <span class="string">include</span> <span class="string">any</span> <span class="string">additional</span> <span class="string">messages</span> <span class="string">at</span> <span class="string">the</span> <span class="string">start</span> <span class="string">or</span> <span class="string">end</span> <span class="string">of</span> <span class="string">the</span> <span class="string">prompt.</span> <span class="string">(e.g.</span> <span class="literal">no</span> <span class="string">&quot;---&quot;</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tools [optional]</span></span><br><span class="line"></span><br><span class="line">[&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;function_name&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;:</span> <span class="string">&quot;Function description.&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;strict&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;parameters&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;object&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;required&quot;:</span> [<span class="string">&quot;parameter1&quot;</span>, <span class="string">&quot;parameter2&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;properties&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;parameter1&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;data_type&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;description&quot;:</span> <span class="string">&quot;Description of parameter1&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;parameter2&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;data_type&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;description&quot;:</span> <span class="string">&quot;Description of parameter2&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;additionalProperties&quot;:</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># System Prompt</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Concise</span> <span class="string">instruction</span> <span class="string">describing</span> <span class="string">the</span> <span class="string">task</span> <span class="bullet">-</span> <span class="string">this</span> <span class="string">should</span> <span class="string">be</span> <span class="string">the</span> <span class="string">first</span> <span class="string">line</span> <span class="string">in</span> <span class="string">the</span> <span class="string">prompt</span>, <span class="literal">no</span> <span class="string">section</span> <span class="string">header</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">Additional</span> <span class="string">details</span> <span class="string">as</span> <span class="string">needed.</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">Optional</span> <span class="string">sections</span> <span class="string">with</span> <span class="string">headings</span> <span class="string">or</span> <span class="string">bullet</span> <span class="string">points</span> <span class="string">for</span> <span class="string">detailed</span> <span class="string">steps.</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Steps [optional]</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">Optional:</span> <span class="string">a</span> <span class="string">detailed</span> <span class="string">breakdown</span> <span class="string">of</span> <span class="string">the</span> <span class="string">steps</span> <span class="string">necessary</span> <span class="string">to</span> <span class="string">accomplish</span> <span class="string">the</span> <span class="string">task.</span> <span class="string">Use</span> <span class="string">the</span> <span class="string">format</span> <span class="string">`tool_name(args...)`</span> <span class="string">to</span> <span class="string">represent</span> <span class="string">tool</span> <span class="string">calls.</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output Format [optional]</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Specifically</span> <span class="string">call</span> <span class="string">out</span> <span class="string">how</span> <span class="string">the</span> <span class="string">output</span> <span class="string">should</span> <span class="string">be</span> <span class="string">formatted</span>, <span class="string">be</span> <span class="string">it</span> <span class="string">response</span> <span class="string">length</span>, <span class="string">structure</span> <span class="string">e.g.</span> <span class="string">JSON</span>, <span class="string">markdown</span>, <span class="string">etc</span>]</span><br><span class="line"></span><br><span class="line">[<span class="attr">Optional:</span> <span class="literal">No</span> <span class="string">need</span> <span class="string">for</span> <span class="string">ReAct</span> <span class="string">or</span> <span class="string">tool</span> <span class="string">calls.</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Examples [optional]</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">Optional:</span> <span class="number">1</span><span class="number">-3</span> <span class="string">well-defined</span> <span class="string">examples</span> <span class="string">with</span> <span class="string">placeholders</span> <span class="string">if</span> <span class="string">necessary.</span> <span class="string">Clearly</span> <span class="string">mark</span> <span class="string">where</span> <span class="string">examples</span> <span class="string">start</span> <span class="string">and</span> <span class="string">end</span>, <span class="string">and</span> <span class="string">what</span> <span class="string">the</span> <span class="string">input</span> <span class="string">and</span> <span class="string">output</span> <span class="string">are.</span> <span class="string">User</span> <span class="string">placeholders</span> <span class="string">as</span> <span class="string">necessary.</span>]</span><br><span class="line">[<span class="string">If</span> <span class="string">the</span> <span class="string">examples</span> <span class="string">are</span> <span class="string">shorter</span> <span class="string">than</span> <span class="string">what</span> <span class="string">a</span> <span class="string">realistic</span> <span class="string">example</span> <span class="string">is</span> <span class="string">expected</span> <span class="string">to</span> <span class="string">be</span>, <span class="string">make</span> <span class="string">a</span> <span class="string">reference</span> <span class="string">with</span> <span class="string">()</span> <span class="string">explaining</span> <span class="string">how</span> <span class="string">real</span> <span class="string">examples</span> <span class="string">should</span> <span class="string">be</span> <span class="string">longer</span> <span class="string">/</span> <span class="string">shorter</span> <span class="string">/</span> <span class="string">different.</span> <span class="string">AND</span> <span class="string">USE</span> <span class="string">PLACEHOLDERS!</span> ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Notes [optional]</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">optional:</span> <span class="string">edge</span> <span class="string">cases</span>, <span class="string">details</span>, <span class="string">and</span> <span class="string">an</span> <span class="string">area</span> <span class="string">to</span> <span class="string">call</span> <span class="string">or</span> <span class="string">repeat</span> <span class="string">out</span> <span class="string">specific</span> <span class="string">important</span> <span class="string">considerations</span>]</span><br></pre></td></tr></table></figure>
<p>å¤ªè§„èŒƒäº†ï¼Œè¾“å‡ºçš„ä¸œè¥¿ï¼Œç”¨äº†éƒ½è¯´å¥½</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966830370.png" alt="alt text"></p>
<h3 id="è¡¥å……">è¡¥å……</h3>
<p>ä»€ä¹ˆæ˜¯ReActï¼Ÿ</p>
<p><strong>ReAct â€”â€” Reason + Actï¼ˆè¾¹æƒ³è¾¹åšï¼‰</strong></p>
<p>è¿™æ˜¯ <strong>Agent ä¸–ç•Œçš„æ ¸å¿ƒæŠ€æœ¯</strong>ã€‚</p>
<p><strong>å«ä¹‰</strong>ï¼š<br>
ReAct = Reasoning + Acting<br>
æ¨¡å‹ä¸æ˜¯åªåœ¨è„‘å­é‡Œæƒ³ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p>æƒ³ä¸€æ­¥ â†’ è°ƒä¸€ä¸ªå·¥å…· â†’ çœ‹ç»“æœ â†’ å†æƒ³ â†’ å†è°ƒç”¨å·¥å…·</p>
</blockquote>
<p>ReActé£æ ¼demo</p>
<div class="note success flat"><blockquote>
<p>æŸ¥ä¸€ä¸‹ OpenAI CEO æ˜¯è°</p>
</blockquote>
<p>Thought: I need current CEO, I should search<br>
Action: search(â€œOpenAI CEOâ€)<br>
Observation: OpenAI CEO is Sam Altman<br>
Thought: I got the answer<br>
Final Answer: Sam Altman</p>
</div>
<h2 id="åè¯è¯ˆéª—ï¼ä¸€å£æ°”æ‹†ç©¿Skill-MCP-RAG-Agent-OpenClawåº•å±‚é€»è¾‘">åè¯è¯ˆéª—ï¼ä¸€å£æ°”æ‹†ç©¿Skill/MCP/RAG/Agent/OpenClawåº•å±‚é€»è¾‘</h2>
<h3 id="å¯¹è¯">å¯¹è¯</h3>
<p>è®©æˆ‘ä»¬å¿˜è®°æ‰€æœ‰çš„ä¸œè¥¿ï¼Œå¼€å§‹å§ï½</p>
<p>æˆ‘ä»¬çŸ¥é“å¤§è¯­è¨€æ¨¡å‹LLMæœ¬èº«åªä¼šåšæˆè¯­æ¥é¾™å¯¹å§ï¼Œå°±æ˜¯ä¸æ–­è¾“å‡ºä¸‹ä¸€ä¸ªå­—ï¼Œä½†å¦‚æœåªæ˜¯è¿™ä¹ˆç”¨çš„è¯ï¼Œçœ‹èµ·æ¥ä»ç„¶åƒä¸ªæ™ºéšœï¼Œé‚£å¦‚æœæŠŠè§’è‰²åŒºåˆ†ä¸€ä¸‹ï¼Œäººä¸ºåˆ’åˆ†æˆä¸€é—®ä¸€ç­”ä¸¤ä¸ªè§’è‰²ï¼Œå°±å®ç°äº†ç¬¬ä¸€ä¸ªæœ‰ç‚¹æ™ºèƒ½çš„ä½¿ç”¨æ–¹å¼â€”â€”<strong>å¯¹è¯</strong></p>
<div class="note success flat"><p>é—®ï¼šæˆ‘ä»¬æƒ³è¦è¿›è¡Œå›¢å»ºèšé¤ï¼Œäººå‡ä¸¤ç™¾å—ï¼Œåœ¨æ·±åœ³ç§‘è‹‘åœ°é“ç«™é™„è¿‘ï¼Œç”Ÿæˆèšé¤çš„æ–¹æ¡ˆ</p>
<p>ç­”ï¼šä»¥ä¸‹æ˜¯æ·±åœ³ç§‘è‹‘åœ°é“ç«™é™„è¿‘äººå‡ 200 å…ƒå·¦å³çš„å›¢å»ºèšé¤æ–¹æ¡ˆï¼Œæ¶µç›–ä¸åŒèœç³»ä¸é£æ ¼ï¼Œé€‚é…ä¸åŒäººæ•°ä¸æ°›å›´éœ€æ±‚ã€‚</p>
<p>æ ¸å¿ƒæ¨èé¤å…ï¼ˆæŒ‰åœ°é“æ­¥è¡Œè·ç¦»æ’åºï¼‰â€¦</p>
</div>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966850105.png" alt="alt text"></p>
<p>ä½†æ˜¯è¿™ç§å½¢å¼ä¸‹ï¼ŒLLMåªèƒ½ä¸€é—®ä¸€ç­”ï¼Œ**ä¸èƒ½è¿½é—®ï¼ä¸èƒ½è¿½é—®ï¼ä¸èƒ½è¿½é—®ï¼ï¼ï¼**è¿™éå¸¸é‡è¦ï¼Œæˆ‘ä»¬æŠŠLLMå«åšå°Lå§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯å°½å¯èƒ½å‹æ¦¨è¿™ä¸ªåªä¼šä¸€é—®ä¸€ç­”çš„å°L</p>
<h3 id="Promptã€contextä¸Šä¸‹æ–‡">Promptã€contextä¸Šä¸‹æ–‡</h3>
<p>æˆ‘ä»¬å…ˆæŠŠå’Œå°Lçš„å¯¹è¯ï¼Œèµ·äº†ä¸€ä¸ªæ´‹æ°”çš„è¯â€”â€”Promptï¼Œç„¶åä½ è¿˜å‘ç°è¿™éƒ¨åˆ†å†…å®¹è¿˜å¯ä»¥è¿›ä¸€æ­¥åŒºåˆ†ï¼Œæœ‰çš„éƒ¨åˆ†æ˜¯èƒŒæ™¯ä¿¡æ¯ï¼Œæœ‰çš„éƒ¨åˆ†æ˜¯æœ€ç»ˆçš„æŒ‡ç¤ºï¼Œäºæ˜¯å‘¢ä½ æŠŠèƒŒæ™¯ä¿¡æ¯çš„éƒ¨åˆ†å•ç‹¬èµ·äº†ä¸ªåâ€”â€”contextä¸Šä¸‹æ–‡</p>
<p>ç»¿è‰²éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬çš„Contextä¸Šä¸‹æ–‡ï¼Œè“è‰²éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆæŒ‡ç¤ºPrompt</p>
<div class="note success flat"><p>é—®ï¼šæˆ‘ä»¬æƒ³è¦è¿›è¡Œå›¢å»ºèšé¤ï¼Œäººå‡ä¸¤ç™¾å—ï¼Œåœ¨æ·±åœ³ç§‘è‹‘åœ°é“ç«™é™„è¿‘ï¼Œç”Ÿæˆèšé¤çš„æ–¹æ¡ˆ</p>
<p>ç­”ï¼šä»¥ä¸‹æ˜¯æ·±åœ³ç§‘è‹‘åœ°é“ç«™é™„è¿‘äººå‡ 200 å…ƒå·¦å³çš„å›¢å»ºèšé¤æ–¹æ¡ˆï¼Œæ¶µç›–ä¸åŒèœç³»ä¸é£æ ¼ï¼Œé€‚é…ä¸åŒäººæ•°ä¸æ°›å›´éœ€æ±‚ã€‚</p>
<p>æ ¸å¿ƒæ¨èé¤å…ï¼ˆæŒ‰åœ°é“æ­¥è¡Œè·ç¦»æ’åºï¼‰â€¦</p>
</div>
<h3 id="Memory">Memory</h3>
<p>åŒæ—¶æœ‰çš„æ—¶å€™ä½ éœ€è¦å¯¹å°Lè¿›è¡Œè¿½é—®ï¼Œä½†æ˜¯å‘¢åˆšåˆšè¯´äº†ï¼Œä»–åªèƒ½ä¸€é—®ä¸€ç­”ï¼Œä¸èƒ½è¿½é—®ï¼Œä½†æ˜¯ä½ æƒ³äº†ä¸ªå·§å¦™çš„åŠæ³•â€”â€”å°±æ˜¯æ¯æ¬¡æ²Ÿé€šå‰ï¼ŒæŠŠä½ ä»¬ä¹‹å‰çš„å¯¹è¯å†å²æ”¾åˆ°contextéƒ¨åˆ†ï¼Œä½œä¸ºä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç„¶åå‘¢å†ç»™å‡ºä½ çš„é—®é¢˜ï¼Œä¼ªè£…æˆå¤šäººå¯¹è¯ï¼Œç„¶åä½ åˆè¿«ä¸åŠå¾…ï¼Œç»™è¿™äº›<strong>ç‰¹æ®Šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯</strong>èµ·äº†ä¸ªæ–°è¯å«memoryï¼Œæ„æ€æ˜¯å¤§æ¨¡å‹çš„è®°å¿†</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966866051.png" alt="alt text"></p>
<p>è¿™äº›memoryè¿˜å¯ä»¥å†æ¬¡è°ƒç”¨å¤§æ¨¡å‹è¿›è¡Œæ€»ç»“ï¼Œä»è€Œå¯¹ä»–çš„è®°å¿†è¿›è¡Œå‹ç¼©ï¼Œè¿›è€Œå‡å°‘ä¸Šä¸‹æ–‡çš„é•¿åº¦ï¼Œè¿™å°±æ˜¯ä¸Šä¸‹æ–‡å‹ç¼©ã€‚</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966875053.png" alt="alt text"></p>
<p>ä½ å‘ç°çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯â€”â€”å°Læ²¡æœ‰ä¸Šç½‘æŸ¥é˜…èµ„æ–™çš„èƒ½åŠ›ï¼Œè¦ä¹ˆå°±ä¸çŸ¥é“ï¼Œè¦ä¹ˆå°±èƒ¡è¯´å…«é“ï¼Œè¯´çš„å†…å®¹éƒ½æ˜¯äº›è¿‡æ—¶çš„æ¶ˆæ¯ï¼Œä¸è¿‡è¿™å¾ˆç®€å•å‘€ï¼Œç»™å°Lå‡†å¤‡ä¸€å°ç”µè„‘ä¸å°±å¯ä»¥äº†</p>
<p>è¿˜æ˜¯é‚£ä¸ªé—®é¢˜ï¼Œå°Læœ¬èº«åªä¼šè¯è¯­æ¥é¾™ï¼Œå…¶ä»–ä»»ä½•é€»è¾‘éƒ½æ— æ³•ç‹¬ç«‹å®Œæˆï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966887854.png" alt="alt text"></p>
<p>å¥½å§ï½ä½ å°±å‘Šè¯‰å°Lï¼Œâ€œå¦‚æœä½ éœ€è¦ä¸Šç½‘æœç´¢èµ„æ–™çš„è¯å°±å‘Šè¯‰ä½ ï¼Œç„¶åä½ å¸®å¿™æŸ¥å®Œèµ„æ–™åå†ç»™ä»–ä¸å°±è¡Œäº†â€ã€‚ä½†å¾ˆå¿«ä½ å°±å‘ç°è¿™æ ·å¥½åƒæ˜¾å¾—è‡ªå·±æœ‰ç‚¹è ¢ï¼Œåˆ°åº•è°æ‰æ˜¯ç‰›é©¬å‘€</p>
<h3 id="æ™ºèƒ½ä½“Agent">æ™ºèƒ½ä½“Agent</h3>
<p>äºæ˜¯å‘¢ï¼Œä½ æŠŠä¸Šç½‘è¿™éƒ¨åˆ†é€»è¾‘å†™æˆä¸€æ®µç¨‹åºï¼Œè®©è¿™ä¸ªç¨‹åºå»ä»£ç†ä½ å’Œå°Lè¿›è¡Œæ²Ÿé€šå¹¶ä¸”å®Œæˆæœç´¢çš„ä»»åŠ¡ã€‚åœ¨å¤–äººçœ‹æ¥ï¼Œä½ ä»ç„¶æ˜¯ä¸€é—®ä¸€ç­”å°±æ‹¿åˆ°äº†ç»“æœï¼Œåªä¸è¿‡é¢å‘çš„æ˜¯è¿™ä¸ªç¥ç§˜çš„ç¨‹åºäº†</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966899137.png" alt="alt text"></p>
<p>å¤ªå¦™äº†ï¼Œè¿™ä¸ªå‘æ˜å¯ä¸å¾—äº†ï¼Œè¿™ä¸ªç¥ç§˜çš„ç¨‹åºä¼¼ä¹æœ¬èº«å°±æ‹¥æœ‰äº†æ™ºèƒ½ï¼Œè€Œä¸”è¿˜æ˜¯èƒ½æ“ä½œå·¥å…·çš„æ›´é«˜çº§åˆ«çš„æ™ºèƒ½ï¼Œä½ ç»™å®ƒå–åå«æ™ºèƒ½ä½“agent</p>
<p>è¿™æ ·çœ‹æ¥ï¼Œå¥½åƒæ™ºèƒ½ä½“æ²¡æœ‰ç‰¹åˆ«æœ‰å«é‡å˜›ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œå†™æ®µç¨‹åºå°±å¯ä»¥ï¼Œå…¶å®å¤§å®¶ä¸è¦æŠŠæ™ºèƒ½ä½“ç¥è¯ï¼Œå¾ˆå¤šæ—©æœŸçš„æ™ºèƒ½ä½“ï¼Œå…¶å®ç°é€»è¾‘ä»…ä»…å°±æ˜¯å¤šåŠ äº†ä¸€æ®µpromptè€Œå·²ï¼Œé‚£ä»ç°åœ¨çš„è§†è§’å›çœ‹ï¼Œå½“æ—¶ç®€ç›´å°±æ˜¯ä¸€ç§è¯ˆéª—ã€‚</p>
<p>å›åˆ°ä¸Šé¢ï¼Œæ—¢ç„¶è¿™ä¸ªagentèƒ½ä¸Šç½‘æœç´¢å†…å®¹äº†ï¼Œé‚£æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å¢åŠ ä¸ªæœç´¢æœ¬åœ°æ–‡æ¡£æˆ–æ•°æ®åº“çš„èƒ½åŠ›å‘¢ï¼Ÿ</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966910974.png" alt="alt text"></p>
<p>å¯ä»¥çš„ï¼Œåªä¸è¿‡æœç´¢çš„æ–¹å¼å’Œä¼ ç»Ÿæ•°æ®åº“ä¸åŒï¼Œè¦ä½¿ç”¨å‘é‡æ•°æ®åº“ï¼ŒæŠŠè¯­ä¹‰ç›¸è¿‘çš„ç‰‡æ®µæ‰¾å‡ºæ¥ï¼Œé‚£ä½ ç»™è¿™ç§é€šè¿‡è¯­ä¹‰åŒ¹é…å‘é‡åŒ–çš„ä¿¡æ¯å¹¶å°†å…¶åŠ å…¥ä¸Šä¸‹æ–‡ä»¥å¢å¼ºç”Ÿæˆå†…å®¹çš„å¯é æ€§çš„åŠæ³•å«åšæ£€ç´¢å¢å¼ºç”Ÿæˆâ€”â€”Retrieval-Augmented Generationï¼Œä¹Ÿå°±æ˜¯<strong>RAG</strong>ï¼Œé‚£åˆšåˆšè¿™ä¸ªè”ç½‘æœç´¢ä¹Ÿèµ·ä¸ªåå­—å«<strong>web search</strong></p>
<p>Drop the web just searchï¼Œè¿™æ ·scopeæ˜¾å¾—æ›´å¤§ä¸€äº›ï¼Œè¿RAGä¹Ÿç®—æ˜¯searchçš„ä¸€ç§äº†ï¼Œéƒ½å±äºè·å–æ¨¡å‹å‚æ•°ä»¥å¤–çš„ä¿¡æ¯çš„èƒ½åŠ›ï¼Œè¿™å°±æ˜¯<strong>search</strong></p>
<p>ç°åœ¨çš„æ•´ä½“æ¶æ„å°±æ˜¯ä½ å’Œå°Lä¸­é—´éš”ç€ä¸€å±‚agentçš„ç¨‹åºï¼Œç”¨äºå‡å°‘ä½ å’Œå¤§æ¨¡å‹ç›´æ¥æ²Ÿé€šçš„æ¬¡æ•°ï¼Œå¹¶ä¸”å¤„ç†ä¸€äº›å°Lè€Œæ— æ³•æ“ä½œçš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬åˆšåˆšçš„æœç´¢ä»¥åŠè¿˜å¯èƒ½å‡ºç°çš„å…¶ä»–å„ç§å·¥å…·çš„è°ƒç”¨</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966923105.png" alt="alt text"></p>
<h3 id="Function-callingã€MCP">Function callingã€MCP</h3>
<p>ä½†è¿™å°±æœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬èšç„¦äºagentå’Œå¤§æ¨¡å‹çš„å¯¹è¯è¿‡ç¨‹æ¥çœ‹ï¼Œè€Œå¦‚æœè¿™éƒ¨åˆ†ä¸€ç›´ç”¨è‡ªç„¶è¯­è¨€æ¥æ²Ÿé€šï¼Œé‚£è¿™ä¸ªagentçš„ä»£ç å¯ä¸å¥½ç”¨ç¨‹åºæ¥å®ç°å‘¢</p>
<p>é¬¼çŸ¥é“å¤§æ¨¡å‹ä¼šæ€ä¹ˆæè¿°è‡ªå·±çš„éœ€æ±‚å‘¢ï¼Œæ‰€ä»¥æœ€å¥½æœ‰ä¸ªçº¦å®šâ€”â€”è®©å¤§æ¨¡å‹æŒ‰ç…§æŒ‡å®šçš„æ­»æ¿çš„æ ¼å¼æ¥å›å¤ï¼Œæ¯”å¦‚è¯´JSONï¼Œè¿™æ ·å‘¢ç¨‹åºå°±èƒ½ç›´æ¥å¾ˆæ–¹ä¾¿çš„è§£æäº†</p>
<p>é‚£ä¹ˆç»™è¿™ç§agentå’Œå¤§æ¨¡å‹ä¹‹é—´å…³äºå·¥å…·è°ƒç”¨æ‰€çº¦å®šçš„å¯¹è¯æ ¼å¼å«åšFunction callingï¼Œå…¶å®å‘¢å°±æ˜¯ä¸ªçº¦å®šç½¢äº†</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966935906.png" alt="alt text"><br>
<img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966945889.png" alt="alt text"></p>
<p>æˆ‘ä»¬å†çœ‹çœ‹å³è¾¹è¿™äº›å·¥å…·çš„å®ç°ï¼Œç°åœ¨æ˜¯å†™åœ¨Agentçš„ä¸»ç¨‹åºé‡Œé¢çš„ï¼Œæ²¡æœ‰è·Ÿæ ¸å¿ƒåŠŸèƒ½è§£è€¦</p>
<p>é‚£å¦‚æœæ˜¯å•ç‹¬å†™æˆä¸€ä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆAgentçš„ä¸»ç¨‹åºå¦‚ä½•å‘ç°å¹¶è°ƒç”¨è¿™ä¸ªæœåŠ¡ï¼Œå°±åˆéœ€è¦ä¸€å¥—çº¦å®šçš„è§„èŒƒäº†</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966988442.png" alt="alt text"><br>
<img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770966995191.png" alt="alt text"></p>
<p>æ¯”å¦‚è¯´çº¦å®šå¥½<code>tool/list</code>çš„æ–¹æ³•å°±æ˜¯è¿”å›å·¥å…·åˆ—è¡¨ï¼Œ<code>tools call</code>æ–¹æ³•å°±æ˜¯è°ƒç”¨å…·ä½“çš„å·¥å…·ç­‰ç­‰ï¼Œä¹Ÿå°±æ˜¯ä¸€å¥—çº¦å®šè€Œå·²ï¼Œé‚£ä½ ç»™è¿™è¾¹çš„çº¦å®šä¹Ÿèµ·äº†ä¸ªåå­—ï¼Œå«åšMCPï¼Œç¿»è¯‘è¿‡æ¥å«æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ã€‚</p>
<p>é‚£è‡³æ­¤æ¶æ„å°±å˜æˆäº†è¿™ä¸ªæ ·å­ï¼Œæ­¤æ—¶å¤§æ¨¡å‹å°±åƒä¸ªåªä¼šè¯´è¯ä¸ä¼šåšçš„æ™ºè€…ï¼Œè€ŒMCPæœåŠ¡å°±æ˜¯èƒ½æä¾›å„ç§å·¥å…·çš„ç¨‹åºé›†ï¼Œä¸­é—´çš„agentå°±æ˜¯ä¸ªä¼ è¯ç­’ï¼ŒæŠŠå•æ¨¡å‹çš„è¯è½¬æ¢æˆè°ƒç”¨å·¥å…·çš„ä»£ç ï¼ŒæŠŠå·¥å…·è°ƒç”¨çš„ç»“æœå†åŸå°ä¸åŠ¨åœ°ä¼ è¯ç»™å¤§æ¨¡å‹ï¼›</p>
<p>åŒæ—¶åˆ«å¿˜äº†ç»™ä½ è¿™ä¸ªç”¨æˆ·ä¼ è¯ï¼Œç°åœ¨æˆ‘ä»¬èšç„¦äºagentå’Œä½ çš„å¯¹è¯ä¹‹é—´ï¼Œè™½ç„¶æœ€åº•å±‚è‚¯å®šè¿˜æ˜¯æ–‡å­—ï¼Œä½†æ˜¯äº¤äº’å½¢å¼ä¸Šå¯ä»¥éå¸¸ä¸°å¯Œå¤šå½©â€”â€”å¯ä»¥æ˜¯åƒCLIä¸€æ ·çš„å‘½ä»¤è¡Œçª—å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç¼–ç¨‹IDEå·¥å…·ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªæ›´ä¸ºé€šç”¨çš„æ¡Œé¢åŠ©æ‰‹ï¼Œæ¯”å¦‚è¯´æœ€è¿‘çˆ†ç«çš„Clawdbotã€ Moltbotã€ OpenClawï¼Œå½“ç„¶è¿™ä»¨æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967005765.png" alt="alt text"></p>
<p>ä¸è¿‡ä¸è®ºä»€ä¹ˆå½¢å¼çš„æ™ºèƒ½ä½“ï¼Œéƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ç¼ºç‚¹</p>
<h3 id="langchainã€workflow">langchainã€workflow</h3>
<p>å‡è®¾æˆ‘ä»¬æƒ³å®Œæˆè¿™æ ·ä¸€ä¸ªä»»åŠ¡â€”â€”ä»ä¸€ä¸ªè‹±æ–‡PDFæ–‡æ¡£å½“ä¸­æå–å†…å®¹ç¿»è¯‘æˆä¸­æ–‡ï¼Œæœ€åä¿å­˜æˆmarkdownæ ¼å¼</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967013413.png" alt="alt text"><br>
<img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967024511.png" alt="alt text"></p>
<p>å½“ç„¶ä½ å¯ä»¥ç›´æ¥æŠŠè¿™ä¸ªéœ€æ±‚æè¿°ç»™agentï¼Œè®©ä»–è‡ªå·±ç­–åˆ’æ•´ä½“çš„æµç¨‹ï¼Œä½†å¦‚æœè¿™ä¸ªæµç¨‹ç›¸å¯¹ç¨³å®šï¼Œæ¯æ¬¡é‡æ–°è®©Agentè‡ªç”±å‘æŒ¥çš„è¯ï¼Œä¸ä½†ä¸ç¨³å®šï¼Œè¿˜éå¸¸æµªè´¹token</p>
<p>æ¯”å¦‚è¯´æ•´ä¸ªæµç¨‹ä¸­æå–pdfå’Œä¿å­˜markdownï¼Œè¿™ä¸¤æ­¥å®Œå…¨å¯ä»¥å›ºåŒ–æˆå›ºå®šçš„è„šæœ¬ï¼Œä¸­é—´çš„ç¿»è¯‘ç›´æ¥å’Œå¤§æ¨¡å‹æ²Ÿé€šå³å¯ï¼Œæ•´ä¸ªæµç¨‹å°±ä¸éœ€è¦ä»»ä½•ä¸€ä¸ªä¸­é—´çš„æ™ºèƒ½ä½“æ’æ‰‹äº†</p>
<p>è¦å›ºåŒ–è¿™æ ·ä¸€ä¸ªæµç¨‹ï¼Œä½ å¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼æ¥å®ç°ï¼Œä¸ºäº†æ–¹ä¾¿ç¼–å†™è¿™ç§é“¾å¼çš„ä»»åŠ¡ï¼Œä½ åˆå‘æ˜äº†ä¸€ä¸ªæ–°çš„ç¼–ç¨‹æ¡†æ¶ï¼Œèµ·åå«Langchain</p>
<p>é‚£ä¸ºäº†ç…§é¡¾éç¨‹åºå‘˜ç”¨æˆ·ï¼Œä½ åˆå‘æ˜äº†ä¸€ç§ä½ä»£ç çš„æ–¹å¼â€”â€”å°±æ˜¯åœ¨é¡µé¢ä¸Šå‚»ç“œå¼çš„æ‹–æ‹½ï¼Œä¸Šæ‰‹éš¾åº¦æ›´ä½ï¼Œä½ ç»™å®ƒèµ·çš„åå­—å«workflowï¼ˆå·¥ä½œæµï¼‰</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967035895.png" alt="alt text"></p>
<p>å‡å¦‚æˆ‘ä»¬æœ‰äº†æ–°çš„è¯‰æ±‚ï¼Œå¯èƒ½å¤„ç†çš„åŸå§‹æ–‡æ¡£ä¸æ­¢æœ‰PDFï¼Œè¿˜æœ‰å¯èƒ½æ˜¯wordæ–‡æ¡£ã€txtæ–‡æ¡£ã€pptç­‰ï¼Œè¾“å‡ºçš„æ ¼å¼ä¹Ÿæœ‰å¯èƒ½æ˜¯HTMLã€å›¾ç‰‡ã€æµç¨‹å›¾å•¥çš„ï¼Œéš¾é“è¦ç»™è¿™äº›æ‰€æœ‰çš„æ’åˆ—ç»„åˆéƒ½å†™ä¸€å¥—å·¥ä½œæµå—ï¼Œè¿™å¾ˆæ˜æ˜¾ï¼Œæ˜¯ä¸åˆç†çš„ï¼</p>
<h3 id="skill">skill</h3>
<p>é‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Œä½ å¯ä»¥è¿™æ ·è®¾è®¡ï¼Œå‡†å¤‡ä¸€ä¸ªç›®å½•ï¼ŒæŠŠæ‰€æœ‰å¯èƒ½æ¶‰åŠåˆ°çš„è½¬æ¢è„šæœ¬å…¨éƒ½å†™å¥½ï¼Œæ”¾åœ¨è¿™ï¼Œç„¶åå‘¢å†™ä¸ªç»Ÿä¸€çš„è¯´æ˜æ–‡ä»¶æŠŠæ•´ä½“çš„æµç¨‹æè¿°æ¸…æ¥šï¼Œå¹¶ä¸”å‘Šè¯‰agentæ ¹æ®æ–‡ä»¶çš„æ ¼å¼çµæ´»é€‰å–æŒ‡å®šçš„è„šæœ¬</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967048845.png" alt="alt text"></p>
<p>ç„¶åå‘¢åœ¨ç»™agentçš„ä¸‹è¾¾ä»»åŠ¡ä¹‹å‰åŠ ä¸Šè¿™ä¹ˆä¸€å¥è¯ï¼Œå…ˆè¯»å–åˆšåˆšæˆ‘ä»¬å†™å¥½çš„é‚£ä¸€å¤§ä¸²è¦æ±‚ï¼Œç„¶åå†æŒ‰ç…§è¦æ±‚å®Œæˆä»»åŠ¡ï¼Œè¿™æ ·æ•´ä¸ªè¿‡ç¨‹å°±æ—¢ä¿è¯äº†ä¸€å®šçš„çµæ´»æ€§ï¼ŒåŒæ—¶åˆå˜å¾—æ¯”è¾ƒå¯æ§</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967057916.png" alt="alt text"></p>
<p>å˜¿ï¼Œä¸ºäº†æ›´é€šç”¨ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æå‰çº¦å®šå¥½ä¸€ä¸ªæŒ‡å®šçš„ä½ç½®ï¼Œç„¶ååœ¨agentä¸­å†™æ­»ä¸€æ®µç¨‹åºï¼Œå»è¯»å–è¿™ä¸ªä½ç½®çš„skill.mdï¼Œç›¸å½“äºæŠŠè¿™å¥è¯å›ºå®šæˆä¸€æ®µç¨‹åºï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡éƒ½åŠ ä¸€å¥è¯äº†</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">â””â”€â”€ skills/</span><br><span class="line"><span class="code">        â””â”€â”€ skill-name/</span></span><br><span class="line"><span class="code">            â”œâ”€â”€ SKILL.md # æ ¸å¿ƒå…¥å£ï¼ˆå¿…éœ€ï¼‰          </span></span><br><span class="line"><span class="code">            â”œâ”€â”€ reference.md # è¯¦ç»†å‚è€ƒæ–‡æ¡£ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="code">            â”œâ”€â”€ examples.md # å®Œæ•´çš„è¯·æ±‚ä¸å“åº”ç¤ºä¾‹ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="code">            â””â”€â”€ scripts/</span></span><br><span class="line"><span class="code">                â””â”€â”€ lint.py # ç”¨äºè‡ªåŠ¨æ£€æŸ¥çš„è¾…åŠ©è„šæœ¬ï¼ˆå¯é€‰ï¼‰</span></span><br></pre></td></tr></table></figure>
<p>å¥½åƒçœ‹èµ·æ¥å°±æ˜¯æŠŠæç¤ºè¯æ¢äº†ä¸ªåœ°æ–¹å­˜èµ·æ¥ï¼Œä½†æƒ³äº†æƒ³è¿˜æ˜¯ç»™å®ƒèµ·ä¸ªæ–°åå­—å§ï¼Œå°±å«åšskillï¼Œå³agentçš„æŠ€èƒ½</p>
<h3 id="subAgent">subAgent</h3>
<p>ä½ åˆå‘ç°ï¼Œå¯¹äºä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œå¯èƒ½agentçš„ä¸Šä¸‹æ–‡ä¼šå˜å¾—éå¸¸å¤§ï¼Œäºæ˜¯å‘¢ä½ åˆå‘æ˜äº†ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œå«subAgentã€‚</p>
<p>å¯¹äºä¸€äº›ç‹¬ç«‹çš„å­ä»»åŠ¡ï¼Œå¯ä»¥å•ç‹¬åœ¨è¿™ä¸ªå­agentä¸­å®Œæˆï¼Œå…¶å®æœ¬è´¨ä¸Šå°±æ˜¯åšäº†ä¸Šä¸‹æ–‡éš”ç¦»ï¼Œéš”ç¦»å­agentçš„äº§ç”Ÿçš„ä¸Šä¸‹æ–‡ä¸ä¼šä¿ç•™åœ¨ä¸»Agentçš„ä¸­</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967071312.png" alt="alt text"></p>
<p><strong>SubAgentï¼ˆå­æ™ºèƒ½ä½“ï¼‰</strong>ï¼Œå°±æ˜¯<br>
ğŸ‘‰ <strong>è¢«å¦ä¸€ä¸ª Agent è°ƒç”¨ã€ä¸“é—¨è´Ÿè´£æŸä¸€å°å—ä»»åŠ¡çš„ Agent</strong>ã€‚</p>
<p>å®ƒä¸æ˜¯â€œæ›´èªæ˜â€ï¼Œè€Œæ˜¯<strong>æ›´ä¸“ä¸€ã€æ›´å¬è¯</strong>ã€‚</p>
<h3 id="å°ç»“ä¸€ä¸‹">å°ç»“ä¸€ä¸‹</h3>
<p>è¿™é‡Œçš„æ¯ä¸€ä¸ªæ–°æ¦‚å¿µå‡ºæ¥çš„æ—¶å€™ï¼Œéƒ½æœ‰å¤§ç¥¨çš„æ–‡ç« æå…¶å¤¸å¼ çš„å¹æ§å’Œè¥é”€ï¼Œè¯´çš„å¥½å¬ç‚¹çš„å°±æ˜¯æŠ€æœ¯å‘å±•çš„ä¸­é—´äº§ç‰©ã€‚</p>
<p>è¿™äº›åè¯å…¶å®éƒ½æ˜¯ä¸€ä¸ªéœ€è¦å¤šä¸ªé˜¶æ®µæ‰èƒ½å®Œæˆçš„ä»»åŠ¡ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨langchainå°±æ˜¯çº¯ç¼–ç¨‹çš„å½¢å¼æ¥å®ç°ï¼Œå…¨æ˜¯ç¡¬ç¼–ç ï¼Œè™½ç„¶ç‰¹åˆ«ç¨³å®šï¼Œä½†æ˜¯ä¹Ÿå¤±å»äº†ä¸€å®šçš„æŸ”æ€§ï¼Œå¾ˆéš¾åŒ…å®¹ä¸€äº›å°é—®é¢˜ï¼Œ</p>
</li>
<li>
<p>è€Œworkflowåªæ˜¯æŠŠç¨‹åºæ›¿æ¢æˆäº†å¯¹ä»£ç çš„æ‹–æ‹½ï¼Œç›¸å¯¹æ”¹å†™æ¥çš„å®¹æ˜“ä¸€äº›</p>
</li>
<li>
<p>skillå°±æ˜¯æŠŠlangchainå’Œworkflowè¿™ç§ç”±ç¨‹åºæ§åˆ¶çš„æµç¨‹èµ°å‘ï¼Œå˜æˆäº†ç”±æ™ºèƒ½ä½“è‡ªè¡Œæ§åˆ¶ï¼Œä½†æ˜¯æå‰å†™å¥½ä¸€äº›è¯´æ˜æ–‡æ¡£å’Œç›´æ¥å¯è¿è¡Œçš„è„šæœ¬ï¼Œå­˜åœ¨ä¸€å®šçµæ´»è°ƒæ•´çš„ç©ºé—´ï¼ŒåŒæ—¶åˆä¸è‡³äºå˜å¾—ç‰¹åˆ«ä¸å¯æ§ï¼Œ</p>
</li>
<li>
<p>è€Œæœ€åçº¯<strong>Agent</strong>çš„å½¢å¼æœ€ä¸ºæŸ”æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥éšæ—¶æ ¹æ®è‡ªå·±çš„åˆ¤æ–­è¿›è¡Œè°ƒæ•´æµç¨‹ï¼Œç”šè‡³éœ€è¦çš„æ—¶å€™è‡ªå·±ç»™è‡ªå·±ç”Ÿæˆä¸ªè„šæœ¬æ¥è¿è¡Œï¼Œä½†åŒæ—¶è¿™ä¹Ÿé€ æˆäº†å®¹æ˜“å˜å¾—ä¸å¯æ§ï¼Œä½ ä¸çŸ¥é“å®ƒä¸­é—´ä¼šç»™è‡ªå·±å†™ä¸ªä»€ä¹ˆè„šæœ¬ï¼ŒæŠŠä¸€ä¸ªåŸæœ¬éå¸¸ç®€å•çš„ä»»åŠ¡å˜å¾—éå¸¸å¤æ‚ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥è¿™æ¡çº¿æˆ‘è®¤ä¸ºæ˜¯å®ƒä»¬å®è§‚ä¸Šçš„ä¸€ä¸ªåŒºåˆ«</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967080133.png" alt="alt text"></p>
<p>å…¶å®æ‰€æœ‰çš„è¿™äº›æŠ€æœ¯ï¼Œæœ€ç»ˆè¿˜æ˜¯ç¦»ä¸å¼€å¤§æ¨¡å‹å’Œæˆ‘ä»¬ä¹‹é—´çš„æç¤ºè¯ï¼Œè¿™äº›æŠ€æœ¯æ— éå°±æ˜¯å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨çš„å¾€æç¤ºè¯é‡Œé¢å¢åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯</p>
<h3 id="é¢å¤–è¯´ä¸€ä¸‹">é¢å¤–è¯´ä¸€ä¸‹</h3>
<p>skillæˆ‘è®¤ä¸ºæœ¬èº«ä¹Ÿæ˜¯ä¸ªä¸­é—´äº§ç‰©ï¼Œæœªæ¥ä¸€å®šä¼šæœ‰æ›´æ–¹ä¾¿çš„å½¢å¼å‡ºç°ï¼Œè®©æ‰€æœ‰äººéƒ½å¯ä»¥å¾ˆç¬¦åˆç›´è§‰çš„æ— è„‘ä½¿ç”¨ï¼Œç°åœ¨çš„skillè¿˜éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ”¾åˆ°æŸä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼ŒAIæŠ€æœ¯æœ€åä¸€å®šé¢å‘çš„æ˜¯æ™®é€šäººï¼Œä¸å¯èƒ½è®©æ™®é€šäººå»æŠŠä»€ä¹ˆskillæ”¾åˆ°æŒ‡å®šçš„ç›®å½•ä¸‹å»ã€é…ç½®ä»€ä¹ˆMCPæœåŠ¡ã€ç”šè‡³é…ç½®å“ªä¸ªå¤§æ¨¡å‹çš„API_KEY</p>
<p>å…¶å®clawdbotå’Œclaude codeè¿™äº›æœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«å—ï¼Œæ²¡æœ‰ï¼Œå°±åªæ˜¯å› ä¸ºå®ƒèƒ½è¿æ¥ç¤¾äº¤è½¯ä»¶ï¼Œèƒ½å¤Ÿé…ç½®å®šæ—¶ä»»åŠ¡ï¼Œæœ‰ä¸ªé¡µé¢èƒ½çœ‹åˆ°skillå¹¶ç®¡ç†ä»–ä»¬ï¼Œç¬¬ä¸€æ¬¡è®©æ™®é€šäººè§‰å¾—ä»–åƒä¸€ä¸ªæ™ºèƒ½ä½“</p>
<p><strong>æˆ‘è®¤ä¸ºåªè¦æ˜¯æä¾›ä¾¿åˆ©çš„æ–¹å‘å°±æ˜¯è¶‹åŠ¿</strong></p>
<h2 id="AIå·¥å…·çš„ä½¿ç”¨">AIå·¥å…·çš„ä½¿ç”¨</h2>
<h3 id="Trae">Trae</h3>
<p><strong>å®šä½</strong>ï¼šé›†æˆäº† AI èƒ½åŠ›çš„ <strong>IDE + ä»£ç åŠ©æ‰‹</strong>ï¼ˆThe Real AI Engineerï¼‰</p>
<p><strong>ä¸»è¦ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>
<p>å¯ä½œä¸ºå®Œæ•´ IDE ä½¿ç”¨ï¼Œè¿˜å†…ç½® AI ä»£ç ç”Ÿæˆä¸è‡ªåŠ¨åŒ–ã€‚</p>
</li>
<li>
<p>è‡ªå¸¦ <em>Builder Mode</em> / <em>SOLO æ¨¡å¼</em> ç­‰ï¼Œå¯è‡ªåŠ¨æ‹†è§£ä»»åŠ¡ã€ç”Ÿæˆé¡¹ç›®å’Œä¿®å¤ bugã€‚</p>
</li>
<li>
<p>æ”¯æŒè‡ªç„¶è¯­è¨€é©±åŠ¨å¼€å‘ï¼Œä»é¡¹ç›®è®¾è®¡åˆ°éƒ¨ç½²å‡å¯åä½œã€‚</p>
</li>
<li>
<p>å†…å«éƒ¨åˆ†é«˜çº§æ¨¡å‹ï¼ˆä¾‹å¦‚ GLMã€Geminiã€GPTç­‰ï¼‰ä½œä¸ºå†…ç½®æ”¯æŒã€‚</p>
</li>
<li>
<p>å‚å†…åˆè§„çš„ç¼–è¾‘å™¨ï¼Œéå¸¸å¥½ç”¨ï¼Œå¯ä»¥è‡ªå»ºAgent</p>
</li>
</ul>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967091164.png" alt="alt text"></p>
<h3 id="Aime">Aime</h3>
<p><strong>å®šä½</strong>ï¼šä¸“ä¸ºå­—èŠ‚åŒå­¦æ‰“é€ çš„<strong>AI Agentå·¥ä½œå¹³å°</strong></p>
<p><strong>ä¸»è¦ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>
<p>å¼‚æ­¥åŠå…¬ï¼Œå†…ç½®äº†å¤§é‡å¸¸è§æ¨¡ç‰ˆï¼Œå¯ä»¥å¿«é€Ÿå‘èµ·ä»»åŠ¡</p>
</li>
<li>
<p>ä¸å¤§é‡å‚å†…çš„åŸºå»ºæ‰“é€šï¼ŒåŒ…æ‹¬é£ä¹¦æ–‡æ¡£ã€bitsç­‰å¹³å°</p>
</li>
<li>
<p>å¯¹é£ä¹¦æ–‡æ¡£çš„è§£æå°¤å…¶å‰å®³ï¼Œæ·±åº¦ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥å†™é£ä¹¦æ–‡æ¡£ç­‰èƒ½åŠ›</p>
</li>
<li>
<p>ä¸€å¥è¯ï¼Œç¥ï¼Œå¥½ç”¨</p>
</li>
</ul>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967097834.png" alt="alt text"></p>
<h3 id="Claude-code">Claude code</h3>
<p><strong>å®šä½</strong>ï¼šAI ç¼–ç¨‹ç»“å¯¹åŠ©æ‰‹ï¼Œä¸“æ³¨åä½œå¼ç¼–ç¨‹å’Œå¤æ‚ä»»åŠ¡å¤„ç†ã€‚</p>
<p><strong>ä¸»è¦ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>
<p>ç†è§£æ•´ä¸ªä»£ç åº“ä¸Šä¸‹æ–‡ï¼Œå¯è·¨å¤šä¸ªæ–‡ä»¶è¿›è¡Œå¤æ‚ä¿®æ”¹å’Œè‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</p>
</li>
<li>
<p>æ”¯æŒè‡ªç„¶è¯­è¨€æè¿°ä»»åŠ¡ï¼Œå¹¶ç”Ÿæˆé«˜è´¨é‡ã€å¯è¿è¡Œä»£ç ã€‚</p>
</li>
<li>
<p>å¯å¤„ç†å¤§å‹é¡¹ç›®ã€é‡æ„ã€æµ‹è¯•ç”Ÿæˆç­‰å¤æ‚å·¥ç¨‹ä»»åŠ¡ã€‚</p>
</li>
<li>
<p>åœ¨ä¸šå†…è¢«è®¤ä¸ºåœ¨å¤šæ–‡ä»¶ååŒåŠä¸Šä¸‹æ–‡ç†è§£ä¸Šè¡¨ç°è¾ƒå¥½ã€‚</p>
</li>
<li>
<p>å…¼å®¹å¾ˆå¤šgithubä¸Šçš„åŸºå»º</p>
</li>
</ul>
<p><strong>é€‚åˆåœºæ™¯</strong>ï¼šå¤æ‚å·¥ç¨‹å¼€å‘ã€è·¨æ–‡ä»¶é‡æ„ã€è‡ªåŠ¨ PR ç”Ÿæˆã€å…¨é¡¹ç›®ç†è§£</p>
<p>è¿™é‡Œè´´ä¸€ä¸‹å‚å†…åˆè§„çš„ä½¿ç”¨æ–¹æ³•ï¼Œé€šè¿‡Claude code routerè¿›è¡Œæ¡¥æ¥ï¼Œclaude codeç»“åˆopenspecæ•ˆæœä¹Ÿæ˜¯éå¸¸å¥½</p>
<p><a href="https://bytedance.larkoffice.com/docx/XrGYdczZyoeebrx62lMc7Ucpnng">Claude Code + ç«å±±æ–¹èˆŸ kimi-k2 </a></p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967104531.png" alt="alt text"></p>
<h2 id="å½“-AI-è¿›å…¥è½¯ä»¶å·¥ç¨‹">å½“ AI è¿›å…¥è½¯ä»¶å·¥ç¨‹</h2>
<p>AIæ­£åœ¨æ— å£°åœ°é‡å¡‘è½¯ä»¶å¼€å‘çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä»éœ€æ±‚çš„è¯ç”Ÿåˆ°æœ€ç»ˆçš„äº¤ä»˜ï¼Œå½»åº•é¢ è¦†ç€æˆ‘ä»¬å¯¹æ ¸å¿ƒæŠ€èƒ½ã€å·¥ä½œæµç¨‹ç”šè‡³å¼€å‘è€…è§’è‰²çš„ä¼ ç»Ÿè®¤çŸ¥ã€‚è¿™åœºå˜é©ä¸ä»…æ˜¯å…³äºâ€œå¦‚ä½•æ›´å¿«åœ°ç¼–ç â€ï¼Œæ›´æ˜¯å…³äºâ€œæˆ‘ä»¬æœªæ¥å°†å¦‚ä½•åˆ›é€ è½¯ä»¶â€ã€‚</p>
<ol>
<li><strong>ä½ çš„æ–°å·¥ä½œæ˜¯å†™æ–‡æ¡£ï¼Œè€Œä¸æ˜¯æ•²ä»£ç </strong></li>
</ol>
<p>æœªæ¥å¼€å‘è€…çš„æ ¸å¿ƒäº§å‡ºï¼Œæˆ–è®¸å°†ä¸å†æ˜¯ <code>\.ts</code>ã€<code>\.py</code> è¿™ç±»æºç æ–‡ä»¶ï¼Œè€Œæ˜¯ç»“æ„åŒ–çš„ <code>\.md</code> æ–‡æ¡£ã€‚éœ€æ±‚è§„æ ¼ã€ç³»ç»Ÿæ¶æ„ã€åŠŸèƒ½è§„çº¦ã€æ¥å£å®šä¹‰ â€”â€” è¿™äº›ç”¨ Markdown ç²¾å¿ƒæ’°å†™ã€é€»è¾‘ä¸¥è°¨çš„æ–‡æ¡£ï¼Œæ­£åœ¨æˆä¸ºæ–°ä¸€ä»£ã€Œæºä»£ç ã€ã€‚</p>
<p>AI ç†è§£å¹¶è½åœ°å·¥ç¨‹åŒ–å¼€å‘ä»»åŠ¡çš„åŸºç¡€ï¼Œæ­£æ˜¯è¿™ç±»ç²¾å‡†ã€æ— æ­§ä¹‰ã€ç»“æ„åŒ–çš„è§„èŒƒæ–‡æœ¬ã€‚ç›¸è¾ƒäºé›¶æ•£ã€éšæ„ã€éš¾ä»¥ç‰ˆæœ¬ç®¡ç†çš„å¯¹è¯å¼æç¤ºè¯ï¼Œè¢«çº³å…¥ä»£ç ä»“åº“ã€å¯åšç‰ˆæœ¬æ§åˆ¶ã€å¯è¯„å®¡ã€å¯è¿½æº¯çš„ç»“æ„åŒ–æ–‡æ¡£ï¼Œæ‰æ˜¯é©±åŠ¨ AI è§„æ¨¡åŒ–ã€å·¥ç¨‹åŒ–å¼€å‘çš„å…³é”®è¾“å…¥ã€‚å®ƒçš„ä¸¥è°¨æ€§ã€è§„èŒƒæ€§ä¸å¯ç»´æŠ¤æ€§ï¼Œå°†ä¸ä¼ ç»Ÿä»£ç å¤„äºåŒä¸€é‡è¦ç­‰çº§ã€‚</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967120874.png" alt="alt text"></p>
<ol start="2">
<li><strong>å¼€å‘è€…è§’è‰²çš„é‡å¡‘ï¼šä»â€œç å†œâ€åˆ°â€œå…¨æ ˆæ¶æ„å¸ˆâ€</strong></li>
</ol>
<p>AI æ­£åœ¨å½»åº•æ”¹å˜å·¥ä½œæ–¹å¼ï¼Œæ›´åœ¨é‡å¡‘å¼€å‘è€…çš„è§’è‰²è¾¹ç•Œã€‚ä¸€ä¸ªæå…·å‰ç»æ€§çš„åˆ¤æ–­æ˜¯ï¼šä¼ ç»Ÿå²—ä½åˆ†å·¥å°†è¢«æ‰“ç ´ï¼Œå¼€å‘è€…ä¼šä»å•çº¯çš„ç¼–ç å®ç°è€…ï¼Œå‡çº§ä¸ºé¡¹ç›®çš„ã€Œæ ¸å¿ƒæ™ºèƒ½ã€ã€‚</p>
<p>åœ¨è¿™ä¸€æ–°èŒƒå¼ä¸‹ï¼Œå¼€å‘è€…çš„æ ¸å¿ƒå·¥ä½œä¸å†æ˜¯æ‰‹å†™ä»£ç ï¼Œè€Œæ˜¯ä»¥<strong>æ¶æ„å¸ˆ + é—®é¢˜å®šä¹‰è€…</strong>çš„èº«ä»½è´¯ç©¿å…¨æµç¨‹ã€‚ä»–ä»¬æœ€å…³é”®çš„äº§å‡ºï¼Œæ˜¯é©±åŠ¨ AI çš„ç»“æ„åŒ– Markdown æ–‡æ¡£ â€”â€” ä¹Ÿå°±æ˜¯æ–°ä¸€ä»£ã€Œæºä»£ç ã€ã€‚æ ¸å¿ƒèŒè´£å¯æµ“ç¼©ä¸ºä¸‰ç‚¹ï¼š</p>
<ol>
<li>
<p>æ·±åº¦ç†è§£ä¸šåŠ¡ï¼Œæ‰¿æ¥å¹¶æ˜ç¡®çœŸå®éœ€æ±‚ï¼›</p>
</li>
<li>
<p>å°†éœ€æ±‚ä¸è®¾è®¡è½¬åŒ–ä¸º AI å¯æ‰§è¡Œçš„ç»“æ„åŒ–æ–‡æ¡£ï¼›</p>
</li>
<li>
<p>å¼•å¯¼ AI ç”Ÿæˆã€æ ¡éªŒç»“æœï¼Œå¹¶æŒç»­è¿­ä»£ä¼˜åŒ–ã€‚</p>
</li>
</ol>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967132356.png" alt="alt text"></p>
<ol start="3">
<li>
<p><strong>AI ååŒçš„è¿›åŒ–ï¼šä»èŠå¤©çª—å£åˆ°ä¸¥è°¨çš„å·¥ç¨‹èŒƒå¼</strong></p>
<p>ç›®å‰ï¼Œè®¸å¤šå¼€å‘è€…ä¸ AI çš„åä½œè¿˜åœç•™åœ¨â€œèŠå¤©çª—å£â€çš„åˆçº§é˜¶æ®µâ€”â€”éšæ„ä¸”ç¼ºä¹ç³»ç»Ÿæ€§ã€‚ç„¶è€Œï¼ŒçœŸæ­£é«˜æ•ˆçš„ AI è½¯ä»¶å¼€å‘æ­£åœ¨è¿…é€Ÿæ‘†è„±è¿™ç§â€œæ‰‹å·¥ä½œåŠâ€æ¨¡å¼ï¼Œå‘ç€æ›´åŠ ç³»ç»ŸåŒ–ã€è§„èŒƒåŒ–çš„å·¥ç¨‹èŒƒå¼è¿›åŒ–ã€‚</p>
<ol>
<li>
<p>Spec Codingï¼ˆè§„çº¦é©±åŠ¨ç¼–ç ï¼‰</p>
<p>ä»¥ OpenSpecä¸ºå…¸å‹å®è·µï¼Œè¯¥æ¨¡å¼è¦æ±‚å¼€å‘è€…éµå¾ªæ ‡å‡†åŒ–æµç¨‹ï¼š<strong>ç¼–å†™éœ€æ±‚æ–‡æ¡£ â†’ è®¾è®¡æ–‡æ¡£ â†’ å¼€å‘ä»»åŠ¡ â†’ ç¼–ç å®ç°</strong>ã€‚æ¯ä¸€æ­¥å‡å…·å¤‡è§„èŒƒçš„è¾“å…¥ä¸è¾“å‡ºï¼Œæµç¨‹å¯è¿½æº¯ã€å¯è¯„å®¡ï¼Œå®ç°é«˜åº¦å·¥ç¨‹åŒ–çš„ AI è¾…åŠ©å¼€å‘ã€‚</p>
<p><img src="/2026/02/13/AI/%E6%8B%92%E7%BB%9DAI%E5%90%8D%E8%AF%8D%E7%84%A6%E8%99%91-LLM%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%80%E6%AC%A1%E8%AE%B2%E9%80%8F/1770967149150.png" alt="alt text"></p>
</li>
<li>
<p>ContextDevï¼ˆä¸Šä¸‹æ–‡é©±åŠ¨å¼€å‘ï¼‰</p>
<p>ä»¥OpenCodeä¸ºä¾‹å­ï¼Œ**å¤šæ¨¡å‹æ™ºèƒ½ç¼–æ’ï¼Œ**ä»¥ Sisyphus ä¸ºæ ¸å¿ƒï¼Œæ ¹æ®ä»»åŠ¡ç‰¹æ€§æŒ‡æŒ¥å¤šä¸ªä¸åŒæ¨¡å‹çš„ä¸“å®¶ Agent åŒæ—¶å·¥ä½œï¼Œæ•ˆç‡æé«˜ã€‚ä»£ç†é—´é€šè¿‡åä½œé“¾è·¯å®Œæˆä»éœ€æ±‚åˆ†æã€æ¶æ„è®¾è®¡åˆ°æµ‹è¯•éªŒè¯çš„å…¨ç”Ÿå‘½å‘¨æœŸé—­ç¯ï¼Œä»¥å¤šæ™ºèƒ½ä½“ååŒä¿éšœå·¥ä¸šçº§ä¸¥è°¨æ€§ä¸äº¤ä»˜è´¨é‡ã€‚</p>
 <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">| Agent             | æ¨¡å‹                     | ä¸“é•¿                      |</span><br><span class="line">  |-------------------|--------------------------|---------------------------|</span><br><span class="line">  | Sisyphus          | Claude Opus 4.5          | ä¸»åè°ƒè€…ï¼Œç¼–æ’ä»»åŠ¡        |</span><br><span class="line">  | Oracle            | GPT 5.2                  | æ¶æ„è®¾è®¡ã€debugã€ä»£ç å®¡æŸ¥ |</span><br><span class="line">  | Librarian         | Claude Sonnet 4.5        | è¯»æ–‡æ¡£ã€ç ”ç©¶å¼€æºå®ç°      |</span><br><span class="line">  | Explore           | Grok Code / Gemini Flash | å¿«é€Ÿä»£ç åº“æœç´¢            |</span><br><span class="line">  | Frontend Engineer | Gemini 3 Pro             | UI/UX å¼€å‘                |</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>æœ‰ä¸€ä¸ªç°è±¡å«<strong>FOMOï¼ˆé”™å¤±ææƒ§ç—‡ï¼‰</strong>ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å…¬å¸å†…å¤§ä½¬ä»¬å¯¹FOMO ç°è±¡çœ‹æ³•ï¼š</p>
<ul>
<li>
<p>æç‰åŒ—è®¤ä¸º FOMO ç°è±¡åæ˜ è¡Œä¸šç¹è£ï¼Œä½†ä¸ªäººåº”ç†æ€§å¯¹å¾…ï¼Œäº²è‡ªè¯•ç”¨äº§å“ï¼Œç»“åˆè‡ªèº«ä¸šåŠ¡ï¼›</p>
</li>
<li>
<p>å§šæ™“é¹å»ºè®®ç†æ€§çœ‹å¾…ï¼ŒæŠ±ç€å­¦ä¹ å¿ƒæ€ç»“åˆä¸šåŠ¡è§£å†³é—®é¢˜ï¼Œä¿æŒç§¯æå¿ƒæ€ï¼›</p>
</li>
<li>
<p>é©¬ç¿€è®¤ä¸ºä¸åº”ç›²ç›®è·Ÿé£ï¼Œåº”ä»ä¸šåŠ¡éœ€æ±‚å‡ºå‘å¯»æ‰¾åˆé€‚æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<p>åœ¨AIé«˜é€Ÿå‘å±•çš„æ—¶ä»£ï¼Œå„ç§AIç¼–ç¨‹å·¥å…·ä¸æ–­æ¶Œç°ï¼Œä½œä¸ºä¸€ä¸ªæ™®é€šçš„å¼€å‘è€…ï¼Œå†…å¿ƒéš¾å…æ„Ÿåˆ°ç„¦è™‘å’Œä¸å®‰ï¼Œé¢å¯¹ç„¦è™‘æœ€å¥½çš„æ–¹å¼å°±æ˜¯ä¸»åŠ¨æ‹¥æŠ±ï¼Œé¡ºåŠ¿è€Œä¸ºï¼Œå­¦ä¹ å¹¶æŒæ¡ AI ç¼–ç¨‹å·¥å…·ï¼Œå¹¶ä¸æ˜¯æ”¾å¼ƒæ€è€ƒã€‚</p>
<p>ç„¦è™‘ä¸å¦‚åŠ å…¥ï¼Œä¸æ–­æ€è€ƒç°åœ¨æœ€å¼ºçš„AI codingæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæˆ‘å¯ä»¥å»å°è¯•ç”¨ä¸€ä¸‹å—ï¼Ÿæˆ‘å¯ä»¥å°è¯•åœ¨ä¸šåŠ¡ä¸­å»å®è·µå—ï¼Ÿæˆ‘å¯ä»¥ä»ä¸­å­¦åˆ°ä»€ä¹ˆæ€æƒ³ï¼Ÿ</p>
<h2 id="å‹æƒ…é“¾æ¥">å‹æƒ…é“¾æ¥</h2>
<p><a href="https://bytetech.info/articles/7545811402050109486?from=article_share_copylink">åˆ«å†è§‰å¾—AIå¤§æ¨¡å‹ç¥ç§˜ï¼è¿™ç¯‡è®²é€å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„</a></p>
<p><a href="https://bytetech.info/articles/7542463368352202795?from=article_share_copylink">ä»£ç çŸ¥è¯†å›¾è°±è®©AIæ›´å‰å®³ï¼Ÿ</a></p>
<p><a href="https://bytetech.info/articles/7581313557229207586?from=article_share_copylink">âŒ¨ï¸ä¸ç”¨é€è¡Œç¿»ï¼AI å®ç°ä»£ç ç²¾å‡†æŸ¥æ‰¾çš„ç§˜å¯†</a></p>
<p><a href="https://bytetech.info/articles/7584809345764032522?from=article_share_copylink">AI + Spec Codingï¼šå‘Šåˆ« Vibe å¼å¼€å‘ï¼Œè§£é”è§„èŒƒé©±åŠ¨ç ”å‘æ–°èŒƒå¼</a></p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<p><a href="https://bytedance.sg.larkoffice.com/docx/Ay69depRooYH5gx0qsxlgaVbgeb">AI Coding æŠ€æœ¯ç»¼è¿°</a></p>
<p><a href="https://bytedance.larkoffice.com/docx/G9VvdOzpuomR2kxjHVecJGm0nzd">10åˆ†é’Ÿè®²æ¸…æ¥š Promptã€Function Callingã€ Agentã€ MCP æ˜¯ä»€ä¹ˆ</a></p>
<p><a href="https://bytedance.larkoffice.com/docx/QK0QdE3QioGqrQxs0XHcwPvJnZC">Agentèƒ½åŠ›è¾¨æï¼šFunction Callã€Toolã€MCPä¸Skill</a></p>
<p><a href="https://www">https://www</a>.bilibili.com/video/BV1ojfDBSEPv/?spm_id_from=333.1007.top_right_bar_window_dynamic.content.click&amp;amp;vd_source=65a6335a772d4a8c05337a8c09db00fb</p>
<p><a href="https://bytedance.larkoffice.com/docx/ZW67dYGKzo5tRJxWaiicJnVFnsb">æ™ºèƒ½çºªè¦ï¼šAI æ—¶ä»£çš„å‰ç«¯å‘å±• 2026å¹´2æœˆ6æ—¥</a></p>
]]></content>
      <categories>
        <category>AI</category>
        <category>LLM</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>LLM</tag>
        <tag>å¤§æ¨¡å‹</tag>
        <tag>Prompt Engineering</tag>
        <tag>Agent</tag>
        <tag>Meta Prompt</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¸©æ•…çŸ¥æ–°â€”â€”Golang GMP ä¸‡å­—æ´—é«“ç»</title>
    <url>/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/</url>
    <content><![CDATA[<h2 id="0-å‰è¨€">0 å‰è¨€</h2>
<p>æˆ‘åœ¨ 23 å¹´åˆæ›¾å‘å¸ƒè¿‡ä¸€ç¯‡â€”â€”golang gmp åŸç†è§£æï¼Œå½“æ—¶åˆšå¼€å§‹æ¥è§¦ go åº•å±‚æºç ï¼Œè§†é‡å¹¿åº¦å’Œç†è§£æ·±åº¦éƒ½æœ‰æ‰€ä¸è¶³ï¼Œå¯¹ä¸€äº›æ ¸å¿ƒç¯èŠ‚çš„æ€è€ƒå’ŒæŒ–æ˜æœ‰æ‰€æ¬ ç¼ºï¼Œå¯¹å…¶ä¸­æŸäº›å±€éƒ¨ç»†èŠ‚åˆè¿‡åˆ†æ‹˜æ³¥ï¼Œæ•´ä½“å†…å®¹è´¨é‡ä¸Šè¿˜æ˜¯æœ‰æ‰€ä¸è¶³.</p>
<p>éšç€è¿‘æœŸå°è¯•æ¥è§¦äº† golang ä»¥å¤–çš„è¯­è¨€ï¼Œé€šè¿‡æ¨ªå‘å¯¹æ¯”åï¼Œå¯¹äº golang ä¸­ gmp çš„ç²¾å¦™è®¾è®¡ä¹Ÿäº§ç”Ÿäº†ä¸€äº›æ–°çš„æ„Ÿæ‚Ÿ. äºæ˜¯å°±å€Ÿç€è¿™ä¸ªå¥‘æœºå¼€å¯ä¸€ä¸ªé‡ç½®ç¯‡ï¼Œå¯¹è€ç‰ˆå†…å®¹è¿›è¡ŒæŸ¥ç¼ºè¡¥æ¼ï¼ŒåŠ›æ±‚èƒ½å¤Ÿæ¸©æ•…è€ŒçŸ¥æ–°.</p>
<p>æœ¬æ–‡ä¼šåˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œå…± 5 ç« å†…å®¹ï¼š</p>
<p>ç¬¬ä¸€éƒ¨åˆ†åäºå®è§‚ï¼Œå¯¹<code>åŸºç¡€çŸ¥è¯†å’Œæ•´ä½“æ¶æ„</code>åŠ ä»¥ä»‹ç»ï¼š</p>
<ul>
<li><code>ç¬¬ä¸€ç« â€”â€”åŸºç¡€æ¦‚å¿µ</code>ï¼šç®€è¿°çº¿ç¨‹ã€åç¨‹åŠ goroutine çš„åŸºç¡€æ¦‚å¿µï¼Œå¹¶è¿›ä¸€æ­¥å¼•å‡º gmp æ¶æ„</li>
<li><code>ç¬¬äºŒç« â€”â€”gmpè¯¦è®¾</code>ï¼šæ­¥å…¥åˆ°æºç ä¸­ï¼Œå¯¹ gmp åº•å±‚æ•°æ®ç»“æ„è®¾è®¡è¿›è¡Œä¸€æ¢ç©¶ç«Ÿ</li>
</ul>
<p>ç¬¬äºŒéƒ¨åˆ†åˆ™ç€çœ¼äº <code>goroutine çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–</code>è¿‡ç¨‹ï¼š</p>
<ul>
<li><code>ç¬¬ä¸‰ç« â€”â€”è°ƒåº¦åŸç†</code>ï¼šä»¥ç¬¬ä¸€äººç§°çš„æ­£å‘è§†è§’ï¼Œè§‚å¯Ÿä¸€ä¸ª g æ˜¯å¦‚ä½•è¯ç”Ÿä»¥åŠè¢«è°ƒåº¦æ‰§è¡Œçš„</li>
<li><code>ç¬¬å››ç« â€”â€”è®©æ¸¡è®¾è®¡</code>ï¼šä»¥ç¬¬ä¸€äººç§°çš„é€†å‘è§†è§’ï¼Œè§‚å¯Ÿä¸€ä¸ª g å¦‚ä½•ä»è¿è¡ŒçŠ¶æ€è®©æ¸¡å‡ºæ‰§è¡Œæƒ</li>
<li><code>ç¬¬äº”ç« â€”â€”æŠ¢å è®¾è®¡</code>ï¼šä»¥ç¬¬ä¸‰äººç§°è§†è§’ï¼Œè§‚å¯Ÿç›‘æ§çº¿ç¨‹å¦‚ä½•é€šè¿‡å¤–åŠ›å¹²é¢„å¯¹ g å®æ–½æŠ¢å å¤„ç†</li>
</ul>
<blockquote>
<p>æå‰åšä¸ªå£°æ˜ï¼Œæœ¬æ–‡æ¶‰åŠå¤§é‡å¯¹ golang runtime æ ‡å‡†åº“æºç çš„é˜…è¯»ç¯èŠ‚ï¼Œå…¶ä¸­å±•ç¤ºçš„æºç ç‰ˆæœ¬ç»Ÿä¸€ä¸º v1.19 ç‰ˆæœ¬.<br>
å¦å¤–ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¹Ÿå’Œä½œä¸ºå‰åŒäº‹å…¼æˆ˜å‹çš„é¾™ä¿Šä¸€èµ·é’ˆå¯¹ gmp æŠ€æœ¯è¯é¢˜æœ‰è¿‡å¾ˆå¤šæ¬¡äº¤æµæ¢è®¨ï¼Œè¿™é‡Œè¦ç‰¹åˆ«è‡´æ•¬ä¸€ä¸‹é¾™å“¥.</p>
</blockquote>
<h2 id="1-åŸºç¡€æ¦‚å¿µ">1 åŸºç¡€æ¦‚å¿µ</h2>
<h3 id="1-1-ä»çº¿ç¨‹åˆ°åç¨‹">1.1 ä»çº¿ç¨‹åˆ°åç¨‹</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_1.png" alt="image_1.png"></p>
<p><code>çº¿ç¨‹ï¼ˆThreadï¼‰</code>ä¸<code>åç¨‹ï¼ˆCoroutineï¼‰</code>æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­çš„ç»å…¸æ¦‚å¿µï¼š</p>
<ul>
<li><code>çº¿ç¨‹</code>æ˜¯æ“ä½œç³»ç»Ÿ<code>å†…æ ¸è§†è§’ä¸‹çš„æœ€å°è°ƒåº¦å•å…ƒ</code>ï¼Œå…¶åˆ›å»ºã€é”€æ¯ã€åˆ‡æ¢ã€è°ƒåº¦éƒ½éœ€è¦ç”±å†…æ ¸å‚ä¸ï¼›</li>
<li><code>åç¨‹</code>åˆç§°ä¸ºç”¨æˆ·æ€çº¿ç¨‹ï¼Œæ˜¯ç”¨æˆ·ç¨‹åºå¯¹å¯¹çº¿ç¨‹æ¦‚å¿µçš„äºŒæ¬¡å°è£…ï¼Œå’Œçº¿ç¨‹ä¸ºå¤šå¯¹ä¸€å…³ç³»ï¼Œåœ¨é€»è¾‘æ„ä¹‰ä¸Šå±äºæ›´ç»†ç²’åº¦çš„è°ƒåº¦å•å…ƒï¼Œå…¶<code>è°ƒåº¦è¿‡ç¨‹ç”±ç”¨æˆ·æ€é—­ç¯å®Œæˆ</code>ï¼Œæ— éœ€å†…æ ¸ä»‹å…¥</li>
</ul>
<p>æ€»ç»“æ¥è¯´ï¼Œçº¿ç¨‹æ›´åŠ ç®€å•ç›´è§‚ï¼Œå¤©ç„¶å¥‘åˆæ“ä½œç³»ç»Ÿè°ƒåº¦æ¨¡å‹ï¼›åç¨‹æ˜¯ç”¨æˆ·æ€ä¸‹äºŒæ¬¡åŠ å·¥çš„äº§ç‰©ï¼Œéœ€è¦å¼•å…¥é¢å¤–çš„å¤æ‚åº¦ï¼Œä½†æ˜¯ç›¸å¯¹äºçº¿ç¨‹è€Œè¨€æœ‰ç€æ›´è½»çš„ç²’åº¦å’Œæ›´å°çš„å¼€é”€.</p>
<h3 id="1-2-ä»åç¨‹åˆ°-goroutine">1.2 ä»åç¨‹åˆ° goroutine</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_2.png" alt="image_2.png"></p>
<p>golang æ˜¯ä¸€é—¨å¤©ç„¶æ”¯æŒåç¨‹çš„è¯­è¨€ï¼Œgoroutine æ˜¯å…¶å¯¹åç¨‹çš„æœ¬åœŸåŒ–å®ç°ï¼Œå¹¶ä¸”åœ¨åŸç”Ÿåç¨‹çš„åŸºç¡€ä¸Šåšäº†å¾ˆå¤§çš„ä¼˜åŒ–æ”¹è¿›.</p>
<p>å½“æˆ‘ä»¬èŠåˆ° <code>goroutine</code> ï¼Œéœ€è¦æ˜ç™½è¿™ä¸æ˜¯ä¸€ä¸ªèƒ½è¢«å•ç‹¬æ‹†è§£çš„æ¦‚å¿µï¼Œå…¶æœ¬èº«æ˜¯å¼ºä¾é™„äº <code>gmpï¼ˆgoroutine-machine-processorï¼‰</code>ä½“ç³»è€Œç”Ÿçš„ï¼Œé€šè¿‡ gmp æ¶æ„çš„å»ºè®¾ï¼Œä½¿å¾— goroutine ç›¸æ¯”äºåŸç”Ÿåç¨‹å…·å¤‡ç€å¦‚ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ul>
<li>g ä¸ pã€m ä¹‹é—´å¯ä»¥åŠ¨æ€ç»“åˆï¼Œæ•´ä¸ªè°ƒåº¦è¿‡ç¨‹æœ‰ç€å¾ˆé«˜çš„çµæ´»æ€§</li>
<li>g æ ˆç©ºé—´å¤§å°å¯ä»¥åŠ¨æ€æ‰©ç¼©ï¼Œæ—¢èƒ½åšåˆ°ä½¿ç”¨æ–¹ä¾¿ï¼Œä¹Ÿå°½å¯èƒ½åœ°èŠ‚çº¦äº†èµ„æº</li>
</ul>
<blockquote>
<p>æ­¤å¤–ï¼Œgolang ä¸­å®Œå…¨å±è”½äº†çº¿ç¨‹çš„æ¦‚å¿µï¼Œå›´ç»•ç€ gmp æ‰“é€ çš„ä¸€ç³»åˆ—å¹¶å‘å·¥å…·éƒ½ä»¥ g ä¸ºå¹¶å‘ç²’åº¦ï¼Œå¯ä»¥è¯´æ˜¯å®Œå…¨ç»Ÿä¸€äº† golang å¹¶å‘ä¸–ç•Œçš„ç§©åºï¼Œåšåˆ°äº†ç±»ä¼¼ â€œä¹¦åŒæ–‡ã€è½¦åŒè½¨â€ çš„æ•ˆæœ</p>
</blockquote>
<h3 id="1-3-gmp-æ¶æ„">1.3 gmp æ¶æ„</h3>
<p><code>gmp = goroutine + machine + processor</code>. ä¸‹é¢æˆ‘ä»¬å¯¹è¿™ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶å±•å¼€ä»‹ç»ï¼š</p>
<p>1ï¼‰g</p>
<ul>
<li>gï¼Œå³ goroutineï¼Œæ˜¯ golang ä¸­å¯¹åç¨‹çš„æŠ½è±¡ï¼›</li>
<li>g æœ‰è‡ªå·±çš„è¿è¡Œæ ˆã€ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ã€ä»¥åŠæ‰§è¡Œçš„ä»»åŠ¡å‡½æ•°ï¼ˆç”¨æˆ·é€šè¿‡ go func æŒ‡å®šï¼‰ï¼›</li>
<li>g éœ€è¦ç»‘å®šåœ¨ m ä¸Šæ‰§è¡Œï¼Œåœ¨ g è§†è§’ä¸­ï¼Œå¯ä»¥å°† m ç†è§£ä¸ºå®ƒçš„ cpu</li>
</ul>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ gmp ç†è§£ä¸ºä¸€ä¸ªä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œé‚£ä¹ˆ g å°±æ˜¯è¿™ä¸ªç³»ç»Ÿä¸­æ‰€è°“çš„â€œä»»åŠ¡â€ï¼Œæ˜¯ä¸€ç§éœ€è¦è¢«åˆ†é…å’Œæ‰§è¡Œçš„â€œèµ„æºâ€.</p>
</blockquote>
<p>2ï¼‰m</p>
<ul>
<li>m å³ machineï¼Œæ˜¯ golang ä¸­å¯¹çº¿ç¨‹çš„æŠ½è±¡ï¼›</li>
<li>m éœ€è¦å’Œ p è¿›è¡Œç»“åˆï¼Œä»è€Œè¿›å…¥åˆ° gmp è°ƒåº¦ä½“ç³»ä¹‹ä¸­</li>
<li>m çš„è¿è¡Œç›®æ ‡å§‹ç»ˆåœ¨ g0 å’Œ g ä¹‹é—´è¿›è¡Œåˆ‡æ¢â€”â€”å½“è¿è¡Œ g0 æ—¶æ‰§è¡Œçš„æ˜¯ m çš„è°ƒåº¦æµç¨‹ï¼Œè´Ÿè´£å¯»æ‰¾åˆé€‚çš„â€œä»»åŠ¡â€ï¼Œä¹Ÿå°±æ˜¯ gï¼›å½“è¿è¡Œ g æ—¶ï¼Œæ‰§è¡Œçš„æ˜¯ m è·å–åˆ°çš„â€ä»»åŠ¡â€œï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·é€šè¿‡ go func å¯åŠ¨çš„ goroutine</li>
</ul>
<blockquote>
<p>å½“æˆ‘ä»¬æŠŠ gmp ç†è§£ä¸ºä¸€ä¸ªä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œé‚£ä¹ˆ m å°±æ˜¯è¿™ä¸ªç³»ç»Ÿä¸­çš„â€å¼•æ“â€œ. å½“ m å’Œ p ç»“åˆåï¼Œå°±é™å®šäº†â€å¼•æ“â€œçš„è¿è¡Œæ˜¯å›´ç»•ç€ gmp è¿™æ¡è½¨é“è¿›è¡Œçš„ï¼Œä½¿å¾—â€å¼•æ“â€œè¿è¡Œç€ä¸¤ä¸ªå‘¨è€Œå¤å§‹ã€ä¸æ–­äº¤æ›¿çš„æ­¥éª¤â€”â€”å¯»æ‰¾ä»»åŠ¡ï¼ˆæ‰§è¡Œg0ï¼‰ï¼›æ‰§è¡Œä»»åŠ¡ï¼ˆæ‰§è¡Œgï¼‰</p>
</blockquote>
<p>3ï¼‰ p</p>
<ul>
<li>p å³ processorï¼Œæ˜¯ golang ä¸­çš„è°ƒåº¦å™¨ï¼›</li>
<li>p å¯ä»¥ç†è§£ä¸º m çš„æ‰§è¡Œä»£ç†ï¼Œm éœ€è¦ä¸ p ç»‘å®šåï¼Œæ‰ä¼šè¿›å…¥åˆ° gmp è°ƒåº¦æ¨¡å¼å½“ä¸­ï¼›å› æ­¤ p çš„æ•°é‡å†³å®šäº† g æœ€å¤§å¹¶è¡Œæ•°é‡ï¼ˆå¯ç”±ç”¨æˆ·é€šè¿‡ GOMAXPROCS è¿›è¡Œè®¾å®šï¼Œåœ¨è¶…è¿‡ CPU æ ¸æ•°æ—¶æ— æ„ä¹‰ï¼‰</li>
<li>p æ˜¯ g çš„å­˜å‚¨å®¹å™¨ï¼Œå…¶è‡ªå¸¦ä¸€ä¸ªæœ¬åœ° g é˜Ÿåˆ—ï¼ˆlocal run queueï¼Œç®€ç§° lrqï¼‰ï¼Œæ‰¿è½½ç€ä¸€ç³»åˆ—ç­‰å¾…è¢«è°ƒåº¦çš„ g</li>
</ul>
<blockquote>
<p>å½“æˆ‘ä»¬æŠŠ gmp ç†è§£ä¸ºä¸€ä¸ªä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œé‚£ä¹ˆ p å°±æ˜¯è¿™ä¸ªç³»ç»Ÿä¸­çš„â€ä¸­æ¢â€œï¼Œå½“å…¶å’Œä½œä¸ºâ€å¼•æ“â€œ çš„ m ç»“åˆåï¼Œæ‰ä¼šå¼•å¯¼â€œå¼•æ“â€è¿›å…¥ gmp çš„è¿è¡Œæ¨¡å¼ï¼›åŒæ—¶ p ä¹Ÿæ˜¯è¿™ä¸ªç³»ç»Ÿä¸­å­˜å‚¨â€œä»»åŠ¡â€çš„â€œå®¹å™¨â€ï¼Œä¸ºâ€œå¼•æ“â€æä¾›äº†ç”¨äºæ‰§è¡Œçš„ä»»åŠ¡èµ„æº.</p>
</blockquote>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_3.png" alt="image_3.png"></p>
<p>ç»“åˆä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ‰¿è½½ g çš„å®¹å™¨åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><code>p çš„æœ¬åœ°é˜Ÿåˆ— lrqï¼ˆlocal run queueï¼‰</code>ï¼šè¿™æ˜¯æ¯ä¸ª p ç§æœ‰çš„ g é˜Ÿåˆ—ï¼Œé€šå¸¸ç”± p è‡ªè¡Œè®¿é—®ï¼Œå¹¶å‘ç«äº‰æƒ…å†µè¾ƒå°‘ï¼Œå› æ­¤è®¾è®¡ä¸ºæ— é”åŒ–ç»“æ„ï¼Œé€šè¿‡ CASï¼ˆcompare-and-swapï¼‰æ“ä½œè®¿é—®</li>
</ul>
<blockquote>
<p>å½“ m ä¸ p ç»“åˆåï¼Œä¸è®ºæ˜¯åˆ›å»º g è¿˜æ˜¯è·å– gï¼Œéƒ½ä¼˜å…ˆä»ç§æœ‰çš„ lrq ä¸­è·å–ï¼Œä»è€Œå°½å¯èƒ½å‡å°‘å¹¶å‘ç«äº‰è¡Œä¸ºï¼›è¿™é‡ŒèŠåˆ°å¹¶å‘æƒ…å†µè¾ƒå°‘ï¼Œä½†å¹¶éå®Œå…¨æ²¡æœ‰ï¼Œæ˜¯å› ä¸ºè¿˜å¯èƒ½å­˜åœ¨æ¥è‡ªå…¶ä»– p çš„çªƒå–è¡Œä¸ºï¼ˆstealworkï¼‰</p>
</blockquote>
<ul>
<li><code>å…¨å±€é˜Ÿåˆ— grqï¼ˆglobal run queueï¼‰</code>ï¼šæ˜¯å…¨å±€è°ƒåº¦æ¨¡å— schedt ä¸­çš„å…¨å±€å…±äº« g é˜Ÿåˆ—ï¼Œä½œä¸ºå½“æŸä¸ª lrq ä¸æ»¡è¶³æ¡ä»¶æ—¶çš„å¤‡ç”¨å®¹å™¨ï¼Œå› ä¸ºä¸åŒçš„ m éƒ½å¯èƒ½è®¿é—® grqï¼Œå› æ­¤å¹¶å‘ç«äº‰æ¯”è¾ƒæ¿€çƒˆï¼Œè®¿é—®å‰éœ€è¦åŠ å…¨å±€é”</li>
</ul>
<p>ä»‹ç»å®Œäº† g çš„å­˜å‚¨å®¹å™¨è®¾è®¡åï¼Œæ¥ä¸‹æ¥èŠèŠå°† g æ”¾å…¥å®¹å™¨å’Œå–å‡ºå®¹å™¨çš„æµç¨‹è®¾è®¡ï¼š</p>
<ul>
<li>put gï¼šå½“æŸä¸ª g ä¸­é€šè¿‡ go func(){â€¦} æ“ä½œåˆ›å»ºå­ g æ—¶ï¼Œä¼šå…ˆå°è¯•å°†å­ g æ·»åŠ åˆ°å½“å‰æ‰€åœ¨ p çš„ lrq ä¸­ï¼ˆæ— é”åŒ–ï¼‰ï¼›å¦‚æœ lrq æ»¡äº†ï¼Œåˆ™ä¼šå°† g è¿½åŠ åˆ° grq ä¸­ï¼ˆå…¨å±€é”ï¼‰. æ­¤å¤„é‡‡å–çš„æ€è·¯æ˜¯<code>â€œå°±è¿‘åŸåˆ™â€</code></li>
<li>get gï¼šgmp è°ƒåº¦æµç¨‹ä¸­ï¼Œm å’Œ p ç»“åˆåï¼Œè¿è¡Œçš„ g0 ä¼šä¸æ–­å¯»æ‰¾åˆé€‚çš„ g ç”¨äºæ‰§è¡Œï¼Œæ­¤æ—¶ä¼šé‡‡å–<code>â€œè´Ÿè½½å‡è¡¡â€</code>çš„æ€è·¯ï¼Œéµå¾ªå¦‚ä¸‹å®æ–½æ­¥éª¤ï¼š
<ul>
<li>ä¼˜å…ˆä»å½“å‰ p çš„ lrq ä¸­è·å– gï¼ˆæ— é”åŒ–-CASï¼‰</li>
<li>ä»å…¨å±€çš„ grq ä¸­è·å– gï¼ˆå…¨å±€é”ï¼‰</li>
<li>å– io å°±ç»ªçš„ gï¼ˆnetpoll æœºåˆ¶ï¼‰</li>
<li>ä»å…¶ä»– p çš„ lrq ä¸­çªƒå– gï¼ˆæ— é”åŒ–-CASï¼‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>åœ¨ get g æµç¨‹ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯åœ¨ g0 æ¯ç»è¿‡ 61 æ¬¡è°ƒåº¦å¾ªç¯åï¼Œä¸‹ä¸€æ¬¡ä¼šåœ¨å¤„ç† lrq å‰ä¼˜å…ˆå¤„ç†ä¸€æ¬¡ grqï¼Œé¿å…å›  lrq è¿‡äºå¿™ç¢Œè€Œè‡´ä½¿ grq é™·å…¥é¥¥è’çŠ¶æ€</p>
</blockquote>
<h3 id="1-4-gmp-ç”Ÿæ€">1.4 gmp ç”Ÿæ€</h3>
<p>åœ¨ golang ä¸­å·²ç»å®Œå…¨å±è”½äº†çº¿ç¨‹çš„æ¦‚å¿µï¼Œå°† goroutine ç»Ÿä¸€ä¸ºæ•´ä¸ªè¯­è¨€å±‚é¢çš„å¹¶å‘ç²’åº¦ï¼Œå¹¶éµå¾ªç€ gmp çš„ç§©åºè¿›è¡Œè¿ä½œ. å¦‚æœæŠŠ golang ç¨‹åºæ¯”åšä¸€ä¸ªäººçš„è¯ï¼Œé‚£ä¹ˆ gmp å°±æ˜¯è¿™ä¸ªäººçš„éª¨æ¶ï¼Œæ”¯æŒç€ä»–çš„ç›´ç«‹ä¸è¡Œèµ°ï¼›è€Œåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šï¼Œç´§å¯†å›´ç»•ç€ gmp ç†å¿µæ‰“é€ è®¾è®¡çš„ä¸€ç³»åˆ—å·¥å…·ã€æ¨¡å—åˆ™åƒæ˜¯åœ¨éª¨æ¶ä¹‹ä¸Šå¡«å……çš„è¡€è‚‰ï¼Œæ˜¯ä¾é™„äºè¿™å¥—æ¡†æ¶è€Œå­˜åœ¨çš„. ä¸‹é¢æˆ‘ä»¬æ¥çœ‹å…¶ä¸­å‡ ä¸ªç»å…¸çš„æ¡ˆä¾‹ï¼š</p>
<p>ï¼ˆ1ï¼‰å†…å­˜ç®¡ç†</p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_4.png" alt="image_4.png"></p>
<p>golang çš„å†…å­˜ç®¡ç†æ¨¡å—ä¸»è¦ç»§æ‰¿è‡ª TCMallocï¼ˆThread-Caching-Mallocï¼‰çš„è®¾è®¡æ€è·¯ï¼Œå…¶ä¸­ç”±å¥‘åˆ gmp æ¨¡å‹åšäº†å› åœ°åˆ¶å®œçš„é€‚é…æ”¹é€ ï¼Œä¸ºæ¯ä¸ª p å‡†å¤‡äº†ä¸€ä»½ç§æœ‰çš„é«˜é€Ÿç¼“å­˜â€”â€”mcacheï¼Œèƒ½å¤Ÿæ— é”åŒ–åœ°å®Œæˆä¸€éƒ¨åˆ† p æœ¬åœ°çš„å†…å­˜åˆ†é…æ“ä½œ.</p>
<blockquote>
<p>æ›´å¤šæœ‰å…³ golang å†…å­˜ç®¡ç†ä¸åƒåœ¾å›æ”¶çš„å†…å®¹ï¼Œå¯ä»¥é˜…è¯»æˆ‘æ­¤å‰å‘è¡¨çš„ç³»åˆ—ä¸“é¢˜ï¼š1ï¼‰Golang å†…å­˜æ¨¡å‹ä¸åˆ†é…æœºåˆ¶ï¼›2ï¼‰Golang åƒåœ¾å›æ”¶åŸç†åˆ†æï¼›3ï¼‰Golang åƒåœ¾å›æ”¶æºç åˆ†æ</p>
</blockquote>
<p>ï¼ˆ2ï¼‰å¹¶å‘å·¥å…·</p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_5.png" alt="image_5.png"></p>
<p>åœ¨ golang ä¸­çš„å¹¶å‘å·¥å…·ï¼ˆä¾‹å¦‚é” mutexã€é€šé“ channel ç­‰ï¼‰å‡å¥‘åˆ gmp ä½œäº†é€‚é…æ”¹é€ ï¼Œä¿è¯åœ¨æ‰§è¡Œé˜»å¡æ“ä½œæ—¶ï¼Œä¼šå°†<code>é˜»å¡ç²’åº¦é™åˆ¶åœ¨ gï¼ˆgoroutineï¼‰è€Œé mï¼ˆthreadï¼‰çš„ç²’åº¦</code>ï¼Œä½¿å¾—<code>é˜»å¡ä¸å”¤é†’æ“ä½œéƒ½å±äºç”¨æˆ·æ€è¡Œä¸º</code>ï¼Œæ— éœ€å†…æ ¸çš„ä»‹å…¥ï¼ŒåŒæ—¶ä¸€ä¸ª g çš„é˜»å¡ä¹Ÿå®Œå…¨ä¸ä¼šå½±å“ m ä¸‹å…¶ä»– g çš„è¿è¡Œ.</p>
<blockquote>
<p>æœ‰å…³ mutex å’Œ channel åº•å±‚å®ç°æœºåˆ¶ï¼Œå¯ä»¥é˜…è¯»æˆ‘æ­¤å‰å‘è¡¨çš„æ–‡ç« ï¼š1ï¼‰Golang å•æœºé”å®ç°åŸç†ï¼›2ï¼‰Golang channel å®ç°åŸç†.</p>
</blockquote>
<p>ä¸Šé¢è¿™é¡¹ç»“è®ºçœ‹ä¼¼ç†æ‰€å½“ç„¶ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€é¡¹éå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œè¿™ä¸€ç‚¹éšç€æˆ‘è¿‘æœŸåœ¨å­¦ä¹  c++ è¿‡ç¨‹ä¸­æ‰äº§ç”Ÿäº†æ›´æ·±çš„æ„Ÿæ‚Ÿâ€”â€”æˆ‘åœ¨è¿‘æœŸå°è¯•ç€ä½¿ç”¨ c++ æ•ˆä»¿ gmp å®ç°ä¸€å¥—åç¨‹è°ƒåº¦ä½“ç³»ï¼Œè™½ç„¶è¿˜åŸå‡ºäº†å…¶ä¸­å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œä½†åœ¨ä½¿ç”¨ä¸Šè¿˜æ˜¯å­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºé™·ï¼Œå°±æ˜¯ c++ æ ‡å‡†åº“ä¸­çš„å¹¶å‘å·¥å…·ï¼ˆå¦‚ lockã€semaphore ç­‰ï¼‰å¯¹åº”çš„é˜»å¡ç²’åº¦éƒ½æ˜¯ thread çº§åˆ«çš„ï¼Œè¿™å°±å¯¼è‡´ä¸€ä¸ªåç¨‹ï¼ˆcoroutineï¼‰çš„é˜»å¡ä¼šä¸Šå‡åˆ°çº¿ç¨‹ï¼ˆthreadï¼‰çº§åˆ«ï¼Œå¹¶å¯¼è‡´å…¶ä»– coroutine ä¹Ÿä¸§å¤±è¢«æ‰§è¡Œçš„æœºä¼š.</p>
<blockquote>
<p>è¿™ä¸€ç‚¹å¦‚æœè¦è§£å†³ï¼Œå°±éœ€è¦é’ˆå¯¹æ‰€æœ‰å¹¶å‘å·¥å…·åšä¸€å±‚é€‚é…äºåç¨‹ç²’åº¦çš„æ”¹é€ ï¼Œå®ç°æˆæœ¬æ— ç–‘æ˜¯å·¨å¤§çš„. è¿™ä¹Ÿä»ä¾§é¢å°è¯äº† golang çš„å¹¶å‘ä¼˜è¶Šæ€§ï¼Œè¿™ç§é€‚é…æ€§åœ¨è¯­è¨€å±‚é¢å°±å·²ç»å¤©ç„¶æ”¯æŒäº†.</p>
</blockquote>
<p>ï¼ˆ3ï¼‰io å¤šè·¯å¤ç”¨</p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_6.png" alt="image_6.png"></p>
<p>åœ¨è®¾è®¡ io æ¨¡å‹æ—¶ï¼Œgolang é‡‡ç”¨äº† linux ç³»ç»Ÿæä¾›çš„ epoll å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œç„¶è€Œä¸ºäº†å› ä¸º epoll_wait æ“ä½œè€Œå¼•èµ· mï¼ˆthreadï¼‰ç²’åº¦çš„é˜»å¡ï¼Œgolang ä¸“é—¨è®¾è®¡ä¸€å¥— netpoll æœºåˆ¶ï¼Œä½¿ç”¨ç”¨æˆ·æ€çš„ gopark æŒ‡ä»¤å®ç°é˜»å¡æ“ä½œï¼Œä½¿ç”¨éé˜»å¡ epoll_wait ç»“åˆç”¨æˆ·æ€çš„ goready æŒ‡ä»¤å®ç°å”¤é†’æ“ä½œï¼Œä»è€Œå°† io è¡Œä¸ºä¹Ÿæ§åˆ¶åœ¨ g ç²’åº¦ï¼Œå¾ˆå¥½åœ°å¥‘åˆäº† gmp è°ƒåº¦ä½“ç³».</p>
<blockquote>
<p>å¦‚æœå¯¹è¿™éƒ¨åˆ†å†…å®¹æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥é˜…è¯»æˆ‘è¿‘æœŸåˆšå‘è¡¨çš„æ–‡ç« â€”â€”ä¸‡å­—è§£æ golang netpoll åº•å±‚åŸç†</p>
</blockquote>
<p>ç±»ä¼¼ä¸Šè¿°çš„ä¾‹å­åœ¨ golang ä¸–ç•Œä¸­æ˜¯æ— æ³•ç©·å°½çš„. gmp æ˜¯ golang çŸ¥è¯†ä½“ç³»çš„åŸºçŸ³ï¼Œå¦‚æœæƒ³è¦æ·±å…¥å­¦ä¹ ç†è§£ golangï¼Œé‚£ä¹ˆ gmp æ— ç–‘æ˜¯ä¸€ä¸ªç»ä½³çš„å­¦ä¹ èµ·ç‚¹.</p>
<h2 id="2-gmp-è¯¦è®¾">2 gmp è¯¦è®¾</h2>
<p>æ–‡å­—æ€§çš„ç†è®ºæè¿°éš¾å…è¿‡äºç©ºæ´ï¼Œgã€mã€p å¹¶ä¸æ˜¯æŠ½è±¡çš„æ¦‚å¿µï¼Œäº‹å®ä¸Šä¸‰è€…åœ¨æºç ä¸­éƒ½æœ‰ç€å…·ä½“çš„å®ç°ï¼Œå®šä¹‰ä»£ç å‡ä½äº runtime/runtime2.go. ä¸‹é¢å°±ä»å…·ä½“çš„æºç ä¸­å¯»æ±‚åŸç†å†…å®¹çš„æ”¯æ’‘å’Œä½è¯.</p>
<h3 id="2-1-g-è¯¦è®¾">2.1 g è¯¦è®¾</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_7.png" alt="image_7.png"></p>
<p><code>g ï¼ˆgoroutineï¼‰</code>çš„ç±»å‹å£°æ˜å¦‚ä¸‹ï¼Œå…¶ä¸­åŒ…å«å¦‚ä¸‹æ ¸å¿ƒæˆå‘˜å­—æ®µï¼š</p>
<ul>
<li>stackï¼šg çš„æ ˆç©ºé—´</li>
<li>stackguard0ï¼šæ ˆç©ºé—´ä¿æŠ¤åŒºè¾¹ç•Œ. åŒæ—¶ä¹Ÿæ‰¿æ‹…äº†ä¼ é€’æŠ¢å æ ‡è¯†çš„ä½œç”¨ï¼ˆ5.3 å°èŠ‚ä¸­ä¼šè¿›è¡Œå‘¼åº”ï¼‰</li>
<li>panicï¼šg è¿è¡Œå‡½æ•°ä¸­å‘ç”Ÿçš„ panic</li>
<li>deferï¼šg è¿è¡Œå‡½æ•°ä¸­åˆ›å»ºçš„ defer æ“ä½œï¼ˆä»¥ LIFO æ¬¡åºç»„ç»‡ï¼‰</li>
<li><code>mï¼šæ­£åœ¨æ‰§è¡Œ g çš„ m</code>ï¼ˆè‹¥ g ä¸ä¸º running çŠ¶æ€ï¼Œåˆ™æ­¤å­—æ®µä¸ºç©ºï¼‰</li>
<li><code>atomicstatusï¼šg çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€</code>ï¼ˆå…·ä½“æµè½¬è§„åˆ™å‚è§ä¸Šå›¾ï¼‰</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ª goroutine çš„å…·è±¡ç±»</span></span><br><span class="line"><span class="keyword">type</span> g <span class="keyword">struct</span>&#123;</span><br><span class="line">    <span class="comment">// g çš„æ‰§è¡Œæ ˆç©ºé—´</span></span><br><span class="line">    stack       stack   </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ ˆç©ºé—´ä¿æŠ¤åŒºè¾¹ç•Œï¼Œç”¨äºæ¢æµ‹æ˜¯å¦æ‰§è¡Œæ ˆæ‰©å®¹</span></span><br><span class="line"><span class="comment">        åœ¨ g è¶…æ—¶æŠ¢å è¿‡ç¨‹ä¸­ï¼Œç”¨äºä¼ é€’æŠ¢å æ ‡è¯†</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    stackguard0 <span class="type">uintptr</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½• g æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°çš„å¼‚å¸¸    </span></span><br><span class="line">    _panic    *_panic </span><br><span class="line">    <span class="comment">// g ä¸­æŒ‚è½½çš„ defer å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ª LIFO çš„é“¾è¡¨ç»“æ„</span></span><br><span class="line">    _defer    *_defer </span><br><span class="line"></span><br><span class="line">    <span class="comment">// g ä»å±çš„ m</span></span><br><span class="line">    m         *m      </span><br><span class="line">    <span class="comment">// ...  </span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        g çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">        // g å®ä¾‹åˆšè¢«åˆ†é…è¿˜æœªå®Œæˆåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">        _Gidle = iota // 0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // g å¤„äºå°±ç»ªæ€.  å¯ä»¥è¢«è°ƒåº¦ </span></span><br><span class="line"><span class="comment">        _Grunnable // 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // g æ­£åœ¨è¢«è°ƒåº¦è¿è¡Œè¿‡ç¨‹ä¸­</span></span><br><span class="line"><span class="comment">        _Grunning // 2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // g æ­£åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨</span></span><br><span class="line"><span class="comment">        _Gsyscall // 3</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // g å¤„äºé˜»å¡æ€ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–å¤–éƒ¨æ¡ä»¶è¾¾æˆåï¼Œæ‰èƒ½é‡æ–°æ¢å¤æˆå°±ç»ªæ€</span></span><br><span class="line"><span class="comment">        _Gwaiting // 4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // ç”Ÿæ­»æœ¬æ˜¯ä¸€ä¸ªè½®å›. å½“ g è°ƒåº¦ç»“æŸç”Ÿå‘½ç»ˆç»“ï¼Œæˆ–è€…åˆšè¢«åˆå§‹åŒ–å‡†å¤‡è¿æ¥æ–°ç”Ÿå‰ï¼Œéƒ½ä¼šå¤„äºæ­¤çŠ¶æ€</span></span><br><span class="line"><span class="comment">        _Gdead // 6</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    atomicstatus <span class="type">uint32</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è¿›å…¥å…¨å±€é˜Ÿåˆ— grq æ—¶æŒ‡å‘ç›¸é‚» g çš„ next æŒ‡é’ˆ</span></span><br><span class="line">    schedlink    guintptr</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-m-è¯¦è®¾">2.2 m è¯¦è®¾</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_8.png" alt="image_8.png"></p>
<p><code>mï¼ˆmachineï¼‰</code>æ˜¯ go å¯¹ thread çš„æŠ½è±¡ï¼Œå…¶ç±»å®šä¹‰ä»£ç ä¸­åŒ…å«å¦‚ä¸‹æ ¸å¿ƒæˆå‘˜ï¼š</p>
<ul>
<li><code>g0ï¼šæ‰§è¡Œè°ƒåº¦æµç¨‹çš„ç‰¹æ®Š g</code>ï¼ˆä¸ç”±ç”¨æˆ·åˆ›å»ºï¼Œæ˜¯ä¸ m ä¸€å¯¹ä¸€ä¼´ç”Ÿçš„ç‰¹æ®Š gï¼Œä¸º m å¯»æ‰¾åˆé€‚çš„æ™®é€š g ç”¨äºæ‰§è¡Œï¼‰</li>
<li>gsignalï¼šæ‰§è¡Œä¿¡å·å¤„ç†çš„ç‰¹æ®Š gï¼ˆä¸ç”±ç”¨æˆ·åˆ›å»ºï¼Œæ˜¯ä¸ m ä¸€å¯¹ä¸€ä¼´ç”Ÿçš„ç‰¹æ®Š gï¼Œå¤„ç†åˆ†é…ç»™ m çš„ signalï¼‰</li>
<li><code>curgï¼šm ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ™®é€š g</code>ï¼ˆç”±ç”¨æˆ·é€šè¿‡ go func(){â€¦} æ“ä½œåˆ›å»ºï¼‰</li>
<li><code>pï¼šå½“å‰ä¸ m ç»“åˆçš„ p</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> m <span class="keyword">struct</span>&#123;</span><br><span class="line">    <span class="comment">// ç”¨äºè°ƒåº¦æ™®é€š g çš„ç‰¹æ®Š gï¼Œä¸æ¯ä¸ª m ä¸€ä¸€å¯¹åº”</span></span><br><span class="line">    g0      *g</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// m çš„å”¯ä¸€ id</span></span><br><span class="line">    procid        <span class="type">uint64</span></span><br><span class="line">    <span class="comment">// ç”¨äºå¤„ç†ä¿¡å·çš„ç‰¹æ®Š gï¼Œä¸æ¯ä¸ª m ä¸€ä¸€å¯¹åº”</span></span><br><span class="line">    gsignal       *g</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// m ä¸Šæ­£åœ¨è¿è¡Œçš„ g</span></span><br><span class="line">    curg          *g</span><br><span class="line">    <span class="comment">// m å…³è”çš„ p</span></span><br><span class="line">    p             puintptr</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è¿›å…¥ schedt midle é“¾è¡¨æ—¶æŒ‡å‘ç›¸é‚» m çš„ next æŒ‡é’ˆ</span></span><br><span class="line">    schedlink     muintptr</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„æš‚æ—¶å°† gsignalæŒ‰ä¸‹ä¸è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† m çš„è¿è¡Œç›®æ ‡åˆ’åˆ†ä¸º g0 å’Œ g ï¼Œä¸¤è€…æ˜¯å§‹ç»ˆäº¤æ›¿è¿›è¡Œçš„ï¼šg0 å°±ç±»ä¼¼äºå¼•æ“ä¸­çš„è°ƒåº¦é€»è¾‘ï¼Œæ£€ç´¢ä»»åŠ¡åˆ—è¡¨å¯»æ‰¾éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼›g å°±æ˜¯ç”± g0 æ‰¾åˆ°å¹¶åˆ†é…ç»™ m æ‰§è¡Œçš„ä¸€ä¸ªå…·ä½“ä»»åŠ¡.</p>
<h3 id="2-3-p-è¯¦è®¾">2.3 p è¯¦è®¾</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_9.png" alt="image_9.png"></p>
<p><code>p ï¼ˆprocessorï¼‰</code>æ˜¯ gmp ä¸­çš„è°ƒåº¦å™¨ï¼Œå…¶ç±»å®šä¹‰ä»£ç ä¸­åŒ…å«å¦‚ä¸‹æ ¸å¿ƒæˆå‘˜å­—æ®µï¼š</p>
<ul>
<li>statusï¼šp ç”Ÿå‘½å‘¨æœŸçŠ¶æ€</li>
<li>mï¼šå½“å‰ä¸ p ç»“åˆçš„ m</li>
<li><code>runqï¼šp ç§æœ‰çš„ g é˜Ÿåˆ—â€”â€”local run queueï¼Œç®€ç§° lrq</code></li>
<li>runqheadï¼šlrq ä¸­é˜Ÿé¦–èŠ‚ç‚¹çš„ç´¢å¼•</li>
<li>runqtailï¼šlrq ä¸­é˜Ÿå°¾èŠ‚ç‚¹çš„ç´¢å¼•</li>
<li>runnextï¼šlrq ä¸­çš„ç‰¹å®šå¸­ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå³å°†æ‰§è¡Œçš„ g</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> p <span class="keyword">struct</span>&#123;</span><br><span class="line">    id          <span class="type">int32</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        p çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">        // p å› ç¼ºå°‘ g è€Œè¿›å…¥ç©ºé—²æ¨¡å¼ï¼Œæ­¤æ—¶ä¼šè¢«æ·»åŠ åˆ°å…¨å±€çš„ idle p é˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">        _Pidle = iota // 0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // p æ­£åœ¨è¿è¡Œä¸­ï¼Œè¢« m æ‰€æŒæœ‰ï¼Œå¯èƒ½åœ¨è¿è¡Œæ™®é€š gï¼Œä¹Ÿå¯èƒ½åœ¨è¿è¡Œ g0</span></span><br><span class="line"><span class="comment">        _Prunning // 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // p æ‰€å…³è”çš„ m æ­£åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨. æ­¤æ—¶ p å¯èƒ½è¢«çªƒå–å¹¶ä¸å…¶ä»– m å…³è”</span></span><br><span class="line"><span class="comment">        _Psyscall // 2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // p å·²è¢«ç»ˆæ­¢</span></span><br><span class="line"><span class="comment">        _Pdead // 4</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    status      <span class="type">uint32</span><span class="comment">// one of pidle/prunning/...</span></span><br><span class="line">    <span class="comment">// è¿›å…¥ schedt pidle é“¾è¡¨æ—¶æŒ‡å‘ç›¸é‚» p çš„ next æŒ‡é’ˆ</span></span><br><span class="line">    link        puintptr</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// p æ‰€å…³è”çš„ m. è‹¥ p ä¸º idle çŠ¶æ€ï¼Œå¯èƒ½ä¸º nil</span></span><br><span class="line">    m           muintptr   <span class="comment">// back-link to associated m (nil if idle)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// lrq çš„é˜Ÿé¦–</span></span><br><span class="line">    runqhead <span class="type">uint32</span></span><br><span class="line">    <span class="comment">// lrq çš„é˜Ÿå°¾</span></span><br><span class="line">    runqtail <span class="type">uint32</span></span><br><span class="line">    <span class="comment">// q çš„æœ¬åœ° g é˜Ÿåˆ—â€”â€”lrq</span></span><br><span class="line">    runq     [<span class="number">256</span>]guintptr</span><br><span class="line">    <span class="comment">// ä¸‹ä¸€ä¸ªè°ƒåº¦çš„ g. å¯ä»¥ç†è§£ä¸º lrq ä¸­çš„ç‰¹ç­‰å¸­</span></span><br><span class="line">    runnext guintptr</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-4-schedt-è¯¦è®¾">2.4 schedt è¯¦è®¾</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_10.png" alt="image_10.png"></p>
<p><code>schedt æ˜¯å…¨å±€å…±äº«çš„èµ„æºæ¨¡å—</code>ï¼Œåœ¨è®¿é—®å‰éœ€è¦åŠ å…¨å±€é”ï¼š</p>
<ul>
<li>lockï¼šå…¨å±€ç»´åº¦çš„äº’æ–¥é”</li>
<li>midleï¼šç©ºé—² m é˜Ÿåˆ—</li>
<li>pidleï¼šç©ºé—² p é˜Ÿåˆ—</li>
<li><code>runqï¼šå…¨å±€ g é˜Ÿåˆ—â€”â€”global run queueï¼Œç®€ç§° grq</code></li>
<li>runqsizeï¼šgrq ä¸­å­˜åœ¨çš„ g ä¸ªæ•°</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…¨å±€è°ƒåº¦æ¨¡å—</span></span><br><span class="line"><span class="keyword">type</span> schedt <span class="keyword">struct</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// äº’æ–¥é”</span></span><br><span class="line">    lock mutex</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç©ºé—² m é˜Ÿåˆ—</span></span><br><span class="line">    midle        muintptr <span class="comment">// idle m&#x27;s waiting for work</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// ç©ºé—² p é˜Ÿåˆ—</span></span><br><span class="line">    pidle      puintptr <span class="comment">// idle p&#x27;s</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¨å±€ g é˜Ÿåˆ—â€”â€”grq</span></span><br><span class="line">    runq     gQueue</span><br><span class="line">    <span class="comment">// grq ä¸­å­˜é‡ g çš„ä¸ªæ•°</span></span><br><span class="line">    runqsize <span class="type">int32</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¹‹æ‰€ä»¥å­˜åœ¨ midle å’Œ pidle çš„è®¾è®¡ï¼Œå°±æ˜¯ä¸ºäº†é¿å… p å’Œ m å› ç¼ºå°‘ g è€Œå¯¼è‡´ cpu ç©ºè½¬. å¯¹äºç©ºé—²çš„ p å’Œ mï¼Œä¼šè¢«é›†æˆåˆ°ç©ºé—²é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”ä¼šæš‚åœ m çš„è¿è¡Œ</p>
</blockquote>
<h2 id="3-è°ƒåº¦åŸç†">3 è°ƒåº¦åŸç†</h2>
<p>æœ¬ç« è¦å’Œå¤§å®¶èŠçš„æµç¨‹æ˜¯â€œè°ƒåº¦â€. æ‰€è°“<code>è°ƒåº¦</code>ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªç”±ç”¨æˆ·é€šè¿‡ go func(){â€¦} æ“ä½œåˆ›å»ºçš„ gï¼Œæ˜¯å¦‚ä½•è¢« m ä¸Šçš„ g0 è·å–å¹¶æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”± <code>g0 -&gt; g</code> çš„æµè½¬è¿‡ç¨‹.</p>
<blockquote>
<p>æˆ‘ä¹ æƒ¯äºå°†â€œè°ƒåº¦â€ç§°ä¸ºç¬¬ä¸€è§†è§’ä¸‹çš„è½¬æ¢ï¼Œå› ä¸ºè¯¥æµè½¬è¿‡ç¨‹æ˜¯ç”± m ä¸Šè¿è¡Œçš„ g0 ä¸»åŠ¨å‘èµ·çš„ï¼Œè€Œæ— éœ€ç¬¬ä¸‰æ–¹è§’è‰²çš„å¹²é¢„.</p>
</blockquote>
<h3 id="3-1-main-å‡½æ•°ä¸-g">3.1 main å‡½æ•°ä¸ g</h3>
<p>1ï¼‰main å‡½æ•°</p>
<p>main å‡½æ•°ä½œä¸ºæ•´ä¸ª go ç¨‹åºçš„å…¥å£æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„å­˜åœ¨ï¼Œå®ƒæ˜¯ç”± go ç¨‹åºå…¨å±€å”¯ä¸€çš„ m0ï¼ˆmain threadï¼‰æ‰§è¡Œçš„ï¼Œå¯¹åº”æºç ä½äº runtime.proc.goï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//go:linkname main_main main.main</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main_main</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The main goroutine.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·å£°æ˜çš„ main å‡½æ•°</span></span><br><span class="line">    fn := main_main </span><br><span class="line">    <span class="comment">// æ‰§è¡Œç”¨æˆ·å£°æ˜çš„ main å‡½æ•°</span></span><br><span class="line">    fn()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ï¼‰g</p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_11.png" alt="image_11.png"></p>
<p>é™¤äº† main å‡½æ•°è¿™ä¸ªç‰¹ä¾‹ä¹‹å¤–ï¼Œæ‰€æœ‰ç”¨æˆ·é€šè¿‡ go func(){â€¦} æ“ä½œå¯åŠ¨çš„ goroutineï¼Œéƒ½ä¼šä»¥ g çš„å½¢å¼è¿›å…¥åˆ° gmp æ¶æ„å½“ä¸­.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// å¼‚æ­¥å¯åŠ¨ goroutine</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// do something ...</span></span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºå‡ºä¸€ä¸ª g å®ä¾‹çš„åˆ›å»ºï¼Œå°†å…¶ç½®ä¸ºå°±ç»ªçŠ¶æ€ï¼Œå¹¶æ·»åŠ åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ï¼š</p>
<ul>
<li>å¦‚æœå½“å‰ p å¯¹åº”æœ¬åœ°é˜Ÿåˆ— lrq æ²¡æœ‰æ»¡ï¼Œåˆ™æ·»åŠ åˆ° lrq ä¸­ï¼›</li>
<li>å¦‚æœ lrq æ»¡äº†ï¼Œåˆ™åŠ é”å¹¶æ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ— grq ä¸­.</li>
</ul>
<p>ä¸Šè¿°æµç¨‹å¯¹åº”ä»£ç ä¸º runtime/proc.go çš„ newproc æ–¹æ³•ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ gï¼Œæœ¬å°†å…¶æŠ•é€’å…¥é˜Ÿåˆ—. å…¥å‚ fn ä¸ºç”¨æˆ·æŒ‡å®šçš„å‡½æ•°.</span></span><br><span class="line"><span class="comment">// å½“å‰æ‰§è¡Œæ–¹è¿˜æ˜¯æŸä¸ªæ™®é€š g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newproc</span><span class="params">(fn *funcval)</span></span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ™®é€š g åŠå…¶ç¨‹åºè®¡æ•°å™¨ï¼ˆprogram counterï¼‰</span></span><br><span class="line">    gp := getg()</span><br><span class="line">    pc := getcallerpc()</span><br><span class="line">    <span class="comment">// æ‰§è¡Œ systemstack æ—¶ï¼Œä¼šä¸´æ—¶åˆ‡æ¢è‡³ g0ï¼Œå¹¶åœ¨å®Œæˆå…¶ä¸­é—­åŒ…å‡½æ•°è°ƒç”¨åï¼Œåˆ‡æ¢å›åˆ°åŸæœ¬çš„æ™®é€š g</span></span><br><span class="line">    systemstack(<span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹ä¸º g0</span></span><br><span class="line">        <span class="comment">// æ„é€ ä¸€ä¸ªæ–°çš„ g å®ä¾‹</span></span><br><span class="line">        newg := newproc1(fn, gp, pc)</span><br><span class="line">        <span class="comment">// è·å–å½“å‰ p</span></span><br><span class="line">        _p_ := getg().m.p.ptr()</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            å°† newg æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼š</span></span><br><span class="line"><span class="comment">            1ï¼‰ä¼˜å…ˆæ·»åŠ åˆ° p çš„æœ¬åœ°é˜Ÿåˆ— lrq</span></span><br><span class="line"><span class="comment">            2ï¼‰è‹¥ lrq æ»¡äº†ï¼Œåˆ™æ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ— grq</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        runqput(_p_, newg,<span class="literal">true</span>)</span><br><span class="line">        <span class="comment">// å¦‚æœå­˜åœ¨å› è¿‡åº¦ç©ºé—²è€Œè¢« block çš„ p å’Œ mï¼Œåˆ™éœ€è¦å¯¹å…¶è¿›è¡Œå”¤é†’</span></span><br><span class="line">        <span class="keyword">if</span> mainStarted &#123;</span><br><span class="line">            wakep()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// åˆ‡æ¢å›åˆ°åŸæœ¬çš„æ™®é€š g ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œå°† g æ·»åŠ åˆ°å°±ç»ªé˜Ÿåˆ—çš„æ–¹æ³•ä¸º runqputï¼Œå±•ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°è¯•å°† g æ·»åŠ åˆ°æŒ‡å®š p çš„ lrq ä¸­. è‹¥ lrq æ»¡äº†ï¼Œåˆ™å°† g æ·»åŠ åˆ° grqrq ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runqput</span><span class="params">(_p_ *p, gp *g, next <span class="type">bool</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å½“ next ä¸º true æ—¶ï¼Œä¼šä¼˜å…ˆå°† gp ä»¥ cas æ“ä½œæ”¾ç½®åˆ° p çš„ runnext ä½ç½®</span></span><br><span class="line">    <span class="comment">// å¦‚æœåŸå›  runnext ä½ç½®è¿˜æœ‰ gï¼Œåˆ™å†å°è¯•å°†å®ƒè¿½åŠ åˆ° lrq çš„å°¾éƒ¨</span></span><br><span class="line">    <span class="keyword">if</span> next&#123;</span><br><span class="line">    retryNext:</span><br><span class="line">        oldnext := _p_.runnext</span><br><span class="line">        <span class="keyword">if</span> !_p_.runnext.cas(oldnext, guintptr(unsafe.Pointer(gp)))&#123;</span><br><span class="line">            <span class="keyword">goto</span> retryNext</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœ runnext ä½ç½®åŸæœ¬ä¸å­˜åœ¨ g ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> oldnext ==<span class="number">0</span>&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// gp æŒ‡å‘ runnext ä¸­è¢«ç½®æ¢å‡ºæ¥çš„ g</span></span><br><span class="line">        gp = oldnext.ptr()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">retry:</span><br><span class="line">    <span class="comment">// è·å– lrq å¤´èŠ‚ç‚¹çš„ç´¢å¼•</span></span><br><span class="line">    h := atomic.LoadAcq(&amp;_p_.runqhead)<span class="comment">// load-acquire, synchronize with consumers</span></span><br><span class="line">    <span class="comment">// è·å– lrq å°¾èŠ‚ç‚¹çš„ç´¢å¼•</span></span><br><span class="line">    t := _p_.runqtail</span><br><span class="line">    <span class="comment">// å¦‚æœ lrq æ²¡æœ‰æ»¡ï¼Œåˆ™å°† g è¿½åŠ åˆ°å°¾èŠ‚ç‚¹çš„ä½ç½®ï¼Œå¹¶ä¸”é€’å¢å°¾èŠ‚ç‚¹çš„ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">if</span> t-h &lt;<span class="type">uint32</span>(<span class="built_in">len</span>(_p_.runq))&#123;</span><br><span class="line">        _p_.runq[t%<span class="type">uint32</span>(<span class="built_in">len</span>(_p_.runq))].set(gp)</span><br><span class="line">        atomic.StoreRel(&amp;_p_.runqtail, t+<span class="number">1</span>)<span class="comment">// store-release, makes the item available for consumption</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// runqputslow æ–¹æ³•ä¸­ä¼šå°† g ä»¥åŠ lrq ä¸­åŠæ•°çš„ g æ”¾ç½®åˆ°å…¨å±€é˜Ÿåˆ— grq ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> runqputslow(_p_, gp, h, t)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-2-g0-ä¸-g">3.2 g0 ä¸ g</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_12.png" alt="image_12.png"></p>
<p>åœ¨æ¯ä¸ª m ä¸­ä¼šæœ‰ä¸€ä¸ªä¸ä¹‹ä¼´ç”Ÿçš„ g0ï¼Œå…¶ä»»åŠ¡å°±æ˜¯ä¸æ–­å¯»æ‰¾å¯æ‰§è¡Œçš„ g. æ‰€ä»¥å¯¹ä¸€ä¸ª m æ¥è¯´ï¼Œå…¶è¿è¡Œå‘¨æœŸå°±æ˜¯å¤„åœ¨ g0 ä¸ g ä¹‹é—´è½®æ¢äº¤æ›¿çš„è¿‡ç¨‹ä¸­.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> m <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºå¯»æ‰¾å¹¶è°ƒåº¦æ™®é€š g çš„ç‰¹æ®Š gï¼Œä¸æ¯ä¸ª m ä¸€ä¸€å¯¹åº”</span></span><br><span class="line">    g0      *g</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// m ä¸Šæ­£åœ¨è¿è¡Œçš„æ™®é€š g</span></span><br><span class="line">    curg          *g</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨ m è¿è¡Œä¸­ï¼Œèƒ½å¤Ÿé€šè¿‡å‡ ä¸ªæ¡©æ–¹æ³•å®ç° g0 ä¸ g ä¹‹é—´æ‰§è¡Œæƒçš„åˆ‡æ¢:</p>
<ul>
<li>g -&gt; g0ï¼šmcallã€systemstack</li>
<li>g0 -&gt; gï¼šgogo</li>
</ul>
<p>å¯¹åº”æ–¹æ³•å£°æ˜äº runtime/stubs.go æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä» g åˆ‡æ¢è‡³ g0 æ‰§è¡Œ. åªå…è®¸åœ¨ g ä¸­è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mcall</span><span class="params">(fn <span class="keyword">func</span>(*g)</span></span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ™®é€š g ä¸­è°ƒç”¨æ—¶ï¼Œä¼šåˆ‡æ¢è‡³ g0 å‹æ ˆæ‰§è¡Œ fnï¼Œæ‰§è¡Œå®Œæˆååˆ‡å›åˆ° g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">systemstack</span><span class="params">(fn <span class="keyword">func</span>()</span></span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä» g0 åˆ‡æ¢è‡³ g æ‰§è¡Œ. gobuf åŒ…å« g è¿è¡Œä¸Šä¸‹æ–‡ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gogo</span><span class="params">(buf *gobuf)</span></span></span><br></pre></td></tr></table></figure>
<p>è€Œä» g0 è§†è§’å‡ºå‘æ¥çœ‹ï¼Œå…¶åœ¨å…ˆåç»å†äº†ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•åï¼Œå®Œæˆäº† g0 -&gt; g çš„åˆ‡æ¢ï¼š</p>
<ul>
<li>scheduleï¼šè°ƒç”¨ findRunnable æ–¹æ³•ï¼Œè·å–åˆ°å¯æ‰§è¡Œçš„ g</li>
<li>executeï¼šæ›´æ–° g çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè°ƒç”¨ gogo æ–¹æ³•ï¼Œå°† m çš„æ‰§è¡Œæƒç”± g0 åˆ‡æ¢åˆ° g</li>
</ul>
<p>ä¸Šè¿°æ–¹æ³•å‡å®ç°äº runtime/proc.go æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰§è¡Œæ–¹ä¸º g0</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">schedule</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰ g0 </span></span><br><span class="line">    _g_ := getg()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">top:</span><br><span class="line">    <span class="comment">// è·å–å½“å‰ p</span></span><br><span class="line">    pp := _g_.m.p.ptr()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">         æ ¸å¿ƒæ–¹æ³•ï¼šè·å–éœ€è¦è°ƒåº¦çš„ g</span></span><br><span class="line"><span class="comment">              - æŒ‰ç…§ä¼˜å…ˆçº§ï¼Œä¾æ¬¡å–æœ¬åœ°é˜Ÿåˆ— lrqã€å–å…¨å±€é˜Ÿåˆ— grqã€æ‰§è¡Œ netpollã€çªƒå–å…¶ä»– p lrq</span></span><br><span class="line"><span class="comment">              - è‹¥æ²¡æœ‰åˆé€‚ gï¼Œåˆ™å°† p å’Œ m block ä½å¹¶æ·»åŠ åˆ°ç©ºé—²é˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    gp, inheritTime, tryWakeP := findRunnable()<span class="comment">// blocks until work is available</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// æ‰§è¡Œ gï¼Œè¯¥æ–¹æ³•ä¸­ä¼šå°†æ‰§è¡Œæƒç”± g0 -&gt; g</span></span><br><span class="line">    execute(gp, inheritTime)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œç»™å®šçš„ g. å½“å‰æ‰§è¡Œæ–¹è¿˜æ˜¯ g0ï¼Œä½†ä¼šé€šè¿‡ gogo æ–¹æ³•åˆ‡æ¢è‡³ gp</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">execute</span><span class="params">(gp *g, inheritTime <span class="type">bool</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">// è·å– g0</span></span><br><span class="line">    _g_ := getg()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            å»ºç«‹ m å’Œ gp çš„å…³ç³»</span></span><br><span class="line"><span class="comment">            1ï¼‰å°† m ä¸­çš„ curg å­—æ®µæŒ‡å‘ gp</span></span><br><span class="line"><span class="comment">            2ï¼‰å°† gp çš„ m å­—æ®µæŒ‡å‘å½“å‰ m</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    _g_.m.curg = gp</span><br><span class="line">    gp.m = _g_.m</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–° gp çŠ¶æ€ runnable -&gt; running</span></span><br><span class="line">    casgstatus(gp,_Grunnable,_Grunning)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è®¾ç½® gp çš„æ ˆç©ºé—´ä¿æŠ¤åŒºè¾¹ç•Œ</span></span><br><span class="line">    gp.stackguard0 = gp.stack.lo +_StackGuard</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// æ‰§è¡Œ gogo æ–¹æ³•ï¼Œm æ‰§è¡Œæƒä¼šåˆ‡æ¢è‡³ gp</span></span><br><span class="line">    gogo(&amp;gp.sched)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-find-g">3.3 find g</h3>
<p>åœ¨è°ƒåº¦æµç¨‹ä¸­ï¼Œæœ€æ ¸å¿ƒçš„æ­¥éª¤å°±åœ¨äºï¼ŒfindRunnable æ–¹æ³•ä¸­å¦‚ä½•æŒ‰ç…§æŒ‡å®šçš„ç­–ç•¥è·å–åˆ°å¯æ‰§è¡Œçš„ g.</p>
<p>1ï¼‰ä¸»æµç¨‹</p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_13.png" alt="image_13.png"></p>
<p>findRunnable æ–¹æ³•å£°æ˜äº runtime/proc.go ä¸­ï¼Œå…¶æ ¸å¿ƒæ­¥éª¤åŒ…æ‹¬ï¼šï¼š</p>
<ul>
<li>æ¯ç»å† 61 æ¬¡è°ƒåº¦åï¼Œéœ€è¦å…ˆå¤„ç†ä¸€æ¬¡å…¨å±€é˜Ÿåˆ— grqï¼ˆglobrunqgetâ€”â€”åŠ é”ï¼‰ï¼Œé¿å…äº§ç”Ÿé¥¥é¥¿ï¼›</li>
<li>å°è¯•ä»æœ¬åœ°é˜Ÿåˆ— lrq ä¸­è·å– gï¼ˆrunqgetâ€”â€”CAS æ— é”ï¼‰</li>
<li>å°è¯•ä»å…¨å±€é˜Ÿåˆ— grq è·å– gï¼ˆglobrunqgetâ€”â€”åŠ é”ï¼‰</li>
<li>å°è¯•è·å– io å°±ç»ªçš„ gï¼ˆnetpollâ€”â€”éé˜»å¡æ¨¡å¼ï¼‰</li>
<li>å°è¯•ä»å…¶ä»– p çš„ lrq çªƒå– gï¼ˆstealworkï¼‰</li>
<li>double check ä¸€æ¬¡ grqï¼ˆglobrunqgetâ€”â€”åŠ é”ï¼‰</li>
<li>è‹¥æ²¡æ‰¾åˆ° gï¼Œå°† p ç½®ä¸º idle çŠ¶æ€ï¼Œæ·»åŠ åˆ° schedt pidle é˜Ÿåˆ—ï¼ˆåŠ¨æ€ç¼©å®¹ï¼‰</li>
<li>ç¡®ä¿ç•™å®ˆä¸€ä¸ª mï¼Œç›‘å¬å¤„ç† io å°±ç»ªçš„ gï¼ˆnetpollâ€”â€”é˜»å¡æ¨¡å¼ï¼‰</li>
<li>è‹¥ m ä»æ— äº‹å¯åšï¼Œåˆ™å°†å…¶æ·»åŠ åˆ° schedt midle é˜Ÿåˆ—ï¼ˆåŠ¨æ€ç¼©å®¹ï¼‰</li>
<li>æš‚åœ mï¼ˆå›æ”¶èµ„æºï¼‰</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–å¯ç”¨äºæ‰§è¡Œçš„ g. å¦‚æœè¯¥æ–¹æ³•è¿”å›äº†ï¼Œåˆ™ä¸€å®šå·²ç»æ‰¾åˆ°äº†ç›®æ ‡ g.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findRunnable</span><span class="params">()</span></span>(gp *g, inheritTime, tryWakeP <span class="type">bool</span>)&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰æ‰§è¡Œ p ä¸‹çš„ g0</span></span><br><span class="line">    _g_ := getg()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">top:</span><br><span class="line">    <span class="comment">// è·å– p</span></span><br><span class="line">    _p_ := _g_.m.p.ptr()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// æ¯ 61 æ¬¡è°ƒåº¦ï¼Œéœ€è¦å°è¯•å¤„ç†ä¸€æ¬¡å…¨å±€é˜Ÿåˆ— (é˜²æ­¢é¥¥é¥¿)</span></span><br><span class="line">    <span class="keyword">if</span> _p_.schedtick%<span class="number">61</span>==<span class="number">0</span>&amp;&amp; sched.runqsize &gt;<span class="number">0</span>&#123;</span><br><span class="line">        lock(&amp;sched.lock)</span><br><span class="line">        gp = globrunqget(_p_,<span class="number">1</span>)</span><br><span class="line">        unlock(&amp;sched.lock)</span><br><span class="line">        <span class="keyword">if</span> gp !=<span class="literal">nil</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> gp,<span class="literal">false</span>,<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å°è¯•ä»æœ¬åœ°é˜Ÿåˆ— lrq ä¸­è·å– g</span></span><br><span class="line">    <span class="keyword">if</span> gp, inheritTime := runqget(_p_); gp !=<span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gp, inheritTime,<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è¯•ä»å…¨å±€é˜Ÿåˆ— grq ä¸­è·å– g</span></span><br><span class="line">    <span class="keyword">if</span> sched.runqsize !=<span class="number">0</span>&#123;</span><br><span class="line">        lock(&amp;sched.lock)</span><br><span class="line">        gp := globrunqget(_p_,<span class="number">0</span>)</span><br><span class="line">        unlock(&amp;sched.lock)</span><br><span class="line">        <span class="keyword">if</span> gp !=<span class="literal">nil</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> gp,<span class="literal">false</span>,<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œ netpoll æµç¨‹ï¼Œå°è¯•æ‰¹é‡å”¤é†’ io å°±ç»ªçš„ g å¹¶è·å–é¦–ä¸ªç”¨ä»¥è°ƒåº¦</span></span><br><span class="line">    <span class="keyword">if</span> netpollinited()&amp;&amp; atomic.Load(&amp;netpollWaiters)&gt;<span class="number">0</span>&amp;&amp; atomic.Load64(&amp;sched.lastpoll)!=<span class="number">0</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> list := netpoll(<span class="number">0</span>);!list.empty()&#123;<span class="comment">// non-blocking</span></span><br><span class="line">            gp := list.pop()</span><br><span class="line">            injectglist(&amp;list)</span><br><span class="line">            casgstatus(gp,_Gwaiting,_Grunnable)</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="keyword">return</span> gp,<span class="literal">false</span>,<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// ä»å…¶ä»– p çš„ lrq ä¸­çªƒå– g</span></span><br><span class="line">    gp, inheritTime, tnow, w, newWork := stealWork(now)</span><br><span class="line">    <span class="keyword">if</span> gp !=<span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gp, inheritTime,<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‹¥å­˜åœ¨ gc å¹¶å‘æ ‡è®°ä»»åŠ¡ï¼Œåˆ™ä»¥ idle æ¨¡å¼å‚ä¸åä½œï¼Œå¥½è¿‡ç›´æ¥å›æ”¶ p</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ å…¨å±€é”ï¼Œå¹¶ double check å…¨å±€é˜Ÿåˆ—æ˜¯å¦æœ‰ g</span></span><br><span class="line">    lock(&amp;sched.lock)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span> sched.runqsize !=<span class="number">0</span>&#123;</span><br><span class="line">        gp := globrunqget(_p_,<span class="number">0</span>)</span><br><span class="line">        unlock(&amp;sched.lock)</span><br><span class="line">        <span class="keyword">return</span> gp,<span class="literal">false</span>,<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// ç¡®è®¤å½“å‰ p æ— äº‹å¯åšï¼Œåˆ™å°† p å’Œ m è§£ç»‘ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å…¨å±€è°ƒåº¦æ¨¡å— schedt ä¸­çš„ç©ºé—² p é˜Ÿåˆ— pidle ä¸­</span></span><br><span class="line">    <span class="comment">// è§£é™¤ m å’Œ p çš„å…³ç³»</span></span><br><span class="line">    releasep()</span><br><span class="line">    <span class="comment">// å°† p æ·»åŠ åˆ° schedt.pidle ä¸­</span></span><br><span class="line">    now = pidleput(_p_, now)</span><br><span class="line">    unlock(&amp;sched.lock)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// åœ¨ block å½“å‰ m ä¹‹å‰ï¼Œä¿è¯å…¨å±€å­˜åœ¨ä¸€ä¸ª m ç•™å®ˆä¸‹æ¥ï¼Œä»¥é˜»å¡æ¨¡å¼æ‰§è¡Œ netpollï¼Œä¿è¯æœ‰ io å°±ç»ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œèƒ½è¢«ç¬¬ä¸€æ—¶é—´å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> netpollinited()&amp;&amp;(atomic.Load(&amp;netpollWaiters)&gt;<span class="number">0</span>|| pollUntil !=<span class="number">0</span>)&amp;&amp; atomic.Xchg64(&amp;sched.lastpoll,<span class="number">0</span>)!=<span class="number">0</span>&#123;</span><br><span class="line">        atomic.Store64(&amp;sched.pollUntil,<span class="type">uint64</span>(pollUntil))</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// ä»¥é˜»å¡æ¨¡å¼æ‰§è¡Œ netpoll æµç¨‹</span></span><br><span class="line">        delay :=<span class="type">int64</span>(<span class="number">-1</span>)</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        list := netpoll(delay)<span class="comment">// block until new work is available</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¢å¤ lastpoll æ ‡è¯†</span></span><br><span class="line">        atomic.Store64(&amp;sched.lastpoll,<span class="type">uint64</span>(now))</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        lock(&amp;sched.lock)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä» schedt çš„ç©ºé—² p é˜Ÿåˆ— pidle ä¸­è·å–ä¸€ä¸ªç©ºé—² p</span></span><br><span class="line">        _p_, _ = pidleget(now)</span><br><span class="line">        unlock(&amp;sched.lock)</span><br><span class="line">        <span class="comment">// è‹¥æ²¡æœ‰è·å–åˆ° pï¼Œåˆ™å°†å°±ç»ªçš„ g éƒ½æ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ— grq ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> _p_ ==<span class="literal">nil</span>&#123;</span><br><span class="line">            injectglist(&amp;list)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// m ä¸ p ç»“åˆ</span></span><br><span class="line">            acquirep(_p_)</span><br><span class="line">            <span class="comment">// å°†é¦–ä¸ª g ç›´æ¥ç”¨äºè°ƒåº¦ï¼Œå…¶ä½™çš„æ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ— grq</span></span><br><span class="line">            <span class="keyword">if</span>!list.empty()&#123;</span><br><span class="line">                gp := list.pop()</span><br><span class="line">                injectglist(&amp;list)</span><br><span class="line">                casgstatus(gp,_Gwaiting,_Grunnable)</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">                <span class="keyword">return</span> gp,<span class="literal">false</span>,<span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="keyword">goto</span> top</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// èµ°åˆ°æ­¤å¤„ä»ç„¶æœªæ‰¾åˆ°åˆé€‚çš„ g ç”¨äºè°ƒåº¦ï¼Œåˆ™éœ€è¦å°† m block ä½ï¼Œæ·»åŠ åˆ° schedt çš„ midle ä¸­</span></span><br><span class="line">    stopm()</span><br><span class="line">    <span class="keyword">goto</span> top</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2ï¼‰ä» lrqè·å– g</p>
<p>runqget æ–¹æ³•ç”¨äºä»æŸä¸ª p çš„ lrq ä¸­è·å– gï¼š</p>
<ul>
<li>ä»¥ CAS æ“ä½œå– runnext ä½ç½®çš„ gï¼Œè·å–æˆåŠŸåˆ™è¿”å›</li>
<li>ä»¥ CAS æ“ä½œç§»åŠ¨ lrq çš„å¤´èŠ‚ç‚¹ç´¢å¼•ï¼Œç„¶åè¿”å›å¤´èŠ‚ç‚¹å¯¹åº” g</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// [æ— é”åŒ–]ä»æŸä¸ª p çš„æœ¬åœ°é˜Ÿåˆ— lrq ä¸­è·å– g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runqget</span><span class="params">(_p_ *p)</span></span>(gp *g, inheritTime <span class="type">bool</span>)&#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆå°è¯•è·å–ç‰¹å®šå¸­ä½ runnext ä¸­çš„ gï¼Œä½¿ç”¨ cas æ“ä½œ</span></span><br><span class="line">    next:= _p_.runnext</span><br><span class="line">    <span class="keyword">if</span> next!=<span class="number">0</span>&amp;&amp; _p_.runnext.cas(next,<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> next.ptr(),<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è¯•åŸºäº cas æ“ä½œï¼Œè·å–æœ¬åœ°é˜Ÿåˆ—å¤´èŠ‚ç‚¹ä¸­çš„ g</span></span><br><span class="line">    <span class="keyword">for</span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å¤´èŠ‚ç‚¹ç´¢å¼•</span></span><br><span class="line">        h := atomic.LoadAcq(&amp;_p_.runqhead)<span class="comment">// load-acquire, synchronize with other consumers</span></span><br><span class="line">        <span class="comment">// è·å–å°¾èŠ‚ç‚¹ç´¢å¼•</span></span><br><span class="line">        t := _p_.runqtail</span><br><span class="line">        <span class="comment">// å¤´å°¾èŠ‚ç‚¹é‡åˆï¼Œè¯´æ˜ lrq ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> t == h &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>,<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ ¹æ®ç´¢å¼•ä» lrq ä¸­å–å‡ºå¤´èŠ‚ç‚¹å¯¹åº”çš„ g</span></span><br><span class="line">        gp := _p_.runq[h%<span class="type">uint32</span>(<span class="built_in">len</span>(_p_.runq))].ptr()</span><br><span class="line">        <span class="comment">// é€šè¿‡ cas æ“ä½œæ›´æ–°å¤´èŠ‚ç‚¹ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">if</span> atomic.CasRel(&amp;_p_.runqhead, h, h+<span class="number">1</span>)&#123;<span class="comment">// cas-release, commits consume</span></span><br><span class="line">            <span class="keyword">return</span> gp,<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3ï¼‰ä»å…¨å±€é˜Ÿåˆ—è·å– g</p>
<p>globrunqget æ–¹æ³•ç”¨äºä»å…¨å±€çš„ grq ä¸­è·å– g. è°ƒç”¨æ—¶éœ€è¦ç¡®ä¿æŒæœ‰ schedt çš„å…¨å±€é”ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»å…¨å±€é˜Ÿåˆ— grq ä¸­è·å– g. è°ƒç”¨æ­¤æ–¹æ³•å‰å¿…é¡»æŒæœ‰ schedt ä¸­çš„äº’æ–¥é” lock</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">globrunqget</span><span class="params">(_p_ *p, max <span class="type">int32</span>)</span></span>*g &#123;</span><br><span class="line">    <span class="comment">// æ–­è¨€ç¡®ä¿æŒæœ‰é”</span></span><br><span class="line">    assertLockHeld(&amp;sched.lock)</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—ä¸ºç©ºï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> sched.runqsize ==<span class="number">0</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// æ­¤å¤–è¿˜æœ‰ä¸€äº›é€»è¾‘æ˜¯æ ¹æ®ä¼ å…¥çš„ max å€¼å°è¯•è·å– grq ä¸­çš„åŠæ•° g å¡«å……åˆ° p çš„ lrq ä¸­. æ­¤å¤„ä¸å±•å¼€</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»å…¨å±€é˜Ÿåˆ—çš„é˜Ÿé¦–å¼¹å‡ºä¸€ä¸ª g</span></span><br><span class="line">    gp := sched.runq.pop()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> gp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4ï¼‰è·å– io å°±ç»ªçš„ g</p>
<p>åœ¨ gmp è°ƒåº¦æµç¨‹ä¸­ï¼Œå¦‚æœ lrq å’Œ grq éƒ½ä¸ºç©ºï¼Œåˆ™ä¼šæ‰§è¡Œ netpoll æµç¨‹ï¼Œå°è¯•ä»¥éé˜»å¡æ¨¡å¼ä¸‹çš„ epoll_wait æ“ä½œè·å– io å°±ç»ªçš„ g. è¯¥æ–¹æ³•ä½äº runtime/netpoll_epoll.goï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">netpoll</span><span class="params">(delay <span class="type">int64</span>)</span></span> gList &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨ epoll_wait è·å–å°±ç»ªçš„ io event</span></span><br><span class="line">    <span class="keyword">var</span> events [<span class="number">128</span>]epollevent</span><br><span class="line">    n := epollwait(epfd,&amp;events[<span class="number">0</span>],<span class="type">int32</span>(<span class="built_in">len</span>(events)), waitms)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">var</span> toRun gList</span><br><span class="line">    <span class="keyword">for</span> i :=<span class="type">int32</span>(<span class="number">0</span>); i &lt; n; i++&#123;</span><br><span class="line">        ev :=&amp;events[i]</span><br><span class="line">        <span class="comment">// å°†å°±ç»ª event å¯¹åº” g è¿½åŠ åˆ°çš„ glist ä¸­</span></span><br><span class="line">        netpollready(...)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> toRun</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>5ï¼‰ä»å…¶ä»– p çªƒå– g</p>
<p>å¦‚æœæ‰§è¡Œå®Œ netpoll æµç¨‹åä»æœªè·å¾— gï¼Œåˆ™ä¼šå°è¯•ä»å…¶ä»– p çš„ lrq ä¸­çªƒå–åŠæ•° g è¡¥å……åˆ°å½“å‰ p çš„ lrq ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stealWork</span><span class="params">(now <span class="type">int64</span>)</span></span> (gp *g, inheritTime <span class="type">bool</span>, rnow, pollUntil <span class="type">int64</span>, newWork <span class="type">bool</span>)&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰ p</span></span><br><span class="line">    pp := getg().m.p.ptr()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å¤–å±‚å¾ªç¯ 4 æ¬¡</span></span><br><span class="line">    <span class="keyword">const</span> stealTries =<span class="number">4</span></span><br><span class="line">    <span class="keyword">for</span> i :=<span class="number">0</span>; i &lt; stealTries; i++&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// é€šè¿‡éšæœºæ•°ä»¥éšæœºèµ·ç‚¹éšæœºæ­¥é•¿é€‰å–ç›®æ ‡ p è¿›è¡Œçªƒå–</span></span><br><span class="line">        <span class="keyword">for</span> enum:= stealOrder.start(fastrand());!enum.done();enum.next()&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="comment">// è·å–æ‹Ÿçªƒå–çš„ç›®æ ‡ p</span></span><br><span class="line">            p2 := allp[enum.position()]</span><br><span class="line">            <span class="comment">// å¦‚æœç›®æ ‡ p æ˜¯å½“å‰ pï¼Œåˆ™è·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> pp == p2 &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="comment">// åªè¦ç›®æ ‡ p ä¸ä¸º idle çŠ¶æ€ï¼Œåˆ™è¿›è¡Œçªƒå–</span></span><br><span class="line">            <span class="keyword">if</span>!idlepMask.read(enum.position())&#123;</span><br><span class="line">                <span class="comment">// çªƒå–ç›®æ ‡ pï¼Œå…¶ä¸­ä¼šå°è¯•å°†ç›®æ ‡ p lrq ä¸­åŠæ•° g çªƒå–åˆ°å½“å‰ p çš„ lrq ä¸­</span></span><br><span class="line">                <span class="keyword">if</span> gp := runqsteal(pp, p2, stealTimersOrRunNextG); gp !=<span class="literal">nil</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> gp,<span class="literal">false</span>, now, pollUntil, ranTimer</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çªƒå–å¤±è´¥ æœªæ‰¾åˆ°åˆé€‚çš„ç›®æ ‡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>,<span class="literal">false</span>, now, pollUntil, ranTimer</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>6ï¼‰å›æ”¶ç©ºé—²çš„ p å’Œ m</p>
<p>å¦‚æœç›´åˆ°æœ€åéƒ½æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ g ç”¨äºæ‰§è¡Œï¼Œåˆ™éœ€è¦å°† p å’Œ m æ·»åŠ åˆ° schedt çš„ pidle å’Œ midle é˜Ÿåˆ—ä¸­å¹¶åœæ­¢ m çš„è¿è¡Œï¼Œé¿å…äº§ç”Ÿèµ„æºæµªè´¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°† p è¿½åŠ åˆ° schedt pidle é˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pidleput</span><span class="params">(_p_ *p, now <span class="type">int64</span>)</span></span><span class="type">int64</span>&#123;</span><br><span class="line">    assertLockHeld(&amp;sched.lock)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// p æŒ‡é’ˆæŒ‡å‘åŸæœ¬ pidle é˜Ÿé¦–</span></span><br><span class="line">    _p_.link = sched.pidle</span><br><span class="line">    <span class="comment">// å°† p è®¾ç½®ä¸º pidle é˜Ÿé¦–</span></span><br><span class="line">    sched.pidle.set(_p_)</span><br><span class="line">    atomic.Xadd(&amp;sched.npidle,<span class="number">1</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å½“å‰ m æ·»åŠ åˆ° schedt midle é˜Ÿåˆ—å¹¶åœæ­¢ m</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stopm</span><span class="params">()</span></span>&#123;</span><br><span class="line">    _g_ := getg()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    lock(&amp;sched.lock)</span><br><span class="line">    <span class="comment">// å°† m æ·»åŠ åˆ° schedt.mdile</span></span><br><span class="line">    mput(_g_.m)</span><br><span class="line">    unlock(&amp;sched.lock)</span><br><span class="line">    <span class="comment">// åœæ­¢ m</span></span><br><span class="line">    mPark()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="4-è®©æ¸¡è®¾è®¡">4 è®©æ¸¡è®¾è®¡</h2>
<p>æ‰€è°“â€œè®©æ¸¡â€ï¼ŒæŒ‡çš„æ˜¯å½“ g åœ¨ m ä¸Šè¿è¡Œæ—¶ï¼Œä¸»åŠ¨è®©å‡ºæ‰§è¡Œæƒï¼Œä½¿å¾— m çš„è¿è¡Œå¯¹è±¡é‡æ–°å›åˆ° g0ï¼Œå³ç”± g -&gt; g0 çš„æµè½¬è¿‡ç¨‹.</p>
<blockquote>
<p>â€œè®©æ¸¡â€å’Œâ€è°ƒåº¦â€œä¸€æ ·ï¼Œä¹Ÿå±äºç¬¬ä¸€è§†è§’ä¸‹çš„è½¬æ¢ï¼Œè¯¥æµè½¬è¿‡ç¨‹æ˜¯ç”± m ä¸Šè¿è¡Œçš„ g ä¸»åŠ¨å‘èµ·çš„ï¼Œè€Œæ— éœ€ç¬¬ä¸‰æ–¹è§’è‰²çš„å¹²é¢„.</p>
</blockquote>
<h3 id="4-1-ç»“æŸè®©æ¸¡">4.1 ç»“æŸè®©æ¸¡</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_14.png" alt="image_14.png"></p>
<p>å½“ g æ‰§è¡Œç»“æŸæ—¶ï¼Œä¼šæ­£å¸¸é€€å‡ºï¼Œå¹¶å°†æ‰§è¡Œæƒåˆ‡æ¢å›åˆ° g0.</p>
<p>é¦–å…ˆï¼Œg åœ¨è¿è¡Œç»“æŸæ—¶ä¼šè°ƒç”¨ goexit1 æ–¹æ³•ä¸­ï¼Œå¹¶é€šè¿‡ mcall æŒ‡ä»¤åˆ‡æ¢è‡³ g0ï¼Œç”± g0 è°ƒç”¨ goexit0 æ–¹æ³•ï¼Œå¹¶ç”± g0 æ‰§è¡Œä¸‹è¿°æ­¥éª¤ï¼š</p>
<ul>
<li>å°† g çŠ¶æ€ç”± running æ›´æ–°ä¸º dead</li>
<li>æ¸…ç©º g ä¸­çš„æ•°æ®</li>
<li>è§£é™¤ g å’Œ m çš„å…³ç³»</li>
<li>å°† g æ·»åŠ åˆ° p çš„ gfree é˜Ÿåˆ—ä»¥ä¾›å¤ç”¨</li>
<li>è°ƒç”¨ schedule æ–¹æ³•å‘èµ·æ–°ä¸€è½®è°ƒåº¦</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// goroutine è¿è¡Œç»“æŸ. æ­¤æ—¶æ‰§è¡Œæ–¹æ˜¯æ™®é€š g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goexit1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡ mcallï¼Œå°†æ‰§è¡Œæ–¹è½¬ä¸º g0ï¼Œè°ƒç”¨ goexit0 æ–¹æ³•</span></span><br><span class="line">    mcall(goexit0)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹ä¸º g0ï¼Œå…¥å‚ gp ä¸ºå·²ç»è¿è¡Œç»“æŸçš„ g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goexit0</span><span class="params">(gp *g)</span></span>&#123;</span><br><span class="line">    <span class="comment">// è·å– g0</span></span><br><span class="line">    _g_ := getg()</span><br><span class="line">    <span class="comment">// è·å–å¯¹åº”çš„ p</span></span><br><span class="line">    _p_ := _g_.m.p.ptr()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† gp çš„çŠ¶æ€ç”± running æ›´æ–°ä¸º dead</span></span><br><span class="line">    casgstatus(gp,_Grunning,_Gdead)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† gp ä¸­çš„å†…å®¹æ¸…ç©º</span></span><br><span class="line">    gp.m =<span class="literal">nil</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    gp._defer =<span class="literal">nil</span><span class="comment">// should be true already but just in case.</span></span><br><span class="line">    gp._panic =<span class="literal">nil</span><span class="comment">// non-nil for Goexit during panic. points at stack-allocated data.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å°† g å’Œ p è§£é™¤å…³ç³»</span></span><br><span class="line">    dropg()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å°† g æ·»åŠ åˆ° p çš„ gfree é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    gfput(_p_, gp)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å‘èµ·æ–°ä¸€è½®è°ƒåº¦æµç¨‹</span></span><br><span class="line">    schedule()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="4-2-ä¸»åŠ¨è®©æ¸¡">4.2 ä¸»åŠ¨è®©æ¸¡</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_15.png" alt="image_15.png"></p>
<p>ä¸»åŠ¨è®©æ¸¡æŒ‡çš„æ˜¯ç”±ç”¨æˆ·æ‰‹åŠ¨è°ƒç”¨ runtime.Gosched æ–¹æ³•è®©å‡º g æ‰€æŒæœ‰çš„æ‰§è¡Œæƒ. åœ¨ Gosched æ–¹æ³•ä¸­ï¼Œä¼šé€šè¿‡ mcall æŒ‡ä»¤åˆ‡æ¢è‡³ g0ï¼Œå¹¶ç”± g0 æ‰§è¡Œ gosched_m æ–¹æ³•ï¼Œå…¶ä¸­åŒ…å«å¦‚ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>å°† g ç”± running æ”¹ä¸º runnable çŠ¶æ€</li>
<li>è§£é™¤ g å’Œ m çš„å…³ç³»</li>
<li>å°† g ç›´æ¥æ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ— grq ä¸­</li>
<li>è°ƒç”¨ schedule æ–¹æ³•å‘èµ·æ–°ä¸€è½®è°ƒåº¦</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸»åŠ¨è®©æ¸¡å‡ºæ‰§è¡Œæƒï¼Œæ­¤æ—¶æ‰§è¡Œæ–¹è¿˜æ˜¯æ™®é€š g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Gosched</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ mcallï¼Œå°†æ‰§è¡Œæ–¹è½¬ä¸º g0ï¼Œè°ƒç”¨ gosched_m æ–¹æ³•</span></span><br><span class="line">    mcall(gosched_m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† gp åˆ‡æ¢å›å°±ç»ªæ€åæ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ— grqï¼Œå¹¶å‘èµ·æ–°ä¸€è½®è°ƒåº¦</span></span><br><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹ä¸º g0</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gosched_m</span><span class="params">(gp *g)</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    goschedImpl(gp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goschedImpl</span><span class="params">(gp *g)</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å°† g çŠ¶æ€ç”± running æ”¹ä¸º runnable å°±ç»ªæ€</span></span><br><span class="line">    casgstatus(gp,_Grunning,_Grunnable)</span><br><span class="line">    <span class="comment">// è§£é™¤ g å’Œ m çš„å…³ç³»</span></span><br><span class="line">    dropg()</span><br><span class="line">    <span class="comment">// å°† g æ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ— grq</span></span><br><span class="line">    lock(&amp;sched.lock)</span><br><span class="line">    globrunqput(gp)</span><br><span class="line">    unlock(&amp;sched.lock)</span><br><span class="line">    <span class="comment">// å‘èµ·æ–°ä¸€è½®è°ƒåº¦</span></span><br><span class="line">    schedule()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-3-é˜»å¡è®©æ¸¡">4.3 é˜»å¡è®©æ¸¡</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_16.png" alt="image_16.png"></p>
<p>é˜»å¡è®©æ¸¡æŒ‡çš„æ˜¯ g åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€ä¾èµ–çš„å¤–éƒ¨æ¡ä»¶æ²¡æœ‰è¾¾æˆï¼Œéœ€è¦è¿›å…¥é˜»å¡ç­‰å¾…çš„çŠ¶æ€ï¼ˆwaitingï¼‰ï¼Œç›´åˆ°æ¡ä»¶è¾¾æˆåæ‰èƒ½å®Œæˆå°†çŠ¶æ€é‡æ–°æ›´æ–°ä¸ºå°±ç»ªæ€ï¼ˆrunnableï¼‰.</p>
<p>Golang é’ˆå¯¹ mutexã€channel ç­‰å¹¶å‘å·¥å…·çš„è®¾è®¡ï¼Œåœ¨åº•å±‚éƒ½æ˜¯é‡‡ç”¨äº†é˜»å¡è®©æ¸¡çš„è®¾è®¡æ¨¡å¼ï¼Œå…·ä½“æ‰§è¡Œçš„æ–¹æ³•æ˜¯ä½äº runtime/proc.go çš„ gopark æ–¹æ³•ï¼š</p>
<ul>
<li>é€šè¿‡ mcall ä» g åˆ‡æ¢è‡³ g0ï¼Œå¹¶ç”± g0 æ‰§è¡Œ park_m æ–¹æ³•</li>
<li>g0 å°† g ç”± running æ›´æ–°ä¸º waiting çŠ¶æ€ï¼Œç„¶åå‘èµ·æ–°ä¸€è½®è°ƒåº¦</li>
</ul>
<blockquote>
<p>æ­¤å¤„éœ€è¦æ³¨æ„ï¼Œåœ¨é˜»å¡è®©æ¸¡åï¼Œg ä¸ä¼šè¿›å…¥åˆ° lrq æˆ– grq ä¸­ï¼Œå› ä¸º lrq/grq å±äºå°±ç»ªé˜Ÿåˆ—. åœ¨æ‰§è¡Œ gopark æ—¶ï¼Œä½¿ç”¨æ–¹æœ‰ä¹‰åŠ¡è‡ªè¡Œç»´æŠ¤ g çš„å¼•ç”¨ï¼Œå¹¶åœ¨å¤–éƒ¨æ¡ä»¶å°±ç»ªæ—¶ï¼Œé€šè¿‡ goready æ“ä½œå°†å…¶æ›´æ–°ä¸º runnable çŠ¶æ€å¹¶é‡æ–°æ·»åŠ åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­.</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹ä¸ºæ™®é€š g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gopark</span><span class="params">(unlockf <span class="keyword">func</span>(*g, unsafe.Pointer)</span></span><span class="type">bool</span>,lockunsafe.Pointer, reason waitReason, traceEv <span class="type">byte</span>, traceskip <span class="type">int</span>)&#123;</span><br><span class="line">    <span class="comment">// è·å– m æ­£åœ¨æ‰§è¡Œçš„ gï¼Œä¹Ÿå°±æ˜¯è¦é˜»å¡è®©æ¸¡çš„ g</span></span><br><span class="line">    gp := mp.curg</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ mcallï¼Œå°†æ‰§è¡Œæ–¹ç”±æ™®é€š g -&gt; g0</span></span><br><span class="line">    mcall(park_m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹ä¸º g0. å…¥å‚ gp ä¸ºéœ€è¦æ‰§è¡Œ park çš„æ™®é€š g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">park_m</span><span class="params">(gp *g)</span></span>&#123;</span><br><span class="line">    <span class="comment">// è·å– g0 </span></span><br><span class="line">    _g_ := getg()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† gp çŠ¶æ€ç”± running å˜æ›´ä¸º waiting</span></span><br><span class="line">    casgstatus(gp,_Grunning,_Gwaiting)</span><br><span class="line">    <span class="comment">// è§£ç»‘ g ä¸ m çš„å…³ç³»</span></span><br><span class="line">    dropg()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// g0 å‘èµ·æ–°ä¸€è½®è°ƒåº¦æµç¨‹</span></span><br><span class="line">    schedule()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ gopark ç›¸å¯¹çš„ï¼Œæ˜¯ç”¨äºå”¤é†’ g çš„ goready æ–¹æ³•ï¼Œå…¶ä¸­ä¼šé€šè¿‡ systemstack å‹æ ˆåˆ‡æ¢è‡³ g0 æ‰§è¡Œ ready æ–¹æ³•â€”â€”å°†ç›®æ ‡ g çŠ¶æ€ç”± waiting æ”¹ä¸º runnableï¼Œç„¶åæ·»åŠ åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹ä¸ºæ™®é€š g. å…¥å‚ gp ä¸ºéœ€è¦å”¤é†’çš„å¦ä¸€ä¸ªæ™®é€š g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goready</span><span class="params">(gp *g, traceskip <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ systemstack åï¼Œä¼šåˆ‡æ¢è‡³ g0 äºšå±•è°ƒç”¨ä¼ å…¥çš„ ready æ–¹æ³•. è°ƒç”¨ç»“æŸååˆ™ä¼šç›´æ¥åˆ‡æ¢å›åˆ°å½“å‰æ™®é€š g ç»§ç»­æ‰§è¡Œ. </span></span><br><span class="line">    systemstack(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ready(gp, traceskip, <span class="literal">true</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¢å¤æˆæ™®é€š g ç»§ç»­æ‰§è¡Œ ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹ä¸º g0. å…¥å‚ gp ä¸ºæ‹Ÿå”¤é†’çš„æ™®é€š g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ready</span><span class="params">(gp *g, traceskip <span class="type">int</span>, next <span class="type">bool</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å½“å‰ g0</span></span><br><span class="line">    _g_ := getg()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å°†ç›®æ ‡ g çŠ¶æ€ç”± waiting æ›´æ–°ä¸º runnable</span></span><br><span class="line">    casgstatus(gp,_Gwaiting,_Grunnable)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1) ä¼˜å…ˆå°†ç›®æ ‡ g æ·»åŠ åˆ°å½“å‰ p çš„æœ¬åœ°é˜Ÿåˆ— lrq</span></span><br><span class="line"><span class="comment">        2ï¼‰è‹¥ lrq æ»¡äº†ï¼Œåˆ™å°† g è¿½åŠ åˆ°å…¨å±€é˜Ÿåˆ— grq</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    runqput(_g_.m.p.ptr(), gp,next)</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰ m æˆ– p å¤„äº idle çŠ¶æ€ï¼Œå°†å…¶å”¤é†’</span></span><br><span class="line">    wakep()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-æŠ¢å è®¾è®¡">5 æŠ¢å è®¾è®¡</h2>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_17.png" alt="image_17.png"></p>
<p>æœ€åæ˜¯å…³äºâ€œæŠ¢å â€çš„æµç¨‹ä»‹ç»ï¼ŒæŠ¢å å’Œè®©æ¸¡æœ‰ç›¸åŒä¹‹å¤„ï¼Œéƒ½è¡¨ç¤ºç”± g-&gt;g0 çš„æµè½¬è¿‡ç¨‹ï¼Œä½†åŒºåˆ«åœ¨äºï¼Œè®©æ¸¡æ˜¯ç”± g ä¸»åŠ¨å‘èµ·çš„ï¼ˆç¬¬ä¸€äººç§°ï¼‰ï¼Œè€ŒæŠ¢å åˆ™æ˜¯ç”±å¤–åŠ›å¹²é¢„ï¼ˆsysmon threadï¼‰å‘èµ·çš„ï¼ˆç¬¬ä¸‰äººç§°ï¼‰.</p>
<h3 id="5-1-ç›‘æ§çº¿ç¨‹">5.1 ç›‘æ§çº¿ç¨‹</h3>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_18.png" alt="image_18.png"></p>
<p>åœ¨ go ç¨‹åºè¿è¡Œæ—¶ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ç›‘æ§çº¿ç¨‹â€”â€”sysmon threadï¼Œå…¶è´Ÿè´£å®šæ—¶æ‰§è¡Œç›‘æ§å·¥ä½œï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ‰§è¡Œ netpoll æ“ä½œï¼Œå”¤é†’ io å°±ç»ªçš„ g</li>
<li>æ‰§è¡Œ retake æ“ä½œï¼Œå¯¹è¿è¡Œæ—¶é—´è¿‡é•¿çš„ g æ‰§è¡ŒæŠ¢å æ“ä½œ</li>
<li>æ‰§è¡Œ gcTrigger æ“ä½œï¼Œæ¢æµ‹æ˜¯å¦éœ€è¦å‘èµ·æ–°çš„ gc è½®æ¬¡</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// The main goroutine.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    systemstack(<span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">        newm(sysmon,<span class="literal">nil</span>,<span class="number">-1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sysmon</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>&#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®é—²å¿™æƒ…å†µè°ƒæ•´è½®è¯¢é—´éš”ï¼Œåœ¨ç©ºé—²æƒ…å†µä¸‹ 10 ms è½®è¯¢ä¸€æ¬¡</span></span><br><span class="line">        usleep(delay)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// æ‰§è¡Œ netpoll </span></span><br><span class="line">        lastpoll :=<span class="type">int64</span>(atomic.Load64(&amp;sched.lastpoll))</span><br><span class="line">        <span class="keyword">if</span> netpollinited()&amp;&amp; lastpoll !=<span class="number">0</span>&amp;&amp; lastpoll+<span class="number">10</span>*<span class="number">1000</span>*<span class="number">1000</span>&lt; now &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            list := netpoll(<span class="number">0</span>)<span class="comment">// non-blocking - returns list of goroutines</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡ŒæŠ¢å å·¥ä½œ</span></span><br><span class="line">        retake(now)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šæ—¶æ£€æŸ¥æ˜¯å¦éœ€è¦å‘èµ· gc</span></span><br><span class="line">        <span class="keyword">if</span> t :=(gcTrigger&#123;kind: gcTriggerTime, now: now&#125;); t.test()&amp;&amp; atomic.Load(&amp;forcegc.idle)!=<span class="number">0</span>&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡ŒæŠ¢å é€»è¾‘çš„ retake æ–¹æ³•æœ¬ç« ç ”ç©¶çš„é‡ç‚¹ï¼Œå…¶ä¸­æ ¹æ®æŠ¢å ç›®æ ‡å’ŒçŠ¶æ€çš„ä¸åŒï¼Œåˆå¯ä»¥åˆ†ä¸ºç³»ç»Ÿè°ƒç”¨æŠ¢å å’Œè¿è¡Œè¶…æ—¶æŠ¢å .</p>
<h3 id="5-2-ç³»ç»Ÿè°ƒç”¨">5.2 ç³»ç»Ÿè°ƒç”¨</h3>
<p>ç³»ç»Ÿè°ƒç”¨æ˜¯ mï¼ˆthreadï¼‰ç²’åº¦çš„ï¼Œåœ¨æ‰§è¡ŒæœŸé—´ä¼šå¯¼è‡´æ•´ä¸ª m æš‚æ—¶ä¸å¯ç”¨ï¼Œæ‰€ä»¥æ­¤æ—¶çš„æŠ¢å å¤„ç†æ€è·¯æ˜¯ï¼Œå°†å‘èµ· syscall çš„ g å’Œ m ç»‘å®šï¼Œä½†æ˜¯è§£é™¤ p ä¸ m çš„ç»‘å®šå…³ç³»ï¼Œä½¿å¾—æ­¤æœŸé—´ p å­˜åœ¨å’Œå…¶ä»– m ç»“åˆçš„æœºä¼š.</p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_19.png" alt="image_19.png"></p>
<p>åœ¨å‘èµ·ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¼šæ‰§è¡Œä½äº runtime/proc.go çš„ reentersyscall æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ ¸å¿ƒæ­¥éª¤åŒ…æ‹¬ï¼š</p>
<ul>
<li>å°† g å’Œ p çš„çŠ¶æ€æ›´æ–°ä¸º syscall</li>
<li>è§£é™¤ p å’Œ m çš„ç»‘å®š</li>
<li>å°† p è®¾ç½®ä¸º m.oldpï¼Œä¿ç•™ p ä¸ m ä¹‹é—´çš„å¼±è”ç³»ï¼ˆä½¿å¾— m syscall ç»“æŸåï¼Œè¿˜æœ‰ä¸€æ¬¡å°è¯•å¤ç”¨ p çš„æœºä¼šï¼‰</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reentersyscall</span><span class="params">(pc, sp <span class="type">uintptr</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// è·å– g</span></span><br><span class="line">    _g_ := getg()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// ä¿å­˜å¯„å­˜å™¨ä¿¡æ¯</span></span><br><span class="line">    save(pc, sp)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å°† g çŠ¶æ€æ›´æ–°ä¸º syscall</span></span><br><span class="line">    casgstatus(_g_,_Grunning,_Gsyscall)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è§£é™¤ p ä¸ m ç»‘å®šå…³ç³»</span></span><br><span class="line">    pp := _g_.m.p.ptr()</span><br><span class="line">    pp.m =<span class="number">0</span></span><br><span class="line">    <span class="comment">// å°† p è®¾ç½®ä¸º m çš„ oldp</span></span><br><span class="line">    _g_.m.oldp.set(pp)</span><br><span class="line">    _g_.m.p =<span class="number">0</span></span><br><span class="line">    <span class="comment">// å°† p çŠ¶æ€æ›´æ–°ä¸º syscall</span></span><br><span class="line">    atomic.Store(&amp;pp.status,_Psyscall)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å½“ç³»ç»Ÿç³»ç»Ÿè°ƒç”¨å®Œæˆæ—¶ï¼Œä¼šæ‰§è¡Œä½äº runtime/proc.go çš„ exitsyscall æ–¹æ³•ï¼ˆæ­¤æ—¶æ‰§è¡Œæ–¹è¿˜æ˜¯ m ä¸Šçš„ gï¼‰ï¼ŒåŒ…å«å¦‚ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>æ£€æŸ¥ syscall æœŸé—´ï¼Œp æ˜¯å¦æœªå’Œå…¶ä»– m ç»“åˆï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œç›´æ¥å¤ç”¨ pï¼Œç»§ç»­æ‰§è¡Œ g</li>
<li>é€šè¿‡ mcall æ“ä½œåˆ‡æ¢è‡³ g0 æ‰§è¡Œ exitsyscall0 æ–¹æ³•â€”â€”å°è¯•ä¸ºå½“å‰ m ç»“åˆä¸€ä¸ªæ–°çš„ pï¼Œå¦‚æœç»“åˆæˆåŠŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œ gï¼Œå¦åˆ™å°† g æ·»åŠ åˆ° grq åæš‚åœ m</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exitsyscall</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// è·å– g</span></span><br><span class="line">    _g_ := getg()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ oldp æ²¡æœ‰å’Œå…¶ä»– m ç»“åˆï¼Œåˆ™ç›´æ¥å¤ç”¨ oldp</span></span><br><span class="line">    oldp := _g_.m.oldp.ptr()</span><br><span class="line">    _g_.m.oldp =<span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> exitsyscallfast(oldp)&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// å°† g çŠ¶æ€ç”± syscall æ›´æ–°å› running</span></span><br><span class="line">        casgstatus(_g_,_Gsyscall,_Grunning)</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡æ¢è‡³ g0 è°ƒç”¨ exitsyscall0 æ–¹æ³•</span></span><br><span class="line">    mcall(exitsyscall0)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹ä¸º m ä¸‹çš„ g0</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exitsyscall0</span><span class="params">(gp *g)</span></span>&#123;</span><br><span class="line">    <span class="comment">// å°† g çš„çŠ¶æ€ä¿®æ”¹ä¸º runnable å°±ç»ªæ€</span></span><br><span class="line">    casgstatus(gp,_Gsyscall,_Grunnable)</span><br><span class="line">    <span class="comment">// è§£é™¤ g å’Œ m çš„ç»‘å®šå…³ç³»</span></span><br><span class="line">    dropg()</span><br><span class="line">    lock(&amp;sched.lock)</span><br><span class="line">    <span class="comment">// å°è¯•å¯»æ‰¾ä¸€ä¸ªç©ºé—²çš„ p ä¸å½“å‰ m ç»“åˆ</span></span><br><span class="line">    <span class="keyword">var</span> _p_ *p</span><br><span class="line">    _p_, _ = pidleget(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">var</span> locked <span class="type">bool</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸ p ç»“åˆå¤±è´¥ï¼Œåˆ™å°† g æ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> _p_ ==<span class="literal">nil</span>&#123;</span><br><span class="line">        globrunqput(gp)</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    unlock(&amp;sched.lock)</span><br><span class="line">    <span class="comment">// å¦‚æœä¸ p ç»“åˆæˆåŠŸï¼Œåˆ™ç»§ç»­è°ƒåº¦ g </span></span><br><span class="line">    <span class="keyword">if</span> _p_ !=<span class="literal">nil</span>&#123;</span><br><span class="line">        acquirep(_p_)</span><br><span class="line">        execute(gp,<span class="literal">false</span>)<span class="comment">// Never returns.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// ä¸ p ç»“åˆå¤±è´¥çš„è¯ï¼Œéœ€è¦å°†å½“å‰ m æ·»åŠ åˆ° schedt çš„ midle é˜Ÿåˆ—å¹¶åœæ­¢ m</span></span><br><span class="line">    stopm()</span><br><span class="line">    <span class="comment">// å¦‚æœ m è¢«é‡æ–°å¯ç”¨ï¼Œåˆ™å‘èµ·æ–°ä¸€è½®è°ƒåº¦</span></span><br><span class="line">    schedule()<span class="comment">// Never returns.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_20.png" alt="image_20.png"></p>
<p>æˆ‘ä»¬å°†è§†è§’åˆ‡å›åˆ° sysmon thread ä¸­çš„ retake æ–¹æ³•ï¼Œæ­¤å¤„ä¼šéå†æ¯ä¸ª pï¼Œå¹¶é’ˆå¯¹æ­£åœ¨å‘èµ·ç³»ç»Ÿè°ƒç”¨çš„ p æ‰§è¡Œå¦‚ä¸‹æ£€æŸ¥é€»è¾‘ï¼š</p>
<ul>
<li>æ£€æŸ¥ p çš„ lrq ä¸­æ˜¯å¦å­˜åœ¨ç­‰å¾…æ‰§è¡Œçš„ g</li>
<li>æ£€æŸ¥ p çš„ syscall æ—¶é•¿æ˜¯å¦ &gt;= 10ms</li>
</ul>
<p>ä½†å‡¡ä¸Šè¿°æ¡ä»¶æ»¡è¶³å…¶ä¸€ï¼Œå°±ä¼šæ‰§è¡Œå¯¹ p æ‰§è¡ŒæŠ¢å æ“ä½œï¼ˆhandoffpï¼‰â€”â€”åˆ†é…ä¸€ä¸ªæ–°çš„ m ä¸ p ç»“åˆï¼Œå®Œæˆåç»­ä»»åŠ¡çš„è°ƒåº¦å¤„ç†.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">retake</span><span class="params">(now <span class="type">int64</span>)</span></span> <span class="type">uint32</span>&#123;</span><br><span class="line">    n :=<span class="number">0</span></span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    lock(&amp;allpLock)</span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰ p</span></span><br><span class="line">    <span class="keyword">for</span> i :=<span class="number">0</span>; i &lt;<span class="built_in">len</span>(allp); i++&#123;</span><br><span class="line">        _p_ := allp[i]</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        s := _p_.status</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// å¯¹äºæ­£åœ¨æ‰§è¡Œ syscall çš„ p</span></span><br><span class="line">        <span class="keyword">if</span> s ==_Psyscall&#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ p æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºä¸”å‘èµ·ç³»ç»Ÿè°ƒç”¨æ—¶é—´ &lt; 10msï¼Œåˆ™ä¸è¿›è¡ŒæŠ¢å </span></span><br><span class="line">            <span class="keyword">if</span> runqempty(_p_)&amp;&amp; atomic.Load(&amp;sched.nmspinning)+atomic.Load(&amp;sched.npidle)&gt;<span class="number">0</span>&amp;&amp; pd.syscallwhen+<span class="number">10</span>*<span class="number">1000</span>*<span class="number">1000</span>&gt; now &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            unlock(&amp;allpLock)</span><br><span class="line">            <span class="comment">// å°† p çš„çŠ¶æ€ç”± syscall æ›´æ–°ä¸º idle</span></span><br><span class="line">            <span class="keyword">if</span> atomic.Cas(&amp;_p_.status, s,_Pidle)&#123;</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">                <span class="comment">// è®© p æ‹¥æœ‰å’Œå…¶ä»– m ç»“åˆçš„æœºä¼š</span></span><br><span class="line">                handoffp(_p_)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            lock(&amp;allpLock)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    unlock(&amp;allpLock)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">uint32</span>(n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handoffp</span><span class="params">(_p_ *p)</span></span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ p lrq ä¸­è¿˜æœ‰ g æˆ–è€…å…¨å±€é˜Ÿåˆ— grq ä¸­è¿˜æœ‰ gï¼Œåˆ™ç«‹å³åˆ†é…ä¸€ä¸ªæ–° m ä¸è¯¥ p ç»“åˆ</span></span><br><span class="line">    <span class="keyword">if</span>!runqempty(_p_)|| sched.runqsize !=<span class="number">0</span>&#123;</span><br><span class="line">        <span class="comment">// åˆ†é…ä¸€ä¸ª m ä¸ p ç»“åˆ</span></span><br><span class="line">        startm(_p_,<span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è‹¥ç³»ç»Ÿç©ºé—²æ²¡æœ‰ g éœ€è¦è°ƒåº¦ï¼Œåˆ™å°† p æ·»åŠ åˆ° schedt ä¸­çš„ç©ºé—² p é˜Ÿåˆ— pidle ä¸­</span></span><br><span class="line">    pidleput(_p_,<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-3-è¿è¡Œè¶…æ—¶">5.3 è¿è¡Œè¶…æ—¶</h3>
<p>é™¤äº†ç³»ç»Ÿè°ƒç”¨æŠ¢å ä¹‹å¤–ï¼Œå½“ sysmon thread å‘ç°æŸä¸ª g æ‰§è¡Œæ—¶é—´è¿‡é•¿æ—¶ï¼Œä¹Ÿä¼šå¯¹å…¶å‘èµ·æŠ¢å æ“ä½œ.</p>
<p>1ï¼‰å‘èµ·æŠ¢å </p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_21.png" alt="image_21.png"></p>
<p>åœ¨ retake æ–¹æ³•ä¸­ï¼Œä¼šæ£€æµ‹åˆ°å“ªäº› p ä¸­è¿è¡Œä¸€ä¸ª g çš„æ—¶é•¿è¶…è¿‡äº† 10 msï¼Œç„¶åå¯¹å…¶å‘èµ·æŠ¢å æ“ä½œï¼ˆpreemtoneï¼‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">retake</span><span class="params">(now <span class="type">int64</span>)</span></span> <span class="type">uint32</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">for</span> i :=<span class="number">0</span>; i &lt;<span class="built_in">len</span>(allp); i++&#123;</span><br><span class="line">        _p_ := allp[i]</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">if</span> s ==_Prunning&#123;</span><br><span class="line">            <span class="comment">// ... </span></span><br><span class="line">            <span class="comment">// å¦‚æœæŸä¸ª p ä¸‹å­˜åœ¨è¿è¡Œè¶…è¿‡ 10 ms çš„ g ï¼Œéœ€è¦å¯¹ g è¿›è¡ŒæŠ¢å </span></span><br><span class="line">            <span class="keyword">if</span> pd.schedwhen+forcePreemptNS &lt;= now&#123;</span><br><span class="line">                   preemptone(_p_)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ preemtone æ–¹æ³•ä¸­ï¼š</p>
<ul>
<li>ä¼šå¯¹ç›®æ ‡ g è®¾ç½®æŠ¢å æ ‡è¯†ï¼ˆå°† stackguard0 æ ‡è¯†è®¾ç½®ä¸º stackPreemptï¼‰ï¼Œè¿™æ ·å½“ g è¿è¡Œåˆ°æ£€æŸ¥ç‚¹æ—¶ï¼Œå°±ä¼šé…åˆæŠ¢å æ„å›¾ï¼Œè‡ªè§‰å®Œæˆè®©æ¸¡æ“ä½œ</li>
<li>ä¼šå¯¹ç›®æ ‡ g æ‰€åœ¨çš„ m å‘é€æŠ¢å ä¿¡å· sigPreemptï¼Œé€šè¿‡æ”¹å†™ g ç¨‹åºè®¡æ•°å™¨ï¼ˆpcï¼Œprogram counterï¼‰çš„æ–¹å¼å°† g é€¼åœ</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŠ¢å æŒ‡å®š p ä¸Šæ­£åœ¨æ‰§è¡Œçš„ g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">preemptone</span><span class="params">(_p_ *p)</span></span><span class="type">bool</span>&#123;</span><br><span class="line">    <span class="comment">// è·å– p å¯¹åº” m</span></span><br><span class="line">    mp := _p_.m.ptr()</span><br><span class="line">    <span class="comment">// è·å– p ä¸Šæ­£åœ¨æ‰§è¡Œçš„ gï¼ˆæŠ¢å ç›®æ ‡ï¼‰</span></span><br><span class="line">    gp := mp.curg</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            å¯åŠ¨åä½œå¼æŠ¢å æ ‡è¯†</span></span><br><span class="line"><span class="comment">            1) å°†æŠ¢å æ ‡è¯† preempt ç½®ä¸º true</span></span><br><span class="line"><span class="comment">            2ï¼‰å°† g ä¸­çš„ stackguard0 æ ‡è¯†ç½®ä¸º stackPreempt</span></span><br><span class="line"><span class="comment">            3ï¼‰g æŸ¥çœ‹åˆ°æŠ¢å æ ‡è¯†åï¼Œä¼šé…åˆä¸»åŠ¨è®©æ¸¡ p è°ƒåº¦æƒ</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    gp.preempt =<span class="literal">true</span></span><br><span class="line">    gp.stackguard0 = stackPreempt</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºäºä¿¡å·æœºåˆ¶å®ç°éåä½œå¼æŠ¢å </span></span><br><span class="line">    <span class="keyword">if</span> preemptMSupported &amp;&amp; debug.asyncpreemptoff ==<span class="number">0</span>&#123;</span><br><span class="line">        _p_.preempt =<span class="literal">true</span></span><br><span class="line">        preemptM(mp)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ preemptM æ–¹æ³•ä¸­ï¼Œä¼šé€šè¿‡ tkill æŒ‡ä»¤å‘è¿›ç¨‹ä¸­çš„æŒ‡å®š thread å‘é€æŠ¢å ä¿¡å· sigPreemptï¼Œå¯¹åº”ä»£ç ä½äº runtime/signal_unix.goï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">preemptM</span><span class="params">(mp *m)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span> atomic.Cas(&amp;mp.signalPending,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> GOOS ==<span class="string">&quot;darwin&quot;</span>|| GOOS ==<span class="string">&quot;ios&quot;</span>&#123;</span><br><span class="line">            atomic.Xadd(&amp;pendingPreemptSignals,<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘æŒ‡å®šçš„ m å‘é€æŠ¢å ä¿¡å·</span></span><br><span class="line">        <span class="comment">// const sigPreempt untyped int = 16</span></span><br><span class="line">        signalM(mp, sigPreempt)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">signalM</span><span class="params">(mp *m, sig <span class="type">int</span>)</span></span>&#123;</span><br><span class="line">    pthread_kill(pthread(mp.procid),<span class="type">uint32</span>(sig))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ï¼‰åä½œå¼æŠ¢å </p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_22.png" alt="image_22.png"></p>
<p>å¯¹äºè¿è¡Œä¸­çš„ gï¼Œåœ¨æ ˆç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šåˆ‡æ¢è‡³ g0 è°ƒç”¨ newstack æ–¹æ³•æ‰§è¡Œæ ˆç©ºé—´æ‰©å¼ æ“ä½œï¼Œåœ¨è¯¥æµç¨‹ä¸­é¢„ç•™äº†ä¸€ä¸ªæ£€æŸ¥æ¡©ç‚¹ï¼Œå½“å…¶ä¸­å‘ç° g å·²ç»è¢«æ‰“ä¸ŠæŠ¢å æ ‡è®°æ—¶ï¼Œå°±ä¼šä¸»åŠ¨é…åˆæ‰§è¡Œè®©æ¸¡æ“ä½œï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ˆæ‰©å¼ . æ‰§è¡Œæ–¹ä¸º g0</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newstack</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è·å–å½“å‰ m æ­£åœ¨æ‰§è¡Œçš„ g</span></span><br><span class="line">    gp := thisg.m.curg</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// è¯»å– g ä¸­çš„ stackguard0 æ ‡è¯†ä½</span></span><br><span class="line">    stackguard0 := atomic.Loaduintptr(&amp;gp.stackguard0)</span><br><span class="line">    <span class="comment">// è‹¥ stackguard0 æ ‡è¯†ä½è¢«ç½®ä¸º stackPreemptï¼Œåˆ™ä»£è¡¨éœ€è¦å¯¹ g è¿›è¡ŒæŠ¢å </span></span><br><span class="line">    preempt := stackguard0 == stackPreempt</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span> preempt&#123;</span><br><span class="line">        <span class="comment">// è‹¥å½“å‰ g ä¸å…·å¤‡æŠ¢å æ¡ä»¶ï¼Œåˆ™ç»§ç»­è°ƒåº¦ï¼Œä¸è¿›è¡ŒæŠ¢å </span></span><br><span class="line">        <span class="comment">// å½“æŒæœ‰é”ã€åœ¨è¿›è¡Œå†…å­˜åˆ†é…æˆ–è€…æ˜¾å¼ç¦ç”¨æŠ¢å æ¨¡å¼æ—¶ï¼Œåˆ™ä¸å…è®¸å¯¹ g æ‰§è¡ŒæŠ¢å æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span>!canPreemptM(thisg.m)&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            gogo(&amp;gp.sched)<span class="comment">// never return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> preempt &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å“åº”æŠ¢å æ„å›¾ï¼Œå®Œæˆè®©æ¸¡æ“ä½œ</span></span><br><span class="line">        gopreempt_m(gp)<span class="comment">// never return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// gopreempt_m æ–¹æ³•ä¼šèµ°åˆ° goschedImpl æ–¹æ³•ä¸­ï¼Œåç»­æµç¨‹ä¸ 4.2 å°èŠ‚ä¸­ä»‹ç»çš„ä¸»åŠ¨è®©æ¸¡ç±»ä¼¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gopreempt_m</span><span class="params">(gp *g)</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    goschedImpl(gp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goschedImpl</span><span class="params">(gp *g)</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    casgstatus(gp,_Grunning,_Grunnable)</span><br><span class="line">    dropg()</span><br><span class="line">    lock(&amp;sched.lock)</span><br><span class="line">    globrunqput(gp)</span><br><span class="line">    unlock(&amp;sched.lock)</span><br><span class="line"></span><br><span class="line">    schedule()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§é€šè¿‡é¢„ç•™æ£€æŸ¥ç‚¹ï¼Œç”± g ä¸»åŠ¨é…åˆæŠ¢å æ„å›¾å®Œæˆè®©æ¸¡æ“ä½œçš„æµç¨‹è¢«ç§°ä½œåä½œå¼æŠ¢å ï¼Œå…¶å­˜åœ¨çš„å±€é™å°±åœ¨äºï¼Œå½“ g æœªå‘ç”Ÿæ ˆæ‰©å¼ è¡Œä¸ºæ—¶ï¼Œåˆ™æ²¡æœ‰è§¦ç¢°åˆ°æ£€æŸ¥ç‚¹çš„æœºä¼šï¼Œä¹Ÿå°±æ— æ³•å“åº”æŠ¢å æ„å›¾.</p>
<p>3ï¼‰éåä½œå¼æŠ¢å </p>
<p><img src="/2026/01/18/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0-Golang-GMP-%E4%B8%87%E5%AD%97%E6%B4%97%E9%AB%93%E7%BB%8F/image_23.png" alt="image_23.png"></p>
<p>ä¸ºäº†å¼¥è¡¥åä½œå¼æŠ¢å çš„ä¸è¶³ï¼Œgo 1.14 ä¸­å¼•å…¥äº†åŸºäºä¿¡å·é‡å®ç°çš„éåä½œå¼æŠ¢å æœºåˆ¶.</p>
<p>åœ¨ go ç¨‹åºå¯åŠ¨æ—¶ï¼Œmain thread ä¼šå®Œæˆå¯¹å„ç±»ä¿¡å·é‡çš„ç›‘å¬æ³¨å†Œï¼Œå…¶ä¸­ä¹ŸåŒ…å«äº†æŠ¢å ä¿¡å· sigPreemptï¼ˆindex = 16ï¼‰. å¯¹åº”ä»£ç ä½äº runtime/signal_unix.goï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initsig</span><span class="params">(preinit <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i :=<span class="type">uint32</span>(<span class="number">0</span>); i &lt; _NSIG; i++&#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    var sigtable = [...]sigTabT&#123;</span></span><br><span class="line"><span class="comment">                    // ...</span></span><br><span class="line"><span class="comment">                    // 16 &#123;_SigNotify + _SigIgn, &quot;SIGURG: urgent condition on socket&quot;&#125;,</span></span><br><span class="line"><span class="comment">                    // ...</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">        t :=&amp;sigtable[i]</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// const _NSIG untyped int = 32</span></span><br><span class="line">        handlingSig[i]=<span class="number">1</span></span><br><span class="line">        setsig(i, abi.FuncPCABIInternal(sighandler))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æŸä¸ª m æ¥æ”¶åˆ°æŠ¢å ä¿¡å·åï¼Œä¼šç”± gsignal é€šè¿‡ sighandler æ–¹æ³•å®Œæˆä¿¡å·å¤„ç†å·¥ä½œï¼Œæ­¤æ—¶é’ˆå¯¹æŠ¢å ä¿¡å·ä¼šè¿›ä¸€æ­¥è°ƒç”¨ doSigPreempt æ–¹æ³•ï¼šåœ¨åˆ¤æ–­ g å…·å¤‡å¯æŠ¢å æ¡ä»¶åï¼Œåˆ™ä¼šä¿å­˜ g çš„å¯„å­˜å™¨ä¿¡æ¯ï¼Œç„¶åä¿®æ”¹ g çš„æ ˆç¨‹åºè®¡æ•°å™¨ pc å’Œæ ˆé¡¶æŒ‡é’ˆ spï¼Œå¾€å…¶ä¸­æ’å…¥ä¸€æ®µå‡½æ•° asyncPreemptï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œè¯¥æ–¹æ³•çš„æ˜¯æŠ¢å ç›®æ ‡ g æ‰€åœ¨ m ä¸‹çš„ gsignal</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sighandler</span><span class="params">(sig <span class="type">uint32</span>, info *siginfo, ctxt unsafe.Pointer, gp *g)</span></span>&#123;</span><br><span class="line">    <span class="comment">// è·å–æ‹ŸæŠ¢å  g ä»å± p å¯¹åº”çš„ g0</span></span><br><span class="line">    _g_ := getg()</span><br><span class="line">    c :=&amp;sigctxt&#123;info, ctxt&#125;</span><br><span class="line">    <span class="comment">// è·å–æ‹ŸæŠ¢å  g ä»å±çš„ m</span></span><br><span class="line">    mp := _g_.m</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å€˜è‹¥æ¥æ”¶åˆ°æŠ¢å ä¿¡å· </span></span><br><span class="line">    <span class="keyword">if</span> sig == sigPreempt &amp;&amp; debug.asyncpreemptoff ==<span class="number">0</span>&amp;&amp;!delayedSignal &#123;</span><br><span class="line">    <span class="comment">// å¯¹ç›®æ ‡ g è¿›è¡ŒæŠ¢å </span></span><br><span class="line">        doSigPreempt(gp, c)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œè¯¥æ–¹æ³•çš„æ˜¯æŠ¢å ç›®æ ‡ g æ‰€åœ¨ m ä¸‹çš„ gsignal</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doSigPreempt</span><span class="params">(gp *g, ctxt *sigctxt)</span></span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ g æ˜¯å¦éœ€è¦è¢«æŠ¢å </span></span><br><span class="line">    <span class="keyword">if</span> wantAsyncPreempt(gp)&#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ g æ˜¯å¦æ»¡è¶³æŠ¢å æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> ok, newpc := isAsyncSafePoint(gp, ctxt.sigpc(), ctxt.sigsp(), ctxt.siglr()); ok &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡ä¿®æ”¹ g å¯„å­˜å™¨çš„æ–¹å¼ï¼Œå¾€ g çš„æ‰§è¡ŒæŒ‡ä»¤ä¸­æ’å…¥ asyncPreempt å‡½æ•°</span></span><br><span class="line">            ctxt.pushCall(abi.FuncPCABI0(asyncPreempt), newpc)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sigctxt.pushCall æ–¹æ³•ä¸­ï¼Œé€šè¿‡ç§»åŠ¨æ ˆé¡¶æŒ‡é’ˆï¼ˆspï¼Œstack pointerï¼‰ã€ä¿®æ”¹ç¨‹åºè®¡æ•°å™¨ï¼ˆpcï¼Œprogram counterï¼‰çš„æ–¹å¼ï¼Œå¼ºè¡Œåœ¨ g çš„æ‰§è¡ŒæŒ‡ä»¤ä¸­æ’å…¥äº†ä¸€æ®µæ–°çš„æŒ‡ä»¤â€”â€”asyncPreempt å‡½æ•°.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œè¯¥æ–¹æ³•çš„æ˜¯æŠ¢å ç›®æ ‡ g æ‰€åœ¨ m ä¸‹çš„ gsignal</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *sigctxt)</span></span> pushCall(targetPC, resumePC <span class="type">uintptr</span>)&#123;</span><br><span class="line">    <span class="comment">// è·å–æ ˆé¡¶æŒ‡é’ˆ sp</span></span><br><span class="line">    sp :=<span class="type">uintptr</span>(c.rsp())</span><br><span class="line">    <span class="comment">// sp åç§»ä¸€ä¸ªæŒ‡é’ˆåœ°å€</span></span><br><span class="line">    sp -= goarch.PtrSize</span><br><span class="line">    <span class="comment">// å°†åŸæœ¬ä¸‹ä¸€æ¡æ‰§è¡ŒæŒ‡ä»¤ pc å­˜æ”¾åœ¨æ ˆé¡¶ä½ç½®</span></span><br><span class="line">    *(*<span class="type">uintptr</span>)(unsafe.Pointer(sp))= resumePC</span><br><span class="line">    <span class="comment">// æ›´æ–°æ ˆé¡¶æŒ‡é’ˆ sp</span></span><br><span class="line">    c.set_rsp(<span class="type">uint64</span>(sp))</span><br><span class="line">    <span class="comment">// å°†ä¼ å…¥çš„æŒ‡ä»¤ï¼ˆasyncPreemtï¼‰ä½œä¸ºä¸‹ä¸€è·³æ‰§è¡Œæ‰§è¡Œ pc</span></span><br><span class="line">    c.set_rip(<span class="type">uint64</span>(targetPC))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äº pc è¢«ä¿®æ”¹äº†ï¼Œæ‰€ä»¥æŠ¢å çš„ç›®æ ‡ g éšåä¼šæ‰§è¡Œåˆ° asyncPreemt2 æ–¹æ³•ï¼Œå…¶ä¸­ä¼šé€šè¿‡ mcall æŒ‡ä»¤åˆ‡æ¢è‡³ g0ï¼Œå¹¶ç”± g0 æ‰§è¡Œ gopreempt_m ç©æ³•ï¼Œå®Œæˆ g çš„è®©æ¸¡æ“ä½œï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ—¶æ‰§è¡Œæ–¹æ˜¯å³å°†è¦è¢«æŠ¢å çš„ gï¼Œè¿™æ®µä»£ç æ˜¯è¢«ä¸´æ—¶æ’å…¥çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">asyncPreempt2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    gp := getg()</span><br><span class="line">    gp.asyncSafePoint = <span class="literal">true</span></span><br><span class="line">    mcall(gopreempt_m)</span><br><span class="line">    gp.asyncSafePoint = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-æ€»ç»“">6 æ€»ç»“</h2>
<p>ç¥è´ºï¼Œè‡³æ­¤å…¨æ–‡ç»“æŸ.</p>
<p>æœ¬ç¯‡æˆ‘ä»¬ä¸€èµ·äº†è§£äº† golang ä¸­çš„ gmp æ•´ä½“æ¶æ„ä¸åº”ç”¨ç”Ÿæ€ï¼Œå¹¶æ·±å…¥åˆ°æºç ä¸­é€å¸§è§£æäº† gmp ä¸­çš„æ ¸å¿ƒç»“æ„ä¸æ‰§è¡Œæµç¨‹è®¾è®¡. å¸Œæœ›ä¸Šè¿°å†…å®¹èƒ½å¯¹å„ä½ go å‹ä»¬æœ‰æ‰€å¸®åŠ©~</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>GMP</category>
      </categories>
      <tags>
        <tag>Goè¯­è¨€</tag>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
        <tag>Goroutine</tag>
        <tag>è°ƒåº¦å™¨</tag>
        <tag>GMP</tag>
      </tags>
  </entry>
  <entry>
    <title>å­—èŠ‚è·³åŠ¨ åç«¯å¼€å‘å·¥ç¨‹å¸ˆ ä¸€é¢</title>
    <url>/2025/08/03/%E9%9D%A2%E8%AF%95%E9%A2%98/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E5%8E%82/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8/2025-08-03-%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%80%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="é¢è¯•åŸºæœ¬ä¿¡æ¯">é¢è¯•åŸºæœ¬ä¿¡æ¯</h2>
<ul>
<li><strong>å…¬å¸</strong>: å­—èŠ‚è·³åŠ¨ï¼ˆäº’è”ç½‘å¤§å‚ï¼‰</li>
<li><strong>èŒä½</strong>: åç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼ˆæŠ–éŸ³ç”Ÿæ´»æœåŠ¡å¹³å°æ²»ç†ï¼‰</li>
<li><strong>é¢è¯•è½®æ¬¡</strong>: ä¸€é¢ï¼ˆæŠ€æœ¯é¢ï¼‰</li>
<li><strong>é¢è¯•å½¢å¼</strong>: çº¿ä¸Šè§†é¢‘é¢è¯•</li>
<li><strong>é¢è¯•æ—¶é•¿</strong>: çº¦53åˆ†é’Ÿ</li>
<li><strong>é¢è¯•å®˜</strong>: æŠ€æœ¯leaderï¼Œè´Ÿè´£å¹³å°æ²»ç†ä¸šåŠ¡</li>
</ul>
<h2 id="é¢è¯•é—®é¢˜ä¸å›ç­”">é¢è¯•é—®é¢˜ä¸å›ç­”</h2>
<h3 id="é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»">é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå…ˆç®€å•è‡ªæˆ‘ä»‹ç»ä¸€ä¸‹â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä½ å¥½ï¼Œæˆ‘æ˜¯ç‹å®‡å“²ï¼Œæ¥è‡ªåä¸œå¸ˆèŒƒå¤§å­¦çš„è½¯ä»¶å·¥ç¨‹ç¡•å£«ã€‚æˆ‘è€ƒç ”çš„è¯æ˜¯æ’70äººä¸­æ’åç¬¬äºŒï¼Œæœ¬ç§‘çš„è¯æ˜¯ä¸“ä¸šæ’åç¬¬ä¸€ï¼Œè·å¾—è¿‡å›½å®¶å¥–å­¦é‡‘ä»¥åŠè“æ¡¥æ¯å›½èµ›äºŒç­‰å¥–ä¹‹ç±»çš„è£èª‰ã€‚æˆ‘ç®€å†ä¸Šçš„è¯ä¸»è¦çš„é¡¹ç›®éƒ½æ˜¯åŸºäºGoè¯­è¨€å»æ„å»ºçš„åˆ†å¸ƒå¼åº”ç”¨â€¦â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å…¶å®è‡ªæˆ‘ä»‹ç»å¯ä»¥æ›´ç®€æ´æœ‰åŠ›ä¸€äº›ã€‚å¯ä»¥è¿™æ ·å›ç­”ï¼š</p>
<p>&quot;ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹å®‡å“²ï¼Œåä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹ç¡•å£«åœ¨è¯»ã€‚åœ¨æ ¡æœŸé—´æˆç»©ä¼˜ç§€ï¼Œè·å¾—è¿‡å›½å®¶å¥–å­¦é‡‘å’Œè“æ¡¥æ¯å›½èµ›äºŒç­‰å¥–ã€‚ä¸»è¦æŠ€æœ¯æ ˆæ˜¯Goè¯­è¨€ï¼Œæœ‰ä¸°å¯Œçš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘ç»éªŒã€‚</p>
<p>æˆ‘çš„é¡¹ç›®ç»å†åŒ…æ‹¬ï¼š</p>
<ol>
<li>ç‹¬ç«‹å¼€å‘çš„åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼Œå•èŠ‚ç‚¹æ€§èƒ½è¶…è¿‡5000QPS</li>
<li>å­—èŠ‚è·³åŠ¨é’è®­è¥çš„æŠ–éŸ³å•†åŸå¾®æœåŠ¡é¡¹ç›®ï¼Œæ‹…ä»»é˜Ÿé•¿</li>
<li>ç›®å‰åœ¨ä¸Šæµ·äººå·¥æ™ºèƒ½å®éªŒå®¤å®ä¹ ï¼Œå‚ä¸å¼€æºé¡¹ç›®å¼€å‘</li>
</ol>
<p>å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿã€ç¼“å­˜æœºåˆ¶ã€å¾®æœåŠ¡æ¶æ„éƒ½æœ‰è¾ƒæ·±çš„ç†è§£ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æ¯”è¾ƒè¯¦ç»†ï¼Œä½†å¯ä»¥æ›´ç»“æ„åŒ–</li>
<li>é¢è¯•å®˜è€å¿ƒå¬å®Œï¼Œæ²¡æœ‰æ‰“æ–­</li>
<li>åº”è¯¥çªå‡ºæŠ€æœ¯æ ˆå’Œæ ¸å¿ƒé¡¹ç›®</li>
</ul>
<h3 id="é—®é¢˜2ï¼šé¡¹ç›®ç»å†è¯¦ç»†è¯¢é—®">é—®é¢˜2ï¼šé¡¹ç›®ç»å†è¯¦ç»†è¯¢é—®</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œèƒ½ç¨å¾®è®²ä¸€ä¸‹åœ¨äººå·¥æ™ºèƒ½å®éªŒå®¤é‡Œé¢åšçš„é‚£ä¸ªé¡¹ç›®æ˜¯å¹²ä»€ä¹ˆå‘¢ï¼Ÿä»–è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œç„¶åæˆ‘åšçš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè¿™ä¸ªé¡¹ç›®çš„è¯ï¼Œç›®å‰å®ƒå…¶å®ä¹Ÿåœ¨ä¸€ä¸ªæ¢ç´¢åœºæ™¯çš„é˜¶æ®µã€‚ç„¶åå®ƒèƒ½æƒ³åˆ°æœ€å¸¸è§çš„åœºæ™¯ï¼Œå°±æ˜¯ç°åœ¨å¾ˆå¤šäººéœ€è¦åšè‡ªå·±çš„RAGå‘é‡æ•°æ®åº“ã€‚ä½†æ˜¯é‚£ä¸ªæ•°æ®åº“åšåˆ‡ç‰‡ä»€ä¹ˆçš„ï¼Œå…¶å®ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ç”¨markdownå»åšã€‚å°±æ˜¯ç”¨markdownè¿™ä¸ªæ–‡ä»¶å»åšæ•°æ®åˆ†ç‰‡ä»€ä¹ˆçš„ä¼šæ¯”è¾ƒå¥½ä¸€äº›ã€‚ä½†æ˜¯å¤§å¤šæ•°äººæ‰‹ä¸Šçš„å…¶å®éƒ½æ˜¯PDFæ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬çš„è¯æ˜¯å¯ä»¥æŠŠPDFè½¬åŒ–æˆmarkdownâ€¦â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé—®é¢˜å›ç­”å¯ä»¥æ›´æ¸…æ™°ä¸€äº›ï¼š</p>
<p>&quot;æˆ‘ä»¬åšçš„æ˜¯ä¸€ä¸ªPDFè½¬Markdownçš„å·¥å…·ï¼Œä¸»è¦è§£å†³AIæ—¶ä»£çš„æ–‡æ¡£å¤„ç†é—®é¢˜ã€‚</p>
<p>èƒŒæ™¯æ˜¯è¿™æ ·çš„ï¼šç°åœ¨å¾ˆå¤šäººéœ€è¦æ„å»ºè‡ªå·±çš„å‘é‡æ•°æ®åº“æ¥åšRAGåº”ç”¨ï¼Œä½†å¤§å¤šæ•°äººçš„åŸå§‹æ–‡æ¡£éƒ½æ˜¯PDFæ ¼å¼ã€‚è€Œå‘é‡æ•°æ®åº“çš„åˆ‡ç‰‡å¤„ç†ï¼Œç”¨Markdownæ ¼å¼ä¼šæ›´åˆé€‚ã€‚</p>
<p>æˆ‘ä»¬çš„é¡¹ç›®å¯ä»¥ï¼š</p>
<ol>
<li>å°†PDFè½¬æ¢ä¸ºMarkdownæ ¼å¼</li>
<li>ä¿ç•™å®Œæ•´çš„å›¾ç‰‡å’Œè¡¨æ ¼ç»“æ„</li>
<li>ç²¾å‡†è¯†åˆ«LaTeXæ•°å­¦å…¬å¼</li>
<li>æ”¯æŒå¤æ‚è¡¨æ ¼çš„è·¨è¡Œè·¨åˆ—è¯†åˆ«</li>
</ol>
<p>æˆ‘åœ¨å…¶ä¸­ä¸»è¦è´Ÿè´£åç«¯å¼€å‘ï¼ŒåŒ…æ‹¬æ¨¡å‹éƒ¨ç½²ã€å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ã€æ€§èƒ½ä¼˜åŒ–ç­‰å·¥ä½œã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æ¯”è¾ƒå£è¯­åŒ–ï¼Œé€»è¾‘ä¸å¤Ÿæ¸…æ™°</li>
<li>é¢è¯•å®˜ç»§ç»­è¿½é—®äº†æŠ€æœ¯ç»†èŠ‚</li>
<li>åº”è¯¥å…ˆè¯´æ˜èƒŒæ™¯ï¼Œå†ä»‹ç»è§£å†³æ–¹æ¡ˆ</li>
</ul>
<h3 id="é—®é¢˜3ï¼šMySQLç´¢å¼•æ•°æ®ç»“æ„">é—®é¢˜3ï¼šMySQLç´¢å¼•æ•°æ®ç»“æ„</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ è¿™è¾¹äº†è§£è¿‡mysqlç´¢å¼•çš„æ•°æ®ç»“æ„å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œMySQLç´¢å¼•çš„æ•°æ®ç»“æ„çš„è¯ä¸»è¦å°±æ˜¯B+æ ‘ã€‚ç„¶åå¦‚æœè¯´å®ƒçš„å¼•æ“æ˜¯å“ˆå¸Œçš„è¯ï¼Œå®ƒçš„æ•°æ®ç»“æ„å°±æ˜¯å“ˆå¸Œè¡¨ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥å›ç­”å¾—æ›´å…¨é¢ï¼š</p>
<p>&quot;MySQLçš„ç´¢å¼•æ•°æ®ç»“æ„ä¸»è¦æœ‰ä¸¤ç§ï¼š</p>
<ol>
<li>
<p><strong>B+æ ‘ç´¢å¼•</strong>ï¼šè¿™æ˜¯InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•ç»“æ„ï¼Œä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ã€‚B+æ ‘çš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åº</li>
<li>é€‚åˆé¢‘ç¹çš„å¢åˆ æ”¹æŸ¥æ“ä½œ</li>
<li>æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦æ˜¯O(log n)</li>
</ul>
</li>
<li>
<p><strong>å“ˆå¸Œç´¢å¼•</strong>ï¼šä¸»è¦ç”¨äºMemoryå­˜å‚¨å¼•æ“ï¼Œç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æŸ¥è¯¢é€Ÿåº¦æå¿«ï¼Œæ—¶é—´å¤æ‚åº¦O(1)</li>
<li>åªæ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</li>
<li>é€‚åˆåªæœ‰æ’å…¥å’ŒæŸ¥è¯¢çš„åœºæ™¯</li>
</ul>
</li>
</ol>
<p>å®é™…åº”ç”¨ä¸­ï¼ŒB+æ ‘ç´¢å¼•æ›´é€šç”¨ï¼Œå› ä¸ºå¤§å¤šæ•°ä¸šåŠ¡éƒ½éœ€è¦æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åºæ“ä½œã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æ¯”è¾ƒåŸºç¡€ï¼Œæ²¡æœ‰æ·±å…¥åˆ†æ</li>
<li>é¢è¯•å®˜ç»§ç»­è¿½é—®äº†ä¼˜åŠ£åŠ¿å¯¹æ¯”</li>
<li>åº”è¯¥å‡†å¤‡æ›´è¯¦ç»†çš„åº”ç”¨åœºæ™¯åˆ†æ</li>
</ul>
<h3 id="é—®é¢˜4ï¼šå“ˆå¸Œç´¢å¼•çš„ä¼˜åŒ–">é—®é¢˜4ï¼šå“ˆå¸Œç´¢å¼•çš„ä¼˜åŒ–</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œé‚£å¦‚æœè¯´è®©ä½ ä¼˜åŒ–çš„è¯ï¼Œä½ è§‰ä½ ä¼šæ€ä¹ˆä¼˜åŒ–è¿™ä¸ªåœ°æ–¹ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè®©æˆ‘ä¼˜åŒ–çš„è¯ï¼Œæˆ‘å¯èƒ½ä¼šæŠŠå“ˆå¸Œè·Ÿå…¶ä»–æ•°æ®ç»“æ„ç»“åˆåœ¨ä¸€èµ·ã€‚å°±æ¯”å¦‚è¯´å“ˆå¸Œä¸‹é¢è¿ä¸€æ£µæ ‘ï¼ŒæŠŠé“¾è¡¨æ”¹æˆæ ‘ï¼Œè¿™ç§æ ‘çš„è¯å°±æ¯”è¾ƒæ–¹ä¾¿å®šä½åˆ°æ•°æ®ï¼Œå°±æ¯”è¾ƒå¥½åˆ é™¤ã€‚æ¯”å¦‚è¯´è¿ä¸ªä»€ä¹ˆB+æ ‘ä»€ä¹ˆçš„ã€‚ä½†æ˜¯çš„è¯ï¼Œå¯¹å“ˆå¸Œè·ŸB+æ ‘æœ€å¤§çš„ä¼˜ç¼ºç‚¹åœ¨äºå“ˆå¸Œæˆ‘æ„Ÿè§‰å®ƒæ˜¯æ›´é€‚åˆç”¨äºå†…å­˜å‹æ•°æ®åº“çš„ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥å›ç­”å¾—æ›´å…·ä½“ä¸€äº›ï¼š</p>
<p>&quot;å¦‚æœè¦ä¼˜åŒ–å“ˆå¸Œç´¢å¼•çš„åˆ é™¤æ€§èƒ½ï¼Œæˆ‘è€ƒè™‘å‡ ç§æ–¹æ¡ˆï¼š</p>
<ol>
<li>
<p><strong>å“ˆå¸Œ+çº¢é»‘æ ‘</strong>ï¼šå°†å“ˆå¸Œå†²çªçš„é“¾è¡¨æ”¹ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ä»O(n)é™åˆ°O(log n)</p>
</li>
<li>
<p><strong>è®¡æ•°å“ˆå¸Œ</strong>ï¼šåœ¨å“ˆå¸Œè¡¨ä¸­å­˜å‚¨è®¡æ•°å™¨è€Œä¸æ˜¯å¸ƒå°”å€¼ï¼Œè¿™æ ·å¯ä»¥æ”¯æŒåˆ é™¤æ“ä½œ</p>
</li>
<li>
<p><strong>åˆ†å±‚è®¾è®¡</strong>ï¼šå°†çƒ­ç‚¹æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œå†·æ•°æ®æ”¾åœ¨ç£ç›˜ä¸Š</p>
</li>
</ol>
<p>ä½†æ˜¯å“ˆå¸Œç´¢å¼•æœ€å¤§çš„é—®é¢˜æ˜¯å®ƒåªé€‚åˆå†…å­˜æ•°æ®åº“ï¼Œå› ä¸ºéšæœºè®¿é—®å¯¹ç£ç›˜IOä¸å‹å¥½ã€‚æ‰€ä»¥å®é™…åº”ç”¨ä¸­ï¼ŒB+æ ‘ç´¢å¼•ä»ç„¶æ˜¯ä¸»æµé€‰æ‹©ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æœ‰åˆ›æ–°æ€§ï¼Œä½†ä¸å¤Ÿç³»ç»Ÿ</li>
<li>é¢è¯•å®˜å¯¹ä¼˜åŒ–æ–¹æ¡ˆæ„Ÿå…´è¶£</li>
<li>åº”è¯¥ç»“åˆå®é™…åº”ç”¨åœºæ™¯æ¥åˆ†æ</li>
</ul>
<h3 id="é—®é¢˜5ï¼šè·³è¡¨æ•°æ®ç»“æ„">é—®é¢˜5ï¼šè·³è¡¨æ•°æ®ç»“æ„</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ è¿™è¾¹äº†è§£è¿‡è·³è¡¨è¿™ä¸ªæ•°æ®ç»“æ„å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè·³è¡¨äº†è§£è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰é‚£ä¹ˆç†Ÿæ‚‰ã€‚å®ƒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯O(log n)ã€‚å®ƒçš„åˆ é™¤çš„è¯åªè¦æ‰¾åˆ°äº†ä»¥åï¼Œå®ƒçš„åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æˆ‘æ„Ÿè§‰åº”è¯¥æ˜¯O(1)ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è·³è¡¨æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è¿™æ ·å›ç­”ï¼š</p>
<p>&quot;è·³è¡¨æ˜¯ä¸€ç§æ¦‚ç‡æ€§çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥çœ‹ä½œæ˜¯é“¾è¡¨çš„å¤šå±‚ç‰ˆæœ¬ã€‚</p>
<p><strong>æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦</strong>ï¼šå¹³å‡O(log n)ï¼Œæœ€åO(n)</p>
<p><strong>åˆ é™¤æ—¶é—´å¤æ‚åº¦</strong>ï¼šæ‰¾åˆ°èŠ‚ç‚¹ååˆ é™¤æ˜¯O(1)ï¼Œä½†æ‰¾åˆ°èŠ‚ç‚¹éœ€è¦O(log n)ï¼Œæ‰€ä»¥æ€»ä½“æ˜¯O(log n)</p>
<p><strong>æ’å…¥æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log n)</p>
<p>è·³è¡¨çš„ä¼˜åŠ¿æ˜¯ï¼š</p>
<ol>
<li>å®ç°ç›¸å¯¹ç®€å•</li>
<li>æ”¯æŒèŒƒå›´æŸ¥è¯¢</li>
<li>ç©ºé—´å¤æ‚åº¦æ˜¯O(n)</li>
</ol>
<p>Redisçš„Sorted Setå°±æ˜¯ç”¨è·³è¡¨å®ç°çš„ï¼Œå› ä¸ºå®ƒæ¯”çº¢é»‘æ ‘æ›´å®¹æ˜“å®ç°ï¼Œè€Œä¸”æ€§èƒ½ç›¸å½“ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å¯¹è·³è¡¨äº†è§£ä¸å¤Ÿæ·±å…¥</li>
<li>é¢è¯•å®˜æ²¡æœ‰ç»§ç»­è¿½é—®</li>
<li>åº”è¯¥æå‰å‡†å¤‡Redisç­‰å®é™…åº”ç”¨æ¡ˆä¾‹</li>
</ul>
<h3 id="é—®é¢˜6ï¼šRedisç¼“å­˜é—®é¢˜">é—®é¢˜6ï¼šRedisç¼“å­˜é—®é¢˜</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ è¿™è¾¹èƒ½ä¹‹å‰äº†è§£è¿‡åƒç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€è¿™äº›æ¦‚å¿µâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè¿™äº›æˆ‘æ˜¯äº†è§£çš„ï¼Œå› ä¸ºæˆ‘é¡¹ç›®é‡Œé¢å°±æœ‰ï¼Œæ¯”å¦‚è¯´ç¼“å­˜é›ªå´©çš„è¯å°±æ˜¯ä¸€å¤§æ‰¹çš„æ•°æ®å®ƒå¯èƒ½åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥è¶Šè¿‡ç¼“å­˜ï¼Œç›´æ¥æ‰“åˆ°æ•°æ®åº“ä¸Šé¢å»äº†ï¼Œå¯¼è‡´æ•°æ®åº“å¯èƒ½ä¼šå®•æœºã€‚ç„¶åç¼“å­˜å‡»ç©¿çš„è¯ï¼Œç¼“å­˜å‡»ç©¿çš„è¯å°±æ˜¯å½“æœ‰ä¸€ä¸ªçƒ­ç‚¹æ•°æ®ï¼Œè¿™ä¸ªçƒ­ç‚¹æ•°æ®è®¿é—®çš„é¢‘ç‡éå¸¸é«˜ï¼Œä½†å®ƒçªç„¶è¿‡æœŸäº†ã€‚ç„¶åå°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±å¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥æ‰“åˆ°äº†æ•°æ®åº“ä¸Šã€‚ç„¶åç¼“å­˜ç©¿é€çš„è¯ï¼Œå®ƒå°±æ˜¯å¤§é‡çš„è¯·æ±‚æ‰“åˆ°äº†ä¸å­˜åœ¨ç¼“å­˜çš„æ•°æ®ä¸Šé¢â€¦â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé—®é¢˜å›ç­”å¾—æ¯”è¾ƒå…¨é¢ï¼Œå¯ä»¥ç¨å¾®è¡¥å……ä¸€ä¸‹ï¼š</p>
<p>&quot;æ˜¯çš„ï¼Œæˆ‘äº†è§£è¿™ä¸‰ç§ç¼“å­˜é—®é¢˜ï¼š</p>
<p><strong>ç¼“å­˜ç©¿é€</strong>ï¼šå¤§é‡è¯·æ±‚æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç»•è¿‡ç¼“å­˜ç›´æ¥è®¿é—®æ•°æ®åº“</p>
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šå¸ƒéš†è¿‡æ»¤å™¨ã€ç¼“å­˜ç©ºå€¼</li>
</ul>
<p><strong>ç¼“å­˜å‡»ç©¿</strong>ï¼šçƒ­ç‚¹æ•°æ®è¿‡æœŸï¼Œå¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“</p>
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šäº’æ–¥é”ã€æ°¸ä¸è¿‡æœŸã€æå‰æ›´æ–°</li>
</ul>
<p><strong>ç¼“å­˜é›ªå´©</strong>ï¼šå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›æ¿€å¢</p>
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šéšæœºè¿‡æœŸæ—¶é—´ã€ç†”æ–­æœºåˆ¶ã€å¤šçº§ç¼“å­˜</li>
</ul>
<p>æˆ‘åœ¨é¡¹ç›®ä¸­å°±å®ç°äº†SingleFlightæœºåˆ¶æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æ¯”è¾ƒè¯¦ç»†ï¼Œè¦†ç›–äº†ä¸»è¦æ¦‚å¿µ</li>
<li>é¢è¯•å®˜ç»§ç»­è¿½é—®äº†å…·ä½“è§£å†³æ–¹æ¡ˆ</li>
<li>å›ç­”è´¨é‡è¾ƒå¥½ï¼Œä½“ç°äº†å®è·µç»éªŒ</li>
</ul>
<h3 id="é—®é¢˜7ï¼šå¸ƒéš†è¿‡æ»¤å™¨">é—®é¢˜7ï¼šå¸ƒéš†è¿‡æ»¤å™¨</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ è¿™è¾¹èƒ½ç¨å¾®è®²ä¸€ä¸‹è¿™ä¸ªå¸ƒéš†è¿‡æ»¤å™¨å®ƒæ˜¯åšä»€ä¹ˆï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œå¸ƒéš†è¿‡æ»¤å™¨çš„è¯ï¼Œå®ƒæœ‰å¾ˆå¤šç§åº”ç”¨åœºæ™¯ã€‚å°±æ¯”å¦‚è¯´è¿‡æ»¤æ‰é‚£äº›ä¸å¸¸è§çš„æ•°æ®ï¼Œè¿‡æ»¤æ‰ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¿™æ˜¯åˆšåˆšä¸€ç§è§£æ³•ã€‚è¿˜æœ‰ä¸€ç§çš„è¯ï¼Œå®ƒå…¶å®æ˜¯å¯ä»¥åšä¸€äº›æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯ä»¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§åº”ç”¨åœºæ™¯ã€‚å°±æ˜¯è¯´å®ƒå¯ä»¥å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡ŒNç§å“ˆå¸Œã€‚å¦‚æœè¯´å®ƒæ€ä¹ˆè¯´å‘¢ï¼Ÿå®ƒæœ‰ä¸ªå«å±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼Œå¯ä»¥å¯¹å¤šä¸ªå­—ç¬¦ä¸²è¿›è¡Œå±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼Œè¿™æ ·å¯ä»¥åŒ¹é…åˆ°ç›¸ä¼¼çš„å­—ç¬¦ä¸²ã€‚å°±æ˜¯é€šè¿‡å“ˆå¸Œå…³ç³»ï¼Œæˆ‘ä¸»è¦äº†è§£æ˜¯è¿™ä¸¤ç§åº”ç”¨åœºæ™¯ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å¸ƒéš†è¿‡æ»¤å™¨çš„å›ç­”å¯ä»¥æ›´å‡†ç¡®ä¸€äº›ï¼š</p>
<p>&quot;å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ¦‚ç‡æ€§çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ol>
<li>ä½¿ç”¨kä¸ªå“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ è¿›è¡Œå“ˆå¸Œ</li>
<li>å°†kä¸ªä½ç½®éƒ½æ ‡è®°ä¸º1</li>
<li>æŸ¥è¯¢æ—¶æ£€æŸ¥kä¸ªä½ç½®æ˜¯å¦éƒ½ä¸º1</li>
</ol>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ol>
<li><strong>ç¼“å­˜ç©¿é€é˜²æŠ¤</strong>ï¼šå¿«é€Ÿè¿‡æ»¤ä¸å­˜åœ¨çš„key</li>
<li><strong>åƒåœ¾é‚®ä»¶è¿‡æ»¤</strong>ï¼šåˆ¤æ–­é‚®ä»¶åœ°å€æ˜¯å¦åœ¨é»‘åå•</li>
<li><strong>ç½‘é¡µçˆ¬è™«å»é‡</strong>ï¼šåˆ¤æ–­URLæ˜¯å¦å·²è®¿é—®</li>
<li><strong>æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–</strong>ï¼šå‡å°‘ä¸å¿…è¦çš„æ•°æ®åº“æŸ¥è¯¢</li>
</ol>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ç©ºé—´æ•ˆç‡é«˜</li>
<li>æŸ¥è¯¢é€Ÿåº¦å¿«O(k)</li>
<li>æœ‰å‡é˜³æ€§ï¼Œæ— å‡é˜´æ€§</li>
<li>ä¸æ”¯æŒåˆ é™¤ï¼ˆé™¤éä½¿ç”¨è®¡æ•°å¸ƒéš†è¿‡æ»¤å™¨ï¼‰&quot;</li>
</ul>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æœ‰äº›æ¦‚å¿µæ··æ·†</li>
<li>é¢è¯•å®˜è¿½é—®äº†åˆ é™¤æ”¯æŒé—®é¢˜</li>
<li>åº”è¯¥æ›´å‡†ç¡®åœ°æè¿°å·¥ä½œåŸç†</li>
</ul>
<h3 id="é—®é¢˜8ï¼šGoè¯­è¨€åƒåœ¾å›æ”¶">é—®é¢˜8ï¼šGoè¯­è¨€åƒåœ¾å›æ”¶</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œé‚£ä½ èƒ½ç¨å¾®è®²ä¸€ä¸‹é‚£ä¸ªGolangçš„åƒåœ¾å›æ”¶æœºåˆ¶å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œGoè¯­è¨€åƒåœ¾å›æ”¶æœºåˆ¶çš„è¯ï¼Œæˆ‘è®°å¾—å®ƒå¥½åƒæœ‰ä¸€ä¸ªæ¼”å˜è¿‡ç¨‹ã€‚é¦–å…ˆå®ƒä¸€å¼€å§‹çš„åƒåœ¾å›æ”¶çš„è¯ï¼Œå®ƒæ˜¯ç›´æ¥å«stop the worldã€‚å°±æ˜¯ä»–åœ¨åƒåœ¾å›æ”¶ä¹‹å‰ï¼Œä»–ä¼šæŠŠæ•´ä¸ªç¨‹åºæš‚åœï¼Œç„¶åæŠŠåƒåœ¾å…¨éƒ½å›æ”¶äº†ã€‚å°±æ˜¯ä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œç„¶åæŠŠå®ƒä¸€ä¸ªä¸ªæ ‡è®°é‚£äº›å¯ä»¥è®¿é—®åˆ°çš„é‚£äº›å†…å­˜ï¼Œç„¶åæŠŠé‚£äº›è®¿é—®ä¸åˆ°å†…å­˜ç›´æ¥ç»™å®ƒæ¸…é™¤æ‰ï¼Œè¿™æ˜¯ç¬¬ä¸€ç§æ–¹å¼ã€‚ç„¶ååé¢çš„è¯å°±å‘ç°è¿™ç§æ–¹å¼çš„è¯ï¼Œå®ƒå¯¹æ€§èƒ½çš„å½±å“ä¼šæ¯”è¾ƒå¤§ã€‚äºæ˜¯ä»–å°±åé¢è¡ç”Ÿå‡ºäº†ä¸€ä¸ªä¸‰è‰²æ ‡è®°æ³•çš„ä¸€ç§åƒåœ¾å›æ”¶æœºåˆ¶â€¦â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>Goçš„åƒåœ¾å›æ”¶æœºåˆ¶å¯ä»¥è¿™æ ·å›ç­”ï¼š</p>
<p>&quot;Goè¯­è¨€çš„åƒåœ¾å›æ”¶ç»å†äº†å‡ ä¸ªé˜¶æ®µï¼š</p>
<p><strong>1. Go 1.3ä¹‹å‰ - Stop The World</strong></p>
<ul>
<li>æš‚åœæ•´ä¸ªç¨‹åºè¿›è¡Œåƒåœ¾å›æ”¶</li>
<li>å¯¹æ€§èƒ½å½±å“å¾ˆå¤§</li>
</ul>
<p><strong>2. Go 1.5 - ä¸‰è‰²æ ‡è®°æ³•</strong></p>
<ul>
<li>ç™½è‰²ï¼šæœªè¢«è®¿é—®çš„å¯¹è±¡</li>
<li>ç°è‰²ï¼šå·²è¢«è®¿é—®ä½†å­å¯¹è±¡æœªè®¿é—®çš„å¯¹è±¡</li>
<li>é»‘è‰²ï¼šå·²è¢«è®¿é—®ä¸”å­å¯¹è±¡å·²è®¿é—®çš„å¯¹è±¡</li>
</ul>
<p><strong>3. Go 1.8 - æ··åˆå†™å±éšœ</strong></p>
<ul>
<li>å‡å°‘å¹¶å‘æ ‡è®°æ—¶çš„å†™å±éšœå¼€é”€</li>
</ul>
<p><strong>4. Go 1.12 - æ ‡è®°æ¸…é™¤</strong></p>
<ul>
<li>è¿›ä¸€æ­¥ä¼˜åŒ–æ ‡è®°é˜¶æ®µ</li>
</ul>
<p><strong>5. Go 1.14 - å¹¶å‘æ ‡è®°æ¸…é™¤</strong></p>
<ul>
<li>æ ‡è®°å’Œæ¸…é™¤é˜¶æ®µéƒ½å¯ä»¥å¹¶å‘æ‰§è¡Œ</li>
</ul>
<p>ç°åœ¨çš„Goä½¿ç”¨ä¸‰è‰²æ ‡è®°+å¹¶å‘å›æ”¶ï¼Œå¤§å¤§å‡å°‘äº†GCå¯¹ç¨‹åºæ€§èƒ½çš„å½±å“ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æ¯”è¾ƒè¯¦ç»†ï¼Œä½“ç°äº†å¯¹Go GCçš„äº†è§£</li>
<li>é¢è¯•å®˜æ²¡æœ‰ç»§ç»­è¿½é—®</li>
<li>å›ç­”è´¨é‡è¾ƒå¥½ï¼Œä½“ç°äº†æŠ€æœ¯æ·±åº¦</li>
</ul>
<h3 id="é—®é¢˜9ï¼šä¹è§‚é”å’Œæ‚²è§‚é”">é—®é¢˜9ï¼šä¹è§‚é”å’Œæ‚²è§‚é”</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ è¿™è¾¹äº†è§£è¿‡ä¹è§‚é”å’Œæ‚²è§‚é”å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä¹è§‚é”çš„è¯ï¼Œä¹è§‚é”çš„è¯ä»–è®¤ä¸ºä»–æ˜¯ä¸€ç§å¾ˆä¹è§‚çš„æƒ³æ³•ï¼Œå°±æ˜¯ä»–é¢„å…ˆæŠŠäº‹æƒ…åšå¥½äº†ï¼Œç„¶åå†åŠ é”ï¼Œè¿™æ ·æ€§èƒ½ä¼šå¥½ä¸€ç‚¹ã€‚ç„¶åæ‚²è§‚é”çš„è¯å°±æ˜¯è®¤ä¸ºæ‰€æœ‰çš„è¯·æ±‚å®ƒéƒ½æœ‰å¯èƒ½ä¼šå¤±è´¥ï¼Œæ‰€ä»¥è¯´å®ƒä¼šæå‰åŠ é”ï¼ŒåŠ é”ä»¥åå†æ‰§è¡Œï¼Œè¿™æ ·å¯¹æ€§èƒ½çš„å½±å“ä¼šæ¯”è¾ƒå¤§ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥å›ç­”å¾—æ›´å…·ä½“ä¸€äº›ï¼š</p>
<p>&quot;ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä¸¤ç§ä¸åŒçš„å¹¶å‘æ§åˆ¶ç­–ç•¥ï¼š</p>
<p><strong>ä¹è§‚é”</strong>ï¼š</p>
<ul>
<li>å‡è®¾å†²çªå¾ˆå°‘å‘ç”Ÿï¼Œå…ˆæ‰§è¡Œæ“ä½œï¼Œå†æ£€æŸ¥å†²çª</li>
<li>å®ç°æ–¹å¼ï¼šç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ã€CASæ“ä½œ</li>
<li>é€‚ç”¨åœºæ™¯ï¼šè¯»å¤šå†™å°‘ã€å†²çªè¾ƒå°‘çš„åœºæ™¯</li>
<li>æ€§èƒ½ï¼šå¹¶å‘æ€§èƒ½å¥½ï¼Œä½†å†²çªæ—¶é‡è¯•å¼€é”€å¤§</li>
</ul>
<p><strong>æ‚²è§‚é”</strong>ï¼š</p>
<ul>
<li>å‡è®¾å†²çªç»å¸¸å‘ç”Ÿï¼Œå…ˆåŠ é”å†æ‰§è¡Œæ“ä½œ</li>
<li>å®ç°æ–¹å¼ï¼šæ•°æ®åº“è¡Œé”ã€è¡¨é”ã€åˆ†å¸ƒå¼é”</li>
<li>é€‚ç”¨åœºæ™¯ï¼šå†™å¤šè¯»å°‘ã€å†²çªè¾ƒå¤šçš„åœºæ™¯</li>
<li>æ€§èƒ½ï¼šå¹¶å‘æ€§èƒ½å·®ï¼Œä½†æ— é‡è¯•å¼€é”€</li>
</ul>
<p>å®é™…åº”ç”¨ä¸­è¦æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©ï¼Œæ¯”å¦‚åº“å­˜æ‰£å‡ç”¨æ‚²è§‚é”ï¼Œç”¨æˆ·ä¿¡æ¯æ›´æ–°ç”¨ä¹è§‚é”ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æ¯”è¾ƒæŠ½è±¡ï¼Œç¼ºä¹å…·ä½“ä¾‹å­</li>
<li>é¢è¯•å®˜è¿½é—®äº†åº”ç”¨åœºæ™¯</li>
<li>åº”è¯¥å‡†å¤‡æ›´å¤šå®é™…åº”ç”¨æ¡ˆä¾‹</li>
</ul>
<h3 id="é—®é¢˜10ï¼šTCPæŠ¥æ–‡æ ¼å¼">é—®é¢˜10ï¼šTCPæŠ¥æ–‡æ ¼å¼</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ è¿™è¾¹èƒ½ç¨å¾®è®²ä¸€ä¸‹å°±æ¯”å¦‚è¯´åƒTCPå®ƒçš„æŠ¥æ–‡æ ¼å¼ï¼Œä½ è¿™ä¸ªä¹‹å‰äº†è§£è¿‡å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œTCPçš„æŠ¥æ–‡æ ¼å¼çš„è¯ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ªå°±æ˜¯ç¬¬ä¸€è¡Œï¼Œå®ƒæ˜¯32å­—èŠ‚ã€‚ç„¶åå‰32ä¸ªä½ï¼Œç„¶åå‰é¢16ä½çš„è¯æ˜¯æºç«¯å£ï¼Œåé¢16ä½çš„è¯æ˜¯ç›®æ ‡ç«¯å£ã€‚ç„¶åæ¥ä¸‹æ¥çš„è¯å¥½åƒæ˜¯åºåˆ—å·ã€‚2ä¸ª32ä½å®ƒåˆ†åˆ«åº”è¯¥ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæ˜¯åºåˆ—å·ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ç¡®è®¤å·ï¼Œç„¶ååé¢å¥½åƒå°±æ˜¯æœ‰ä¸€éƒ¨åˆ†ç©ºå‡ºæ¥çš„é‚£æ¥ä¸‹æ¥å°±æ˜¯ä»€ä¹ˆACKã€SYNä¹‹ç±»çš„æ ‡å¿—ä½ï¼Œç„¶åå†å¾€åçš„è¯åº”è¯¥æ˜¯ä¸€äº›æ ¡éªŒä½ï¼Œä½†å…·ä½“çš„ä¹Ÿè®°ä¸å¤ªæ¸…æ¥šäº†ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>TCPæŠ¥æ–‡æ ¼å¼å¯ä»¥è¿™æ ·å›ç­”ï¼š</p>
<p>&quot;TCPæŠ¥æ–‡æ ¼å¼åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p>
<p><strong>æºç«¯å£å’Œç›®çš„ç«¯å£</strong>ï¼šå„16ä½ï¼Œæ ‡è¯†å‘é€å’Œæ¥æ”¶çš„è¿›ç¨‹</p>
<p><strong>åºåˆ—å·</strong>ï¼š32ä½ï¼Œæ ‡è¯†æœ¬æŠ¥æ–‡æ®µç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·</p>
<p><strong>ç¡®è®¤å·</strong>ï¼š32ä½ï¼ŒæœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºå·</p>
<p><strong>æ•°æ®åç§»</strong>ï¼š4ä½ï¼ŒæŒ‡å‡ºTCPæŠ¥æ–‡æ®µçš„æ•°æ®èµ·å§‹å¤„è·ç¦»TCPæŠ¥æ–‡æ®µèµ·å§‹å¤„æœ‰å¤šè¿œ</p>
<p><strong>ä¿ç•™å­—æ®µ</strong>ï¼š6ä½ï¼Œä¿ç•™ä¸ºä»Šåä½¿ç”¨</p>
<p><strong>æ§åˆ¶ä½</strong>ï¼š6ä½ï¼ŒåŒ…æ‹¬URGã€ACKã€PSHã€RSTã€SYNã€FIN</p>
<p><strong>çª—å£å¤§å°</strong>ï¼š16ä½ï¼Œå‘Šè¯‰å¯¹æ–¹æœ¬æŠ¥æ–‡æ®µå‘é€æ–¹çš„æ¥æ”¶çª—å£å¤§å°</p>
<p><strong>æ ¡éªŒå’Œ</strong>ï¼š16ä½ï¼Œæ£€éªŒæ•´ä¸ªTCPæŠ¥æ–‡æ®µ</p>
<p><strong>ç´§æ€¥æŒ‡é’ˆ</strong>ï¼š16ä½ï¼Œä»…åœ¨URG=1æ—¶æœ‰æ•ˆ</p>
<p><strong>é€‰é¡¹å’Œå¡«å……</strong>ï¼šå¯å˜é•¿åº¦&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”æ¯”è¾ƒæ··ä¹±ï¼Œè®°å¿†ä¸å¤Ÿå‡†ç¡®</li>
<li>é¢è¯•å®˜æ²¡æœ‰ç»§ç»­è¿½é—®</li>
<li>åº”è¯¥æå‰å¤ä¹ ç½‘ç»œåè®®çš„åŸºç¡€çŸ¥è¯†</li>
</ul>
<h3 id="é—®é¢˜11ï¼šç®—æ³•é¢˜-é“¾è¡¨å¯¹æŠ˜">é—®é¢˜11ï¼šç®—æ³•é¢˜ - é“¾è¡¨å¯¹æŠ˜</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘è¿™è¾¹ç»™ä½ å‡†å¤‡ä¸€é“ç®—æ³•é¢˜ï¼Œèƒ½çœ‹åˆ°è¿™ä¸ªé¡µé¢å˜åŒ–å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘æƒ³çš„æœ€ç®€å•çš„è§£æ³•å°±æ˜¯æŠŠå®ƒç»™æ‹†æˆä¸¤ä¸ªé“¾è¡¨ã€‚å…ˆæŠŠå®ƒæŒ‰ä¸­é—´æ‹†æˆä¸¤ä¸ªé“¾è¡¨ï¼Œç„¶åå¦ä¸€ä¸ªé“¾è¡¨å®ƒæ‹†çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒæ˜¯ä½¿ç”¨å¤´æ’æ³•ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå®ƒåè½¬äº†ï¼Œç„¶åå®ƒæ—¶é—´å¤æ‚åº¦ä¹Ÿä¼šå¾ˆä½ï¼Œç„¶åå†æŠŠè¿™ä¸¤ä¸ªé“¾è¡¨å†æ‹¼èµ·æ¥ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™é“é“¾è¡¨å¯¹æŠ˜é¢˜å¯ä»¥è¿™æ ·è§£å†³ï¼š</p>
<p>&quot;æˆ‘çš„æ€è·¯æ˜¯ï¼š</p>
<ol>
<li>ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨ä¸­é—´èŠ‚ç‚¹</li>
<li>å°†ååŠéƒ¨åˆ†é“¾è¡¨åè½¬</li>
<li>å°†ä¸¤ä¸ªé“¾è¡¨äº¤æ›¿åˆå¹¶</li>
</ol>
<p>å…·ä½“å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reorderList</span><span class="params">(head *ListNode)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹</span></span><br><span class="line">    slow, fast := head, head</span><br><span class="line">    <span class="keyword">for</span> fast.Next != <span class="literal">nil</span> &amp;&amp; fast.Next.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">        slow = slow.Next</span><br><span class="line">        fast = fast.Next.Next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åè½¬ååŠéƒ¨åˆ†</span></span><br><span class="line">    second := reverseList(slow.Next)</span><br><span class="line">    slow.Next = <span class="literal">nil</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// äº¤æ›¿åˆå¹¶</span></span><br><span class="line">    first := head</span><br><span class="line">    <span class="keyword">for</span> second != <span class="literal">nil</span> &#123;</span><br><span class="line">        temp1, temp2 := first.Next, second.Next</span><br><span class="line">        first.Next = second</span><br><span class="line">        second.Next = temp1</span><br><span class="line">        first, second = temp1, temp2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œç©ºé—´å¤æ‚åº¦ï¼šO(1)&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶æ€è·¯æ­£ç¡®ï¼Œä½†è¡¨è¾¾ä¸å¤Ÿæ¸…æ™°</li>
<li>é¢è¯•å®˜è®©æˆ‘ç°åœºå®ç°</li>
<li>åº”è¯¥æå‰å‡†å¤‡ä»£ç å®ç°</li>
</ul>
<h3 id="é—®é¢˜12ï¼šå¹¶å‘ç¼–ç¨‹é¢˜">é—®é¢˜12ï¼šå¹¶å‘ç¼–ç¨‹é¢˜</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¦å¤–è¿˜æœ‰ä¸€ä¸ªæ˜¯ä½ è¿™è¾¹åšè¿‡ï¼Œå°±åƒæ¯”å¦‚è¯´æ˜¯æˆ‘ç°åœ¨æœ‰ä¸¤ä¸ªåç¨‹ï¼Œç„¶åæƒ³ä¸€ä¸ªæ‰“å°å¥‡æ•°ï¼Œä¸€ä¸ªæ‰“å°å¶æ•°ï¼Œç„¶åä½ èƒ½åšåˆ°è®©ä»–ä»¬ä¸¤ä¸ªäº¤æ›¿è¾“å‡ºå—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œå¯ä»¥ï¼Œæˆ‘ä¸Šæ¬¡çš„é¢è¯•ä¹Ÿæ˜¯è¿™ä¸ªï¼Œä¸Šæ¬¡å­—èŠ‚çš„é¢è¯•ä¹Ÿæ˜¯è¿™ä¸ªé¢˜ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™é“å¹¶å‘ç¼–ç¨‹é¢˜å¯ä»¥è¿™æ ·è§£å†³ï¼š</p>
<p>&quot;è¿™é“é¢˜å¯ä»¥ç”¨channelæ¥å®ç°ä¸¤ä¸ªgoroutineçš„äº¤æ›¿æ‰§è¡Œï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">alternatePrint</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰“å°å¥‡æ•°</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">99</span>; i += <span class="number">2</span> &#123;</span><br><span class="line">            &lt;-ch1</span><br><span class="line">            fmt.Println(i)</span><br><span class="line">            ch2 &lt;- <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰“å°å¶æ•°</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">2</span>; i &lt;= <span class="number">100</span>; i += <span class="number">2</span> &#123;</span><br><span class="line">            &lt;-ch2</span><br><span class="line">            fmt.Println(i)</span><br><span class="line">            ch1 &lt;- <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    ch1 &lt;- <span class="number">1</span> <span class="comment">// å¯åŠ¨ç¬¬ä¸€ä¸ªgoroutine</span></span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³é”®ç‚¹ï¼š</p>
<ol>
<li>ä½¿ç”¨ä¸¤ä¸ªchannelè¿›è¡ŒåŒæ­¥</li>
<li>ç”¨WaitGroupç­‰å¾…ä¸¤ä¸ªgoroutineå®Œæˆ</li>
<li>é€šè¿‡channelæ§åˆ¶æ‰§è¡Œé¡ºåº&quot;</li>
</ol>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶æœ‰ç»éªŒï¼Œä½†å®ç°æ—¶å‡ºç°äº†æ­»é”</li>
<li>é¢è¯•å®˜è¿½é—®äº†æ­»é”åŸå› </li>
<li>åº”è¯¥æ›´ä»”ç»†åœ°æ£€æŸ¥channelçš„ä½¿ç”¨</li>
</ul>
<h2 id="é¢è¯•æ•´ä½“æ„Ÿå—">é¢è¯•æ•´ä½“æ„Ÿå—</h2>
<ul>
<li><strong>éš¾åº¦è¯„ä»·</strong>: é€‚ä¸­ï¼Œä¸»è¦è€ƒå¯ŸåŸºç¡€çŸ¥è¯†å’Œå®é™…ç¼–ç¨‹èƒ½åŠ›</li>
<li><strong>é¢è¯•å®˜é£æ ¼</strong>: å‹å–„ä¸“ä¸šï¼Œä¼šå¼•å¯¼æ€è€ƒï¼Œä¸ä¼šåˆ»æ„åˆéš¾</li>
<li><strong>é¢˜ç›®ç±»å‹</strong>: æŠ€æœ¯åŸºç¡€ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€ç½‘ç»œï¼‰+ ç®—æ³•ç¼–ç¨‹ + é¡¹ç›®ç»å†</li>
<li><strong>å‡†å¤‡å»ºè®®</strong>: é‡ç‚¹å¤ä¹ Goè¯­è¨€ã€æ•°æ®åº“ã€ç¼“å­˜æœºåˆ¶ï¼Œå‡†å¤‡ç®—æ³•é¢˜å’Œå¹¶å‘ç¼–ç¨‹</li>
</ul>
<h2 id="é¢è¯•ç»“æœ">é¢è¯•ç»“æœ</h2>
<ul>
<li><strong>å½“åœºåé¦ˆ</strong>: é¢è¯•å®˜è¡¨ç¤ºä¼šå’ŒHRæ²Ÿé€šï¼Œæ²¡æœ‰å½“åœºç»™å‡ºæ˜ç¡®ç»“æœ</li>
<li><strong>åç»­æµç¨‹</strong>: æŠ€æœ¯é¢ä¸€èˆ¬æœ‰ä¸‰è½®ï¼Œç­‰å¾…HRé€šçŸ¥</li>
<li><strong>ä¸ªäººæ„Ÿå—</strong>: æ•´ä½“è¡¨ç°è¿˜å¯ä»¥ï¼ŒåŸºç¡€çŸ¥è¯†æŒæ¡è¾ƒå¥½ï¼Œä½†æœ‰äº›ç»†èŠ‚éœ€è¦åŠ å¼º</li>
</ul>
<h2 id="ç»éªŒæ€»ç»“">ç»éªŒæ€»ç»“</h2>
<h3 id="åšå¾—å¥½çš„åœ°æ–¹">åšå¾—å¥½çš„åœ°æ–¹</h3>
<ol>
<li><strong>é¡¹ç›®ç»å†ä¸°å¯Œ</strong>ï¼šæœ‰å®é™…çš„é¡¹ç›®ç»éªŒï¼Œèƒ½è¯¦ç»†è¯´æ˜æŠ€æœ¯ç»†èŠ‚</li>
<li><strong>åŸºç¡€çŸ¥è¯†æ‰å®</strong>ï¼šå¯¹ç¼“å­˜æœºåˆ¶ã€æ•°æ®åº“ç´¢å¼•ç­‰æ¦‚å¿µç†è§£è¾ƒå¥½</li>
<li><strong>å­¦ä¹ èƒ½åŠ›å¼º</strong>ï¼šèƒ½å¿«é€Ÿç†è§£é¢è¯•å®˜çš„é—®é¢˜å¹¶ç»™å‡ºåˆç†å›ç­”</li>
</ol>
<h3 id="éœ€è¦æ”¹è¿›çš„åœ°æ–¹">éœ€è¦æ”¹è¿›çš„åœ°æ–¹</h3>
<ol>
<li><strong>è¡¨è¾¾ä¸å¤Ÿæ¸…æ™°</strong>ï¼šæœ‰äº›å›ç­”æ¯”è¾ƒå£è¯­åŒ–ï¼Œé€»è¾‘ä¸å¤Ÿæ¸…æ™°</li>
<li><strong>ç»†èŠ‚æŒæ¡ä¸å¤Ÿ</strong>ï¼šå¯¹TCPæŠ¥æ–‡æ ¼å¼ã€è·³è¡¨ç­‰ç»†èŠ‚äº†è§£ä¸å¤Ÿæ·±å…¥</li>
<li><strong>ä»£ç å®ç°èƒ½åŠ›</strong>ï¼šç®—æ³•é¢˜çš„ä»£ç å®ç°éœ€è¦æ›´åŠ ç†Ÿç»ƒ</li>
</ol>
<h3 id="å‡†å¤‡å»ºè®®">å‡†å¤‡å»ºè®®</h3>
<ol>
<li><strong>ç³»ç»Ÿå¤ä¹ åŸºç¡€çŸ¥è¯†</strong>ï¼šé‡ç‚¹å¤ä¹ ç½‘ç»œåè®®ã€æ•°æ®ç»“æ„ã€å¹¶å‘ç¼–ç¨‹</li>
<li><strong>å‡†å¤‡é¡¹ç›®ç»†èŠ‚</strong>ï¼šå¯¹é¡¹ç›®ä¸­çš„æŠ€æœ¯é€‰å‹å’Œå®ç°ç»†èŠ‚è¦äº†å¦‚æŒ‡æŒ</li>
<li><strong>ç»ƒä¹ ç®—æ³•ç¼–ç¨‹</strong>ï¼šå¤šç»ƒä¹ é“¾è¡¨ã€æ ‘ã€å¹¶å‘ç¼–ç¨‹ç­‰å¸¸è§é¢˜å‹</li>
<li><strong>æå‡è¡¨è¾¾èƒ½åŠ›</strong>ï¼šç»ƒä¹ ç”¨æ›´æ¸…æ™°çš„è¯­è¨€è¡¨è¾¾æŠ€æœ¯æ¦‚å¿µ</li>
</ol>
<h3 id="çŸ¥è¯†ç‚¹å¤ä¹ ">çŸ¥è¯†ç‚¹å¤ä¹ </h3>
<ul>
<li><strong>æ•°æ®åº“</strong>ï¼šB+æ ‘ç´¢å¼•ã€å“ˆå¸Œç´¢å¼•ã€ä¹è§‚é”æ‚²è§‚é”</li>
<li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼šç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©åŠè§£å†³æ–¹æ¡ˆ</li>
<li><strong>æ•°æ®ç»“æ„</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨ã€è·³è¡¨ã€é“¾è¡¨æ“ä½œ</li>
<li><strong>ç½‘ç»œåè®®</strong>ï¼šTCPæŠ¥æ–‡æ ¼å¼ã€ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</li>
<li><strong>å¹¶å‘ç¼–ç¨‹</strong>ï¼šGoè¯­è¨€GMPæ¨¡å‹ã€åƒåœ¾å›æ”¶ã€channelä½¿ç”¨</li>
<li><strong>ç®—æ³•é¢˜</strong>ï¼šé“¾è¡¨æ“ä½œã€å¹¶å‘ç¼–ç¨‹é¢˜</li>
</ul>
<p>è¿™æ¬¡é¢è¯•è®©æˆ‘æ„è¯†åˆ°åœ¨æŠ€æœ¯æ·±åº¦å’Œè¡¨è¾¾èƒ½åŠ›ä¸Šè¿˜æœ‰æå‡ç©ºé—´ï¼Œéœ€è¦ç»§ç»­åŠ å¼ºåŸºç¡€çŸ¥è¯†çš„æŒæ¡å’Œå®é™…ç¼–ç¨‹èƒ½åŠ›çš„è®­ç»ƒã€‚</p>
]]></content>
      <categories>
        <category>é¢è¯•ç»éªŒ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>å­—èŠ‚è·³åŠ¨</tag>
        <tag>ä¸€é¢</tag>
        <tag>æŠ–éŸ³ç”Ÿæ´»æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 239 - æ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼ˆSliding Window Maximumï¼‰</title>
    <url>/2025/07/26/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-239-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º <code>k</code> çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ <code>k</code> ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚</p>
<p>è¿”å›æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,3,-1,-3,5,3,6,7], k = 3</span><br><span class="line">è¾“å‡ºï¼š[3,3,5,5,6,7]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</span><br><span class="line">---------------               -----</span><br><span class="line">[1  3  -1] -3  5  3  6  7       3</span><br><span class="line"> 1 [3  -1  -3] 5  3  6  7       3</span><br><span class="line"> 1  3 [-1  -3  5] 3  6  7       5</span><br><span class="line"> 1  3  -1 [-3  5  3] 6  7       5</span><br><span class="line"> 1  3  -1  -3 [5  3  6] 7       6</span><br><span class="line"> 1  3  -1  -3  5 [3  6  7]      7</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1], k = 1</span><br><span class="line">è¾“å‡ºï¼š[1]</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= nums.length &lt;= 10^5</code></li>
<li><code>-10^4 &lt;= nums[i] &lt;= 10^4</code></li>
<li><code>1 &lt;= k &lt;= nums.length</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<h3 id="æ ¸å¿ƒç®—æ³•ï¼šå•è°ƒé˜Ÿåˆ—">æ ¸å¿ƒç®—æ³•ï¼šå•è°ƒé˜Ÿåˆ—</h3>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨<strong>å•è°ƒé€’å‡é˜Ÿåˆ—</strong>æ¥ç»´æŠ¤æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚å•è°ƒé˜Ÿåˆ—çš„ç‰¹ç‚¹æ˜¯é˜Ÿåˆ—ä¸­çš„å…ƒç´ æŒ‰ç…§ä»å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ï¼Œé˜Ÿé¦–å…ƒç´ å§‹ç»ˆæ˜¯å½“å‰çª—å£çš„æœ€å¤§å€¼ã€‚</p>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li><strong>åˆå§‹åŒ–å•è°ƒé˜Ÿåˆ—</strong>ï¼šåˆ›å»ºä¸€ä¸ªåŒç«¯é˜Ÿåˆ—æ¥å­˜å‚¨æ•°ç»„ç´¢å¼•</li>
<li><strong>ç»´æŠ¤å•è°ƒæ€§</strong>ï¼šæ¯æ¬¡æ·»åŠ æ–°å…ƒç´ æ—¶ï¼Œä»é˜Ÿå°¾ç§»é™¤æ‰€æœ‰å°äºç­‰äºå½“å‰å…ƒç´ çš„å€¼</li>
<li><strong>å¤„ç†çª—å£æ»‘åŠ¨</strong>ï¼šå½“çª—å£å·¦è¾¹ç•Œç§»åŠ¨æ—¶ï¼Œç§»é™¤é˜Ÿåˆ—ä¸­å·²ç»ä¸åœ¨çª—å£å†…çš„å…ƒç´ </li>
<li><strong>è·å–æœ€å¤§å€¼</strong>ï¼šé˜Ÿé¦–å…ƒç´ å§‹ç»ˆæ˜¯å½“å‰çª—å£çš„æœ€å¤§å€¼</li>
</ol>
<h3 id="å…³é”®æ´è§">å…³é”®æ´è§</h3>
<ul>
<li><strong>å•è°ƒé˜Ÿåˆ—çš„ä¼˜åŠ¿</strong>ï¼šä¸éœ€è¦éå†æ•´ä¸ªçª—å£æ¥æ‰¾åˆ°æœ€å¤§å€¼ï¼Œæ—¶é—´å¤æ‚åº¦ä» O(k) é™ä½åˆ° O(1)</li>
<li><strong>ç´¢å¼•å­˜å‚¨</strong>ï¼šå­˜å‚¨ç´¢å¼•è€Œä¸æ˜¯å€¼ï¼Œä¾¿äºåˆ¤æ–­å…ƒç´ æ˜¯å¦è¿˜åœ¨çª—å£å†…</li>
<li><strong>å»¶è¿Ÿåˆ é™¤</strong>ï¼šåªæœ‰å½“é˜Ÿé¦–å…ƒç´ ç¡®å®ä¸åœ¨çª—å£å†…æ—¶æ‰åˆ é™¤ï¼Œé¿å…é¢‘ç¹æ“ä½œ</li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ <code>nums = [1,3,-1,-3,5,3,6,7], k = 3</code> ä¸ºä¾‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ­¥éª¤</th>
<th>å½“å‰å…ƒç´ </th>
<th>é˜Ÿåˆ—çŠ¶æ€</th>
<th>çª—å£</th>
<th>æœ€å¤§å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>[0]</td>
<td>[1]</td>
<td>-</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>[1]</td>
<td>[1,3]</td>
<td>-</td>
</tr>
<tr>
<td>3</td>
<td>-1</td>
<td>[1,2]</td>
<td>[1,3,-1]</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>-3</td>
<td>[1,2,3]</td>
<td>[3,-1,-3]</td>
<td>3</td>
</tr>
<tr>
<td>5</td>
<td>5</td>
<td>[4]</td>
<td>[-1,-3,5]</td>
<td>5</td>
</tr>
<tr>
<td>6</td>
<td>3</td>
<td>[4,5]</td>
<td>[-3,5,3]</td>
<td>5</td>
</tr>
<tr>
<td>7</td>
<td>6</td>
<td>[6]</td>
<td>[5,3,6]</td>
<td>6</td>
</tr>
<tr>
<td>8</td>
<td>7</td>
<td>[7]</td>
<td>[3,6,7]</td>
<td>7</td>
</tr>
</tbody>
</table>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSlidingWindow</span><span class="params">(nums []<span class="type">int</span>, k <span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> || k == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> []<span class="type">int</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»“æœæ•°ç»„</span></span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, n-k+<span class="number">1</span>)</span><br><span class="line">    <span class="comment">// å•è°ƒé€’å‡é˜Ÿåˆ—ï¼Œå­˜å‚¨ç´¢å¼•</span></span><br><span class="line">    queue := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="comment">// ç§»é™¤é˜Ÿåˆ—ä¸­å·²ç»ä¸åœ¨çª—å£å†…çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &amp;&amp; queue[<span class="number">0</span>] &lt;= i-k &#123;</span><br><span class="line">            queue = queue[<span class="number">1</span>:]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç»´æŠ¤å•è°ƒé€’å‡æ€§è´¨ï¼šç§»é™¤æ‰€æœ‰å°äºç­‰äºå½“å‰å…ƒç´ çš„å€¼</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &amp;&amp; nums[queue[<span class="built_in">len</span>(queue)<span class="number">-1</span>]] &lt;= nums[i] &#123;</span><br><span class="line">            queue = queue[:<span class="built_in">len</span>(queue)<span class="number">-1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°†å½“å‰å…ƒç´ ç´¢å¼•åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">        queue = <span class="built_in">append</span>(queue, i)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å½“çª—å£å¤§å°è¾¾åˆ°kæ—¶ï¼Œå¼€å§‹è®°å½•ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> i &gt;= k<span class="number">-1</span> &#123;</span><br><span class="line">            result = <span class="built_in">append</span>(result, nums[queue[<span class="number">0</span>]])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç ä¼˜åŒ–ç‰ˆæœ¬">ä»£ç ä¼˜åŒ–ç‰ˆæœ¬</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSlidingWindow</span><span class="params">(nums []<span class="type">int</span>, k <span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, n-k+<span class="number">1</span>)</span><br><span class="line">    queue := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="comment">// ç§»é™¤è¿‡æœŸå…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &amp;&amp; queue[<span class="number">0</span>] &lt;= i-k &#123;</span><br><span class="line">            queue = queue[<span class="number">1</span>:]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç»´æŠ¤å•è°ƒé€’å‡é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &amp;&amp; nums[queue[<span class="built_in">len</span>(queue)<span class="number">-1</span>]] &lt; nums[i] &#123;</span><br><span class="line">            queue = queue[:<span class="built_in">len</span>(queue)<span class="number">-1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        queue = <span class="built_in">append</span>(queue, i)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> i &gt;= k<span class="number">-1</span> &#123;</span><br><span class="line">            result = <span class="built_in">append</span>(result, nums[queue[<span class="number">0</span>]])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æš´åŠ›è§£æ³•</th>
<th>å•è°ƒé˜Ÿåˆ—è§£æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(nk)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(k)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç®€å•ï¼Œå®¹æ˜“ç†è§£</td>
<td>é«˜æ•ˆï¼Œé€‚åˆå¤§æ•°æ®é‡</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>æ—¶é—´å¤æ‚åº¦è¿‡é«˜</td>
<td>å®ç°ç›¸å¯¹å¤æ‚</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-n">æ—¶é—´å¤æ‚åº¦ï¼šO(n)</h3>
<ul>
<li><strong>æ¯ä¸ªå…ƒç´ æœ€å¤šå…¥é˜Ÿä¸€æ¬¡</strong>ï¼šæ¯ä¸ªç´¢å¼•æœ€å¤šè¢«åŠ å…¥é˜Ÿåˆ—ä¸€æ¬¡</li>
<li><strong>æ¯ä¸ªå…ƒç´ æœ€å¤šå‡ºé˜Ÿä¸€æ¬¡</strong>ï¼šæ¯ä¸ªç´¢å¼•æœ€å¤šè¢«ç§»é™¤é˜Ÿåˆ—ä¸€æ¬¡</li>
<li><strong>æ€»æ“ä½œæ¬¡æ•°</strong>ï¼šæ¯ä¸ªå…ƒç´ æœ€å¤šè¿›è¡Œ 2 æ¬¡é˜Ÿåˆ—æ“ä½œ</li>
<li><strong>ç»“è®º</strong>ï¼šæ—¶é—´å¤æ‚åº¦ä¸º O(n)</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼šO-k">ç©ºé—´å¤æ‚åº¦ï¼šO(k)</h3>
<ul>
<li><strong>é˜Ÿåˆ—å¤§å°</strong>ï¼šæœ€åæƒ…å†µä¸‹é˜Ÿåˆ—ä¸­å­˜å‚¨ k ä¸ªå…ƒç´ </li>
<li><strong>ç»“æœæ•°ç»„</strong>ï¼šéœ€è¦å­˜å‚¨ n-k+1 ä¸ªç»“æœ</li>
<li><strong>æ€»ç©ºé—´</strong>ï¼šO(k) + O(n-k+1) = O(n)</li>
<li><strong>ä¼˜åŒ–å</strong>ï¼šåªè€ƒè™‘é˜Ÿåˆ—ç©ºé—´ï¼Œä¸º O(k)</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="ç®—æ³•æŠ€å·§">ç®—æ³•æŠ€å·§</h3>
<ol>
<li>
<p><strong>å•è°ƒé˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>æ»‘åŠ¨çª—å£æœ€å¤§å€¼/æœ€å°å€¼</li>
<li>åŒºé—´æœ€å€¼æŸ¥è¯¢</li>
<li>å•è°ƒæ ˆçš„å˜ç§åº”ç”¨</li>
</ul>
</li>
<li>
<p><strong>ç´¢å¼•å­˜å‚¨çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ä¾¿äºåˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨çª—å£å†…</li>
<li>é¿å…é‡å¤è®¡ç®—</li>
<li>æé«˜ä»£ç å¯è¯»æ€§</li>
</ul>
</li>
<li>
<p><strong>å»¶è¿Ÿåˆ é™¤ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å‡å°‘ä¸å¿…è¦çš„é˜Ÿåˆ—æ“ä½œ</li>
<li>æé«˜ç®—æ³•æ•ˆç‡</li>
<li>ç®€åŒ–å®ç°é€»è¾‘</li>
</ul>
</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li>
<p><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼š</p>
<ul>
<li>æ•°ç»„ä¸ºç©ºæˆ– k ä¸º 0 çš„æƒ…å†µ</li>
<li>çª—å£å¤§å°ç­‰äºæ•°ç»„é•¿åº¦çš„æƒ…å†µ</li>
</ul>
</li>
<li>
<p><strong>é˜Ÿåˆ—æ“ä½œé¡ºåº</strong>ï¼š</p>
<ul>
<li>å…ˆç§»é™¤è¿‡æœŸå…ƒç´ ï¼Œå†ç»´æŠ¤å•è°ƒæ€§</li>
<li>é¿å…åœ¨é”™è¯¯æ—¶æœºåˆ é™¤å…ƒç´ </li>
</ul>
</li>
<li>
<p><strong>ç»“æœè®°å½•æ—¶æœº</strong>ï¼š</p>
<ul>
<li>åªæœ‰å½“çª—å£å¤§å°è¾¾åˆ° k æ—¶æ‰è®°å½•ç»“æœ</li>
<li>æ³¨æ„ç´¢å¼•çš„è¾¹ç•Œæ¡ä»¶</li>
</ul>
</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><a href="https://leetcode.com/problems/min-stack/">LeetCode 155 - æœ€å°æ ˆ</a></li>
<li><a href="https://leetcode.com/problems/largest-rectangle-in-histogram/">LeetCode 84 - æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢</a></li>
<li><a href="https://leetcode.com/problems/trapping-rain-water/">LeetCode 42 - æ¥é›¨æ°´</a></li>
</ul>
<p>è¿™äº›é¢˜ç›®éƒ½æ¶‰åŠå•è°ƒæ ˆ/é˜Ÿåˆ—çš„åº”ç”¨ï¼Œæ˜¯å¾ˆå¥½çš„ç»ƒä¹ ææ–™ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>Hard</tag>
        <tag>æ•°ç»„</tag>
        <tag>æ»‘åŠ¨çª—å£</tag>
        <tag>å•è°ƒé˜Ÿåˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 560 - å’Œä¸º K çš„å­æ•°ç»„ï¼ˆSubarray Sum Equals Kï¼‰</title>
    <url>/2025/07/26/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-560-%E5%92%8C%E4%B8%BAK%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code>ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å›è¯¥æ•°ç»„ä¸­å’Œä¸º <code>k</code> çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚</p>
<p>å­æ•°ç»„æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„è¿ç»­éç©ºåºåˆ—ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,1,1], k = 2</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼šå’Œä¸º 2 çš„å­æ•°ç»„æœ‰ [1,1] å’Œ [1,1]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,2,3], k = 3</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼šå’Œä¸º 3 çš„å­æ•°ç»„æœ‰ [1,2] å’Œ [3]</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= nums.length &lt;= 2 * 10^4</code></li>
<li><code>-1000 &lt;= nums[i] &lt;= 1000</code></li>
<li><code>-10^7 &lt;= k &lt;= 10^7</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨<strong>å‰ç¼€å’Œ</strong>å’Œ<strong>å“ˆå¸Œè¡¨</strong>çš„ç»„åˆæ¥è§£å†³ã€‚</p>
<h3 id="æ ¸å¿ƒæ´è§">æ ¸å¿ƒæ´è§</h3>
<p><strong>å…³é”®æ´è§</strong>ï¼šå¦‚æœå­˜åœ¨ä¸¤ä¸ªä½ç½® <code>i</code> å’Œ <code>j</code>ï¼ˆ<code>i &lt; j</code>ï¼‰ï¼Œä½¿å¾—å‰ç¼€å’Œ <code>prefix[j] - prefix[i] = k</code>ï¼Œé‚£ä¹ˆå­æ•°ç»„ <code>nums[i+1...j]</code> çš„å’Œå°±æ˜¯ <code>k</code>ã€‚</p>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li>
<p><strong>åˆå§‹åŒ–</strong>ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ <code>count</code> æ¥è®°å½•æ¯ä¸ªå‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°</li>
<li>åˆå§‹åŒ– <code>count[0] = 1</code>ï¼Œè¡¨ç¤ºç©ºå‰ç¼€å’Œå‡ºç° 1 æ¬¡</li>
<li>åˆå§‹åŒ– <code>prefix_sum = 0</code> å’Œ <code>result = 0</code></li>
</ul>
</li>
<li>
<p><strong>éå†æ•°ç»„</strong>ï¼š</p>
<ul>
<li>å¯¹äºæ¯ä¸ªå…ƒç´  <code>nums[i]</code>ï¼Œè®¡ç®—å½“å‰çš„å‰ç¼€å’Œ <code>prefix_sum += nums[i]</code></li>
<li>æ£€æŸ¥æ˜¯å¦å­˜åœ¨ <code>prefix_sum - k</code> åœ¨å“ˆå¸Œè¡¨ä¸­</li>
<li>å¦‚æœå­˜åœ¨ï¼Œå°†å¯¹åº”çš„æ¬¡æ•°åŠ åˆ°ç»“æœä¸­</li>
<li>å°†å½“å‰å‰ç¼€å’ŒåŠå…¶å‡ºç°æ¬¡æ•°æ›´æ–°åˆ°å“ˆå¸Œè¡¨ä¸­</li>
</ul>
</li>
<li>
<p><strong>ç»Ÿè®¡ç»“æœ</strong>ï¼š</p>
<ul>
<li>è¿”å›æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„æ•°é‡</li>
</ul>
</li>
</ol>
<h3 id="å¯è§†åŒ–ç¤ºä¾‹">å¯è§†åŒ–ç¤ºä¾‹</h3>
<p>ä»¥ <code>nums = [1, 1, 1], k = 2</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç´¢å¼•:    0  1  2</span><br><span class="line">æ•°ç»„:   [1, 1, 1]</span><br><span class="line">å‰ç¼€å’Œ:   1  2  3</span><br><span class="line"></span><br><span class="line">æ­¥éª¤åˆ†æï¼š</span><br><span class="line">i=0: prefix_sum=1, æŸ¥æ‰¾ 1-2=-1, count[-1]=0, ç»“æœ=0, count[1]=1</span><br><span class="line">i=1: prefix_sum=2, æŸ¥æ‰¾ 2-2=0,  count[0]=1,  ç»“æœ=1, count[2]=1  </span><br><span class="line">i=2: prefix_sum=3, æŸ¥æ‰¾ 3-2=1,  count[1]=1,  ç»“æœ=2, count[3]=1</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœï¼š2</span><br></pre></td></tr></table></figure>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦-count-0-1ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ <code>count[0] = 1</code>ï¼Ÿ</h3>
<p>è¿™æ˜¯ä¸ºäº†å¤„ç†ä»æ•°ç»„å¼€å¤´å¼€å§‹çš„å­æ•°ç»„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>nums[0] = k</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ° <code>prefix_sum - k = 0</code>ï¼Œå³ <code>prefix_sum = k</code>ã€‚å¦‚æœæ²¡æœ‰åˆå§‹åŒ– <code>count[0] = 1</code>ï¼Œè¿™ç§æƒ…å†µä¼šè¢«é—æ¼ã€‚</p>
<h3 id="å“ˆå¸Œè¡¨çš„ä½œç”¨">å“ˆå¸Œè¡¨çš„ä½œç”¨</h3>
<p>å“ˆå¸Œè¡¨ <code>count</code> ç”¨äºå¿«é€ŸæŸ¥æ‰¾æŸä¸ªå‰ç¼€å’Œå€¼ä¹‹å‰å‡ºç°è¿‡å¤šå°‘æ¬¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½çŸ¥é“æœ‰å¤šå°‘ä¸ªå­æ•°ç»„çš„å’Œä¸º <code>k</code>ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subarraySum</span><span class="params">(nums []<span class="type">int</span>, k <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    count := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>)</span><br><span class="line">    count[<span class="number">0</span>] = <span class="number">1</span>  <span class="comment">// åˆå§‹åŒ–ç©ºå‰ç¼€å’Œ</span></span><br><span class="line">    </span><br><span class="line">    prefixSum := <span class="number">0</span></span><br><span class="line">    result := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        prefixSum += num</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ prefixSum - k çš„å‰ç¼€å’Œ</span></span><br><span class="line">        <span class="keyword">if</span> freq, exists := count[prefixSum-k]; exists &#123;</span><br><span class="line">            result += freq</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ›´æ–°å½“å‰å‰ç¼€å’Œçš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">        count[prefixSum]++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç æ‰§è¡Œè¿‡ç¨‹åˆ†æ">ä»£ç æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>ä»¥ <code>nums = [1, 1, 1], k = 2</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹çŠ¶æ€ï¼š</span><br><span class="line">count = &#123;0: 1&#125;</span><br><span class="line">prefixSum = 0</span><br><span class="line">result = 0</span><br><span class="line"></span><br><span class="line">i=0, num=1:</span><br><span class="line">prefixSum = 1</span><br><span class="line">æŸ¥æ‰¾ count[1-2] = count[-1] = 0</span><br><span class="line">result = 0</span><br><span class="line">count = &#123;0: 1, 1: 1&#125;</span><br><span class="line"></span><br><span class="line">i=1, num=1:</span><br><span class="line">prefixSum = 2</span><br><span class="line">æŸ¥æ‰¾ count[2-2] = count[0] = 1</span><br><span class="line">result = 1</span><br><span class="line">count = &#123;0: 1, 1: 1, 2: 1&#125;</span><br><span class="line"></span><br><span class="line">i=2, num=1:</span><br><span class="line">prefixSum = 3</span><br><span class="line">æŸ¥æ‰¾ count[3-2] = count[1] = 1</span><br><span class="line">result = 2</span><br><span class="line">count = &#123;0: 1, 1: 1, 2: 1, 3: 1&#125;</span><br><span class="line"></span><br><span class="line">è¿”å› result = 2</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å‰ç¼€å’Œ + å“ˆå¸Œè¡¨</th>
<th>æš´åŠ›æšä¸¾</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(nÂ²)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>é«˜æ•ˆï¼Œä¸€æ¬¡éå†è§£å†³</td>
<td>ç›´è§‚æ˜“æ‡‚</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
<td>æ—¶é—´å¤æ‚åº¦è¿‡é«˜</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-n">æ—¶é—´å¤æ‚åº¦ï¼šO(n)</h3>
<ul>
<li>åªéœ€è¦éå†æ•°ç»„ä¸€æ¬¡</li>
<li>å“ˆå¸Œè¡¨çš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)</li>
<li>æ€»ä½“æ—¶é—´å¤æ‚åº¦ä¸º O(n)</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼šO-n">ç©ºé—´å¤æ‚åº¦ï¼šO(n)</h3>
<ul>
<li>å“ˆå¸Œè¡¨æœ€å¤šå­˜å‚¨ n ä¸ªä¸åŒçš„å‰ç¼€å’Œå€¼</li>
<li>åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ‰€æœ‰å‰ç¼€å’Œéƒ½ä¸åŒï¼Œéœ€è¦ O(n) ç©ºé—´</li>
</ul>
<h3 id="æ•°å­¦æ¨å¯¼">æ•°å­¦æ¨å¯¼</h3>
<p>å¯¹äºé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œå‰ç¼€å’Œçš„è®¡ç®—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">T(n) = n Ã— O(1) = O(n)</span><br></pre></td></tr></table></figure>
<p>å“ˆå¸Œè¡¨ç©ºé—´ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S(n) = O(n)  // æœ€åæƒ…å†µä¸‹æ‰€æœ‰å‰ç¼€å’Œéƒ½ä¸åŒ</span><br></pre></td></tr></table></figure>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>å‰ç¼€å’ŒæŠ€å·§</strong>ï¼šå½“éœ€è¦é¢‘ç¹è®¡ç®—å­æ•°ç»„å’Œæ—¶ï¼Œå‰ç¼€å’Œæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æŠ€å·§</li>
<li><strong>å“ˆå¸Œè¡¨åº”ç”¨</strong>ï¼šå“ˆå¸Œè¡¨ä¸ä»…å¯ä»¥ç”¨äºå»é‡ï¼Œè¿˜å¯ä»¥ç”¨äºå¿«é€Ÿç»Ÿè®¡å’ŒæŸ¥æ‰¾</li>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šåˆå§‹åŒ– <code>count[0] = 1</code> æ˜¯å¤„ç†è¾¹ç•Œæƒ…å†µçš„å…³é”®</li>
<li><strong>æ•°å­¦æ€ç»´</strong>ï¼šå°†é—®é¢˜è½¬åŒ–ä¸º <code>prefix[j] - prefix[i] = k</code> çš„å½¢å¼ï¼Œå¤§å¤§ç®€åŒ–äº†æ±‚è§£è¿‡ç¨‹</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>å¿˜è®°åˆå§‹åŒ–</strong>ï¼šæ²¡æœ‰è®¾ç½® <code>count[0] = 1</code> ä¼šå¯¼è‡´ä»å¼€å¤´å¼€å§‹çš„å­æ•°ç»„è¢«é—æ¼</li>
<li><strong>é¡ºåºé”™è¯¯</strong>ï¼šåº”è¯¥å…ˆæŸ¥æ‰¾å†æ›´æ–°å“ˆå¸Œè¡¨ï¼Œé¿å…é‡å¤è®¡ç®—</li>
<li><strong>æ•´æ•°æº¢å‡º</strong>ï¼šå¯¹äºå¤§æ•°ç»„ï¼Œå‰ç¼€å’Œå¯èƒ½è¶…å‡º int èŒƒå›´ï¼Œéœ€è¦æ³¨æ„æ•°æ®ç±»å‹</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><a href="https://leetcode.com/problems/maximum-subarray/">LeetCode 53: Maximum Subarray</a> - æœ€å¤§å­æ•°ç»„å’Œ</li>
<li><a href="https://leetcode.com/problems/maximum-size-subarray-sum-equals-k/">LeetCode 325: Maximum Size Subarray Sum Equals k</a> - å’Œä¸ºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦</li>
<li><a href="https://leetcode.com/problems/minimum-size-subarray-sum/">LeetCode 209: Minimum Size Subarray Sum</a> - å’Œå¤§äºç­‰äºç›®æ ‡å€¼çš„æœ€çŸ­å­æ•°ç»„</li>
</ul>
<p>è¿™é“é¢˜æ˜¯å‰ç¼€å’ŒæŠ€å·§çš„ç»å…¸åº”ç”¨ï¼ŒæŒæ¡è¿™ä¸ªæ€è·¯å¯¹äºè§£å†³ç±»ä¼¼çš„å­æ•°ç»„é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>æ•°ç»„</tag>
        <tag>å‰ç¼€å’Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 149 - ç›´çº¿ä¸Šæœ€å¤šçš„ç‚¹æ•°ï¼ˆMax Points on a Lineï¼‰</title>
    <url>/2025/07/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-149-%E7%9B%B4%E7%BA%BF%E4%B8%8A%E6%9C%80%E5%A4%9A%E7%9A%84%E7%82%B9%E6%95%B0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªäºŒç»´å¹³é¢ä¸Šçš„ç‚¹æ•°ç»„ <code>points</code>ï¼Œå…¶ä¸­ <code>points[i] = [xi, yi]</code>ï¼Œè¿”å›ä½äºåŒä¸€ç›´çº¿ä¸Šçš„æœ€å¤§ç‚¹æ•°ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špoints = [[1,1],[2,2],[3,3]]</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">æ‰€æœ‰ç‚¹éƒ½åœ¨ç›´çº¿ y = x ä¸Š</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špoints = [[1,1],[3,2],[5,3],[4,1],[2,3],[1,4]]</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">æœ€å¤šæœ‰ 4 ä¸ªç‚¹åœ¨åŒä¸€ç›´çº¿ä¸Š</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= points.length &lt;= 300</code></li>
<li><code>points[i].length == 2</code></li>
<li><code>-10^4 &lt;= xi, yi &lt;= 10^4</code></li>
<li>æ‰€æœ‰ç‚¹éƒ½æ˜¯å”¯ä¸€çš„</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<h3 id="æ ¸å¿ƒç®—æ³•æ¦‚å¿µ">æ ¸å¿ƒç®—æ³•æ¦‚å¿µ</h3>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å¯¹äºæ¯ä¸ªç‚¹ï¼Œè®¡ç®—å®ƒä¸æ‰€æœ‰å…¶ä»–ç‚¹å½¢æˆçš„ç›´çº¿æ–œç‡ï¼Œç»Ÿè®¡å…·æœ‰ç›¸åŒæ–œç‡çš„ç‚¹çš„æ•°é‡</strong>ã€‚</p>
<h3 id="å…³é”®æ´è§">å…³é”®æ´è§</h3>
<ol>
<li><strong>æ–œç‡è¡¨ç¤ºç›´çº¿</strong>ï¼šä¸¤ç‚¹ç¡®å®šä¸€æ¡ç›´çº¿ï¼Œæ–œç‡æ˜¯ç›´çº¿çš„å”¯ä¸€æ ‡è¯†</li>
<li><strong>é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜</strong>ï¼šç›´æ¥ä½¿ç”¨åˆ†æ•°è¡¨ç¤ºæ–œç‡ï¼Œè€Œä¸æ˜¯æµ®ç‚¹æ•°</li>
<li><strong>å¤„ç†é‡å¤ç‚¹</strong>ï¼šéœ€è¦å•ç‹¬ç»Ÿè®¡ä¸åŸºå‡†ç‚¹é‡åˆçš„ç‚¹</li>
<li><strong>æœ€ç®€åˆ†æ•°</strong>ï¼šä½¿ç”¨æœ€å¤§å…¬çº¦æ•°å°†æ–œç‡åŒ–ä¸ºæœ€ç®€å½¢å¼</li>
</ol>
<h3 id="è§£é¢˜æ­¥éª¤">è§£é¢˜æ­¥éª¤</h3>
<h4 id="æ­¥éª¤-1ï¼šæšä¸¾åŸºå‡†ç‚¹">æ­¥éª¤ 1ï¼šæšä¸¾åŸºå‡†ç‚¹</h4>
<ul>
<li>éå†æ¯ä¸ªç‚¹ä½œä¸ºåŸºå‡†ç‚¹</li>
<li>å¯¹äºæ¯ä¸ªåŸºå‡†ç‚¹ï¼Œè®¡ç®—å®ƒä¸æ‰€æœ‰å…¶ä»–ç‚¹å½¢æˆçš„ç›´çº¿</li>
</ul>
<h4 id="æ­¥éª¤-2ï¼šè®¡ç®—æ–œç‡">æ­¥éª¤ 2ï¼šè®¡ç®—æ–œç‡</h4>
<ul>
<li>å¯¹äºåŸºå‡†ç‚¹ <code>(x1, y1)</code> å’Œå¦ä¸€ä¸ªç‚¹ <code>(x2, y2)</code></li>
<li>æ–œç‡ = <code>(y2 - y1) / (x2 - x1)</code></li>
<li>ä½¿ç”¨æœ€ç®€åˆ†æ•°è¡¨ç¤ºï¼š<code>(dy/gcd(dx, dy), dx/gcd(dx, dy))</code></li>
</ul>
<h4 id="æ­¥éª¤-3ï¼šç»Ÿè®¡å…±çº¿ç‚¹">æ­¥éª¤ 3ï¼šç»Ÿè®¡å…±çº¿ç‚¹</h4>
<ul>
<li>ä½¿ç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªæ–œç‡å¯¹åº”çš„ç‚¹æ•°</li>
<li>åŒæ—¶ç»Ÿè®¡ä¸åŸºå‡†ç‚¹é‡åˆçš„ç‚¹æ•°</li>
<li>æœ€ç»ˆç»“æœ = é‡åˆç‚¹æ•° + æœ€å¤§æ–œç‡å¯¹åº”çš„ç‚¹æ•°</li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ–œç‡è®¡ç®—ä¼˜åŒ–">æ–œç‡è®¡ç®—ä¼˜åŒ–</h3>
<p>ä¸ºäº†é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€ç®€åˆ†æ•°è¡¨ç¤ºæ–œç‡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dx := points[j][<span class="number">0</span>] - points[i][<span class="number">0</span>]</span><br><span class="line">dy := points[j][<span class="number">1</span>] - points[i][<span class="number">1</span>]</span><br><span class="line">g := gcd(dx, dy)</span><br><span class="line">slope := [<span class="number">2</span>]<span class="type">int</span>&#123;dx / g, dy / g&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é‡å¤ç‚¹å¤„ç†">é‡å¤ç‚¹å¤„ç†</h3>
<p>å¯¹äºä¸åŸºå‡†ç‚¹é‡åˆçš„ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬ç»Ÿè®¡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> points[j][<span class="number">0</span>] == points[i][<span class="number">0</span>] &amp;&amp; points[j][<span class="number">1</span>] == points[i][<span class="number">1</span>] &#123;</span><br><span class="line">    duplicates++</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¾¹ç•Œæƒ…å†µå¤„ç†">è¾¹ç•Œæƒ…å†µå¤„ç†</h3>
<ul>
<li>å½“ç‚¹æ•° â‰¤ 2 æ—¶ï¼Œç›´æ¥è¿”å›ç‚¹æ•°</li>
<li>å¤„ç†å‚ç›´çº¿ï¼ˆdx = 0ï¼‰å’Œæ°´å¹³çº¿ï¼ˆdy = 0ï¼‰çš„æƒ…å†µ</li>
</ul>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxPoints</span><span class="params">(points [][]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(points)</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æšä¸¾æ¯ä¸ªç‚¹ä½œä¸ºåŸºå‡†ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        hashTable := <span class="keyword">map</span>[[<span class="number">2</span>]<span class="type">int</span>]<span class="type">int</span>&#123;&#125;</span><br><span class="line">        duplicates := <span class="number">1</span>  <span class="comment">// ç»Ÿè®¡ä¸åŸºå‡†ç‚¹é‡åˆçš„ç‚¹æ•°</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—ä¸å…¶ä»–ç‚¹å½¢æˆçš„ç›´çº¿æ–œç‡</span></span><br><span class="line">        <span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; n; j++ &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†é‡å¤ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> points[j][<span class="number">0</span>] == points[i][<span class="number">0</span>] &amp;&amp; points[j][<span class="number">1</span>] == points[i][<span class="number">1</span>] &#123;</span><br><span class="line">                duplicates++</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®¡ç®—æ–œç‡ï¼ˆä½¿ç”¨æœ€ç®€åˆ†æ•°è¡¨ç¤ºï¼‰</span></span><br><span class="line">            dx := points[j][<span class="number">0</span>] - points[i][<span class="number">0</span>]</span><br><span class="line">            dy := points[j][<span class="number">1</span>] - points[i][<span class="number">1</span>]</span><br><span class="line">            g := gcd(dx, dy)</span><br><span class="line">            hashTable[[<span class="number">2</span>]<span class="type">int</span>&#123;dx / g, dy / g&#125;]++</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ›´æ–°ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> res &lt; duplicates &#123;</span><br><span class="line">            res = duplicates</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> _, count := <span class="keyword">range</span> hashTable &#123;</span><br><span class="line">            <span class="keyword">if</span> res &lt; count + duplicates &#123;</span><br><span class="line">                res = count + duplicates</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gcd</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> b != <span class="number">0</span> &#123;</span><br><span class="line">        a, b = b, a % b</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>ä»¥ç¤ºä¾‹ 2 ä¸ºä¾‹ï¼š<code>[[1,1],[3,2],[5,3],[4,1],[2,3],[1,4]]</code></p>
<ol>
<li>
<p><strong>åŸºå‡†ç‚¹ (1,1)</strong>ï¼š</p>
<ul>
<li>ä¸ (3,2) çš„æ–œç‡ï¼š<code>(2-1)/(3-1) = 1/2</code></li>
<li>ä¸ (5,3) çš„æ–œç‡ï¼š<code>(3-1)/(5-1) = 2/4 = 1/2</code></li>
<li>ä¸ (4,1) çš„æ–œç‡ï¼š<code>(1-1)/(4-1) = 0/3 = 0/1</code></li>
<li>ä¸ (2,3) çš„æ–œç‡ï¼š<code>(3-1)/(2-1) = 2/1</code></li>
<li>ä¸ (1,4) çš„æ–œç‡ï¼š<code>(4-1)/(1-1) = 3/0</code>ï¼ˆå‚ç›´çº¿ï¼‰</li>
</ul>
<p>ç»“æœï¼šæœ€å¤š 2 ä¸ªç‚¹å…±çº¿ï¼ˆæ–œç‡ä¸º 1/2ï¼‰</p>
</li>
<li>
<p><strong>åŸºå‡†ç‚¹ (3,2)</strong>ï¼š</p>
<ul>
<li>ä¸ (5,3) çš„æ–œç‡ï¼š<code>(3-2)/(5-3) = 1/2</code></li>
<li>ä¸ (4,1) çš„æ–œç‡ï¼š<code>(1-2)/(4-3) = -1/1</code></li>
<li>ä¸ (2,3) çš„æ–œç‡ï¼š<code>(3-2)/(2-3) = 1/-1 = -1/1</code></li>
<li>ä¸ (1,4) çš„æ–œç‡ï¼š<code>(4-2)/(1-3) = 2/-2 = -1/1</code></li>
</ul>
<p>ç»“æœï¼šæœ€å¤š 3 ä¸ªç‚¹å…±çº¿ï¼ˆæ–œç‡ä¸º -1/1ï¼‰</p>
</li>
</ol>
<p>æœ€ç»ˆç­”æ¡ˆä¸º 4ã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å“ˆå¸Œè¡¨æ³•</th>
<th>æš´åŠ›æšä¸¾æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(nÂ²)</td>
<td>O(nÂ³)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>é«˜æ•ˆï¼Œé¿å…é‡å¤è®¡ç®—</td>
<td>ç›´è§‚æ˜“æ‡‚</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å®ç°ç›¸å¯¹å¤æ‚</td>
<td>è¿è¡Œæ—¶é—´è¿‡é•¿</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-nÂ²">æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)</h3>
<ul>
<li>å¤–å±‚å¾ªç¯ï¼šO(n)</li>
<li>å†…å±‚å¾ªç¯ï¼šO(n)</li>
<li>æ€»æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼šO-n">ç©ºé—´å¤æ‚åº¦ï¼šO(n)</h3>
<ul>
<li>å“ˆå¸Œè¡¨å­˜å‚¨æ–œç‡ä¿¡æ¯ï¼šO(n)</li>
<li>åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç‚¹éƒ½ä¸å…±çº¿ï¼Œå“ˆå¸Œè¡¨å¤§å°ä¸º O(n)</li>
</ul>
<h3 id="è¯¦ç»†æ¨å¯¼">è¯¦ç»†æ¨å¯¼</h3>
<p>å¯¹äºæ¯ä¸ªåŸºå‡†ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ol>
<li>è®¡ç®—ä¸ n-1 ä¸ªå…¶ä»–ç‚¹çš„æ–œç‡ï¼šO(n)</li>
<li>å“ˆå¸Œè¡¨æ“ä½œï¼ˆæ’å…¥å’ŒæŸ¥æ‰¾ï¼‰ï¼šO(1) å¹³å‡æƒ…å†µ</li>
<li>æ€»æ“ä½œæ•°ï¼šn Ã— (n-1) = O(nÂ²)</li>
</ol>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="é‡è¦ç®—æ³•æ¦‚å¿µ">é‡è¦ç®—æ³•æ¦‚å¿µ</h3>
<ol>
<li><strong>å‡ ä½•é—®é¢˜çš„æ•°å­¦å»ºæ¨¡</strong>ï¼šå°†å‡ ä½•é—®é¢˜è½¬åŒ–ä¸ºæ•°å­¦è®¡ç®—</li>
<li><strong>å“ˆå¸Œè¡¨çš„åº”ç”¨</strong>ï¼šä½¿ç”¨å“ˆå¸Œè¡¨é«˜æ•ˆç»Ÿè®¡å’ŒæŸ¥æ‰¾</li>
<li><strong>ç²¾åº¦å¤„ç†æŠ€å·§</strong>ï¼šé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼Œä½¿ç”¨åˆ†æ•°è¡¨ç¤º</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜</strong>ï¼šç›´æ¥ä½¿ç”¨æµ®ç‚¹æ•°è®¡ç®—æ–œç‡å¯èƒ½å¯¼è‡´ç²¾åº¦è¯¯å·®</li>
<li><strong>é‡å¤ç‚¹å¤„ç†</strong>ï¼šå¿˜è®°ç»Ÿè®¡ä¸åŸºå‡†ç‚¹é‡åˆçš„ç‚¹</li>
<li><strong>è¾¹ç•Œæƒ…å†µ</strong>ï¼šæ²¡æœ‰æ­£ç¡®å¤„ç†å‚ç›´çº¿å’Œæ°´å¹³çº¿</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><strong>LeetCode 1232</strong>ï¼šæ£€æŸ¥ç‚¹æ˜¯å¦åœ¨ç›´çº¿ä¸Š</li>
<li><strong>LeetCode 1037</strong>ï¼šæœ‰æ•ˆçš„å›æ—‹é•–</li>
<li><strong>LeetCode 939</strong>ï¼šæœ€å°é¢ç§¯çŸ©å½¢</li>
</ul>
<h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3>
<ul>
<li>è®¡ç®—æœºå›¾å½¢å­¦ä¸­çš„ç›´çº¿æ£€æµ‹</li>
<li>å›¾åƒå¤„ç†ä¸­çš„ç‰¹å¾ç‚¹åŒ¹é…</li>
<li>åœ°ç†ä¿¡æ¯ç³»ç»Ÿä¸­çš„è·¯å¾„è§„åˆ’</li>
</ul>
<hr>
<p><strong>æ€»ç»“</strong>ï¼šè¿™é“é¢˜é€šè¿‡å·§å¦™ä½¿ç”¨å“ˆå¸Œè¡¨å’Œæ•°å­¦æŠ€å·§ï¼Œå°†å‡ ä½•é—®é¢˜è½¬åŒ–ä¸ºé«˜æ•ˆçš„ç®—æ³•é—®é¢˜ã€‚å…³é”®åœ¨äºç†è§£æ–œç‡ä½œä¸ºç›´çº¿å”¯ä¸€æ ‡è¯†çš„æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°å­¦</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>Hard</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>æ•°å­¦</tag>
        <tag>å‡ ä½•</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 50 - Pow(x, n)ï¼ˆå¿«é€Ÿå¹‚ç®—æ³•ï¼‰</title>
    <url>/2025/07/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-50-Pow-x-n/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>å®ç° <code>pow(x, n)</code>ï¼Œå³è®¡ç®— x çš„ n æ¬¡å¹‚å‡½æ•°ï¼ˆå³ï¼Œ$x^n$ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šx = 2.00000, n = 10</span><br><span class="line">è¾“å‡ºï¼š1024.00000</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šx = 2.10000, n = 3</span><br><span class="line">è¾“å‡ºï¼š9.26100</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šx = 2.00000, n = -2</span><br><span class="line">è¾“å‡ºï¼š0.25000</span><br><span class="line">è§£é‡Šï¼š2^(-2) = 1/2^2 = 1/4 = 0.25</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>$-100.0 &lt; x &lt; 100.0$</li>
<li>$-2^{31} \leq n \leq 2^{31}-1$</li>
<li>$n$ æ˜¯ä¸€ä¸ªæ•´æ•°</li>
<li>$-10^4 \leq x^n \leq 10^4$</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<h3 id="æ ¸å¿ƒç®—æ³•ï¼šå¿«é€Ÿå¹‚ï¼ˆFast-Powerï¼‰">æ ¸å¿ƒç®—æ³•ï¼šå¿«é€Ÿå¹‚ï¼ˆFast Powerï¼‰</h3>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨<strong>å¿«é€Ÿå¹‚ç®—æ³•</strong>ï¼Œä¹Ÿç§°ä¸º<strong>äºŒè¿›åˆ¶å¹‚ç®—æ³•</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„æ•°å­¦ä¼˜åŒ–æŠ€å·§ï¼Œå¯ä»¥å°†å¹‚è¿ç®—çš„æ—¶é—´å¤æ‚åº¦ä» $O(n)$ ä¼˜åŒ–åˆ° $O(\log n)$ã€‚</p>
<p><strong>å…³é”®æ´è§ï¼š</strong> ä»»ä½•æ•´æ•°éƒ½å¯ä»¥è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶å½¢å¼ï¼Œåˆ©ç”¨è¿™ä¸ªæ€§è´¨å¯ä»¥å°†å¹‚è¿ç®—åˆ†è§£ä¸ºå¤šä¸ªå¹³æ–¹è¿ç®—çš„ç»„åˆã€‚</p>
<h3 id="ç®—æ³•åŸç†">ç®—æ³•åŸç†</h3>
<ol>
<li><strong>äºŒè¿›åˆ¶åˆ†è§£</strong>ï¼šå°†æŒ‡æ•° n è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼</li>
<li><strong>å¹³æ–¹é€’æ¨</strong>ï¼šåˆ©ç”¨ $x^{2k} = (x^k)^2$ çš„æ€§è´¨</li>
<li><strong>ç´¯ä¹˜ç»“æœ</strong>ï¼šæ ¹æ®äºŒè¿›åˆ¶ä½æ˜¯å¦ä¸º 1 å†³å®šæ˜¯å¦ç´¯ä¹˜</li>
</ol>
<h3 id="å…·ä½“æ­¥éª¤">å…·ä½“æ­¥éª¤</h3>
<ol>
<li><strong>å¤„ç†è´Ÿæ•°æŒ‡æ•°</strong>ï¼šå¦‚æœ n &lt; 0ï¼Œå°† x å–å€’æ•°ï¼Œn å–ç»å¯¹å€¼</li>
<li><strong>åˆå§‹åŒ–</strong>ï¼šè®¾ç½® base = xï¼Œresult = 1</li>
<li><strong>å¾ªç¯å¤„ç†</strong>ï¼šå½“ n &gt; 0 æ—¶ï¼š
<ul>
<li>å¦‚æœ n çš„æœ€ä½ä½ä¸º 1ï¼Œå°† base ä¹˜åˆ° result ä¸­</li>
<li>base è‡ªä¹˜ï¼ˆç›¸å½“äº base = baseÂ²ï¼‰</li>
<li>n å³ç§»ä¸€ä½ï¼ˆç›¸å½“äº n = n/2ï¼‰</li>
</ul>
</li>
<li><strong>è¿”å›ç»“æœ</strong>ï¼šæœ€ç»ˆ result å³ä¸º $x^n$</li>
</ol>
<h3 id="æ•°å­¦æ¨å¯¼">æ•°å­¦æ¨å¯¼</h3>
<p>å¯¹äºä»»æ„æ­£æ•´æ•° nï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š<br>
$$n = \sum_{i=0}^{k} b_i \cdot 2^i$$</p>
<p>å…¶ä¸­ $b_i \in {0, 1}$ æ˜¯ n çš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚</p>
<p>å› æ­¤ï¼š<br>
$$x^n = x^{\sum_{i=0}^{k} b_i \cdot 2^i} = \prod_{i=0}^{k} x^{b_i \cdot 2^i} = \prod_{i=0}^{k} (x^{2^i})^{b_i}$$</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="ä½è¿ç®—æŠ€å·§">ä½è¿ç®—æŠ€å·§</h3>
<ul>
<li><code>n &amp; 1</code>ï¼šæ£€æŸ¥ n çš„æœ€ä½ä½æ˜¯å¦ä¸º 1</li>
<li><code>n &gt;&gt;= 1</code>ï¼šå°† n å³ç§»ä¸€ä½ï¼Œç›¸å½“äº n/2</li>
<li>æ¯æ¬¡å¾ªç¯ base è‡ªä¹˜ï¼Œç›¸å½“äºè®¡ç®— $x^{2^i}$</li>
</ul>
<h3 id="è¾¹ç•Œæƒ…å†µå¤„ç†">è¾¹ç•Œæƒ…å†µå¤„ç†</h3>
<ol>
<li><strong>n = 0</strong>ï¼šä»»ä½•æ•°çš„ 0 æ¬¡æ–¹éƒ½æ˜¯ 1</li>
<li><strong>n &lt; 0</strong>ï¼šè½¬æ¢ä¸ºæ­£æ•°å¤„ç†ï¼Œæœ€åå–å€’æ•°</li>
<li><strong>x = 0</strong>ï¼š0 çš„ä»»ä½•æ­£æ¬¡æ–¹éƒ½æ˜¯ 0ï¼Œ0 çš„ 0 æ¬¡æ–¹æ˜¯ 1</li>
<li><strong>n = -2^31</strong>ï¼šéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå› ä¸ºå–ç»å¯¹å€¼ä¼šæº¢å‡º</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myPow</span><span class="params">(x <span class="type">float64</span>, n <span class="type">int</span>)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†è´Ÿæ•°æŒ‡æ•°</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line">        x = <span class="number">1</span> / x</span><br><span class="line">        n = -n</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    base := x</span><br><span class="line">    res := <span class="number">1.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¿«é€Ÿå¹‚ç®—æ³•</span></span><br><span class="line">    <span class="keyword">for</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰ä½ä¸º 1ï¼Œç´¯ä¹˜åˆ°ç»“æœä¸­</span></span><br><span class="line">        <span class="keyword">if</span> n&amp;<span class="number">1</span> == <span class="number">1</span> &#123;</span><br><span class="line">            res *= base</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// base è‡ªä¹˜ï¼Œç›¸å½“äº base = baseÂ²</span></span><br><span class="line">        base *= base</span><br><span class="line">        <span class="comment">// n å³ç§»ä¸€ä½ï¼Œç›¸å½“äº n = n/2</span></span><br><span class="line">        n &gt;&gt;= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥è®¡ç®— $2^{10}$ ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹ï¼šbase = 2, res = 1, n = 10 (äºŒè¿›åˆ¶ï¼š1010)</span><br><span class="line"></span><br><span class="line">ç¬¬1è½®ï¼šn = 10 (1010)</span><br><span class="line">- n&amp;1 = 0ï¼Œä¸ç´¯ä¹˜</span><br><span class="line">- base = 2Â² = 4</span><br><span class="line">- n = 5 (101)</span><br><span class="line"></span><br><span class="line">ç¬¬2è½®ï¼šn = 5 (101)  </span><br><span class="line">- n&amp;1 = 1ï¼Œres = 1 Ã— 4 = 4</span><br><span class="line">- base = 4Â² = 16</span><br><span class="line">- n = 2 (10)</span><br><span class="line"></span><br><span class="line">ç¬¬3è½®ï¼šn = 2 (10)</span><br><span class="line">- n&amp;1 = 0ï¼Œä¸ç´¯ä¹˜</span><br><span class="line">- base = 16Â² = 256</span><br><span class="line">- n = 1 (1)</span><br><span class="line"></span><br><span class="line">ç¬¬4è½®ï¼šn = 1 (1)</span><br><span class="line">- n&amp;1 = 1ï¼Œres = 4 Ã— 256 = 1024</span><br><span class="line">- base = 256Â² = 65536</span><br><span class="line">- n = 0ï¼Œç»“æŸ</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š1024</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æš´åŠ›æ³•</th>
<th>å¿«é€Ÿå¹‚ç®—æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>$O(\log n)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(1)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç®€å•ç›´è§‚</td>
<td>é«˜æ•ˆï¼Œé€‚åˆå¤§æŒ‡æ•°</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>æ•ˆç‡ä½ï¼Œå®¹æ˜“è¶…æ—¶</td>
<td>å®ç°ç¨å¤æ‚</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼š-O-log-n">æ—¶é—´å¤æ‚åº¦ï¼š$O(\log n)$</h3>
<ul>
<li>æ¯æ¬¡å¾ªç¯ n éƒ½ä¼šå‡åŠï¼ˆå³ç§»ä¸€ä½ï¼‰</li>
<li>å¾ªç¯æ¬¡æ•°ç­‰äº n çš„äºŒè¿›åˆ¶ä½æ•°</li>
<li>å¯¹äº 32 ä½æ•´æ•°ï¼Œæœ€å¤šå¾ªç¯ 32 æ¬¡</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼š-O-1">ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$</h3>
<ul>
<li>åªä½¿ç”¨äº†å¸¸æ•°ä¸ªå˜é‡</li>
<li>ä¸ä¾èµ–è¾“å…¥è§„æ¨¡</li>
</ul>
<h3 id="æ•°å­¦è¯æ˜">æ•°å­¦è¯æ˜</h3>
<p>è®¾ n çš„äºŒè¿›åˆ¶ä½æ•°ä¸º kï¼Œåˆ™ï¼š<br>
$$k = \lfloor \log_2 n \rfloor + 1$$</p>
<p>å› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º $O(\log n)$ã€‚</p>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="é‡è¦æ¦‚å¿µ">é‡è¦æ¦‚å¿µ</h3>
<ol>
<li><strong>å¿«é€Ÿå¹‚ç®—æ³•</strong>ï¼šå°†å¹‚è¿ç®—çš„æ—¶é—´å¤æ‚åº¦ä»çº¿æ€§ä¼˜åŒ–åˆ°å¯¹æ•°çº§</li>
<li><strong>äºŒè¿›åˆ¶åˆ†è§£</strong>ï¼šåˆ©ç”¨æ•´æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºè¿›è¡Œç®—æ³•ä¼˜åŒ–</li>
<li><strong>ä½è¿ç®—æŠ€å·§</strong>ï¼šä½¿ç”¨ä½è¿ç®—è¿›è¡Œé«˜æ•ˆçš„æ•°å€¼æ“ä½œ</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>æ•´æ•°æº¢å‡º</strong>ï¼šå½“ n = -2^31 æ—¶ï¼Œå–ç»å¯¹å€¼ä¼šæº¢å‡º</li>
<li><strong>ç²¾åº¦é—®é¢˜</strong>ï¼šæµ®ç‚¹æ•°è¿ç®—å¯èƒ½å­˜åœ¨ç²¾åº¦è¯¯å·®</li>
<li><strong>è¾¹ç•Œæƒ…å†µ</strong>ï¼šéœ€è¦æ­£ç¡®å¤„ç† n = 0 å’Œ x = 0 çš„æƒ…å†µ</li>
</ol>
<h3 id="ç›¸å…³åº”ç”¨">ç›¸å…³åº”ç”¨</h3>
<ul>
<li><strong>å¯†ç å­¦</strong>ï¼šRSA ç®—æ³•ä¸­çš„æ¨¡å¹‚è¿ç®—</li>
<li><strong>å¤§æ•°è¿ç®—</strong>ï¼šå¤„ç†è¶…å¤§æ•´æ•°çš„å¹‚è¿ç®—</li>
<li><strong>çŸ©é˜µå¿«é€Ÿå¹‚</strong>ï¼šè®¡ç®—çŸ©é˜µçš„é«˜æ¬¡å¹‚</li>
<li><strong>æ–æ³¢é‚£å¥‘æ•°åˆ—</strong>ï¼šä½¿ç”¨çŸ©é˜µå¿«é€Ÿå¹‚è®¡ç®—ç¬¬ n é¡¹</li>
</ul>
<h3 id="æ‰©å±•æ€è€ƒ">æ‰©å±•æ€è€ƒ</h3>
<p>å¿«é€Ÿå¹‚ç®—æ³•çš„æ€æƒ³å¯ä»¥æ‰©å±•åˆ°ï¼š</p>
<ul>
<li><strong>çŸ©é˜µå¿«é€Ÿå¹‚</strong>ï¼šè®¡ç®—çŸ©é˜µçš„é«˜æ¬¡å¹‚</li>
<li><strong>å¤šé¡¹å¼å¿«é€Ÿå¹‚</strong>ï¼šè®¡ç®—å¤šé¡¹å¼çš„å¹‚</li>
<li><strong>æ¨¡è¿ç®—å¿«é€Ÿå¹‚</strong>ï¼šåœ¨æ¨¡è¿ç®—ä¸‹è®¡ç®—å¹‚</li>
</ul>
<p>è¿™ä¸ªç®—æ³•æ˜¯æ•°å­¦è®¡ç®—ä¸­çš„ç»å…¸ä¼˜åŒ–æŠ€å·§ï¼Œåœ¨é¢è¯•ä¸­ç»å¸¸è¢«è€ƒå¯Ÿï¼ŒæŒæ¡å®ƒå¯¹äºè§£å†³ç›¸å…³é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>ä½è¿ç®—</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>ä½è¿ç®—</tag>
        <tag>æ•°å­¦</tag>
        <tag>å¿«é€Ÿå¹‚</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 172 - é˜¶ä¹˜åçš„é›¶ï¼ˆFactorial Trailing Zeroesï¼‰</title>
    <url>/2025/07/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-172-%E9%98%B6%E4%B9%98%E5%90%8E%E7%9A%84%E9%9B%B6/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªæ•´æ•° <code>n</code>ï¼Œè¿”å› <code>n!</code> ç»“æœä¸­å°¾éšé›¶çš„æ•°é‡ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 3</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼š3! = 6ï¼Œä¸å«å°¾éšé›¶ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 5</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">è§£é‡Šï¼š5! = 120ï¼Œæœ‰ä¸€ä¸ªå°¾éšé›¶ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 0</span><br><span class="line">è¾“å‡ºï¼š0</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>0 &lt;= n &lt;= 10^4</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<h3 id="æ ¸å¿ƒæ´è§">æ ¸å¿ƒæ´è§</h3>
<p><strong>é˜¶ä¹˜æœ«å°¾çš„é›¶æ˜¯ç”±å› å­ä¸­çš„ 2 å’Œ 5 é…å¯¹äº§ç”Ÿçš„</strong>ã€‚åœ¨é˜¶ä¹˜ä¸­ï¼Œ2 çš„ä¸ªæ•°æ€»æ˜¯æ¯” 5 å¤šï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ç»Ÿè®¡å› å­ä¸­ 5 çš„ä¸ªæ•°å³å¯ã€‚</p>
<h3 id="è¯¦ç»†åˆ†æ">è¯¦ç»†åˆ†æ</h3>
<ol>
<li><strong>é›¶çš„äº§ç”ŸåŸç†</strong>ï¼šæ¯ä¸ªå°¾éšé›¶éƒ½å¯¹åº”ä¸€ä¸ªå› å­ 10ï¼Œè€Œ 10 = 2 Ã— 5</li>
<li><strong>2 å’Œ 5 çš„åˆ†å¸ƒ</strong>ï¼šåœ¨é˜¶ä¹˜ä¸­ï¼Œå¶æ•°æ¯” 5 çš„å€æ•°æ›´é¢‘ç¹ï¼Œæ‰€ä»¥ 2 çš„ä¸ªæ•°æ€»æ˜¯è¶³å¤Ÿå¤š</li>
<li><strong>5 çš„æ¥æº</strong>ï¼š
<ul>
<li>ç›´æ¥åŒ…å«å› å­ 5 çš„æ•°ï¼š5, 10, 15, 20, â€¦</li>
<li>åŒ…å«å› å­ 25 çš„æ•°ï¼š25, 50, 75, â€¦ï¼ˆè´¡çŒ®ä¸¤ä¸ª 5ï¼‰</li>
<li>åŒ…å«å› å­ 125 çš„æ•°ï¼š125, 250, â€¦ï¼ˆè´¡çŒ®ä¸‰ä¸ª 5ï¼‰</li>
</ul>
</li>
</ol>
<h3 id="è®¡ç®—æ–¹æ³•">è®¡ç®—æ–¹æ³•</h3>
<p>å¯¹äºæ¯ä¸ª 5 çš„å¹‚æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿè®¡å…¶è´¡çŒ®ï¼š</p>
<ul>
<li>5Â¹ çš„è´¡çŒ®ï¼š<code>âŒŠn/5âŒ‹</code></li>
<li>5Â² çš„è´¡çŒ®ï¼š<code>âŒŠn/25âŒ‹</code></li>
<li>5Â³ çš„è´¡çŒ®ï¼š<code>âŒŠn/125âŒ‹</code></li>
<li>â€¦</li>
</ul>
<p>æ€»é›¶çš„ä¸ªæ•° = <code>âŒŠn/5âŒ‹ + âŒŠn/25âŒ‹ + âŒŠn/125âŒ‹ + ...</code></p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šè¿­ä»£è®¡ç®—">æ–¹æ³•ä¸€ï¼šè¿­ä»£è®¡ç®—</h3>
<p>é€šè¿‡ä¸æ–­é™¤ä»¥ 5 æ¥è®¡ç®—æ‰€æœ‰ 5 çš„å¹‚æ¬¡çš„è´¡çŒ®ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">trailingZeroes</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    ans := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">        n /= <span class="number">5</span></span><br><span class="line">        ans += n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šç›´æ¥è®¡ç®—ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰">æ–¹æ³•äºŒï¼šç›´æ¥è®¡ç®—ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">trailingZeroes</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n &gt;= <span class="number">5</span> &#123;</span><br><span class="line">        count += n / <span class="number">5</span></span><br><span class="line">        n /= <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=172 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [172] é˜¶ä¹˜åçš„é›¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">trailingZeroes</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	ans := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">		n /= <span class="number">5</span></span><br><span class="line">		ans += n</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ <code>n = 25</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>
<p>ç¬¬ä¸€æ¬¡å¾ªç¯ï¼š<code>n = 25, ans = 0</code></p>
<ul>
<li><code>n = 25 / 5 = 5</code></li>
<li><code>ans = 0 + 5 = 5</code></li>
</ul>
</li>
<li>
<p>ç¬¬äºŒæ¬¡å¾ªç¯ï¼š<code>n = 5, ans = 5</code></p>
<ul>
<li><code>n = 5 / 5 = 1</code></li>
<li><code>ans = 5 + 1 = 6</code></li>
</ul>
</li>
<li>
<p>ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼š<code>n = 1, ans = 6</code></p>
<ul>
<li><code>n = 1 / 5 = 0</code></li>
<li><code>ans = 6 + 0 = 6</code></li>
</ul>
</li>
<li>
<p>å¾ªç¯ç»“æŸï¼Œè¿”å› <code>ans = 6</code></p>
</li>
</ol>
<p>éªŒè¯ï¼š25! = 15511210043330985984000000ï¼Œæœ«å°¾ç¡®å®æœ‰ 6 ä¸ªé›¶ã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è¿­ä»£è®¡ç®—æ³•</th>
<th>ç›´æ¥è®¡ç®—æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(log n)</td>
<td>O(log n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ä»£ç ç®€æ´</td>
<td>é€»è¾‘æ¸…æ™°</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>æ— </td>
<td>æ— </td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p><strong>O(log n)</strong></p>
<ul>
<li>æ¯æ¬¡å¾ªç¯éƒ½å°† n é™¤ä»¥ 5</li>
<li>å¾ªç¯æ¬¡æ•°ä¸º logâ‚…(n)</li>
<li>ç”±äº 5 &gt; 1ï¼Œæ‰€ä»¥ logâ‚…(n) &lt; logâ‚‚(n) = O(log n)</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<p><strong>O(1)</strong></p>
<ul>
<li>åªä½¿ç”¨äº†å¸¸æ•°ä¸ªå˜é‡</li>
<li>ä¸ä¾èµ–è¾“å…¥è§„æ¨¡</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="é‡è¦æ¦‚å¿µ">é‡è¦æ¦‚å¿µ</h3>
<ol>
<li><strong>é˜¶ä¹˜æœ«å°¾é›¶çš„æœ¬è´¨</strong>ï¼šç”±å› å­ 2 å’Œ 5 é…å¯¹äº§ç”Ÿ</li>
<li><strong>æ•°å­¦ä¼˜åŒ–</strong>ï¼šé€šè¿‡åˆ†æå› å­åˆ†å¸ƒï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºç»Ÿè®¡ 5 çš„ä¸ªæ•°</li>
<li><strong>è¿­ä»£æŠ€å·§</strong>ï¼šé€šè¿‡ä¸æ–­é™¤ä»¥ 5 æ¥ç»Ÿè®¡æ‰€æœ‰ 5 çš„å¹‚æ¬¡è´¡çŒ®</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>ç›´æ¥è®¡ç®—é˜¶ä¹˜</strong>ï¼šå¯¹äºå¤§æ•°ä¼šå¯¼è‡´æº¢å‡º</li>
<li><strong>å¿½ç•¥é«˜æ¬¡å¹‚</strong>ï¼šåªè€ƒè™‘å•ä¸ª 5 è€Œå¿½ç•¥ 25ã€125 ç­‰çš„è´¡çŒ®</li>
<li><strong>è¾¹ç•Œæƒ…å†µ</strong>ï¼šn = 0 æ—¶åº”è¯¥è¿”å› 0</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><a href="https://leetcode.com/problems/preimage-size-of-factorial-zeroes-function/">LeetCode 793: é˜¶ä¹˜å‡½æ•°å K ä¸ªé›¶</a></li>
<li><a href="https://leetcode.com/problems/count-primes/">LeetCode 204: è®¡æ•°è´¨æ•°</a></li>
</ul>
<h3 id="å®é™…åº”ç”¨">å®é™…åº”ç”¨</h3>
<ul>
<li>å¤§æ•°é˜¶ä¹˜è®¡ç®—ä¸­çš„é›¶ç»Ÿè®¡</li>
<li>æ•°å­¦ç«èµ›ä¸­çš„æ•°è®ºé—®é¢˜</li>
<li>ç®—æ³•å¤æ‚åº¦åˆ†æä¸­çš„å¯¹æ•°è®¡ç®—</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°å­¦</category>
      </categories>
      <tags>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ•°å­¦</tag>
        <tag>æ•°è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode-23-åˆå¹¶ K ä¸ªå‡åºé“¾è¡¨</title>
    <url>/2025/07/09/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-23-%E5%90%88%E5%B9%B6-K-%E4%B8%AA%E5%8D%87%E5%BA%8F%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚</p>
<p>è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šlists = [[1,4,5],[1,3,4],[2,6]]</span><br><span class="line">è¾“å‡ºï¼š[1,1,2,3,4,4,5,6]</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨æ•°ç»„å¦‚ä¸‹ï¼š</span><br><span class="line">[</span><br><span class="line">  1-&gt;4-&gt;5,</span><br><span class="line">  1-&gt;3-&gt;4,</span><br><span class="line">  2-&gt;6</span><br><span class="line">]</span><br><span class="line">å°†å®ƒä»¬åˆå¹¶åˆ°ä¸€ä¸ªæœ‰åºé“¾è¡¨ä¸­å¾—åˆ°ã€‚</span><br><span class="line">1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šlists = []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šlists = [[]]</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li><code>k == lists.length</code></li>
<li><code>0 &lt;= k &lt;= 10^4</code></li>
<li><code>0 &lt;= lists[i].length &lt;= 500</code></li>
<li><code>-10^4 &lt;= lists[i][j] &lt;= 10^4</code></li>
<li><code>lists[i]</code> æŒ‰ <strong>å‡åº</strong> æ’åˆ—</li>
<li><code>lists[i].length</code> çš„æ€»å’Œä¸è¶…è¿‡ <code>10^4</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šæœ€å°å †">æ–¹æ³•ä¸€ï¼šæœ€å°å †</h3>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæœ€å°å †æ¥ç»´æŠ¤ <code>k</code> ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚æ¯æ¬¡ä»å †ä¸­å–å‡ºæœ€å°çš„èŠ‚ç‚¹ï¼Œå°†å…¶åŠ å…¥åˆ°ç»“æœé“¾è¡¨ä¸­ï¼Œç„¶åå°†è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥åˆ°å †ä¸­ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹é‡å¤è¿›è¡Œï¼Œç›´åˆ°å †ä¸ºç©ºã€‚</p>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> O(N log k)ï¼Œå…¶ä¸­ <code>N</code> æ˜¯æ‰€æœ‰é“¾è¡¨ä¸­å…ƒç´ çš„æ€»æ•°ï¼Œ<code>k</code> æ˜¯é“¾è¡¨çš„æ•°é‡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> O(k)ï¼Œå †ä¸­æœ€å¤šå­˜å‚¨ <code>k</code> ä¸ªå…ƒç´ ã€‚</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=23 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [23] åˆå¹¶ K ä¸ªå‡åºé“¾è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æœ€å°å †</span></span><br><span class="line"><span class="comment">* æ—¶é—´å¤æ‚åº¦ï¼šO(nlogk)</span></span><br><span class="line"><span class="comment">* ç©ºé—´å¤æ‚åº¦ï¼šO(k)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ListItem <span class="keyword">struct</span> &#123;</span><br><span class="line">	index <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ListMinHeap <span class="keyword">struct</span> &#123;</span><br><span class="line">	data  []*ListItem</span><br><span class="line">	lists *[]*ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewListMinHeap</span><span class="params">(lists *[]*ListNode)</span></span> *ListMinHeap &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;ListMinHeap&#123;</span><br><span class="line">		data:  []*ListItem&#123;&#125;,</span><br><span class="line">		lists: lists,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(heap *ListMinHeap)</span></span> Smaller(index1, index2 <span class="type">int</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (*(heap.lists))[heap.data[index1].index].Val &lt; (*(heap.lists))[heap.data[index2].index].Val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(heap *ListMinHeap)</span></span> Push(x *ListItem) &#123;</span><br><span class="line">	heap.data = <span class="built_in">append</span>(heap.data, x)</span><br><span class="line">	n := <span class="built_in">len</span>(heap.data) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> n != <span class="number">0</span> &amp;&amp; heap.Smaller(n, (n<span class="number">-1</span>)/<span class="number">2</span>) &#123;</span><br><span class="line">		heap.data[n], heap.data[(n<span class="number">-1</span>)/<span class="number">2</span>] = heap.data[(n<span class="number">-1</span>)/<span class="number">2</span>], heap.data[n]</span><br><span class="line">		n = (n - <span class="number">1</span>) / <span class="number">2</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(heap *ListMinHeap)</span></span> Pop() *ListItem &#123;</span><br><span class="line">	top := heap.data[<span class="number">0</span>]</span><br><span class="line">	heap.data[<span class="number">0</span>] = heap.data[<span class="built_in">len</span>(heap.data)<span class="number">-1</span>]</span><br><span class="line">	heap.data = heap.data[:<span class="built_in">len</span>(heap.data)<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">	index := <span class="number">0</span></span><br><span class="line">	heapLen := <span class="built_in">len</span>(heap.data)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		leftChildren := <span class="number">2</span>*index + <span class="number">1</span></span><br><span class="line">		rightChildren := <span class="number">2</span>*index + <span class="number">2</span></span><br><span class="line"></span><br><span class="line">		minIndex := index</span><br><span class="line">		<span class="keyword">if</span> leftChildren &lt; heapLen &amp;&amp; heap.Smaller(leftChildren, minIndex) &#123;</span><br><span class="line">			minIndex = leftChildren</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> rightChildren &lt; heapLen &amp;&amp; heap.Smaller(rightChildren, minIndex) &#123;</span><br><span class="line">			minIndex = rightChildren</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> minIndex == index &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		heap.data[index], heap.data[minIndex] = heap.data[minIndex], heap.data[index]</span><br><span class="line"></span><br><span class="line">		index = minIndex</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> top</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeKLists</span><span class="params">(lists []*ListNode)</span></span> *ListNode &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(lists) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dummyHead := &amp;ListNode&#123;&#125;</span><br><span class="line"></span><br><span class="line">	h := NewListMinHeap(&amp;lists)</span><br><span class="line"></span><br><span class="line">	remain := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(lists); i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> lists[i] == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		remain++</span><br><span class="line">		h.Push(&amp;ListItem&#123;index: i&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cur := dummyHead</span><br><span class="line">	<span class="keyword">for</span> remain != <span class="number">0</span> &#123;</span><br><span class="line">		<span class="comment">// å¤„ç†æœ€åä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line">		<span class="keyword">if</span> remain == <span class="number">1</span> &#123;</span><br><span class="line">			cur.Next = lists[h.Pop().index]</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		top := h.Pop()</span><br><span class="line">		minIndex := top.index</span><br><span class="line"></span><br><span class="line">		cur.Next = lists[minIndex]</span><br><span class="line"></span><br><span class="line">		lists[minIndex] = lists[minIndex].Next</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> lists[minIndex] == <span class="literal">nil</span> &#123;</span><br><span class="line">			remain--</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// æ”¾å›å»é‡æ–°æ’åº</span></span><br><span class="line">			h.Push(top)</span><br><span class="line">		&#125;</span><br><span class="line">		cur = cur.Next</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dummyHead.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šé¡ºåºåˆå¹¶">æ–¹æ³•äºŒï¼šé¡ºåºåˆå¹¶</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸¤ä¸¤åˆå¹¶é“¾è¡¨çš„æ–¹å¼æ¥å®ç°ã€‚æ¯æ¬¡å°†ä¸¤ä¸ªé“¾è¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„é“¾è¡¨ï¼Œç›´åˆ°æ‰€æœ‰é“¾è¡¨éƒ½åˆå¹¶å®Œæ¯•ã€‚</p>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> O(N*k)ï¼Œå…¶ä¸­ <code>N</code> æ˜¯æ‰€æœ‰é“¾è¡¨ä¸­å…ƒç´ çš„æ€»æ•°ï¼Œ<code>k</code> æ˜¯é“¾è¡¨çš„æ•°é‡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> O(1)ã€‚</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* é¡ºåºåˆå¹¶</span></span><br><span class="line"><span class="comment">* æ—¶é—´å¤æ‚åº¦ï¼šO(n*k)</span></span><br><span class="line"><span class="comment">* ç©ºé—´å¤æ‚åº¦ï¼šO(1)é¡ºåºåˆå¹¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeKListsSequential</span><span class="params">(lists []*ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(lists) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(lists) == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lists[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    merge := <span class="function"><span class="keyword">func</span><span class="params">(l1, l2 *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">        dummy := &amp;ListNode&#123;&#125;</span><br><span class="line">        cur := dummy</span><br><span class="line">        <span class="keyword">for</span> l1 != <span class="literal">nil</span> &amp;&amp; l2 != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> l1.Val &lt; l2.Val &#123;</span><br><span class="line">                cur.Next = l1</span><br><span class="line">                l1 = l1.Next</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cur.Next = l2</span><br><span class="line">                l2 = l2.Next</span><br><span class="line">            &#125;</span><br><span class="line">            cur = cur.Next</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> l1 != <span class="literal">nil</span> &#123;</span><br><span class="line">            cur.Next = l1</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> l2 != <span class="literal">nil</span> &#123;</span><br><span class="line">            cur.Next = l2</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res := lists[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(lists); i++ &#123;</span><br><span class="line">        res = merge(res, lists[i])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†ä¸¤ç§è§£å†³ â€œåˆå¹¶ K ä¸ªå‡åºé“¾è¡¨â€ é—®é¢˜çš„æ–¹æ³•ã€‚</p>
<ul>
<li><strong>æœ€å°å †</strong> çš„æ–¹æ³•åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½è¡¨ç°å¾—æ›´ä¼˜ï¼Œå°¤å…¶æ˜¯åœ¨ <code>k</code> å€¼è¾ƒå¤§çš„æƒ…å†µä¸‹ã€‚</li>
<li><strong>é¡ºåºåˆå¹¶</strong> çš„æ–¹æ³•å®ç°èµ·æ¥æ›´ç®€å•ç›´è§‚ï¼Œä½†æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ã€‚</li>
</ul>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¨èä½¿ç”¨æœ€å°å †çš„æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>é“¾è¡¨</tag>
        <tag>å †</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: æ‚²è§‚é”ä¸ä¹è§‚é”</title>
    <url>/2025/07/06/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/</url>
    <content><![CDATA[<h1>5.5 ä»€ä¹ˆæ˜¯æ‚²è§‚é”ã€ä¹è§‚é”ï¼Ÿ</h1>
<p>å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºçš„æ—¶å€™ï¼Œé¿å…ä¸äº†èµ„æºç«äº‰è€Œå¯¼è‡´æ•°æ®é”™ä¹±çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œéƒ½ä¼šåœ¨è®¿é—®å…±äº«èµ„æºä¹‹å‰åŠ é”ã€‚</p>
<p>æœ€å¸¸ç”¨çš„å°±æ˜¯äº’æ–¥é”ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šç§ä¸åŒçš„é”ï¼Œæ¯”å¦‚è‡ªæ—‹é”ã€è¯»å†™é”ã€ä¹è§‚é”ç­‰ï¼Œä¸åŒç§ç±»çš„é”è‡ªç„¶é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚</p>
<p>å¦‚æœé€‰æ‹©äº†é”™è¯¯çš„é”ï¼Œé‚£ä¹ˆåœ¨ä¸€äº›é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¼šé™ä½ç³»ç»Ÿçš„æ€§èƒ½ï¼Œè¿™æ ·ç”¨æˆ·ä½“éªŒå°±ä¼šéå¸¸å·®äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºäº†é€‰æ‹©åˆé€‚çš„é”ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦æ¸…æ¥šçŸ¥é“åŠ é”çš„æˆæœ¬å¼€é”€æœ‰å¤šå¤§ï¼Œè¿˜éœ€è¦åˆ†æä¸šåŠ¡åœºæ™¯ä¸­è®¿é—®çš„å…±äº«èµ„æºçš„æ–¹å¼ï¼Œå†æ¥è¿˜è¦è€ƒè™‘å¹¶å‘è®¿é—®å…±äº«èµ„æºæ—¶çš„å†²çªæ¦‚ç‡ã€‚</p>
<p>å¯¹ç—‡ä¸‹è¯ï¼Œæ‰èƒ½å‡å°‘é”å¯¹é«˜å¹¶å‘æ€§èƒ½çš„å½±å“ã€‚</p>
<p>é‚£æ¥ä¸‹æ¥ï¼Œé’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œè°ˆä¸€è°ˆã€Œ<strong>äº’æ–¥é”ã€è‡ªæ—‹é”ã€è¯»å†™é”ã€ä¹è§‚é”ã€æ‚²è§‚é”</strong>ã€çš„é€‰æ‹©å’Œä½¿ç”¨ã€‚</p>
<h2 id="äº’æ–¥é”ä¸è‡ªæ—‹é”">äº’æ–¥é”ä¸è‡ªæ—‹é”</h2>
<p>æœ€åº•å±‚çš„ä¸¤ç§å°±æ˜¯ä¼šã€Œäº’æ–¥é”å’Œè‡ªæ—‹é”ã€ï¼Œæœ‰å¾ˆå¤šé«˜çº§çš„é”éƒ½æ˜¯åŸºäºå®ƒä»¬å®ç°çš„ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒä»¬æ˜¯å„ç§é”çš„åœ°åŸºï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ¸…æ¥šå®ƒä¿©ä¹‹é—´çš„åŒºåˆ«å’Œåº”ç”¨ã€‚</p>
<p>åŠ é”çš„ç›®çš„å°±æ˜¯ä¿è¯å…±äº«èµ„æºåœ¨ä»»æ„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¤šçº¿ç¨‹å¯¼è‡´å…±äº«æ•°æ®é”™ä¹±çš„é—®é¢˜ã€‚</p>
<p>å½“å·²ç»æœ‰ä¸€ä¸ªçº¿ç¨‹åŠ é”åï¼Œå…¶ä»–çº¿ç¨‹åŠ é”åˆ™å°±ä¼šå¤±è´¥ï¼Œäº’æ–¥é”å’Œè‡ªæ—‹é”å¯¹äºåŠ é”å¤±è´¥åçš„å¤„ç†æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼š</p>
<ul>
<li><strong>äº’æ–¥é”</strong>åŠ é”å¤±è´¥åï¼Œçº¿ç¨‹ä¼š<strong>é‡Šæ”¾ CPU</strong> ï¼Œç»™å…¶ä»–çº¿ç¨‹ï¼›</li>
<li><strong>è‡ªæ—‹é”</strong>åŠ é”å¤±è´¥åï¼Œçº¿ç¨‹ä¼š<strong>å¿™ç­‰å¾…</strong>ï¼Œç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼›</li>
</ul>
<p>äº’æ–¥é”æ˜¯ä¸€ç§ã€Œç‹¬å é”ã€ï¼Œæ¯”å¦‚å½“çº¿ç¨‹ A åŠ é”æˆåŠŸåï¼Œæ­¤æ—¶äº’æ–¥é”å·²ç»è¢«çº¿ç¨‹ A ç‹¬å äº†ï¼Œåªè¦çº¿ç¨‹ A æ²¡æœ‰é‡Šæ”¾æ‰‹ä¸­çš„é”ï¼Œçº¿ç¨‹ B åŠ é”å°±ä¼šå¤±è´¥ï¼Œäºæ˜¯å°±ä¼šé‡Šæ”¾ CPU è®©ç»™å…¶ä»–çº¿ç¨‹ï¼Œ<strong>æ—¢ç„¶çº¿ç¨‹ B é‡Šæ”¾æ‰äº† CPUï¼Œè‡ªç„¶çº¿ç¨‹ B åŠ é”çš„ä»£ç å°±ä¼šè¢«é˜»å¡</strong>ã€‚</p>
<p><strong>å¯¹äºäº’æ–¥é”åŠ é”å¤±è´¥è€Œé˜»å¡çš„ç°è±¡ï¼Œæ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°çš„</strong>ã€‚å½“åŠ é”å¤±è´¥æ—¶ï¼Œå†…æ ¸ä¼šå°†çº¿ç¨‹ç½®ä¸ºã€Œç¡çœ ã€çŠ¶æ€ï¼Œç­‰åˆ°é”è¢«é‡Šæ”¾åï¼Œå†…æ ¸ä¼šåœ¨åˆé€‚çš„æ—¶æœºå”¤é†’çº¿ç¨‹ï¼Œå½“è¿™ä¸ªçº¿ç¨‹æˆåŠŸè·å–åˆ°é”åï¼Œäºæ˜¯å°±å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/07/06/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/1751786419492.png" alt="1751786419492"></p>
<p>æ‰€ä»¥ï¼Œäº’æ–¥é”åŠ é”å¤±è´¥æ—¶ï¼Œä¼šä»ç”¨æˆ·æ€é™·å…¥åˆ°å†…æ ¸æ€ï¼Œè®©å†…æ ¸å¸®æˆ‘ä»¬åˆ‡æ¢çº¿ç¨‹ï¼Œè™½ç„¶ç®€åŒ–äº†ä½¿ç”¨é”çš„éš¾åº¦ï¼Œä½†æ˜¯å­˜åœ¨ä¸€å®šçš„æ€§èƒ½å¼€é”€æˆæœ¬ã€‚</p>
<p>é‚£è¿™ä¸ªå¼€é”€æˆæœ¬æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¼šæœ‰<strong>ä¸¤æ¬¡çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬</strong>ï¼š</p>
<ul>
<li>å½“çº¿ç¨‹åŠ é”å¤±è´¥æ—¶ï¼Œå†…æ ¸ä¼šæŠŠçº¿ç¨‹çš„çŠ¶æ€ä»ã€Œè¿è¡Œã€çŠ¶æ€è®¾ç½®ä¸ºã€Œç¡çœ ã€çŠ¶æ€ï¼Œç„¶åæŠŠ CPU åˆ‡æ¢ç»™å…¶ä»–çº¿ç¨‹è¿è¡Œï¼›</li>
<li>æ¥ç€ï¼Œå½“é”è¢«é‡Šæ”¾æ—¶ï¼Œä¹‹å‰ã€Œç¡çœ ã€çŠ¶æ€çš„çº¿ç¨‹ä¼šå˜ä¸ºã€Œå°±ç»ªã€çŠ¶æ€ï¼Œç„¶åå†…æ ¸ä¼šåœ¨åˆé€‚çš„æ—¶é—´ï¼ŒæŠŠ CPU åˆ‡æ¢ç»™è¯¥çº¿ç¨‹è¿è¡Œã€‚</li>
</ul>
<p>çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ˜¯ä»€ä¹ˆï¼Ÿå½“ä¸¤ä¸ªçº¿ç¨‹æ˜¯å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œ<strong>å› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨åˆ‡æ¢æ—¶ï¼Œè™šæ‹Ÿå†…å­˜è¿™äº›èµ„æºå°±ä¿æŒä¸åŠ¨ï¼Œåªéœ€è¦åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ã€‚</strong></p>
<p>ä¸Šä¸‹æ–‡åˆ‡æ¢çš„è€—æ—¶æœ‰å¤§ä½¬ç»Ÿè®¡è¿‡ï¼Œå¤§æ¦‚åœ¨å‡ åçº³ç§’åˆ°å‡ å¾®ç§’ä¹‹é—´ï¼Œå¦‚æœä½ é”ä½çš„ä»£ç æ‰§è¡Œæ—¶é—´æ¯”è¾ƒçŸ­ï¼Œé‚£å¯èƒ½ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶é—´éƒ½æ¯”ä½ é”ä½çš„ä»£ç æ‰§è¡Œæ—¶é—´è¿˜è¦é•¿ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>å¦‚æœä½ èƒ½ç¡®å®šè¢«é”ä½çš„ä»£ç æ‰§è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œå°±ä¸åº”è¯¥ç”¨äº’æ–¥é”ï¼Œè€Œåº”è¯¥é€‰ç”¨è‡ªæ—‹é”ï¼Œå¦åˆ™ä½¿ç”¨äº’æ–¥é”ã€‚</strong></p>
<p>è‡ªæ—‹é”æ˜¯é€šè¿‡ CPU æä¾›çš„ <code>CAS</code> å‡½æ•°ï¼ˆ<em>Compare And Swap</em>ï¼‰ï¼Œåœ¨ã€Œç”¨æˆ·æ€ã€å®ŒæˆåŠ é”å’Œè§£é”æ“ä½œï¼Œä¸ä¼šä¸»åŠ¨äº§ç”Ÿçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥ç›¸æ¯”äº’æ–¥é”æ¥è¯´ï¼Œä¼šå¿«ä¸€äº›ï¼Œå¼€é”€ä¹Ÿå°ä¸€äº›ã€‚</p>
<p>ä¸€èˆ¬åŠ é”çš„è¿‡ç¨‹ï¼ŒåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼ŒæŸ¥çœ‹é”çš„çŠ¶æ€ï¼Œå¦‚æœé”æ˜¯ç©ºé—²çš„ï¼Œåˆ™æ‰§è¡Œç¬¬äºŒæ­¥ï¼›</li>
<li>ç¬¬äºŒæ­¥ï¼Œå°†é”è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹æŒæœ‰ï¼›</li>
</ul>
<p>CAS å‡½æ•°å°±æŠŠè¿™ä¸¤ä¸ªæ­¥éª¤åˆå¹¶æˆä¸€æ¡ç¡¬ä»¶çº§æŒ‡ä»¤ï¼Œå½¢æˆ<strong>åŸå­æŒ‡ä»¤</strong>ï¼Œè¿™æ ·å°±ä¿è¯äº†è¿™ä¸¤ä¸ªæ­¥éª¤æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œè¦ä¹ˆä¸€æ¬¡æ€§æ‰§è¡Œå®Œä¸¤ä¸ªæ­¥éª¤ï¼Œè¦ä¹ˆä¸¤ä¸ªæ­¥éª¤éƒ½ä¸æ‰§è¡Œã€‚</p>
<p>æ¯”å¦‚ï¼Œè®¾é”ä¸ºå˜é‡ lockï¼Œæ•´æ•° 0 è¡¨ç¤ºé”æ˜¯ç©ºé—²çŠ¶æ€ï¼Œæ•´æ•° pid è¡¨ç¤ºçº¿ç¨‹ IDï¼Œé‚£ä¹ˆ CAS(lock, 0, pid) å°±è¡¨ç¤ºè‡ªæ—‹é”çš„åŠ é”æ“ä½œï¼ŒCAS(lock, pid, 0) åˆ™è¡¨ç¤ºè§£é”æ“ä½œã€‚</p>
<p>ä½¿ç”¨è‡ªæ—‹é”çš„æ—¶å€™ï¼Œå½“å‘ç”Ÿå¤šçº¿ç¨‹ç«äº‰é”çš„æƒ…å†µï¼ŒåŠ é”å¤±è´¥çš„çº¿ç¨‹ä¼šã€Œå¿™ç­‰å¾…ã€ï¼Œç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚è¿™é‡Œçš„ã€Œå¿™ç­‰å¾…ã€å¯ä»¥ç”¨ <code>while</code> å¾ªç¯ç­‰å¾…å®ç°ï¼Œä¸è¿‡æœ€å¥½æ˜¯ä½¿ç”¨ CPU æä¾›çš„ <code>PAUSE</code> æŒ‡ä»¤æ¥å®ç°ã€Œå¿™ç­‰å¾…ã€ï¼Œå› ä¸ºå¯ä»¥å‡å°‘å¾ªç¯ç­‰å¾…æ—¶çš„è€—ç”µé‡ã€‚</p>
<p>è‡ªæ—‹é”æ˜¯æœ€ç®€å•çš„ä¸€ç§é”ï¼Œä¸€ç›´è‡ªæ—‹ï¼Œåˆ©ç”¨ CPU å‘¨æœŸï¼Œç›´åˆ°é”å¯ç”¨ã€‚<strong>éœ€è¦æ³¨æ„ï¼Œåœ¨å•æ ¸ CPU ä¸Šï¼Œéœ€è¦æŠ¢å å¼çš„è°ƒåº¦å™¨ï¼ˆå³ä¸æ–­é€šè¿‡æ—¶é’Ÿä¸­æ–­ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿è¡Œå…¶ä»–çº¿ç¨‹ï¼‰ã€‚å¦åˆ™ï¼Œè‡ªæ—‹é”åœ¨å• CPU ä¸Šæ— æ³•ä½¿ç”¨ï¼Œå› ä¸ºä¸€ä¸ªè‡ªæ—‹çš„çº¿ç¨‹æ°¸è¿œä¸ä¼šæ”¾å¼ƒ CPUã€‚</strong></p>
<p>è‡ªæ—‹é”å¼€é”€å°‘ï¼Œåœ¨å¤šæ ¸ç³»ç»Ÿä¸‹ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨äº§ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œé€‚åˆå¼‚æ­¥ã€åç¨‹ç­‰åœ¨ç”¨æˆ·æ€åˆ‡æ¢è¯·æ±‚çš„ç¼–ç¨‹æ–¹å¼ï¼Œä½†å¦‚æœè¢«é”ä½çš„ä»£ç æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè‡ªæ—‹çš„çº¿ç¨‹ä¼šé•¿æ—¶é—´å ç”¨ CPU èµ„æºï¼Œæ‰€ä»¥è‡ªæ—‹çš„æ—¶é—´å’Œè¢«é”ä½çš„ä»£ç æ‰§è¡Œçš„æ—¶é—´æ˜¯æˆã€Œæ­£æ¯”ã€çš„å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦æ¸…æ¥šçš„çŸ¥é“è¿™ä¸€ç‚¹ã€‚</p>
<p>è‡ªæ—‹é”ä¸äº’æ–¥é”ä½¿ç”¨å±‚é¢æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†å®ç°å±‚é¢ä¸Šå®Œå…¨ä¸åŒï¼š<strong>å½“åŠ é”å¤±è´¥æ—¶ï¼Œäº’æ–¥é”ç”¨ã€Œçº¿ç¨‹åˆ‡æ¢ã€æ¥åº”å¯¹ï¼Œè‡ªæ—‹é”åˆ™ç”¨ã€Œå¿™ç­‰å¾…ã€æ¥åº”å¯¹</strong>ã€‚</p>
<p>å®ƒä¿©æ˜¯é”çš„æœ€åŸºæœ¬å¤„ç†æ–¹å¼ï¼Œæ›´é«˜çº§çš„é”éƒ½ä¼šé€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ¥å®ç°ï¼Œæ¯”å¦‚è¯»å†™é”æ—¢å¯ä»¥é€‰æ‹©äº’æ–¥é”å®ç°ï¼Œä¹Ÿå¯ä»¥åŸºäºè‡ªæ—‹é”å®ç°ã€‚</p>
<hr>
<h2 id="è¯»å†™é”">è¯»å†™é”</h2>
<p>è¯»å†™é”ä»å­—é¢æ„æ€æˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œå®ƒç”±ã€Œè¯»é”ã€å’Œã€Œå†™é”ã€ä¸¤éƒ¨åˆ†æ„æˆï¼Œå¦‚æœåªè¯»å–å…±äº«èµ„æºç”¨ã€Œè¯»é”ã€åŠ é”ï¼Œå¦‚æœè¦ä¿®æ”¹å…±äº«èµ„æºåˆ™ç”¨ã€Œå†™é”ã€åŠ é”ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>è¯»å†™é”é€‚ç”¨äºèƒ½æ˜ç¡®åŒºåˆ†è¯»æ“ä½œå’Œå†™æ“ä½œçš„åœºæ™¯</strong>ã€‚</p>
<p>è¯»å†™é”çš„å·¥ä½œåŸç†æ˜¯ï¼š</p>
<ul>
<li>å½“ã€Œå†™é”ã€æ²¡æœ‰è¢«çº¿ç¨‹æŒæœ‰æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹èƒ½å¤Ÿå¹¶å‘åœ°æŒæœ‰è¯»é”ï¼Œè¿™å¤§å¤§æé«˜äº†å…±äº«èµ„æºçš„è®¿é—®æ•ˆç‡ï¼Œå› ä¸ºã€Œè¯»é”ã€æ˜¯ç”¨äºè¯»å–å…±äº«èµ„æºçš„åœºæ™¯ï¼Œæ‰€ä»¥å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰è¯»é”ä¹Ÿä¸ä¼šç ´åå…±äº«èµ„æºçš„æ•°æ®ã€‚</li>
<li>ä½†æ˜¯ï¼Œä¸€æ—¦ã€Œå†™é”ã€è¢«çº¿ç¨‹æŒæœ‰åï¼Œè¯»çº¿ç¨‹çš„è·å–è¯»é”çš„æ“ä½œä¼šè¢«é˜»å¡ï¼Œè€Œä¸”å…¶ä»–å†™çº¿ç¨‹çš„è·å–å†™é”çš„æ“ä½œä¹Ÿä¼šè¢«é˜»å¡ã€‚</li>
</ul>
<p>æ‰€ä»¥è¯´ï¼Œå†™é”æ˜¯ç‹¬å é”ï¼Œå› ä¸ºä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”ï¼Œç±»ä¼¼äº’æ–¥é”å’Œè‡ªæ—‹é”ï¼Œè€Œè¯»é”æ˜¯å…±äº«é”ï¼Œå› ä¸ºè¯»é”å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰ã€‚</p>
<p>çŸ¥é“äº†è¯»å†™é”çš„å·¥ä½œåŸç†åï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<strong>è¯»å†™é”åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œèƒ½å‘æŒ¥å‡ºä¼˜åŠ¿</strong>ã€‚</p>
<p>å¦å¤–ï¼Œæ ¹æ®å®ç°çš„ä¸åŒï¼Œè¯»å†™é”å¯ä»¥åˆ†ä¸ºã€Œè¯»ä¼˜å…ˆé”ã€å’Œã€Œå†™ä¼˜å…ˆé”ã€ã€‚</p>
<p>è¯»ä¼˜å…ˆé”æœŸæœ›çš„æ˜¯ï¼Œè¯»é”èƒ½è¢«æ›´å¤šçš„çº¿ç¨‹æŒæœ‰ï¼Œä»¥ä¾¿æé«˜è¯»çº¿ç¨‹çš„å¹¶å‘æ€§ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ï¼šå½“è¯»çº¿ç¨‹ A å…ˆæŒæœ‰äº†è¯»é”ï¼Œå†™çº¿ç¨‹ B åœ¨è·å–å†™é”çš„æ—¶å€™ï¼Œä¼šè¢«é˜»å¡ï¼Œå¹¶ä¸”åœ¨é˜»å¡è¿‡ç¨‹ä¸­ï¼Œåç»­æ¥çš„è¯»çº¿ç¨‹ C ä»ç„¶å¯ä»¥æˆåŠŸè·å–è¯»é”ï¼Œæœ€åç›´åˆ°è¯»çº¿ç¨‹ A å’Œ C é‡Šæ”¾è¯»é”åï¼Œå†™çº¿ç¨‹ B æ‰å¯ä»¥æˆåŠŸè·å–å†™é”ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/07/06/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/1751786434195.png" alt="1751786434195"></p>
<p>è€Œã€Œå†™ä¼˜å…ˆé”ã€æ˜¯ä¼˜å…ˆæœåŠ¡å†™çº¿ç¨‹ï¼Œå…¶å·¥ä½œæ–¹å¼æ˜¯ï¼šå½“è¯»çº¿ç¨‹ A å…ˆæŒæœ‰äº†è¯»é”ï¼Œå†™çº¿ç¨‹ B åœ¨è·å–å†™é”çš„æ—¶å€™ï¼Œä¼šè¢«é˜»å¡ï¼Œå¹¶ä¸”åœ¨é˜»å¡è¿‡ç¨‹ä¸­ï¼Œåç»­æ¥çš„è¯»çº¿ç¨‹ C è·å–è¯»é”æ—¶ä¼šå¤±è´¥ï¼Œäºæ˜¯è¯»çº¿ç¨‹ C å°†è¢«é˜»å¡åœ¨è·å–è¯»é”çš„æ“ä½œï¼Œè¿™æ ·åªè¦è¯»çº¿ç¨‹ A é‡Šæ”¾è¯»é”åï¼Œå†™çº¿ç¨‹ B å°±å¯ä»¥æˆåŠŸè·å–å†™é”ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/07/06/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/1751786441472.png" alt="1751786441472"></p>
<p>è¯»ä¼˜å…ˆé”å¯¹äºè¯»çº¿ç¨‹å¹¶å‘æ€§æ›´å¥½ï¼Œä½†ä¹Ÿä¸æ˜¯æ²¡æœ‰é—®é¢˜ã€‚æˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸€ç›´æœ‰è¯»çº¿ç¨‹è·å–è¯»é”ï¼Œé‚£ä¹ˆå†™çº¿ç¨‹å°†æ°¸è¿œè·å–ä¸åˆ°å†™é”ï¼Œè¿™å°±é€ æˆäº†å†™çº¿ç¨‹ã€Œé¥¥é¥¿ã€çš„ç°è±¡ã€‚</p>
<p>å†™ä¼˜å…ˆé”å¯ä»¥ä¿è¯å†™çº¿ç¨‹ä¸ä¼šé¥¿æ­»ï¼Œä½†æ˜¯å¦‚æœä¸€ç›´æœ‰å†™çº¿ç¨‹è·å–å†™é”ï¼Œè¯»çº¿ç¨‹ä¹Ÿä¼šè¢«ã€Œé¥¿æ­»ã€ã€‚</p>
<p>æ—¢ç„¶ä¸ç®¡ä¼˜å…ˆè¯»é”è¿˜æ˜¯å†™é”ï¼Œå¯¹æ–¹å¯èƒ½ä¼šå‡ºç°é¥¿æ­»é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸åè¢’ä»»ä½•ä¸€æ–¹ï¼Œæä¸ªã€Œå…¬å¹³è¯»å†™é”ã€ã€‚</p>
<p><strong>å…¬å¹³è¯»å†™é”æ¯”è¾ƒç®€å•çš„ä¸€ç§æ–¹å¼æ˜¯ï¼šç”¨é˜Ÿåˆ—æŠŠè·å–é”çš„çº¿ç¨‹æ’é˜Ÿï¼Œä¸ç®¡æ˜¯å†™çº¿ç¨‹è¿˜æ˜¯è¯»çº¿ç¨‹éƒ½æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™åŠ é”å³å¯ï¼Œè¿™æ ·è¯»çº¿ç¨‹ä»ç„¶å¯ä»¥å¹¶å‘ï¼Œä¹Ÿä¸ä¼šå‡ºç°ã€Œé¥¥é¥¿ã€çš„ç°è±¡ã€‚</strong></p>
<p>äº’æ–¥é”å’Œè‡ªæ—‹é”éƒ½æ˜¯æœ€åŸºæœ¬çš„é”ï¼Œè¯»å†™é”å¯ä»¥æ ¹æ®åœºæ™¯æ¥é€‰æ‹©è¿™ä¸¤ç§é”å…¶ä¸­çš„ä¸€ä¸ªè¿›è¡Œå®ç°ã€‚</p>
<hr>
<h2 id="ä¹è§‚é”ä¸æ‚²è§‚é”">ä¹è§‚é”ä¸æ‚²è§‚é”</h2>
<p>å‰é¢æåˆ°çš„äº’æ–¥é”ã€è‡ªæ—‹é”ã€è¯»å†™é”ï¼Œéƒ½æ˜¯å±äºæ‚²è§‚é”ã€‚</p>
<p>æ‚²è§‚é”åšäº‹æ¯”è¾ƒæ‚²è§‚ï¼Œå®ƒè®¤ä¸º<strong>å¤šçº¿ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«èµ„æºçš„æ¦‚ç‡æ¯”è¾ƒé«˜ï¼Œäºæ˜¯å¾ˆå®¹æ˜“å‡ºç°å†²çªï¼Œæ‰€ä»¥è®¿é—®å…±äº«èµ„æºå‰ï¼Œå…ˆè¦ä¸Šé”</strong>ã€‚</p>
<p>é‚£ç›¸åçš„ï¼Œå¦‚æœå¤šçº¿ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«èµ„æºçš„æ¦‚ç‡æ¯”è¾ƒä½ï¼Œå°±å¯ä»¥é‡‡ç”¨ä¹è§‚é”ã€‚</p>
<p>ä¹è§‚é”åšäº‹æ¯”è¾ƒä¹è§‚ï¼Œå®ƒå‡å®šå†²çªçš„æ¦‚ç‡å¾ˆä½ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ï¼š<strong>å…ˆä¿®æ”¹å®Œå…±äº«èµ„æºï¼Œå†éªŒè¯è¿™æ®µæ—¶é—´å†…æœ‰æ²¡æœ‰å‘ç”Ÿå†²çªï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨ä¿®æ”¹èµ„æºï¼Œé‚£ä¹ˆæ“ä½œå®Œæˆï¼Œå¦‚æœå‘ç°æœ‰å…¶ä»–çº¿ç¨‹å·²ç»ä¿®æ”¹è¿‡è¿™ä¸ªèµ„æºï¼Œå°±æ”¾å¼ƒæœ¬æ¬¡æ“ä½œ</strong>ã€‚</p>
<p>æ”¾å¼ƒåå¦‚ä½•é‡è¯•ï¼Œè¿™è·Ÿä¸šåŠ¡åœºæ™¯æ¯æ¯ç›¸å…³ï¼Œè™½ç„¶é‡è¯•çš„æˆæœ¬å¾ˆé«˜ï¼Œä½†æ˜¯å†²çªçš„æ¦‚ç‡è¶³å¤Ÿä½çš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<p>å¯è§ï¼Œä¹è§‚é”çš„å¿ƒæ€æ˜¯ï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œå…ˆæ”¹äº†èµ„æºå†è¯´ã€‚å¦å¤–ï¼Œä½ ä¼šå‘ç°<strong>ä¹è§‚é”å…¨ç¨‹å¹¶æ²¡æœ‰åŠ é”ï¼Œæ‰€ä»¥å®ƒä¹Ÿå«æ— é”ç¼–ç¨‹</strong>ã€‚</p>
<p>è¿™é‡Œä¸¾ä¸€ä¸ªåœºæ™¯ä¾‹å­ï¼šåœ¨çº¿æ–‡æ¡£ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨çº¿æ–‡æ¡£å¯ä»¥åŒæ—¶å¤šäººç¼–è¾‘çš„ï¼Œå¦‚æœä½¿ç”¨äº†æ‚²è§‚é”ï¼Œé‚£ä¹ˆåªè¦æœ‰ä¸€ä¸ªç”¨æˆ·æ­£åœ¨ç¼–è¾‘æ–‡æ¡£ï¼Œæ­¤æ—¶å…¶ä»–ç”¨æˆ·å°±æ— æ³•æ‰“å¼€ç›¸åŒçš„æ–‡æ¡£äº†ï¼Œè¿™ç”¨æˆ·ä½“éªŒå½“ç„¶ä¸å¥½äº†ã€‚</p>
<p>é‚£å®ç°å¤šäººåŒæ—¶ç¼–è¾‘ï¼Œå®é™…ä¸Šæ˜¯ç”¨äº†ä¹è§‚é”ï¼Œå®ƒå…è®¸å¤šä¸ªç”¨æˆ·æ‰“å¼€åŒä¸€ä¸ªæ–‡æ¡£è¿›è¡Œç¼–è¾‘ï¼Œç¼–è¾‘å®Œæäº¤ä¹‹åæ‰éªŒè¯ä¿®æ”¹çš„å†…å®¹æ˜¯å¦æœ‰å†²çªã€‚</p>
<p>æ€ä¹ˆæ ·æ‰ç®—å‘ç”Ÿå†²çªï¼Ÿè¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç”¨æˆ· A å…ˆåœ¨æµè§ˆå™¨ç¼–è¾‘æ–‡æ¡£ï¼Œä¹‹åç”¨æˆ· B åœ¨æµè§ˆå™¨ä¹Ÿæ‰“å¼€äº†ç›¸åŒçš„æ–‡æ¡£è¿›è¡Œç¼–è¾‘ï¼Œä½†æ˜¯ç”¨æˆ· B æ¯”ç”¨æˆ· A æäº¤æ—©ï¼Œè¿™ä¸€è¿‡ç¨‹ç”¨æˆ· A æ˜¯ä¸çŸ¥é“çš„ï¼Œå½“ A æäº¤ä¿®æ”¹å®Œçš„å†…å®¹æ—¶ï¼Œé‚£ä¹ˆ A å’Œ B ä¹‹é—´å¹¶è¡Œä¿®æ”¹çš„åœ°æ–¹å°±ä¼šå‘ç”Ÿå†²çªã€‚</p>
<p>æœåŠ¡ç«¯è¦æ€ä¹ˆéªŒè¯æ˜¯å¦å†²çªäº†å‘¢ï¼Ÿé€šå¸¸æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”±äºå‘ç”Ÿå†²çªçš„æ¦‚ç‡æ¯”è¾ƒä½ï¼Œæ‰€ä»¥å…ˆè®©ç”¨æˆ·ç¼–è¾‘æ–‡æ¡£ï¼Œä½†æ˜¯æµè§ˆå™¨åœ¨ä¸‹è½½æ–‡æ¡£æ—¶ä¼šè®°å½•ä¸‹æœåŠ¡ç«¯è¿”å›çš„æ–‡æ¡£ç‰ˆæœ¬å·ï¼›</li>
<li>å½“ç”¨æˆ·æäº¤ä¿®æ”¹æ—¶ï¼Œå‘ç»™æœåŠ¡ç«¯çš„è¯·æ±‚ä¼šå¸¦ä¸ŠåŸå§‹æ–‡æ¡£ç‰ˆæœ¬å·ï¼ŒæœåŠ¡å™¨æ”¶åˆ°åå°†å®ƒä¸å½“å‰ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´åˆ™æäº¤å¤±è´¥ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸€è‡´åˆ™ä¿®æ”¹æˆåŠŸï¼Œç„¶åæœåŠ¡ç«¯ç‰ˆæœ¬å·æ›´æ–°åˆ°æœ€æ–°çš„ç‰ˆæœ¬å·ã€‚</li>
</ul>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¸¸è§çš„ SVN å’Œ Git ä¹Ÿæ˜¯ç”¨äº†ä¹è§‚é”çš„æ€æƒ³ï¼Œå…ˆè®©ç”¨æˆ·ç¼–è¾‘ä»£ç ï¼Œç„¶åæäº¤çš„æ—¶å€™ï¼Œé€šè¿‡ç‰ˆæœ¬å·æ¥åˆ¤æ–­æ˜¯å¦äº§ç”Ÿäº†å†²çªï¼Œå‘ç”Ÿäº†å†²çªçš„åœ°æ–¹ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ä¿®æ”¹åï¼Œå†é‡æ–°æäº¤ã€‚</p>
<p>ä¹è§‚é”è™½ç„¶å»é™¤äº†åŠ é”è§£é”çš„æ“ä½œï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå†²çªï¼Œé‡è¯•çš„æˆæœ¬éå¸¸é«˜ï¼Œæ‰€ä»¥<strong>åªæœ‰åœ¨å†²çªæ¦‚ç‡éå¸¸ä½ï¼Œä¸”åŠ é”æˆæœ¬éå¸¸é«˜çš„åœºæ™¯æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨ä¹è§‚é”ã€‚</strong></p>
<hr>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ€å¸¸è§çš„å°±æ˜¯äº’æ–¥é”çš„äº†ï¼Œäº’æ–¥é”åŠ é”å¤±è´¥æ—¶ï¼Œä¼šç”¨ã€Œçº¿ç¨‹åˆ‡æ¢ã€æ¥åº”å¯¹ï¼Œå½“åŠ é”å¤±è´¥çš„çº¿ç¨‹å†æ¬¡åŠ é”æˆåŠŸåçš„è¿™ä¸€è¿‡ç¨‹ï¼Œä¼šæœ‰ä¸¤æ¬¡çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬ï¼Œæ€§èƒ½æŸè€—æ¯”è¾ƒå¤§ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ˜ç¡®çŸ¥é“è¢«é”ä½çš„ä»£ç çš„æ‰§è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œé‚£æˆ‘ä»¬åº”è¯¥é€‰æ‹©å¼€é”€æ¯”è¾ƒå°çš„è‡ªæ—‹é”ï¼Œå› ä¸ºè‡ªæ—‹é”åŠ é”å¤±è´¥æ—¶ï¼Œå¹¶ä¸ä¼šä¸»åŠ¨äº§ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œè€Œæ˜¯ä¸€ç›´å¿™ç­‰å¾…ï¼Œç›´åˆ°è·å–åˆ°é”ï¼Œé‚£ä¹ˆå¦‚æœè¢«é”ä½çš„ä»£ç æ‰§è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œé‚£è¿™ä¸ªå¿™ç­‰å¾…çš„æ—¶é—´ç›¸å¯¹åº”ä¹Ÿå¾ˆçŸ­ã€‚</p>
<p>å¦‚æœèƒ½åŒºåˆ†è¯»æ“ä½œå’Œå†™æ“ä½œçš„åœºæ™¯ï¼Œé‚£è¯»å†™é”å°±æ›´åˆé€‚äº†ï¼Œå®ƒå…è®¸å¤šä¸ªè¯»çº¿ç¨‹å¯ä»¥åŒæ—¶æŒæœ‰è¯»é”ï¼Œæé«˜äº†è¯»çš„å¹¶å‘æ€§ã€‚æ ¹æ®åè¢’è¯»æ–¹è¿˜æ˜¯å†™æ–¹ï¼Œå¯ä»¥åˆ†ä¸ºè¯»ä¼˜å…ˆé”å’Œå†™ä¼˜å…ˆé”ï¼Œè¯»ä¼˜å…ˆé”å¹¶å‘æ€§å¾ˆå¼ºï¼Œä½†æ˜¯å†™çº¿ç¨‹ä¼šè¢«é¥¿æ­»ï¼Œè€Œå†™ä¼˜å…ˆé”ä¼šä¼˜å…ˆæœåŠ¡å†™çº¿ç¨‹ï¼Œè¯»çº¿ç¨‹ä¹Ÿå¯èƒ½ä¼šè¢«é¥¿æ­»ï¼Œé‚£ä¸ºäº†é¿å…é¥¥é¥¿çš„é—®é¢˜ï¼Œäºæ˜¯å°±æœ‰äº†å…¬å¹³è¯»å†™é”ï¼Œå®ƒæ˜¯ç”¨é˜Ÿåˆ—æŠŠè¯·æ±‚é”çš„çº¿ç¨‹æ’é˜Ÿï¼Œå¹¶ä¿è¯å…ˆå…¥å…ˆå‡ºçš„åŸåˆ™æ¥å¯¹çº¿ç¨‹åŠ é”ï¼Œè¿™æ ·ä¾¿ä¿è¯äº†æŸç§çº¿ç¨‹ä¸ä¼šè¢«é¥¿æ­»ï¼Œé€šç”¨æ€§ä¹Ÿæ›´å¥½ç‚¹ã€‚</p>
<p>äº’æ–¥é”å’Œè‡ªæ—‹é”éƒ½æ˜¯æœ€åŸºæœ¬çš„é”ï¼Œè¯»å†™é”å¯ä»¥æ ¹æ®åœºæ™¯æ¥é€‰æ‹©è¿™ä¸¤ç§é”å…¶ä¸­çš„ä¸€ä¸ªè¿›è¡Œå®ç°ã€‚</p>
<p>å¦å¤–ï¼Œäº’æ–¥é”ã€è‡ªæ—‹é”ã€è¯»å†™é”éƒ½å±äºæ‚²è§‚é”ï¼Œæ‚²è§‚é”è®¤ä¸ºå¹¶å‘è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå†²çªæ¦‚ç‡å¯èƒ½éå¸¸é«˜ï¼Œæ‰€ä»¥åœ¨è®¿é—®å…±äº«èµ„æºå‰ï¼Œéƒ½éœ€è¦å…ˆåŠ é”ã€‚</p>
<p>ç›¸åçš„ï¼Œå¦‚æœå¹¶å‘è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå†²çªæ¦‚ç‡éå¸¸ä½çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¹è§‚é”ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œåœ¨è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œä¸ç”¨å…ˆåŠ é”ï¼Œä¿®æ”¹å®Œå…±äº«èµ„æºåï¼Œå†éªŒè¯è¿™æ®µæ—¶é—´å†…æœ‰æ²¡æœ‰å‘ç”Ÿå†²çªï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨ä¿®æ”¹èµ„æºï¼Œé‚£ä¹ˆæ“ä½œå®Œæˆï¼Œå¦‚æœå‘ç°æœ‰å…¶ä»–çº¿ç¨‹å·²ç»ä¿®æ”¹è¿‡è¿™ä¸ªèµ„æºï¼Œå°±æ”¾å¼ƒæœ¬æ¬¡æ“ä½œã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸€æ—¦å†²çªæ¦‚ç‡ä¸Šå‡ï¼Œå°±ä¸é€‚åˆä½¿ç”¨ä¹è§‚é”äº†ï¼Œå› ä¸ºå®ƒè§£å†³å†²çªçš„é‡è¯•æˆæœ¬éå¸¸é«˜ã€‚</p>
<p>ä¸ç®¡ä½¿ç”¨çš„å“ªç§é”ï¼Œæˆ‘ä»¬çš„åŠ é”çš„ä»£ç èŒƒå›´åº”è¯¥å°½å¯èƒ½çš„å°ï¼Œä¹Ÿå°±æ˜¯åŠ é”çš„ç²’åº¦è¦å°ï¼Œè¿™æ ·æ‰§è¡Œé€Ÿåº¦ä¼šæ¯”è¾ƒå¿«ã€‚å†æ¥ï¼Œä½¿ç”¨ä¸Šäº†åˆé€‚çš„é”ï¼Œå°±ä¼šå¿«ä¸ŠåŠ å¿«äº†ã€‚</p>
<h2 id="è¯»è€…é—®ç­”">è¯»è€…é—®ç­”</h2>
<blockquote>
<p>CAS ä¸æ˜¯ä¹è§‚é”å—ï¼Œä¸ºä»€ä¹ˆåŸºäº CAS å®ç°çš„è‡ªæ—‹é”æ˜¯æ‚²è§‚é”ï¼Ÿ</p>
</blockquote>
<p>ä¹è§‚é”æ˜¯å…ˆä¿®æ”¹åŒæ­¥èµ„æºï¼Œå†éªŒè¯æœ‰æ²¡æœ‰å‘ç”Ÿå†²çªã€‚</p>
<p>æ‚²è§‚é”æ˜¯ä¿®æ”¹å…±äº«æ•°æ®å‰ï¼Œéƒ½è¦å…ˆåŠ é”ï¼Œé˜²æ­¢ç«äº‰ã€‚</p>
<p>CAS æ˜¯ä¹è§‚é”æ²¡é”™ï¼Œä½†æ˜¯ CAS å’Œè‡ªæ—‹é”ä¸åŒä¹‹å¤„ï¼Œè‡ªæ—‹é”åŸºäº CAS åŠ äº† while æˆ–è€…ç¡çœ  CPU çš„æ“ä½œè€Œäº§ç”Ÿè‡ªæ—‹çš„æ•ˆæœï¼ŒåŠ é”å¤±è´¥ä¼šå¿™ç­‰å¾…ç›´åˆ°æ‹¿åˆ°é”ï¼Œè‡ªæ—‹é”æ˜¯è¦éœ€è¦äº‹å…ˆæ‹¿åˆ°é”æ‰èƒ½ä¿®æ”¹æ•°æ®çš„ï¼Œæ‰€ä»¥ç®—æ‚²è§‚é”ã€‚</p>
<hr>
<h2 id="å…³æ³¨ä½œè€…">å…³æ³¨ä½œè€…</h2>
<p>è¿™å‘¨æœ«å¿™é‡Œå·é—²äº†ä¸‹ï¼Œçœ‹äº†ä¸‰éƒ¨ç”µå½±ï¼Œç®€å•è¯´ä¸€ä¸‹æ„Ÿå—ã€‚</p>
<p>é¦–å…ˆçœ‹äº†ã€Œåˆ©åˆƒå‡ºé˜ã€ï¼Œè¿™éƒ¨ç”µå½±æ˜¯æ‚¬ç–‘ç±»å‹ï¼Œä¹Ÿæ˜¯è±†ç“£é«˜åˆ†ç”µå½±ï¼Œç”µå½±è™½ç„¶æ²¡æœ‰ä»€ä¹ˆå¤§åœºé¢ï¼Œä½†æ˜¯å•çº¯é ç¼œå¯†çš„å‰§æƒ…é“ºè®¾ï¼Œå…¨ç¨‹æ— å°¿ç‚¹ï¼Œç»“å°¾ä¹Ÿå„ç§ç¿»è½¬ï¼Œå¦‚æœå–œæ¬¢æ‚¬ç–‘ç±»ç”µå½±æœ‹å‹ï¼Œä¸å¦¨æŠ½ä¸ªæ—¶é—´çœ‹çœ‹ã€‚</p>
<p>å†æ¥ï¼Œçœ‹äº†ã€ŒèŠ±æœ¨å…°ã€ï¼Œè¿™ç”µå½±æˆ‘ç‰¹å–µæ— æ³•å¯è¯´ï¼Œçƒ‚ç‰‡ä¸­çš„æˆ˜æ–—é¸¡ï¼Œæ¼”å‘˜éƒ½æ˜¯ä¸­å›½äººå´å…¨åœ¨è¯´è‹±æ–‡ï¼ˆå¯¼æ¼”æ˜¯ç¾å›½è¿ªå£«å°¼çš„ï¼‰ï¼Œè¿™ç§æ„Ÿè§‰å°±å¾ˆå¥‡æ€ªå¾ˆåˆ«æ‰­ï¼Œå¥½æ¯”ä½ çœ‹è¥¿æ¸¸è®°ã€æ°´æµ’ä¼ è‹±æ–‡ç‰ˆé‚£æ ·çš„åˆ«æ‰­ã€‚åˆ«æ‰­ä¹Ÿå°±ç®—äº†ï¼Œå…³é”®å‰§æƒ…å¹³æ·¡æ— å¥‡ï¼Œå„ç§æ— å˜å¤´çš„åœ°æ–¹ï¼Œåæ­£çœ‹å®Œä¹‹åï¼Œæˆ‘éå¸¸åæ‚”æŠŠæˆ‘ç”Ÿå‘½ä¸­éå¸¸çè´µçš„ 2 ä¸ªå°æ—¶çŒ®ç»™äº†å®ƒï¼Œå¦‚æœèƒ½é‡æ¥ï¼Œæˆ‘é€‰æ‹©ç”¨è¿™ 2 å°æ—¶ç¡è§‰ã€‚</p>
<p>æœ€åï¼Œå½“ç„¶çœ‹äº†ã€Œä¿¡æ¡ã€ï¼Œè¯ºå…°ç”¨å·¨èµ„æ‹æ‘„å‡ºæ¥çš„ç”µå½±ï¼ŒèŠ±é’±ä¹°é£æœºæ¥æ’ï¼Œç”»é¢éå¸¸éœ‡æ’¼ï¼Œå¯ä»¥è¯´éå¸¸æœ‰è¯šæ„äº†ã€‚è¯ºå…°é’Ÿçˆ±æ—¶é—´çš„æ¦‚å¿µï¼Œè¿™æ¬¡åˆ™ä»¥æ—¶é—´å€’æµæ–¹å¼æ¥å‘ˆç°ï¼Œéå¸¸çš„çƒ§è„‘ï¼Œåæ­£æˆ‘çœ‹å®Œåè„‘è¢‹æ‡µæ‡µçš„ï¼Œæˆ‘å°±æ˜¯è¦è¿™ç§æ„Ÿè§‰ï¼Œå˜»å˜»ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>é”</tag>
        <tag>æ‚²è§‚é”</tag>
        <tag>ä¹è§‚é”</tag>
        <tag>å¹¶å‘</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 148 - æ’åºé“¾è¡¨ï¼ˆSort Listï¼‰</title>
    <url>/2025/07/03/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-148-Sort-List/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ é“¾è¡¨çš„å¤´ç»“ç‚¹ <code>head</code>ï¼Œè¯·å°†å…¶æŒ‰ <strong>å‡åº</strong> æ’åˆ—å¹¶è¿”å› <strong>æ’åºåçš„é“¾è¡¨</strong>ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [4,2,1,3]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3,4]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [-1,5,3,4,0]</span><br><span class="line">è¾“å‡ºï¼š[-1,0,3,4,5]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure>
<h3 id="æç¤º">æç¤º</h3>
<ul>
<li>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ <code>[0, 5 * 10^4]</code> å†…</li>
<li><code>-10^5 &lt;= Node.val &lt;= 10^5</code></li>
</ul>
<h3 id="è¿›é˜¶">è¿›é˜¶</h3>
<p>ä½ å¯ä»¥åœ¨ <code>O(n log n)</code> æ—¶é—´å¤æ‚åº¦å’Œå¸¸æ•°çº§ç©ºé—´å¤æ‚åº¦ä¸‹ï¼Œå¯¹é“¾è¡¨è¿›è¡Œæ’åºå—ï¼Ÿ</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¦æ’åºé“¾è¡¨ï¼Œæœ€ç›´è§‚çš„æ–¹æ³•æ˜¯å…ˆè½¬æ¢æˆæ•°ç»„ï¼Œæ’åºåå†è½¬å›é“¾è¡¨ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•éœ€è¦ O(n) çš„é¢å¤–ç©ºé—´ã€‚å¦‚æœè¦æ»¡è¶³è¿›é˜¶è¦æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¯¹é“¾è¡¨å‹å¥½çš„å½’å¹¶æ’åºã€‚</p>
<p>å¯¹äºé“¾è¡¨æ’åºï¼Œå¯ä»¥è€ƒè™‘ä¸¤ç§å½’å¹¶æ’åºå®ç°æ–¹å¼ï¼š</p>
<ol>
<li><strong>è‡ªé¡¶å‘ä¸‹</strong>ï¼šé€’å½’å®ç°ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(log n)</li>
<li><strong>è‡ªåº•å‘ä¸Š</strong>ï¼šè¿­ä»£å®ç°ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)</li>
</ol>
<h3 id="æ–¹æ³•ä¸€ï¼šè‡ªåº•å‘ä¸Šå½’å¹¶æ’åº">æ–¹æ³•ä¸€ï¼šè‡ªåº•å‘ä¸Šå½’å¹¶æ’åº</h3>
<p>è‡ªåº•å‘ä¸Šçš„å½’å¹¶æ’åºæ˜¯ä¸€ç§éé€’å½’çš„å½’å¹¶æ’åºï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼š</p>
<ol>
<li>å…ˆå°†é“¾è¡¨æ‹†åˆ†æˆé•¿åº¦ä¸º 1 çš„å¤šä¸ªå­é“¾è¡¨</li>
<li>ç„¶åä¸¤ä¸¤åˆå¹¶æˆé•¿åº¦ä¸º 2 çš„å­é“¾è¡¨</li>
<li>å†ä¸¤ä¸¤åˆå¹¶æˆé•¿åº¦ä¸º 4 çš„å­é“¾è¡¨</li>
<li>ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ•´ä¸ªé“¾è¡¨æ’åºå®Œæˆ</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œæ»¡è¶³è¿›é˜¶è¦æ±‚ã€‚</p>
<h2 id="ä»£ç å®ç°ï¼ˆä¼˜åŒ–ç‰ˆï¼‰">ä»£ç å®ç°ï¼ˆä¼˜åŒ–ç‰ˆï¼‰</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sortList</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†ç©ºé“¾è¡¨æˆ–å•èŠ‚ç‚¹é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡ç®—é“¾è¡¨é•¿åº¦</span></span><br><span class="line">    length := getLength(head)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºå“‘èŠ‚ç‚¹ï¼Œç®€åŒ–è¾¹ç•Œæƒ…å†µå¤„ç†</span></span><br><span class="line">    dummy := &amp;ListNode&#123;Next: head&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªåº•å‘ä¸Šå½’å¹¶æ’åº</span></span><br><span class="line">    <span class="comment">// æ¯æ¬¡è¿­ä»£å­é“¾è¡¨é•¿åº¦ä¹˜ä»¥2ï¼ˆ1-&gt;2-&gt;4-&gt;8...ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> subLength := <span class="number">1</span>; subLength &lt; length; subLength &lt;&lt;= <span class="number">1</span> &#123;</span><br><span class="line">        prev, curr := dummy, dummy.Next</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ¯è½®è¿­ä»£å¤„ç†æ•´ä¸ªé“¾è¡¨</span></span><br><span class="line">        <span class="keyword">for</span> curr != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="comment">// ç¬¬ä¸€ä¸ªå­é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">            head1 := curr</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆ‡å‰²ç¬¬ä¸€ä¸ªå­é“¾è¡¨</span></span><br><span class="line">            <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; subLength &amp;&amp; curr != <span class="literal">nil</span> &amp;&amp; curr.Next != <span class="literal">nil</span>; i++ &#123;</span><br><span class="line">                curr = curr.Next</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç¬¬äºŒä¸ªå­é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">            head2 := curr.Next</span><br><span class="line">            curr.Next = <span class="literal">nil</span> <span class="comment">// æ–­å¼€ç¬¬ä¸€ä¸ªå­é“¾è¡¨</span></span><br><span class="line">            curr = head2</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆ‡å‰²ç¬¬äºŒä¸ªå­é“¾è¡¨</span></span><br><span class="line">            <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; subLength &amp;&amp; curr != <span class="literal">nil</span> &amp;&amp; curr.Next != <span class="literal">nil</span>; i++ &#123;</span><br><span class="line">                curr = curr.Next</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®°å½•ä¸‹ä¸€æ¬¡è¦å¤„ç†çš„èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">var</span> next *ListNode = <span class="literal">nil</span></span><br><span class="line">            <span class="keyword">if</span> curr != <span class="literal">nil</span> &#123;</span><br><span class="line">                next = curr.Next</span><br><span class="line">                curr.Next = <span class="literal">nil</span> <span class="comment">// æ–­å¼€ç¬¬äºŒä¸ªå­é“¾è¡¨</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆå¹¶ä¸¤ä¸ªå­é“¾è¡¨</span></span><br><span class="line">            merged := mergeTwoLists(head1, head2)</span><br><span class="line">            prev.Next = merged</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç§»åŠ¨prevåˆ°åˆå¹¶åé“¾è¡¨çš„æœ«å°¾</span></span><br><span class="line">            <span class="keyword">for</span> prev.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">                prev = prev.Next</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¤„ç†ä¸‹ä¸€å¯¹å­é“¾è¡¨</span></span><br><span class="line">            curr = next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dummy.Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–é“¾è¡¨é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getLength</span><span class="params">(head *ListNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    length := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> node := head; node != <span class="literal">nil</span>; node = node.Next &#123;</span><br><span class="line">        length++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> length</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeTwoLists</span><span class="params">(l1 *ListNode, l2 *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    dummy := &amp;ListNode&#123;&#125;</span><br><span class="line">    curr := dummy</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> l1 != <span class="literal">nil</span> &amp;&amp; l2 != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> l1.Val &lt; l2.Val &#123;</span><br><span class="line">            curr.Next = l1</span><br><span class="line">            l1 = l1.Next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            curr.Next = l2</span><br><span class="line">            l2 = l2.Next</span><br><span class="line">        &#125;</span><br><span class="line">        curr = curr.Next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿æ¥å‰©ä½™éƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">if</span> l1 != <span class="literal">nil</span> &#123;</span><br><span class="line">        curr.Next = l1</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        curr.Next = l2</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dummy.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šè‡ªé¡¶å‘ä¸‹å½’å¹¶æ’åº">æ–¹æ³•äºŒï¼šè‡ªé¡¶å‘ä¸‹å½’å¹¶æ’åº</h3>
<p>è‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æ’åºæ˜¯ä¸€ç§é€’å½’å®ç°ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼š</p>
<ol>
<li>ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨ä¸­ç‚¹ï¼Œå°†é“¾è¡¨åˆ†ä¸ºä¸¤åŠ</li>
<li>é€’å½’æ’åºä¸¤ä¸ªå­é“¾è¡¨</li>
<li>åˆå¹¶ä¸¤ä¸ªæ’åºåçš„å­é“¾è¡¨</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(log n)ï¼Œå› ä¸ºé€’å½’æ ˆçš„æ·±åº¦æ˜¯ log nã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sortList</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="comment">// é€’å½’ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨ä¸­ç‚¹</span></span><br><span class="line">    slow, fast := head, head.Next</span><br><span class="line">    <span class="keyword">for</span> fast != <span class="literal">nil</span> &amp;&amp; fast.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">        slow = slow.Next</span><br><span class="line">        fast = fast.Next.Next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ‡åˆ†é“¾è¡¨</span></span><br><span class="line">    mid := slow.Next</span><br><span class="line">    slow.Next = <span class="literal">nil</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€’å½’æ’åºä¸¤ä¸ªå­é“¾è¡¨</span></span><br><span class="line">    left := sortList(head)</span><br><span class="line">    right := sortList(mid)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå¹¶æ’åºåçš„å­é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">return</span> mergeTwoLists(left, right)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeTwoLists</span><span class="params">(l1 *ListNode, l2 *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    dummy := &amp;ListNode&#123;&#125;</span><br><span class="line">    curr := dummy</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> l1 != <span class="literal">nil</span> &amp;&amp; l2 != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> l1.Val &lt; l2.Val &#123;</span><br><span class="line">            curr.Next = l1</span><br><span class="line">            l1 = l1.Next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            curr.Next = l2</span><br><span class="line">            l2 = l2.Next</span><br><span class="line">        &#125;</span><br><span class="line">        curr = curr.Next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿æ¥å‰©ä½™éƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">if</span> l1 != <span class="literal">nil</span> &#123;</span><br><span class="line">        curr.Next = l1</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        curr.Next = l2</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dummy.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è‡ªåº•å‘ä¸Šï¼ˆè¿­ä»£ï¼‰</th>
<th>è‡ªé¡¶å‘ä¸‹ï¼ˆé€’å½’ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n log n)</td>
<td>O(n log n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(log n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å¸¸æ•°ç©ºé—´å¤æ‚åº¦</td>
<td>ä»£ç ç®€æ´æ˜“æ‡‚</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å®ç°è¾ƒå¤æ‚</td>
<td>éœ€è¦é¢å¤–çš„é€’å½’æ ˆç©ºé—´</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
</tbody>
</table>
<h2 id="é”™è¯¯åˆ†æä¸æ€»ç»“">é”™è¯¯åˆ†æä¸æ€»ç»“</h2>
<p>åœ¨å°è¯•å®ç°è‡ªåº•å‘ä¸Šå½’å¹¶æ’åºæ—¶ï¼Œæˆ‘é‡åˆ°äº†å‡ ä¸ªå…¸å‹çš„é“¾è¡¨æ“ä½œè¾¹ç•Œé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„é”™è¯¯ä»£ç å’Œå…·ä½“åˆ†æï¼Œå¸Œæœ›èƒ½å¸®åŠ©æˆ‘ï¼ˆä»¥åŠä»–äººï¼‰é¿å…é‡è¹ˆè¦†è¾™ã€‚</p>
<h3 id="åˆå§‹é”™è¯¯ä»£ç ">åˆå§‹é”™è¯¯ä»£ç </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sortList</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">	<span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> head</span><br><span class="line">	&#125;</span><br><span class="line">	dummyHead := &amp;ListNode&#123;&#125;</span><br><span class="line">	dummyHead.Next = head</span><br><span class="line">	length := <span class="number">0</span></span><br><span class="line">	cur := head</span><br><span class="line">	<span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">		cur = cur.Next</span><br><span class="line">		length++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k := <span class="number">1</span>; k &lt; length; k &lt;&lt;= <span class="number">1</span> &#123;</span><br><span class="line">		prev, cur := dummyHead, dummyHead.Next</span><br><span class="line">		<span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">			head1 := cur</span><br><span class="line">			<span class="comment">// è¿™é‡Œåº”è¯¥æ˜¯1å¼€å§‹</span></span><br><span class="line">			<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k &amp;&amp; cur.Next != <span class="literal">nil</span>; i++ &#123;</span><br><span class="line">				cur = cur.Next</span><br><span class="line">			&#125;</span><br><span class="line">			head2 := cur.Next</span><br><span class="line">			cur.Next = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">// å¯èƒ½ä¼šå¸¦æ¥cur = nil</span></span><br><span class="line">			cur = head2</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k &amp;&amp; cur != <span class="literal">nil</span> &amp;&amp; cur.Next != <span class="literal">nil</span>; i++ &#123;</span><br><span class="line">				cur = cur.Next</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">var</span> next *ListNode</span><br><span class="line">			<span class="keyword">if</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">				next = cur.Next</span><br><span class="line">				cur.Next = <span class="literal">nil</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			prev.Next = mergeSorted(head1, head2)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> prev.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">				prev = prev.Next</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// è¿™é‡Œæ²¡å¿…è¦åŠ ï¼Œå› ä¸ºåé¢çš„å¤„ç†å®Œè‡ªç„¶ä¼šåŠ ä¸Š</span></span><br><span class="line">			prev.Next = next</span><br><span class="line">			cur = next</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dummyHead.Next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeSorted</span><span class="params">(head1, head2 *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">	dummyHead := &amp;ListNode&#123;&#125;</span><br><span class="line">	cur := dummyHead</span><br><span class="line">	<span class="keyword">for</span> head1 != <span class="literal">nil</span> &amp;&amp; head2 != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> head1.Val &lt; head2.Val &#123;</span><br><span class="line">			cur.Next = head1</span><br><span class="line">			head1 = head1.Next</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			cur.Next = head2</span><br><span class="line">			head2 = head2.Next</span><br><span class="line">		&#125;</span><br><span class="line">		cur = cur.Next</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> head1 != <span class="literal">nil</span> &#123;</span><br><span class="line">		cur.Next = head1</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		cur.Next = head2</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dummyHead.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯ç‚¹åˆ†æ">é”™è¯¯ç‚¹åˆ†æ</h3>
<p>æˆ‘åœ¨ä»£ç æ³¨é‡Šä¸­æ ‡è®°äº†å‡ ä¸ªç–‘ç‚¹ï¼Œç»è¿‡åˆ†æï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ ¸å¿ƒé”™è¯¯ï¼š</p>
<h4 id="1-å­é“¾è¡¨åˆ‡åˆ†é”™è¯¯">1. å­é“¾è¡¨åˆ‡åˆ†é”™è¯¯</h4>
<p><strong>é—®é¢˜æ‰€åœ¨</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">head1 := cur</span><br><span class="line"><span class="comment">// è¿™é‡Œåº”è¯¥æ˜¯1å¼€å§‹</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k &amp;&amp; cur.Next != <span class="literal">nil</span>; i++ &#123;</span><br><span class="line">    cur = cur.Next</span><br><span class="line">&#125;</span><br><span class="line">head2 := cur.Next</span><br><span class="line">cur.Next = <span class="literal">nil</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>ç”¨äºåˆ‡åˆ†é•¿åº¦ä¸º <code>k</code> çš„å­é“¾è¡¨çš„å¾ªç¯ <code>for i := 0; i &lt; k &amp;&amp; ...</code> æ‰§è¡Œäº† <code>k</code> æ¬¡ï¼Œè¿™ä½¿å¾— <code>cur</code> æŒ‡é’ˆå‰è¿›äº† <code>k</code> æ­¥ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œä» <code>head1</code> å¼€å§‹ï¼ŒæŒ‡é’ˆéœ€è¦å‰è¿› <code>k-1</code> æ­¥æ‰èƒ½åˆ°è¾¾é•¿åº¦ä¸º <code>k</code> çš„å­é“¾è¡¨çš„å°¾éƒ¨ã€‚</p>
<p><strong>åŸå› åˆ†æ</strong>ï¼š<br>
å½“å­é“¾è¡¨é•¿åº¦ä¸º <code>k</code> æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç¬¬ <code>k</code> ä¸ªèŠ‚ç‚¹ä½œä¸ºå°¾éƒ¨ã€‚å¦‚æœ <code>cur</code> åˆå§‹æŒ‡å‘ç¬¬ 1 ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå‰è¿› <code>k-1</code> æ­¥åï¼Œ<code>cur</code> ä¼šæŒ‡å‘ç¬¬ <code>k</code> ä¸ªèŠ‚ç‚¹ã€‚è€Œ <code>for i := 0; i &lt; k</code> è¿™ä¸ªå¾ªç¯ä¼šæ‰§è¡Œ <code>k</code> æ¬¡ï¼Œå¯¼è‡´ <code>cur</code> æŒ‡å‘äº†ç¬¬ <code>k+1</code> ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚ä¾‹å¦‚ï¼Œå½“ <code>k=1</code> æ—¶ï¼Œå¾ªç¯ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œ<code>cur</code> å‰è¿›äº†ä¸€æ­¥ï¼Œå¯¼è‡´åˆ‡åˆ†å‡ºçš„ <code>head1</code> åŒ…å«äº†ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè€Œæˆ‘ä»¬æœŸæœ›çš„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p><strong>æ­£ç¡®å®ç°</strong>ï¼š<br>
å¾ªç¯åº”è¯¥ä» <code>1</code> å¼€å§‹ï¼Œåˆ° <code>k</code> ç»“æŸï¼ˆä¸åŒ…æ‹¬ <code>k</code>ï¼‰ï¼Œå³å¾ªç¯ <code>k-1</code> æ¬¡ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ­£ç¡®çš„åˆ‡åˆ†é€»è¾‘</span></span><br><span class="line">curr := head1</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; k &amp;&amp; curr != <span class="literal">nil</span> &amp;&amp; curr.Next != <span class="literal">nil</span>; i++ &#123;</span><br><span class="line">    curr = curr.Next</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ­¤æ—¶ curr æ˜¯ç¬¬ä¸€ä¸ªå­é“¾è¡¨çš„å°¾èŠ‚ç‚¹</span></span><br><span class="line">head2 := curr.Next</span><br><span class="line">curr.Next = <span class="literal">nil</span> <span class="comment">// æ–­å¼€</span></span><br></pre></td></tr></table></figure>
<h4 id="2-å¯¹é“¾è¡¨è¿æ¥æ–¹å¼çš„è¯¯è§£">2. å¯¹é“¾è¡¨è¿æ¥æ–¹å¼çš„è¯¯è§£</h4>
<p><strong>é—®é¢˜æ‰€åœ¨</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">for</span> prev.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">    prev = prev.Next</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æˆ‘æ›¾è®¤ä¸ºè¿™é‡Œæ²¡å¿…è¦åŠ ï¼Œå› ä¸ºåé¢çš„å¤„ç†å®Œè‡ªç„¶ä¼šåŠ ä¸Š</span></span><br><span class="line">prev.Next = next</span><br><span class="line">cur = next</span><br></pre></td></tr></table></figure>
<p>æˆ‘æ›¾è®¤ä¸º <code>prev.Next = next</code> è¿™ä¸€è¡Œæ˜¯å¤šä½™çš„ï¼Œç†ç”±æ˜¯åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œ<code>prev.Next</code> ä¼šè¢« <code>mergeSorted</code> çš„ç»“æœè‡ªç„¶è¦†ç›–ã€‚</p>
<p><strong>åŸå› åˆ†æ</strong>ï¼š<br>
è¿™ä¸ªæƒ³æ³•æ˜¯é”™è¯¯çš„ã€‚åœ¨ <code>for cur != nil</code> çš„æ•´ä¸ªå¾ªç¯è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘ <strong>å·²æ’åºéƒ¨åˆ†å°¾éƒ¨</strong> çš„æŒ‡é’ˆ <code>prev</code>ï¼Œå¹¶å°†åç»­å¤„ç†å¥½çš„ç‰‡æ®µä¾æ¬¡è¿æ¥åˆ°å®ƒåé¢ã€‚</p>
<p>æˆ‘å†™çš„ <code>prev.Next = next</code> è¿™è¡Œä»£ç æœ¬èº«æ˜¯ä¸€ç§æœ‰æ•ˆçš„è¿æ¥æ–¹å¼ï¼Œå®ƒç¡®ä¿åœ¨å¤„ç†ä¸‹ä¸€å¯¹å­é“¾è¡¨ <em>ä¹‹å‰</em>ï¼Œå°†åˆšåˆå¹¶å®Œçš„é“¾è¡¨ä¸åé¢è¿˜æœªå¤„ç†çš„é“¾è¡¨éƒ¨åˆ†å…ˆè¿æ¥èµ·æ¥ï¼Œä»è€Œä¿è¯é“¾è¡¨çš„å®Œæ•´æ€§ã€‚æˆ‘çš„é”™è¯¯åœ¨äºï¼Œæˆ‘è¯¯ä»¥ä¸ºè¿™è¡Œä»£ç æ˜¯å¤šä½™çš„ï¼Œå¦‚æœå°†å…¶åˆ é™¤ï¼Œé‚£ä¹ˆåœ¨å¤„ç†å®Œæœ€åä¸€å¯¹å­é“¾è¡¨åï¼Œå¦‚æœåŸå§‹é“¾è¡¨é•¿åº¦ä¸æ˜¯2çš„å¹‚ï¼Œå‰©ä½™çš„å°¾éƒ¨ <code>next</code> å°±ä¼šä¸¢å¤±ã€‚</p>
<p><strong>æ­£ç¡®é€»è¾‘</strong>ï¼š<br>
æ­£ç¡®çš„åšæ³•æ˜¯åœ¨ <code>for cur != nil</code> å¾ªç¯ä¸­ï¼Œå§‹ç»ˆç»´æŠ¤ <code>prev</code> ä½œä¸ºå·²å¤„ç†éƒ¨åˆ†çš„å°¾å·´ã€‚</p>
<ol>
<li><code>prev.Next = mergedList</code> å°†æ–°åˆå¹¶çš„é“¾è¡¨æ¥åœ¨ <code>prev</code> åé¢ã€‚</li>
<li>ç„¶å <code>prev</code> è‡ªèº«å‰è¿›åˆ°æ–°åˆå¹¶é“¾è¡¨çš„å°¾éƒ¨ï¼ˆ<code>while (prev.Next != nil) &#123; prev = prev.Next; &#125;</code>ï¼‰ã€‚</li>
<li><code>cur</code> æ›´æ–°ä¸º <code>next</code>ï¼Œå¼€å§‹ä¸‹ä¸€å¯¹å­é“¾è¡¨çš„å¤„ç†ã€‚<br>
åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œ<code>prev.Next = mergedList</code> ä¼šå†æ¬¡å°†æ–°çš„åˆå¹¶ç»“æœè¿æ¥åˆ°æ›´æ–°åçš„ <code>prev</code> ä¹‹åï¼Œä»è€Œå°†æ‰€æœ‰éƒ¨åˆ†ä¸²è”èµ·æ¥ã€‚æˆ‘çš„ä»£ç å®ç°äº†ç±»ä¼¼çš„æ•ˆæœï¼Œä½†æˆ‘çš„æ³¨é‡Šå´åæ˜ äº†æˆ‘å¯¹è¿™ä¸ªå…³é”®è¿æ¥æ­¥éª¤çš„è¯¯è§£ã€‚</li>
</ol>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log n)</p>
<ul>
<li>å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n log n)</li>
<li>æ¯æ¬¡åˆå¹¶æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ€»å…±éœ€è¦è¿›è¡Œ log n æ¬¡åˆå¹¶</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>è‡ªåº•å‘ä¸Šæ–¹æ³•ï¼šO(1)ï¼Œåªéœ€è¦å¸¸æ•°çº§çš„é¢å¤–ç©ºé—´</li>
<li>è‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼šO(log n)ï¼Œå› ä¸ºé€’å½’è°ƒç”¨æ ˆçš„æ·±åº¦æ˜¯ log n</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®å­¦ä¹ ç‚¹">å…³é”®å­¦ä¹ ç‚¹</h2>
<ol>
<li><strong>é“¾è¡¨å½’å¹¶æ’åºçš„å®ç°</strong>ï¼šå­¦ä¹ å¦‚ä½•å¯¹é“¾è¡¨è€Œéæ•°ç»„åº”ç”¨å½’å¹¶æ’åº</li>
<li><strong>è‡ªåº•å‘ä¸Šä¸è‡ªé¡¶å‘ä¸‹å¯¹æ¯”</strong>ï¼šç†è§£ä¸¤ç§å½’å¹¶æ’åºå®ç°æ–¹å¼çš„åŒºåˆ«</li>
<li><strong>é“¾è¡¨æ“ä½œæŠ€å·§</strong>ï¼š
<ul>
<li>ä½¿ç”¨å“‘èŠ‚ç‚¹ï¼ˆdummy nodeï¼‰ç®€åŒ–å¤´èŠ‚ç‚¹å¤„ç†</li>
<li>ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾é“¾è¡¨ä¸­ç‚¹</li>
<li>é“¾è¡¨çš„åˆ‡åˆ†ä¸åˆå¹¶æŠ€å·§</li>
</ul>
</li>
</ol>
<p>æ’åºé“¾è¡¨æ˜¯ä¸€é“å¾ˆå¥½çš„ç»ƒä¹ é¢˜ï¼Œå®ƒä¸ä»…è€ƒå¯Ÿäº†é“¾è¡¨æ“ä½œï¼Œè¿˜è€ƒå¯Ÿäº†æ’åºç®—æ³•çš„å®ç°ã€‚é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ å¦‚ä½•åœ¨é“¾è¡¨è¿™ç§çº¿æ€§æ•°æ®ç»“æ„ä¸Šå®ç°é«˜æ•ˆçš„æ’åºç®—æ³•ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>é“¾è¡¨</tag>
        <tag>å½’å¹¶æ’åº</tag>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: I/Oå¤šè·¯å¤ç”¨è¯¦è§£ - select/poll/epollåŸç†ä¸å¯¹æ¯”</title>
    <url>/2025/07/02/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/</url>
    <content><![CDATA[<h1>I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯è¯¦è§£ï¼šä»selectåˆ°epollçš„æ¼”è¿›</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>I/Oå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§é«˜æ•ˆçš„ç½‘ç»œç¼–ç¨‹æŠ€æœ¯ï¼Œå…è®¸å•ä¸ªè¿›ç¨‹åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„I/Oäº‹ä»¶ã€‚å®ƒæ˜¯è§£å†³<strong>C10Ké—®é¢˜</strong>ï¼ˆå•æœºåŒæ—¶å¤„ç†ä¸€ä¸‡ä¸ªè¿æ¥ï¼‰çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œä¹Ÿæ˜¯ç°ä»£é«˜æ€§èƒ½æœåŠ¡å™¨çš„åŸºç¡€ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦I-Oå¤šè·¯å¤ç”¨ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦I/Oå¤šè·¯å¤ç”¨ï¼Ÿ</h3>
<p>åœ¨ä¼ ç»Ÿçš„é˜»å¡I/Oæ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æˆ–çº¿ç¨‹æ¥å¤„ç†ï¼Œè¿™ç§æ–¹å¼åœ¨é¢å¯¹å¤§é‡å¹¶å‘è¿æ¥æ—¶ä¼šé‡åˆ°ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆï¼š</p>
<ul>
<li><strong>èµ„æºæ¶ˆè€—å·¨å¤§</strong>ï¼šæ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹éƒ½ä¼šå ç”¨å¤§é‡å†…å­˜</li>
<li><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€</strong>ï¼šé¢‘ç¹çš„è¿›ç¨‹/çº¿ç¨‹åˆ‡æ¢å½±å“æ€§èƒ½</li>
<li><strong>ç³»ç»Ÿé™åˆ¶</strong>ï¼šæ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹/çº¿ç¨‹æ•°é‡æœ‰é™åˆ¶</li>
</ul>
<hr>
<h2 id="åŸºç¡€æ¦‚å¿µï¼šSocketç½‘ç»œç¼–ç¨‹æ¨¡å‹">åŸºç¡€æ¦‚å¿µï¼šSocketç½‘ç»œç¼–ç¨‹æ¨¡å‹</h2>
<h3 id="æœ€åŸºæœ¬çš„Socketæ¨¡å‹">æœ€åŸºæœ¬çš„Socketæ¨¡å‹</h3>
<p>Socketæ˜¯è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§ç‰¹æ®Šæ–¹å¼ï¼Œç‰¹åˆ«ä¹‹å¤„åœ¨äºå®ƒæ”¯æŒè·¨ä¸»æœºé€šä¿¡ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼ŒSocketéµå¾ª&quot;ä¸€åˆ‡çš†æ–‡ä»¶&quot;çš„ç†å¿µï¼Œæ¯ä¸ªSocketéƒ½å¯¹åº”ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p>
<p><strong>TCP Socketç¼–ç¨‹çš„åŸºæœ¬æµç¨‹ï¼š</strong></p>
<p><img src="/2025/07/02/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/1751383613218.png" alt="1751383613218"></p>
<p><strong>æœåŠ¡ç«¯æµç¨‹ï¼š</strong></p>
<ol>
<li><code>socket()</code> - åˆ›å»ºSocket</li>
<li><code>bind()</code> - ç»‘å®šIPåœ°å€å’Œç«¯å£</li>
<li><code>listen()</code> - è¿›å…¥ç›‘å¬çŠ¶æ€</li>
<li><code>accept()</code> - æ¥å—å®¢æˆ·ç«¯è¿æ¥</li>
<li><code>read()/write()</code> - æ•°æ®ä¼ è¾“</li>
</ol>
<p><strong>å®¢æˆ·ç«¯æµç¨‹ï¼š</strong></p>
<ol>
<li><code>socket()</code> - åˆ›å»ºSocket</li>
<li><code>connect()</code> - è¿æ¥æœåŠ¡å™¨</li>
<li><code>read()/write()</code> - æ•°æ®ä¼ è¾“</li>
</ol>
<h3 id="é‡è¦æ¦‚å¿µï¼šä¸¤ç§Socket">é‡è¦æ¦‚å¿µï¼šä¸¤ç§Socket</h3>
<ul>
<li><strong>ç›‘å¬Socket</strong>ï¼šç”¨äºç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚</li>
<li><strong>å·²è¿æ¥Socket</strong>ï¼šç”¨äºä¸ç‰¹å®šå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®ä¼ è¾“</li>
</ul>
<h3 id="TCPè¿æ¥é˜Ÿåˆ—æœºåˆ¶">TCPè¿æ¥é˜Ÿåˆ—æœºåˆ¶</h3>
<p>æœåŠ¡å™¨å†…æ ¸ä¸ºæ¯ä¸ªSocketç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—ï¼š</p>
<ul>
<li><strong>åŠè¿æ¥é˜Ÿåˆ—</strong>ï¼šå­˜å‚¨æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥ï¼ˆSYN_RCVDçŠ¶æ€ï¼‰</li>
<li><strong>å…¨è¿æ¥é˜Ÿåˆ—</strong>ï¼šå­˜å‚¨å·²å®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥ï¼ˆESTABLISHEDçŠ¶æ€ï¼‰</li>
</ul>
<hr>
<h2 id="æœåŠ¡å™¨å¹¶å‘æ¨¡å‹çš„æ¼”è¿›">æœåŠ¡å™¨å¹¶å‘æ¨¡å‹çš„æ¼”è¿›</h2>
<h3 id="ç†è®ºæœ€å¤§è¿æ¥æ•°">ç†è®ºæœ€å¤§è¿æ¥æ•°</h3>
<p>TCPè¿æ¥ç”±å››å…ƒç»„å”¯ä¸€ç¡®å®šï¼š<code>(æœ¬æœºIP, æœ¬æœºç«¯å£, å¯¹ç«¯IP, å¯¹ç«¯ç«¯å£)</code></p>
<p><strong>ç†è®ºæœ€å¤§è¿æ¥æ•° = å®¢æˆ·ç«¯IPæ•° Ã— å®¢æˆ·ç«¯ç«¯å£æ•°</strong></p>
<p>å¯¹äºIPv4ï¼š<strong>2^32 Ã— 2^16 = 2^48</strong> ä¸ªè¿æ¥</p>
<h3 id="å®é™…é™åˆ¶å› ç´ ">å®é™…é™åˆ¶å› ç´ </h3>
<ol>
<li><strong>æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</strong>ï¼šæ¯ä¸ªè¿æ¥å ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</li>
<li><strong>ç³»ç»Ÿå†…å­˜é™åˆ¶</strong>ï¼šæ¯ä¸ªè¿æ¥åœ¨å†…æ ¸ä¸­éƒ½æœ‰å¯¹åº”çš„æ•°æ®ç»“æ„</li>
</ol>
<h3 id="C10Ké—®é¢˜">C10Ké—®é¢˜</h3>
<p><strong>C10Ké—®é¢˜</strong>ï¼šå•æœºåŒæ—¶å¤„ç†10,000ä¸ªå¹¶å‘è¿æ¥çš„æŒ‘æˆ˜</p>
<p><strong>ç¡¬ä»¶è¦æ±‚ä¼°ç®—ï¼š</strong></p>
<ul>
<li>å†…å­˜ï¼šæ¯ä¸ªè¿æ¥ &lt; 200KB â†’ 10Kè¿æ¥éœ€è¦çº¦2GBå†…å­˜</li>
<li>å¸¦å®½ï¼šæ¯ä¸ªè¿æ¥ &lt; 100Kbit â†’ 10Kè¿æ¥éœ€è¦çº¦1Gbpså¸¦å®½</li>
</ul>
<hr>
<h2 id="ä¼ ç»Ÿå¹¶å‘æ¨¡å‹åŠå…¶å±€é™">ä¼ ç»Ÿå¹¶å‘æ¨¡å‹åŠå…¶å±€é™</h2>
<h3 id="å¤šè¿›ç¨‹æ¨¡å‹">å¤šè¿›ç¨‹æ¨¡å‹</h3>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<ul>
<li>ä¸»è¿›ç¨‹ç›‘å¬è¿æ¥</li>
<li>æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥forkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†</li>
</ul>
<p><img src="/2025/07/02/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/1751383641741.png" alt="1751383641741"></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>è¿›ç¨‹éš”ç¦»ï¼Œç¨³å®šæ€§å¥½</li>
<li>å®ç°ç®€å•</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å†…å­˜å¼€é”€å¤§ï¼ˆæ¯ä¸ªè¿›ç¨‹ç‹¬ç«‹åœ°å€ç©ºé—´ï¼‰</li>
<li>ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€é‡</li>
<li>è¿›ç¨‹åˆ›å»º/é”€æ¯æˆæœ¬é«˜</li>
<li>æ˜“äº§ç”Ÿåƒµå°¸è¿›ç¨‹</li>
</ul>
<h3 id="å¤šçº¿ç¨‹æ¨¡å‹">å¤šçº¿ç¨‹æ¨¡å‹</h3>
<p><strong>æ”¹è¿›æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä½¿ç”¨çº¿ç¨‹æ›¿ä»£è¿›ç¨‹</li>
<li>å¼•å…¥çº¿ç¨‹æ± é¿å…é¢‘ç¹åˆ›å»º/é”€æ¯</li>
</ul>
<p><img src="/2025/07/02/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/1751383651750.png" alt="1751383651750"></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ç›¸æ¯”è¿›ç¨‹ï¼Œå¼€é”€æ›´å°</li>
<li>å…±äº«å†…å­˜ç©ºé—´ï¼Œé€šä¿¡æ–¹ä¾¿</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>ä»ç„¶æ— æ³•è§£å†³C10Ké—®é¢˜</li>
<li>çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
<li>ä¸Šä¸‹æ–‡åˆ‡æ¢ä»æœ‰å¼€é”€</li>
</ul>
<hr>
<h2 id="I-Oå¤šè·¯å¤ç”¨æŠ€æœ¯æ ¸å¿ƒ">I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯æ ¸å¿ƒ</h2>
<h3 id="åŸºæœ¬æ€æƒ³">åŸºæœ¬æ€æƒ³</h3>
<p><strong>æ—¶åˆ†å¤šè·¯å¤ç”¨</strong>ï¼šä¸€ä¸ªè¿›ç¨‹åœ¨æçŸ­æ—¶é—´å†…è½®æµå¤„ç†å¤šä¸ªè¿æ¥çš„I/Oäº‹ä»¶ï¼Œä»å®è§‚ä¸Šçœ‹å®ç°äº†&quot;å¹¶å‘&quot;å¤„ç†ã€‚</p>
<p><img src="/2025/07/02/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/1751383661511.png" alt="1751383661511"></p>
<h3 id="æ ¸å¿ƒä¼˜åŠ¿">æ ¸å¿ƒä¼˜åŠ¿</h3>
<ul>
<li><strong>èµ„æºåˆ©ç”¨ç‡é«˜</strong>ï¼šå•è¿›ç¨‹å¤„ç†å¤šè¿æ¥</li>
<li><strong>å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼šé¿å…å¤§é‡è¿›ç¨‹/çº¿ç¨‹åˆ‡æ¢</li>
<li><strong>å†…å­˜å‹å¥½</strong>ï¼šæ˜¾è‘—é™ä½å†…å­˜å ç”¨</li>
</ul>
<hr>
<h2 id="select-pollè¯¦è§£">select/pollè¯¦è§£</h2>
<h3 id="selectå®ç°æœºåˆ¶">selectå®ç°æœºåˆ¶</h3>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<ol>
<li>å°†æ–‡ä»¶æè¿°ç¬¦é›†åˆä»ç”¨æˆ·æ€<strong>æ‹·è´</strong>åˆ°å†…æ ¸æ€</li>
<li>å†…æ ¸<strong>éå†</strong>æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œæ£€æŸ¥I/Oäº‹ä»¶</li>
<li>å°†ç»“æœä»å†…æ ¸æ€<strong>æ‹·è´</strong>å›ç”¨æˆ·æ€</li>
<li>ç”¨æˆ·æ€å†æ¬¡<strong>éå†</strong>æ‰¾åˆ°å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦</li>
</ol>
<p><strong>æ ¸å¿ƒé—®é¢˜ï¼š</strong></p>
<ul>
<li><strong>2æ¬¡æ‹·è´</strong>ï¼šç”¨æˆ·æ€ â†” å†…æ ¸æ€</li>
<li><strong>2æ¬¡éå†</strong>ï¼šå†…æ ¸æ€ + ç”¨æˆ·æ€</li>
<li><strong>æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶</strong>ï¼šé»˜è®¤æœ€å¤§1024ä¸ª</li>
</ul>
<h3 id="pollæ”¹è¿›">pollæ”¹è¿›</h3>
<p><strong>ä¸»è¦æ”¹è¿›ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨åŠ¨æ€æ•°ç»„æ›¿ä»£å›ºå®šé•¿åº¦BitMap</li>
<li>çªç ´æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶</li>
</ul>
<p><strong>æœ¬è´¨é—®é¢˜æœªè§£å†³ï¼š</strong></p>
<ul>
<li>ä»ç„¶éœ€è¦æ‹·è´å’Œéå†</li>
<li>æ—¶é—´å¤æ‚åº¦ä»ä¸ºO(n)</li>
</ul>
<h3 id="æ€§èƒ½åˆ†æ">æ€§èƒ½åˆ†æ</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>select</th>
<th>poll</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</td>
<td>1024</td>
<td>æ— ç¡¬ç¼–ç é™åˆ¶</td>
</tr>
<tr>
<td>æ•°æ®ç»“æ„</td>
<td>BitMap</td>
<td>åŠ¨æ€æ•°ç»„</td>
</tr>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>å†…æ ¸æ‹·è´</td>
<td>éœ€è¦</td>
<td>éœ€è¦</td>
</tr>
<tr>
<td>éå†æ¬¡æ•°</td>
<td>2æ¬¡</td>
<td>2æ¬¡</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="epollé©å‘½æ€§æ”¹è¿›">epollé©å‘½æ€§æ”¹è¿›</h2>
<h3 id="æ ¸å¿ƒåˆ›æ–°ç‚¹">æ ¸å¿ƒåˆ›æ–°ç‚¹</h3>
<p><strong>ç¬¬ä¸€ç‚¹ï¼šçº¢é»‘æ ‘ç®¡ç†æ–‡ä»¶æè¿°ç¬¦</strong></p>
<ul>
<li>ä½¿ç”¨çº¢é»‘æ ‘å­˜å‚¨å¾…ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦</li>
<li>å¢åˆ æŸ¥æ—¶é—´å¤æ‚åº¦ï¼šO(log n)</li>
<li>é¿å…æ¯æ¬¡ä¼ å…¥æ•´ä¸ªé›†åˆï¼Œå‡å°‘æ‹·è´</li>
</ul>
<p><strong>ç¬¬äºŒç‚¹ï¼šäº‹ä»¶é©±åŠ¨æœºåˆ¶</strong></p>
<ul>
<li>ç»´æŠ¤å°±ç»ªäº‹ä»¶é“¾è¡¨</li>
<li>é€šè¿‡å›è°ƒå‡½æ•°æ›´æ–°å°±ç»ªåˆ—è¡¨</li>
<li>åªè¿”å›æœ‰äº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦</li>
</ul>
<p><img src="/2025/07/02/%E5%85%AB%E8%82%A1%E6%96%87/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/1751383673424.png" alt="1751383673424"></p>
<h3 id="epollæ¥å£è¯¦è§£">epollæ¥å£è¯¦è§£</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºepollå®ä¾‹</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_create</span><span class="params">(<span class="type">int</span> size)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ§åˆ¶epollå®ä¾‹</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_ctl</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> op, <span class="type">int</span> fd, <span class="keyword">struct</span> epoll_event *event)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…äº‹ä»¶</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">epoll_wait</span><span class="params">(<span class="type">int</span> epfd, <span class="keyword">struct</span> epoll_event *events, <span class="type">int</span> maxevents, <span class="type">int</span> timeout)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="è§¦å‘æ¨¡å¼å¯¹æ¯”">è§¦å‘æ¨¡å¼å¯¹æ¯”</h3>
<h4 id="æ°´å¹³è§¦å‘ï¼ˆLevel-Triggered-LTï¼‰">æ°´å¹³è§¦å‘ï¼ˆLevel Triggered, LTï¼‰</h4>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåªè¦æ»¡è¶³æ¡ä»¶å°±æŒç»­è§¦å‘</li>
<li><strong>è¡Œä¸º</strong>ï¼šæ•°æ®å¯è¯»æ—¶ä¼šä¸æ–­é€šçŸ¥ï¼Œç›´åˆ°æ•°æ®è¢«è¯»å®Œ</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç¼–ç¨‹ç®€å•ï¼Œä¸æ˜“å‡ºé”™</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½äº§ç”Ÿå¤šä½™çš„ç³»ç»Ÿè°ƒç”¨</li>
</ul>
<h4 id="è¾¹ç¼˜è§¦å‘ï¼ˆEdge-Triggered-ETï¼‰">è¾¹ç¼˜è§¦å‘ï¼ˆEdge Triggered, ETï¼‰</h4>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåªåœ¨çŠ¶æ€å˜åŒ–æ—¶è§¦å‘ä¸€æ¬¡</li>
<li><strong>è¡Œä¸º</strong>ï¼šæ•°æ®åˆ°è¾¾æ—¶åªé€šçŸ¥ä¸€æ¬¡ï¼Œå¿…é¡»ä¸€æ¬¡æ€§è¯»å®Œ</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œæ•ˆç‡æ›´é«˜</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šç¼–ç¨‹å¤æ‚ï¼Œå¿…é¡»é…åˆéé˜»å¡I/Oä½¿ç”¨</li>
</ul>
<p><strong>å®é™…åº”ç”¨å»ºè®®ï¼š</strong></p>
<ul>
<li>è¾¹ç¼˜è§¦å‘ + éé˜»å¡I/O + å¾ªç¯è¯»å†™</li>
<li>æ£€æŸ¥EAGAIN/EWOULDBLOCKé”™è¯¯</li>
</ul>
<hr>
<h2 id="æ€§èƒ½å¯¹æ¯”ä¸é€‰æ‹©æŒ‡å—">æ€§èƒ½å¯¹æ¯”ä¸é€‰æ‹©æŒ‡å—</h2>
<h3 id="ç»¼åˆæ€§èƒ½å¯¹æ¯”">ç»¼åˆæ€§èƒ½å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>select</th>
<th>poll</th>
<th>epoll</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ€§èƒ½</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>è¿æ¥æ•°é™åˆ¶</td>
<td>1024</td>
<td>æ— é™åˆ¶</td>
<td>æ— é™åˆ¶</td>
</tr>
<tr>
<td>å†…å­˜æ‹·è´</td>
<td>æ¯æ¬¡å…¨é‡</td>
<td>æ¯æ¬¡å…¨é‡</td>
<td>å¢é‡</td>
</tr>
<tr>
<td>äº‹ä»¶å¤æ‚åº¦</td>
<td>çº¿æ€§æ‰«æ</td>
<td>çº¿æ€§æ‰«æ</td>
<td>äº‹ä»¶é©±åŠ¨</td>
</tr>
<tr>
<td>è·¨å¹³å°æ€§</td>
<td>æœ€å¥½</td>
<td>è¾ƒå¥½</td>
<td>Linuxä¸“æœ‰</td>
</tr>
</tbody>
</table>
<h3 id="åº”ç”¨åœºæ™¯é€‰æ‹©">åº”ç”¨åœºæ™¯é€‰æ‹©</h3>
<p><strong>selecté€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>è¿æ¥æ•°å°‘ï¼ˆ&lt; 100ï¼‰</li>
<li>è·¨å¹³å°å…¼å®¹æ€§è¦æ±‚é«˜</li>
<li>ä¸´æ—¶æ€§/ç®€å•åº”ç”¨</li>
</ul>
<p><strong>pollé€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>è¿æ¥æ•°ä¸­ç­‰ï¼ˆ&lt; 1000ï¼‰</li>
<li>éœ€è¦çªç ´selectçš„1024é™åˆ¶</li>
<li>ä¸è¦æ±‚æœ€é«˜æ€§èƒ½</li>
</ul>
<p><strong>epollé€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é«˜å¹¶å‘æœåŠ¡å™¨ï¼ˆ&gt; 1000è¿æ¥ï¼‰</li>
<li>å¯¹æ€§èƒ½è¦æ±‚æé«˜</li>
<li>Linuxå¹³å°ä¸“ç”¨åº”ç”¨</li>
</ul>
<hr>
<h2 id="å¸¸è§é¢è¯•é—®é¢˜ä¸è§£ç­”">å¸¸è§é¢è¯•é—®é¢˜ä¸è§£ç­”</h2>
<h3 id="Q1-ä¸ºä»€ä¹ˆepollæ¯”select-pollæ€§èƒ½æ›´å¥½ï¼Ÿ">Q1: ä¸ºä»€ä¹ˆepollæ¯”select/pollæ€§èƒ½æ›´å¥½ï¼Ÿ</h3>
<p><strong>A:</strong> ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢çš„æ”¹è¿›ï¼š</p>
<ol>
<li>
<p><strong>æ•°æ®ç»“æ„ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>select/pollä½¿ç”¨çº¿æ€§ç»“æ„ï¼Œéœ€è¦O(n)éå†</li>
<li>epollä½¿ç”¨çº¢é»‘æ ‘ï¼Œå¢åˆ æŸ¥ä¸ºO(log n)</li>
</ul>
</li>
<li>
<p><strong>äº‹ä»¶é€šçŸ¥æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>select/pollé‡‡ç”¨è½®è¯¢æ–¹å¼ï¼Œæ¯æ¬¡éƒ½è¦éå†å…¨éƒ¨æ–‡ä»¶æè¿°ç¬¦</li>
<li>epollé‡‡ç”¨äº‹ä»¶é©±åŠ¨ï¼Œåªè¿”å›æ´»è·ƒçš„æ–‡ä»¶æè¿°ç¬¦</li>
</ul>
</li>
</ol>
<h3 id="Q2-epollçš„ETå’ŒLTæ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">Q2: epollçš„ETå’ŒLTæ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p><strong>A:</strong></p>
<ul>
<li><strong>LTï¼ˆæ°´å¹³è§¦å‘ï¼‰</strong>ï¼šåªè¦æœ‰æ•°æ®å°±æŒç»­é€šçŸ¥ï¼Œç±»ä¼¼&quot;å¿«é€’ç®±åå¤å‘çŸ­ä¿¡&quot;</li>
<li><strong>ETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰</strong>ï¼šåªåœ¨æ•°æ®åˆ°è¾¾ç¬é—´é€šçŸ¥ä¸€æ¬¡ï¼Œç±»ä¼¼&quot;å¿«é€’ç®±åªå‘ä¸€æ¬¡çŸ­ä¿¡&quot;</li>
</ul>
<p>ETæ¨¡å¼æ•ˆç‡æ›´é«˜ä½†ç¼–ç¨‹æ›´å¤æ‚ï¼Œå¿…é¡»é…åˆéé˜»å¡I/Oä½¿ç”¨ã€‚</p>
<h3 id="Q3-I-Oå¤šè·¯å¤ç”¨æ˜¯å¦ä¸€å®šè¦é…åˆéé˜»å¡I-Oï¼Ÿ">Q3: I/Oå¤šè·¯å¤ç”¨æ˜¯å¦ä¸€å®šè¦é…åˆéé˜»å¡I/Oï¼Ÿ</h3>
<p><strong>A:</strong> å¼ºçƒˆå»ºè®®é…åˆä½¿ç”¨ï¼ŒåŸå› ï¼š</p>
<ul>
<li>å¤šè·¯å¤ç”¨è¿”å›çš„&quot;å°±ç»ª&quot;äº‹ä»¶å¯èƒ½æ˜¯å‡çš„</li>
<li>ä½¿ç”¨é˜»å¡I/Oå¯èƒ½å¯¼è‡´ç¨‹åºæ„å¤–é˜»å¡</li>
<li>éé˜»å¡I/Oèƒ½å¤ŸåŠæ—¶å¤„ç†EAGAINé”™è¯¯</li>
</ul>
<h3 id="Q4-epollæ˜¯å¦ä½¿ç”¨äº†å…±äº«å†…å­˜ï¼Ÿ">Q4: epollæ˜¯å¦ä½¿ç”¨äº†å…±äº«å†…å­˜ï¼Ÿ</h3>
<p><strong>A:</strong> <strong>é”™è¯¯çš„å¸¸è§è¯¯è§£ï¼</strong> epollå¹¶æ²¡æœ‰ä½¿ç”¨å…±äº«å†…å­˜ã€‚æŸ¥çœ‹å†…æ ¸æºç å¯ä»¥å‘ç°ï¼Œ<code>epoll_wait</code>ä¸­è°ƒç”¨äº†<code>__put_user</code>å‡½æ•°ï¼Œè¿™æ˜ç¡®è¡¨æ˜æ•°æ®æ˜¯ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„ã€‚</p>
<h3 id="Q5-å¦‚ä½•é€‰æ‹©åˆé€‚çš„I-Oå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Ÿ">Q5: å¦‚ä½•é€‰æ‹©åˆé€‚çš„I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Ÿ</h3>
<p><strong>A:</strong> é€‰æ‹©ä¾æ®ï¼š</p>
<ul>
<li><strong>è¿æ¥æ•°é‡</strong>ï¼šå°‘é‡ç”¨selectï¼Œä¸­ç­‰ç”¨pollï¼Œå¤§é‡ç”¨epoll</li>
<li><strong>å¹³å°å…¼å®¹æ€§</strong>ï¼šè·¨å¹³å°é€‰select/pollï¼ŒLinuxä¸“ç”¨é€‰epoll</li>
<li><strong>æ€§èƒ½è¦æ±‚</strong>ï¼šé«˜æ€§èƒ½é€‰epollï¼Œä¸€èˆ¬éœ€æ±‚å¯ç”¨poll</li>
<li><strong>å¼€å‘å¤æ‚åº¦</strong>ï¼šç®€å•åº”ç”¨ç”¨selectï¼Œå¤æ‚åº”ç”¨ç”¨epoll</li>
</ul>
<hr>
<h2 id="æœ€ä½³å®è·µä¸ä¼˜åŒ–å»ºè®®">æœ€ä½³å®è·µä¸ä¼˜åŒ–å»ºè®®</h2>
<h3 id="1-åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´">1. åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¿å…æ— é™é˜»å¡ï¼Œè®¾ç½®åˆç†è¶…æ—¶</span></span><br><span class="line"><span class="type">int</span> timeout = <span class="number">1000</span>; <span class="comment">// 1ç§’è¶…æ—¶</span></span><br><span class="line">epoll_wait(epfd, events, MAX_EVENTS, timeout);</span><br></pre></td></tr></table></figure>
<h3 id="2-è¾¹ç¼˜è§¦å‘æ¨¡å¼æœ€ä½³å®è·µ">2. è¾¹ç¼˜è§¦å‘æ¨¡å¼æœ€ä½³å®è·µ</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ETæ¨¡å¼å¿…é¡»å¾ªç¯è¯»å–ç›´åˆ°EAGAIN</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="type">ssize_t</span> n = read(fd, buffer, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (errno == EAGAIN || errno == EWOULDBLOCK) &#123;</span><br><span class="line">            <span class="keyword">break</span>; <span class="comment">// æ•°æ®è¯»å®Œ</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¤„ç†å…¶ä»–é”™è¯¯</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤„ç†è¯»å–çš„æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-é”™è¯¯å¤„ç†">3. é”™è¯¯å¤„ç†</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥spurious wakeup</span></span><br><span class="line"><span class="keyword">if</span> (epoll_wait(...) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// éªŒè¯æ–‡ä»¶æè¿°ç¬¦ç¡®å®å¯è¯»/å¯å†™</span></span><br><span class="line">    <span class="keyword">if</span> (fcntl(fd, F_GETFL) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶æè¿°ç¬¦å·²å…³é—­</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-èµ„æºç®¡ç†">4. èµ„æºç®¡ç†</h3>
<ul>
<li>åŠæ—¶å…³é—­ä¸å†ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦</li>
<li>ä½¿ç”¨EPOLL_CTL_DELç§»é™¤ç›‘æ§</li>
<li>é¿å…æ–‡ä»¶æè¿°ç¬¦æ³„æ¼</li>
</ul>
<hr>
<h2 id="ç›¸å…³æŠ€æœ¯å»¶ä¼¸">ç›¸å…³æŠ€æœ¯å»¶ä¼¸</h2>
<h3 id="ä¸å¼‚æ­¥I-Oçš„å…³ç³»">ä¸å¼‚æ­¥I/Oçš„å…³ç³»</h3>
<ul>
<li>I/Oå¤šè·¯å¤ç”¨ä»å±äºåŒæ­¥I/O</li>
<li>çœŸæ­£çš„å¼‚æ­¥I/Oï¼šAIOã€io_uring</li>
</ul>
<h3 id="ç°ä»£æ¡†æ¶åº”ç”¨">ç°ä»£æ¡†æ¶åº”ç”¨</h3>
<ul>
<li><strong>Nginx</strong>ï¼šåŸºäºepollçš„äº‹ä»¶é©±åŠ¨</li>
<li><strong>Redis</strong>ï¼šäº‹ä»¶å¾ªç¯ + epoll</li>
<li><strong>Node.js</strong>ï¼šlibuväº‹ä»¶å¾ªç¯</li>
</ul>
<h3 id="æ€§èƒ½è°ƒä¼˜è¦ç‚¹">æ€§èƒ½è°ƒä¼˜è¦ç‚¹</h3>
<ul>
<li>åˆç†è®¾ç½®æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</li>
<li>ä¼˜åŒ–å†…æ ¸å‚æ•°</li>
<li>ä½¿ç”¨CPUäº²å’Œæ€§ç»‘å®š</li>
<li>è€ƒè™‘NUMAæ¶æ„å½±å“</li>
</ul>
<hr>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯ç»å†äº†ä»selectåˆ°pollå†åˆ°epollçš„æ¼”è¿›è¿‡ç¨‹ï¼Œæ¯ä¸€æ­¥éƒ½åœ¨è§£å†³å‰ä¸€ä»£æŠ€æœ¯çš„æ€§èƒ½ç“¶é¢ˆã€‚epollä»¥å…¶äº‹ä»¶é©±åŠ¨å’Œçº¢é»‘æ ‘ç®¡ç†çš„åˆ›æ–°è®¾è®¡ï¼ŒæˆåŠŸè§£å†³äº†C10Ké—®é¢˜ï¼Œä¸ºç°ä»£é«˜æ€§èƒ½æœåŠ¡å™¨å¥ å®šäº†åŸºç¡€ã€‚</p>
<p><strong>å…³é”®è®°å¿†ç‚¹ï¼š</strong></p>
<ul>
<li>select/pollï¼šçº¿æ€§éå†ï¼ŒO(n)å¤æ‚åº¦ï¼Œæœ‰æ‹·è´å¼€é”€</li>
<li>epollï¼šäº‹ä»¶é©±åŠ¨ï¼ŒO(1)å¤æ‚åº¦ï¼Œå‡å°‘æ‹·è´</li>
<li>ETæ¨¡å¼é…åˆéé˜»å¡I/Oå®ç°æœ€ä¼˜æ€§èƒ½</li>
<li>é€‰æ‹©æ ‡å‡†ï¼šè¿æ¥æ•°ã€å¹³å°ã€æ€§èƒ½éœ€æ±‚</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>IOå¤šè·¯å¤ç”¨</tag>
        <tag>select</tag>
        <tag>poll</tag>
        <tag>epoll</tag>
        <tag>ç³»ç»Ÿç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 212 - å•è¯æœç´¢ IIï¼ˆWord Search IIï¼‰</title>
    <url>/2025/07/01/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-212-%E5%8D%95%E8%AF%8D%E6%90%9C%E7%B4%A2-ii/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ª <code>m x n</code> äºŒç»´å­—ç¬¦ç½‘æ ¼ <code>board</code> å’Œä¸€ä¸ªå•è¯åˆ—è¡¨ <code>words</code>ï¼Œè¿”å›æ‰€æœ‰åœ¨äºŒç»´ç½‘æ ¼ä¸­å¯ä»¥æ‰¾åˆ°çš„å•è¯ã€‚</p>
<p>å•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­&quot;ç›¸é‚»&quot;å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯åœ¨ä¸€ä¸ªå•è¯ä¸­ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šboard = [[&quot;o&quot;,&quot;a&quot;,&quot;a&quot;,&quot;n&quot;],</span><br><span class="line">              [&quot;e&quot;,&quot;t&quot;,&quot;a&quot;,&quot;e&quot;],</span><br><span class="line">              [&quot;i&quot;,&quot;h&quot;,&quot;k&quot;,&quot;r&quot;],</span><br><span class="line">              [&quot;i&quot;,&quot;f&quot;,&quot;l&quot;,&quot;v&quot;]], </span><br><span class="line">     words = [&quot;oath&quot;,&quot;pea&quot;,&quot;eat&quot;,&quot;rain&quot;]</span><br><span class="line">è¾“å‡ºï¼š[&quot;eat&quot;,&quot;oath&quot;]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šboard = [[&quot;a&quot;,&quot;b&quot;],</span><br><span class="line">              [&quot;c&quot;,&quot;d&quot;]], </span><br><span class="line">     words = [&quot;abcb&quot;]</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>m == board.length</code></li>
<li><code>n == board[i].length</code></li>
<li><code>1 &lt;= m, n &lt;= 12</code></li>
<li><code>board[i][j]</code> æ˜¯ä¸€ä¸ªå°å†™è‹±æ–‡å­—æ¯</li>
<li><code>1 &lt;= words.length &lt;= 3 * 10^4</code></li>
<li><code>1 &lt;= words[i].length &lt;= 10</code></li>
<li><code>words[i]</code> ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
<li><code>words</code> ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²äº’ä¸ç›¸åŒ</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜æ˜¯<strong>å•è¯æœç´¢é—®é¢˜çš„å‡çº§ç‰ˆ</strong>ï¼Œéœ€è¦åœ¨åŒä¸€ä¸ªäºŒç»´ç½‘æ ¼ä¸­æœç´¢å¤šä¸ªå•è¯ã€‚å¦‚æœæˆ‘ä»¬å¯¹æ¯ä¸ªå•è¯éƒ½è¿›è¡Œä¸€æ¬¡ DFS æœç´¢ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šéå¸¸é«˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨**å­—å…¸æ ‘ï¼ˆTrieï¼‰**æ¥ä¼˜åŒ–æœç´¢è¿‡ç¨‹ã€‚</p>
<h3 id="æ ¸å¿ƒæ€è·¯">æ ¸å¿ƒæ€è·¯</h3>
<p><strong>å…³é”®æ´è§</strong>ï¼šä½¿ç”¨å­—å…¸æ ‘å°†æ‰€æœ‰ç›®æ ‡å•è¯å­˜å‚¨åœ¨ä¸€ä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œç„¶ååªéœ€è¦å¯¹ç½‘æ ¼è¿›è¡Œä¸€æ¬¡ DFS éå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­åŒæ—¶åŒ¹é…å­—å…¸æ ‘ä¸­çš„æ‰€æœ‰å•è¯ã€‚</p>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<h4 id="1-æ„å»ºå­—å…¸æ ‘">1. æ„å»ºå­—å…¸æ ‘</h4>
<ul>
<li>å°†æ‰€æœ‰å¾…æœç´¢çš„å•è¯æ’å…¥åˆ°å­—å…¸æ ‘ä¸­</li>
<li>åœ¨å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´çš„å•è¯ï¼Œä¾¿äºè¯†åˆ«å®Œæ•´åŒ¹é…</li>
</ul>
<h4 id="2-DFS-æœç´¢ç­–ç•¥">2. DFS æœç´¢ç­–ç•¥</h4>
<ul>
<li>ä»ç½‘æ ¼çš„æ¯ä¸ªä½ç½®å¼€å§‹è¿›è¡Œ DFS</li>
<li>åœ¨ DFS è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å½“å‰è·¯å¾„çš„å­—ç¬¦åœ¨å­—å…¸æ ‘ä¸­è¿›è¡ŒåŒ¹é…</li>
<li>å¦‚æœå½“å‰è·¯å¾„æ— æ³•åœ¨å­—å…¸æ ‘ä¸­ç»§ç»­åŒ¹é…ï¼Œåˆ™æå‰å‰ªæ</li>
<li>å¦‚æœåŒ¹é…åˆ°å®Œæ•´å•è¯ï¼Œåˆ™è®°å½•ç»“æœ</li>
</ul>
<h4 id="3-å›æº¯æœºåˆ¶">3. å›æº¯æœºåˆ¶</h4>
<ul>
<li>ä½¿ç”¨æ ‡è®°å­—ç¬¦ï¼ˆå¦‚ <code>#</code>ï¼‰æ¥é¿å…åœ¨åŒä¸€æ¬¡ DFS ä¸­é‡å¤è®¿é—®ç›¸åŒä½ç½®</li>
<li>åœ¨ DFS è¿”å›æ—¶æ¢å¤åŸå§‹å­—ç¬¦ï¼Œç¡®ä¿ä¸åŒè·¯å¾„å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒä½ç½®</li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="å­—å…¸æ ‘èŠ‚ç‚¹è®¾è®¡">å­—å…¸æ ‘èŠ‚ç‚¹è®¾è®¡</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Trie1 <span class="keyword">struct</span> &#123;</span><br><span class="line">    nodes [<span class="number">26</span>]*Trie1  <span class="comment">// 26ä¸ªå­—æ¯çš„å­èŠ‚ç‚¹</span></span><br><span class="line">    word  <span class="type">string</span>      <span class="comment">// å­˜å‚¨å®Œæ•´å•è¯ï¼ˆä»…åœ¨å•è¯ç»“å°¾èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="DFS-æœç´¢æµç¨‹">DFS æœç´¢æµç¨‹</h3>
<ol>
<li><strong>è¾¹ç•Œæ£€æŸ¥</strong>ï¼šæ£€æŸ¥åæ ‡æ˜¯å¦è¶Šç•Œæˆ–ä½ç½®æ˜¯å¦å·²è®¿é—®</li>
<li><strong>å­—å…¸æ ‘åŒ¹é…</strong>ï¼šæ ¹æ®å½“å‰å­—ç¬¦åœ¨å­—å…¸æ ‘ä¸­æŸ¥æ‰¾å¯¹åº”å­èŠ‚ç‚¹</li>
<li><strong>å‰ªæä¼˜åŒ–</strong>ï¼šå¦‚æœå­—å…¸æ ‘ä¸­æ²¡æœ‰å¯¹åº”å­èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›</li>
<li><strong>ç»“æœè®°å½•</strong>ï¼šå¦‚æœå½“å‰èŠ‚ç‚¹åŒ…å«å®Œæ•´å•è¯ï¼Œè®°å½•åˆ°ç»“æœä¸­</li>
<li><strong>æ ‡è®°è®¿é—®</strong>ï¼šå°†å½“å‰ä½ç½®æ ‡è®°ä¸ºå·²è®¿é—®ï¼ˆä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼‰</li>
<li><strong>é€’å½’æœç´¢</strong>ï¼šå‘å››ä¸ªæ–¹å‘ç»§ç»­ DFS</li>
<li><strong>æ¢å¤çŠ¶æ€</strong>ï¼šå›æº¯æ—¶æ¢å¤åŸå§‹å­—ç¬¦</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Trie1 <span class="keyword">struct</span> &#123;</span><br><span class="line">    nodes [<span class="number">26</span>]*Trie1</span><br><span class="line">    word  <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Insert</span><span class="params">(word <span class="type">string</span>, root *Trie1)</span></span> &#123;</span><br><span class="line">    node := root</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> word &#123;</span><br><span class="line">        ch := word[i] - <span class="string">&#x27;a&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> node.nodes[ch] == <span class="literal">nil</span> &#123;</span><br><span class="line">            node.nodes[ch] = &amp;Trie1&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        node = node.nodes[ch]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    node.word = word  <span class="comment">// åœ¨å•è¯ç»“å°¾å­˜å‚¨å®Œæ•´å•è¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dirs = []<span class="keyword">struct</span>&#123; x, y <span class="type">int</span> &#125;&#123;&#123;<span class="number">-1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findWords</span><span class="params">(board [][]<span class="type">byte</span>, words []<span class="type">string</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">    <span class="comment">// 1. æ„å»ºå­—å…¸æ ‘</span></span><br><span class="line">    root := &amp;Trie1&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> words &#123;</span><br><span class="line">        Insert(word, root)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    n, m := <span class="built_in">len</span>(board), <span class="built_in">len</span>(board[<span class="number">0</span>])</span><br><span class="line">    seen := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span>&#123;&#125;  <span class="comment">// å»é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. DFS æœç´¢å‡½æ•°</span></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(node *Trie1, x, y <span class="type">int</span>)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(node *Trie1, x, y <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        ch := board[x][y]</span><br><span class="line">        node = node.nodes[ch-<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‰ªæï¼šå¦‚æœå­—å…¸æ ‘ä¸­æ²¡æœ‰å¯¹åº”è·¯å¾„</span></span><br><span class="line">        <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœæ‰¾åˆ°å®Œæ•´å•è¯ï¼Œè®°å½•ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> node.word != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">            seen[node.word] = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ‡è®°å½“å‰ä½ç½®ä¸ºå·²è®¿é—®</span></span><br><span class="line">        board[x][y] = <span class="string">&#x27;#&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‘å››ä¸ªæ–¹å‘ç»§ç»­æœç´¢</span></span><br><span class="line">        <span class="keyword">for</span> _, dir := <span class="keyword">range</span> dirs &#123;</span><br><span class="line">            nx, ny := x+dir.x, y+dir.y</span><br><span class="line">            <span class="keyword">if</span> nx &lt; <span class="number">0</span> || ny &lt; <span class="number">0</span> || nx &gt;= n || ny &gt;= m &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> board[nx][ny] == <span class="string">&#x27;#&#x27;</span> &#123;  <span class="comment">// å·²è®¿é—®è¿‡</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            dfs(node, nx, ny)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å›æº¯ï¼šæ¢å¤åŸå§‹å­—ç¬¦</span></span><br><span class="line">        board[x][y] = ch</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. ä»æ¯ä¸ªä½ç½®å¼€å§‹æœç´¢</span></span><br><span class="line">    <span class="keyword">for</span> i, row := <span class="keyword">range</span> board &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="keyword">range</span> row &#123;</span><br><span class="line">            dfs(root, i, j)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. è½¬æ¢ç»“æœæ ¼å¼</span></span><br><span class="line">    res := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(seen))</span><br><span class="line">    <span class="keyword">for</span> w := <span class="keyword">range</span> seen &#123;</span><br><span class="line">        res = <span class="built_in">append</span>(res, w)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æš´åŠ›è§£æ³•</th>
<th>å­—å…¸æ ‘ + DFS</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(k \cdot m \cdot n \cdot 4^L)$</td>
<td>$O(m \cdot n \cdot 4^L)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(L)$</td>
<td>$O(\sum w_i)$</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç®€å•</td>
<td>é«˜æ•ˆå‰ªæï¼Œå‡å°‘é‡å¤æœç´¢</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>é‡å¤æœç´¢ç›¸åŒè·¯å¾„</td>
<td>éœ€è¦é¢å¤–çš„å­—å…¸æ ‘ç©ºé—´</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$k$ = å•è¯æ•°é‡</li>
<li>$m \times n$ = ç½‘æ ¼å¤§å°</li>
<li>$L$ = å•è¯æœ€å¤§é•¿åº¦</li>
<li>$\sum w_i$ = æ‰€æœ‰å•è¯çš„å­—ç¬¦æ€»æ•°</li>
</ul>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼š-O-m-cdot-n-cdot-4-L">æ—¶é—´å¤æ‚åº¦ï¼š$O(m \cdot n \cdot 4^L)$</h3>
<p>è¯¦ç»†åˆ†æï¼š</p>
<ol>
<li><strong>å­—å…¸æ ‘æ„å»º</strong>ï¼š$O(\sum w_i)$ï¼Œå…¶ä¸­ $\sum w_i$ æ˜¯æ‰€æœ‰å•è¯çš„å­—ç¬¦æ€»æ•°</li>
<li><strong>DFS æœç´¢</strong>ï¼š
<ul>
<li>ä»æ¯ä¸ªä½ç½®å¼€å§‹ï¼š$O(m \cdot n)$</li>
<li>æ¯æ¬¡ DFS æœ€å¤šé€’å½’ $L$ å±‚ï¼ˆå•è¯æœ€å¤§é•¿åº¦ï¼‰</li>
<li>æ¯å±‚æœ‰ 4 ä¸ªæ–¹å‘é€‰æ‹©ï¼š$O(4^L)$</li>
<li>å­—å…¸æ ‘å‰ªæå¤§å¤§å‡å°‘äº†å®é™…æœç´¢ç©ºé—´</li>
</ul>
</li>
</ol>
<p>æ€»æ—¶é—´å¤æ‚åº¦ï¼š$O(m \cdot n \cdot 4^L + \sum w_i)$ï¼Œä¸»è¦éƒ¨åˆ†æ˜¯ $O(m \cdot n \cdot 4^L)$</p>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼š-O-sum-w-i">ç©ºé—´å¤æ‚åº¦ï¼š$O(\sum w_i)$</h3>
<p>ç©ºé—´ä½¿ç”¨åˆ†æï¼š</p>
<ol>
<li><strong>å­—å…¸æ ‘å­˜å‚¨</strong>ï¼š$O(\sum w_i)$ - å­˜å‚¨æ‰€æœ‰å•è¯çš„å­—ç¬¦</li>
<li><strong>DFS é€’å½’æ ˆ</strong>ï¼š$O(L)$ - æœ€å¤§é€’å½’æ·±åº¦ä¸ºå•è¯é•¿åº¦</li>
<li><strong>ç»“æœå­˜å‚¨</strong>ï¼š$O(k \cdot L)$ - æœ€å¤š $k$ ä¸ªå•è¯ï¼Œæ¯ä¸ªé•¿åº¦ $L$</li>
</ol>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="ç®—æ³•æŠ€å·§">ç®—æ³•æŠ€å·§</h3>
<ol>
<li><strong>å­—å…¸æ ‘ä¼˜åŒ–</strong>ï¼šå°†å¤šä¸ªå•è¯çš„æœç´¢é—®é¢˜è½¬åŒ–ä¸ºå•æ¬¡éå†é—®é¢˜</li>
<li><strong>å‰ªæç­–ç•¥</strong>ï¼šåˆ©ç”¨å­—å…¸æ ‘çš„å‰ç¼€ç‰¹æ€§æå‰ç»ˆæ­¢æ— æ•ˆè·¯å¾„</li>
<li><strong>çŠ¶æ€æ¢å¤</strong>ï¼šä½¿ç”¨æ ‡è®°å­—ç¬¦é¿å…é‡å¤è®¿é—®ï¼Œå›æº¯æ—¶æ¢å¤çŠ¶æ€</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>å¿˜è®°å›æº¯</strong>ï¼šå¿…é¡»åœ¨ DFS è¿”å›æ—¶æ¢å¤åŸå§‹å­—ç¬¦</li>
<li><strong>é‡å¤è®¡æ•°</strong>ï¼šä½¿ç”¨ <code>map[string]bool</code> å»é‡ï¼Œé¿å…åŒä¸€å•è¯è¢«å¤šæ¬¡è®¡ç®—</li>
<li><strong>è¾¹ç•Œå¤„ç†</strong>ï¼šæ£€æŸ¥æ•°ç»„è¶Šç•Œå’Œå·²è®¿é—®ä½ç½®</li>
</ol>
<h3 id="æ‰©å±•åº”ç”¨">æ‰©å±•åº”ç”¨</h3>
<ul>
<li><strong>å•è¯æ¸¸æˆ</strong>ï¼šå¦‚ Boggle æ¸¸æˆçš„å•è¯æœç´¢</li>
<li><strong>æ–‡æœ¬åŒ¹é…</strong>ï¼šåœ¨å¤§æ–‡æœ¬ä¸­æœç´¢å¤šä¸ªæ¨¡å¼ä¸²</li>
<li><strong>è·¯å¾„è§„åˆ’</strong>ï¼šåœ¨å›¾ä¸­æœç´¢æ»¡è¶³ç‰¹å®šæ¨¡å¼çš„è·¯å¾„</li>
</ul>
<p>è¿™é“é¢˜å®Œç¾å±•ç¤ºäº†<strong>å­—å…¸æ ‘åœ¨å¤šæ¨¡å¼åŒ¹é…ä¸­çš„å¼ºå¤§ä½œç”¨</strong>ï¼Œæ˜¯æŒæ¡é«˜çº§å­—ç¬¦ä¸²ç®—æ³•çš„é‡è¦é¢˜ç›®ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›æº¯</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>å­—å…¸æ ‘</tag>
        <tag>å›æº¯ç®—æ³•</tag>
        <tag>éš¾åº¦Hard</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 211 - æ·»åŠ ä¸æœç´¢å•è¯-æ•°æ®ç»“æ„è®¾è®¡ï¼ˆDesign Add and Search Words Data Structureï¼‰</title>
    <url>/2025/06/29/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-211-%E6%B7%BB%E5%8A%A0%E4%B8%8E%E6%90%9C%E7%B4%A2%E5%8D%95%E8%AF%8D-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>è¯·ä½ è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œæ”¯æŒæ·»åŠ æ–°å•è¯å’ŒæŸ¥æ‰¾å­—ç¬¦ä¸²æ˜¯å¦ä¸ä»»ä½•å…ˆå‰æ·»åŠ çš„å­—ç¬¦ä¸²åŒ¹é…ã€‚</p>
<p>å®ç°è¯å…¸ç±» <code>WordDictionary</code>ï¼š</p>
<ul>
<li><code>WordDictionary()</code> åˆå§‹åŒ–è¯å…¸å¯¹è±¡</li>
<li><code>void addWord(word)</code> å°† <code>word</code> æ·»åŠ åˆ°æ•°æ®ç»“æ„ä¸­ï¼Œä¹‹åå¯ä»¥å¯¹å®ƒè¿›è¡ŒåŒ¹é…</li>
<li><code>bool search(word)</code> å¦‚æœæ•°æ®ç»“æ„ä¸­å­˜åœ¨å­—ç¬¦ä¸²ä¸ <code>word</code> åŒ¹é…ï¼Œåˆ™è¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚<code>word</code> ä¸­å¯èƒ½åŒ…å«ä¸€äº› <code>'.'</code>ï¼Œæ¯ä¸ª <code>'.'</code> éƒ½å¯ä»¥è¡¨ç¤ºä»»ä½•ä¸€ä¸ªå­—æ¯ã€‚</li>
</ul>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;WordDictionary&quot;,&quot;addWord&quot;,&quot;addWord&quot;,&quot;addWord&quot;,&quot;search&quot;,&quot;search&quot;,&quot;search&quot;,&quot;search&quot;]</span><br><span class="line">[[],[&quot;bad&quot;],[&quot;dad&quot;],[&quot;mad&quot;],[&quot;pad&quot;],[&quot;bad&quot;],[&quot;.ad&quot;],[&quot;b..&quot;]]</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">[null,null,null,null,false,true,true,true]</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">WordDictionary wordDictionary = new WordDictionary();</span><br><span class="line">wordDictionary.addWord(&quot;bad&quot;);</span><br><span class="line">wordDictionary.addWord(&quot;dad&quot;);</span><br><span class="line">wordDictionary.addWord(&quot;mad&quot;);</span><br><span class="line">wordDictionary.search(&quot;pad&quot;); // è¿”å› False</span><br><span class="line">wordDictionary.search(&quot;bad&quot;); // è¿”å› True</span><br><span class="line">wordDictionary.search(&quot;.ad&quot;); // è¿”å› True</span><br><span class="line">wordDictionary.search(&quot;b..&quot;); // è¿”å› True</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>1 &lt;= word.length &lt;= 25</code></li>
<li><code>addWord</code> ä¸­çš„ <code>word</code> ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
<li><code>search</code> ä¸­çš„ <code>word</code> ç”± <code>'.'</code> æˆ–å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
<li>æœ€å¤šè°ƒç”¨ <code>10^4</code> æ¬¡ <code>addWord</code> å’Œ <code>search</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜éœ€è¦å®ç°ä¸€ä¸ªæ”¯æŒé€šé…ç¬¦æœç´¢çš„å­—å…¸æ•°æ®ç»“æ„ã€‚<strong>æ ¸å¿ƒæ€è·¯æ˜¯ä½¿ç”¨å­—å…¸æ ‘(Trie)å­˜å‚¨å•è¯ï¼Œå¹¶ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢(DFS)å¤„ç†é€šé…ç¬¦åŒ¹é…</strong>ã€‚</p>
<h3 id="å…³é”®æ´å¯Ÿ">å…³é”®æ´å¯Ÿ</h3>
<ol>
<li><strong>å­—å…¸æ ‘é€‚åˆå‰ç¼€åŒ¹é…</strong>ï¼šTrieçš„æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œä»æ ¹åˆ°å¶å­çš„è·¯å¾„æ„æˆå®Œæ•´å•è¯</li>
<li><strong>é€šé…ç¬¦éœ€è¦é€’å½’å¤„ç†</strong>ï¼šé‡åˆ° <code>'.'</code> æ—¶ï¼Œéœ€è¦å°è¯•æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦åˆ†æ”¯</li>
<li><strong>çŠ¶æ€è®°å½•å¾ˆé‡è¦</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹éœ€è¦æ ‡è®°æ˜¯å¦ä¸ºå•è¯ç»“å°¾</li>
</ol>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<h4 id="1-æ•°æ®ç»“æ„è®¾è®¡">1. æ•°æ®ç»“æ„è®¾è®¡</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TrieNode ç»“æ„ï¼š</span><br><span class="line">â”œâ”€â”€ children[26]  // 26ä¸ªå°å†™å­—æ¯çš„å­èŠ‚ç‚¹</span><br><span class="line">â””â”€â”€ isEnd        // æ ‡è®°æ˜¯å¦ä¸ºå•è¯ç»“å°¾</span><br></pre></td></tr></table></figure>
<h4 id="2-AddWord-æ“ä½œ">2. AddWord æ“ä½œ</h4>
<ol>
<li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†å¾…æ·»åŠ çš„å•è¯</li>
<li>å¯¹æ¯ä¸ªå­—ç¬¦ï¼Œè®¡ç®—å…¶åœ¨childrenæ•°ç»„ä¸­çš„ç´¢å¼•ï¼š<code>index = char - 'a'</code></li>
<li>å¦‚æœå¯¹åº”å­èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹</li>
<li>ç§»åŠ¨åˆ°å­èŠ‚ç‚¹ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå­—ç¬¦</li>
<li>å•è¯ç»“æŸæ—¶ï¼Œæ ‡è®°å½“å‰èŠ‚ç‚¹çš„ <code>isEnd = true</code></li>
</ol>
<h4 id="3-Search-æ“ä½œï¼ˆæ ¸å¿ƒéš¾ç‚¹ï¼‰">3. Search æ“ä½œï¼ˆæ ¸å¿ƒéš¾ç‚¹ï¼‰</h4>
<p>ä½¿ç”¨é€’å½’DFSå¤„ç†ä¸¤ç§æƒ…å†µï¼š</p>
<p><strong>æ™®é€šå­—ç¬¦</strong>ï¼š</p>
<ul>
<li>ç›´æ¥æ²¿ç€å¯¹åº”çš„å­èŠ‚ç‚¹è·¯å¾„ç»§ç»­æœç´¢</li>
</ul>
<p><strong>é€šé…ç¬¦ â€˜.â€™</strong>ï¼š</p>
<ul>
<li>éå†å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰éç©ºå­èŠ‚ç‚¹</li>
<li>å¯¹æ¯ä¸ªå­èŠ‚ç‚¹é€’å½’è°ƒç”¨æœç´¢å‡½æ•°</li>
<li>åªè¦æœ‰ä¸€ä¸ªåˆ†æ”¯è¿”å›trueï¼Œæ•´ä¸ªæœç´¢å°±æˆåŠŸ</li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="DFSé€’å½’å‡½æ•°è®¾è®¡">DFSé€’å½’å‡½æ•°è®¾è®¡</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfs</span><span class="params">(node *TrieNode, word <span class="type">string</span>, index <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// è¾¹ç•Œæ¡ä»¶æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœç´¢å®Œæˆï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºå•è¯ç»“å°¾</span></span><br><span class="line">    <span class="keyword">if</span> index &gt;= <span class="built_in">len</span>(word) &#123;</span><br><span class="line">        <span class="keyword">return</span> node.isEnd</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†é€šé…ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span> word[index] == <span class="string">&#x27;.&#x27;</span> &#123;</span><br><span class="line">        <span class="comment">// å°è¯•æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦</span></span><br><span class="line">        <span class="keyword">for</span> i := <span class="keyword">range</span> node.children &#123;</span><br><span class="line">            <span class="keyword">if</span> dfs(node.children[i], word, index+<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ™®é€šå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">return</span> dfs(node.children[word[index]-<span class="string">&#x27;a&#x27;</span>], word, index+<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç®—æ³•æ‰§è¡Œç¤ºä¾‹">ç®—æ³•æ‰§è¡Œç¤ºä¾‹</h3>
<p>ä»¥æœç´¢ <code>&quot;.ad&quot;</code> ä¸ºä¾‹ï¼ˆå‡è®¾å­—å…¸ä¸­æœ‰ â€œbadâ€, â€œdadâ€, â€œmadâ€ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. dfs(root, &quot;.ad&quot;, 0)</span><br><span class="line">   â”œâ”€â”€ word[0] = &#x27;.&#x27; â†’ éå†æ‰€æœ‰å­èŠ‚ç‚¹</span><br><span class="line">   â”œâ”€â”€ dfs(node_b, &quot;.ad&quot;, 1) â†’ æœç´¢ &quot;ad&quot;</span><br><span class="line">   â”‚   â””â”€â”€ word[1] = &#x27;a&#x27; â†’ è¿›å…¥node_a</span><br><span class="line">   â”‚       â””â”€â”€ word[2] = &#x27;d&#x27; â†’ è¿›å…¥node_d</span><br><span class="line">   â”‚           â””â”€â”€ index=3, node_d.isEnd=true â†’ è¿”å›true</span><br><span class="line">   â””â”€â”€ æ‰¾åˆ°åŒ¹é…ï¼Œè¿”å›true</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> WordDictionary <span class="keyword">struct</span> &#123;</span><br><span class="line">    root *TrieNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TrieNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    children [<span class="number">26</span>]*TrieNode <span class="comment">// åªé’ˆå¯¹å°å†™å­—æ¯ a-z</span></span><br><span class="line">    isEnd    <span class="type">bool</span>          <span class="comment">// æ ‡è®°å•è¯ç»“æŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span></span> WordDictionary &#123;</span><br><span class="line">    <span class="keyword">return</span> WordDictionary&#123;</span><br><span class="line">        root: &amp;TrieNode&#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *WordDictionary)</span></span> AddWord(word <span class="type">string</span>) &#123;</span><br><span class="line">    node := this.root</span><br><span class="line">    <span class="keyword">for</span> _, ch := <span class="keyword">range</span> word &#123;</span><br><span class="line">        index := ch - <span class="string">&#x27;a&#x27;</span> <span class="comment">// å°†å­—ç¬¦æ˜ å°„åˆ°0-25çš„ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">if</span> node.children[index] == <span class="literal">nil</span> &#123;</span><br><span class="line">            node.children[index] = &amp;TrieNode&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        node = node.children[index]</span><br><span class="line">    &#125;</span><br><span class="line">    node.isEnd = <span class="literal">true</span> <span class="comment">// æ ‡è®°å•è¯ç»“æŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *WordDictionary)</span></span> Search(word <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(node *TrieNode, index <span class="type">int</span>)</span></span> <span class="type">bool</span></span><br><span class="line">    </span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(node *TrieNode, index <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> index &gt;= <span class="built_in">len</span>(word) &#123;</span><br><span class="line">            <span class="keyword">return</span> node.isEnd</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> word[index] == <span class="string">&#x27;.&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// å°è¯•æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦åˆ†æ”¯</span></span><br><span class="line">            <span class="keyword">for</span> i := <span class="keyword">range</span> node.children &#123;</span><br><span class="line">                <span class="keyword">if</span> dfs(node.children[i], index+<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ™®é€šå­—ç¬¦ï¼Œç›´æ¥æ²¿ç€å¯¹åº”è·¯å¾„æœç´¢</span></span><br><span class="line">        <span class="keyword">return</span> dfs(node.children[word[index]-<span class="string">&#x27;a&#x27;</span>], index+<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dfs(this.root, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p><strong>AddWordæ“ä½œ</strong>ï¼š$O(m)$</p>
<ul>
<li>å…¶ä¸­ $m$ æ˜¯å•è¯é•¿åº¦</li>
<li>éœ€è¦éå†å•è¯çš„æ¯ä¸ªå­—ç¬¦</li>
</ul>
<p><strong>Searchæ“ä½œ</strong>ï¼š</p>
<ul>
<li><strong>æœ€å¥½æƒ…å†µ</strong>ï¼š$O(m)$ - æ— é€šé…ç¬¦æ—¶</li>
<li><strong>æœ€åæƒ…å†µ</strong>ï¼š$O(26^k \cdot m)$ - å…¶ä¸­ $k$ æ˜¯é€šé…ç¬¦æ•°é‡</li>
<li>é€šé…ç¬¦ä¼šå¯¼è‡´æŒ‡æ•°çº§çš„æœç´¢åˆ†æ”¯</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<p>$O(ALPHABET_SIZE \times N \times M)$</p>
<ul>
<li>$ALPHABET_SIZE = 26$ï¼ˆå°å†™å­—æ¯æ•°é‡ï¼‰</li>
<li>$N$ æ˜¯å•è¯æ€»æ•°</li>
<li>$M$ æ˜¯å¹³å‡å•è¯é•¿åº¦</li>
<li>Trieçš„ç©ºé—´æ¶ˆè€—å–å†³äºå•è¯çš„å…¬å…±å‰ç¼€</li>
</ul>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>Trie + DFS</th>
<th>å“ˆå¸Œè¡¨ + æš´åŠ›æœç´¢</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>AddWord: O(m)</td>
<td>AddWord: O(1)</td>
</tr>
<tr>
<td></td>
<td>Search: O(26^kÃ—m)</td>
<td>Search: O(NÃ—m)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(26Ã—NÃ—M)</td>
<td>O(NÃ—M)</td>
</tr>
<tr>
<td>é€šé…ç¬¦æ”¯æŒ</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
</tr>
<tr>
<td>å®ç°å¤æ‚åº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
<tr>
<td>å‰ç¼€æŸ¥è¯¢</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜†â˜†â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>Trieé€‚åˆå­—ç¬¦ä¸²å‰ç¼€æ“ä½œ</strong>ï¼šå¯¹äºæ¶‰åŠå­—ç¬¦ä¸²å‰ç¼€åŒ¹é…çš„é—®é¢˜ï¼ŒTrieé€šå¸¸æ˜¯æœ€ä½³é€‰æ‹©</li>
<li><strong>é€’å½’å¤„ç†åˆ†æ”¯é€»è¾‘</strong>ï¼šé€šé…ç¬¦é—®é¢˜å¸¸éœ€è¦é€’å½’æ¢ç´¢å¤šä¸ªå¯èƒ½çš„è·¯å¾„</li>
<li><strong>çŠ¶æ€æ ‡è®°çš„é‡è¦æ€§</strong>ï¼š<code>isEnd</code> æ ‡è®°ç¡®ä¿åªæœ‰å®Œæ•´å•è¯æ‰èƒ½åŒ¹é…æˆåŠŸ</li>
<li><strong>ä¼˜åŒ–æœç´¢ç­–ç•¥</strong>ï¼šå¯ä»¥è€ƒè™‘å‰ªæä¼˜åŒ–ï¼Œæ¯”å¦‚æå‰ç»ˆæ­¢æ— æ•ˆåˆ†æ”¯</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ul>
<li><strong>å¿˜è®°æ£€æŸ¥ <code>isEnd</code></strong>ï¼šæœç´¢åˆ°å•è¯ç»“å°¾æ—¶å¿…é¡»éªŒè¯æ˜¯å¦ä¸ºæœ‰æ•ˆå•è¯</li>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šç©ºèŠ‚ç‚¹å’Œç´¢å¼•è¶Šç•Œéœ€è¦æ­£ç¡®å¤„ç†</li>
<li><strong>é€šé…ç¬¦é€»è¾‘é”™è¯¯</strong>ï¼šéœ€è¦éå†æ‰€æœ‰å¯èƒ½çš„å­èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„</li>
</ul>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><a href="https://leetcode.cn/problems/implement-trie-prefix-tree/">LeetCode 208: å®ç° Trie (å‰ç¼€æ ‘)</a></li>
<li><a href="https://leetcode.cn/problems/word-search/">LeetCode 79: å•è¯æœç´¢</a></li>
<li><a href="https://leetcode.cn/problems/word-search-ii/">LeetCode 212: å•è¯æœç´¢ II</a></li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ¨¡æ‹Ÿ</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>DFS</tag>
        <tag>Trie</tag>
        <tag>å­—å…¸æ ‘</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 127 - å•è¯æ¥é¾™ï¼ˆWord Ladderï¼‰</title>
    <url>/2025/06/29/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-127-%E5%8D%95%E8%AF%8D%E6%8E%A5%E9%BE%99/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>å­—å…¸ <code>wordList</code> ä¸­ä»å•è¯ <code>beginWord</code> å’Œ <code>endWord</code> çš„<strong>è½¬æ¢åºåˆ—</strong>æ˜¯ä¸€ä¸ªæŒ‰ä¸‹è¿°è§„æ ¼ç»„æˆçš„åºåˆ—ï¼š</p>
<ol>
<li>åºåˆ—ä¸­ç¬¬ä¸€ä¸ªå•è¯æ˜¯ <code>beginWord</code></li>
<li>åºåˆ—ä¸­æœ€åä¸€ä¸ªå•è¯æ˜¯ <code>endWord</code></li>
<li>æ¯æ¬¡è½¬æ¢åªèƒ½æ”¹å˜ä¸€ä¸ªå­—æ¯</li>
<li>è½¬æ¢è¿‡ç¨‹ä¸­çš„ä¸­é—´å•è¯å¿…é¡»æ˜¯å­—å…¸ <code>wordList</code> ä¸­çš„å•è¯</li>
</ol>
<p>ç»™ä½ ä¸¤ä¸ªå•è¯ <code>beginWord</code> å’Œ <code>endWord</code> å’Œä¸€ä¸ªå­—å…¸ <code>wordList</code>ï¼Œæ‰¾åˆ°ä» <code>beginWord</code> åˆ° <code>endWord</code> çš„<strong>æœ€çŸ­è½¬æ¢åºåˆ—</strong>ä¸­çš„<strong>å•è¯æ•°ç›®</strong>ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„è½¬æ¢åºåˆ—ï¼Œè¿”å› 0ã€‚</p>
<h3 id="ç¤ºä¾‹-1">ç¤ºä¾‹ 1</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šbeginWord = &quot;hit&quot;, endWord = &quot;cog&quot;, wordList = [&quot;hot&quot;,&quot;dot&quot;,&quot;dog&quot;,&quot;lot&quot;,&quot;log&quot;,&quot;cog&quot;]</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line">è§£é‡Šï¼šä¸€ä¸ªæœ€çŸ­è½¬æ¢åºåˆ—æ˜¯ &quot;hit&quot; -&gt; &quot;hot&quot; -&gt; &quot;dot&quot; -&gt; &quot;dog&quot; -&gt; &quot;cog&quot;, è¿”å›å®ƒçš„é•¿åº¦ 5ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹ 2</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šbeginWord = &quot;hit&quot;, endWord = &quot;cog&quot;, wordList = [&quot;hot&quot;,&quot;dot&quot;,&quot;dog&quot;,&quot;lot&quot;,&quot;log&quot;]</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼šendWord &quot;cog&quot; ä¸åœ¨å­—å…¸ä¸­ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œè½¬æ¢ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>1 &lt;= beginWord.length &lt;= 10</code></li>
<li><code>endWord.length == beginWord.length</code></li>
<li><code>1 &lt;= wordList.length &lt;= 5000</code></li>
<li><code>wordList[i].length == beginWord.length</code></li>
<li><code>beginWord</code>ã€<code>endWord</code> å’Œ <code>wordList[i]</code> ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
<li><code>beginWord != endWord</code></li>
<li><code>wordList</code> ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²<strong>äº’ä¸ç›¸åŒ</strong></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>å›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜</strong>ã€‚æˆ‘ä»¬éœ€è¦å°†å•è¯è½¬æ¢é—®é¢˜å»ºæ¨¡ä¸ºå›¾ï¼Œç„¶åä½¿ç”¨ BFS æ‰¾åˆ°æœ€çŸ­è·¯å¾„ã€‚</p>
<h3 id="æ ¸å¿ƒæ´å¯Ÿ">æ ¸å¿ƒæ´å¯Ÿ</h3>
<p><strong>å…³é”®æ€è·¯</strong>ï¼šå°†æ¯ä¸ªå•è¯çœ‹ä½œå›¾ä¸­çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸¤ä¸ªå•è¯åªç›¸å·®ä¸€ä¸ªå­—ç¬¦ï¼Œå°±åœ¨å®ƒä»¬ä¹‹é—´å»ºç«‹ä¸€æ¡è¾¹ã€‚ç„¶åä½¿ç”¨ BFS ä» <code>beginWord</code> å¼€å§‹æœç´¢åˆ° <code>endWord</code> çš„æœ€çŸ­è·¯å¾„ã€‚</p>
<h3 id="è™šæ‹ŸèŠ‚ç‚¹æŠ€å·§">è™šæ‹ŸèŠ‚ç‚¹æŠ€å·§</h3>
<p>ç›´æ¥æ¯”è¾ƒæ¯å¯¹å•è¯æ˜¯å¦åªç›¸å·®ä¸€ä¸ªå­—ç¬¦çš„æ—¶é—´å¤æ‚åº¦å¾ˆé«˜ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå·§å¦™çš„<strong>è™šæ‹ŸèŠ‚ç‚¹</strong>æŠ€å·§ï¼š</p>
<ol>
<li>å¯¹äºæ¯ä¸ªå•è¯çš„æ¯ä¸ªä½ç½®ï¼Œå°†è¯¥ä½ç½®çš„å­—ç¬¦æ›¿æ¢ä¸º <code>*</code>ï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹</li>
<li>ä¾‹å¦‚ï¼š<code>&quot;hit&quot;</code> å¯ä»¥ç”Ÿæˆ <code>&quot;*it&quot;</code>ã€<code>&quot;h*t&quot;</code>ã€<code>&quot;hi*&quot;</code> ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹</li>
<li>æ‰€æœ‰èƒ½ç”Ÿæˆç›¸åŒè™šæ‹ŸèŠ‚ç‚¹çš„å•è¯ä¹‹é—´éƒ½åªç›¸å·®ä¸€ä¸ªå­—ç¬¦</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å•è¯å›¾ç¤ºä¾‹ï¼š</span><br><span class="line">hit -&gt; *it &lt;- hot</span><br><span class="line">hit -&gt; h*t &lt;- hut  </span><br><span class="line">hit -&gt; hi* &lt;- his</span><br><span class="line"></span><br><span class="line">è¿™æ · hit å’Œ hot é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹ *it è¿æ¥èµ·æ¥</span><br></pre></td></tr></table></figure>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li>
<p><strong>å»ºå›¾é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªå•è¯åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹</li>
<li>å»ºç«‹å•è¯èŠ‚ç‚¹ä¸è™šæ‹ŸèŠ‚ç‚¹ä¹‹é—´çš„åŒå‘è¾¹</li>
</ul>
</li>
<li>
<p><strong>BFS æœç´¢é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ä» <code>beginWord</code> å¼€å§‹ BFS</li>
<li>å½“æ‰¾åˆ° <code>endWord</code> æ—¶è¿”å›è·¯å¾„é•¿åº¦</li>
<li>ç”±äºå­˜åœ¨è™šæ‹ŸèŠ‚ç‚¹ï¼Œå®é™…è·¯å¾„é•¿åº¦éœ€è¦é™¤ä»¥ 2 å†åŠ  1</li>
</ul>
</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="å»ºå›¾è¿‡ç¨‹">å»ºå›¾è¿‡ç¨‹</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ å•è¯åˆ°å›¾ä¸­ï¼Œè¿”å›å•è¯çš„ID</span></span><br><span class="line">addWord := <span class="function"><span class="keyword">func</span><span class="params">(word <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    id, has := wordId[word]</span><br><span class="line">    <span class="keyword">if</span> !has &#123;</span><br><span class="line">        id = <span class="built_in">len</span>(wordId)</span><br><span class="line">        wordId[word] = id</span><br><span class="line">        graph = <span class="built_in">append</span>(graph, []<span class="type">int</span>&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºå•è¯åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹å¹¶å»ºç«‹è¿æ¥</span></span><br><span class="line">addEdge := <span class="function"><span class="keyword">func</span><span class="params">(word <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    id1 := addWord(word)</span><br><span class="line">    s := []<span class="type">byte</span>(word)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, b := <span class="keyword">range</span> s &#123;</span><br><span class="line">        s[i] = <span class="string">&#x27;*&#x27;</span>                    <span class="comment">// åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹</span></span><br><span class="line">        id2 := addWord(<span class="type">string</span>(s))     <span class="comment">// æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹</span></span><br><span class="line">        graph[id1] = <span class="built_in">append</span>(graph[id1], id2)  <span class="comment">// å»ºç«‹åŒå‘è¾¹</span></span><br><span class="line">        graph[id2] = <span class="built_in">append</span>(graph[id2], id1)</span><br><span class="line">        s[i] = b                      <span class="comment">// æ¢å¤åŸå­—ç¬¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> id1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BFS-æœç´¢è¿‡ç¨‹">BFS æœç´¢è¿‡ç¨‹</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–è·ç¦»æ•°ç»„</span></span><br><span class="line"><span class="keyword">const</span> inf <span class="type">int</span> = math.MaxInt32</span><br><span class="line">dist := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(wordId))</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> dist &#123;</span><br><span class="line">    dist[i] = inf</span><br><span class="line">&#125;</span><br><span class="line">dist[beginId] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BFS é˜Ÿåˆ—</span></span><br><span class="line">queue := []<span class="type">int</span>&#123;beginId&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">    v := queue[<span class="number">0</span>]</span><br><span class="line">    queue = queue[<span class="number">1</span>:]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> v == endId &#123;</span><br><span class="line">        <span class="keyword">return</span> dist[endId]/<span class="number">2</span> + <span class="number">1</span>  <span class="comment">// é™¤ä»¥2æ˜¯å› ä¸ºæœ‰è™šæ‹ŸèŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> _, w := <span class="keyword">range</span> graph[v] &#123;</span><br><span class="line">        <span class="keyword">if</span> dist[w] == inf &#123;</span><br><span class="line">            dist[w] = dist[v] + <span class="number">1</span></span><br><span class="line">            queue = <span class="built_in">append</span>(queue, w)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ladderLength</span><span class="params">(beginWord <span class="type">string</span>, endWord <span class="type">string</span>, wordList []<span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    wordId := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">    graph := <span class="built_in">make</span>([][]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ å•è¯åˆ°å›¾ä¸­</span></span><br><span class="line">    addWord := <span class="function"><span class="keyword">func</span><span class="params">(word <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        id, has := wordId[word]</span><br><span class="line">        <span class="keyword">if</span> !has &#123;</span><br><span class="line">            id = <span class="built_in">len</span>(wordId)</span><br><span class="line">            wordId[word] = id</span><br><span class="line">            graph = <span class="built_in">append</span>(graph, []<span class="type">int</span>&#123;&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> id</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸ºå•è¯åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹å¹¶å»ºç«‹è¿æ¥</span></span><br><span class="line">    addEdge := <span class="function"><span class="keyword">func</span><span class="params">(word <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        id1 := addWord(word)</span><br><span class="line">        s := []<span class="type">byte</span>(word)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i, b := <span class="keyword">range</span> s &#123;</span><br><span class="line">            s[i] = <span class="string">&#x27;*&#x27;</span></span><br><span class="line">            id2 := addWord(<span class="type">string</span>(s))</span><br><span class="line">            graph[id1] = <span class="built_in">append</span>(graph[id1], id2)</span><br><span class="line">            graph[id2] = <span class="built_in">append</span>(graph[id2], id1)</span><br><span class="line">            s[i] = b</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> id1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å»ºå›¾ï¼šå¤„ç†å­—å…¸ä¸­çš„æ‰€æœ‰å•è¯</span></span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> wordList &#123;</span><br><span class="line">        addEdge(word)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ èµ·å§‹å•è¯</span></span><br><span class="line">    beginId := addEdge(beginWord)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥ç›®æ ‡å•è¯æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    endId, has := wordId[endWord]</span><br><span class="line">    <span class="keyword">if</span> !has &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// BFS æœç´¢æœ€çŸ­è·¯å¾„</span></span><br><span class="line">    <span class="keyword">const</span> inf <span class="type">int</span> = math.MaxInt32</span><br><span class="line">    dist := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(wordId))</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> dist &#123;</span><br><span class="line">        dist[i] = inf</span><br><span class="line">    &#125;</span><br><span class="line">    dist[beginId] = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    queue := []<span class="type">int</span>&#123;beginId&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        v := queue[<span class="number">0</span>]</span><br><span class="line">        queue = queue[<span class="number">1</span>:]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> v == endId &#123;</span><br><span class="line">            <span class="keyword">return</span> dist[endId]/<span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> _, w := <span class="keyword">range</span> graph[v] &#123;</span><br><span class="line">            <span class="keyword">if</span> dist[w] == inf &#123;</span><br><span class="line">                dist[w] = dist[v] + <span class="number">1</span></span><br><span class="line">                queue = <span class="built_in">append</span>(queue, w)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç®—æ³•æ‰§è¡Œç¤ºä¾‹">ç®—æ³•æ‰§è¡Œç¤ºä¾‹</h2>
<p>ä»¥ <code>beginWord = &quot;hit&quot;</code>, <code>endWord = &quot;cog&quot;</code>, <code>wordList = [&quot;hot&quot;,&quot;dot&quot;,&quot;dog&quot;,&quot;lot&quot;,&quot;log&quot;,&quot;cog&quot;]</code> ä¸ºä¾‹ï¼š</p>
<h3 id="å»ºå›¾é˜¶æ®µ">å»ºå›¾é˜¶æ®µ</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å•è¯èŠ‚ç‚¹ï¼šhit(0), hot(1), dot(2), dog(3), lot(4), log(5), cog(6)</span><br><span class="line">è™šæ‹ŸèŠ‚ç‚¹ï¼š*it(7), h*t(8), hi*(9), *ot(10), ho*(11), ...</span><br><span class="line"></span><br><span class="line">è¿æ¥å…³ç³»ï¼š</span><br><span class="line">hit(0) &lt;-&gt; *it(7) &lt;-&gt; hot(1)</span><br><span class="line">hit(0) &lt;-&gt; h*t(8) &lt;-&gt; hot(1)  </span><br><span class="line">hot(1) &lt;-&gt; *ot(10) &lt;-&gt; dot(2), lot(4)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="BFS-æœç´¢è¿‡ç¨‹-2">BFS æœç´¢è¿‡ç¨‹</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹ï¼šqueue = [0(hit)], dist[0] = 0</span><br><span class="line"></span><br><span class="line">ç¬¬1è½®ï¼šè®¿é—® hit(0)</span><br><span class="line">- è®¿é—®è™šæ‹ŸèŠ‚ç‚¹ *it(7), h*t(8), hi*(9)</span><br><span class="line">- dist[7] = dist[8] = dist[9] = 1</span><br><span class="line">- queue = [7, 8, 9]</span><br><span class="line"></span><br><span class="line">ç¬¬2è½®ï¼šè®¿é—®è™šæ‹ŸèŠ‚ç‚¹</span><br><span class="line">- é€šè¿‡ *it(7) è®¿é—®åˆ° hot(1), dist[1] = 2</span><br><span class="line">- queue = [8, 9, 1]</span><br><span class="line"></span><br><span class="line">...ç»§ç»­ç›´åˆ°æ‰¾åˆ° cog(6)</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆï¼šdist[6] = 8ï¼Œè¿”å› 8/2 + 1 = 5</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼š-O-M-2-times-N">æ—¶é—´å¤æ‚åº¦ï¼š$O(M^2 \times N)$</h3>
<ul>
<li>$M$ æ˜¯å•è¯é•¿åº¦ï¼Œ$N$ æ˜¯å•è¯åˆ—è¡¨é•¿åº¦</li>
<li>å»ºå›¾é˜¶æ®µï¼šæ¯ä¸ªå•è¯åˆ›å»º $M$ ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œæ€»å…± $O(M \times N)$ ä¸ªèŠ‚ç‚¹</li>
<li>BFS é˜¶æ®µï¼šæœ€åæƒ…å†µä¸‹è®¿é—®æ‰€æœ‰èŠ‚ç‚¹å’Œè¾¹ï¼Œè¾¹æ•°ä¸º $O(M \times N)$</li>
<li>å­—ç¬¦ä¸²æ“ä½œï¼šæ¯æ¬¡å­—ç¬¦ä¸²å¤åˆ¶éœ€è¦ $O(M)$ æ—¶é—´</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼š-O-M-2-times-N">ç©ºé—´å¤æ‚åº¦ï¼š$O(M^2 \times N)$</h3>
<ul>
<li>å›¾å­˜å‚¨ï¼š$O(M \times N)$ ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šè¿æ¥ $O(M)$ æ¡è¾¹</li>
<li>é˜Ÿåˆ—å’Œè·ç¦»æ•°ç»„ï¼š$O(M \times N)$</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="é‡è¦ç®—æ³•æ¦‚å¿µ">é‡è¦ç®—æ³•æ¦‚å¿µ</h3>
<ol>
<li><strong>å›¾å»ºæ¨¡</strong>ï¼šå°†é—®é¢˜è½¬æ¢ä¸ºå›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜</li>
<li><strong>è™šæ‹ŸèŠ‚ç‚¹æŠ€å·§</strong>ï¼šé¿å…ç›´æ¥æ¯”è¾ƒæ‰€æœ‰å•è¯å¯¹ï¼Œæé«˜å»ºå›¾æ•ˆç‡</li>
<li><strong>BFS ç‰¹æ€§</strong>ï¼šä¿è¯æ‰¾åˆ°æœ€çŸ­è·¯å¾„</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>å¿˜è®°æ£€æŸ¥ç›®æ ‡å•è¯</strong>ï¼šå¦‚æœ <code>endWord</code> ä¸åœ¨å­—å…¸ä¸­ç›´æ¥è¿”å› 0</li>
<li><strong>è·¯å¾„é•¿åº¦è®¡ç®—é”™è¯¯</strong>ï¼šç”±äºæœ‰è™šæ‹ŸèŠ‚ç‚¹ï¼Œéœ€è¦ <code>dist/2 + 1</code></li>
<li><strong>åŒå‘è¾¹å»ºç«‹</strong>ï¼šè™šæ‹ŸèŠ‚ç‚¹ä¸å•è¯èŠ‚ç‚¹ä¹‹é—´éœ€è¦å»ºç«‹åŒå‘è¿æ¥</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li>LeetCode 126: å•è¯æ¥é¾™ IIï¼ˆè¿”å›æ‰€æœ‰æœ€çŸ­è·¯å¾„ï¼‰</li>
<li>LeetCode 433: æœ€å°åŸºå› å˜åŒ–ï¼ˆç›¸ä¼¼çš„BFSé—®é¢˜ï¼‰</li>
<li>å…¶ä»–å›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜</li>
</ul>
<p>è¿™é“é¢˜å±•ç¤ºäº†å¦‚ä½•å°†å­—ç¬¦ä¸²è½¬æ¢é—®é¢˜å·§å¦™åœ°è½¬åŒ–ä¸ºå›¾è®ºé—®é¢˜ï¼Œå¹¶ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹ä¼˜åŒ–å»ºå›¾è¿‡ç¨‹ï¼Œæ˜¯ BFS ç®—æ³•çš„ç»å…¸åº”ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ¨¡æ‹Ÿ</category>
      </categories>
      <tags>
        <tag>å¹¿åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>å›¾</tag>
        <tag>BFS</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 433 - æœ€å°åŸºå› å˜åŒ– (Minimum Genetic Mutation)</title>
    <url>/2025/06/25/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-433-%E6%9C%80%E5%B0%8F%E5%9F%BA%E5%9B%A0%E5%8F%98%E5%8C%96/</url>
    <content><![CDATA[<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>åŸºå› åºåˆ—å¯ä»¥è¡¨ç¤ºä¸ºä¸€æ¡ç”± 8 ä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ â€˜Aâ€™ã€â€˜Câ€™ã€â€˜Gâ€™ å’Œ â€˜Tâ€™ ä¹‹ä¸€ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦è°ƒæŸ¥ä»åŸºå› åºåˆ— <code>startGene</code> å˜ä¸º <code>endGene</code> æ‰€å‘ç”Ÿçš„åŸºå› å˜åŒ–ã€‚ä¸€æ¬¡åŸºå› å˜åŒ–å°±æ„å‘³ç€è¿™ä¸ªåŸºå› åºåˆ—ä¸­çš„ä¸€ä¸ªå­—ç¬¦å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<ul>
<li>ä¾‹å¦‚ï¼Œ<code>&quot;AACCGGTT&quot; --&gt; &quot;AACCGGTA&quot;</code> å°±æ˜¯ä¸€æ¬¡åŸºå› å˜åŒ–ã€‚</li>
</ul>
<p>å¦æœ‰ä¸€ä¸ªåŸºå› åº“ <code>bank</code> è®°å½•äº†æ‰€æœ‰æœ‰æ•ˆçš„åŸºå› å˜åŒ–ï¼Œåªæœ‰åŸºå› åº“ä¸­çš„åŸºå› æ‰æ˜¯æœ‰æ•ˆçš„åŸºå› åºåˆ—ã€‚ï¼ˆå˜åŒ–åçš„åŸºå› å¿…é¡»ä½äºåŸºå› åº“ <code>bank</code> ä¸­ï¼‰</p>
<p>ç»™ä½ ä¸¤ä¸ªåŸºå› åºåˆ— <code>startGene</code> å’Œ <code>endGene</code> ï¼Œä»¥åŠä¸€ä¸ªåŸºå› åº“ <code>bank</code> ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›èƒ½å¤Ÿä½¿ <code>startGene</code> å˜åŒ–ä¸º <code>endGene</code> æ‰€éœ€çš„ <strong>æœ€å°‘å˜åŒ–æ¬¡æ•°</strong>ã€‚å¦‚æœæ— æ³•å®Œæˆæ­¤åŸºå› å˜åŒ–ï¼Œè¿”å› -1 ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> èµ·å§‹åŸºå› åºåˆ— <code>startGene</code> é»˜è®¤æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸ä¸€å®šä¼šå‡ºç°åœ¨åŸºå› åº“ä¸­ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šstartGene = &quot;AACCGGTT&quot;, endGene = &quot;AACCGGTA&quot;, bank = [&quot;AACCGGTA&quot;]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šstartGene = &quot;AACCGGTT&quot;, endGene = &quot;AAACGGTA&quot;, bank = [&quot;AACCGGTA&quot;,&quot;AACCGCTA&quot;,&quot;AAACGGTA&quot;]</span><br><span class="line">è¾“å‡ºï¼š2</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šstartGene = &quot;AAAAACCC&quot;, endGene = &quot;AACCCCCC&quot;, bank = [&quot;AAAACCCC&quot;,&quot;AAACCCCC&quot;,&quot;AACCCCCC&quot;]</span><br><span class="line">è¾“å‡ºï¼š3</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶:</strong></p>
<ul>
<li><code>startGene.length == 8</code></li>
<li><code>endGene.length == 8</code></li>
<li><code>0 &lt;= bank.length &lt;= 10</code></li>
<li><code>bank[i].length == 8</code></li>
<li><code>startGene</code>ã€<code>endGene</code> å’Œ <code>bank[i]</code> ä»…ç”±å­—ç¬¦ <code>['A', 'C', 'G', 'T']</code> ç»„æˆ</li>
</ul>
<h3 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h3>
<p>è¿™ä¸ªé—®é¢˜è¦æ±‚è§£&quot;æœ€å°‘å˜åŒ–æ¬¡æ•°&quot;ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æœ€çŸ­è·¯å¾„é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªåŸºå› åºåˆ—çœ‹ä½œä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœä¸¤ä¸ªåŸºå› åºåˆ—ä¹‹é—´å¯ä»¥é€šè¿‡ä¸€æ¬¡å˜åŒ–ï¼ˆå³ä¸€ä¸ªå­—ç¬¦ä¸åŒï¼‰ç›¸äº’è½¬æ¢ï¼Œå¹¶ä¸”ç›®æ ‡åºåˆ—åœ¨åŸºå› åº“ <code>bank</code> ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å°±å­˜åœ¨ä¸€æ¡è¾¹ã€‚é—®é¢˜çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°ä» <code>startGene</code> åˆ° <code>endGene</code> çš„æœ€çŸ­è·¯å¾„ã€‚</p>
<h4 id="æ€è·¯ä¸€ï¼šå»ºå›¾-Dijkstra-ç®—æ³•">æ€è·¯ä¸€ï¼šå»ºå›¾ + Dijkstra ç®—æ³•</h4>
<p>è¿™ç§æ–¹æ³•å°†é—®é¢˜æ˜¾å¼åœ°è½¬æ¢ä¸ºå›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜ã€‚</p>
<ol>
<li><strong>èŠ‚ç‚¹å®šä¹‰</strong>ï¼šå°† <code>startGene</code> ä»¥åŠ <code>bank</code> ä¸­æ‰€æœ‰ä¸é‡å¤çš„åŸºå› åºåˆ—ä½œä¸ºå›¾çš„èŠ‚ç‚¹ã€‚</li>
<li><strong>è¾¹çš„å®šä¹‰</strong>ï¼šå¦‚æœä¸¤ä¸ªåŸºå› åºåˆ—ï¼ˆèŠ‚ç‚¹ï¼‰ä¹‹é—´åªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸åŒï¼Œåˆ™åœ¨å®ƒä»¬ä¹‹é—´è¿æ¥ä¸€æ¡æƒé‡ä¸º 1 çš„è¾¹ã€‚</li>
<li><strong>æ„å»ºé‚»æ¥çŸ©é˜µ</strong>ï¼šæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé‚»æ¥çŸ©é˜µ <code>graph</code> æ¥å­˜å‚¨å›¾çš„ç»“æ„ã€‚<code>graph[i][j] = 1</code> è¡¨ç¤ºèŠ‚ç‚¹ <code>i</code> å’ŒèŠ‚ç‚¹ <code>j</code> ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ã€‚</li>
<li><strong>æœ€çŸ­è·¯å¾„ç®—æ³•</strong>ï¼šåœ¨æ„å»ºå¥½çš„å›¾ä¸Šï¼Œä» <code>startGene</code> å¯¹åº”çš„èŠ‚ç‚¹å¼€å§‹ï¼Œä½¿ç”¨ Dijkstra ç®—æ³•è®¡ç®—åˆ° <code>endGene</code> å¯¹åº”èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚</li>
</ol>
<h5 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h5>
<p>Dijkstra ç®—æ³•æ˜¯ä¸€ç§ç»å…¸çš„è§£å†³å•æºæœ€çŸ­è·¯å¾„é—®é¢˜çš„ç®—æ³•ï¼Œå®ƒé€‚ç”¨äºè¾¹æƒä¸ºéè´Ÿæ•°çš„æƒ…å†µã€‚è™½ç„¶åœ¨è¿™é‡Œæ‰€æœ‰è¾¹æƒéƒ½ä¸º 1ï¼Œä½¿ç”¨å®ƒä¹Ÿæ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚</p>
<h5 id="ä»£ç å®ç°-Go-Dijkstra">ä»£ç å®ç° (Go - Dijkstra)</h5>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;math&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// LeetCode 433</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minMutation</span><span class="params">(startGene <span class="type">string</span>, endGene <span class="type">string</span>, bank []<span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	cnt := <span class="number">0</span></span><br><span class="line">	DNA2Index := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°† startGene å’Œ bank ä¸­çš„åŸºå› åºåˆ—åŠ å…¥æ˜ å°„å¹¶ç¼–å·</span></span><br><span class="line">	DNA2Index[startGene] = cnt</span><br><span class="line">	cnt++</span><br><span class="line">	<span class="keyword">for</span> _, dna := <span class="keyword">range</span> bank &#123;</span><br><span class="line">		<span class="keyword">if</span> _, ok := DNA2Index[dna]; ok &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		DNA2Index[dna] = cnt</span><br><span class="line">		cnt++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœ endGene ä¸åœ¨å¯è¾¾çš„åŸºå› åº“ä¸­ï¼Œç›´æ¥è¿”å› -1</span></span><br><span class="line">	<span class="keyword">if</span> _, ok := DNA2Index[endGene]; !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–é‚»æ¥çŸ©é˜µ</span></span><br><span class="line">	graph := <span class="built_in">make</span>([][]<span class="type">int</span>, cnt)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> graph &#123;</span><br><span class="line">		graph[i] = <span class="built_in">make</span>([]<span class="type">int</span>, cnt)</span><br><span class="line">		<span class="keyword">for</span> j := <span class="keyword">range</span> graph[i] &#123;</span><br><span class="line">			<span class="keyword">if</span> i != j &#123;</span><br><span class="line">				graph[i][j] = math.MaxInt32</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æ ¹æ®åŸºå› å·®å¼‚æ„å»ºå›¾çš„è¾¹</span></span><br><span class="line">	dnaList := <span class="built_in">make</span>([]<span class="type">string</span>, cnt)</span><br><span class="line">	<span class="keyword">for</span> dna, index := <span class="keyword">range</span> DNA2Index &#123;</span><br><span class="line">		dnaList[index] = dna</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; cnt; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; cnt; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> diff(dnaList[i], dnaList[j]) == <span class="number">1</span> &#123;</span><br><span class="line">				graph[i][j] = <span class="number">1</span></span><br><span class="line">				graph[j][i] = <span class="number">1</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	startIndex := DNA2Index[startGene]</span><br><span class="line">	endIndex := DNA2Index[endGene]</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä½¿ç”¨ Dijkstra ç®—æ³•æ±‚è§£</span></span><br><span class="line">	dist, has := dijkstra(graph, startIndex, endIndex)</span><br><span class="line">	<span class="keyword">if</span> !has &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dijkstra ç®—æ³•å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dijkstra</span><span class="params">(matrix [][]<span class="type">int</span>, start, end <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">bool</span>) &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(matrix)</span><br><span class="line">	dist := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">	visited := <span class="built_in">make</span>([]<span class="type">bool</span>, n)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> dist &#123;</span><br><span class="line">		dist[i] = math.MaxInt32</span><br><span class="line">	&#125;</span><br><span class="line">	dist[start] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		u := <span class="number">-1</span></span><br><span class="line">		minDist := math.MaxInt32</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; n; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> !visited[j] &amp;&amp; dist[j] &lt; minDist &#123;</span><br><span class="line">				minDist = dist[j]</span><br><span class="line">				u = j</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> u == <span class="number">-1</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		visited[u] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> v := <span class="number">0</span>; v &lt; n; v++ &#123;</span><br><span class="line">			<span class="keyword">if</span> !visited[v] &amp;&amp; matrix[u][v] != math.MaxInt32 &amp;&amp; dist[u]+matrix[u][v] &lt; dist[v] &#123;</span><br><span class="line">				dist[v] = dist[u] + matrix[u][v]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> dist[end] == math.MaxInt32 &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dist[end], <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—ä¸¤ä¸ªåŸºå› åºåˆ—çš„å·®å¼‚å­—ç¬¦æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">diff</span><span class="params">(a, b <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	diffNum := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(a); i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> a[i] != b[i] &#123;</span><br><span class="line">			diffNum++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> diffNum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ€è·¯äºŒï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢-BFS">æ€è·¯äºŒï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢ (BFS)</h4>
<p>å¯¹äºè¾¹æƒå…¨éƒ¨ä¸º 1 çš„å›¾ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰æ˜¯æ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜çš„æ›´ç›´æ¥ã€æ›´é«˜æ•ˆçš„é€‰æ‹©ã€‚BFS æŒ‰å±‚çº§éå†å›¾ï¼Œç¬¬ä¸€æ¬¡åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹æ—¶æ‰€ç»è¿‡çš„å±‚æ•°ï¼ˆæ­¥æ•°ï¼‰å°±æ˜¯æœ€çŸ­è·¯å¾„çš„é•¿åº¦ã€‚</p>
<ol>
<li><strong>æ•°æ®ç»“æ„</strong>ï¼š
<ul>
<li>ä¸€ä¸ªé˜Ÿåˆ— <code>queue</code> ç”¨äºå­˜å‚¨å¾…è®¿é—®çš„åŸºå› åºåˆ—ã€‚</li>
<li>ä¸€ä¸ªå“ˆå¸Œé›†åˆ <code>visited</code> (æˆ– <code>map</code>) ç”¨äºè®°å½•å·²ç»è®¿é—®è¿‡çš„åºåˆ—ï¼Œé˜²æ­¢é‡å¤æœç´¢å’Œé™·å…¥å¾ªç¯ã€‚</li>
<li>ä¸€ä¸ªå“ˆå¸Œé›†åˆ <code>bankSet</code> ç”¨äºå¿«é€ŸæŸ¥è¯¢ä¸€ä¸ªåŸºå› åºåˆ—æ˜¯å¦åœ¨åŸºå› åº“ <code>bank</code> ä¸­ã€‚</li>
</ul>
</li>
<li><strong>ç®—æ³•æµç¨‹</strong>ï¼š
<ul>
<li>å°† <code>startGene</code> å’Œåˆå§‹æ­¥æ•° 0 åŠ å…¥é˜Ÿåˆ—ã€‚</li>
<li>å°† <code>startGene</code> åŠ å…¥ <code>visited</code> é›†åˆã€‚</li>
<li>å½“é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼Œå–å‡ºé˜Ÿå¤´å…ƒç´ ï¼ˆå½“å‰åŸºå› åºåˆ— <code>currentGene</code> å’Œæ­¥æ•° <code>steps</code>ï¼‰ã€‚</li>
<li>å¦‚æœ <code>currentGene</code> ç­‰äº <code>endGene</code>ï¼Œåˆ™ <code>steps</code> å°±æ˜¯æœ€çŸ­è·¯å¾„ï¼Œè¿”å› <code>steps</code>ã€‚</li>
<li>å¦åˆ™ï¼Œç”Ÿæˆ <code>currentGene</code> çš„æ‰€æœ‰å¯èƒ½çš„ä¸€æ¬¡å˜åŒ–ã€‚å¯¹äºæ¯ä¸ªæ–°çš„åŸºå› åºåˆ— <code>nextGene</code>ï¼š
<ul>
<li>å¦‚æœ <code>nextGene</code> å­˜åœ¨äº <code>bankSet</code> ä¸­ä¸”æœªè¢«è®¿é—®è¿‡ï¼Œåˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—å’Œ <code>visited</code> é›†åˆï¼Œæ­¥æ•°åŠ  1ã€‚</li>
</ul>
</li>
<li>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºä»æœªæ‰¾åˆ° <code>endGene</code>ï¼Œè¯´æ˜æ— æ³•è½¬æ¢ï¼Œè¿”å› -1ã€‚</li>
</ul>
</li>
</ol>
<h5 id="ä»£ç å®ç°-Go-BFS">ä»£ç å®ç° (Go - BFS)</h5>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;container/list&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minMutationBfs</span><span class="params">(startGene <span class="type">string</span>, endGene <span class="type">string</span>, bank []<span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	bankSet := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">	<span class="keyword">for</span> _, s := <span class="keyword">range</span> bank &#123;</span><br><span class="line">		bankSet[s] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> _, ok := bankSet[endGene]; !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">type</span> pair <span class="keyword">struct</span> &#123;</span><br><span class="line">		gene  <span class="type">string</span></span><br><span class="line">		steps <span class="type">int</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	q := list.New()</span><br><span class="line">	q.PushBack(pair&#123;startGene, <span class="number">0</span>&#125;)</span><br><span class="line">	visited := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">	visited[startGene] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line">	chars := []<span class="type">byte</span>&#123;<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;T&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> q.Len() &gt; <span class="number">0</span> &#123;</span><br><span class="line">		element := q.Front()</span><br><span class="line">		p := element.Value.(pair)</span><br><span class="line">		q.Remove(element)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> p.gene == endGene &#123;</span><br><span class="line">			<span class="keyword">return</span> p.steps</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		geneChars := []<span class="type">byte</span>(p.gene)</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(geneChars); i++ &#123;</span><br><span class="line">			oldChar := geneChars[i]</span><br><span class="line">			<span class="keyword">for</span> _, c := <span class="keyword">range</span> chars &#123;</span><br><span class="line">				<span class="keyword">if</span> oldChar == c &#123;</span><br><span class="line">					<span class="keyword">continue</span></span><br><span class="line">				&#125;</span><br><span class="line">				geneChars[i] = c</span><br><span class="line">				nextGene := <span class="type">string</span>(geneChars)</span><br><span class="line">				<span class="keyword">if</span> _, inBank := bankSet[nextGene]; inBank &#123;</span><br><span class="line">					<span class="keyword">if</span> _, isVisited := visited[nextGene]; !isVisited &#123;</span><br><span class="line">						visited[nextGene] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">						q.PushBack(pair&#123;nextGene, p.steps + <span class="number">1</span>&#125;)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			geneChars[i] = oldChar <span class="comment">// æ¢å¤ï¼Œä»¥ä¾¿è¿›è¡Œä¸‹ä¸€ä¸ªä½ç½®çš„å˜åŒ–</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h3>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ–¹æ³•ä¸€ (Dijkstra)</th>
<th>æ–¹æ³•äºŒ (BFS)</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(NÂ² + L*NÂ²) or O(NÂ²logN)</td>
<td>O(C<em>L</em>N)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(NÂ²)</td>
<td>O(L*N)</td>
</tr>
<tr>
<td>æ ¸å¿ƒæ€æƒ³</td>
<td>é€šç”¨çš„å•æºæœ€çŸ­è·¯å¾„ç®—æ³•</td>
<td>é’ˆå¯¹æ— æƒå›¾çš„æœ€çŸ­è·¯å¾„ä¼˜åŒ–</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>æ€è·¯é€šç”¨ï¼Œå¯å¤„ç†å¸¦æƒå›¾</td>
<td>å®ç°æ›´ç®€æ´ï¼Œæ•ˆç‡æ›´é«˜</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å¯¹äºæ— æƒå›¾æ¥è¯´è¿‡äºå¤æ‚</td>
<td>ä»…é€‚ç”¨äºæ— æƒå›¾</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>N</strong>: <code>bank</code> çš„é•¿åº¦ã€‚</li>
<li><strong>L</strong>: åŸºå› åºåˆ—çš„é•¿åº¦ (è¿™é‡Œæ˜¯ 8)ã€‚</li>
<li><strong>C</strong>: åŸºå› å­—ç¬¦é›†çš„å¤§å° (è¿™é‡Œæ˜¯ 4)ã€‚</li>
<li>Dijkstra çš„å¤æ‚åº¦å–å†³äºå…¶å…·ä½“å®ç°ï¼ˆé‚»æ¥çŸ©é˜µä¸º O(NÂ²)ï¼Œä¼˜å…ˆé˜Ÿåˆ—ä¸º O(E log V)ï¼Œåœ¨æ­¤å›¾ä¸­ E å¯èƒ½è¾¾åˆ° O(NÂ²))ã€‚</li>
<li>BFS çš„å¤æ‚åº¦ä¸­ï¼Œ<code>C*L</code> ä»£è¡¨ä»ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ‰©å±•å‡ºçš„é‚»å±…æ•°é‡ï¼ŒN æ˜¯èŠ‚ç‚¹æ€»æ•°ã€‚</li>
</ul>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<h4 id="Dijkstra">Dijkstra</h4>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: <code>O(N^2)</code>ï¼Œå…¶ä¸­ <code>N</code> æ˜¯å›¾ä¸­èŠ‚ç‚¹çš„æ€»æ•° (<code>len(bank) + 1</code>)ã€‚æ„å»ºé‚»æ¥çŸ©é˜µéœ€è¦ <code>O(N^2 * L)</code> çš„æ—¶é—´ï¼ˆL=8ï¼‰ï¼ŒDijkstra ç®—æ³•åœ¨ä½¿ç”¨é‚»æ¥çŸ©é˜µå’Œçº¿æ€§æ‰«ææ‰¾æœ€å°è·ç¦»èŠ‚ç‚¹æ—¶çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(N^2)</code>ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: <code>O(N^2)</code>ï¼Œä¸»è¦ç”¨äºå­˜å‚¨é‚»æ¥çŸ©é˜µã€‚</li>
</ul>
<h4 id="BFS">BFS</h4>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: <code>O(C * L * N)</code>ã€‚<code>N</code> æ˜¯ <code>bank</code> çš„é•¿åº¦ï¼Œ<code>L</code> æ˜¯åŸºå› åºåˆ—é•¿åº¦ (8)ï¼Œ<code>C</code> æ˜¯å­—ç¬¦é›†å¤§å° (4)ã€‚å¯¹äºé˜Ÿåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬éƒ½éœ€è¦éå†å…¶æ‰€æœ‰å¯èƒ½çš„ <code>C*L</code> ç§å˜åŒ–ï¼Œå¹¶æ£€æŸ¥å…¶æ˜¯å¦åœ¨ <code>bank</code> ä¸­ã€‚ç”±äº <code>bank</code> çš„å¤§å° <code>N</code> å¾ˆå°ï¼Œè¿™ç§æ–¹æ³•éå¸¸é«˜æ•ˆã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: <code>O(L * N)</code>ï¼Œç”¨äºå­˜å‚¨ <code>bankSet</code>ã€<code>visited</code> é›†åˆå’Œé˜Ÿåˆ—ã€‚</li>
</ul>
<h3 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h3>
<ul>
<li><strong>é—®é¢˜å»ºæ¨¡</strong>: è¯†åˆ«å‡º â€œæœ€å°‘æ¬¡æ•°â€ã€â€œæœ€çŸ­è½¬æ¢â€ è¿™ç±»é—®é¢˜å¯ä»¥å»ºæ¨¡ä¸ºå›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜æ˜¯è§£å†³å…³é”®ã€‚</li>
<li><strong>ç®—æ³•é€‰æ‹©</strong>: åœ¨æ— æƒå›¾ï¼ˆæ‰€æœ‰è¾¹çš„æƒé‡éƒ½ä¸º 1 æˆ–ç›¸åŒï¼‰ä¸­ï¼ŒBFS æ˜¯æ±‚è§£æœ€çŸ­è·¯å¾„çš„é¦–é€‰ç®—æ³•ã€‚å®ƒçš„å®ç°ç®€å•ä¸”æ—¶é—´å¤æ‚åº¦ä¼˜äºé€šç”¨çš„ Dijkstra ç®—æ³•ã€‚</li>
<li><strong>éšå¼å›¾ vs æ˜¾å¼å›¾</strong>: Dijkstra çš„è§£æ³•æ˜¯å…ˆ <strong>æ˜¾å¼</strong> åœ°æŠŠå›¾çš„å®Œæ•´ç»“æ„ï¼ˆé‚»æ¥çŸ©é˜µï¼‰æ„å»ºå‡ºæ¥ï¼Œç„¶åå†è¿è¡Œç®—æ³•ã€‚è€Œ BFS çš„è§£æ³•æ˜¯åœ¨æœç´¢è¿‡ç¨‹ä¸­ <strong>éšå¼</strong> åœ°æ¢ç´¢å›¾çš„èŠ‚ç‚¹å’Œè¾¹ï¼Œæ— éœ€é¢„å…ˆæ„å»ºæ•´ä¸ªå›¾ï¼Œä»è€ŒèŠ‚çœäº†ç©ºé—´å’Œé¢„å¤„ç†æ—¶é—´ã€‚å¯¹äºèŠ‚ç‚¹è¿æ¥è§„åˆ™æ˜ç¡®ä½†å›¾å¯èƒ½å¾ˆå¤§çš„æƒ…å†µï¼Œéšå¼å›¾æœç´¢æ˜¯æ›´ä¼˜çš„é€‰æ‹©ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›¾è®º</category>
      </categories>
      <tags>
        <tag>å¹¿åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>å›¾</tag>
        <tag>BFS</tag>
        <tag>Dijkstra</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 909 - è›‡æ¢¯æ£‹ï¼ˆSnakes and Laddersï¼‰âŒé”™é¢˜é›†</title>
    <url>/2025/06/23/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-909-%E8%9B%87%E6%A2%AF%E6%A3%8B-%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå¤§å°ä¸º <code>n x n</code> çš„æ•´æ•°çŸ©é˜µ <code>board</code>ï¼Œå…¶ä¸­ <code>n</code> å’Œ <code>board[i][j]</code> éƒ½åœ¨èŒƒå›´ <code>[1, n]</code> å†…ã€‚</p>
<p>è›‡æ¢¯æ£‹çš„æ£‹ç›˜ä¸Šæ ‡æœ‰ä» <code>1</code> åˆ° <code>nÂ²</code> çš„æ•°å­—ï¼ŒæŒ‰ä»å·¦åˆ°å³ï¼Œä»ä¸‹åˆ°ä¸Šçš„ <strong>è›‡å½¢</strong> æ–¹å¼ç¼–å·ã€‚</p>
<p>ç©å®¶ä»æ£‹ç›˜ä¸Šçš„æ–¹æ ¼ <code>1</code> ï¼ˆæ€»æ˜¯åœ¨æœ€åä¸€è¡Œã€ç¬¬ä¸€åˆ—ï¼‰å¼€å§‹å‡ºå‘ã€‚</p>
<p>æ¯ä¸€å›åˆï¼Œç©å®¶éƒ½è¦ä»å½“å‰æ–¹æ ¼å¼€å§‹å‡ºå‘ï¼ŒæŒ‰ä»¥ä¸‹è§„åˆ™å‰è¿›ï¼š</p>
<ul>
<li>é€‰æ‹©ç›®æ ‡æ–¹æ ¼æ¥å†³å®šä¸‹ä¸€æ­¥çš„ç§»åŠ¨ï¼Œç›®æ ‡æ–¹æ ¼çš„ç¼–å·æ˜¯ <code>[curr + 1, curr + 6]</code> çš„èŒƒå›´å†…ä»»æ„æ•´æ•° <code>curr</code> æ˜¯ç©å®¶å½“å‰æ‰€åœ¨çš„æ–¹æ ¼ç¼–å·ã€‚</li>
<li>è¯¥é€‰æ‹©æ¨¡æ‹Ÿäº†æ· <strong>å…­é¢éª°å­</strong> çš„æƒ…æ™¯ï¼Œæ— è®ºæ£‹ç›˜å¤§å°å¦‚ä½•ï¼Œç©å®¶æœ€å¤šåªèƒ½æœ‰ 6 ä¸ªç›®çš„åœ°ã€‚</li>
<li>å¦‚æœç›®æ ‡æ–¹æ ¼æœ‰è›‡æˆ–æ¢¯å­ï¼Œç©å®¶å¿…é¡»æŒ‰è›‡æ¢¯çš„æŒ‡ç¤ºå‰è¿›ã€‚è›‡æ¢¯çš„ç›®çš„åœ°ä¸ä¼šæœ‰è›‡æˆ–æ¢¯å­ã€‚</li>
<li>æ³¨æ„ï¼Œç©å®¶åœ¨æ¯å›åˆçš„ç§»åŠ¨è¿‡ç¨‹ä¸­æœ€å¤šåªèƒ½çˆ¬è¿‡è›‡æˆ–æ¢¯å­ä¸€æ¬¡ï¼šå°±ç®—ç›®çš„åœ°æ˜¯å¦ä¸€æ¡è›‡æˆ–æ¢¯å­çš„èµ·ç‚¹ï¼Œç©å®¶ä¹Ÿä¸èƒ½ç»§ç»­ç§»åŠ¨ã€‚</li>
</ul>
<p>è¿”å›è¾¾åˆ°ç¼–å·ä¸º <code>nÂ²</code> çš„æ–¹æ ¼æ‰€éœ€çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•°ï¼Œå¦‚æœä¸å¯èƒ½ï¼Œåˆ™è¿”å› <code>-1</code>ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šboard = [[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,35,-1,-1,13,-1],[-1,-1,-1,-1,-1,-1],[-1,15,-1,-1,-1,-1]]</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">é¦–å…ˆï¼Œä»æ–¹æ ¼ 1 [ç¬¬ 5 è¡Œï¼Œç¬¬ 0 åˆ—] å¼€å§‹ã€‚ </span><br><span class="line">å†³å®šç§»åŠ¨åˆ°æ–¹æ ¼ 2ï¼Œå¹¶å¿…é¡»çˆ¬è¿‡æ¢¯å­ç§»åŠ¨åˆ°æ–¹æ ¼ 15ã€‚</span><br><span class="line">ç„¶åå†³å®šç§»åŠ¨åˆ°æ–¹æ ¼ 17 [ç¬¬ 3 è¡Œï¼Œç¬¬ 5 åˆ—]ï¼Œå¿…é¡»çˆ¬è¿‡è›‡åˆ°æ–¹æ ¼ 13ã€‚</span><br><span class="line">æ¥ä¸‹æ¥å†³å®šç§»åŠ¨åˆ°æ–¹æ ¼ 14ï¼Œä¸”å¿…é¡»çˆ¬è¿‡æ¢¯å­ç§»åŠ¨åˆ°æ–¹æ ¼ 35ã€‚ </span><br><span class="line">æœ€åå†³å®šç§»åŠ¨åˆ°æ–¹æ ¼ 36 [ç¬¬ 0 è¡Œï¼Œç¬¬ 5 åˆ—]ï¼Œæ¸¸æˆç»“æŸã€‚ </span><br><span class="line">å¯ä»¥è¯æ˜éœ€è¦è‡³å°‘ 4 æ¬¡ç§»åŠ¨æ‰èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªæ–¹æ ¼ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 4ã€‚</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/23/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-909-%E8%9B%87%E6%A2%AF%E6%A3%8B-%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/1750689003149.png" alt="1750689003149"></p>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šboard = [[-1,-1],[-1,3]]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<h2 id="âŒ-é”™è¯¯åˆ†æè¿‡ç¨‹">âŒ é”™è¯¯åˆ†æè¿‡ç¨‹</h2>
<h3 id="é‡åˆ°çš„ä¸»è¦é—®é¢˜">é‡åˆ°çš„ä¸»è¦é—®é¢˜</h3>
<h4 id="1-å†…å­˜é™åˆ¶è¶…å‡º-Memory-Limit-Exceeded">1. <strong>å†…å­˜é™åˆ¶è¶…å‡º (Memory Limit Exceeded)</strong></h4>
<p><strong>é”™è¯¯ç°è±¡</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Memory Limit Exceeded</span><br><span class="line">5/217 cases passed (N/A)</span><br><span class="line">Testcase: [[-1,4,-1],[6,2,6],[-1,3,-1]]</span><br><span class="line">Expected Answer: 2</span><br></pre></td></tr></table></figure>
<p><strong>åˆ†æ</strong>: è¿™ä¸ªé”™è¯¯æ˜¯ç”±äºå­˜åœ¨<strong>å¾ªç¯è›‡æ¢¯</strong>å¯¼è‡´çš„æ— é™é€’å½’è°ƒç”¨ã€‚åœ¨æµ‹è¯•æ¡ˆä¾‹ä¸­ï¼š</p>
<ul>
<li>ä½ç½® 2 æŒ‡å‘ä½ç½® 6</li>
<li>ä½ç½® 6 æŒ‡å‘ä½ç½® 2</li>
</ul>
<p>å½¢æˆäº†å¾ªç¯ï¼Œ<code>numToNode</code> å‡½æ•°ä¼šæ— é™é€’å½’è°ƒç”¨è‡ªå·±ï¼Œå¯¼è‡´æ ˆæº¢å‡ºã€‚</p>
<h4 id="2-åæ ‡è½¬æ¢é€»è¾‘å¤æ‚">2. <strong>åæ ‡è½¬æ¢é€»è¾‘å¤æ‚</strong></h4>
<p>è›‡æ¢¯æ£‹çš„ç¼–å·è§„åˆ™ç›¸å½“å¤æ‚ï¼š</p>
<ul>
<li>ä»æ£‹ç›˜åº•éƒ¨å¼€å§‹ç¼–å·ï¼ˆ1 åœ¨æœ€åä¸€è¡Œç¬¬ä¸€åˆ—ï¼‰</li>
<li>å¥‡æ•°è¡Œä»å·¦åˆ°å³ï¼Œå¶æ•°è¡Œä»å³åˆ°å·¦</li>
<li>éœ€è¦æ­£ç¡®å¤„ç†æ•°ç»„ç´¢å¼•åˆ°æ£‹ç›˜ç¼–å·çš„è½¬æ¢</li>
</ul>
<p><strong>å¤šæ¬¡å°è¯•çš„åæ ‡è½¬æ¢æ–¹æ¡ˆ</strong>:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ¡ˆ1: æœ€åˆçš„é”™è¯¯å®ç°</span></span><br><span class="line"><span class="keyword">if</span> row%<span class="number">2</span> == <span class="number">0</span> &amp;&amp; n%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">    col = n - <span class="number">1</span> - col</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ¡ˆ2: ä¿®æ­£åçš„å®ç°</span></span><br><span class="line"><span class="keyword">if</span> (n<span class="number">-1</span>-row)%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">    col = n - <span class="number">1</span> - col</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ¡ˆ3: æœ€ç»ˆå°è¯•çš„å®ç°</span></span><br><span class="line">row := (num - <span class="number">1</span>) / n</span><br><span class="line"><span class="keyword">if</span> row%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">    col = n - <span class="number">1</span> - col</span><br><span class="line">&#125;</span><br><span class="line">row = n - <span class="number">1</span> - row</span><br></pre></td></tr></table></figure>
<h4 id="3-BFS-è®¿é—®æ§åˆ¶é—®é¢˜">3. <strong>BFS è®¿é—®æ§åˆ¶é—®é¢˜</strong></h4>
<p><strong>é—®é¢˜</strong>: æ²¡æœ‰æ­£ç¡®å¤„ç†å·²è®¿é—®èŠ‚ç‚¹çš„æ ‡è®°ï¼Œå¯¼è‡´ï¼š</p>
<ul>
<li>é‡å¤è®¿é—®åŒä¸€ä¸ªä½ç½®</li>
<li>ç®—æ³•æ•ˆç‡ä½ä¸‹</li>
<li>å¯èƒ½çš„æ— é™å¾ªç¯</li>
</ul>
<h4 id="4-é€’å½’vsè¿­ä»£çš„é€‰æ‹©">4. <strong>é€’å½’vsè¿­ä»£çš„é€‰æ‹©</strong></h4>
<p>æœ€åˆä½¿ç”¨é€’å½’çš„ <code>numToNode</code> å‡½æ•°æ¥å¤„ç†è›‡æ¢¯è·³è½¬ï¼Œä½†é‡åˆ°å¾ªç¯è›‡æ¢¯æ—¶ä¼šå¯¼è‡´æ ˆæº¢å‡ºã€‚</p>
<h2 id="è§£é¢˜æ€è·¯åˆ†æ">è§£é¢˜æ€è·¯åˆ†æ</h2>
<h3 id="æ ¸å¿ƒç®—æ³•-BFS-å¹¿åº¦ä¼˜å…ˆæœç´¢">æ ¸å¿ƒç®—æ³•: BFS (å¹¿åº¦ä¼˜å…ˆæœç´¢)</h3>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>æœ€çŸ­è·¯å¾„</strong>é—®é¢˜ï¼Œåº”è¯¥ä½¿ç”¨ BFS æ¥è§£å†³ï¼š</p>
<ol>
<li><strong>çŠ¶æ€è¡¨ç¤º</strong>: æ¯ä¸ªçŠ¶æ€åŒ…å«å½“å‰ä½ç½®ç¼–å·å’Œæ­¥æ•°</li>
<li><strong>çŠ¶æ€è½¬ç§»</strong>: ä»å½“å‰ä½ç½®å¯ä»¥ç§»åŠ¨åˆ° <code>[curr+1, curr+6]</code> èŒƒå›´å†…çš„ä»»æ„ä½ç½®</li>
<li><strong>è›‡æ¢¯å¤„ç†</strong>: å¦‚æœåˆ°è¾¾çš„ä½ç½®æœ‰è›‡æˆ–æ¢¯å­ï¼Œéœ€è¦è·³è½¬åˆ°æŒ‡å®šä½ç½®</li>
<li><strong>ç»ˆæ­¢æ¡ä»¶</strong>: åˆ°è¾¾ç¼–å·ä¸º <code>nÂ²</code> çš„ä½ç½®</li>
</ol>
<h3 id="å…³é”®éš¾ç‚¹">å…³é”®éš¾ç‚¹</h3>
<h4 id="1-åæ ‡è½¬æ¢">1. <strong>åæ ‡è½¬æ¢</strong></h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ£‹ç›˜ç¼–å·ç¤ºä¾‹ (4x4):</span><br><span class="line">13  14  15  16</span><br><span class="line">12  11  10   9</span><br><span class="line"> 5   6   7   8</span><br><span class="line"> 4   3   2   1</span><br><span class="line"></span><br><span class="line">å¯¹åº”æ•°ç»„ç´¢å¼•:</span><br><span class="line">[0,0] [0,1] [0,2] [0,3]</span><br><span class="line">[1,0] [1,1] [1,2] [1,3]</span><br><span class="line">[2,0] [2,1] [2,2] [2,3]</span><br><span class="line">[3,0] [3,1] [3,2] [3,3]</span><br></pre></td></tr></table></figure>
<h4 id="2-è›‡æ¢¯å¤„ç†">2. <strong>è›‡æ¢¯å¤„ç†</strong></h4>
<ul>
<li>éœ€è¦åœ¨åˆ°è¾¾æ–°ä½ç½®åç«‹å³æ£€æŸ¥æ˜¯å¦æœ‰è›‡æˆ–æ¢¯å­</li>
<li>é¿å…æ— é™é€’å½’è°ƒç”¨</li>
<li>æ­£ç¡®å¤„ç†å¾ªç¯è›‡æ¢¯çš„æƒ…å†µ</li>
</ul>
<h4 id="3-è®¿é—®æ§åˆ¶">3. <strong>è®¿é—®æ§åˆ¶</strong></h4>
<ul>
<li>ä½¿ç”¨ <code>visited</code> æ•°ç»„é¿å…é‡å¤è®¿é—®</li>
<li>æ³¨æ„æ•°ç»„ç´¢å¼•èŒƒå›´ï¼ˆç¼–å·1åˆ°nÂ²ï¼‰</li>
</ul>
<h2 id="é”™è¯¯ä»£ç å®ç°å†ç¨‹">é”™è¯¯ä»£ç å®ç°å†ç¨‹</h2>
<h3 id="ç¬¬ä¸€ç‰ˆï¼šæœ€åˆçš„é”™è¯¯å®ç°">ç¬¬ä¸€ç‰ˆï¼šæœ€åˆçš„é”™è¯¯å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Location <span class="keyword">struct</span> &#123;</span><br><span class="line">	X    <span class="type">int</span></span><br><span class="line">	Y    <span class="type">int</span></span><br><span class="line">	step <span class="type">int</span></span><br><span class="line">	Num  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">snakesAndLadders</span><span class="params">(board [][]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"></span><br><span class="line">	n := <span class="built_in">len</span>(board)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> numToNode <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> Location</span><br><span class="line"></span><br><span class="line">	numToNode = <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> Location &#123;</span><br><span class="line"></span><br><span class="line">		row := n - <span class="number">1</span> - (num<span class="number">-1</span>)/n</span><br><span class="line">		col := (num - <span class="number">1</span>) % n</span><br><span class="line">		<span class="keyword">if</span> row%<span class="number">2</span> == <span class="number">0</span> &amp;&amp; n%<span class="number">2</span> == <span class="number">0</span> &#123;  <span class="comment">// âŒ é”™è¯¯çš„åæ ‡è½¬æ¢é€»è¾‘</span></span><br><span class="line">			col = n - <span class="number">1</span> - col</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> board[row][col] &gt;= <span class="number">0</span> &#123;  <span class="comment">// âŒ åº”è¯¥æ˜¯ != -1</span></span><br><span class="line">			<span class="keyword">return</span> numToNode(board[row][col])  <span class="comment">// âŒ é€’å½’è°ƒç”¨ï¼Œä¼šå¯¼è‡´å¾ªç¯è›‡æ¢¯æ—¶æ ˆæº¢å‡º</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> Location&#123;X: row, Y: col, step: <span class="number">0</span>, Num: num&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	start := numToNode(<span class="number">1</span>)</span><br><span class="line">	fmt.Println(start)  <span class="comment">// è°ƒè¯•è¾“å‡º</span></span><br><span class="line">	end := numToNode(n * n)</span><br><span class="line"></span><br><span class="line">	cnt := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	queue := []Location&#123;start&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">len</span>(queue) != <span class="number">0</span> &amp;&amp; cnt &lt;= n*n &#123;</span><br><span class="line">		top := queue[<span class="number">0</span>]</span><br><span class="line">		queue = queue[<span class="number">1</span>:]</span><br><span class="line">		cnt++</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> top.X == end.X &amp;&amp; top.Y == end.Y &#123;  <span class="comment">// âŒ ç”¨åæ ‡æ¯”è¾ƒè€Œä¸æ˜¯ç¼–å·</span></span><br><span class="line">			<span class="keyword">return</span> top.step</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> board[top.X][top.Y] == <span class="number">-2</span> &#123;  <span class="comment">// âŒ ç”¨ä¿®æ”¹åŸæ•°ç»„çš„æ–¹å¼æ ‡è®°è®¿é—®</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		board[top.X][top.Y] = <span class="number">-2</span>  <span class="comment">// âŒ ç ´ååŸæ•°ç»„</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">6</span>; i++ &#123;</span><br><span class="line">			<span class="keyword">if</span> top.Num+i &lt;= n*n &#123;</span><br><span class="line">				next := numToNode(top.Num + i)  <span class="comment">// âŒ é€’å½’è°ƒç”¨</span></span><br><span class="line">				next.step = top.step + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">				queue = <span class="built_in">append</span>(queue, next)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é—®é¢˜åˆ†æ</strong>:</p>
<ol>
<li>åæ ‡è½¬æ¢æ¡ä»¶ <code>row%2 == 0 &amp;&amp; n%2 == 0</code> å®Œå…¨é”™è¯¯</li>
<li>ä½¿ç”¨é€’å½’çš„ <code>numToNode</code> å‡½æ•°å¤„ç†è›‡æ¢¯è·³è½¬ï¼Œé‡åˆ°å¾ªç¯æ—¶ä¼šæ ˆæº¢å‡º</li>
<li>ç”¨ä¿®æ”¹åŸæ•°ç»„çš„æ–¹å¼æ ‡è®°è®¿é—®ï¼Œä¸å¤Ÿä¼˜é›…ä¸”å®¹æ˜“å‡ºé”™</li>
<li>ç»ˆæ­¢æ¡ä»¶ç”¨åæ ‡æ¯”è¾ƒï¼Œä¸å¦‚ç›´æ¥ç”¨ç¼–å·æ¯”è¾ƒ</li>
</ol>
<h3 id="ç¬¬äºŒç‰ˆï¼šå°è¯•ä¿®å¤åæ ‡è½¬æ¢å’Œè®¿é—®æ§åˆ¶">ç¬¬äºŒç‰ˆï¼šå°è¯•ä¿®å¤åæ ‡è½¬æ¢å’Œè®¿é—®æ§åˆ¶</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">snakesAndLadders</span><span class="params">(board [][]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"></span><br><span class="line">	n := <span class="built_in">len</span>(board)</span><br><span class="line">	visited := <span class="built_in">make</span>([]<span class="type">bool</span>, n*n+<span class="number">1</span>) <span class="comment">// âœ… ä½¿ç”¨visitedæ•°ç»„</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> numToNode <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> Location</span><br><span class="line"></span><br><span class="line">	numToNode = <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> Location &#123;</span><br><span class="line"></span><br><span class="line">		row := n - <span class="number">1</span> - (num<span class="number">-1</span>)/n</span><br><span class="line">		col := (num - <span class="number">1</span>) % n</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// âœ… ä¿®æ­£è¡Œç¿»è½¬é€»è¾‘ï¼šä»åº•éƒ¨æ•°èµ·çš„å¶æ•°è¡Œéœ€è¦ç¿»è½¬</span></span><br><span class="line">		<span class="keyword">if</span> (n<span class="number">-1</span>-row)%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">			col = n - <span class="number">1</span> - col</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> board[row][col] != <span class="number">-1</span> &#123;  <span class="comment">// âœ… ä¿®æ­£æ¡ä»¶</span></span><br><span class="line">			<span class="keyword">return</span> numToNode(board[row][col])  <span class="comment">// âŒ ä»ç„¶æ˜¯é€’å½’è°ƒç”¨</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> Location&#123;X: row, Y: col, step: <span class="number">0</span>, Num: num&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	start := numToNode(<span class="number">1</span>)</span><br><span class="line">	start.step = <span class="number">0</span></span><br><span class="line">	</span><br><span class="line">	queue := []Location&#123;start&#125;</span><br><span class="line">	visited[<span class="number">1</span>] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">len</span>(queue) != <span class="number">0</span> &#123;</span><br><span class="line">		top := queue[<span class="number">0</span>]</span><br><span class="line">		queue = queue[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">		<span class="comment">// âœ… æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç›®æ ‡</span></span><br><span class="line">		<span class="keyword">if</span> top.Num == n*n &#123;</span><br><span class="line">			<span class="keyword">return</span> top.step</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">6</span>; i++ &#123;</span><br><span class="line">			nextNum := top.Num + i</span><br><span class="line">			<span class="keyword">if</span> nextNum &lt;= n*n &amp;&amp; !visited[nextNum] &#123;</span><br><span class="line">				next := numToNode(nextNum)  <span class="comment">// âŒ ä»ç„¶é€’å½’</span></span><br><span class="line">				next.step = top.step + <span class="number">1</span></span><br><span class="line">				visited[nextNum] = <span class="literal">true</span></span><br><span class="line">				queue = <span class="built_in">append</span>(queue, next)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é—®é¢˜åˆ†æ</strong>:</p>
<ul>
<li>âœ… ä¿®æ­£äº†åæ ‡è½¬æ¢é€»è¾‘</li>
<li>âœ… ä½¿ç”¨äº†properçš„visitedæ•°ç»„</li>
<li>âœ… ä¿®æ­£äº†ç»ˆæ­¢æ¡ä»¶</li>
<li>âŒ ä»ç„¶ä½¿ç”¨é€’å½’å¤„ç†è›‡æ¢¯ï¼Œå¾ªç¯è›‡æ¢¯æ—¶ä¼šå¯¼è‡´æ ˆæº¢å‡º</li>
</ul>
<h3 id="ç¬¬ä¸‰ç‰ˆï¼šæœ€ç»ˆå°è¯•çš„å®ç°">ç¬¬ä¸‰ç‰ˆï¼šæœ€ç»ˆå°è¯•çš„å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">snakesAndLadders</span><span class="params">(board [][]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(board)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> numToNode <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> Location</span><br><span class="line">    </span><br><span class="line">    numToNode = <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> Location &#123;</span><br><span class="line">        row := (num - <span class="number">1</span>) / n  <span class="comment">// âŒ ä¿®æ”¹äº†è®¡ç®—æ–¹å¼ï¼Œä½†å¯èƒ½ä¸æ­£ç¡®</span></span><br><span class="line">        col := (num - <span class="number">1</span>) % n</span><br><span class="line">        <span class="keyword">if</span> row%<span class="number">2</span> == <span class="number">1</span> &#123;  <span class="comment">// âŒ ç¿»è½¬é€»è¾‘åˆå˜äº†</span></span><br><span class="line">            col = n - <span class="number">1</span> - col</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        row = n - <span class="number">1</span> - row  <span class="comment">// âŒ åç½®è½¬æ¢</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Location&#123;X: row, Y: col, step: <span class="number">0</span>, Num: num&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    start := numToNode(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    visited := <span class="built_in">make</span>([]<span class="type">bool</span>, n*n)  <span class="comment">// âŒ é•¿åº¦åº”è¯¥æ˜¯ n*n+1</span></span><br><span class="line">    </span><br><span class="line">    queue := []Location&#123;start&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) != <span class="number">0</span> &#123;</span><br><span class="line">        top := queue[<span class="number">0</span>]</span><br><span class="line">        queue = queue[<span class="number">1</span>:]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">6</span>; i++ &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> top.Num+i &gt; n*n &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            next := numToNode(top.Num + i)</span><br><span class="line">            <span class="keyword">if</span> board[next.X][next.Y] &gt; <span class="number">0</span> &#123;  <span class="comment">// âŒ åº”è¯¥æ˜¯ != -1</span></span><br><span class="line">                next = numToNode(board[next.X][next.Y])  <span class="comment">// âŒ ä»ç„¶é€’å½’</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> next.Num == n*n &#123;</span><br><span class="line">                <span class="keyword">return</span> top.step + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> visited[next.Num] &#123;  <span class="comment">// âŒ next.Num å¯èƒ½æ˜¯n*nï¼Œä¼šè¶Šç•Œ</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            visited[next.Num] = <span class="literal">true</span></span><br><span class="line">            </span><br><span class="line">            next.step = top.step + <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            queue = <span class="built_in">append</span>(queue, next)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é—®é¢˜åˆ†æ</strong>:</p>
<ol>
<li><strong>visitedæ•°ç»„è¶Šç•Œ</strong>: <code>visited := make([]bool, n*n)</code> é•¿åº¦ä¸ºn<em>nï¼Œä½†ç¼–å·èŒƒå›´æ˜¯[1,n</em>n]ï¼Œè®¿é—® <code>visited[n*n]</code> ä¼šè¶Šç•Œ</li>
<li><strong>é€’å½’é—®é¢˜æœªè§£å†³</strong>: ä»ç„¶ä½¿ç”¨é€’å½’å¤„ç†è›‡æ¢¯è·³è½¬</li>
<li><strong>åæ ‡è½¬æ¢é€»è¾‘</strong>: å¤šæ¬¡ä¿®æ”¹ï¼Œä½†ä»ä¸ç¡®å®šæ­£ç¡®æ€§</li>
</ol>
<h2 id="æ­£ç¡®è§£é¢˜æ€è·¯åˆ†æ">æ­£ç¡®è§£é¢˜æ€è·¯åˆ†æ</h2>
<h3 id="1-åæ ‡è½¬æ¢çš„æ­£ç¡®é€»è¾‘">1. <strong>åæ ‡è½¬æ¢çš„æ­£ç¡®é€»è¾‘</strong></h3>
<p>è›‡æ¢¯æ£‹çš„ç¼–å·è§„åˆ™éœ€è¦ä»”ç»†ç†è§£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">6x6æ£‹ç›˜ç¼–å·ç¤ºä¾‹ï¼š</span><br><span class="line">31  32  33  34  35  36</span><br><span class="line">30  29  28  27  26  25  </span><br><span class="line">19  20  21  22  23  24</span><br><span class="line">18  17  16  15  14  13</span><br><span class="line"> 7   8   9  10  11  12</span><br><span class="line"> 6   5   4   3   2   1</span><br><span class="line"></span><br><span class="line">å¯¹åº”æ•°ç»„ç´¢å¼•ï¼š</span><br><span class="line">[0,0][0,1][0,2][0,3][0,4][0,5]</span><br><span class="line">[1,0][1,1][1,2][1,3][1,4][1,5]</span><br><span class="line">[2,0][2,1][2,2][2,3][2,4][2,5]</span><br><span class="line">[3,0][3,1][3,2][3,3][3,4][3,5]</span><br><span class="line">[4,0][4,1][4,2][4,3][4,4][4,5]</span><br><span class="line">[5,0][5,1][5,2][5,3][5,4][5,5]</span><br></pre></td></tr></table></figure>
<p><strong>æ­£ç¡®çš„åæ ‡è½¬æ¢å…¬å¼</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numToPos</span><span class="params">(num, n <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="comment">// ä»åº•éƒ¨æ•°çš„è¡Œå·ï¼ˆä»0å¼€å§‹ï¼‰</span></span><br><span class="line">    bottomRow := (num - <span class="number">1</span>) / n</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸ºæ•°ç»„è¡Œç´¢å¼•</span></span><br><span class="line">    row := n - <span class="number">1</span> - bottomRow</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ—ç´¢å¼•</span></span><br><span class="line">    col := (num - <span class="number">1</span>) % n</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¶æ•°è¡Œï¼ˆä»åº•éƒ¨æ•°ï¼Œç´¢å¼•1,3,5...ï¼‰éœ€è¦ç¿»è½¬</span></span><br><span class="line">    <span class="keyword">if</span> bottomRow%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">        col = n - <span class="number">1</span> - col</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> row, col</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å…³é”®ç†è§£</strong>ï¼š</p>
<ul>
<li><code>bottomRow = (num-1) / n</code> è®¡ç®—ä»åº•éƒ¨æ•°çš„è¡Œå·</li>
<li>ä»åº•éƒ¨æ•°çš„å¥‡æ•°è¡Œï¼ˆbottomRow=0,2,4â€¦ï¼‰ï¼šä»å·¦åˆ°å³</li>
<li>ä»åº•éƒ¨æ•°çš„å¶æ•°è¡Œï¼ˆbottomRow=1,3,5â€¦ï¼‰ï¼šä»å³åˆ°å·¦</li>
</ul>
<h3 id="2-é¿å…é€’å½’çš„è›‡æ¢¯å¤„ç†">2. <strong>é¿å…é€’å½’çš„è›‡æ¢¯å¤„ç†</strong></h3>
<p><strong>é”™è¯¯æ–¹å¼</strong>ï¼ˆä¼šå¯¼è‡´æ ˆæº¢å‡ºï¼‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numToNode</span><span class="params">(num <span class="type">int</span>)</span></span> Location &#123;</span><br><span class="line">    row, col := numToPos(num, n)</span><br><span class="line">    <span class="keyword">if</span> board[row][col] != <span class="number">-1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> numToNode(board[row][col])  <span class="comment">// âŒ é€’å½’è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Location&#123;X: row, Y: col, Num: num&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ­£ç¡®æ–¹å¼</strong>ï¼ˆåœ¨BFSä¸­ç›´æ¥å¤„ç†ï¼‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨BFSå¾ªç¯ä¸­</span></span><br><span class="line">nextNum := curr.Num + i</span><br><span class="line">row, col := numToPos(nextNum, n)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†è›‡æ¢¯è·³è½¬</span></span><br><span class="line"><span class="keyword">if</span> board[row][col] != <span class="number">-1</span> &#123;</span><br><span class="line">    nextNum = board[row][col]  <span class="comment">// ç›´æ¥æ›´æ–°ç¼–å·ï¼Œä¸é€’å½’</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦å·²è®¿é—®æœ€ç»ˆä½ç½®</span></span><br><span class="line"><span class="keyword">if</span> !visited[nextNum] &#123;</span><br><span class="line">    visited[nextNum] = <span class="literal">true</span></span><br><span class="line">    newRow, newCol := numToPos(nextNum, n)</span><br><span class="line">    queue = <span class="built_in">append</span>(queue, Location&#123;X: newRow, Y: newCol, Num: nextNum, step: curr.step + <span class="number">1</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-å®Œæ•´çš„æ­£ç¡®å®ç°">3. <strong>å®Œæ•´çš„æ­£ç¡®å®ç°</strong></h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Location <span class="keyword">struct</span> &#123;</span><br><span class="line">    X    <span class="type">int</span></span><br><span class="line">    Y    <span class="type">int</span></span><br><span class="line">    step <span class="type">int</span></span><br><span class="line">    Num  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">snakesAndLadders</span><span class="params">(board [][]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(board)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼–å·åˆ°åæ ‡çš„è½¬æ¢å‡½æ•°</span></span><br><span class="line">    numToPos := <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">        bottomRow := (num - <span class="number">1</span>) / n</span><br><span class="line">        row := n - <span class="number">1</span> - bottomRow</span><br><span class="line">        col := (num - <span class="number">1</span>) % n</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> bottomRow%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">            col = n - <span class="number">1</span> - col</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> row, col</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// visitedæ•°ç»„ï¼Œæ³¨æ„é•¿åº¦æ˜¯n*n+1ï¼Œå› ä¸ºç¼–å·ä»1å¼€å§‹</span></span><br><span class="line">    visited := <span class="built_in">make</span>([]<span class="type">bool</span>, n*n+<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// BFSé˜Ÿåˆ—ï¼Œä»ç¼–å·1å¼€å§‹</span></span><br><span class="line">    queue := []Location&#123;&#123;Num: <span class="number">1</span>, step: <span class="number">0</span>&#125;&#125;</span><br><span class="line">    visited[<span class="number">1</span>] = <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        curr := queue[<span class="number">0</span>]</span><br><span class="line">        queue = queue[<span class="number">1</span>:]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç»ˆç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> curr.Num == n*n &#123;</span><br><span class="line">            <span class="keyword">return</span> curr.step</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ·éª°å­ï¼š1åˆ°6ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> dice := <span class="number">1</span>; dice &lt;= <span class="number">6</span>; dice++ &#123;</span><br><span class="line">            nextNum := curr.Num + dice</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è¶…å‡ºè¾¹ç•Œåˆ™è·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> nextNum &gt; n*n &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è·å–ç›®æ ‡ä½ç½®åæ ‡</span></span><br><span class="line">            row, col := numToPos(nextNum)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¤„ç†è›‡æ¢¯ï¼šå¦‚æœä¸æ˜¯-1ï¼Œåˆ™è·³è½¬åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">            <span class="keyword">if</span> board[row][col] != <span class="number">-1</span> &#123;</span><br><span class="line">                nextNum = board[row][col]</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ£€æŸ¥æœ€ç»ˆä½ç½®æ˜¯å¦å·²è®¿é—®</span></span><br><span class="line">            <span class="keyword">if</span> !visited[nextNum] &#123;</span><br><span class="line">                visited[nextNum] = <span class="literal">true</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">// è·å–æœ€ç»ˆä½ç½®çš„åæ ‡ï¼ˆç”¨äºå®Œæ•´æ€§ï¼Œå®é™…å¯èƒ½ä¸éœ€è¦ï¼‰</span></span><br><span class="line">                finalRow, finalCol := numToPos(nextNum)</span><br><span class="line">                </span><br><span class="line">                queue = <span class="built_in">append</span>(queue, Location&#123;</span><br><span class="line">                    X:    finalRow,</span><br><span class="line">                    Y:    finalCol,</span><br><span class="line">                    Num:  nextNum,</span><br><span class="line">                    step: curr.step + <span class="number">1</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>  <span class="comment">// æ— æ³•åˆ°è¾¾ç»ˆç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-å…³é”®æŠ€æœ¯è¦ç‚¹">4. <strong>å…³é”®æŠ€æœ¯è¦ç‚¹</strong></h3>
<h4 id="A-åæ ‡è½¬æ¢çš„æ•°å­¦åŸç†">A. <strong>åæ ‡è½¬æ¢çš„æ•°å­¦åŸç†</strong></h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹äºç¼–å·numï¼ˆä»1å¼€å§‹ï¼‰ï¼š</span></span><br><span class="line">bottomRow := (num - <span class="number">1</span>) / n     <span class="comment">// ä»åº•éƒ¨æ•°çš„è¡Œå·ï¼ˆä»0å¼€å§‹ï¼‰</span></span><br><span class="line">col := (num - <span class="number">1</span>) % n           <span class="comment">// åœ¨è¯¥è¡Œä¸­çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è›‡å½¢è·¯å¾„çš„å¤„ç†ï¼š</span></span><br><span class="line"><span class="keyword">if</span> bottomRow%<span class="number">2</span> == <span class="number">1</span> &#123;          <span class="comment">// å¶æ•°è¡Œï¼ˆä»åº•éƒ¨æ•°1,3,5...è¡Œï¼‰</span></span><br><span class="line">    col = n - <span class="number">1</span> - col          <span class="comment">// ä»å³åˆ°å·¦ï¼Œéœ€è¦ç¿»è½¬åˆ—ç´¢å¼•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">row := n - <span class="number">1</span> - bottomRow       <span class="comment">// è½¬æ¢ä¸ºæ•°ç»„è¡Œç´¢å¼•</span></span><br></pre></td></tr></table></figure>
<h4 id="B-å¾ªç¯è›‡æ¢¯çš„å¤„ç†">B. <strong>å¾ªç¯è›‡æ¢¯çš„å¤„ç†</strong></h4>
<ul>
<li><strong>å…³é”®æ€æƒ³</strong>: åœ¨BFSä¸­ç›´æ¥å¤„ç†è·³è½¬ï¼Œä¸ä½¿ç”¨é€’å½’</li>
<li><strong>è®¿é—®æ ‡è®°</strong>: å¯¹æœ€ç»ˆåˆ°è¾¾çš„ä½ç½®è¿›è¡Œæ ‡è®°ï¼Œé¿å…é‡å¤è®¿é—®</li>
<li><strong>ä¸€æ¬¡è·³è½¬</strong>: é¢˜ç›®ä¿è¯è›‡æ¢¯çš„ç›®çš„åœ°ä¸ä¼šå†æœ‰è›‡æ¢¯</li>
</ul>
<h4 id="C-BFSçš„ä¼˜åŒ–è¦ç‚¹">C. <strong>BFSçš„ä¼˜åŒ–è¦ç‚¹</strong></h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. visitedæ•°ç»„å¤§å°æ­£ç¡®</span></span><br><span class="line">visited := <span class="built_in">make</span>([]<span class="type">bool</span>, n*n+<span class="number">1</span>)  <span class="comment">// ç¼–å·èŒƒå›´[1, n*n]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è¾¹ç•Œæ£€æŸ¥</span></span><br><span class="line"><span class="keyword">if</span> nextNum &gt; n*n &#123;</span><br><span class="line">    <span class="keyword">break</span>  <span class="comment">// è¶…å‡ºæ£‹ç›˜èŒƒå›´</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line"><span class="keyword">if</span> curr.Num == n*n &#123;  <span class="comment">// ç›´æ¥æ¯”è¾ƒç¼–å·ï¼Œä¸éœ€è¦åæ ‡</span></span><br><span class="line">    <span class="keyword">return</span> curr.step</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-å¤æ‚åº¦åˆ†æ">5. <strong>å¤æ‚åº¦åˆ†æ</strong></h3>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(nÂ²)</p>
<ul>
<li>æ¯ä¸ªä½ç½®æœ€å¤šè®¿é—®ä¸€æ¬¡</li>
<li>æ€»å…±nÂ²ä¸ªä½ç½®</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(nÂ²)</p>
<ul>
<li>visitedæ•°ç»„: O(nÂ²)</li>
<li>BFSé˜Ÿåˆ—: æœ€åæƒ…å†µO(nÂ²)</li>
</ul>
</li>
</ul>
<h2 id="ä»å­˜åœ¨çš„é—®é¢˜">ä»å­˜åœ¨çš„é—®é¢˜</h2>
<h3 id="1-visitedæ•°ç»„ç´¢å¼•è¶Šç•Œ">1. <strong>visitedæ•°ç»„ç´¢å¼•è¶Šç•Œ</strong></h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">visited := <span class="built_in">make</span>([]<span class="type">bool</span>, n*n)  <span class="comment">// é•¿åº¦ä¸º n*nï¼Œç´¢å¼•èŒƒå›´ [0, n*n-1]</span></span><br><span class="line"><span class="comment">// ä½†æ˜¯ç¼–å·èŒƒå›´æ˜¯ [1, n*n]ï¼Œè®¿é—® visited[n*n] ä¼šè¶Šç•Œ</span></span><br></pre></td></tr></table></figure>
<h3 id="2-é€’å½’é—®é¢˜æœªè§£å†³">2. <strong>é€’å½’é—®é¢˜æœªè§£å†³</strong></h3>
<p>ä»ç„¶ä½¿ç”¨ <code>numToNode</code> é€’å½’å‡½æ•°ï¼Œé‡åˆ°å¾ªç¯è›‡æ¢¯æ—¶ä¾ç„¶ä¼šæœ‰é—®é¢˜ã€‚</p>
<h3 id="3-åæ ‡è½¬æ¢çš„æ­£ç¡®æ€§">3. <strong>åæ ‡è½¬æ¢çš„æ­£ç¡®æ€§</strong></h3>
<p>å¤šæ¬¡ä¿®æ”¹åæ ‡è½¬æ¢é€»è¾‘ï¼Œä½†ä»ä¸ç¡®å®šæ˜¯å¦å®Œå…¨æ­£ç¡®ã€‚</p>
<h2 id="å…³é”®æ”¶è·ä¸åæ€">å…³é”®æ”¶è·ä¸åæ€</h2>
<h3 id="ç®—æ³•å±‚é¢">ç®—æ³•å±‚é¢</h3>
<ol>
<li><strong>BFSæ˜¯æ­£ç¡®çš„é€‰æ‹©</strong>: æ±‚æœ€çŸ­è·¯å¾„é—®é¢˜åº”è¯¥ä½¿ç”¨BFS</li>
<li><strong>çŠ¶æ€è®¾è®¡è¦æ¸…æ™°</strong>: æ˜ç¡®æ¯ä¸ªçŠ¶æ€åŒ…å«çš„ä¿¡æ¯</li>
<li><strong>è¾¹ç•Œæ¡ä»¶è¦ä»”ç»†</strong>: æ•°ç»„ç´¢å¼•ã€ç¼–å·èŒƒå›´ç­‰ç»†èŠ‚å¾ˆé‡è¦</li>
</ol>
<h3 id="å®ç°å±‚é¢">å®ç°å±‚é¢</h3>
<ol>
<li><strong>åæ ‡è½¬æ¢æ˜¯æ ¸å¿ƒéš¾ç‚¹</strong>: è›‡æ¢¯æ£‹çš„ç¼–å·è§„åˆ™æ¯”è¾ƒå¤æ‚</li>
<li><strong>é€’å½’vsè¿­ä»£è¦æƒè¡¡</strong>: å¯¹äºå¯èƒ½æœ‰å¾ªç¯çš„åœºæ™¯ï¼Œè¿­ä»£æ›´å®‰å…¨</li>
<li><strong>è®¿é—®æ§åˆ¶å¿…ä¸å¯å°‘</strong>: é¿å…é‡å¤è®¿é—®å’Œæ— é™å¾ªç¯</li>
</ol>
<h3 id="è°ƒè¯•æŠ€å·§">è°ƒè¯•æŠ€å·§</h3>
<ol>
<li><strong>å°æ•°æ®æµ‹è¯•</strong>: ç”¨ç®€å•çš„æµ‹è¯•æ¡ˆä¾‹éªŒè¯åæ ‡è½¬æ¢é€»è¾‘</li>
<li><strong>è¾¹ç•Œæ¡ä»¶æ£€æŸ¥</strong>: ç‰¹åˆ«å…³æ³¨æ•°ç»„è¶Šç•Œé—®é¢˜</li>
<li><strong>å¾ªç¯æ£€æµ‹</strong>: å¯¹äºå›¾ç›¸å…³é—®é¢˜è¦è€ƒè™‘å¾ªç¯çš„å¤„ç†</li>
</ol>
<h2 id="é”™è¯¯æ ¹å› æ€»ç»“">é”™è¯¯æ ¹å› æ€»ç»“</h2>
<p>é€šè¿‡æ·±å…¥åˆ†æï¼Œè¿™é“é¢˜çš„é”™è¯¯ä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<h3 id="1-åæ ‡è½¬æ¢ç†è§£ä¸å¤Ÿæ·±å…¥">1. <strong>åæ ‡è½¬æ¢ç†è§£ä¸å¤Ÿæ·±å…¥</strong></h3>
<ul>
<li><strong>é”™è¯¯</strong>: å¤šæ¬¡å°è¯•ä¸åŒçš„è½¬æ¢å…¬å¼ï¼Œä½†éƒ½æ²¡æœ‰æ­£ç¡®ç†è§£è›‡å½¢ç¼–å·çš„æ•°å­¦è§„å¾‹</li>
<li><strong>æ­£ç¡®</strong>: éœ€è¦æ¸…æ¥šç†è§£ <code>bottomRow = (num-1)/n</code> å’Œç¿»è½¬æ¡ä»¶ <code>bottomRow%2 == 1</code></li>
</ul>
<h3 id="2-é€’å½’vsè¿­ä»£çš„é€‰æ‹©å¤±è¯¯">2. <strong>é€’å½’vsè¿­ä»£çš„é€‰æ‹©å¤±è¯¯</strong></h3>
<ul>
<li><strong>é”™è¯¯</strong>: ä½¿ç”¨é€’å½’å¤„ç†è›‡æ¢¯è·³è½¬ï¼Œé‡åˆ°å¾ªç¯æ—¶å¯¼è‡´æ ˆæº¢å‡º</li>
<li><strong>æ­£ç¡®</strong>: åœ¨BFSä¸»å¾ªç¯ä¸­ç›´æ¥å¤„ç†è·³è½¬ï¼Œé¿å…å‡½æ•°è°ƒç”¨æ ˆé—®é¢˜</li>
</ul>
<h3 id="3-è¾¹ç•Œæ¡ä»¶å¤„ç†ä¸å½“">3. <strong>è¾¹ç•Œæ¡ä»¶å¤„ç†ä¸å½“</strong></h3>
<ul>
<li><strong>é”™è¯¯</strong>: visitedæ•°ç»„é•¿åº¦ä¸ºn<em>nï¼Œä½†ç¼–å·èŒƒå›´æ˜¯[1,n</em>n]ï¼Œå¯¼è‡´è¶Šç•Œ</li>
<li><strong>æ­£ç¡®</strong>: visitedæ•°ç»„é•¿åº¦åº”ä¸ºn<em>n+1ï¼Œæˆ–è€…å°†ç¼–å·æ˜ å°„åˆ°[0,n</em>n-1]èŒƒå›´</li>
</ul>
<h3 id="4-è®¿é—®æ§åˆ¶æ—¶æœºé”™è¯¯">4. <strong>è®¿é—®æ§åˆ¶æ—¶æœºé”™è¯¯</strong></h3>
<ul>
<li><strong>é”™è¯¯</strong>: åœ¨å‡ºé˜Ÿæ—¶æ‰æ ‡è®°è®¿é—®ï¼Œæˆ–è€…æ ‡è®°æ—¶æœºä¸å½“</li>
<li><strong>æ­£ç¡®</strong>: åœ¨å…¥é˜Ÿæ—¶ç«‹å³æ ‡è®°æœ€ç»ˆä½ç½®ä¸ºå·²è®¿é—®</li>
</ul>
<h2 id="ç®—æ³•å­¦ä¹ æ”¶è·">ç®—æ³•å­¦ä¹ æ”¶è·</h2>
<h3 id="æŠ€æœ¯å±‚é¢">æŠ€æœ¯å±‚é¢</h3>
<ol>
<li>
<p><strong>åæ ‡è½¬æ¢å…¬å¼æ¨å¯¼</strong>:</p>
<ul>
<li>ç†è§£äºŒç»´ç¼–å·åˆ°ä¸€ç»´æ•°ç»„çš„æ˜ å°„å…³ç³»</li>
<li>æŒæ¡è›‡å½¢è·¯å¾„çš„æ•°å­¦è§„å¾‹</li>
</ul>
</li>
<li>
<p><strong>BFSå®ç°æŠ€å·§</strong>:</p>
<ul>
<li>åˆç†çš„visitedæ•°ç»„è®¾è®¡</li>
<li>æ­£ç¡®çš„è®¿é—®æ ‡è®°æ—¶æœº</li>
<li>è¾¹ç•Œæ¡ä»¶çš„å…¨é¢æ£€æŸ¥</li>
</ul>
</li>
<li>
<p><strong>é¿å…é€’å½’é™·é˜±</strong>:</p>
<ul>
<li>è¯†åˆ«å¯èƒ½å­˜åœ¨å¾ªç¯çš„åœºæ™¯</li>
<li>é€‰æ‹©è¿­ä»£è€Œéé€’å½’çš„å¤„ç†æ–¹å¼</li>
</ul>
</li>
</ol>
<h3 id="æ€ç»´å±‚é¢">æ€ç»´å±‚é¢</h3>
<ol>
<li><strong>é—®é¢˜åˆ†è§£èƒ½åŠ›</strong>: å°†å¤æ‚é—®é¢˜æ‹†åˆ†ä¸ºåæ ‡è½¬æ¢ã€è›‡æ¢¯å¤„ç†ã€BFSéå†ç­‰å­é—®é¢˜</li>
<li><strong>è¾¹ç•Œæ„è¯†</strong>: æ—¶åˆ»å…³æ³¨æ•°ç»„ç´¢å¼•èŒƒå›´ã€ç¼–å·èŒƒå›´ç­‰è¾¹ç•Œæ¡ä»¶</li>
<li><strong>è°ƒè¯•æ€ç»´</strong>: é€šè¿‡å…·ä½“ä¾‹å­éªŒè¯ç®—æ³•é€»è¾‘çš„æ­£ç¡®æ€§</li>
</ol>
<h3 id="ä»£ç è´¨é‡">ä»£ç è´¨é‡</h3>
<ol>
<li><strong>å‡½æ•°è®¾è®¡</strong>: å°†åæ ‡è½¬æ¢æŠ½è±¡ä¸ºç‹¬ç«‹å‡½æ•°ï¼Œæé«˜ä»£ç å¯è¯»æ€§</li>
<li><strong>å˜é‡å‘½å</strong>: ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åï¼ˆå¦‚bottomRowï¼‰å¸®åŠ©ç†è§£</li>
<li><strong>æ³¨é‡Šä¹ æƒ¯</strong>: åœ¨å…³é”®é€»è¾‘å¤„æ·»åŠ è¯´æ˜ï¼Œç‰¹åˆ«æ˜¯æ•°å­¦å…¬å¼éƒ¨åˆ†</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>LeetCode 909 è›‡æ¢¯æ£‹æ˜¯ä¸€é“ç»¼åˆæ€§å¾ˆå¼ºçš„é¢˜ç›®ï¼Œæ¶‰åŠï¼š</p>
<ul>
<li><strong>å›¾è®º</strong>: BFSæœ€çŸ­è·¯å¾„</li>
<li><strong>æ•°å­¦</strong>: åæ ‡è½¬æ¢å…¬å¼æ¨å¯¼</li>
<li><strong>ç¼–ç¨‹æŠ€å·§</strong>: é¿å…é€’å½’ã€æ­£ç¡®çš„è®¿é—®æ§åˆ¶</li>
</ul>
<p><strong>æ ¸å¿ƒæ•™è®­</strong>:</p>
<ol>
<li><strong>ç†è®ºå…ˆè¡Œ</strong>: åœ¨ç¼–ç å‰è¦å®Œå…¨ç†è§£é—®é¢˜çš„æ•°å­¦æ¨¡å‹</li>
<li><strong>ç»†èŠ‚å…³é”®</strong>: è¾¹ç•Œæ¡ä»¶ã€æ•°ç»„ç´¢å¼•ç­‰ç»†èŠ‚å¾€å¾€å†³å®šæˆè´¥</li>
<li><strong>è¿­ä»£ä¼˜äºé€’å½’</strong>: å¯¹äºå¯èƒ½æœ‰å¾ªç¯çš„å›¾é—®é¢˜ï¼Œä¼˜å…ˆè€ƒè™‘è¿­ä»£è§£æ³•</li>
<li><strong>æµ‹è¯•éªŒè¯</strong>: ç”¨ç®€å•ä¾‹å­éªŒè¯å…³é”®é€»è¾‘ï¼ˆå¦‚åæ ‡è½¬æ¢ï¼‰çš„æ­£ç¡®æ€§</li>
</ol>
<p><strong>æ ‡è®°ä¸ºé”™é¢˜çš„ä»·å€¼</strong>: é€šè¿‡å®Œæ•´è®°å½•é”™è¯¯è¿‡ç¨‹å’Œæ­£ç¡®æ€è·¯ï¼Œä¸ºä»Šåé‡åˆ°ç±»ä¼¼çš„åæ ‡è½¬æ¢ã€BFSéå†é—®é¢˜æä¾›äº†å®è´µçš„å‚è€ƒç»éªŒã€‚è¿™ç§æ·±åº¦åˆ†ææ¯”ç®€å•çš„ACæ›´æœ‰å­¦ä¹ ä»·å€¼ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ¨¡æ‹Ÿ</category>
        <category>é”™é¢˜é›†</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>BFS</tag>
        <tag>å›¾è®º</tag>
        <tag>åæ ‡è½¬æ¢</tag>
        <tag>é”™é¢˜åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 399 - é™¤æ³•æ±‚å€¼ï¼šä»å›¾è®ºåˆ°Floydç®—æ³•çš„ä¼˜é›…è½¬æ¢</title>
    <url>/2025/06/22/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-399-%E9%99%A4%E6%B3%95%E6%B1%82%E5%80%BC/</url>
    <content><![CDATA[<h2 id="å¼•è¨€ï¼šä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„æ•°å­¦é—®é¢˜">å¼•è¨€ï¼šä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„æ•°å­¦é—®é¢˜</h2>
<p>å½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°LeetCode 399è¿™é“é¢˜æ—¶ï¼Œå¿ƒæƒ³ï¼š&quot;ä¸å°±æ˜¯è®¡ç®—ä¸€äº›é™¤æ³•å—ï¼Ÿ&quot;ä½†ä»”ç»†ä¸€çœ‹ï¼Œå‘ç°äº‹æƒ…è¿œæ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚</p>
<p>é¢˜ç›®ç»™å‡ºäº†ä¸€äº›å˜é‡ä¹‹é—´çš„é™¤æ³•å…³ç³»ï¼Œæ¯”å¦‚ <code>a/b = 2.0, b/c = 3.0</code>ï¼Œç„¶åè¦æ±‚æˆ‘ä»¬è®¡ç®—å…¶ä»–å˜é‡å¯¹çš„é™¤æ³•ç»“æœï¼Œå¦‚ <code>a/c = ?</code>ã€‚å¦‚æœå˜é‡ä¸å­˜åœ¨æˆ–è€…æ— æ³•é€šè¿‡å·²çŸ¥å…³ç³»æ¨å¯¼å‡ºç»“æœï¼Œå°±è¿”å› <code>-1.0</code>ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜çš„æœ‰è¶£ä¹‹å¤„åœ¨äºï¼Œå®ƒè¡¨é¢ä¸Šæ˜¯æ•°å­¦è®¡ç®—ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ª<strong>å…³ç³»ä¼ é€’</strong>çš„é—®é¢˜ã€‚å°±åƒç°å®ç”Ÿæ´»ä¸­çš„æ±‡ç‡æ¢ç®—ï¼šå¦‚æœä½ çŸ¥é“ <code>1ç¾å…ƒ = 7äººæ°‘å¸</code> å’Œ <code>1äººæ°‘å¸ = 0.14æ¬§å…ƒ</code>ï¼Œé‚£ä¹ˆä½ è‡ªç„¶èƒ½æ¨ç®—å‡º <code>1ç¾å…ƒ = 0.98æ¬§å…ƒ</code>ã€‚</p>
<h2 id="ç¬¬ä¸€ç›´è§‰ï¼šè¿™ä¸å°±æ˜¯å›¾è®ºé—®é¢˜å—ï¼Ÿ">ç¬¬ä¸€ç›´è§‰ï¼šè¿™ä¸å°±æ˜¯å›¾è®ºé—®é¢˜å—ï¼Ÿ</h2>
<p>é¢å¯¹è¿™æ ·çš„å…³ç³»ä¼ é€’é—®é¢˜ï¼Œæˆ‘çš„ç¬¬ä¸€ç›´è§‰æ˜¯ï¼š<strong>è¿™å¯ä»¥ç”¨å›¾æ¥å»ºæ¨¡</strong>ï¼</p>
<h3 id="æ€è·¯çš„å½¢æˆè¿‡ç¨‹">æ€è·¯çš„å½¢æˆè¿‡ç¨‹</h3>
<p>è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š</p>
<ol>
<li><strong>å˜é‡å¯ä»¥çœ‹ä½œèŠ‚ç‚¹</strong>ï¼šæ¯ä¸ªå˜é‡ï¼ˆå¦‚ <code>a</code>, <code>b</code>, <code>c</code>ï¼‰éƒ½æ˜¯å›¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹</li>
<li><strong>é™¤æ³•å…³ç³»å¯ä»¥çœ‹ä½œè¾¹</strong>ï¼šå¦‚æœ <code>a/b = 2.0</code>ï¼Œé‚£ä¹ˆå¯ä»¥å»ºç«‹ä¸€æ¡ä» <code>a</code> åˆ° <code>b</code> çš„æœ‰å‘è¾¹ï¼Œæƒé‡ä¸º <code>2.0</code></li>
<li><strong>æŸ¥è¯¢å°±æ˜¯è·¯å¾„æœç´¢</strong>ï¼šè¦è®¡ç®— <code>a/c</code>ï¼Œå°±æ˜¯è¦æ‰¾ä»èŠ‚ç‚¹ <code>a</code> åˆ°èŠ‚ç‚¹ <code>c</code> çš„è·¯å¾„</li>
</ol>
<p>ä½†è¿™é‡Œæœ‰ä¸ªå…³é”®é—®é¢˜ï¼š<strong>è·¯å¾„ä¸Šçš„æƒé‡å¦‚ä½•è®¡ç®—ï¼Ÿ</strong></p>
<p>åœ¨ä¼ ç»Ÿçš„å›¾è®ºé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è®¡ç®—è·¯å¾„é•¿åº¦ï¼ˆæƒé‡ç›¸åŠ ï¼‰ã€‚ä½†åœ¨é™¤æ³•é—®é¢˜ä¸­ï¼Œå…³ç³»æ˜¯<strong>ä¹˜æ€§çš„</strong>ï¼š</p>
<ul>
<li>å¦‚æœ <code>a/b = 2.0</code> ä¸” <code>b/c = 3.0</code></li>
<li>é‚£ä¹ˆ <code>a/c = (a/b) Ã— (b/c) = 2.0 Ã— 3.0 = 6.0</code></li>
</ul>
<p>è¿™ä¸ªæ´å¯Ÿå¾ˆé‡è¦ï¼š<strong>è·¯å¾„æƒé‡éœ€è¦ç›¸ä¹˜ï¼Œè€Œä¸æ˜¯ç›¸åŠ </strong>ï¼</p>
<h3 id="å›¾çš„æ„å»ºç­–ç•¥">å›¾çš„æ„å»ºç­–ç•¥</h3>
<p>æ˜ç¡®äº†åŸºæœ¬æ€è·¯åï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•æ„å»ºå›¾ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™å®šï¼ša/b = 2.0, b/c = 3.0</span><br><span class="line"></span><br><span class="line">æ„å»ºçš„å›¾ï¼š</span><br><span class="line">   a ----2.0---â†’ b ----3.0---â†’ c</span><br><span class="line">   â†‘             â†‘             â†‘</span><br><span class="line">   |             |             |</span><br><span class="line"> 0.5            0.33          0.33</span><br><span class="line">   |             |             |</span><br><span class="line">   â†“             â†“             â†“</span><br><span class="line">   a â†---0.5---- b â†---0.33--- c</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„å‡ ä¸ªè¦ç‚¹ï¼š</p>
<ol>
<li><strong>åŒå‘è¾¹</strong>ï¼šå¦‚æœ <code>a/b = 2.0</code>ï¼Œé‚£ä¹ˆ <code>b/a = 0.5</code></li>
<li><strong>è‡ªç¯</strong>ï¼šæ¯ä¸ªå˜é‡é™¤ä»¥è‡ªå·±ç­‰äº <code>1.0</code></li>
<li><strong>æƒé‡ä¼ é€’</strong>ï¼šé€šè¿‡ä¸­é—´èŠ‚ç‚¹å¯ä»¥è®¡ç®—é—´æ¥å…³ç³»</li>
</ol>
<h2 id="è§£æ³•ä¸€ï¼šDFSå›¾æœç´¢-ç›´è§‚è€Œæœ‰æ•ˆ">è§£æ³•ä¸€ï¼šDFSå›¾æœç´¢ - ç›´è§‚è€Œæœ‰æ•ˆ</h2>
<p>åŸºäºå›¾è®ºçš„æ€è·¯ï¼Œæœ€ç›´è§‚çš„è§£æ³•å°±æ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼š</p>
<h3 id="æ ¸å¿ƒç®—æ³•è®¾è®¡">æ ¸å¿ƒç®—æ³•è®¾è®¡</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calcEquation</span><span class="params">(equations [][]<span class="type">string</span>, values []<span class="type">float64</span>, queries [][]<span class="type">string</span>)</span></span> []<span class="type">float64</span> &#123;</span><br><span class="line">    <span class="comment">// 1. æ„å»ºå›¾çš„é‚»æ¥è¡¨</span></span><br><span class="line">    graph := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">float64</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. åˆå§‹åŒ–å›¾ - æ·»åŠ åŒå‘è¾¹å’Œè‡ªç¯</span></span><br><span class="line">    <span class="keyword">for</span> i, equation := <span class="keyword">range</span> equations &#123;</span><br><span class="line">        a, b := equation[<span class="number">0</span>], equation[<span class="number">1</span>]</span><br><span class="line">        value := values[i]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> graph[a] == <span class="literal">nil</span> &#123;</span><br><span class="line">            graph[a] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">float64</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> graph[b] == <span class="literal">nil</span> &#123;</span><br><span class="line">            graph[b] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">float64</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…³é”®ï¼šåŒå‘è¾¹çš„å»ºç«‹</span></span><br><span class="line">        graph[a][b] = value      <span class="comment">// a/b = value</span></span><br><span class="line">        graph[b][a] = <span class="number">1.0</span> / value <span class="comment">// b/a = 1/value</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è‡ªç¯å¤„ç†</span></span><br><span class="line">        graph[a][a] = <span class="number">1.0</span></span><br><span class="line">        graph[b][b] = <span class="number">1.0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. DFSæœç´¢å‡½æ•° - å¯»æ‰¾è·¯å¾„å¹¶è®¡ç®—ä¹˜ç§¯</span></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(start, end <span class="type">string</span>, visited <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span>)</span></span> <span class="type">float64</span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(start, end <span class="type">string</span>, visited <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span>)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> graph[start] == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1.0</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç›´æ¥å¯è¾¾</span></span><br><span class="line">        <span class="keyword">if</span> val, exists := graph[start][end]; exists &#123;</span><br><span class="line">            <span class="keyword">return</span> val</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ‡è®°è®¿é—®ï¼Œé¿å…ç¯è·¯</span></span><br><span class="line">        visited[start] = <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€’å½’æœç´¢æ‰€æœ‰é‚»å±…</span></span><br><span class="line">        <span class="keyword">for</span> neighbor, weight := <span class="keyword">range</span> graph[start] &#123;</span><br><span class="line">            <span class="keyword">if</span> !visited[neighbor] &#123;</span><br><span class="line">                result := dfs(neighbor, end, visited)</span><br><span class="line">                <span class="keyword">if</span> result != <span class="number">-1.0</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> weight * result  <span class="comment">// å…³é”®ï¼šæƒé‡ç›¸ä¹˜</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å›æº¯</span></span><br><span class="line">        visited[start] = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1.0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. å¤„ç†æ‰€æœ‰æŸ¥è¯¢</span></span><br><span class="line">    results := <span class="built_in">make</span>([]<span class="type">float64</span>, <span class="built_in">len</span>(queries))</span><br><span class="line">    <span class="keyword">for</span> i, query := <span class="keyword">range</span> queries &#123;</span><br><span class="line">        start, end := query[<span class="number">0</span>], query[<span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> graph[start] == <span class="literal">nil</span> || graph[end] == <span class="literal">nil</span> &#123;</span><br><span class="line">            results[i] = <span class="number">-1.0</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> start == end &#123;</span><br><span class="line">            results[i] = <span class="number">1.0</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        visited := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span>)</span><br><span class="line">        results[i] = dfs(start, end, visited)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç®—æ³•æ‰§è¡Œè¿‡ç¨‹åˆ†æ">ç®—æ³•æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥çœ‹DFSçš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p><strong>è¾“å…¥</strong>ï¼š<code>equations = [[&quot;a&quot;,&quot;b&quot;],[&quot;b&quot;,&quot;c&quot;]], values = [2.0,3.0]</code><br>
<strong>æŸ¥è¯¢</strong>ï¼š<code>a/c</code></p>
<ol>
<li>
<p><strong>å›¾æ„å»ºé˜¶æ®µ</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph[&quot;a&quot;][&quot;b&quot;] = 2.0, graph[&quot;b&quot;][&quot;a&quot;] = 0.5</span><br><span class="line">graph[&quot;b&quot;][&quot;c&quot;] = 3.0, graph[&quot;c&quot;][&quot;b&quot;] = 0.33</span><br><span class="line">graph[&quot;a&quot;][&quot;a&quot;] = 1.0, graph[&quot;b&quot;][&quot;b&quot;] = 1.0, graph[&quot;c&quot;][&quot;c&quot;] = 1.0</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>DFSæœç´¢è¿‡ç¨‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dfs(&quot;a&quot;, &quot;c&quot;, &#123;&#125;)</span><br><span class="line">â†’ æ£€æŸ¥ç›´æ¥è¾¹ï¼šä¸å­˜åœ¨ aâ†’c</span><br><span class="line">â†’ æ ‡è®° a ä¸ºå·²è®¿é—®</span><br><span class="line">â†’ éå†é‚»å±…ï¼šæ‰¾åˆ° bï¼Œæƒé‡ 2.0</span><br><span class="line">  â†’ dfs(&quot;b&quot;, &quot;c&quot;, &#123;&quot;a&quot;: true&#125;)</span><br><span class="line">    â†’ æ£€æŸ¥ç›´æ¥è¾¹ï¼šå­˜åœ¨ bâ†’cï¼Œæƒé‡ 3.0</span><br><span class="line">    â†’ è¿”å› 3.0</span><br><span class="line">  â†’ è¿”å› 2.0 Ã— 3.0 = 6.0</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="DFSè§£æ³•çš„ä¼˜ç¼ºç‚¹">DFSè§£æ³•çš„ä¼˜ç¼ºç‚¹</h3>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>æ€è·¯ç›´è§‚ï¼Œå®¹æ˜“ç†è§£</li>
<li>å®ç°ç›¸å¯¹ç®€å•</li>
<li>é€‚åˆä¸­å°è§„æ¨¡æ•°æ®</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦é‡æ–°æœç´¢</li>
<li>æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼š$O(M \times (N + E))$</li>
<li>å¤§é‡æŸ¥è¯¢æ—¶æ•ˆç‡ä¸é«˜</li>
</ul>
<h2 id="è§£æ³•äºŒï¼šFloyd-Warshallç®—æ³•çš„ä¼˜é›…è½¬æ¢">è§£æ³•äºŒï¼šFloyd-Warshallç®—æ³•çš„ä¼˜é›…è½¬æ¢</h2>
<p>å°±åœ¨æˆ‘å¯¹DFSè§£æ³•åŸºæœ¬æ»¡æ„çš„æ—¶å€™ï¼Œçªç„¶æ„è¯†åˆ°ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæŸ¥è¯¢é‡å¾ˆå¤§æ€ä¹ˆåŠï¼Ÿæ¯æ¬¡éƒ½DFSæœç´¢æ˜¾ç„¶ä¸å¤Ÿé«˜æ•ˆã€‚</p>
<p>è¿™æ—¶æˆ‘æƒ³åˆ°äº†ç»å…¸çš„<strong>Floyd-Warshallç®—æ³•</strong>ã€‚ä¼ ç»Ÿçš„Floydç®—æ³•ç”¨äºè®¡ç®—æ‰€æœ‰ç‚¹å¯¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œæ ¸å¿ƒæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> k := <span class="number">0</span>; k &lt; n; k++ &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; n; j++ &#123;</span><br><span class="line">            dist[i][j] = min(dist[i][j], dist[i][k] + dist[k][j])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ç­‰ç­‰ï¼<strong>æˆ‘ä»¬çš„é™¤æ³•é—®é¢˜ä¸­ï¼Œè·¯å¾„æƒé‡æ˜¯ç›¸ä¹˜çš„ï¼Œä¸æ˜¯ç›¸åŠ çš„</strong>ã€‚é‚£ä¹ˆï¼Œèƒ½ä¸èƒ½æŠŠåŠ æ³•æ”¹æˆä¹˜æ³•å‘¢ï¼Ÿ</p>
<h3 id="ç®—æ³•æ”¹è¿›çš„å…³é”®æ´å¯Ÿ">ç®—æ³•æ”¹è¿›çš„å…³é”®æ´å¯Ÿ</h3>
<p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼å…³é”®åœ¨äºç†è§£é™¤æ³•çš„ä¼ é€’æ€§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦‚æœ a/k = x ä¸” k/b = y</span><br><span class="line">é‚£ä¹ˆ a/b = (a/k) Ã— (k/b) = x Ã— y</span><br></pre></td></tr></table></figure>
<p>è¿™æ­£å¥½å¯¹åº”Floydç®—æ³•ä¸­é€šè¿‡ä¸­é—´ç‚¹kçš„è·¯å¾„è®¡ç®—ï¼</p>
<h3 id="Floydç®—æ³•çš„é™¤æ³•ç‰ˆæœ¬">Floydç®—æ³•çš„é™¤æ³•ç‰ˆæœ¬</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calcEquationFloyd</span><span class="params">(equations [][]<span class="type">string</span>, values []<span class="type">float64</span>, queries [][]<span class="type">string</span>)</span></span> []<span class="type">float64</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å»ºç«‹å˜é‡åˆ°ç´¢å¼•çš„æ˜ å°„</span></span><br><span class="line">    variables := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">    idx := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, equation := <span class="keyword">range</span> equations &#123;</span><br><span class="line">        <span class="keyword">for</span> _, variable := <span class="keyword">range</span> equation &#123;</span><br><span class="line">            <span class="keyword">if</span> _, exists := variables[variable]; !exists &#123;</span><br><span class="line">                variables[variable] = idx</span><br><span class="line">                idx++</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    n := <span class="built_in">len</span>(variables)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. åˆå§‹åŒ–è·ç¦»çŸ©é˜µ</span></span><br><span class="line">    dist := <span class="built_in">make</span>([][]<span class="type">float64</span>, n)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> dist &#123;</span><br><span class="line">        dist[i] = <span class="built_in">make</span>([]<span class="type">float64</span>, n)</span><br><span class="line">        <span class="keyword">for</span> j := <span class="keyword">range</span> dist[i] &#123;</span><br><span class="line">            <span class="keyword">if</span> i == j &#123;</span><br><span class="line">                dist[i][j] = <span class="number">1.0</span>    <span class="comment">// è‡ªå·±/è‡ªå·± = 1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dist[i][j] = <span class="number">-1.0</span>   <span class="comment">// åˆå§‹ä¸å¯è¾¾</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. å¡«å……å·²çŸ¥çš„é™¤æ³•å…³ç³»</span></span><br><span class="line">    <span class="keyword">for</span> i, equation := <span class="keyword">range</span> equations &#123;</span><br><span class="line">        a, b := variables[equation[<span class="number">0</span>]], variables[equation[<span class="number">1</span>]]</span><br><span class="line">        value := values[i]</span><br><span class="line">        </span><br><span class="line">        dist[a][b] = value</span><br><span class="line">        dist[b][a] = <span class="number">1.0</span> / value</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. Floydæ ¸å¿ƒç®—æ³• - å…³é”®åœ¨äºä¹˜æ³•ï¼</span></span><br><span class="line">    <span class="keyword">for</span> k := <span class="number">0</span>; k &lt; n; k++ &#123;</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">            <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; n; j++ &#123;</span><br><span class="line">                <span class="comment">// ä¼ ç»ŸFloyd: dist[i][j] = min(dist[i][j], dist[i][k] + dist[k][j])</span></span><br><span class="line">                <span class="comment">// é™¤æ³•ç‰ˆæœ¬: å¦‚æœé€šè¿‡kçš„è·¯å¾„å­˜åœ¨ï¼Œåˆ™è®¡ç®—ä¹˜ç§¯</span></span><br><span class="line">                <span class="keyword">if</span> dist[i][k] != <span class="number">-1.0</span> &amp;&amp; dist[k][j] != <span class="number">-1.0</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> dist[i][j] == <span class="number">-1.0</span> &#123;</span><br><span class="line">                        dist[i][j] = dist[i][k] * dist[k][j]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. å¤„ç†æŸ¥è¯¢ - O(1)æ—¶é—´å¤æ‚åº¦</span></span><br><span class="line">    results := <span class="built_in">make</span>([]<span class="type">float64</span>, <span class="built_in">len</span>(queries))</span><br><span class="line">    <span class="keyword">for</span> i, query := <span class="keyword">range</span> queries &#123;</span><br><span class="line">        start, end := query[<span class="number">0</span>], query[<span class="number">1</span>]</span><br><span class="line">        startIdx, startExists := variables[start]</span><br><span class="line">        endIdx, endExists := variables[end]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> !startExists || !endExists &#123;</span><br><span class="line">            results[i] = <span class="number">-1.0</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            results[i] = dist[startIdx][endIdx]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Floydç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹">Floydç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹</h3>
<p>è®©æˆ‘ä»¬çœ‹çœ‹Floydç®—æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<p><strong>åˆå§‹çŠ¶æ€</strong>ï¼ˆä»¥ <code>a/b=2.0, b/c=3.0</code> ä¸ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    a    b    c</span><br><span class="line">a [ 1.0  2.0  -1 ]</span><br><span class="line">b [ 0.5  1.0  3.0]</span><br><span class="line">c [ -1   0.33 1.0]</span><br></pre></td></tr></table></figure>
<p><strong>k=0æ—¶</strong>ï¼ˆé€šè¿‡aä½œä¸ºä¸­é—´ç‚¹ï¼‰ï¼š</p>
<ul>
<li>æ£€æŸ¥æ‰€æœ‰i,jå¯¹ï¼Œçœ‹æ˜¯å¦èƒ½é€šè¿‡aè¿æ¥</li>
<li>å‘ç°æ²¡æœ‰æ–°çš„è¿æ¥</li>
</ul>
<p><strong>k=1æ—¶</strong>ï¼ˆé€šè¿‡bä½œä¸ºä¸­é—´ç‚¹ï¼‰ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>dist[a][c]</code>ï¼š<code>dist[a][b] * dist[b][c] = 2.0 * 3.0 = 6.0</code></li>
<li>æ£€æŸ¥ <code>dist[c][a]</code>ï¼š<code>dist[c][b] * dist[b][a] = 0.33 * 0.5 = 0.167</code></li>
</ul>
<p><strong>æœ€ç»ˆçŠ¶æ€</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    a    b    c</span><br><span class="line">a [ 1.0  2.0  6.0 ]</span><br><span class="line">b [ 0.5  1.0  3.0 ]</span><br><span class="line">c [0.167 0.33 1.0 ]</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œä»»ä½•æŸ¥è¯¢éƒ½å¯ä»¥åœ¨O(1)æ—¶é—´å†…å®Œæˆï¼</p>
<h3 id="âŒ-å¸¸è§é”™è¯¯åˆ†æï¼šæ¡ä»¶åˆ¤æ–­çš„é™·é˜±">âŒ å¸¸è§é”™è¯¯åˆ†æï¼šæ¡ä»¶åˆ¤æ–­çš„é™·é˜±</h3>
<p>åœ¨å®ç°Floyd-Warshallç®—æ³•æ—¶ï¼Œæœ‰ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ä¼šå¯¼è‡´ç²¾åº¦é—®é¢˜å’Œé”™è¯¯ç»“æœã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªé”™è¯¯çš„å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯çš„Floydå®ç°</span></span><br><span class="line"><span class="keyword">for</span> k := <span class="number">0</span>; k &lt; cnt; k++ &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; cnt; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; cnt; j++ &#123;</span><br><span class="line">            <span class="comment">// é—®é¢˜å‡ºç°åœ¨è¿™é‡Œï¼</span></span><br><span class="line">            <span class="keyword">if</span> matrix[i][k] != <span class="number">0</span> &amp;&amp; matrix[k][j] != <span class="number">0</span> &amp;&amp; matrix[i][j] != <span class="number">0</span> &#123;</span><br><span class="line">                matrix[i][j] = matrix[i][k] * matrix[k][j]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯çš„æ ¹æœ¬åŸå› ï¼šä¸å¿…è¦çš„ <code>matrix[i][j] != 0</code> æ¡ä»¶</strong></p>
<p>è¿™ä¸ªå¤šä½™çš„æ¡ä»¶å¯¼è‡´ç®—æ³•åªåœ¨å·²å­˜åœ¨è·¯å¾„çš„æƒ…å†µä¸‹æ‰æ›´æ–°ï¼Œé”™è¿‡äº†è®¸å¤šå»ºç«‹æ–°è·¯å¾„çš„æœºä¼šã€‚</p>
<p><strong>å…·ä½“çš„é”™è¯¯åœºæ™¯</strong></p>
<p>ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹æš´éœ²äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">equations = [[&quot;b&quot;,&quot;a&quot;],[&quot;c&quot;,&quot;b&quot;],[&quot;d&quot;,&quot;c&quot;],...,[&quot;t&quot;,&quot;u&quot;]]  // 20ä¸ªè¿ç»­å…³ç³»</span><br><span class="line">values = [1e-05,1e-05,1e-05,...,1e-05]  // 20ä¸ªç›¸åŒçš„å°æ•°å€¼</span><br><span class="line">queries = [[&quot;a&quot;,&quot;u&quot;]]</span><br><span class="line"></span><br><span class="line">é¢„æœŸè¾“å‡ºï¼š[1.0]</span><br><span class="line">å®é™…è¾“å‡ºï¼š[0.99994]  // ç²¾åº¦ä¸¢å¤±</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯åˆ†æ</strong>ï¼š</p>
<ol>
<li>
<p><strong>è·¯å¾„å»ºç«‹å¤±è´¥</strong>ï¼šç”±äº <code>matrix[i][j] != 0</code> æ¡ä»¶ï¼Œç®—æ³•é”™è¿‡äº†é€šè¿‡ä¸­é—´èŠ‚ç‚¹å»ºç«‹æ–°è·¯å¾„çš„æœºä¼š</p>
</li>
<li>
<p><strong>ç²¾åº¦ç´¯ç§¯è¯¯å·®</strong>ï¼šç®—æ³•å¯èƒ½åœ¨ä¸åŒä¸­é—´èŠ‚ç‚¹é—´é‡å¤è®¡ç®—ï¼Œå¯¼è‡´æµ®ç‚¹è¿ç®—ç´¯ç§¯è¯¯å·®</p>
</li>
<li>
<p><strong>ç†è®ºvså®é™…</strong>ï¼šç†è®ºä¸Š <code>a/u</code> åº”è¯¥ç­‰äºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(1Ã—10^5)^20 Ã— (1Ã—10^-5)^20 = 1.0</span><br></pre></td></tr></table></figure>
<p>ä½†é”™è¯¯çš„æ¡ä»¶åˆ¤æ–­ç ´åäº†è¿™ä¸ªæ•°å­¦å…³ç³»</p>
</li>
</ol>
<p><strong>æ­£ç¡®çš„å®ç°æ–¹å¼</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®çš„Floydå®ç°</span></span><br><span class="line"><span class="keyword">for</span> k := <span class="number">0</span>; k &lt; n; k++ &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; n; j++ &#123;</span><br><span class="line">            <span class="comment">// å…³é”®ä¿®æ”¹ï¼šç§»é™¤å¤šä½™çš„æ¡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> dist[i][k] != <span class="number">-1.0</span> &amp;&amp; dist[k][j] != <span class="number">-1.0</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> dist[i][j] == <span class="number">-1.0</span> &#123;  <span class="comment">// åªåœ¨æ²¡æœ‰è·¯å¾„æ—¶å»ºç«‹æ–°è·¯å¾„</span></span><br><span class="line">                    dist[i][j] = dist[i][k] * dist[k][j]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¸ºä»€ä¹ˆæ­£ç¡®çš„å®ç°å¯ä»¥å·¥ä½œ</strong>ï¼š</p>
<ol>
<li><strong>ç§¯æè·¯å¾„å‘ç°</strong>ï¼šåªè¦é€šè¿‡kæœ‰è·¯å¾„å°±å°è¯•å»ºç«‹iåˆ°jçš„è¿æ¥</li>
<li><strong>é¿å…é‡å¤æ›´æ–°</strong>ï¼šåªåœ¨æ²¡æœ‰ç›´æ¥è·¯å¾„æ—¶æ‰å»ºç«‹æ–°è·¯å¾„</li>
<li><strong>æ•°å€¼ç¨³å®šæ€§</strong>ï¼šå‡å°‘äº†ä¸å¿…è¦çš„é‡å¤è®¡ç®—ï¼Œæé«˜äº†ç²¾åº¦</li>
</ol>
<p><strong>å­¦ä¹ è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>Floyd-Warshallç®—æ³•çš„æœ¬è´¨æ˜¯<strong>å°è¯•é€šè¿‡ä¸­é—´èŠ‚ç‚¹æ”¹è¿›è·¯å¾„</strong></li>
<li>ä¸è¦éšæ„æ·»åŠ &quot;çœ‹ä¼¼åˆç†&quot;çš„æ¡ä»¶åˆ¤æ–­</li>
<li>åœ¨æµ®ç‚¹è¿ç®—ä¸­è¦æ ¼å¤–æ³¨æ„ç´¯ç§¯è¯¯å·®çš„å½±å“</li>
<li>ç®—æ³•çš„æ­£ç¡®æ€§ä¸ä»…åœ¨äºæ ¸å¿ƒæ€æƒ³ï¼Œæ›´åœ¨äºå®ç°ç»†èŠ‚çš„å‡†ç¡®æ€§</li>
</ul>
<h2 id="ä¸¤ç§è§£æ³•çš„æ·±åº¦å¯¹æ¯”">ä¸¤ç§è§£æ³•çš„æ·±åº¦å¯¹æ¯”</h2>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>DFSè§£æ³•</th>
<th>Floydè§£æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>é¢„å¤„ç†æ—¶é—´</td>
<td>$O(N + E)$</td>
<td>$O(N^3)$</td>
</tr>
<tr>
<td>å•æ¬¡æŸ¥è¯¢</td>
<td>$O(N + E)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>æ€»æ—¶é—´å¤æ‚åº¦</td>
<td>$O(M \times (N + E))$</td>
<td>$O(N^3 + M)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(N + E)$</td>
<td>$O(N^2)$</td>
</tr>
</tbody>
</table>
<h3 id="é€‚ç”¨åœºæ™¯åˆ†æ">é€‚ç”¨åœºæ™¯åˆ†æ</h3>
<p><strong>DFSè§£æ³•é€‚åˆ</strong>ï¼š</p>
<ul>
<li>å˜é‡æ•°é‡è¾ƒå¤šï¼Œä½†æŸ¥è¯¢è¾ƒå°‘çš„æƒ…å†µ</li>
<li>å›¾æ¯”è¾ƒç¨€ç–çš„æƒ…å†µ</li>
<li>å†…å­˜å—é™çš„æƒ…å†µ</li>
</ul>
<p><strong>Floydè§£æ³•é€‚åˆ</strong>ï¼š</p>
<ul>
<li>å˜é‡æ•°é‡ä¸å¤šï¼ˆN â‰¤ 100ï¼‰ï¼Œä½†æŸ¥è¯¢é¢‘ç¹</li>
<li>éœ€è¦é¢„è®¡ç®—æ‰€æœ‰å¯èƒ½ç»“æœçš„æƒ…å†µ</li>
<li>ä»£ç ç®€æ´æ€§è¦æ±‚é«˜çš„åœºåˆ</li>
</ul>
<h3 id="ä»£ç å¯è¯»æ€§å¯¹æ¯”">ä»£ç å¯è¯»æ€§å¯¹æ¯”</h3>
<p>ä»ä»£ç å¯è¯»æ€§æ¥è¯´ï¼ŒFloydç®—æ³•æ˜æ˜¾æ›´èƒœä¸€ç­¹ï¼š</p>
<ol>
<li><strong>é€»è¾‘æ¸…æ™°</strong>ï¼šæ ¸å¿ƒå°±æ˜¯ä¸‰é‡å¾ªç¯ï¼Œç»å…¸ç®—æ³•æ¨¡æ¿</li>
<li><strong>æ˜“äºè°ƒè¯•</strong>ï¼šå¯ä»¥ç›´æ¥è§‚å¯Ÿè·ç¦»çŸ©é˜µçš„å˜åŒ–</li>
<li><strong>æ•°å­¦ç¾æ„Ÿ</strong>ï¼šåŠ æ³•â†’ä¹˜æ³•çš„è½¬æ¢ä½“ç°äº†ç®—æ³•çš„é€‚åº”æ€§</li>
</ol>
<h2 id="æ·±å…¥æ€è€ƒï¼šç®—æ³•è®¾è®¡çš„è‰ºæœ¯">æ·±å…¥æ€è€ƒï¼šç®—æ³•è®¾è®¡çš„è‰ºæœ¯</h2>
<p>è¿™é“é¢˜ç»™æˆ‘æœ€å¤§çš„æ”¶è·ä¸æ˜¯å…·ä½“çš„è§£æ³•ï¼Œè€Œæ˜¯å¯¹<strong>ç®—æ³•é€‚åº”æ€§</strong>çš„æ·±å…¥ç†è§£ã€‚</p>
<h3 id="ç»å…¸ç®—æ³•çš„æ–°åº”ç”¨">ç»å…¸ç®—æ³•çš„æ–°åº”ç”¨</h3>
<p>Floyd-Warshallç®—æ³•æœ€åˆæ˜¯ä¸ºäº†è§£å†³æœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œæ ¸å¿ƒæ“ä½œæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">distance = min(current_distance, path1 + path2)</span><br></pre></td></tr></table></figure>
<p>ä½†åœ¨é™¤æ³•æ±‚å€¼é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å·§å¦™åœ°å°†å…¶è½¬æ¢ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ratio = path1 Ã— path2  (å¦‚æœè·¯å¾„å­˜åœ¨)</span><br></pre></td></tr></table></figure>
<p>è¿™ç§è½¬æ¢ä¸æ˜¯ç®€å•çš„æ›¿æ¢ï¼Œè€Œæ˜¯å¯¹ç®—æ³•æœ¬è´¨çš„æ·±åˆ»ç†è§£ï¼š</p>
<ul>
<li><strong>Floydç®—æ³•çš„æœ¬è´¨</strong>ï¼šé€šè¿‡ä¸­é—´èŠ‚ç‚¹å»ºç«‹è¿æ¥</li>
<li><strong>å…³é”®é€‚åº”</strong>ï¼šå°†&quot;è·ç¦»ç›¸åŠ &quot;æ”¹ä¸º&quot;æ¯”ç‡ç›¸ä¹˜&quot;</li>
<li><strong>æ•°å­¦åŸºç¡€</strong>ï¼šé™¤æ³•çš„ä¼ é€’æ€§</li>
</ul>
<h3 id="é—®é¢˜æŠ½è±¡çš„é‡è¦æ€§">é—®é¢˜æŠ½è±¡çš„é‡è¦æ€§</h3>
<p>è¿™é“é¢˜è¿˜å±•ç¤ºäº†<strong>é—®é¢˜æŠ½è±¡</strong>çš„é‡è¦æ€§ï¼š</p>
<ol>
<li><strong>è¡¨é¢é—®é¢˜</strong>ï¼šè®¡ç®—é™¤æ³•è¡¨è¾¾å¼</li>
<li><strong>æŠ½è±¡åçš„é—®é¢˜</strong>ï¼šåœ¨æœ‰å‘åŠ æƒå›¾ä¸­è®¡ç®—è·¯å¾„æƒé‡ä¹˜ç§¯</li>
<li><strong>è¿›ä¸€æ­¥æŠ½è±¡</strong>ï¼šä¼ é€’é—­åŒ…çš„è®¡ç®—é—®é¢˜</li>
</ol>
<p>æ­£ç¡®çš„æŠ½è±¡è®©æˆ‘ä»¬èƒ½å¤Ÿè¿ç”¨å·²æœ‰çš„ç®—æ³•çŸ¥è¯†ï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹è®¾è®¡è§£æ³•ã€‚</p>
<h2 id="å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</h2>
<p>é™¤äº†ç®—æ³•é¢˜ï¼Œè¿™ç§æ€è·¯åœ¨å®é™…å¼€å‘ä¸­ä¹Ÿå¾ˆæœ‰ç”¨ï¼š</p>
<h3 id="è´§å¸æ±‡ç‡è½¬æ¢">è´§å¸æ±‡ç‡è½¬æ¢</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœçŸ¥é“ USD/CNY = 7.0, CNY/EUR = 0.14</span></span><br><span class="line"><span class="comment">// å°±èƒ½è®¡ç®—å‡º USD/EUR = 7.0 Ã— 0.14 = 0.98</span></span><br></pre></td></tr></table></figure>
<h3 id="å•ä½æ¢ç®—ç³»ç»Ÿ">å•ä½æ¢ç®—ç³»ç»Ÿ</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é•¿åº¦å•ä½ï¼šç±³â†’å˜ç±³â†’æ¯«ç±³</span></span><br><span class="line"><span class="comment">// 1ç±³ = 100å˜ç±³, 1å˜ç±³ = 10æ¯«ç±³</span></span><br><span class="line"><span class="comment">// å› æ­¤ 1ç±³ = 1000æ¯«ç±³</span></span><br></pre></td></tr></table></figure>
<h3 id="ç½‘ç»œæ‹“æ‰‘åˆ†æ">ç½‘ç»œæ‹“æ‰‘åˆ†æ</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç½‘ç»œèŠ‚ç‚¹é—´çš„ä¼ è¾“å»¶è¿Ÿæ¯”ä¾‹</span></span><br><span class="line"><span class="comment">// å¯ä»¥ç”¨ç±»ä¼¼æ–¹æ³•è®¡ç®—ç«¯åˆ°ç«¯çš„æ€§èƒ½æŒ‡æ ‡</span></span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“ï¼šç®—æ³•æ€ç»´çš„æå‡">æ€»ç»“ï¼šç®—æ³•æ€ç»´çš„æå‡</h2>
<p>é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°äº†ç®—æ³•å­¦ä¹ çš„å‡ ä¸ªå±‚æ¬¡ï¼š</p>
<ol>
<li><strong>åŸºç¡€å±‚</strong>ï¼šçŸ¥é“æŸä¸ªç®—æ³•æ€ä¹ˆå†™</li>
<li><strong>åº”ç”¨å±‚</strong>ï¼šçŸ¥é“åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨æŸä¸ªç®—æ³•</li>
<li><strong>åˆ›æ–°å±‚</strong>ï¼šèƒ½å¤Ÿæ”¹é€ ç»å…¸ç®—æ³•è§£å†³æ–°é—®é¢˜</li>
<li><strong>è®¾è®¡å±‚</strong>ï¼šèƒ½å¤ŸæŠ½è±¡é—®é¢˜æœ¬è´¨ï¼Œé€‰æ‹©æœ€ä¼˜è§£æ³•</li>
</ol>
<p>Floydç®—æ³•çš„é™¤æ³•åº”ç”¨å®Œç¾ä½“ç°äº†ç¬¬ä¸‰å±‚çš„èƒ½åŠ›ã€‚å®ƒä¸æ˜¯ç®€å•çš„ç®—æ³•å¥—ç”¨ï¼Œè€Œæ˜¯åœ¨ç†è§£ç®—æ³•æœ¬è´¨çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œåˆ›é€ æ€§çš„æ”¹è¿›ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ç§æ€ç»´æ–¹å¼å¯ä»¥æ¨å¹¿åˆ°å…¶ä»–é—®é¢˜ï¼š</p>
<ul>
<li>å½“é‡åˆ°æ–°é—®é¢˜æ—¶ï¼Œé¦–å…ˆæ€è€ƒå®ƒçš„æœ¬è´¨æ˜¯ä»€ä¹ˆ</li>
<li>æ˜¯å¦å¯ä»¥æŠ½è±¡ä¸ºå·²çŸ¥çš„ç»å…¸é—®é¢˜</li>
<li>å¦‚æœä¸å®Œå…¨åŒ¹é…ï¼Œèƒ½å¦é€šè¿‡å·§å¦™çš„è½¬æ¢æ¥é€‚åº”</li>
</ul>
<p>è¿™å°±æ˜¯ç®—æ³•å­¦ä¹ çš„çœŸæ­£ä»·å€¼ï¼šä¸æ˜¯è®°ä½å¤šå°‘ä¸ªç®—æ³•æ¨¡æ¿ï¼Œè€Œæ˜¯åŸ¹å…»è§£å†³é—®é¢˜çš„æ€ç»´æ–¹å¼ã€‚è€ŒLeetCode 399è¿™é“é™¤æ³•æ±‚å€¼é—®é¢˜ï¼Œæ­£æ˜¯è¿™ç§æ€ç»´è®­ç»ƒçš„ç»ä½³æ¡ˆä¾‹ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›¾è®º</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>å›¾è®º</tag>
        <tag>Floyd-Warshall</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡½å²©èµ„äº§ Golangåç«¯å¼€å‘å®ä¹ ç”Ÿ ä¸€é¢</title>
    <url>/2025/06/22/%E9%9D%A2%E8%AF%95%E9%A2%98/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E5%8E%82/%E9%A1%BD%E5%B2%A9%E8%B5%84%E4%BA%A7/2025-02-17-%E9%A1%BD%E5%B2%A9%E8%B5%84%E4%BA%A7-Golang%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%AE%9E%E4%B9%A0%E7%94%9F-%E4%B8%80%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="é¢è¯•åŸºæœ¬ä¿¡æ¯">é¢è¯•åŸºæœ¬ä¿¡æ¯</h2>
<ul>
<li><strong>å…¬å¸</strong>: é¡½å²©èµ„äº§ï¼ˆé‡‘èç§‘æŠ€å…¬å¸ï¼‰</li>
<li><strong>èŒä½</strong>: Golangåç«¯å¼€å‘å®ä¹ ç”Ÿ</li>
<li><strong>é¢è¯•è½®æ¬¡</strong>: ä¸€é¢ï¼ˆæŠ€æœ¯é¢ï¼‰</li>
<li><strong>é¢è¯•å½¢å¼</strong>: åœ¨çº¿è¯­éŸ³é¢è¯•</li>
<li><strong>é¢è¯•æ—¶é•¿</strong>: çº¦47åˆ†é’Ÿ</li>
<li><strong>é¢è¯•å®˜</strong>: æŠ€æœ¯é¢è¯•å®˜ï¼ˆè´Ÿè´£æœºå™¨å­¦ä¹ å¹³å°å¼€å‘ï¼‰</li>
</ul>
<h2 id="é¢è¯•é—®é¢˜ä¸å›ç­”">é¢è¯•é—®é¢˜ä¸å›ç­”</h2>
<h3 id="é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»">é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå…ˆè‡ªæˆ‘ä»‹ç»ä¸€ä¸‹â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä½ å¥½ï¼Œæˆ‘æ˜¯ç‹å®‡å“²ï¼Œç°åœ¨æ˜¯åä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹å­¦é™¢çš„ç ”ç©¶ç”Ÿï¼Œä¸»è¦ç ”ç©¶æ–¹å‘æ˜¯å¯†ç å­¦æ–¹å‘ã€‚æˆ‘ä¹‹å‰æœ¬ç§‘æœŸé—´è·å¾—è¿‡å›½å®¶å¥–å­¦é‡‘ä»¥åŠè“æ¡¥æ¯å›½èµ›äºŒç­‰å¥–è¿™ç±»å¥–é¡¹ã€‚ç„¶åæˆ‘ç°åœ¨ä¸»è¦æŠ€æœ¯æ ˆåœ¨äºGoè¯­è¨€ã€‚Goçš„è¯ä¸»è¦åšäº†ä¸¤ä¸ªé¡¹ç›®ã€‚ç¬¬ä¸€ä¸ªé¡¹ç›®æ˜¯å«æŠ–éŸ³å•†åŸï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¾®æœåŠ¡ï¼ŒåŸºäºGoåŠ gRPCçš„å¾®æœåŠ¡æ¶æ„çš„ä¸€ä¸ªæ¡†æ¶ï¼Œä¸€ä¸ªå•†åŸç³»ç»Ÿã€‚ç„¶åç»“åˆäº†ä¸€äº›å¯è§‚æµ‹æ€§ä¹‹ç±»çš„ï¼Œè¿˜æœ‰æ¶ˆæ¯é˜Ÿåˆ—redisä¹‹ç±»çš„æŠ€æœ¯æ ˆã€‚è¿˜æœ‰ä¸€ä¸ªçš„è¯æ˜¯å«ANXï¼Œæ˜¯æˆ‘è‡ªå·±å­¦ä¹ é˜¶æ®µçš„æ—¶å€™ï¼Œè‡ªå·±åšäº†ä¸€ä¸ªå«AIå¤šä»£ç†ï¼Œå°±æ˜¯åˆ†å¸ƒå¼AIå¤šä»£ç†æ¶æ„çš„ä¸€ä¸ªç›¸å½“äºè®©AIæ¥è¿›è¡Œå¾®æœåŠ¡è°ƒç”¨çš„ä¸€ä¸ªæ¡†æ¶ã€‚ç„¶åæˆ‘ä¹‹å‰å®ä¹ çš„è¯æ˜¯åœ¨ä¸šå†…åä¼å®ä¹ çš„ï¼Œä¸»è¦çš„å®ä¹ æœŸé—´å·¥ä½œå°±æ˜¯å‚ä¸CMSç³»ç»Ÿçš„å¼€å‘ï¼Œä»¥åŠä¸€äº›æ—¥å¸¸ç»´æŠ¤å·¥ä½œã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å…¶å®å¯ä»¥è¿™æ ·ç»„ç»‡ä¼šæ›´å¥½ï¼š</p>
<p>&quot;æ‚¨å¥½ï¼Œæˆ‘æ˜¯ç‹å®‡å“²ï¼Œåä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹å­¦é™¢ç ”ç©¶ç”Ÿï¼Œä¸“ä¸šæ–¹å‘æ˜¯å¯†ç å­¦ã€‚åœ¨æŠ€æœ¯æ–¹é¢ï¼Œæˆ‘ä¸»è¦ä¸“æ³¨äºGoè¯­è¨€åç«¯å¼€å‘ï¼Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„é¡¹ç›®ç»å†ï¼š</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯æŠ–éŸ³å•†åŸé¡¹ç›®ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºGo+gRPCçš„åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œæˆ‘åœ¨å…¶ä¸­è´Ÿè´£äº†APIç½‘å…³è®¾è®¡ã€æƒé™ç®¡ç†ã€é»‘åå•åŠŸèƒ½ç­‰æ ¸å¿ƒæ¨¡å—ï¼Œè¿˜æ¥å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—ã€å¯è§‚æµ‹æ€§ç­‰æŠ€æœ¯ã€‚</p>
<p>ç¬¬äºŒä¸ªæ˜¯ANXé¡¹ç›®ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ›æ–°æ€§çš„AIå¤šä»£ç†åˆ†å¸ƒå¼æ¶æ„ï¼Œé€šè¿‡åˆ†å±‚AIè®¾è®¡è®©AIèƒ½å¤Ÿç²¾å‡†è°ƒç”¨å¾®æœåŠ¡ï¼Œæˆ‘åœ¨å…¶ä¸­è§£å†³äº†æµå¼AIå‡½æ•°è°ƒç”¨æ‹¼æ¥ç­‰æŠ€æœ¯éš¾ç‚¹ã€‚</p>
<p>å®ä¹ æ–¹é¢ï¼Œæˆ‘åœ¨æŸå…¬å¸å‚ä¸äº†CMSç³»ç»Ÿå¼€å‘ï¼Œä½¿ç”¨PHPæŠ€æœ¯æ ˆï¼Œä¸»è¦è´Ÿè´£å®˜ç½‘é‡æ„å’Œæ¨¡æ¿æ¸²æŸ“ä¼˜åŒ–ã€‚</p>
<p>åœ¨å­¦æœ¯æ–¹é¢ï¼Œæˆ‘çš„ç ”ç©¶æ–¹å‘æ˜¯å¯æœç´¢åŠ å¯†ï¼Œä¸»è¦å…³æ³¨æ¨¡ç³Šæœç´¢ç›¸å…³çš„æ•°æ®åº“æŠ€æœ¯ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å›ç­”æ¶µç›–äº†åŸºæœ¬ä¿¡æ¯ï¼Œä½†å¯ä»¥æ›´æœ‰é€»è¾‘æ€§</li>
<li>é¢è¯•å®˜æ¯”è¾ƒå…³æ³¨æŠ€æœ¯é¡¹ç›®ï¼Œåç»­ä¸»è¦å›´ç»•é¡¹ç›®å±•å¼€</li>
</ul>
<h3 id="é—®é¢˜2ï¼šå®ä¹ é¡¹ç›®çš„æŠ€æœ¯é€‰å‹">é—®é¢˜2ï¼šå®ä¹ é¡¹ç›®çš„æŠ€æœ¯é€‰å‹</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå®ä¹ çš„æ—¶å€™ç”¨çš„ä¸æ˜¯Goå§ï¼Ÿç°åœ¨è¿˜æœ‰ç³»ç»Ÿåœ¨ç”¨PHPï¼Œä»–ä»¬æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ—©çš„ç³»ç»Ÿå—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä»–ä¹Ÿä¸æ˜¯å¾ˆå¤æ—©ï¼Œä½†æ˜¯å½“æ—¶å°±æ˜¯å› ä¸ºä»–ä»¬å®˜ç½‘ï¼Œå› ä¸ºä¸€å¼€å§‹å®ƒæ˜¯çº¯é™æ€é¡µé¢çš„ï¼Œåé¢çš„è¯å°±æ˜¯åŠ æˆ‘è¿›å»ï¼Œå› ä¸ºä»–ä»¬å®˜ç½‘çš„è¯ç»´æŠ¤æˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œå› ä¸ºå®ƒéšç€æ–°é—»å°±è¶Šæ¥è¶Šå¤šï¼Œå› ä¸ºä»–ä»¬å…¬å¸ä¸»è¦ä¸šåŠ¡ä¹Ÿä¸æ˜¯åœ¨ITä¸Šé¢ï¼Œæ‰€ä»¥ITä¸Šé¢æ²¡æœ‰èŠ±å¾ˆå¤šåŠŸå¤«ã€‚ç„¶åæˆ‘å°±æ˜¯è´Ÿè´£ä»–ä»¬å®˜ç½‘ï¼Œå½“æ—¶æ˜¯è®©æˆ‘å»å†™é™æ€é¡µé¢ï¼Œç„¶åæˆ‘å°±æƒ³ç€æ—¢ç„¶éƒ½è¦å†™é™æ€é¡µé¢ï¼Œè¦ä¸æŠŠæ•´ä¸ªç³»ç»Ÿé‡æ„ä¸€ä¸‹ï¼Œç»™ä»–ç›´æ¥å°±æ˜¯è®©ä»–ä»¬å¯ä»¥åå°ç®¡ç†ï¼Œè¿™æ ·çš„è¯ä¸æ˜¯çœäº†å¼€å‘çš„å¤§é‡çš„æ—¶é—´å—ï¼Ÿç„¶åæˆ‘ä»¬ä¹Ÿå°±è®©æˆ‘å»ç»„ç»‡è¿™ä¸ªï¼Œä½†æ˜¯ä»–ç»™æˆ‘è¦æ±‚å°±æ˜¯è¦å°½å¿«å®Œæˆã€‚æ‰€ä»¥è¯´ä¸ºäº†å¿«çš„è¯ï¼Œæˆ‘å°±é€‰æ‹©äº†æš‚æ—¶å…ˆç”¨PHPå»å®ç°å®ƒã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å…¶å®å¯ä»¥è¿™æ ·è§£é‡ŠæŠ€æœ¯é€‰å‹çš„è€ƒè™‘ï¼š</p>
<p>&quot;ç¡®å®ç”¨çš„æ˜¯PHPï¼Œä¸»è¦æ˜¯åŸºäºä¸šåŠ¡éœ€æ±‚å’Œæ—¶é—´æˆæœ¬è€ƒè™‘çš„ã€‚å½“æ—¶å…¬å¸å®˜ç½‘æ˜¯çº¯é™æ€é¡µé¢ï¼Œéšç€å†…å®¹å¢å¤šç»´æŠ¤æˆæœ¬å¾ˆé«˜ï¼Œæˆ‘æå‡ºäº†é‡æ„æ–¹æ¡ˆï¼Œå°†å…¶æ”¹é€ ä¸ºå¯åå°ç®¡ç†çš„CMSç³»ç»Ÿã€‚</p>
<p>é€‰æ‹©PHPä¸»è¦æœ‰å‡ ä¸ªåŸå› ï¼šé¦–å…ˆæ˜¯æ—¶é—´è¦æ±‚ç´§è¿«ï¼Œéœ€è¦å¿«é€Ÿäº¤ä»˜ï¼›å…¶æ¬¡PHPåœ¨Webå¼€å‘æ–¹é¢ç”Ÿæ€æˆç†Ÿï¼Œç‰¹åˆ«æ˜¯æ¨¡æ¿æ¸²æŸ“è¿™å—æœ‰å¾ˆå¤šç°æˆçš„è½®å­å¯ä»¥ç”¨ï¼›æœ€åè€ƒè™‘åˆ°å›¢é˜Ÿç»´æŠ¤æˆæœ¬ï¼ŒPHPç›¸å¯¹æ¥è¯´å­¦ä¹ æˆæœ¬è¾ƒä½ã€‚</p>
<p>ä¸è¿‡åœ¨å…·ä½“å®ç°ä¸Šï¼Œæˆ‘è¿˜æ˜¯åšäº†ä¸€äº›æŠ€æœ¯ä¼˜åŒ–ï¼Œæ¯”å¦‚è®¾è®¡äº†æ¨¡æ¿ç¼“å­˜æœºåˆ¶ï¼Œé€šè¿‡å“ˆå¸Œå€¼ç®¡ç†é™æ€é¡µé¢ç¼“å­˜ï¼Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°æ¸²æŸ“ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å›ç­”è§£é‡Šäº†èƒŒæ™¯ï¼Œä½†æŠ€æœ¯é€‰å‹çš„é€»è¾‘å¯ä»¥æ›´æ¸…æ™°</li>
<li>é¢è¯•å®˜å…³æ³¨æŠ€æœ¯é€‰å‹çš„åˆç†æ€§</li>
</ul>
<h3 id="é—®é¢˜3ï¼šæŠ–éŸ³å•†åŸé¡¹ç›®æ¶æ„è®¾è®¡">é—®é¢˜3ï¼šæŠ–éŸ³å•†åŸé¡¹ç›®æ¶æ„è®¾è®¡</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä»‹ç»ä¸€ä¸‹æŠ–éŸ³å•†åŸè¿™ä¸ªé¡¹ç›®â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæŠ–éŸ³å•†åŸè¿™ä¸ªé¡¹ç›®å®ƒæ˜¯ä¸€ä¸ªåŒ…å«åŸºæœ¬ä¸šåŠ¡çš„ä¸€ä¸ªå•†åŸç³»ç»Ÿã€‚æŠ€æœ¯æ ˆè®¾è®¡çš„è¯æ˜¯ä½¿ç”¨äº†GoåŠ gRPCï¼Œæˆ‘ä¸“é—¨è®¾è®¡äº†ä¸€ä¸ªç±»ä¼¼äºAPIç½‘å…³çš„ä¸€ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯å«frontendå¾®æœåŠ¡ã€‚å®ƒåªç›´æ¥ä¸å‰ç«¯è¿›è¡Œäº¤äº’çš„ï¼Œç›¸å½“äºå®ƒæ˜¯è¿›è¡Œè¯·æ±‚è½¬å‘çš„ï¼Œç„¶åä»¥åŠå»è°ƒç”¨åå°çš„å„ç§gRPCæœåŠ¡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜è´Ÿè´£æŠŠå‰ç«¯çš„tokenè½¬åŒ–ç›´æ¥è½¬åŒ–ä¸ºuser IDï¼Œä»¥æ–¹ä¾¿åé¢çš„gRPCå¾®æœåŠ¡å»è°ƒç”¨ã€‚å› ä¸ºgRPCå®ƒåŸºæœ¬ä¸Šä¸€èˆ¬æ¥è¯´æ˜¯éƒ¨ç½²åœ¨å†…ç½‘çš„å®‰å…¨çš„ç¯å¢ƒçš„ã€‚æ‰€ä»¥è¯´ä¸éœ€è¦æ¯ä¸ªå¾®æœåŠ¡å®ƒéƒ½è¦å»è§£æä¸€ä¸‹tokenã€‚å› ä¸ºè¿™æ ·ä¼šå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ã€‚æ‰€ä»¥è¯´æˆ‘ç›´æ¥è®©frontendå»è§£æå®Œä»¥åï¼Œä¸¢ç»™åå°åé¢çš„å‡ ä¸ªå¾®æœåŠ¡ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å¯ä»¥è¿™æ ·æ›´ç³»ç»Ÿåœ°ä»‹ç»æ¶æ„è®¾è®¡ï¼š</p>
<p>&quot;æŠ–éŸ³å•†åŸæ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”µå•†ç³»ç»Ÿï¼Œé‡‡ç”¨Go+gRPCçš„å¾®æœåŠ¡æ¶æ„ã€‚æ•´ä½“æ¶æ„åˆ†ä¸ºå‡ ä¸ªå±‚æ¬¡ï¼š</p>
<p>é¦–å…ˆæ˜¯APIç½‘å…³å±‚ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ªfrontendå¾®æœåŠ¡ä½œä¸ºç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£å‡ ä¸ªå…³é”®åŠŸèƒ½ï¼šä¸€æ˜¯è¯·æ±‚è·¯ç”±å’Œè½¬å‘ï¼ŒäºŒæ˜¯tokenè§£æå’Œç”¨æˆ·èº«ä»½è½¬æ¢ï¼Œä¸‰æ˜¯ç»Ÿä¸€çš„æƒé™æ§åˆ¶å’Œé»‘åå•ç®¡ç†ã€‚</p>
<p>è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œåç«¯çš„gRPCå¾®æœåŠ¡å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦é‡å¤å¤„ç†è®¤è¯æˆæƒï¼Œæé«˜äº†å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p>åœ¨æƒé™ç®¡ç†ä¸Šï¼Œæˆ‘é›†æˆäº†casbinï¼Œå¹¶ä¸”å®ç°äº†æ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥æ‰¹é‡ç®¡ç†è·¯ç”±æƒé™ï¼Œæ¯”å¦‚/user/*ä¸‹çš„æ‰€æœ‰å­è·¯å¾„å¯ä»¥ç”¨ä¸€ä¸ªè§„åˆ™ç»Ÿä¸€ç®¡ç†ã€‚</p>
<p>é»‘åå•åŠŸèƒ½é‡‡ç”¨äº†Redis+MySQLçš„è®¾è®¡ï¼ŒçŸ­æœŸå°ç¦æ”¾Redisï¼Œé•¿æœŸå°ç¦å­˜MySQLï¼Œè¿™æ ·æ—¢ä¿è¯äº†æŸ¥è¯¢æ€§èƒ½ï¼Œåˆæ§åˆ¶äº†å†…å­˜ä½¿ç”¨ã€‚</p>
<p>ç›®å‰æ­£åœ¨ä¼˜åŒ–çš„æ˜¯å•†å“æœç´¢åŠŸèƒ½ï¼Œé€šè¿‡ç›‘å¬MySQLçš„binlogï¼Œå®æ—¶åŒæ­¥æ•°æ®åˆ°Elasticsearchï¼Œä¿è¯æœç´¢æ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>ä»‹ç»äº†æ ¸å¿ƒæ¶æ„ï¼Œä½†å¯ä»¥æ›´çªå‡ºè®¾è®¡äº®ç‚¹</li>
<li>é¢è¯•å®˜å¯¹binlogç›‘å¬æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œè¿›è¡Œäº†æ·±å…¥è¿½é—®</li>
</ul>
<h3 id="é—®é¢˜4ï¼šMySQL-binlogç›‘å¬çš„æ›¿ä»£æ–¹æ¡ˆ">é—®é¢˜4ï¼šMySQL binlogç›‘å¬çš„æ›¿ä»£æ–¹æ¡ˆ</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä¸ºä»€ä¹ˆè¦ç”¨åˆ°MySQLçš„binlogï¼Ÿåœ¨äº’è”ç½‘å…¬å¸é‡Œï¼Œå¯èƒ½è¿™ä¸ªbinlogçš„æƒé™ä¸å¯¹ç ”å‘å¼€æ”¾ã€‚æ‰€ä»¥æœ‰æ²¡æœ‰å…¶ä»–çš„æ›¿ä»£å½¢å¼å‘¢ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œå…¶ä»–æ›¿ä»£å½¢å¼çš„è¯å°±æ˜¯åœ¨ä»£ç é‡Œé¢åµŒå…¥ä¸€äº›ã€‚å°±æ¯”å¦‚è¯´ä½ ç›´æ¥å»ï¼Œæ¯æ¬¡æ’å…¥çš„æ—¶å€™éƒ½ç»™å®ƒæ”¾ESä¹Ÿæ’å…¥ä¸€ä¸‹ã€‚æˆ–è€…è¯´ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¼ é€’ç»™åå°ä¸“é—¨ç»´æŠ¤ESçš„é‚£ä¸ªå¾®æœåŠ¡ï¼Œç„¶åè®©ä»–å»åŒæ­¥ä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–¹æ¡ˆã€‚ä½†æ˜¯è¿™ç§æ–¹æ¡ˆçš„è¯ï¼Œå®ƒæœ€å¤§çš„é—®é¢˜å…¶å®å°±æ˜¯åœ¨äºä»£ç åµŒå…¥å¤ªå¤§äº†ï¼Œå¯èƒ½ä¼šå¯¹å¼€å‘é€ æˆå¾ˆå¤§çš„å¼€å‘å±‚é¢ä¸Šæ¥è¯´ä¼šæœ‰å¾ˆå¤šçš„å·¥ä½œé‡ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé—®é¢˜é—®å¾—å¾ˆå¥½ï¼Œç¡®å®åœ¨å®é™…å·¥ä½œä¸­binlogæƒé™æ˜¯ä¸ªé—®é¢˜ã€‚æ›¿ä»£æ–¹æ¡ˆæœ‰å‡ ç§ï¼š</p>
<p>ç¬¬ä¸€ç§æ˜¯ä»£ç å±‚é¢çš„åŒå†™ï¼Œå°±æ˜¯åœ¨ä¸šåŠ¡ä»£ç ä¸­åŒæ—¶å†™MySQLå’ŒESã€‚ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯ä»£ç ä¾µå…¥æ€§å¼ºï¼Œè€Œä¸”å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦ï¼Œä¸šåŠ¡ä»£ç å†™å®ŒMySQLåå‘é€æ¶ˆæ¯ï¼Œç”±ä¸“é—¨çš„æ¶ˆè´¹è€…è´Ÿè´£åŒæ­¥ESã€‚è¿™æ ·é™ä½äº†ä»£ç ä¾µå…¥æ€§ï¼Œä½†å¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦ã€‚</p>
<p>ç¬¬ä¸‰ç§æ˜¯ä½¿ç”¨æ•°æ®åº“çš„è§¦å‘å™¨æˆ–è€…å­˜å‚¨è¿‡ç¨‹ï¼Œåœ¨æ•°æ®å˜æ›´æ—¶è‡ªåŠ¨å‘é€åŒæ­¥ä¿¡å·ã€‚</p>
<p>ç¬¬å››ç§æ˜¯é‡‡ç”¨CDCï¼ˆChange Data Captureï¼‰å·¥å…·ï¼Œæ¯”å¦‚Debeziumï¼Œå®ƒå¯ä»¥ç›‘å¬æ•°æ®åº“å˜æ›´å¹¶æ¨é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘è§‰å¾—æ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆæ˜¯æ¯”è¾ƒå¥½çš„å¹³è¡¡ï¼Œæ—¢ä¿è¯äº†ä»£ç çš„æ¸…æ´ï¼Œåˆæœ‰è¾ƒå¥½çš„å¯é æ€§ã€‚è‡³äºé€‰æ‹©å“ªç§æ–¹æ¡ˆï¼Œä¸»è¦çœ‹å…¬å¸çš„æŠ€æœ¯æ ˆå’Œæƒé™ç®¡ç†ç­–ç•¥ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å›ç­”äº†æ›¿ä»£æ–¹æ¡ˆï¼Œä½†æ²¡æœ‰æ·±å…¥åˆ†æå„ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹</li>
<li>é¢è¯•å®˜çš„é—®é¢˜å¾ˆå®é™…ï¼Œä½“ç°äº†å·¥ç¨‹ç»éªŒ</li>
</ul>
<h3 id="é—®é¢˜5ï¼šAIå¤šä»£ç†é¡¹ç›®çš„æ¶æ„è®¾è®¡">é—®é¢˜5ï¼šAIå¤šä»£ç†é¡¹ç›®çš„æ¶æ„è®¾è®¡</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œAIGCçš„é‚£ä¸ªé¡¹ç›®ï¼Œä½ é‡Œé¢å†™çš„ä¸»è¦éƒ½æ˜¯è·ŸgRPCå’Œå¾®æœåŠ¡æ¶æ„æœ‰å…³çš„ï¼Œä»‹ç»ä¸€ä¸‹æ€»ä½“æ€è·¯â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä»–è¿™ä¸ªæ•´ä½“çš„ç›®çš„å°±æ˜¯ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæŒ‡ä»¤ï¼Œç„¶åé€šè¿‡AIä»–ä¼šå»è§£æè¿™ä¸ªæŒ‡ä»¤ï¼Œç„¶åå»è°ƒç”¨ç›¸å…³çš„å¾®æœåŠ¡ã€‚ä½†æ˜¯å½“æ—¶è®¾è®¡æ¶æ„ä¹‹åˆçš„æ—¶å€™ï¼Œè€ƒè™‘åˆ°å…¶å®æ¯ä¸€ä¸ªAIçš„ä¸Šä¸‹æ–‡æ˜¯æœ‰é™çš„ã€‚æ‰€ä»¥è¯´ä»–å¯èƒ½æ²¡æœ‰åŠæ³•ï¼Œå¦‚æœä»–è¦ç®¡ç†çš„é‚£ä¸ªå‡½æ•°åˆ—è¡¨å¤ªå¤šçš„è¯ï¼Œä»–å¯èƒ½ç²¾å‡†åº¦å°±ä¼šç›¸åº”çš„ä¸‹æ¥ã€‚æ‰€ä»¥è¯´å°±è°ƒç”¨çš„ç²¾å‡†åº¦ä¼šä¸‹æ¥ã€‚æ‰€ä»¥è¯´æˆ‘å°±æƒ³åˆ°ç”¨ä¸€ä¸ªåˆ†å±‚çš„ä¸€ç§æ¶æ„æ¥å®ç°ã€‚å°±æ¯”å¦‚è¯´ä»–æœ‰ä¸ªä¸»AIï¼Œä¸»AIä»–ä¸çŸ¥é“æ¯ä¸ªå¾®æœåŠ¡ä¸­å®ƒå…·ä½“æœ‰å“ªäº›å‡½æ•°ï¼Œä½†æ˜¯ä»–çŸ¥é“æœ‰å“ªäº›å¾®æœåŠ¡ã€‚ç„¶åä»–å»åˆ¤æ–­ç”¨æˆ·çš„è¿™ä¸ªè¯·æ±‚è¦äº¤ç»™å“ªäº›å¾®æœåŠ¡å»æ‰§è¡Œã€‚ç„¶åä»–ä¼šæŠŠè¿™ä¸ªè¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„å¾®æœåŠ¡ï¼Œæ¯ä¸ªå¯¹åº”çš„å¾®æœåŠ¡å‰é¢å®ƒéƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„AIï¼Œè¿™ä¸ªAIä»–åªç®¡ç†è¿™ä¸ªå¾®æœåŠ¡ä¸­æ‰€æœ‰çš„å‡½æ•°åˆ—è¡¨ã€‚è¿™æ ·çš„è¯ä»–å°±å¯ä»¥æ ¹æ®ä¸»AIçš„è¦æ±‚ä»¥åŠç”¨æˆ·çš„è¦æ±‚å»å†³å®šå»è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œç„¶åå»å¡«å……å“ªäº›å‚æ•°ï¼Œæœ€åæŠŠæ•´ä¸ªç»“æœè¿”å›å›æ¥ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé¡¹ç›®çš„æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨äºåˆ†å±‚AIæ¶æ„è®¾è®¡ï¼Œæˆ‘æ¥è¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p>é¦–å…ˆï¼Œé—®é¢˜èƒŒæ™¯æ˜¯AIçš„ä¸Šä¸‹æ–‡çª—å£æœ‰é™ï¼Œå¦‚æœè®©ä¸€ä¸ªAIç®¡ç†æ‰€æœ‰å¾®æœåŠ¡çš„å‡½æ•°åˆ—è¡¨ï¼Œä¼šå¯¼è‡´è°ƒç”¨ç²¾å‡†åº¦ä¸‹é™ã€‚</p>
<p>æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯è®¾è®¡äº†ä¸¤å±‚AIæ¶æ„ï¼š</p>
<p>ç¬¬ä¸€å±‚æ˜¯ä¸»AIï¼ˆè·¯ç”±å±‚ï¼‰ï¼Œå®ƒåªçŸ¥é“ç³»ç»Ÿä¸­æœ‰å“ªäº›å¾®æœåŠ¡ä»¥åŠæ¯ä¸ªå¾®æœåŠ¡çš„èŒè´£ï¼Œè´Ÿè´£æ ¹æ®ç”¨æˆ·è¯·æ±‚è¿›è¡Œåˆ†å‘ã€‚</p>
<p>ç¬¬äºŒå±‚æ˜¯ä¸“é—¨çš„æœåŠ¡AIï¼ˆæ‰§è¡Œå±‚ï¼‰ï¼Œæ¯ä¸ªå¾®æœåŠ¡å‰ç½®ä¸€ä¸ªä¸“é—¨çš„AIï¼Œåªç®¡ç†è¯¥å¾®æœåŠ¡çš„å‡½æ•°åˆ—è¡¨ï¼Œè´Ÿè´£å…·ä½“çš„å‡½æ•°è°ƒç”¨å’Œå‚æ•°å¡«å……ã€‚</p>
<p>æŠ€æœ¯å®ç°ä¸Šï¼Œæˆ‘é€šè¿‡è§£ægRPCçš„protoæ–‡ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå„å±‚AIçš„å‡½æ•°æ¸…å•ã€‚è¿™æ ·æ—¢ä¿è¯äº†ä¿¡æ¯çš„å‡†ç¡®æ€§ï¼Œåˆå®ç°äº†è‡ªåŠ¨åŒ–ç®¡ç†ã€‚</p>
<p>æœ€å¤§çš„æŠ€æœ¯éš¾ç‚¹æ˜¯æµå¼AIçš„å‡½æ•°è°ƒç”¨æ‹¼æ¥ã€‚å› ä¸ºAIæ˜¯æµå¼è¿”å›çš„ï¼Œéœ€è¦åœ¨åˆé€‚çš„æ—¶æœºè§¦å‘å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¸”æ­£ç¡®æ‹¼æ¥å¤šä¸ªå‡½æ•°è°ƒç”¨ç»“æœã€‚</p>
<p>è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿æ˜¯æé«˜äº†è°ƒç”¨ç²¾å‡†åº¦ï¼Œç¼ºç‚¹æ˜¯å¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦å’Œå“åº”æ—¶å»¶ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>è¯´æ˜äº†è®¾è®¡æ€è·¯ï¼Œä½†æŠ€æœ¯å®ç°ç»†èŠ‚å¯ä»¥æ›´å…·ä½“</li>
<li>é¢è¯•å®˜å¯¹æµå¼å¤„ç†çš„æŠ€æœ¯éš¾ç‚¹æ¯”è¾ƒæ„Ÿå…´è¶£</li>
</ul>
<h3 id="é—®é¢˜6ï¼šç³»ç»Ÿè®¾è®¡å¼€æ”¾é¢˜-æ•°æ®ç‰ˆæœ¬ç®¡ç†">é—®é¢˜6ï¼šç³»ç»Ÿè®¾è®¡å¼€æ”¾é¢˜ - æ•°æ®ç‰ˆæœ¬ç®¡ç†</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¦‚æœè¯´æˆ‘çš„æ•°æ®é›†å°±æ˜¯å¾ˆå¤§ï¼Œé‚£ä½ ç°åœ¨è¦è®¾è®¡è¿™ä¸ªä¸œè¥¿ï¼Œä½ ä¼šæ€ä¹ˆæƒ³çš„ï¼Ÿå°±æ¯”å¦‚è¯´æˆ‘ç°åœ¨è®¾è®¡çš„è¿™ä¸ªæ¨¡å‹ä»“åº“ï¼Œä¸€ä¸ªæ¨¡å‹å¯èƒ½å‡ åå…†å‡ ç™¾å…†ï¼Œä½†æ˜¯ä¸€ä¸ªæ•°æ®é›†å¯èƒ½æ˜¯å‡ åGæˆ–è€…å‡ Tçš„è§„æ¨¡ã€‚ä»–æ¯æ¬¡ä¼šæœ‰ä¸€äº›æ–°å¢ï¼Œä½†æˆ‘æœ‰çš„æ—¶å€™è¿˜æ˜¯è¦ç”¨ä¸Šä¸ªç‰ˆæœ¬çš„ï¼Œä½ æ€ä¹ˆå»åšç®¡ç†å‘¢ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘çš„æƒ³æ³•å°±æ˜¯èƒ½ä¸èƒ½ä»ç´¢å¼•ä¸Šå»æ€è€ƒè¿™ä¸ªé—®é¢˜ã€‚å°±æ¯”å¦‚è¯´æˆ‘ä»¬ä¸åšæ–‡ä»¶çš„ç®¡ç†ï¼Œæˆ‘ä»¬å»åšç´¢å¼•çš„ç®¡ç†ã€‚ç‰ˆæœ¬åŒ–çš„è¯ï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªç‰ˆæœ¬å®ƒä¼šæœ‰ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œç¬¬äºŒä¸ªç‰ˆæœ¬å®ƒä¼šæœ‰å¦ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ã€‚ç„¶åæˆ‘ä»¬è¦æ¯æ¬¡å»åŠ è½½æ•°æ®é›†çš„æ—¶å€™ï¼Œæˆ‘ä»¬èµ°è¿™ä¸ªç´¢å¼•ï¼Œè€Œä¸æ˜¯å»ç›´æ¥æ‰¾æ‰€æœ‰çš„æ–‡ä»¶ã€‚ç„¶åæ–‡ä»¶çš„è¯å…¨éƒ½å †åœ¨é‚£ä¸€å—å°±è¡Œäº†ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¤§æ•°æ®ç‰ˆæœ¬ç®¡ç†é—®é¢˜ã€‚æˆ‘è®¤ä¸ºå¯ä»¥ä»å‡ ä¸ªè§’åº¦æ¥è®¾è®¡ï¼š</p>
<p>é¦–å…ˆï¼Œç´¢å¼•åŒ–ç®¡ç†çš„æ€è·¯æ˜¯å¯¹çš„ã€‚æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªç±»ä¼¼Gitçš„ç‰ˆæœ¬ç®¡ç†æœºåˆ¶ï¼š</p>
<ol>
<li>
<p><strong>æ–‡ä»¶å»é‡</strong>ï¼šä½¿ç”¨å†…å®¹å“ˆå¸Œï¼ˆå¦‚SHA256ï¼‰ä½œä¸ºæ–‡ä»¶å”¯ä¸€æ ‡è¯†ï¼Œç›¸åŒå†…å®¹çš„æ–‡ä»¶åªå­˜å‚¨ä¸€ä»½ã€‚</p>
</li>
<li>
<p><strong>å¢é‡å­˜å‚¨</strong>ï¼šæ¯ä¸ªç‰ˆæœ¬åªå­˜å‚¨ç›¸å¯¹äºçˆ¶ç‰ˆæœ¬çš„å˜æ›´ï¼ŒåŒ…æ‹¬æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨ã€‚</p>
</li>
<li>
<p><strong>ç´¢å¼•ç»“æ„</strong>ï¼šæ¯ä¸ªç‰ˆæœ¬ç»´æŠ¤ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œè®°å½•è¯¥ç‰ˆæœ¬åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶åŠå…¶å“ˆå¸Œå€¼ã€‚ç´¢å¼•æ–‡ä»¶æœ¬èº«ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ†å±‚ç»“æ„ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ã€‚</p>
</li>
<li>
<p><strong>å­˜å‚¨ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>çƒ­æ•°æ®æ”¾SSDï¼Œå†·æ•°æ®æ”¾æ™®é€šç£ç›˜</li>
<li>å¯¹äºå¤§æ–‡ä»¶ï¼Œå¯ä»¥è€ƒè™‘åˆ†å—å­˜å‚¨</li>
<li>ä½¿ç”¨å‹ç¼©æŠ€æœ¯å‡å°‘å­˜å‚¨ç©ºé—´</li>
</ul>
</li>
<li>
<p><strong>ç‰ˆæœ¬æ ‘ç®¡ç†</strong>ï¼šæ”¯æŒåˆ†æ”¯å’Œåˆå¹¶ï¼Œå°±åƒGité‚£æ ·ã€‚</p>
</li>
</ol>
<p>å…·ä½“å®ç°ä¸Šï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå…ƒæ•°æ®æ•°æ®åº“ï¼ˆå¦‚MySQLï¼‰ç®¡ç†ç‰ˆæœ¬å…³ç³»å’Œæ–‡ä»¶ç´¢å¼•ï¼Œç”¨å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚MinIOï¼‰ç®¡ç†å®é™…æ–‡ä»¶å†…å®¹ã€‚</p>
<p>è¿™æ ·æ—¢ä¿è¯äº†å­˜å‚¨æ•ˆç‡ï¼Œåˆæ”¯æŒçµæ´»çš„ç‰ˆæœ¬ç®¡ç†ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å›ç­”äº†åŸºæœ¬æ€è·¯ï¼Œä½†å®ç°ç»†èŠ‚ä¸å¤Ÿæ·±å…¥</li>
<li>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€æ”¾æ€§ç³»ç»Ÿè®¾è®¡é¢˜ï¼Œè€ƒå¯Ÿæ¶æ„æ€ç»´</li>
</ul>
<h3 id="é—®é¢˜7ï¼šç ”ç©¶æ–¹å‘ç›¸å…³">é—®é¢˜7ï¼šç ”ç©¶æ–¹å‘ç›¸å…³</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ æ˜¯å­¦å¯†ç å­¦çš„ï¼Œæ²¡æœ‰å»åšä¸€äº›è·Ÿå¯†ç å­¦æœ‰å…³çš„é¡¹ç›®æˆ–è€…å®ä¹ å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œå¯†ç å­¦ç›¸å…³çš„é¡¹ç›®æ²¡æœ‰ã€‚å› ä¸ºå¯†ç å­¦çš„è¯å…¶å®å¥½åƒæ²¡æœ‰å¾ˆå¤šå¯¹å£çš„ä¸“å¯¹å£çš„å²—ä½ï¼Œé™¤äº†åŒºå—é“¾ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>ç¡®å®å¯†ç å­¦ç›¸å…³çš„å²—ä½ç›¸å¯¹è¾ƒå°‘ï¼Œä½†æˆ‘çš„ç ”ç©¶æ–¹å‘æ˜¯å¯æœç´¢åŠ å¯†ï¼Œä¸»è¦å…³æ³¨æ¨¡ç³Šæœç´¢æ–¹é¢ã€‚è™½ç„¶æ²¡æœ‰ç›´æ¥çš„å¯†ç å­¦é¡¹ç›®ï¼Œä½†æˆ‘è§‰å¾—è¿™ä¸ªç ”ç©¶èƒŒæ™¯å¯¹åç«¯å¼€å‘è¿˜æ˜¯æœ‰å¸®åŠ©çš„ï¼š</p>
<p>ç¬¬ä¸€ï¼Œå¯†ç å­¦çš„ä¸¥è°¨æ€§è®­ç»ƒäº†æˆ‘çš„é€»è¾‘æ€ç»´èƒ½åŠ›ï¼Œè¿™åœ¨ç³»ç»Ÿè®¾è®¡å’Œç®—æ³•ä¼˜åŒ–ä¸Šå¾ˆæœ‰ç”¨ã€‚</p>
<p>ç¬¬äºŒï¼Œå¯æœç´¢åŠ å¯†æ¶‰åŠå¤§é‡çš„æ•°æ®åº“å’Œç´¢å¼•æŠ€æœ¯ï¼Œè¿™ä¸åç«¯å¼€å‘ä¸­çš„æ•°æ®å­˜å‚¨å’Œæ£€ç´¢ä¼˜åŒ–æ˜¯ç›¸é€šçš„ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œæˆ‘å¹³æ—¶ä¼šé˜…è¯»å¾ˆå¤šæ•°æ®åº“ç›¸å…³çš„è®ºæ–‡ï¼Œå¯¹å‰æ²¿æŠ€æœ¯ä¿æŒæ•æ„Ÿåº¦ã€‚</p>
<p>ç›®å‰æˆ‘è¿˜æ˜¯å¸Œæœ›ä¸“æ³¨äºåç«¯å¼€å‘æ–¹å‘ï¼Œå› ä¸ºæˆ‘æ›´äº«å—è§£å†³å·¥ç¨‹é—®é¢˜çš„è¿‡ç¨‹ï¼Œè€Œä¸”Goè¯­è¨€çš„ç®€æ´æ€§å¾ˆç¬¦åˆæˆ‘çš„ç¼–ç¨‹é£æ ¼ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœå°†æ¥æœ‰æœºä¼šï¼Œæˆ‘ä¹Ÿå¾ˆæ„¿æ„å°†å¯†ç å­¦çŸ¥è¯†åº”ç”¨åˆ°æ•°æ®å®‰å…¨ã€éšç§ä¿æŠ¤ç­‰ç›¸å…³é¢†åŸŸã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å›ç­”è¿‡äºç®€å•ï¼Œæ²¡æœ‰ä½“ç°ç ”ç©¶èƒŒæ™¯çš„ä»·å€¼</li>
<li>å¯ä»¥å°†å­¦æœ¯èƒŒæ™¯ä¸å·¥ç¨‹å®è·µè”ç³»èµ·æ¥</li>
</ul>
<h2 id="é¢è¯•æ•´ä½“æ„Ÿå—">é¢è¯•æ•´ä½“æ„Ÿå—</h2>
<ul>
<li><strong>éš¾åº¦è¯„ä»·</strong>: é€‚ä¸­ï¼Œä¸»è¦è€ƒå¯Ÿé¡¹ç›®ç»éªŒå’Œæ¶æ„æ€ç»´</li>
<li><strong>é¢è¯•å®˜é£æ ¼</strong>: ä¸“ä¸šå‹å–„ï¼Œä¼šæ ¹æ®å›ç­”æ·±å…¥è¿½é—®æŠ€æœ¯ç»†èŠ‚</li>
<li><strong>é¢˜ç›®ç±»å‹</strong>: é¡¹ç›®è®²è§£(60%) + ç³»ç»Ÿè®¾è®¡(30%) + èƒŒæ™¯äº†è§£(10%)</li>
<li><strong>å‡†å¤‡å»ºè®®</strong>: é‡ç‚¹å‡†å¤‡é¡¹ç›®æ¶æ„å’ŒæŠ€æœ¯é€‰å‹çš„é€»è¾‘ï¼Œè¦èƒ½è¯´æ¸…æ¥šä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡</li>
</ul>
<h2 id="é¢è¯•ç»“æœ">é¢è¯•ç»“æœ</h2>
<ul>
<li><strong>å½“åœºåé¦ˆ</strong>: é¢è¯•å®˜ä»‹ç»äº†å…¬å¸ä¸šåŠ¡æ–¹å‘ï¼Œè¯¢é—®äº†ä¸ªäººè§„åˆ’</li>
<li><strong>åç»­æµç¨‹</strong>: é¢è¯•å®˜è¡¨ç¤ºä¼šè€ƒè™‘ï¼Œåç»­HRä¼šè”ç³»</li>
<li><strong>ä¸ªäººæ„Ÿå—</strong>: æ•´ä½“äº¤æµæ¯”è¾ƒé¡ºç•…ï¼Œé¢è¯•å®˜å¯¹AIé¡¹ç›®æ¯”è¾ƒæ„Ÿå…´è¶£</li>
</ul>
<h2 id="ç»éªŒæ€»ç»“">ç»éªŒæ€»ç»“</h2>
<h3 id="åšå¾—å¥½çš„åœ°æ–¹">åšå¾—å¥½çš„åœ°æ–¹</h3>
<ul>
<li>é¡¹ç›®ä»‹ç»æ¯”è¾ƒå®Œæ•´ï¼Œè¦†ç›–äº†æŠ€æœ¯æ ˆå’Œä¸šåŠ¡åœºæ™¯</li>
<li>å¯¹ç³»ç»Ÿè®¾è®¡æœ‰è‡ªå·±çš„æ€è€ƒ</li>
<li>å›ç­”é—®é¢˜æ¯”è¾ƒè¯šå®ï¼Œä¸æ‡‚çš„åœ°æ–¹ä¸èƒ¡ç¼–ä¹±é€ </li>
</ul>
<h3 id="éœ€è¦æ”¹è¿›çš„åœ°æ–¹">éœ€è¦æ”¹è¿›çš„åœ°æ–¹</h3>
<ul>
<li>æŠ€æœ¯ç»†èŠ‚è¡¨è¾¾ä¸å¤Ÿå‡†ç¡®ï¼Œæœ‰äº›åœ°æ–¹é€»è¾‘ä¸å¤Ÿæ¸…æ™°</li>
<li>å¯¹å¼€æ”¾æ€§é—®é¢˜çš„æ€è€ƒæ·±åº¦ä¸å¤Ÿ</li>
<li>å­¦æœ¯èƒŒæ™¯ä¸å·¥ç¨‹å®è·µçš„ç»“åˆå¯ä»¥æ›´å¥½</li>
</ul>
<h3 id="å‡†å¤‡å»ºè®®">å‡†å¤‡å»ºè®®</h3>
<ol>
<li><strong>é¡¹ç›®ç»éªŒè¦æ·±å…¥</strong>ï¼šä¸ä»…è¦è¯´åšäº†ä»€ä¹ˆï¼Œè¿˜è¦è¯´ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Œé‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³çš„</li>
<li><strong>ç³»ç»Ÿè®¾è®¡è¦ç»ƒä¹ </strong>ï¼šå¤šåšä¸€äº›å¼€æ”¾æ€§çš„æ¶æ„è®¾è®¡é¢˜ï¼ŒåŸ¹å…»å…¨å±€æ€ç»´</li>
<li><strong>æŠ€æœ¯è¡¨è¾¾è¦å‡†ç¡®</strong>ï¼šä¸“ä¸šæœ¯è¯­è¦ç”¨å‡†ç¡®ï¼ŒæŠ€æœ¯æ–¹æ¡ˆè¦æœ‰é€»è¾‘</li>
<li><strong>èƒŒæ™¯ç»å†è¦ä¸²è”</strong>ï¼šå°†å­¦æœ¯èƒŒæ™¯ã€é¡¹ç›®ç»éªŒã€ä¸ªäººè§„åˆ’ä¸²æˆä¸€æ¡ä¸»çº¿</li>
</ol>
<h3 id="çŸ¥è¯†ç‚¹å¤ä¹ ">çŸ¥è¯†ç‚¹å¤ä¹ </h3>
<ul>
<li>Goè¯­è¨€GMPæ¨¡å‹å’Œå¹¶å‘æœºåˆ¶</li>
<li>å¾®æœåŠ¡æ¶æ„è®¾è®¡åŸåˆ™</li>
<li>åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§æ–¹æ¡ˆ</li>
<li>MySQL binlogåŸç†å’ŒCDCæŠ€æœ¯</li>
<li>ç³»ç»Ÿè®¾è®¡ä¸­çš„æ•°æ®å­˜å‚¨å’Œç‰ˆæœ¬ç®¡ç†</li>
<li>AIå·¥ç¨‹åŒ–å’Œæµå¼å¤„ç†æŠ€æœ¯</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œè¿™æ˜¯ä¸€æ¬¡å¾ˆå¥½çš„æŠ€æœ¯é¢è¯•ä½“éªŒï¼Œé¢è¯•å®˜ä¸“ä¸šæ°´å¹³å¾ˆé«˜ï¼Œé—®é¢˜æœ‰æ·±åº¦ä¹Ÿå¾ˆå®é™…ã€‚å¯¹äºå‡†å¤‡åç«¯å¼€å‘å²—ä½çš„åŒå­¦ï¼Œå»ºè®®å¤šå…³æ³¨ç³»ç»Ÿè®¾è®¡å’Œå·¥ç¨‹å®è·µï¼Œä¸ä»…è¦ä¼šå†™ä»£ç ï¼Œè¿˜è¦èƒ½è®¾è®¡ç³»ç»Ÿã€‚</p>
]]></content>
      <categories>
        <category>é¢è¯•ç»éªŒ</category>
      </categories>
      <tags>
        <tag>ä¸€é¢</tag>
        <tag>é¡½å²©èµ„äº§</tag>
        <tag>Golangåç«¯å¼€å‘</tag>
        <tag>å®ä¹ ç”Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>è”šæ¥ Golangåç«¯å¼€å‘ ä¸€é¢</title>
    <url>/2025/06/22/%E9%9D%A2%E8%AF%95%E9%A2%98/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E5%8E%82/%E8%94%9A%E6%9D%A5/2025-02-11-%E8%94%9A%E6%9D%A5-Golang%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%B8%80%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="é¢è¯•åŸºæœ¬ä¿¡æ¯">é¢è¯•åŸºæœ¬ä¿¡æ¯</h2>
<ul>
<li><strong>å…¬å¸</strong>: è”šæ¥æ±½è½¦ï¼ˆæ–°èƒ½æºæ±½è½¦ç‹¬è§’å…½ï¼‰</li>
<li><strong>èŒä½</strong>: Golangåç«¯å¼€å‘å·¥ç¨‹å¸ˆ</li>
<li><strong>é¢è¯•è½®æ¬¡</strong>: ä¸€é¢ï¼ˆæŠ€æœ¯é¢ï¼‰</li>
<li><strong>é¢è¯•å½¢å¼</strong>: çº¿ä¸Šè§†é¢‘é¢è¯•</li>
<li><strong>é¢è¯•æ—¶é•¿</strong>: çº¦60åˆ†é’Ÿï¼ˆåŒ…å«15-20åˆ†é’Ÿä»£ç é¢˜ï¼‰</li>
<li><strong>é¢è¯•å®˜</strong>: æŠ€æœ¯leaderï¼Œä¸»è¦è´Ÿè´£è½¦è¾†æµ‹è¯•ç³»ç»Ÿå¼€å‘</li>
</ul>
<h2 id="é¢è¯•é—®é¢˜ä¸å›ç­”">é¢è¯•é—®é¢˜ä¸å›ç­”</h2>
<h3 id="é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»å’Œé¡¹ç›®ç»å†">é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»å’Œé¡¹ç›®ç»å†</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ å…ˆåšä¸ªè‡ªæˆ‘ä»‹ç»ï¼Œç„¶åä»‹ç»ä¸€ä¸‹ä½ çš„é¡¹ç›®ç»å†ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;å¥½çš„ï¼Œé¦–å…ˆæˆ‘å«ç‹å®‡å“²ï¼Œæ¥è‡ªåä¸œå¸ˆèŒƒå¤§å­¦ï¼Œç°åœ¨æ˜¯åœ¨è½¯ä»¶å·¥ç¨‹å­¦é™¢çš„è½¯ä»¶å·¥ç¨‹ä¸“ä¸šå°±è¯»ï¼Œç›®å‰æ˜¯ç ”ä¸€ã€‚ç ”ä¸€çš„è¯æˆ‘ä»¬å¯¼å¸ˆæ²¡æœ‰è¯´ä¸åŒæ„å‡ºæ¥å®ä¹ ï¼Œä¹Ÿæ²¡æœ‰è¯´åŒæ„ï¼Œä½†æ˜¯æˆ‘å› ä¸ºè®ºæ–‡åŸºæœ¬ä¸Šå·²ç»å®Œæˆå¾—å·®ä¸å¤šäº†ï¼Œæ‰€ä»¥ä¹Ÿè·Ÿå¯¼å¸ˆå•†é‡å¥½äº†ï¼Œç§‘ç ”ä¸Šçš„ä»»åŠ¡åŸºæœ¬ä¸Šæ²¡æœ‰å¤ªå¤šäº†ï¼Œæ‰€ä»¥ç°åœ¨å°±æ¥æ‰¾å®ä¹ äº†ã€‚</p>
<p>ç„¶åæˆ‘ä¸»è¦çš„æŠ€æœ¯æ ˆæ˜¯Goè¯­è¨€ï¼Œä»¥å‰ä¹Ÿåšè¿‡Javaã€PHPç›¸å…³çš„é¡¹ç›®ã€‚ç°åœ¨ä¸»è¦æŠ€æœ¯æ ˆçš„è¯ï¼Œæœ€è¿‘åšçš„æ˜¯æŠ–éŸ³å•†åŸï¼Œå®ƒæ˜¯ä¸€ä¸ªå‚åŠ å­—èŠ‚è·³åŠ¨é’è®­è¥çš„é¡¹ç›®ã€‚è¿™ä¸ªé¡¹ç›®ç”¨ginåŠ gRPCï¼Œç„¶åèåˆäº†ä¸€äº›å¯è§‚æµ‹æ€§ä¹‹ç±»çš„ç»„ä»¶è¿›å»ï¼ŒæœåŠ¡æ³¨å†ŒæœåŠ¡å‘ç°ï¼ŒåŸºæœ¬ä¸Šèƒ½æƒ³åˆ°çš„è·Ÿå¾®æœåŠ¡ç›¸å…³çš„å¸¸è§çš„ä¸œè¥¿åŸºæœ¬ä¸Šéƒ½èå…¥è¿›å»äº†ã€‚</p>
<p>å¦ä¸€ä¸ªé¡¹ç›®çš„è¯å«ani qï¼Œæ˜¯æˆ‘è‡ªå·±å­¦ä¹ ä¹‹ä½™åšçš„ä¸€ä¸ªé¡¹ç›®ï¼Œæ˜¯å»å¹´æš‘å‡çš„æ—¶å€™è¿˜æ²¡å¼€å­¦çš„æ—¶å€™åšçš„ã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºäºå­—èŠ‚è·³åŠ¨é‚£ä¸ªæ¡†æ¶æ­å»ºå‡ºæ¥çš„å¾®æœåŠ¡æ¶æ„çš„å¤šä»£ç†AIç³»ç»Ÿã€‚ä»¥å‰æœ¬ç§‘çš„è¯æ‹¿è¿‡å›½å®¶å¥–å­¦é‡‘ï¼Œä¹Ÿå‚åŠ è¿‡è“æ¡¥æ¯æ‹¿è¿‡å›½ä¸€ï¼Œè®¡ç®—æœºè®¾è®¡å¤§èµ›æ‹¿è¿‡å›½ä¸‰ï¼Œè¿˜æœ‰å¤§å­¦ç”Ÿæ•°å­¦ç«èµ›æ‹¿è¿‡ä¸€ç­‰å¥–ï¼Œå·®ä¸å¤šå°±è¿™äº›ã€‚&quot;</p>
</blockquote>
<p><strong>é¢è¯•å®˜åç»­æé—®</strong>ï¼š</p>
<blockquote>
<p>â€œä½ é‚£ä¸ªAIæ˜¯åšäº†ä¸€ä¸ªä»€ä¹ˆæ ·çš„å…·ä½“çš„æ–¹å‘ï¼ŸAIé‚£ä¸ªçš„è¯èƒ½è¯¦ç»†è®²ä¸€ä¸‹å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;AIé‚£ä¸ªçš„è¯å®ƒä¸»è¦å°±æ˜¯é™¤äº†å¾®æœåŠ¡ï¼Œé™¤äº†ä¸€äº›ç®€å•åŸºæœ¬çš„å¾®æœåŠ¡ä»¥å¤–ï¼Œæˆ‘ä»¬ä¸»è¦å½“æ—¶è®¾æƒ³æ˜¯è¿™æ ·ä¸€ä¸ªAIèƒ½å¤Ÿå»å°±æ¯”å¦‚è¯´å®ƒä¼šæœ‰ä¸€ä¸ªæ¶æ„ï¼Œå®ƒæ˜¯é¦–å…ˆä¸€ä¸ªä¸»AIæ˜¯ç”¨æ¥åˆ†æç”¨æˆ·éœ€æ±‚çš„ã€‚ç„¶åå®ƒä¼šç±»ä¼¼äºä¸€ä¸ªæ ‘å½¢çš„ç»“æ„ï¼Œå®ƒä¼šåˆ†é…ç»™ä¸‹çº§çš„AIå»æ‰§è¡Œä¸€äº›æ‰§è¡Œé‚£ä¸ªå¾®æœåŠ¡çš„ï¼Œæ‰§è¡Œæ‰§è¡Œå†³å®šè¦è½¬å‘ç»™å“ªä¸ªå¾®æœåŠ¡ã€‚</p>
<p>å°±æ¯”å¦‚è¯´å®ƒå¯èƒ½æœ‰è®¢å•å¾®æœåŠ¡ï¼Œå°±æ¯”å¦‚è¯´ä¸€äº›å¸¸è§çš„å•†åŸç³»ç»Ÿï¼Œå®ƒå¯èƒ½æœ‰è®¢å•å¾®æœåŠ¡ï¼Œç”¨æˆ·å¾®æœåŠ¡ï¼Œç„¶åå®ƒè·ŸAIæå‡ºä¸€ä¸ªè¯·æ±‚ï¼Œå®ƒä¼šç„¶åä¸»AIå®ƒä¼šå»åˆ¤æ–­åº”è¯¥æ˜¯äº¤ç»™å“ªä¸ªå¾®æœåŠ¡å»æ“ä½œçš„ã€‚ç„¶åäº¤ç»™é‚£å®ƒä¸ä¼šç›´æ¥äº¤ç»™é‚£ä¸ªå¾®æœåŠ¡ï¼Œä¼šäº¤ç»™ä¸€ä¸ªä¸‹æ¸¸AIï¼Œé‚£ä¸ªä¸‹æ¸¸AIçš„è¯å®ƒæ˜¯çŸ¥é“é‚£ä¸ªå¾®æœåŠ¡çš„æ‰€æœ‰çš„æ¥å£çš„ã€‚ç„¶åç¬¬äºŒçº§AIçš„è¯ï¼Œå®ƒå¯ä»¥å»å†³å®šå»è°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°ã€‚è¿™æ ·çš„è¯å®ƒå°±å¯ä»¥ä»¥ä¸€ç§æ ‘å½¢çš„ç»“æ„å»è°ƒåº¦çš„è¯ï¼Œå®ƒå¯ä»¥å®ƒå› ä¸ºç°åœ¨AIä¸Šä¸‹æ–‡çš„é•¿åº¦ä¸æ˜¯å¾ˆé«˜ã€‚å› ä¸ºä¸Šä¸‹æ–‡ä¸€æ—¦å¤šäº†ä»¥åï¼Œå®ƒè¿™ä¸ªå‡†ç¡®åº¦å°±ä¼šä¸‹æ¥ã€‚å¦‚æœç”¨è¿™ç§æ¶æ„çš„è¯ï¼Œå®ƒå³ä½¿æ˜¯å³ä½¿å®ƒæ”¯æŒä¸Šä¸‹æ–‡æœ‰é™ï¼Œå®ƒä¹Ÿå¯ä»¥è¾¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„æ•ˆæœã€‚å› ä¸ºæœ‰ç‚¹åƒåˆ†æ²»çš„æ€æƒ³åœ¨é‡Œé¢ã€‚&quot;</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œç¬¬ä¸€ä¸ªé¡¹ç›®åº”è¯¥æ²¡æœ‰å¾ˆå¤æ‚çš„ä¸šåŠ¡ï¼Œåœ¨é‡Œé¢ä½ æ˜¯è‡ªå·±ç»ƒç»ƒæ‰‹çš„ä¸€ä¸ªé¡¹ç›®ï¼Œå¯¹å§ï¼Ÿä¸»è¦å°±æ˜¯ä¸€äº›å•†åŸçš„ä¸€äº›å¸¸ç”¨çš„ä¸€äº›æ¨¡å‹çš„ä¸€äº›CRUDä¸ºä¸»å¯¹å§ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç”¨æ¥åšä»€ä¹ˆï¼Ÿèƒ½è¯¦ç»†è¯´è¯´å—ï¼Ÿæ¯”å¦‚è¯´ä½ æ˜¯å¤„ç†ä»€ä¹ˆæ ·çš„ä¸šåŠ¡éœ€è¦æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;ä¸åªæ˜¯CRUDï¼Œå®ƒä¸»è¦æ˜¯å› ä¸ºè¦ä¿è¯ä¸€äº›å¯è§‚æµ‹æ€§ä¹‹ç±»çš„ï¼Œæ‰€ä»¥è¯´å®ƒèåˆæŒºå¤šã€‚æ¯”å¦‚è¯´æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿèåˆè¿›å»äº†ã€‚æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿä¿è¯é«˜å¹¶å‘åœºæ™¯ä¸‹çš„é‚£äº›è´Ÿè½½ï¼Œå°±æ˜¯æœåŠ¡å¯¹é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå®ƒæœåŠ¡å™¨è´Ÿè½½å°±æ˜¯å•ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½ä¸ä¼šå¤ªå¤§ã€‚</p>
<p>æ¯”å¦‚è¯´è®¢å•ï¼Œæ¯”å¦‚è¯´åˆ›å»ºè®¢å•ï¼Œä½ éƒ½ä¸æ˜¯ç«‹å³å¤„ç†ï¼Œéƒ½æ˜¯å¼‚æ­¥å¤„ç†çš„ã€‚è¿™ä¸ªæ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™æ ·çš„è¯å°±æ˜¯æœåŠ¡å™¨å‹åŠ›ä¸ä¼šå¤ªå¤§ã€‚æˆ‘ä»¬ç”¨çš„RocketMQã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è‡ªæˆ‘ä»‹ç»è¿™å—æˆ‘è§‰å¾—å¯ä»¥æ›´æœ‰æ¡ç†ä¸€äº›ã€‚å¯ä»¥è¿™æ ·ç»„ç»‡ï¼š</p>
<p>&quot;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯xxxï¼Œç›®å‰åœ¨åä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹ä¸“ä¸šè¯»ç ”ä¸€ã€‚æŠ€æœ¯æ–¹é¢ï¼Œæˆ‘ä¸»è¦ä¸“æ³¨äºGoè¯­è¨€åç«¯å¼€å‘ï¼Œæœ‰çº¦1å¹´çš„å®è·µç»éªŒã€‚</p>
<p>é¡¹ç›®ç»å†æ–¹é¢ï¼Œæˆ‘ä¸»è¦å®Œæˆäº†ä¸¤ä¸ªæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„é¡¹ç›®ï¼š</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯å­—èŠ‚è·³åŠ¨é’è®­è¥çš„æŠ–éŸ³å•†åŸé¡¹ç›®ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¾®æœåŠ¡æ¶æ„é¡¹ç›®ã€‚æŠ€æœ¯æ ˆä½¿ç”¨gin+gRPCï¼Œé›†æˆäº†æœåŠ¡æ³¨å†Œå‘ç°ã€æ¶ˆæ¯é˜Ÿåˆ—RocketMQã€é“¾è·¯è¿½è¸ªPrometheusç­‰ç»„ä»¶ï¼Œä¸»è¦è§£å†³é«˜å¹¶å‘åœºæ™¯ä¸‹çš„è®¢å•å¤„ç†é—®é¢˜ã€‚</p>
<p>ç¬¬äºŒä¸ªæ˜¯æˆ‘ä¸ªäººå¼€å‘çš„ani qå¤šä»£ç†AIç³»ç»Ÿï¼ŒåŸºäºå­—èŠ‚è·³åŠ¨çš„Hertzå’ŒKitexæ¡†æ¶ï¼Œè®¾è®¡äº†åˆ†å±‚çš„AIè°ƒåº¦æ¶æ„ï¼Œé€šè¿‡è§£æProtoæ–‡ä»¶å®ç°æ³›åŒ–è°ƒç”¨ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åˆ›æ–°æ€§çš„å°è¯•ã€‚</p>
<p>å­¦æœ¯æ–¹é¢ï¼Œæˆ‘è·å¾—è¿‡å›½å®¶å¥–å­¦é‡‘ï¼Œåœ¨ç®—æ³•ç«èµ›å’Œæ•°å­¦ç«èµ›ä¸­ä¹Ÿæœ‰ä¸é”™çš„æˆç»©ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶ä»‹ç»æœ‰ç‚¹å•°å—¦ï¼Œé€»è¾‘ä¸å¤Ÿæ¸…æ™°</li>
<li>åº”è¯¥çªå‡ºæ ¸å¿ƒæŠ€æœ¯èƒ½åŠ›å’Œé¡¹ç›®äº®ç‚¹</li>
<li>å¯ä»¥æå‰å‡†å¤‡1-2åˆ†é’Ÿçš„ç²¾ç‚¼ç‰ˆæœ¬</li>
</ul>
<h3 id="é—®é¢˜2ï¼šGoè¯­è¨€deferæœºåˆ¶">é—®é¢˜2ï¼šGoè¯­è¨€deferæœºåˆ¶</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ è¯´ä¸€ä¸‹Goè¯­è¨€é‡Œé¢é‚£ä¸ªdeferæœ‰ä»€ä¹ˆç”¨ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œdeferçš„è¯å®ƒä¸»è¦å°±æ˜¯å®ƒä¼šåœ¨ä¸€ä¸ªå‡½æ•°æ‰§è¡Œå‰å»ï¼Œè¿™ä¸ªå‡½æ•°ç»“æŸä¹‹å‰å»æ‰§è¡Œè¿™ä¸ªdeferé‡Œé¢çš„é‚£ä¸ªå¯¹ä¸€äº›æ–¹æ³•ã€‚ç„¶åå®ƒçš„è¯æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ï¼Œå°±æ˜¯å®ƒå…ˆè¿›å…ˆå‡ºã€‚ä¹Ÿå°±æ˜¯è¯´æ¯”å¦‚è¯´ä½ deferå®ƒå¯èƒ½å®šä¹‰çš„æ˜¯é¡ºåºæ˜¯1ã€2ã€3ï¼Œä½†å®ƒæœ€åæ‰§è¡Œçš„è¯ï¼Œæ‰§è¡Œdeferé‡Œé¢çš„å‡½æ•°ï¼Œå®ƒä¼šç”¨3ã€2ã€1çš„é¡ºåºå»æ‰§è¡Œã€‚å®ƒè¿™ä¸ªä¸€èˆ¬æ˜¯ç”¨åœ¨æ¯”å¦‚è¯´æˆ‘å¼€å¯äº†ä¸€ä¸ªæ•°æ®åº“ï¼Œç„¶åæˆ‘ä»¬è¦åœ¨å‡½æ•°ç»“æŸçš„æ—¶å€™è¦ç»™å®ƒé”€æ¯æ‰ï¼Œæ‰§è¡Œè¿™æ ·ä¸€äº›æ–¹æ³•ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å…³äºdeferæœºåˆ¶ï¼Œæˆ‘è§‰å¾—å¯ä»¥è¿™æ ·å›ç­”ä¼šæ›´å‡†ç¡®ï¼š</p>
<p>&quot;deferæ˜¯Goè¯­è¨€çš„ä¸€ä¸ªå…³é”®å­—ï¼Œä¸»è¦ç”¨äºå»¶è¿Ÿæ‰§è¡Œå‡½æ•°è°ƒç”¨ï¼Œç›´åˆ°åŒ…å«å®ƒçš„å‡½æ•°è¿”å›æ—¶æ‰æ‰§è¡Œã€‚</p>
<p>deferæœ‰å‡ ä¸ªé‡è¦ç‰¹æ€§ï¼šç¬¬ä¸€ï¼Œå®ƒæ˜¯å…ˆè¿›åå‡ºçš„æ‰§è¡Œé¡ºåºï¼Œä¹Ÿå°±æ˜¯LIFOï¼ˆLast In First Outï¼‰ï¼Œåå®šä¹‰çš„deferä¼šå…ˆæ‰§è¡Œï¼›ç¬¬äºŒï¼Œdeferçš„å‚æ•°ä¼šåœ¨deferè¯­å¥æ‰§è¡Œæ—¶å°±ç¡®å®šå€¼ï¼Œè€Œä¸æ˜¯åœ¨å®é™…è°ƒç”¨æ—¶ï¼›ç¬¬ä¸‰ï¼Œå³ä½¿å‡½æ•°å‘ç”Ÿpanicï¼Œdeferè¯­å¥ä¹Ÿä¼šæ‰§è¡Œã€‚</p>
<p>å®é™…åº”ç”¨ä¸­ï¼Œdeferä¸»è¦ç”¨äºèµ„æºæ¸…ç†ï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶å¥æŸ„ã€é‡Šæ”¾æ•°æ®åº“è¿æ¥ã€è§£é”mutexç­‰ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿èµ„æºåœ¨å‡½æ•°é€€å‡ºæ—¶ä¸€å®šä¼šè¢«æ­£ç¡®é‡Šæ”¾ï¼Œé¿å…èµ„æºæ³„éœ²ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processFile</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    file, err := os.Open(<span class="string">&quot;test.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> file.Close() <span class="comment">// ç¡®ä¿æ–‡ä»¶ä¸€å®šä¼šå…³é—­</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ–‡ä»¶é€»è¾‘...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶è¯´æˆäº†&quot;å…ˆè¿›å…ˆå‡º&quot;ï¼Œåº”è¯¥æ˜¯&quot;åè¿›å…ˆå‡º&quot;ï¼ˆLIFOï¼‰</li>
<li>è¡¨è¾¾æœ‰äº›ç£•ç£•ç»Šç»Šï¼Œé€»è¾‘ä¸å¤Ÿæ¸…æ™°</li>
<li>æ²¡æœ‰æåˆ°panicæ—¶ä¹Ÿä¼šæ‰§è¡Œdeferè¿™ä¸ªé‡è¦ç‰¹æ€§</li>
<li>åº”è¯¥ç»™å‡ºå…·ä½“çš„ä»£ç ç¤ºä¾‹</li>
</ul>
<h3 id="é—®é¢˜3ï¼šGoè¯­è¨€åƒåœ¾å›æ”¶æœºåˆ¶">é—®é¢˜3ï¼šGoè¯­è¨€åƒåœ¾å›æ”¶æœºåˆ¶</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œè¯´ä¸€ä¸‹Goè¯­è¨€çš„åƒåœ¾å›æ”¶æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè¿™ä¸ªåƒåœ¾å›æ”¶æœºåˆ¶çš„è¯æˆ‘æ²¡æœ‰å¤ªäº†è§£ï¼Œä½†æ˜¯æˆ‘è®°å¾—å®ƒå¥½åƒæ˜¯æœ‰ä¸€ä¸ªå«ä¸‰è‰²æ ‡è®°æ³•ï¼Œå¥½åƒæ˜¯Goè¯­è¨€ä»¥åçš„ã€‚æˆ‘è®°å¾—å®ƒæ˜¯ä¼šç”¨ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹å»æ ‡è®°ï¼Œæ ‡è®°äº†é»‘è‰²èŠ‚ç‚¹ä»¥åï¼Œå®ƒå°±æ˜¯æ ‡è®°ä¸ºè¿™äº›èµ„æºä¸ä¼šå†è¢«ä½¿ç”¨äº†ï¼Œå°±æ˜¯ç­‰å¾…è¢«å›æ”¶çš„ã€‚ç„¶åå®ƒä¸ä¼šä¸€æ¬¡æ€§å›æ”¶ï¼Œå®ƒä¼šå¥½åƒæ˜¯æ¯éš”ä¸€æ®µæ—¶é—´å®ƒä¼šå›æ”¶ä¸€éƒ¨åˆ†ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>Goè¯­è¨€çš„åƒåœ¾å›æ”¶ç¡®å®æ˜¯åŸºäºä¸‰è‰²æ ‡è®°æ³•ï¼Œæˆ‘æ¥è¯¦ç»†è¯´ä¸€ä¸‹ï¼š</p>
<p>&quot;Goè¯­è¨€ä½¿ç”¨çš„æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•ã€‚å…·ä½“æ¥è¯´ï¼š</p>
<p>ä¸‰è‰²æ ‡è®°æ³•æŠŠæ‰€æœ‰å¯¹è±¡åˆ†ä¸ºä¸‰ç§é¢œè‰²ï¼š</p>
<ul>
<li>ç™½è‰²ï¼šæœªè¢«è®¿é—®çš„å¯¹è±¡ï¼Œå›æ”¶å€™é€‰</li>
<li>ç°è‰²ï¼šå·²è¢«è®¿é—®ä½†å…¶å¼•ç”¨è¿˜æœªè¢«æ‰«æçš„å¯¹è±¡</li>
<li>é»‘è‰²ï¼šå·²è¢«è®¿é—®ä¸”å…¶å¼•ç”¨ä¹Ÿå·²è¢«æ‰«æçš„å¯¹è±¡</li>
</ul>
<p>å›æ”¶è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œæ ‡è®°ä¸ºç°è‰²ï¼›ç„¶åæ‰«æç°è‰²å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ï¼Œå°†å¼•ç”¨å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œè‡ªå·±å˜ä¸ºé»‘è‰²ï¼›é‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æ²¡æœ‰ç°è‰²å¯¹è±¡ï¼›æœ€åæ¸…ç†æ‰€æœ‰ç™½è‰²å¯¹è±¡ã€‚</p>
<p>Goçš„ä¼˜åŒ–ç‚¹åœ¨äºï¼šç¬¬ä¸€ï¼Œä½¿ç”¨å†™å±éšœæŠ€æœ¯ä¿è¯å¹¶å‘å®‰å…¨ï¼›ç¬¬äºŒï¼Œé‡‡ç”¨æ··åˆå†™å±éšœå‡å°‘STWï¼ˆStop The Worldï¼‰æ—¶é—´ï¼›ç¬¬ä¸‰ï¼Œé€šè¿‡è°ƒä¼˜å‚æ•°GOGCæ§åˆ¶å›æ”¶é¢‘ç‡ï¼Œå¹³è¡¡ååé‡å’Œå»¶è¿Ÿã€‚</p>
<p>ç°åœ¨Go 1.5+ç‰ˆæœ¬çš„GCå»¶è¿Ÿå·²ç»æ§åˆ¶åœ¨æ¯«ç§’çº§åˆ«ï¼Œå¯¹äºå¤§éƒ¨åˆ†åº”ç”¨æ¥è¯´æ€§èƒ½è¡¨ç°éƒ½å¾ˆå¥½ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶åªè®°å¾—ä¸‰è‰²æ ‡è®°æ³•çš„æ¦‚å¿µï¼Œæ²¡æœ‰æ·±å…¥ç†è§£</li>
<li>åº”è¯¥å­¦ä¹ å®Œæ•´çš„GCæµç¨‹å’Œä¼˜åŒ–ç­–ç•¥</li>
<li>å¯ä»¥è¡¥å……ä¸€äº›æ€§èƒ½è°ƒä¼˜çš„å®è·µç»éªŒ</li>
</ul>
<h3 id="é—®é¢˜4ï¼šGoåç¨‹é—´é€šä¿¡æ–¹å¼">é—®é¢˜4ï¼šGoåç¨‹é—´é€šä¿¡æ–¹å¼</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œGoè¯­è¨€é‡Œé¢goroutineä¹‹é—´æœ‰å“ªäº›å¯ä»¥é€šä¿¡çš„æ–¹å¼ï¼Ÿä¸¾2åˆ°3ä¸ªã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;ä¸€èˆ¬æ¥è¯´çš„è¯ï¼Œç¬¬ä¸€ç§å°±æ˜¯å®ƒç”¨é‚£ç§ä¿¡å·é‡æœºåˆ¶ï¼Œæ¯”å¦‚è¯´syncè¿™ä¸ªåº“é‡Œé¢å®ƒä¼šæä¾›mutexï¼Œç”¨è¿™ç§æ–¹å¼å»æ‰§è¡Œä¸€ä¸ªç±»ä¼¼äºåŒæ­¥ä¹‹ç±»çš„æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é€šä¿¡æ–¹å¼ã€‚</p>
<p>æœ€ä¸»è¦çš„è¿˜æ˜¯channelè¿™ç§ï¼Œå®ƒç›¸å½“äºæœ‰ç‚¹åƒæ˜¯ä¸€ä¸ªæ¶ˆæ¯é€šé“ã€‚ç„¶åå·¦è¾¹æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå³è¾¹ä¸€ä¸ªâ€¦å°±æ˜¯å·¦è¾¹ä¸€ä¸ªproviderï¼Œå³è¾¹ä¸€ä¸ªconsumerï¼Œç„¶åå°±æ˜¯ç”¨è¿™ä¸ªä¿¡å·ï¼Œç”¨è¿™ä¸ªchannelçš„è¯ï¼Œå®ƒå°±å¯ä»¥å®ç°ä¸€äº›åŒæ­¥çš„æ“ä½œï¼Œè¿˜å¯ä»¥ä¼ é€’æ•°æ®ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªå«WaitGroupï¼Œæˆ‘è®°å¾—å®ƒä¼šå°±æ˜¯å®ƒå°±æ¯”å¦‚è¯´ä½ åœ¨å¼€å¯ä¸‰ä¸ªåç¨‹çš„æ—¶å€™ï¼Œæ¯ä¸ªåç¨‹å¼€å¯ä¹‹å‰ï¼Œä½ éƒ½ç»™å®ƒWaitGroupå»åŠ 1ã€‚ç„¶åæœ€åçš„è¯å°±æ˜¯åœ¨åç¨‹å¼€å¯å®Œä»¥åï¼Œæˆ‘ä»¬å»åœ¨ä¸»å‡½æ•°é‡Œé¢æœ€åå»ç­‰å¾…ç­‰å¾…è¿™äº›wait WaitGroupè¢«é‡Šæ”¾ï¼Œç„¶åå°±å¯ä»¥åŒæ—¶ç­‰å¾…ä¸‰ä¸ªåç¨‹ç»“æŸã€‚è¿™æ ·çš„è¯å°±å¯ä»¥åŒæ—¶ç­‰å¾…ä¸‰ä¸ªç¨‹åºç»“æŸä»¥åï¼Œå†ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æ˜¯å…±äº«å†…å­˜ï¼Œå…±äº«å†…å­˜å®ƒå°±æ˜¯ç›´æ¥å¯ä»¥è¯»å–ã€‚æ¯”å¦‚è¯´ä¸»å‡½æ•°é‡Œé¢çš„å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œç„¶ååç¨‹é‡Œé¢å®ƒå°±å¯ä»¥è¯»å–ä¸»å‡½æ•°è¿™ä¸ªå˜é‡ã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>Goåç¨‹é—´é€šä¿¡ä¸»è¦æœ‰è¿™å‡ ç§æ–¹å¼ï¼š</p>
<p>&quot;ç¬¬ä¸€ç§æ˜¯Channelï¼Œè¿™æ˜¯Goè¯­è¨€æ¨èçš„é€šä¿¡æ–¹å¼ï¼Œç¬¦åˆâ€™ä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œè¦é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜â€™çš„ç†å¿µã€‚Channelå¯ä»¥æ˜¯æ— ç¼“å†²çš„ï¼ˆåŒæ­¥ï¼‰æˆ–æœ‰ç¼“å†²çš„ï¼ˆå¼‚æ­¥ï¼‰ï¼Œèƒ½å¤Ÿå®‰å…¨åœ°åœ¨åç¨‹é—´ä¼ é€’æ•°æ®ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯å…±äº«å†…å­˜é…åˆåŒæ­¥åŸè¯­ï¼Œæ¯”å¦‚ä½¿ç”¨sync.Mutexã€sync.RWMutexæ¥ä¿æŠ¤å…±äº«å˜é‡çš„è®¿é—®ã€‚è¿™ç§æ–¹å¼æ€§èƒ½è¾ƒå¥½ï¼Œä½†éœ€è¦å°å¿ƒå¤„ç†ç«æ€æ¡ä»¶ã€‚</p>
<p>ç¬¬ä¸‰ç§æ˜¯å…¶ä»–åŒæ­¥åŸè¯­ï¼Œæ¯”å¦‚sync.WaitGroupç”¨äºç­‰å¾…ä¸€ç»„åç¨‹å®Œæˆï¼Œsync.Onceç”¨äºç¡®ä¿å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œsync.Condç”¨äºæ¡ä»¶ç­‰å¾…ç­‰ã€‚</p>
<p>å®é™…å¼€å‘ä¸­ï¼Œä¼˜å…ˆæ¨èä½¿ç”¨Channelï¼Œå› ä¸ºå®ƒåœ¨ç¼–è¯‘æ—¶å°±èƒ½å¸®æˆ‘ä»¬æ£€æŸ¥å¾ˆå¤šå¹¶å‘å®‰å…¨é—®é¢˜ã€‚åªæœ‰åœ¨æ€§èƒ½è¦æ±‚ç‰¹åˆ«é«˜çš„åœºæ™¯ä¸‹ï¼Œæ‰è€ƒè™‘ä½¿ç”¨å…±äº«å†…å­˜çš„æ–¹å¼ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯WaitGroupä¸¥æ ¼æ¥è¯´ä¸æ˜¯é€šä¿¡æ–¹å¼ï¼Œè€Œæ˜¯åŒæ­¥æœºåˆ¶ï¼Œç”¨äºåè°ƒåç¨‹çš„æ‰§è¡Œé¡ºåºã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶æŠŠWaitGroupä¹Ÿç®—ä½œé€šä¿¡æ–¹å¼ï¼Œæ¦‚å¿µæœ‰ç‚¹æ··æ·†</li>
<li>åº”è¯¥æ˜ç¡®åŒºåˆ†é€šä¿¡å’ŒåŒæ­¥çš„æ¦‚å¿µ</li>
<li>å¯ä»¥è¡¥å……ä¸€äº›å…·ä½“çš„ä½¿ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µ</li>
</ul>
<h3 id="é—®é¢˜5ï¼šMySQL-B-æ ‘ç´¢å¼•ç»“æ„">é—®é¢˜5ï¼šMySQL B+æ ‘ç´¢å¼•ç»“æ„</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œMySQLä½ ç”¨çš„æ¯”è¾ƒå¤šå¯¹å§ï¼Ÿè¯´ä¸€ä¸‹MySQLçš„InnoDBå¼•æ“çš„B+æ ‘ç´¢å¼•ï¼Œå®ƒæ˜¯ä»€ä¹ˆæ ·ä¸€ç§æ•°æ®ç»“æ„ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;B+æ ‘çš„è¯å®ƒä¸€èˆ¬æ¥è¯´å®ƒåªåœ¨å¶å­èŠ‚ç‚¹å»å­˜å‚¨çœŸå®æ•°æ®ã€‚ç„¶åå®ƒçš„éå¶å­èŠ‚ç‚¹çš„è¯ï¼Œå®ƒä¼šå­˜å‚¨ç´¢å¼•çš„ï¼Œå®ƒä¼šå­˜å‚¨ä¸€äº›ç´¢å¼•ã€‚ç„¶åçš„è¯å®ƒä¸€èˆ¬æ¥è¯´ç”¨è¿™ç§æ–¹æ³•çš„è¯ï¼Œç¬¬ä¸€å®ƒæ˜¯ç›¸å½“äºæ˜¯Bæ ‘çš„æ”¹è¿›ç‰ˆæœ¬ã€‚å› ä¸ºBæ ‘çš„è¯å®ƒæ¯ä¸ªèŠ‚ç‚¹å®ƒéƒ½ä¼šå­˜å‚¨ä¸€å®šçš„æ•°æ®å’Œç´¢å¼•ã€‚ä½†ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œå®ƒå¯èƒ½æ ‘çš„é«˜åº¦ä¼šå˜ä¼šå¢åŠ å¾—ç‰¹åˆ«å¿«ã€‚</p>
<p>ç„¶åå…¶æ¬¡å°±æ˜¯å®ƒæ¯æ¬¡IOçš„è¯å®ƒå¯èƒ½ä¼šè¯»å–å®ƒIOçš„æ¬¡æ•°å¯èƒ½ä¼šå˜å¤šã€‚å› ä¸ºå®ƒè¯»å–æ¯æ¬¡è¯»å–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒéƒ½è¦è¿›è¡Œä¸€æ¬¡IOï¼Œä½†æ˜¯ç”¨B+æ ‘çš„è¯ï¼Œå®ƒå°±æ˜¯ç´¢å¼•éƒ½èšé›†åœ¨ä¸€å—äº†ã€‚ç„¶åå®ƒè¯»å–çš„IOæ¬¡æ•°å°±ä¼šå‡å°‘ã€‚ç„¶åå®ƒIOæ¬¡æ•°å‡å°‘äº†ä»¥åï¼Œå®ƒæ•´ä½“çš„æ€§èƒ½å°±ä¼šï¼Œæ•´ä½“çš„æŸ¥è¯¢é€Ÿåº¦å°±ä¼šå˜å¿«ã€‚ç„¶åB+æ ‘å®ƒæœ€åä¸€å±‚çš„è¯ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯å®ƒä¼šæŠŠæ¯ä¸ªå¶å­èŠ‚ç‚¹ç”¨ä¸€ä¸ªæŒ‡é’ˆç»™å®ƒè¿èµ·æ¥ï¼Œè¿™æ ·å¯ä»¥å®ç°ä¸€ä¸ªèŒƒå›´çš„æŸ¥æ‰¾ã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å…³äºB+æ ‘ç´¢å¼•ï¼Œæˆ‘è§‰å¾—å›ç­”å¾—è¿˜å¯ä»¥ï¼Œå¯ä»¥å†è¡¥å……ä¸€äº›ç»†èŠ‚ï¼š</p>
<p>&quot;InnoDBä½¿ç”¨B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„æœ‰å‡ ä¸ªå…³é”®ç‰¹ç‚¹ï¼š</p>
<p>é¦–å…ˆï¼ŒB+æ ‘æ˜¯Bæ ‘çš„æ”¹è¿›ç‰ˆæœ¬ã€‚Bæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨é”®å€¼å’Œæ•°æ®ï¼Œè€ŒB+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ç”¨äºå¯¼èˆªã€‚</p>
<p>è¿™æ ·è®¾è®¡çš„ä¼˜åŠ¿æ˜¯ï¼šç¬¬ä¸€ï¼Œéå¶å­èŠ‚ç‚¹å¯ä»¥å­˜å‚¨æ›´å¤šçš„é”®å€¼ï¼Œå‡å°‘äº†æ ‘çš„é«˜åº¦ï¼Œä»è€Œå‡å°‘ç£ç›˜IOæ¬¡æ•°ï¼›ç¬¬äºŒï¼Œæ‰€æœ‰æ•°æ®éƒ½åœ¨å¶å­èŠ‚ç‚¹ï¼Œå¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥ï¼Œéå¸¸é€‚åˆèŒƒå›´æŸ¥è¯¢å’Œæ’åºæ“ä½œï¼›ç¬¬ä¸‰ï¼ŒæŸ¥è¯¢è·¯å¾„ç¨³å®šï¼Œä»»ä½•æŸ¥è¯¢éƒ½éœ€è¦ä»æ ¹èŠ‚ç‚¹èµ°åˆ°å¶å­èŠ‚ç‚¹ï¼Œæ€§èƒ½å¯é¢„æœŸã€‚</p>
<p>åœ¨InnoDBä¸­ï¼Œä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å®Œæ•´çš„è¡Œæ•°æ®ï¼Œå«åšèšç°‡ç´¢å¼•ï¼›è€Œè¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ï¼Œéœ€è¦å›è¡¨æŸ¥è¯¢è·å–å®Œæ•´æ•°æ®ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒInnoDBçš„B+æ ‘é«˜åº¦åœ¨2-4å±‚ï¼Œæ¯å±‚èƒ½å­˜å‚¨çš„æ•°æ®é‡æ˜¯æŒ‡æ•°çº§å¢é•¿çš„ï¼Œæ‰€ä»¥å³ä½¿åƒä¸‡çº§æ•°æ®ä¹Ÿèƒ½ä¿æŒå¾ˆå¥½çš„æŸ¥è¯¢æ€§èƒ½ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ¦‚å¿µå›ç­”æ­£ç¡®ï¼Œä½†å¯ä»¥æ›´æ·±å…¥</li>
<li>åº”è¯¥è¡¥å……èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«</li>
<li>å¯ä»¥ä¸¾ä¸€äº›å…·ä½“çš„æ•°æ®é‡å’Œæ€§èƒ½çš„ä¾‹å­</li>
</ul>
<h3 id="é—®é¢˜6ï¼šRedisåˆ†å¸ƒå¼é”">é—®é¢˜6ï¼šRedisåˆ†å¸ƒå¼é”</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œRedisæœ‰ç”¨è¿‡å—ï¼Ÿè¯´ä¸€ä¸‹Rediså¦‚æœä½œä¸ºåˆ†å¸ƒå¼é”ï¼Œå®ƒæ˜¯ä»€ä¹ˆæ ·ä¸€ä¸ªç‰¹æ€§å¯ä»¥æ‹¿æ¥ä½œä¸ºåˆ†å¸ƒå¼é”ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œRedisåˆ†å¸ƒå¼é”å¤§æ¦‚äº†è§£è¿‡ã€‚æˆ‘è®°å¾—å®ƒæ˜¯ä¸€ä¸ªï¼Œæˆ‘è®°å¾—å®ƒæ˜¯ä¸€ä¸ªå•å‘½ä»¤ï¼Œä»€ä¹ˆæ ·é‚£ä¸ªå‘½ä»¤ä»€ä¹ˆæ ·å‘½ä»¤æ˜¯lockå—ï¼Ÿsetnxï¼Œä¸æ˜¯ï¼Œå› ä¸ºæˆ‘è§‰å¾—è¿˜æ˜¯æ²¡ç”¨è¿‡ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>Redisåˆ†å¸ƒå¼é”ä¸»è¦åˆ©ç”¨çš„æ˜¯Redisçš„åŸå­æ€§æ“ä½œç‰¹æ€§ï¼š</p>
<p>&quot;Rediså¯ä»¥å®ç°åˆ†å¸ƒå¼é”ä¸»è¦æ˜¯å› ä¸ºå‡ ä¸ªç‰¹æ€§ï¼š</p>
<p>ç¬¬ä¸€ï¼ŒRedisæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå‘½ä»¤æ‰§è¡Œæ˜¯åŸå­æ€§çš„ï¼Œä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚</p>
<p>ç¬¬äºŒï¼Œå¯ä»¥ä½¿ç”¨SETNXï¼ˆSET if Not eXistsï¼‰å‘½ä»¤ï¼Œå®ƒåªæœ‰åœ¨keyä¸å­˜åœ¨æ—¶æ‰ä¼šè®¾ç½®æˆåŠŸï¼Œè¿™æ­£å¥½ç¬¦åˆé”çš„è¯­ä¹‰ - åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½è·å–åˆ°é”ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œå¯ä»¥é€šè¿‡EXPIREè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…æ­»é”é—®é¢˜ã€‚</p>
<p>å…·ä½“å®ç°æ—¶ï¼Œé€šå¸¸ä½¿ç”¨SETå‘½ä»¤çš„ç»„åˆå‚æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SET lock_key unique_value NX PX 30000</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥åŸå­æ€§åœ°è®¾ç½®keyå’Œè¿‡æœŸæ—¶é—´ã€‚</p>
<p>é‡Šæ”¾é”æ—¶éœ€è¦ä½¿ç”¨Luaè„šæœ¬æ¥ä¿è¯åŸå­æ€§ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼ŒRedisåˆ†å¸ƒå¼é”ä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼Œæ¯”å¦‚åœ¨ä¸»ä»æ¶æ„ä¸‹å¯èƒ½å‡ºç°é”ä¸¢å¤±çš„é—®é¢˜ï¼Œè¿™æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨Redlockç®—æ³•æˆ–è€…å…¶ä»–åˆ†å¸ƒå¼é”æ–¹æ¡ˆã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶ç¡®å®æ²¡æœ‰å®é™…ä½¿ç”¨ç»éªŒï¼Œå›ç­”å¾ˆç®€å•</li>
<li>åº”è¯¥è‡³å°‘äº†è§£åŸºæœ¬çš„å®ç°åŸç†</li>
<li>å¯ä»¥è¡¥å……å­¦ä¹ ä¸€äº›å®é™…çš„ä½¿ç”¨åœºæ™¯</li>
</ul>
<h3 id="é—®é¢˜7ï¼šé˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«åŠåº”ç”¨åœºæ™¯">é—®é¢˜7ï¼šé˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«åŠåº”ç”¨åœºæ™¯</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œè¯´ä¸€ä¸‹é˜Ÿåˆ—å’Œæ ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»–ä»¬åˆ†åˆ«å¯ä»¥åœ¨ä¸šåŠ¡ä¸Šä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä»€ä¹ˆæ ·çš„åœºæ™¯ä¸‹å»ä½¿ç”¨ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;é˜Ÿåˆ—çš„è¯ä¸€èˆ¬æ˜¯ç”¨åœ¨è¿™ç§å…ˆè¿›å…ˆå‡ºçš„æƒ…å†µã€‚å°±æ¯”å¦‚è¯´æˆ‘åˆšåˆšè¯´çš„é‚£ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæœ‰ä¸€ç§ä¹Ÿæ˜¯ä¸€ç§é˜Ÿåˆ—çš„æ•°æ®ç»“æ„ã€‚å®ƒè¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯å…ˆç”Ÿæˆçš„è®¢å•è¢«ï¼Œå°±æ˜¯å…ˆç”Ÿæˆçš„è®¢å•ä¼šå…ˆå¤„ç†ã€‚</p>
<p>ç„¶åæ ˆçš„è¯æ˜¯è¿™æ ·ä¸€ç§å…ˆè¿›åå‡ºçš„ä¸€ç§æ•°æ®ç»“æ„ã€‚ç„¶åå®ƒä¸€èˆ¬æ¥è¯´çš„è¯å°±æ˜¯æ¯”å¦‚è¯´æˆ‘ä»¬åœ¨å®è¡Œä¸€ä¸ªé€’å½’çš„æ“ä½œçš„æ—¶å€™ï¼Œå®ƒçš„é‚£ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ä¸€ä¸ªç”¨æ ˆçš„å®ç°æ¥ï¼Œç”¨è¿™æ ·çš„æ–¹å¼æ¥å®ç°çš„ã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>é˜Ÿåˆ—å’Œæ ˆçš„åŒºåˆ«åŠåº”ç”¨ï¼Œæˆ‘è§‰å¾—å½“æ—¶å›ç­”å¾—è¿˜å¯ä»¥ï¼Œå¯ä»¥å†ä¸°å¯Œä¸€äº›ï¼š</p>
<p>&quot;é˜Ÿåˆ—ï¼ˆQueueï¼‰æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œæ ˆï¼ˆStackï¼‰æ˜¯åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ã€‚</p>
<p>é˜Ÿåˆ—çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¦‚ä½ æåˆ°çš„è®¢å•å¤„ç†ï¼Œä¿è¯è¯·æ±‚æŒ‰é¡ºåºå¤„ç†</li>
<li>å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰ï¼šå±‚æ¬¡éå†æ ‘æˆ–å›¾</li>
<li>ä»»åŠ¡è°ƒåº¦ï¼šæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹è°ƒåº¦ï¼Œæ‰“å°æœºä»»åŠ¡é˜Ÿåˆ—</li>
<li>ç¼“å†²åŒºï¼šç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ä¸­çš„æ•°æ®ç¼“å†²</li>
</ul>
<p>æ ˆçš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å‡½æ•°è°ƒç”¨æ ˆï¼šå­˜å‚¨å‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
<li>æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰ï¼šé€’å½’éå†çš„æ¨¡æ‹Ÿ</li>
<li>è¡¨è¾¾å¼æ±‚å€¼ï¼šä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼</li>
<li>æµè§ˆå™¨å†å²è®°å½•ï¼šåè®¿é—®çš„é¡µé¢å…ˆè¿”å›</li>
<li>æ’¤é”€æ“ä½œï¼šç¼–è¾‘å™¨çš„Ctrl+ZåŠŸèƒ½</li>
</ul>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ¯”å¦‚åšä¸€ä¸ªè®¡ç®—å™¨åº”ç”¨ï¼Œè§£ææ•°å­¦è¡¨è¾¾å¼æ—¶å°±éœ€è¦ç”¨æ ˆæ¥å¤„ç†æ‹¬å·åŒ¹é…å’Œè¿ç®—ç¬¦ä¼˜å…ˆçº§ã€‚è€Œåšä¸€ä¸ªä»»åŠ¡ç³»ç»Ÿæ—¶ï¼Œé€šå¸¸ç”¨é˜Ÿåˆ—æ¥ä¿è¯ä»»åŠ¡çš„å…¬å¹³è°ƒåº¦ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ¦‚å¿µå›ç­”æ­£ç¡®</li>
<li>åº”ç”¨åœºæ™¯å¯ä»¥æ›´ä¸°å¯Œä¸€äº›</li>
<li>å¯ä»¥ç»“åˆå…·ä½“çš„æŠ€æœ¯å®ç°æ¥è¯´æ˜</li>
</ul>
<h3 id="é—®é¢˜8ï¼šæ·±åº¦ä¼˜å…ˆéå†å’Œå¹¿åº¦ä¼˜å…ˆéå†">é—®é¢˜8ï¼šæ·±åº¦ä¼˜å…ˆéå†å’Œå¹¿åº¦ä¼˜å…ˆéå†</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œè¯´ä¸€ä¸‹æ·±åº¦ä¼˜å…ˆéå†å’Œå¹¿åº¦ä¼˜å…ˆéå†åˆ†åˆ«æ˜¯ä»€ä¹ˆæ ·çš„ä¸€ç§éå†æ–¹å¼ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;æ·±åº¦ä¼˜å…ˆéå†çš„è¯ï¼Œæˆ‘ç›´æ¥åœ¨æ ‘è¿™ä¸ªç»“æ„ï¼Œå°±ä¸åœ¨å›¾é‡Œé¢å»è®²äº†ã€‚æ¯”å¦‚è¯´åœ¨æ ‘è¿™ä¸ªç»“æ„ä¸‹çš„è¯ï¼Œæ·±åº¦ä¼˜å…ˆéå†çš„è¯ï¼Œå®ƒä¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ä¸€çº§çº§éå†ã€‚å®ƒæ¯æ¬¡åªä¼šé€‰æ‹©ä¸€ä¸ªåˆ†æ”¯å»è¿›è¡Œéå†ï¼Œç„¶åæœ€åç¢°åˆ°äº†å¶å­èŠ‚ç‚¹ä»¥åå†è¿”å›ï¼Œä¸ä¸€å®šæ˜¯å¶å­èŠ‚ç‚¹ï¼Œå°±æ˜¯ç¢°åˆ°äº†æ¯”å¦‚è¯´å®ƒæ˜¯å…ˆå‘å·¦éå†ï¼Œé‚£å®ƒç¢°åˆ°æ²¡æœ‰å·¦èŠ‚ç‚¹ä»¥åï¼Œå®ƒä¼šç»§ç»­å‘å³éå†ã€‚ç„¶åç›¸å½“äºå®ƒå°±å…ˆå¾€æ·±å¤„éå†ï¼Œç„¶åæ…¢æ…¢å†å›æº¯ï¼Œç„¶åå†å¾€æ·±å¤„éå†ï¼Œæ˜¯è¿™æ ·ä¸€ä¸ªæ“ä½œè¿‡ç¨‹ã€‚</p>
<p>è€Œå¹¿åº¦ä¼˜å…ˆéå†çš„è¯å®ƒæ˜¯ä¸€å±‚ä¸€å±‚çš„éå†ï¼Œå®ƒå°±æ˜¯æœ‰ç§é‚£ç§æ¯”è¾ƒå‘æ•£çš„é‚£ç§æ„Ÿè§‰ã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å…³äºDFSå’ŒBFSï¼Œæˆ‘è§‰å¾—å¯ä»¥è¿™æ ·è§£é‡Šä¼šæ›´æ¸…æ¥šï¼š</p>
<p>&quot;æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰å’Œå¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„å›¾/æ ‘éå†ç­–ç•¥ï¼š</p>
<p>æ·±åº¦ä¼˜å…ˆéå†çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å°½å¯èƒ½æ·±åœ°è®¿é—®èŠ‚ç‚¹ï¼Œç›´åˆ°æ— æ³•ç»§ç»­ä¸ºæ­¢ï¼Œç„¶åå›æº¯</li>
<li>ä½¿ç”¨æ ˆï¼ˆé€’å½’æˆ–æ˜¾å¼æ ˆï¼‰æ¥å®ç°</li>
<li>ç©ºé—´å¤æ‚åº¦ç›¸å¯¹è¾ƒä½ï¼Œä¸ºO(h)ï¼Œhæ˜¯æ ‘çš„é«˜åº¦</li>
<li>é€‚ç”¨åœºæ™¯ï¼šæ‰¾è·¯å¾„ã€æ£€æµ‹ç¯ã€æ‹“æ‰‘æ’åºç­‰</li>
</ul>
<p>å¹¿åº¦ä¼˜å…ˆéå†çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>é€å±‚è®¿é—®èŠ‚ç‚¹ï¼Œå…ˆè®¿é—®è·ç¦»æ ¹èŠ‚ç‚¹è¿‘çš„èŠ‚ç‚¹</li>
<li>ä½¿ç”¨é˜Ÿåˆ—æ¥å®ç°</li>
<li>ç©ºé—´å¤æ‚åº¦ä¸ºO(w)ï¼Œwæ˜¯æ ‘çš„æœ€å¤§å®½åº¦</li>
<li>é€‚ç”¨åœºæ™¯ï¼šæ‰¾æœ€çŸ­è·¯å¾„ã€å±‚æ¬¡éå†ã€è¿é€šæ€§æ£€æµ‹</li>
</ul>
<p>ä¸¾ä¸ªå…·ä½“ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \</span><br><span class="line">4   5</span><br></pre></td></tr></table></figure>
<p>DFSé¡ºåºï¼š1 -&gt; 2 -&gt; 4 -&gt; 5 -&gt; 3<br>
BFSé¡ºåºï¼š1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¯”å¦‚åœ¨ç¤¾äº¤ç½‘ç»œä¸­æ‰¾æœ‹å‹å…³ç³»ï¼Œå¦‚æœè¦æ‰¾æœ€è¿‘çš„å…±åŒå¥½å‹ï¼Œç”¨BFSæ¯”è¾ƒåˆé€‚ï¼›å¦‚æœè¦éå†æ•´ä¸ªå…³ç³»ç½‘ç»œï¼ŒDFSå¯èƒ½æ›´èŠ‚çœå†…å­˜ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ€æƒ³è§£é‡Šæ­£ç¡®</li>
<li>å¯ä»¥è¡¥å……å®ç°æ–¹å¼å’Œå¤æ‚åº¦åˆ†æ</li>
<li>åº”è¯¥ç»“åˆå…·ä½“ä¾‹å­æ¥è¯´æ˜</li>
</ul>
<h3 id="é—®é¢˜9ï¼šä»£ç é¢˜ç¯èŠ‚">é—®é¢˜9ï¼šä»£ç é¢˜ç¯èŠ‚</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œç°åœ¨åšä¸ªä»£ç è€ƒæ ¸ï¼Œæ—¶é—´å¤§æ¦‚15åˆ°20åˆ†é’Ÿã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>[åœ¨ä»£ç ç¯èŠ‚é‡åˆ°äº†åç¨‹ç›¸å…³çš„é—®é¢˜ï¼Œæœ€åæ²¡æœ‰å®Œå…¨è§£å†³]<br>
â€œè¿™ä¸ªæˆ‘å®åœ¨æ˜¯æƒ³ä¸èµ·æ¥äº†â€¦è¿™ä¸ªåç¨‹ä¸æ€ä¹ˆç”¨ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>ä»£ç é¢˜éƒ¨åˆ†ç¡®å®æ˜¯æˆ‘çš„è–„å¼±ç¯èŠ‚ï¼Œä¸»è¦æš´éœ²äº†ä»¥ä¸‹é—®é¢˜ï¼š</p>
<p>&quot;è™½ç„¶æˆ‘äº†è§£Goè¯­è¨€çš„åŸºæœ¬è¯­æ³•å’Œæ¦‚å¿µï¼Œä½†åœ¨å®é™…ç¼–ç¨‹å®ç°ä¸Šè¿˜éœ€è¦æ›´å¤šç»ƒä¹ ã€‚ç‰¹åˆ«æ˜¯åç¨‹ç›¸å…³çš„ä»£ç ï¼Œå¹³æ—¶è™½ç„¶çŸ¥é“ç†è®ºï¼Œä½†æ‰‹å†™ä»£ç çš„ç»éªŒä¸è¶³ã€‚</p>
<p>è¿™æé†’æˆ‘éœ€è¦ï¼š</p>
<ol>
<li>å¤šåšä¸€äº›Goè¯­è¨€çš„ç¼–ç¨‹ç»ƒä¹ ï¼Œç‰¹åˆ«æ˜¯å¹¶å‘ç›¸å…³çš„</li>
<li>ç†Ÿæ‚‰å¸¸è§çš„ä»£ç æ¨¡å¼å’Œæœ€ä½³å®è·µ</li>
<li>å‡†å¤‡ä¸€äº›ç»å…¸çš„ä»£ç é¢˜ï¼Œæ¯”å¦‚åç¨‹æ± ã€ç”Ÿäº§è€…æ¶ˆè´¹è€…ç­‰</li>
<li>å¹³æ—¶å¼€å‘ä¸­åº”è¯¥æ›´å¤šåœ°ä½¿ç”¨Goçš„å¹¶å‘ç‰¹æ€§</li>
</ol>
<p>å»ºè®®å…¶ä»–åŒå­¦åœ¨å‡†å¤‡é¢è¯•æ—¶ï¼Œä¸ä»…è¦æŒæ¡ç†è®ºçŸ¥è¯†ï¼Œè¿˜è¦æœ‰è¶³å¤Ÿçš„ç¼–ç å®è·µï¼Œè¿™æ ·åœ¨é¢è¯•ä¸­æ‰èƒ½æ›´å¥½åœ°å±•ç°è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>ç†è®ºçŸ¥è¯†æŒæ¡å°šå¯ï¼Œä½†ç¼–ç¨‹å®è·µä¸è¶³</li>
<li>éœ€è¦åŠ å¼ºä»£ç é¢˜çš„è®­ç»ƒ</li>
<li>åº”è¯¥å‡†å¤‡ä¸€äº›å¸¸è§çš„Goå¹¶å‘ç¼–ç¨‹æ¨¡å¼</li>
</ul>
<h2 id="é¢è¯•æ•´ä½“æ„Ÿå—">é¢è¯•æ•´ä½“æ„Ÿå—</h2>
<ul>
<li><strong>éš¾åº¦è¯„ä»·</strong>: é€‚ä¸­ï¼Œä¸»è¦è€ƒå¯ŸåŸºç¡€çŸ¥è¯†å’Œç†è§£æ·±åº¦</li>
<li><strong>é¢è¯•å®˜é£æ ¼</strong>: ä¸“ä¸šå‹å–„ï¼Œä¼šæ ¹æ®å›ç­”æƒ…å†µè¿›è¡Œæ·±å…¥è¿½é—®</li>
<li><strong>é¢˜ç›®ç±»å‹</strong>: ä¸»è¦è€ƒå¯ŸGoè¯­è¨€åŸºç¡€ã€æ•°æ®åº“åŸç†ã€æ•°æ®ç»“æ„ç®—æ³•ï¼Œè¿˜æœ‰ç¼–ç¨‹å®è·µèƒ½åŠ›</li>
<li><strong>å‡†å¤‡å»ºè®®</strong>: éœ€è¦ç³»ç»Ÿå¤ä¹ Goè¯­è¨€ç‰¹æ€§ï¼ŒåŠ å¼ºç¼–ç¨‹å®è·µï¼Œå‡†å¤‡å¸¸è§çš„æŠ€æœ¯é—®é¢˜</li>
</ul>
<h2 id="é¢è¯•ç»“æœ">é¢è¯•ç»“æœ</h2>
<ul>
<li><strong>å½“åœºåé¦ˆ</strong>: é¢è¯•å®˜æ²¡æœ‰ç»™å‡ºæ˜ç¡®åé¦ˆï¼Œæ•´ä½“æ°›å›´æ¯”è¾ƒå‹å¥½</li>
<li><strong>åç»­æµç¨‹</strong>: ç­‰å¾…HRé€šçŸ¥ï¼Œä½†æœ€ç»ˆæ²¡æœ‰è¿›å…¥ä¸‹ä¸€è½®</li>
<li><strong>ä¸ªäººæ„Ÿå—</strong>: åŸºç¡€çŸ¥è¯†å›ç­”è¿˜å¯ä»¥ï¼Œä½†ä»£ç å®ç°èƒ½åŠ›æœ‰å¾…æé«˜</li>
</ul>
<h2 id="ç»éªŒæ€»ç»“">ç»éªŒæ€»ç»“</h2>
<h3 id="åšå¾—å¥½çš„åœ°æ–¹">åšå¾—å¥½çš„åœ°æ–¹</h3>
<ul>
<li>é¡¹ç›®ä»‹ç»æ¯”è¾ƒæ¸…æ™°ï¼ŒæŠ€æœ¯æ ˆåŒ¹é…åº¦è¾ƒé«˜</li>
<li>åŸºç¡€æ¦‚å¿µæŒæ¡ç›¸å¯¹æ‰å®</li>
<li>é¢è¯•è¿‡ç¨‹ä¸­æ¯”è¾ƒè¯šå®ï¼Œä¸ä¼šçš„åœ°æ–¹å¦è¯šæ‰¿è®¤</li>
</ul>
<h3 id="éœ€è¦æ”¹è¿›çš„åœ°æ–¹">éœ€è¦æ”¹è¿›çš„åœ°æ–¹</h3>
<ul>
<li>éƒ¨åˆ†æ¦‚å¿µç†è§£ä¸å¤Ÿæ·±å…¥ï¼Œå¦‚åƒåœ¾å›æ”¶æœºåˆ¶</li>
<li>ç¼–ç¨‹å®è·µèƒ½åŠ›éœ€è¦åŠ å¼ºï¼Œç‰¹åˆ«æ˜¯å¹¶å‘ç¼–ç¨‹</li>
<li>åº”è¯¥å‡†å¤‡æ›´å¤šçš„å…·ä½“ä»£ç ç¤ºä¾‹</li>
</ul>
<h3 id="å‡†å¤‡å»ºè®®">å‡†å¤‡å»ºè®®</h3>
<ol>
<li><strong>ç³»ç»Ÿå­¦ä¹ Goè¯­è¨€</strong>ï¼šä¸ä»…è¦çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œè¿˜è¦çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•åº”ç”¨</li>
<li><strong>åŠ å¼ºç¼–ç¨‹ç»ƒä¹ </strong>ï¼šå¤šåšä¸€äº›Goè¯­è¨€çš„å®é™…é¡¹ç›®å’Œä»£ç é¢˜</li>
<li><strong>æ·±å…¥ç†è§£åŸç†</strong>ï¼šå¯¹äºæ•°æ®åº“ã€ç¼“å­˜ç­‰åŸºç¡€è®¾æ–½è¦æœ‰æ›´æ·±å…¥çš„ç†è§£</li>
<li><strong>å‡†å¤‡é¡¹ç›®ç»†èŠ‚</strong>ï¼šèƒ½å¤Ÿæ·±å…¥è®²è§£é¡¹ç›®ä¸­çš„æŠ€æœ¯å†³ç­–å’Œå®ç°ç»†èŠ‚</li>
<li><strong>å…³æ³¨ä¸šåŠ¡åœºæ™¯</strong>ï¼šäº†è§£ç›®æ ‡å…¬å¸çš„ä¸šåŠ¡ï¼Œå‡†å¤‡ç›¸å…³çš„æŠ€æœ¯é—®é¢˜</li>
</ol>
<h3 id="çŸ¥è¯†ç‚¹å¤ä¹ ">çŸ¥è¯†ç‚¹å¤ä¹ </h3>
<ul>
<li>Goè¯­è¨€GMPæ¨¡å‹å’Œè°ƒåº¦æœºåˆ¶</li>
<li>Goè¯­è¨€å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶</li>
<li>Goå¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ</li>
<li>MySQLç´¢å¼•åŸç†å’Œä¼˜åŒ–</li>
<li>Redisæ•°æ®ç»“æ„å’Œåº”ç”¨åœºæ™¯</li>
<li>å¸¸è§æ•°æ®ç»“æ„å’Œç®—æ³•çš„å®ç°</li>
<li>å¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼</li>
</ul>
]]></content>
      <categories>
        <category>é¢è¯•ç»éªŒ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ä¸€é¢</tag>
        <tag>è”šæ¥</tag>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>Bç«™ æµ‹è¯•å¼€å‘å·¥ç¨‹å¸ˆ ä¸€é¢</title>
    <url>/2025/06/22/%E9%9D%A2%E8%AF%95%E9%A2%98/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E5%8E%82/B%E7%AB%99/2025-02-08-B%E7%AB%99-%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91-%E4%B8%80%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="é¢è¯•åŸºæœ¬ä¿¡æ¯">é¢è¯•åŸºæœ¬ä¿¡æ¯</h2>
<ul>
<li><strong>å…¬å¸</strong>: Bç«™ï¼ˆå“”å“©å“”å“©ï¼‰</li>
<li><strong>èŒä½</strong>: æµ‹è¯•å¼€å‘å·¥ç¨‹å¸ˆï¼ˆæ—¥å¸¸å®ä¹ ï¼‰</li>
<li><strong>é¢è¯•è½®æ¬¡</strong>: ä¸€é¢ï¼ˆæŠ€æœ¯é¢ï¼‰</li>
<li><strong>é¢è¯•å½¢å¼</strong>: çº¿ä¸Šè§†é¢‘é¢è¯•</li>
<li><strong>é¢è¯•æ—¶é•¿</strong>: çº¦65åˆ†é’Ÿ</li>
<li><strong>é¢è¯•å®˜</strong>: æŠ€æœ¯é¢è¯•å®˜</li>
</ul>
<h2 id="é¢è¯•é—®é¢˜ä¸å›ç­”">é¢è¯•é—®é¢˜ä¸å›ç­”</h2>
<h3 id="é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»">é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œé¦–å…ˆæ¬¢è¿ä½ å‚åŠ æœ¬æ¬¡é¢è¯•ï¼Œå…ˆè¯·ä½ åšä¸€ä¸ªè‡ªæˆ‘ä»‹ç»ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä½ å¥½ï¼Œæˆ‘æ˜¯ç‹å®‡å“²ï¼Œç„¶åæ˜¯ä¸€ä¸ªç ”ä¸€çš„å­¦ç”Ÿï¼Œç°åœ¨å°±è¯»äºåä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹ä¸“ä¸šï¼Œç ”ç©¶æ–¹å‘æ˜¯å¯†ç å­¦æ–¹å‘ã€‚æˆ‘ç°åœ¨ä¸»è¦çš„æŠ€æœ¯æ ˆåœ¨Goè¯­è¨€è¿™ä¸€å—ï¼Œä½†æ˜¯ä¹Ÿæ¥è§¦è¿‡ä¸€äº›æµ‹è¯•ç›¸å…³çš„çŸ¥è¯†ã€‚æˆ‘åšè¿‡ä¸€äº›é¡¹ç›®ï¼Œæ¯”å¦‚è¯´æŠ–éŸ³å•†åŸï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºGoè¯­è¨€ã€gRPCï¼Œç„¶åå„ç§å¾®æœåŠ¡ç»„ä»¶ç»„åˆèµ·æ¥æ„æˆçš„ä¸€ä¸ªå¾®æœåŠ¡æ¡†æ¶çš„é¡¹ç›®ã€‚ç„¶åè¿˜æœ‰ä¸€ä¸ªæ˜¯AI Nexusï¼Œæ˜¯æˆ‘è‡ªå·±åšçš„ä¸€ä¸ªå°é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªä½¿ç”¨AIçš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¤šä»£ç†ç³»ç»Ÿï¼Œå·®ä¸å¤šå°±è¿™äº›ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è‡ªæˆ‘ä»‹ç»è¦æ›´åŠ ç»“æ„åŒ–ä¸€äº›ï¼Œå»ºè®®è¿™æ ·ç»„ç»‡ï¼š</p>
<p>&quot;æ‚¨å¥½ï¼Œæˆ‘æ˜¯XXXï¼Œç›®å‰æ˜¯åä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹ä¸“ä¸šçš„ç ”ä¸€å­¦ç”Ÿï¼Œç ”ç©¶æ–¹å‘æ˜¯å¯†ç å­¦ã€‚åœ¨æŠ€æœ¯æ ˆæ–¹é¢ï¼Œæˆ‘ä¸»è¦ä¸“æ³¨äºGoè¯­è¨€åç«¯å¼€å‘ï¼ŒåŒæ—¶ä¹Ÿæœ‰æµ‹è¯•ç›¸å…³çš„å®è·µç»éªŒã€‚</p>
<p>åœ¨é¡¹ç›®ç»éªŒæ–¹é¢ï¼Œæˆ‘å‚ä¸äº†å­—èŠ‚è·³åŠ¨é’è®­è¥çš„æŠ–éŸ³å•†åŸé¡¹ç›®ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºGoè¯­è¨€çš„å¾®æœåŠ¡æ¶æ„é¡¹ç›®ï¼Œä½¿ç”¨äº†gRPCã€æœåŠ¡å‘ç°ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æŠ€æœ¯ã€‚å¦å¤–æˆ‘è¿˜ç‹¬ç«‹å¼€å‘äº†AI Nativeé¡¹ç›®ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤šä»£ç†AIç³»ç»Ÿã€‚</p>
<p>é™¤äº†é¡¹ç›®ç»éªŒï¼Œæˆ‘è¿˜æœ‰å®é™…çš„å®ä¹ ç»å†ï¼Œè´Ÿè´£è¿‡CMSç³»ç»Ÿå¼€å‘å’ŒCI/CDæµæ°´çº¿æ­å»ºç­‰å·¥ä½œã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å›ç­”æ¯”è¾ƒéšæ„ï¼Œç»“æ„æ€§ä¸å¼º</li>
<li>å¯¹é¡¹ç›®çš„æè¿°ä¸å¤Ÿæ¸…æ™°</li>
<li>åº”è¯¥çªå‡ºä¸æµ‹è¯•å¼€å‘ç›¸å…³çš„ç»éªŒ</li>
</ul>
<h3 id="é—®é¢˜2ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Goè¯­è¨€">é—®é¢˜2ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Goè¯­è¨€</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä¸ºä»€ä¹ˆé€‰æ‹©åšGoè¯­è¨€å‘¢ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œå› ä¸ºGoè¯­è¨€çš„è¯æˆ‘è§‰å¾—å®ƒç¬¬ä¸€å®ƒæ¯”è¾ƒç®€æ´ï¼Œå°±æ˜¯ä»æˆ‘ä¸ªäººå¼€å‘è§’åº¦æ¥è¯´ï¼Œæˆ‘è§‰å¾—å®ƒæ¯”è¾ƒç®€æ´ã€‚ç„¶åæˆ‘è‡ªå·±åšçš„æ—¶å€™ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œèƒ½éƒ¨ç½²åˆ°æˆ‘è‡ªå·±çš„æœåŠ¡å™¨ä¸Šé¢å»ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚å› ä¸ºå®ƒç¼–è¯‘å¥½è¿è¡Œä»¥åå¯ä»¥ç›´æ¥éƒ¨ç½²ä¸Šå»ã€‚ä½†Javaçš„è¯ï¼Œæˆ‘æœåŠ¡å™¨å®ƒå¯èƒ½ä¼šå› ä¸ºè¿˜è¦è¿è¡Œä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæ‰€ä»¥è¯´å®ƒå¯èƒ½ä¼šæœ‰ç‚¹æ…¢ã€‚æ‰€ä»¥è¯´ä»æˆ‘ä¸ªäººå¼€å‘è§’åº¦æ¥è¯´ï¼Œæˆ‘å€¾å‘äºä½¿ç”¨Goã€‚å…¶æ¬¡æ˜¯Goçš„è¯­æ³•çš„è¯ï¼Œæˆ‘è§‰å¾—æ˜¯æ¯”è¾ƒç®€å•æ˜“æ‡‚çš„ï¼Œå› ä¸ºå®ƒæœ‰ç‚¹åƒæ˜¯é¢å‘è¿‡ç¨‹çš„é‚£ç§è¯­è¨€ï¼ŒJavaçš„è¯å®ƒå¯èƒ½çœ‹èµ·æ¥ä»£ç é‡ä¼šå¤§ä¸€ç‚¹ï¼Œå½“ç„¶å®ƒä¸æ˜¯çœŸçš„å¤§ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å› ä¸ºæˆ‘ä¸ªäººæ„Ÿè§‰Goè¯­è¨€ï¼Œå¯¹æˆ‘è‡ªå·±çš„ä½¿ç”¨è€Œè¨€ä¼šæ›´èˆ’æœä¸€äº›ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>é€‰æ‹©Goè¯­è¨€ä¸»è¦æœ‰å‡ ä¸ªåŸå› ï¼š</p>
<p>é¦–å…ˆæ˜¯éƒ¨ç½²ç®€å•ï¼ŒGoæ˜¯ç¼–è¯‘å‹è¯­è¨€ï¼Œå¯ä»¥ç›´æ¥ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéƒ¨ç½²æ—¶ä¸éœ€è¦é¢å¤–çš„è¿è¡Œç¯å¢ƒï¼Œè¿™å¯¹ä¸ªäººé¡¹ç›®å’Œå°å›¢é˜Ÿç‰¹åˆ«å‹å¥½ã€‚</p>
<p>å…¶æ¬¡æ˜¯è¯­æ³•ç®€æ´æ¸…æ™°ï¼ŒGoçš„è®¾è®¡ç†å¿µå°±æ˜¯ç®€å•ä¼˜é›…ï¼Œå­¦ä¹ æ›²çº¿ç›¸å¯¹å¹³ç¼“ï¼Œä»£ç å¯è¯»æ€§å¾ˆå¥½ã€‚</p>
<p>å¦å¤–Goåœ¨å¹¶å‘ç¼–ç¨‹æ–¹é¢æœ‰å¤©ç„¶ä¼˜åŠ¿ï¼Œgoroutineå’Œchannelçš„è®¾è®¡è®©å¹¶å‘ç¼–ç¨‹å˜å¾—ç®€å•å®‰å…¨ã€‚</p>
<p>æœ€åæ˜¯æ€§èƒ½è¡¨ç°ï¼ŒGoçš„æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œå†…å­˜å ç”¨ä¹Ÿç›¸å¯¹è¾ƒå°ï¼Œç‰¹åˆ«é€‚åˆäº‘åŸç”Ÿå’Œå¾®æœåŠ¡åœºæ™¯ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å›ç­”äº†åŸºæœ¬æƒ³æ³•ï¼Œä½†è¡¨è¾¾ä¸å¤Ÿä¸“ä¸š</li>
<li>å¯ä»¥æ›´å¤šä»æŠ€æœ¯ç‰¹æ€§è§’åº¦åˆ†æ</li>
</ul>
<h3 id="é—®é¢˜3ï¼šå®ä¹ ç»å†ä»‹ç»">é—®é¢˜3ï¼šå®ä¹ ç»å†ä»‹ç»</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘çœ‹ä½ ä¹‹å‰è¿˜æœ‰ä¸€ä¸ªå®ä¹ ç»å†æ˜¯å§ï¼Ÿè¿™ä¸ªæ˜¯ä½ ä»¬è¯´ä¸€ä¸‹ä½ è¿™ä¸ªå®ä¹ ç»å†çš„ä¸»è¦å·¥ä½œæœ‰å“ªäº›ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š<br>
æè¿°äº†åœ¨å®ä¹ æœŸé—´ä¸»è¦åšPHPå®˜ç½‘ç³»ç»Ÿé‡æ„ã€æ•°æ®åº“è¿ç§»ï¼ˆSQLiteåˆ°MySQLï¼‰ã€CI/CDæµæ°´çº¿æ­å»ºç­‰å·¥ä½œã€‚</p>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>æˆ‘çš„å®ä¹ ä¸»è¦è´Ÿè´£ä¸‰ä¸ªæ–¹é¢çš„å·¥ä½œï¼š</p>
<p>ç¬¬ä¸€æ˜¯å®˜ç½‘ç³»ç»Ÿé‡æ„ï¼Œä½¿ç”¨PHPæŠ€æœ¯æ ˆé‡æ–°è®¾è®¡äº†æ¨¡æ¿æ¸²æŸ“å¼•æ“ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å®ç°å˜é‡æå–å’Œæ›¿æ¢ã€‚</p>
<p>ç¬¬äºŒæ˜¯æ•°æ®åº“è¿ç§»ï¼Œå°†åŸæœ‰çš„SQLiteæ•°æ®åº“è¿ç§»åˆ°MySQLï¼Œå¤„ç†äº†æ•°æ®ç±»å‹å…¼å®¹æ€§é—®é¢˜ï¼Œç¼–å†™Pythonè„šæœ¬å®Œæˆäº†600å¤šæ¡æ–°é—»æ•°æ®çš„è¿ç§»ã€‚</p>
<p>ç¬¬ä¸‰æ˜¯æ­å»ºCI/CDæµæ°´çº¿ï¼Œä½¿ç”¨é˜¿é‡Œäº‘æ•ˆå¹³å°å®ç°äº†è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå»ºç«‹äº†æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„åˆ†ç¦»ï¼Œå°†éƒ¨ç½²å‘¨æœŸä»ä¸¤å‘¨ç¼©çŸ­åˆ°3-4å¤©ã€‚</p>
<p>è¿™äº›å·¥ä½œè®©æˆ‘äº†è§£äº†å®Œæ•´çš„é¡¹ç›®å¼€å‘æµç¨‹ï¼Œç‰¹åˆ«æ˜¯è´¨é‡ä¿éšœå’Œè‡ªåŠ¨åŒ–éƒ¨ç½²çš„é‡è¦æ€§ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>é¡¹ç›®ç»éªŒæ¯”è¾ƒå®Œæ•´</li>
<li>ä½“ç°äº†ä¸€å®šçš„å·¥ç¨‹åŒ–æ€ç»´</li>
<li>ä¸æµ‹è¯•å¼€å‘å²—ä½æœ‰ä¸€å®šå…³è”æ€§</li>
</ul>
<h3 id="é—®é¢˜4ï¼šæŠ–éŸ³å•†åŸé¡¹ç›®è¯¦è§£">é—®é¢˜4ï¼šæŠ–éŸ³å•†åŸé¡¹ç›®è¯¦è§£</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘çœ‹ä½ å»å»ä»è¿‘æœŸåœ¨åšçš„ä¸€ä¸ªé¡¹ç›®æ˜¯æŠ–éŸ³å•†åŸè¿™ä¸ªé¡¹ç›®ã€‚å¯¹ï¼Œä½ èƒ½å¤§æ¦‚è¯´ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„åŠŸèƒ½æœ‰å“ªäº›å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š<br>
è¯¦ç»†ä»‹ç»äº†æŠ–éŸ³å•†åŸé¡¹ç›®çš„å¾®æœåŠ¡æ¶æ„ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ¨¡å—ã€æˆæƒæ¨¡å—ã€å‰ç«¯æ¨¡å—ã€è®¢å•æ¨¡å—ã€è´­ç‰©è½¦æ¨¡å—ã€å•†å“æ¨¡å—ã€ç»“ç®—å’Œæ”¯ä»˜æ¨¡å—ç­‰ã€‚</p>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>æŠ–éŸ³å•†åŸæ˜¯ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„ç”µå•†ç³»ç»Ÿï¼Œæˆ‘ä¸»è¦è´Ÿè´£ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š</p>
<ol>
<li>ç”¨æˆ·è®¤è¯æˆæƒï¼šå®ç°JWTä»¤ç‰Œåˆ†å‘ã€æƒé™æ ¡éªŒå’Œé»‘åå•æœºåˆ¶</li>
<li>å‰ç«¯ç½‘å…³ï¼šè´Ÿè´£è¯·æ±‚è·¯ç”±å’Œæƒé™éªŒè¯ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè·¯å¾„åŒ¹é…</li>
<li>è®¢å•ç³»ç»Ÿï¼šåŒ…æ‹¬ä¸‹å•æµç¨‹ã€åº“å­˜æ ¡éªŒã€æ”¯ä»˜é›†æˆå’Œè®¢å•è¶…æ—¶å¤„ç†</li>
<li>å•†å“æœç´¢ï¼šä½¿ç”¨Elasticsearchå®ç°å•†å“çš„æ¨¡ç³Šæœç´¢</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šä½¿ç”¨RocketMQå®ç°è®¢å•å¤„ç†çš„å‰Šå³°å¡«è°·</li>
</ol>
<p>åœ¨æŠ€æœ¯æ¶æ„ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆNacosï¼‰ã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªã€æ—¥å¿—æ”¶é›†ç­‰å¯è§‚æµ‹æ€§ç»„ä»¶ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>é¡¹ç›®ç»éªŒä¸°å¯Œï¼ŒæŠ€æœ¯æ ˆå®Œæ•´</li>
<li>å¯¹å¾®æœåŠ¡æ¶æ„æœ‰å®é™…ç†è§£</li>
<li>ä½“ç°äº†ä¸€å®šçš„æ¶æ„è®¾è®¡èƒ½åŠ›</li>
</ul>
<h3 id="é—®é¢˜5ï¼šæ¶ˆæ¯é˜Ÿåˆ—åŸç†">é—®é¢˜5ï¼šæ¶ˆæ¯é˜Ÿåˆ—åŸç†</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ èƒ½è¯´ä¸€ä¸‹è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆæ ·å­çš„å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæ¶ˆæ¯é˜Ÿåˆ—åº•å±‚çš„è¯åº”è¯¥æ˜¯æ˜¯æˆ‘æ²¡æœ‰äº†è§£å¤ªå¤šï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰ä»–åº”è¯¥å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ã€‚å› ä¸ºä»–æˆ‘éƒ¨ç½²çš„æ—¶å€™ï¼Œæˆ‘å‘ç°ä»–æœ‰ä¸€ä¸ªå«name serverï¼Œè¿˜æœ‰ä¸€ä¸ªå«ä»–åº”è¯¥æ˜¯ä¸€ä¸ªä¸»ä»ç»“æ„çš„ã€‚ç„¶åä»–æ¶ˆæ¯çš„è¯åº”è¯¥æ˜¯ä»–å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ç„¶åã€‚å®ƒåº•å±‚åº”è¯¥å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç›´è§‚ä¸Šçœ‹ä¸Šå»å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>RocketMQçš„åº•å±‚åŸç†å¯ä»¥ä»å‡ ä¸ªå±‚é¢æ¥è¯´ï¼š</p>
<p>é¦–å…ˆæ˜¯æ¶æ„ç»„æˆï¼Œä¸»è¦åŒ…æ‹¬Name Serverï¼ˆæœåŠ¡å‘ç°ï¼‰ã€Brokerï¼ˆæ¶ˆæ¯å­˜å‚¨ï¼‰ã€Producerï¼ˆç”Ÿäº§è€…ï¼‰å’ŒConsumerï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚</p>
<p>å­˜å‚¨æœºåˆ¶ä¸Šï¼ŒRocketMQä½¿ç”¨CommitLogè¿›è¡Œé¡ºåºå†™å…¥ï¼Œé€šè¿‡ConsumerQueueå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·æ—¢ä¿è¯äº†å†™å…¥æ€§èƒ½ï¼Œåˆæ”¯æŒé«˜æ•ˆçš„æ¶ˆæ¯æ£€ç´¢ã€‚</p>
<p>åœ¨é«˜å¯ç”¨æ–¹é¢ï¼ŒBrokeræ”¯æŒä¸»ä»å¤åˆ¶ï¼ŒName Serveré‡‡ç”¨æ— çŠ¶æ€è®¾è®¡ï¼Œé¿å…äº†å•ç‚¹æ•…éšœã€‚</p>
<p>æ¶ˆæ¯çš„å¯é æ€§é€šè¿‡åŒæ­¥/å¼‚æ­¥åˆ·ç›˜ã€ä¸»ä»åŒæ­¥ç­‰æœºåˆ¶æ¥ä¿è¯ã€‚</p>
<p>åœ¨æ¶ˆè´¹æ¨¡å¼ä¸Šï¼Œæ”¯æŒæ¨æ‹‰ä¸¤ç§æ¨¡å¼ï¼Œå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡å’Œå¹¿æ’­æ¶ˆè´¹ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¯¹æ¶ˆæ¯é˜Ÿåˆ—çš„ç†è§£æ¯”è¾ƒæµ…å±‚</li>
<li>éœ€è¦æ·±å…¥å­¦ä¹ ä¸­é—´ä»¶çš„åº•å±‚åŸç†</li>
<li>å®é™…ä½¿ç”¨ç»éªŒæœ‰ï¼Œä½†ç†è®ºåŸºç¡€éœ€è¦åŠ å¼º</li>
</ul>
<h3 id="é—®é¢˜6ï¼šæ•°æ®åº“åŸºç¡€">é—®é¢˜6ï¼šæ•°æ®åº“åŸºç¡€</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œè¯´ä¸€ä¸‹åŸºæœ¬çš„å¢åˆ æ”¹çš„å…³é”®å­—ï¼Œå‘¨å–„æ”¹æŸ¥ï¼Œå¢åˆ æ”¹æŸ¥å››ä¸ªã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š<br>
ä»‹ç»äº†SELECTã€INSERT INTOã€UPDATEã€DELETEçš„åŸºæœ¬è¯­æ³•ã€‚</p>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>MySQLçš„åŸºæœ¬CRUDæ“ä½œï¼š</p>
<p>æŸ¥è¯¢ï¼ˆSELECTï¼‰ï¼š<code>SELECT å­—æ®µ FROM è¡¨å WHERE æ¡ä»¶ GROUP BY å­—æ®µ HAVING æ¡ä»¶ ORDER BY å­—æ®µ</code></p>
<p>æ’å…¥ï¼ˆINSERTï¼‰ï¼š</p>
<ul>
<li><code>INSERT INTO è¡¨å VALUES (å€¼åˆ—è¡¨)</code></li>
<li><code>INSERT INTO è¡¨å (å­—æ®µåˆ—è¡¨) VALUES (å€¼åˆ—è¡¨)</code></li>
</ul>
<p>æ›´æ–°ï¼ˆUPDATEï¼‰ï¼š<code>UPDATE è¡¨å SET å­—æ®µ=å€¼ WHERE æ¡ä»¶</code></p>
<p>åˆ é™¤ï¼ˆDELETEï¼‰ï¼š<code>DELETE FROM è¡¨å WHERE æ¡ä»¶</code></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯WHEREæ¡ä»¶çš„ä½¿ç”¨ï¼Œé¿å…è¯¯åˆ è¯¯æ”¹æ•°æ®ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºç¡€è¯­æ³•æŒæ¡æ­£ç¡®</li>
<li>è¡¨è¾¾æ¯”è¾ƒæ¸…æ™°</li>
</ul>
<h3 id="é—®é¢˜7ï¼šç´¢å¼•çš„ä½œç”¨">é—®é¢˜7ï¼šç´¢å¼•çš„ä½œç”¨</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œè¯´ä¸€ä¸‹ç´¢å¼•çš„ä½œç”¨ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œç´¢å¼•çš„è¯å®ƒä¸»è¦æ˜¯ä¸ºäº†è®©è¿™ä¸ªå­—æ®µèƒ½å¤Ÿæé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚å®ƒæ˜¯å¯¹å­—æ®µè¿›è¡ŒåŠ ç´¢å¼•çš„ï¼Œç„¶åç´¢å¼•çš„è¯å°±æ˜¯ä½ èµ°è¿™ä¸ªå­—æ®µç´¢å¼•å®Œä»¥åï¼Œå®ƒä¼šå†å›è¿‡å¤´å»èµ°ä¸»é”®çš„é‚£ä¸ªç´¢å¼•ã€‚ç„¶åè¿™æ ·çš„è¯å°±æ˜¯èƒ½å¤§å¤§æé«˜æœç´¢æ•ˆç‡ã€‚å› ä¸ºåº•å±‚çš„B+æ ‘ç»“æ„çš„è¯ï¼Œå®ƒæ˜¯æ”¯æŒå°±å¯ä»¥æŠŠæŸ¥è¯¢çš„é€Ÿåº¦ä»O(n)é™åˆ°O(log n)ï¼Œæ‰€ä»¥è¯´å¯ä»¥å¤§å¤§æé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚ä½†æ˜¯ç´¢å¼•æœ‰æ—¶å€™ä¹Ÿä¼šå¤±æ•ˆï¼Œå°±æ˜¯å¯èƒ½ä¼šé€ æˆä¸€äº›æœ€ç»ˆè¿˜æ˜¯ä¼šå˜æˆå…¨è¡¨æ‰«æã€‚ç„¶åæˆ‘ä»¬ç³»ç»Ÿä¼˜åŒ–ï¼Œå°±æ˜¯MySQLä¼˜åŒ–çš„è¯ï¼Œä¹Ÿè¦å»é¿å…è¿™äº›å¯èƒ½ä¼šé€ æˆå…¨è¡¨æ‰«æçš„æƒ…å†µã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>ç´¢å¼•çš„ä½œç”¨ä¸»è¦æ˜¯æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå…·ä½“åŸç†æ˜¯è¿™æ ·çš„ï¼š</p>
<p>é¦–å…ˆï¼Œç´¢å¼•ä½¿ç”¨B+æ ‘æ•°æ®ç»“æ„ï¼Œå¯ä»¥å°†æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä»O(n)é™ä½åˆ°O(log n)ã€‚</p>
<p>å…¶æ¬¡ï¼Œç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼šå…ˆé€šè¿‡ç´¢å¼•å®šä½åˆ°ä¸»é”®ï¼Œå†é€šè¿‡ä¸»é”®å›è¡¨è·å–å®Œæ•´æ•°æ®ï¼Œè¿™å«åšå›è¡¨æ“ä½œã€‚</p>
<p>ä½†æ˜¯ç´¢å¼•ä¹Ÿæœ‰æˆæœ¬ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>å ç”¨é¢å¤–å­˜å‚¨ç©ºé—´</li>
<li>å½±å“å†™å…¥æ€§èƒ½ï¼ˆæ¯æ¬¡å†™å…¥éƒ½è¦ç»´æŠ¤ç´¢å¼•ï¼‰</li>
<li>å¯èƒ½å¤±æ•ˆçš„æƒ…å†µï¼ˆå¦‚å‡½æ•°æ“ä½œã€ç±»å‹è½¬æ¢ã€æœ€å·¦åŒ¹é…åŸåˆ™ç­‰ï¼‰</li>
</ol>
<p>æ‰€ä»¥ç´¢å¼•è®¾è®¡è¦è€ƒè™‘æŸ¥è¯¢æ¨¡å¼ï¼Œé¿å…è¿‡å¤šæ— ç”¨ç´¢å¼•ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ¦‚å¿µç†è§£æ­£ç¡®</li>
<li>å¯¹B+æ ‘å’Œå›è¡¨æœ‰è®¤è¯†</li>
<li>ä½†è¡¨è¾¾ä¸å¤Ÿå‡†ç¡®ï¼Œæœ¯è¯­ä½¿ç”¨æœ‰è¯¯</li>
</ul>
<h3 id="é—®é¢˜8ï¼šTCPå’ŒUDPçš„åŒºåˆ«">é—®é¢˜8ï¼šTCPå’ŒUDPçš„åŒºåˆ«</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œèƒ½è¯´ä¸€ä¸‹TCPå’ŒUDPçš„åŒºåˆ«å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š<br>
ä»‹ç»äº†TCPé¢å‘è¿æ¥ã€å¯é æ€§ã€ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ï¼ŒUDPé¢å‘æŠ¥æ–‡ã€ä¸å¯é ä½†é€Ÿåº¦å¿«ç­‰ç‰¹ç‚¹ã€‚</p>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>TCPå’ŒUDPçš„ä¸»è¦åŒºåˆ«ï¼š</p>
<p><strong>è¿æ¥æ€§</strong>ï¼šTCPæ˜¯é¢å‘è¿æ¥çš„ï¼Œéœ€è¦å»ºç«‹è¿æ¥åæ‰èƒ½ä¼ è¾“ï¼›UDPæ˜¯æ— è¿æ¥çš„ï¼Œç›´æ¥å‘é€æ•°æ®ã€‚</p>
<p><strong>å¯é æ€§</strong>ï¼šTCPé€šè¿‡åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€é‡ä¼ æœºåˆ¶ä¿è¯å¯é ä¼ è¾“ï¼›UDPä¸ä¿è¯å¯é æ€§ã€‚</p>
<p><strong>æ•ˆç‡</strong>ï¼šTCPå¤´éƒ¨è¾ƒå¤§ï¼ˆ20å­—èŠ‚ï¼‰ï¼Œæœ‰å„ç§æ§åˆ¶æœºåˆ¶ï¼›UDPå¤´éƒ¨ç®€å•ï¼ˆ8å­—èŠ‚ï¼‰ï¼Œä¼ è¾“æ•ˆç‡é«˜ã€‚</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>TCPé€‚ç”¨äºå¯¹å¯é æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¦‚HTTPã€HTTPSã€æ–‡ä»¶ä¼ è¾“</li>
<li>UDPé€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¦‚è§†é¢‘ç›´æ’­ã€åœ¨çº¿æ¸¸æˆã€DNSæŸ¥è¯¢</li>
</ul>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ¦‚å¿µæŒæ¡æ­£ç¡®</li>
<li>èƒ½å¤Ÿç»“åˆåº”ç”¨åœºæ™¯åˆ†æ</li>
<li>å›ç­”æ¯”è¾ƒå®Œæ•´</li>
</ul>
<h3 id="é—®é¢˜9ï¼šHTTPå’ŒHTTPSçš„åŒºåˆ«">é—®é¢˜9ï¼šHTTPå’ŒHTTPSçš„åŒºåˆ«</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œè¯´ä¸€ä¸‹HTTPå’ŒHTTPSçš„åŒºåˆ«ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š<br>
ä»‹ç»äº†ç«¯å£å·åŒºåˆ«ï¼ˆ80 vs 443ï¼‰ã€HTTPSçš„åŠ å¯†æœºåˆ¶ã€è¯ä¹¦éªŒè¯è¿‡ç¨‹ç­‰ã€‚</p>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>HTTPå’ŒHTTPSçš„ä¸»è¦åŒºåˆ«ï¼š</p>
<p><strong>å®‰å…¨æ€§</strong>ï¼šHTTPæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå®¹æ˜“è¢«çªƒå¬ï¼›HTTPSåœ¨HTTPåŸºç¡€ä¸ŠåŠ äº†SSL/TLSåŠ å¯†å±‚ã€‚</p>
<p><strong>ç«¯å£</strong>ï¼šHTTPé»˜è®¤ä½¿ç”¨80ç«¯å£ï¼ŒHTTPSä½¿ç”¨443ç«¯å£ã€‚</p>
<p><strong>è®¤è¯æœºåˆ¶</strong>ï¼šHTTPSä½¿ç”¨æ•°å­—è¯ä¹¦éªŒè¯æœåŠ¡å™¨èº«ä»½ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</p>
<p><strong>åŠ å¯†è¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯è¯·æ±‚HTTPSè¿æ¥</li>
<li>æœåŠ¡å™¨è¿”å›æ•°å­—è¯ä¹¦ï¼ˆåŒ…å«å…¬é’¥ï¼‰</li>
<li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§</li>
<li>ä½¿ç”¨å…¬é’¥åŠ å¯†éšæœºç”Ÿæˆçš„ä¼šè¯å¯†é’¥</li>
<li>åç»­é€šä¿¡ä½¿ç”¨ä¼šè¯å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†</li>
</ol>
<p><strong>æ€§èƒ½å½±å“</strong>ï¼šHTTPSç”±äºåŠ å¯†è§£å¯†è¿‡ç¨‹ï¼Œæ€§èƒ½ç•¥ä½äºHTTPï¼Œä½†ç°åœ¨ç¡¬ä»¶æ€§èƒ½è¶³å¤Ÿï¼Œå½±å“å¾®ä¹å…¶å¾®ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¯¹åŠ å¯†åŸç†æœ‰åŸºæœ¬ç†è§£</li>
<li>èƒ½å¤Ÿè¯´å‡ºå…·ä½“çš„æ¡æ‰‹è¿‡ç¨‹</li>
<li>å›ç­”ç›¸å¯¹å®Œæ•´</li>
</ul>
<h3 id="é—®é¢˜10ï¼šHTTPè¯·æ±‚ç±»å‹">é—®é¢˜10ï¼šHTTPè¯·æ±‚ç±»å‹</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œHTTPçš„è¯·æ±‚æœ‰å“ªäº›ç±»å‹ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä¸»è¦æœ‰GETã€POSTè¿™ä¸¤ä¸ªæœ€å¸¸ç”¨ã€‚ç„¶åè¿˜æœ‰OPTIONSï¼Œå®ƒæ˜¯è¯·æ±‚æ–¹æ³•çš„ã€‚ç„¶åPUTã€DELETEå¥½åƒä¹Ÿæ˜¯æ¯”è¾ƒæ–°ä¸€äº›çš„ç±»å‹ï¼Œå¥½åƒå¾ˆå°‘çœ‹åˆ°ã€‚ç„¶åè¿˜æœ‰ä¸€ä¸ªTRACEå®ƒå¥½åƒæ˜¯ç”¨æ¥é“¾è·¯è·Ÿè¸ªçš„ç±»å‹ã€‚è¿˜æœ‰ä¸€ä¸ªæˆ‘ä¸å¤ªç¡®å®šäº†ï¼Œå¥½åƒæ˜¯ä¸€ä¸ªå…³äºHEADçš„ç±»å‹ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>HTTPçš„ä¸»è¦è¯·æ±‚æ–¹æ³•ï¼š</p>
<p><strong>GET</strong>ï¼šè·å–èµ„æºï¼Œå¹‚ç­‰ä¸”å®‰å…¨<br>
<strong>POST</strong>ï¼šåˆ›å»ºèµ„æºï¼Œéå¹‚ç­‰<br>
<strong>PUT</strong>ï¼šæ›´æ–°æ•´ä¸ªèµ„æºï¼Œå¹‚ç­‰<br>
<strong>DELETE</strong>ï¼šåˆ é™¤èµ„æºï¼Œå¹‚ç­‰<br>
<strong>PATCH</strong>ï¼šéƒ¨åˆ†æ›´æ–°èµ„æº<br>
<strong>HEAD</strong>ï¼šè·å–èµ„æºå¤´ä¿¡æ¯ï¼Œä¸è¿”å›æ¶ˆæ¯ä½“<br>
<strong>OPTIONS</strong>ï¼šè·å–æœåŠ¡å™¨æ”¯æŒçš„HTTPæ–¹æ³•<br>
<strong>TRACE</strong>ï¼šç”¨äºè¯Šæ–­ï¼Œå›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚</p>
<p>å…¶ä¸­GETã€POSTæ˜¯æœ€å¸¸ç”¨çš„ï¼ŒPUTã€DELETEåœ¨RESTful APIä¸­ä½¿ç”¨è¾ƒå¤šã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ–¹æ³•éƒ½çŸ¥é“</li>
<li>ä½†å¯¹æ¯ä¸ªæ–¹æ³•çš„å…·ä½“ä½œç”¨ä¸å¤Ÿæ¸…æ™°</li>
<li>è¡¨è¾¾æœ‰äº›ä¸å‡†ç¡®</li>
</ul>
<h3 id="é—®é¢˜11ï¼šHTTPçŠ¶æ€ç ">é—®é¢˜11ï¼šHTTPçŠ¶æ€ç </h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œHTTPçš„å“åº”çŠ¶æ€ç ï¼Œè¯´ä¸€äº›ä½ æ¯”è¾ƒç†Ÿæ‚‰çš„ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š<br>
ä»‹ç»äº†200ã€301/302ã€404ã€403ã€401ã€502ã€503ç­‰å¸¸è§çŠ¶æ€ç ã€‚</p>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å¸¸è§HTTPçŠ¶æ€ç ï¼š</p>
<p><strong>2xxæˆåŠŸ</strong>ï¼š</p>
<ul>
<li>200 OKï¼šè¯·æ±‚æˆåŠŸ</li>
<li>201 Createdï¼šèµ„æºåˆ›å»ºæˆåŠŸ</li>
<li>204 No Contentï¼šè¯·æ±‚æˆåŠŸä½†æ— è¿”å›å†…å®¹</li>
</ul>
<p><strong>3xxé‡å®šå‘</strong>ï¼š</p>
<ul>
<li>301 Moved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘</li>
<li>302 Foundï¼šä¸´æ—¶é‡å®šå‘</li>
<li>304 Not Modifiedï¼šèµ„æºæœªä¿®æ”¹ï¼Œä½¿ç”¨ç¼“å­˜</li>
</ul>
<p><strong>4xxå®¢æˆ·ç«¯é”™è¯¯</strong>ï¼š</p>
<ul>
<li>400 Bad Requestï¼šè¯·æ±‚è¯­æ³•é”™è¯¯</li>
<li>401 Unauthorizedï¼šæœªè®¤è¯</li>
<li>403 Forbiddenï¼šæ— æƒé™</li>
<li>404 Not Foundï¼šèµ„æºä¸å­˜åœ¨</li>
</ul>
<p><strong>5xxæœåŠ¡å™¨é”™è¯¯</strong>ï¼š</p>
<ul>
<li>500 Internal Server Errorï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯</li>
<li>502 Bad Gatewayï¼šç½‘å…³é”™è¯¯</li>
<li>503 Service Unavailableï¼šæœåŠ¡ä¸å¯ç”¨</li>
</ul>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¸¸è§çŠ¶æ€ç åŸºæœ¬æŒæ¡</li>
<li>èƒ½å¤Ÿåˆ†ç±»è¯´æ˜</li>
<li>ä¸ªåˆ«çŠ¶æ€ç ç†è§£æœ‰åå·®</li>
</ul>
<h3 id="é—®é¢˜12ï¼šç¼–ç¨‹é¢˜-ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦">é—®é¢˜12ï¼šç¼–ç¨‹é¢˜ - ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¥½ï¼Œè¡Œï¼Œé‚£æˆ‘ä»¬æ¥åšä¸€ä¸ªç¼–ç¨‹çš„é¢˜ç›®ã€‚å¥½è¿™ä¸ªé¢˜ç›®äºŒï¼Œç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦OKã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š<br>
å®ç°äº†ä½¿ç”¨mapç»Ÿè®¡å­—ç¬¦å‡ºç°æ¬¡æ•°ï¼Œç„¶åéå†å­—ç¬¦ä¸²æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‡ºç°æ¬¡æ•°ä¸º1çš„å­—ç¬¦çš„è§£æ³•ã€‚</p>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™é“é¢˜æœ‰ä¸¤ç§ä¸»è¦è§£æ³•ï¼š</p>
<p><strong>æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨</strong>ï¼ˆæˆ‘ä½¿ç”¨çš„æ–¹æ³•ï¼‰</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">firstUniqChar</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    count := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">rune</span>]<span class="type">int</span>)</span><br><span class="line">    <span class="comment">// ç»Ÿè®¡æ¯ä¸ªå­—ç¬¦å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> _, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">        count[char]++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰¾ç¬¬ä¸€ä¸ªå‡ºç°æ¬¡æ•°ä¸º1çš„å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">for</span> i, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">        <span class="keyword">if</span> count[char] == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ³•äºŒï¼šä¸¤æ¬¡éå†ä¼˜åŒ–</strong><br>
å¯ä»¥ç”¨æ•°ç»„ä»£æ›¿mapï¼Œå› ä¸ºå­—ç¬¦èŒƒå›´æœ‰é™ï¼Œç©ºé—´å¤æ‚åº¦æ›´ä¼˜ã€‚</p>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼ˆå­—ç¬¦é›†å¤§å°å›ºå®šï¼‰</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>è§£æ³•æ­£ç¡®ï¼Œæ€è·¯æ¸…æ™°</li>
<li>ä»£ç å®ç°æ²¡æœ‰é—®é¢˜</li>
<li>ç¼–ç¨‹åŸºç¡€æ‰å®</li>
</ul>
<h3 id="é—®é¢˜13ï¼šèŒä¸šè§„åˆ’">é—®é¢˜13ï¼šèŒä¸šè§„åˆ’</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå°±æ˜¯ä½ è‡ªå·±çš„æ•´ä½“çš„èŒä¸šè§„åˆ’å¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘æ•´ä½“èŒä¸šè§„åˆ’çš„è¯ï¼Œå…¶å®æˆ‘ä¸»è¦æ˜¯æƒ³è¦æ¥è§¦ä¸€äº›æ›´å¤šçš„æŠ€æœ¯ï¼Œå°±æ˜¯å…ˆæå‡è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›ï¼Œç„¶åå°±æ˜¯äº‰å–æœªæ¥èƒ½èµ°ä¸Šä¸€äº›æ›´å¥½çš„å¼€å‘å²—ï¼Œæµ‹è¯•å¼€æµ‹è¯•å¼€å‘ä¹Ÿåœ¨å†…ã€‚ç›®å‰æ¥è¯´çš„è¯ï¼Œä¸»è¦æ˜¯æƒ³è¦æ›´å¤šå­¦ä¹ çš„æŠ€æœ¯ï¼Œç„¶åå­¦ä¹ ä¸€äº›è§„èŒƒæ›´è§„èŒƒçš„æµç¨‹ã€‚å› ä¸ºæˆ‘åŸæœ¬å®ä¹ çš„å…¬å¸ï¼Œä»–çš„é‚£ä¸ªå¼€å‘å®ƒä¸æ˜¯å®ƒçš„æ ¸å¿ƒèŒèƒ½éƒ¨é—¨ã€‚æ‰€ä»¥è¯´æˆ‘ä»¬æˆ‘ä»¬çš„å·¥ä½œå®ƒæ²¡æœ‰å…¶å®æ˜¯æ²¡æœ‰ä¸€ä¸ªå¾ˆè§„èŒƒçš„ä¸€äº›æµç¨‹çš„ã€‚æ‰€ä»¥è¯´æˆ‘æƒ³çŸ¥é“çœŸæ­£çš„ä¸€ä¸ªå¼€å‘çš„è§„èŒƒæµç¨‹åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œè¿™æ˜¯æˆ‘ç›®å‰æƒ³è¦åšçš„äº‹ã€‚ç„¶åæ¥ä¸‹æ¥æ‰æ˜¯ä¸»è¦å°±æ˜¯è¿™äº›ï¼Œå°±æ˜¯ç›®å‰æ¥è¯´æ˜¯è¿™äº›ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>æˆ‘çš„èŒä¸šè§„åˆ’åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š</p>
<p><strong>çŸ­æœŸç›®æ ‡ï¼ˆ1-2å¹´ï¼‰</strong>ï¼š<br>
é€šè¿‡å®ä¹ æœºä¼šæ·±å…¥äº†è§£å¤§å‚çš„å¼€å‘æµç¨‹å’Œè´¨é‡ä¿éšœä½“ç³»ï¼Œå­¦ä¹ è§„èŒƒçš„å·¥ç¨‹åŒ–å®è·µï¼Œæå‡æŠ€æœ¯æ ˆçš„æ·±åº¦å’Œå¹¿åº¦ã€‚</p>
<p><strong>ä¸­æœŸç›®æ ‡ï¼ˆ3-5å¹´ï¼‰</strong>ï¼š<br>
æˆä¸ºä¸€åä¼˜ç§€çš„æµ‹è¯•å¼€å‘å·¥ç¨‹å¸ˆï¼Œèƒ½å¤Ÿç‹¬ç«‹è®¾è®¡å’Œå®æ–½è‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»ï¼Œå…·å¤‡ç³»ç»Ÿæ¶æ„å’Œæ€§èƒ½ä¼˜åŒ–çš„èƒ½åŠ›ã€‚</p>
<p><strong>é•¿æœŸç›®æ ‡</strong>ï¼š<br>
å‘æŠ€æœ¯ä¸“å®¶æˆ–æŠ€æœ¯ç®¡ç†æ–¹å‘å‘å±•ï¼Œèƒ½å¤Ÿåœ¨æŠ€æœ¯å†³ç­–å’Œå›¢é˜Ÿå»ºè®¾æ–¹é¢å‘æŒ¥æ›´å¤§ä½œç”¨ã€‚</p>
<p>é€‰æ‹©æµ‹è¯•å¼€å‘æ˜¯å› ä¸ºè¿™ä¸ªå²—ä½æ—¢èƒ½å‘æŒ¥æˆ‘çš„å¼€å‘èƒ½åŠ›ï¼Œåˆèƒ½è®©æˆ‘æ·±å…¥äº†è§£è´¨é‡ä¿éšœä½“ç³»ï¼Œå¯¹æŠ€æœ¯çš„å…¨é¢æ€§è¦æ±‚æ›´é«˜ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>è¡¨è¾¾äº†å­¦ä¹ æ„æ„¿</li>
<li>å¯¹è§„èŒƒæµç¨‹çš„æ¸´æœ›å¾ˆçœŸè¯š</li>
<li>ä½†è§„åˆ’ä¸å¤Ÿå…·ä½“å’Œæ·±å…¥</li>
</ul>
<h3 id="é—®é¢˜14ï¼šå¯¹æµ‹è¯•å¼€å‘å²—ä½çš„ç†è§£">é—®é¢˜14ï¼šå¯¹æµ‹è¯•å¼€å‘å²—ä½çš„ç†è§£</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œé‚£ä½ å¯¹æµ‹è¯•å¼€å‘å²—ä½æ˜¯æœ‰ä»€ä¹ˆæ ·çš„ç†ï¼Œå°±æ˜¯é¢„æœŸæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæˆ–è€…æ˜¯è¯´åˆæ­¥çš„äº†è§£æ˜¯ä»€ä¹ˆæ ·çš„ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæµ‹è¯•å¼€å‘å²—ä½çš„è¯ä»–å…¶å®å°±æ˜¯æ„Ÿè§‰æœ‰ç‚¹åƒæ˜¯ã€‚æœ‰ç‚¹åƒæ˜¯ä¸€ä¸ªä¸€å µé˜²ç«å¢™ï¼Œå®ƒå¯ä»¥èƒ½ä¿è¯æœ€ç»ˆé‚£ä¸ªè½¯ä»¶ä¸Šçº¿æ˜¯èƒ½èƒ½è¦å°½é‡ç¡®ä¿è½¯ä»¶ä¸Šçº¿æ˜¯æ­£å¸¸çš„ã€‚å› ä¸ºå®é™…ä¸Šæˆ‘ä»¬å¼€å‘çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå› ä¸ºæ³¨é‡ä¸šåŠ¡çš„å®ç°ï¼Œå¯¼è‡´å¿½ç•¥äº†å¾ˆå¤šå¿½ç•¥å¾ˆå¤šä¸€äº›è¾¹ç•Œæ¡ä»¶ä»€ä¹ˆçš„ã€‚å°±å¯¼è‡´æœ€åä¸Šçº¿çš„è¯ï¼Œå®ƒå¯èƒ½ä¼šå‡ºç°ä¸€äº›bugã€‚ç„¶åæµ‹è¯•çš„ä½œç”¨å°±æ˜¯åœ¨ä¸­é—´ç»™ä»–åšä¸€ä¸ªå®Œæ•´æ€§çš„æµ‹è¯•ï¼Œç„¶åå°±æ˜¯å°½å¯èƒ½çš„æœç»è¿™äº›å‡ºç°çš„é—®é¢˜ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>æˆ‘å¯¹æµ‹è¯•å¼€å‘å²—ä½çš„ç†è§£ï¼š</p>
<p><strong>æ ¸å¿ƒèŒè´£</strong>ï¼šæµ‹è¯•å¼€å‘ä¸åªæ˜¯ä¸€é“é˜²ç«å¢™ï¼Œæ›´æ˜¯è´¨é‡ä¿éšœä½“ç³»çš„å»ºè®¾è€…ã€‚ä¸»è¦åŒ…æ‹¬ï¼š</p>
<ol>
<li>è®¾è®¡å’Œå®ç°è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶</li>
<li>å»ºè®¾CI/CDæµæ°´çº¿ä¸­çš„è´¨é‡å¡ç‚¹</li>
<li>è¿›è¡Œæ€§èƒ½æµ‹è¯•å’Œç¨³å®šæ€§æµ‹è¯•</li>
<li>å¼€å‘æµ‹è¯•å·¥å…·å’Œå¹³å°</li>
</ol>
<p><strong>æŠ€èƒ½è¦æ±‚</strong>ï¼š</p>
<ul>
<li>æ‰å®çš„ç¼–ç¨‹èƒ½åŠ›ï¼ˆè‡ªåŠ¨åŒ–æµ‹è¯•å¼€å‘ï¼‰</li>
<li>æ·±å…¥çš„ä¸šåŠ¡ç†è§£ï¼ˆè®¾è®¡æœ‰æ•ˆçš„æµ‹è¯•ç­–ç•¥ï¼‰</li>
<li>ç³»ç»Ÿæ€§æ€ç»´ï¼ˆæ•´ä½“è´¨é‡ä¿éšœè®¾è®¡ï¼‰</li>
<li>å·¥å…·å¼€å‘èƒ½åŠ›ï¼ˆæå‡æµ‹è¯•æ•ˆç‡ï¼‰</li>
</ul>
<p><strong>ä»·å€¼ä½“ç°</strong>ï¼šé€šè¿‡æŠ€æœ¯æ‰‹æ®µæå‡ç ”å‘æ•ˆç‡ï¼Œé™ä½çº¿ä¸Šæ•…éšœç‡ï¼Œä¿éšœç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¯¹å²—ä½æœ‰åŸºæœ¬è®¤çŸ¥</li>
<li>ç†è§£äº†è´¨é‡ä¿éšœçš„é‡è¦æ€§</li>
<li>ä½†å¯¹å…·ä½“å·¥ä½œå†…å®¹äº†è§£ä¸å¤Ÿæ·±å…¥</li>
</ul>
<h2 id="é¢è¯•æ•´ä½“æ„Ÿå—">é¢è¯•æ•´ä½“æ„Ÿå—</h2>
<ul>
<li><strong>éš¾åº¦è¯„ä»·</strong>: é€‚ä¸­åéš¾</li>
<li><strong>é¢è¯•å®˜é£æ ¼</strong>: ä¸“ä¸šå‹å–„ï¼Œä¼šé€æ­¥æ·±å…¥è¿½é—®</li>
<li><strong>é¢˜ç›®ç±»å‹</strong>: é¡¹ç›®ç»éªŒ+åŸºç¡€çŸ¥è¯†+ç¼–ç¨‹é¢˜ï¼Œå…¨é¢è€ƒå¯Ÿ</li>
<li><strong>å‡†å¤‡å»ºè®®</strong>: éœ€è¦å¯¹é¡¹ç›®ç»éªŒè¿›è¡Œæ·±åº¦æ€»ç»“ï¼ŒåŸºç¡€çŸ¥è¯†è¦æ‰å®</li>
</ul>
<h2 id="é¢è¯•ç»“æœ">é¢è¯•ç»“æœ</h2>
<ul>
<li><strong>å½“åœºåé¦ˆ</strong>: é¢è¯•å®˜æ²¡æœ‰æ˜ç¡®è¡¨æ€</li>
<li><strong>åç»­æµç¨‹</strong>: ç­‰å¾…HRé€šçŸ¥</li>
<li><strong>ä¸ªäººæ„Ÿå—</strong>: æ•´ä½“å‘æŒ¥ä¸€èˆ¬ï¼Œé¡¹ç›®ç»éªŒè¾ƒå¥½ï¼ŒåŸºç¡€çŸ¥è¯†æœ‰å¾…åŠ å¼º</li>
</ul>
<h2 id="ç»éªŒæ€»ç»“">ç»éªŒæ€»ç»“</h2>
<h3 id="åšå¾—å¥½çš„åœ°æ–¹">åšå¾—å¥½çš„åœ°æ–¹</h3>
<ul>
<li>é¡¹ç›®ç»éªŒæ¯”è¾ƒä¸°å¯Œï¼Œèƒ½å¤Ÿè¯¦ç»†ä»‹ç»æŠ€æœ¯ç»†èŠ‚</li>
<li>ç¼–ç¨‹é¢˜è§£ç­”æ­£ç¡®ï¼Œä»£ç å®ç°æ²¡æœ‰é—®é¢˜</li>
<li>å¯¹å®ä¹ å·¥ä½œæœ‰æ·±å…¥æ€è€ƒ</li>
</ul>
<h3 id="éœ€è¦æ”¹è¿›çš„åœ°æ–¹">éœ€è¦æ”¹è¿›çš„åœ°æ–¹</h3>
<ul>
<li>è¯­è¨€è¡¨è¾¾éœ€è¦æ›´åŠ ä¸“ä¸šå’Œå‡†ç¡®</li>
<li>åŸºç¡€çŸ¥è¯†æŒæ¡ä¸å¤Ÿæ·±å…¥ï¼Œç‰¹åˆ«æ˜¯ä¸­é—´ä»¶åŸç†</li>
<li>å¯¹ç›®æ ‡å²—ä½çš„ç†è§£è¿˜éœ€è¦åŠ æ·±</li>
</ul>
<h3 id="å‡†å¤‡å»ºè®®">å‡†å¤‡å»ºè®®</h3>
<ol>
<li><strong>é¡¹ç›®ç»éªŒ</strong>ï¼šå‡†å¤‡STARæ³•åˆ™æè¿°é¡¹ç›®ï¼Œçªå‡ºæŠ€æœ¯éš¾ç‚¹å’Œè§£å†³æ–¹æ¡ˆ</li>
<li><strong>åŸºç¡€çŸ¥è¯†</strong>ï¼šæ·±å…¥å­¦ä¹ Goè¯­è¨€ç‰¹æ€§ã€æ•°æ®åº“åŸç†ã€ç½‘ç»œåè®®ç­‰</li>
<li><strong>æµ‹è¯•å¼€å‘</strong>ï¼šäº†è§£è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ã€CI/CDã€æ€§èƒ½æµ‹è¯•ç­‰ç›¸å…³çŸ¥è¯†</li>
<li><strong>è¡¨è¾¾èƒ½åŠ›</strong>ï¼šå¤šç»ƒä¹ æŠ€æœ¯è¡¨è¾¾ï¼Œä½¿ç”¨å‡†ç¡®çš„ä¸“ä¸šæœ¯è¯­</li>
</ol>
<h3 id="çŸ¥è¯†ç‚¹å¤ä¹ ">çŸ¥è¯†ç‚¹å¤ä¹ </h3>
<ul>
<li>Goè¯­è¨€å¹¶å‘ç¼–ç¨‹ï¼ˆGMPæ¨¡å‹ã€channelç­‰ï¼‰</li>
<li>å¾®æœåŠ¡æ¶æ„è®¾è®¡å’Œä¸­é—´ä»¶åŸç†</li>
<li>æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–å’ŒSQLè°ƒä¼˜</li>
<li>HTTP/HTTPSåè®®è¯¦è§£</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•å’Œè´¨é‡ä¿éšœä½“ç³»</li>
</ul>
]]></content>
      <categories>
        <category>é¢è¯•ç»éªŒ</category>
      </categories>
      <tags>
        <tag>Bç«™</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>ä¸€é¢</tag>
      </tags>
  </entry>
  <entry>
    <title>è…¾è®¯IEG è¿è¥å¼€å‘å·¥ç¨‹å¸ˆ ä¸€é¢</title>
    <url>/2025/06/21/%E9%9D%A2%E8%AF%95%E9%A2%98/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E5%8E%82/%E8%85%BE%E8%AE%AF/2025-03-24-%E8%85%BE%E8%AE%AFIEG-%E8%BF%90%E8%90%A5%E5%BC%80%E5%8F%91-%E4%B8%80%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="é¢è¯•åŸºæœ¬ä¿¡æ¯">é¢è¯•åŸºæœ¬ä¿¡æ¯</h2>
<ul>
<li><strong>å…¬å¸</strong>: è…¾è®¯IEGï¼ˆäº’åŠ¨å¨±ä¹äº‹ä¸šç¾¤ï¼‰</li>
<li><strong>èŒä½</strong>: è¿è¥å¼€å‘å·¥ç¨‹å¸ˆï¼ˆåå…¨æ ˆï¼‰</li>
<li><strong>é¢è¯•è½®æ¬¡</strong>: ä¸€é¢ï¼ˆæŠ€æœ¯é¢ï¼‰</li>
<li><strong>é¢è¯•å½¢å¼</strong>: çº¿ä¸Šè§†é¢‘é¢è¯•</li>
<li><strong>é¢è¯•æ—¶é•¿</strong>: çº¦90åˆ†é’Ÿ</li>
<li><strong>é¢è¯•å®˜</strong>: å¼€å‘(ä¼¼ä¹æ˜¯å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ)</li>
<li><strong>é¢è¯•æ—¥æœŸ</strong>: 2025å¹´06æœˆ21æ—¥</li>
</ul>
<h2 id="é¢è¯•é—®é¢˜ä¸å›ç­”">é¢è¯•é—®é¢˜ä¸å›ç­”</h2>
<h3 id="é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»">é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå’±ä»¬è€è§„çŸ©å…ˆè‡ªæˆ‘ä»‹ç»ä¸€ä¸‹å‘—â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;é¢è¯•å®˜ä½ å¥½ã€‚æˆ‘æ˜¯ç‹å®‡å“²ï¼Œç›®å‰æ˜¯åä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹å¯†ç å­¦æ–¹å‘åœ¨è¯»ç ”ç©¶ç”Ÿã€‚æˆ‘ç ”ç©¶çš„æ–¹å‘ä¸»è¦æ˜¯å¯æœç´¢åŠ å¯†ï¼Œç„¶åæ¯”è¾ƒåæ•°æ®æ£€ç´¢è¿™æ–¹é¢çš„ã€‚ç„¶åæœ¬ç§‘æœŸé—´çš„è¯ï¼Œæˆ‘å­¦ä¹ æˆç»©æ¯”è¾ƒä¼˜å¼‚ï¼Œä¸‰å¹´å‡ä¸ºä¸“ä¸šæ’åç¬¬ä¸€ï¼Œè·å¾—è¿‡å›½å®¶å¥–å­¦é‡‘ã€‚ä¹Ÿé€šè¿‡è‡ªå·±çš„ç¼–ç¨‹èƒ½åŠ›è·å¾—è¿‡ä¸€äº›æ¯”å¦‚è¯´è“æ¡¥æ¯å›½å¥–ï¼Œè®¡ç®—æœºè®¾è®¡å¤§èµ›ä¸‰ç­‰å¥–è¿™äº›å¥–é¡¹ã€‚æˆ‘è‡ªå·±çš„è¯æ˜¯å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿä»¥åŠå¾®æœåŠ¡æ¶æ„è¿™äº›å¾®æœåŠ¡æ¶æ„è®¾è®¡è¿™äº›æ–¹é¢ç‰¹åˆ«æ„Ÿå…´è¶£ã€‚ç„¶ååœ¨è¿‡å»çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä¸»è¦æ˜¯ä½¿ç”¨GoæŠ€æœ¯æ ˆå»æ„å»ºä¸€äº›åˆ†å¸ƒå¼åº”ç”¨ã€‚</p>
<p>å»å¹´12æœˆåˆ°ä»Šå¹´2æœˆæœŸé—´ï¼Œæˆ‘å‚åŠ æŠ–éŸ³çš„é’è®­è¥ï¼Œç„¶åç»„ç»‡å›¢é˜Ÿå®Œæˆäº†ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„æŠ–éŸ³å•†åŸç³»ç»Ÿã€‚ç„¶åæˆ‘åœ¨è¿™é‡Œé¢æ˜¯è´Ÿè´£ç³»ç»Ÿçš„æ€»ä½“æ¶æ„è®¾è®¡ï¼Œä»¥åŠä½¿ç”¨GitHub Actionså»å®ç°è‡ªåŠ¨éƒ¨ç½²å¾®æœåŠ¡ä¸Šäº‘è¿™äº›æ“ä½œã€‚ç„¶åæˆ‘ä¹Ÿè®¾è®¡äº†å¾®æœåŠ¡ä¹‹é—´é€šä¿¡çš„æœºåˆ¶ï¼Œä»¥åŠç»“åˆäº†OpenTelemetryå»èåˆä¸€äº›å¯è§‚æµ‹æ€§ã€‚ä¹Ÿä½¿ç”¨äº†Nacoså®ç°æœåŠ¡æ³¨å†Œï¼Œä»¥åŠæœåŠ¡å‘ç°ï¼Œä»¥åŠåŠ¨æ€é…ç½®çƒ­æ›´æ–°ã€‚é™¤æ­¤ä¹‹å¤–æˆ‘è¿˜è®¾è®¡äº†ä¸€äº›é»‘åå•åˆ†çº§å­˜å‚¨ç­–ç•¥ä¹‹ç±»çš„æ¥ä¼˜åŒ–ä¸€äº›ç³»ç»Ÿæ€§èƒ½ã€‚ç„¶ååŒæ—¶ä½¿ç”¨CanalåŠ æ¶ˆæ¯é˜Ÿåˆ—æ¥è¿›è¡Œä¸‰ä¸ªæ•°æ®åº“çš„æ•°æ®åŒæ­¥ã€‚</p>
<p>ç„¶åå»å¹´7æœˆä»½çš„è¯ï¼Œæˆ‘ä¹Ÿåœ¨å­¦ä¹ GoæœŸé—´ï¼Œæˆ‘æ˜¯å¼€å‘äº†ä¸€ä¸ªAIGC NEXUSåº”ç”¨ã€‚å®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç”¨AIæ¥è¿›è¡Œå¾®æœåŠ¡è°ƒç”¨çš„ä¸€ä¸ªæ¡†æ¶ã€‚åŸºæœ¬ä¸Šå°±æ˜¯æˆ‘çš„è‡ªæˆ‘ä»‹ç»ã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è‡ªæˆ‘ä»‹ç»å¯ä»¥æ›´åŠ ç»“æ„åŒ–ä¸€äº›ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹é€»è¾‘ï¼š</p>
<p>&quot;é¢è¯•å®˜ä½ å¥½ï¼Œæˆ‘æ˜¯XXXã€‚é¦–å…ˆè¯´ä¸€ä¸‹æ•™è‚²èƒŒæ™¯ï¼Œæˆ‘ç°åœ¨æ˜¯åä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹ä¸“ä¸šçš„ç ”äºŒå­¦ç”Ÿï¼Œç ”ç©¶æ–¹å‘æ˜¯å¯†ç å­¦ã€‚</p>
<p>åœ¨æŠ€æœ¯èƒ½åŠ›æ–¹é¢ï¼Œæˆ‘ä¸»è¦ä¸“æ³¨äºåˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„çš„å¼€å‘ã€‚æœ€è¿‘çš„é¡¹ç›®ç»éªŒåŒ…æ‹¬ï¼šå»å¹´12æœˆåˆ°ä»Šå¹´2æœˆå‚åŠ äº†æŠ–éŸ³é’è®­è¥ï¼Œç»„ç»‡å›¢é˜Ÿå®Œæˆäº†ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„ç”µå•†ç³»ç»Ÿï¼Œæˆ‘è´Ÿè´£ç³»ç»Ÿæ¶æ„è®¾è®¡ã€CI/CDæµç¨‹æ­å»ºä»¥åŠæœåŠ¡é—´é€šä¿¡æœºåˆ¶çš„è®¾è®¡ã€‚</p>
<p>åœ¨å­¦æœ¯æˆç»©æ–¹é¢ï¼Œæœ¬ç§‘ä¸‰å¹´ä¸“ä¸šæ’åç¬¬ä¸€ï¼Œè·å¾—è¿‡å›½å®¶å¥–å­¦é‡‘ã€‚åŒæ—¶ä¹Ÿæœ‰ä¸€äº›å®è·µç»éªŒï¼Œæ¯”å¦‚å‚åŠ è®¡ç®—æœºè®¾è®¡å¤§èµ›è·å¾—ä¸‰ç­‰å¥–ç­‰ã€‚</p>
<p>æˆ‘å¯¹è¿™ä¸ªå²—ä½å¾ˆæ„Ÿå…´è¶£ï¼Œå› ä¸ºæˆ‘äº†è§£åˆ°è¿™ä¸ªèŒä½æ¶‰åŠåˆ°å‰åç«¯å¼€å‘ï¼Œæ­£å¥½ç¬¦åˆæˆ‘å¸Œæœ›åœ¨å·¥ä½œå‰å‡ å¹´è¿›è¡ŒæŠ€æœ¯å¹¿åº¦å­¦ä¹ çš„è§„åˆ’ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å›ç­”æ¯”è¾ƒå…¨é¢ï¼Œæ¶µç›–äº†æ•™è‚²èƒŒæ™¯ã€é¡¹ç›®ç»éªŒã€æŠ€æœ¯èƒ½åŠ›</li>
<li>ä½“ç°äº†å¯¹å…¨æ ˆå¼€å‘çš„å…´è¶£å’Œå­¦ä¹ è§„åˆ’</li>
<li>å¯ä»¥æ›´ç®€æ´ä¸€äº›ï¼Œé‡ç‚¹çªå‡ºä¸å²—ä½ç›¸å…³çš„ç»éªŒ</li>
</ul>
<h3 id="é—®é¢˜2ï¼šå­¦ä¹ æˆç»©æƒ…å†µä¸å®ä¹ ç»å†">é—®é¢˜2ï¼šå­¦ä¹ æˆç»©æƒ…å†µä¸å®ä¹ ç»å†</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ æœ‰æåˆ°æœ¬ç§‘é˜¶æ®µæˆç»©æ¯”è¾ƒå¥½ï¼Œé‚£ç ”ç©¶ç”Ÿé˜¶æ®µçš„æˆç»©æ€ä¹ˆæ ·ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œç ”ç©¶ç”Ÿå› ä¸ºæ˜¯ç ”ä¸€ï¼Œä½†æ˜¯æˆ‘ç»©ç‚¹çš„è¯åº”è¯¥æ˜¯3.8ï¼Œåº”è¯¥ä¹Ÿèƒ½æ’å‰é¢ã€‚ç„¶åå› ä¸ºæˆ‘æ˜¯è€ƒç ”è€ƒä¸Šæ¥çš„ï¼Œæˆ‘è€ƒç ”çš„æˆç»©çš„è¯æ˜¯æ’ä¸“ä¸šç¬¬äºŒï¼Œ70ä¸ªäººé‡Œé¢ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘å…ˆé—®ä¸€å¥ï¼Œå°±æ˜¯ä½ ç°åœ¨æ˜¯åœ¨å®ä¹ ä¸­æ˜¯å§ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘ä¸åœ¨å®ä¹ ä¸­ï¼Œä½†æ˜¯â€¦çœ‹ä½ çš„ç®€å†ï¼Œä½ æ˜¯å·²ç»ç»“æŸäº†ä¸€æ®µä¹‹å‰çš„é¡¹ç›®æ˜¯å¤–éƒ¨å¼€å‘çš„å®ä¹ ã€‚å¯¹å¯¹å¯¹ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘çœ‹ä½ ç°åœ¨åº”è˜çš„å²—ä½æ˜¯åå°å¼€å‘æ–¹å‘ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ä½ å¯¹æœªæ¥çš„æœŸæœ›ã€‚æˆ‘å› ä¸ºæˆ‘è¿™è¾¹çš„å²—ä½æ˜¯åå…¨æ ˆçš„ï¼Œä»–ä¸å•çº¯æ˜¯åå°å¼€å‘ï¼Œåç«¯ä¸ºä¸»ï¼Œä½†æ˜¯ä¼šæ¶‰åŠåˆ°ä¸€äº›å‰ç«¯ï¼Œå°ç¨‹åºç«¯çš„å·¥ä½œé‡ã€‚ä½ è¿™ç§å²—ä½ä½ æœªæ¥ä¼šè€ƒè™‘å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘ä¼šè€ƒè™‘çš„ã€‚å› ä¸ºé¦–å…ˆæˆ‘è‡ªå·±æ˜¯å°±æ˜¯æˆ‘æœ¬ç§‘æœŸé—´ï¼Œå…¶å®æˆ‘åšçš„ä¸œè¥¿éƒ½å¾ˆæ‚ï¼Œä¹Ÿæ˜¯åå…¨æ ˆè¿™äº›ä¸œè¥¿å°±æ˜¯æˆ‘ä»€ä¹ˆéƒ½ä¼šåšä¸€ç‚¹ï¼Œç„¶åæˆ‘åŸºæœ¬ä¸Šéƒ½ä¼šè‡ªå·±å»å¼€å‘ä¸€äº›åº”ç”¨ï¼Œå»ç±»ä¼¼äºåšä¸€äº›å°demoä¹‹ç±»çš„ï¼Œæ‰€ä»¥è¯´åŸºæœ¬ä¸Šæˆ‘éƒ½ä¼šæ¶‰åŠä¸€äº›ï¼Œç„¶åæˆ‘ä¹Ÿæ¯”è¾ƒå…³æ³¨çš„æ˜¯çŸ¥è¯†çš„å¹¿åº¦ã€‚ç„¶åç›®å‰çš„è¯å°±æ˜¯è¿‘å°±æ˜¯ä»æˆ‘ç ”ç©¶ç”Ÿç ”ä¸€å¼€å§‹ï¼Œç„¶ååˆ°æœªæ¥å·¥ä½œçš„ä¸‰å¹´å†…ï¼Œæˆ‘éƒ½ä¼šæˆ‘éƒ½è®¡åˆ’æ˜¯å»è¿›è¡Œå¹¿åº¦çš„å­¦ä¹ ï¼Œè€Œä¸æ˜¯å»æ·±åº¦çš„å­¦ä¹ ã€‚è¿™åœ¨å·¥ä½œçš„ä¸‰å¹´ä¸­ï¼Œæˆ‘å¯èƒ½ä¼šè¿›è¡Œæ·±åº¦çš„å­¦ä¹ ã€‚è¿™æ®µæ—¶é—´çš„è¯ï¼Œæˆ‘æ˜¯ä¸»è¦æ˜¯åœ¨å¹¿åº¦çš„æ¶‰çŒä¸€äº›æŠ€æœ¯ï¼Œäº†è§£å„ç§å„æ ·çš„æŠ€æœ¯æ ˆã€‚æ‰€ä»¥è¯´æˆ‘æ„Ÿè§‰è¿™ä¸ªèŒä½å½“æ—¶æˆ‘çœ‹åˆ°è¿™ä¸ªèŒä½æè¿°çš„æ—¶å€™ï¼Œæˆ‘è§‰å¾—æˆ‘è‡ªå·±æ˜¯æ¯”è¾ƒå¸Œæœ›èƒ½è¿›æ¥çš„ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>&quot;ç ”ç©¶ç”Ÿé˜¶æ®µæˆ‘ä¹Ÿä¿æŒäº†æ¯”è¾ƒå¥½çš„å­¦ä¹ çŠ¶æ€ã€‚ç›®å‰ç ”ä¸€çš„ç»©ç‚¹æ˜¯3.8ï¼Œåœ¨ä¸“ä¸šä¸­æ’åé å‰ã€‚è€ƒç ”æ—¶æˆ‘çš„æˆç»©åœ¨70äººä¸­æ’ç¬¬äºŒï¼Œè¯´æ˜åŸºç¡€è¿˜æ˜¯æ¯”è¾ƒæ‰å®çš„ã€‚</p>
<p>ä¸è¿‡ç ”ç©¶ç”Ÿé˜¶æ®µæˆ‘æ›´æ³¨é‡å®è·µèƒ½åŠ›çš„æå‡ï¼Œæ‰€ä»¥åœ¨ä¿è¯å­¦ä¸šçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä¼šæ›´å¤šåœ°å‚ä¸ä¸€äº›é¡¹ç›®å¼€å‘å’ŒæŠ€æœ¯å­¦ä¹ ï¼Œè¿™æ ·èƒ½æ›´å¥½åœ°å°†ç†è®ºçŸ¥è¯†è½¬åŒ–ä¸ºå®é™…èƒ½åŠ›ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>æ•°æ®å…·ä½“ï¼Œæœ‰è¯´æœåŠ›</li>
<li>ä½“ç°äº†ä»ç†è®ºå‘å®è·µè½¬åŒ–çš„æ€è·¯</li>
<li>å±•ç°äº†å­¦ä¹ èƒ½åŠ›å’Œè‡ªæˆ‘è§„åˆ’æ„è¯†</li>
</ul>
<h3 id="é—®é¢˜3ï¼šæŠ–éŸ³å•†åŸé¡¹ç›®èƒŒæ™¯">é—®é¢˜3ï¼šæŠ–éŸ³å•†åŸé¡¹ç›®èƒŒæ™¯</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ åˆšæ‰ä¹Ÿæåˆ°è¿‡é‚£ä¸ªæŠ–éŸ³å•†åŸçš„é¡¹ç›®æ˜¯ä¸€ä¸ªä»€ä¹ˆèƒŒæ™¯ï¼ŒæŠ–éŸ³çš„ä»€ä¹ˆæ¯”èµ›é¡¹ç›®å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œå¯¹ä»–æ˜¯ä¸€ä¸ªé’è®­è¥çš„é¡¹ç›®ï¼Œä»–å°±æ˜¯ç»„ç»‡ä¸€ç¾¤äººä¸€èµ·å»ï¼Œä»–ä¼šç»™æˆ‘ä»¬ä¸€äº›æ•™å­¦è§†é¢‘ï¼Œç„¶åè®©æˆ‘ä»¬è‡ªå·±å»å­¦å®Œè§†é¢‘ä»¥åï¼Œè‡ªå·±å»æ ¹æ®è¿™ä¸ªå›¢é˜Ÿï¼ŒæŒ‰ç…§ä»–çš„éœ€æ±‚æ–‡æ¡£æ¥åšä¸€ä¸ªç³»ç»Ÿå‡ºæ¥ã€‚å¤§æ¦‚èŠ±äº†ï¼ŒåˆæœŸçš„è¯æ˜¯ä¸€ä¸ªæœˆå°±å·²ç»æŠŠåŸºæœ¬çš„åŠŸèƒ½éƒ½ç»™åšå®Œäº†ã€‚ç„¶åä¸­é—´æ˜¯æ˜¥èŠ‚ï¼Œæ˜¥èŠ‚å°±æ˜¯ä¸­é—´å¾ˆé•¿æ—¶é—´æ²¡æœ‰åšã€‚ç„¶ååé¢çš„è¯å°±æ˜¯åœ¨æ˜¥èŠ‚æœŸé—´ä¹Ÿè€ƒè™‘ä¸€äº›å…¶ä»–çš„æŠ€æœ¯æ ˆï¼Œæ¯”å¦‚è¯´åæ¥é‚£ä¸ªCanalä»€ä¹ˆçš„ï¼Œéƒ½æ˜¯åæ¥è€ƒè™‘åˆ°çš„ï¼Œç„¶åå»ç»™å®ƒèåˆè¿›å»äº†ï¼Œæ€»å…±åŠ èµ·æ¥çš„è¯æ˜¯ä¸¤ä¸ªæœˆã€‚æˆ‘ä»¬çš„è¯å…·ä½“å¼€å‘çš„è¯å››ä¸ªäººï¼Œä½†æ˜¯å…¶å®ä¸»è¦å·¥ä½œé‡è¿˜æ˜¯æˆ‘å¤§æ¦‚70%çš„å·¥ä½œé‡ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>&quot;æ˜¯çš„ï¼Œè¿™æ˜¯å­—èŠ‚è·³åŠ¨é’è®­è¥çš„ä¸€ä¸ªå®æˆ˜é¡¹ç›®ã€‚é’è®­è¥æ˜¯å­—èŠ‚è·³åŠ¨é¢å‘å¤§å­¦ç”Ÿçš„æŠ€æœ¯æˆé•¿è®¡åˆ’ï¼Œä»–ä»¬ä¼šæä¾›ç³»ç»Ÿçš„æŠ€æœ¯åŸ¹è®­è§†é¢‘å’Œå®æˆ˜é¡¹ç›®ã€‚</p>
<p>æ•´ä¸ªæµç¨‹æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦å­¦ä¹ ä»–ä»¬æä¾›çš„å¾®æœåŠ¡å¼€å‘ç›¸å…³è§†é¢‘è¯¾ç¨‹ï¼Œç„¶åæ ¹æ®ä»–ä»¬ç»™å‡ºçš„éœ€æ±‚æ–‡æ¡£ï¼Œè‡ªä¸»ç»„é˜Ÿå®Œæˆä¸€ä¸ªå®Œæ•´çš„ç”µå•†ç³»ç»Ÿã€‚</p>
<p>æˆ‘é€‰æ‹©æ‹…ä»»é˜Ÿé•¿ï¼Œä¸»è¦æ˜¯å› ä¸ºæˆ‘å¯¹å¾®æœåŠ¡æ¶æ„æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œè€Œä¸”å¸Œæœ›èƒ½åœ¨é¡¹ç›®ä¸­æ‰¿æ‹…æ›´å¤šçš„æŠ€æœ¯å†³ç­–å’Œæ¶æ„è®¾è®¡å·¥ä½œã€‚è¿™ä¸ªé¡¹ç›®è®©æˆ‘å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰äº†æ›´æ·±å…¥çš„ç†è§£ï¼Œä¹Ÿç§¯ç´¯äº†å›¢é˜Ÿåä½œçš„ç»éªŒã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>è¯´æ˜äº†é¡¹ç›®çš„æƒå¨æ€§å’Œå«é‡‘é‡</li>
<li>ä½“ç°äº†ä¸»åŠ¨å­¦ä¹ å’Œé¢†å¯¼èƒ½åŠ›</li>
<li>å±•ç°äº†å¯¹æŠ€æœ¯çš„çƒ­æƒ…</li>
</ul>
<h3 id="é—®é¢˜4ï¼šå†…å­˜å ç”¨æ’æŸ¥ä¸åˆ†å¸ƒå¼äº‹åŠ¡">é—®é¢˜4ï¼šå†…å­˜å ç”¨æ’æŸ¥ä¸åˆ†å¸ƒå¼äº‹åŠ¡</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå…ˆé—®ä¸€ä¸ªå†…å­˜é—®é¢˜ï¼Œå‡å¦‚è¯´ç°åœ¨æœ‰é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä½ è¿™ä¸ªæœåŠ¡ä¸Šçº¿äº†ï¼Œä½†æ˜¯æœ‰ä¸€å¤©é‡åˆ°æœåŠ¡å™¨å‘Šè­¦ï¼Œå†…å­˜ä¸è¶³ï¼Œä½ å»æ’æŸ¥é—®é¢˜ï¼Œä½ ä¼šç”¨ä»€ä¹ˆæ–¹æ³•å»å»æ’æŸ¥ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;è¿™ä¸ªæ­£å¥½æ˜¯æˆ‘ä¹‹å‰å®ä¹ çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯å½“æ—¶å®ä¹ çš„è¯å› ä¸ºæˆ‘ä»¬å½“æ—¶é‚£ä¸ªå…¬å¸çš„ç³»ç»Ÿç‰ˆæœ¬æ¯”è¾ƒä½ã€‚ç„¶ååæ¥ä¸çŸ¥é“æ€ä¹ˆçš„ï¼Œå°±æ˜¯å¥½åƒå»å¹´åæœˆä»½å¼€å§‹æœ‰ä¸€ä¸ªæ¼æ´ï¼Œå°±æœ‰ä¸€ä¸ªè •è™«ç—…æ¯’ï¼Œç„¶åæ‚„æ— å£°æ¯è¿›å…¥æˆ‘ä»¬é‚£ä¸ªæœåŠ¡å™¨é‡Œé¢å»äº†ã€‚ç„¶åä»–å°±ä¸€ç›´åœ¨æŒ–çŸ¿ï¼Œç„¶åå¯¼è‡´æˆ‘ä»¬é‚£ä¸ªMySQLå°±ä¸€ç›´åœ¨å¯åŠ¨ï¼Œç„¶åè¿‡ä¸‰å¤©å®•æœºäº†ï¼Œå†å¯åŠ¨åˆè¿‡ä¸‰å¤©åˆå®•æœºäº†ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å…ˆå»ç”¨é‚£ä¸ªå‘½ä»¤è¡Œå»çœ‹topï¼Œå°±æ˜¯ç”¨topå»çœ‹è¿›ç¨‹çš„é‚£äº›ä»€ä¹ˆå†…å­˜å ç”¨æƒ…å†µï¼ŒCPUå ç”¨æƒ…å†µï¼Œå‘ç°éƒ½ä¸å¤ªè¡Œã€‚ç„¶ååæ¥çš„è¯æˆ‘ä»¬å°±ä¸‹äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„é‚£ä¸ªå·¥å…·ï¼Œç„¶åç¬¬ä¸‰æ–¹çš„é‚£ä¸ªå‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œç„¶åæˆ‘ä»¬å»è¿è¡Œï¼Œç„¶åå‘ç°ä»–é‚£ä¸ªæˆ‘ä»¬ä¸€è¿è¡Œå°±ä¼šå‘ç°ä»–å‰ä»–å°±æ˜¯æœ€å°±æ˜¯ä¼šæœ‰ä¸€ä¸ªåº”ç”¨ï¼Œä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒå ç”¨ç‰¹åˆ«å¤šå†…å­˜ï¼Œè¿˜æœ‰é‚£ä¸ªCPUèµ„æºã€‚ç„¶åæˆ‘ä»¬å°±ç”¨é‚£ä¸ªwhichå‘½ä»¤å»å»åˆ¤æ–­topæŒ‡ä»¤å®ƒåœ¨å“ªä¸ªç›®å½•ã€‚ç„¶åæˆ‘ä»¬å‘ç°topè¢«é‚£ä¸ªè •è™«ç—…æ¯’ç»™ä¿®æ”¹æ‰äº†ã€‚&quot;</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œé‚£æ¢ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸æ˜¯è¢«æ”»å‡»çš„ï¼Œå°±åªæ˜¯å•çº¯çš„ä½ çš„æœåŠ¡å†…å­˜å ç”¨æ¯”è¾ƒé«˜ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;é¦–å…ˆä¸€èˆ¬æ¥è¯´æœåŠ¡å å†…å­˜å ç”¨æ¯”è¾ƒé«˜çš„è¯ï¼Œå®ƒæœ‰å‡ ä¸ªé—®é¢˜ã€‚æˆ‘è‡ªå·±å¼€å‘é‚£ä¸ªæŠ–éŸ³å•†åŸçš„æ—¶å€™ä¹Ÿé‡åˆ°è¿‡ç›¸å…³çš„é—®é¢˜ã€‚å°±æ¯”å¦‚è¯´æˆ‘ç”¨Nacosçš„æ—¶å€™ï¼Œä»–é‚£ä¸ªæœåŠ¡å™¨åŠ¨ä¸åŠ¨å°±OPSè¿‡é«˜ï¼Œç„¶åæ•´ä¸ªæœåŠ¡å™¨å°±åœæ­¢äº†ã€‚åæ¥æ’æŸ¥åŸå› å‘ç°æ˜¯Nacosä»–é‚£ä¸ªæ—¥å¿—çº§åˆ«çš„é—®é¢˜ã€‚å› ä¸ºç»™ä»–è®¾ç½®äº†infoæ—¥å¿—ï¼Œå¯¼è‡´ä»–æ—¥å¿—ç‰¹åˆ«å¤šã€‚ç„¶åä¸åœçš„è¯»å†™ç£ç›˜ï¼Œå¯¼è‡´å®ƒé‚£ä¸ªå†…å­˜è¿‡é«˜äº†ã€‚äºæ˜¯æˆ‘ä»¬å°±æŠŠè¿™ä¸ªæ—¥å¿—çº§åˆ«ç»™æ”¹æˆé‚£ä¸ªerrorçº§åˆ«ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰MySQLï¼ŒMySQLç»å¸¸ä¼šå‡ºç°å†…å­˜è¿‡é«˜çš„æƒ…å†µï¼Œå ç”¨å†…å­˜é‡è¿‡é«˜çš„æƒ…å†µã€‚é‚£å®ƒä¸€èˆ¬æ¥è¯´å°±æ˜¯å®ƒçš„ä¸€äº›ç¼“å†²æ± ä¹‹ç±»çš„ï¼Œå°±æ˜¯å‚æ•°è®¾ç½®è¿‡é«˜ï¼Œæˆ‘ä»¬ä¼šç»™å®ƒè®¾ç½®ä½ä¸€ç‚¹ã€‚è™½ç„¶è¯´å®ƒæŸ¥æ‰¾é€Ÿåº¦æ€§èƒ½ä¼šå˜ä½ï¼Œä½†æ˜¯å®ƒä¸è‡³äºè®©æ•´ä¸ªç³»ç»Ÿçš„å†…å­˜åœ¨è´Ÿè½½å¤ªé«˜ã€‚&quot;</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œé‚£ç°åœ¨å°±æœ‰ä¸€ä¸ªæ¯”è¾ƒç°å®çš„é—®é¢˜ï¼Œå°±æ˜¯ä½ ä¸Šå»å°±topå»çœ‹ä¸€ä¸‹ï¼Œå‘ç°æœ‰æŸä¸ªæœåŠ¡çš„è¿›ç¨‹ï¼Œå®ƒè€—çš„å†…å­˜å°±æ˜¯æ¯”è¾ƒé«˜ï¼Œè¶Šæ¥è¶Šå¤šã€‚é‚£ä½ æ€ä¹ˆå»æ’æŸ¥åƒåœ¾å›æ”¶çš„é—®é¢˜ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œåƒåœ¾å›æ”¶çš„é—®é¢˜çš„è¯ï¼Œè¿™ä¸ªæˆ‘æ„Ÿè§‰æ˜¯è¦ä»ä»£ç å±‚é¢å»è€ƒè™‘ã€‚å¯èƒ½å°±æ˜¯åœ¨åšå•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå»ç»™æ¯ä¸ªè¿›ç¨‹å»å¸®ä»–ä»¬GCä¸€ä¸‹ï¼Œç„¶åå»åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªå†…å­˜æœ€åä¼šå ç”¨å¤šå°‘ï¼Œç„¶åå»ä¸€ä¸ªä¸ªå»æ‰¾åˆ°å¯¹åº”å“ªä¸ªå†…å­˜å¯èƒ½å ç”¨ä¸€ç›´è¿‡é«˜çš„é‚£ä¸ªã€‚ä½†æ˜¯æ’æŸ¥å†…å­˜æ³„éœ²çš„å·¥å…·æˆ‘æ²¡æœ‰ç”¨è¿‡ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¦‚æœç”¨åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³åº“å­˜é—®é¢˜ï¼Œå…·ä½“æ˜¯æ€ä¹ˆæ“ä½œçš„å‘¢ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè¿™ä¸ªæˆ‘ä¸å¤ªäº†è§£ï¼Œåº”è¯¥æ˜¯å¦‚æœè¯´ä»–å‡ºç°äº†é—®é¢˜ï¼Œä»–åº”è¯¥è¿˜è¦ä¸“é—¨å†™ä¸€ä¸ªæ¢å¤çš„å‡½æ•°ã€‚æˆ‘ä¼°è®¡æ˜¯è¿™æ ·ï¼Œå› ä¸ºæˆ‘ä¸å¤ªäº†è§£è¿™ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå®ƒåº”è¯¥æ˜¯è¦ä¸“é—¨å†™ä¸€ä¸ªæ¢å¤åº“å­˜çš„ä¸€ä¸ªå‡½æ•°ã€‚ç„¶åå°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡å®ƒä¼šæœ‰ä¸ªä¸­å¿ƒï¼Œåº”è¯¥ä¼šé€šçŸ¥ä»–å»å›æ»šï¼Œåº”è¯¥æ˜¯è¿™æ ·çš„ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>&quot;åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³åº“å­˜é—®é¢˜ä¸»è¦æœ‰å‡ ç§æ–¹æ¡ˆï¼š</p>
<p>ç¬¬ä¸€ç§æ˜¯2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰æ¨¡å¼ï¼Œæœ‰ä¸ªäº‹åŠ¡åè°ƒå™¨æ¥ç®¡ç†ã€‚ç¬¬ä¸€é˜¶æ®µå…ˆå‘å„ä¸ªæœåŠ¡å‘é€å‡†å¤‡è¯·æ±‚ï¼Œæ¯”å¦‚è®¢å•æœåŠ¡é¢„åˆ›å»ºè®¢å•ï¼Œåº“å­˜æœåŠ¡é¢„æ‰£å‡åº“å­˜ã€‚ç¬¬äºŒé˜¶æ®µå¦‚æœéƒ½å‡†å¤‡æˆåŠŸå°±æäº¤ï¼Œå¦åˆ™å°±å›æ»šã€‚</p>
<p>ç¬¬äºŒç§æ˜¯TCCæ¨¡å¼ï¼Œå°±æ˜¯Try-Confirm-Cancelã€‚Tryé˜¶æ®µå…ˆå°è¯•æ‰§è¡Œï¼Œæ¯”å¦‚å†»ç»“åº“å­˜ï¼›Confirmé˜¶æ®µç¡®è®¤æäº¤ï¼›å¦‚æœå‡ºç°é—®é¢˜å°±Cancelå›æ»šï¼Œé‡Šæ”¾å†»ç»“çš„åº“å­˜ã€‚</p>
<p>ç¬¬ä¸‰ç§æ˜¯SAGAæ¨¡å¼ï¼Œå°†ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œã€‚å¦‚æœåé¢çš„äº‹åŠ¡å¤±è´¥ï¼Œå°±é€æ­¥æ‰§è¡Œè¡¥å¿æ“ä½œæ¥å›æ»šã€‚</p>
<p>å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬æ›´å¤šä¼šé€‰æ‹©æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥å¼‚æ­¥å¤„ç†ï¼Œé…åˆé‡è¯•å’Œè¡¥å¿æœºåˆ¶æ¥ä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å½“æ—¶å›ç­”è¿‡äºç®€å•ï¼Œç¼ºä¹å…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆ</li>
<li>åº”è¯¥å‡†å¤‡å¸¸è§çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</li>
<li>éœ€è¦åŠ å¼ºåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºçŸ¥è¯†</li>
</ul>
<h3 id="é—®é¢˜5ï¼šMySQLç´¢å¼•è®¾è®¡">é—®é¢˜5ï¼šMySQLç´¢å¼•è®¾è®¡</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå‡å¦‚è¯´æœ‰ä¸€å¼ ç”¨æˆ·çš„æ•°æ®è¡¨ï¼Œå­—æ®µæœ‰ç”¨æˆ·åã€æ˜µç§°ã€æ€§åˆ«ã€å¹´é¾„ã€æ³¨å†Œæ—¶é—´ï¼Œå¯¹è¿™ä¸ªè¡¨åšç´¢å¼•çš„è®¾è®¡ï¼Œä½ ä¼šåšå“ªå‡ åŠ ç´¢å¼•ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;æˆ‘é¦–å…ˆè‚¯å®šè¦è€ƒè™‘çš„è€ƒè™‘æŠŠç”¨æˆ·åè®¾æˆ–è€…IDè®¾ç½®ä¸ºä¸»é”®ï¼Œè¿™æ ·çš„è¯æŸ¥è¯¢èµ·æ¥æ¯”è¾ƒå¿«ã€‚å› ä¸ºç”¨æˆ·åæŸ¥æ‰¾çš„è‚¯å®šæ˜¯æœ€å¤šçš„ã€‚ç„¶åå…¶æ¬¡çš„è¯æ˜µç§°æˆ‘ä¸€èˆ¬æ˜¯ä¸ä¼šå»ºç´¢å¼•çš„ã€‚å› ä¸ºåƒæ¯”å¦‚è¯´æˆ‘ä»¬ç°åœ¨QQæˆ‘ä»¬é‚£ä¸ªQQé‡Œé¢å¾ˆå¤šäººéƒ½ä»–éƒ½ä¼šæœ‰å¾ˆå¤šç¨€å¥‡å¤æ€ªçš„ç¬¦å·ã€‚å¦‚æœè¯´æˆ‘ä»¬å»ºç´¢å¼•çš„è¯ï¼Œä»–å…¶å®å¾ˆå°‘æœ‰äººä¼šå¯¹å®ƒè¿›è¡Œç²¾ç¡®çš„æŸ¥è¯¢ã€‚æ‰€ä»¥è¯´æˆ‘ä»¬ä¸ä¼šå¯¹ä»–å»ºç´¢å¼•ï¼Œè®©ä»–æ¯æ¬¡æŸ¥è¯¢éƒ½å…¨è¡¨æ‰«æã€‚</p>
<p>ç„¶åè¿™ä¸ªæ€§åˆ«çš„è¯ä¸€èˆ¬æŸ¥çš„ä¹Ÿæ¯”è¾ƒå°‘ï¼Œæ€§åˆ«å¹´é¾„ä¸€èˆ¬æŸ¥çš„ä¹Ÿæ¯”è¾ƒå°‘ã€‚æ³¨å†Œæ—¶é—´çš„è¯æˆ‘è§‰å¾—å†…éƒ¨ä»–å¯èƒ½ä¼šç»Ÿè®¡ä¸€äº›ç”¨æˆ·ä¿¡æ¯ï¼Œä»–å¯èƒ½ä¼šç”¨ï¼Œæ‰€ä»¥è¯´å¯èƒ½è¦å»ºä¸ªç´¢å¼•ï¼Œè€Œä¸”ä»–æ¯”è¾ƒæ¯”è¾ƒèƒ½æ¯”è¾ƒè‰¯å¥½çš„æ”¯æŒä¸€äº›èŒƒå›´æŸ¥è¯¢ä¹‹ç±»çš„ã€‚æ‰€ä»¥è¯´è¿™ä¸ªå¯èƒ½è¦å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¯èƒ½æ ¹æ®å†…éƒ¨éœ€æ±‚ã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>&quot;å¯¹äºè¿™ä¸ªç”¨æˆ·è¡¨çš„ç´¢å¼•è®¾è®¡ï¼Œæˆ‘ä¼šè¿™æ ·è€ƒè™‘ï¼š</p>
<p>é¦–å…ˆè‚¯å®šæ˜¯ä¸»é”®ç´¢å¼•ï¼Œå¦‚æœæœ‰user_idå°±ç”¨user_idï¼Œè¿™æ˜¯èšç°‡ç´¢å¼•ï¼ŒæŸ¥è¯¢æ•ˆç‡æœ€é«˜ã€‚</p>
<p>ç„¶åæˆ‘ä¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯æ¥è®¾è®¡å…¶ä»–ç´¢å¼•ï¼š</p>
<ol>
<li>
<p>ç”¨æˆ·åï¼ˆusernameï¼‰ï¼šè¿™ä¸ªè‚¯å®šè¦å»ºå”¯ä¸€ç´¢å¼•ï¼Œå› ä¸ºç™»å½•æ—¶ä¼šé¢‘ç¹æŒ‰ç”¨æˆ·åæŸ¥è¯¢ï¼Œè€Œä¸”ç”¨æˆ·åä¸èƒ½é‡å¤ã€‚</p>
</li>
<li>
<p>æ³¨å†Œæ—¶é—´ï¼ˆregister_timeï¼‰ï¼šè¿™ä¸ªå»ºè®®å»ºæ™®é€šç´¢å¼•ï¼Œå› ä¸ºè¿è¥ç»å¸¸éœ€è¦æŒ‰æ—¶é—´èŒƒå›´ç»Ÿè®¡ç”¨æˆ·ï¼Œæ¯”å¦‚æŸ¥è¯¢æŸä¸ªæ—¶é—´æ®µçš„æ–°å¢ç”¨æˆ·ã€‚</p>
</li>
<li>
<p>æ€§åˆ«ã€å¹´é¾„ï¼šå•ç‹¬å»ºç´¢å¼•æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºåŒºåˆ†åº¦å¤ªä½ã€‚ä½†å¦‚æœç»å¸¸éœ€è¦æŒ‰å¹´é¾„æ®µå’Œæ€§åˆ«ç»„åˆæŸ¥è¯¢ï¼Œå¯ä»¥è€ƒè™‘å»ºè”åˆç´¢å¼• (age, gender)ã€‚</p>
</li>
<li>
<p>æ˜µç§°ï¼šä¸€èˆ¬ä¸å»ºç´¢å¼•ï¼Œå› ä¸ºæ˜µç§°æŸ¥è¯¢ä¸å¤šï¼Œè€Œä¸”æ˜µç§°å¯èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œç´¢å¼•æ•ˆæœä¸å¥½ã€‚</p>
</li>
</ol>
<p>æ€»çš„åŸåˆ™æ˜¯ï¼šé«˜é¢‘æŸ¥è¯¢çš„å­—æ®µã€åŒºåˆ†åº¦é«˜çš„å­—æ®µä¼˜å…ˆå»ºç´¢å¼•ï¼Œä½†ä¹Ÿè¦è€ƒè™‘ç´¢å¼•ç»´æŠ¤æˆæœ¬ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ€è·¯æ­£ç¡®ï¼Œä½†åˆ†æä¸å¤Ÿæ·±å…¥</li>
<li>åº”è¯¥æ›´å¤šä»ä¸šåŠ¡åœºæ™¯è§’åº¦è€ƒè™‘</li>
<li>éœ€è¦æŒæ¡ç´¢å¼•è®¾è®¡çš„åŸºæœ¬åŸåˆ™</li>
</ul>
<h3 id="é—®é¢˜6ï¼šè”åˆç´¢å¼•ä½¿ç”¨è§„åˆ™">é—®é¢˜6ï¼šè”åˆç´¢å¼•ä½¿ç”¨è§„åˆ™</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¦‚æœæœ‰ABC3åˆ—çš„è¯ï¼ŒABã€ACã€BCã€CBã€CAå“ªå‡ ä¸ªèƒ½ç”¨åˆ°ç´¢å¼•ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œABåº”è¯¥æ˜¯ä¼šç”¨åˆ°çš„ï¼Œå› ä¸ºå®ƒæ»¡è¶³æœ€å·¦åŸåˆ™ï¼Œå…¶å®æˆ‘ä»¬è”åˆç´¢å¼•å¯ä»¥æŠŠå®ƒçœ‹æˆå‡ ä¸ªå­—æ®µç»™å®ƒæ‹¼èµ·æ¥ï¼Œå°±ä»å·¦å‘å³æ‹¼èµ·æ¥ï¼Œæ‰€ä»¥è¯´ABè‚¯å®šå¯ä»¥ã€‚ACå¯ä»¥æŸ¥ä¸€éƒ¨åˆ†ï¼Œå°±æ˜¯æŸ¥çš„æ€§èƒ½å¯èƒ½æ²¡æœ‰é‚£ä¹ˆå¥½å§ï¼Œæ„Ÿè§‰ä¼šå…ˆæŸ¥Aã€‚å…·ä½“çš„å­—æ®µå¿˜äº†ï¼Œå…·ä½“å­—æ®µå¿˜äº†ï¼Œå®ƒå¥½åƒä¼šæ˜¾ç¤ºç”¨åˆ°å“ªäº›ä»€ä¹ˆrangeä¹‹ç±»çš„ä¸€äº›ç´¢å¼•ï¼Œä½†æ˜¯å…·ä½“çš„ç”¨çš„æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥è¯´æˆ‘å·²ç»è®°ä¸å¤ªæ¸…æ¥šäº†ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>&quot;è¿™æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦å‰ç¼€åŸåˆ™é—®é¢˜ã€‚å¦‚æœå»ºç«‹äº†ABCçš„è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆï¼š</p>
<p>èƒ½å®Œå…¨ä½¿ç”¨ç´¢å¼•çš„ç»„åˆï¼š</p>
<ul>
<li>Aï¼šå¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºAæ˜¯æœ€å·¦è¾¹çš„</li>
<li>ABï¼šå¯ä»¥ä½¿ç”¨ï¼Œç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™</li>
<li>ABCï¼šå¯ä»¥ä½¿ç”¨ï¼Œå®Œå…¨åŒ¹é…</li>
</ul>
<p>èƒ½éƒ¨åˆ†ä½¿ç”¨ç´¢å¼•çš„ç»„åˆï¼š</p>
<ul>
<li>ACï¼šåªèƒ½ä½¿ç”¨Aåˆ—çš„ç´¢å¼•ï¼ŒCåˆ—ç”¨ä¸åˆ°ï¼Œå› ä¸ºç¼ºå°‘ä¸­é—´çš„B</li>
<li>BCï¼šå®Œå…¨ç”¨ä¸åˆ°ç´¢å¼•ï¼Œå› ä¸ºæ²¡æœ‰æœ€å·¦è¾¹çš„A</li>
</ul>
<p>å®Œå…¨ç”¨ä¸åˆ°ç´¢å¼•çš„ç»„åˆï¼š</p>
<ul>
<li>CBã€CAï¼šéƒ½ç”¨ä¸åˆ°ï¼Œå› ä¸ºæ²¡æœ‰ä»æœ€å·¦è¾¹å¼€å§‹</li>
</ul>
<p>è¿™æ˜¯å› ä¸ºè”åˆç´¢å¼•åœ¨B+æ ‘ä¸­æ˜¯æŒ‰ç…§å»ºç«‹é¡ºåºè¿›è¡Œæ’åºçš„ï¼Œå¿…é¡»ä»æœ€å·¦è¾¹å¼€å§‹æ‰èƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ã€‚å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠæŸ¥è¯¢é¢‘ç‡æœ€é«˜ã€åŒºåˆ†åº¦æœ€å¤§çš„å­—æ®µæ”¾åœ¨æœ€å·¦è¾¹ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¯¹æœ€å·¦å‰ç¼€åŸåˆ™ç†è§£ä¸å¤Ÿå‡†ç¡®</li>
<li>éœ€è¦æ·±å…¥ç†è§£è”åˆç´¢å¼•çš„å­˜å‚¨ç»“æ„</li>
<li>åº”è¯¥èƒ½å‡†ç¡®åˆ¤æ–­å„ç§ç»„åˆçš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ</li>
</ul>
<h3 id="é—®é¢˜7ï¼šæµ·é‡æ•°æ®å¤„ç†">é—®é¢˜7ï¼šæµ·é‡æ•°æ®å¤„ç†</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œç»Ÿè®¡æµ·é‡IPæ•°æ®ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å‰åä¸ªIPã€‚æ•°æ®é‡ä¼šæ¯”è¾ƒå¤§ï¼Œå‡è®¾æ˜¯ä¸€ä¸ªIPåœ°å€çš„æ–‡ä»¶ï¼Œç„¶åæ–‡ä»¶ä¸­æœ‰100äº¿ä¸ªIPï¼Œæ–‡ä»¶å¤§å°å¤§çº¦æ˜¯100Gã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;æœ€ç®€å•çš„æ–¹å¼çš„è¯ï¼Œåº”è¯¥æ˜¯æƒ³åˆ°ç”¨ä¸€ä¸ªmapæ¥å­˜ã€‚ä½†æ˜¯100ä¸ªGçš„æ–‡ä»¶ï¼Œå®ƒæ²¡æœ‰åŠæ³•ç›´æ¥åŠ åˆ°å†…å­˜ä¸­ã€‚é¦–å…ˆå®ƒæ˜¯100ä¸ªGçš„æ–‡ä»¶ï¼Œå®ƒä¸å¯èƒ½ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ã€‚é¦–å…ˆæˆ‘ä»¬è‚¯å®šæ˜¯è¿™ä¸ªå‘½ä»¤è¡Œçš„è¯ï¼Œå®ƒè‚¯å®šæ˜¯è¦ç”¨ä¸€äº›æŒ‡é’ˆå»è®°å½•ä¸Šä¸€æ¬¡è¯»å…¥å†…å­˜çš„æ–‡ä»¶çš„åœ°å€ã€‚æˆ‘è®°å¾—C++é‡Œé¢ï¼Œå®ƒåº”è¯¥æ˜¯æœ‰ä¸€ä¸ªæŒ‡é’ˆçš„ï¼Œå°±æ˜¯æ–‡ä»¶çš„æ¸¸æ ‡ã€‚</p>
<p>ç„¶åæˆ‘ä»¬é¦–å…ˆç¬¬ä¸€æ¬¡åˆæ­¥ç»Ÿè®¡å‰ï¼Œå°±æ˜¯åˆæ­¥æˆ‘ä»¬åˆ†æ‰¹æ¬¡è¯»å–ã€‚æ¯”å¦‚è¯´ç¬¬ä¸€æ¬¡è¯»ä¸ªä¸€ä¸ªGç„¶åè¯»å®Œä¸€ä¸ªGä»¥åï¼Œæˆ‘ä»¬å…ˆç”¨ä¸€äº›å¸¸è§„çš„ç®—æ³•å»æŠŠå®ƒå‰10ä¸ªIPç»Ÿè®¡å‡ºæ¥ã€‚ä½†åˆ†æ‰¹æ¬¡è¯»çš„è¯ï¼Œå®ƒä¼šä¸¢å¤±å‰é¢é‚£ä¸€ä¸ªåˆ†å—çš„ä¿¡æ¯ã€‚æ¯”å¦‚è¯´å¯èƒ½ç»Ÿè®¡å‡ºæ¥å‰åä¸ªåˆ†å—ï¼Œå‰åä¸ªåˆ†å—æ¬¡æ•°å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ˜¯IP1ï¼Œç„¶åä»–å‡ºç°äº†åæ¬¡ã€‚ä½†æ˜¯å…¶å®å‡ºç°æ¬¡æ•°ç¬¬äºŒé«˜çš„å®ƒæ˜¯å‡ºç°äº†ä¹æ¬¡ã€‚ä½†æ˜¯åé¢è¿™ä¸ªIP1å®ƒå†ä¹Ÿæ²¡æœ‰è¢«å‡ºç°è¿‡ã€‚ä½†IP2çš„è¯å®ƒä¸€ç›´åˆç»å¸¸æ€§çš„å‡ºç°ã€‚ä½†æ˜¯IP2æ²¡æœ‰è¢«è®¡ç®—è¿›å»ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•è¾¾åˆ°æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>å¯èƒ½å¾—ç”¨å½’å¹¶æ’åºå§ã€‚ä½†å“ˆå¸Œçš„è¯å®ƒä¼šå ç”¨å¾ˆå¤šå†…å­˜ã€‚ä½†æ˜¯è¿™ä¸ªæµ·é‡IPï¼Œå®ƒä¸åº”è¯¥æ˜¯ä¹±åºçš„å—ï¼Ÿæœ‰é‡å¤çš„æœ‰é‡å¤çš„ã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>&quot;è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æµ·é‡æ•°æ®å¤„ç†é—®é¢˜ï¼Œ100Gçš„æ–‡ä»¶æ— æ³•ç›´æ¥åŠ è½½åˆ°å†…å­˜ï¼Œéœ€è¦ç”¨åˆ†æ²»çš„æ€æƒ³ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼šæ•°æ®åˆ†ç‰‡</p>
<ul>
<li>å°†100Gæ–‡ä»¶æŒ‰IPè¿›è¡Œå“ˆå¸Œåˆ†ç‰‡ï¼Œæ¯”å¦‚åˆ†æˆ1ä¸‡ä¸ªå°æ–‡ä»¶</li>
<li>æ¯ä¸ªIPåšhash(IP) % 10000ï¼Œç›¸åŒIPä¸€å®šä¼šåˆ†åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­</li>
<li>è¿™æ ·æ¯ä¸ªå°æ–‡ä»¶å¤§çº¦10Mï¼Œå¯ä»¥æ”¾å…¥å†…å­˜å¤„ç†</li>
</ul>
<p>ç¬¬äºŒæ­¥ï¼šå•æ–‡ä»¶å¤„ç†</p>
<ul>
<li>å¯¹æ¯ä¸ªå°æ–‡ä»¶ï¼Œç”¨HashMapç»Ÿè®¡IPå‡ºç°æ¬¡æ•°</li>
<li>æ‰¾å‡ºæ¯ä¸ªæ–‡ä»¶ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å‰10ä¸ªIP</li>
</ul>
<p>ç¬¬ä¸‰æ­¥ï¼šå…¨å±€åˆå¹¶</p>
<ul>
<li>å°†æ‰€æœ‰å°æ–‡ä»¶çš„top10ç»“æœåˆå¹¶ï¼ˆæœ€å¤š10ä¸‡ä¸ªIPï¼‰</li>
<li>å†æ¬¡ç»Ÿè®¡ï¼Œæ‰¾å‡ºå…¨å±€çš„top10</li>
</ul>
<p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œç©ºé—´å¤æ‚åº¦ï¼šO(k)ï¼Œå…¶ä¸­kæ˜¯å•ä¸ªåˆ†ç‰‡çš„å¤§å°ã€‚</p>
<p>è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯â€™åˆ†è€Œæ²»ä¹‹â€™ï¼Œç¡®ä¿ç›¸åŒIPåœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å‡†ç¡®ç»Ÿè®¡æ¯ä¸ªIPçš„æ€»å‡ºç°æ¬¡æ•°ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åˆšå¼€å§‹æ€è·¯ä¸å¤Ÿæ¸…æ™°ï¼Œè¢«100Gçš„æ•°æ®é‡å“åˆ°äº†</li>
<li>ç»è¿‡é¢è¯•å®˜æç¤ºåç†è§£äº†å“ˆå¸Œåˆ†ç‰‡çš„æ€è·¯</li>
<li>éœ€è¦åŠ å¼ºå¤§æ•°æ®å¤„ç†çš„ç®—æ³•æ€ç»´</li>
</ul>
<h3 id="é—®é¢˜8ï¼šæŠ½å¥–ç®—æ³•å®ç°">é—®é¢˜8ï¼šæŠ½å¥–ç®—æ³•å®ç°</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå®ç°ä¸€ä¸ªæŠ½å¥–ç¨‹åºï¼Œæœ‰ä¸€ä¸ªæ¦‚ç‡è¡¨ï¼šä¸€ç­‰å¥–0.1ï¼ŒäºŒç­‰å¥–0.1ï¼Œä¸‰ç­‰å¥–0.2ï¼Œå››ç­‰å¥–0.4ï¼Œæ¦‚ç‡å’Œæ˜¯1ã€‚è¦æ±‚å®ç°è¿™ä¸ªæŠ½å¥–çš„ç®—æ³•ï¼Œå¹¶ä¸”æ‰§è¡Œ1ä¸‡æ¬¡æŠ½å¥–ï¼Œç„¶åè®¡ç®—æ¯ä¸ªå¥–é¡¹çš„æ€»å’Œã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>[ç°åœºç¼–ç¨‹å®ç°äº†åŸºäºéšæœºæ•°å’Œæ¦‚ç‡ç´¯åŠ çš„æŠ½å¥–ç®—æ³•]</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>&quot;è¿™ä¸ªæŠ½å¥–ç®—æ³•æˆ‘ç”¨æ¦‚ç‡åŒºé—´çš„æ–¹å¼æ¥å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lottery</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// æ¦‚ç‡è¡¨ï¼š[0.1, 0.1, 0.2, 0.4, 0.2]</span></span><br><span class="line">    probabilities := []<span class="type">float64</span>&#123;<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.2</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”Ÿæˆ0-1ä¹‹é—´çš„éšæœºæ•°</span></span><br><span class="line">    rand := rand.Float64()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç´¯åŠ æ¦‚ç‡ï¼Œæ‰¾åˆ°å¯¹åº”åŒºé—´</span></span><br><span class="line">    cumulative := <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> i, prob := <span class="keyword">range</span> probabilities &#123;</span><br><span class="line">        cumulative += prob</span><br><span class="line">        <span class="keyword">if</span> rand &lt;= cumulative &#123;</span><br><span class="line">            <span class="keyword">return</span> i + <span class="number">1</span>  <span class="comment">// è¿”å›å¥–é¡¹ç¼–å·</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(probabilities) <span class="comment">// å…œåº•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œå…¶ä¸­næ˜¯å¥–é¡¹æ•°é‡ã€‚å¦‚æœå¥–é¡¹å¾ˆå¤šï¼Œå¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–åˆ°O(log n)ã€‚</p>
<p>æ‰§è¡Œ1ä¸‡æ¬¡çš„ç»“æœåº”è¯¥æ¥è¿‘ç†è®ºæœŸæœ›ï¼šä¸€ç­‰å¥–çº¦1000æ¬¡ï¼ŒäºŒç­‰å¥–çº¦1000æ¬¡ï¼Œä¸‰ç­‰å¥–çº¦2000æ¬¡ï¼Œå››ç­‰å¥–çº¦4000æ¬¡ï¼Œäº”ç­‰å¥–çº¦2000æ¬¡ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>ç°åœºç¼–ç¨‹åŸºæœ¬å®ç°æ­£ç¡®</li>
<li>è€ƒè™‘äº†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦</li>
<li>å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæ¯”å¦‚é¢„å¤„ç†ç´¯ç§¯æ¦‚ç‡æ•°ç»„</li>
</ul>
<h3 id="é—®é¢˜9ï¼šRedisä¸gRPC">é—®é¢˜9ï¼šRedisä¸gRPC</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œRedisçš„æŒä¹…åŒ–æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæŒä¹…åŒ–çš„è¯å®ƒæœ‰ä¸¤ç§ï¼Œä¸€ç§å«AOFï¼Œä¸€ç§å«RDBã€‚ç„¶åAOFçš„è¯ï¼Œå®ƒç›¸å½“äºæ˜¯è®°å½•åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶é‡Œé¢ã€‚å®ƒå› ä¸ºå®ƒAOFå®ƒå…¨åå«append only fileï¼Œå®ƒå®é™…ä¸Šæ˜¯æŠŠæ¯æ¬¡è¯·æ±‚ï¼Œæ¯æ¬¡æ“ä½œéƒ½ç»™å®ƒåŠ åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶é‡Œé¢å»ã€‚RDBçš„è¯å®ƒç›¸å½“äºæ˜¯ä¸€ä¸ªé•œåƒï¼Œå®ƒä¼šæŠŠæ•´ä¸ªæ•°æ®åº“å…¨é‡ç»™å®ƒä¿å­˜ä¸‹æ¥ï¼Œä½†å®ƒä¸ä¼šä¿å­˜æ¯æ¬¡æ“ä½œè®°å½•ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ é¡¹ç›®é‡Œé¢æœ‰ç”¨åˆ°è¿‡gRPCå¯¹å§ï¼Ÿè¯´è¯´gRPCå’Œrestful APIçš„åŒºåˆ«ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œå¯¹ï¼ŒgRPCçš„è¯é¦–å…ˆå®ƒrestful APIçš„è¯ä»–ç”¨çš„æ˜¯HTTPåè®®ï¼ŒgRPCå¥½åƒæ˜¯RPCåè®®ï¼Œè¿˜æ˜¯ä»–è‡ªå·±ç ”å‘çš„ä¸€å¥—åè®®ï¼Œä¸å¤ªè®°å¾—ã€‚ä½†å®ƒè‚¯å®šæ˜¯RPCã€‚é¦–å…ˆRPCå®ƒæ˜¯å»æ‰äº†HTTPé‡Œé¢çš„ä¸€äº›ä¸œè¥¿çš„ï¼Œæ‰€ä»¥è¯´å®ƒçš„æ€§èƒ½ä¼šæ›´é«˜ä¸€ç‚¹ï¼Œå®ƒæ›´é€‚åˆå»åšå†…ç½‘çš„é€šä¿¡ä»€ä¹ˆçš„ã€‚æ‰€ä»¥è¯´æˆ‘ä»¬ä¸€èˆ¬æ¥è¯´å°±æ˜¯å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨éƒ½ä½¿ç”¨RPCåè®®ã€‚é™¤éæœ‰çš„æ—¶å€™å°±æ¯”å¦‚è¯´æœ‰åˆ«çš„å…¬å¸æƒ³è®©ä½ æ¥è°ƒç”¨ä»–çš„å¾®æœåŠ¡ï¼Œä½†æ˜¯ä»–çš„RPCè‚¯å®šä¸å¯èƒ½å‘ä½ å¼€æ”¾ã€‚é‚£è¿™ä¸ªæ—¶å€™è¿˜æ˜¯è¦ä½¿ç”¨restful APIå»è°ƒç”¨ä»–å¾®æœåŠ¡ï¼Œä¸»è¦æ˜¯è€ƒè™‘è¿™ä¸ªã€‚å°±æ˜¯å†…ç½‘å’Œå¤–ç½‘çš„åŒºåˆ«ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ æŠ€æœ¯é€‰å‹ä½ æ˜¯æ€ä¹ˆæ€ä¹ˆåšçš„ï¼Ÿå°±å†³å®šç”¨è¿™ä¸€å¥—ã€‚ä»¥å‰åšè¿‡ç±»ä¼¼çš„é¡¹ç›®å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä»¥å‰å°±ä¸‹é¢é‚£ä¸€ä¸ªå«AIGCçš„ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®ã€‚ä½†æ˜¯æˆ‘ä¸€å¼€å§‹æ¥è§¦å¾®æœåŠ¡çš„æ—¶å€™å°±æ˜¯æ¥è§¦gRPCçš„ï¼Œæ‰€ä»¥è¯´æˆ‘éƒ½æ˜¯è¿™ä¹ˆé€‰çš„ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæŠ–éŸ³å•†åŸçš„æŠ€æœ¯æ ˆå’Œå‰é¢é‚£ä¸ªAIGCçš„é¡¹ç›®æŠ€æœ¯æ ˆé‡Œé¢æœ‰ä»€ä¹ˆå·®å¼‚å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæŠ–éŸ³å•†åŸçš„æŠ€æœ¯æ ˆçš„è¯å®ƒæ˜¯æ¯”è¾ƒä¸°å¯Œä¸€ç‚¹ï¼Œä½†æ˜¯AIGCçš„è¯å®ƒæ›´å¤šã€‚å› ä¸ºç°åœ¨AIå®ƒæƒ³è¦ç”¨æˆ·å»å“åº”çš„å‹å¥½ä¸€ç‚¹ï¼Œä»–è‚¯å®šæ˜¯è¦ç”¨æµå¼APIå»è°ƒç”¨çš„ã€‚ç„¶åæµå¼APIåœ¨å¾®æœåŠ¡ä¸­å®ƒå¯èƒ½å°±ä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚ç„¶åå°±åœ¨AIGCå¾®æœåŠ¡è°ƒç”¨çš„æ—¶å€™ï¼ŒAIGCè¿™ä¸ªé¡¹ç›®å¾®æœåŠ¡è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨server streamingå»è°ƒç”¨ã€‚å°±æ˜¯ä»–ç”¨æµå¼å»è°ƒç”¨ã€‚ä¸»è¦æ˜¯è¿™ä¸€ç‚¹åŒºåˆ«ï¼Œç„¶åä»¥åŠä»–ä»–éœ€è¦ä¸€ä¸ªæ³›åŒ–è°ƒç”¨ï¼Œå°±æ˜¯AIGC nativeå®ƒè¿˜æœ‰ä¸€ä¸ªæŠ€æœ¯ä½“ç°åœ¨æ³›åŒ–è°ƒç”¨ã€‚â€</p>
</blockquote>
<h3 id="é—®é¢˜10ï¼šMySQLæ•°æ®å¼•æ“ä¸åº“å­˜é—®é¢˜">é—®é¢˜10ï¼šMySQLæ•°æ®å¼•æ“ä¸åº“å­˜é—®é¢˜</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œmysqlå¸¸ç”¨çš„æ•°æ®å¼•æ“æœ‰å“ªäº›ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œé¦–å…ˆæ˜¯InnoDBï¼Œç„¶åè¿˜æœ‰ä¸€ä¸ªå«MyISAMï¼Œç„¶åè¿˜æœ‰ä¸€ä¸ªæ˜¯å¥½åƒæ˜¯ç›´æ¥å­˜åˆ°å†…å­˜é‡Œé¢çš„ä¸€ä¸ªå¼•æ“ï¼Œå…·ä½“åå­—æˆ‘ä¸å¤ªè®°å¾—ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œMemoryé‚£ä¸ªmemoryè¿™ä¸ªåœºæ™¯æ¯”è¾ƒç‰¹æ®Šï¼Œä¸€èˆ¬æŒä¹…åŒ–çš„InnoDBå’ŒMyISAMå®ƒçš„ç‰¹æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œInnoDBçš„è¯å®ƒä¸»è¦æ˜¯æ”¯æŒACIDç‰¹æ€§ã€‚ç„¶åMyISAMçš„è¯å®ƒæ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ï¼Œç„¶åä»–å¥½åƒä¹Ÿæ²¡æœ‰å¾ˆå¼ºçš„ä¸€äº›é”ä¹‹ç±»èƒ½åŠ›ã€‚ä»–åº”è¯¥ä¸»è¦é¢å‘äºæŸ¥è¯¢è¿™ä¸ªåœºæ™¯çš„ä¸€ä¸ªå¼•æ“ã€‚åƒInnoDBçš„è¯çš„åŠŸèƒ½å°±æ¯”è¾ƒå®Œå–„ï¼Œå¢åˆ æ”¹æŸ¥å®ƒéƒ½æ¯”è¾ƒæœ‰æ¯”è¾ƒå¥½çš„æ€§èƒ½ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæŠ–éŸ³å•†åŸé‡Œé¢ä¸å¯é¿å…çš„ä¼šæœ‰å•†å“åº“å­˜é—®é¢˜ï¼Œè¿™ä¸ªåº“å­˜é—®é¢˜ä½ æ€ä¹ˆè§£å†³çš„ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œé¦–å…ˆæˆ‘å¯ä»¥è¯´ä¸€ä¸‹ï¼Œå…¶å®æˆ‘ä»¬å½“æ—¶æ²¡æœ‰åšåº“å­˜è¿™ä¸ªä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘æœ‰æ€è·¯ã€‚åº“å­˜çš„è¯å®ƒæœ‰å¥½å‡ ç§æ–¹å¼ã€‚ä¸€ç§å°±æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œé¢ï¼Œå®ƒæœ‰ä¸ªå«åˆ†å¸ƒå¼äº‹åŠ¡è¿™ä¸ªä¸œè¥¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡å»ç»™å®ƒæ‰£å‡åº“å­˜ã€‚ç„¶åè¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯ç”¨Redis Luaè„šæœ¬å»æ‰£å‡ã€‚è¿™ä¸ªçš„è¯æ˜¯æˆ‘çš„é˜Ÿå‘˜å»å®ç°ï¼Œç„¶åæˆ‘çœ‹åˆ°ä»–å»è¿™ä¹ˆå®ç°ï¼Œç„¶åç¨å¾®çœ‹äº†ä¸€ä¸‹ã€‚ä½†æ˜¯ä»–æœ€åå› ä¸ºæˆ‘ä»¬å½“æ—¶åˆ†å·¥çš„æ—¶å€™ï¼Œå°±æ˜¯ä»–ä¸çŸ¥é“æ²¡æœ‰åº“å­˜è¿™ä¸ªä¸œè¥¿ï¼Œç„¶åä»–å®ç°äº†åº“å­˜è¿™ä¸ªä¸œè¥¿ã€‚ç„¶åçš„è¯æˆ‘è¿˜æœ‰ä¸€äº›å°±æ˜¯ç”¨Redisè¿›è¡ŒåŠ é”ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œè·å–é”å’Œé‡Šæ”¾é”åˆ†åˆ«æ˜¯ä»€ä¹ˆæ“ä½œï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè¿™ä¸ªæœ‰ä¸€ç‚¹ä¸å¤ªè®°å¾—äº†ï¼Œå› ä¸ºéƒ½æ˜¯åœ¨å‡½æ•°é‡Œé¢å»è°ƒç”¨lock unlockæ–¹æ³•ã€‚å°±å‰ç«¯æ˜¯Hertzï¼Œå«å‰ç«¯æ˜¯ç”¨çš„Ginã€‚â€</p>
</blockquote>
<h3 id="é—®é¢˜11ï¼šWebå®‰å…¨æ¼æ´ä¸ä¸ªäººèƒŒæ™¯">é—®é¢˜11ï¼šWebå®‰å…¨æ¼æ´ä¸ä¸ªäººèƒŒæ™¯</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¸¸è§çš„å¤–éƒ¨å¼€å‘é‡Œé¢çš„å®‰å…¨æ¼æ´ï¼Œè¿™ä¸ªæœ‰äº†è§£å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;å¸¸è§çš„webå¼€å‘å®‰å…¨æ¼æ´ï¼Œç¬¬ä¸€ä¸ªSQLæ³¨å…¥ï¼Œè¿™ä¸ªæ¼æ´çš„è¯åŸºæœ¬ä¸Šè¢«ç°åœ¨å› ä¸ºç”¨ORMæ¡†æ¶ç”¨çš„æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šå·²ç»è¢«åŸºæœ¬ä¸Šè§£å†³äº†ã€‚ä½†æ˜¯ä¸æ’é™¤ä¸€äº›å…¬å¸ä»–è¿˜åœ¨æ²¿ç”¨é‚£ç§å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼å»å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚ä»–æˆ‘è®°å¾—ä»¥å‰ç”¨PHPçš„æ—¶å€™ï¼Œå®ƒæœ‰360çš„ä¸€ä¸ªå®‰å…¨åº“ï¼Œå®ƒå¯ä»¥åšä¸€ä¸ªæµ…å±‚çš„è¿‡æ»¤ï¼Œç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å»åšè¿‡æ»¤ã€‚å°±æ˜¯å®ƒä¼šæœ‰å„ç§å„æ ·çš„ä¸å®‰å…¨çš„é‚£äº›å­—ç¬¦ç»„åˆå°±ç”¨é‚£ç§æ–¹å¼å¯ä»¥è¿‡æ»¤ã€‚</p>
<p>ç„¶åXSSæ¼æ´çš„è¯ï¼ŒXSSçš„æ¼æ´ä¸»è¦å°±æ˜¯å…¶å®ä»–é˜²èŒƒçš„å°±æ˜¯é˜²èŒƒä¸»è¦æ˜¯è„šæœ¬ã€‚æ‰€ä»¥è¯´ç°åœ¨çš„è¯æˆ‘äº†è§£åˆ°æœ€æ–°çš„æ–¹å¼å°±æ˜¯åœ¨HTTPè¯·æ±‚çš„headerå¤´é‡Œé¢ï¼Œå®ƒæœ‰ä¸€ä¸ªheaderï¼Œä½ å¯ä»¥å»ç»™å®ƒå¼€å¯ã€‚ç„¶åå®ƒå°±å¯ä»¥é˜²èŒƒè¿™ä¸ªXSSçš„æ³¨å…¥ã€‚å®ƒå°±å¯ä»¥å³ä½¿ä½ æœ‰XSSä»£ç ï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šä¸å…è®¸ä½ è·³è½¬åˆ°ä¸€äº›ä½ ä¸å…è®¸çš„ç½‘ç«™é‡Œé¢å»ï¼Œè¿™æ ·å°±èƒ½ä¸€å®šç¨‹åº¦ä¸Šé˜²èŒƒè¿™ä¸ªæ¼æ´äº†ã€‚&quot;</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæ¯”è¾ƒæ—©æ˜¯å¤šæ—©ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘åˆä¸‰çš„æ—¶å€™å°±æ¥è§¦ï¼Œå½“æ—¶åœ¨æ¥è§¦PHPã€‚å¯¹ï¼Œè‡ªå·±åšç½‘ç«™ã€‚å› ä¸ºå½“æ—¶çš„æ—¶å€™ä¹Ÿæ˜¯ä¸ºäº†æ”’é’±ï¼Œä¹°ä¸€äº›è‡ªå·±æƒ³è¦çš„ä¸œè¥¿ã€‚å°±æ˜¯å½“æ—¶å¾ˆç«çš„ä¸€äº›æˆæƒä¹‹ç±»çš„ã€‚å°±æ˜¯ä½ åšä¸€ä¸ªå¥½çš„äº§å“ï¼Œç„¶åä½ å¯ä»¥æˆæƒå–ç»™åˆ«äººã€‚é‚£æ˜¯å¾ˆæ—©ï¼Œå¤§æ¦‚13ã€14å¹´ã€‚PHPä¼°è®¡ä¸¤ä¸‰å¹´ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ çš„å®ä¹ çš„æ—¶é—´æ˜¯å››æœˆä»½å¼€å§‹ï¼Œæ—¶é•¿æ˜¯å¤šä¹…ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œèƒ½ä¸€å¹´å—ï¼Ÿä¸€å¹´ï¼Œå› ä¸ºæˆ‘è®ºæ–‡æˆ‘åŸºæœ¬ä¸Šå†™çš„å·®ä¸å¤šäº†ï¼Œæˆ‘å…¶å®æ›´æƒ³åœ¨å…¬å¸é‡Œé¢å­¦åˆ°æ›´å¤šçš„ä¸œè¥¿ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ ç©æ¸¸æˆå—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œç©è¿‡ã€‚åŸºæœ¬ä¸Šå°±å¹³å¸¸å¶å°”ç©ä¸€ç©ç‹è€…è£è€€ã€‚å› ä¸ºå¹³å¸¸çš„è¯ä¸»è¦è¿˜æ˜¯åœ¨å†™ä»£ç ï¼Œç„¶åå­¦ç´¯äº†æˆ‘ä¼šç©ä¸€ç©ç‹è€…è£è€€ã€‚æ˜Ÿè€€æ®µä½ã€‚æˆ‘ä¸Šè¿‡ç‹è€…ï¼Œå¾ˆæ—©ä¹‹å‰ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>&quot;Webå¼€å‘ä¸­å¸¸è§çš„å®‰å…¨æ¼æ´ä¸»è¦æœ‰ï¼š</p>
<ol>
<li>
<p>SQLæ³¨å…¥ï¼šé€šè¿‡åœ¨è¾“å…¥ä¸­æ³¨å…¥æ¶æ„SQLä»£ç æ¥æ“ä½œæ•°æ®åº“</p>
<ul>
<li>é˜²èŒƒï¼šä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ã€å‚æ•°åŒ–æŸ¥è¯¢</li>
<li>å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰</li>
</ul>
</li>
<li>
<p>XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰ï¼šåœ¨é¡µé¢ä¸­æ³¨å…¥æ¶æ„è„šæœ¬</p>
<ul>
<li>é˜²èŒƒï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒHTMLè½¬ä¹‰</li>
<li>è®¾ç½®CSPï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰å¤´</li>
<li>ä½¿ç”¨HttpOnly cookie</li>
</ul>
</li>
<li>
<p>CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ï¼šåˆ©ç”¨ç”¨æˆ·ç™»å½•çŠ¶æ€è¿›è¡Œæ¶æ„æ“ä½œ</p>
<ul>
<li>é˜²èŒƒï¼šä½¿ç”¨CSRF token</li>
<li>éªŒè¯Refererå¤´</li>
<li>è®¾ç½®SameSite cookieå±æ€§</li>
</ul>
</li>
<li>
<p>æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼šä¸Šä¼ æ¶æ„æ–‡ä»¶æ‰§è¡Œä»£ç </p>
<ul>
<li>é˜²èŒƒï¼šé™åˆ¶æ–‡ä»¶ç±»å‹å’Œå¤§å°</li>
<li>æ–‡ä»¶å†…å®¹æ£€æŸ¥</li>
<li>å­˜å‚¨åœ¨éæ‰§è¡Œç›®å½•</li>
</ul>
</li>
<li>
<p>æƒé™æ§åˆ¶æ¼æ´ï¼šæœªæ­£ç¡®éªŒè¯ç”¨æˆ·æƒé™</p>
<ul>
<li>é˜²èŒƒï¼šä¸¥æ ¼çš„æƒé™æ ¡éªŒ</li>
<li>æœ€å°æƒé™åŸåˆ™</li>
</ul>
</li>
</ol>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨å®‰å…¨æ¡†æ¶æ¥é˜²èŒƒè¿™äº›æ¼æ´ï¼Œæ¯”å¦‚Spring Securityã€OWASPçš„å®‰å…¨ç»„ä»¶ç­‰ã€‚&quot;</p>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¦‚æœå¦‚æœè¿™æ˜¯ä¸€ä¸ªå·²ç»ä¸Šçº¿çš„ä¸šåŠ¡ï¼Œä½ å»çœ‹ä¸€ä¸ªslow queryå°±æœ‰ä¸ªæ…¢æŸ¥è¯¢çš„æ—¥å¿—ã€‚ä½ æ€ä¹ˆåˆ†æè¿™ä¸ªè¡¨çš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ç”¨åˆ°ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘è®°å¾—å¥½åƒæœ‰ä¸€ä¸ªå«explainå‘½ä»¤ã€‚å…·ä½“çš„å­—æ®µå¿˜äº†ï¼Œå…·ä½“å­—æ®µå¿˜äº†ï¼Œå®ƒå¥½åƒä¼šæ˜¾ç¤ºç”¨åˆ°å“ªäº›ä»€ä¹ˆrangeä¹‹ç±»çš„ä¸€äº›ç´¢å¼•ï¼Œä½†æ˜¯å…·ä½“çš„ç”¨çš„æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥è¯´æˆ‘å·²ç»è®°ä¸å¤ªæ¸…æ¥šäº†ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œç°åœ¨è¿™ä¸ªåœºæ™¯ç¨å¾®å˜ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯ä»¥QQå·å°±æ˜¯åˆ«çš„è´¦å·ä½“ç³»ç”Ÿæˆçš„è´¦å·ä¸ºä¾‹ï¼Œæˆ‘ä»¬è¦è®¾è®¡æŠ–éŸ³å•†åŸçš„ä¸€ä¸ªç”¨æˆ·è®¿é—®æ•°æ®ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬è¦è®°å½•ç”¨æˆ·æµè§ˆå•†å“çš„æ‰€æœ‰çš„æ—¥å¿—ï¼Œæ¥åˆ°æ•°æ®åº“ï¼Œç„¶ååé¢å¯èƒ½ä¾›æ•°æ®æŒ–æ˜å»åšå•†å“æ¨èä½¿ç”¨ï¼Œè¿™ä¸ªæµé‡ä¼šæ¯”è¾ƒå¤§ï¼Œæ¯å¤©500ä¸‡çš„æµè§ˆé‡ã€‚è¿™ä¸ªæ•°æ®å­˜å‚¨ä½ æ€ä¹ˆè®¾è®¡ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè¿™ç§ä¸€èˆ¬æ˜¯ç”¨æ•°ä»“æ¥å­˜å‚¨çš„ã€‚é¦–å…ˆæˆ‘ä»¬æ‰€ä»¥å¼•æ“çš„è¯å¯èƒ½è¦æ”¹ä¸€ä¸‹ï¼Œæ”¹æˆé‚£ä¸ªMyISAMã€‚å› ä¸ºå®ƒåªæœ‰å¢å’ŒæŸ¥è¿™ä¸¤ä¸ªä¸»è¦æ“ä½œï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬å¹¶ä¸éœ€è¦å¯¹å®ƒå»æ”¹å’Œåˆ ã€‚æ‰€ä»¥è¯´çš„è¯é¦–å…ˆå¼•æ“è¿™æ–¹é¢è¦å˜æ‰ï¼Œç„¶åå…¶æ¬¡çš„è¯è¡¨çš„è®¾è®¡ã€‚è¡¨çš„è®¾è®¡çš„è¯æœ€å¥½è¿˜æ˜¯è®¾è®¡æˆä¸€ä¸ªè¡¨ã€‚å°±æ˜¯ç”¨æˆ·ç›¸å…³ä¿¡æ¯ï¼Œä»¥åŠå•†å“å¯¹åº”çš„å…³ç³»ï¼Œå®ƒéƒ½è®¾è®¡æˆä¸€ä¸ªè¡¨ä¸­ï¼Œä¸è¦å°½é‡ä¸è¦è¿›è¡Œå¤šè¡¨å…³è”ï¼Œå¤šè¡¨å…³è”çš„è¯å¯èƒ½ä¼šæ¯”è¾ƒæ¶ˆè€—ä¸€äº›å†…å­˜ã€‚è€ƒè™‘å®ƒçš„æ•°æ®é‡çº§ã€‚æ€ä¹ˆå­˜ï¼Ÿä»–è¿™ç§æ•°æ®é‡çº§çš„è¯ï¼Œä¸€èˆ¬æ˜¯è¦åˆ†åº“åˆ†è¡¨ã€‚æ ¹æ®æµè§ˆæ—¶é—´è¿›è¡Œåˆ†è¡¨ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬ä»¥ä¸€å¹´ä¸ºä¸€ä¸ªç»´åº¦ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæŠŠå®ƒæ‹†æˆ12ä¸ªæœˆï¼Œç„¶åæ¯ä¸ªæœˆå®ƒæœ‰ä¸€ä¸ªè‡ªå·±çš„è¡¨ï¼Œæˆ–è€…è¯´æ¯ä¸€å¤©ä»–æœ‰ä¸€ä¸ªå•ç‹¬çš„è¡¨ã€‚è¿™æ ·çš„è¯æŸ¥è¯¢èµ·æ¥å‹åŠ›åº”è¯¥æ²¡æœ‰é‚£ä¹ˆå¤§äº†ï¼Œå°±æ˜¯å­˜å‚¨èµ·æ¥å‹åŠ›åº”è¯¥å°±æ²¡æœ‰é‚£ä¹ˆå¤§äº†ã€‚â€</p>
</blockquote>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ¦‚å¿µäº†è§£ï¼Œä½†æ·±åº¦ä¸å¤Ÿ</li>
<li>éœ€è¦æ›´ç³»ç»Ÿåœ°å­¦ä¹ Webå®‰å…¨çŸ¥è¯†</li>
<li>åº”è¯¥ç»“åˆå®é™…é¡¹ç›®ç»éªŒæ¥å›ç­”</li>
<li>å¯¹å¤§æ•°æ®é‡å¤„ç†æœ‰ä¸€å®šæ€è·¯ï¼Œä½†ç¼ºä¹æ›´æ·±å…¥çš„åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ</li>
</ul>
<h2 id="é¢è¯•æ•´ä½“æ„Ÿå—">é¢è¯•æ•´ä½“æ„Ÿå—</h2>
<ul>
<li><strong>éš¾åº¦è¯„ä»·</strong>: é€‚ä¸­åéš¾</li>
<li><strong>é¢è¯•å®˜é£æ ¼</strong>: ä¸“ä¸šã€è€å¿ƒï¼Œä¼šé€‚å½“å¼•å¯¼</li>
<li><strong>é¢˜ç›®ç±»å‹</strong>: åé‡å®é™…åº”ç”¨ï¼Œè€ƒå¯Ÿé¡¹ç›®ç»éªŒã€ç³»ç»Ÿè®¾è®¡ã€ç¼–ç¨‹åŸºç¡€</li>
<li><strong>å‡†å¤‡å»ºè®®</strong>: éœ€è¦æœ‰å®é™…çš„é¡¹ç›®ç»éªŒï¼Œå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿã€æ•°æ®åº“ä¼˜åŒ–è¦æœ‰æ·±å…¥ç†è§£</li>
</ul>
<h2 id="é¢è¯•ç»“æœ">é¢è¯•ç»“æœ</h2>
<ul>
<li><strong>å½“åœºåé¦ˆ</strong>: é¢è¯•å®˜å¯¹é¡¹ç›®ç»éªŒæ¯”è¾ƒè®¤å¯ï¼ŒæŒ‡å‡ºäº†ä¸€äº›æŠ€æœ¯æ·±åº¦ä¸è¶³çš„åœ°æ–¹</li>
<li><strong>åç»­æµç¨‹</strong>: ç­‰å¾…HRé€šçŸ¥åç»­é¢è¯•å®‰æ’</li>
<li><strong>ä¸ªäººæ„Ÿå—</strong>: æ•´ä½“è¡¨ç°ä¸­ç­‰ï¼Œé¡¹ç›®ç»éªŒæ˜¯äº®ç‚¹ï¼Œä½†æŠ€æœ¯æ·±åº¦è¿˜éœ€åŠ å¼º</li>
</ul>
<h2 id="ç»éªŒæ€»ç»“">ç»éªŒæ€»ç»“</h2>
<h3 id="åšå¾—å¥½çš„åœ°æ–¹">åšå¾—å¥½çš„åœ°æ–¹</h3>
<ol>
<li><strong>é¡¹ç›®ç»éªŒä¸°å¯Œ</strong>: æŠ–éŸ³é’è®­è¥é¡¹ç›®ä½“ç°äº†å®Œæ•´çš„å¼€å‘ç»éªŒ</li>
<li><strong>å­¦ä¹ èƒ½åŠ›å¼º</strong>: ä½“ç°äº†æŒç»­å­¦ä¹ å’ŒæŠ€æœ¯å¹¿åº¦æ¢ç´¢çš„æ„æ„¿</li>
<li><strong>æ²Ÿé€šè¡¨è¾¾</strong>: èƒ½å¤Ÿæ¸…æ™°è¡¨è¾¾æŠ€æœ¯æ€è·¯ï¼Œé€»è¾‘æ€§è¾ƒå¥½</li>
</ol>
<h3 id="éœ€è¦æ”¹è¿›çš„åœ°æ–¹">éœ€è¦æ”¹è¿›çš„åœ°æ–¹</h3>
<ol>
<li><strong>æŠ€æœ¯æ·±åº¦</strong>: å¯¹åˆ†å¸ƒå¼äº‹åŠ¡ã€æ•°æ®åº“ä¼˜åŒ–ç­‰æ·±å±‚æŠ€æœ¯ç†è§£ä¸å¤Ÿ</li>
<li><strong>ç³»ç»Ÿè®¾è®¡</strong>: æµ·é‡æ•°æ®å¤„ç†ç­‰ç®—æ³•æ€ç»´éœ€è¦åŠ å¼º</li>
<li><strong>å®‰å…¨çŸ¥è¯†</strong>: Webå®‰å…¨æ¼æ´çš„é˜²èŒƒæªæ–½æŒæ¡ä¸å¤Ÿå…¨é¢</li>
</ol>
<h3 id="å‡†å¤‡å»ºè®®">å‡†å¤‡å»ºè®®</h3>
<ol>
<li><strong>æ·±å…¥å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>: é‡ç‚¹æŒæ¡åˆ†å¸ƒå¼äº‹åŠ¡ã€ä¸€è‡´æ€§ç®—æ³•ã€æœåŠ¡æ²»ç†</li>
<li><strong>æ•°æ®åº“ä¼˜åŒ–</strong>: æ·±å…¥ç†è§£MySQLç´¢å¼•åŸç†ã€æŸ¥è¯¢ä¼˜åŒ–ã€åˆ†åº“åˆ†è¡¨</li>
<li><strong>ç³»ç»Ÿè®¾è®¡èƒ½åŠ›</strong>: å¤šç»ƒä¹ å¤§æ•°æ®é‡å¤„ç†ã€é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡</li>
<li><strong>å®‰å…¨çŸ¥è¯†</strong>: ç³»ç»Ÿå­¦ä¹ OWASP Top 10ï¼Œäº†è§£å¸¸è§å®‰å…¨é˜²æŠ¤æªæ–½</li>
<li><strong>ç®—æ³•åŸºç¡€</strong>: åŠ å¼ºæµ·é‡æ•°æ®å¤„ç†ã€åˆ†æ²»ç®—æ³•ç­‰åŸºç¡€ç®—æ³•èƒ½åŠ›</li>
</ol>
<h3 id="çŸ¥è¯†ç‚¹å¤ä¹ æ¸…å•">çŸ¥è¯†ç‚¹å¤ä¹ æ¸…å•</h3>
<ul>
<li>[ ] åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆ2PCã€TCCã€SAGAï¼‰</li>
<li>[ ] MySQLç´¢å¼•ä¼˜åŒ–å’Œè”åˆç´¢å¼•åŸç†</li>
<li>[ ] RedisæŒä¹…åŒ–æœºåˆ¶å’Œåˆ†å¸ƒå¼é”</li>
<li>[ ] å¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼</li>
<li>[ ] Webå®‰å…¨æ¼æ´é˜²æŠ¤</li>
<li>[ ] æµ·é‡æ•°æ®å¤„ç†ç®—æ³•</li>
<li>[ ] ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–ç­–ç•¥</li>
</ul>
<h3 id="å¯¹IEGè¿è¥å¼€å‘å²—ä½çš„ç†è§£">å¯¹IEGè¿è¥å¼€å‘å²—ä½çš„ç†è§£</h3>
<p><strong>é¢è¯•å®˜ä»‹ç»</strong>ï¼š</p>
<blockquote>
<p>&quot;æˆ‘ä»¬éƒ¨é—¨æ¯”è¾ƒå¤§ï¼Œéƒ¨é—¨æ•´åº”è¯¥è¯´æˆ‘ä»¬éƒ¨é—¨è´Ÿè´£çš„æ˜¯è…¾è®¯äº’å¨±ï¼Œäº’å¨±ä¹Ÿå°±æ˜¯æˆ‘ä»¬é‚£ä¸ªäº’åŠ¨å¨±ä¹è¿è¥ã€‚ä½ åˆ«è¯´ä»–ç°åœ¨å«IEGï¼Œè…¾è®¯çš„å·¥ä½œå®¤ç¾¤åˆ’åˆ†ï¼Œè¿™ä¸ªä½ çŸ¥é“å¯¹å§ï¼Ÿè…¾è®¯äº‘å¯¹å¾®ä¿¡ï¼Œå¤§æ¦‚åˆ†è¿™ä¹ˆå‡ ä¸ªBGã€‚IEGå°±æ˜¯å¯ä»¥ç»Ÿç§°è…¾è®¯äº’å¨±ï¼Œæ‰€æœ‰çš„æ¸¸æˆç›¸å…³çš„éƒ½åœ¨è¿™ä¸ªäº‹ä¸šç¾¤ã€‚ç„¶åæˆ‘ä»¬éƒ¨é—¨çš„è¯æ˜¯åœ¨IEGä¹‹ä¸‹åšæ¸¸æˆæ ¸å¿ƒç©æ³•ä»¥å¤–çš„ä¸€äº›å‘¨è¾¹çš„ç³»ç»Ÿå·¥å…·è¿è¥æ´»åŠ¨ç­‰ç­‰ã€‚ç›¸å…³çš„é¡¹ç›®å¯èƒ½éƒ½åœ¨æˆ‘ä»¬è¿™å„¿ã€‚é‚£æ¸¸æˆå·¥ä½œå®¤çš„è¯å°±å¾ˆå¥½ç†è§£ï¼Œä»–ä»¬åšæ¸¸æˆæœ¬èº«ï¼Œæ¸¸æˆç©æ³•å°±æ˜¯å®¢æˆ·ç«¯ã€‚</p>
<p>ç„¶åé™¤äº†ä½ èƒ½ç©åˆ°çš„é‚£ä¸ªæ¸¸æˆæœ¬èº«çš„ä¸œè¥¿ï¼Œè¿˜ä¼šæœ‰ä¸€äº›åšè¿è¥çš„ç›¸å…³çš„æ–¹å‘ã€‚æ¯”å¦‚è¯´ç‹è€…è£è€€ï¼Œä½ å¦‚æœç©è¿‡å°±åº”è¯¥çŸ¥é“å®ƒé‡Œé¢ç»å¸¸ä¼šçœ‹åˆ°ä¸€äº›æ´»åŠ¨ã€‚æ¯”å¦‚è¯´é‚£ä¸ªçš®è‚¤è¿”åœºã€æŠ•ç¥¨ã€é¢†å¥–ï¼Œå°±ä½ å‚ä¸æŠ•ç¥¨æˆ–è€…æ˜¯æŠ•ç¨¿ä¸€äº›æ¯”èµ›èµ›äº‹ç­‰ç­‰ï¼Œè¿™ç§æ´»åŠ¨éƒ½ä¼šæœ‰ä¸€äº›å¥–åŠ±ã€‚è¿™ç§æ´»åŠ¨ç±»çš„å¤§å¤šæ•°æ˜¯æˆ‘ä»¬åšçš„ã€‚ç‹è€…çš„è¿è¥å¼€å‘å°±åœ¨æˆ‘ä»¬å›¢é˜Ÿï¼Œå¯¹ï¼Œè¿è¥å¼€å‘å°±åœ¨æˆ‘ä»¬å›¢é˜Ÿã€‚æˆ‘ä»¬è¿™è´Ÿè´£æ˜¯å‡†ç¡®çš„è¯´æ˜¯å¤©ç¾çš„æ‰€æœ‰çš„æ¸¸æˆè¿è¥å¼€å‘éƒ½åœ¨æˆ‘ä»¬è¿™ã€‚</p>
<p>é¡¹ç›®çš„è¯æ¯”è¾ƒæ‚ï¼Œé™¤äº†é™¤äº†æ ¸å¿ƒç©æ³•ä»¥å¤–ï¼Œå®ƒçš„é‚£äº›å·¥å…·ç³»ç»Ÿã€‚æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰å¯èƒ½ä¼šåšä¸€äº›è¿è¥æ´»åŠ¨ï¼Œä»¥è¿è¥æ´»åŠ¨ä¸ºä¸»ï¼Œå¤§å¤´æ˜¯è¿™ä¸ªã€‚è¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯åƒæ¯”å¦‚è¯´ç­–åˆ’ç”¨çš„ä¸€äº›å·¥å…·ï¼Œç³»ç»Ÿéƒ½æœ‰å¯èƒ½æ˜¯æˆ‘ä»¬æ¥åšã€‚</p>
<p>é¡¹ç›®æœ€å¤šçš„æ˜¯è¿è¥æ´»åŠ¨ç±»çš„ã€‚è¿è¥æ´»åŠ¨ç±»ç‹è€…é‡Œé¢ä½ èƒ½çœ‹åˆ°å¾ˆå¤šï¼Œä»–é‡Œé¢ç°åœ¨æ˜¯ç”¨è¿™ç§å«æ¸¸æˆå†…çš„ä¸€ç§ä»¿åŸç”Ÿçš„å¼€å‘æŠ€æœ¯ã€‚ç‹è€…æœ¬èº«å®ƒæ˜¯unityå¼€å‘å®¢æˆ·ç«¯ï¼Œç”¨Uå¼•æ“çš„ã€‚ä½†æˆ‘ä»¬å¯ä»¥å¾€é‡Œé¢å»å¾€æ¸¸æˆé‡Œé¢å»åµŒH5çš„ã€‚å°±è¿™ç§webçš„æ´»åŠ¨é¡µé¢ä¹Ÿå¯ä»¥ç”¨é‚£ä¸ªåŸç”Ÿçš„ä»¿åŸç”Ÿçš„ä¸€ç§ã€‚æˆ‘ä»¬è‡ªå·±æˆ‘ä»¬éƒ¨é—¨è‡ªå·±åšäº†ä¸€ç§å¼•æ“å»åšé‚£ä¸ªæ”¯æŒçƒ­æ›´çš„è¿™ç§åŸç”Ÿæ´»åŠ¨ï¼Œå¯¹æ¯”ç‹è€…é¡¹ç›®ç»„è‡ªå·±åšçš„è¯ï¼Œè¿™ç§å°±æ›´æ–°ï¼Œè¿˜æœ‰å¼€å‘æ•ˆç‡æ–¹é¢ä¼šæ›´é«˜ã€‚ç„¶åä»–è¯•éªŒæˆæœ¬ä¼šç›¸å¯¹ä½ä¸€äº›ï¼Œå› ä¸ºä»–ä»¬è‡ªå·±åšçš„è¯ï¼Œç”¨unityå»åšå‘ç‰ˆæœ¬è¿™ç§ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚è¿™æ˜¯æˆ‘ä»¬å«æˆ‘ä»¬è‡ªå·±å«ä»–é‚£ä¸ªæ½˜å¤šæ‹‰çš„æ¡†æ¶ï¼Œè¿™ä¸ªæ˜¯ç«¯å†…çš„åŸç”Ÿé¡¹ç›®ã€‚</p>
<p>ç„¶åè¿˜æœ‰ä¸€äº›æ˜¯å¤–éƒ¨å¼€å‘çš„é¡¹ç›®ï¼Œæœ‰ä¸€äº›æ˜¯å°ç¨‹åºçš„é¡¹ç›®ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ã€‚ä½†å°ç¨‹åºæˆ‘ä»¬å€’ä¸ç”¨è‡ªå·±åšçº¯é¡µé¢éƒ¨åˆ†ï¼Œä¸€èˆ¬çš„H5å’Œå°ç¨‹åºçš„é¡µé¢çš„åˆ‡å›¾å’Œé‡æ„ä¼šæœ‰ä¸“äººæ¥åšã€‚æˆ‘ä»¬ä¼šè´Ÿè´£å»åšåç«¯çš„åŠŸèƒ½ï¼Œä»¥åŠæŠŠè¿™ä¸ªé¡µé¢å’ŒåŠŸèƒ½æ•´åˆèµ·æ¥ã€‚å°±å†™ä¸€éƒ¨åˆ†JSï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ã€‚&quot;</p>
</blockquote>
<p>é¢è¯•å®˜è¯¦ç»†ä»‹ç»äº†å²—ä½èŒè´£ï¼šä¸»è¦è´Ÿè´£è…¾è®¯æ¸¸æˆï¼ˆç‰¹åˆ«æ˜¯å¤©ç¾å·¥ä½œå®¤ç¾¤ï¼‰çš„è¿è¥æ´»åŠ¨å¼€å‘ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>æ¸¸æˆå†…æ´»åŠ¨é¡µé¢å¼€å‘ï¼ˆH5ã€å°ç¨‹åºã€åŸç”Ÿï¼‰</li>
<li>è¿è¥å·¥å…·ç³»ç»Ÿå¼€å‘</li>
<li>åç«¯æœåŠ¡å’Œæ•°æ®å¤„ç†</li>
<li>æŠ€æœ¯æ ˆåå…¨æ ˆï¼Œéœ€è¦ä¸€å®šçš„å‰ç«¯èƒ½åŠ›</li>
<li>ä½¿ç”¨è‡ªç ”çš„æ½˜å¤šæ‹‰æ¡†æ¶æ”¯æŒçƒ­æ›´æ–°</li>
</ul>
<p>è¿™ä¸ªå²—ä½å¾ˆé€‚åˆå¸Œæœ›åœ¨æŠ€æœ¯å¹¿åº¦ä¸Šå‘å±•çš„åŒå­¦ï¼Œèƒ½æ¥è§¦åˆ°æ¸¸æˆè¡Œä¸šçš„ä¸šåŠ¡åœºæ™¯ï¼ŒæŠ€æœ¯æŒ‘æˆ˜ä¹Ÿæ¯”è¾ƒä¸°å¯Œã€‚ç‰¹åˆ«æ˜¯å¯¹äºäº¿çº§ç”¨æˆ·é‡çš„æ¸¸æˆæ´»åŠ¨ï¼Œåœ¨é«˜å¹¶å‘å’Œæ•°æ®å¤„ç†æ–¹é¢éƒ½æœ‰å¾ˆé«˜çš„æŠ€æœ¯è¦æ±‚ã€‚</p>
]]></content>
      <categories>
        <category>é¢è¯•ç»éªŒ</category>
      </categories>
      <tags>
        <tag>ä¸€é¢</tag>
        <tag>è…¾è®¯</tag>
        <tag>è¿è¥å¼€å‘</tag>
        <tag>IEG</tag>
      </tags>
  </entry>
  <entry>
    <title>è…¾è®¯IEG è¿è¥å¼€å‘å·¥ç¨‹å¸ˆ äºŒé¢</title>
    <url>/2025/06/21/%E9%9D%A2%E8%AF%95%E9%A2%98/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E5%8E%82/%E8%85%BE%E8%AE%AF/2025-03-26-%E8%85%BE%E8%AE%AFIEG-%E8%BF%90%E8%90%A5%E5%BC%80%E5%8F%91-%E4%BA%8C%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="é¢è¯•åŸºæœ¬ä¿¡æ¯">é¢è¯•åŸºæœ¬ä¿¡æ¯</h2>
<ul>
<li><strong>å…¬å¸</strong>: è…¾è®¯IEGï¼ˆäº’åŠ¨å¨±ä¹äº‹ä¸šç¾¤ï¼‰</li>
<li><strong>èŒä½</strong>: è¿è¥å¼€å‘å·¥ç¨‹å¸ˆï¼ˆæ—¥å¸¸å®ä¹ ï¼‰</li>
<li><strong>é¢è¯•è½®æ¬¡</strong>: äºŒé¢ï¼ˆæŠ€æœ¯é¢ï¼‰</li>
<li><strong>é¢è¯•å½¢å¼</strong>: çº¿ä¸Šè§†é¢‘é¢è¯•ï¼ˆè…¾è®¯ä¼šè®®ï¼‰</li>
<li><strong>é¢è¯•æ—¶é•¿</strong>: çº¦50åˆ†é’Ÿ</li>
<li><strong>é¢è¯•å®˜</strong>: æŠ€æœ¯leaderï¼Œæ¯”è¾ƒå‹å–„ä¸“ä¸š</li>
</ul>
<h2 id="é¢è¯•é—®é¢˜ä¸å›ç­”">é¢è¯•é—®é¢˜ä¸å›ç­”</h2>
<h3 id="é—®é¢˜1ï¼šæ°´æ¯é‡æ°´ï¼ˆé€»è¾‘æ€ç»´é¢˜ï¼‰">é—®é¢˜1ï¼šæ°´æ¯é‡æ°´ï¼ˆé€»è¾‘æ€ç»´é¢˜ï¼‰</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ æ‰‹ä¸Šæœ‰ä¸¤ä¸ªæ°´æ¯ï¼Œéƒ½æ˜¯æ²¡æœ‰åˆ»åº¦çš„ï¼Œä¸€ä¸ªä¸‰å‡ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯äº”å‡ã€‚ä½ è¿˜æœ‰å¤§é‡çš„æ°´ï¼Œæ€ä¹ˆç”¨æœ€å¿«çš„æ–¹å¼é‡å‡ºå››å‡çš„æ°´ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œé¦–å…ˆå…ˆå¾€è¿™ä¸ªä¸‰æ¯«å‡çš„æ°´é‡Œé¢è£…æ»¡ï¼Œä¸‰æ¯«å‡çš„æ¯å­é‡Œé¢è£…æ»¡æ°´ï¼Œç„¶åå†å€’åˆ°è¿™ä¸ªäº”æ¯«å‡çš„æ°´é‡Œé¢ï¼Œç„¶åå†æŠŠè¿™ä¸ªå°±æ˜¯ç°åœ¨5æ¯«å‡çš„æ¯å­é‡Œé¢æœ‰ä¸‰æ¯«å‡çš„æ°´äº†ã€‚ç„¶åå†å†æŠŠè¿™ä¸ªä¸‰æ¯«å‡çš„è£…æ»¡ã€‚è£…æ»¡ä»¥åå†æŠŠè¿™ä¸ª3æ¯«å‡çš„æ¯å­é‡Œé¢æ°´å€’æ»¡ï¼Œå€’åˆ°5æ¯«å‡çš„æ¯å­é‡Œé¢å€’æ»¡ã€‚ç„¶å5æ¯«å‡çš„æ¯å­æ»¡äº†ï¼Œé‚£3æ¯«å‡çš„æ¯å­é‡Œé¢å°±åªå‰©ä¸€æ¯«å‡çš„æ°´äº†ã€‚ç„¶åå†æŠŠ5æ¯«å‡çš„æ¯å­é‡Œé¢æ°´å…¨éƒ½å€’æ‰ï¼Œç„¶åå†æŠŠè¿™ä¸ªä¸‰æ¯«å‡æ¯å­é‡Œé¢çš„é‚£ä¸ªä¸€æ¯«å‡çš„æ°´ç»™å€’åˆ°5æ¯«å‡çš„æ¯å­é‡Œé¢ï¼Œæœ€åå†æŠŠè¿™ä¸ª3æ¯«å‡çš„æ¯å­è£…æ»¡ï¼Œç„¶åè£…æ»¡ç„¶åå†å€’åˆ°5æ¯«å‡çš„æ¯å­é‡Œé¢ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°äº†ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé—®é¢˜å›ç­”å¾—è¿˜ä¸é”™ã€‚å…·ä½“æ­¥éª¤æ˜¯ï¼š</p>
<ol>
<li>å…ˆæŠŠ3å‡æ¯å­è£…æ»¡ï¼Œå€’å…¥5å‡æ¯å­ï¼ˆ5å‡æ¯å­é‡Œæœ‰3å‡æ°´ï¼‰</li>
<li>å†æŠŠ3å‡æ¯å­è£…æ»¡ï¼Œç»§ç»­å€’å…¥5å‡æ¯å­ç›´åˆ°æ»¡ï¼ˆ3å‡æ¯å­é‡Œå‰©1å‡æ°´ï¼‰</li>
<li>æŠŠ5å‡æ¯å­çš„æ°´å…¨éƒ¨å€’æ‰ï¼ŒæŠŠ3å‡æ¯å­é‡Œçš„1å‡æ°´å€’å…¥5å‡æ¯å­</li>
<li>å†æŠŠ3å‡æ¯å­è£…æ»¡ï¼Œå€’å…¥5å‡æ¯å­ï¼ˆ1+3=4å‡ï¼‰</li>
</ol>
<p>è¿™æ ·å°±å¾—åˆ°äº†4å‡æ°´ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>æ€è·¯æ­£ç¡®ï¼Œæ­¥éª¤ä¹Ÿå¯¹</li>
<li>è¡¨è¾¾ç¨å¾®æœ‰äº›å•°å—¦ï¼Œå¯ä»¥æ›´ç®€æ´äº›</li>
</ul>
<h3 id="é—®é¢˜2ï¼šåšå¼ˆè®ºé—®é¢˜ï¼ˆè‹¹æœæŠ¢å¤ºæ¸¸æˆï¼‰">é—®é¢˜2ï¼šåšå¼ˆè®ºé—®é¢˜ï¼ˆè‹¹æœæŠ¢å¤ºæ¸¸æˆï¼‰</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œåœ¨ä¸€ä¸ªè¯¾æ¡Œä¸Šæœ‰100ä¸ªè‹¹æœã€‚æˆ‘å’Œä½ è½®æµæ‹¿ï¼Œæ¯äººæ¯æ¬¡æ‹¿çš„è‹¹æœæ•°é‡æ˜¯1åˆ°5ã€‚ä½ æ¥è®¾è®¡ä¸€ä¸ªç­–ç•¥ï¼Œä¿è¯ç¬¬100ä¸ªè‹¹æœï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ªè‹¹æœä¸€å®šæ˜¯ä½ èƒ½æ‹¿åˆ°çš„ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘è¦ç¡®ä¿æˆ‘æ‹¿å®Œä»¥åï¼Œæœ€åå‰©ä¸‹çš„è‹¹æœæ•°æ¨¡å…­æ˜¯ç­‰äºä¸€çš„â€¦æ¯”å¦‚è¯´æˆ‘æœ‰Nä¸ªè‹¹æœï¼Œç„¶åæˆ‘ç¬¬ä¸€æ¬¡æ‹¿å››ä¸ªï¼Œç„¶åä¹‹åå¯¹æ–¹æ— è®ºæ‹¿å¤šå°‘ä¸ªï¼Œæ— è®ºæ‹¿å¤šå°‘ä¸ªï¼Œæ¯”å¦‚è¯´å¯¹æ–¹æ‹¿ä¸ƒä¸ªï¼Œé‚£æˆ‘éƒ½ä¸€å®šæ‹¿6å‡7ä¸ªã€‚è¿™æ ·å°±ä¸€å®šèƒ½ä¿è¯æˆ‘ä¼šæœ€åè·èƒœã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªæ˜¯ç»å…¸çš„åšå¼ˆè®ºé—®é¢˜ã€‚æ­£ç¡®çš„ç­–ç•¥æ˜¯ï¼š</p>
<p>é¦–å…ˆåˆ†æè·èƒœæ¡ä»¶ï¼šè¦æƒ³æ‹¿åˆ°æœ€åä¸€ä¸ªè‹¹æœï¼Œå°±è¦ä¿è¯è½®åˆ°å¯¹æ–¹æ‹¿çš„æ—¶å€™ï¼Œå‰©ä½™è‹¹æœæ•°æ˜¯6çš„å€æ•°ã€‚</p>
<p>å› ä¸ºæ¯æ¬¡æœ€å¤šæ‹¿5ä¸ªï¼Œæœ€å°‘æ‹¿1ä¸ªï¼Œæ‰€ä»¥å¦‚æœå‰©6ä¸ªè‹¹æœè½®åˆ°å¯¹æ–¹ï¼Œæ— è®ºä»–æ‹¿å‡ ä¸ªï¼ˆ1-5ä¸ªï¼‰ï¼Œæˆ‘éƒ½èƒ½é€šè¿‡æ‹¿å¯¹åº”æ•°é‡çš„è‹¹æœï¼ˆ5-1ä¸ªï¼‰æ¥ä¿è¯æ‹¿åˆ°æœ€åä¸€ä¸ªã€‚</p>
<p>å…·ä½“ç­–ç•¥ï¼š</p>
<ol>
<li>100 Ã· 6 = 16â€¦4ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡æˆ‘æ‹¿4ä¸ªï¼Œå‰©96ä¸ª</li>
<li>ä¹‹åæ— è®ºå¯¹æ–¹æ‹¿å‡ ä¸ªï¼ˆ1-5ä¸ªï¼‰ï¼Œæˆ‘éƒ½æ‹¿å¯¹åº”çš„æ•°è®©ä¸¤äººè¿™è½®æ€»å…±æ‹¿6ä¸ª</li>
<li>è¿™æ ·æ¯è½®ç»“æŸåï¼Œå‰©ä½™è‹¹æœæ•°éƒ½æ˜¯6çš„å€æ•°</li>
<li>æœ€ç»ˆè½®åˆ°å¯¹æ–¹æ—¶å‰©6ä¸ªï¼Œæˆ‘å¿…èƒœ</li>
</ol>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>æ€è·¯æ–¹å‘å¯¹äº†ï¼Œä½†ä¸€å¼€å§‹è¯´æˆäº†&quot;æ¨¡5ç­‰äº1&quot;</li>
<li>ç»è¿‡é¢è¯•å®˜æç¤ºé€æ­¥æ‰¾åˆ°äº†æ­£ç¡®ç­”æ¡ˆ</li>
<li>è¿™ç±»é¢˜ç›®éœ€è¦ä»ç»ˆå±€å¾€å‰æ¨ç†</li>
</ul>
<h3 id="é—®é¢˜3ï¼šç¼–ç¨‹é¢˜ï¼ˆæœ€é•¿è¿ç»­é€’å¢å­åºåˆ—ï¼‰">é—®é¢˜3ï¼šç¼–ç¨‹é¢˜ï¼ˆæœ€é•¿è¿ç»­é€’å¢å­åºåˆ—ï¼‰</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå†™ä¸ªç®—æ³•æ±‚å‡ºå­—ç¬¦ä¸²çš„æœ€é•¿è¿ç»­é€’å¢å­åºåˆ—ï¼Œè¦æŠŠè¿™ä¸ªå­åºåˆ—è¾“å‡ºå‡ºæ¥ï¼Œå­—ç¬¦ä¸²æ˜¯Aåˆ°Zçš„å°å†™å­—æ¯ã€‚â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘å°è±¡ä¸­æ˜¯ç”¨DPï¼Œç„¶åå¦‚æœè¯´å‘ç°ä»–è¿™ä¸€ä¸ªå³è¾¹é‚£ä¸ªå…ƒç´ ï¼Œå°±æ˜¯å°äºå‰é¢çš„ä¸€ä¸ªå…ƒç´ äº†ï¼Œé‚£å°±æ˜¯éœ€è¦å›æº¯ä¸€ä¸‹ï¼Œç„¶åç»§ç»­é‡æ–°è¿›è¡Œé‚£ä¸ªDPã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å…¶å®è¿™é¢˜ç”¨DPå¯èƒ½æŠŠé—®é¢˜å¤æ‚åŒ–äº†ï¼Œæœ‰æ›´ç®€å•çš„æ€è·¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestIncreasingSubstring</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    maxLength := <span class="number">1</span></span><br><span class="line">    maxStart := <span class="number">0</span></span><br><span class="line">    currentLength := <span class="number">1</span></span><br><span class="line">    currentStart := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> s[i] &gt; s[i<span class="number">-1</span>] &#123; <span class="comment">// è¿ç»­é€’å¢</span></span><br><span class="line">            currentLength++</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// é‡æ–°å¼€å§‹</span></span><br><span class="line">            <span class="keyword">if</span> currentLength &gt; maxLength &#123;</span><br><span class="line">                maxLength = currentLength</span><br><span class="line">                maxStart = currentStart</span><br><span class="line">            &#125;</span><br><span class="line">            currentLength = <span class="number">1</span></span><br><span class="line">            currentStart = i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æœ€åä¸€æ®µ</span></span><br><span class="line">    <span class="keyword">if</span> currentLength &gt; maxLength &#123;</span><br><span class="line">        maxLength = currentLength</span><br><span class="line">        maxStart = currentStart</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> s[maxStart : maxStart+maxLength]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line">    test := <span class="string">&quot;abcxyzdeghi&quot;</span></span><br><span class="line">    result := longestIncreasingSubstring(test)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;è¾“å…¥: %s\n&quot;</span>, test)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;æœ€é•¿è¿ç»­é€’å¢å­åºåˆ—: %s\n&quot;</span>, result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ€è·¯å°±æ˜¯ï¼šè®¾ç½®ä¸€ä¸ªæœ€å¤§é•¿åº¦è®°å½•å™¨ï¼Œéå†å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦æ¯”å‰ä¸€ä¸ªå¤§å°±ç»§ç»­ï¼Œå¦åˆ™é‡æ–°å¼€å§‹è®¡æ•°ï¼Œå¹¶æ›´æ–°æœ€å¤§å€¼ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>æ–¹å‘æƒ³å¤æ‚äº†ï¼Œå…¶å®æ˜¯æ¯”è¾ƒåŸºç¡€çš„ç®—æ³•é¢˜</li>
<li>ç°åœºæ²¡æœ‰å†™å‡ºä»£ç ï¼Œè¯´æ˜åŸºç¡€ç®—æ³•éœ€è¦åŠ å¼º</li>
<li>åº”è¯¥å¤šç»ƒä¹ è¿™ç±»å­—ç¬¦ä¸²å¤„ç†é¢˜ç›®</li>
</ul>
<h3 id="é—®é¢˜4ï¼šé¡¹ç›®ç»éªŒï¼ˆæŠ–éŸ³å•†åŸç³»ç»Ÿï¼‰">é—®é¢˜4ï¼šé¡¹ç›®ç»éªŒï¼ˆæŠ–éŸ³å•†åŸç³»ç»Ÿï¼‰</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæ‚¨è¿™è¾¹æœ‰åšè¿‡æ¯”è¾ƒæœ‰ä»·å€¼çš„ä¸€ä¸ªé¡¹ç›®ï¼Œèƒ½å¤Ÿä¸¤åˆ†é’Ÿç»™æˆ‘ä»‹ç»ä¸€ä¸‹èƒŒæ™¯ï¼Œè¿˜æœ‰ä½ åœ¨é‡Œé¢åšçš„ä¸€äº›äº‹æƒ…ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæ¯”è¾ƒæœ‰æŠ€æœ¯å«é‡çš„åº”è¯¥æ˜¯è¿™ä¸ªæŠ–éŸ³å•†åŸã€‚è¿™ä¸ªé¡¹ç›®æœ€å¤§çš„æŒ‘æˆ˜æ˜¯Casbinæƒé™ç®¡ç†æ¡†æ¶çš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚æˆ‘å®šä¹‰äº†ä¸¤ä¸ªCasbinå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰çœŸçš„å»åŒæ­¥ä»–ä»¬çš„ç¼“å­˜æ•°æ®ã€‚æœ€åè§£å†³çš„æ–¹æ³•å°±æ˜¯æŠŠæ•´ä¸ªé¡¹ç›®ä¸­Casbinåªå…è®¸åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>é¡¹ç›®ä»‹ç»å¯ä»¥æ›´ç»“æ„åŒ–ä¸€äº›ï¼š</p>
<ol>
<li>
<p><strong>é¡¹ç›®èƒŒæ™¯</strong>ï¼šè¿™æ˜¯æŠ–éŸ³é’è®­è¥çš„å›¢é˜Ÿé¡¹ç›®ï¼ŒåŸºäºå¾®æœåŠ¡æ¶æ„å¼€å‘çš„ç”µå•†ç³»ç»Ÿï¼Œæˆ‘ä¸»è¦è´Ÿè´£æ•´ä½“æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹ã€‚</p>
</li>
<li>
<p><strong>æŠ€æœ¯æ¶æ„</strong>ï¼šä½¿ç”¨Goè¯­è¨€+å¾®æœåŠ¡æ¶æ„ï¼Œé›†æˆäº†æœåŠ¡å‘ç°ã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯é˜Ÿåˆ—ã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰ç»„ä»¶ï¼Œè¿˜å®ç°äº†CICDè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</p>
</li>
<li>
<p><strong>æŠ€æœ¯éš¾ç‚¹</strong>ï¼šä¸»è¦æ˜¯Casbinæƒé™ç®¡ç†çš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚Casbinåœ¨å†…å­˜ä¸­ç»´æŠ¤ç­–ç•¥ç¼“å­˜ï¼Œå½“æˆ‘åˆ›å»ºå¤šä¸ªCasbinå®ä¾‹æ—¶ï¼Œå‡ºç°äº†ç¼“å­˜ä¸åŒæ­¥çš„é—®é¢˜ã€‚æœ€ç»ˆé€šè¿‡å•ä¾‹æ¨¡å¼ç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªCasbinå®ä¾‹ï¼Œè§£å†³äº†ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>å…¶ä»–äº®ç‚¹</strong>ï¼šè¿˜å®ç°äº†Redis+MySQLçš„åˆ†çº§å­˜å‚¨ã€Canal+MQçš„æ•°æ®åŒæ­¥ã€åŸºäºRedis Luaè„šæœ¬çš„åˆ†å¸ƒå¼é”ç­‰ã€‚</p>
</li>
</ol>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>é¡¹ç›®ç»éªŒè¿˜ç®—ä¸°å¯Œï¼Œä½†è¡¨è¾¾å¯ä»¥æ›´æœ‰æ¡ç†</li>
<li>å¯¹æŠ€æœ¯ç»†èŠ‚çš„ç†è§£è¿˜ä¸å¤Ÿæ·±å…¥</li>
</ul>
<h3 id="é—®é¢˜5ï¼šé«˜å¹¶å‘åœºæ™¯ï¼ˆåº“å­˜è¶…å–é—®é¢˜ï¼‰">é—®é¢˜5ï¼šé«˜å¹¶å‘åœºæ™¯ï¼ˆåº“å­˜è¶…å–é—®é¢˜ï¼‰</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è¯´åº“å­˜æ˜¯100ï¼Œä½†æ˜¯é«˜å¹¶å‘å¤§å®¶ä¸€èµ·è¿‡æ¥ä¹°ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°è¶…å–çš„æƒ…å†µã€‚è¿™ç§é—®é¢˜ä½ å½“æ—¶åœ¨è®¾è®¡çš„æ—¶å€™æ€ä¹ˆè§£å†³ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘ä»¬ä½¿ç”¨äº†Redisçš„Luaè„šæœ¬ï¼Œç„¶åå»ç»™åº“å­˜å»è¿›è¡ŒåŠ é”â€¦ä½¿ç”¨äº†Redisé‡Œé¢çš„SET NXå‘½ä»¤è¿›è¡ŒåŠ é”ï¼Œå› ä¸ºRedisæœ¬èº«æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ä¸€æ—¦å¯¹åº“å­˜è¿›è¡ŒåŠ é”ä»¥åï¼Œåˆ«çš„è¯·æ±‚å…¶å®æ˜¯ä¼šè¢«æ‹’ç»çš„ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¶…å–é—®é¢˜ç¡®å®æ˜¯é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç»å…¸é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆæœ‰å‡ ç§ï¼š</p>
<ol>
<li>
<p><strong>RedisåŸå­æ“ä½œ</strong>ï¼šä½¿ç”¨Redisçš„DECRå‘½ä»¤ï¼Œå› ä¸ºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¯ä»¥ä¿è¯åŸå­æ€§ã€‚å…ˆæ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³ï¼Œå†å‡åº“å­˜ã€‚</p>
</li>
<li>
<p><strong>Luaè„šæœ¬</strong>ï¼šæŠŠæ£€æŸ¥åº“å­˜å’Œå‡åº“å­˜çš„é€»è¾‘å†™åœ¨ä¸€ä¸ªLuaè„šæœ¬é‡Œï¼ŒRedisä¼šåŸå­æ€§åœ°æ‰§è¡Œæ•´ä¸ªè„šæœ¬ï¼š</p>
</li>
</ol>
<p>Luaè„šæœ¬ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;stock&#x27;</span>) &gt;= <span class="built_in">tonumber</span>(ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&#x27;decrby&#x27;</span>, <span class="string">&#x27;stock&#x27;</span>, ARGV[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Goè¯­è¨€è°ƒç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decreaseStock</span><span class="params">(rdb *redis.Client, quantity <span class="type">int</span>)</span></span> (<span class="type">int64</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    luaScript := <span class="string">`</span></span><br><span class="line"><span class="string">        if redis.call(&#x27;get&#x27;, KEYS[1]) &gt;= tonumber(ARGV[1]) then</span></span><br><span class="line"><span class="string">            return redis.call(&#x27;decrby&#x27;, KEYS[1], ARGV[1])</span></span><br><span class="line"><span class="string">        else</span></span><br><span class="line"><span class="string">            return -1</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    </span><br><span class="line">    ctx := context.Background()</span><br><span class="line">    result, err := rdb.Eval(ctx, luaScript, []<span class="type">string</span>&#123;<span class="string">&quot;stock&quot;</span>&#125;, quantity).Result()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result.(<span class="type">int64</span>), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">        Addr: <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°è¯•å‡å°‘åº“å­˜</span></span><br><span class="line">    remaining, err := decreaseStock(rdb, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;å‡åº“å­˜å¤±è´¥: %v\n&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> remaining == <span class="number">-1</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;å‡åº“å­˜æˆåŠŸï¼Œå‰©ä½™åº“å­˜: %d\n&quot;</span>, remaining)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>
<p><strong>æ•°æ®åº“å±‚é¢</strong>ï¼šä½¿ç”¨ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·ï¼‰æˆ–æ‚²è§‚é”ï¼ˆSELECT FOR UPDATEï¼‰ã€‚</p>
</li>
<li>
<p><strong>åˆ†å¸ƒå¼é”</strong>ï¼šä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”ï¼Œä½†æ€§èƒ½ä¼šæœ‰æŸå¤±ã€‚</p>
</li>
</ol>
<p>å…¶ä¸­Redis + Luaè„šæœ¬æ˜¯æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆï¼Œæ—¢ä¿è¯äº†åŸå­æ€§ï¼Œæ€§èƒ½ä¹Ÿä¸é”™ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>çŸ¥é“ç”¨Rediså’ŒLuaè„šæœ¬çš„æ€è·¯æ˜¯å¯¹çš„</li>
<li>ä½†å¯¹å…·ä½“å®ç°ç»†èŠ‚ä¸å¤Ÿæ¸…æ¥š</li>
<li>éœ€è¦æ·±å…¥ç†è§£RedisåŸå­æ“ä½œçš„åŸç†</li>
</ul>
<h3 id="é—®é¢˜6ï¼šç›‘æ§å‘Šè­¦ç³»ç»Ÿ">é—®é¢˜6ï¼šç›‘æ§å‘Šè­¦ç³»ç»Ÿ</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ ä»¬åšäº†ä¸€äº›ç›‘æ§å’Œå‘Šè­¦çš„åŠŸèƒ½ï¼Œç›‘æ§å“ªäº›æŒ‡æ ‡ï¼Ÿç›‘æ§æ—¥å¿—æ˜¯ç›‘æ§çš„ä»€ä¹ˆæŒ‡æ ‡ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘ä»¬æ˜¯ç›´æ¥æ¥å…¥äº†OpenTelemetryï¼Œç›‘æ§QPSæŒ‡æ ‡ï¼Œä½†QPSæˆ‘ä»¬æ²¡æœ‰åšå‘Šè­¦ã€‚è¿˜æœ‰ç›‘æ§æ—¥å¿—ï¼Œæ—¥å¿—ç›‘æ§åªæ˜¯ä¸ºäº†å»æ’æŸ¥é—®é¢˜â€¦æˆ‘ä»¬å‘Šè­¦ä¸»è¦æ˜¯é»‘åå•è¿™ä¸€å—ï¼Œä½¿ç”¨Redisè¿›è¡ŒQPSé™åˆ¶ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·ä¸€ç§’å†…è¯·æ±‚è¶…è¿‡åæ¬¡ï¼Œå°±ä¼šè°ƒç”¨é»‘åå•åŠŸèƒ½ç¦ç”¨è¿™ä¸ªç”¨æˆ·ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>ç›‘æ§å‘Šè­¦ç³»ç»Ÿé€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li>
<p><strong>åº”ç”¨å±‚ç›‘æ§</strong>ï¼š</p>
<ul>
<li>QPS/TPSï¼šæ¯ç§’è¯·æ±‚æ•°/äº‹åŠ¡æ•°</li>
<li>å“åº”æ—¶é—´ï¼šå¹³å‡å“åº”æ—¶é—´ã€P99å“åº”æ—¶é—´</li>
<li>é”™è¯¯ç‡ï¼š4xxã€5xxé”™è¯¯æ¯”ä¾‹</li>
<li>æ¥å£å¯ç”¨æ€§</li>
</ul>
</li>
<li>
<p><strong>ç³»ç»Ÿå±‚ç›‘æ§</strong>ï¼š</p>
<ul>
<li>CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡</li>
<li>ç£ç›˜IOã€ç½‘ç»œIO</li>
<li>æ•°æ®åº“è¿æ¥æ•°</li>
</ul>
</li>
<li>
<p><strong>ä¸šåŠ¡å±‚ç›‘æ§</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·è®¿é—®é‡ã€è½¬åŒ–ç‡</li>
<li>ä¸šåŠ¡æ“ä½œæˆåŠŸç‡</li>
<li>èµ„é‡‘å®‰å…¨ç›¸å…³æŒ‡æ ‡</li>
</ul>
</li>
<li>
<p><strong>æ—¥å¿—ç›‘æ§</strong>ï¼š</p>
<ul>
<li>é”™è¯¯æ—¥å¿—æ•°é‡å’Œé¢‘ç‡</li>
<li>å…³é”®ä¸šåŠ¡æ“ä½œæ—¥å¿—</li>
<li>å®‰å…¨ç›¸å…³æ—¥å¿—ï¼ˆç™»å½•å¤±è´¥ã€å¼‚å¸¸è®¿é—®ç­‰ï¼‰</li>
</ul>
</li>
</ol>
<p>å‘Šè­¦ç­–ç•¥åº”è¯¥åŸºäºé˜ˆå€¼è®¾ç½®ï¼Œæ¯”å¦‚é”™è¯¯ç‡è¶…è¿‡5%ã€å“åº”æ—¶é—´è¶…è¿‡1ç§’ç­‰ã€‚</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¯¹ç›‘æ§çš„ç†è§£æ¯”è¾ƒæµ…å±‚ï¼Œä¸»è¦åœç•™åœ¨å·¥å…·ä½¿ç”¨å±‚é¢</li>
<li>ç¼ºä¹å¯¹ç›‘æ§ä½“ç³»çš„ç³»ç»Ÿæ€§ç†è§£</li>
<li>åº”è¯¥å­¦ä¹ æ›´å¤šç›‘æ§å‘Šè­¦çš„æœ€ä½³å®è·µ</li>
</ul>
<h2 id="é¢è¯•æ•´ä½“æ„Ÿå—">é¢è¯•æ•´ä½“æ„Ÿå—</h2>
<ul>
<li><strong>éš¾åº¦è¯„ä»·</strong>: é€‚ä¸­ï¼Œä¸»è¦è€ƒå¯ŸåŸºç¡€èƒ½åŠ›å’Œé¡¹ç›®ç»éªŒ</li>
<li><strong>é¢è¯•å®˜é£æ ¼</strong>: æ¯”è¾ƒå‹å–„ï¼Œä¼šç»™æç¤ºå¼•å¯¼æ€è€ƒ</li>
<li><strong>é¢˜ç›®ç±»å‹</strong>: é€»è¾‘æ€ç»´+ç¼–ç¨‹+é¡¹ç›®ç»éªŒï¼Œæ¯”è¾ƒå…¨é¢</li>
<li><strong>å‡†å¤‡å»ºè®®</strong>: éœ€è¦åŠ å¼ºåŸºç¡€ç®—æ³•å’Œæ·±å…¥ç†è§£é¡¹ç›®æŠ€æœ¯ç»†èŠ‚</li>
</ul>
<h2 id="é¢è¯•ç»“æœ">é¢è¯•ç»“æœ</h2>
<ul>
<li><strong>å½“åœºåé¦ˆ</strong>: é¢è¯•å®˜è¡¨ç¤ºæŠ€æœ¯é¡¹ç›®è¿˜æ˜¯å¾ˆæ‰å®çš„</li>
<li><strong>åç»­æµç¨‹</strong>: è¡¨ç¤ºè¿˜åœ¨æ‹›è˜ä¸­ï¼Œéœ€è¦ç­‰å¯¹æ¯”ç»“æœ</li>
<li><strong>ä¸ªäººæ„Ÿå—</strong>: æ•´ä½“å‘æŒ¥ä¸€èˆ¬ï¼Œç®—æ³•é¢˜æ²¡ç­”å‡ºæ¥æ¯”è¾ƒé—æ†¾</li>
</ul>
<h2 id="ç»éªŒæ€»ç»“">ç»éªŒæ€»ç»“</h2>
<h3 id="åšå¾—å¥½çš„åœ°æ–¹">åšå¾—å¥½çš„åœ°æ–¹</h3>
<ul>
<li>é¡¹ç›®ç»éªŒæ¯”è¾ƒä¸°å¯Œï¼ŒæŠ€æœ¯æ ˆæ¶‰åŠé¢å¹¿</li>
<li>é€»è¾‘æ€ç»´é¢˜æ€è·¯æ¸…æ™°ï¼Œèƒ½åœ¨æç¤ºä¸‹æ‰¾åˆ°ç­”æ¡ˆ</li>
<li>å¯¹å¾®æœåŠ¡ã€åˆ†å¸ƒå¼æœ‰ä¸€å®šç†è§£</li>
</ul>
<h3 id="éœ€è¦æ”¹è¿›çš„åœ°æ–¹">éœ€è¦æ”¹è¿›çš„åœ°æ–¹</h3>
<ul>
<li>åŸºç¡€ç®—æ³•èƒ½åŠ›éœ€è¦åŠ å¼ºï¼Œç¼–ç¨‹é¢˜å®Œå…¨æ²¡å†™å‡ºæ¥</li>
<li>å¯¹é¡¹ç›®ä¸­æŠ€æœ¯ç»†èŠ‚çš„ç†è§£ä¸å¤Ÿæ·±å…¥</li>
<li>è¡¨è¾¾å¯ä»¥æ›´æœ‰æ¡ç†ï¼Œå›ç­”æ›´ç®€æ´</li>
</ul>
<h3 id="å‡†å¤‡å»ºè®®">å‡†å¤‡å»ºè®®</h3>
<ol>
<li><strong>ç®—æ³•åˆ·é¢˜</strong>ï¼šLeetCodeä¸­ç­‰éš¾åº¦é¢˜ç›®è¦ç†Ÿç»ƒæŒæ¡</li>
<li><strong>é¡¹ç›®æ·±æŒ–</strong>ï¼šå¯¹ç®€å†ä¸­çš„é¡¹ç›®è¦èƒ½æ·±å…¥åˆ°æºç å±‚é¢</li>
<li><strong>åŸºç¡€å·©å›º</strong>ï¼šRedisã€MySQLã€å¾®æœåŠ¡ç­‰æ ¸å¿ƒæŠ€æœ¯è¦æ·±å…¥ç†è§£</li>
<li><strong>ç³»ç»Ÿè®¾è®¡</strong>ï¼šå¤šäº†è§£é«˜å¹¶å‘ã€åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç»å…¸é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</li>
</ol>
<h3 id="çŸ¥è¯†ç‚¹å¤ä¹ ">çŸ¥è¯†ç‚¹å¤ä¹ </h3>
<ul>
<li>æ°´æ¯é‡æ°´ç­‰ç»å…¸é€»è¾‘é¢˜</li>
<li>åšå¼ˆè®ºåŸºç¡€é—®é¢˜</li>
<li>å­—ç¬¦ä¸²å¤„ç†ç®—æ³•ï¼ˆæ»‘åŠ¨çª—å£ã€åŒæŒ‡é’ˆï¼‰</li>
<li>RedisåŸå­æ“ä½œå’ŒLuaè„šæœ¬</li>
<li>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</li>
<li>ç›‘æ§å‘Šè­¦ç³»ç»Ÿè®¾è®¡</li>
<li>é«˜å¹¶å‘åœºæ™¯ä¸‹çš„å¸¸è§é—®é¢˜ï¼ˆè¶…å–ã€ç¼“å­˜å‡»ç©¿ç­‰ï¼‰</li>
</ul>
]]></content>
      <categories>
        <category>é¢è¯•ç»éªŒ</category>
      </categories>
      <tags>
        <tag>è…¾è®¯</tag>
        <tag>è¿è¥å¼€å‘</tag>
        <tag>äºŒé¢</tag>
        <tag>å®ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>è…¾è®¯äº‘CSIG åç«¯å¼€å‘å®ä¹  ä¸€é¢</title>
    <url>/2025/06/21/%E9%9D%A2%E8%AF%95%E9%A2%98/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E5%8E%82/%E8%85%BE%E8%AE%AF/2025-06-11-%E8%85%BE%E8%AE%AF%E4%BA%91-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%AE%9E%E4%B9%A0-%E4%B8%80%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="é¢è¯•åŸºæœ¬ä¿¡æ¯">é¢è¯•åŸºæœ¬ä¿¡æ¯</h2>
<ul>
<li><strong>å…¬å¸</strong>: è…¾è®¯äº‘CSIGï¼ˆæœºå™¨å­¦ä¹ å¹³å°éƒ¨é—¨ï¼‰</li>
<li><strong>èŒä½</strong>: åç«¯å¼€å‘å®ä¹ ç”Ÿ</li>
<li><strong>é¢è¯•è½®æ¬¡</strong>: ä¸€é¢ï¼ˆæŠ€æœ¯é¢ï¼‰</li>
<li><strong>é¢è¯•å½¢å¼</strong>: è…¾è®¯ä¼šè®®é¢è¯•ï¼ˆä¸éœ€è¦å¼€è§†é¢‘ï¼‰</li>
<li><strong>é¢è¯•æ—¶é•¿</strong>: çº¦20åˆ†é’Ÿ</li>
<li><strong>é¢è¯•å®˜</strong>: æŠ€æœ¯äººå‘˜ï¼Œè´Ÿè´£AI/å¤§æ¨¡å‹è®­ç»ƒå¹³å°ç›¸å…³å¼€å‘</li>
<li><strong>é¢è¯•æ—¶é—´</strong>: 2025å¹´06æœˆ11æ—¥ ä¸‹åˆ07ç‚¹58åˆ†</li>
</ul>
<h2 id="é¢è¯•é—®é¢˜ä¸å›ç­”">é¢è¯•é—®é¢˜ä¸å›ç­”</h2>
<h3 id="é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»">é—®é¢˜1ï¼šè‡ªæˆ‘ä»‹ç»</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œè¦ä¸ä½ å…ˆç»™æˆ‘å…ˆä»‹ç»ä¸€ä¸‹ä½ è¿™è¾¹çš„é¡¹ç›®ç»ç†â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œé¢è¯•å®˜ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹å®‡å“²ï¼Œç„¶åæ˜¯åä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹ç¡•å£«ï¼Œç ”ç©¶æ–¹å‘æ˜¯åŠ å¯†ä¿¡æ¯æ£€ç´¢ã€‚ç„¶åæœ¬ç§‘ä¸‰å¹´ä¸“ä¸šç¬¬ä¸€ï¼Œè·å¾—è¿‡å›½å®¶å¥–å­¦é‡‘å’Œè“æ¡¥å›½èµ›äºŒç­‰å¥–ã€‚ç®€å†ä¸Šçš„é¡¹ç›®ä¸»è¦æ˜¯é€šè¿‡goç¼–å†™çš„åˆ†å¸ƒå¼åº”ç”¨ã€‚ç¬¬ä¸€ä¸ªé¡¹ç›®çš„è¯æ˜¯ç‹¬ç«‹å®ç°çš„åˆ†å¸ƒå¼ç¼“å­˜é¡¹ç›®ï¼Œå®ƒçš„å•ç‚¹æ€§èƒ½èƒ½è¶…è¿‡5000QPSï¼Œç„¶åé‡‡ç”¨äº†ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°äº†æ•°æ®åˆ‡ç‰‡ã€‚ç„¶åé€šè¿‡ETCDåšæœåŠ¡å‘ç°ï¼Œç”¨gRPCå»åšé€šä¿¡ï¼Œå¹¶å®ç°äº†é˜²ç¼“å­˜å‡»ç©¿çš„single flyæœºåˆ¶ã€‚ç¬¬äºŒä¸ªé¡¹ç›®çš„è¯æ˜¯å¾®æœåŠ¡æ¶æ„çš„æŠ–éŸ³å•†åŸç³»ç»Ÿï¼Œç„¶åè´Ÿè´£æ•´ä½“æ¶æ„è®¾è®¡ä»¥åŠ70%ä»¥ä¸Šçš„ä»£ç å¼€å‘ä»»åŠ¡ã€‚ä½¿ç”¨github actionè‡ªåŠ¨éƒ¨ç½²ä¸Šäº‘ã€‚é›†æˆopen telemetryå»å®ç°äº†å¯è§‚æµ‹æ€§ï¼Œç„¶åé€šè¿‡åˆ†å¸ƒå¼é”å»è§£å†³äº†è¶…å–é—®é¢˜ã€‚ç„¶åç”¨canalåŠ æ¶ˆæ¯é˜Ÿåˆ—å®ç°äº†mysqlã€redisã€elasticsearchè¿™ä¸‰ä¸ªæ•°æ®åº“çš„åŒæ­¥ã€‚ç¬¬ä¸‰ä¸ªé¡¹ç›®çš„è¯æ˜¯AIç½‘å…³é¡¹ç›®ã€‚ç„¶åæ€è·¯ä¸Šå®ç°æœ‰ç‚¹åƒç°åœ¨æ¯”è¾ƒç«çš„MCPã€‚ç„¶åå®ƒèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·è¾“å…¥æç¤ºè¯å»è§„åˆ’ä»»åŠ¡ï¼Œç„¶åé€šè¿‡RPCå»è°ƒç”¨å¯¹åº”çš„å¾®æœåŠ¡çš„å¯¹åº”æ¥å£ã€‚ç„¶åæˆ‘è®¾è®¡äº†å¤šä»£ç†åˆ†å±‚çš„æ–¹å¼å»è°ƒåº¦ï¼Œå‡å°‘äº†ä¸Šä¸‹æ–‡çª—å£å¸¦æ¥çš„é—å¿˜é—®é¢˜ã€‚ç„¶åæé«˜äº†ä»»åŠ¡çš„å‡†ç¡®åº¦ï¼Œå¹¶é€šè¿‡æ³›åŒ–è°ƒç”¨æ¥å®ç°AIå±‚ä¸å®é™…å‡½æ•°å±‚çš„è§£è€¦ã€‚ç„¶åæœ€è¿‘çš„è¯ä¹Ÿä¸ºå¼€æºé¡¹ç›®mineruï¼ˆä¸€ä¸ª30k starçš„å¼€æºé¡¹ç›®ï¼‰è´¡çŒ®äº†è‡ªå·±ç¼–å†™çš„MCPçš„ä»£ç ã€‚å¹³å¸¸çš„è¯æˆ‘å¯¹å„ç§AIå·¥å…·ç†Ÿç»ƒä½¿ç”¨ï¼Œæ¯”å¦‚cursorä¹‹ç±»çš„ã€‚ç„¶åå¯¹äºç°ä»£å‰æ²¿çš„AIæŠ€æœ¯å’Œç†å¿µä¹Ÿæœ‰æ‰€äº†è§£ï¼Œä¹Ÿç†Ÿç»ƒä½¿ç”¨å„ç§AIå»ç»„åˆå‡ºä¸€å¥—å¼€å‘æµç¨‹æ¥å¿«é€Ÿå¼€å‘ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è‡ªæˆ‘ä»‹ç»éƒ¨åˆ†å›ç­”å¾ˆå®Œæ•´ï¼Œæ¶µç›–äº†æ•™è‚²èƒŒæ™¯ã€é¡¹ç›®ç»éªŒå’ŒæŠ€æœ¯ç‰¹é•¿ã€‚å»ºè®®å¯ä»¥æ›´åŠ ç®€æ´ä¸€äº›ï¼Œçªå‡ºé‡ç‚¹ï¼š</p>
<p>â€œæ‚¨å¥½ï¼Œæˆ‘æ˜¯ç‹å®‡å“²ï¼Œåä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹ç¡•å£«ï¼Œä¸»è¦ä¸“æ³¨äºGoè¯­è¨€åç«¯å¼€å‘ã€‚æˆ‘æœ‰ä¸‰ä¸ªæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„é¡¹ç›®ï¼šé¦–å…ˆæ˜¯åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼Œå•ç‚¹QPSè¶…è¿‡5000ï¼Œä½¿ç”¨äº†ä¸€è‡´æ€§å“ˆå¸Œå’ŒETCDæœåŠ¡å‘ç°ï¼›ç„¶åæ˜¯å¾®æœåŠ¡ç”µå•†ç³»ç»Ÿï¼Œè´Ÿè´£æ¶æ„è®¾è®¡å’Œå¤§éƒ¨åˆ†å¼€å‘å·¥ä½œï¼Œé›†æˆäº†å¯è§‚æµ‹æ€§å’Œåˆ†å¸ƒå¼é”ï¼›æœ€åæ˜¯AIç½‘å…³é¡¹ç›®ï¼Œç±»ä¼¼MCPæ¨¡å¼ï¼Œèƒ½å¤Ÿæ ¹æ®æç¤ºè¯æ™ºèƒ½è°ƒåº¦å¾®æœåŠ¡ã€‚æœ€è¿‘ä¹Ÿä¸ºmineruå¼€æºé¡¹ç›®è´¡çŒ®äº†MCPä»£ç ã€‚æˆ‘æ¯”è¾ƒç†Ÿæ‚‰AIå·¥å…·è¾…åŠ©å¼€å‘ï¼Œå¯¹ç°ä»£åç«¯æŠ€æœ¯æ ˆæœ‰æ·±å…¥ç†è§£ã€‚â€</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>é¡¹ç›®ä»‹ç»æ¯”è¾ƒè¯¦ç»†ï¼Œå±•ç°äº†æŠ€æœ¯å¹¿åº¦</li>
<li>é¢è¯•å®˜å¯¹minerué¡¹ç›®æ„Ÿå…´è¶£ï¼Œè¿›è¡Œäº†è¿½é—®</li>
<li>è‡ªæˆ‘ä»‹ç»ç•¥é•¿ï¼Œå¯ä»¥æ›´åŠ ç²¾ç‚¼</li>
</ul>
<h3 id="é—®é¢˜2ï¼šç¼–ç¨‹é¢˜-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„">é—®é¢˜2ï¼šç¼–ç¨‹é¢˜ - åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå†™ä¸€ä¸ªç®€å•çš„ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>å½“æ—¶åœ¨åœ¨çº¿ç¼–è¾‘å™¨ä¸­å®ç°äº†åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ç®—æ³•ï¼Œé¢è¯•å®˜ç¡®è®¤ä¸éœ€è¦å¼€è¾Ÿæ–°ç©ºé—´ï¼Œè¦æ±‚åŸåœ°åˆå¹¶åˆ°ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­ã€‚</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„åŒæŒ‡é’ˆé—®é¢˜ã€‚ç”±äºè¦æ±‚åŸåœ°åˆå¹¶ï¼Œå¯ä»¥è¿™æ ·æ€è€ƒï¼š</p>
<p>&quot;è¿™ä¸ªé¢˜ç›®çš„å…³é”®æ˜¯è¦åŸåœ°åˆå¹¶ï¼Œä¸èƒ½å¼€è¾Ÿæ–°ç©ºé—´ã€‚æˆ‘çš„æ€è·¯æ˜¯ä»åå¾€å‰å¡«å……ï¼Œè¿™æ ·ä¸ä¼šè¦†ç›–è¿˜æ²¡å¤„ç†çš„å…ƒç´ ã€‚</p>
<p>å…·ä½“å®ç°æ˜¯ç”¨ä¸‰ä¸ªæŒ‡é’ˆï¼šiæŒ‡å‘nums1çš„æœ‰æ•ˆå…ƒç´ æœ«å°¾ï¼ŒjæŒ‡å‘nums2çš„æœ«å°¾ï¼ŒkæŒ‡å‘nums1çš„çœŸå®æœ«å°¾ã€‚ç„¶åæ¯”è¾ƒnums1[i]å’Œnums2[j]ï¼ŒæŠŠè¾ƒå¤§çš„æ”¾åˆ°nums1[k]ä½ç½®ï¼Œç„¶åç›¸åº”æŒ‡é’ˆå‰ç§»ã€‚</p>
<p>è¿™æ ·æ—¶é—´å¤æ‚åº¦æ˜¯O(m+n)ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæ»¡è¶³åŸåœ°åˆå¹¶çš„è¦æ±‚ã€‚&quot;</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(nums1 []<span class="type">int</span>, m <span class="type">int</span>, nums2 []<span class="type">int</span>, n <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    i, j, k := m<span class="number">-1</span>, n<span class="number">-1</span>, m+n<span class="number">-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> j &gt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="number">0</span> &amp;&amp; nums1[i] &gt; nums2[j] &#123;</span><br><span class="line">            nums1[k] = nums1[i]</span><br><span class="line">            i--</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nums1[k] = nums2[j]</span><br><span class="line">            j--</span><br><span class="line">        &#125;</span><br><span class="line">        k--</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>ç¼–ç¨‹è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›å°é”™è¯¯ï¼Œéœ€è¦è°ƒè¯•</li>
<li>é¢è¯•å®˜è€å¿ƒç­‰å¾…å¹¶ç»™äºˆäº†æç¤º</li>
<li>åº”è¯¥å…ˆæƒ³æ¸…æ¥šæ€è·¯å†å¼€å§‹ç¼–å†™</li>
</ul>
<h3 id="é—®é¢˜3ï¼šGoè¯­è¨€åƒåœ¾å›æ”¶æœºåˆ¶">é—®é¢˜3ï¼šGoè¯­è¨€åƒåœ¾å›æ”¶æœºåˆ¶</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ çŸ¥é“Goç°åœ¨å®ƒçš„é‚£ä¸ªåƒåœ¾å›æ”¶æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä»–ç°åœ¨çš„è¯æœ€æ–°çš„æˆ‘æ²¡æœ‰å»äº†è§£ï¼Œä½†æ˜¯çš„è¯å†å¾€å‰ä¸€ç‚¹ï¼Œæˆ‘ä¸çŸ¥é“æœ€æ–°æœ‰æ²¡æœ‰å»æ›´æ–°ã€‚ä½†å†å¾€å‰ä¸€ç‚¹çš„è¯ï¼Œæ˜¯æ›´æ–°åˆ°äº†ä¸‰è‰²æ ‡è®°æ³•åŠ é‚£ä¸ªè¯»å†™å±éšœã€‚ç„¶åä¸‰è‰²æ ‡è®°æ³•çš„è¯ï¼Œæˆ‘çš„ç†è§£å°±æ˜¯â€¦ä»–åº”è¯¥æ˜¯18å’Œ19ç‰ˆæœ¬ä»¥åå°±æ˜¯æ›´æ–°çš„è¿™ä¸ªä¸‰è‰²æ ‡è®°æ³•åŠ è¯»å†™å±éšœã€‚ç„¶åä»–è¿™ä¸ªè¯»å†™å±éšœçš„è¯ç›¸å½“äºä¹‹å‰çš„è¯ä»–ä¼šå»ä»ä¸»å‡½æ•°å¼€å§‹ï¼Œä»¥åŠå †é¡¶å¼€å§‹ï¼Œä¸€ä¸ªä¸ªå»éå†æ‰€æœ‰ä¾¿åˆ©æ ‡è®°é‚£äº›å¯ä»¥è¢«è®¿é—®åˆ°çš„é‚£äº›å¯¹è±¡ï¼Œç„¶åå†æŠŠæœªæ ‡è®°çš„å…¨éƒ½åˆ æ‰ã€‚ä»¥å‰æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯ä¼šå‘ç°è¿™æ ·çš„è¯ä¼šæœ‰ä¸€ä¸ªå«stop the worldï¼Œå°±æ˜¯å®ƒä¼šéœ€è¦æŠŠæ•´ä¸ªç¨‹åºæš‚åœï¼Œç„¶åå»è¿›è¡Œè¿™æ ·çš„åƒåœ¾å›æ”¶ã€‚è¿™æ ·çš„è¯æ˜¯å¾ˆå½±å“æ€§èƒ½çš„ã€‚äºæ˜¯ä»–å°±æƒ³å‡ºäº†ä¸€ä¸ªä¸‰è‰²æ ‡è®°æ³•ï¼Œç„¶åè¿™æ ·å°±å¯ä»¥å’Œé‚£ä¸ªç¨‹åºå»å¹¶è¡Œçš„ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¹¶è¡Œçš„å»è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è¿™æ ·å°±æ„Ÿå—ä¸åˆ°é‚£ç§å¡é¡¿äº†ã€‚å®ƒç›¸å½“äºå¥½åƒæ˜¯å…ˆç”¨ä¸€ä¸ªé¢œè‰²ï¼Œæˆ‘æ˜¯ä¸å¤ªè®°å¾—äº†ã€‚ä½†æ˜¯çš„è¯å…ˆæ˜¯æ‰€æœ‰å¯¹è±¡æ˜¯ç™½è‰²ï¼Œç„¶åå®ƒä¼šä»–å¥½åƒæ˜¯ç™½è‰²ï¼Œç„¶åä»–ä¼šæŠŠæ‰€æœ‰çš„ä¸»å‡½æ•°ä¸­ç›´æ¥èƒ½è·å–åˆ°çš„å¯¹è±¡ï¼Œå°±å †é¡¶èƒ½ç›´æ¥æ··æ·†çš„å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²ã€‚ç„¶ååœ¨æ¯ä¸€é€šè¿‡è¿™ä¸ªé»‘è‰²çš„å¯¹è±¡å†å¾€ä¸‹éå†ï¼Œç„¶åéå†å®Œä¾¿åˆ©åçš„å¯¹è±¡åº”è¯¥ä¼šè¢«æ ‡è®°ä¸ºã€‚æ ‡è®°ä¸ºç°è‰²ï¼Œç„¶åæ ‡è®°ä¸ºç°è‰²å¯¹è±¡ã€‚æˆ‘æƒ³ä¸€æƒ³â€¦â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>Goçš„åƒåœ¾å›æ”¶ç¡®å®æ˜¯åŸºäºä¸‰è‰²æ ‡è®°æ³•ï¼Œæˆ‘æ¥ç³»ç»Ÿåœ°è¯´ä¸€ä¸‹ï¼š</p>
<p>&quot;Goç›®å‰ä½¿ç”¨çš„æ˜¯ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•é…åˆå†™å±éšœã€‚ä¸‰è‰²æŒ‡çš„æ˜¯ç™½è‰²ã€ç°è‰²ã€é»‘è‰²ä¸‰ç§çŠ¶æ€ï¼š</p>
<p>ç™½è‰²å¯¹è±¡ï¼šæœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶ç»“æŸåä¼šè¢«æ¸…ç†<br>
ç°è‰²å¯¹è±¡ï¼šå·²è¢«æ ‡è®°ä½†å…¶å¼•ç”¨çš„å¯¹è±¡è¿˜æœªå®Œå…¨æ‰«æçš„å¯¹è±¡<br>
é»‘è‰²å¯¹è±¡ï¼šå·²è¢«æ ‡è®°ä¸”å…¶å¼•ç”¨çš„å¯¹è±¡éƒ½å·²æ‰«æå®Œæˆçš„å¯¹è±¡</p>
<p>å…·ä½“æµç¨‹æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆä»GC Rootå¼€å§‹ï¼ŒæŠŠç›´æ¥å¯è¾¾çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚ç„¶åä¸æ–­åœ°å–å‡ºç°è‰²å¯¹è±¡ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºé»‘è‰²ï¼ŒåŒæ—¶æŠŠå®ƒå¼•ç”¨çš„ç™½è‰²å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚å½“æ²¡æœ‰ç°è‰²å¯¹è±¡æ—¶ï¼Œæ‰€æœ‰ç™½è‰²å¯¹è±¡å°±æ˜¯åƒåœ¾ï¼Œå¯ä»¥æ¸…ç†äº†ã€‚</p>
<p>å†™å±éšœçš„ä½œç”¨æ˜¯åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç¨‹åºä¿®æ”¹äº†æŒ‡é’ˆå¼•ç”¨ï¼Œä¼šè§¦å‘å±éšœå‡½æ•°ï¼Œç¡®ä¿æ–°çš„å¼•ç”¨å…³ç³»è¢«æ­£ç¡®å¤„ç†ï¼Œé¿å…é”™è¯¯å›æ”¶ã€‚</p>
<p>è¿™æ ·å°±å®ç°äº†å¹¶å‘åƒåœ¾å›æ”¶ï¼Œå¤§å¤§å‡å°‘äº†STWæ—¶é—´ï¼Œæé«˜äº†ç¨‹åºæ€§èƒ½ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¯¹æ¦‚å¿µæœ‰åŸºæœ¬äº†è§£ï¼Œä½†è¡¨è¾¾ä¸å¤Ÿæ¸…æ™°</li>
<li>ç»†èŠ‚è®°å¿†æ¨¡ç³Šï¼Œåº”è¯¥æ›´ç³»ç»Ÿåœ°å¤ä¹ </li>
<li>é¢è¯•å®˜çœ‹å‡ºäº†æˆ‘çš„ä¸ç¡®å®šï¼ŒåŠæ—¶è½¬æ¢äº†è¯é¢˜</li>
</ul>
<h3 id="é—®é¢˜4ï¼šGoè¯­è¨€Mapå®ç°">é—®é¢˜4ï¼šGoè¯­è¨€Mapå®ç°</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œæ¯”å¦‚è¯´ä½ é‚£ä¸ªGoçš„mapï¼Œå®ƒæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œmapå®ƒåº•å±‚æ˜¯ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨å»å®ç°çš„ã€‚ç„¶åæ€ä¹ˆè¯´å‘¢ï¼Ÿå°±å®ƒä¸€å¼€å§‹çš„é•¿åº¦ä¸ºé›¶ï¼Œç„¶åå®ƒä¼šæ¯æ¬¡å¾€é‡Œé¢æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå®ƒä¼šå¦‚æœè¯´è¶…å‡ºäº†å®ƒçš„å®¹é‡ï¼Œå®ƒä¼šå»æ‰©å¢ã€‚ç„¶åæ¯æ¬¡ä¹˜2ï¼Œç„¶ååˆ°å¥½åƒ1024çš„æ—¶å€™ï¼Œä»–å°±åé¢ä¸æ˜¯ä¹˜2äº†ã€‚å1024ä»¥åå°±æ¯æ¬¡ä¼šå¢åŠ 1024ä¸ªå…ƒç´ çš„å­˜å‚¨ç©ºé—´ï¼Œå¥½åƒæ˜¯è¿™æ ·ã€‚â€</p>
</blockquote>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<blockquote>
<p>â€œé‚£ä½ äº†è§£ä»–ç°åœ¨é‚£äº›ç¢°æ’ç®—æ³•æ˜¯æ€ä¹ˆå®ç°çš„å—ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œç¢°æ’ç®—æ³•å¦‚æœå®ƒç¢°æ’äº†ä¹‹åï¼Œå®ƒä¼šâ€¦Goä¸­çš„æˆ‘æ²¡æœ‰å»äº†è§£ï¼Œä½†æ˜¯æˆ‘å¤§æ¦‚çŸ¥é“å‡ ç§ç¢°æ’ï¼Œä¸€ç§å°±æ˜¯å“ˆå¸Œè¡¨ç¢°æ’è§£å†³åŠæ³•ä¸€èˆ¬ç¬¬ä¸€ç§å«å¥½åƒä»€ä¹ˆå¼€æ”¾å¯»å€æ³•ä¹‹ç±»çš„ã€‚ä»–æœ‰äº›ä¼šå°±æ˜¯å¾€åå°±å¾€åä¸€ä¸ªä¸ªå»æ‰¾ã€‚ç„¶åè¿˜æœ‰ä¸€äº›çš„è¯ï¼Œä»–å°±æ˜¯ä¼šå…ˆå¾€å³ä¸€æ ¼ï¼Œå°±æ˜¯è¿™ä¸€ä¸ªå¦‚æœè¯´å‘ç”Ÿç¢°æ’çš„è¯ï¼Œé‚£å®ƒå°±ä¼šåˆ°è¿™ä¸ªç´¢å¼•åŠ ä¸€çš„ä½ç½®å†æ‰¾ã€‚ç„¶åå¦‚æœè¯´å†æ‰¾å†è¢«å ç”¨çš„è¯ï¼Œåˆ°åŠ 1ï¼Œç„¶åå†åˆ°åŠ 2è¿™æ ·å»æŸ¥æ‰¾ã€‚ç„¶åè¿˜æœ‰ä¸€ç§çš„è¯å°±æ˜¯ä¸€ç›´å¾€åæ‰¾ï¼Œå°±indexä¸€ç›´åŠ 1åŠ 1åŠ 1ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>Goçš„mapå®ç°ç¡®å®æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘æ¥è¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p>&quot;Goçš„mapåº•å±‚æ˜¯å“ˆå¸Œè¡¨ï¼Œå…·ä½“å®ç°ä¸Šä½¿ç”¨çš„æ˜¯æ‹‰é“¾æ³•è§£å†³å†²çªã€‚å®ƒçš„æ•°æ®ç»“æ„åŒ…å«bucketsæ•°ç»„ï¼Œæ¯ä¸ªbucketå¯ä»¥å­˜å‚¨8ä¸ªkey-valueå¯¹ã€‚</p>
<p>å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼ŒGoä¸æ˜¯ç”¨å¼€æ”¾å¯»å€æ³•ï¼Œè€Œæ˜¯ç”¨æ‹‰é“¾æ³•ã€‚å¦‚æœä¸€ä¸ªbucketæ»¡äº†ï¼Œä¼šåˆ›å»ºoverflow bucketé“¾æ¥åˆ°åé¢ã€‚è¿™æ ·ç›¸åŒå“ˆå¸Œå€¼çš„å…ƒç´ ä¼šå½¢æˆä¸€ä¸ªé“¾è¡¨ç»“æ„ã€‚</p>
<p>å…³äºæ‰©å®¹æœºåˆ¶ï¼ŒGo mapæœ‰ä¸¤ç§æ‰©å®¹æ–¹å¼ï¼š</p>
<ol>
<li>ç¿»å€æ‰©å®¹ï¼šå½“è´Ÿè½½å› å­è¶…è¿‡6.5æ—¶è§¦å‘ï¼Œbucketæ•°é‡ç¿»å€</li>
<li>ç­‰é‡æ‰©å®¹ï¼šå½“overflow bucketè¿‡å¤šæ—¶è§¦å‘ï¼Œé‡æ–°æ•´ç†æ•°æ®ä½†ä¸å¢åŠ bucketæ•°é‡</li>
</ol>
<p>æ‰©å®¹æ˜¯æ¸è¿›å¼çš„ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å®Œæˆï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è®¿é—®æ—¶é€æ­¥è¿ç§»ï¼Œè¿™æ ·é¿å…äº†é•¿æ—¶é—´é˜»å¡ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯mapéå†æ˜¯éšæœºçš„ï¼Œè¿™æ˜¯Goæ•…æ„è®¾è®¡çš„ï¼Œä¸ºäº†é˜²æ­¢å¼€å‘è€…ä¾èµ–éå†é¡ºåºã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¯¹åŸºæœ¬åŸç†æœ‰äº†è§£ï¼Œä½†ç»†èŠ‚ä¸å¤Ÿå‡†ç¡®</li>
<li>æ··æ·†äº†Goå®é™…ä½¿ç”¨çš„ç¢°æ’è§£å†³æ–¹æ¡ˆ</li>
<li>åº”è¯¥åŒºåˆ†ä¸åŒè¯­è¨€çš„å“ˆå¸Œè¡¨å®ç°å·®å¼‚</li>
</ul>
<h3 id="é—®é¢˜5ï¼šGoè¯­è¨€åå°„æœºåˆ¶">é—®é¢˜5ï¼šGoè¯­è¨€åå°„æœºåˆ¶</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œé‚£ä¸ªGoå®ƒé‚£ä¸ªåå°„å®ƒæ˜¯æ€ä¹ˆå»å®ç°çš„ï¼Ÿæ¯”å¦‚è¯´Goé‚£ä¸ªstructé‡Œé¢ï¼Œå®ƒä¸æ˜¯æœ‰å¯ä»¥å®šä¹‰ä¸€äº›é‚£ä¸ªtypeï¼Œå¯¹å§ï¼Ÿæ¯”å¦‚è¯´ä½ marshalçš„æ—¶å€™ï¼Œä½ çŸ¥é“é‚£ä¸ªtypeæ€ä¹ˆå®ç°çš„ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œä¸å¤ªäº†è§£Goçš„åº•å±‚ï¼Œæˆ‘æ²¡æœ‰å¤ªç ”ç©¶è¿‡ï¼Œä¸»è¦æ˜¯ç¼–ç¨‹åº”ç”¨ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¿™ä¸ªé—®é¢˜è€ƒå¯Ÿçš„æ˜¯Goåå°„çš„åº•å±‚å®ç°ï¼Œç¡®å®æ¯”è¾ƒæ·±å…¥ï¼š</p>
<p>&quot;Goçš„åå°„æ˜¯åŸºäºinterface{}çš„åº•å±‚å®ç°æ¥å®ç°çš„ã€‚æ¯ä¸ªinterface{}å®é™…ä¸ŠåŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼šä¸€ä¸ªæŒ‡å‘ç±»å‹ä¿¡æ¯ï¼ˆtypeï¼‰ï¼Œä¸€ä¸ªæŒ‡å‘å…·ä½“æ•°æ®ï¼ˆdataï¼‰ã€‚</p>
<p>Goçš„ç±»å‹ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç±»å‹éƒ½æœ‰ä¸€ä¸ªruntime.Typeç»“æ„ï¼ŒåŒ…å«äº†ç±»å‹çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»å‹åç§°ã€æ–¹æ³•åˆ—è¡¨ã€å­—æ®µä¿¡æ¯ç­‰ã€‚</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨reflect.TypeOf()æ—¶ï¼Œå®é™…ä¸Šæ˜¯è·å–äº†interface{}ä¸­çš„ç±»å‹ä¿¡æ¯éƒ¨åˆ†ã€‚reflect.ValueOf()åˆ™æ˜¯è·å–äº†æ•°æ®éƒ¨åˆ†ï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥æ“ä½œè¿™ä¸ªå€¼ã€‚</p>
<p>å¯¹äºstructçš„tagï¼Œæ¯”å¦‚jsonæ ‡ç­¾ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨ç±»å‹çš„å…ƒæ•°æ®ä¸­çš„ã€‚ç¼–è¯‘å™¨ä¼šæŠŠè¿™äº›tagä¿¡æ¯ç¼–è¯‘åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œè¿è¡Œæ—¶é€šè¿‡åå°„å¯ä»¥è¯»å–åˆ°è¿™äº›ä¿¡æ¯ã€‚</p>
<p>marshal/unmarshalçš„è¿‡ç¨‹å°±æ˜¯ï¼šå…ˆé€šè¿‡åå°„è·å–ç±»å‹ä¿¡æ¯å’Œtagä¿¡æ¯ï¼Œç„¶åæ ¹æ®tagè§„åˆ™è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåå°„ä¼šæœ‰æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºéœ€è¦åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾å’Œè§£æè¿™äº›å…ƒæ•°æ®ä¿¡æ¯ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>æ‰¿è®¤ä¸äº†è§£æ¯”ç›´æ¥ä¹±ç­”è¦å¥½</li>
<li>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ·±å…¥çš„é—®é¢˜ï¼Œéœ€è¦å¯¹Goè¿è¡Œæ—¶æœ‰æ·±å…¥ç†è§£</li>
<li>å¯ä»¥å¹³æ—¶å¤šå…³æ³¨ä¸€äº›åº•å±‚å®ç°çš„æ–‡ç« </li>
</ul>
<h3 id="é—®é¢˜6ï¼šç¼“å­˜è¿‡æœŸæœºåˆ¶">é—®é¢˜6ï¼šç¼“å­˜è¿‡æœŸæœºåˆ¶</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ ä½ ä½ é‚£ä¸ªç¼“å­˜æ˜¯å§ï¼Ÿç¼“å­˜å®ƒè¿‡æœŸæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œç¼“å­˜è¿‡æœŸçš„è¯ï¼Œæˆ‘æ˜¯æ¨¡ä»¿é‚£ä¸ªredisé‡Œé¢çš„ã€‚ç„¶åæˆ‘çœ‹é‚£ä¸ªç¼“å­˜è¿‡æœŸçš„æ—¶å€™ï¼Œæˆ‘å¹¶ä¸ä¼šç›´æ¥å°†å®ƒåˆ é™¤ï¼Œè€Œæ˜¯ç­‰ä¸‹ä¸€æ¬¡å†è®¿é—®è¿™ä¸ªç¼“å­˜çš„æ—¶å€™ã€‚å°±æ¯æ¬¡è®¿é—®ç¼“å­˜ä¹‹å‰ï¼Œæˆ‘ä¼šå»åˆ¤æ–­ä¸€ä¸‹ã€‚ä¸è®¿é—®çš„è¯ï¼Œä»–åå°ä¼šæœ‰ä¸€ä¸ªåç¨‹å»ç›‘å¬ï¼Œç„¶åå°±æ˜¯ä¼šå®šæœŸå»æ¸…ç†ï¼Œå°±æ˜¯å…¨å±€å»æŸ¥æ‰¾ï¼Œç„¶åå»æ¸…ç†è¿‡æœŸçš„é‚£äº›ç¼“å­˜ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼å…¶å®ä¹Ÿæ˜¯æœ‰ä¼˜åŒ–çš„ï¼Œä½†æˆ‘è¿˜æ²¡æœ‰åšä¼˜åŒ–ï¼Œå› ä¸ºå…¨å±€æ¸…ç†çš„è¯ä¼šæ¯”è¾ƒè€—æ—¶é—´ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>ç¼“å­˜è¿‡æœŸæœºåˆ¶çš„å®ç°æ€è·¯æ˜¯å¯¹çš„ï¼Œå¯ä»¥æ›´è¯¦ç»†åœ°è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p>&quot;æˆ‘å®ç°çš„ç¼“å­˜è¿‡æœŸæœºåˆ¶ä¸»è¦é‡‡ç”¨äº†ä¸¤ç§ç­–ç•¥ï¼Œå‚è€ƒäº†Redisçš„è®¾è®¡ï¼š</p>
<p>ç¬¬ä¸€ç§æ˜¯æƒ°æ€§åˆ é™¤ï¼šå½“å®¢æˆ·ç«¯è®¿é—®æŸä¸ªkeyæ—¶ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤å¹¶è¿”å›ç©ºå€¼ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ä¸ä¼šæµªè´¹CPUèµ„æºï¼Œç¼ºç‚¹æ˜¯å¦‚æœæŸäº›keyä¸€ç›´ä¸è¢«è®¿é—®ï¼Œå°±ä¼šä¸€ç›´å ç”¨å†…å­˜ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯å®šæœŸåˆ é™¤ï¼šå¯åŠ¨ä¸€ä¸ªåå°åç¨‹ï¼Œå®šæœŸæ‰«ææ‰€æœ‰keyï¼Œåˆ é™¤è¿‡æœŸçš„keyã€‚ä¸ºäº†é¿å…ä¸€æ¬¡æ€§æ‰«ææ‰€æœ‰keyå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œæˆ‘é‡‡ç”¨äº†åˆ†æ‰¹å¤„ç†çš„æ–¹å¼ã€‚</p>
<p>æ›´å¥½çš„ä¼˜åŒ–æ–¹æ¡ˆå¯ä»¥è€ƒè™‘ï¼š</p>
<ol>
<li>éšæœºé‡‡æ ·ï¼šæ¯æ¬¡åªæ£€æŸ¥ä¸€éƒ¨åˆ†keyï¼Œè€Œä¸æ˜¯å…¨é‡æ‰«æ</li>
<li>æ—¶é—´è½®ç®—æ³•ï¼šæŒ‰è¿‡æœŸæ—¶é—´å¯¹keyè¿›è¡Œåˆ†ç»„ï¼Œå‡å°‘æ£€æŸ¥é¢‘ç‡</li>
<li>LRUæ·˜æ±°ï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¸»åŠ¨æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„key</li>
</ol>
<p>è¿™æ ·æ—¢èƒ½ä¿è¯è¿‡æœŸkeyåŠæ—¶æ¸…ç†ï¼Œåˆä¸ä¼šå¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆå¤ªå¤§å½±å“ã€‚&quot;</p>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>åŸºæœ¬æ€è·¯æ­£ç¡®ï¼Œå‚è€ƒäº†Redisçš„å®ç°</li>
<li>æ„è¯†åˆ°äº†æ€§èƒ½ä¼˜åŒ–çš„é—®é¢˜</li>
<li>å¯ä»¥è¿›ä¸€æ­¥äº†è§£æ›´å¤šä¼˜åŒ–ç­–ç•¥</li>
</ul>
<h2 id="é¢è¯•æ•´ä½“æ„Ÿå—">é¢è¯•æ•´ä½“æ„Ÿå—</h2>
<ul>
<li><strong>éš¾åº¦è¯„ä»·</strong>: é€‚ä¸­ï¼Œä¸»è¦è€ƒå¯ŸGoè¯­è¨€åŸºç¡€å’Œç³»ç»Ÿè®¾è®¡æ€ç»´</li>
<li><strong>é¢è¯•å®˜é£æ ¼</strong>: æ¯”è¾ƒå‹å–„ï¼Œä¼šç»™äºˆæç¤ºå’Œå¼•å¯¼</li>
<li><strong>é¢˜ç›®ç±»å‹</strong>: åŸºç¡€æ¦‚å¿µ + ç¼–ç¨‹å®ç° + é¡¹ç›®ç»éªŒ</li>
<li><strong>å‡†å¤‡å»ºè®®</strong>: é‡ç‚¹å¤ä¹ Goè¯­è¨€ç‰¹æ€§ã€æ•°æ®ç»“æ„å®ç°å’Œåˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚å¿µ</li>
</ul>
<h2 id="é¢è¯•ç»“æœ">é¢è¯•ç»“æœ</h2>
<ul>
<li><strong>å½“åœºåé¦ˆ</strong>: é¢è¯•å®˜è¯¢é—®äº†å®ä¹ æ—¶é—´å®‰æ’ï¼Œè¡¨ç¤ºå¯ä»¥æ¥å—</li>
<li><strong>åç»­æµç¨‹</strong>: é¢è¯•å®˜è¡¨ç¤ºä¼šå®‰æ’åç»­é€šçŸ¥</li>
<li><strong>ä¸ªäººæ„Ÿå—</strong>: æ•´ä½“è¡¨ç°ä¸­ç­‰ï¼Œæœ‰äº›åŸºç¡€æ¦‚å¿µéœ€è¦åŠ å¼º</li>
</ul>
<h2 id="ç»éªŒæ€»ç»“">ç»éªŒæ€»ç»“</h2>
<h3 id="åšå¾—å¥½çš„åœ°æ–¹">åšå¾—å¥½çš„åœ°æ–¹</h3>
<ul>
<li>è‡ªæˆ‘ä»‹ç»æ¯”è¾ƒå…¨é¢ï¼Œé¡¹ç›®ç»éªŒä¸°å¯Œ</li>
<li>ç¼–ç¨‹é¢˜æœ€ç»ˆå®ç°æ­£ç¡®ï¼Œæ€è·¯æ¸…æ™°</li>
<li>å¯¹äºä¸äº†è§£çš„é—®é¢˜è¯šå®å›ç­”ï¼Œæ²¡æœ‰å¼ºè¡Œå›ç­”</li>
</ul>
<h3 id="éœ€è¦æ”¹è¿›çš„åœ°æ–¹">éœ€è¦æ”¹è¿›çš„åœ°æ–¹</h3>
<ul>
<li>Goè¯­è¨€åŸºç¡€æ¦‚å¿µæŒæ¡ä¸å¤Ÿæ·±å…¥ï¼Œç‰¹åˆ«æ˜¯åº•å±‚å®ç°</li>
<li>è¡¨è¾¾æ—¶æœ‰äº›å¡é¡¿ï¼Œé€»è¾‘æ€§æœ‰å¾…æé«˜</li>
<li>å¯¹äºåƒåœ¾å›æ”¶ç­‰æ ¸å¿ƒæ¦‚å¿µåº”è¯¥æ›´åŠ å‡†ç¡®</li>
</ul>
<h3 id="å‡†å¤‡å»ºè®®">å‡†å¤‡å»ºè®®</h3>
<ol>
<li><strong>Goè¯­è¨€åŸºç¡€</strong>: æ·±å…¥å­¦ä¹ GMPæ¨¡å‹ã€åƒåœ¾å›æ”¶ã€mapå®ç°ç­‰æ ¸å¿ƒæ¦‚å¿µ</li>
<li><strong>ç³»ç»Ÿè®¾è®¡</strong>: åŠ å¼ºå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿã€ç¼“å­˜ç­–ç•¥çš„ç†è§£</li>
<li><strong>ç®—æ³•å®ç°</strong>: å¤šç»ƒä¹ åŒæŒ‡é’ˆã€æ•°ç»„æ“ä½œç­‰åŸºç¡€ç®—æ³•</li>
<li><strong>è¡¨è¾¾èƒ½åŠ›</strong>: æå‰å‡†å¤‡æŠ€æœ¯æ¦‚å¿µçš„æ ‡å‡†è¡¨è¿°ï¼Œé¿å…å£è¯­åŒ–è¿‡é‡</li>
</ol>
<h3 id="é‡è¦çŸ¥è¯†ç‚¹å¤ä¹ ">é‡è¦çŸ¥è¯†ç‚¹å¤ä¹ </h3>
<ul>
<li>Goè¯­è¨€ä¸‰è‰²æ ‡è®°åƒåœ¾å›æ”¶ç®—æ³•</li>
<li>Go mapçš„åº•å±‚å®ç°å’Œæ‰©å®¹æœºåˆ¶</li>
<li>Goåå°„çš„å®ç°åŸç†</li>
<li>ç¼“å­˜è¿‡æœŸç­–ç•¥è®¾è®¡</li>
<li>åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</li>
</ul>
]]></content>
      <categories>
        <category>é¢è¯•ç»éªŒ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ä¸€é¢</tag>
        <tag>å®ä¹ </tag>
        <tag>è…¾è®¯äº‘</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 133 - å…‹éš†å›¾ï¼ˆClone Graphï¼‰</title>
    <url>/2025/06/21/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-133-%E5%85%8B%E9%9A%86%E5%9B%BE/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ æ— å‘<strong>è¿é€š</strong>å›¾ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œè¯·ä½ è¿”å›è¯¥å›¾çš„<strong>æ·±æ‹·è´</strong>ï¼ˆå…‹éš†ï¼‰ã€‚</p>
<p>å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«å®ƒçš„å€¼ <code>val</code>ï¼ˆ<code>int</code>ï¼‰ å’Œå…¶é‚»å±…çš„åˆ—è¡¨ï¼ˆ<code>list[Node]</code>ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class Node &#123;</span><br><span class="line">    public int val;</span><br><span class="line">    public List&lt;Node&gt; neighbors;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æµ‹è¯•ç”¨ä¾‹æ ¼å¼">æµ‹è¯•ç”¨ä¾‹æ ¼å¼</h3>
<p>ç®€å•èµ·è§ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å’Œå®ƒçš„ç´¢å¼•ç›¸åŒã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹å€¼ä¸º 1ï¼ˆ<code>val = 1</code>ï¼‰ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹å€¼ä¸º 2ï¼ˆ<code>val = 2</code>ï¼‰ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¯¥å›¾åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­ä½¿ç”¨é‚»æ¥åˆ—è¡¨è¡¨ç¤ºã€‚</p>
<p><strong>é‚»æ¥åˆ—è¡¨</strong>æ˜¯ç”¨äºè¡¨ç¤ºæœ‰é™å›¾çš„æ— åºåˆ—è¡¨çš„é›†åˆã€‚æ¯ä¸ªåˆ—è¡¨éƒ½æè¿°äº†å›¾ä¸­èŠ‚ç‚¹çš„é‚»å±…é›†ã€‚</p>
<p>ç»™å®šèŠ‚ç‚¹å°†å§‹ç»ˆæ˜¯å›¾ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå€¼ä¸º 1ï¼‰ã€‚ä½ å¿…é¡»å°†<strong>ç»™å®šèŠ‚ç‚¹çš„æ‹·è´</strong>ä½œä¸ºå¯¹å…‹éš†å›¾çš„å¼•ç”¨è¿”å›ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šadjList = [[2,4],[1,3],[2,4],[1,3]]</span><br><span class="line">è¾“å‡ºï¼š[[2,4],[1,3],[2,4],[1,3]]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">å›¾ä¸­æœ‰ 4 ä¸ªèŠ‚ç‚¹ã€‚</span><br><span class="line">èŠ‚ç‚¹ 1 çš„å€¼æ˜¯ 1ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‚»å±…ï¼šèŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 4 ã€‚</span><br><span class="line">èŠ‚ç‚¹ 2 çš„å€¼æ˜¯ 2ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‚»å±…ï¼šèŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 3 ã€‚</span><br><span class="line">èŠ‚ç‚¹ 3 çš„å€¼æ˜¯ 3ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‚»å±…ï¼šèŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 4 ã€‚</span><br><span class="line">èŠ‚ç‚¹ 4 çš„å€¼æ˜¯ 4ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‚»å±…ï¼šèŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 3 ã€‚</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/21/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-133-%E5%85%8B%E9%9A%86%E5%9B%BE/1750518091470.png" alt="1750518091470"></p>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šadjList = [[]]</span><br><span class="line">è¾“å‡ºï¼š[[]]</span><br><span class="line">è§£é‡Šï¼šè¾“å…¥åŒ…å«ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚è¯¥å›¾ä»…ä»…åªæœ‰ä¸€ä¸ªå€¼ä¸º 1 çš„èŠ‚ç‚¹ï¼Œå®ƒæ²¡æœ‰ä»»ä½•é‚»å±…ã€‚</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/21/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-133-%E5%85%8B%E9%9A%86%E5%9B%BE/1750518114187.png" alt="1750518114187"></p>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šadjList = []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br><span class="line">è§£é‡Šï¼šè¿™ä¸ªå›¾æ˜¯ç©ºçš„ï¼Œå®ƒä¸å«ä»»ä½•èŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>èŠ‚ç‚¹æ•°ä¸è¶…è¿‡ 100</li>
<li><code>1 &lt;= Node.val &lt;= 100</code></li>
<li>æ¯ä¸ªèŠ‚ç‚¹å€¼ <code>Node.val</code> éƒ½æ˜¯å”¯ä¸€çš„</li>
<li>æ— å‘å›¾</li>
<li>å›¾æ˜¯è¿é€šçš„ï¼Œä½ å¯ä»¥ä»ç»™å®šèŠ‚ç‚¹è®¿é—®åˆ°æ‰€æœ‰èŠ‚ç‚¹</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>å›¾çš„æ·±æ‹·è´</strong>é—®é¢˜ï¼Œæ ¸å¿ƒæŒ‘æˆ˜åœ¨äºå¤„ç†å›¾ä¸­çš„<strong>ç¯å½¢å¼•ç”¨</strong>ã€‚å¦‚æœç›´æ¥é€’å½’å¤åˆ¶ï¼Œä¼šé™·å…¥æ— é™å¾ªç¯ã€‚</p>
<h3 id="æ ¸å¿ƒæ€è·¯">æ ¸å¿ƒæ€è·¯</h3>
<p><strong>ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰+ å“ˆå¸Œè¡¨</strong>æ¥è§£å†³ï¼š</p>
<ol>
<li><strong>å“ˆå¸Œè¡¨è®°å½•æ˜ å°„å…³ç³»</strong>ï¼šç”¨ <code>visited</code> å“ˆå¸Œè¡¨è®°å½•åŸèŠ‚ç‚¹åˆ°å…‹éš†èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»</li>
<li><strong>é¿å…é‡å¤è®¿é—®</strong>ï¼šå¦‚æœèŠ‚ç‚¹å·²ç»è¢«è®¿é—®è¿‡ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„å…‹éš†èŠ‚ç‚¹</li>
<li><strong>é€’å½’æ„å»ºé‚»å±…å…³ç³»</strong>ï¼šå¯¹æ¯ä¸ªé‚»å±…èŠ‚ç‚¹é€’å½’è°ƒç”¨å…‹éš†å‡½æ•°</li>
</ol>
<h3 id="å…³é”®æ´å¯Ÿ">å…³é”®æ´å¯Ÿ</h3>
<p><strong>è®¿é—®æ ‡è®°çš„æ—¶æœºè‡³å…³é‡è¦</strong>ï¼šå¿…é¡»åœ¨å¼€å§‹å¤„ç†é‚»å±…ä¹‹å‰å°±å»ºç«‹åŸèŠ‚ç‚¹åˆ°å…‹éš†èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼Œè€Œä¸æ˜¯åœ¨å¤„ç†å®Œé‚»å±…ä¹‹åã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å¤„ç†ç¯å½¢å¼•ç”¨æ—¶å‡ºç°æ— é™é€’å½’ã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li><strong>è¾¹ç•Œå¤„ç†</strong>ï¼šå¦‚æœè¾“å…¥èŠ‚ç‚¹ä¸ºç©ºï¼Œç›´æ¥è¿”å› <code>nil</code></li>
<li><strong>æ£€æŸ¥æ˜¯å¦å·²è®¿é—®</strong>ï¼šå¦‚æœå½“å‰èŠ‚ç‚¹å·²ç»åœ¨ <code>visited</code> ä¸­ï¼Œè¯´æ˜å·²ç»å…‹éš†è¿‡ï¼Œç›´æ¥è¿”å›å…‹éš†èŠ‚ç‚¹</li>
<li><strong>åˆ›å»ºå…‹éš†èŠ‚ç‚¹</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå€¼ä¸åŸèŠ‚ç‚¹ç›¸åŒï¼Œé‚»å±…åˆ—è¡¨ä¸ºç©º</li>
<li><strong>â­ å…³é”®æ­¥éª¤</strong>ï¼šç«‹å³å°†åŸèŠ‚ç‚¹å’Œå…‹éš†èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»å­˜å…¥ <code>visited</code></li>
<li><strong>é€’å½’å¤„ç†é‚»å±…</strong>ï¼šéå†åŸèŠ‚ç‚¹çš„æ‰€æœ‰é‚»å±…ï¼Œé€’å½’è°ƒç”¨å…‹éš†å‡½æ•°ï¼Œå°†è¿”å›çš„å…‹éš†é‚»å±…æ·»åŠ åˆ°å½“å‰å…‹éš†èŠ‚ç‚¹çš„é‚»å±…åˆ—è¡¨ä¸­</li>
<li><strong>è¿”å›å…‹éš†èŠ‚ç‚¹</strong></li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆè¦å…ˆå»ºç«‹æ˜ å°„å…³ç³»ï¼Ÿ">ä¸ºä»€ä¹ˆè¦å…ˆå»ºç«‹æ˜ å°„å…³ç³»ï¼Ÿ</h3>
<p>è€ƒè™‘è¿™æ ·çš„å›¾ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 ---- 2</span><br><span class="line">|      |</span><br><span class="line">|      |</span><br><span class="line">4 ---- 3</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬åœ¨å¤„ç†å®Œé‚»å±…åæ‰å»ºç«‹æ˜ å°„ï¼š</p>
<ol>
<li>å…‹éš†èŠ‚ç‚¹ 1ï¼Œå¼€å§‹å¤„ç†å…¶é‚»å±…èŠ‚ç‚¹ 2 å’Œ 4</li>
<li>é€’å½’å…‹éš†èŠ‚ç‚¹ 2ï¼Œå¼€å§‹å¤„ç†å…¶é‚»å±…èŠ‚ç‚¹ 1 å’Œ 3</li>
<li>é€’å½’å…‹éš†èŠ‚ç‚¹ 1ï¼ˆåˆå›åˆ°äº†èŠ‚ç‚¹ 1ï¼ï¼‰</li>
<li>å› ä¸ºèŠ‚ç‚¹ 1 è¿˜æ²¡æœ‰åœ¨ <code>visited</code> ä¸­å»ºç«‹æ˜ å°„ï¼Œä¼šé‡æ–°å¼€å§‹å…‹éš†è¿‡ç¨‹</li>
<li><strong>æ— é™é€’å½’</strong>ï¼</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="æ­£ç¡®å®ç°">æ­£ç¡®å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cloneGraph</span><span class="params">(node *Node)</span></span> *Node &#123;</span><br><span class="line">    visited := <span class="keyword">map</span>[*Node]*Node&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(cur *Node)</span></span> *Node</span><br><span class="line">    </span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(cur *Node)</span></span> *Node &#123;</span><br><span class="line">        <span class="comment">// è¾¹ç•Œæ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> cur == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> cur</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœå·²ç»è®¿é—®è¿‡ï¼Œç›´æ¥è¿”å›å…‹éš†èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> clonedNode, ok := visited[cur]; ok &#123;</span><br><span class="line">            <span class="keyword">return</span> clonedNode</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ›å»ºå…‹éš†èŠ‚ç‚¹</span></span><br><span class="line">        clonedNode := &amp;Node&#123;cur.Val, []*Node&#123;&#125;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// â­ å…³é”®ï¼šç«‹å³å»ºç«‹æ˜ å°„å…³ç³»ï¼</span></span><br><span class="line">        visited[cur] = clonedNode</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€’å½’å¤„ç†æ‰€æœ‰é‚»å±…</span></span><br><span class="line">        <span class="keyword">for</span> _, neighbor := <span class="keyword">range</span> cur.Neighbors &#123;</span><br><span class="line">            clonedNode.Neighbors = <span class="built_in">append</span>(clonedNode.Neighbors, dfs(neighbor))</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> clonedNode</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dfs(node)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯å®ç°åˆ†æ">é”™è¯¯å®ç°åˆ†æ</h3>
<p>âŒ <strong>é”™è¯¯çš„ä»£ç </strong>ï¼ˆå°† <code>visited[cur] = clonedNode</code> æ”¾åœ¨æœ€åï¼‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cloneGraph</span><span class="params">(node *Node)</span></span> *Node &#123;</span><br><span class="line">    visited := <span class="keyword">map</span>[*Node]*Node&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(cur *Node)</span></span> *Node</span><br><span class="line">    </span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(cur *Node)</span></span> *Node &#123;</span><br><span class="line">        <span class="keyword">if</span> cur == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> cur</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> clonedNode, ok := visited[cur]; ok &#123;</span><br><span class="line">            <span class="keyword">return</span> clonedNode</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        clonedNode := &amp;Node&#123;cur.Val, []*Node&#123;&#125;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€’å½’å¤„ç†æ‰€æœ‰é‚»å±…</span></span><br><span class="line">        <span class="keyword">for</span> _, neighbor := <span class="keyword">range</span> cur.Neighbors &#123;</span><br><span class="line">            clonedNode.Neighbors = <span class="built_in">append</span>(clonedNode.Neighbors, dfs(neighbor))</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// âŒ é”™è¯¯ï¼šå¤ªæ™šå»ºç«‹æ˜ å°„å…³ç³»ï¼</span></span><br><span class="line">        visited[cur] = clonedNode</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> clonedNode</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dfs(node)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› è¯¦ç»†åˆ†æ">é”™è¯¯åŸå› è¯¦ç»†åˆ†æ</h3>
<h4 id="é—®é¢˜æ ¹æº">é—®é¢˜æ ¹æº</h4>
<p><strong>æ—¶æœºé”™è¯¯</strong>ï¼šåœ¨å¤„ç†é‚»å±…çš„é€’å½’è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå½“å‰èŠ‚ç‚¹è¿˜æ²¡æœ‰è¢«æ ‡è®°ä¸º&quot;å·²è®¿é—®&quot;ï¼Œå¯¼è‡´åœ¨ç¯å½¢å¼•ç”¨çš„æƒ…å†µä¸‹ä¼šé‡å¤è¿›å…¥åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<h4 id="å…·ä½“æ‰§è¡Œè¿‡ç¨‹">å…·ä½“æ‰§è¡Œè¿‡ç¨‹</h4>
<p>ä»¥å›¾ <code>1-2-1</code> ä¸ºä¾‹ï¼ˆèŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 2 äº’ç›¸è¿æ¥ï¼‰ï¼š</p>
<ol>
<li>
<p><strong>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>dfs(node1)</code></strong>ï¼š</p>
<ul>
<li><code>visited</code> ä¸ºç©ºï¼Œåˆ›å»º <code>clonedNode1</code></li>
<li>å¼€å§‹å¤„ç† <code>node1</code> çš„é‚»å±… <code>node2</code></li>
<li>è°ƒç”¨ <code>dfs(node2)</code></li>
</ul>
</li>
<li>
<p><strong>ç¬¬äºŒæ¬¡è°ƒç”¨ <code>dfs(node2)</code></strong>ï¼š</p>
<ul>
<li><code>visited</code> ä»ä¸ºç©ºï¼ˆ<code>node1</code> è¿˜æ²¡è¢«æ·»åŠ ï¼‰ï¼Œåˆ›å»º <code>clonedNode2</code></li>
<li>å¼€å§‹å¤„ç† <code>node2</code> çš„é‚»å±… <code>node1</code></li>
<li>è°ƒç”¨ <code>dfs(node1)</code> â† <strong>åˆå›åˆ°äº†èŠ‚ç‚¹ 1ï¼</strong></li>
</ul>
</li>
<li>
<p><strong>ç¬¬ä¸‰æ¬¡è°ƒç”¨ <code>dfs(node1)</code></strong>ï¼š</p>
<ul>
<li><code>visited</code> ä»ä¸ºç©ºï¼Œå†æ¬¡åˆ›å»ºæ–°çš„ <code>clonedNode1</code></li>
<li>å¼€å§‹å¤„ç†é‚»å±…â€¦</li>
<li><strong>æ— é™é€’å½’å¼€å§‹ï¼</strong></li>
</ul>
</li>
</ol>
<h4 id="Runtime-Error-çš„å…·ä½“è¡¨ç°">Runtime Error çš„å…·ä½“è¡¨ç°</h4>
<ul>
<li><strong>Stack Overflow</strong>ï¼šé€’å½’æ ˆæ·±åº¦è¶…å‡ºé™åˆ¶</li>
<li><strong>è¶…æ—¶é”™è¯¯</strong>ï¼šç¨‹åºé™·å…¥æ— é™å¾ªç¯</li>
<li><strong>å†…å­˜æº¢å‡º</strong>ï¼šä¸æ–­åˆ›å»ºæ–°çš„èŠ‚ç‚¹å¯¹è±¡</li>
</ul>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(N + M)$</p>
<ul>
<li>$N$ æ˜¯èŠ‚ç‚¹æ•°é‡ï¼Œ$M$ æ˜¯è¾¹çš„æ•°é‡</li>
<li>æ¯ä¸ªèŠ‚ç‚¹è®¿é—®ä¸€æ¬¡ï¼š$O(N)$</li>
<li>æ¯æ¡è¾¹è®¿é—®ä¸€æ¬¡ï¼š$O(M)$</li>
</ul>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(N)$</p>
<ul>
<li><code>visited</code> å“ˆå¸Œè¡¨å­˜å‚¨ï¼š$O(N)$</li>
<li>é€’å½’è°ƒç”¨æ ˆæ·±åº¦ï¼š$O(N)$ï¼ˆæœ€åæƒ…å†µä¸‹æ˜¯é“¾çŠ¶å›¾ï¼‰</li>
<li>å…‹éš†å›¾çš„å­˜å‚¨ç©ºé—´ï¼š$O(N + M)$ï¼ˆä¸è®¡å…¥ç»“æœç©ºé—´ï¼‰</li>
</ul>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ­£ç¡®å®ç°</th>
<th>é”™è¯¯å®ç°</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ˜ å°„å»ºç«‹æ—¶æœº</td>
<td>åˆ›å»ºèŠ‚ç‚¹åç«‹å³å»ºç«‹</td>
<td>å¤„ç†å®Œé‚»å±…åå»ºç«‹</td>
</tr>
<tr>
<td>ç¯å½¢å¼•ç”¨å¤„ç†</td>
<td>âœ… æ­£ç¡®å¤„ç†</td>
<td>âŒ æ— é™é€’å½’</td>
</tr>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(N + M)$</td>
<td>æ— æ³•å®Œæˆï¼ˆè¶…æ—¶/æ ˆæº¢å‡ºï¼‰</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(N)$</td>
<td>æ— æ³•å®Œæˆï¼ˆå†…å­˜æº¢å‡ºï¼‰</td>
</tr>
<tr>
<td>è¿è¡Œç»“æœ</td>
<td>âœ… é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹</td>
<td>âŒ Runtime Error</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="é‡è¦æ¦‚å¿µ">é‡è¦æ¦‚å¿µ</h3>
<ol>
<li><strong>å›¾çš„æ·±æ‹·è´</strong>ï¼šä¸ä»…è¦å¤åˆ¶èŠ‚ç‚¹å€¼ï¼Œè¿˜è¦æ­£ç¡®å¤åˆ¶èŠ‚ç‚¹é—´çš„è¿æ¥å…³ç³»</li>
<li><strong>ç¯å½¢å¼•ç”¨æ£€æµ‹</strong>ï¼šä½¿ç”¨å“ˆå¸Œè¡¨è®°å½•è®¿é—®çŠ¶æ€ï¼Œé¿å…é‡å¤è®¿é—®</li>
<li><strong>è®¿é—®æ ‡è®°æ—¶æœº</strong>ï¼šåœ¨å¼€å§‹å¤„ç†å½“å‰èŠ‚ç‚¹æ—¶å°±è¦æ ‡è®°ï¼Œè€Œä¸æ˜¯å¤„ç†å®Œæˆå</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>âŒ è®¿é—®æ ‡è®°æ—¶æœºé”™è¯¯</strong>ï¼šåœ¨é€’å½’å¤„ç†é‚»å±…ä¹‹åæ‰æ ‡è®°è®¿é—®çŠ¶æ€</li>
<li><strong>âŒ å¿˜è®°å¤„ç†ç©ºå›¾</strong>ï¼šæ²¡æœ‰æ£€æŸ¥è¾“å…¥èŠ‚ç‚¹æ˜¯å¦ä¸º <code>nil</code></li>
<li><strong>âŒ é‚»å±…åˆ—è¡¨åˆå§‹åŒ–é”™è¯¯</strong>ï¼šæ²¡æœ‰æ­£ç¡®åˆå§‹åŒ–å…‹éš†èŠ‚ç‚¹çš„é‚»å±…åˆ—è¡¨</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><strong>LeetCode 138 - å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨</strong>ï¼šç±»ä¼¼çš„æ·±æ‹·è´é—®é¢˜</li>
<li><strong>LeetCode 207 - è¯¾ç¨‹è¡¨</strong>ï¼šå›¾çš„ç¯æ£€æµ‹é—®é¢˜</li>
<li><strong>LeetCode 200 - å²›å±¿æ•°é‡</strong>ï¼šå›¾çš„ DFS éå†</li>
</ul>
<h3 id="å®é™…åº”ç”¨">å®é™…åº”ç”¨</h3>
<ul>
<li><strong>å¯¹è±¡æ·±æ‹·è´</strong>ï¼šåœ¨éœ€è¦å®Œå…¨ç‹¬ç«‹çš„å¯¹è±¡å‰¯æœ¬æ—¶</li>
<li><strong>å›¾æ•°æ®åº“</strong>ï¼šå¤åˆ¶å›¾ç»“æ„ç”¨äºå¤‡ä»½æˆ–åˆ†æ</li>
<li><strong>ç¤¾äº¤ç½‘ç»œ</strong>ï¼šå¤åˆ¶ç”¨æˆ·å…³ç³»ç½‘ç»œçš„å­å›¾</li>
</ul>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ•™è®­æ˜¯ï¼š<strong>åœ¨å¤„ç†æœ‰ç¯æ•°æ®ç»“æ„æ—¶ï¼Œè®¿é—®æ ‡è®°çš„æ—¶æœºè‡³å…³é‡è¦</strong>ã€‚å¿…é¡»åœ¨å¼€å§‹å¤„ç†å½“å‰å…ƒç´ æ—¶å°±è¿›è¡Œæ ‡è®°ï¼Œè€Œä¸æ˜¯ç­‰å¤„ç†å®Œæˆåå†æ ‡è®°ã€‚è¿™æ˜¯é¿å…æ— é™é€’å½’çš„å…³é”®ï¼</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›¾è®º</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>å›¾</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>DFS</tag>
      </tags>
  </entry>
  <entry>
    <title>è…¾è®¯äº‘CSIG åç«¯å¼€å‘å·¥ç¨‹å¸ˆ äºŒé¢</title>
    <url>/2025/06/21/%E9%9D%A2%E8%AF%95%E9%A2%98/%E4%BA%92%E8%81%94%E7%BD%91%E5%A4%A7%E5%8E%82/%E8%85%BE%E8%AE%AF/2025-06-18-%E8%85%BE%E8%AE%AF%E4%BA%91CSIG-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91-%E4%BA%8C%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="é¢è¯•åŸºæœ¬ä¿¡æ¯">é¢è¯•åŸºæœ¬ä¿¡æ¯</h2>
<ul>
<li><strong>å…¬å¸</strong>: è…¾è®¯äº‘ AIäº§å“ä¸­å¿ƒ</li>
<li><strong>èŒä½</strong>: åç«¯å¼€å‘å·¥ç¨‹å¸ˆ</li>
<li><strong>é¢è¯•è½®æ¬¡</strong>: äºŒé¢ï¼ˆæŠ€æœ¯é¢ï¼‰</li>
<li><strong>é¢è¯•å½¢å¼</strong>: çº¿ä¸Šè§†é¢‘é¢è¯•ï¼ˆå¯é€‰æ‹©æ˜¯å¦å¼€æ‘„åƒå¤´ï¼‰</li>
<li><strong>é¢è¯•æ—¶é•¿</strong>: çº¦70åˆ†é’Ÿ</li>
<li><strong>é¢è¯•å®˜</strong>: æŠ€æœ¯å›¢é˜Ÿè´Ÿè´£äººï¼Œä¸»è¦è´Ÿè´£AIå¹³å°æœºå™¨å­¦ä¹ å¹³å°ç›¸å…³äº§å“</li>
</ul>
<h2 id="å›¢é˜Ÿä»‹ç»">å›¢é˜Ÿä»‹ç»</h2>
<p>é¢è¯•å®˜ä»‹ç»äº†å›¢é˜Ÿæƒ…å†µï¼š</p>
<ul>
<li>éš¶å±äºè…¾è®¯äº‘AIäº§å“ä¸­å¿ƒ</li>
<li>ä¸»è¦åšAIå¹³å°å’Œæœºå™¨å­¦ä¹ å¹³å°ç›¸å…³äº§å“</li>
<li>å…·ä½“å·¥ä½œåå‘åº•å±‚æ”¯æ’‘ï¼Œä¼˜åŒ–GPUã€CPUç®—åŠ›çš„ä½¿ç”¨æ•ˆç‡</li>
<li>è®©å¹³å°æ›´é«˜æ•ˆåœ°ä½¿ç”¨è®¡ç®—èµ„æº</li>
</ul>
<h2 id="é¢è¯•é—®é¢˜ä¸å›ç­”">é¢è¯•é—®é¢˜ä¸å›ç­”</h2>
<h3 id="é—®é¢˜1ï¼šé¡¹ç›®ä»‹ç»-Go-Cacheåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿ">é—®é¢˜1ï¼šé¡¹ç›®ä»‹ç» - Go Cacheåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿ</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œç®€å•ä»‹ç»ä¸€ä¸‹ä½ çš„åŸºç¡€æƒ…å†µå’Œé¡¹ç›®ï¼Œæˆ‘çœ‹ä½ ç®€å†ä¸Šæœ‰ä¸ªGo Cacheé¡¹ç›®ï¼Œè¯´ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„èƒŒæ™¯â€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œGo Cacheæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼ŒæŒ‚è½½åœ¨æœåŠ¡ç«¯å’Œæ•°æ®åº“ä¸­é—´ã€‚å¯ä»¥è®¾ç½®å„ç§æ•°æ®æºï¼Œé€šè¿‡ç¼“å­˜æœºåˆ¶å‡å°‘æ•°æ®åº“è®¿é—®ï¼Œæé«˜QPSã€‚é¡¹ç›®ä¸­ä½¿ç”¨äº†single flightæœºåˆ¶è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œå°†å¤šä¸ªç›¸åŒè¯·æ±‚åˆå¹¶æˆä¸€ä¸ªï¼Œå‡å°‘ç½‘ç»œIOæ¬¡æ•°ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>é¡¹ç›®ä»‹ç»å¯ä»¥æ›´ç³»ç»Ÿä¸€äº›ã€‚é¦–å…ˆè¯´æ˜é¡¹ç›®çš„å®šä½å’Œè§£å†³çš„é—®é¢˜ï¼šGo Cacheæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜ä¸­é—´ä»¶ï¼Œä¸»è¦è§£å†³é«˜å¹¶å‘åœºæ™¯ä¸‹æ•°æ®åº“å‹åŠ›è¿‡å¤§çš„é—®é¢˜ã€‚</p>
<p>ç„¶åä»‹ç»æ¶æ„è®¾è®¡ï¼šé‡‡ç”¨ä¸»ä»æ¶æ„ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å’Œåè°ƒï¼Œä»èŠ‚ç‚¹è´Ÿè´£æ•°æ®å­˜å‚¨å’Œæ•°æ®æºè®¿é—®ã€‚æ”¯æŒæ•°æ®åˆ†ç‰‡ï¼Œç±»ä¼¼Redisé›†ç¾¤ã€‚</p>
<p>æœ€åè¯´æ˜æ ¸å¿ƒä¼˜åŒ–ï¼šå®ç°äº†single flightæœºåˆ¶è§£å†³ç¼“å­˜å‡»ç©¿ï¼Œå½“å¤šä¸ªç›¸åŒè¯·æ±‚åŒæ—¶åˆ°è¾¾æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçœŸæ­£å‘èµ·æ•°æ®è·å–ï¼Œå…¶ä»–è¯·æ±‚ç­‰å¾…å¹¶å…±äº«ç»“æœã€‚</p>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>single flightçš„æ—¶é—´çª—å£å’Œå¤±è´¥å¤„ç†</li>
<li>ä¸»ä»èŠ‚ç‚¹çš„å…·ä½“èŒè´£åˆ’åˆ†</li>
<li>åˆ†å¸ƒå¼ä½“ç°åœ¨å“ªé‡Œ</li>
</ul>
<p><strong>æ€»ç»“åæ€</strong>ï¼š</p>
<ul>
<li>å¯¹é¡¹ç›®çš„æ ¸å¿ƒæœºåˆ¶ç†è§£æ¸…æ¥š</li>
<li>ä½†å¯¹æ•…éšœå¤„ç†åœºæ™¯è€ƒè™‘ä¸è¶³</li>
<li>åº”è¯¥å‡†å¤‡æ›´è¯¦ç»†çš„æ¶æ„å›¾å’Œå¼‚å¸¸å¤„ç†æ–¹æ¡ˆ</li>
</ul>
<h3 id="é—®é¢˜2ï¼šé¡¹ç›®ä»‹ç»-æŠ–éŸ³å•†åŸç³»ç»Ÿ">é—®é¢˜2ï¼šé¡¹ç›®ä»‹ç» - æŠ–éŸ³å•†åŸç³»ç»Ÿ</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå†ä»‹ç»ä¸€ä¸‹ä½ çš„æŠ–éŸ³å•†åŸé¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯ä»€ä¹ˆèƒŒæ™¯ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œè¿™æ˜¯å‚åŠ å­—èŠ‚è·³åŠ¨é’è®­è¥çš„é¡¹ç›®ï¼Œæ˜¯å®Œæ•´çš„å•†åŸç³»ç»Ÿã€‚å®ç°äº†æœåŠ¡å‘ç°ã€æœåŠ¡æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€åˆ†å¸ƒå¼ç¼“å­˜ã€åˆ†å¸ƒå¼é”ç­‰ã€‚ä½¿ç”¨Canalç›‘å¬MySQL binlogå®ç°æ•°æ®åŒæ­¥ï¼Œä¿è¯MySQLã€Redisã€ElasticSearchä¹‹é—´çš„å¼±ä¸€è‡´æ€§ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>å¯ä»¥ä»ç³»ç»Ÿè®¾è®¡è§’åº¦æ›´å¥½åœ°ä»‹ç»è¿™ä¸ªé¡¹ç›®ã€‚é¦–å…ˆè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¶æ„çš„ç”µå•†ç³»ç»Ÿï¼Œå®ç°äº†å®Œæ•´çš„å•†åŸæ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<p>æŠ€æœ¯æ¶æ„æ–¹é¢ï¼š</p>
<ol>
<li>å¾®æœåŠ¡æ²»ç†ï¼šæœåŠ¡å‘ç°ã€æ³¨å†Œã€é…ç½®ä¸­å¿ƒ</li>
<li>æ•°æ®å±‚ï¼šMySQLä¸»åº“ + Redisç¼“å­˜ + ElasticSearchæœç´¢</li>
<li>å¯è§‚æµ‹æ€§ï¼šé›†æˆOpenTelemetry</li>
<li>æ•°æ®ä¸€è‡´æ€§ï¼šCanal + æ¶ˆæ¯é˜Ÿåˆ—å®ç°æœ€ç»ˆä¸€è‡´æ€§</li>
</ol>
<p>æ ¸å¿ƒäº®ç‚¹æ˜¯æ•°æ®åŒæ­¥æ–¹æ¡ˆï¼šé€šè¿‡Canalç›‘å¬MySQL binlogï¼Œå°†æ•°æ®å˜æ›´å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…æ›´æ–°Rediså’ŒESï¼Œå®ç°äº†ä¸šåŠ¡ä»£ç è§£è€¦å’Œæ•°æ®æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆé€‰æ‹©ElasticSearchè€Œä¸æ˜¯MySQLåšæœç´¢</li>
<li>æ•°æ®ä¸€è‡´æ€§è¦æ±‚å’ŒCanalçš„ä½œç”¨</li>
</ul>
<h3 id="é—®é¢˜3ï¼šMySQLæ€§èƒ½ä¼˜åŒ–">é—®é¢˜3ï¼šMySQLæ€§èƒ½ä¼˜åŒ–</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¦‚æœMySQLæŸ¥è¯¢å¾ˆæ…¢ï¼Œæœ‰ä»€ä¹ˆåŠæ³•å®šä½å’Œä¼˜åŒ–ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œé¦–å…ˆç”¨explainè¯­å¥æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ï¼Œæ£€æŸ¥keyå­—æ®µã€‚ç„¶åçœ‹æŸ¥è¯¢è¯­å¥æ˜¯å¦æœ‰å¯¼è‡´ä¼˜åŒ–å™¨é€‰æ‹©å…¨è¡¨æ‰«æçš„é—®é¢˜ï¼Œæ¯”å¦‚ä½¿ç”¨äº†ORã€‚å¯èƒ½éœ€è¦å»ºç´¢å¼•ï¼Œä½†åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™å»ºç´¢å¼•ä¼šæ¯”è¾ƒè€—æ—¶ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>MySQLæŸ¥è¯¢ä¼˜åŒ–å¯ä»¥ä»å‡ ä¸ªå±‚é¢æ¥åˆ†æï¼š</p>
<ol>
<li>
<p><strong>SQLå±‚é¢</strong>ï¼šä½¿ç”¨EXPLAINåˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œé‡ç‚¹çœ‹typeã€keyã€rowsã€filteredå­—æ®µã€‚æ£€æŸ¥æ˜¯å¦èµ°ç´¢å¼•ï¼Œæ˜¯å¦æœ‰filesortã€temporaryç­‰</p>
</li>
<li>
<p><strong>ç´¢å¼•å±‚é¢</strong>ï¼šåˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ£€æŸ¥whereæ¡ä»¶ã€order byã€group byå­—æ®µæ˜¯å¦æœ‰é€‚å½“ç´¢å¼•ã€‚è€ƒè™‘è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™</p>
</li>
<li>
<p><strong>ç³»ç»Ÿå±‚é¢</strong>ï¼šæŸ¥çœ‹MySQLæœåŠ¡å™¨çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€é”ç­‰å¾…ã€IOçŠ¶å†µç­‰</p>
</li>
<li>
<p><strong>å…·ä½“ä¼˜åŒ–æ‰‹æ®µ</strong>ï¼š</p>
<ul>
<li>é‡å†™SQLï¼Œé¿å…å‡½æ•°ã€ORã€å‰ç¼€æ¨¡ç³ŠæŸ¥è¯¢</li>
<li>æ·»åŠ è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨</li>
<li>åˆ†åº“åˆ†è¡¨å¤„ç†å¤§æ•°æ®é‡</li>
<li>è¯»å†™åˆ†ç¦»åˆ†æ‹…å‹åŠ›</li>
</ul>
</li>
</ol>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>å¦‚ä½•è®¾è®¡ç´¢å¼•ï¼Œè€ƒè™‘å“ªäº›å› ç´ </li>
<li>è”åˆç´¢å¼•çš„ä½¿ç”¨åœºæ™¯</li>
</ul>
<h3 id="é—®é¢˜4ï¼šåˆ†å¸ƒå¼é”å®ç°">é—®é¢˜4ï¼šåˆ†å¸ƒå¼é”å®ç°</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¦‚æœç”¨MySQLå®ç°åˆ†å¸ƒå¼é”ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿç”¨Rediså‘¢ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>&quot;MySQLå®ç°åˆ†å¸ƒå¼é”æˆ‘è§‰å¾—ä¸å¤ªé€‚åˆï¼Œå› ä¸ºé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚ä½†è¦å®ç°çš„è¯ä¹Ÿå¯ä»¥ï¼Œæˆ‘æƒ³åˆ°æœ‰ä¸¤ç§æ–¹å¼ã€‚ç¬¬ä¸€ç§æ˜¯ç”¨äº‹åŠ¡ï¼Œè®©æ‰€æœ‰è¯·æ±‚éƒ½æ‰§è¡ŒåŒä¸€ä¸ªinsertè¯­å¥ã€‚å› ä¸ºinsertä¼šå¯¹æ•´ä¸ªè¡¨åŠ é”ï¼Œæˆ–è€…è¯´å¯¹IDçš„é—´éš™è¿›è¡ŒåŠ é”ï¼Œè¿™æ—¶å…¶ä»–è¯·æ±‚å°±ä¼šè¢«é˜»å¡ã€‚ç„¶ååœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥æ·»åŠ ä¸šåŠ¡ä»£ç ï¼Œæœ€åä¸šåŠ¡ä»£ç æ‰§è¡Œå®Œå†æäº¤äº‹åŠ¡ï¼Œè¿™æ ·å°±å®ç°äº†é”ã€‚ç¬¬äºŒç§æ˜¯é¿å…ç”¨insertï¼Œå¯ä»¥ä½¿ç”¨select xxx for updateè¿™ç§æ–¹å¼å®ç°åŠ é”ã€‚</p>
<p>Redisçš„è¯ç”¨SET NXå‘½ä»¤ï¼Œå› ä¸ºRediså•çº¿ç¨‹ä¿è¯åŸå­æ€§ã€‚éœ€è¦æ³¨æ„åˆ é™¤é”æ—¶çš„å®‰å…¨æ€§ï¼Œç”¨luaè„šæœ¬ä¿è¯åŸå­æ€§ã€‚&quot;</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p><strong>MySQLåˆ†å¸ƒå¼é”</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ–¹æ¡ˆ1ï¼šåŸºäºå”¯ä¸€ç´¢å¼•</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> lock_table (lock_key, owner, expire_time) <span class="keyword">VALUES</span> (<span class="string">&#x27;resource_id&#x27;</span>, <span class="string">&#x27;unique_id&#x27;</span>, NOW() <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">SECOND</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ2ï¼šåŸºäºè¡Œé”</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> lock_table <span class="keyword">WHERE</span> lock_key <span class="operator">=</span> <span class="string">&#x27;resource_id&#x27;</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>
<p>ä¼˜ç‚¹æ˜¯å¼ºä¸€è‡´æ€§ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½è¾ƒä½ï¼Œé€‚åˆå¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯ã€‚</p>
<p><strong>Redisåˆ†å¸ƒå¼é”</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŠ é”</span></span><br><span class="line">SET lock_key unique_value PX 30000 NX</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é”ï¼ˆluaè„šæœ¬ä¿è¯åŸå­æ€§ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>, KEYS[1]) == ARGV[1] <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">return</span> redis.call(<span class="string">&quot;del&quot;</span>, KEYS[1])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>ä¼˜ç‚¹æ˜¯æ€§èƒ½é«˜ï¼Œç¼ºç‚¹æ˜¯å¯èƒ½å­˜åœ¨é”ä¸¢å¤±çš„æç«¯æƒ…å†µã€‚</p>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>luaè„šæœ¬çš„é—®é¢˜å’Œæ›¿ä»£æ–¹æ¡ˆ</li>
<li>Rediså¤§keyé—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</li>
</ul>
<h3 id="é—®é¢˜5ï¼šRediså†…å­˜è¯„ä¼°å’Œç¼“å­˜ç­–ç•¥">é—®é¢˜5ï¼šRediså†…å­˜è¯„ä¼°å’Œç¼“å­˜ç­–ç•¥</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œå¦‚ä½•è¯„ä¼°Redisç¼“å­˜éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿæ¯”å¦‚1ä¸‡ä¸ªkeyï¼Œæ¯ä¸ªvalue 1KBï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œ1ä¸‡ä¸ªkeyï¼Œæ¯ä¸ª1KBï¼Œå¤§æ¦‚éœ€è¦å‡ åå…†å†…å­˜ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>Rediså†…å­˜è¯„ä¼°éœ€è¦è€ƒè™‘å¤šä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>æ•°æ®æœ¬èº«</strong>ï¼š1ä¸‡ Ã— 1KB = 10MB</li>
<li><strong>keyçš„å­˜å‚¨</strong>ï¼šå‡è®¾keyå¹³å‡20å­—èŠ‚ï¼Œ1ä¸‡ Ã— 20B = 200KB</li>
<li><strong>Redisæ•°æ®ç»“æ„å¼€é”€</strong>ï¼šæ¯ä¸ªkey-valueå¯¹å¤§çº¦æœ‰40-50å­—èŠ‚çš„å…ƒæ•°æ®å¼€é”€</li>
<li><strong>å†…å­˜ç¢ç‰‡</strong>ï¼šé€šå¸¸å ç”¨é¢å¤–10-20%ç©ºé—´</li>
<li><strong>æŒä¹…åŒ–å¼€é”€</strong>ï¼šRDB/AOFå¯èƒ½éœ€è¦é¢å¤–å†…å­˜</li>
</ol>
<p>æ‰€ä»¥å®é™…éœ€è¦å¤§çº¦ï¼š10MB + 0.2MB + 0.5MB + 2MB = 13-15MBå·¦å³ã€‚</p>
<p>å¯¹äºçƒ­ç‚¹æ•°æ®ç®¡ç†ï¼š</p>
<ul>
<li>å¯ä»¥é€šè¿‡ç»Ÿè®¡è®¿é—®é¢‘ç‡è¯†åˆ«çƒ­ç‚¹</li>
<li>ä½¿ç”¨LRUã€LFUç­‰æ·˜æ±°ç­–ç•¥</li>
<li>å®šæœŸåˆ·æ–°çƒ­ç‚¹æ•°æ®ï¼Œé¿å…ä¸šåŠ¡é«˜å³°æœŸå›æº</li>
</ul>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>çƒ­ç‚¹æ•°æ®å˜åŒ–æ—¶çš„å¤„ç†ç­–ç•¥</li>
</ul>
<h3 id="é—®é¢˜6ï¼šRediså•çº¿ç¨‹æ¨¡å‹">é—®é¢˜6ï¼šRediså•çº¿ç¨‹æ¨¡å‹</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œRedisè¯´æ˜¯å•çº¿ç¨‹ï¼Œå®ƒæ˜¯æ€ä¹ˆæ”¯æŒé«˜å¹¶å‘çš„ï¼Ÿåœ¨å¤šæ ¸ç³»ç»Ÿä¸Šæ€ä¹ˆåˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿ï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œRedisçš„å•çº¿ç¨‹æ˜¯æŒ‡å‘½ä»¤æ‰§è¡Œæ˜¯å•çº¿ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å¤šçº¿ç¨‹çš„ã€‚å•çº¿ç¨‹é¿å…äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œè€Œä¸”æ“ä½œçš„æ˜¯å†…å­˜é€Ÿåº¦å¾ˆå¿«ã€‚å¤šæ ¸ç³»ç»Ÿå¯ä»¥å¼€å¤šä¸ªRediså®ä¾‹åœ¨ä¸åŒç«¯å£ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>Redisçš„å•çº¿ç¨‹æŒ‡çš„æ˜¯<strong>å‘½ä»¤å¤„ç†</strong>æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ•´ä¸ªç³»ç»Ÿæ˜¯å¤šçº¿ç¨‹çš„ï¼š</p>
<ol>
<li><strong>ä¸»çº¿ç¨‹</strong>ï¼šå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ‰§è¡Œå‘½ä»¤</li>
<li><strong>åå°çº¿ç¨‹</strong>ï¼šå¤„ç†æŒä¹…åŒ–ã€å†…å­˜å›æ”¶ã€é›†ç¾¤æ•°æ®åŒæ­¥ç­‰</li>
</ol>
<p>å•çº¿ç¨‹çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>é¿å…çº¿ç¨‹åˆ‡æ¢å¼€é”€</li>
<li>é¿å…é”ç«äº‰</li>
<li>ç®€åŒ–å†…å­˜æ¨¡å‹</li>
<li>åŸºäºå†…å­˜æ“ä½œï¼ŒCPUä¸æ˜¯ç“¶é¢ˆ</li>
</ul>
<p>é«˜å¹¶å‘æ”¯æŒï¼š</p>
<ul>
<li>åŸºäºIOå¤šè·¯å¤ç”¨ï¼ˆepoll/kqueueï¼‰</li>
<li>éé˜»å¡IOï¼Œå•çº¿ç¨‹å¤„ç†å¤šä¸ªè¿æ¥</li>
<li>å†…å­˜æ“ä½œé€Ÿåº¦æå¿«</li>
</ul>
<p>å¤šæ ¸åˆ©ç”¨ï¼š</p>
<ul>
<li>å•å®ä¾‹ä¸»è¦å—å†…å­˜å’Œç½‘ç»œIOé™åˆ¶</li>
<li>å¯ä»¥éƒ¨ç½²å¤šå®ä¾‹åˆ©ç”¨å¤šæ ¸</li>
<li>Redis 6.0å¼•å…¥å¤šçº¿ç¨‹å¤„ç†ç½‘ç»œIO</li>
</ul>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>ä¸»è¦æ€§èƒ½ç“¶é¢ˆåœ¨å“ªé‡Œ</li>
<li>Rediså†…éƒ¨è¯·æ±‚å¤„ç†æµç¨‹</li>
</ul>
<h3 id="é—®é¢˜7ï¼šç½‘ç»œåè®®å’ŒHTTPS">é—®é¢˜7ï¼šç½‘ç»œåè®®å’ŒHTTPS</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œä½ äº†è§£HTTP/2å—ï¼ŸHTTPSçš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœè¦æ‹¦æˆªHTTPSè¯·æ±‚åº”è¯¥æ€ä¹ˆåšï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œHTTP/2å¥½åƒæ˜¯åœ¨é•¿è¿æ¥æ–¹é¢åšäº†ä¼˜åŒ–ã€‚HTTPSæ˜¯åœ¨HTTPåŸºç¡€ä¸ŠåŠ äº†å¯†é’¥äº¤æ¢å’ŒåŠ å¯†ã€‚æ‹¦æˆªéœ€è¦æœ‰å®¢æˆ·ç«¯ä¿¡ä»»çš„CAè¯ä¹¦ã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p><strong>HTTPSæœºåˆ¶</strong>ï¼š</p>
<ol>
<li><strong>è¯ä¹¦éªŒè¯</strong>ï¼šå®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦åˆæ³•æ€§</li>
<li><strong>å¯†é’¥åå•†</strong>ï¼šé€šè¿‡RSAæˆ–ECDHEç­‰ç®—æ³•åå•†å¯¹ç§°å¯†é’¥</li>
<li><strong>æ•°æ®åŠ å¯†</strong>ï¼šä½¿ç”¨åå•†çš„å¯¹ç§°å¯†é’¥åŠ å¯†ä¼ è¾“æ•°æ®</li>
</ol>
<p><strong>HTTPSä¸­é—´äººæ‹¦æˆª</strong>ï¼š<br>
éœ€è¦ä½œä¸ºä¸­é—´ä»£ç†ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯ä¿¡ä»»ä»£ç†çš„æ ¹è¯ä¹¦</li>
<li>ä»£ç†ä¸ºç›®æ ‡åŸŸååŠ¨æ€ç”Ÿæˆè¯ä¹¦</li>
<li>ä¸å®¢æˆ·ç«¯å»ºç«‹HTTPSè¿æ¥ï¼ˆä½¿ç”¨ä»£ç†è¯ä¹¦ï¼‰</li>
<li>ä¸æœåŠ¡å™¨å»ºç«‹HTTPSè¿æ¥ï¼ˆéªŒè¯çœŸå®è¯ä¹¦ï¼‰</li>
<li>è§£å¯†å®¢æˆ·ç«¯æ•°æ®ï¼Œå¤„ç†åè½¬å‘ç»™æœåŠ¡å™¨</li>
</ol>
<p>è¿™ç§æ–¹æ¡ˆå¸¸ç”¨äºä¼ä¸šç½‘å…³ã€å®‰å…¨å®¡è®¡ç­‰åœºæ™¯ã€‚</p>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>ç½‘ç»œåŒ…ä¼ è¾“çš„å®Œæ•´æµç¨‹</li>
<li>ä»åº”ç”¨å±‚åˆ°ç‰©ç†å±‚çš„å¤„ç†è¿‡ç¨‹</li>
</ul>
<h3 id="é—®é¢˜8ï¼šGoè¯­è¨€åç¨‹å’Œè°ƒåº¦">é—®é¢˜8ï¼šGoè¯­è¨€åç¨‹å’Œè°ƒåº¦</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œGoè¯­è¨€çš„åç¨‹å’Œçº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåç¨‹ä»€ä¹ˆæ—¶å€™ä¼šè®©å‡ºCPUï¼Ÿâ€</p>
</blockquote>
<p><strong>æˆ‘çš„å›ç­”</strong>ï¼š</p>
<blockquote>
<p>â€œåç¨‹æ¯”çº¿ç¨‹è½»é‡ï¼Œä¸éœ€è¦å’Œå†…æ ¸æ€äº¤äº’ã€‚è¿›ç¨‹æ˜¯èµ„æºåˆ†é…å•ä½ï¼Œçº¿ç¨‹æ˜¯è°ƒåº¦å•ä½ï¼Œåç¨‹åœ¨çº¿ç¨‹ä¹‹ä¸Šã€‚åç¨‹è¶…è¿‡10æ¯«ç§’ä¼šè¢«å¼ºåˆ¶è°ƒåº¦ï¼Œæˆ–è€…é˜»å¡æ—¶ä¸»åŠ¨è®©å‡ºã€‚â€</p>
</blockquote>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p><strong>åç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</strong>ï¼š</p>
<ol>
<li>
<p><strong>åˆ›å»ºå¼€é”€</strong>ï¼š</p>
<ul>
<li>çº¿ç¨‹ï¼šéœ€è¦å†…æ ¸æ€æ“ä½œï¼Œæ ˆç©ºé—´é»˜è®¤8MB</li>
<li>åç¨‹ï¼šç”¨æˆ·æ€åˆ›å»ºï¼Œåˆå§‹æ ˆ2KBï¼ŒåŠ¨æ€å¢é•¿</li>
</ul>
</li>
<li>
<p><strong>è°ƒåº¦æ–¹å¼</strong>ï¼š</p>
<ul>
<li>çº¿ç¨‹ï¼šæŠ¢å å¼è°ƒåº¦ï¼Œå†…æ ¸æ§åˆ¶</li>
<li>åç¨‹ï¼šåä½œå¼è°ƒåº¦ï¼Œç”¨æˆ·æ€æ§åˆ¶</li>
</ul>
</li>
<li>
<p><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼š</p>
<ul>
<li>çº¿ç¨‹ï¼šæ¶‰åŠå†…æ ¸æ€åˆ‡æ¢ï¼Œä¿å­˜å®Œæ•´å¯„å­˜å™¨çŠ¶æ€</li>
<li>åç¨‹ï¼šåªéœ€ä¿å­˜å°‘é‡å¯„å­˜å™¨ï¼Œå¼€é”€å¾ˆå°</li>
</ul>
</li>
</ol>
<p><strong>åç¨‹è®©å‡ºCPUçš„æ—¶æœº</strong>ï¼š</p>
<ol>
<li><strong>ä¸»åŠ¨è®©å‡º</strong>ï¼šè°ƒç”¨runtime.Gosched()ã€channelæ“ä½œé˜»å¡ã€mutexè·å–å¤±è´¥</li>
<li><strong>è¢«åŠ¨æŠ¢å </strong>ï¼šè¿è¡Œæ—¶é—´è¿‡é•¿ï¼ˆ10msï¼‰ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶æ£€æŸ¥</li>
<li><strong>ç³»ç»Ÿè°ƒç”¨</strong>ï¼šè¿›å…¥ç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒMä¼šä¸Påˆ†ç¦»</li>
</ol>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>çº¿ç¨‹åˆ‡æ¢çš„å…·ä½“å¼€é”€</li>
<li>forå¾ªç¯ä¼šä¸ä¼šä¸€ç›´å ç”¨CPU</li>
</ul>
<h3 id="é—®é¢˜9ï¼šç¼–ç¨‹é¢˜-å¹¶å‘å®‰å…¨çš„Map">é—®é¢˜9ï¼šç¼–ç¨‹é¢˜ - å¹¶å‘å®‰å…¨çš„Map</h3>
<p><strong>é¢è¯•å®˜é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p>â€œç”¨Goè¯­è¨€å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„mapï¼ŒåŒ…å«putã€getã€deleteæ–¹æ³•â€</p>
</blockquote>
<p><strong>æˆ‘çš„å®ç°</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> SafeMap <span class="keyword">struct</span> &#123;</span><br><span class="line">    mu   sync.RWMutex</span><br><span class="line">    data <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *SafeMap)</span></span> Put(key <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">    m.mu.Lock()</span><br><span class="line">    <span class="keyword">defer</span> m.mu.Unlock()</span><br><span class="line">    m.data[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *SafeMap)</span></span> Get(key <span class="type">string</span>) (<span class="keyword">interface</span>&#123;&#125;, <span class="type">bool</span>) &#123;</span><br><span class="line">    m.mu.RLock()</span><br><span class="line">    <span class="keyword">defer</span> m.mu.RUnlock()</span><br><span class="line">    value, ok := m.data[key]</span><br><span class="line">    <span class="keyword">return</span> value, ok</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *SafeMap)</span></span> Delete(key <span class="type">string</span>) &#123;</span><br><span class="line">    m.mu.Lock()</span><br><span class="line">    <span class="keyword">defer</span> m.mu.Unlock()</span><br><span class="line">    <span class="built_in">delete</span>(m.data, key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é¢è¯•å®˜è¿½é—®</strong>ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨è¯»å†™é”ï¼Ÿ</li>
<li>è¿˜èƒ½æ€ä¹ˆä¼˜åŒ–ï¼Ÿ</li>
</ul>
<p><strong>æ ‡å‡†/å»ºè®®å›ç­”</strong>ï¼š</p>
<p>è¯»å†™é”çš„ä¼˜åŠ¿ï¼šåœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹ï¼Œå¤šä¸ªgoroutineå¯ä»¥åŒæ—¶è·å–è¯»é”ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚</p>
<p>è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<ol>
<li><strong>åˆ†æ®µé”</strong>ï¼šå°†mapåˆ†æˆå¤šä¸ªsegmentï¼Œæ¯ä¸ªsegmentç‹¬ç«‹åŠ é”ï¼Œå‡å°‘é”ç«äº‰</li>
<li><strong>æ— é”å®ç°</strong>ï¼šä½¿ç”¨atomicåŒ…å’ŒCASæ“ä½œ</li>
<li><strong>ä½¿ç”¨sync.Map</strong>ï¼šGoæ ‡å‡†åº“æä¾›çš„å¹¶å‘å®‰å…¨map</li>
</ol>
<p>åˆ†æ®µé”å®ç°æ€è·¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> SegmentedMap <span class="keyword">struct</span> &#123;</span><br><span class="line">    segments []segment</span><br><span class="line">    mask     <span class="type">uint32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> segment <span class="keyword">struct</span> &#123;</span><br><span class="line">    mu   sync.RWMutex</span><br><span class="line">    data <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é¢è¯•æ•´ä½“æ„Ÿå—">é¢è¯•æ•´ä½“æ„Ÿå—</h2>
<ul>
<li><strong>éš¾åº¦è¯„ä»·</strong>: é€‚ä¸­ï¼Œä¸»è¦è€ƒæŸ¥åŸºç¡€æ‰å®ç¨‹åº¦å’Œé¡¹ç›®ç»éªŒ</li>
<li><strong>é¢è¯•å®˜é£æ ¼</strong>: ä¸“ä¸šå‹å–„ï¼Œä¼šæ·±å…¥è¿½é—®ç»†èŠ‚</li>
<li><strong>é¢˜ç›®ç±»å‹</strong>: é¡¹ç›®ç»éªŒã€åŸºç¡€çŸ¥è¯†ã€ç¼–ç¨‹èƒ½åŠ›å¹¶é‡</li>
<li><strong>å‡†å¤‡å»ºè®®</strong>: é‡ç‚¹å‡†å¤‡é¡¹ç›®ç»†èŠ‚ã€å¸¸è§ä¸­é—´ä»¶åŸç†ã€Goè¯­è¨€ç‰¹æ€§</li>
</ul>
<h2 id="é¢è¯•ç»“æœ">é¢è¯•ç»“æœ</h2>
<ul>
<li><strong>å½“åœºåé¦ˆ</strong>: é¢è¯•å®˜æ²¡æœ‰ç»™å‡ºæ˜ç¡®åé¦ˆ</li>
<li><strong>åç»­æµç¨‹</strong>: éœ€è¦ç­‰å¾…HRé€šçŸ¥åç»­å®‰æ’</li>
<li><strong>ä¸ªäººæ„Ÿå—</strong>: éƒ¨åˆ†é—®é¢˜å›ç­”ä¸å¤Ÿæ·±å…¥ï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œåè®®å’Œç³»ç»Ÿåº•å±‚éƒ¨åˆ†</li>
</ul>
<h2 id="ç»éªŒæ€»ç»“">ç»éªŒæ€»ç»“</h2>
<h3 id="åšå¾—å¥½çš„åœ°æ–¹">åšå¾—å¥½çš„åœ°æ–¹</h3>
<ul>
<li>é¡¹ç›®ä»‹ç»æ¯”è¾ƒæ¸…æ™°ï¼Œsingle flightç­‰æ ¸å¿ƒæŠ€æœ¯ç‚¹è¡¨è¾¾å‡†ç¡®</li>
<li>Redisã€MySQLåŸºç¡€çŸ¥è¯†æŒæ¡è¾ƒå¥½</li>
<li>ç¼–ç¨‹é¢˜å®ç°æ€è·¯æ­£ç¡®</li>
</ul>
<h3 id="éœ€è¦æ”¹è¿›çš„åœ°æ–¹">éœ€è¦æ”¹è¿›çš„åœ°æ–¹</h3>
<ul>
<li>å¯¹æ•…éšœåœºæ™¯å’Œè¾¹ç•Œæƒ…å†µè€ƒè™‘ä¸è¶³</li>
<li>ç½‘ç»œåè®®åº•å±‚åŸç†æŒæ¡ä¸å¤Ÿæ·±å…¥</li>
<li>ç³»ç»Ÿè®¾è®¡çš„å…¨å±€æ€ç»´éœ€è¦åŠ å¼º</li>
</ul>
<h3 id="å‡†å¤‡å»ºè®®">å‡†å¤‡å»ºè®®</h3>
<ol>
<li><strong>é¡¹ç›®ç»éªŒ</strong>ï¼šå‡†å¤‡è¯¦ç»†çš„æ¶æ„å›¾ï¼Œè€ƒè™‘å„ç§å¼‚å¸¸åœºæ™¯çš„å¤„ç†</li>
<li><strong>åŸºç¡€çŸ¥è¯†</strong>ï¼šæ·±å…¥ç†è§£å¸¸ç”¨ä¸­é—´ä»¶çš„åº•å±‚åŸç†å’Œæºç </li>
<li><strong>ç³»ç»Ÿè®¾è®¡</strong>ï¼šå¤šç»ƒä¹ åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ï¼Œè€ƒè™‘æ€§èƒ½ã€ä¸€è‡´æ€§ã€å¯ç”¨æ€§æƒè¡¡</li>
<li><strong>ç¼–ç¨‹èƒ½åŠ›</strong>ï¼šç†Ÿç»ƒæŒæ¡å¸¸è§æ•°æ®ç»“æ„å’Œç®—æ³•çš„å¹¶å‘å®‰å…¨å®ç°</li>
</ol>
<h3 id="çŸ¥è¯†ç‚¹å¤ä¹ ">çŸ¥è¯†ç‚¹å¤ä¹ </h3>
<ul>
<li>åˆ†å¸ƒå¼ç¼“å­˜è®¾è®¡åŸç†</li>
<li>MySQLç´¢å¼•ä¼˜åŒ–å’ŒæŸ¥è¯¢åˆ†æ</li>
<li>Rediså†…å­˜ç®¡ç†å’ŒæŒä¹…åŒ–æœºåˆ¶</li>
<li>HTTPS/TLSåè®®è¯¦è§£</li>
<li>Goè¯­è¨€GMPè°ƒåº¦æ¨¡å‹</li>
<li>åˆ†å¸ƒå¼é”çš„å®ç°å’Œå¯¹æ¯”</li>
<li>ç½‘ç»œåè®®æ ˆå’Œæ•°æ®åŒ…ä¼ è¾“æµç¨‹</li>
</ul>
]]></content>
      <categories>
        <category>é¢è¯•ç»éªŒ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>è…¾è®¯</tag>
        <tag>äºŒé¢</tag>
        <tag>è…¾è®¯äº‘</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤æ‚é“¾è·¯ä¸‹çš„åç«¯åœºæ™¯AI Codingå®è·µ+æ€è·¯</title>
    <url>/2025/06/20/AI/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%B7%AF%E4%B8%8B%E7%9A%84%E5%90%8E%E7%AB%AF%E5%9C%BA%E6%99%AFAI%20Coding%E5%AE%9E%E8%B7%B5+%E6%80%9D%E8%B7%AF/</url>
    <content><![CDATA[<h1>å¤æ‚é“¾è·¯ä¸‹çš„åç«¯åœºæ™¯AI Codingå®è·µ+æ€è·¯</h1>
<p>åœ¨æ—¥å¸¸åç«¯å¼€å‘ä¸­ï¼Œæˆ‘ç»å¸¸é¢å¯¹è¿™æ ·çš„åœºæ™¯ï¼š</p>
<ul>
<li>è¦å¼€å‘ä¸€ä¸ªè·¨å¤šä¸ªæœåŠ¡çš„æ–°åŠŸèƒ½ï¼Œéœ€è¦äº†è§£ä¸Šæ¸¸çš„è°ƒç”¨å…¥å£ã€ä¸‹æ¸¸çš„æ•°æ®æ¥æºï¼Œä»¥åŠä¸­é—´å„ä¸ªç¯èŠ‚çš„å¤„ç†é€»è¾‘</li>
<li>çº¿ä¸Šå‡ºç°é—®é¢˜éœ€è¦æ’æŸ¥ï¼Œå¾—ä»ä¸€ä¸ªæ¥å£å¼€å§‹ï¼Œé€çº§è¿½è¸ªåˆ°æ•°æ®åº“æ“ä½œï¼Œç”šè‡³ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨</li>
<li>æ¥æ‰‹ä¸€ä¸ªé™Œç”Ÿçš„æ¨¡å—ï¼Œæƒ³å¿«é€Ÿç†è§£å…¶è®¾è®¡æ€è·¯å’Œå®ç°ç»†èŠ‚</li>
</ul>
<p>è¿™äº›å¤æ‚é“¾è·¯çš„åˆ†æå·¥ä½œï¼Œä¼ ç»Ÿæ–¹å¼ä¸‹å¾€å¾€éœ€è¦ï¼š</p>
<ol>
<li>æ‰‹åŠ¨æœç´¢ä»£ç åº“ï¼Œå®šä½ç›¸å…³æ–‡ä»¶</li>
<li>ç¿»é˜… PRD å’ŒæŠ€æœ¯æ–‡æ¡£ï¼Œç†è§£ä¸šåŠ¡é€»è¾‘</li>
<li>æ¢³ç†è°ƒç”¨å…³ç³»ï¼Œç”»å‡ºé“¾è·¯å›¾</li>
<li>åˆ†æä¾èµ–å…³ç³»ï¼Œè¯†åˆ«æ½œåœ¨é£é™©</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹è€—æ—¶è€—åŠ›ï¼Œè€Œä¸”å¾ˆå®¹æ˜“é—æ¼å…³é”®ä¿¡æ¯ã€‚å½“æˆ‘å°è¯•è®© AI å¸®å¿™æ—¶ï¼Œåˆé‡åˆ°äº†æ–°é—®é¢˜ï¼š</p>
<ul>
<li>è¯»äº† 50 ä¸ªæ–‡ä»¶åï¼Œä¸Šä¸‹æ–‡ç›´æ¥çˆ†äº†ï¼Œåé¢çš„å¯¹è¯å…¨ä¹±å¥—</li>
<li>æ¯æ¬¡åˆ†ææ¨¡å—éƒ½è¦å¤åˆ¶ç²˜è´´åŒä¸€æ®µ Promptï¼Œæ”¹ä¸ªæ¨¡å—åå†å‘ä¸€éï¼Œé‡å¤åŠ³åŠ¨è®©äººå´©æºƒ</li>
<li>å¤æ‚é“¾è·¯æ¶‰åŠå¤šä¸ªæœåŠ¡ï¼ŒAI æ— æ³•å¿«é€Ÿè·å–è·¨æœåŠ¡çš„æ¥å£ä¿¡æ¯</li>
</ul>
<p>è¿™äº›é—®é¢˜çš„æœ¬è´¨æ˜¯<strong>æ²¡æœ‰é€‰å¯¹å·¥å…·</strong>ï¼Œä¹Ÿæ²¡æœ‰å»ºç«‹ä¸€å¥—æœ‰æ•ˆçš„å·¥ä½œæµç¨‹ã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä¼šå…ˆä»‹ç» Slash Commandã€SubAgentã€Skill ä¸‰ç§å·¥å…·çš„é€‰æ‹©æ€è·¯å’Œå®è·µæ–¹æ³•ï¼Œç„¶ååœ¨æœ€åç»™å‡ºé’ˆå¯¹å¤æ‚é“¾è·¯çš„å…·ä½“å®è·µç»éªŒå’Œæ ¸å¿ƒå·¥å…·ï¼Œå¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°åº”å¯¹åç«¯å¼€å‘ä¸­çš„å¤æ‚åœºæ™¯ã€‚</p>
</blockquote>
<blockquote>
<p>ä¹‹å‰åšè¿‡ä¸€æœŸåˆ†äº«ï¼Œä»‹ç»äº† Skills å’Œ SubAgents çš„æ¦‚å¿µã€åŒºåˆ«ä¸åº”ç”¨åœºæ™¯ã€‚ï¼ˆå‚è€ƒï¼š<a href="https://bytetech.info/articles/7597275570697486374#Q33FdNfo2oc1TaxwAuxcPyZ1njg">Claude Code æ’ä»¶å®è·µï¼šåŸºäº Skills ä¸ SubAgents çš„åŒå±‚æ¶æ„è®¾è®¡</a>ï¼‰</p>
<p>ä½†éšç€ AI å·¥å…·çš„å¿«é€Ÿè¿­ä»£ï¼Œå¾ˆå¤šæ¦‚å¿µçš„è¾¹ç•Œå˜å¾—è¶Šæ¥è¶Šæ¨¡ç³Šã€‚æ¯”å¦‚ Skills ç°åœ¨æ”¯æŒæ‰‹åŠ¨è°ƒç”¨ï¼ˆå’Œ Slash Command å¾ˆåƒï¼‰ï¼Œä¹Ÿæ”¯æŒ <code>context:fork</code>ï¼ˆå‡ ä¹å¯ä»¥å½“ SubAgent ç”¨äº†ï¼‰ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸å…¶çº ç»“å®šä¹‰ï¼Œä¸å¦‚ä»<strong>åœºæ™¯</strong>å‡ºå‘â€”â€”ææ¸…æ¥š&quot;ä»€ä¹ˆåœºæ™¯ç”¨ä»€ä¹ˆå·¥å…·&quot;ï¼Œæ¯”èƒŒæ¦‚å¿µæœ‰ç”¨å¾—å¤šã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¼šé€šè¿‡ä¸‰ä¸ªçœŸå®åœºæ™¯ï¼Œä»‹ç» Slash Commandã€SubAgentã€Skill çš„é€‰æ‹©æ€è·¯å’Œå®è·µæ–¹æ³•ã€‚æ–‡ä¸­ä»¥ Trae ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºï¼ˆéƒ¨åˆ†åŠŸèƒ½åœ¨ç°åº¦ä¸­ï¼‰ï¼Œä½†æ€è·¯é€‚ç”¨äºæ‰€æœ‰ç±»ä¼¼çš„ AI Coding å·¥å…·ã€‚</p>
</blockquote>
<hr>
<h2 id="ä¸€ã€ä¸‰ç§å·¥å…·é€Ÿè§ˆ">ä¸€ã€ä¸‰ç§å·¥å…·é€Ÿè§ˆ</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆå¿«é€Ÿè¿‡ä¸€ä¸‹è¿™ä¸‰ä¸ªæ¦‚å¿µï¼š</p>
<table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>ä¸€å¥è¯è§£é‡Š</th>
<th>æ ¸å¿ƒä»·å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Slash Command</strong></td>
<td>æŠŠå¸¸ç”¨ Prompt åšæˆå‘½ä»¤ï¼Œç”¨ <code>/å‘½ä»¤å</code> å¿«é€Ÿè°ƒç”¨</td>
<td>çœæ—¶é—´ã€ä¿è¯ä¸€è‡´æ€§</td>
</tr>
<tr>
<td><strong>SubAgent</strong></td>
<td>ç‹¬ç«‹ä¸Šä¸‹æ–‡çš„&quot;ä¸“å®¶&quot;ï¼Œå¤„ç†å®Œä»»åŠ¡åªè¿”å›ç»“æœ</td>
<td>ä¸Šä¸‹æ–‡éš”ç¦»ã€ç»“æœæç‚¼</td>
</tr>
<tr>
<td><strong>Skill</strong></td>
<td>çŸ¥è¯†åŒ… + å·¥ä½œæµå®šä¹‰ï¼Œè‡ªåŠ¨æ³¨å…¥æ–‡æ¡£å’Œæµç¨‹</td>
<td>æµç¨‹æ ‡å‡†åŒ–ã€çŸ¥è¯†è‡ªåŠ¨åŠ è½½</td>
</tr>
</tbody>
</table>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šé€šè¿‡ä¸‰ä¸ªåœºæ™¯æ¥è¯´æ˜ä»€ä¹ˆæ—¶å€™è¯¥ç”¨å“ªä¸ªã€‚</p>
<hr>
<h2 id="äºŒã€åœºæ™¯-1ï¼šé«˜é¢‘é‡å¤çš„-Prompt-â†’-ç”¨-Slash-Command">äºŒã€åœºæ™¯ 1ï¼šé«˜é¢‘é‡å¤çš„ Prompt â†’ ç”¨ Slash Command</h2>
<h3 id="ç—›ç‚¹">ç—›ç‚¹</h3>
<p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ç»å¸¸éœ€è¦è®© AI å¸®æˆ‘åˆ†ææŸä¸ªæ¨¡å—çš„å®ç°ã€‚æ¯æ¬¡éƒ½è¦å‘è¿™æ ·ä¸€æ®µ Promptï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">è¯·å¸®æˆ‘åˆ†æ å®šæ—¶å™¨ æ¨¡å—çš„å®ç°ï¼š</span><br><span class="line"></span><br><span class="line">1. å…ˆè¯»å–è¯¥æ¨¡å—çš„ä¸»è¦æ–‡ä»¶</span><br><span class="line">2. æ¢³ç†å‡ºæ ¸å¿ƒçš„å‡½æ•°å’Œç±»</span><br><span class="line">3. ç”»å‡ºè°ƒç”¨é“¾è·¯å›¾ï¼ˆç”¨ mermaid æ ¼å¼ï¼‰</span><br><span class="line">4. åˆ—å‡ºè¯¥æ¨¡å—ä¾èµ–çš„å…¶ä»–æ¨¡å—</span><br><span class="line">5. ç”¨è¡¨æ ¼æ€»ç»“å…³é”®å‡½æ•°çš„ä½œç”¨</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šåªä½¿ç”¨è¯»å–æ–‡ä»¶çš„èƒ½åŠ›ï¼Œä¸è¦ä¿®æ”¹ä»»ä½•ä»£ç ã€‚</span><br></pre></td></tr></table></figure>
<p>ä¸‹æ¬¡æƒ³åˆ†æã€Œä»»åŠ¡ã€æ¨¡å—ï¼Ÿå†å¤åˆ¶ä¸€éï¼ŒæŠŠã€Œå®šæ—¶å™¨ã€æ”¹æˆã€Œä»»åŠ¡ã€â€¦â€¦</p>
<p>è¿™ç§é‡å¤åŠ³åŠ¨å¤ªä½æ•ˆäº†ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆï¼šSlash-Command">è§£å†³æ–¹æ¡ˆï¼šSlash Command</h3>
<p>æŠŠè¿™æ®µ Prompt åšæˆä¸€ä¸ªæ¨¡æ¿ï¼Œç”¨ <code>$1</code> ä½œä¸ºå ä½ç¬¦ï¼Œç„¶åé€šè¿‡ <code>/å‘½ä»¤å å‚æ•°</code> çš„æ–¹å¼å¿«é€Ÿè°ƒç”¨ã€‚</p>
<p>åœ¨ <code>.trae/commands/explain.md</code> ä¸­å†™å…¥ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="section">description: è§£é‡ŠæŸä¸ªåŠŸèƒ½æ¨¡å—çš„è°ƒç”¨é“¾è·¯</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line"><span class="section">## æ¨¡å—åˆ†æä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line">è¯·å¸®æˆ‘åˆ†æ <span class="strong">**$1**</span> æ¨¡å—çš„å®ç°ï¼š</span><br><span class="line"></span><br><span class="line"><span class="section">### è¾“å‡ºè¦æ±‚</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> å…ˆè¯»å–è¯¥æ¨¡å—çš„ä¸»è¦æ–‡ä»¶</span><br><span class="line"><span class="bullet">2.</span> æ¢³ç†å‡ºæ ¸å¿ƒçš„å‡½æ•°å’Œç±»</span><br><span class="line"></span><br><span class="line"><span class="section">### è°ƒç”¨é“¾è·¯å›¾</span></span><br><span class="line"></span><br><span class="line">ç”¨ mermaid æ ¼å¼ç”»å‡ºè°ƒç”¨å…³ç³»,å­˜æ”¾åˆ° <span class="strong">**$1.md**</span> ä¸­ï¼š</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">pre</span> <span class="attr">class</span>=<span class="string">&quot;mermaid&quot;</span>&gt;</span></span>graph TD</span><br><span class="line"><span class="code">    A[å…¥å£å‡½æ•°] --&amp;gt; B[å­å‡½æ•°]&lt;/pre&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section">### ä¾èµ–åˆ†æ</span></span><br><span class="line"></span><br><span class="line">åˆ—å‡ºè¯¥æ¨¡å—ä¾èµ–çš„å…¶ä»–æ¨¡å—</span><br><span class="line"></span><br><span class="line"><span class="section">### å‡½æ•°æ€»ç»“</span></span><br><span class="line"></span><br><span class="line">| å‡½æ•°å | ä½œç”¨ | å‚æ•° | è¿”å›å€¼ |</span><br><span class="line">|--------|------|------|--------|</span><br><span class="line">| ... | ... | ... | ... |</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šåªè¯»å–æ–‡ä»¶ï¼Œä¸è¦ä¿®æ”¹ä»»ä½•ä»£ç ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨æ•ˆæœ">ä½¿ç”¨æ•ˆæœ</h3>
<p>åœ¨ Trae ä¸­è¾“å…¥ <code>/</code> å°±èƒ½çœ‹åˆ°è¿™ä¸ªå‘½ä»¤ï¼š</p>
<p><img src="/2025/06/20/AI/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%B7%AF%E4%B8%8B%E7%9A%84%E5%90%8E%E7%AB%AF%E5%9C%BA%E6%99%AFAI%20Coding%E5%AE%9E%E8%B7%B5+%E6%80%9D%E8%B7%AF/image.png" alt="Slash Command åˆ—è¡¨"></p>
<p>ç„¶ååªéœ€è¦è¾“å…¥ <code>/explain æ¨¡å—å</code> å°±èƒ½å¿«é€Ÿè§¦å‘ï¼š</p>
<p><img src="/2025/06/20/AI/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%B7%AF%E4%B8%8B%E7%9A%84%E5%90%8E%E7%AB%AF%E5%9C%BA%E6%99%AFAI%20Coding%E5%AE%9E%E8%B7%B5+%E6%80%9D%E8%B7%AF/image%201.png" alt="ä½¿ç”¨ Slash Command"></p>
<p>æ¨¡æ¿ä¸­çš„ <code>$1</code> ä¼šè¢«æ›¿æ¢ä¸ºä½ è¾“å…¥çš„æ¨¡å—åï¼ŒAI æœ€ç»ˆæ”¶åˆ°çš„ Prompt å°±æ˜¯å®Œæ•´çš„åˆ†ææŒ‡ä»¤ã€‚</p>
<h3 id="å°ç»“">å°ç»“</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè¾“å…¥æ ¼å¼å›ºå®šã€è¾“å‡ºæ ¼å¼å›ºå®šã€é«˜é¢‘ä½¿ç”¨çš„ Promptã€‚</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šçœå»å¤åˆ¶ç²˜è´´çš„æ—¶é—´ï¼Œä¿è¯æ¯æ¬¡è¾“å‡ºçš„ä¸€è‡´æ€§ã€‚</p>
<hr>
<h2 id="ä¸‰ã€åœºæ™¯-2ï¼šè€¦åˆåº¦ä½çš„å¤æ‚ä»»åŠ¡-â†’-å¤–åŒ…ç»™-SubAgent">ä¸‰ã€åœºæ™¯ 2ï¼šè€¦åˆåº¦ä½çš„å¤æ‚ä»»åŠ¡ â†’ å¤–åŒ…ç»™ SubAgent</h2>
<h3 id="ç—›ç‚¹-2">ç—›ç‚¹</h3>
<p>å‡è®¾æˆ‘è¦ç»™é¡¹ç›®æ·»åŠ ä¸€ä¸ªã€Œç”¨æˆ·ç§¯åˆ†ç³»ç»Ÿã€çš„åŠŸèƒ½ã€‚åœ¨åŠ¨æ‰‹å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘éœ€è¦å…ˆææ¸…æ¥šç°æœ‰çš„ç”¨æˆ·æ¨¡å—æ˜¯æ€ä¹ˆå®ç°çš„â€”â€”å…¥å£åœ¨å“ªã€è°ƒç”¨äº†å“ªäº›å‡½æ•°ã€ä¾èµ–äº†å“ªäº›æ¨¡å—ã€‚</p>
<p>è¿™ä¸ªã€Œè°ƒç ”ã€è¿‡ç¨‹ä¼šäº§ç”Ÿå¤§é‡ä¸­é—´ä¿¡æ¯ï¼šè¯»äº†å“ªäº›æ–‡ä»¶ã€æœäº†å“ªäº›ä»£ç ã€åˆ†æäº†å“ªäº›å‡½æ•°â€¦â€¦ä½†æœ€ç»ˆæˆ‘åªéœ€è¦ä¸€ä»½æ€»ç»“æŠ¥å‘Šã€‚</p>
<p>å¦‚æœè®©ä¸» Agent æ¥åšè¿™ä»¶äº‹ï¼Œè¿™äº›ä¸­é—´ä¿¡æ¯ä¼šæŠŠä¸Šä¸‹æ–‡æå¾—å¾ˆä¹±ï¼Œå½±å“åç»­çš„å¼€å‘ä»»åŠ¡ã€‚</p>
<h3 id="æ ¸å¿ƒæ¦‚å¿µï¼šä¸Šä¸‹æ–‡éš”ç¦»">æ ¸å¿ƒæ¦‚å¿µï¼šä¸Šä¸‹æ–‡éš”ç¦»</h3>
<p>SubAgent å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li><strong>è¾“å…¥</strong>ï¼šä¸€æ®µä»»åŠ¡æè¿°ï¼ˆæ¯”å¦‚ã€Œåˆ†æç”¨æˆ·æ¨¡å—çš„è°ƒç”¨é“¾è·¯ã€ï¼‰</li>
<li><strong>å¤„ç†</strong>ï¼šåœ¨ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡é‡Œè¯»æ–‡ä»¶ã€æœä»£ç ã€åˆ†æé€»è¾‘</li>
<li><strong>è¾“å‡º</strong>ï¼šä¸€ä»½ç²¾ç‚¼çš„ç»“æœï¼ˆæ¯”å¦‚è°ƒç”¨é“¾è·¯å›¾ + å…³é”®å‡½æ•°è¯´æ˜ï¼‰</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿå› ä¸º AI çš„ä¸Šä¸‹æ–‡çª—å£æ˜¯æœ‰é™çš„ï¼ˆæ¯”å¦‚ 200k tokensï¼‰ã€‚å¦‚æœæŠŠè°ƒç ”è¿‡ç¨‹ä¸­è¯»å–çš„æ‰€æœ‰æ–‡ä»¶å†…å®¹éƒ½å¡è¿›ä¸»ä¸Šä¸‹æ–‡ï¼Œä¼šæŒ¤æ‰çœŸæ­£é‡è¦çš„ä¿¡æ¯â€”â€”æ¯”å¦‚ç”¨æˆ·çš„éœ€æ±‚æè¿°ã€å·²ç»ç¡®è®¤çš„æŠ€æœ¯æ–¹æ¡ˆã€‚ç»“æœå°±æ˜¯ AI è¶ŠèŠè¶Š&quot;å¥å¿˜&quot;ï¼Œç”šè‡³å¼€å§‹èƒ¡è¯´å…«é“ã€‚</p>
<p>SubAgent çš„ä»·å€¼å°±åœ¨äºï¼šä¸­é—´è¿‡ç¨‹äº§ç”Ÿçš„å¤§é‡ä¿¡æ¯éƒ½ç•™åœ¨å®ƒå†…éƒ¨ï¼Œä¸ä¼šã€Œæ±¡æŸ“ã€ä¸» Agent çš„ä¸Šä¸‹æ–‡ã€‚ä¸» Agent åªæ‹¿åˆ°æœ€ç»ˆçš„ç²¾ç‚¼ç»“æœï¼Œä¸Šä¸‹æ–‡ä¿æŒå¹²å‡€ã€‚</p>
<h3 id="å¦‚ä½•åˆ›å»º-SubAgentï¼ˆä»¥-Trae-ä¸ºä¾‹ï¼‰">å¦‚ä½•åˆ›å»º SubAgentï¼ˆä»¥ Trae ä¸ºä¾‹ï¼‰</h3>
<p>æ‰“å¼€ Trae çš„è®¾ç½®ï¼Œæ‰¾åˆ°ã€Œæ™ºèƒ½ä½“ã€ï¼Œç‚¹å‡»ã€Œåˆ›å»ºæ™ºèƒ½ä½“ã€ï¼š</p>
<p><img src="/2025/06/20/AI/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%B7%AF%E4%B8%8B%E7%9A%84%E5%90%8E%E7%AB%AF%E5%9C%BA%E6%99%AFAI%20Coding%E5%AE%9E%E8%B7%B5+%E6%80%9D%E8%B7%AF/image%202.png" alt="åˆ›å»ºæ™ºèƒ½ä½“å…¥å£"></p>
<p>è¿›å…¥åˆ›å»ºé¡µé¢åï¼Œéœ€è¦å¡«å†™ä»¥ä¸‹é…ç½®ï¼š</p>
<p><img src="/2025/06/20/AI/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%B7%AF%E4%B8%8B%E7%9A%84%E5%90%8E%E7%AB%AF%E5%9C%BA%E6%99%AFAI%20Coding%E5%AE%9E%E8%B7%B5+%E6%80%9D%E8%B7%AF/image%203.png" alt="æ™ºèƒ½ä½“é…ç½®é¡µé¢"></p>
<p><strong>1. åç§°</strong></p>
<p>ç»™ SubAgent èµ·ä¸ªåå­—ï¼Œæ¯”å¦‚ã€Œé“¾è·¯åˆ†æå™¨ã€ã€‚</p>
<p><strong>2. æç¤ºè¯</strong></p>
<p>å‘Šè¯‰ SubAgent å®ƒè¦åšä»€ä¹ˆï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ä½ æ˜¯ä¸€ä¸ªä»£ç é“¾è·¯åˆ†æä¸“å®¶ã€‚å½“ç”¨æˆ·ç»™ä½ ä¸€ä¸ªæ¨¡å—åæ—¶ï¼Œä½ éœ€è¦ï¼š</span><br><span class="line">1. æ‰¾åˆ°è¯¥æ¨¡å—çš„å…¥å£æ–‡ä»¶</span><br><span class="line">2. åˆ†ææ‰€æœ‰çš„å‡½æ•°è°ƒç”¨å…³ç³»</span><br><span class="line">3. è¾“å‡ºä¸€ä»½ç»“æ„åŒ–çš„é“¾è·¯æŠ¥å‘Šï¼ŒåŒ…å«è°ƒç”¨å›¾å’Œå…³é”®å‡½æ•°è¯´æ˜</span><br></pre></td></tr></table></figure>
<p><strong>3. å¯è¢«å…¶ä»–æ™ºèƒ½ä½“è°ƒç”¨</strong></p>
<p>è¿™ä¸ªå¼€å…³è¦æ‰“å¼€ï¼Œè¿™æ ·ä¸» Agent æ‰èƒ½è°ƒç”¨è¿™ä¸ª SubAgentã€‚</p>
<p><strong>4. è‹±æ–‡æ ‡è¯†å</strong></p>
<p>å¡«ä¸€ä¸ªå”¯ä¸€çš„è‹±æ–‡åï¼Œæ¯”å¦‚ <code>trace-analyzer</code>ï¼Œä¸» Agent ä¼šé€šè¿‡è¿™ä¸ªåå­—æ¥è°ƒç”¨å®ƒã€‚</p>
<p><strong>5. ä½•æ—¶è°ƒç”¨</strong></p>
<p>æè¿°ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥è°ƒç”¨è¿™ä¸ª SubAgentï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">å½“ç”¨æˆ·éœ€è¦åˆ†ææŸä¸ªæ¨¡å—çš„è°ƒç”¨é“¾è·¯ã€ä¾èµ–å…³ç³»ï¼Œæˆ–è€…éœ€è¦åœ¨å¼€å‘å‰å…ˆäº†è§£ç°æœ‰ä»£ç ç»“æ„æ—¶ï¼Œè°ƒç”¨æ­¤æ™ºèƒ½ä½“</span><br></pre></td></tr></table></figure>
<p><strong>6. å·¥å…·</strong></p>
<p>å‹¾é€‰è¿™ä¸ª SubAgent å¯ä»¥ä½¿ç”¨çš„å·¥å…·ã€‚é“¾è·¯åˆ†æåªéœ€è¦è¯»ä»£ç ï¼Œæ‰€ä»¥åªå‹¾é€‰ï¼š</p>
<ul>
<li>âœ… Read</li>
<li>âœ… Context4Codeï¼ˆå¦‚æœéœ€è¦è·¨ä»“åº“æœç´¢ï¼‰</li>
</ul>
<p>ä¸éœ€è¦çš„å·¥å…·å°±ä¸è¦å‹¾é€‰ï¼Œé¿å… SubAgent åšå‡ºè¶…å‡ºé¢„æœŸçš„æ“ä½œã€‚</p>
<h3 id="ä½¿ç”¨æ•ˆæœ-2">ä½¿ç”¨æ•ˆæœ</h3>
<p>é…ç½®å®Œæˆåï¼Œå½“ä½ åœ¨å¯¹è¯ä¸­è¯´ã€Œå¸®æˆ‘åˆ†æä¸€ä¸‹å®šæ—¶å™¨çš„è°ƒç”¨é“¾è·¯ï¼Œç„¶ååŸºäºè¿™ä¸ªé“¾è·¯å®ç°å»¶æ—¶åŠŸèƒ½ã€æ—¶ï¼š</p>
<ol>
<li>ä¸» Agent è¯†åˆ«åˆ°éœ€è¦å…ˆåˆ†æé“¾è·¯</li>
<li>è‡ªåŠ¨è°ƒç”¨ <code>trace-analyzer</code> è¿™ä¸ª SubAgent</li>
<li>SubAgent ç‹¬ç«‹å®Œæˆé“¾è·¯åˆ†æï¼Œè¿”å›ç»“æœ</li>
<li>ä¸» Agent æ‹¿åˆ°é“¾è·¯ä¿¡æ¯åï¼Œç»§ç»­å®Œæˆåç»­çš„å¼€å‘ä»»åŠ¡</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œé“¾è·¯åˆ†æçš„ç»†èŠ‚éƒ½åœ¨ SubAgent çš„ç‹¬ç«‹ä¸Šä¸‹æ–‡é‡Œå®Œæˆï¼Œä¸» Agent åªæ‹¿åˆ°æœ€ç»ˆçš„åˆ†æç»“æœã€‚</p>
<p><img src="/2025/06/20/AI/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%B7%AF%E4%B8%8B%E7%9A%84%E5%90%8E%E7%AB%AF%E5%9C%BA%E6%99%AFAI%20Coding%E5%AE%9E%E8%B7%B5+%E6%80%9D%E8%B7%AF/image%204.png" alt="SubAgent æ‰§è¡Œæ•ˆæœ"></p>
<h3 id="å°ç»“-2">å°ç»“</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä»»åŠ¡ç‹¬ç«‹ã€æ•°æ®å¯†é›†ã€ç»“æœå¯æç‚¼çš„ã€Œå‰ç½®å·¥ä½œã€ã€‚</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šä¿æŒä¸»ä¸Šä¸‹æ–‡å¹²å‡€ï¼Œè®© AI ä¸“æ³¨äºæ ¸å¿ƒä»»åŠ¡ã€‚</p>
<hr>
<h2 id="å››ã€åœºæ™¯-3ï¼šéœ€è¦éµå¾ªå·¥ä½œæµ-å¼•å…¥æ–‡æ¡£-â†’-ç”¨-Skill">å››ã€åœºæ™¯ 3ï¼šéœ€è¦éµå¾ªå·¥ä½œæµ + å¼•å…¥æ–‡æ¡£ â†’ ç”¨ Skill</h2>
<h3 id="ç—›ç‚¹-3">ç—›ç‚¹</h3>
<p>å›¢é˜Ÿå¾€å¾€æœ‰å›ºå®šçš„å¼€å‘æµç¨‹ã€‚æ¯”å¦‚ã€Œæ–°åŠŸèƒ½å¼€å‘ã€è¦å…ˆåšéœ€æ±‚åˆ†æã€å†è°ƒç ”ç°æœ‰ä»£ç ã€å†å†™æŠ€æœ¯æ–¹æ¡ˆã€æœ€åæ‰å†™ä»£ç ã€‚</p>
<p>åŒæ—¶ï¼Œå¼€å‘è¿‡ç¨‹ä¸­è¿˜éœ€è¦å‚è€ƒå„ç§è§„èŒƒæ–‡æ¡£ï¼šä»£ç è§„èŒƒã€API è®¾è®¡è§„èŒƒã€ç³»ç»Ÿæ¶æ„è¯´æ˜â€¦â€¦</p>
<p>æ¯æ¬¡éƒ½é å£å¤´æè¿°ç»™ AIï¼Œæ—¢éº»çƒ¦åˆå®¹æ˜“æ¼æ­¥éª¤ã€æ¼æ–‡æ¡£ã€‚</p>
<h3 id="æ ¸å¿ƒæ¦‚å¿µï¼šæ¸è¿›å¼æŠ«éœ²-å·¥ä½œæµç¼–æ’">æ ¸å¿ƒæ¦‚å¿µï¼šæ¸è¿›å¼æŠ«éœ² + å·¥ä½œæµç¼–æ’</h3>
<p>Skill æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªã€ŒçŸ¥è¯†åŒ… + å·¥å…·åŒ…ã€çš„ç»„åˆï¼Œå®ƒå¯ä»¥ï¼š</p>
<ol>
<li><strong>å®šä¹‰å·¥ä½œæµ</strong>ï¼šå‘Šè¯‰ AI åº”è¯¥æŒ‰ä»€ä¹ˆæ­¥éª¤åšäº‹</li>
<li><strong>è‡ªåŠ¨å¼•å…¥æ–‡æ¡£</strong>ï¼šè§¦å‘æŠ€èƒ½æ—¶è‡ªåŠ¨æŠŠç›¸å…³æ–‡æ¡£å¸¦è¿›ä¸Šä¸‹æ–‡</li>
<li><strong>åŒ…å«å¯æ‰§è¡Œè„šæœ¬</strong>ï¼šåœ¨ Skill ç›®å½•ä¸‹æ”¾è„šæœ¬æ–‡ä»¶ï¼ŒAI å¯ä»¥æŒ‰éœ€æ‰§è¡Œï¼ˆå¦‚åˆå§‹åŒ–é¡¹ç›®ã€ç”Ÿæˆæ¨¡æ¿ï¼‰</li>
</ol>
<p>Skill é‡‡ç”¨ã€Œæ¸è¿›å¼æŠ«éœ²ã€çš„è®¾è®¡â€”â€”åªåœ¨éœ€è¦æ—¶æ‰åŠ è½½ç›¸å…³çŸ¥è¯†å’Œè°ƒç”¨ç›¸å…³è„šæœ¬ï¼Œä¸ä¼šä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰å†…å®¹éƒ½å¡è¿›ä¸Šä¸‹æ–‡ã€‚</p>
<p>ç®€å•è¯´ï¼ŒSkill æ˜¯<strong>æŒ‰éœ€åŠ è½½çš„ Prompt + æŒ‰éœ€è°ƒç”¨çš„å·¥å…·</strong>çš„é›†åˆã€‚</p>
<h3 id="å®é™…ä¾‹å­ï¼šæ–°åŠŸèƒ½å¼€å‘å·¥ä½œæµ">å®é™…ä¾‹å­ï¼šæ–°åŠŸèƒ½å¼€å‘å·¥ä½œæµ</h3>
<p>å‡è®¾æˆ‘ä»¬å›¢é˜Ÿçš„æ–°åŠŸèƒ½å¼€å‘æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li><strong>éœ€æ±‚åˆ†æ</strong>ï¼šå…ˆç†è§£éœ€æ±‚ï¼Œåˆ†æå½±å“èŒƒå›´</li>
<li><strong>é“¾è·¯è°ƒç ”</strong>ï¼šæœç´¢ç°æœ‰ä»£ç ï¼Œäº†è§£ç›¸å…³æ¨¡å—çš„å®ç°</li>
<li><strong>æ–¹æ¡ˆè®¾è®¡</strong>ï¼šè¾“å‡ºæŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£</li>
<li><strong>ä»£ç å®ç°</strong>ï¼šæŒ‰æ–¹æ¡ˆå†™ä»£ç </li>
</ol>
<p>åŒæ—¶ï¼Œå¼€å‘è¿‡ç¨‹ä¸­éœ€è¦å‚è€ƒè¿™äº›æ–‡æ¡£ï¼š</p>
<ul>
<li><code>docs/code-style.md</code>ï¼šä»£ç è§„èŒƒ</li>
<li><code>docs/api-design.md</code>ï¼šAPI è®¾è®¡è§„èŒƒ</li>
<li><code>docs/architecture.md</code>ï¼šç³»ç»Ÿæ¶æ„è¯´æ˜</li>
</ul>
<h3 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé“¾è·¯è°ƒç ”çš„-SubAgent">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé“¾è·¯è°ƒç ”çš„ SubAgent</h3>
<p>å…ˆæŒ‰åœºæ™¯ 2 çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ª SubAgentï¼Œå…³é”®é…ç½®ï¼š</p>
<ul>
<li><strong>åç§°</strong>ï¼šé“¾è·¯è°ƒç ”åŠ©æ‰‹</li>
<li><strong>è‹±æ–‡æ ‡è¯†å</strong>ï¼š<code>trace-analyzer</code></li>
<li><strong>ä½•æ—¶è°ƒç”¨</strong>ï¼šå½“éœ€è¦åˆ†ææŸä¸ªåŠŸèƒ½æ¨¡å—çš„è°ƒç”¨é“¾è·¯ã€ä¾èµ–å…³ç³»ï¼Œæˆ–è€…éœ€è¦åœ¨å¼€å‘å‰å…ˆäº†è§£ç°æœ‰ä»£ç ç»“æ„æ—¶</li>
<li><strong>å·¥å…·</strong>ï¼šåªå‹¾é€‰ Readã€Context4Code</li>
</ul>
<h3 id="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå·¥ä½œæµ-Skillï¼ˆåŒ…å«å‚è€ƒæ–‡æ¡£ï¼‰">ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå·¥ä½œæµ Skillï¼ˆåŒ…å«å‚è€ƒæ–‡æ¡£ï¼‰</h3>
<p>Skill å¯ä»¥æ‰“åŒ…æˆä¸€ä¸ªç›®å½•ï¼ŒæŠŠç›¸å…³çš„å‚è€ƒæ–‡æ¡£éƒ½æ”¾è¿›å»ã€‚ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">feature-dev/</span><br><span class="line">â”œâ”€â”€ SKILL.md           # æŠ€èƒ½å®šä¹‰æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ code-style.md      # ä»£ç è§„èŒƒæ–‡æ¡£</span><br><span class="line">â”œâ”€â”€ api-design.md      # API è®¾è®¡è§„èŒƒ</span><br><span class="line">â”œâ”€â”€ architecture.md    # ç³»ç»Ÿæ¶æ„è¯´æ˜</span><br><span class="line">â””â”€â”€ scripts/</span><br><span class="line">    â””â”€â”€ init-project.sh  # å¯æ‰§è¡Œè„šæœ¬ï¼ˆå¯é€‰ï¼‰</span><br></pre></td></tr></table></figure>
<p><code>SKILL.md</code> å†…å®¹ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">name: feature-dev</span><br><span class="line"><span class="section">description: å½“ç”¨æˆ·éœ€è¦å¼€å‘æ–°åŠŸèƒ½ã€å®ç°æ–°éœ€æ±‚æ—¶è§¦å‘</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line"><span class="section"># æ–°åŠŸèƒ½å¼€å‘å·¥ä½œæµ</span></span><br><span class="line"></span><br><span class="line"><span class="section">## å‚è€ƒæ–‡æ¡£</span></span><br><span class="line">åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¯·å‚è€ƒæœ¬ç›®å½•ä¸‹çš„æ–‡æ¡£ï¼š</span><br><span class="line"><span class="bullet">-</span> code-style.md - ä»£ç è§„èŒƒ</span><br><span class="line"><span class="bullet">-</span> api-design.md - API è®¾è®¡è§„èŒƒ  </span><br><span class="line"><span class="bullet">-</span> architecture.md - ç³»ç»Ÿæ¶æ„è¯´æ˜</span><br><span class="line"></span><br><span class="line"><span class="section">## æµç¨‹æ­¥éª¤</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 1. éœ€æ±‚åˆ†æ</span></span><br><span class="line"><span class="bullet">-</span> ç¡®è®¤åŠŸèƒ½çš„è¾“å…¥è¾“å‡º</span><br><span class="line"><span class="bullet">-</span> æ˜ç¡®è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ</span><br><span class="line"><span class="bullet">-</span> åˆ—å‡ºéœ€è¦ä¿®æ”¹çš„æ¨¡å—</span><br><span class="line"></span><br><span class="line"><span class="section">### 2. é“¾è·¯è°ƒç ”</span></span><br><span class="line"><span class="bullet">-</span> è°ƒç”¨ trace-analyzer SubAgent åˆ†æç›¸å…³æ¨¡å—çš„ç°æœ‰å®ç°</span><br><span class="line"><span class="bullet">-</span> è·å–è°ƒç”¨é“¾è·¯å›¾å’Œå…³é”®å‡½æ•°è¯´æ˜</span><br><span class="line"><span class="bullet">-</span> æ³¨æ„ï¼šè¿™ä¸€æ­¥äº¤ç»™ SubAgent å®Œæˆï¼Œä¸è¦è‡ªå·±å»å¤§é‡æœç´¢ä»£ç </span><br><span class="line"></span><br><span class="line"><span class="section">### 3. æ–¹æ¡ˆè®¾è®¡</span></span><br><span class="line">åŸºäºè°ƒç ”ç»“æœå’Œæ¶æ„æ–‡æ¡£ï¼Œè¾“å‡ºæŠ€æœ¯æ–¹æ¡ˆï¼š</span><br><span class="line"><span class="bullet">-</span> æ•´ä½“æ¶æ„å›¾</span><br><span class="line"><span class="bullet">-</span> éœ€è¦æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨</span><br><span class="line"><span class="bullet">-</span> å…³é”®å®ç°æ€è·¯</span><br><span class="line"></span><br><span class="line"><span class="section">### 4. ä»£ç å®ç°</span></span><br><span class="line"><span class="bullet">-</span> æŒ‰æ–¹æ¡ˆé€æ­¥å®ç°</span><br><span class="line"><span class="bullet">-</span> éµå¾ª code-style.md ä¸­çš„ä»£ç è§„èŒƒ</span><br><span class="line"><span class="bullet">-</span> æ–°å¢ API éœ€è¦ç¬¦åˆ api-design.md çš„è®¾è®¡è§„èŒƒ</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨ Trae è®¾ç½®çš„ã€Œè§„åˆ™å’ŒæŠ€èƒ½ã€ä¸­ï¼Œé€šè¿‡ã€Œä¸Šä¼ è¿›è¡Œæ™ºèƒ½è§£æã€æŠŠè¿™ä¸ªç›®å½•æ‰“åŒ…ä¸Šä¼ ï¼š</p>
<p><img src="/2025/06/20/AI/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%B7%AF%E4%B8%8B%E7%9A%84%E5%90%8E%E7%AB%AF%E5%9C%BA%E6%99%AFAI%20Coding%E5%AE%9E%E8%B7%B5+%E6%80%9D%E8%B7%AF/image%205.png" alt="ä¸Šä¼  Skill"></p>
<p>ï¼ˆå¦‚æœä¸æ¶‰åŠå‚è€ƒæ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Trae ä¸­çš„å›¾å½¢åŒ–ç•Œé¢åˆ›å»ºæŠ€èƒ½ï¼‰</p>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨æ•ˆæœ">ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨æ•ˆæœ</h3>
<p>å½“ä½ è¯´ã€Œå¸®æˆ‘å®ç°ä¸€ä¸ªå»¶æ—¶åŠŸèƒ½ã€æ—¶ï¼š</p>
<p><img src="/2025/06/20/AI/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%B7%AF%E4%B8%8B%E7%9A%84%E5%90%8E%E7%AB%AF%E5%9C%BA%E6%99%AFAI%20Coding%E5%AE%9E%E8%B7%B5+%E6%80%9D%E8%B7%AF/image%206.png" alt="Skill æ‰§è¡Œæ•ˆæœ"></p>
<p>ä¸» Agent ä¼šï¼š</p>
<ol>
<li>è¯†åˆ«åˆ°è¿™æ˜¯æ–°åŠŸèƒ½å¼€å‘ â†’ è‡ªåŠ¨è§¦å‘ <code>feature-dev</code> æŠ€èƒ½</li>
<li>è‡ªåŠ¨åŠ è½½ Skill ç›®å½•ä¸‹çš„å‚è€ƒæ–‡æ¡£ â†’ <code>code-style.md</code>ã€<code>api-design.md</code>ã€<code>architecture.md</code> è¢«å¼•å…¥ä¸Šä¸‹æ–‡</li>
<li>æŒ‰å·¥ä½œæµæ‰§è¡Œéœ€æ±‚åˆ†æ â†’ å’Œä½ ç¡®è®¤åŠŸèƒ½ç»†èŠ‚</li>
<li>è°ƒç”¨ <code>trace-analyzer</code> SubAgent â†’ SubAgent ç‹¬ç«‹å®Œæˆé“¾è·¯è°ƒç ”ï¼Œè¿”å›åˆ†ææŠ¥å‘Š</li>
<li>åŸºäºæŠ¥å‘Šå’Œæ¶æ„æ–‡æ¡£è®¾è®¡æ–¹æ¡ˆ â†’ è¾“å‡ºæŠ€æœ¯æ–¹æ¡ˆè®©ä½ ç¡®è®¤</li>
<li>å®ç°ä»£ç  â†’ æŒ‰è§„èŒƒé€æ­¥å®Œæˆå¼€å‘</li>
</ol>
<h3 id="å°ç»“-3">å°ç»“</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€è¦éµå¾ª SOPã€éœ€è¦å¼•å…¥é¢†åŸŸçŸ¥è¯†/è§„èŒƒæ–‡æ¡£çš„å¤æ‚ä»»åŠ¡ã€‚</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šæµç¨‹æ ‡å‡†åŒ–ã€çŸ¥è¯†è‡ªåŠ¨æ³¨å…¥ã€é¿å…é—æ¼æ­¥éª¤ã€‚</p>
<hr>
<h2 id="äº”ã€è¡¥å……ï¼šå…³äº-Skills-çš„æœªæ¥">äº”ã€è¡¥å……ï¼šå…³äº Skills çš„æœªæ¥</h2>
<p>ç›®å‰ AI Coding é¢†åŸŸæ­£åœ¨åš Skills çš„å¤§ä¸€ç»Ÿï¼ŒSubAgent å’Œ Slash Command çš„èƒ½åŠ›éƒ½åœ¨æ…¢æ…¢å¹¶å…¥ Skills ä½“ç³»ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœªæ¥ä½ å¯èƒ½åªéœ€è¦é€šè¿‡ Skills è¿™ä¸€ä¸ªå…¥å£ï¼Œå°±èƒ½åŒæ—¶å®ç°ï¼š</p>
<ul>
<li><strong>Slash Command çš„èƒ½åŠ›</strong>ï¼šå¿«é€Ÿè§¦å‘é¢„è®¾ Prompt</li>
<li><strong>SubAgent çš„èƒ½åŠ›</strong>ï¼šç‹¬ç«‹ä¸Šä¸‹æ–‡æ‰§è¡Œå¤æ‚ä»»åŠ¡</li>
<li><strong>å·¥ä½œæµç¼–æ’çš„èƒ½åŠ›</strong>ï¼šå®šä¹‰å¤šæ­¥éª¤æµç¨‹</li>
</ul>
<p>æ‰€ä»¥ç°åœ¨å­¦ä¼šç”¨ Skillsï¼Œä»¥åè¿™äº›èƒ½åŠ›éƒ½èƒ½æ— ç¼è¡”æ¥ã€‚</p>
<p>å…·ä½“å¯ä»¥å‚è€ƒï¼š<a href="https://code.claude.com/docs/zh-CN/skills">Claude Code Skills æ–‡æ¡£</a></p>
<hr>
<h2 id="å…­ã€å¤æ‚é“¾è·¯çš„å®æˆ˜è§£å†³æ–¹æ¡ˆ">å…­ã€å¤æ‚é“¾è·¯çš„å®æˆ˜è§£å†³æ–¹æ¡ˆ</h2>
<h3 id="6-1-å¤æ‚é“¾è·¯çš„æŒ‘æˆ˜">6.1 å¤æ‚é“¾è·¯çš„æŒ‘æˆ˜</h3>
<p>åœ¨åç«¯å¼€å‘ä¸­ï¼Œå¤æ‚é“¾è·¯é€šå¸¸å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>è·¨æœåŠ¡è°ƒç”¨</strong>ï¼šä¸€ä¸ªåŠŸèƒ½å¯èƒ½æ¶‰åŠå¤šä¸ªå¾®æœåŠ¡ï¼Œéœ€è¦äº†è§£å„ä¸ªæœåŠ¡ä¹‹é—´çš„æ¥å£å’Œæ•°æ®ä¼ é€’</li>
<li><strong>å¤šå±‚çº§ä¾èµ–</strong>ï¼šä»APIå…¥å£åˆ°æ•°æ®æŒä¹…åŒ–ï¼Œå¯èƒ½ç»è¿‡å¤šå±‚å¤„ç†é€»è¾‘</li>
<li><strong>ä¿¡æ¯åˆ†æ•£</strong>ï¼šç›¸å…³æ–‡æ¡£ã€ä»£ç ã€æ¥å£å®šä¹‰åˆ†å¸ƒåœ¨ä¸åŒå¹³å°</li>
<li><strong>ä¸Šä¸‹æ–‡å¤æ‚</strong>ï¼šéœ€è¦åŒæ—¶è€ƒè™‘ä¸šåŠ¡é€»è¾‘ã€æŠ€æœ¯å®ç°ã€æ€§èƒ½ä¼˜åŒ–ç­‰å¤šä¸ªç»´åº¦</li>
</ul>
<p>è¿™äº›ç‰¹ç‚¹ä½¿å¾—ä¼ ç»Ÿçš„åˆ†ææ–¹æ³•æ•ˆç‡ä½ä¸‹ï¼Œè€ŒAIå·¥å…·åœ¨å¤„ç†è¿™ç±»é—®é¢˜æ—¶ï¼Œåˆé¢ä¸´ä¿¡æ¯è·å–çš„ç“¶é¢ˆã€‚</p>
<h3 id="6-2-ä¸‰å¤§æ ¸å¿ƒå·¥å…·ä»‹ç»">6.2 ä¸‰å¤§æ ¸å¿ƒå·¥å…·ä»‹ç»</h3>
<p>è¦è§£å†³å¤æ‚é“¾è·¯ä¸­çš„ä¿¡æ¯è·å–é—®é¢˜ï¼Œæˆ‘æ¨èä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒå·¥å…·ï¼š</p>
<h4 id="1-é£ä¹¦-Lark-OpenAPI">1. é£ä¹¦/Lark OpenAPI</h4>
<p><strong>ç”¨é€”</strong>ï¼šç”¨æ¥è¯»PRDã€æŠ€æœ¯æ–¹æ¡ˆç­‰æ–‡æ¡£</p>
<p><strong>é“¾æ¥</strong>ï¼š<a href="https://cloud.bytedance.net/mcp/6800d5246ecc78283b3e98af?x-resource-account=public&amp;x-bc-region-id=bytedance">é£ä¹¦å¼€æ”¾å¹³å°</a></p>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šé€šè¿‡APIæ¥å£è·å–é£ä¹¦ä¸­çš„æ–‡æ¡£å†…å®¹ï¼Œè®©AIèƒ½å¤Ÿç›´æ¥è¯»å–PRDã€æŠ€æœ¯æ–¹æ¡ˆç­‰æ–‡æ¡£ï¼Œäº†è§£ä¸šåŠ¡èƒŒæ™¯å’Œéœ€æ±‚ç»†èŠ‚ã€‚</p>
<h4 id="2-Context4Code">2. Context4Code</h4>
<p><strong>ç”¨é€”</strong>ï¼šåœ¨æä¾›ä»“åº“çš„é“¾æ¥åï¼ˆä¸æ”¯æŒPSMï¼‰å¯ä»¥ç›´æ¥è®¿é—®ä»“åº“å†…çš„ä»£ç </p>
<p><strong>é“¾æ¥</strong>ï¼š<a href="https://cloud.bytedance.net/mcp/68f07098153269f45e098f6f?x-resource-account=public&amp;x-bc-region-id=bytedance">Context4Code</a></p>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šæä¾›ä»£ç ä»“åº“é“¾æ¥åï¼ŒAIå¯ä»¥ç›´æ¥æŸ¥çœ‹ä»“åº“ä¸­çš„ä»£ç æ–‡ä»¶ï¼Œäº†è§£å…·ä½“å®ç°é€»è¾‘ï¼Œç‰¹åˆ«æ˜¯ä¸Šä¸‹æ¸¸ä¸­ä¸€äº›å‡½æ•°çš„å…·ä½“å®ç°ã€‚</p>
<h4 id="3-BAM-API-DOC">3. BAM API DOC</h4>
<p><strong>ç”¨é€”</strong>ï¼šå¯ä»¥åœ¨æä¾›PSMåå¿«é€Ÿäº†è§£æŸä¸ªæœåŠ¡å¯¹å¤–æä¾›çš„å‡½æ•°ä»¥åŠä½¿ç”¨æ–¹æ³•</p>
<p><strong>é“¾æ¥</strong>ï¼š<a href="https://cloud.bytedance.net/mcp/689051d6fd439beb70320d85?x-resource-account=public&amp;x-bc-region-id=bytedance">BAM API DOC</a></p>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šæä¾›æœåŠ¡çš„PSMåï¼ŒAIå¯ä»¥å¿«é€Ÿè·å–è¯¥æœåŠ¡å¯¹å¤–æš´éœ²çš„æ¥å£ä¿¡æ¯ï¼Œäº†è§£æ•°æ®å¦‚ä½•ä»ä¸‹æ¸¸æå‡ºï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨è¿™äº›æ¥å£ã€‚</p>
<h3 id="6-3-åŸºäºSkillsçš„SOPæ–‡æ¡£è®¾è®¡">6.3 åŸºäºSkillsçš„SOPæ–‡æ¡£è®¾è®¡</h3>
<p>è¦å……åˆ†å‘æŒ¥è¿™äº›å·¥å…·çš„ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Skillsä¸­æä¾›ä¸€äº›SOPæ–‡æ¡£ï¼Œæ¥å¤§è‡´æè¿°å…³é”®é“¾è·¯ï¼Œæä¾›å…³é”®é“¾è·¯ä¸Šçš„PSMå’Œä»“åº“åœ°å€ã€‚</p>
<h4 id="ç›®å½•ç»“æ„ç¤ºä¾‹">ç›®å½•ç»“æ„ç¤ºä¾‹</h4>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">complex-link-analysis/</span><br><span class="line">â”œâ”€â”€ SKILL.md           # æŠ€èƒ½å®šä¹‰æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ sop/               # SOPæ–‡æ¡£ç›®å½•</span><br><span class="line">â”‚   â”œâ”€â”€ user-flow.md   # ç”¨æˆ·æµç¨‹é“¾è·¯SOP</span><br><span class="line">â”‚   â”œâ”€â”€ order-flow.md  # è®¢å•æµç¨‹é“¾è·¯SOP</span><br><span class="line">â”‚   â””â”€â”€ payment-flow.md # æ”¯ä»˜æµç¨‹é“¾è·¯SOP</span><br><span class="line">â”œâ”€â”€ docs/              # å‚è€ƒæ–‡æ¡£ç›®å½•</span><br><span class="line">â”‚   â”œâ”€â”€ code-style.md  # ä»£ç è§„èŒƒ</span><br><span class="line">â”‚   â””â”€â”€ api-design.md  # APIè®¾è®¡è§„èŒƒ</span><br><span class="line">â””â”€â”€ scripts/           # è„šæœ¬ç›®å½•</span><br><span class="line">    â””â”€â”€ fetch-docs.sh  # è‡ªåŠ¨è·å–æ–‡æ¡£çš„è„šæœ¬</span><br></pre></td></tr></table></figure>
<h4 id="SOPæ–‡æ¡£æ¨¡æ¿">SOPæ–‡æ¡£æ¨¡æ¿</h4>
<p>ä»¥<code>user-flow.md</code>ä¸ºä¾‹ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ç”¨æˆ·æµç¨‹é“¾è·¯SOP</span></span><br><span class="line"></span><br><span class="line"><span class="section">## é“¾è·¯æ¦‚è¿°</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**åŠŸèƒ½è¯´æ˜**</span>ï¼šç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯æ›´æ–°çš„å®Œæ•´æµç¨‹</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ¶‰åŠæœåŠ¡**</span>ï¼šç”¨æˆ·æœåŠ¡ã€è®¤è¯æœåŠ¡ã€é€šçŸ¥æœåŠ¡</span><br><span class="line"></span><br><span class="line"><span class="section">## å…³é”®èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 1. ç”¨æˆ·æ³¨å†Œ</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å…¥å£**</span>ï¼š<span class="code">`/api/user/register`</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å¤„ç†æœåŠ¡**</span>ï¼šç”¨æˆ·æœåŠ¡ (PSM: user.service)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ä»£ç ä»“åº“**</span>ï¼šhttps://code.byted.org/user/service</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ ¸å¿ƒå‡½æ•°**</span>ï¼š</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`UserService.Register()`</span>: å¤„ç†æ³¨å†Œé€»è¾‘</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`AuthService.GenerateToken()`</span>: ç”Ÿæˆè®¤è¯ä»¤ç‰Œ</span><br><span class="line"></span><br><span class="line"><span class="section">### 2. ç”¨æˆ·ç™»å½•</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å…¥å£**</span>ï¼š<span class="code">`/api/user/login`</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å¤„ç†æœåŠ¡**</span>ï¼šè®¤è¯æœåŠ¡ (PSM: auth.service)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ä»£ç ä»“åº“**</span>ï¼šhttps://code.byted.org/auth/service</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ ¸å¿ƒå‡½æ•°**</span>ï¼š</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`AuthService.Login()`</span>: å¤„ç†ç™»å½•é€»è¾‘</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`AuthService.ValidateCredentials()`</span>: éªŒè¯å‡­è¯</span><br><span class="line"></span><br><span class="line"><span class="section">### 3. ä¿¡æ¯æ›´æ–°</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å…¥å£**</span>ï¼š<span class="code">`/api/user/profile/update`</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å¤„ç†æœåŠ¡**</span>ï¼šç”¨æˆ·æœåŠ¡ (PSM: user.service)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ä»£ç ä»“åº“**</span>ï¼šhttps://code.byted.org/user/service</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ ¸å¿ƒå‡½æ•°**</span>ï¼š</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`UserService.UpdateProfile()`</span>: æ›´æ–°ç”¨æˆ·ä¿¡æ¯</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`NotificationService.SendUpdateNotification()`</span>: å‘é€æ›´æ–°é€šçŸ¥</span><br><span class="line"></span><br><span class="line"><span class="section">## æ•°æ®æµå‘</span></span><br><span class="line"><span class="bullet">1.</span> å®¢æˆ·ç«¯ â†’ ç”¨æˆ·æœåŠ¡ â†’ è®¤è¯æœåŠ¡ â†’ æ•°æ®åº“</span><br><span class="line"><span class="bullet">2.</span> å®¢æˆ·ç«¯ â†’ è®¤è¯æœåŠ¡ â†’ ç”¨æˆ·æœåŠ¡ â†’ æ•°æ®åº“</span><br><span class="line"><span class="bullet">3.</span> å®¢æˆ·ç«¯ â†’ ç”¨æˆ·æœåŠ¡ â†’ æ•°æ®åº“ â†’ é€šçŸ¥æœåŠ¡</span><br><span class="line"></span><br><span class="line"><span class="section">## ä¾èµ–å…³ç³»</span></span><br><span class="line"><span class="bullet">-</span> ç”¨æˆ·æœåŠ¡ä¾èµ–è®¤è¯æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯</span><br><span class="line"><span class="bullet">-</span> è®¤è¯æœåŠ¡ä¾èµ–ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯</span><br><span class="line"><span class="bullet">-</span> ç”¨æˆ·æœåŠ¡ä¾èµ–é€šçŸ¥æœåŠ¡å‘é€æ¶ˆæ¯</span><br></pre></td></tr></table></figure>
<h3 id="6-4-å®æˆ˜æ•ˆæœ">6.4 å®æˆ˜æ•ˆæœ</h3>
<p>é€šè¿‡ä»¥ä¸Šå·¥å…·å’Œæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ol>
<li>
<p><strong>å¿«é€Ÿè·å–ä¿¡æ¯</strong>ï¼šAIå¯ä»¥é€šè¿‡é£ä¹¦OpenAPIè¯»å–PRDå’ŒæŠ€æœ¯æ–¹æ¡ˆï¼Œé€šè¿‡Context4CodeæŸ¥çœ‹ä»£ç å®ç°ï¼Œé€šè¿‡BAM API DOCäº†è§£æœåŠ¡æ¥å£ï¼Œæ— éœ€æ‰‹åŠ¨æœç´¢å’Œæ•´ç†</p>
</li>
<li>
<p><strong>å…¨é¢ç†è§£é“¾è·¯</strong>ï¼šåŸºäºSkillsä¸­çš„SOPæ–‡æ¡£ï¼ŒAIå¯ä»¥å¿«é€Ÿäº†è§£æ•´ä¸ªé“¾è·¯çš„ç»“æ„å’Œå…³é”®èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬æ¶‰åŠçš„æœåŠ¡ã€æ ¸å¿ƒå‡½æ•°ã€æ•°æ®æµå‘ç­‰</p>
</li>
<li>
<p><strong>ç²¾å‡†å®šä½é—®é¢˜</strong>ï¼šå½“çº¿ä¸Šå‡ºç°é—®é¢˜æ—¶ï¼ŒAIå¯ä»¥æ ¹æ®é“¾è·¯ä¿¡æ¯å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨çš„æœåŠ¡å’Œå‡½æ•°ï¼Œæé«˜æ’æŸ¥æ•ˆç‡</p>
</li>
<li>
<p><strong>é«˜æ•ˆæ–¹æ¡ˆè®¾è®¡</strong>ï¼šåœ¨å¼€å‘æ–°åŠŸèƒ½æ—¶ï¼ŒAIå¯ä»¥åŸºäºç°æœ‰é“¾è·¯ä¿¡æ¯ï¼Œè®¾è®¡å‡ºæ›´åˆç†çš„å®ç°æ–¹æ¡ˆï¼Œé¿å…é‡å¤é€ è½®å­</p>
</li>
<li>
<p><strong>ä¿æŒä¸Šä¸‹æ–‡æ¸…æ™°</strong>ï¼šé€šè¿‡SubAgentçš„ç‹¬ç«‹ä¸Šä¸‹æ–‡èƒ½åŠ›ï¼ŒAIå¯ä»¥åœ¨ç‹¬ç«‹çš„ç¯å¢ƒä¸­å¤„ç†å¤§é‡çš„ä»£ç å’Œæ–‡æ¡£ä¿¡æ¯ï¼Œåªè¿”å›ç²¾ç‚¼çš„ç»“æœï¼Œä¿æŒä¸»ä¸Šä¸‹æ–‡çš„å¹²å‡€</p>
</li>
</ol>
<hr>
<h2 id="ä¸ƒã€æ€»ç»“">ä¸ƒã€æ€»ç»“</h2>
<h3 id="å¦‚ä½•é€‰æ‹©å·¥å…·ï¼Ÿ">å¦‚ä½•é€‰æ‹©å·¥å…·ï¼Ÿ</h3>
<table>
<thead>
<tr>
<th>ä»»åŠ¡ç‰¹å¾</th>
<th>æ¨èå·¥å…·</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prompt å›ºå®šã€åªæ¢å‚æ•°</td>
<td>Slash Command</td>
</tr>
<tr>
<td>ä¼šäº§ç”Ÿå¤§é‡ä¸­é—´ä¿¡æ¯ã€åªéœ€è¦æœ€ç»ˆç»“æœ</td>
<td>SubAgent</td>
</tr>
<tr>
<td>éœ€è¦æŒ‰å›ºå®šæµç¨‹æ‰§è¡Œ</td>
<td>Skill</td>
</tr>
<tr>
<td>éœ€è¦è‡ªåŠ¨å¼•å…¥å‚è€ƒæ–‡æ¡£</td>
<td>Skill</td>
</tr>
<tr>
<td>éœ€è¦æ‰§è¡Œè‡ªåŠ¨åŒ–è„šæœ¬</td>
<td>Skill</td>
</tr>
<tr>
<td>ä»¥ä¸Šç‰¹å¾ç»„åˆå‡ºç°</td>
<td>Skill + SubAgent ç»„åˆ</td>
</tr>
</tbody>
</table>
<h3 id="å»ºè®®çš„å­¦ä¹ è·¯å¾„">å»ºè®®çš„å­¦ä¹ è·¯å¾„</h3>
<ol>
<li>å…ˆä» Slash Command å¼€å§‹ï¼ŒæŠŠæ—¥å¸¸é«˜é¢‘çš„ Prompt éƒ½æ¨¡æ¿åŒ–</li>
<li>ç­‰ç†Ÿæ‚‰äº†å†å°è¯• SubAgentï¼ŒæŠŠ&quot;å‰ç½®è°ƒç ”&quot;ç±»ä»»åŠ¡å¤–åŒ…å‡ºå»</li>
<li>æœ€åç”¨ Skill æŠŠå›¢é˜Ÿçš„å¼€å‘æµç¨‹å›ºåŒ–ä¸‹æ¥ï¼Œé…åˆè„šæœ¬å®ç°æ›´å¤šè‡ªåŠ¨åŒ–</li>
<li>å¯¹äºå¤æ‚é“¾è·¯åœºæ™¯ï¼Œç»“åˆé£ä¹¦/Lark OpenAPIã€Context4Codeã€BAM API DOC ä¸‰å¤§å·¥å…·ï¼Œå»ºç«‹æ ‡å‡†åŒ–çš„SOPæ–‡æ¡£</li>
</ol>
<h3 id="å¤æ‚é“¾è·¯è§£å†³æ–¹æ¡ˆæ€»ç»“">å¤æ‚é“¾è·¯è§£å†³æ–¹æ¡ˆæ€»ç»“</h3>
<p>åœ¨å¤„ç†åç«¯å¤æ‚é“¾è·¯æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ol>
<li>
<p><strong>å·¥å…·ç»„åˆä½¿ç”¨</strong>ï¼šåˆ©ç”¨é£ä¹¦/Lark OpenAPIè·å–ä¸šåŠ¡æ–‡æ¡£ï¼ŒContext4CodeæŸ¥çœ‹ä»£ç å®ç°ï¼ŒBAM API DOCäº†è§£æœåŠ¡æ¥å£ï¼Œå½¢æˆå®Œæ•´çš„ä¿¡æ¯è·å–é—­ç¯</p>
</li>
<li>
<p><strong>æµç¨‹æ ‡å‡†åŒ–</strong>ï¼šé€šè¿‡Skillsåˆ›å»ºSOPæ–‡æ¡£ï¼Œæè¿°å…³é”®é“¾è·¯çš„ç»“æ„ã€æ¶‰åŠçš„æœåŠ¡ã€æ ¸å¿ƒå‡½æ•°å’Œæ•°æ®æµå‘ï¼Œä¸ºAIæä¾›æ¸…æ™°çš„åˆ†ææ¡†æ¶</p>
</li>
<li>
<p><strong>ä¸Šä¸‹æ–‡ç®¡ç†</strong>ï¼šä½¿ç”¨SubAgentçš„ç‹¬ç«‹ä¸Šä¸‹æ–‡èƒ½åŠ›ï¼Œå¤„ç†å¤æ‚é“¾è·¯åˆ†æä¸­çš„å¤§é‡ä¸­é—´ä¿¡æ¯ï¼Œåªå‘ä¸»Agentè¿”å›ç²¾ç‚¼çš„ç»“æœ</p>
</li>
<li>
<p><strong>çŸ¥è¯†æ²‰æ·€</strong>ï¼šå°†é“¾è·¯åˆ†æçš„ç»éªŒå’Œç»“æœæ²‰æ·€åˆ°Skillsä¸­ï¼Œå½¢æˆå›¢é˜Ÿå…±äº«çš„çŸ¥è¯†åº“ï¼Œæé«˜åç»­å¼€å‘çš„æ•ˆç‡</p>
</li>
</ol>
<p>æŠ€æœ¯ä¼šå˜ï¼Œæ¦‚å¿µä¼šè¿­ä»£ï¼Œä½†ã€Œæ ¹æ®åœºæ™¯é€‰å·¥å…·ã€çš„æ€è·¯ä¸ä¼šå˜ã€‚</p>
<p>ä¸å…¶çº ç»“å®šä¹‰ï¼Œä¸å¦‚é—®è‡ªå·±ï¼šæˆ‘ç°åœ¨è¦è§£å†³çš„æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿç„¶åé€‰æ‹©æœ€åˆé€‚çš„å·¥å…·ã€‚</p>
<p>å¯¹äºå¤æ‚é“¾è·¯çš„å¼€å‘å’Œæ’æŸ¥ï¼Œé€šè¿‡æœ¬æ–‡ä»‹ç»çš„å·¥å…·å’Œæ–¹æ³•ï¼Œä½ å¯ä»¥è®©AIæˆä¸ºä½ çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¤§å¹…æé«˜å·¥ä½œæ•ˆç‡ï¼Œå‡å°‘é”™è¯¯ç‡ã€‚</p>
<hr>
<blockquote>
<p>æ–‡ä¸­ Trae çš„ç‰ˆæœ¬ä¸º Beta ç‰ˆï¼Œéƒ¨åˆ†åŠŸèƒ½æ­£åœ¨é€æ­¥ä¸Šçº¿ä¸­ã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯é€šè¿‡ Trae æ¥ä»‹ç»æ¸…æ¥šå„ç§æ¦‚å¿µçš„å…³ç³»ä»¥åŠè®¾è®¡æ€è·¯ï¼Œæ€è·¯æœ¬èº«é€‚ç”¨äºæ‰€æœ‰ç±»ä¼¼çš„ AI Coding å·¥å…·ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>AIå·¥ç¨‹</category>
        <category>AI Coding</category>
      </categories>
      <tags>
        <tag>AI Coding</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>å·¥ç¨‹æ•ˆç‡</tag>
        <tag>Trae</tag>
        <tag>Skills</tag>
        <tag>SubAgent</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 530 - äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®ï¼ˆMinimum Absolute Difference in BSTï¼‰</title>
    <url>/2025/06/18/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-530-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E6%9C%80%E5%B0%8F%E7%BB%9D%E5%AF%B9%E5%B7%AE/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code>ï¼Œè¿”å› <strong>æ ‘ä¸­ä»»æ„ä¸¤ä¸åŒèŠ‚ç‚¹å€¼ä¹‹é—´çš„æœ€å°å·®å€¼</strong>ã€‚</p>
<p>å·®å€¼æ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œå…¶æ•°å€¼ç­‰äºä¸¤å€¼ä¹‹å·®çš„ç»å¯¹å€¼ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [4,2,6,1,3]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [1,0,48,null,null,12,49]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ <code>[2, 10^4]</code></li>
<li><code>0 &lt;= Node.val &lt;= 10^5</code></li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong> æœ¬é¢˜ä¸ 783 é¢˜ç›¸åŒã€‚</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ€è·¯æ˜¯åˆ©ç”¨ <strong>äºŒå‰æœç´¢æ ‘ä¸­åºéå†çš„æœ‰åºæ€§</strong>ã€‚</p>
<h3 id="å…³é”®æ´å¯Ÿ">å…³é”®æ´å¯Ÿ</h3>
<p><strong>äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†ç»“æœæ˜¯ä¸€ä¸ªæœ‰åºåºåˆ—</strong>ã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬æŒ‰ç…§ä¸­åºéå†è®¿é—®èŠ‚ç‚¹ï¼Œç›¸é‚»è®¿é—®çš„ä¸¤ä¸ªèŠ‚ç‚¹åœ¨æ•°å€¼ä¸Šä¹Ÿæ˜¯ç›¸é‚»çš„ï¼Œå› æ­¤æœ€å°å·®å€¼ä¸€å®šå‡ºç°åœ¨ç›¸é‚»çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´ã€‚</p>
<h3 id="ç®—æ³•æ€è·¯">ç®—æ³•æ€è·¯</h3>
<p>æˆ‘ä»¬ä¸éœ€è¦å°†ä¸­åºéå†çš„ç»“æœå­˜å‚¨åˆ°æ•°ç»„ä¸­ï¼Œè€Œæ˜¯å¯ä»¥åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼š</p>
<ol>
<li>ä½¿ç”¨ä¸€ä¸ª <code>prev</code> æŒ‡é’ˆè®°å½•å‰ä¸€ä¸ªè®¿é—®çš„èŠ‚ç‚¹</li>
<li>ä½¿ç”¨ä¸€ä¸ª <code>cur</code> æŒ‡é’ˆè®°å½•å½“å‰è®¿é—®çš„èŠ‚ç‚¹</li>
<li>åœ¨æ¯æ¬¡è®¿é—®å½“å‰èŠ‚ç‚¹æ—¶ï¼Œè®¡ç®—ä¸å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å·®å€¼</li>
<li>ç»´æŠ¤ä¸€ä¸ªå…¨å±€æœ€å°å€¼</li>
</ol>
<h3 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</h3>
<ol>
<li><strong>åˆå§‹åŒ–</strong>ï¼šè®¾ç½®æœ€å°å€¼ä¸ºæœ€å¤§æ•´æ•°ï¼Œå‰é©±èŠ‚ç‚¹ä¸ºç©º</li>
<li><strong>ä¸­åºéå†</strong>ï¼šå·¦ â†’ æ ¹ â†’ å³çš„é¡ºåºè®¿é—®</li>
<li><strong>å¤„ç†å½“å‰èŠ‚ç‚¹</strong>ï¼š
<ul>
<li>å¦‚æœå‰é©±èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œè®¡ç®—å·®å€¼å¹¶æ›´æ–°æœ€å°å€¼</li>
<li>å°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºå‰é©±èŠ‚ç‚¹</li>
</ul>
</li>
<li><strong>ç»§ç»­éå†å³å­æ ‘</strong></li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="ä¸­åºéå†çš„å®ç°">ä¸­åºéå†çš„å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfs</span><span class="params">(node *TreeNode)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    dfs(node.Left)   <span class="comment">// éå†å·¦å­æ ‘</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    cur = node</span><br><span class="line">    <span class="keyword">if</span> prev != <span class="literal">nil</span> &#123;</span><br><span class="line">        minVal = min(minVal, <span class="type">int</span>(math.Abs(<span class="type">float64</span>(prev.Val)-<span class="type">float64</span>(cur.Val))))</span><br><span class="line">    &#125;</span><br><span class="line">    prev = cur</span><br><span class="line">    </span><br><span class="line">    dfs(node.Right)  <span class="comment">// éå†å³å­æ ‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­åºéå†ï¼Ÿ">ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­åºéå†ï¼Ÿ</h3>
<p>å¯¹äºäºŒå‰æœç´¢æ ‘ <code>[4,2,6,1,3]</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    4</span><br><span class="line">   / \</span><br><span class="line">  2   6</span><br><span class="line"> / \</span><br><span class="line">1   3</span><br></pre></td></tr></table></figure>
<p>ä¸­åºéå†åºåˆ—ï¼š<code>1 â†’ 2 â†’ 3 â†’ 4 â†’ 6</code></p>
<p>è¿™æ˜¯ä¸€ä¸ªæœ‰åºåºåˆ—ï¼Œæœ€å°å·®å€¼åªå¯èƒ½å‡ºç°åœ¨ç›¸é‚»å…ƒç´ ä¹‹é—´ï¼š</p>
<ul>
<li>|2-1| = 1</li>
<li>|3-2| = 1</li>
<li>|4-3| = 1</li>
<li>|6-4| = 2</li>
</ul>
<p>æ‰€ä»¥æœ€å°å·®å€¼æ˜¯ 1ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMinimumDifference</span><span class="params">(root *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    minVal := math.MaxInt32</span><br><span class="line">    <span class="keyword">var</span> prev, cur *TreeNode</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(node *TreeNode)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(node *TreeNode)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        dfs(node.Left)   <span class="comment">// éå†å·¦å­æ ‘</span></span><br><span class="line">        </span><br><span class="line">        cur = node</span><br><span class="line">        <span class="keyword">if</span> prev != <span class="literal">nil</span> &#123;</span><br><span class="line">            minVal = min(minVal, <span class="type">int</span>(math.Abs(<span class="type">float64</span>(prev.Val)-<span class="type">float64</span>(cur.Val))))</span><br><span class="line">        &#125;</span><br><span class="line">        prev = cur</span><br><span class="line">        </span><br><span class="line">        dfs(node.Right)  <span class="comment">// éå†å³å­æ ‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    dfs(root)</span><br><span class="line">    <span class="keyword">return</span> minVal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ <code>[4,2,6,1,3]</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è®¿é—®é¡ºåºï¼š1 â†’ 2 â†’ 3 â†’ 4 â†’ 6</span><br><span class="line"></span><br><span class="line">1. è®¿é—®èŠ‚ç‚¹1ï¼šprev=nil, cur=1, prev=1</span><br><span class="line">2. è®¿é—®èŠ‚ç‚¹2ï¼šprev=1, cur=2, è®¡ç®—|2-1|=1, minVal=1, prev=2</span><br><span class="line">3. è®¿é—®èŠ‚ç‚¹3ï¼šprev=2, cur=3, è®¡ç®—|3-2|=1, minVal=1, prev=3  </span><br><span class="line">4. è®¿é—®èŠ‚ç‚¹4ï¼šprev=3, cur=4, è®¡ç®—|4-3|=1, minVal=1, prev=4</span><br><span class="line">5. è®¿é—®èŠ‚ç‚¹6ï¼šprev=4, cur=6, è®¡ç®—|6-4|=2, minVal=1, prev=6</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœï¼š1</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(n)$</p>
<ul>
<li>éœ€è¦è®¿é—®æ¯ä¸ªèŠ‚ç‚¹ä¸€æ¬¡ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡</li>
</ul>
<p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(h)$</p>
<ul>
<li>é€’å½’è°ƒç”¨çš„æ ˆæ·±åº¦ç­‰äºæ ‘çš„é«˜åº¦ h</li>
<li>æœ€åæƒ…å†µä¸‹ï¼ˆé€€åŒ–ä¸ºé“¾è¡¨ï¼‰ï¼š$O(n)$</li>
<li>æœ€å¥½æƒ…å†µä¸‹ï¼ˆå¹³è¡¡æ ‘ï¼‰ï¼š$O(\log n)$</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>BST æ€§è´¨çš„åº”ç”¨</strong>ï¼šäºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†äº§ç”Ÿæœ‰åºåºåˆ—ï¼Œè¿™æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®</li>
<li><strong>ç©ºé—´ä¼˜åŒ–</strong>ï¼šä¸éœ€è¦é¢å¤–æ•°ç»„å­˜å‚¨éå†ç»“æœï¼Œä¸€æ¬¡éå†å³å¯å®Œæˆ</li>
<li><strong>ç®—æ³•æ¨¡å¼</strong>ï¼šè¿™ç§&quot;åœ¨éå†è¿‡ç¨‹ä¸­ç»´æŠ¤å‰é©±èŠ‚ç‚¹&quot;çš„æ¨¡å¼åœ¨å¾ˆå¤šæ ‘é—®é¢˜ä¸­éƒ½å¾ˆæœ‰ç”¨</li>
<li><strong>ç›¸å…³é—®é¢˜</strong>ï¼š
<ul>
<li>LeetCode 783: äºŒå‰æœç´¢æ ‘èŠ‚ç‚¹æœ€å°è·ç¦»ï¼ˆå®Œå…¨ç›¸åŒï¼‰</li>
<li>LeetCode 98: éªŒè¯äºŒå‰æœç´¢æ ‘</li>
<li>LeetCode 230: äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ </li>
</ul>
</li>
</ol>
<h2 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h2>
<ol>
<li><strong>å¿˜è®°åˆå§‹åŒ–</strong>ï¼š<code>prev</code> å¿…é¡»åˆå§‹åŒ–ä¸º <code>nil</code></li>
<li><strong>ç±»å‹è½¬æ¢</strong>ï¼šGo ä¸­éœ€è¦å°† <code>int</code> è½¬æ¢ä¸º <code>float64</code> æ‰èƒ½ä½¿ç”¨ <code>math.Abs</code></li>
<li><strong>éå†é¡ºåº</strong>ï¼šå¿…é¡»æ˜¯ä¸­åºéå†ï¼Œå…¶ä»–éå†æ–¹å¼æ— æ³•ä¿è¯æœ‰åºæ€§</li>
</ol>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>äºŒå‰æœç´¢æ ‘</tag>
        <tag>ä¸­åºéå†</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£Goè¯­è¨€å¹¶å‘è°ƒåº¦å™¨GMPæ¨¡å‹</title>
    <url>/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/</url>
    <content><![CDATA[<h1>æ·±å…¥ç†è§£Goè¯­è¨€å¹¶å‘è°ƒåº¦å™¨GMPæ¨¡å‹</h1>
<h2 id="ğŸ“–-æ¦‚è¿°">ğŸ“– æ¦‚è¿°</h2>
<p>Goè¯­è¨€çš„å¹¶å‘èƒ½åŠ›æ˜¯å…¶æœ€å¤§çš„ç‰¹è‰²ä¹‹ä¸€ï¼Œè€Œè¿™ä¸€åˆ‡éƒ½å½’åŠŸäºå…¶å¼ºå¤§çš„è°ƒåº¦å™¨ç³»ç»Ÿã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æGoè¯­è¨€çš„GMPè°ƒåº¦å™¨æ¨¡å‹ï¼Œä»å†å²æ¼”è¿›åˆ°æ ¸å¿ƒåŸç†ï¼Œå†åˆ°å®é™…è°ƒåº¦åœºæ™¯ï¼Œå¸®åŠ©ä½ å…¨é¢ç†è§£Goè¯­è¨€å¹¶å‘ç¼–ç¨‹çš„åº•å±‚æœºåˆ¶ã€‚</p>
<h2 id="ğŸ¯-å­¦ä¹ ç›®æ ‡">ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>
<p>é˜…è¯»æœ¬æ–‡åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>ç†è§£Goè°ƒåº¦å™¨çš„å‘å±•å†ç¨‹å’Œè®¾è®¡æ€æƒ³</li>
<li>æŒæ¡GMPæ¨¡å‹çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†</li>
<li>äº†è§£Goroutineçš„è°ƒåº¦åœºæ™¯å’Œç”Ÿå‘½å‘¨æœŸ</li>
<li>å…·å¤‡å›ç­”ç›¸å…³é¢è¯•é—®é¢˜çš„èƒ½åŠ›</li>
</ul>
<h2 id="ğŸ—ï¸-ç¬¬ä¸€ç« ï¼šGoè°ƒåº¦å™¨çš„å†å²æ¼”è¿›">ğŸ—ï¸ ç¬¬ä¸€ç« ï¼šGoè°ƒåº¦å™¨çš„å†å²æ¼”è¿›</h2>
<h3 id="1-1-å•è¿›ç¨‹æ—¶ä»£çš„å›°å¢ƒ">1.1 å•è¿›ç¨‹æ—¶ä»£çš„å›°å¢ƒ</h3>
<p>åœ¨è®¡ç®—æœºå‘å±•æ—©æœŸï¼Œæ“ä½œç³»ç»Ÿåªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºï¼Œç›´åˆ°ç¨‹åºè¿è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªç¨‹åºã€‚è¿™ç§<strong>ä¸²è¡Œæ‰§è¡Œ</strong>çš„æ–¹å¼å¸¦æ¥äº†ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š</p>
<ol>
<li><strong>æ‰§è¡Œæ•ˆç‡ä½</strong>ï¼šåªèƒ½ä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡åœ°å¤„ç†</li>
<li><strong>CPUèµ„æºæµªè´¹</strong>ï¼šå½“è¿›ç¨‹å› IOç­‰æ“ä½œé˜»å¡æ—¶ï¼ŒCPUå¤„äºç©ºé—²çŠ¶æ€</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750165896833.png" alt="å•è¿›ç¨‹æ—¶ä»£"></p>
<h3 id="1-2-å¤šè¿›ç¨‹-å¤šçº¿ç¨‹çš„æ”¹è¿›ä¸æ–°é—®é¢˜">1.2 å¤šè¿›ç¨‹/å¤šçº¿ç¨‹çš„æ”¹è¿›ä¸æ–°é—®é¢˜</h3>
<p>ä¸ºäº†è§£å†³å•è¿›ç¨‹çš„é—®é¢˜ï¼Œæ“ä½œç³»ç»Ÿå¼•å…¥äº†<strong>å¤šè¿›ç¨‹</strong>å’Œ<strong>å¤šçº¿ç¨‹</strong>æœºåˆ¶ï¼š</p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750165911410.png" alt="å¤šè¿›ç¨‹å¤šçº¿ç¨‹"></p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>å½“ä¸€ä¸ªè¿›ç¨‹é˜»å¡æ—¶ï¼ŒCPUå¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹ç»§ç»­æ‰§è¡Œ</li>
<li>å®è§‚ä¸Šå®ç°äº†å¹¶å‘æ‰§è¡Œ</li>
</ul>
<p><strong>æ–°çš„é—®é¢˜</strong>ï¼š</p>
<ul>
<li><strong>èµ„æºæ¶ˆè€—å¤§</strong>ï¼šæ¯ä¸ªè¿›ç¨‹å ç”¨4GBè™šæ‹Ÿå†…å­˜ï¼Œçº¿ç¨‹ä¹Ÿéœ€è¦çº¦4MBå†…å­˜</li>
<li><strong>åˆ‡æ¢æˆæœ¬é«˜</strong>ï¼šè¿›ç¨‹/çº¿ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢ã€é”€æ¯éƒ½éœ€è¦å¤§é‡æ—¶é—´</li>
<li><strong>è°ƒåº¦å¼€é”€å¤§</strong>ï¼šCPUå¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´ç”¨äºè¿›ç¨‹è°ƒåº¦</li>
</ul>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750165922867.png" alt="è¿›ç¨‹çº¿ç¨‹è°ƒåº¦"></p>
<h3 id="1-3-åç¨‹ï¼šè½»é‡çº§çš„è§£å†³æ–¹æ¡ˆ">1.3 åç¨‹ï¼šè½»é‡çº§çš„è§£å†³æ–¹æ¡ˆ</h3>
<h4 id="ç”¨æˆ·æ€çº¿ç¨‹-vs-å†…æ ¸æ€çº¿ç¨‹">ç”¨æˆ·æ€çº¿ç¨‹ vs å†…æ ¸æ€çº¿ç¨‹</h4>
<p>å·¥ç¨‹å¸ˆä»¬å‘ç°å¯ä»¥å°†çº¿ç¨‹åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li><strong>å†…æ ¸æ€çº¿ç¨‹</strong>ï¼šç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†ï¼ŒCPUç›´æ¥è°ƒåº¦</li>
<li><strong>ç”¨æˆ·æ€çº¿ç¨‹ï¼ˆåç¨‹ï¼‰</strong>ï¼šç”±ç”¨æˆ·ç¨‹åºç®¡ç†ï¼Œå¿…é¡»ç»‘å®šåˆ°å†…æ ¸æ€çº¿ç¨‹ä¸Šè¿è¡Œ</li>
</ul>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750165936977.png" alt="ç”¨æˆ·æ€ä¸å†…æ ¸æ€çº¿ç¨‹"></p>
<h4 id="ä¸‰ç§åç¨‹-çº¿ç¨‹æ˜ å°„æ¨¡å‹">ä¸‰ç§åç¨‹-çº¿ç¨‹æ˜ å°„æ¨¡å‹</h4>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750165957203.png" alt="åç¨‹çº¿ç¨‹æ˜ å°„"></p>
<h5 id="N-1-æ¨¡å‹">N:1 æ¨¡å‹</h5>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šNä¸ªåç¨‹ç»‘å®š1ä¸ªçº¿ç¨‹</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šåç¨‹åˆ‡æ¢åœ¨ç”¨æˆ·æ€å®Œæˆï¼Œåˆ‡æ¢æˆæœ¬æä½</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š
<ul>
<li>æ— æ³•åˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿</li>
<li>ä¸€ä¸ªåç¨‹é˜»å¡ä¼šå¯¼è‡´æ‰€æœ‰åç¨‹é˜»å¡</li>
</ul>
</li>
</ul>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166007486.png" alt="N:1æ¨¡å‹"></p>
<h5 id="1-1-æ¨¡å‹">1:1 æ¨¡å‹</h5>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼š1ä¸ªåç¨‹ç»‘å®š1ä¸ªçº¿ç¨‹</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•ï¼Œä¸å­˜åœ¨N:1æ¨¡å‹çš„ç¼ºç‚¹</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šåç¨‹åˆ›å»ºã€åˆ é™¤ã€åˆ‡æ¢çš„ä»£ä»·ä¸çº¿ç¨‹ç›¸åŒï¼Œæˆæœ¬è¾ƒé«˜</li>
</ul>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166026834.png" alt="1:1æ¨¡å‹"></p>
<h5 id="M-N-æ¨¡å‹">M:N æ¨¡å‹</h5>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šMä¸ªåç¨‹ç»‘å®šNä¸ªçº¿ç¨‹</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç»“åˆäº†N:1å’Œ1:1æ¨¡å‹çš„ä¼˜åŠ¿</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå®ç°å¤æ‚åº¦æœ€é«˜</li>
</ul>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166037159.png" alt="M:Næ¨¡å‹"></p>
<blockquote>
<p>ğŸ’¡ <strong>å…³é”®åŒºåˆ«</strong>ï¼šåç¨‹æ˜¯<strong>åä½œå¼è°ƒåº¦</strong>ï¼ˆéœ€è¦ä¸»åŠ¨è®©å‡ºCPUï¼‰ï¼Œçº¿ç¨‹æ˜¯<strong>æŠ¢å å¼è°ƒåº¦</strong>ï¼ˆç”±CPUå¼ºåˆ¶åˆ‡æ¢ï¼‰</p>
</blockquote>
<h3 id="1-4-Goè¯­è¨€çš„Goroutine">1.4 Goè¯­è¨€çš„Goroutine</h3>
<p>Goè¯­è¨€é‡‡ç”¨äº†M:Næ¨¡å‹ï¼Œå¹¶ç§°å…¶è½»é‡çº§çº¿ç¨‹ä¸º<strong>Goroutine</strong>ï¼š</p>
<p><strong>Goroutineç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>å†…å­˜å ç”¨å°</strong>ï¼šåˆå§‹æ ˆåªæœ‰å‡ KB</li>
<li><strong>åŠ¨æ€æ‰©å±•</strong>ï¼šruntimeä¼šæ ¹æ®éœ€è¦è‡ªåŠ¨æ‰©å±•æ ˆç©ºé—´</li>
<li><strong>è°ƒåº¦çµæ´»</strong>ï¼šç”±Go runtimeè€ŒéOSè°ƒåº¦</li>
<li><strong>å¹¶å‘èƒ½åŠ›å¼º</strong>ï¼šæ”¯æŒæ•°ä¸‡ç”šè‡³æ•°åä¸‡ä¸ªGoroutine</li>
</ul>
<h3 id="1-5-æ—§è°ƒåº¦å™¨çš„é—®é¢˜">1.5 æ—§è°ƒåº¦å™¨çš„é—®é¢˜</h3>
<p>Goæœ€åˆçš„è°ƒåº¦å™¨å­˜åœ¨ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼š</p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166093219.png" alt="æ—§è°ƒåº¦å™¨æ¶æ„"></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166100261.png" alt="æ—§è°ƒåº¦å™¨å®ç°"></p>
<p><strong>ä¸»è¦é—®é¢˜</strong>ï¼š</p>
<ol>
<li><strong>é”ç«äº‰æ¿€çƒˆ</strong>ï¼šæ‰€æœ‰Méƒ½éœ€è¦è®¿é—®å…¨å±€Gé˜Ÿåˆ—ï¼Œéœ€è¦åŠ é”ä¿æŠ¤</li>
<li><strong>å±€éƒ¨æ€§å·®</strong>ï¼šæ–°åˆ›å»ºçš„Gè¢«åˆ†é…ç»™å…¶ä»–Mæ‰§è¡Œï¼Œç¼ºä¹å±€éƒ¨æ€§</li>
<li><strong>ç³»ç»Ÿè°ƒç”¨å¼€é”€å¤§</strong>ï¼šé¢‘ç¹çš„çº¿ç¨‹é˜»å¡å’Œå”¤é†’å¢åŠ ç³»ç»Ÿå¼€é”€</li>
</ol>
<h2 id="ğŸ”§-ç¬¬äºŒç« ï¼šGMPæ¨¡å‹çš„è®¾è®¡ä¸å®ç°">ğŸ”§ ç¬¬äºŒç« ï¼šGMPæ¨¡å‹çš„è®¾è®¡ä¸å®ç°</h2>
<h3 id="2-1-GMPæ¨¡å‹æ ¸å¿ƒæ¦‚å¿µ">2.1 GMPæ¨¡å‹æ ¸å¿ƒæ¦‚å¿µ</h3>
<p>ä¸ºäº†è§£å†³æ—§è°ƒåº¦å™¨çš„é—®é¢˜ï¼ŒGoåœ¨2012å¹´é‡æ–°è®¾è®¡äº†è°ƒåº¦å™¨ï¼Œå¼•å…¥äº†<strong>P</strong>ï¼ˆ<strong>Processor</strong>ï¼‰çš„æ¦‚å¿µï¼š</p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166111531.png" alt="GMPæ¨¡å‹"></p>
<h4 id="æ ¸å¿ƒç»„ä»¶å®šä¹‰">æ ¸å¿ƒç»„ä»¶å®šä¹‰</h4>
<p><strong>G (Goroutine)</strong>ï¼š</p>
<ul>
<li>ä»£è¡¨ä¸€ä¸ªGoroutine</li>
<li>åŒ…å«å‡½æ•°æŒ‡é’ˆã€æ ˆä¿¡æ¯ã€çŠ¶æ€ç­‰</li>
<li>æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½</li>
</ul>
<p><strong>M (Machine)</strong>ï¼š</p>
<ul>
<li>ä»£è¡¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹</li>
<li>è´Ÿè´£æ‰§è¡ŒGoroutine</li>
<li>å¿…é¡»ç»‘å®šPæ‰èƒ½è¿è¡ŒG</li>
</ul>
<p><strong>P (Processor)</strong>ï¼š</p>
<ul>
<li>é€»è¾‘å¤„ç†å™¨ï¼ŒåŒ…å«è¿è¡ŒGoroutineæ‰€éœ€çš„èµ„æº</li>
<li>ç»´æŠ¤æœ¬åœ°Goroutineé˜Ÿåˆ—</li>
<li>æ•°é‡ç”±GOMAXPROCSå†³å®š</li>
</ul>
<h4 id="GMPæ¨¡å‹æ¶æ„">GMPæ¨¡å‹æ¶æ„</h4>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166119273.png" alt="GMPæ¶æ„è¯¦è§£"></p>
<p><strong>ä¸»è¦ç»„ä»¶</strong>ï¼š</p>
<ol>
<li><strong>å…¨å±€é˜Ÿåˆ—</strong>ï¼šå­˜æ”¾ç­‰å¾…è¿è¡Œçš„G</li>
<li><strong>Pçš„æœ¬åœ°é˜Ÿåˆ—</strong>ï¼šå­˜æ”¾ç­‰å¾…è¿è¡Œçš„Gï¼Œå®¹é‡é™åˆ¶ä¸º256ä¸ª</li>
<li><strong>Påˆ—è¡¨</strong>ï¼šæ‰€æœ‰Påœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œæ•°é‡ä¸ºGOMAXPROCS</li>
<li><strong>M</strong>ï¼šå·¥ä½œçº¿ç¨‹ï¼Œéœ€è¦è·å–Pæ‰èƒ½è¿è¡ŒG</li>
</ol>
<h3 id="2-2-På’ŒMçš„æ•°é‡å…³ç³»">2.2 På’ŒMçš„æ•°é‡å…³ç³»</h3>
<h4 id="Pçš„æ•°é‡">Pçš„æ•°é‡</h4>
<ul>
<li>ç”±ç¯å¢ƒå˜é‡<code>GOMAXPROCS</code>æˆ–<code>runtime.GOMAXPROCS()</code>å†³å®š</li>
<li>é€šå¸¸è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°</li>
<li>åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ä¿æŒä¸å˜</li>
</ul>
<h4 id="Mçš„æ•°é‡">Mçš„æ•°é‡</h4>
<ul>
<li><strong>é»˜è®¤ä¸Šé™</strong>ï¼š10000ä¸ªï¼ˆé€šå¸¸è¾¾ä¸åˆ°ï¼‰</li>
<li><strong>åŠ¨æ€åˆ›å»º</strong>ï¼šå½“ç°æœ‰Méƒ½é˜»å¡æ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„M</li>
<li><strong>å¯é…ç½®</strong>ï¼šé€šè¿‡<code>runtime/debug.SetMaxThreads()</code>è®¾ç½®</li>
</ul>
<blockquote>
<p>ğŸ“Œ <strong>é‡è¦æç¤º</strong>ï¼šMçš„æ•°é‡ä¸å›ºå®šï¼Œä¼šæ ¹æ®è¿è¡Œæ—¶éœ€è¦åŠ¨æ€è°ƒæ•´</p>
</blockquote>
<h4 id="På’ŒMçš„åˆ›å»ºæ—¶æœº">På’ŒMçš„åˆ›å»ºæ—¶æœº</h4>
<p><strong>Pçš„åˆ›å»º</strong>ï¼šåœ¨ç¡®å®šæœ€å¤§æ•°é‡åï¼Œè¿è¡Œæ—¶ç³»ç»Ÿåˆ›å»ºå¯¹åº”æ•°é‡çš„P</p>
<p><strong>Mçš„åˆ›å»º</strong>ï¼šå½“æ²¡æœ‰è¶³å¤Ÿçš„Mæ¥å…³è”På¹¶è¿è¡ŒGæ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„M</p>
<h3 id="2-3-è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥">2.3 è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥</h3>
<h4 id="å¤ç”¨çº¿ç¨‹">å¤ç”¨çº¿ç¨‹</h4>
<ol>
<li>
<p><strong>Work Stealingï¼ˆå·¥ä½œçªƒå–ï¼‰</strong>ï¼š</p>
<ul>
<li>å½“æœ¬çº¿ç¨‹çš„Pé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä»å…¶ä»–På·å–G</li>
<li>é¿å…äº†çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€</li>
</ul>
</li>
<li>
<p><strong>Hand Offï¼ˆç§»äº¤ï¼‰</strong>ï¼š</p>
<ul>
<li>å½“çº¿ç¨‹å› ç³»ç»Ÿè°ƒç”¨é˜»å¡æ—¶ï¼Œå°†Pç§»äº¤ç»™å…¶ä»–ç©ºé—²çº¿ç¨‹</li>
<li>ä¿è¯Pä¸­çš„å…¶ä»–Gèƒ½ç»§ç»­æ‰§è¡Œ</li>
</ul>
</li>
</ol>
<h4 id="åˆ©ç”¨å¹¶è¡Œ">åˆ©ç”¨å¹¶è¡Œ</h4>
<ul>
<li>é€šè¿‡<code>GOMAXPROCS</code>æ§åˆ¶å¹¶è¡Œåº¦</li>
<li>æœ€å¤šæœ‰<code>GOMAXPROCS</code>ä¸ªçº¿ç¨‹åŒæ—¶åœ¨ä¸åŒCPUæ ¸å¿ƒä¸Šè¿è¡Œ</li>
</ul>
<h4 id="æŠ¢å å¼è°ƒåº¦">æŠ¢å å¼è°ƒåº¦</h4>
<ul>
<li>Goroutineæœ€å¤šè¿ç»­è¿è¡Œ10ms</li>
<li>é˜²æ­¢æŸä¸ªGoroutineé•¿æ—¶é—´å ç”¨CPUï¼Œå¯¼è‡´å…¶ä»–Goroutineé¥¿æ­»</li>
<li>è¿™æ˜¯Goroutineä¸ä¼ ç»Ÿåç¨‹çš„é‡è¦åŒºåˆ«</li>
</ul>
<h4 id="è°ƒåº¦å™¨æŸ¥æ‰¾Gçš„ä¼˜å…ˆçº§é¡ºåº">è°ƒåº¦å™¨æŸ¥æ‰¾Gçš„ä¼˜å…ˆçº§é¡ºåº</h4>
<p>å½“Méœ€è¦æ‰§è¡Œæ–°çš„Goroutineæ—¶ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ï¼š</p>
<ol>
<li><strong>Pçš„æœ¬åœ°é˜Ÿåˆ—</strong>ï¼šæœ€é«˜ä¼˜å…ˆçº§ï¼Œæ— é”è®¿é—®ï¼Œæ€§èƒ½æœ€ä½³</li>
<li><strong>å…¨å±€é˜Ÿåˆ—</strong>ï¼šä¸­ç­‰ä¼˜å…ˆçº§ï¼Œæ¯61æ¬¡è°ƒåº¦æ£€æŸ¥ä¸€æ¬¡ï¼Œéœ€è¦åŠ é”</li>
<li><strong>ç½‘ç»œè½®è¯¢å™¨(netpoll)</strong>ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œI/Oå°±ç»ªçš„G</li>
<li><strong>Work Stealing</strong>ï¼šæœ€åæ‰‹æ®µï¼Œä»å…¶ä»–Pçš„æœ¬åœ°é˜Ÿåˆ—å·å–G</li>
</ol>
<p>è¿™ä¸ªè®¾è®¡ä¿è¯äº†ï¼š</p>
<ul>
<li>ğŸš€ <strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼šæœ¬åœ°é˜Ÿåˆ—æ— é”è®¿é—®</li>
<li>âš–ï¸ <strong>å…¬å¹³è°ƒåº¦</strong>ï¼šå®šæœŸæ£€æŸ¥å…¨å±€é˜Ÿåˆ—é˜²æ­¢é¥¥é¥¿</li>
<li>ğŸ’ª <strong>è´Ÿè½½å‡è¡¡</strong>ï¼šwork stealingæœºåˆ¶åˆ†æ•£è´Ÿè½½</li>
<li>ğŸ”„ <strong>èµ„æºåˆ©ç”¨</strong>ï¼šnetpollæé«˜I/Oå¯†é›†å‹ç¨‹åºæ•ˆç‡</li>
</ul>
<h2 id="ğŸ”„-ç¬¬ä¸‰ç« ï¼šGoroutineè°ƒåº¦æµç¨‹è¯¦è§£">ğŸ”„ ç¬¬ä¸‰ç« ï¼šGoroutineè°ƒåº¦æµç¨‹è¯¦è§£</h2>
<h3 id="3-1-åˆ›å»ºGoroutineçš„æµç¨‹">3.1 åˆ›å»ºGoroutineçš„æµç¨‹</h3>
<p>å½“æˆ‘ä»¬ä½¿ç”¨<code>go func()</code>åˆ›å»ºGoroutineæ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166136097.png" alt="åˆ›å»ºGoroutineæµç¨‹"></p>
<p><strong>è¯¦ç»†æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>é€šè¿‡<code>go func()</code>åˆ›å»ºæ–°çš„Goroutineï¼ˆG2ï¼‰</li>
<li>æ–°Gä¼˜å…ˆåŠ å…¥å½“å‰Pçš„æœ¬åœ°é˜Ÿåˆ—</li>
<li>å¦‚æœæœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œæ‰§è¡Œè´Ÿè½½å‡è¡¡ï¼Œå°†éƒ¨åˆ†Gç§»è‡³å…¨å±€é˜Ÿåˆ—</li>
<li>Mä»Pçš„æœ¬åœ°é˜Ÿåˆ—è·å–Gæ‰§è¡Œ</li>
<li>å¦‚æœæœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œå…ˆä»å…¨å±€é˜Ÿåˆ—è·å–G</li>
<li>å¦‚æœå…¨å±€é˜Ÿåˆ—ä¹Ÿä¸ºç©ºï¼Œå†å°è¯•ä»å…¶ä»–Pçªƒå–G</li>
</ol>
<p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li><strong>å¾ªç¯è°ƒåº¦</strong>ï¼šMè°ƒåº¦Gæ‰§è¡Œæ˜¯ä¸€ä¸ªå¾ªç¯è¿‡ç¨‹</li>
<li><strong>ç³»ç»Ÿè°ƒç”¨å¤„ç†</strong>ï¼šå½“Gè¿›è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒMä¼šè¢«æ‘˜é™¤ï¼Œåˆ›å»ºæ–°MæœåŠ¡P</li>
<li><strong>Pçš„å¤ç”¨</strong>ï¼šç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼ŒGå°è¯•è·å–ç©ºé—²Pç»§ç»­æ‰§è¡Œ</li>
</ul>
<h3 id="3-2-è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ">3.2 è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166152945.png" alt="è°ƒåº¦å™¨ç”Ÿå‘½å‘¨æœŸ"></p>
<h4 id="ç‰¹æ®Šçš„M0å’ŒG0">ç‰¹æ®Šçš„M0å’ŒG0</h4>
<p><strong>M0</strong>ï¼š</p>
<ul>
<li>ç¨‹åºå¯åŠ¨åçš„ä¸»çº¿ç¨‹</li>
<li>è´Ÿè´£æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</li>
<li>å¯åŠ¨ç¬¬ä¸€ä¸ªGoroutineåä¸æ™®é€šMæ— å¼‚</li>
</ul>
<p><strong>G0</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªMéƒ½æœ‰ä¸€ä¸ªG0</li>
<li>ä¸“é—¨è´Ÿè´£è°ƒåº¦å·¥ä½œ</li>
<li>ä¸æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œåªå¤„ç†è°ƒåº¦é€»è¾‘</li>
</ul>
<h4 id="è°ƒåº¦å™¨å¯åŠ¨æµç¨‹">è°ƒåº¦å™¨å¯åŠ¨æµç¨‹</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç çš„æ‰§è¡Œæµç¨‹ï¼š</p>
<ol>
<li>åˆ›å»ºM0å’ŒG0ï¼Œå»ºç«‹å…³è”</li>
<li>åˆå§‹åŒ–è°ƒåº¦å™¨ï¼šåˆ›å»ºPåˆ—è¡¨ã€è®¾ç½®GOMAXPROCSç­‰</li>
<li>ä¸º<code>runtime.main</code>åˆ›å»ºmain goroutine</li>
<li>å¯åŠ¨M0ï¼Œå¼€å§‹è°ƒåº¦å¾ªç¯</li>
<li>æ‰§è¡Œç”¨æˆ·çš„<code>main.main</code>å‡½æ•°</li>
<li>ç¨‹åºç»“æŸï¼Œæ¸…ç†èµ„æº</li>
</ol>
<h2 id="ğŸ“Š-ç¬¬å››ç« ï¼šå¯è§†åŒ–GMPè°ƒåº¦">ğŸ“Š ç¬¬å››ç« ï¼šå¯è§†åŒ–GMPè°ƒåº¦</h2>
<h3 id="4-1-ä½¿ç”¨go-tool-trace">4.1 ä½¿ç”¨go tool trace</h3>
<p>åˆ›å»ºtraceç¤ºä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime/trace&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºtraceæ–‡ä»¶</span></span><br><span class="line">    f, err := os.Create(<span class="string">&quot;trace.out&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯åŠ¨trace</span></span><br><span class="line">    err = trace.Start(f)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> trace.Stop()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»è¦é€»è¾‘</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œç¨‹åºç”Ÿæˆtraceæ–‡ä»¶</span></span><br><span class="line">go run trace.go</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ætraceæ–‡ä»¶</span></span><br><span class="line">go tool trace trace.out</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166198901.png" alt="Traceåˆ†æç•Œé¢"></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166205460.png" alt="Traceè¯¦ç»†è§†å›¾"></p>
<p><strong>ä¿¡æ¯è§£è¯»</strong>ï¼š</p>
<ul>
<li><strong>Gä¿¡æ¯</strong>ï¼šå¯ä»¥çœ‹åˆ°Goroutineçš„è¿è¡ŒçŠ¶æ€å’Œåˆ‡æ¢è¿‡ç¨‹</li>
<li><strong>Mä¿¡æ¯</strong>ï¼šæ˜¾ç¤ºçº¿ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨æƒ…å†µ</li>
<li><strong>Pä¿¡æ¯</strong>ï¼šå±•ç¤ºå¤„ç†å™¨çš„å·¥ä½œè´Ÿè½½åˆ†å¸ƒ</li>
</ul>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166212597.png" alt="Gä¿¡æ¯è¯¦æƒ…"><br>
<img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166219787.png" alt="Mä¿¡æ¯è¯¦æƒ…"><br>
<img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166245678.png" alt="Pä¿¡æ¯è¯¦æƒ…"><br>
<img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166252879.png" alt="åŠ¨æ€Måˆ›å»º"><br>
<img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166258618.png" alt="M2è¯¦æƒ…"></p>
<h3 id="4-2-ä½¿ç”¨GODEBUGè°ƒè¯•">4.2 ä½¿ç”¨GODEBUGè°ƒè¯•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        time.Sleep(time.Second)</span><br><span class="line">        fmt.Println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿è¡Œå‘½ä»¤</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GODEBUG=schedtrace=1000 ./program</span><br></pre></td></tr></table></figure>
<p><strong>è¾“å‡ºè§£é‡Š</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SCHED 0ms: gomaxprocs=2 idleprocs=0 threads=4 spinningthreads=1 idlethreads=1 runqueue=0 [0 0]</span><br></pre></td></tr></table></figure>
<ul>
<li><code>gomaxprocs=2</code>ï¼šPçš„æ•°é‡</li>
<li><code>idleprocs=0</code>ï¼šç©ºé—²Pçš„æ•°é‡</li>
<li><code>threads=4</code>ï¼šMçš„æ€»æ•°é‡</li>
<li><code>spinningthreads=1</code>ï¼šè‡ªæ—‹Mçš„æ•°é‡</li>
<li><code>runqueue=0</code>ï¼šå…¨å±€é˜Ÿåˆ—ä¸­Gçš„æ•°é‡</li>
<li><code>[0 0]</code>ï¼šå„ä¸ªPæœ¬åœ°é˜Ÿåˆ—ä¸­Gçš„æ•°é‡</li>
</ul>
<h2 id="ğŸ¬-ç¬¬äº”ç« ï¼šå…¸å‹è°ƒåº¦åœºæ™¯åˆ†æ">ğŸ¬ ç¬¬äº”ç« ï¼šå…¸å‹è°ƒåº¦åœºæ™¯åˆ†æ</h2>
<h3 id="åœºæ™¯1ï¼šåˆ›å»ºæ–°Goroutine">åœºæ™¯1ï¼šåˆ›å»ºæ–°Goroutine</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166280168.png" alt="åœºæ™¯1"></p>
<p><strong>æè¿°</strong>ï¼šPæ‹¥æœ‰G1ï¼ŒM1è·å–Påè¿è¡ŒG1ï¼ŒG1åˆ›å»ºG2<br>
<strong>ç»“æœ</strong>ï¼šG2ä¼˜å…ˆåŠ å…¥P1çš„æœ¬åœ°é˜Ÿåˆ—ï¼ˆå±€éƒ¨æ€§åŸç†ï¼‰</p>
<h3 id="åœºæ™¯2ï¼šGoroutineæ‰§è¡Œå®Œæ¯•">åœºæ™¯2ï¼šGoroutineæ‰§è¡Œå®Œæ¯•</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166294675.png" alt="åœºæ™¯2"></p>
<p><strong>æè¿°</strong>ï¼šG1æ‰§è¡Œå®Œæ¯•ï¼ŒM1å¤ç”¨æ‰§è¡ŒG2<br>
<strong>å…³é”®å‡½æ•°</strong>ï¼š</p>
<ul>
<li><code>goexit</code>ï¼šGoroutineé€€å‡º</li>
<li><code>schedule</code>ï¼šè°ƒåº¦æ–°çš„Goroutine</li>
<li><code>execute</code>ï¼šæ‰§è¡ŒGoroutine</li>
</ul>
<h3 id="åœºæ™¯3ï¼šæœ¬åœ°é˜Ÿåˆ—æœªæ»¡">åœºæ™¯3ï¼šæœ¬åœ°é˜Ÿåˆ—æœªæ»¡</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166302874.png" alt="åœºæ™¯3"></p>
<p><strong>æè¿°</strong>ï¼šå‡è®¾Pçš„æœ¬åœ°é˜Ÿåˆ—å®¹é‡ä¸º3ï¼ŒG2åˆ›å»ºG3ã€G4ã€G5<br>
<strong>ç»“æœ</strong>ï¼šæ–°åˆ›å»ºçš„Géƒ½åŠ å…¥P1çš„æœ¬åœ°é˜Ÿåˆ—</p>
<h3 id="åœºæ™¯4ï¼šæœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œæ‰§è¡Œè´Ÿè½½å‡è¡¡">åœºæ™¯4ï¼šæœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œæ‰§è¡Œè´Ÿè½½å‡è¡¡</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166310526.png" alt="åœºæ™¯4"></p>
<p><strong>æè¿°</strong>ï¼šG2åˆ›å»ºG7æ—¶ï¼ŒP1æœ¬åœ°é˜Ÿåˆ—å·²æ»¡<br>
<strong>è´Ÿè½½å‡è¡¡ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å°†æœ¬åœ°é˜Ÿåˆ—å‰ä¸€åŠçš„Gç§»è‡³å…¨å±€é˜Ÿåˆ—</li>
<li>æ–°åˆ›å»ºçš„Gä¹Ÿç§»è‡³å…¨å±€é˜Ÿåˆ—</li>
<li>ç»´æŠ¤é˜Ÿåˆ—çš„åŠ¨æ€å¹³è¡¡</li>
</ul>
<h3 id="åœºæ™¯5ï¼šç»§ç»­åˆ›å»ºGoroutine">åœºæ™¯5ï¼šç»§ç»­åˆ›å»ºGoroutine</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166319379.png" alt="åœºæ™¯5"></p>
<p><strong>æè¿°</strong>ï¼šG2åˆ›å»ºG8ï¼Œæ­¤æ—¶P1æœ¬åœ°é˜Ÿåˆ—æœªæ»¡<br>
<strong>ç»“æœ</strong>ï¼šG8ç›´æ¥åŠ å…¥P1æœ¬åœ°é˜Ÿåˆ—</p>
<h3 id="åœºæ™¯6ï¼šå”¤é†’ç©ºé—²çš„M-Pç»„åˆ">åœºæ™¯6ï¼šå”¤é†’ç©ºé—²çš„M-Pç»„åˆ</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166332661.png" alt="åœºæ™¯6"></p>
<p><strong>å…³é”®æœºåˆ¶</strong>ï¼šåˆ›å»ºGæ—¶ä¼šå°è¯•å”¤é†’ç©ºé—²çš„M-Pç»„åˆ<br>
<strong>è‡ªæ—‹çº¿ç¨‹</strong>ï¼šæ²¡æœ‰Gæ‰§è¡Œä½†ä¿æŒè¿è¡ŒçŠ¶æ€ï¼ŒæŒç»­å¯»æ‰¾å¯æ‰§è¡Œçš„G</p>
<h3 id="åœºæ™¯7ï¼šä»å…¨å±€é˜Ÿåˆ—è·å–G">åœºæ™¯7ï¼šä»å…¨å±€é˜Ÿåˆ—è·å–G</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166340433.png" alt="åœºæ™¯7"></p>
<p><strong>è´Ÿè½½å‡è¡¡å…¬å¼</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">n = min(len(GQ)/GOMAXPROCS + 1, len(GQ)/2)</span><br></pre></td></tr></table></figure>
<p><strong>è®¾è®¡åŸåˆ™</strong>ï¼š</p>
<ul>
<li>è‡³å°‘è·å–1ä¸ªG</li>
<li>ä¸è¦ä¸€æ¬¡æ€§è·å–å¤ªå¤šGï¼Œç»™å…¶ä»–Pç•™æœºä¼š</li>
<li>å®ç°å…¨å±€é˜Ÿåˆ—åˆ°æœ¬åœ°é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡</li>
</ul>
<h3 id="åœºæ™¯8ï¼šWork-Stealingï¼ˆå·¥ä½œçªƒå–ï¼‰">åœºæ™¯8ï¼šWork Stealingï¼ˆå·¥ä½œçªƒå–ï¼‰</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166348141.png" alt="åœºæ™¯8"></p>
<p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šæœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºä¸”ä»å…¨å±€é˜Ÿåˆ—ä¹Ÿæ— æ³•è·å–Gæ—¶<br>
<strong>çªƒå–ç­–ç•¥</strong>ï¼šä»å…¶ä»–Pçš„æœ¬åœ°é˜Ÿåˆ—å°¾éƒ¨çªƒå–ä¸€åŠçš„G<br>
<strong>ä¼˜åŠ¿</strong>ï¼šé¿å…çº¿ç¨‹ç©ºé—²ï¼Œæé«˜CPUåˆ©ç”¨ç‡</p>
<h3 id="åœºæ™¯9ï¼šå¤šä¸ªMå¤„äºè‡ªæ—‹çŠ¶æ€">åœºæ™¯9ï¼šå¤šä¸ªMå¤„äºè‡ªæ—‹çŠ¶æ€</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166359369.png" alt="åœºæ™¯9"></p>
<p><strong>è‡ªæ—‹çº¿ç¨‹çš„æ„ä¹‰</strong>ï¼š</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæœ‰æ–°Gæ—¶èƒ½ç«‹å³æ‰§è¡Œï¼Œé™ä½å»¶è¿Ÿ</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆè€—CPUèµ„æº</li>
<li><strong>é™åˆ¶</strong>ï¼šæœ€å¤šå…è®¸GOMAXPROCSä¸ªè‡ªæ—‹çº¿ç¨‹</li>
</ul>
<h3 id="åœºæ™¯10ï¼šç³»ç»Ÿè°ƒç”¨é˜»å¡">åœºæ™¯10ï¼šç³»ç»Ÿè°ƒç”¨é˜»å¡</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166366685.png" alt="åœºæ™¯10"></p>
<p><strong>é˜»å¡ç³»ç»Ÿè°ƒç”¨å¤„ç†</strong>ï¼š</p>
<ol>
<li>M2ä¸P2ç«‹å³è§£ç»‘</li>
<li>P2å¯»æ‰¾ç©ºé—²çš„Mï¼ˆå¦‚M5ï¼‰é‡æ–°ç»‘å®š</li>
<li>ä¿è¯P2ä¸­çš„å…¶ä»–Gèƒ½ç»§ç»­æ‰§è¡Œ</li>
<li>å®ç°äº†Hand Offæœºåˆ¶</li>
</ol>
<h3 id="åœºæ™¯11ï¼šéé˜»å¡ç³»ç»Ÿè°ƒç”¨">åœºæ™¯11ï¼šéé˜»å¡ç³»ç»Ÿè°ƒç”¨</h3>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/GMP/GMP/1750166376430.png" alt="åœºæ™¯11"></p>
<p><strong>éé˜»å¡ç³»ç»Ÿè°ƒç”¨å¤„ç†</strong>ï¼š</p>
<ol>
<li>M2è®°ä½P2ï¼Œç„¶åä¸P2è§£ç»‘</li>
<li>ç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼ŒM2å°è¯•é‡æ–°è·å–P2</li>
<li>å¦‚æœP2è¢«å ç”¨ï¼Œå°è¯•è·å–å…¶ä»–ç©ºé—²P</li>
<li>å¦‚æœæ²¡æœ‰ç©ºé—²Pï¼ŒGè¿›å…¥å…¨å±€é˜Ÿåˆ—ï¼ŒMè¿›å…¥ä¼‘çœ </li>
</ol>
<h2 id="ğŸ“-é¢è¯•é‡ç‚¹æ€»ç»“">ğŸ“ é¢è¯•é‡ç‚¹æ€»ç»“</h2>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong>G</strong>ï¼šGoroutineï¼Œè½»é‡çº§çº¿ç¨‹</li>
<li><strong>M</strong>ï¼šMachineï¼Œæ“ä½œç³»ç»Ÿçº¿ç¨‹</li>
<li><strong>P</strong>ï¼šProcessorï¼Œé€»è¾‘å¤„ç†å™¨ï¼ŒåŒ…å«è¿è¡ŒGæ‰€éœ€çš„èµ„æº</li>
</ul>
<h3 id="å…³é”®æœºåˆ¶">å…³é”®æœºåˆ¶</h3>
<ol>
<li><strong>Work Stealing</strong>ï¼šä»å…¶ä»–Pçªƒå–G</li>
<li><strong>Hand Off</strong>ï¼šç³»ç»Ÿè°ƒç”¨æ—¶Pçš„ç§»äº¤</li>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šæœ¬åœ°é˜Ÿåˆ—ä¸å…¨å±€é˜Ÿåˆ—é—´çš„Gåˆ†é…</li>
<li><strong>æŠ¢å å¼è°ƒåº¦</strong>ï¼šé˜²æ­¢Goroutineé•¿æ—¶é—´å ç”¨CPU</li>
</ol>
<h3 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</h3>
<ul>
<li><strong>å±€éƒ¨æ€§</strong>ï¼šæ–°Gä¼˜å…ˆæ”¾å…¥å½“å‰Pçš„æœ¬åœ°é˜Ÿåˆ—</li>
<li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šä»å…¨å±€é˜Ÿåˆ—æ‰¹é‡è·å–G</li>
<li><strong>åŠ¨æ€æ‰©å®¹</strong>ï¼šæ ¹æ®éœ€è¦åŠ¨æ€åˆ›å»ºM</li>
</ul>
<h3 id="é¢è¯•é«˜é¢‘é—®é¢˜">é¢è¯•é«˜é¢‘é—®é¢˜</h3>
<p><strong>Q1ï¼šè§£é‡ŠGMPæ¨¡å‹çš„æ ¸å¿ƒç»„ä»¶</strong><br>
<strong>A1</strong>ï¼š</p>
<ul>
<li>Gä»£è¡¨Goroutineï¼Œæ˜¯Goè¯­è¨€çš„è½»é‡çº§çº¿ç¨‹</li>
<li>Mä»£è¡¨Machineï¼Œæ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹</li>
<li>Pä»£è¡¨Processorï¼Œæ˜¯é€»è¾‘å¤„ç†å™¨ï¼ŒåŒ…å«è¿è¡ŒGoroutineæ‰€éœ€çš„èµ„æº</li>
</ul>
<p><strong>Q2ï¼šä¸ºä»€ä¹ˆéœ€è¦Pè¿™ä¸ªç»„ä»¶ï¼Ÿ</strong><br>
<strong>A2</strong>ï¼š</p>
<ul>
<li>è§£å†³æ—§è°ƒåº¦å™¨çš„å…¨å±€é”ç«äº‰é—®é¢˜</li>
<li>æä¾›æœ¬åœ°é˜Ÿåˆ—ï¼Œå‡å°‘é”ç«äº‰</li>
<li>å®ç°Work Stealingæœºåˆ¶</li>
<li>æ”¯æŒæ›´å¥½çš„å±€éƒ¨æ€§</li>
</ul>
<p><strong>Q3ï¼šä»€ä¹ˆæ˜¯Work Stealingï¼Ÿ</strong><br>
<strong>A3</strong>ï¼š<br>
å½“ä¸€ä¸ªPçš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œä¸”ä»å…¨å±€é˜Ÿåˆ—ä¹Ÿæ— æ³•è·å–Gæ—¶ï¼Œå¯¹åº”çš„Mä¼šä»å…¶ä»–Pçš„æœ¬åœ°é˜Ÿåˆ—å°¾éƒ¨çªƒå–ä¸€åŠçš„Gæ¥æ‰§è¡Œï¼Œè¿™æ ·é¿å…äº†Mçš„ç©ºé—²ï¼Œæé«˜äº†CPUåˆ©ç”¨ç‡ã€‚</p>
<p><strong>Q4ï¼šGoè°ƒåº¦å™¨æŸ¥æ‰¾å¯è¿è¡ŒGoroutineçš„é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br>
<strong>A4</strong>ï¼š</p>
<ol>
<li>é¦–å…ˆæ£€æŸ¥Pçš„æœ¬åœ°é˜Ÿåˆ—ï¼ˆæ— é”ï¼Œæœ€å¿«ï¼‰</li>
<li>æ¯61æ¬¡è°ƒåº¦æ£€æŸ¥ä¸€æ¬¡å…¨å±€é˜Ÿåˆ—ï¼ˆé¿å…å…¨å±€é˜Ÿåˆ—é¥¥é¥¿ï¼‰</li>
<li>æ£€æŸ¥ç½‘ç»œè½®è¯¢å™¨(netpoll)æ˜¯å¦æœ‰I/Oå°±ç»ªçš„G</li>
<li>æœ€åè¿›è¡Œwork stealingï¼Œä»å…¶ä»–På·å–G</li>
</ol>
<p>è¿™ä¸ªé¡ºåºæ—¢ä¿è¯äº†æ€§èƒ½ï¼ˆä¼˜å…ˆæœ¬åœ°é˜Ÿåˆ—ï¼‰ï¼Œåˆç¡®ä¿äº†å…¬å¹³æ€§ï¼ˆå®šæœŸæ£€æŸ¥å…¨å±€é˜Ÿåˆ—ï¼‰ã€‚</p>
<p><strong>Q5ï¼šGoroutineå¦‚ä½•å®ç°æŠ¢å ï¼Ÿ</strong><br>
<strong>A5</strong>ï¼š<br>
Goè°ƒåº¦å™¨é€šè¿‡åœ¨å‡½æ•°è°ƒç”¨æ—¶æ£€æŸ¥æŠ¢å æ ‡å¿—æ¥å®ç°åä½œå¼æŠ¢å ï¼ŒåŒæ—¶è®¾ç½®æœ€å¤§è¿ç»­è¿è¡Œæ—¶é—´ä¸º10msï¼Œé˜²æ­¢æŸä¸ªGoroutineé•¿æ—¶é—´å ç”¨CPUã€‚</p>
<h2 id="ğŸ¯-æ€»ç»“">ğŸ¯ æ€»ç»“</h2>
<p>Goè¯­è¨€çš„GMPè°ƒåº¦å™¨æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„å¹¶å‘ç³»ç»Ÿï¼š</p>
<ol>
<li><strong>å†å²æ¼”è¿›</strong>ï¼šä»å•è¿›ç¨‹åˆ°å¤šçº¿ç¨‹ï¼Œå†åˆ°åç¨‹ï¼Œæœ€ç»ˆå‘å±•ä¸ºGMPæ¨¡å‹</li>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé€šè¿‡M:Næ˜ å°„å®ç°è½»é‡çº§å¹¶å‘ï¼Œç”¨Pä½œä¸ºèµ„æºå®¹å™¨å‡å°‘é”ç«äº‰</li>
<li><strong>å…³é”®æœºåˆ¶</strong>ï¼šWork Stealingã€Hand Offã€è´Ÿè½½å‡è¡¡ç­‰ä¿è¯é«˜æ•ˆè°ƒåº¦</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå±€éƒ¨æ€§ã€æ‰¹é‡æ“ä½œã€åŠ¨æ€æ‰©å®¹ç­‰æå‡æ•´ä½“æ€§èƒ½</li>
</ol>
<p><strong>Goè°ƒåº¦å™¨çš„æœ¬è´¨æ˜¯æŠŠå¤§é‡çš„Goroutineé«˜æ•ˆåœ°åˆ†é…åˆ°å°‘é‡çš„çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸å¹¶è¡Œèƒ½åŠ›ï¼Œå®ç°å¼ºå¤§çš„å¹¶å‘æ€§èƒ½ã€‚</strong></p>
<p>ç†è§£GMPæ¨¡å‹ä¸ä»…æœ‰åŠ©äºå†™å‡ºé«˜æ€§èƒ½çš„Goä»£ç ï¼Œæ›´èƒ½å¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£å¹¶å‘ç¼–ç¨‹çš„æœ¬è´¨ã€‚</p>
<hr>
<p><em>å‚è€ƒèµ„æ–™ï¼š</em></p>
<ul>
<li><a href="https://golang.org/doc/">Goè¯­è¨€å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://docs.google.com/document/d/1TTj4T2JO42uD5ID9e89oa0sLKhJYD0Y_kqxDv3I3XMw">Goè°ƒåº¦å™¨è®¾è®¡æ–‡æ¡£</a></li>
<li><a href="https://golang.org/doc/effective_go.html">Effective Go</a></li>
</ul>
<blockquote>
<p>ğŸ’¡ <strong>å­¦ä¹ å»ºè®®</strong>ï¼šå»ºè®®ç»“åˆå®é™…ä»£ç å’Œtraceå·¥å…·æ¥åŠ æ·±ç†è§£ï¼Œå¤šå†™å¤šç»ƒæ‰èƒ½çœŸæ­£æŒæ¡Goå¹¶å‘ç¼–ç¨‹çš„ç²¾é«“ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>GMP</category>
      </categories>
      <tags>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
        <tag>GMPæ¨¡å‹</tag>
        <tag>Goroutine</tag>
        <tag>è°ƒåº¦å™¨</tag>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 222 - å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ï¼ˆCount Complete Tree Nodesï¼‰</title>
    <url>/2025/06/17/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-222-%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E8%8A%82%E7%82%B9%E4%B8%AA%E6%95%B0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€æ£µ<strong>å®Œå…¨äºŒå‰æ ‘</strong>çš„æ ¹èŠ‚ç‚¹ <code>root</code>ï¼Œæ±‚å‡ºè¯¥æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚</p>
<p><strong>å®Œå…¨äºŒå‰æ ‘</strong>çš„å®šä¹‰å¦‚ä¸‹ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€åº•å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼Œåˆ™è¯¥å±‚åŒ…å« 1 ~ 2^(h-1) ä¸ªèŠ‚ç‚¹ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼š">ç¤ºä¾‹ 1ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [1,2,3,4,5,6]</span><br><span class="line">è¾“å‡ºï¼š6</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2ï¼š">ç¤ºä¾‹ 2ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = []</span><br><span class="line">è¾“å‡ºï¼š0</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-3ï¼š">ç¤ºä¾‹ 3ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [1]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶ï¼š">çº¦æŸæ¡ä»¶ï¼š</h3>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ <code>[0, 5 * 10^4]</code></li>
<li><code>0 &lt;= Node.val &lt;= 5 * 10^4</code></li>
<li>é¢˜ç›®æ•°æ®ä¿è¯è¾“å…¥çš„æ ‘æ˜¯<strong>å®Œå…¨äºŒå‰æ ‘</strong></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„å…³é”®åœ¨äºåˆ©ç”¨<strong>å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨</strong>æ¥ä¼˜åŒ–è®¡ç®—ã€‚</p>
<p>å¦‚æœç›´æ¥éå†æ•´ä¸ªæ ‘æ¥è®¡ç®—èŠ‚ç‚¹ä¸ªæ•°ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šæ˜¯ O(n)ã€‚ä½†æ˜¯ï¼Œå®Œå…¨äºŒå‰æ ‘æœ‰ä¸€ä¸ªé‡è¦æ€§è´¨ï¼š<strong>å¯¹äºå®Œå…¨äºŒå‰æ ‘çš„ä»»æ„å­æ ‘ï¼Œå¦‚æœå…¶å·¦å­æ ‘çš„é«˜åº¦ç­‰äºå³å­æ ‘çš„é«˜åº¦ï¼Œé‚£ä¹ˆè¿™ä¸ªå­æ ‘æ˜¯ä¸€ä¸ªæ»¡äºŒå‰æ ‘</strong>ã€‚</p>
<h3 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3>
<ol>
<li><strong>æ»¡äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°</strong>ï¼šå¯¹äºé«˜åº¦ä¸º h çš„æ»¡äºŒå‰æ ‘ï¼ŒèŠ‚ç‚¹ä¸ªæ•°ä¸º $2^h - 1$</li>
<li><strong>é«˜åº¦è®¡ç®—</strong>ï¼šé€šè¿‡è®¡ç®—å·¦å­æ ‘çš„é«˜åº¦ï¼ˆä¸€ç›´å¾€å·¦èµ°ï¼‰å’Œå³å­æ ‘çš„é«˜åº¦ï¼ˆä¸€ç›´å¾€å³èµ°ï¼‰</li>
<li><strong>é€’å½’åˆ¤æ–­</strong>ï¼š
<ul>
<li>å¦‚æœå·¦å­æ ‘é«˜åº¦ = å³å­æ ‘é«˜åº¦ â†’ æ»¡äºŒå‰æ ‘ â†’ ä½¿ç”¨å…¬å¼è®¡ç®—</li>
<li>å¦‚æœå·¦å­æ ‘é«˜åº¦ â‰  å³å­æ ‘é«˜åº¦ â†’ é€’å½’è®¡ç®—å·¦å³å­æ ‘ + æ ¹èŠ‚ç‚¹</li>
</ul>
</li>
</ol>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li><strong>è¾¹ç•Œæ¡ä»¶</strong>ï¼šå¦‚æœèŠ‚ç‚¹ä¸ºç©ºï¼Œè¿”å› 0</li>
<li><strong>è®¡ç®—é«˜åº¦</strong>ï¼š
<ul>
<li>ä»å½“å‰èŠ‚ç‚¹å¼€å§‹ï¼Œä¸€ç›´å‘å·¦èµ°ï¼Œè®¡ç®—å·¦å­æ ‘é«˜åº¦ <code>hl</code></li>
<li>ä»å½“å‰èŠ‚ç‚¹å¼€å§‹ï¼Œä¸€ç›´å‘å³èµ°ï¼Œè®¡ç®—å³å­æ ‘é«˜åº¦ <code>hr</code></li>
</ul>
</li>
<li><strong>åˆ¤æ–­æ˜¯å¦ä¸ºæ»¡äºŒå‰æ ‘</strong>ï¼š
<ul>
<li>å¦‚æœ <code>hl == hr</code>ï¼Œè¯´æ˜æ˜¯æ»¡äºŒå‰æ ‘ï¼Œè¿”å› $2^{hl} - 1$</li>
<li>å¦‚æœ <code>hl != hr</code>ï¼Œé€’å½’è®¡ç®—ï¼š<code>countNodes(left) + 1 + countNodes(right)</code></li>
</ul>
</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆè¿™æ ·åšæ˜¯æ­£ç¡®çš„ï¼Ÿ">ä¸ºä»€ä¹ˆè¿™æ ·åšæ˜¯æ­£ç¡®çš„ï¼Ÿ</h3>
<p>å¯¹äºå®Œå…¨äºŒå‰æ ‘ï¼Œå¦‚æœå·¦å­æ ‘é«˜åº¦ç­‰äºå³å­æ ‘é«˜åº¦ï¼Œè¯´æ˜å·¦å­æ ‘æ˜¯æ»¡çš„ï¼Œå³å­æ ‘ä¹Ÿæ˜¯æ»¡çš„ï¼ˆé™¤äº†å¯èƒ½æœ€åä¸€å±‚ï¼‰ã€‚ä½†ç”±äºæˆ‘ä»¬è®¡ç®—çš„æ˜¯ä»æ ¹åˆ°æœ€æ·±å¶å­çš„è·¯å¾„é•¿åº¦ï¼Œå¦‚æœå·¦å³è·¯å¾„é•¿åº¦ç›¸ç­‰ï¼Œè¯´æ˜æ•´ä¸ªå­æ ‘éƒ½æ˜¯æ»¡çš„ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countNodes</span><span class="params">(root *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(node *TreeNode)</span></span> <span class="type">int</span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(node *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—å·¦å­æ ‘é«˜åº¦</span></span><br><span class="line">        hl := <span class="number">0</span></span><br><span class="line">        cur := node</span><br><span class="line">        <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">            cur = cur.Left</span><br><span class="line">            hl++</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—å³å­æ ‘é«˜åº¦</span></span><br><span class="line">        hr := <span class="number">0</span></span><br><span class="line">        cur = node</span><br><span class="line">        <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">            cur = cur.Right</span><br><span class="line">            hr++</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœé«˜åº¦ç›¸ç­‰ï¼Œè¯´æ˜æ˜¯æ»¡äºŒå‰æ ‘</span></span><br><span class="line">        <span class="keyword">if</span> hl == hr &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>&lt;&lt;hl - <span class="number">1</span>  <span class="comment">// ç­‰ä»·äº 2^hl - 1</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦åˆ™é€’å½’è®¡ç®—å·¦å³å­æ ‘</span></span><br><span class="line">        <span class="keyword">return</span> dfs(node.Left) + <span class="number">1</span> + dfs(node.Right)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dfs(root)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…³é”®å®ç°ç»†èŠ‚">å…³é”®å®ç°ç»†èŠ‚</h3>
<ol>
<li><strong>é«˜åº¦è®¡ç®—</strong>ï¼šä»å½“å‰èŠ‚ç‚¹å¼€å§‹è®¡ç®—ï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹çš„é«˜åº¦ä¸º 1</li>
<li><strong>ä½è¿ç®—ä¼˜åŒ–</strong>ï¼š<code>1&lt;&lt;hl - 1</code> ç­‰ä»·äº $2^{hl} - 1$ï¼Œåˆ©ç”¨ä½è¿ç®—æé«˜æ•ˆç‡</li>
<li><strong>é€’å½’ç»“æ„</strong>ï¼šä½¿ç”¨å†…éƒ¨å‡½æ•° <code>dfs</code> æ¥å®ç°é€’å½’é€»è¾‘</li>
</ol>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼š-O-log-2-n">æ—¶é—´å¤æ‚åº¦ï¼š$O(\log^2 n)$</h3>
<p><strong>æ¨å¯¼è¿‡ç¨‹</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡é€’å½’è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å·¦å³å­æ ‘çš„é«˜åº¦ï¼Œè¿™éœ€è¦ $O(\log n)$ æ—¶é—´</li>
<li>åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é€’å½’ $O(\log n)$ æ¬¡ï¼ˆæ ‘çš„é«˜åº¦ï¼‰</li>
<li>å› æ­¤æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(\log n \times \log n) = O(\log^2 n)$</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆä¸æ˜¯ O(n)ï¼Ÿ</strong></p>
<ul>
<li>å…³é”®åœ¨äºæˆ‘ä»¬ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½è®¿é—®</li>
<li>æ¯æ¬¡é€’å½’æ—¶ï¼Œè¦ä¹ˆç›´æ¥è®¡ç®—å‡ºæ»¡äºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°ï¼Œè¦ä¹ˆåªé€’å½’åˆ°ä¸€ä¸ªå­æ ‘</li>
<li>è¿™å¤§å¤§å‡å°‘äº†éœ€è¦è®¿é—®çš„èŠ‚ç‚¹æ•°é‡</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼š-O-log-n">ç©ºé—´å¤æ‚åº¦ï¼š$O(\log n)$</h3>
<ul>
<li>é€’å½’è°ƒç”¨æ ˆçš„æ·±åº¦æœ€å¤šä¸ºæ ‘çš„é«˜åº¦</li>
<li>å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦ä¸º $O(\log n)$</li>
</ul>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æš´åŠ›éå†</th>
<th>æœ¬é¢˜è§£æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>$O(\log^2 n)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(\log n)$</td>
<td>$O(\log n)$</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>æ€è·¯ç®€å•ç›´æ¥</td>
<td>å……åˆ†åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘æ€§è´¨</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>æ²¡æœ‰åˆ©ç”¨é¢˜ç›®æ¡ä»¶</td>
<td>å®ç°ç›¸å¯¹å¤æ‚</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>åˆ©ç”¨æ•°æ®ç»“æ„ç‰¹æ€§</strong>ï¼šå®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ®Šæ€§è´¨æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®</li>
<li><strong>æ»¡äºŒå‰æ ‘åˆ¤æ–­</strong>ï¼šé€šè¿‡æ¯”è¾ƒå·¦å³å­æ ‘é«˜åº¦æ¥åˆ¤æ–­æ˜¯å¦ä¸ºæ»¡äºŒå‰æ ‘</li>
<li><strong>é€’å½’ä¼˜åŒ–</strong>ï¼šä¸æ˜¯æ‰€æœ‰å­æ ‘éƒ½éœ€è¦é€’å½’ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡</li>
<li><strong>ä½è¿ç®—åº”ç”¨</strong>ï¼šä½¿ç”¨ <code>1&lt;&lt;h</code> ä»£æ›¿ <code>pow(2,h)</code> æé«˜è®¡ç®—æ•ˆç‡</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>é«˜åº¦è®¡ç®—é”™è¯¯</strong>ï¼šæ³¨æ„ä»å½“å‰èŠ‚ç‚¹å¼€å§‹è®¡ç®—é«˜åº¦ï¼Œæ ¹èŠ‚ç‚¹é«˜åº¦ä¸º 1</li>
<li><strong>å…¬å¼è®°å¿†é”™è¯¯</strong>ï¼šæ»¡äºŒå‰æ ‘èŠ‚ç‚¹æ•°æ˜¯ $2^h - 1$ï¼Œä¸æ˜¯ $2^h$</li>
<li><strong>é€’å½’ç»ˆæ­¢æ¡ä»¶</strong>ï¼šè¦æ­£ç¡®å¤„ç†ç©ºèŠ‚ç‚¹çš„æƒ…å†µ</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li>LeetCode 104: äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</li>
<li>LeetCode 111: äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</li>
<li>LeetCode 958: äºŒå‰æ ‘çš„å®Œå…¨æ€§æ£€éªŒ</li>
</ul>
<p>è¿™é“é¢˜å¾ˆå¥½åœ°å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨æ•°æ®ç»“æ„çš„ç‰¹æ®Šæ€§è´¨æ¥ä¼˜åŒ–ç®—æ³•ï¼Œæ˜¯ä¸€é“ç»å…¸çš„æ ‘å½¢ç»“æ„ä¼˜åŒ–é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>é€’å½’</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: Goè¯­è¨€åƒåœ¾å›æ”¶ - ä¸‰è‰²æ ‡è®°ç®—æ³•è¯¦è§£</title>
    <url>/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/</url>
    <content><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>GCæ˜¯é¢è¯•é‡Œçš„è€å…«è‚¡æ–‡äº†ï¼Œæèµ·GCï¼Œå¾ˆå¤šäººå¿ƒé‡Œä¼šå‘æ€µï¼Œä½†å¥½å¥½å‡†å¤‡ä¸€ç•ªåï¼Œå¼„æ¸…å…¶ä¸­çš„æ¥é¾™å»è„‰ï¼Œåœ¨é¢è¯•çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€èƒ½å¤ŸèˆŒç¿è²èŠ±ã€‚ä»Šå¤©ç‰¹åœ°æ¢³ç†äº†ä¸€ä¸‹GCçš„ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œç›¸ä¿¡åœ¨å„ä½é“å‹çœ‹å®Œåï¼Œä¹Ÿå¯ä»¥å¯¹é¢è¯•å®˜æå‡ºçš„GCé—®é¢˜ï¼Œç°å¸¸è‡ªä¿¡çš„å¨“å¨“é“æ¥â€¦</p>
<h2 id="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</h2>
<h3 id="ä»€ä¹ˆæ˜¯GCï¼Ÿ">ä»€ä¹ˆæ˜¯GCï¼Ÿ</h3>
<p><strong>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼Œç¼©å†™ä¸ºGCï¼‰</strong>ï¼Œæ˜¯ä¸€ç§è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ã€‚</p>
<p>å³æˆ‘ä»¬åœ¨ç¨‹åºä¸­å®šä¹‰ä¸€ä¸ªå˜é‡åï¼Œä¼šåœ¨å†…å­˜ä¸­å¼€è¾Ÿç›¸åº”ç©ºé—´è¿›è¡Œå­˜å‚¨ã€‚å½“ä¸éœ€è¦æ­¤å˜é‡åï¼Œéœ€è¦æ‰‹åŠ¨é”€æ¯æ­¤å¯¹è±¡ï¼Œå¹¶é‡Šæ”¾å†…å­˜ã€‚è€Œè¿™ç§å¯¹ä¸å†ä½¿ç”¨çš„å†…å­˜èµ„æºè¿›è¡Œè‡ªåŠ¨å›æ”¶çš„åŠŸèƒ½å³ä¸ºåƒåœ¾å›æ”¶ã€‚</p>
<h3 id="GCç›¸å…³æœ¯è¯­">GCç›¸å…³æœ¯è¯­</h3>
<p>åœ¨å¯¹GCå¼€å§‹è®²è§£ä¹‹å‰ï¼Œæœ‰å¾ˆå¤šå…³äºGCçš„è¡Œè¯ï¼Œå…ˆæ™®åŠä¸€ä¸‹ï¼Œä¸ç„¶åæ–‡è¯»èµ·æ¥ä¼šç¨å¾®æœ‰ç‚¹æ‡µã€‚</p>
<ul>
<li>
<p><strong>èµ‹å€¼å™¨ï¼ˆMutatorï¼‰</strong>ï¼šè¯´ç™½äº†å°±æ˜¯ä½ å†™çš„ç¨‹åºä»£ç ï¼Œåœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæ”¹å˜å¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼Œæˆ–è€…åˆ›å»ºæ–°çš„å¼•ç”¨ã€‚</p>
</li>
<li>
<p><strong>å›æ”¶å™¨ï¼ˆCollectorï¼‰</strong>ï¼šåƒåœ¾å›æ”¶å™¨çš„è´£ä»»å°±æ˜¯å»å¹²æ‰é‚£äº›ç¨‹åºä¸­ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p><strong>STWï¼ˆStop The Worldï¼‰</strong>ï¼šGCæœŸé—´æŸä¸ªé˜¶æ®µä¼šåœæ­¢æ‰€æœ‰çš„èµ‹å€¼å™¨ï¼Œä¸­æ–­ä½ çš„ç¨‹åºé€»è¾‘ï¼Œä»¥ç¡®å®šå¼•ç”¨å…³ç³»ã€‚</p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦STWï¼Ÿ</strong> ä¸¾ä¸ªç”ŸåŠ¨çš„ä¾‹å­ï¼šæƒ³è±¡ä¸€ä¸ªå¹¼å„¿å›­è€å¸ˆè¦ç»Ÿè®¡å­©å­ä»¬çš„æ‰‹ç‰µæ‰‹æƒ…å†µã€‚å¦‚æœå­©å­ä»¬åœ¨ç»Ÿè®¡è¿‡ç¨‹ä¸­è¿˜åœ¨è·‘æ¥è·‘å»ï¼Œæ”¹å˜ç‰µæ‰‹å…³ç³»ï¼Œé‚£ç»Ÿè®¡ç»“æœå°±ä¸å‡†ç¡®äº†ã€‚æ‰€ä»¥è€å¸ˆéœ€è¦å…ˆè®©æ‰€æœ‰å­©å­&quot;å®šæ ¼&quot;ï¼ˆSTWï¼‰ï¼Œç„¶åè¿›è¡Œç»Ÿè®¡ã€‚åœ¨GCä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¦‚æœç¨‹åºåœ¨æ ‡è®°è¿‡ç¨‹ä¸­è¿˜åœ¨æ”¹å˜å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œå°±å¯èƒ½å¯¼è‡´åº”è¯¥å­˜æ´»çš„å¯¹è±¡è¢«è¯¯åˆ é™¤ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>Rootå¯¹è±¡</strong>ï¼šæ ¹å¯¹è±¡æ˜¯æŒ‡èµ‹å€¼å™¨ä¸éœ€è¦é€šè¿‡å…¶ä»–å¯¹è±¡å°±å¯ä»¥ç›´æ¥è®¿é—®åˆ°çš„å¯¹è±¡ï¼Œé€šè¿‡Rootå¯¹è±¡ï¼Œå¯ä»¥è¿½è¸ªåˆ°å…¶ä»–å­˜æ´»çš„å¯¹è±¡ã€‚å¸¸è§çš„rootå¯¹è±¡æœ‰ï¼š</p>
<ul>
<li><strong>å…¨å±€å˜é‡</strong>ï¼šç¨‹åºåœ¨ç¼–è¯‘æœŸå°±èƒ½ç¡®å®šçš„é‚£äº›å­˜åœ¨äºç¨‹åºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„å˜é‡ã€‚</li>
<li><strong>æ‰§è¡Œæ ˆ</strong>ï¼šæ¯ä¸ªgoroutineï¼ˆåŒ…æ‹¬mainå‡½æ•°ï¼‰éƒ½æ‹¥æœ‰è‡ªå·±çš„æ‰§è¡Œæ ˆï¼Œè¿™äº›æ‰§è¡Œæ ˆä¸ŠåŒ…å«æ ˆä¸Šçš„å˜é‡åŠå †å†…å­˜æŒ‡é’ˆã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>æ˜“æ··æ·†ç‚¹è§£é‡Š</strong>ï¼šå¾ˆå¤šäººåˆ†ä¸æ¸…æ ˆå†…å­˜å’Œå †å†…å­˜çš„å¯¹è±¡ã€‚ç®€å•è®°ä½ï¼š</p>
<ul>
<li><strong>æ ˆå†…å­˜</strong>ï¼šå‡½æ•°å†…çš„å±€éƒ¨å˜é‡ï¼Œä½œç”¨åŸŸæœ‰é™ï¼Œå‡½æ•°ç»“æŸå°±é‡Šæ”¾</li>
<li><strong>å †å†…å­˜</strong>ï¼šé€šè¿‡newã€makeç­‰åˆ†é…çš„å†…å­˜ï¼Œéœ€è¦GCæ¥å›æ”¶</li>
</ul>
</blockquote>
<h2 id="Goçš„GCå‘å±•æ¼”å˜å²">Goçš„GCå‘å±•æ¼”å˜å²</h2>
<h3 id="v1-3-æ ‡è®°æ¸…é™¤æ³•">v1.3 - æ ‡è®°æ¸…é™¤æ³•</h3>
<p>æ ‡è®°æ¸…é™¤æ³•ä¸»è¦åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>æ ‡è®°</strong></li>
<li><strong>æ¸…é™¤</strong></li>
</ol>
<h4 id="ç®—æ³•æµç¨‹ç¤ºä¾‹">ç®—æ³•æµç¨‹ç¤ºä¾‹</h4>
<p><strong>ç¬¬ä¸€æ­¥ï¼šå¼€å¯STWï¼Œåœæ­¢ç¨‹åºçš„è¿è¡Œ</strong></p>
<p>å›¾ä¸­æ˜¯æœ¬æ¬¡GCæ¶‰åŠåˆ°çš„rootèŠ‚ç‚¹å’Œç›¸å…³å¯¹è±¡ï¼š</p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089761940.png" alt="1750089761940"></p>
<p><strong>ç¬¬äºŒæ­¥ï¼šä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œæ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡</strong></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089768379.png" alt="1750089768379"></p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šåœæ­¢STWï¼Œå›æ”¶æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡</strong></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089782651.png" alt="1750089782651"></p>
<h4 id="æ ‡è®°æ¸…é™¤æ³•çš„å¼Šç«¯">æ ‡è®°æ¸…é™¤æ³•çš„å¼Šç«¯</h4>
<p>æ ‡è®°æ¸…é™¤æ³•çš„æœ€å¤§å¼Šç«¯å°±æ˜¯åœ¨æ•´ä¸ªGCæœŸé—´éœ€è¦STWï¼Œå°†æ•´ä¸ªç¨‹åºæš‚åœã€‚å› ä¸ºå¦‚æœä¸è¿›è¡ŒSTWçš„è¯ï¼Œä¼šå‡ºç°å·²ç»è¢«æ ‡è®°çš„å¯¹è±¡Aï¼Œå¼•ç”¨äº†æ–°çš„æœªè¢«æ ‡è®°çš„å¯¹è±¡Bï¼Œä½†ç”±äºå¯¹è±¡Aå·²ç»æ ‡è®°è¿‡äº†ï¼Œä¸ä¼šå†é‡æ–°æ‰«æAå¯¹Bçš„å¯è¾¾æ€§ï¼Œä»è€Œå°†Bå¯¹è±¡å½“åšåƒåœ¾å›æ”¶æ‰ã€‚</p>
<p>è¯´å®è¯è¿™ç§å…¨ç¨‹STWçš„GCç®—æ³•çœŸçš„æ˜¯å¦‚è¿‡è¡—è€é¼ ï¼Œäººè§äººæ‰“â€¦å¥½å®¶ä¼™ï¼Œè®©æˆ‘ç¨‹åºåœä¸‹æ¥ï¼Œä¸“é—¨å»åšåƒåœ¾å›æ”¶è¿™ä»¶äº‹ï¼Œåœ¨è¿½æ±‚é«˜æ€§èƒ½çš„ä»Šå¤©ï¼Œå¾ˆéš¾æœ‰äººå¯ä»¥æ¥å—è¿™ç§æ€§èƒ½æŸè€—ã€‚</p>
<p>æ‰€ä»¥Golangå›¢é˜Ÿè¿™ä¸ªæ—¶æœŸå°±å¼€å§‹ä¸“æ³¨äºå¦‚ä½•èƒ½æå‡GCçš„æ€§èƒ½ï¼Œè¿™é‡Œå¸Œæœ›å„ä½é“å‹èƒ½æ˜ç™½Golangå›¢é˜Ÿå¯¹GCç®—æ³•ä¼˜åŒ–çš„æ–¹å‘æ˜¯ä»€ä¹ˆï¼Œæˆ–è€…ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œé‚£å°±æ˜¯<strong>è®©GCå’Œç”¨æˆ·ç¨‹åºå¯ä»¥äº’ä¸å¹²æ‰°ï¼Œå¹¶å‘è¿›è¡Œ</strong>ã€‚æ‰€ä»¥æ‰æœ‰äº†åé¢çš„ä¸‰è‰²æ ‡è®°æ³•ã€‚</p>
<h3 id="v1-5-ä¸‰è‰²æ ‡è®°æ³•">v1.5 - ä¸‰è‰²æ ‡è®°æ³•</h3>
<h4 id="ç®—æ³•æµç¨‹">ç®—æ³•æµç¨‹</h4>
<p><strong>ç¬¬ä¸€æ­¥ï¼šåˆå§‹æ—¶ï¼Œæ‰€æœ‰å¯¹è±¡è¢«æ ‡è®°ä¸ºç™½è‰²</strong></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089792781.png" alt="1750089792781"></p>
<p><strong>ç¬¬äºŒæ­¥ï¼šGCå¼€å§‹ï¼Œéå†rootsetï¼Œå°†ç›´æ¥å¯è¾¾çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²</strong></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089800640.png" alt="1750089800640"></p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šéå†ç°è‰²å¯¹è±¡ï¼Œå°†ç›´æ¥å¯è¾¾çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œå¹¶å°†è‡ªèº«æ ‡è®°ä¸ºé»‘è‰²</strong></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089807926.png" alt="1750089807926"></p>
<p><strong>ç¬¬å››æ­¥ï¼šé‡å¤ç¬¬ä¸‰æ­¥ï¼Œç›´åˆ°ç°è‰²å¯¹è±¡ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯æ ‡è®°å®Œæ‰€æœ‰å¯¹è±¡</strong></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089813826.png" alt="1750089813826"></p>
<p><strong>ç¬¬äº”æ­¥ï¼šåœæ­¢STWï¼Œå›æ”¶æ‰€æœ‰ç™½è‰²å¯¹è±¡</strong></p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089819494.png" alt="1750089819494"></p>
<blockquote>
<p><strong>ä¸‰è‰²å«ä¹‰è¯¦è§£</strong>ï¼š</p>
<ul>
<li><strong>ç™½è‰²</strong>ï¼šæœªè¢«è®¿é—®çš„å¯¹è±¡ï¼Œå¯èƒ½æ˜¯åƒåœ¾ï¼Œæœ€ç»ˆä¼šè¢«å›æ”¶</li>
<li><strong>ç°è‰²</strong>ï¼šå·²è¢«è®¿é—®ä½†å…¶å¼•ç”¨çš„å¯¹è±¡è¿˜æ²¡æœ‰å…¨éƒ¨è®¿é—®å®Œï¼Œç›¸å½“äº&quot;å¾…å¤„ç†é˜Ÿåˆ—&quot;</li>
<li><strong>é»‘è‰²</strong>ï¼šå·²è®¿é—®ä¸”å…¶å¼•ç”¨çš„å¯¹è±¡ä¹Ÿå…¨éƒ¨è®¿é—®å®Œæ¯•ï¼Œç¡®å®šå­˜æ´»çš„å¯¹è±¡</li>
</ul>
</blockquote>
<h4 id="ä¸‰è‰²æ ‡è®°æ³•çš„é—®é¢˜">ä¸‰è‰²æ ‡è®°æ³•çš„é—®é¢˜</h4>
<p>å¯¹äºä¸Šè¿°çš„ä¸‰è‰²æ ‡è®°æ³•æ¥è®²ï¼Œä»ç„¶éœ€è¦ä¾èµ–STWçš„ã€‚å› ä¸ºå¦‚æœä¸æš‚åœç¨‹åºï¼Œç¨‹åºçš„é€»è¾‘æ”¹å˜å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œè¿™ç§åŠ¨ä½œå¦‚æœåœ¨æ ‡è®°é˜¶æ®µåšäº†ä¿®æ”¹ï¼Œä¼šå½±å“æ ‡è®°ç»“æœçš„æ­£ç¡®æ€§ã€‚æˆ‘ä»¬ä¸¾ä¸€ä¸ªåœºæ™¯ï¼š</p>
<p><strong>é—®é¢˜åœºæ™¯æ¼”ç¤ºï¼š</strong></p>
<ol>
<li>å¯¹è±¡2æ ‡è®°ä¸ºç°è‰²ï¼Œå¯¹è±¡2å¼•ç”¨äº†å¯¹è±¡3ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089840658.png" alt="1750089840658"></p>
<ol start="2">
<li>é»‘è‰²å¯¹è±¡6åˆ›å»ºäº†ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘äº†å¯¹è±¡3ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089857909.png" alt="1750089857909"></p>
<ol start="3">
<li>å¯¹è±¡2åˆ é™¤äº†å¯¹è±¡3çš„å¼•ç”¨ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089870176.png" alt="1750089870176"></p>
<ol start="4">
<li>ç”±äºå¯¹è±¡6ä¸ä¼šå†è¿›è¡Œæ‰«æï¼Œ3å¯¹è±¡ä¸€ç›´ä¼šæ˜¯ç™½è‰²æ ‡è®°ï¼Œæœ€åä¼šè¢«å½“åšåƒåœ¾å›æ”¶æ‰ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750089876109.png" alt="1750089876109"></p>
<blockquote>
<p><strong>è¿™ä¸ªé—®é¢˜ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼Ÿ</strong><br>
å› ä¸ºå¯¹è±¡6å·²ç»æ˜¯é»‘è‰²ï¼ŒæŒ‰ç…§ç®—æ³•è§„åˆ™ï¼Œé»‘è‰²å¯¹è±¡ä¸ä¼šå†è¢«æ‰«æã€‚å½“å¯¹è±¡6æ–°å¢å¯¹å¯¹è±¡3çš„å¼•ç”¨ï¼Œè€Œå¯¹è±¡2åˆåˆ é™¤äº†å¯¹å¯¹è±¡3çš„å¼•ç”¨æ—¶ï¼Œå¯¹è±¡3å°±&quot;å¤±è”&quot;äº†â€”â€”æ²¡æœ‰ä»»ä½•ç°è‰²å¯¹è±¡èƒ½å‘ç°å®ƒï¼Œä½†å®ƒå®é™…ä¸Šè¿˜è¢«é»‘è‰²å¯¹è±¡6å¼•ç”¨ç€ï¼Œåº”è¯¥å­˜æ´»ã€‚</p>
</blockquote>
<p>å¥½ï¼Œé‚£æˆ‘ä»¬æ¥ç€è¯´ï¼ŒGolangæ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªSTWé—®é¢˜çš„å‘¢ï¼Ÿ</p>
<h4 id="å¯¹è±¡ä¸¢å¤±çš„æ¡ä»¶åˆ†æ">å¯¹è±¡ä¸¢å¤±çš„æ¡ä»¶åˆ†æ</h4>
<p>å…¶å®æ€»ç»“æ¥çœ‹ï¼Œåœ¨ä¸‰è‰²æ ‡è®°æ³•çš„è¿‡ç¨‹ä¸­å¯¹è±¡ä¸¢å¤±ï¼Œéœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li><strong>æ¡ä»¶ä¸€</strong>ï¼šç™½è‰²å¯¹è±¡è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨</li>
<li><strong>æ¡ä»¶äºŒ</strong>ï¼šç°è‰²å¯¹è±¡ä¸ç™½è‰²å¯¹è±¡ä¹‹é—´çš„å¯è¾¾å…³ç³»é­åˆ°ç ´å</li>
</ul>
<p>çœ‹æ¥åªè¦æŠŠä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ç ´åæ‰ä¸€ä¸ªï¼Œå°±å¯ä»¥ä¿è¯å¯¹è±¡ä¸ä¸¢å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„golangå›¢é˜Ÿå°±æå‡ºäº†ä¸¤ç§ç ´åæ¡ä»¶çš„æ–¹å¼ï¼š<strong>å¼ºä¸‰è‰²ä¸å˜å¼</strong>å’Œ<strong>å¼±ä¸‰è‰²ä¸å˜å¼</strong>ã€‚</p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Ÿ</strong></p>
<ul>
<li>å¦‚æœåªæ»¡è¶³æ¡ä»¶ä¸€ï¼Œä½†ç°è‰²å¯¹è±¡è¿˜èƒ½åˆ°è¾¾ç™½è‰²å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨åç»­æ‰«æä¸­è¿˜èƒ½å‘ç°è¿™ä¸ªç™½è‰²å¯¹è±¡</li>
<li>å¦‚æœåªæ»¡è¶³æ¡ä»¶äºŒï¼Œä½†ç™½è‰²å¯¹è±¡æ²¡æœ‰è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªç™½è‰²å¯¹è±¡æœ¬æ¥å°±åº”è¯¥è¢«å›æ”¶</li>
<li>åªæœ‰ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ï¼Œæ‰ä¼šå‡ºç°&quot;åº”è¯¥å­˜æ´»ä½†è¢«è¯¯åˆ &quot;çš„æƒ…å†µ</li>
</ul>
</blockquote>
<h2 id="ä¸¤ç§ä¸å˜å¼">ä¸¤ç§ä¸å˜å¼</h2>
<h3 id="å¼ºä¸‰è‰²ä¸å˜å¼">å¼ºä¸‰è‰²ä¸å˜å¼</h3>
<p><strong>è§„åˆ™</strong>ï¼šä¸å…è®¸é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡</p>
<p><strong>ç ´åæ¡ä»¶</strong>ï¼šç ´åäº†æ¡ä»¶ä¸€ - ç™½è‰²å¯¹è±¡è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨</p>
<p><strong>è§£é‡Š</strong>ï¼šå¦‚æœä¸€ä¸ªé»‘è‰²å¯¹è±¡ä¸ç›´æ¥å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°ç™½è‰²å¯¹è±¡æ‰«æä¸åˆ°ï¼Œä»è€Œè¢«å½“åšåƒåœ¾å›æ”¶æ‰çš„å°´å°¬ï¼š</p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090062290.png" alt="1750090062290"></p>
<blockquote>
<p><strong>é€šä¿—ç†è§£</strong>ï¼šå°±åƒç­çº§é‡Œï¼Œâ€œå·²å®Œæˆä½œä¸šçš„åŒå­¦â€ï¼ˆé»‘è‰²ï¼‰ä¸èƒ½ç›´æ¥å¸®åŠ©&quot;æœªå¼€å§‹ä½œä¸šçš„åŒå­¦&quot;ï¼ˆç™½è‰²ï¼‰ï¼Œå¿…é¡»é€šè¿‡&quot;æ­£åœ¨åšä½œä¸šçš„åŒå­¦&quot;ï¼ˆç°è‰²ï¼‰æ¥ä¼ é€’å¸®åŠ©ã€‚</p>
</blockquote>
<h3 id="å¼±ä¸‰è‰²ä¸å˜å¼">å¼±ä¸‰è‰²ä¸å˜å¼</h3>
<p><strong>è§„åˆ™</strong>ï¼šé»‘è‰²å¯¹è±¡å¯ä»¥å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œä½†æ˜¯ç™½è‰²å¯¹è±¡çš„ä¸Šæ¸¸å¿…é¡»å­˜åœ¨ç°è‰²å¯¹è±¡</p>
<p><strong>ç ´åæ¡ä»¶</strong>ï¼šç ´åäº†æ¡ä»¶äºŒ - ç°è‰²å¯¹è±¡ä¸ç™½è‰²å¯¹è±¡ä¹‹é—´çš„å¯è¾¾å…³ç³»é­åˆ°ç ´å</p>
<p><strong>è§£é‡Š</strong>ï¼šå¦‚æœä¸€ä¸ªç™½è‰²å¯¹è±¡çš„ä¸Šæ¸¸æœ‰ç°è‰²å¯¹è±¡ï¼Œåˆ™è¿™ä¸ªç™½è‰²å¯¹è±¡ä¸€å®šå¯ä»¥æ‰«æåˆ°ï¼Œä»è€Œä¸è¢«å›æ”¶ï¼š</p>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090072223.png" alt="1750090072223"></p>
<blockquote>
<p><strong>é€šä¿—ç†è§£</strong>ï¼šå…è®¸&quot;å·²å®Œæˆä½œä¸šçš„åŒå­¦&quot;ï¼ˆé»‘è‰²ï¼‰ç›´æ¥å¸®åŠ©&quot;æœªå¼€å§‹ä½œä¸šçš„åŒå­¦&quot;ï¼ˆç™½è‰²ï¼‰ï¼Œä½†å¿…é¡»ä¿è¯æœ‰&quot;æ­£åœ¨åšä½œä¸šçš„åŒå­¦&quot;ï¼ˆç°è‰²ï¼‰ä¹Ÿèƒ½è”ç³»åˆ°è¿™ä¸ª&quot;æœªå¼€å§‹ä½œä¸šçš„åŒå­¦&quot;ï¼Œè¿™æ ·å°±æœ‰åŒé‡ä¿éšœã€‚</p>
</blockquote>
<h2 id="å±éšœæœºåˆ¶">å±éšœæœºåˆ¶</h2>
<p>Golangå›¢é˜Ÿéµå¾ªä¸Šè¿°ä¸¤ç§ä¸å˜å¼æåˆ°çš„åŸåˆ™ï¼Œåˆ†åˆ«æå‡ºäº†ä¸¤ç§å®ç°æœºåˆ¶ï¼š<strong>æ’å…¥å†™å±éšœ</strong>å’Œ<strong>åˆ é™¤å†™å±éšœ</strong>ã€‚</p>
<blockquote>
<p><strong>ä»€ä¹ˆæ˜¯å†™å±éšœï¼Ÿ</strong><br>
å†™å±éšœå¯ä»¥ç†è§£ä¸ºåœ¨ç¨‹åºä¿®æ”¹æŒ‡é’ˆæ—¶è‡ªåŠ¨æ‰§è¡Œçš„ä¸€å°æ®µä»£ç ï¼Œå®ƒä¼šæ‹¦æˆªè¿™äº›ä¿®æ”¹æ“ä½œï¼Œå¹¶æ‰§è¡Œä¸€äº›é¢å¤–çš„æ ‡è®°å·¥ä½œã€‚å°±åƒé—¨å«ä¸€æ ·ï¼Œç›‘æ§æ‰€æœ‰çš„&quot;å¼•ç”¨å…³ç³»å˜æ›´&quot;ã€‚</p>
</blockquote>
<h3 id="æ’å…¥å†™å±éšœ">æ’å…¥å†™å±éšœ</h3>
<p><strong>è§„åˆ™</strong>ï¼šå½“ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å¦å¤–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°†å¦å¤–ä¸€ä¸ªå¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚</p>
<p><strong>æ»¡è¶³</strong>ï¼šå¼ºä¸‰è‰²ä¸å˜å¼ã€‚ä¸ä¼šå­˜åœ¨é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡</p>
<p><strong>é‡è¦æç¤º</strong>ï¼šæ’å…¥å±éšœä»…ä¼šåœ¨å †å†…å­˜ä¸­ç”Ÿæ•ˆï¼Œä¸å¯¹æ ˆå†…å­˜ç©ºé—´ç”Ÿæ•ˆï¼Œè¿™æ˜¯å› ä¸ºgoåœ¨å¹¶å‘è¿è¡Œæ—¶ï¼Œå¤§éƒ¨åˆ†çš„æ“ä½œéƒ½å‘ç”Ÿåœ¨æ ˆä¸Šï¼Œå‡½æ•°è°ƒç”¨ä¼šéå¸¸é¢‘ç¹ã€‚æ•°åä¸‡goroutineçš„æ ˆéƒ½è¿›è¡Œå±éšœä¿æŠ¤è‡ªç„¶ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚</p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆæ ˆä¸ç”¨å±éšœï¼Ÿ</strong></p>
<ol>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šæ ˆæ“ä½œæå…¶é¢‘ç¹ï¼Œæ¯ä¸ªå‡½æ•°è°ƒç”¨éƒ½æ¶‰åŠæ ˆæ“ä½œ</li>
<li><strong>å¹¶å‘æ•°é‡</strong>ï¼šGoç¨‹åºå¯èƒ½æœ‰æ•°åä¸‡ä¸ªgoroutineï¼Œæ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„æ ˆ</li>
<li><strong>å¼€é”€å¤ªå¤§</strong>ï¼šå¦‚æœæ¯ä¸ªæ ˆæ“ä½œéƒ½è¦å†™å±éšœï¼Œæ€§èƒ½æŸå¤±å·¨å¤§</li>
</ol>
</blockquote>
<h4 id="æ’å…¥å†™å±éšœæœºåˆ¶ç¤ºä¾‹">æ’å…¥å†™å±éšœæœºåˆ¶ç¤ºä¾‹</h4>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ’å…¥å†™å±éšœæœºåˆ¶ï¼Œåœ¨æ’å…¥å†™å±éšœæœºåˆ¶ä¸‹æ˜¯å¦‚ä½•ä¿æŠ¤å¯¹è±¡ä¸ä¸¢å¤±çš„ï¼š</p>
<ol>
<li>å¯¹è±¡2æ ‡è®°ä¸ºç°è‰²ï¼Œå¯¹è±¡2å¼•ç”¨äº†å¯¹è±¡3ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090080410.png" alt="1750090080410"></p>
<ol start="2">
<li>é»‘è‰²å¯¹è±¡6åˆ›å»ºäº†ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘äº†å¯¹è±¡3ï¼Œç”±äºæ’å…¥å†™å±éšœï¼Œå¯¹è±¡3å˜æˆç°è‰²ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090087363.png" alt="1750090087363"></p>
<ol start="3">
<li>å¯¹è±¡2åˆ é™¤äº†å¯¹è±¡3çš„å¼•ç”¨ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090093919.png" alt="1750090093919"></p>
<p>å¯ä»¥å‘ç°ï¼Œå¯¹è±¡3åœ¨æ’å…¥å†™å±éšœæœºåˆ¶ä¸‹ï¼Œå¾—åˆ°äº†ä¿æŠ¤ï¼Œä½†æ˜¯ç”±äºæ ˆä¸Šçš„å¯¹è±¡æ²¡æœ‰æ’å…¥å†™æœºåˆ¶ï¼Œåœ¨æ‰«æå®Œæˆåï¼Œä»ç„¶å¯èƒ½å­˜åœ¨æ ˆä¸Šçš„ç™½è‰²å¯¹è±¡è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨æœ€åéœ€è¦å¯¹æ ˆä¸Šçš„ç©ºé—´è¿›è¡ŒSTWï¼Œé˜²æ­¢å¯¹è±¡è¯¯åˆ é™¤ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ol start="4">
<li>ä¸ºé»‘è‰²å¯¹è±¡1æ–°å¼•ç”¨å¯¹è±¡9ï¼Œç”±äºå¯¹è±¡1åœ¨æ ˆåŒºï¼Œä¸ä¼šè§¦å‘æ’å…¥å†™å±éšœæœºåˆ¶ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090101055.png" alt="1750090101055"></p>
<ol start="5">
<li>å¯¹æ ˆç©ºé—´è¿›è¡ŒSTWä¿æŠ¤ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090111424.png" alt="1750090111424"></p>
<ol start="6">
<li>å¯¹æ ˆç©ºé—´é‡æ–°è¿›è¡Œæ‰«æï¼Œå°†å¯¹è±¡9æ ‡è®°ä¸ºäº†é»‘è‰²ï¼Œæœ€ååƒåœ¾å›æ”¶ç™½è‰²æ ‡è®°çš„å¯¹è±¡5å’Œ8ï¼Œç¬¦åˆé¢„æœŸï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090117475.png" alt="1750090117475"></p>
<h4 id="æ’å…¥å†™å±éšœçš„å¼Šç«¯">æ’å…¥å†™å±éšœçš„å¼Šç«¯</h4>
<p>å¯¹äºæ’å…¥å†™å±éšœæ¥è®²ï¼Œæ’å…¥å†™å±éšœæœ€å¤§çš„å¼Šç«¯å°±æ˜¯ï¼Œåœ¨ä¸€æ¬¡æ­£å¸¸çš„ä¸‰è‰²æ ‡è®°æµç¨‹ç»“æŸåï¼Œéœ€è¦å¯¹æ ˆä¸Šé‡æ–°è¿›è¡Œä¸€æ¬¡STWï¼Œç„¶åå†rescanä¸€æ¬¡ã€‚</p>
<blockquote>
<p><strong>æ’å…¥å†™å±éšœçš„é—®é¢˜</strong>ï¼šè™½ç„¶å¤§éƒ¨åˆ†æ—¶é—´å¯ä»¥å¹¶å‘æ ‡è®°ï¼Œä½†æœ€åè¿˜æ˜¯éœ€è¦STWæ¥å¤„ç†æ ˆï¼Œè¿™ä¾ç„¶ä¼šé€ æˆç¨‹åºæš‚åœã€‚</p>
</blockquote>
<h3 id="åˆ é™¤å†™å±éšœ">åˆ é™¤å†™å±éšœ</h3>
<p><strong>è§„åˆ™</strong>ï¼šåœ¨åˆ é™¤å¼•ç”¨æ—¶ï¼Œå¦‚æœè¢«åˆ é™¤å¼•ç”¨çš„å¯¹è±¡è‡ªèº«ä¸ºç°è‰²æˆ–è€…ç™½è‰²ï¼Œé‚£ä¹ˆè¢«æ ‡è®°ä¸ºç°è‰²ã€‚</p>
<p><strong>æ»¡è¶³</strong>ï¼šå¼±ä¸‰è‰²ä¸å˜å¼ã€‚ç°è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„è·¯å¾„ä¸ä¼šæ–­</p>
<p><strong>è§£é‡Š</strong>ï¼šç™½è‰²å¯¹è±¡å§‹ç»ˆä¼šè¢«ç°è‰²å¯¹è±¡ä¿æŠ¤</p>
<h4 id="åˆ é™¤å†™å±éšœæœºåˆ¶ç¤ºä¾‹">åˆ é™¤å†™å±éšœæœºåˆ¶ç¤ºä¾‹</h4>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹åœ¨åˆ é™¤å†™å±éšœæœºåˆ¶ä¸‹æ˜¯å¦‚ä½•ä¿æŠ¤å¯¹è±¡ä¸ä¸¢å¤±çš„ï¼š</p>
<ol>
<li>å¯¹è±¡2æ ‡è®°ä¸ºç°è‰²ï¼Œå¯¹è±¡2å¼•ç”¨äº†å¯¹è±¡3ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090125329.png" alt="1750090125329"></p>
<ol start="2">
<li>é»‘è‰²å¯¹è±¡6å¼•ç”¨äº†å¯¹è±¡3ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090132051.png" alt="1750090132051"></p>
<ol start="3">
<li>ç°è‰²å¯¹è±¡2å»æ‰äº†å¯¹è±¡3çš„å¼•ç”¨ï¼Œè§¦å‘åˆ é™¤å†™å±éšœï¼Œå°†å¯¹è±¡3æ ‡è®°ä¸ºç°è‰²ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090138630.png" alt="1750090138630"></p>
<ol start="4">
<li>éå†å®Œæ‰€æœ‰å¯è¾¾å¯¹è±¡åï¼Œå›æ”¶äº†ç™½è‰²å¯¹è±¡5å’Œ8ï¼Œç¬¦åˆé¢„æœŸï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090145711.png" alt="1750090145711"></p>
<h4 id="åˆ é™¤å†™å±éšœçš„å¼Šç«¯">åˆ é™¤å†™å±éšœçš„å¼Šç«¯</h4>
<p>ä½†æ˜¯å¼•å…¥åˆ é™¤å†™å±éšœï¼Œæœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è¢«åˆ é™¤åï¼Œå³ä½¿æ²¡æœ‰å…¶ä»–å­˜æ´»çš„å¯¹è±¡å¼•ç”¨å®ƒï¼Œå®ƒä»ç„¶ä¼šæ´»åˆ°ä¸‹ä¸€è½®ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šçš„å†—ä½™æ‰«ææˆæœ¬ï¼Œä¸”é™ä½äº†å›æ”¶ç²¾åº¦ã€‚</p>
<p><strong>ä¸¾ä¾‹è¯´æ˜ï¼š</strong></p>
<p>å¦‚ä¸‹å›¾ï¼š</p>
<ol>
<li>å¯¹è±¡1ä¸ºé»‘è‰²ï¼Œå¯¹è±¡2ä¸ºç°è‰²ï¼Œå¯¹è±¡3â€¦nä¸ºç™½è‰²ï¼Œ1å¼•ç”¨2ï¼Œ2å¼•ç”¨3ï¼Œâ€¦ï¼Œn-1å¼•ç”¨n</li>
<li>å¯¹è±¡2åˆ é™¤äº†å¯¹è±¡3çš„å¼•ç”¨</li>
<li>è§¦å‘åˆ é™¤å±éšœæœºåˆ¶ï¼Œå¯¹è±¡3æ ‡ç°</li>
<li>å†—ä½™æ‰«æå¯¹è±¡3åˆ°å¯¹è±¡nï¼Œä¸”GCå®Œæˆåå‡è¢«ä¿ç•™ä¸‹æ¥ï¼Œé™ä½äº†å›æ”¶ç²¾åº¦</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090152351.png" alt="1750090152351"></p>
<blockquote>
<p><strong>åˆ é™¤å†™å±éšœçš„é—®é¢˜</strong>ï¼šå®ƒè¿‡äº&quot;ä¿å®ˆ&quot;ï¼Œå®æ„¿å¤šç•™ä¸€äº›åƒåœ¾åˆ°ä¸‹æ¬¡GCï¼Œä¹Ÿä¸æ„¿æ„è¯¯åˆ æœ‰ç”¨å¯¹è±¡ã€‚è¿™å¯¼è‡´å†…å­˜å›æ”¶ä¸å¤ŸåŠæ—¶ã€‚</p>
</blockquote>
<h3 id="å°ç»“">å°ç»“</h3>
<p>ä»ä¸Šé¢ç¤ºä¾‹æ¥çœ‹ï¼Œæ’å…¥å†™å±éšœæœºåˆ¶å’Œåˆ é™¤å†™å±éšœæœºåˆ¶ä¸­ä»»ä¸€æœºåˆ¶å‡å¯ä¿æŠ¤å¯¹è±¡ä¸ä¸¢å¤±ã€‚åœ¨V1.5çš„ç‰ˆæœ¬ä¸­é‡‡ç”¨çš„æ˜¯æ’å…¥å†™æœºåˆ¶å®ç°ã€‚</p>
<p><strong>å¯¹æ¯”æ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœ</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å±éšœç±»å‹</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ’å…¥å†™å±éšœ</td>
<td>å›æ”¶ç²¾åº¦é«˜ï¼Œèƒ½åŠæ—¶å›æ”¶åƒåœ¾</td>
<td>æœ€åéœ€è¦STWé‡æ‰«æ ˆ</td>
<td>å†™å…¥æ“ä½œè¾ƒå¤šçš„åœºæ™¯</td>
</tr>
<tr>
<td>åˆ é™¤å†™å±éšœ</td>
<td>ä¸éœ€è¦é‡æ‰«æ ˆï¼Œå‡å°‘STWæ—¶é—´</td>
<td>å›æ”¶ç²¾åº¦ä½ï¼Œäº§ç”Ÿæµ®åŠ¨åƒåœ¾</td>
<td>åˆ é™¤æ“ä½œè¾ƒå¤šçš„åœºæ™¯</td>
</tr>
</tbody>
</table>
<h2 id="v1-8-æ··åˆå†™å±éšœæœºåˆ¶">v1.8 - æ··åˆå†™å±éšœæœºåˆ¶</h2>
<p>è®²åˆ°è¿™é‡Œï¼Œå¦‚æœæ˜¯ä½ ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿå½“ç„¶æ˜¯å–å…¶ç²¾åï¼Œå»å…¶ç³Ÿç²•å•¦â€¦æ²¡é”™ï¼ŒGolangå›¢é˜Ÿï¼Œæ­£æ˜¯ç»“åˆäº†è¿™ä¸¤ç‚¹ï¼Œåœ¨v1.8ç‰ˆæœ¬ä¸‹å¼•å…¥äº†<strong>æ··åˆå†™å±éšœæœºåˆ¶</strong>ã€‚</p>
<h3 id="æ··åˆå±éšœæœºåˆ¶çš„æ ¸å¿ƒå®šä¹‰">æ··åˆå±éšœæœºåˆ¶çš„æ ¸å¿ƒå®šä¹‰</h3>
<ol>
<li>
<p><strong>GCåˆšå¼€å§‹çš„æ—¶å€™ï¼Œä¼šå°†æ ˆä¸Šçš„å¯è¾¾å¯¹è±¡å…¨éƒ¨æ ‡è®°ä¸ºé»‘è‰²ã€‚</strong></p>
</li>
<li>
<p><strong>GCæœŸé—´ï¼Œä»»ä½•åœ¨æ ˆä¸Šæ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå‡ä¸ºé»‘è‰²ã€‚</strong></p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ</strong><br>
å› ä¸ºæ ˆæ“ä½œå¤ªé¢‘ç¹ï¼Œä¸å…¶åœ¨æ¯æ¬¡æ ˆæ“ä½œæ—¶éƒ½ç”¨å†™å±éšœï¼ˆæ€§èƒ½æŸå¤±å¤§ï¼‰ï¼Œä¸å¦‚åœ¨GCå¼€å§‹æ—¶ä¸€æ¬¡æ€§æŠŠæ ˆä¸Šçš„å¯¹è±¡éƒ½æ ‡è®°ä¸ºé»‘è‰²ã€‚è¿™æ ·æ—¢é¿å…äº†é¢‘ç¹çš„å†™å±éšœï¼Œä¹Ÿç¡®ä¿æ ˆä¸Šå¯¹è±¡ä¸ä¼šè¢«è¯¯åˆ ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>å †ä¸Šè¢«åˆ é™¤çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²</strong></p>
</li>
<li>
<p><strong>å †ä¸Šæ–°æ·»åŠ çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²</strong></p>
</li>
</ol>
<h3 id="æ··åˆå†™å±éšœæœºåˆ¶çš„ç¤ºä¾‹">æ··åˆå†™å±éšœæœºåˆ¶çš„ç¤ºä¾‹</h3>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ··åˆå†™å±éšœæœºåˆ¶çš„ç¤ºä¾‹ï¼š</p>
<ol>
<li>åˆå§‹æ—¶ï¼Œæ‰€æœ‰å¯¹è±¡è¢«æ ‡è®°ä¸ºç™½è‰²ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090165652.png" alt="1750090165652"></p>
<ol start="2">
<li>GCå¼€å§‹æ—¶ï¼Œå…ˆå°†æ ˆä¸Šæ‰€æœ‰å¯è¾¾å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090172566.png" alt="1750090172566"></p>
<ol start="3">
<li>å¼€å§‹ä¸‰è‰²æ ‡è®°ï¼Œå°†6æ ‡è®°ä¸ºç°è‰²ï¼ŒåŒæ—¶æ ˆä¸Šå¯¹è±¡3å¼•ç”¨å¯¹è±¡9ï¼Œè§¦å‘æ··åˆå†™å±éšœæœºåˆ¶ï¼Œå°†å¯¹è±¡9æ ‡è®°ä¸ºé»‘è‰²ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090178723.png" alt="1750090178723"></p>
<ol start="4">
<li>å¯¹è±¡6æ–°å¼•ç”¨å¯¹è±¡10ï¼Œå¯¹è±¡6åœ¨å †ä¸Šï¼Œè§¦å‘æ··åˆå±éšœæœºåˆ¶ï¼Œå°†10å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090184552.png" alt="1750090184552"></p>
<ol start="5">
<li>å¯¹è±¡1å¼•ç”¨äº†å¯¹è±¡7ï¼Œç”±äºå¯¹è±¡1åœ¨æ ˆä¸Šï¼Œä¸ä¼šè§¦å‘æ··åˆå±éšœæœºåˆ¶ï¼Œä»…ä»…æ˜¯æŒ‚è½½ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090190532.png" alt="1750090190532"></p>
<ol start="6">
<li>å¯¹è±¡6åˆ é™¤äº†å¯¹å¯¹è±¡7çš„å¼•ç”¨ï¼Œå¯¹è±¡6åœ¨å †ä¸Šï¼Œè§¦å‘æ··åˆå†™å±éšœæœºåˆ¶ï¼Œå°†å¯¹è±¡7æ ‡è®°ä¸ºç°è‰²ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090196232.png" alt="1750090196232"></p>
<p><strong>é‡è¦è¯´æ˜</strong>ï¼šæœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼Œä¸‡ä¸€æ ˆä¸Šçš„å¯¹è±¡1å¼•ç”¨äº†å †ä¸Šçš„ä¸€ä¸ªæ–°åˆ†é…çš„ç™½è‰²å¯¹è±¡8ï¼Œç”±äºä¸è§¦å‘æ··åˆå†™å±éšœæœºåˆ¶ï¼Œé‚£å¯¹è±¡8ä¸€ç›´æ˜¯ç™½è‰²çš„ï¼Œæœ€åä¸å°±è¢«åƒåœ¾å›æ”¶èµ°äº†ä¹ˆï¼Ÿ</p>
<blockquote>
<p><strong>è¿™ä¸ªæ‹…å¿ƒæ˜¯å¤šä½™çš„ï¼</strong></p>
<p>è¿™ä¸ªæƒ…å†µæ˜¯ä¸ä¼šå‘ç”Ÿçš„ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å¯¹è±¡åˆ›å»ºæ—¶æœº</strong>ï¼šå¦‚æœå¯¹è±¡8æ˜¯åœ¨GCå¼€å§‹åæ–°åˆ†é…çš„ï¼Œå®ƒä¸ä¼šæ˜¯ç™½è‰²ï¼Œè€Œæ˜¯ä¼šè¢«æ ‡è®°ä¸ºé»‘è‰²ï¼ˆè¿™æ˜¯æ··åˆå†™å±éšœçš„è§„åˆ™ï¼‰</li>
<li><strong>å¼•ç”¨å¯è¾¾æ€§</strong>ï¼šä¸€ä¸ªå¯¹è±¡ä¹‹æ‰€ä»¥èƒ½è¢«å¼•ç”¨ï¼Œå‰ææ˜¯å®ƒå¿…é¡»æ˜¯å¯è¾¾çš„ã€‚åœ¨å›¾ä¸­çš„8å·å¯¹è±¡æ˜¾ç„¶æ˜¯ä¸å¯è¾¾çš„ç™½è‰²å¯¹è±¡ï¼ˆGCå¼€å§‹å‰å°±å­˜åœ¨ä¸”æ— å¼•ç”¨ï¼‰</li>
<li><strong>æ ˆæ‰«ææ—¶æœº</strong>ï¼šæ ˆä¸Šçš„å¯è¾¾å¯¹è±¡åœ¨GCå¼€å§‹æ—¶å°±å…¨éƒ¨æ ‡è®°ä¸ºé»‘è‰²äº†ï¼ŒåŒ…æ‹¬å®ƒä»¬å½“æ—¶èƒ½åˆ°è¾¾çš„æ‰€æœ‰å¯¹è±¡</li>
</ol>
</blockquote>
<p>é‚£ä¸ºä»€ä¹ˆ1å·å¯¹è±¡å¯ä»¥å¼•ç”¨7å·å¯¹è±¡å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º1å·å¯¹è±¡åœ¨å¼•ç”¨7å·å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡7æ˜¯åœ¨å¯¹è±¡6çš„ä¸‹æ¸¸ï¼Œæœ¬èº«æ˜¯å¯è¾¾çš„ï¼Œæ‰€ä»¥è¿™ç§å¼•ç”¨å…³ç³»çš„æ”¹å˜æ˜¯åˆç†çš„ã€‚</p>
<ol start="7">
<li>å°†æ‰€æœ‰å¯è¾¾å¯¹è±¡æ ‡è®°å®Œæˆåï¼ŒGCç»“æŸï¼Œæœ€åæŠŠå¯¹è±¡5å’Œå¯¹è±¡8ç™½è‰²å¯¹è±¡å›æ”¶ï¼š</li>
</ol>
<p><img src="/2025/06/17/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B3%95/1750090203090.png" alt="1750090203090"></p>
<h3 id="æ··åˆå†™å±éšœçš„ä¼˜åŠ¿">æ··åˆå†™å±éšœçš„ä¼˜åŠ¿</h3>
<ol>
<li><strong>æ¶ˆé™¤äº†é‡æ‰«æ ˆçš„STW</strong>ï¼šä¸éœ€è¦åœ¨æœ€åæš‚åœç¨‹åºé‡æ–°æ‰«ææ ˆ</li>
<li><strong>å…¼é¡¾æ€§èƒ½å’Œç²¾åº¦</strong>ï¼šæ—¢é¿å…äº†é¢‘ç¹çš„æ ˆå†™å±éšœï¼Œåˆä¿æŒäº†è¾ƒé«˜çš„å›æ”¶ç²¾åº¦</li>
<li><strong>å®ç°ç®€å•</strong>ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤</li>
</ol>
<blockquote>
<p><strong>æ··åˆå†™å±éšœçš„ç²¾å¦™ä¹‹å¤„</strong>ï¼š</p>
<ul>
<li>ç”¨&quot;ä¸€æ¬¡æ€§æ ‡é»‘æ ˆå¯¹è±¡&quot;æ›¿ä»£&quot;é¢‘ç¹çš„æ ˆå†™å±éšœ&quot;</li>
<li>åœ¨å †ä¸ŠåŒæ—¶ä½¿ç”¨æ’å…¥å’Œåˆ é™¤å†™å±éšœçš„ä¼˜ç‚¹</li>
<li>è¾¾åˆ°äº†æ€§èƒ½å’Œç²¾åº¦çš„å®Œç¾å¹³è¡¡</li>
</ul>
</blockquote>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Goè¯­è¨€åƒåœ¾å›æ”¶æœºåˆ¶çš„æ¼”è¿›å†ç¨‹ï¼š</p>
<ol>
<li>
<p><strong>Golang v1.3ä¹‹å‰</strong>ï¼šé‡‡ç”¨ä¼ ç»Ÿçš„æ ‡è®°-æ¸…é™¤æ³•ï¼Œéœ€è¦STWï¼Œæš‚åœæ•´ä¸ªç¨‹åºçš„è¿è¡Œã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œé€»è¾‘æ¸…æ™°</li>
<li>ç¼ºç‚¹ï¼šSTWæ—¶é—´é•¿ï¼Œä¸¥é‡å½±å“ç¨‹åºæ€§èƒ½</li>
</ul>
</li>
<li>
<p><strong>v1.5ç‰ˆæœ¬</strong>ï¼šå¼•å…¥äº†ä¸‰è‰²æ ‡è®°æ³•å’Œæ’å…¥å†™å±éšœæœºåˆ¶ï¼Œå…¶ä¸­æ’å…¥å†™å±éšœæœºåˆ¶åªåœ¨å †å†…å­˜ä¸­ç”Ÿæ•ˆã€‚ä½†åœ¨æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œæœ€åéœ€è¦å¯¹æ ˆè¿›è¡ŒSTWã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå¤§éƒ¨åˆ†æ—¶é—´å¯ä»¥å¹¶å‘æ ‡è®°ï¼Œæ€§èƒ½æœ‰æ‰€æå‡</li>
<li>ç¼ºç‚¹ï¼šæœ€åä»éœ€STWé‡æ‰«æ ˆï¼Œå­˜åœ¨æ€§èƒ½ç“¶é¢ˆ</li>
</ul>
</li>
<li>
<p><strong>v1.8ç‰ˆæœ¬</strong>ï¼šç»“åˆåˆ é™¤å†™å±éšœæœºåˆ¶ï¼Œæ¨å‡ºäº†æ··åˆå±éšœæœºåˆ¶ï¼Œå±éšœé™åˆ¶åªåœ¨å †å†…å­˜ä¸­ç”Ÿæ•ˆã€‚é¿å…äº†æœ€åèŠ‚ç‚¹å¯¹æ ˆè¿›è¡ŒSTWçš„é—®é¢˜ï¼Œæå‡äº†GCæ•ˆç‡ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå‡ ä¹æ¶ˆé™¤äº†STWï¼Œè¾¾åˆ°äº†å¹¶å‘æ ‡è®°çš„ç›®æ ‡</li>
<li>ç¼ºç‚¹ï¼šå®ç°å¤æ‚åº¦ç¨é«˜ï¼Œä½†è¿™ä¸ªä»£ä»·æ˜¯å€¼å¾—çš„</li>
</ul>
</li>
</ol>
<h2 id="æ·±åº¦ç†è§£è¦ç‚¹">æ·±åº¦ç†è§£è¦ç‚¹</h2>
<h3 id="æ˜“æ··æ·†æ¦‚å¿µæ¾„æ¸…">æ˜“æ··æ·†æ¦‚å¿µæ¾„æ¸…</h3>
<ol>
<li><strong>ä¸‰è‰²çš„æœ¬è´¨</strong>ï¼šä¸‰è‰²ä¸æ˜¯å¯¹è±¡çš„å›ºæœ‰å±æ€§ï¼Œè€Œæ˜¯GCè¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ ‡è®°çŠ¶æ€</li>
<li><strong>å†™å±éšœçš„ä½œç”¨æ—¶æœº</strong>ï¼šåªæœ‰åœ¨ä¿®æ”¹æŒ‡é’ˆå¼•ç”¨å…³ç³»æ—¶æ‰ä¼šè§¦å‘ï¼Œæ™®é€šçš„å€¼ä¿®æ”¹ä¸ä¼šè§¦å‘</li>
<li><strong>æ ˆä¸å †çš„å¤„ç†å·®å¼‚</strong>ï¼šæ ˆå¤„ç†ç®€å•ç²—æš´ï¼ˆå…¨æ ‡é»‘ï¼‰ï¼Œå †å¤„ç†ç²¾ç»†å¤æ‚ï¼ˆå†™å±éšœï¼‰</li>
<li><strong>STWçš„å¿…è¦æ€§</strong>ï¼šä¸æ˜¯æ‰€æœ‰GCéƒ½èƒ½å®Œå…¨é¿å…STWï¼Œå…³é”®æ˜¯å°½å¯èƒ½å‡å°‘STWæ—¶é—´</li>
</ol>
<h3 id="æ€§èƒ½ä¼˜åŒ–æ€è·¯">æ€§èƒ½ä¼˜åŒ–æ€è·¯</h3>
<p>Go GCçš„ä¼˜åŒ–æ€è·¯ä½“ç°äº†å·¥ç¨‹ä¸Šçš„æ™ºæ…§ï¼š</p>
<ol>
<li><strong>æƒè¡¡å–èˆ</strong>ï¼šåœ¨ååé‡ã€å»¶è¿Ÿã€å†…å­˜ä½¿ç”¨ä¹‹é—´å¯»æ‰¾å¹³è¡¡</li>
<li><strong>åˆ†æ²»ç­–ç•¥</strong>ï¼šæ ˆå’Œå †é‡‡ç”¨ä¸åŒçš„å¤„ç†ç­–ç•¥</li>
<li><strong>æ¸è¿›ä¼˜åŒ–</strong>ï¼šä»v1.3åˆ°v1.8çš„é€æ­¥æ”¹è¿›ï¼Œæ¯æ¬¡è§£å†³ä¸€ä¸ªä¸»è¦é—®é¢˜</li>
<li><strong>å®ç”¨ä¸»ä¹‰</strong>ï¼šä¸è¿½æ±‚ç†è®ºä¸Šçš„å®Œç¾ï¼Œè€Œæ˜¯è¿½æ±‚å·¥ç¨‹ä¸Šçš„å¯è¡Œ</li>
</ol>
<h2 id="å¸¸è§é¢è¯•é—®é¢˜">å¸¸è§é¢è¯•é—®é¢˜</h2>
<h3 id="Q1ï¼šGoè¯­è¨€ä¸­ä¸‰è‰²æ ‡è®°æ³•çš„åŸºæœ¬åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ">Q1ï¼šGoè¯­è¨€ä¸­ä¸‰è‰²æ ‡è®°æ³•çš„åŸºæœ¬åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>ç­”</strong>ï¼šä¸‰è‰²æ ‡è®°æ³•å°†æ‰€æœ‰å¯¹è±¡åˆ†ä¸ºä¸‰ç§é¢œè‰²ï¼š</p>
<ul>
<li><strong>ç™½è‰²</strong>ï¼šæœªè¢«è®¿é—®çš„å¯¹è±¡ï¼Œæœ€åä¼šè¢«å›æ”¶</li>
<li><strong>ç°è‰²</strong>ï¼šå·²è®¿é—®ä½†å…¶å¼•ç”¨çš„å¯¹è±¡è¿˜æœªå…¨éƒ¨è®¿é—®ï¼Œç›¸å½“äºå¾…å¤„ç†é˜Ÿåˆ—</li>
<li><strong>é»‘è‰²</strong>ï¼šå·²è®¿é—®ä¸”å…¶å¼•ç”¨çš„å¯¹è±¡ä¹Ÿå…¨éƒ¨è®¿é—®å®Œæ¯•ï¼Œç¡®å®šå­˜æ´»çš„å¯¹è±¡</li>
</ul>
<p>æ ‡è®°è¿‡ç¨‹ä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œé€æ­¥å°†å¯è¾¾å¯¹è±¡ä»ç™½è‰²æ ‡è®°ä¸ºç°è‰²ï¼Œå†ä»ç°è‰²æ ‡è®°ä¸ºé»‘è‰²ï¼Œæœ€ç»ˆå›æ”¶æ‰€æœ‰ç™½è‰²å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ä¸ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œæé«˜äº†GCæ•ˆç‡ã€‚</p>
<h3 id="Q2ï¼šä¸ºä»€ä¹ˆéœ€è¦å†™å±éšœæœºåˆ¶ï¼Ÿ">Q2ï¼šä¸ºä»€ä¹ˆéœ€è¦å†™å±éšœæœºåˆ¶ï¼Ÿ</h3>
<p><strong>ç­”</strong>ï¼šåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå¯èƒ½ä¼šä¿®æ”¹å¯¹è±¡é—´çš„å¼•ç”¨å…³ç³»ï¼Œè¿™å¯èƒ½å¯¼è‡´åº”è¯¥å­˜æ´»çš„å¯¹è±¡è¢«è¯¯å›æ”¶ã€‚å…·ä½“æ¥è¯´ï¼Œå½“åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå¯¹è±¡ä¼šä¸¢å¤±ï¼š</p>
<ol>
<li>ç™½è‰²å¯¹è±¡è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨</li>
<li>ç°è‰²å¯¹è±¡ä¸ç™½è‰²å¯¹è±¡ä¹‹é—´çš„å¯è¾¾å…³ç³»è¢«ç ´å</li>
</ol>
<p>å†™å±éšœæœºåˆ¶å¯ä»¥æ‹¦æˆªè¿™äº›å¼•ç”¨å…³ç³»çš„æ”¹å˜ï¼Œé€šè¿‡ç ´åä¸Šè¿°æ¡ä»¶ä¹‹ä¸€æ¥ç¡®ä¿å¯¹è±¡ä¸ä¼šä¸¢å¤±ã€‚</p>
<h3 id="Q3ï¼šæ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">Q3ï¼šæ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>ç­”</strong>ï¼š</p>
<ul>
<li>
<p><strong>æ’å…¥å†™å±éšœ</strong>ï¼šåœ¨åˆ›å»ºæ–°å¼•ç”¨æ—¶è§¦å‘ï¼Œå°†è¢«å¼•ç”¨å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œæ»¡è¶³å¼ºä¸‰è‰²ä¸å˜å¼ï¼ˆä¸å…è®¸é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼‰</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå›æ”¶ç²¾åº¦é«˜</li>
<li>ç¼ºç‚¹ï¼šæœ€åéœ€è¦STWé‡æ‰«æ ˆ</li>
</ul>
</li>
<li>
<p><strong>åˆ é™¤å†™å±éšœ</strong>ï¼šåœ¨åˆ é™¤å¼•ç”¨æ—¶è§¦å‘ï¼Œå°†è¢«åˆ é™¤å¼•ç”¨çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œæ»¡è¶³å¼±ä¸‰è‰²ä¸å˜å¼ï¼ˆç™½è‰²å¯¹è±¡çš„ä¸Šæ¸¸å¿…é¡»å­˜åœ¨ç°è‰²å¯¹è±¡ï¼‰</p>
<ul>
<li>ä¼˜ç‚¹ï¼šä¸éœ€è¦é‡æ‰«æ ˆ</li>
<li>ç¼ºç‚¹ï¼šå›æ”¶ç²¾åº¦ä½ï¼Œäº§ç”Ÿæµ®åŠ¨åƒåœ¾</li>
</ul>
</li>
</ul>
<h3 id="Q4ï¼šGo-1-8çš„æ··åˆå†™å±éšœè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ">Q4ï¼šGo 1.8çš„æ··åˆå†™å±éšœè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3>
<p><strong>ç­”</strong>ï¼šæ··åˆå†™å±éšœç»“åˆäº†æ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœçš„ä¼˜ç‚¹ï¼Œä¸»è¦è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li><strong>æ¶ˆé™¤STW</strong>ï¼šé€šè¿‡åœ¨GCå¼€å§‹æ—¶å°†æ ˆä¸Šå¯¹è±¡å…¨éƒ¨æ ‡è®°ä¸ºé»‘è‰²ï¼Œé¿å…äº†æœ€åé‡æ‰«æ ˆçš„STW</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé¿å…äº†åœ¨é«˜é¢‘çš„æ ˆæ“ä½œä¸Šä½¿ç”¨å†™å±éšœï¼Œå¤§å¤§é™ä½äº†æ€§èƒ½å¼€é”€</li>
<li><strong>æé«˜ç²¾åº¦</strong>ï¼šåœ¨å †ä¸ŠåŒæ—¶ä½¿ç”¨æ’å…¥å’Œåˆ é™¤å†™å±éšœçš„æœºåˆ¶ï¼Œä¿æŒäº†è¾ƒé«˜çš„å›æ”¶ç²¾åº¦</li>
</ol>
<p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæ ˆç”¨ç®€å•ç²—æš´çš„æ–¹å¼å¤„ç†ï¼ˆå…¨æ ‡é»‘ï¼‰ï¼Œå †ç”¨ç²¾ç»†çš„å†™å±éšœå¤„ç†ï¼Œè¾¾åˆ°æ€§èƒ½å’Œç²¾åº¦çš„å¹³è¡¡ã€‚</p>
<h3 id="Q5ï¼šä¸ºä»€ä¹ˆæ ˆä¸ä½¿ç”¨å†™å±éšœï¼Ÿ">Q5ï¼šä¸ºä»€ä¹ˆæ ˆä¸ä½¿ç”¨å†™å±éšœï¼Ÿ</h3>
<p><strong>ç­”</strong>ï¼šæ ˆä¸ä½¿ç”¨å†™å±éšœçš„åŸå› ï¼š</p>
<ol>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šæ ˆæ“ä½œæå…¶é¢‘ç¹ï¼Œæ¯ä¸ªå‡½æ•°è°ƒç”¨ã€å±€éƒ¨å˜é‡æ“ä½œéƒ½æ¶‰åŠæ ˆï¼Œå¦‚æœéƒ½åŠ å†™å±éšœï¼Œæ€§èƒ½æŸå¤±å·¨å¤§</li>
<li><strong>æ•°é‡é—®é¢˜</strong>ï¼šGoç¨‹åºå¯èƒ½æœ‰æ•°åä¸‡ä¸ªgoroutineï¼Œæ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œå†™å±éšœçš„å¼€é”€ä¼šè¢«æ”¾å¤§</li>
<li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šæ··åˆå†™å±éšœé‡‡ç”¨åœ¨GCå¼€å§‹æ—¶ä¸€æ¬¡æ€§æ ‡è®°æ ˆä¸Šæ‰€æœ‰å¯¹è±¡ä¸ºé»‘è‰²çš„æ–¹å¼ï¼Œé¿å…äº†é¢‘ç¹çš„å†™å±éšœ</li>
</ol>
<h3 id="Q6ï¼šä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘GCï¼Ÿ">Q6ï¼šä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘GCï¼Ÿ</h3>
<p><strong>ç­”</strong>ï¼šGoè¯­è¨€ä¸­GCçš„è§¦å‘æ¡ä»¶ä¸»è¦æœ‰ï¼š</p>
<ol>
<li>
<p><strong>è‡ªåŠ¨è§¦å‘</strong>ï¼š</p>
<ul>
<li>å†…å­˜åˆ†é…è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼ˆç”±GOGCç¯å¢ƒå˜é‡æ§åˆ¶ï¼Œé»˜è®¤100%ï¼‰</li>
<li>è·ç¦»ä¸Šæ¬¡GCæ—¶é—´è¶…è¿‡2åˆ†é’Ÿ</li>
</ul>
</li>
<li>
<p><strong>æ‰‹åŠ¨è§¦å‘</strong>ï¼š</p>
<ul>
<li>è°ƒç”¨<code>runtime.GC()</code>å‡½æ•°</li>
<li>è°ƒç”¨<code>runtime.GCPercent()</code>è®¾ç½®è§¦å‘é˜ˆå€¼</li>
</ul>
</li>
<li>
<p><strong>ç³»ç»Ÿå‹åŠ›</strong>ï¼š</p>
<ul>
<li>ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶å¯èƒ½ä¼šæ›´é¢‘ç¹åœ°è§¦å‘GC</li>
</ul>
</li>
</ol>
<hr>
<blockquote>
<p><strong>å­¦ä¹ å»ºè®®</strong>ï¼š</p>
<ol>
<li><strong>ç”»å›¾ç†è§£</strong>ï¼šGCæœºåˆ¶æœ€å¥½é€šè¿‡ç”»å›¾æ¥ç†è§£å¯¹è±¡å¼•ç”¨å…³ç³»çš„å˜åŒ–</li>
<li><strong>å®éªŒéªŒè¯</strong>ï¼šå¯ä»¥é€šè¿‡ç¼–å†™æµ‹è¯•ç¨‹åºå’Œä½¿ç”¨<code>go tool trace</code>æ¥è§‚å¯ŸGCè¡Œä¸º</li>
<li><strong>å…³æ³¨æ¼”è¿›</strong>ï¼šç†è§£æ¯ä¸ªç‰ˆæœ¬çš„æ”¹è¿›ç‚¹ï¼Œæœ‰åŠ©äºæ·±å…¥ç†è§£è®¾è®¡æ€è·¯</li>
<li><strong>ç»“åˆå®è·µ</strong>ï¼šåœ¨å®é™…é¡¹ç›®ä¸­æ³¨æ„GCçš„æ€§èƒ½å½±å“ï¼Œå­¦ä¼šè°ƒä¼˜</li>
</ol>
</blockquote>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>åƒåœ¾å›æ”¶</category>
      </categories>
      <tags>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
        <tag>åƒåœ¾å›æ”¶</tag>
        <tag>GC</tag>
        <tag>ä¸‰è‰²æ ‡è®°æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: Go Map åŸºç¡€æ¦‚å¿µä¸ç”¨æ³•</title>
    <url>/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<h1>Go Map åŸºç¡€æ¦‚å¿µä¸ç”¨æ³•</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>map åˆç§°å­—å…¸ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œæ ¸å¿ƒç‰¹å¾åŒ…å«ä¸‹è¿°ä¸‰ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰å­˜å‚¨åŸºäº key-value å¯¹æ˜ å°„çš„æ¨¡å¼ï¼›</p>
<p>ï¼ˆ2ï¼‰åŸºäº key ç»´åº¦å®ç°å­˜å‚¨æ•°æ®çš„å»é‡ï¼›</p>
<p>ï¼ˆ3ï¼‰è¯»ã€å†™ã€åˆ æ“ä½œæ§åˆ¶ï¼Œæ—¶é—´å¤æ‚åº¦ O(1)ã€‚</p>
<h2 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h2>
<h3 id="å‡ ç§åˆå§‹åŒ–æ–¹æ³•">å‡ ç§åˆå§‹åŒ–æ–¹æ³•</h3>
<p>golang ä¸­ï¼Œå¯¹ map çš„åˆå§‹åŒ–åˆ†ä¸ºä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">myMap1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ make å…³é”®å­—è¿›è¡Œåˆå§‹åŒ–ï¼ŒåŒæ—¶æŒ‡å®š map é¢„åˆ†é…çš„å®¹é‡ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">myMap2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ make å…³é”®å­—è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸æ˜¾å¼å£°æ˜å®¹é‡ï¼Œå› æ­¤é»˜è®¤å®¹é‡ä¸º 0ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">myMap3 := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>&#123;</span><br><span class="line">	<span class="number">1</span>: <span class="number">2</span>,</span><br><span class="line">	<span class="number">3</span>: <span class="number">4</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–æ“ä½œè¿å¸¦èµ‹å€¼ï¼Œä¸€æ°”å‘µæˆã€‚</p>
<h3 id="key-çš„ç±»å‹è¦æ±‚">key çš„ç±»å‹è¦æ±‚</h3>
<p>map ä¸­ï¼Œkey çš„æ•°æ®ç±»å‹å¿…é¡»ä¸ºå¯æ¯”è¾ƒçš„ç±»å‹ï¼Œchanã€mapã€func ä¸å¯æ¯”è¾ƒã€‚</p>
<p><strong>å¯ä½œä¸º key çš„ç±»å‹ï¼š</strong></p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼šbool, æ•°å€¼ç±»å‹, string</li>
<li>æŒ‡é’ˆç±»å‹</li>
<li>æ•°ç»„ç±»å‹ï¼ˆå…ƒç´ å¯æ¯”è¾ƒï¼‰</li>
<li>ç»“æ„ä½“ç±»å‹ï¼ˆæ‰€æœ‰å­—æ®µå¯æ¯”è¾ƒï¼‰</li>
</ul>
<p><strong>ä¸å¯ä½œä¸º key çš„ç±»å‹ï¼š</strong></p>
<ul>
<li>sliceï¼ˆåˆ‡ç‰‡ï¼‰</li>
<li>mapï¼ˆæ˜ å°„ï¼‰</li>
<li>functionï¼ˆå‡½æ•°ï¼‰</li>
</ul>
<h2 id="è¯»æ“ä½œ">è¯»æ“ä½œ</h2>
<p>è¯» map åˆ†ä¸ºä¸‹é¢ä¸¤ç§æ–¹å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">v1 := myMap[<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥è¯»ï¼Œå€˜è‹¥ key å­˜åœ¨ï¼Œåˆ™è·å–åˆ°å¯¹åº”çš„ valï¼Œå€˜è‹¥ key ä¸å­˜åœ¨æˆ–è€… map æœªåˆå§‹åŒ–ï¼Œä¼šè¿”å› val ç±»å‹çš„é›¶å€¼ä½œä¸ºå…œåº•ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">v2, ok := myMap[<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹å¼æ˜¯è¯»çš„åŒæ—¶æ·»åŠ ä¸€ä¸ª bool ç±»å‹çš„ flag æ ‡è¯†æ˜¯å¦è¯»å–æˆåŠŸã€‚å€˜è‹¥ ok == falseï¼Œè¯´æ˜è¯»å–å¤±è´¥ï¼Œkey ä¸å­˜åœ¨ï¼Œæˆ–è€… map æœªåˆå§‹åŒ–ã€‚</p>
<p>æ­¤å¤„åŒä¸€ç§è¯­æ³•èƒ½å¤Ÿå®ç°ä¸åŒè¿”å›å€¼ç±»å‹çš„é€‚é…ï¼Œæ˜¯ç”±äºä»£ç åœ¨æ±‡ç¼–æ—¶ï¼Œä¼šæ ¹æ®è¿”å›å‚æ•°ç±»å‹çš„åŒºåˆ«ï¼Œæ˜ å°„åˆ°ä¸åŒçš„å®ç°æ–¹æ³•ã€‚</p>
<h3 id="åˆ¤æ–­-key-æ˜¯å¦å­˜åœ¨">åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨</h3>
<p><strong>æ­£ç¡®æ–¹å¼ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">value, ok := m[key]</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line">    <span class="comment">// keyå­˜åœ¨ï¼Œvalueæ˜¯å¯¹åº”çš„å€¼</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;keyå­˜åœ¨ï¼Œå€¼ä¸º:&quot;</span>, value)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// keyä¸å­˜åœ¨ï¼Œvalueæ˜¯é›¶å€¼</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;keyä¸å­˜åœ¨&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€åŒ–å†™æ³•</span></span><br><span class="line"><span class="keyword">if</span> value, ok := m[key]; ok &#123;</span><br><span class="line">    <span class="comment">// keyå­˜åœ¨çš„å¤„ç†é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong> ä¸èƒ½ä»…é€šè¿‡å€¼åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨ï¼Œå› ä¸ºå€¼å¯èƒ½å°±æ˜¯é›¶å€¼ã€‚</p>
<h2 id="å†™æ“ä½œ">å†™æ“ä½œ</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">myMap[<span class="number">5</span>] = <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>å†™æ“ä½œçš„è¯­æ³•å¦‚ä¸Šã€‚é¡»æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå€˜è‹¥ map æœªåˆå§‹åŒ–ï¼Œç›´æ¥æ‰§è¡Œå†™æ“ä½œä¼šå¯¼è‡´ panicï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;assignment to entry in nil map&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="åˆ é™¤æ“ä½œ">åˆ é™¤æ“ä½œ</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="built_in">delete</span>(myMap, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ delete æ–¹æ³•æ—¶ï¼Œå€˜è‹¥ key å­˜åœ¨ï¼Œåˆ™ä¼šä» map ä¸­å°†å¯¹åº”çš„ key-value å¯¹åˆ é™¤ï¼›å€˜è‹¥ key ä¸å­˜åœ¨æˆ– map æœªåˆå§‹åŒ–ï¼Œåˆ™æ–¹æ³•ç›´æ¥ç»“æŸï¼Œä¸ä¼šäº§ç”Ÿæ˜¾å¼æç¤ºã€‚</p>
<h2 id="éå†æ“ä½œ">éå†æ“ä½œ</h2>
<p>éå†åˆ†ä¸ºä¸‹é¢ä¸¤ç§æ–¹å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> myMap &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸºäº k,v ä¾æ¬¡æ‰¿æ¥ map ä¸­çš„ key-value å¯¹ï¼›</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> k := <span class="keyword">range</span> myMap &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸºäº k ä¾æ¬¡æ‰¿æ¥ map ä¸­çš„ keyï¼Œä¸å…³æ³¨ val çš„å–å€¼ã€‚</p>
<h3 id="éå†é¡ºåº">éå†é¡ºåº</h3>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ‰§è¡Œ map éå†æ“ä½œæ—¶ï¼Œè·å–çš„ key-value å¯¹å¹¶æ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„é¡ºåºï¼Œå› æ­¤å‰åä¸¤æ¬¡éå†é¡ºåºå¯èƒ½å­˜åœ¨å·®å¼‚ã€‚</p>
<p><strong>Go map éå†æ— åºçš„åŸå› ï¼š</strong></p>
<ol>
<li><strong>å“ˆå¸Œè¡¨ç‰¹æ€§</strong>ï¼šæ•°æ®å­˜å‚¨ä½ç½®ç”±å“ˆå¸Œå€¼å†³å®šï¼Œä¸ä¿è¯é¡ºåº</li>
<li><strong>æ•…æ„éšæœºåŒ–</strong>ï¼šGo 1.0 åæ•…æ„å¼•å…¥éšæœºåŒ–ï¼Œé˜²æ­¢ç¨‹åºä¾èµ–éå†é¡ºåº</li>
<li><strong>æ‰©å®¹å½±å“</strong>ï¼šæ‰©å®¹è¿‡ç¨‹ä¸­æ•°æ®é‡æ–°åˆ†å¸ƒï¼Œè¿›ä¸€æ­¥æ‰“ä¹±é¡ºåº</li>
</ol>
<p><strong>å¦‚éœ€æœ‰åºéå†ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…ˆæ”¶é›†keyå¹¶æ’åº</span></span><br><span class="line">keys := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(m))</span><br><span class="line"><span class="keyword">for</span> k := <span class="keyword">range</span> m &#123;</span><br><span class="line">	keys = <span class="built_in">append</span>(keys, k)</span><br><span class="line">&#125;</span><br><span class="line">sort.Strings(keys)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‰æ’åºåçš„keyéå†</span></span><br><span class="line"><span class="keyword">for</span> _, k := <span class="keyword">range</span> keys &#123;</span><br><span class="line">	fmt.Println(k, m[k])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¹¶å‘å®‰å…¨æ€§">å¹¶å‘å®‰å…¨æ€§</h2>
<p>map ä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„ï¼Œå€˜è‹¥å­˜åœ¨å¹¶å‘è¯»å†™è¡Œä¸ºï¼Œä¼šæŠ›å‡º fatal errorã€‚</p>
<p>å…·ä½“è§„åˆ™æ˜¯ï¼š</p>
<p>ï¼ˆ1ï¼‰å¹¶å‘è¯»æ²¡æœ‰é—®é¢˜ï¼›</p>
<p>ï¼ˆ2ï¼‰å¹¶å‘è¯»å†™ä¸­çš„&quot;å†™&quot;æ˜¯å¹¿ä¹‰ä¸Šçš„ï¼ŒåŒ…å«å†™å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼›</p>
<p>ï¼ˆ3ï¼‰è¯»çš„æ—¶å€™å‘ç°å…¶ä»– goroutine åœ¨å¹¶å‘å†™ï¼ŒæŠ›å‡º fatal errorï¼›</p>
<p>ï¼ˆ4ï¼‰å†™çš„æ—¶å€™å‘ç°å…¶ä»– goroutine åœ¨å¹¶å‘å†™ï¼ŒæŠ›å‡º fatal errorã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">fatal(<span class="string">&quot;concurrent map read and map write&quot;</span>)</span><br><span class="line">fatal(<span class="string">&quot;concurrent map writes&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>éœ€è¦å…³æ³¨ï¼Œæ­¤å¤„å¹¶å‘è¯»å†™ä¼šå¼•å‘ fatal errorï¼Œæ˜¯ä¸€ç§æ¯” panic æ›´ä¸¥é‡çš„é”™è¯¯ï¼Œæ— æ³•ä½¿ç”¨ recover æ“ä½œæ•è·ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>ä½¿ç”¨äº’æ–¥é”ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mu sync.RWMutex</span><br><span class="line"><span class="keyword">var</span> m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»æ“ä½œ</span></span><br><span class="line">mu.RLock()</span><br><span class="line">value := m[key]</span><br><span class="line">mu.RUnlock()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ“ä½œ</span></span><br><span class="line">mu.Lock()</span><br><span class="line">m[key] = value</span><br><span class="line">mu.Unlock()</span><br></pre></td></tr></table></figure>
<p><strong>ä½¿ç”¨ sync.Mapï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> m sync.Map</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜å‚¨</span></span><br><span class="line">m.Store(key, value)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–</span></span><br><span class="line">value, ok := m.Load(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤</span></span><br><span class="line">m.Delete(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†</span></span><br><span class="line">m.Range(<span class="function"><span class="keyword">func</span><span class="params">(key, value <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†é€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// è¿”å›falseä¼šåœæ­¢éå†</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="map-çš„é›¶å€¼">map çš„é›¶å€¼</h2>
<ul>
<li><strong>é›¶å€¼</strong>ï¼šGo map çš„é›¶å€¼æ˜¯ <code>nil</code></li>
<li><strong>è¯»æ“ä½œ</strong>ï¼šå¯ä»¥ä» nil map è¯»å–ï¼Œè¿”å›é›¶å€¼å’Œ false</li>
<li><strong>å†™æ“ä½œ</strong>ï¼šä¸èƒ½å‘ nil map å†™å…¥ï¼Œä¼š panicï¼š<code>assignment to entry in nil map</code></li>
</ul>
<p><strong>æ­£ç¡®åˆå§‹åŒ–æ–¹å¼ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼1ï¼šä½¿ç”¨make</span></span><br><span class="line">m1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šå­—é¢é‡åˆå§‹åŒ–</span></span><br><span class="line">m2 := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>&#123;<span class="string">&quot;key&quot;</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼3ï¼šæŒ‡å®šå®¹é‡</span></span><br><span class="line">m3 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h2 id="å°ç»“">å°ç»“</h2>
<p>Go è¯­è¨€çš„ map æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œä½†åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li><strong>ç±»å‹é™åˆ¶</strong>ï¼škey å¿…é¡»æ˜¯å¯æ¯”è¾ƒç±»å‹</li>
<li><strong>å¹¶å‘å®‰å…¨</strong>ï¼šmap ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œéœ€è¦é¢å¤–çš„åŒæ­¥æœºåˆ¶</li>
<li><strong>é›¶å€¼å¤„ç†</strong>ï¼šnil map åªèƒ½è¯»ä¸èƒ½å†™</li>
<li><strong>éå†é¡ºåº</strong>ï¼šéå†é¡ºåºæ˜¯éšæœºçš„ï¼Œä¸è¦ä¾èµ–é¡ºåº</li>
<li><strong>æ€§èƒ½ç‰¹å¾</strong>ï¼šè¯»å†™åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)</li>
</ol>
<p>ç†è§£è¿™äº›åŸºç¡€æ¦‚å¿µå’Œç”¨æ³•æ˜¯æ·±å…¥å­¦ä¹  Go map åº•å±‚å®ç°çš„é‡è¦åŸºç¡€ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>Map</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
        <tag>Map</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: Go Map æ‰©å®¹æœºåˆ¶æ·±åº¦è§£æ</title>
    <url>/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1>Go Map æ‰©å®¹æœºåˆ¶æ·±åº¦è§£æ</h1>
<h2 id="æ‰©å®¹æœºåˆ¶æ¦‚è¿°">æ‰©å®¹æœºåˆ¶æ¦‚è¿°</h2>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/1750126901506.png" alt="1750126901506"></p>
<p>Go map çš„æ‰©å®¹æœºåˆ¶æ˜¯å…¶é«˜æ€§èƒ½çš„å…³é”®ä¿éšœã€‚é€šè¿‡åŠ¨æ€è°ƒæ•´æ¡¶æ•°ç»„å¤§å°ï¼Œmap èƒ½å¤Ÿåœ¨å…ƒç´ æ•°é‡å¢é•¿æ—¶å§‹ç»ˆä¿æŒ O(1) çš„å¹³å‡è®¿é—®æ—¶é—´å¤æ‚åº¦ã€‚</p>
<h2 id="æ‰©å®¹ç±»å‹è¯¦è§£">æ‰©å®¹ç±»å‹è¯¦è§£</h2>
<p>map çš„æ‰©å®¹ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼šå¢é‡æ‰©å®¹å’Œç­‰é‡æ‰©å®¹ã€‚</p>
<h3 id="å¢é‡æ‰©å®¹ï¼ˆç¿»å€æ‰©å®¹ï¼‰">å¢é‡æ‰©å®¹ï¼ˆç¿»å€æ‰©å®¹ï¼‰</h3>
<p><strong>è¡¨ç°</strong>ï¼šæ‰©å®¹åï¼Œæ¡¶æ•°ç»„çš„é•¿åº¦å¢é•¿ä¸ºåŸé•¿åº¦çš„ 2 å€</p>
<p><strong>ç›®çš„</strong>ï¼šé™ä½æ¯ä¸ªæ¡¶ä¸­ key-value å¯¹çš„æ•°é‡ï¼Œä¼˜åŒ– map æ“ä½œçš„æ—¶é—´å¤æ‚åº¦</p>
<p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå½“è´Ÿè½½å› å­è¶…è¿‡ 6.5 æ—¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è´Ÿè½½å› å­ = å…ƒç´ æ€»æ•° / æ¡¶æ•°ç»„é•¿åº¦ &gt; 6.5</span><br></pre></td></tr></table></figure>
<h3 id="ç­‰é‡æ‰©å®¹ï¼ˆæ•´ç†æ‰©å®¹ï¼‰">ç­‰é‡æ‰©å®¹ï¼ˆæ•´ç†æ‰©å®¹ï¼‰</h3>
<p><strong>è¡¨ç°</strong>ï¼šæ‰©å®¹åï¼Œæ¡¶æ•°ç»„çš„é•¿åº¦å’Œä¹‹å‰ä¿æŒä¸€è‡´ï¼›ä½†æ˜¯æº¢å‡ºæ¡¶çš„æ•°é‡ä¼šä¸‹é™</p>
<p><strong>ç›®çš„</strong>ï¼šæé«˜æ¡¶ä¸»ä½“ç»“æ„çš„æ•°æ®å¡«å……ç‡ï¼Œå‡å°‘æº¢å‡ºæ¡¶æ•°é‡ï¼Œé¿å…å‘ç”Ÿå†…å­˜æ³„æ¼</p>
<p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå½“æº¢å‡ºæ¡¶æ•°é‡è¿‡å¤šæ—¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æº¢å‡ºæ¡¶æ•°é‡ &gt;= 2^B ï¼ˆB æœ€å¤§å– 15ï¼‰</span><br></pre></td></tr></table></figure>
<h2 id="æ‰©å®¹è§¦å‘æ¡ä»¶">æ‰©å®¹è§¦å‘æ¡ä»¶</h2>
<h3 id="è§¦å‘æ—¶æœº">è§¦å‘æ—¶æœº</h3>
<p>åªæœ‰ map çš„å†™æµç¨‹å¯èƒ½å¼€å¯æ‰©å®¹æ¨¡å¼ã€‚å†™ map æ–°æ’å…¥ key-value å¯¹ä¹‹å‰ï¼Œä¼šå‘èµ·æ‰©å®¹æ¡ä»¶åˆ¤æ–­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapassign</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span></span> unsafe.Pointer &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">if</span> !h.growing() &amp;&amp; (overLoadFactor(h.count+<span class="number">1</span>, h.B) || tooManyOverflowBuckets(h.noverflow, h.B)) &#123;</span><br><span class="line">		hashGrow(t, h)</span><br><span class="line">		<span class="keyword">goto</span> again</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰©å®¹çŠ¶æ€åˆ¤æ–­">æ‰©å®¹çŠ¶æ€åˆ¤æ–­</h3>
<p>æ ¹æ® hmap çš„ oldbuckets æ˜¯å¦ä¸ºç©ºï¼Œå¯ä»¥åˆ¤æ–­ map æ­¤å‰æ˜¯å¦å·²å¼€å¯æ‰©å®¹æ¨¡å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *hmap)</span></span> growing() <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> h.oldbuckets != <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¢é‡æ‰©å®¹æ¡ä»¶">å¢é‡æ‰©å®¹æ¡ä»¶</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	loadFactorNum = <span class="number">13</span></span><br><span class="line">	loadFactorDen = <span class="number">2</span></span><br><span class="line">	bucketCnt     = <span class="number">8</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">overLoadFactor</span><span class="params">(count <span class="type">int</span>, B <span class="type">uint8</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> count &gt; bucketCnt &amp;&amp; <span class="type">uintptr</span>(count) &gt; loadFactorNum*(bucketShift(B)/loadFactorDen)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¡ä»¶ï¼š</p>
<ul>
<li>map ä¸­ key-value å¯¹çš„æ•°é‡è¶…è¿‡ 8 ä¸ª</li>
<li>è´Ÿè½½å› å­å¤§äº 6.5ï¼ˆ13/2 = 6.5ï¼‰</li>
</ul>
<h3 id="ç­‰é‡æ‰©å®¹æ¡ä»¶">ç­‰é‡æ‰©å®¹æ¡ä»¶</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tooManyOverflowBuckets</span><span class="params">(noverflow <span class="type">uint16</span>, B <span class="type">uint8</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> B &gt; <span class="number">15</span> &#123;</span><br><span class="line">		B = <span class="number">15</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> noverflow &gt;= <span class="type">uint16</span>(<span class="number">1</span>)&lt;&lt;(B&amp;<span class="number">15</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¡ä»¶ï¼šæº¢å‡ºæ¡¶çš„æ•°é‡å¤§äºç­‰äº 2^B ä¸ªï¼ˆB å¤§äº 15 æ—¶å– 15ï¼‰</p>
<h2 id="æ‰©å®¹å¼€å¯æµç¨‹-hashGrow">æ‰©å®¹å¼€å¯æµç¨‹ - hashGrow</h2>
<h3 id="hashGrow-æ ¸å¿ƒå®ç°">hashGrow æ ¸å¿ƒå®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hashGrow</span><span class="params">(t *maptype, h *hmap)</span></span> &#123;</span><br><span class="line">	bigger := <span class="type">uint8</span>(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">if</span> !overLoadFactor(h.count+<span class="number">1</span>, h.B) &#123;</span><br><span class="line">		bigger = <span class="number">0</span></span><br><span class="line">		h.flags |= sameSizeGrow</span><br><span class="line">	&#125;</span><br><span class="line">	oldbuckets := h.buckets</span><br><span class="line">	newbuckets, nextOverflow := makeBucketArray(t, h.B+bigger, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">	flags := h.flags &amp;^ (iterator | oldIterator)</span><br><span class="line">	<span class="keyword">if</span> h.flags&amp;iterator != <span class="number">0</span> &#123;</span><br><span class="line">		flags |= oldIterator</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// commit the grow (atomic wrt gc)</span></span><br><span class="line">	h.B += bigger</span><br><span class="line">	h.flags = flags</span><br><span class="line">	h.oldbuckets = oldbuckets</span><br><span class="line">	h.buckets = newbuckets</span><br><span class="line">	h.nevacuate = <span class="number">0</span></span><br><span class="line">	h.noverflow = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> h.extra != <span class="literal">nil</span> &amp;&amp; h.extra.overflow != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> h.extra.oldoverflow != <span class="literal">nil</span> &#123;</span><br><span class="line">			throw(<span class="string">&quot;oldoverflow is not nil&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		h.extra.oldoverflow = h.extra.overflow</span><br><span class="line">		h.extra.overflow = <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> nextOverflow != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> h.extra == <span class="literal">nil</span> &#123;</span><br><span class="line">			h.extra = <span class="built_in">new</span>(mapextra)</span><br><span class="line">		&#125;</span><br><span class="line">		h.extra.nextOverflow = nextOverflow</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¼€å¯æµç¨‹è¯¦è§£">å¼€å¯æµç¨‹è¯¦è§£</h3>
<h4 id="1-æ‰©å®¹ç±»å‹åˆ¤æ–­">1. æ‰©å®¹ç±»å‹åˆ¤æ–­</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">bigger := <span class="type">uint8</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> !overLoadFactor(h.count+<span class="number">1</span>, h.B) &#123;</span><br><span class="line">	bigger = <span class="number">0</span></span><br><span class="line">	h.flags |= sameSizeGrow</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¢é‡æ‰©å®¹ï¼š<code>bigger = 1</code>ï¼Œæ–°æ¡¶æ•°ç»„é•¿åº¦ç¿»å€</li>
<li>ç­‰é‡æ‰©å®¹ï¼š<code>bigger = 0</code>ï¼Œå¹¶è®¾ç½®ç­‰é‡æ‰©å®¹æ ‡å¿—ä½</li>
</ul>
<h4 id="2-æ–°æ¡¶æ•°ç»„åˆ›å»º">2. æ–°æ¡¶æ•°ç»„åˆ›å»º</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">oldbuckets := h.buckets</span><br><span class="line">newbuckets, nextOverflow := makeBucketArray(t, h.B+bigger, <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¿å­˜è€æ¡¶æ•°ç»„å¼•ç”¨</li>
<li>åˆ›å»ºæ–°æ¡¶æ•°ç»„ï¼Œé•¿åº¦ä¸º 2^(B+bigger)</li>
<li>åŒæ—¶åˆ›å»ºæ–°çš„æº¢å‡ºæ¡¶</li>
</ul>
<h4 id="3-çŠ¶æ€æ›´æ–°">3. çŠ¶æ€æ›´æ–°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">h.B += bigger</span><br><span class="line">h.flags = flags</span><br><span class="line">h.oldbuckets = oldbuckets</span><br><span class="line">h.buckets = newbuckets</span><br><span class="line">h.nevacuate = <span class="number">0</span></span><br><span class="line">h.noverflow = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ›´æ–°æ¡¶æ•°ç»„é•¿åº¦æŒ‡æ•°</li>
<li>è®¾ç½®æ–°è€æ¡¶æ•°ç»„æŒ‡é’ˆ</li>
<li>é‡ç½®è¿ç§»è¿›åº¦å’Œæº¢å‡ºæ¡¶è®¡æ•°</li>
</ul>
<h4 id="4-æº¢å‡ºæ¡¶å¤„ç†">4. æº¢å‡ºæ¡¶å¤„ç†</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h.extra != <span class="literal">nil</span> &amp;&amp; h.extra.overflow != <span class="literal">nil</span> &#123;</span><br><span class="line">	h.extra.oldoverflow = h.extra.overflow</span><br><span class="line">	h.extra.overflow = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°†åŸæœ¬çš„æº¢å‡ºæ¡¶èµ‹ç»™ oldoverflowï¼Œä¸ºæ–°æ¡¶æ•°ç»„åˆ†é…æ–°çš„æº¢å‡ºæ¡¶ã€‚</p>
<h2 id="æ•°æ®è¿ç§»è§„åˆ™">æ•°æ®è¿ç§»è§„åˆ™</h2>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/1750126910858.png" alt="1750126910858"></p>
<h3 id="ç­‰é‡æ‰©å®¹è¿ç§»">ç­‰é‡æ‰©å®¹è¿ç§»</h3>
<p>åœ¨ç­‰é‡æ‰©å®¹ä¸­ï¼š</p>
<ul>
<li>æ–°æ¡¶æ•°ç»„é•¿åº¦ä¸åŸæ¡¶æ•°ç»„ç›¸åŒ</li>
<li>key-value å¯¹åœ¨æ–°æ¡¶æ•°ç»„å’Œè€æ¡¶æ•°ç»„ä¸­çš„ç´¢å¼•å·ä¿æŒä¸€è‡´</li>
<li>ä¸»è¦ç›®çš„æ˜¯é‡æ–°æ•´ç†æ•°æ®ï¼Œå‡å°‘æº¢å‡ºæ¡¶</li>
</ul>
<h3 id="å¢é‡æ‰©å®¹è¿ç§»">å¢é‡æ‰©å®¹è¿ç§»</h3>
<p>åœ¨å¢é‡æ‰©å®¹ä¸­ï¼š</p>
<ul>
<li>æ–°æ¡¶æ•°ç»„é•¿åº¦ä¸ºåŸæ¡¶æ•°ç»„çš„ 2 å€</li>
<li>æŠŠæ–°æ¡¶æ•°ç»„åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼š
<ul>
<li><strong>X åŒºåŸŸ</strong>ï¼šå¯¹åº”è€æ¡¶æ•°ç»„çš„åŒºåŸŸï¼ˆç´¢å¼• 0 åˆ° 2^(B-1)-1ï¼‰</li>
<li><strong>Y åŒºåŸŸ</strong>ï¼šæ–°æ‰©å±•çš„åŒºåŸŸï¼ˆç´¢å¼• 2^(B-1) åˆ° 2^B-1ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="è¿ç§»ä½ç½®è®¡ç®—">è¿ç§»ä½ç½®è®¡ç®—</h3>
<p>ä¸€ä¸ª key å±äºå“ªä¸ªæ¡¶ï¼Œå–å†³äºå…¶ hash å€¼å¯¹æ¡¶æ•°ç»„é•¿åº¦å–æ¨¡çš„ç»“æœï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">bucket = hash &amp; (<span class="number">2</span>^B - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨å¢é‡æ‰©å®¹ä¸­ï¼Œkey çš„æ–°ä½ç½®åªæœ‰ä¸¤ç§å¯èƒ½ï¼š</p>
<ul>
<li>åŸä½ç½® iï¼ˆX åŒºåŸŸï¼‰</li>
<li>åŸä½ç½® + è€æ¡¶æ•°ç»„é•¿åº¦ï¼ˆY åŒºåŸŸï¼‰</li>
</ul>
<p>åˆ¤æ–­ä¾æ®æ˜¯ hash å€¼çš„ç¬¬ B ä½ï¼š</p>
<ul>
<li>ç¬¬ B ä½ä¸º 0ï¼šè¿ç§»åˆ° X åŒºåŸŸ</li>
<li>ç¬¬ B ä½ä¸º 1ï¼šè¿ç§»åˆ° Y åŒºåŸŸ</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> hash&amp;(<span class="number">1</span>&lt;&lt;(B<span class="number">-1</span>)) == <span class="number">0</span> &#123;</span><br><span class="line">	<span class="comment">// è¿ç§»åˆ° X åŒºåŸŸï¼Œä½ç½®ä¸å˜</span></span><br><span class="line">	newBucket = oldBucket</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="comment">// è¿ç§»åˆ° Y åŒºåŸŸ</span></span><br><span class="line">	newBucket = oldBucket + oldBucketCount</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ¸è¿›å¼æ‰©å®¹æœºåˆ¶">æ¸è¿›å¼æ‰©å®¹æœºåˆ¶</h2>
<h3 id="æ¸è¿›å¼æ‰©å®¹ç­–ç•¥">æ¸è¿›å¼æ‰©å®¹ç­–ç•¥</h3>
<p>map é‡‡ç”¨æ¸è¿›å¼æ‰©å®¹æ–¹å¼ï¼Œé¿å…ä¸€æ¬¡æ€§å…¨é‡è¿ç§»å¯¼è‡´çš„æ€§èƒ½æŠ–åŠ¨ï¼š</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/1750126921148.png" alt="1750126921148"></p>
<p>å½“æ¯æ¬¡è§¦å‘å†™ã€åˆ æ“ä½œæ—¶ï¼Œä¼šä¸ºå¤„äºæ‰©å®¹æµç¨‹ä¸­çš„ map å®Œæˆä¸¤ç»„æ¡¶çš„æ•°æ®è¿ç§»ï¼š</p>
<ol>
<li>å½“å‰å†™ã€åˆ æ“ä½œæ‰€å‘½ä¸­çš„æ¡¶</li>
<li>å½“å‰æœªè¿ç§»çš„æ¡¶ä¸­ï¼Œç´¢å¼•æœ€å°çš„é‚£ä¸ªæ¡¶</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">growWork</span><span class="params">(t *maptype, h *hmap, bucket <span class="type">uintptr</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// è¿ç§»å½“å‰æ“ä½œå‘½ä¸­çš„æ¡¶</span></span><br><span class="line">	evacuate(t, h, bucket&amp;h.oldbucketmask())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿ç§»ä¸€ä¸ªé¢å¤–çš„æ¡¶æ¨è¿›æ‰©å®¹è¿›åº¦</span></span><br><span class="line">	<span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">		evacuate(t, h, h.nevacuate)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ¸è¿›å¼æ‰©å®¹ä¼˜åŠ¿">æ¸è¿›å¼æ‰©å®¹ä¼˜åŠ¿</h3>
<ol>
<li><strong>åˆ†æ‘Šå¼€é”€</strong>ï¼šå°†æ‰©å®¹å¼€é”€åˆ†æ‘Šåˆ°å¤šæ¬¡æ“ä½œä¸­</li>
<li><strong>é¿å…é˜»å¡</strong>ï¼šå•æ¬¡æ“ä½œä¸ä¼šå› æ‰©å®¹è€Œé•¿æ—¶é—´é˜»å¡</li>
<li><strong>å†…å­˜å‹å¥½</strong>ï¼šæ–°è€æ•°ç»„å¹¶å­˜æ—¶é—´è¾ƒçŸ­ï¼Œå‡å°‘å†…å­˜å‹åŠ›</li>
<li><strong>ç”¨æˆ·æ— æ„ŸçŸ¥</strong>ï¼šå¯¹ç”¨æˆ·æ¥è¯´æ‰©å®¹è¿‡ç¨‹é€æ˜</li>
</ol>
<h2 id="æ•°æ®è¿ç§»å®ç°-evacuate">æ•°æ®è¿ç§»å®ç° - evacuate</h2>
<h3 id="evacuate-æ ¸å¿ƒé€»è¾‘">evacuate æ ¸å¿ƒé€»è¾‘</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">evacuate</span><span class="params">(t *maptype, h *hmap, oldbucket <span class="type">uintptr</span>)</span></span> &#123;</span><br><span class="line">	b := (*bmap)(add(h.oldbuckets, oldbucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">	newbit := h.noldbuckets()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !evacuated(b) &#123;</span><br><span class="line">		<span class="keyword">var</span> xy [<span class="number">2</span>]evacDst</span><br><span class="line">		x := &amp;xy[<span class="number">0</span>]</span><br><span class="line">		x.b = (*bmap)(add(h.buckets, oldbucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">		x.k = add(unsafe.Pointer(x.b), dataOffset)</span><br><span class="line">		x.e = add(x.k, bucketCnt*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !h.sameSizeGrow() &#123;</span><br><span class="line">			y := &amp;xy[<span class="number">1</span>]</span><br><span class="line">			y.b = (*bmap)(add(h.buckets, (oldbucket+newbit)*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">			y.k = add(unsafe.Pointer(y.b), dataOffset)</span><br><span class="line">			y.e = add(y.k, bucketCnt*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line">			k := add(unsafe.Pointer(b), dataOffset)</span><br><span class="line">			e := add(k, bucketCnt*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; bucketCnt; i, k, e = i+<span class="number">1</span>, add(k, <span class="type">uintptr</span>(t.keysize)), add(e, <span class="type">uintptr</span>(t.elemsize)) &#123;</span><br><span class="line">				top := b.tophash[i]</span><br><span class="line">				<span class="keyword">if</span> isEmpty(top) &#123;</span><br><span class="line">					b.tophash[i] = evacuatedEmpty</span><br><span class="line">					<span class="keyword">continue</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> top &lt; minTopHash &#123;</span><br><span class="line">					throw(<span class="string">&quot;bad map state&quot;</span>)</span><br><span class="line">				&#125;</span><br><span class="line">				k2 := k</span><br><span class="line">				<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">					k2 = *((*unsafe.Pointer)(k2))</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">var</span> useY <span class="type">uint8</span></span><br><span class="line">				<span class="keyword">if</span> !h.sameSizeGrow() &#123;</span><br><span class="line">					hash := t.hasher(k2, <span class="type">uintptr</span>(h.hash0))</span><br><span class="line">					<span class="keyword">if</span> hash&amp;newbit != <span class="number">0</span> &#123;</span><br><span class="line">						useY = <span class="number">1</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				b.tophash[i] = evacuatedX + useY</span><br><span class="line">				dst := &amp;xy[useY]</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> dst.i == bucketCnt &#123;</span><br><span class="line">					dst.b = h.newoverflow(t, dst.b)</span><br><span class="line">					dst.i = <span class="number">0</span></span><br><span class="line">					dst.k = add(unsafe.Pointer(dst.b), dataOffset)</span><br><span class="line">					dst.e = add(dst.k, bucketCnt*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">				&#125;</span><br><span class="line">				dst.b.tophash[dst.i&amp;(bucketCnt<span class="number">-1</span>)] = top</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å¤åˆ¶ key</span></span><br><span class="line">				<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">					*(*unsafe.Pointer)(dst.k) = k2</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					typedmemmove(t.key, dst.k, k)</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å¤åˆ¶ value</span></span><br><span class="line">				<span class="keyword">if</span> t.indirectelem() &#123;</span><br><span class="line">					*(*unsafe.Pointer)(dst.e) = *(*unsafe.Pointer)(e)</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					typedmemmove(t.elem, dst.e, e)</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				dst.i++</span><br><span class="line">				dst.k = add(dst.k, <span class="type">uintptr</span>(t.keysize))</span><br><span class="line">				dst.e = add(dst.e, <span class="type">uintptr</span>(t.elemsize))</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¸…ç†è€æ¡¶å†…å­˜</span></span><br><span class="line">		<span class="keyword">if</span> h.flags&amp;oldIterator == <span class="number">0</span> &amp;&amp; t.bucket.ptrdata != <span class="number">0</span> &#123;</span><br><span class="line">			bMem := add(h.oldbuckets, oldbucket*<span class="type">uintptr</span>(t.bucketsize))</span><br><span class="line">			ptr := add(bMem, dataOffset)</span><br><span class="line">			n := <span class="type">uintptr</span>(t.bucketsize) - dataOffset</span><br><span class="line">			memclrHasPointers(ptr, n)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> oldbucket == h.nevacuate &#123;</span><br><span class="line">		advanceEvacuationMark(h, t, newbit)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿ç§»è¿‡ç¨‹è¯¦è§£">è¿ç§»è¿‡ç¨‹è¯¦è§£</h3>
<h4 id="1-ç›®æ ‡æ¡¶å‡†å¤‡">1. ç›®æ ‡æ¡¶å‡†å¤‡</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xy [<span class="number">2</span>]evacDst</span><br><span class="line">x := &amp;xy[<span class="number">0</span>]  <span class="comment">// X åŒºåŸŸç›®æ ‡æ¡¶</span></span><br><span class="line">y := &amp;xy[<span class="number">1</span>]  <span class="comment">// Y åŒºåŸŸç›®æ ‡æ¡¶ï¼ˆä»…å¢é‡æ‰©å®¹ä½¿ç”¨ï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="2-è¿ç§»ä½ç½®è®¡ç®—">2. è¿ç§»ä½ç½®è®¡ç®—</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> useY <span class="type">uint8</span></span><br><span class="line"><span class="keyword">if</span> !h.sameSizeGrow() &#123;</span><br><span class="line">	hash := t.hasher(k2, <span class="type">uintptr</span>(h.hash0))</span><br><span class="line">	<span class="keyword">if</span> hash&amp;newbit != <span class="number">0</span> &#123;</span><br><span class="line">		useY = <span class="number">1</span>  <span class="comment">// è¿ç§»åˆ° Y åŒºåŸŸ</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-æ•°æ®å¤åˆ¶">3. æ•°æ®å¤åˆ¶</h4>
<p>æ ¹æ® key å’Œ value æ˜¯å¦ä¸ºæŒ‡é’ˆç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„å¤åˆ¶æ–¹å¼ï¼š</p>
<ul>
<li>æŒ‡é’ˆç±»å‹ï¼šç›´æ¥å¤åˆ¶æŒ‡é’ˆ</li>
<li>å€¼ç±»å‹ï¼šä½¿ç”¨ <code>typedmemmove</code> å¤åˆ¶æ•°æ®</li>
</ul>
<h4 id="4-çŠ¶æ€æ ‡è®°">4. çŠ¶æ€æ ‡è®°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">b.tophash[i] = evacuatedX + useY</span><br></pre></td></tr></table></figure>
<p>è¿ç§»å®Œæˆåï¼Œåœ¨è€æ¡¶ä¸­æ ‡è®°è¯¥ä½ç½®å·²è¿ç§»ï¼š</p>
<ul>
<li><code>evacuatedX</code>ï¼šå·²è¿ç§»åˆ° X åŒºåŸŸ</li>
<li><code>evacuatedY</code>ï¼šå·²è¿ç§»åˆ° Y åŒºåŸŸ</li>
</ul>
<h3 id="è¿ç§»è¿›åº¦ç®¡ç†">è¿ç§»è¿›åº¦ç®¡ç†</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">advanceEvacuationMark</span><span class="params">(h *hmap, t *maptype, newbit <span class="type">uintptr</span>)</span></span> &#123;</span><br><span class="line">	h.nevacuate++</span><br><span class="line">	stop := h.nevacuate + <span class="number">1024</span></span><br><span class="line">	<span class="keyword">if</span> stop &gt; newbit &#123;</span><br><span class="line">		stop = newbit</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> h.nevacuate != stop &amp;&amp; bucketEvacuated(t, h, h.nevacuate) &#123;</span><br><span class="line">		h.nevacuate++</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> h.nevacuate == newbit &#123;</span><br><span class="line">		<span class="comment">// æ‰€æœ‰æ¡¶éƒ½å·²è¿ç§»å®Œæˆ</span></span><br><span class="line">		h.oldbuckets = <span class="literal">nil</span></span><br><span class="line">		<span class="keyword">if</span> h.extra != <span class="literal">nil</span> &#123;</span><br><span class="line">			h.extra.oldoverflow = <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">		h.flags &amp;^= sameSizeGrow</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ‰©å®¹æœŸé—´çš„æ“ä½œå¤„ç†">æ‰©å®¹æœŸé—´çš„æ“ä½œå¤„ç†</h2>
<h3 id="è¯»æ“ä½œå¤„ç†">è¯»æ“ä½œå¤„ç†</h3>
<p>è¯»æ“ä½œéœ€è¦åŒæ—¶æ£€æŸ¥æ–°è€æ¡¶æ•°ç»„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> c := h.oldbuckets; c != <span class="literal">nil</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> !h.sameSizeGrow() &#123;</span><br><span class="line">		m &gt;&gt;= <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">	oldb := (*bmap)(add(c, (hash&amp;m)*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">	<span class="keyword">if</span> !evacuated(oldb) &#123;</span><br><span class="line">		b = oldb  <span class="comment">// ä»è€æ¡¶è¯»å–</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å†™æ“ä½œå¤„ç†">å†™æ“ä½œå¤„ç†</h3>
<p>å†™æ“ä½œä¼šååŠ©æ‰©å®¹è¿›ç¨‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">	growWork(t, h, bucket)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡å†™æ“ä½œéƒ½ä¼šè¿ç§»ä¸¤ä¸ªæ¡¶ï¼Œæ¨è¿›æ‰©å®¹è¿›åº¦ã€‚</p>
<h3 id="åˆ é™¤æ“ä½œå¤„ç†">åˆ é™¤æ“ä½œå¤„ç†</h3>
<p>åˆ é™¤æ“ä½œåŒæ ·ä¼šååŠ©æ‰©å®¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">	growWork(t, h, bucket)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€§èƒ½åˆ†æä¸ä¼˜åŒ–">æ€§èƒ½åˆ†æä¸ä¼˜åŒ–</h2>
<h3 id="æ‰©å®¹å¼€é”€åˆ†æ">æ‰©å®¹å¼€é”€åˆ†æ</h3>
<ol>
<li><strong>å†…å­˜å¼€é”€</strong>ï¼šæ‰©å®¹æœŸé—´éœ€è¦åŒæ—¶ç»´æŠ¤æ–°è€ä¸¤ä¸ªæ¡¶æ•°ç»„</li>
<li><strong>æ—¶é—´å¼€é”€</strong>ï¼šæ¯æ¬¡å†™æ“ä½œé¢å¤–è¿ç§»ä¸¤ä¸ªæ¡¶</li>
<li><strong>GC å‹åŠ›</strong>ï¼šè¿ç§»è¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿé¢å¤–çš„åƒåœ¾å›æ”¶å‹åŠ›</li>
</ol>
<h3 id="è´Ÿè½½å› å­é€‰æ‹©">è´Ÿè½½å› å­é€‰æ‹©</h3>
<p>Go é€‰æ‹© 6.5 ä½œä¸ºè´Ÿè½½å› å­çš„åŸå› ï¼š</p>
<ul>
<li><strong>æŸ¥æ‰¾æ•ˆç‡</strong>ï¼šä¿è¯å¤§éƒ¨åˆ†æŸ¥æ‰¾åœ¨å¸¸æ•°æ—¶é—´å†…å®Œæˆ</li>
<li><strong>å†…å­˜åˆ©ç”¨ç‡</strong>ï¼šé¿å…å†…å­˜æµªè´¹</li>
<li><strong>æ‰©å®¹é¢‘ç‡</strong>ï¼šå¹³è¡¡æ‰©å®¹å¼€é”€å’Œæ€§èƒ½</li>
</ul>
<h3 id="æ¸è¿›å¼æ‰©å®¹ä¼˜åŒ–">æ¸è¿›å¼æ‰©å®¹ä¼˜åŒ–</h3>
<ol>
<li><strong>æ‰¹é‡è¿ç§»</strong>ï¼šä¸€æ¬¡è¿ç§»æ•´ä¸ªæ¡¶é“¾è¡¨</li>
<li><strong>å†…å­˜æ¸…ç†</strong>ï¼šåŠæ—¶æ¸…ç†è€æ¡¶å†…å­˜</li>
<li><strong>çŠ¶æ€è·Ÿè¸ª</strong>ï¼šç²¾ç¡®è·Ÿè¸ªè¿ç§»è¿›åº¦</li>
</ol>
<h2 id="é¢è¯•é‡ç‚¹é—®é¢˜">é¢è¯•é‡ç‚¹é—®é¢˜</h2>
<h3 id="Q1-Go-map-ä»€ä¹ˆæ—¶å€™ä¼šæ‰©å®¹ï¼Ÿ">Q1: Go map ä»€ä¹ˆæ—¶å€™ä¼šæ‰©å®¹ï¼Ÿ</h3>
<p><strong>A:</strong> Go map æœ‰ä¸¤ç§æ‰©å®¹è§¦å‘æ¡ä»¶ï¼š</p>
<p><strong>å¢é‡æ‰©å®¹ï¼ˆå®¹é‡ç¿»å€ï¼‰ï¼š</strong></p>
<ul>
<li>è§¦å‘æ¡ä»¶ï¼šè´Ÿè½½å› å­ &gt; 6.5ï¼ˆcount/2^B &gt; 6.5ï¼‰</li>
<li>æ‰©å®¹åï¼šæ¡¶æ•°ç»„é•¿åº¦å˜ä¸ºåŸæ¥çš„ 2 å€</li>
</ul>
<p><strong>ç­‰é‡æ‰©å®¹ï¼ˆå®¹é‡ä¸å˜ï¼‰ï¼š</strong></p>
<ul>
<li>è§¦å‘æ¡ä»¶ï¼šæº¢å‡ºæ¡¶æ•°é‡ &gt;= 2^B</li>
<li>ç›®çš„ï¼šæ•´ç†æ•°æ®ï¼Œå‡å°‘æº¢å‡ºæ¡¶æ•°é‡</li>
</ul>
<h3 id="Q2-Go-map-æ‰©å®¹ä¸ºä»€ä¹ˆæ˜¯æ¸è¿›å¼çš„ï¼Ÿ">Q2: Go map æ‰©å®¹ä¸ºä»€ä¹ˆæ˜¯æ¸è¿›å¼çš„ï¼Ÿ</h3>
<p><strong>A:</strong> æ¸è¿›å¼æ‰©å®¹çš„ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>é¿å…é˜»å¡</strong>ï¼šä¸€æ¬¡æ€§è¿ç§»æ‰€æœ‰æ•°æ®ä¼šå¯¼è‡´é•¿æ—¶é—´é˜»å¡</li>
<li><strong>åˆ†æ‘Šå¼€é”€</strong>ï¼šå°†è¿ç§»å¼€é”€åˆ†æ‘Šåˆ°å¤šæ¬¡æ“ä½œä¸­</li>
<li><strong>ç”¨æˆ·æ— æ„ŸçŸ¥</strong>ï¼šç”¨æˆ·æ“ä½œä¸ä¼šæ„Ÿå—åˆ°æ‰©å®¹çš„å½±å“</li>
<li><strong>å†…å­˜å‹å¥½</strong>ï¼šå‡å°‘å†…å­˜å³°å€¼ä½¿ç”¨</li>
</ol>
<h3 id="Q3-æ‰©å®¹æœŸé—´å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ">Q3: æ‰©å®¹æœŸé—´å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</h3>
<p><strong>A:</strong> æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶ï¼š</p>
<ol>
<li><strong>åŒæ•°ç»„æŸ¥æ‰¾</strong>ï¼šè¯»æ“ä½œåŒæ—¶æ£€æŸ¥æ–°è€æ¡¶æ•°ç»„</li>
<li><strong>ååŠ©è¿ç§»</strong>ï¼šå†™æ“ä½œååŠ©æ¨è¿›è¿ç§»è¿›åº¦</li>
<li><strong>çŠ¶æ€æ ‡è®°</strong>ï¼šé€šè¿‡ tophash æ ‡è®°è®°å½•è¿ç§»çŠ¶æ€</li>
<li><strong>åŸå­æ“ä½œ</strong>ï¼šå…³é”®çŠ¶æ€æ›´æ–°ä½¿ç”¨åŸå­æ“ä½œ</li>
</ol>
<h3 id="Q4-ä¸ºä»€ä¹ˆè´Ÿè½½å› å­é€‰æ‹©-6-5ï¼Ÿ">Q4: ä¸ºä»€ä¹ˆè´Ÿè½½å› å­é€‰æ‹© 6.5ï¼Ÿ</h3>
<p><strong>A:</strong> 6.5 è´Ÿè½½å› å­çš„é€‰æ‹©å¹³è¡¡äº†å¤šä¸ªå› ç´ ï¼š</p>
<ol>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šä¿è¯å¤§éƒ¨åˆ†æŸ¥æ‰¾åœ¨ O(1) æ—¶é—´å†…å®Œæˆ</li>
<li><strong>å†…å­˜æ•ˆç‡</strong>ï¼šé¿å…è¿‡å¤šçš„å†…å­˜æµªè´¹</li>
<li><strong>æ‰©å®¹é¢‘ç‡</strong>ï¼šæ§åˆ¶æ‰©å®¹æ“ä½œçš„é¢‘ç‡</li>
<li><strong>å®éªŒç»“æœ</strong>ï¼šç»è¿‡å¤§é‡å®éªŒéªŒè¯çš„æœ€ä¼˜å€¼</li>
</ol>
<p>ç†è§£ Go map çš„æ‰©å®¹æœºåˆ¶å¯¹äºä¼˜åŒ–ç¨‹åºæ€§èƒ½å’Œé¿å…æ€§èƒ½é™·é˜±éå¸¸é‡è¦ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>Map</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
        <tag>æ‰©å®¹æœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: Go Map æ„é€ ä¸åˆå§‹åŒ–æµç¨‹</title>
    <url>/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%9E%84%E9%80%A0%E4%B8%8E%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<h1>Go Map æ„é€ ä¸åˆå§‹åŒ–æµç¨‹</h1>
<h2 id="æ„é€ æµç¨‹æ¦‚è¿°">æ„é€ æµç¨‹æ¦‚è¿°</h2>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%9E%84%E9%80%A0%E4%B8%8E%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B/1750126785867.png" alt="1750126785867"></p>
<p>åˆ›å»º map æ—¶ï¼Œå®é™…ä¸Šä¼šè°ƒç”¨ runtime/map.go æ–‡ä»¶ä¸­çš„ makemap æ–¹æ³•ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æ map çš„æ„é€ å’Œåˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>
<h2 id="makemap-æ ¸å¿ƒå®ç°">makemap æ ¸å¿ƒå®ç°</h2>
<h3 id="ä¸»å¹²æºç åˆ†æ">ä¸»å¹²æºç åˆ†æ</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makemap</span><span class="params">(t *maptype, hint <span class="type">int</span>, h *hmap)</span></span> *hmap &#123;</span><br><span class="line">	mem, overflow := math.MulUintptr(<span class="type">uintptr</span>(hint), t.bucket.size)</span><br><span class="line">	<span class="keyword">if</span> overflow || mem &gt; maxAlloc &#123;</span><br><span class="line">		hint = <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> h == <span class="literal">nil</span> &#123;</span><br><span class="line">		h = <span class="built_in">new</span>(hmap)</span><br><span class="line">	&#125;</span><br><span class="line">	h.hash0 = fastrand()</span><br><span class="line"></span><br><span class="line">	B := <span class="type">uint8</span>(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> overLoadFactor(hint, B) &#123;</span><br><span class="line">		B++</span><br><span class="line">	&#125;</span><br><span class="line">	h.B = B</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> h.B != <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">var</span> nextOverflow *bmap</span><br><span class="line">		h.buckets, nextOverflow = makeBucketArray(t, h.B, <span class="literal">nil</span>)</span><br><span class="line">		<span class="keyword">if</span> nextOverflow != <span class="literal">nil</span> &#123;</span><br><span class="line">			h.extra = <span class="built_in">new</span>(mapextra)</span><br><span class="line">			h.extra.nextOverflow = nextOverflow</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¯¦ç»†æ­¥éª¤è§£æ">è¯¦ç»†æ­¥éª¤è§£æ</h3>
<h4 id="1-å†…å­˜æº¢å‡ºæ£€æŸ¥">1. å†…å­˜æº¢å‡ºæ£€æŸ¥</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">mem, overflow := math.MulUintptr(<span class="type">uintptr</span>(hint), t.bucket.size)</span><br><span class="line"><span class="keyword">if</span> overflow || mem &gt; maxAlloc &#123;</span><br><span class="line">	hint = <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ1ï¼‰hint ä¸º map æ‹Ÿåˆ†é…çš„å®¹é‡ï¼›åœ¨åˆ†é…å‰ï¼Œä¼šæå‰å¯¹æ‹Ÿåˆ†é…çš„å†…å­˜å¤§å°è¿›è¡Œåˆ¤æ–­ï¼Œå€˜è‹¥è¶…é™ï¼Œä¼šå°† hint ç½®ä¸ºé›¶ï¼›</p>
<p>è¿™ä¸€æ­¥éª¤é˜²æ­¢å› ä¸ºè¿‡å¤§çš„ hint å€¼å¯¼è‡´å†…å­˜æº¢å‡ºæˆ–è¶…å‡ºç³»ç»Ÿé™åˆ¶ã€‚</p>
<h4 id="2-hmap-ç»“æ„ä½“åˆå§‹åŒ–">2. hmap ç»“æ„ä½“åˆå§‹åŒ–</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h == <span class="literal">nil</span> &#123;</span><br><span class="line">	h = <span class="built_in">new</span>(hmap)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ new æ–¹æ³•åˆå§‹åŒ– hmap ç»“æ„ä½“ï¼Œè¿™æ˜¯ map çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚</p>
<h4 id="3-å“ˆå¸Œç§å­ç”Ÿæˆ">3. å“ˆå¸Œç§å­ç”Ÿæˆ</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">h.hash0 = fastrand()</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨ fastrandï¼Œæ„é€  hash å› å­ï¼šhmap.hash0ã€‚è¿™ä¸ªéšæœºç§å­ç”¨äºå“ˆå¸Œè®¡ç®—ï¼Œå¢å¼ºå®‰å…¨æ€§å’Œæ•£åˆ—æ•ˆæœã€‚</p>
<h4 id="4-æ¡¶æ•°ç»„å®¹é‡è®¡ç®—">4. æ¡¶æ•°ç»„å®¹é‡è®¡ç®—</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">B := <span class="type">uint8</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> overLoadFactor(hint, B) &#123;</span><br><span class="line">	B++</span><br><span class="line">&#125;</span><br><span class="line">h.B = B</span><br></pre></td></tr></table></figure>
<p>å¤§è‡´ä¸ŠåŸºäº log2(B) &gt;= hint çš„æ€è·¯ï¼ˆå…·ä½“è§ overLoadFactor æ–¹æ³•çš„ä»‹ç»ï¼‰ï¼Œè®¡ç®—æ¡¶æ•°ç»„çš„å®¹é‡æŒ‡æ•° Bã€‚</p>
<h4 id="5-æ¡¶æ•°ç»„å’Œæº¢å‡ºæ¡¶åˆå§‹åŒ–">5. æ¡¶æ•°ç»„å’Œæº¢å‡ºæ¡¶åˆå§‹åŒ–</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h.B != <span class="number">0</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> nextOverflow *bmap</span><br><span class="line">	h.buckets, nextOverflow = makeBucketArray(t, h.B, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> nextOverflow != <span class="literal">nil</span> &#123;</span><br><span class="line">		h.extra = <span class="built_in">new</span>(mapextra)</span><br><span class="line">		h.extra.nextOverflow = nextOverflow</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ5ï¼‰è°ƒç”¨ makeBucketArray æ–¹æ³•ï¼Œåˆå§‹åŒ–æ¡¶æ•°ç»„ hmap.bucketsï¼›</p>
<p>ï¼ˆ6ï¼‰å€˜è‹¥ map å®¹é‡è¾ƒå¤§ï¼Œä¼šæå‰ç”³è¯·ä¸€æ‰¹æº¢å‡ºæ¡¶ hmap.extraã€‚</p>
<h2 id="overLoadFactor-è´Ÿè½½å› å­åˆ¤æ–­">overLoadFactor è´Ÿè½½å› å­åˆ¤æ–­</h2>
<p>é€šè¿‡ overLoadFactor æ–¹æ³•ï¼Œå¯¹ map é¢„åˆ†é…å®¹é‡å’Œæ¡¶æ•°ç»„é•¿åº¦æŒ‡æ•°è¿›è¡Œåˆ¤æ–­ï¼Œå†³å®šæ˜¯å¦ä»éœ€è¦å¢é•¿ B çš„æ•°å€¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> loadFactorNum = <span class="number">13</span></span><br><span class="line"><span class="keyword">const</span> loadFactorDen = <span class="number">2</span></span><br><span class="line"><span class="keyword">const</span> bucketCnt = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">overLoadFactor</span><span class="params">(count <span class="type">int</span>, B <span class="type">uint8</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> count &gt; bucketCnt &amp;&amp; <span class="type">uintptr</span>(count) &gt; loadFactorNum*(bucketShift(B)/loadFactorDen)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bucketShift</span><span class="params">(b <span class="type">uint8</span>)</span></span> <span class="type">uintptr</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="type">uintptr</span>(<span class="number">1</span>) &lt;&lt; (b &amp; (goarch.PtrSize*<span class="number">8</span> - <span class="number">1</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è´Ÿè½½å› å­è§„åˆ™">è´Ÿè½½å› å­è§„åˆ™</h3>
<p>ï¼ˆ1ï¼‰å€˜è‹¥ map é¢„åˆ†é…å®¹é‡å°äºç­‰äº 8ï¼ŒB å– 0ï¼Œæ¡¶çš„ä¸ªæ•°ä¸º 1ï¼›</p>
<p>ï¼ˆ2ï¼‰ä¿è¯ map é¢„åˆ†é…å®¹é‡å°äºç­‰äºæ¡¶æ•°ç»„é•¿åº¦ * 6.5ã€‚</p>
<h3 id="å®¹é‡ä¸æ¡¶æ•°ç»„å…³ç³»è¡¨">å®¹é‡ä¸æ¡¶æ•°ç»„å…³ç³»è¡¨</h3>
<table>
<thead>
<tr>
<th>kv å¯¹æ•°é‡</th>
<th>æ¡¶æ•°ç»„é•¿åº¦æŒ‡æ•° B</th>
<th>æ¡¶æ•°ç»„é•¿åº¦ 2^B</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 ~ 8</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>9 ~ 13</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>14 ~ 26</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>27 ~ 52</td>
<td>3</td>
<td>8</td>
</tr>
<tr>
<td>2^(B-1) * 6.5+1 ~ 2^B*6.5</td>
<td>B</td>
<td>2^B</td>
</tr>
</tbody>
</table>
<h2 id="makeBucketArray-æ¡¶æ•°ç»„åˆ†é…">makeBucketArray æ¡¶æ•°ç»„åˆ†é…</h2>
<p>makeBucketArray æ–¹æ³•ä¼šè¿›è¡Œæ¡¶æ•°ç»„çš„åˆå§‹åŒ–ï¼Œå¹¶æ ¹æ®æ¡¶çš„æ•°é‡å†³å®šæ˜¯å¦éœ€è¦æå‰ä½œæº¢å‡ºæ¡¶çš„åˆå§‹åŒ–ã€‚</p>
<h3 id="æ ¸å¿ƒå®ç°">æ ¸å¿ƒå®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeBucketArray</span><span class="params">(t *maptype, b <span class="type">uint8</span>, dirtyalloc unsafe.Pointer)</span></span> (buckets unsafe.Pointer, nextOverflow *bmap) &#123;</span><br><span class="line">	base := bucketShift(b)</span><br><span class="line">	nbuckets := base</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> b &gt;= <span class="number">4</span> &#123;</span><br><span class="line">		nbuckets += bucketShift(b - <span class="number">4</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	buckets = newarray(t.bucket, <span class="type">int</span>(nbuckets))</span><br><span class="line">	<span class="keyword">if</span> base != nbuckets &#123;</span><br><span class="line">		nextOverflow = (*bmap)(add(buckets, base*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">		last := (*bmap)(add(buckets, (nbuckets<span class="number">-1</span>)*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">		last.setoverflow(t, (*bmap)(buckets))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> buckets, nextOverflow</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¯¦ç»†æ­¥éª¤">è¯¦ç»†æ­¥éª¤</h3>
<h4 id="1-è®¡ç®—æ¡¶æ•°é‡">1. è®¡ç®—æ¡¶æ•°é‡</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">base := bucketShift(b)</span><br><span class="line">nbuckets := base</span><br><span class="line"><span class="keyword">if</span> b &gt;= <span class="number">4</span> &#123;</span><br><span class="line">	nbuckets += bucketShift(b - <span class="number">4</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>makeBucketArray ä¼šä¸º map çš„æ¡¶æ•°ç»„ç”³è¯·å†…å­˜ï¼Œåœ¨æ¡¶æ•°ç»„çš„æŒ‡æ•° b &gt;= 4 æ—¶ï¼ˆæ¡¶æ•°ç»„çš„å®¹é‡ &gt;= 16ï¼‰ï¼Œä¼šéœ€è¦æå‰åˆ›å»ºæº¢å‡ºæ¡¶ã€‚</p>
<ul>
<li><code>base</code>ï¼šè®°å½•æ¡¶æ•°ç»„çš„é•¿åº¦ï¼Œä¸åŒ…å«æº¢å‡ºæ¡¶</li>
<li><code>nbuckets</code>ï¼šè®°å½•ç´¯åŠ ä¸Šæº¢å‡ºæ¡¶åï¼Œæ¡¶æ•°ç»„çš„æ€»é•¿åº¦</li>
</ul>
<h4 id="2-å†…å­˜åˆ†é…">2. å†…å­˜åˆ†é…</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">buckets = newarray(t.bucket, <span class="type">int</span>(nbuckets))</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨ newarray æ–¹æ³•ä¸ºæ¡¶æ•°ç»„ç”³è¯·å†…å­˜ç©ºé—´ï¼Œè¿å¸¦ç€éœ€è¦åˆå§‹åŒ–çš„æº¢å‡ºæ¡¶ã€‚</p>
<h4 id="3-æº¢å‡ºæ¡¶é“¾æ¥">3. æº¢å‡ºæ¡¶é“¾æ¥</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> base != nbuckets &#123;</span><br><span class="line">	nextOverflow = (*bmap)(add(buckets, base*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">	last := (*bmap)(add(buckets, (nbuckets<span class="number">-1</span>)*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">	last.setoverflow(t, (*bmap)(buckets))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€˜è‹¥ base != nbucketsï¼Œè¯´æ˜éœ€è¦åˆ›å»ºæº¢å‡ºæ¡¶ï¼Œä¼šåŸºäºåœ°å€åç§»çš„æ–¹å¼ï¼Œé€šè¿‡ nextOverflow æŒ‡å‘é¦–ä¸ªæº¢å‡ºæ¡¶çš„åœ°å€ã€‚</p>
<p>å€˜è‹¥éœ€è¦åˆ›å»ºæº¢å‡ºæ¡¶ï¼Œä¼šå°†æœ€åä¸€ä¸ªæº¢å‡ºæ¡¶çš„ overflow æŒ‡é’ˆæŒ‡å‘ buckets æ•°ç»„ï¼Œä»¥æ­¤æ¥æ ‡è¯†ç”³è¯·çš„æº¢å‡ºæ¡¶å·²ç»ç”¨å®Œã€‚</p>
<h3 id="setoverflow-æ–¹æ³•">setoverflow æ–¹æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *bmap)</span></span> setoverflow(t *maptype, ovf *bmap) &#123;</span><br><span class="line">	*(**bmap)(add(unsafe.Pointer(b), <span class="type">uintptr</span>(t.bucketsize)-goarch.PtrSize)) = ovf</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•é€šè¿‡å†…å­˜åœ°å€åç§»ï¼Œå°†æº¢å‡ºæ¡¶æŒ‡é’ˆè®¾ç½®åˆ°æ¡¶ç»“æ„çš„æœ«å°¾ä½ç½®ã€‚</p>
<h2 id="æº¢å‡ºæ¡¶é¢„åˆ†é…ç­–ç•¥">æº¢å‡ºæ¡¶é¢„åˆ†é…ç­–ç•¥</h2>
<h3 id="é¢„åˆ†é…æ¡ä»¶">é¢„åˆ†é…æ¡ä»¶</h3>
<p>å½“æ¡¶æ•°ç»„é•¿åº¦æŒ‡æ•° B &gt;= 4 æ—¶ï¼ˆå³æ¡¶æ•°ç»„é•¿åº¦ &gt;= 16ï¼‰ï¼Œç³»ç»Ÿä¼šé¢„åˆ†é…æº¢å‡ºæ¡¶ï¼š</p>
<ul>
<li><strong>é¢„åˆ†é…æ•°é‡</strong>ï¼š2^(B-4) ä¸ªæº¢å‡ºæ¡¶</li>
<li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šè¿ç»­åˆ†é…åœ¨æ­£å¸¸æ¡¶æ•°ç»„ä¹‹å</li>
<li><strong>ç®¡ç†æ–¹å¼</strong>ï¼šé€šè¿‡ mapextra ç»“æ„ç®¡ç†</li>
</ul>
<h3 id="é¢„åˆ†é…ä¼˜åŠ¿">é¢„åˆ†é…ä¼˜åŠ¿</h3>
<ol>
<li><strong>å‡å°‘å†…å­˜åˆ†é…</strong>ï¼šé¿å…è¿è¡Œæ—¶é¢‘ç¹åˆ†é…æº¢å‡ºæ¡¶</li>
<li><strong>æé«˜æ€§èƒ½</strong>ï¼šé¢„åˆ†é…å‡å°‘äº†å†…å­˜åˆ†é…çš„å¼€é”€</li>
<li><strong>å†…å­˜è¿ç»­æ€§</strong>ï¼šé¢„åˆ†é…çš„æº¢å‡ºæ¡¶å†…å­˜åœ°å€è¿ç»­ï¼Œæé«˜ç¼“å­˜å‹å¥½æ€§</li>
</ol>
<h2 id="åˆå§‹åŒ–æµç¨‹æ€»ç»“">åˆå§‹åŒ–æµç¨‹æ€»ç»“</h2>
<ol>
<li><strong>å‚æ•°éªŒè¯</strong>ï¼šæ£€æŸ¥ hint å€¼æ˜¯å¦ä¼šå¯¼è‡´å†…å­˜æº¢å‡º</li>
<li><strong>ç»“æ„ä½“åˆ›å»º</strong>ï¼šåˆå§‹åŒ– hmap æ ¸å¿ƒç»“æ„</li>
<li><strong>éšæœºç§å­</strong>ï¼šç”Ÿæˆå“ˆå¸Œè®¡ç®—ç”¨çš„éšæœºå› å­</li>
<li><strong>å®¹é‡è®¡ç®—</strong>ï¼šæ ¹æ®è´Ÿè½½å› å­ç¡®å®šæ¡¶æ•°ç»„å¤§å°</li>
<li><strong>å†…å­˜åˆ†é…</strong>ï¼šåˆ†é…æ¡¶æ•°ç»„å’Œé¢„åˆ†é…æº¢å‡ºæ¡¶</li>
<li><strong>æŒ‡é’ˆè®¾ç½®</strong>ï¼šå»ºç«‹å„ç§æŒ‡é’ˆå…³ç³»ï¼Œå®Œæˆåˆå§‹åŒ–</li>
</ol>
<h2 id="æ€§èƒ½ä¼˜åŒ–è€ƒè™‘">æ€§èƒ½ä¼˜åŒ–è€ƒè™‘</h2>
<h3 id="å†…å­˜åˆ†é…ä¼˜åŒ–">å†…å­˜åˆ†é…ä¼˜åŒ–</h3>
<ol>
<li><strong>æ‰¹é‡åˆ†é…</strong>ï¼šæ¡¶æ•°ç»„å’Œæº¢å‡ºæ¡¶ä¸€æ¬¡æ€§åˆ†é…ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡</li>
<li><strong>å†…å­˜å¯¹é½</strong>ï¼šç¡®ä¿æ•°æ®ç»“æ„æŒ‰ç…§ CPU å­—é•¿å¯¹é½</li>
<li><strong>é¢„åˆ†é…ç­–ç•¥</strong>ï¼šæ ¹æ®å®¹é‡å¤§å°å†³å®šæ˜¯å¦é¢„åˆ†é…æº¢å‡ºæ¡¶</li>
</ol>
<h3 id="è´Ÿè½½å› å­ä¼˜åŒ–">è´Ÿè½½å› å­ä¼˜åŒ–</h3>
<ol>
<li><strong>6.5 è´Ÿè½½å› å­</strong>ï¼šå¹³è¡¡å†…å­˜ä½¿ç”¨å’ŒæŸ¥æ‰¾æ€§èƒ½</li>
<li><strong>åŠ¨æ€è°ƒæ•´</strong>ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µåŠ¨æ€æ‰©å®¹</li>
<li><strong>é¿å…é€€åŒ–</strong>ï¼šé˜²æ­¢å“ˆå¸Œè¡¨é€€åŒ–ä¸ºé“¾è¡¨</li>
</ol>
<h2 id="é¢è¯•è¦ç‚¹">é¢è¯•è¦ç‚¹</h2>
<h3 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h3>
<p><strong>Q1: make(map[int]int, 100) å’Œ make(map[int]int) æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p>
<p>A: ä¸»è¦åŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li><code>make(map[int]int, 100)</code>ï¼šä¼šæ ¹æ®å®¹é‡ hint é¢„åˆ†é…åˆé€‚å¤§å°çš„æ¡¶æ•°ç»„</li>
<li><code>make(map[int]int)</code>ï¼šåˆå§‹æ¡¶æ•°ç»„å¤§å°ä¸º 0ï¼Œéšç€å…ƒç´ å¢åŠ åŠ¨æ€æ‰©å®¹</li>
<li>é¢„åˆ†é…å¯ä»¥å‡å°‘åç»­çš„æ‰©å®¹æ“ä½œï¼Œæé«˜æ€§èƒ½</li>
</ul>
<p><strong>Q2: Go map åˆå§‹åŒ–æ—¶ä¸ºä»€ä¹ˆä½¿ç”¨éšæœºå“ˆå¸Œç§å­ï¼Ÿ</strong></p>
<p>A: ä½¿ç”¨éšæœºå“ˆå¸Œç§å­çš„ç›®çš„ï¼š</p>
<ul>
<li><strong>å®‰å…¨æ€§</strong>ï¼šé˜²æ­¢å“ˆå¸Œç¢°æ’æ”»å‡»</li>
<li><strong>æ•£åˆ—æ€§</strong>ï¼šæé«˜å“ˆå¸Œå€¼çš„éšæœºåˆ†å¸ƒ</li>
<li><strong>é¿å…é€€åŒ–</strong>ï¼šé˜²æ­¢ç‰¹å®šæ•°æ®å¯¼è‡´æ€§èƒ½é€€åŒ–</li>
</ul>
<p><strong>Q3: æº¢å‡ºæ¡¶ä»€ä¹ˆæ—¶å€™ä¼šè¢«é¢„åˆ†é…ï¼Ÿ</strong></p>
<p>A: é¢„åˆ†é…æ¡ä»¶ï¼š</p>
<ul>
<li>æ¡¶æ•°ç»„é•¿åº¦æŒ‡æ•° B &gt;= 4ï¼ˆå³è‡³å°‘ 16 ä¸ªæ¡¶ï¼‰</li>
<li>é¢„åˆ†é…æ•°é‡ä¸º 2^(B-4) ä¸ªæº¢å‡ºæ¡¶</li>
<li>ç›®çš„æ˜¯å‡å°‘è¿è¡Œæ—¶çš„å†…å­˜åˆ†é…å¼€é”€</li>
</ul>
<p>ç†è§£è¿™äº›åˆå§‹åŒ–ç»†èŠ‚æœ‰åŠ©äºæ›´å¥½åœ°ä½¿ç”¨å’Œä¼˜åŒ– Go è¯­è¨€ä¸­çš„ map æ•°æ®ç»“æ„ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>Map</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
        <tag>åˆå§‹åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: Go Map æ ¸å¿ƒåŸç†ä¸æ•°æ®ç»“æ„</title>
    <url>/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<h1>Go Map æ ¸å¿ƒåŸç†ä¸æ•°æ®ç»“æ„</h1>
<h2 id="æ ¸å¿ƒåŸç†æ¦‚è¿°">æ ¸å¿ƒåŸç†æ¦‚è¿°</h2>
<p>map åˆç§°ä¸º hash mapï¼Œåœ¨ç®—æ³•ä¸ŠåŸºäº hash å®ç° key çš„æ˜ å°„å’Œå¯»å€ï¼›åœ¨æ•°æ®ç»“æ„ä¸ŠåŸºäºæ¡¶æ•°ç»„å®ç° key-value å¯¹çš„å­˜å‚¨ã€‚</p>
<p>ä»¥ä¸€ç»„ key-value å¯¹å†™å…¥ map çš„æµç¨‹ä¸ºä¾‹è¿›è¡Œç®€è¿°ï¼š</p>
<p>ï¼ˆ1ï¼‰é€šè¿‡å“ˆå¸Œæ–¹æ³•å–å¾— key çš„ hash å€¼ï¼›</p>
<p>ï¼ˆ2ï¼‰hash å€¼å¯¹æ¡¶æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œç¡®å®šå…¶æ‰€å±çš„æ¡¶ï¼›</p>
<p>ï¼ˆ3ï¼‰åœ¨æ¡¶ä¸­æ’å…¥ key-value å¯¹ã€‚</p>
<p>hash çš„æ€§è´¨ï¼Œä¿è¯äº†ç›¸åŒçš„ key å¿…ç„¶äº§ç”Ÿç›¸åŒçš„ hash å€¼ï¼Œå› æ­¤èƒ½æ˜ å°„åˆ°ç›¸åŒçš„æ¡¶ä¸­ï¼Œé€šè¿‡æ¡¶å†…éå†çš„æ–¹å¼é”å®šå¯¹åº”çš„ key-value å¯¹ã€‚</p>
<p>å› æ­¤ï¼Œåªè¦åœ¨å®è§‚æµç¨‹ä¸Šï¼Œæ§åˆ¶æ¯ä¸ªæ¡¶ä¸­ key-value å¯¹çš„æ•°é‡ï¼Œå°±èƒ½ä¿è¯ map çš„å‡ é¡¹æ“ä½œéƒ½é™åˆ¶ä¸ºå¸¸æ•°çº§åˆ«çš„æ—¶é—´å¤æ‚åº¦ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126799085.png" alt="1750126799085"></p>
<h2 id="Hash-åŸç†">Hash åŸç†</h2>
<p>hash è¯‘ä½œæ•£åˆ—ï¼Œæ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„è¾“å…¥å‹ç¼©åˆ°æŸä¸€å›ºå®šé•¿åº¦çš„è¾“å‡ºæ‘˜è¦çš„è¿‡ç¨‹ï¼Œç”±äºè¿™ç§è½¬æ¢å±äºå‹ç¼©æ˜ å°„ï¼Œè¾“å…¥ç©ºé—´è¿œå¤§äºè¾“å‡ºç©ºé—´ï¼Œå› æ­¤ä¸åŒè¾“å…¥å¯èƒ½ä¼šæ˜ å°„æˆç›¸åŒçš„è¾“å‡ºç»“æœã€‚æ­¤å¤–ï¼Œhash åœ¨å‹ç¼©è¿‡ç¨‹ä¸­ä¼šå­˜åœ¨éƒ¨åˆ†ä¿¡æ¯çš„é—å¤±ï¼Œå› æ­¤è¿™ç§æ˜ å°„å…³ç³»å…·æœ‰ä¸å¯é€†çš„ç‰¹è´¨ã€‚</p>
<h3 id="Hash-çš„æ ¸å¿ƒç‰¹æ€§">Hash çš„æ ¸å¿ƒç‰¹æ€§</h3>
<p>ï¼ˆ1ï¼‰<strong>hash çš„å¯é‡å…¥æ€§</strong>ï¼šç›¸åŒçš„ keyï¼Œå¿…ç„¶äº§ç”Ÿç›¸åŒçš„ hash å€¼ï¼›</p>
<p>ï¼ˆ2ï¼‰<strong>hash çš„ç¦»æ•£æ€§</strong>ï¼šåªè¦ä¸¤ä¸ª key ä¸ç›¸åŒï¼Œä¸è®ºå…¶ç›¸ä¼¼åº¦çš„é«˜ä½ï¼Œäº§ç”Ÿçš„ hash å€¼ä¼šåœ¨æ•´ä¸ªè¾“å‡ºåŸŸå†…å‡åŒ€åœ°ç¦»æ•£åŒ–ï¼›</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126805900.png" alt="1750126805900"></p>
<p>ï¼ˆ3ï¼‰<strong>hash çš„å•å‘æ€§</strong>ï¼šä¼å›¾é€šè¿‡ hash å€¼åå‘æ˜ å°„å› key æ˜¯æ— è¿¹å¯å¯»çš„ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126812775.png" alt="1750126812775"></p>
<p>ï¼ˆ4ï¼‰<strong>hash å†²çª</strong>ï¼šç”±äºè¾“å…¥åŸŸï¼ˆkeyï¼‰æ— ç©·å¤§ï¼Œè¾“å‡ºåŸŸï¼ˆhash å€¼ï¼‰æœ‰é™ï¼Œå› æ­¤å¿…ç„¶å­˜åœ¨ä¸åŒ key æ˜ å°„åˆ°ç›¸åŒ hash å€¼çš„æƒ…å†µï¼Œç§°ä¹‹ä¸º hash å†²çªã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126819675.png" alt="1750126819675"></p>
<h2 id="æ¡¶æ•°ç»„ç»“æ„">æ¡¶æ•°ç»„ç»“æ„</h2>
<p>map ä¸­ï¼Œä¼šé€šè¿‡é•¿åº¦ä¸º 2 çš„æ•´æ•°æ¬¡å¹‚çš„æ¡¶æ•°ç»„è¿›è¡Œ key-value å¯¹çš„å­˜å‚¨ï¼š</p>
<p>ï¼ˆ1ï¼‰æ¯ä¸ªæ¡¶å›ºå®šå¯ä»¥å­˜æ”¾ 8 ä¸ª key-value å¯¹ï¼›</p>
<p>ï¼ˆ2ï¼‰å€˜è‹¥è¶…è¿‡ 8 ä¸ª key-value å¯¹æ‰“åˆ°æ¡¶æ•°ç»„çš„åŒä¸€ä¸ªç´¢å¼•å½“ä¸­ï¼Œæ­¤æ—¶ä¼šé€šè¿‡åˆ›å»ºæ¡¶é“¾è¡¨çš„æ–¹å¼æ¥åŒ–è§£è¿™ä¸€é—®é¢˜ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126827377.png" alt="1750126827377"></p>
<h3 id="æ¡¶æ•°ç»„çš„è®¾è®¡ä¼˜åŠ¿">æ¡¶æ•°ç»„çš„è®¾è®¡ä¼˜åŠ¿</h3>
<ol>
<li><strong>2 çš„å¹‚æ¬¡é•¿åº¦</strong>ï¼šä¾¿äºä½¿ç”¨ä½è¿ç®—è¿›è¡Œå–æ¨¡æ“ä½œï¼Œæé«˜æ€§èƒ½</li>
<li><strong>å›ºå®šæ¡¶å®¹é‡</strong>ï¼šæ¯ä¸ªæ¡¶å­˜å‚¨ 8 ä¸ªå…ƒç´ ï¼Œåœ¨å†…å­˜å±€éƒ¨æ€§å’ŒæŸ¥æ‰¾æ•ˆç‡é—´å–å¾—å¹³è¡¡</li>
<li><strong>æº¢å‡ºæ¡¶æœºåˆ¶</strong>ï¼šé€šè¿‡é“¾è¡¨è§£å†³å“ˆå¸Œå†²çªï¼Œä¿è¯æ•°æ®å®Œæ•´æ€§</li>
</ol>
<h2 id="æ‹‰é“¾æ³•è§£å†³-Hash-å†²çª">æ‹‰é“¾æ³•è§£å†³ Hash å†²çª</h2>
<p>é¦–å…ˆï¼Œç”±äº hash å†²çªçš„å­˜åœ¨ï¼Œä¸åŒ key å¯èƒ½å­˜åœ¨ç›¸åŒçš„ hash å€¼ï¼›</p>
<p>å†è€…ï¼Œhash å€¼ä¼šå¯¹æ¡¶æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œå› æ­¤ä¸åŒ hash å€¼å¯èƒ½è¢«æ‰“åˆ°åŒä¸€ä¸ªæ¡¶ä¸­ã€‚</p>
<p>ç»¼ä¸Šï¼Œä¸åŒçš„ key-value å¯èƒ½è¢«æ˜ å°„åˆ° map çš„åŒä¸€ä¸ªæ¡¶å½“ä¸­ã€‚</p>
<p>æ­¤æ—¶æœ€ç»å…¸çš„è§£å†³æ‰‹æ®µåˆ†ä¸ºä¸¤ç§ï¼šæ‹‰é“¾æ³•å’Œå¼€æ”¾å¯»å€æ³•ã€‚</p>
<h3 id="æ‹‰é“¾æ³•">æ‹‰é“¾æ³•</h3>
<p>æ‹‰é“¾æ³•ä¸­ï¼Œå°†å‘½ä¸­åŒä¸€ä¸ªæ¡¶çš„å…ƒç´ é€šè¿‡é“¾è¡¨çš„å½¢å¼è¿›è¡Œé“¾æ¥ï¼Œå› æ­¤å¾ˆä¾¿äºåŠ¨æ€æ‰©å±•ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126833996.png" alt="1750126833996"></p>
<h3 id="å¼€æ”¾å¯»å€æ³•">å¼€æ”¾å¯»å€æ³•</h3>
<p>å¼€æ”¾å¯»å€æ³•ä¸­ï¼Œåœ¨æ’å…¥æ–°æ¡ç›®æ—¶ï¼Œä¼šåŸºäºä¸€å®šçš„æ¢æµ‹ç­–ç•¥æŒç»­å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨äºå­˜æ”¾æ•°æ®çš„ç©ºä½ä¸ºæ­¢ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126854650.png" alt="1750126854650"></p>
<h3 id="ä¸¤ç§æ–¹æ³•çš„ä¼˜åŠ£å¯¹æ¯”">ä¸¤ç§æ–¹æ³•çš„ä¼˜åŠ£å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ‹‰é“¾æ³•</td>
<td>ç®€å•å¸¸ç”¨ï¼›æ— éœ€é¢„å…ˆä¸ºå…ƒç´ åˆ†é…å†…å­˜</td>
<td>éœ€è¦é¢å¤–æŒ‡é’ˆç©ºé—´ï¼›å†…å­˜ä¸è¿ç»­</td>
</tr>
<tr>
<td>å¼€æ”¾å¯»å€æ³•</td>
<td>æ— éœ€é¢å¤–çš„æŒ‡é’ˆç”¨äºé“¾æ¥å…ƒç´ ï¼›å†…å­˜åœ°å€å®Œå…¨è¿ç»­ï¼Œå¯ä»¥åŸºäºå±€éƒ¨æ€§åŸç†ï¼Œå……åˆ†åˆ©ç”¨ CPU é«˜é€Ÿç¼“å­˜</td>
<td>éœ€è¦é¢„åˆ†é…å†…å­˜ï¼›åˆ é™¤æ“ä½œå¤æ‚</td>
</tr>
</tbody>
</table>
<h3 id="Go-Map-çš„æ··åˆç­–ç•¥">Go Map çš„æ··åˆç­–ç•¥</h3>
<p>åœ¨ map è§£å†³ hash/åˆ†æ¡¶å†²çªé—®é¢˜æ—¶ï¼Œå®é™…ä¸Šç»“åˆäº†æ‹‰é“¾æ³•å’Œå¼€æ”¾å¯»å€æ³•ä¸¤ç§æ€è·¯ã€‚ä»¥ map çš„æ’å…¥å†™æµç¨‹ä¸ºä¾‹ï¼Œè¿›è¡Œæ€è·¯é˜è¿°ï¼š</p>
<p>ï¼ˆ1ï¼‰æ¡¶æ•°ç»„ä¸­çš„æ¯ä¸ªæ¡¶ï¼Œä¸¥æ ¼æ„ä¹‰ä¸Šæ˜¯ä¸€ä¸ªå•å‘æ¡¶é“¾è¡¨ï¼Œä»¥æ¡¶ä¸ºèŠ‚ç‚¹è¿›è¡Œä¸²è”ï¼›</p>
<p>ï¼ˆ2ï¼‰æ¯ä¸ªæ¡¶å›ºå®šå¯ä»¥å­˜æ”¾ 8 ä¸ª key-value å¯¹ï¼›</p>
<p>ï¼ˆ3ï¼‰å½“ key å‘½ä¸­ä¸€ä¸ªæ¡¶æ—¶ï¼Œé¦–å…ˆæ ¹æ®å¼€æ”¾å¯»å€æ³•ï¼Œåœ¨æ¡¶çš„ 8 ä¸ªä½ç½®ä¸­å¯»æ‰¾ç©ºä½è¿›è¡Œæ’å…¥ï¼›</p>
<p>ï¼ˆ4ï¼‰å€˜è‹¥æ¡¶çš„ 8 ä¸ªä½ç½®éƒ½å·²è¢«å æ»¡ï¼Œåˆ™åŸºäºæ¡¶çš„æº¢å‡ºæ¡¶æŒ‡é’ˆï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªæ¡¶ï¼Œé‡å¤ç¬¬ï¼ˆ3ï¼‰æ­¥ï¼›</p>
<p>ï¼ˆ5ï¼‰å€˜è‹¥éå†åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œä»æœªæ‰¾åˆ°ç©ºä½ï¼Œåˆ™åŸºäºæ‹‰é“¾æ³•ï¼Œåœ¨æ¡¶é“¾è¡¨å°¾éƒ¨ç»­æ¥æ–°æ¡¶ï¼Œå¹¶æ’å…¥ key-value å¯¹ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126861545.png" alt="1750126861545"></p>
<h2 id="æ‰©å®¹ä¼˜åŒ–æ€§èƒ½">æ‰©å®¹ä¼˜åŒ–æ€§èƒ½</h2>
<p>å€˜è‹¥ map çš„æ¡¶æ•°ç»„é•¿åº¦å›ºå®šä¸å˜ï¼Œé‚£ä¹ˆéšç€ key-value å¯¹æ•°é‡çš„å¢é•¿ï¼Œå½“ä¸€ä¸ªæ¡¶ä¸‹æŒ‚è½½çš„ key-value è¾¾åˆ°ä¸€å®šçš„é‡çº§ï¼Œæ­¤æ—¶æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¼šè¶‹äºçº¿æ€§ï¼Œæ— æ³•æ»¡è¶³è¯‰æ±‚ã€‚</p>
<p>å› æ­¤åœ¨å®ç°ä¸Šï¼Œmap æ¡¶æ•°ç»„çš„é•¿åº¦ä¼šéšç€ key-value å¯¹æ•°é‡çš„å˜åŒ–è€Œå®æ—¶è°ƒæ•´ï¼Œä»¥ä¿è¯æ¯ä¸ªæ¡¶å†…çš„ key-value å¯¹æ•°é‡å§‹ç»ˆæ§åˆ¶åœ¨å¸¸é‡çº§åˆ«ï¼Œæ»¡è¶³å„é¡¹æ“ä½œä¸º O(1) æ—¶é—´å¤æ‚åº¦çš„è¦æ±‚ã€‚</p>
<h3 id="æ‰©å®¹æœºåˆ¶æ ¸å¿ƒç‚¹">æ‰©å®¹æœºåˆ¶æ ¸å¿ƒç‚¹</h3>
<p>ï¼ˆ1ï¼‰æ‰©å®¹åˆ†ä¸ºå¢é‡æ‰©å®¹å’Œç­‰é‡æ‰©å®¹ï¼›</p>
<p>ï¼ˆ2ï¼‰å½“æ¡¶å†… key-value æ€»æ•°/æ¡¶æ•°ç»„é•¿åº¦ &gt; 6.5 æ—¶å‘ç”Ÿå¢é‡æ‰©å®¹ï¼Œæ¡¶æ•°ç»„é•¿åº¦å¢é•¿ä¸ºåŸå€¼çš„ä¸¤å€ï¼›</p>
<p>ï¼ˆ3ï¼‰å½“æ¡¶å†…æº¢å‡ºæ¡¶æ•°é‡å¤§äºç­‰äº 2^B æ—¶ï¼ˆB ä¸ºæ¡¶æ•°ç»„é•¿åº¦çš„æŒ‡æ•°ï¼ŒB æœ€å¤§å– 15ï¼‰ï¼Œå‘ç”Ÿç­‰é‡æ‰©å®¹ï¼Œæ¡¶çš„é•¿åº¦ä¿æŒä¸ºåŸå€¼ï¼›</p>
<p>ï¼ˆ4ï¼‰é‡‡ç”¨æ¸è¿›æ‰©å®¹çš„æ–¹å¼ï¼Œå½“æ¡¶è¢«å®é™…æ“ä½œåˆ°æ—¶ï¼Œç”±ä½¿ç”¨è€…è´Ÿè´£å®Œæˆæ•°æ®è¿ç§»ï¼Œé¿å…å› ä¸ºä¸€æ¬¡æ€§çš„å…¨é‡æ•°æ®è¿ç§»å¼•å‘æ€§èƒ½æŠ–åŠ¨ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126868130.png" alt="1750126868130"></p>
<h2 id="æ ¸å¿ƒæ•°æ®ç»“æ„">æ ¸å¿ƒæ•°æ®ç»“æ„</h2>
<h3 id="hmap-ç»“æ„">hmap ç»“æ„</h3>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126875064.png" alt="1750126875064"></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> &#123;</span><br><span class="line">	count      <span class="type">int</span>             <span class="comment">// map ä¸­çš„ key-value æ€»æ•°</span></span><br><span class="line">	flags      <span class="type">uint8</span>           <span class="comment">// map çŠ¶æ€æ ‡è¯†ï¼Œå¯ä»¥æ ‡è¯†å‡º map æ˜¯å¦è¢« goroutine å¹¶å‘è¯»å†™</span></span><br><span class="line">	B          <span class="type">uint8</span>           <span class="comment">// æ¡¶æ•°ç»„é•¿åº¦çš„æŒ‡æ•°ï¼Œæ¡¶æ•°ç»„é•¿åº¦ä¸º 2^B</span></span><br><span class="line">	noverflow  <span class="type">uint16</span>          <span class="comment">// map ä¸­æº¢å‡ºæ¡¶çš„æ•°é‡</span></span><br><span class="line">	hash0      <span class="type">uint32</span>          <span class="comment">// hash éšæœºå› å­ï¼Œç”Ÿæˆ key çš„ hash å€¼æ—¶ä¼šä½¿ç”¨åˆ°</span></span><br><span class="line">	buckets    unsafe.Pointer  <span class="comment">// æ¡¶æ•°ç»„</span></span><br><span class="line">	oldbuckets unsafe.Pointer  <span class="comment">// æ‰©å®¹è¿‡ç¨‹ä¸­è€çš„æ¡¶æ•°ç»„</span></span><br><span class="line">	nevacuate  <span class="type">uintptr</span>         <span class="comment">// æ‰©å®¹æ—¶çš„è¿›åº¦æ ‡è¯†ï¼Œindex å°äº nevacuate çš„æ¡¶éƒ½å·²ç»ç”±è€æ¡¶è½¬ç§»åˆ°æ–°æ¡¶ä¸­</span></span><br><span class="line">	extra      *mapextra       <span class="comment">// é¢„ç”³è¯·çš„æº¢å‡ºæ¡¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="mapextra-ç»“æ„">mapextra ç»“æ„</h3>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126881251.png" alt="1750126881251"></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> mapextra <span class="keyword">struct</span> &#123;</span><br><span class="line">	overflow     *[]*bmap  <span class="comment">// ä¾›æ¡¶æ•°ç»„ buckets ä½¿ç”¨çš„æº¢å‡ºæ¡¶</span></span><br><span class="line">	oldoverflow  *[]*bmap  <span class="comment">// æ‰©å®¹æµç¨‹ä¸­ï¼Œä¾›è€æ¡¶æ•°ç»„ oldBuckets ä½¿ç”¨çš„æº¢å‡ºæ¡¶</span></span><br><span class="line">	nextOverflow *bmap     <span class="comment">// ä¸‹ä¸€ä¸ªå¯ç”¨çš„æº¢å‡ºæ¡¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ map åˆå§‹åŒ–æ—¶ï¼Œå€˜è‹¥å®¹é‡è¿‡å¤§ï¼Œä¼šæå‰ç”³è¯·å¥½ä¸€æ‰¹æº¢å‡ºæ¡¶ï¼Œä»¥ä¾›åç»­ä½¿ç”¨ï¼Œè¿™éƒ¨åˆ†æº¢å‡ºæ¡¶å­˜æ”¾åœ¨ hmap.mapextra å½“ä¸­ã€‚</p>
<h3 id="bmap-ç»“æ„">bmap ç»“æ„</h3>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1750126889050.png" alt="1750126889050"></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> bucketCnt = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> bmap <span class="keyword">struct</span> &#123;</span><br><span class="line">	tophash [bucketCnt]<span class="type">uint8</span>  <span class="comment">// æ¯ä¸ªkeyçš„é«˜8ä½hashå€¼</span></span><br><span class="line">	<span class="comment">// keys and values are not explicitly defined here but are part of the memory layout</span></span><br><span class="line">	<span class="comment">// overflow is also part of the memory layout, typically after keys and values</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>bmap ç‰¹ç‚¹ï¼š</strong></p>
<p>ï¼ˆ1ï¼‰bmap å°±æ˜¯ map ä¸­çš„æ¡¶ï¼Œå¯ä»¥å­˜å‚¨ 8 ç»„ key-value å¯¹çš„æ•°æ®ï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªæº¢å‡ºæ¡¶çš„æŒ‡é’ˆï¼›</p>
<p>ï¼ˆ2ï¼‰æ¯ç»„ key-value å¯¹æ•°æ®åŒ…å« key é«˜ 8 ä½ hash å€¼ tophashï¼Œkey å’Œ val ä¸‰éƒ¨åˆ†ï¼›</p>
<p>ï¼ˆ3ï¼‰åœ¨ä»£ç å±‚é¢åªå±•ç¤ºäº† tophash éƒ¨åˆ†ï¼Œä½†ç”±äº tophashã€key å’Œ val çš„æ•°æ®é•¿åº¦å›ºå®šï¼Œå› æ­¤å¯ä»¥é€šè¿‡å†…å­˜åœ°å€åç§»çš„æ–¹å¼å¯»æ‰¾åˆ°åç»­çš„ key æ•°ç»„ã€val æ•°ç»„ä»¥åŠæº¢å‡ºæ¡¶æŒ‡é’ˆï¼›</p>
<p><strong>å®Œæ•´çš„ bmap æ¦‚å¿µç»“æ„ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Conceptual representation of a bmap with explicit fields</span></span><br><span class="line"><span class="keyword">type</span> bmap_conceptual <span class="keyword">struct</span> &#123;</span><br><span class="line">	tophash  [bucketCnt]<span class="type">uint8</span>    <span class="comment">// é«˜8ä½hashå€¼æ•°ç»„</span></span><br><span class="line">	keys     [bucketCnt]KeyType  <span class="comment">// keyæ•°ç»„</span></span><br><span class="line">	values   [bucketCnt]ValType  <span class="comment">// valueæ•°ç»„</span></span><br><span class="line">	overflow <span class="type">uintptr</span>             <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªæº¢å‡ºæ¡¶çš„æŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å†…å­˜å¸ƒå±€ä¼˜åŒ–">å†…å­˜å¸ƒå±€ä¼˜åŒ–</h2>
<p>Go Map çš„å†…å­˜å¸ƒå±€ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼š</p>
<ol>
<li><strong>tophash æ•°ç»„åœ¨å‰</strong>ï¼šä¾¿äºå¿«é€Ÿæ¯”è¾ƒï¼Œé¿å…è®¿é—®å®Œæ•´çš„ key</li>
<li><strong>key å’Œ value åˆ†ç¦»å­˜å‚¨</strong>ï¼šæé«˜å†…å­˜è®¿é—®æ•ˆç‡</li>
<li><strong>æº¢å‡ºæ¡¶æŒ‡é’ˆåœ¨æœ«å°¾</strong>ï¼šåªæœ‰åœ¨éœ€è¦æ—¶æ‰è®¿é—®</li>
</ol>
<p>è¿™ç§è®¾è®¡å……åˆ†è€ƒè™‘äº† CPU ç¼“å­˜å‹å¥½æ€§å’Œå†…å­˜è®¿é—®æ¨¡å¼ï¼Œæ˜¯ Go Map é«˜æ€§èƒ½çš„é‡è¦ä¿éšœã€‚</p>
<h2 id="å°ç»“">å°ç»“</h2>
<p>Go Map çš„æ ¸å¿ƒåŸç†ä½“ç°äº†ç°ä»£å“ˆå¸Œè¡¨è®¾è®¡çš„ç²¾é«“ï¼š</p>
<ol>
<li><strong>é«˜æ•ˆçš„å“ˆå¸Œç®—æ³•</strong>ï¼šä¿è¯è‰¯å¥½çš„æ•£åˆ—æ€§å’Œä½å†²çªç‡</li>
<li><strong>ä¼˜åŒ–çš„æ•°æ®ç»“æ„</strong>ï¼šhmapã€bmapã€mapextra ä¸‰çº§ç»“æ„ååŒå·¥ä½œ</li>
<li><strong>æ··åˆå†²çªè§£å†³ç­–ç•¥</strong>ï¼šç»“åˆå¼€æ”¾å¯»å€æ³•å’Œæ‹‰é“¾æ³•çš„ä¼˜åŠ¿</li>
<li><strong>åŠ¨æ€æ‰©å®¹æœºåˆ¶</strong>ï¼šä¿æŒè´Ÿè½½å› å­åœ¨åˆç†èŒƒå›´å†…</li>
<li><strong>å†…å­˜å¸ƒå±€ä¼˜åŒ–</strong>ï¼šå……åˆ†åˆ©ç”¨ CPU ç¼“å­˜æé«˜æ€§èƒ½</li>
</ol>
<p>ç†è§£è¿™äº›æ ¸å¿ƒåŸç†å¯¹äºæ·±å…¥æŒæ¡ Go Map çš„å®ç°ç»†èŠ‚å’Œæ€§èƒ½ç‰¹å¾è‡³å…³é‡è¦ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>Map</category>
      </categories>
      <tags>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: Go Map è¯»å†™åˆ é™¤æµç¨‹è¯¦è§£</title>
    <url>/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E8%AF%BB%E5%86%99%E5%88%A0%E9%99%A4%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1>Go Map è¯»å†™åˆ é™¤æµç¨‹è¯¦è§£</h1>
<h2 id="è¯»æµç¨‹è¯¦è§£">è¯»æµç¨‹è¯¦è§£</h2>
<h3 id="è¯»æµç¨‹æ¦‚è¿°">è¯»æµç¨‹æ¦‚è¿°</h3>
<p>map è¯»æµç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<p>ï¼ˆ1ï¼‰æ ¹æ® key å– hash å€¼ï¼›</p>
<p>ï¼ˆ2ï¼‰æ ¹æ® hash å€¼å¯¹æ¡¶æ•°ç»„å–æ¨¡ï¼Œç¡®å®šæ‰€åœ¨çš„æ¡¶ï¼›</p>
<p>ï¼ˆ3ï¼‰æ²¿ç€æ¡¶é“¾è¡¨ä¾æ¬¡éå†å„ä¸ªæ¡¶å†…çš„ key-value å¯¹ï¼›</p>
<p>ï¼ˆ4ï¼‰å‘½ä¸­ç›¸åŒçš„ keyï¼Œåˆ™è¿”å› valueï¼›å€˜è‹¥ key ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›é›¶å€¼ã€‚</p>
<p>map è¯»æ“ä½œæœ€ç»ˆä¼šèµ°è¿› runtime/map.go çš„ mapaccess æ–¹æ³•ä¸­ã€‚</p>
<h3 id="mapaccess-æ–¹æ³•æºç è¯¦è§£">mapaccess æ–¹æ³•æºç è¯¦è§£</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapaccess1</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span></span> unsafe.Pointer &#123;</span><br><span class="line">	<span class="keyword">if</span> h == <span class="literal">nil</span> || h.count == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="number">0</span>])</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> h.flags&amp;hashWriting != <span class="number">0</span> &#123;</span><br><span class="line">		fatal(<span class="string">&quot;concurrent map read and map write&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	hash := t.hasher(key, <span class="type">uintptr</span>(h.hash0))</span><br><span class="line">	m := bucketMask(h.B)</span><br><span class="line">	b := (*bmap)(add(h.buckets, (hash&amp;m)*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> c := h.oldbuckets; c != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> !h.sameSizeGrow() &#123;</span><br><span class="line">			m &gt;&gt;= <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">		oldb := (*bmap)(add(c, (hash&amp;m)*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">		<span class="keyword">if</span> !evacuated(oldb) &#123;</span><br><span class="line">			b = oldb</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	top := tophash(hash)</span><br><span class="line">bucketloop:</span><br><span class="line">	<span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="type">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line">			<span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line">				<span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line">					<span class="keyword">break</span> bucketloop</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			k := add(unsafe.Pointer(b), dataOffset+i*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">			<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">				k = *((*unsafe.Pointer)(k))</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> t.key.equal(key, k) &#123;</span><br><span class="line">				e := add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="type">uintptr</span>(t.keysize)+i*<span class="type">uintptr</span>(t.elemsize))</span><br><span class="line">				<span class="keyword">if</span> t.indirectelem() &#123;</span><br><span class="line">					e = *((*unsafe.Pointer)(e))</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> e</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¯»æµç¨‹è¯¦ç»†æ­¥éª¤">è¯»æµç¨‹è¯¦ç»†æ­¥éª¤</h3>
<h4 id="1-è¾¹ç•Œæ¡ä»¶æ£€æŸ¥">1. è¾¹ç•Œæ¡ä»¶æ£€æŸ¥</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h == <span class="literal">nil</span> || h.count == <span class="number">0</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€˜è‹¥ map æœªåˆå§‹åŒ–ï¼Œæˆ–æ­¤æ—¶å­˜åœ¨ key-value å¯¹æ•°é‡ä¸º 0ï¼Œç›´æ¥è¿”å›é›¶å€¼ã€‚</p>
<h4 id="2-å¹¶å‘å®‰å…¨æ£€æŸ¥">2. å¹¶å‘å®‰å…¨æ£€æŸ¥</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h.flags&amp;hashWriting != <span class="number">0</span> &#123;</span><br><span class="line">	fatal(<span class="string">&quot;concurrent map read and map write&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€˜è‹¥å‘ç°å­˜åœ¨å…¶ä»– goroutine åœ¨å†™ mapï¼Œç›´æ¥æŠ›å‡ºå¹¶å‘è¯»å†™çš„ fatal errorã€‚å…¶ä¸­ï¼Œå¹¶å‘å†™æ ‡è®°ï¼Œä½äº hmap.flags çš„ç¬¬ 3 ä¸ª bit ä½ã€‚</p>
<h4 id="3-å“ˆå¸Œè®¡ç®—ä¸æ¡¶å®šä½">3. å“ˆå¸Œè®¡ç®—ä¸æ¡¶å®šä½</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">hash := t.hasher(key, <span class="type">uintptr</span>(h.hash0))</span><br><span class="line">m := bucketMask(h.B)</span><br><span class="line">b := (*bmap)(add(h.buckets, (hash&amp;m)*<span class="type">uintptr</span>(t.bucketsize)))</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ maptype.hasher() æ–¹æ³•è®¡ç®—å¾—åˆ° key çš„ hash å€¼ï¼Œå¹¶å¯¹æ¡¶æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œå–å¾—å¯¹åº”çš„æ¡¶ã€‚</p>
<p><code>bucketMask</code> æ–¹æ³•ä¼šæ ¹æ® B æ±‚å¾—æ¡¶æ•°ç»„é•¿åº¦ - 1 çš„å€¼ï¼Œç”¨äºåç»­çš„ &amp; è¿ç®—ï¼Œå®ç°å–æ¨¡çš„æ•ˆæœï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bucketMask</span><span class="params">(b <span class="type">uint8</span>)</span></span> <span class="type">uintptr</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> bucketShift(b) - <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-æ‰©å®¹æœŸé—´çš„ç‰¹æ®Šå¤„ç†">4. æ‰©å®¹æœŸé—´çš„ç‰¹æ®Šå¤„ç†</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> c := h.oldbuckets; c != <span class="literal">nil</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> !h.sameSizeGrow() &#123;</span><br><span class="line">		m &gt;&gt;= <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">	oldb := (*bmap)(add(c, (hash&amp;m)*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">	<span class="keyword">if</span> !evacuated(oldb) &#123;</span><br><span class="line">		b = oldb</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å–æ¡¶æ—¶ï¼Œä¼šå…³æ³¨å½“å‰ map æ˜¯å¦å¤„äºæ‰©å®¹çš„æµç¨‹ï¼Œå€˜è‹¥æ˜¯çš„è¯ï¼Œéœ€è¦åœ¨è€çš„æ¡¶æ•°ç»„ oldBuckets ä¸­å–æ¡¶ï¼Œé€šè¿‡ evacuated æ–¹æ³•åˆ¤æ–­æ¡¶æ•°æ®æ˜¯å·²è¿åˆ°æ–°æ¡¶è¿˜æ˜¯ä»å­˜ç•™åœ¨è€æ¡¶ã€‚</p>
<h4 id="5-tophash-ä¼˜åŒ–">5. tophash ä¼˜åŒ–</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">top := tophash(hash)</span><br></pre></td></tr></table></figure>
<p>å– key hash å€¼çš„é«˜ 8 ä½å€¼ topã€‚å€˜è‹¥è¯¥å€¼ &lt; 5ï¼Œä¼šç´¯åŠ  5ï¼Œä»¥é¿å¼€ 0 ~ 4 çš„å–å€¼ï¼Œå› ä¸ºè¿™å‡ ä¸ªå€¼ä¼šç”¨äºæšä¸¾ï¼Œå…·æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚</p>
<h4 id="6-æ¡¶é“¾è¡¨éå†">6. æ¡¶é“¾è¡¨éå†</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">bucketloop:</span><br><span class="line"><span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="type">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line">			<span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line">				<span class="keyword">break</span> bucketloop</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// æ‰¾åˆ°åŒ¹é…çš„tophashï¼Œè¿›ä¸€æ­¥æ¯”è¾ƒå®Œæ•´key</span></span><br><span class="line">		k := add(unsafe.Pointer(b), dataOffset+i*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">		<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">			k = *((*unsafe.Pointer)(k))</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> t.key.equal(key, k) &#123;</span><br><span class="line">			e := add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="type">uintptr</span>(t.keysize)+i*<span class="type">uintptr</span>(t.elemsize))</span><br><span class="line">			<span class="keyword">if</span> t.indirectelem() &#123;</span><br><span class="line">				e = *((*unsafe.Pointer)(e))</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> e</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¼€å¯ä¸¤å±‚ for å¾ªç¯è¿›è¡Œéå†æµç¨‹ï¼š</p>
<ul>
<li>å¤–å±‚ï¼šåŸºäºæ¡¶é“¾è¡¨ï¼Œä¾æ¬¡éå†é¦–ä¸ªæ¡¶å’Œåç»­çš„æ¯ä¸ªæº¢å‡ºæ¡¶</li>
<li>å†…å±‚ï¼šä¾æ¬¡éå†ä¸€ä¸ªæ¡¶å†…çš„ key-value å¯¹</li>
</ul>
<h2 id="å†™æµç¨‹è¯¦è§£">å†™æµç¨‹è¯¦è§£</h2>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E8%AF%BB%E5%86%99%E5%88%A0%E9%99%A4%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/1750126774765.png" alt="1750126774765"></p>
<h3 id="å†™æµç¨‹æ¦‚è¿°">å†™æµç¨‹æ¦‚è¿°</h3>
<p>map å†™æµç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<p>ï¼ˆ1ï¼‰æ ¹æ® key å– hash å€¼ï¼›</p>
<p>ï¼ˆ2ï¼‰æ ¹æ® hash å€¼å¯¹æ¡¶æ•°ç»„å–æ¨¡ï¼Œç¡®å®šæ‰€åœ¨çš„æ¡¶ï¼›</p>
<p>ï¼ˆ3ï¼‰å€˜è‹¥ map å¤„äºæ‰©å®¹ï¼Œåˆ™è¿ç§»å‘½ä¸­çš„æ¡¶ï¼Œå¸®åŠ©æ¨è¿›æ¸è¿›å¼æ‰©å®¹ï¼›</p>
<p>ï¼ˆ4ï¼‰æ²¿ç€æ¡¶é“¾è¡¨ä¾æ¬¡éå†å„ä¸ªæ¡¶å†…çš„ key-value å¯¹ï¼›</p>
<p>ï¼ˆ5ï¼‰å€˜è‹¥å‘½ä¸­ç›¸åŒçš„ keyï¼Œåˆ™å¯¹ value è¿›è¡Œæ›´æ–°ï¼›</p>
<p>ï¼ˆ6ï¼‰å€˜è‹¥ key ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ key-value å¯¹ï¼›</p>
<p>ï¼ˆ7ï¼‰å€˜è‹¥å‘ç° map è¾¾æˆæ‰©å®¹æ¡ä»¶ï¼Œåˆ™ä¼šå¼€å¯æ‰©å®¹æ¨¡å¼ï¼Œå¹¶é‡æ–°è¿”å›ç¬¬ï¼ˆ2ï¼‰æ­¥ã€‚</p>
<h3 id="mapassign-æ–¹æ³•æ ¸å¿ƒå®ç°">mapassign æ–¹æ³•æ ¸å¿ƒå®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapassign</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span></span> unsafe.Pointer &#123;</span><br><span class="line">	<span class="keyword">if</span> h == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;assignment to entry in nil map&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> h.flags&amp;hashWriting != <span class="number">0</span> &#123;</span><br><span class="line">		fatal(<span class="string">&quot;concurrent map writes&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	hash := t.hasher(key, <span class="type">uintptr</span>(h.hash0))</span><br><span class="line">	h.flags ^= hashWriting</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> h.buckets == <span class="literal">nil</span> &#123;</span><br><span class="line">		h.buckets = newobject(t.bucket)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">again:</span><br><span class="line">	bucket := hash &amp; bucketMask(h.B)</span><br><span class="line">	<span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">		growWork(t, h, bucket)</span><br><span class="line">	&#125;</span><br><span class="line">	b := (*bmap)(add(h.buckets, bucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">	top := tophash(hash)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> inserti *<span class="type">uint8</span></span><br><span class="line">	<span class="keyword">var</span> insertk unsafe.Pointer</span><br><span class="line">	<span class="keyword">var</span> elem unsafe.Pointer</span><br><span class="line"></span><br><span class="line">bucketloop:</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="type">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line">			<span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line">				<span class="keyword">if</span> isEmpty(b.tophash[i]) &amp;&amp; inserti == <span class="literal">nil</span> &#123;</span><br><span class="line">					inserti = &amp;b.tophash[i]</span><br><span class="line">					insertk = add(unsafe.Pointer(b), dataOffset+i*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">					elem = add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="type">uintptr</span>(t.keysize)+i*<span class="type">uintptr</span>(t.elemsize))</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line">					<span class="keyword">break</span> bucketloop</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			k := add(unsafe.Pointer(b), dataOffset+i*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">			<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">				k = *((*unsafe.Pointer)(k))</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> !t.key.equal(key, k) &#123;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// keyå·²å­˜åœ¨ï¼Œæ›´æ–°æ“ä½œ</span></span><br><span class="line">			<span class="keyword">if</span> t.needkeyupdate() &#123;</span><br><span class="line">				typedmemmove(t.key, k, key)</span><br><span class="line">			&#125;</span><br><span class="line">			elem = add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="type">uintptr</span>(t.keysize)+i*<span class="type">uintptr</span>(t.elemsize))</span><br><span class="line">			<span class="keyword">goto</span> done</span><br><span class="line">		&#125;</span><br><span class="line">		ovf := b.overflow(t)</span><br><span class="line">		<span class="keyword">if</span> ovf == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		b = ovf</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">	<span class="keyword">if</span> !h.growing() &amp;&amp; (overLoadFactor(h.count+<span class="number">1</span>, h.B) || tooManyOverflowBuckets(h.noverflow, h.B)) &#123;</span><br><span class="line">		hashGrow(t, h)</span><br><span class="line">		<span class="keyword">goto</span> again</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ†é…æ–°çš„æ’å…¥ä½ç½®</span></span><br><span class="line">	<span class="keyword">if</span> inserti == <span class="literal">nil</span> &#123;</span><br><span class="line">		newb := h.newoverflow(t, b)</span><br><span class="line">		inserti = &amp;newb.tophash[<span class="number">0</span>]</span><br><span class="line">		insertk = add(unsafe.Pointer(newb), dataOffset)</span><br><span class="line">		elem = add(insertk, bucketCnt*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ’å…¥æ–°çš„key-valueå¯¹</span></span><br><span class="line">	<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">		kmem := newobject(t.key)</span><br><span class="line">		*(*unsafe.Pointer)(insertk) = kmem</span><br><span class="line">		insertk = kmem</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> t.indirectelem() &#123;</span><br><span class="line">		vmem := newobject(t.elem)</span><br><span class="line">		*(*unsafe.Pointer)(elem) = vmem</span><br><span class="line">	&#125;</span><br><span class="line">	typedmemmove(t.key, insertk, key)</span><br><span class="line">	*inserti = top</span><br><span class="line">	h.count++</span><br><span class="line"></span><br><span class="line">done:</span><br><span class="line">	<span class="keyword">if</span> h.flags&amp;hashWriting == <span class="number">0</span> &#123;</span><br><span class="line">		fatal(<span class="string">&quot;concurrent map writes&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	h.flags &amp;^= hashWriting</span><br><span class="line">	<span class="keyword">if</span> t.indirectelem() &#123;</span><br><span class="line">		elem = *((*unsafe.Pointer)(elem))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> elem</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å†™æµç¨‹å…³é”®æ­¥éª¤">å†™æµç¨‹å…³é”®æ­¥éª¤</h3>
<h4 id="1-å†™æ ‡è®°è®¾ç½®">1. å†™æ ‡è®°è®¾ç½®</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">h.flags ^= hashWriting</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡å¼‚æˆ–ä½è¿ç®—ï¼Œå°† map.flags çš„ç¬¬ 3 ä¸ª bit ä½ç½®ä¸º 1ï¼Œæ·»åŠ å†™æ ‡è®°ã€‚</p>
<h4 id="2-æ‰©å®¹ååŠ©">2. æ‰©å®¹ååŠ©</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">	growWork(t, h, bucket)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€˜è‹¥å‘ç°å½“å‰ map æ­£å¤„äºæ‰©å®¹è¿‡ç¨‹ï¼Œåˆ™å¸®åŠ©å…¶æ¸è¿›æ‰©å®¹ã€‚</p>
<h4 id="3-ç©ºä½è®°å½•">3. ç©ºä½è®°å½•</h4>
<p>åœ¨éå†æ¡¶çš„è¿‡ç¨‹ä¸­ï¼Œä¼šè®°å½•ç¬¬ä¸€ä¸ªå¯ç”¨çš„ç©ºä½ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> isEmpty(b.tophash[i]) &amp;&amp; inserti == <span class="literal">nil</span> &#123;</span><br><span class="line">	inserti = &amp;b.tophash[i]</span><br><span class="line">	insertk = add(unsafe.Pointer(b), dataOffset+i*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">	elem = add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="type">uintptr</span>(t.keysize)+i*<span class="type">uintptr</span>(t.elemsize))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-æ‰©å®¹æ¡ä»¶æ£€æŸ¥">4. æ‰©å®¹æ¡ä»¶æ£€æŸ¥</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> !h.growing() &amp;&amp; (overLoadFactor(h.count+<span class="number">1</span>, h.B) || tooManyOverflowBuckets(h.noverflow, h.B)) &#123;</span><br><span class="line">	hashGrow(t, h)</span><br><span class="line">	<span class="keyword">goto</span> again</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°å·²å­˜åœ¨çš„ key ä¸”éœ€è¦æ’å…¥æ–°å…ƒç´ æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚</p>
<h2 id="åˆ é™¤æµç¨‹è¯¦è§£">åˆ é™¤æµç¨‹è¯¦è§£</h2>
<h3 id="åˆ é™¤æµç¨‹æ¦‚è¿°">åˆ é™¤æµç¨‹æ¦‚è¿°</h3>
<p>map åˆ é™¤ kv å¯¹æµç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<p>ï¼ˆ1ï¼‰æ ¹æ® key å– hash å€¼ï¼›</p>
<p>ï¼ˆ2ï¼‰æ ¹æ® hash å€¼å¯¹æ¡¶æ•°ç»„å–æ¨¡ï¼Œç¡®å®šæ‰€åœ¨çš„æ¡¶ï¼›</p>
<p>ï¼ˆ3ï¼‰å€˜è‹¥ map å¤„äºæ‰©å®¹ï¼Œåˆ™è¿ç§»å‘½ä¸­çš„æ¡¶ï¼Œå¸®åŠ©æ¨è¿›æ¸è¿›å¼æ‰©å®¹ï¼›</p>
<p>ï¼ˆ4ï¼‰æ²¿ç€æ¡¶é“¾è¡¨ä¾æ¬¡éå†å„ä¸ªæ¡¶å†…çš„ key-value å¯¹ï¼›</p>
<p>ï¼ˆ5ï¼‰å€˜è‹¥å‘½ä¸­ç›¸åŒçš„ keyï¼Œåˆ é™¤å¯¹åº”çš„ key-value å¯¹ï¼›å¹¶å°†å½“å‰ä½ç½®çš„ tophash ç½®ä¸º emptyOneï¼Œè¡¨ç¤ºä¸ºç©ºï¼›</p>
<p>ï¼ˆ6ï¼‰å€˜è‹¥å½“å‰ä½ç½®ä¸ºæœ«ä½ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ªä½ç½®çš„ tophash ä¸º emptyRestï¼Œåˆ™æ²¿å½“å‰ä½ç½®å‘å‰éå†ï¼Œå°†æ¯—é‚»çš„ emptyOne ç»Ÿä¸€æ›´æ–°ä¸º emptyRestã€‚</p>
<h3 id="mapdelete-æ–¹æ³•å®ç°">mapdelete æ–¹æ³•å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapdelete</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> h == <span class="literal">nil</span> || h.count == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> h.flags&amp;hashWriting != <span class="number">0</span> &#123;</span><br><span class="line">		fatal(<span class="string">&quot;concurrent map writes&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	hash := t.hasher(key, <span class="type">uintptr</span>(h.hash0))</span><br><span class="line">	h.flags ^= hashWriting</span><br><span class="line"></span><br><span class="line">	bucket := hash &amp; bucketMask(h.B)</span><br><span class="line">	<span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">		growWork(t, h, bucket)</span><br><span class="line">	&#125;</span><br><span class="line">	b := (*bmap)(add(h.buckets, bucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">	bOrig := b</span><br><span class="line">	top := tophash(hash)</span><br><span class="line"></span><br><span class="line">search:</span><br><span class="line">	<span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="type">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line">			<span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line">				<span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line">					<span class="keyword">break</span> search</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			k := add(unsafe.Pointer(b), dataOffset+i*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">			k2 := k</span><br><span class="line">			<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">				k2 = *((*unsafe.Pointer)(k2))</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> !t.key.equal(key, k2) &#123;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æ¸…ç†key</span></span><br><span class="line">			<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">				*(*unsafe.Pointer)(k) = <span class="literal">nil</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> t.key.ptrdata != <span class="number">0</span> &#123;</span><br><span class="line">				memclrHasPointers(k, t.key.size)</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æ¸…ç†value</span></span><br><span class="line">			e := add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="type">uintptr</span>(t.keysize)+i*<span class="type">uintptr</span>(t.elemsize))</span><br><span class="line">			<span class="keyword">if</span> t.indirectelem() &#123;</span><br><span class="line">				*(*unsafe.Pointer)(e) = <span class="literal">nil</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> t.elem.ptrdata != <span class="number">0</span> &#123;</span><br><span class="line">				memclrHasPointers(e, t.elem.size)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				memclrNoHeapPointers(e, t.elem.size)</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			b.tophash[i] = emptyOne</span><br><span class="line"></span><br><span class="line">			<span class="comment">// ä¼˜åŒ–ç©ºæ§½æ ‡è®°</span></span><br><span class="line">			<span class="keyword">if</span> i == bucketCnt<span class="number">-1</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> b.overflow(t) != <span class="literal">nil</span> &amp;&amp; b.overflow(t).tophash[<span class="number">0</span>] != emptyRest &#123;</span><br><span class="line">					<span class="keyword">goto</span> notLast</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> b.tophash[i+<span class="number">1</span>] != emptyRest &#123;</span><br><span class="line">					<span class="keyword">goto</span> notLast</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// å‘å‰åˆå¹¶ç©ºæ§½</span></span><br><span class="line">			<span class="keyword">for</span> &#123;</span><br><span class="line">				b.tophash[i] = emptyRest</span><br><span class="line">				<span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> b == bOrig &#123;</span><br><span class="line">						<span class="keyword">break</span></span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">// æ‰¾åˆ°å‰ä¸€ä¸ªæ¡¶</span></span><br><span class="line">					c := b</span><br><span class="line">					<span class="keyword">for</span> b = bOrig; b.overflow(t) != c; b = b.overflow(t) &#123;</span><br><span class="line">					&#125;</span><br><span class="line">					i = bucketCnt - <span class="number">1</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					i--</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> b.tophash[i] != emptyOne &#123;</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		notLast:</span><br><span class="line">			h.count--</span><br><span class="line">			<span class="keyword">if</span> h.count == <span class="number">0</span> &#123;</span><br><span class="line">				h.hash0 = fastrand()</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span> search</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> h.flags&amp;hashWriting == <span class="number">0</span> &#123;</span><br><span class="line">		fatal(<span class="string">&quot;concurrent map writes&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	h.flags &amp;^= hashWriting</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åˆ é™¤æµç¨‹å…³é”®ç‰¹æ€§">åˆ é™¤æµç¨‹å…³é”®ç‰¹æ€§</h3>
<h4 id="1-ç©ºæ§½æ ‡è®°ä¼˜åŒ–">1. ç©ºæ§½æ ‡è®°ä¼˜åŒ–</h4>
<p>åˆ é™¤æ“ä½œä½¿ç”¨ä¸¤ç§ç©ºæ§½æ ‡è®°ï¼š</p>
<ul>
<li><code>emptyOne</code>ï¼šå•ä¸ªç©ºæ§½</li>
<li><code>emptyRest</code>ï¼šè¿ç»­ç©ºæ§½çš„ç»“æŸæ ‡è®°</li>
</ul>
<h4 id="2-å‘å‰åˆå¹¶æœºåˆ¶">2. å‘å‰åˆå¹¶æœºåˆ¶</h4>
<p>åˆ é™¤å…ƒç´ åï¼Œä¼šå‘å‰éå†ï¼Œå°†è¿ç»­çš„ <code>emptyOne</code> æ ‡è®°åˆå¹¶ä¸º <code>emptyRest</code>ï¼Œè¿™æ ·å¯ä»¥åœ¨æŸ¥æ‰¾æ—¶æå‰ç»ˆæ­¢ï¼Œæé«˜æ€§èƒ½ã€‚</p>
<h4 id="3-å†…å­˜æ¸…ç†">3. å†…å­˜æ¸…ç†</h4>
<p>æ ¹æ® key å’Œ value çš„ç±»å‹ç‰¹æ€§ï¼Œé€‰æ‹©åˆé€‚çš„å†…å­˜æ¸…ç†æ–¹å¼ï¼š</p>
<ul>
<li>æŒ‡é’ˆç±»å‹ï¼šè®¾ç½®ä¸º nil</li>
<li>åŒ…å«æŒ‡é’ˆçš„ç±»å‹ï¼šè°ƒç”¨<code>memclrHasPointers</code></li>
<li>ä¸åŒ…å«æŒ‡é’ˆçš„ç±»å‹ï¼šè°ƒç”¨<code>memclrNoHeapPointers</code></li>
</ul>
<h2 id="æ€§èƒ½ä¼˜åŒ–æŠ€å·§">æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h2>
<h3 id="tophash-å¿«é€Ÿæ¯”è¾ƒ">tophash å¿«é€Ÿæ¯”è¾ƒ</h3>
<p>ä½¿ç”¨ hash å€¼çš„é«˜ 8 ä½ä½œä¸ºå¿«é€Ÿæ¯”è¾ƒï¼Œé¿å…å®Œæ•´ key æ¯”è¾ƒï¼š</p>
<ol>
<li>é¦–å…ˆæ¯”è¾ƒ tophashï¼Œä¸åŒ¹é…ç›´æ¥è·³è¿‡</li>
<li>tophash åŒ¹é…åæ‰è¿›è¡Œå®Œæ•´ key æ¯”è¾ƒ</li>
<li>å‡å°‘äº†å¤§éƒ¨åˆ†ä¸å¿…è¦çš„ key æ¯”è¾ƒæ“ä½œ</li>
</ol>
<h3 id="å†…å­˜å¸ƒå±€ä¼˜åŒ–">å†…å­˜å¸ƒå±€ä¼˜åŒ–</h3>
<ol>
<li><strong>æ•°æ®å±€éƒ¨æ€§</strong>ï¼škey å’Œ value åˆ†åˆ«è¿ç»­å­˜å‚¨ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡</li>
<li><strong>å¯¹é½ä¼˜åŒ–</strong>ï¼šæ•°æ®ç»“æ„æŒ‰ç…§å­—é•¿å¯¹é½ï¼Œæé«˜è®¿é—®æ•ˆç‡</li>
<li><strong>é¢„å–ä¼˜åŒ–</strong>ï¼šè¿ç»­çš„å†…å­˜å¸ƒå±€æœ‰åˆ©äº CPU é¢„å–</li>
</ol>
<h3 id="æ¸è¿›å¼æ‰©å®¹">æ¸è¿›å¼æ‰©å®¹</h3>
<ol>
<li><strong>åˆ†æ‘Šå¼€é”€</strong>ï¼šå°†æ‰©å®¹å¼€é”€åˆ†æ‘Šåˆ°å¤šæ¬¡æ“ä½œä¸­</li>
<li><strong>é¿å…é˜»å¡</strong>ï¼šé¿å…å•æ¬¡æ“ä½œè€—æ—¶è¿‡é•¿</li>
<li><strong>åŒæ•°ç»„è®¾è®¡</strong>ï¼šæ–°è€æ•°ç»„å¹¶å­˜ï¼Œæ”¯æŒæ¸è¿›è¿ç§»</li>
</ol>
<h2 id="é¢è¯•é‡ç‚¹">é¢è¯•é‡ç‚¹</h2>
<h3 id="å¸¸è§é¢è¯•é¢˜">å¸¸è§é¢è¯•é¢˜</h3>
<p><strong>Q1: Go map çš„è¯»å†™åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</strong></p>
<p>A:</p>
<ul>
<li><strong>å¹³å‡æƒ…å†µ</strong>ï¼šO(1)</li>
<li><strong>æœ€åæƒ…å†µ</strong>ï¼šO(n)ï¼Œå½“æ‰€æœ‰ key éƒ½å“ˆå¸Œåˆ°åŒä¸€ä¸ªæ¡¶æ—¶</li>
<li><strong>å®é™…è¡¨ç°</strong>ï¼šç”±äºè´Ÿè½½å› å­æ§åˆ¶å’Œæ‰©å®¹æœºåˆ¶ï¼Œå®é™…æ€§èƒ½æ¥è¿‘ O(1)</li>
</ul>
<p><strong>Q2: Go map åœ¨æ‰©å®¹è¿‡ç¨‹ä¸­å¦‚ä½•å¤„ç†è¯»å†™æ“ä½œï¼Ÿ</strong></p>
<p>A:</p>
<ul>
<li><strong>æ¸è¿›å¼æ‰©å®¹</strong>ï¼šä¸ä¼šä¸€æ¬¡æ€§è¿ç§»æ‰€æœ‰æ•°æ®</li>
<li><strong>åŒæ•°ç»„æŸ¥æ‰¾</strong>ï¼šè¯»æ“ä½œä¼šåŒæ—¶æ£€æŸ¥æ–°è€æ•°ç»„</li>
<li><strong>ååŠ©è¿ç§»</strong>ï¼šå†™æ“ä½œä¼šååŠ©è¿ç§»å¯¹åº”çš„æ¡¶</li>
<li><strong>æ— é˜»å¡</strong>ï¼šæ“ä½œä¸ä¼šè¢«æ‰©å®¹é˜»å¡</li>
</ul>
<p><strong>Q3: tophash çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>A:</p>
<ul>
<li><strong>å¿«é€Ÿè¿‡æ»¤</strong>ï¼šé¿å…ä¸å¿…è¦çš„å®Œæ•´ key æ¯”è¾ƒ</li>
<li><strong>çŠ¶æ€æ ‡è®°</strong>ï¼šæ ‡è®°ç©ºæ§½ã€è¿ç§»çŠ¶æ€ç­‰ä¿¡æ¯</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå‡å°‘å†…å­˜è®¿é—®å’Œæ¯”è¾ƒæ“ä½œ</li>
</ul>
<p>ç†è§£è¿™äº›è¯»å†™åˆ é™¤æµç¨‹çš„ç»†èŠ‚ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°ä½¿ç”¨å’Œä¼˜åŒ– Go è¯­è¨€ä¸­çš„ map æ“ä½œã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>Map</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
        <tag>ç®—æ³•å®ç°</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: Go Map é¢è¯•é¢˜è§£æ</title>
    <url>/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E9%9D%A2%E8%AF%95%E9%A2%98%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1>Go Map é¢è¯•é¢˜è§£æ</h1>
<h2 id="åŸºç¡€æ¦‚å¿µç±»é¢è¯•é¢˜">åŸºç¡€æ¦‚å¿µç±»é¢è¯•é¢˜</h2>
<h3 id="Q1-Go-è¯­è¨€ä¸­-map-çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ">Q1: Go è¯­è¨€ä¸­ map çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>A:</strong> Go è¯­è¨€ä¸­ map çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯<strong>å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰</strong>ï¼Œå…·ä½“å®ç°åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>hmap ç»“æ„ä½“</strong>ï¼šå­˜å‚¨ map çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬æ¡¶æ•°ç»„æŒ‡é’ˆã€å…ƒç´ æ•°é‡ã€å“ˆå¸Œç§å­ç­‰</li>
<li><strong>æ¡¶æ•°ç»„ï¼ˆbucketsï¼‰</strong>ï¼šé•¿åº¦ä¸º 2 çš„æ•´æ•°æ¬¡å¹‚çš„æ•°ç»„ï¼Œæ¯ä¸ªæ¡¶å¯å­˜å‚¨ 8 ä¸ª key-value å¯¹</li>
<li><strong>æº¢å‡ºæ¡¶é“¾è¡¨</strong>ï¼šå½“æ¡¶æ»¡æ—¶ï¼Œé€šè¿‡é“¾è¡¨è¿æ¥æº¢å‡ºæ¡¶è§£å†³å“ˆå¸Œå†²çª</li>
<li><strong>æ¸è¿›å¼æ‰©å®¹æœºåˆ¶</strong>ï¼šæ”¯æŒå¢é‡æ‰©å®¹å’Œç­‰é‡æ‰©å®¹</li>
</ol>
<p><strong>æ ¸å¿ƒç»“æ„ä½“ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> &#123;</span><br><span class="line">	count      <span class="type">int</span>             <span class="comment">// å…ƒç´ æ€»æ•°</span></span><br><span class="line">	flags      <span class="type">uint8</span>           <span class="comment">// çŠ¶æ€æ ‡å¿—</span></span><br><span class="line">	B          <span class="type">uint8</span>           <span class="comment">// æ¡¶æ•°ç»„é•¿åº¦æŒ‡æ•°ï¼ˆé•¿åº¦ä¸º2^Bï¼‰</span></span><br><span class="line">	noverflow  <span class="type">uint16</span>          <span class="comment">// æº¢å‡ºæ¡¶æ•°é‡</span></span><br><span class="line">	hash0      <span class="type">uint32</span>          <span class="comment">// å“ˆå¸Œç§å­</span></span><br><span class="line">	buckets    unsafe.Pointer  <span class="comment">// æ¡¶æ•°ç»„æŒ‡é’ˆ</span></span><br><span class="line">	oldbuckets unsafe.Pointer  <span class="comment">// æ‰©å®¹æ—¶çš„è€æ¡¶æ•°ç»„</span></span><br><span class="line">	nevacuate  <span class="type">uintptr</span>         <span class="comment">// æ‰©å®¹è¿ç§»è¿›åº¦</span></span><br><span class="line">	extra      *mapextra       <span class="comment">// æº¢å‡ºæ¡¶ç®¡ç†</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> bmap <span class="keyword">struct</span> &#123;</span><br><span class="line">	tophash [<span class="number">8</span>]<span class="type">uint8</span>  <span class="comment">// å­˜å‚¨8ä¸ªkeyçš„é«˜8ä½hashå€¼</span></span><br><span class="line">	<span class="comment">// åç»­æ˜¯8ä¸ªkeyã€8ä¸ªvalueã€1ä¸ªoverflowæŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Q2-Go-map-å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªï¼Ÿ">Q2: Go map å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªï¼Ÿ</h3>
<p><strong>A:</strong> Go map é‡‡ç”¨<strong>æ‹‰é“¾æ³• + å¼€æ”¾å¯»å€æ³•</strong>çš„æ··åˆæ–¹å¼è§£å†³å“ˆå¸Œå†²çªï¼š</p>
<ol>
<li><strong>æ¡¶å†…å¼€æ”¾å¯»å€</strong>ï¼šæ¯ä¸ªæ¡¶å›ºå®šå­˜å‚¨ 8 ä¸ª key-value å¯¹ï¼Œå‘ç”Ÿå†²çªæ—¶åœ¨æ¡¶å†…å¯»æ‰¾ç©ºä½</li>
<li><strong>æ¡¶é—´æ‹‰é“¾æ³•</strong>ï¼šå½“æ¡¶æ»¡æ—¶ï¼Œé€šè¿‡æº¢å‡ºæ¡¶æŒ‡é’ˆå½¢æˆé“¾è¡¨ç»“æ„</li>
<li><strong>æ¸è¿›å¼æ‰©å®¹</strong>ï¼šå½“è´Ÿè½½å› å­è¶…è¿‡ 6.5 æ—¶è§¦å‘æ‰©å®¹ï¼Œé‡æ–°åˆ†å¸ƒæ•°æ®</li>
</ol>
<p><strong>è§£å†³å†²çªçš„æ­¥éª¤ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. è®¡ç®—hashå€¼</span></span><br><span class="line">hash := hasher(key, seed)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ç¡®å®šæ¡¶ä½ç½®</span></span><br><span class="line">bucket := hash &amp; (bucketCount - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. åœ¨æ¡¶å†…æŸ¥æ‰¾ç©ºä½ï¼ˆå¼€æ”¾å¯»å€ï¼‰</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">8</span>; i++ &#123;</span><br><span class="line">	<span class="keyword">if</span> bucket[i] == empty &#123;</span><br><span class="line">		bucket[i] = key_value</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. æ¡¶æ»¡æ—¶åˆ›å»ºæº¢å‡ºæ¡¶ï¼ˆæ‹‰é“¾æ³•ï¼‰</span></span><br><span class="line">overflowBucket := newOverflowBucket()</span><br><span class="line">linkToOverflow(bucket, overflowBucket)</span><br></pre></td></tr></table></figure>
<h3 id="Q3-Go-map-çš„-key-æœ‰ä»€ä¹ˆé™åˆ¶ï¼Ÿ">Q3: Go map çš„ key æœ‰ä»€ä¹ˆé™åˆ¶ï¼Ÿ</h3>
<p><strong>A:</strong> Go map çš„ key å¿…é¡»æ˜¯<strong>å¯æ¯”è¾ƒç±»å‹</strong>ï¼š</p>
<p><strong>å¯ä½œä¸º key çš„ç±»å‹ï¼š</strong></p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼šbool, æ•°å€¼ç±»å‹, string</li>
<li>æŒ‡é’ˆç±»å‹</li>
<li>æ•°ç»„ç±»å‹ï¼ˆå…ƒç´ å¯æ¯”è¾ƒï¼‰</li>
<li>ç»“æ„ä½“ç±»å‹ï¼ˆæ‰€æœ‰å­—æ®µå¯æ¯”è¾ƒï¼‰</li>
</ul>
<p><strong>ä¸å¯ä½œä¸º key çš„ç±»å‹ï¼š</strong></p>
<ul>
<li>sliceï¼ˆåˆ‡ç‰‡ï¼‰</li>
<li>mapï¼ˆæ˜ å°„ï¼‰</li>
<li>functionï¼ˆå‡½æ•°ï¼‰</li>
</ul>
<p><strong>åŸå› ï¼š</strong> è¿™äº›ç±»å‹æ— æ³•ç”¨ <code>==</code> æ“ä½œç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œæ— æ³•è®¡ç®—ç¨³å®šçš„å“ˆå¸Œå€¼ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®çš„keyç±»å‹</span></span><br><span class="line">m1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>)</span><br><span class="line">m3 := <span class="built_in">make</span>(<span class="keyword">map</span>[[<span class="number">3</span>]<span class="type">int</span>]<span class="type">string</span>) <span class="comment">// æ•°ç»„å¯ä»¥ä½œä¸ºkey</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é”™è¯¯çš„keyç±»å‹</span></span><br><span class="line"><span class="comment">// m4 := make(map[[]int]string)     // sliceä¸èƒ½ä½œä¸ºkey</span></span><br><span class="line"><span class="comment">// m5 := make(map[map[int]int]string) // mapä¸èƒ½ä½œä¸ºkey</span></span><br><span class="line"><span class="comment">// m6 := make(map[func()]string)    // functionä¸èƒ½ä½œä¸ºkey</span></span><br></pre></td></tr></table></figure>
<h2 id="æ‰©å®¹æœºåˆ¶ç±»é¢è¯•é¢˜">æ‰©å®¹æœºåˆ¶ç±»é¢è¯•é¢˜</h2>
<h3 id="Q4-Go-map-ä»€ä¹ˆæ—¶å€™ä¼šæ‰©å®¹ï¼Ÿæ‰©å®¹è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ">Q4: Go map ä»€ä¹ˆæ—¶å€™ä¼šæ‰©å®¹ï¼Ÿæ‰©å®¹è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>A:</strong> Go map æœ‰ä¸¤ç§æ‰©å®¹è§¦å‘æ¡ä»¶ï¼š</p>
<p><strong>å¢é‡æ‰©å®¹ï¼ˆå®¹é‡ç¿»å€ï¼‰ï¼š</strong></p>
<ul>
<li>è§¦å‘æ¡ä»¶ï¼šè´Ÿè½½å› å­ &gt; 6.5ï¼ˆå³ count/2^B &gt; 6.5ï¼‰</li>
<li>æ‰©å®¹åï¼šæ¡¶æ•°ç»„é•¿åº¦å˜ä¸ºåŸæ¥çš„ 2 å€</li>
<li>ç›®çš„ï¼šé™ä½æ¡¶å†…å…ƒç´ å¯†åº¦ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡</li>
</ul>
<p><strong>ç­‰é‡æ‰©å®¹ï¼ˆå®¹é‡ä¸å˜ï¼‰ï¼š</strong></p>
<ul>
<li>è§¦å‘æ¡ä»¶ï¼šæº¢å‡ºæ¡¶æ•°é‡ &gt;= 2^Bï¼ˆB æœ€å¤§ä¸º 15ï¼‰</li>
<li>æ‰©å®¹åï¼šæ¡¶æ•°ç»„é•¿åº¦ä¸å˜ï¼Œä½†é‡æ–°æ•´ç†æ•°æ®</li>
<li>ç›®çš„ï¼šå‡å°‘æº¢å‡ºæ¡¶æ•°é‡ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
</ul>
<p><strong>æ‰©å®¹ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>é‡‡ç”¨æ¸è¿›å¼æ‰©å®¹ï¼Œé¿å…æ€§èƒ½æŠ–åŠ¨</li>
<li>æ¯æ¬¡å†™æ“ä½œæ—¶è¿ç§» 2 ä¸ªæ¡¶çš„æ•°æ®</li>
<li>é€šè¿‡ oldbuckets å’Œ buckets åŒæ•°ç»„å®ç°</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰©å®¹è§¦å‘æ¡ä»¶æ£€æŸ¥</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">needGrow</span><span class="params">(h *hmap)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="comment">// å¢é‡æ‰©å®¹æ¡ä»¶</span></span><br><span class="line">	<span class="keyword">if</span> overLoadFactor(h.count+<span class="number">1</span>, h.B) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ç­‰é‡æ‰©å®¹æ¡ä»¶</span></span><br><span class="line">	<span class="keyword">if</span> tooManyOverflowBuckets(h.noverflow, h.B) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Q5-Go-map-æ‰©å®¹ä¸ºä»€ä¹ˆæ˜¯æ¸è¿›å¼çš„ï¼Ÿ">Q5: Go map æ‰©å®¹ä¸ºä»€ä¹ˆæ˜¯æ¸è¿›å¼çš„ï¼Ÿ</h3>
<p><strong>A:</strong> æ¸è¿›å¼æ‰©å®¹çš„ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>é¿å…é˜»å¡</strong>ï¼šä¸€æ¬¡æ€§è¿ç§»æ‰€æœ‰æ•°æ®ä¼šå¯¼è‡´é•¿æ—¶é—´é˜»å¡ï¼Œå½±å“ç¨‹åºå“åº”æ€§</li>
<li><strong>åˆ†æ‘Šå¼€é”€</strong>ï¼šå°†è¿ç§»å¼€é”€åˆ†æ‘Šåˆ°å¤šæ¬¡æ“ä½œä¸­ï¼Œå•æ¬¡æ“ä½œå»¶è¿Ÿå¯æ§</li>
<li><strong>å†…å­˜å‹å¥½</strong>ï¼šé¿å…åŒæ—¶å­˜åœ¨ä¸¤ä»½å®Œæ•´æ•°æ®ï¼Œå‡å°‘å†…å­˜å³°å€¼ä½¿ç”¨</li>
<li><strong>ç”¨æˆ·æ— æ„ŸçŸ¥</strong>ï¼šå¯¹ç”¨æˆ·æ¥è¯´æ‰©å®¹è¿‡ç¨‹é€æ˜</li>
</ol>
<p><strong>å®ç°æœºåˆ¶ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¯æ¬¡å†™æ“ä½œååŠ©è¿ç§»</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">growWork</span><span class="params">(t *maptype, h *hmap, bucket <span class="type">uintptr</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// è¿ç§»å½“å‰æ“ä½œå‘½ä¸­çš„æ¡¶</span></span><br><span class="line">	evacuate(t, h, bucket&amp;h.oldbucketmask())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿ç§»ä¸€ä¸ªé¢å¤–çš„æ¡¶æ¨è¿›æ‰©å®¹è¿›åº¦</span></span><br><span class="line">	<span class="keyword">if</span> h.growing() &#123;</span><br><span class="line">		evacuate(t, h, h.nevacuate)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¹¶å‘å®‰å…¨ç±»é¢è¯•é¢˜">å¹¶å‘å®‰å…¨ç±»é¢è¯•é¢˜</h2>
<h3 id="Q6-Go-map-ä¸ºä»€ä¹ˆä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ">Q6: Go map ä¸ºä»€ä¹ˆä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h3>
<p><strong>A:</strong> Go map ä¸æ˜¯å¹¶å‘å®‰å…¨çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</p>
<p><strong>ä¸å®‰å…¨çš„åŸå› ï¼š</strong></p>
<ol>
<li><strong>è®¾è®¡ç†å¿µ</strong>ï¼šä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒGo map æ²¡æœ‰å†…ç½®é”æœºåˆ¶</li>
<li><strong>æ£€æµ‹æœºåˆ¶</strong>ï¼šè¿è¡Œæ—¶ä¼šæ£€æµ‹å¹¶å‘è¯»å†™ï¼Œå‘ç°æ—¶æŠ›å‡º fatal error</li>
<li><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼šé¿å…ä¸ºä¸éœ€è¦å¹¶å‘çš„åœºæ™¯å¢åŠ é”å¼€é”€</li>
</ol>
<p><strong>å¹¶å‘æ£€æµ‹è§„åˆ™ï¼š</strong></p>
<ul>
<li>å¹¶å‘è¯»æ˜¯å®‰å…¨çš„</li>
<li>è¯»å†™å¹¶å‘ä¼š panicï¼š<code>concurrent map read and map write</code></li>
<li>å†™å†™å¹¶å‘ä¼š panicï¼š<code>concurrent map writes</code></li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p><strong>æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ sync.RWMutex æ‰‹åŠ¨åŠ é”</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> SafeMap <span class="keyword">struct</span> &#123;</span><br><span class="line">	mu sync.RWMutex</span><br><span class="line">	m  <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sm *SafeMap)</span></span> Set(key <span class="type">string</span>, value <span class="type">int</span>) &#123;</span><br><span class="line">	sm.mu.Lock()</span><br><span class="line">	<span class="keyword">defer</span> sm.mu.Unlock()</span><br><span class="line">	sm.m[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sm *SafeMap)</span></span> Get(key <span class="type">string</span>) (<span class="type">int</span>, <span class="type">bool</span>) &#123;</span><br><span class="line">	sm.mu.RLock()</span><br><span class="line">	<span class="keyword">defer</span> sm.mu.RUnlock()</span><br><span class="line">	v, ok := sm.m[key]</span><br><span class="line">	<span class="keyword">return</span> v, ok</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ sync.Map</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> m sync.Map</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜å‚¨</span></span><br><span class="line">m.Store(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–</span></span><br><span class="line">value, ok := m.Load(<span class="string">&quot;key&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤</span></span><br><span class="line">m.Delete(<span class="string">&quot;key&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†</span></span><br><span class="line">m.Range(<span class="function"><span class="keyword">func</span><span class="params">(key, value <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	fmt.Println(key, value)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ channel è¿›è¡Œä¸²è¡ŒåŒ–è®¿é—®</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> MapService <span class="keyword">struct</span> &#123;</span><br><span class="line">	m    <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line">	ch   <span class="keyword">chan</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMapService</span><span class="params">()</span></span> *MapService &#123;</span><br><span class="line">	ms := &amp;MapService&#123;</span><br><span class="line">		m:  <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>),</span><br><span class="line">		ch: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>),</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">go</span> ms.run()</span><br><span class="line">	<span class="keyword">return</span> ms</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *MapService)</span></span> run() &#123;</span><br><span class="line">	<span class="keyword">for</span> f := <span class="keyword">range</span> ms.ch &#123;</span><br><span class="line">		f()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *MapService)</span></span> Set(key <span class="type">string</span>, value <span class="type">int</span>) &#123;</span><br><span class="line">	done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">	ms.ch &lt;- <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		ms.m[key] = value</span><br><span class="line">		<span class="built_in">close</span>(done)</span><br><span class="line">	&#125;</span><br><span class="line">	&lt;-done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€§èƒ½ä¼˜åŒ–ç±»é¢è¯•é¢˜">æ€§èƒ½ä¼˜åŒ–ç±»é¢è¯•é¢˜</h2>
<h3 id="Q7-Go-map-éå†ä¸ºä»€ä¹ˆæ˜¯æ— åºçš„ï¼Ÿå¦‚ä½•å®ç°æœ‰åºéå†ï¼Ÿ">Q7: Go map éå†ä¸ºä»€ä¹ˆæ˜¯æ— åºçš„ï¼Ÿå¦‚ä½•å®ç°æœ‰åºéå†ï¼Ÿ</h3>
<p><strong>A:</strong> Go map éå†æ— åºçš„åŸå› ï¼š</p>
<ol>
<li><strong>å“ˆå¸Œè¡¨ç‰¹æ€§</strong>ï¼šæ•°æ®å­˜å‚¨ä½ç½®ç”±å“ˆå¸Œå€¼å†³å®šï¼Œä¸ä¿è¯é¡ºåº</li>
<li><strong>æ•…æ„éšæœºåŒ–</strong>ï¼šGo 1.0 åæ•…æ„å¼•å…¥éšæœºåŒ–ï¼Œé˜²æ­¢ç¨‹åºä¾èµ–éå†é¡ºåº</li>
<li><strong>æ‰©å®¹å½±å“</strong>ï¼šæ‰©å®¹è¿‡ç¨‹ä¸­æ•°æ®é‡æ–°åˆ†å¸ƒï¼Œè¿›ä¸€æ­¥æ‰“ä¹±é¡ºåº</li>
</ol>
<p><strong>éšæœºåŒ–å®ç°ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éå†åˆå§‹åŒ–æ—¶çš„éšæœºåŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapiterinit</span><span class="params">(t *maptype, h *hmap, it *hiter)</span></span> &#123;</span><br><span class="line">	r := <span class="type">uintptr</span>(fastrand())</span><br><span class="line">	it.startBucket = r &amp; bucketMask(h.B)           <span class="comment">// éšæœºèµ·å§‹æ¡¶</span></span><br><span class="line">	it.offset = <span class="type">uint8</span>(r &gt;&gt; h.B &amp; (bucketCnt - <span class="number">1</span>))  <span class="comment">// æ¡¶å†…éšæœºåç§»</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å®ç°æœ‰åºéå†ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•1ï¼šæ”¶é›†keyåæ’åº</span></span><br><span class="line">keys := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(m))</span><br><span class="line"><span class="keyword">for</span> k := <span class="keyword">range</span> m &#123;</span><br><span class="line">	keys = <span class="built_in">append</span>(keys, k)</span><br><span class="line">&#125;</span><br><span class="line">sort.Strings(keys)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, k := <span class="keyword">range</span> keys &#123;</span><br><span class="line">	fmt.Println(k, m[k])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•2ï¼šä½¿ç”¨æœ‰åºæ•°æ®ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> OrderedMap <span class="keyword">struct</span> &#123;</span><br><span class="line">	keys []<span class="type">string</span></span><br><span class="line">	m    <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(om *OrderedMap)</span></span> Set(key <span class="type">string</span>, value <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> _, exists := om.m[key]; !exists &#123;</span><br><span class="line">		om.keys = <span class="built_in">append</span>(om.keys, key)</span><br><span class="line">	&#125;</span><br><span class="line">	om.m[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(om *OrderedMap)</span></span> Range(fn <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">string</span>, <span class="type">int</span>)</span></span>) &#123;</span><br><span class="line">	<span class="keyword">for</span> _, key := <span class="keyword">range</span> om.keys &#123;</span><br><span class="line">		fn(key, om.m[key])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Q8-å¦‚ä½•ä¼˜åŒ–-map-çš„æ€§èƒ½ï¼Ÿ">Q8: å¦‚ä½•ä¼˜åŒ– map çš„æ€§èƒ½ï¼Ÿ</h3>
<p><strong>A:</strong> map æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š</p>
<p><strong>1. é¢„åˆ†é…å®¹é‡</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é¢‘ç¹æ‰©å®¹</span></span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">	m[fmt.Sprintf(<span class="string">&quot;key%d&quot;</span>, i)] = i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… é¢„åˆ†é…å®¹é‡</span></span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>, <span class="number">10000</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">	m[fmt.Sprintf(<span class="string">&quot;key%d&quot;</span>, i)] = i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2. é€‰æ‹©åˆé€‚çš„ key ç±»å‹</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ æ€§èƒ½è¾ƒå·®çš„keyç±»å‹</span></span><br><span class="line">m1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)        <span class="comment">// å­—ç¬¦ä¸²æ¯”è¾ƒå¼€é”€å¤§</span></span><br><span class="line">m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]<span class="type">int</span>)   <span class="comment">// æ¥å£ç±»å‹éœ€è¦ç±»å‹æ–­è¨€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… é«˜æ•ˆçš„keyç±»å‹</span></span><br><span class="line">m3 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>)          <span class="comment">// æ•´æ•°æ¯”è¾ƒæœ€å¿«</span></span><br><span class="line">m4 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">uint64</span>]<span class="type">int</span>)       <span class="comment">// å›ºå®šé•¿åº¦ç±»å‹æ•ˆç‡é«˜</span></span><br></pre></td></tr></table></figure>
<p><strong>3. é¿å…é¢‘ç¹çš„åˆ é™¤æ“ä½œ</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é¢‘ç¹åˆ é™¤å¯¼è‡´ç¢ç‰‡åŒ–</span></span><br><span class="line"><span class="keyword">for</span> key := <span class="keyword">range</span> m &#123;</span><br><span class="line">	<span class="keyword">if</span> shouldDelete(key) &#123;</span><br><span class="line">		<span class="built_in">delete</span>(m, key)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ‰¹é‡é‡å»º</span></span><br><span class="line">newM := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>, <span class="built_in">len</span>(m))</span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> m &#123;</span><br><span class="line">	<span class="keyword">if</span> !shouldDelete(key) &#123;</span><br><span class="line">		newM[key] = value</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">m = newM</span><br></pre></td></tr></table></figure>
<p><strong>4. ä½¿ç”¨ä¸“é—¨çš„æ•°æ®ç»“æ„</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹äºç‰¹å®šåœºæ™¯ä½¿ç”¨ä¸“é—¨ä¼˜åŒ–çš„æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="comment">// å¦‚ï¼šsync.Map ç”¨äºè¯»å¤šå†™å°‘çš„å¹¶å‘åœºæ™¯</span></span><br><span class="line"><span class="comment">// å¦‚ï¼šç¬¬ä¸‰æ–¹çš„æœ‰åºmapåº“</span></span><br></pre></td></tr></table></figure>
<h2 id="å†…å­˜ç®¡ç†ç±»é¢è¯•é¢˜">å†…å­˜ç®¡ç†ç±»é¢è¯•é¢˜</h2>
<h3 id="Q9-Go-map-çš„é›¶å€¼æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å—ï¼Ÿ">Q9: Go map çš„é›¶å€¼æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å—ï¼Ÿ</h3>
<p><strong>A:</strong></p>
<ul>
<li><strong>é›¶å€¼</strong>ï¼šGo map çš„é›¶å€¼æ˜¯ <code>nil</code></li>
<li><strong>è¯»æ“ä½œ</strong>ï¼šå¯ä»¥ä» nil map è¯»å–ï¼Œè¿”å›é›¶å€¼å’Œ false</li>
<li><strong>å†™æ“ä½œ</strong>ï¼šä¸èƒ½å‘ nil map å†™å…¥ï¼Œä¼š panicï¼š<code>assignment to entry in nil map</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line">fmt.Println(m == <span class="literal">nil</span>)        <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å¯ä»¥è¯»å–</span></span><br><span class="line">v, ok := m[<span class="string">&quot;key&quot;</span>]           <span class="comment">// v=0, ok=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ ä¸èƒ½å†™å…¥</span></span><br><span class="line"><span class="comment">// m[&quot;key&quot;] = 1             // panic: assignment to entry in nil map</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®åˆå§‹åŒ–</span></span><br><span class="line">m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">m[<span class="string">&quot;key&quot;</span>] = <span class="number">1</span>               <span class="comment">// æ­£å¸¸å·¥ä½œ</span></span><br></pre></td></tr></table></figure>
<p><strong>æ­£ç¡®åˆå§‹åŒ–æ–¹å¼ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼1ï¼šä½¿ç”¨make</span></span><br><span class="line">m1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šå­—é¢é‡åˆå§‹åŒ–</span></span><br><span class="line">m2 := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>&#123;<span class="string">&quot;key&quot;</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼3ï¼šæŒ‡å®šå®¹é‡</span></span><br><span class="line">m3 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Q10-å¦‚ä½•åˆ¤æ–­-map-ä¸­æŸä¸ª-key-æ˜¯å¦å­˜åœ¨ï¼Ÿ">Q10: å¦‚ä½•åˆ¤æ–­ map ä¸­æŸä¸ª key æ˜¯å¦å­˜åœ¨ï¼Ÿ</h3>
<p><strong>A:</strong> ä½¿ç”¨åŒè¿”å›å€¼è¯­æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">value, ok := m[key]</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line">	<span class="comment">// keyå­˜åœ¨ï¼Œvalueæ˜¯å¯¹åº”çš„å€¼</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;keyå­˜åœ¨ï¼Œå€¼ä¸º:&quot;</span>, value)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="comment">// keyä¸å­˜åœ¨ï¼Œvalueæ˜¯é›¶å€¼</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;keyä¸å­˜åœ¨&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€åŒ–å†™æ³•</span></span><br><span class="line"><span class="keyword">if</span> value, ok := m[key]; ok &#123;</span><br><span class="line">	<span class="comment">// keyå­˜åœ¨çš„å¤„ç†é€»è¾‘</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;æ‰¾åˆ°å€¼:&quot;</span>, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»…æ£€æŸ¥å­˜åœ¨æ€§</span></span><br><span class="line"><span class="keyword">if</span> _, ok := m[key]; ok &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;keyå­˜åœ¨&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šä»…é€šè¿‡å€¼åˆ¤æ–­å­˜åœ¨æ€§</span></span><br><span class="line"><span class="keyword">if</span> m[key] != <span class="number">0</span> &#123;  <span class="comment">// é”™è¯¯ï¼å€¼å¯èƒ½æœ¬èº«å°±æ˜¯0</span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨okæ ‡å¿—</span></span><br><span class="line"><span class="keyword">if</span> _, ok := m[key]; ok &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é«˜çº§åº”ç”¨ç±»é¢è¯•é¢˜">é«˜çº§åº”ç”¨ç±»é¢è¯•é¢˜</h2>
<h3 id="Q11-éå†è¿‡ç¨‹ä¸­ä¿®æ”¹-map-ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ">Q11: éå†è¿‡ç¨‹ä¸­ä¿®æ”¹ map ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3>
<p><strong>A:</strong> éå†è¿‡ç¨‹ä¸­ä¿®æ”¹ map çš„å½±å“ï¼š</p>
<ol>
<li><strong>å†™æ“ä½œå†²çª</strong>ï¼šä¼šè§¦å‘ <code>fatal(&quot;concurrent map iteration and map write&quot;)</code></li>
<li><strong>è¯»æ“ä½œå®‰å…¨</strong>ï¼šåŒæ—¶å¤šä¸ªéå†æ˜¯å®‰å…¨çš„</li>
<li><strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šå³ä½¿ä¸å´©æºƒï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šéå†æ—¶ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">	<span class="keyword">if</span> shouldDelete(v) &#123;</span><br><span class="line">		<span class="built_in">delete</span>(m, k)  <span class="comment">// ä¼španic</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> shouldUpdate(v) &#123;</span><br><span class="line">		m[k] = newValue  <span class="comment">// ä¼španic</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šå…ˆæ”¶é›†åå¤„ç†</span></span><br><span class="line">toDelete := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>)</span><br><span class="line">toUpdate := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">	<span class="keyword">if</span> shouldDelete(v) &#123;</span><br><span class="line">		toDelete = <span class="built_in">append</span>(toDelete, k)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> shouldUpdate(v) &#123;</span><br><span class="line">		toUpdate[k] = newValue</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¹é‡å¤„ç†</span></span><br><span class="line"><span class="keyword">for</span> _, k := <span class="keyword">range</span> toDelete &#123;</span><br><span class="line">	<span class="built_in">delete</span>(m, k)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> toUpdate &#123;</span><br><span class="line">	m[k] = v</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Q12-Go-map-çš„å†…å­˜æ³„æ¼é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Ÿ">Q12: Go map çš„å†…å­˜æ³„æ¼é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Ÿ</h3>
<p><strong>A:</strong> Go map å¯èƒ½çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼š</p>
<p><strong>é—®é¢˜ 1ï¼šåˆ é™¤å…ƒç´ åå†…å­˜ä¸é‡Šæ”¾</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ï¼šé¢‘ç¹åˆ é™¤åï¼Œæ¡¶æ•°ç»„ä¸ä¼šç¼©å°</span></span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">byte</span>, <span class="number">1000000</span>)</span><br><span class="line"><span class="comment">// æ·»åŠ å¤§é‡æ•°æ®</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">	m[fmt.Sprintf(<span class="string">&quot;key%d&quot;</span>, i)] = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å¤§éƒ¨åˆ†æ•°æ®</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">999000</span>; i++ &#123;</span><br><span class="line">	<span class="built_in">delete</span>(m, fmt.Sprintf(<span class="string">&quot;key%d&quot;</span>, i))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ­¤æ—¶mapä»å ç”¨å¤§é‡å†…å­˜</span></span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ¡ˆ1ï¼šé‡å»ºmap</span></span><br><span class="line">oldM := m</span><br><span class="line">m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">byte</span>, <span class="built_in">len</span>(oldM))</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> oldM &#123;</span><br><span class="line">	m[k] = v</span><br><span class="line">&#125;</span><br><span class="line">oldM = <span class="literal">nil</span>  <span class="comment">// å¸®åŠ©GC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ¡ˆ2ï¼šå®šæœŸé‡å»º</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(m) &lt; <span class="built_in">cap</span>(m)/<span class="number">4</span> &#123;  <span class="comment">// ä¼ªä»£ç ï¼Œå®é™…æ— æ³•è·å–cap</span></span><br><span class="line">	<span class="comment">// é‡å»ºmap</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é—®é¢˜ 2ï¼švalue å«æœ‰æŒ‡é’ˆæ—¶çš„å†…å­˜æ³„æ¼</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">	data []<span class="type">byte</span></span><br><span class="line">	next *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]*Node)</span><br><span class="line"><span class="comment">// åˆ é™¤æ—¶å¦‚æœä¸å¤„ç†æŒ‡é’ˆé“¾ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼</span></span><br><span class="line"><span class="built_in">delete</span>(m, key)  <span class="comment">// NodeåŠå…¶é“¾è¡¨å¯èƒ½æ— æ³•è¢«GC</span></span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ é™¤å‰å…ˆæ–­å¼€æŒ‡é’ˆé“¾</span></span><br><span class="line"><span class="keyword">if</span> node, ok := m[key]; ok &#123;</span><br><span class="line">	<span class="comment">// æ¸…ç†æŒ‡é’ˆå¼•ç”¨</span></span><br><span class="line">	<span class="keyword">for</span> current := node; current != <span class="literal">nil</span>; &#123;</span><br><span class="line">		next := current.next</span><br><span class="line">		current.next = <span class="literal">nil</span>  <span class="comment">// æ–­å¼€å¼•ç”¨</span></span><br><span class="line">		current = next</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">delete</span>(m, key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å®æˆ˜åº”ç”¨ç±»é¢è¯•é¢˜">å®æˆ˜åº”ç”¨ç±»é¢è¯•é¢˜</h2>
<h3 id="Q13-å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„-LRU-ç¼“å­˜ï¼Ÿ">Q13: å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„ LRU ç¼“å­˜ï¼Ÿ</h3>
<p><strong>A:</strong> åŸºäº map + åŒå‘é“¾è¡¨å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> LRUCache <span class="keyword">struct</span> &#123;</span><br><span class="line">	capacity <span class="type">int</span></span><br><span class="line">	cache    <span class="keyword">map</span>[<span class="type">int</span>]*Node</span><br><span class="line">	head     *Node</span><br><span class="line">	tail     *Node</span><br><span class="line">	mutex    sync.RWMutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">	key   <span class="type">int</span></span><br><span class="line">	value <span class="type">int</span></span><br><span class="line">	prev  *Node</span><br><span class="line">	next  *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLRUCache</span><span class="params">(capacity <span class="type">int</span>)</span></span> *LRUCache &#123;</span><br><span class="line">	head := &amp;Node&#123;&#125;</span><br><span class="line">	tail := &amp;Node&#123;&#125;</span><br><span class="line">	head.next = tail</span><br><span class="line">	tail.prev = head</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;LRUCache&#123;</span><br><span class="line">		capacity: capacity,</span><br><span class="line">		cache:    <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]*Node),</span><br><span class="line">		head:     head,</span><br><span class="line">		tail:     tail,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lru *LRUCache)</span></span> Get(key <span class="type">int</span>) <span class="type">int</span> &#123;</span><br><span class="line">	lru.mutex.Lock()</span><br><span class="line">	<span class="keyword">defer</span> lru.mutex.Unlock()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> node, ok := lru.cache[key]; ok &#123;</span><br><span class="line">		lru.moveToHead(node)</span><br><span class="line">		<span class="keyword">return</span> node.value</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lru *LRUCache)</span></span> Put(key, value <span class="type">int</span>) &#123;</span><br><span class="line">	lru.mutex.Lock()</span><br><span class="line">	<span class="keyword">defer</span> lru.mutex.Unlock()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> node, ok := lru.cache[key]; ok &#123;</span><br><span class="line">		node.value = value</span><br><span class="line">		lru.moveToHead(node)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	node := &amp;Node&#123;key: key, value: value&#125;</span><br><span class="line">	lru.cache[key] = node</span><br><span class="line">	lru.addToHead(node)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(lru.cache) &gt; lru.capacity &#123;</span><br><span class="line">		tail := lru.removeTail()</span><br><span class="line">		<span class="built_in">delete</span>(lru.cache, tail.key)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lru *LRUCache)</span></span> moveToHead(node *Node) &#123;</span><br><span class="line">	lru.removeNode(node)</span><br><span class="line">	lru.addToHead(node)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lru *LRUCache)</span></span> removeNode(node *Node) &#123;</span><br><span class="line">	node.prev.next = node.next</span><br><span class="line">	node.next.prev = node.prev</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lru *LRUCache)</span></span> addToHead(node *Node) &#123;</span><br><span class="line">	node.prev = lru.head</span><br><span class="line">	node.next = lru.head.next</span><br><span class="line">	lru.head.next.prev = node</span><br><span class="line">	lru.head.next = node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lru *LRUCache)</span></span> removeTail() *Node &#123;</span><br><span class="line">	last := lru.tail.prev</span><br><span class="line">	lru.removeNode(last)</span><br><span class="line">	<span class="keyword">return</span> last</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Q14-å¦‚ä½•å®ç°ä¸€ä¸ªæ”¯æŒè¿‡æœŸæ—¶é—´çš„-mapï¼Ÿ">Q14: å¦‚ä½•å®ç°ä¸€ä¸ªæ”¯æŒè¿‡æœŸæ—¶é—´çš„ mapï¼Ÿ</h3>
<p><strong>A:</strong> å¸¦è¿‡æœŸæ—¶é—´çš„å¹¶å‘å®‰å…¨ mapï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ExpiringMap <span class="keyword">struct</span> &#123;</span><br><span class="line">	data   <span class="keyword">map</span>[<span class="type">string</span>]*Item</span><br><span class="line">	mutex  sync.RWMutex</span><br><span class="line">	stop   <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Item <span class="keyword">struct</span> &#123;</span><br><span class="line">	value    <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	expireAt time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewExpiringMap</span><span class="params">(cleanupInterval time.Duration)</span></span> *ExpiringMap &#123;</span><br><span class="line">	em := &amp;ExpiringMap&#123;</span><br><span class="line">		data: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]*Item),</span><br><span class="line">		stop: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¯åŠ¨æ¸…ç†goroutine</span></span><br><span class="line">	<span class="keyword">go</span> em.cleanup(cleanupInterval)</span><br><span class="line">	<span class="keyword">return</span> em</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(em *ExpiringMap)</span></span> Set(key <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;, ttl time.Duration) &#123;</span><br><span class="line">	em.mutex.Lock()</span><br><span class="line">	<span class="keyword">defer</span> em.mutex.Unlock()</span><br><span class="line"></span><br><span class="line">	em.data[key] = &amp;Item&#123;</span><br><span class="line">		value:    value,</span><br><span class="line">		expireAt: time.Now().Add(ttl),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(em *ExpiringMap)</span></span> Get(key <span class="type">string</span>) (<span class="keyword">interface</span>&#123;&#125;, <span class="type">bool</span>) &#123;</span><br><span class="line">	em.mutex.RLock()</span><br><span class="line">	<span class="keyword">defer</span> em.mutex.RUnlock()</span><br><span class="line"></span><br><span class="line">	item, ok := em.data[key]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> time.Now().After(item.expireAt) &#123;</span><br><span class="line">		<span class="comment">// è¿‡æœŸäº†ï¼Œéœ€è¦åˆ é™¤ï¼ˆå»¶è¿Ÿåˆ é™¤ï¼Œé¿å…é•¿æ—¶é—´æŒæœ‰è¯»é”ï¼‰</span></span><br><span class="line">		<span class="keyword">go</span> em.<span class="built_in">delete</span>(key)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> item.value, <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(em *ExpiringMap)</span></span> <span class="built_in">delete</span>(key <span class="type">string</span>) &#123;</span><br><span class="line">	em.mutex.Lock()</span><br><span class="line">	<span class="keyword">defer</span> em.mutex.Unlock()</span><br><span class="line">	<span class="built_in">delete</span>(em.data, key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(em *ExpiringMap)</span></span> cleanup(interval time.Duration) &#123;</span><br><span class="line">	ticker := time.NewTicker(interval)</span><br><span class="line">	<span class="keyword">defer</span> ticker.Stop()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ticker.C:</span><br><span class="line">			em.removeExpired()</span><br><span class="line">		<span class="keyword">case</span> &lt;-em.stop:</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(em *ExpiringMap)</span></span> removeExpired() &#123;</span><br><span class="line">	em.mutex.Lock()</span><br><span class="line">	<span class="keyword">defer</span> em.mutex.Unlock()</span><br><span class="line"></span><br><span class="line">	now := time.Now()</span><br><span class="line">	<span class="keyword">for</span> key, item := <span class="keyword">range</span> em.data &#123;</span><br><span class="line">		<span class="keyword">if</span> now.After(item.expireAt) &#123;</span><br><span class="line">			<span class="built_in">delete</span>(em.data, key)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(em *ExpiringMap)</span></span> Close() &#123;</span><br><span class="line">	<span class="built_in">close</span>(em.stop)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Go map çš„é¢è¯•é¢˜æ¶µç›–äº†ä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§åº”ç”¨çš„å„ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>åŸºç¡€åŸç†</strong>ï¼šç†è§£å“ˆå¸Œè¡¨ã€æ¡¶æ•°ç»„ã€å†²çªè§£å†³ç­‰æ ¸å¿ƒæ¦‚å¿µ</li>
<li><strong>æ‰©å®¹æœºåˆ¶</strong>ï¼šæŒæ¡æ¸è¿›å¼æ‰©å®¹çš„åŸç†å’Œä¼˜åŠ¿</li>
<li><strong>å¹¶å‘å®‰å…¨</strong>ï¼šäº†è§£å¹¶å‘é—®é¢˜åŠå„ç§è§£å†³æ–¹æ¡ˆ</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæŒæ¡æ€§èƒ½ä¼˜åŒ–çš„æŠ€å·§å’Œæœ€ä½³å®è·µ</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼šç†è§£å†…å­˜æ³„æ¼é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</li>
<li><strong>å®æˆ˜åº”ç”¨</strong>ï¼šèƒ½å¤ŸåŸºäº map å®ç°å¤æ‚çš„æ•°æ®ç»“æ„</li>
</ol>
<p>æ·±å…¥ç†è§£è¿™äº›çŸ¥è¯†ç‚¹ï¼Œä¸ä»…æœ‰åŠ©äºé€šè¿‡é¢è¯•ï¼Œæ›´é‡è¦çš„æ˜¯èƒ½åœ¨å®é™…å·¥ä½œä¸­æ­£ç¡®é«˜æ•ˆåœ°ä½¿ç”¨ Go mapã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>Map</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
        <tag>é¢è¯•æŒ‡å—</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: Go Map éå†æœºåˆ¶è§£æ</title>
    <url>/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E9%81%8D%E5%8E%86%E6%9C%BA%E5%88%B6%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1>Go Map éå†æœºåˆ¶è§£æ</h1>
<h2 id="éå†æœºåˆ¶æ¦‚è¿°">éå†æœºåˆ¶æ¦‚è¿°</h2>
<p>Go è¯­è¨€ä¸­ map çš„éå†æ˜¯é€šè¿‡ range å…³é”®å­—å®ç°çš„ï¼Œå…¶åº•å±‚å®ç°æ¶‰åŠå¤æ‚çš„è¿­ä»£å™¨æœºåˆ¶ã€‚ä¸å…¶ä»–è¯­è¨€ä¸åŒï¼ŒGo map çš„éå†é¡ºåºæ˜¯<strong>éšæœºçš„</strong>ï¼Œè¿™æ˜¯æœ‰æ„è®¾è®¡çš„ç‰¹æ€§ã€‚</p>
<h2 id="è¿­ä»£å™¨æ•°æ®ç»“æ„">è¿­ä»£å™¨æ•°æ®ç»“æ„</h2>
<h3 id="hiter-ç»“æ„ä½“">hiter ç»“æ„ä½“</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> hiter <span class="keyword">struct</span> &#123;</span><br><span class="line">	key         unsafe.Pointer  <span class="comment">// æŒ‡å‘éå†å¾—åˆ° key çš„æŒ‡é’ˆ</span></span><br><span class="line">	elem        unsafe.Pointer  <span class="comment">// æŒ‡å‘éå†å¾—åˆ° value çš„æŒ‡é’ˆ</span></span><br><span class="line">	t           *maptype        <span class="comment">// map ç±»å‹ï¼ŒåŒ…å«äº† keyã€value ç±»å‹å¤§å°ç­‰ä¿¡æ¯</span></span><br><span class="line">	h           *hmap           <span class="comment">// map çš„æŒ‡é’ˆ</span></span><br><span class="line">	buckets     unsafe.Pointer  <span class="comment">// map çš„æ¡¶æ•°ç»„</span></span><br><span class="line">	bptr        *bmap           <span class="comment">// å½“å‰éå†åˆ°çš„æ¡¶</span></span><br><span class="line">	overflow    *[]*bmap        <span class="comment">// æ–°è€æ¡¶æ•°ç»„å¯¹åº”çš„æº¢å‡ºæ¡¶</span></span><br><span class="line">	oldoverflow *[]*bmap        <span class="comment">// è€æ¡¶æ•°ç»„çš„æº¢å‡ºæ¡¶</span></span><br><span class="line">	startBucket <span class="type">uintptr</span>         <span class="comment">// éå†èµ·å§‹ä½ç½®çš„æ¡¶ç´¢å¼•</span></span><br><span class="line">	offset      <span class="type">uint8</span>           <span class="comment">// éå†èµ·å§‹ä½ç½®çš„ key-value å¯¹ç´¢å¼•å·</span></span><br><span class="line">	wrapped     <span class="type">bool</span>            <span class="comment">// éå†æ˜¯å¦ç©¿è¶Šæ¡¶æ•°ç»„å°¾ç«¯å›åˆ°å¤´éƒ¨äº†</span></span><br><span class="line">	B           <span class="type">uint8</span>           <span class="comment">// æ¡¶æ•°ç»„çš„é•¿åº¦æŒ‡æ•°</span></span><br><span class="line">	i           <span class="type">uint8</span>           <span class="comment">// å½“å‰éå†åˆ°çš„ key-value å¯¹åœ¨æ¡¶ä¸­çš„ç´¢å¼•</span></span><br><span class="line">	bucket      <span class="type">uintptr</span>         <span class="comment">// å½“å‰éå†åˆ°çš„æ¡¶</span></span><br><span class="line">	checkBucket <span class="type">uintptr</span>         <span class="comment">// å› ä¸ºæ‰©å®¹æµç¨‹çš„å­˜åœ¨ï¼Œéœ€è¦é¢å¤–æ£€æŸ¥çš„æ¡¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>hiter æ˜¯éå† map æ—¶ç”¨äºå­˜æ”¾ä¸´æ—¶æ•°æ®çš„è¿­ä»£å™¨ï¼Œå®ƒè®°å½•äº†éå†è¿‡ç¨‹ä¸­çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ã€‚</p>
<h3 id="å­—æ®µè¯¦è§£">å­—æ®µè¯¦è§£</h3>
<ul>
<li><strong>key/elem</strong>ï¼šæŒ‡å‘å½“å‰éå†åˆ°çš„ key-value å¯¹</li>
<li><strong>t/h</strong>ï¼šmap çš„ç±»å‹ä¿¡æ¯å’Œå®ä¾‹æŒ‡é’ˆ</li>
<li><strong>buckets</strong>ï¼šå½“å‰ä½¿ç”¨çš„æ¡¶æ•°ç»„</li>
<li><strong>bptr</strong>ï¼šå½“å‰æ­£åœ¨éå†çš„æ¡¶</li>
<li><strong>startBucket/offset</strong>ï¼šéšæœºåŒ–çš„èµ·å§‹ä½ç½®</li>
<li><strong>wrapped</strong>ï¼šæ˜¯å¦å·²ç»ç»•äº†ä¸€åœˆ</li>
<li><strong>bucket/i</strong>ï¼šå½“å‰éå†ä½ç½®</li>
<li><strong>checkBucket</strong>ï¼šæ‰©å®¹æ—¶éœ€è¦æ£€æŸ¥çš„æ¡¶</li>
</ul>
<h2 id="åˆå§‹åŒ–æµç¨‹-mapiterinit">åˆå§‹åŒ–æµç¨‹ - mapiterinit</h2>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/Go%E8%AF%AD%E8%A8%80/Map/Go-Map-%E9%81%8D%E5%8E%86%E6%9C%BA%E5%88%B6%E8%A7%A3%E6%9E%90/1750126758693.png" alt="1750126758693"></p>
<p>map éå†æµç¨‹å¼€å§‹æ—¶ï¼Œé¦–å…ˆä¼šèµ°è¿› runtime/map.go çš„ mapiterinit() æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šåˆ›å»º map è¿­ä»£å™¨ hiterï¼Œå¹¶ä¸”é€šè¿‡å–éšæœºæ•°çš„æ–¹å¼ï¼Œå†³å®šéå†çš„èµ·å§‹æ¡¶å·ä»¥åŠèµ·å§‹ key-value å¯¹ç´¢å¼•å·ã€‚</p>
<h3 id="mapiterinit-æºç å®ç°">mapiterinit æºç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapiterinit</span><span class="params">(t *maptype, h *hmap, it *hiter)</span></span> &#123;</span><br><span class="line">	it.t = t</span><br><span class="line">	<span class="keyword">if</span> h == <span class="literal">nil</span> || h.count == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	it.h = h</span><br><span class="line">	it.B = h.B</span><br><span class="line">	it.buckets = h.buckets</span><br><span class="line">	<span class="keyword">if</span> t.bucket.ptrdata == <span class="number">0</span> &#123;</span><br><span class="line">		h.createOverflow()</span><br><span class="line">		it.overflow = h.extra.overflow</span><br><span class="line">		it.oldoverflow = h.extra.oldoverflow</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å†³å®šèµ·å§‹ä½ç½® - å…³é”®çš„éšæœºåŒ–é€»è¾‘</span></span><br><span class="line">	<span class="keyword">var</span> r <span class="type">uintptr</span></span><br><span class="line">	r = <span class="type">uintptr</span>(fastrand())  <span class="comment">// è·å–éšæœºæ•°</span></span><br><span class="line"></span><br><span class="line">	it.startBucket = r &amp; bucketMask(h.B)           <span class="comment">// ç¡®å®šèµ·å§‹æ¡¶</span></span><br><span class="line">	it.offset = <span class="type">uint8</span>(r &gt;&gt; h.B &amp; (bucketCnt - <span class="number">1</span>))  <span class="comment">// ç¡®å®šæ¡¶å†…èµ·å§‹åç§»</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–è¿­ä»£å™¨çŠ¶æ€</span></span><br><span class="line">	it.bucket = it.startBucket</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ ‡è®°å­˜åœ¨è¿­ä»£å™¨</span></span><br><span class="line">	<span class="keyword">if</span> old := h.flags; old&amp;(iterator|oldIterator) != iterator|oldIterator &#123;</span><br><span class="line">		atomic.Or8(&amp;h.flags, iterator|oldIterator)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	mapiternext(it)  <span class="comment">// å¼€å§‹éå†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="éšæœºåŒ–èµ·å§‹ä½ç½®">éšæœºåŒ–èµ·å§‹ä½ç½®</h3>
<p>Go map éå†çš„éšæœºæ€§ä¸»è¦ä½“ç°åœ¨èµ·å§‹ä½ç½®çš„éšæœºåŒ–ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> r <span class="type">uintptr</span></span><br><span class="line">r = <span class="type">uintptr</span>(fastrand())</span><br><span class="line">it.startBucket = r &amp; bucketMask(h.B)           <span class="comment">// éšæœºèµ·å§‹æ¡¶</span></span><br><span class="line">it.offset = <span class="type">uint8</span>(r &gt;&gt; h.B &amp; (bucketCnt - <span class="number">1</span>))  <span class="comment">// æ¡¶å†…éšæœºèµ·å§‹ä½ç½®</span></span><br></pre></td></tr></table></figure>
<p>è¿™ç§è®¾è®¡ç¡®ä¿äº†ï¼š</p>
<ol>
<li><strong>èµ·å§‹æ¡¶éšæœº</strong>ï¼šä»éšæœºçš„æ¡¶å¼€å§‹éå†</li>
<li><strong>æ¡¶å†…èµ·å§‹ä½ç½®éšæœº</strong>ï¼šå³ä½¿åœ¨åŒä¸€ä¸ªæ¡¶å†…ï¼Œèµ·å§‹ä½ç½®ä¹Ÿæ˜¯éšæœºçš„</li>
<li><strong>ä¸å¯é¢„æµ‹æ€§</strong>ï¼šä¸¤æ¬¡éå†çš„é¡ºåºå‡ ä¹ä¸å¯èƒ½ç›¸åŒ</li>
</ol>
<h2 id="éå†æ‰§è¡Œæµç¨‹-mapiternext">éå†æ‰§è¡Œæµç¨‹ - mapiternext</h2>
<h3 id="mapiternext-æ ¸å¿ƒå®ç°">mapiternext æ ¸å¿ƒå®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapiternext</span><span class="params">(it *hiter)</span></span> &#123;</span><br><span class="line">	h := it.h</span><br><span class="line">	<span class="keyword">if</span> h.flags&amp;hashWriting != <span class="number">0</span> &#123;</span><br><span class="line">		fatal(<span class="string">&quot;concurrent map iteration and map write&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	t := it.t</span><br><span class="line">	bucket := it.bucket</span><br><span class="line">	b := it.bptr</span><br><span class="line">	i := it.i</span><br><span class="line">	checkBucket := it.checkBucket</span><br><span class="line"></span><br><span class="line">next:</span><br><span class="line">	<span class="keyword">if</span> b == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// æ£€æŸ¥æ˜¯å¦å®Œæˆä¸€è½®éå†</span></span><br><span class="line">		<span class="keyword">if</span> bucket == it.startBucket &amp;&amp; it.wrapped &#123;</span><br><span class="line">			it.key = <span class="literal">nil</span></span><br><span class="line">			it.elem = <span class="literal">nil</span></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¤„ç†æ‰©å®¹æœŸé—´çš„éå†</span></span><br><span class="line">		<span class="keyword">if</span> h.growing() &amp;&amp; it.B == h.B &#123;</span><br><span class="line">			oldbucket := bucket &amp; it.h.oldbucketmask()</span><br><span class="line">			b = (*bmap)(add(h.oldbuckets, oldbucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">			<span class="keyword">if</span> !evacuated(b) &#123;</span><br><span class="line">				checkBucket = bucket</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				b = (*bmap)(add(it.buckets, bucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">				checkBucket = noCheck</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			b = (*bmap)(add(it.buckets, bucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">			checkBucket = noCheck</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		bucket++</span><br><span class="line">		<span class="keyword">if</span> bucket == bucketShift(it.B) &#123;</span><br><span class="line">			bucket = <span class="number">0</span></span><br><span class="line">			it.wrapped = <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">		i = <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// éå†æ¡¶å†…çš„ key-value å¯¹</span></span><br><span class="line">	<span class="keyword">for</span> ; i &lt; bucketCnt; i++ &#123;</span><br><span class="line">		offi := (i + it.offset) &amp; (bucketCnt - <span class="number">1</span>)  <span class="comment">// åº”ç”¨éšæœºåç§»</span></span><br><span class="line">		<span class="keyword">if</span> isEmpty(b.tophash[offi]) || b.tophash[offi] == evacuatedEmpty &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		k := add(unsafe.Pointer(b), dataOffset+<span class="type">uintptr</span>(offi)*<span class="type">uintptr</span>(t.keysize))</span><br><span class="line">		<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">			k = *((*unsafe.Pointer)(k))</span><br><span class="line">		&#125;</span><br><span class="line">		e := add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="type">uintptr</span>(t.keysize)+<span class="type">uintptr</span>(offi)*<span class="type">uintptr</span>(t.elemsize))</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ‰©å®¹æœŸé—´çš„ç‰¹æ®Šæ£€æŸ¥</span></span><br><span class="line">		<span class="keyword">if</span> checkBucket != noCheck &amp;&amp; !h.sameSizeGrow() &#123;</span><br><span class="line">			hash := t.hasher(k, <span class="type">uintptr</span>(h.hash0))</span><br><span class="line">			<span class="keyword">if</span> (hash&gt;&gt;it.h.B)&amp;<span class="number">1</span> != (checkBucket&gt;&gt;it.h.B)&amp;<span class="number">1</span> &#123;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¤„ç†å·²è¿ç§»çš„æ•°æ®</span></span><br><span class="line">		<span class="keyword">if</span> (b.tophash[offi] != evacuatedX &amp;&amp; b.tophash[offi] != evacuatedY) ||</span><br><span class="line">			!(t.reflexivekey() || t.key.equal(k, k)) &#123;</span><br><span class="line">			it.key = k</span><br><span class="line">			<span class="keyword">if</span> t.indirectelem() &#123;</span><br><span class="line">				e = *((*unsafe.Pointer)(e))</span><br><span class="line">			&#125;</span><br><span class="line">			it.elem = e</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// æŸ¥æ‰¾æ–°è¡¨ä¸­çš„å½“å‰å€¼</span></span><br><span class="line">			rk, re := mapaccessK(t, h, k)</span><br><span class="line">			<span class="keyword">if</span> rk == <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">continue</span>  <span class="comment">// key å·²è¢«åˆ é™¤</span></span><br><span class="line">			&#125;</span><br><span class="line">			it.key = rk</span><br><span class="line">			it.elem = re</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ›´æ–°è¿­ä»£å™¨çŠ¶æ€</span></span><br><span class="line">		it.bucket = bucket</span><br><span class="line">		<span class="keyword">if</span> it.bptr != b &#123;</span><br><span class="line">			it.bptr = b</span><br><span class="line">		&#125;</span><br><span class="line">		it.i = i + <span class="number">1</span></span><br><span class="line">		it.checkBucket = checkBucket</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæº¢å‡ºæ¡¶</span></span><br><span class="line">	b = b.overflow(t)</span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	<span class="keyword">goto</span> next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="éå†æµç¨‹å…³é”®ç‚¹">éå†æµç¨‹å…³é”®ç‚¹</h3>
<h4 id="1-å¹¶å‘å®‰å…¨æ£€æŸ¥">1. å¹¶å‘å®‰å…¨æ£€æŸ¥</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h.flags&amp;hashWriting != <span class="number">0</span> &#123;</span><br><span class="line">	fatal(<span class="string">&quot;concurrent map iteration and map write&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éå†æ—¶å‘ç°å…¶ä»– goroutine åœ¨å¹¶å‘å†™ï¼Œç›´æ¥æŠ›å‡º fatal errorã€‚</p>
<h4 id="2-æ¡¶å†…éšæœºåç§»">2. æ¡¶å†…éšæœºåç§»</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">offi := (i + it.offset) &amp; (bucketCnt - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>å³ä½¿åœ¨åŒä¸€ä¸ªæ¡¶å†…ï¼Œä¹Ÿä¼šåº”ç”¨éšæœºåç§»ï¼Œè¿›ä¸€æ­¥å¢å¼ºéšæœºæ€§ã€‚</p>
<h4 id="3-æ‰©å®¹æœŸé—´çš„å¤„ç†">3. æ‰©å®¹æœŸé—´çš„å¤„ç†</h4>
<p>åœ¨æ‰©å®¹æœŸé—´éå†éœ€è¦ç‰¹åˆ«å¤„ç†ï¼š</p>
<ul>
<li>æ£€æŸ¥æ•°æ®æ˜¯åœ¨è€æ¡¶è¿˜æ˜¯æ–°æ¡¶</li>
<li>å¯¹äºæœªè¿ç§»çš„æ•°æ®ï¼Œä»è€æ¡¶è¯»å–</li>
<li>å¯¹äºå·²è¿ç§»çš„æ•°æ®ï¼Œä»æ–°æ¡¶è¯»å–</li>
</ul>
<h4 id="4-æ•°æ®ä¸€è‡´æ€§ä¿è¯">4. æ•°æ®ä¸€è‡´æ€§ä¿è¯</h4>
<p>å¯¹äºæ­£åœ¨è¿ç§»çš„æ•°æ®ï¼Œé€šè¿‡ä»¥ä¸‹æœºåˆ¶ä¿è¯ä¸€è‡´æ€§ï¼š</p>
<ul>
<li>æ£€æŸ¥ tophash çŠ¶æ€æ ‡è®°</li>
<li>å¯¹äºå·²è¿ç§»çš„æ•°æ®ï¼Œé‡æ–°ä»æ–°è¡¨æŸ¥æ‰¾</li>
<li>ç¡®ä¿è¿”å›æœ€æ–°çš„æ•°æ®</li>
</ul>
<h2 id="éšæœºåŒ–çš„å®ç°æœºåˆ¶">éšæœºåŒ–çš„å®ç°æœºåˆ¶</h2>
<h3 id="ä¸ºä»€ä¹ˆè¦éšæœºåŒ–">ä¸ºä»€ä¹ˆè¦éšæœºåŒ–</h3>
<p>Go æœ‰æ„è®¾è®¡äº†éšæœºåŒ–çš„éå†é¡ºåºï¼ŒåŸå› åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>é¿å…ä¾èµ–</strong>ï¼šé˜²æ­¢ç¨‹åºä¾èµ–ç‰¹å®šçš„éå†é¡ºåº</li>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šå“ˆå¸Œè¡¨æœ¬èº«å°±ä¸ä¿è¯é¡ºåº</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šé˜²æ­¢æŸäº›æ”»å‡»æ‰‹æ®µåˆ©ç”¨å›ºå®šçš„éå†é¡ºåº</li>
<li><strong>å‘å‰å…¼å®¹</strong>ï¼šä¿è¯æœªæ¥ä¼˜åŒ–ä¸ä¼šç ´åç°æœ‰ç¨‹åº</li>
</ol>
<h3 id="éšæœºåŒ–çš„å¤šä¸ªå±‚æ¬¡">éšæœºåŒ–çš„å¤šä¸ªå±‚æ¬¡</h3>
<ol>
<li><strong>èµ·å§‹æ¡¶éšæœº</strong>ï¼š<code>startBucket = r &amp; bucketMask(h.B)</code></li>
<li><strong>æ¡¶å†…åç§»éšæœº</strong>ï¼š<code>offset = uint8(r &gt;&gt; h.B &amp; (bucketCnt - 1))</code></li>
<li><strong>æ¯æ¬¡åç§»åº”ç”¨</strong>ï¼š<code>offi = (i + it.offset) &amp; (bucketCnt - 1)</code></li>
</ol>
<h3 id="éšæœºæ€§åˆ†æ">éšæœºæ€§åˆ†æ</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šéå†é¡ºåºçš„éšæœºæ€§</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demonstrateRandomness</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>&#123;<span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>, <span class="number">3</span>: <span class="number">3</span>, <span class="number">4</span>: <span class="number">4</span>, <span class="number">5</span>: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;ç¬¬ä¸€æ¬¡éå†:&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%d:%d &quot;</span>, k, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;\nç¬¬äºŒæ¬¡éå†:&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%d:%d &quot;</span>, k, v)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// è¾“å‡ºé¡ºåºå¾ˆå¯èƒ½ä¸åŒ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ‰©å®¹æœŸé—´çš„éå†å¤„ç†">æ‰©å®¹æœŸé—´çš„éå†å¤„ç†</h2>
<h3 id="åŒæ•°ç»„éå†ç­–ç•¥">åŒæ•°ç»„éå†ç­–ç•¥</h3>
<p>åœ¨æ‰©å®¹æœŸé—´ï¼Œmap åŒæ—¶ç»´æŠ¤æ–°è€ä¸¤ä¸ªæ¡¶æ•°ç»„ï¼Œéå†éœ€è¦ç‰¹æ®Šå¤„ç†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> h.growing() &amp;&amp; it.B == h.B &#123;</span><br><span class="line">	<span class="comment">// åœ¨è€æ¡¶ä¸­æŸ¥æ‰¾</span></span><br><span class="line">	oldbucket := bucket &amp; it.h.oldbucketmask()</span><br><span class="line">	b = (*bmap)(add(h.oldbuckets, oldbucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">	<span class="keyword">if</span> !evacuated(b) &#123;</span><br><span class="line">		<span class="comment">// æ•°æ®è¿˜åœ¨è€æ¡¶ä¸­</span></span><br><span class="line">		checkBucket = bucket</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// æ•°æ®å·²è¿ç§»åˆ°æ–°æ¡¶</span></span><br><span class="line">		b = (*bmap)(add(it.buckets, bucket*<span class="type">uintptr</span>(t.bucketsize)))</span><br><span class="line">		checkBucket = noCheck</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®ä¸€è‡´æ€§ä¿è¯">æ•°æ®ä¸€è‡´æ€§ä¿è¯</h3>
<ol>
<li><strong>çŠ¶æ€æ£€æŸ¥</strong>ï¼šé€šè¿‡ evacuated å‡½æ•°æ£€æŸ¥æ¡¶æ˜¯å¦å·²è¿ç§»</li>
<li><strong>åŒé‡æŸ¥æ‰¾</strong>ï¼šå¯¹äºå·²è¿ç§»çš„æ•°æ®ï¼Œé‡æ–°æŸ¥æ‰¾ç¡®ä¿ä¸€è‡´æ€§</li>
<li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šé€šè¿‡ checkBucket æœºåˆ¶å¤„ç†ç‰ˆæœ¬å·®å¼‚</li>
</ol>
<h2 id="æ€§èƒ½ä¼˜åŒ–è€ƒè™‘">æ€§èƒ½ä¼˜åŒ–è€ƒè™‘</h2>
<h3 id="è¿­ä»£å™¨çŠ¶æ€ç®¡ç†">è¿­ä»£å™¨çŠ¶æ€ç®¡ç†</h3>
<ol>
<li><strong>æœ€å°çŠ¶æ€</strong>ï¼šè¿­ä»£å™¨åªä¿å­˜å¿…è¦çš„çŠ¶æ€ä¿¡æ¯</li>
<li><strong>æ‡’åŠ è½½</strong>ï¼šåªåœ¨éœ€è¦æ—¶æ‰è®¡ç®—ä¸‹ä¸€ä¸ªä½ç½®</li>
<li><strong>å†…å­˜å‹å¥½</strong>ï¼šé¿å…å¤§é‡çš„ä¸´æ—¶å¯¹è±¡åˆ†é…</li>
</ol>
<h3 id="ç¼“å­˜å‹å¥½çš„éå†">ç¼“å­˜å‹å¥½çš„éå†</h3>
<ol>
<li><strong>è¿ç»­è®¿é—®</strong>ï¼šå°½å¯èƒ½è¿ç»­è®¿é—®å†…å­˜</li>
<li><strong>é¢„å–ä¼˜åŒ–</strong>ï¼šåˆ©ç”¨ CPU ç¼“å­˜é¢„å–æœºåˆ¶</li>
<li><strong>å±€éƒ¨æ€§åŸç†</strong>ï¼šå…ˆéå†å®Œä¸€ä¸ªæ¡¶å†ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ¡¶</li>
</ol>
<h2 id="é¢è¯•é‡ç‚¹é—®é¢˜">é¢è¯•é‡ç‚¹é—®é¢˜</h2>
<h3 id="Q1-Go-map-éå†ä¸ºä»€ä¹ˆæ˜¯æ— åºçš„ï¼Ÿ">Q1: Go map éå†ä¸ºä»€ä¹ˆæ˜¯æ— åºçš„ï¼Ÿ</h3>
<p><strong>A:</strong> Go map éå†æ— åºçš„åŸå› ï¼š</p>
<ol>
<li><strong>è®¾è®¡åˆè¡·</strong>ï¼šæ•…æ„è®¾è®¡ä¸ºæ— åºï¼Œé˜²æ­¢ç¨‹åºä¾èµ–éå†é¡ºåº</li>
<li><strong>å“ˆå¸Œç‰¹æ€§</strong>ï¼šå“ˆå¸Œè¡¨æœ¬èº«ä¸ä¿è¯æ•°æ®é¡ºåº</li>
<li><strong>éšæœºåŒ–å®ç°</strong>ï¼š
<ul>
<li>éšæœºèµ·å§‹æ¡¶ï¼š<code>startBucket = r &amp; bucketMask(h.B)</code></li>
<li>éšæœºæ¡¶å†…åç§»ï¼š<code>offset = uint8(r &gt;&gt; h.B &amp; (bucketCnt - 1))</code></li>
</ul>
</li>
<li><strong>æ‰©å®¹å½±å“</strong>ï¼šæ‰©å®¹è¿‡ç¨‹ä¸­æ•°æ®é‡æ–°åˆ†å¸ƒ</li>
</ol>
<h3 id="Q2-å¦‚ä½•å®ç°-map-çš„æœ‰åºéå†ï¼Ÿ">Q2: å¦‚ä½•å®ç° map çš„æœ‰åºéå†ï¼Ÿ</h3>
<p><strong>A:</strong> å®ç°æœ‰åºéå†çš„æ–¹æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•1ï¼šæ”¶é›†keyåæ’åº</span></span><br><span class="line">keys := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(m))</span><br><span class="line"><span class="keyword">for</span> k := <span class="keyword">range</span> m &#123;</span><br><span class="line">	keys = <span class="built_in">append</span>(keys, k)</span><br><span class="line">&#125;</span><br><span class="line">sort.Strings(keys)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, k := <span class="keyword">range</span> keys &#123;</span><br><span class="line">	fmt.Println(k, m[k])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•2ï¼šä½¿ç”¨æœ‰åºå®¹å™¨</span></span><br><span class="line"><span class="comment">// å¯ä»¥è€ƒè™‘ä½¿ç”¨ sync.Map æˆ–ç¬¬ä¸‰æ–¹æœ‰åºmapåº“</span></span><br></pre></td></tr></table></figure>
<h3 id="Q3-éå†è¿‡ç¨‹ä¸­ä¿®æ”¹-map-ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ">Q3: éå†è¿‡ç¨‹ä¸­ä¿®æ”¹ map ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3>
<p><strong>A:</strong> éå†è¿‡ç¨‹ä¸­ä¿®æ”¹ map çš„å½±å“ï¼š</p>
<ol>
<li><strong>å†™æ“ä½œå†²çª</strong>ï¼šä¼šè§¦å‘ <code>fatal(&quot;concurrent map iteration and map write&quot;)</code></li>
<li><strong>è¯»æ“ä½œå®‰å…¨</strong>ï¼šåŒæ—¶å¤šä¸ªéå†æ˜¯å®‰å…¨çš„</li>
<li><strong>é¿å…æ–¹æ³•</strong>ï¼š
<ul>
<li>å…ˆæ”¶é›†è¦ä¿®æ”¹çš„ keyï¼Œéå†ç»“æŸåå†ä¿®æ”¹</li>
<li>ä½¿ç”¨ channel æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶</li>
<li>åˆ›å»ºæ–°çš„ map æ¥ä¿å­˜ä¿®æ”¹ç»“æœ</li>
</ul>
</li>
</ol>
<h3 id="Q4-æ‰©å®¹æœŸé—´éå†å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ">Q4: æ‰©å®¹æœŸé—´éå†å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</h3>
<p><strong>A:</strong> æ‰©å®¹æœŸé—´çš„ä¸€è‡´æ€§ä¿è¯æœºåˆ¶ï¼š</p>
<ol>
<li><strong>åŒæ•°ç»„æŸ¥æ‰¾</strong>ï¼šåŒæ—¶æ£€æŸ¥æ–°è€æ¡¶æ•°ç»„</li>
<li><strong>è¿ç§»çŠ¶æ€æ£€æŸ¥</strong>ï¼šé€šè¿‡ tophash æ ‡è®°åˆ¤æ–­æ•°æ®ä½ç½®</li>
<li><strong>é‡æ–°æŸ¥æ‰¾æœºåˆ¶</strong>ï¼šå¯¹å·²è¿ç§»æ•°æ®é‡æ–°æŸ¥æ‰¾ç¡®ä¿æœ€æ–°å€¼</li>
<li><strong>æ¸è¿›å¼è¿ç§»</strong>ï¼šä¸ä¼šé˜»å¡éå†æ“ä½œ</li>
</ol>
<h2 id="æœ€ä½³å®è·µå»ºè®®">æœ€ä½³å®è·µå»ºè®®</h2>
<h3 id="1-ä¸è¦ä¾èµ–éå†é¡ºåº">1. ä¸è¦ä¾èµ–éå†é¡ºåº</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šä¾èµ–éå†é¡ºåº</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processMapInOrder</span><span class="params">(m <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">		<span class="comment">// å‡è®¾æŸç§ç‰¹å®šé¡ºåºè¿›è¡Œå¤„ç†</span></span><br><span class="line">		<span class="keyword">if</span> isFirstKey(k) &#123; <span class="comment">// è¿™ç§å‡è®¾æ˜¯é”™è¯¯çš„</span></span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šæ˜¾å¼æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processMapInOrder</span><span class="params">(m <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	keys := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(m))</span><br><span class="line">	<span class="keyword">for</span> k := <span class="keyword">range</span> m &#123;</span><br><span class="line">		keys = <span class="built_in">append</span>(keys, k)</span><br><span class="line">	&#125;</span><br><span class="line">	sort.Strings(keys)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, k := <span class="keyword">range</span> keys &#123;</span><br><span class="line">		<span class="comment">// å¤„ç† m[k]</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-é¿å…éå†æ—¶ä¿®æ”¹">2. é¿å…éå†æ—¶ä¿®æ”¹</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šéå†æ—¶ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">	<span class="keyword">if</span> shouldDelete(v) &#123;</span><br><span class="line">		<span class="built_in">delete</span>(m, k)  <span class="comment">// ä¼španic</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šå…ˆæ”¶é›†åå¤„ç†</span></span><br><span class="line">toDelete := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">	<span class="keyword">if</span> shouldDelete(v) &#123;</span><br><span class="line">		toDelete = <span class="built_in">append</span>(toDelete, k)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> _, k := <span class="keyword">range</span> toDelete &#123;</span><br><span class="line">	<span class="built_in">delete</span>(m, k)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å°ç»“">å°ç»“</h2>
<p>Go map çš„éå†æœºåˆ¶ä½“ç°äº†ç²¾å¿ƒçš„è®¾è®¡ï¼š</p>
<ol>
<li><strong>éšæœºåŒ–ç­–ç•¥</strong>ï¼šå¤šå±‚æ¬¡çš„éšæœºåŒ–ä¿è¯éå†é¡ºåºä¸å¯é¢„æµ‹</li>
<li><strong>æ‰©å®¹å…¼å®¹</strong>ï¼šåœ¨æ‰©å®¹æœŸé—´ä»èƒ½æ­£ç¡®éå†æ‰€æœ‰æ•°æ®</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå……åˆ†è€ƒè™‘ç¼“å­˜å‹å¥½æ€§å’Œå†…å­˜è®¿é—®æ¨¡å¼</li>
<li><strong>å¹¶å‘å®‰å…¨</strong>ï¼šé€šè¿‡æ£€æµ‹æœºåˆ¶é¿å…å¹¶å‘è¯»å†™é—®é¢˜</li>
</ol>
<p>ç†è§£è¿™äº›éå†æœºåˆ¶æœ‰åŠ©äºæ›´å¥½åœ°ä½¿ç”¨ Go mapï¼Œé¿å…å¸¸è§çš„é™·é˜±å’Œé”™è¯¯ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Goè¯­è¨€</category>
        <category>Map</category>
      </categories>
      <tags>
        <tag>è¿­ä»£å™¨</tag>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Goè¯­è¨€</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 173 - äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨ï¼ˆBinary Search Tree Iteratorï¼‰</title>
    <url>/2025/06/16/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-173-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E8%BF%AD%E4%BB%A3%E5%99%A8/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>å®ç°ä¸€ä¸ªäºŒå‰æœç´¢æ ‘è¿­ä»£å™¨ç±» <code>BSTIterator</code>ï¼Œè¡¨ç¤ºä¸€ä¸ªæŒ‰ä¸­åºéå†äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„è¿­ä»£å™¨ï¼š</p>
<ul>
<li><code>BSTIterator(TreeNode root)</code> åˆå§‹åŒ– <code>BSTIterator</code> ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚BST çš„æ ¹èŠ‚ç‚¹ root ä¼šä½œä¸ºæ„é€ å‡½æ•°çš„ä¸€éƒ¨åˆ†ç»™å‡ºã€‚æŒ‡é’ˆåº”åˆå§‹åŒ–ä¸ºä¸€ä¸ªä¸å­˜åœ¨äº BST ä¸­çš„æ•°å­—ï¼Œä¸”è¯¥æ•°å­—å°äº BST ä¸­çš„ä»»ä½•å…ƒç´ ã€‚</li>
<li><code>boolean hasNext()</code> å¦‚æœå‘æŒ‡é’ˆå³ä¾§éå†å­˜åœ¨æ•°å­—ï¼Œåˆ™è¿”å› <code>true</code>ï¼›å¦åˆ™è¿”å› <code>false</code>ã€‚</li>
<li><code>int next()</code> å°†æŒ‡é’ˆå‘å³ç§»åŠ¨ï¼Œç„¶åè¿”å›æŒ‡é’ˆå¤„çš„æ•°å­—ã€‚</li>
</ul>
<p>æ³¨æ„ï¼ŒæŒ‡é’ˆåˆå§‹åŒ–ä¸ºä¸€ä¸ªä¸å­˜åœ¨äº BST ä¸­çš„æ•°å­—ï¼Œæ‰€ä»¥å¯¹ <code>next()</code> çš„é¦–æ¬¡è°ƒç”¨å°†è¿”å› BST ä¸­çš„æœ€å°å…ƒç´ ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾ <code>next()</code> è°ƒç”¨æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è°ƒç”¨ <code>next()</code> æ—¶ï¼ŒBST çš„ä¸­åºéå†ä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªä¸‹ä¸€ä¸ªæ•°å­—ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥</span><br><span class="line">[&quot;BSTIterator&quot;, &quot;next&quot;, &quot;next&quot;, &quot;hasNext&quot;, &quot;next&quot;, &quot;hasNext&quot;, &quot;next&quot;, &quot;hasNext&quot;, &quot;next&quot;, &quot;hasNext&quot;]</span><br><span class="line">[[[7, 3, 15, null, null, 9, 20]], [], [], [], [], [], [], [], [], []]</span><br><span class="line">è¾“å‡º</span><br><span class="line">[null, 3, 7, true, 9, true, 15, true, 20, false]</span><br><span class="line"></span><br><span class="line">è§£é‡Š</span><br><span class="line">BSTIterator bSTIterator = new BSTIterator([7, 3, 15, null, null, 9, 20]);</span><br><span class="line">bSTIterator.next();    // è¿”å› 3</span><br><span class="line">bSTIterator.next();    // è¿”å› 7</span><br><span class="line">bSTIterator.hasNext(); // è¿”å› True</span><br><span class="line">bSTIterator.next();    // è¿”å› 9</span><br><span class="line">bSTIterator.hasNext(); // è¿”å› True</span><br><span class="line">bSTIterator.next();    // è¿”å› 15</span><br><span class="line">bSTIterator.hasNext(); // è¿”å› True</span><br><span class="line">bSTIterator.next();    // è¿”å› 20</span><br><span class="line">bSTIterator.hasNext(); // è¿”å› False</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ <code>[1, 10^5]</code> å†…</li>
<li><code>0 &lt;= Node.val &lt;= 10^6</code></li>
<li>æœ€å¤šè°ƒç”¨ <code>10^5</code> æ¬¡ <code>hasNext</code> å’Œ <code>next</code> æ“ä½œ</li>
</ul>
<p><strong>è¿›é˜¶ï¼š</strong><br>
ä½ å¯ä»¥è®¾è®¡ä¸€ä¸ªæ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ<code>next()</code> å’Œ <code>hasNext()</code> æ“ä½œå‡æ‘Šæ—¶é—´å¤æ‚åº¦ä¸º <code>O(1)</code>ï¼Œå¹¶ä½¿ç”¨ <code>O(h)</code> å†…å­˜ã€‚å…¶ä¸­ <code>h</code> æ˜¯æ ‘çš„é«˜åº¦ã€‚</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„å…³é”®æ˜¯ç†è§£<strong>äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†ä¼šäº§ç”Ÿæœ‰åºåºåˆ—</strong>è¿™ä¸€é‡è¦æ€§è´¨ã€‚æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªè¿­ä»£å™¨ï¼Œèƒ½å¤ŸæŒ‰ç…§ä¸­åºéå†çš„é¡ºåºä¾æ¬¡è¿”å›èŠ‚ç‚¹å€¼ã€‚</p>
<h3 id="æ ¸å¿ƒç®—æ³•æ€æƒ³">æ ¸å¿ƒç®—æ³•æ€æƒ³</h3>
<p><strong>å…³é”®æ´è§</strong>ï¼šä½¿ç”¨æ ˆæ¨¡æ‹Ÿä¸­åºéå†çš„é€’å½’è¿‡ç¨‹ï¼Œä½†ä¸éœ€è¦ä¸€æ¬¡æ€§éå†æ•´æ£µæ ‘ï¼Œè€Œæ˜¯<strong>æŒ‰éœ€éå†</strong>ï¼Œå®ç°æ‡’åŠ è½½ï¼ˆLazy Evaluationï¼‰ã€‚</p>
<p>ä¸­åºéå†çš„è®¿é—®é¡ºåºæ˜¯ï¼š<strong>å·¦å­æ ‘ â†’ æ ¹èŠ‚ç‚¹ â†’ å³å­æ ‘</strong></p>
<h3 id="ç®—æ³•è®¾è®¡è¦ç‚¹">ç®—æ³•è®¾è®¡è¦ç‚¹</h3>
<ol>
<li><strong>åˆå§‹åŒ–é˜¶æ®µ</strong>ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå°†æ‰€æœ‰å·¦å­èŠ‚ç‚¹ä¾æ¬¡å‹å…¥æ ˆä¸­ï¼Œè¿™æ ·æ ˆé¡¶å°±æ˜¯æœ€å°å€¼èŠ‚ç‚¹</li>
<li><strong>next() æ“ä½œ</strong>ï¼š
<ul>
<li>å¼¹å‡ºæ ˆé¡¶å…ƒç´ ä½œä¸ºå½“å‰è®¿é—®çš„èŠ‚ç‚¹</li>
<li>å¦‚æœè¯¥èŠ‚ç‚¹æœ‰å³å­æ ‘ï¼Œå°†å³å­æ ‘çš„æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆä¸­</li>
</ul>
</li>
<li><strong>hasNext() æ“ä½œ</strong>ï¼šæ£€æŸ¥æ ˆæ˜¯å¦ä¸ºç©ºå³å¯</li>
</ol>
<h3 id="å¯è§†åŒ–ç¤ºä¾‹">å¯è§†åŒ–ç¤ºä¾‹</h3>
<p>ä»¥ç¤ºä¾‹æ ‘ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  7</span><br><span class="line"> / \</span><br><span class="line">3   15</span><br><span class="line">   /  \</span><br><span class="line">  9   20</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–åæ ˆçš„çŠ¶æ€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ ˆé¡¶ â†’ [3, 7]  # ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå°†æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆ</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li><code>next()</code> â†’ è¿”å› 3ï¼Œ3 æ— å³å­æ ‘</li>
<li><code>next()</code> â†’ è¿”å› 7ï¼Œ7 æœ‰å³å­æ ‘ 15ï¼Œå°† 15 åŠå…¶å·¦å­èŠ‚ç‚¹ 9 å‹å…¥æ ˆ</li>
<li><code>next()</code> â†’ è¿”å› 9ï¼Œ9 æ— å³å­æ ‘</li>
<li><code>next()</code> â†’ è¿”å› 15ï¼Œ15 æœ‰å³å­æ ‘ 20ï¼Œå°† 20 å‹å…¥æ ˆ</li>
<li><code>next()</code> â†’ è¿”å› 20ï¼Œ20 æ— å³å­æ ‘ï¼Œæ ˆä¸ºç©º</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="å…³é”®å‡½æ•°è®¾è®¡">å…³é”®å‡½æ•°è®¾è®¡</h3>
<h4 id="pushAllLeft-è¾…åŠ©å‡½æ•°">pushAllLeft è¾…åŠ©å‡½æ•°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†èŠ‚ç‚¹åŠå…¶æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *BSTIterator)</span></span> pushAllLeft(node *TreeNode) &#123;</span><br><span class="line">    <span class="keyword">for</span> node != <span class="literal">nil</span> &#123;</span><br><span class="line">        this.nodeStack = <span class="built_in">append</span>(this.nodeStack, node)</span><br><span class="line">        node = node.Left</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Constructor-æ„é€ å‡½æ•°">Constructor æ„é€ å‡½æ•°</h4>
<ul>
<li>åˆå§‹åŒ–æ ˆ</li>
<li>å°†æ ¹èŠ‚ç‚¹çš„æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆï¼Œç¡®ä¿æ ˆé¡¶æ˜¯æœ€å°å€¼</li>
</ul>
<h4 id="Next-å‡½æ•°">Next å‡½æ•°</h4>
<ul>
<li>å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ä½œä¸ºè¿”å›å€¼</li>
<li>å¦‚æœè¯¥èŠ‚ç‚¹æœ‰å³å­æ ‘ï¼Œå°†å³å­æ ‘çš„æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆ</li>
</ul>
<h4 id="HasNext-å‡½æ•°">HasNext å‡½æ•°</h4>
<ul>
<li>ç®€å•æ£€æŸ¥æ ˆæ˜¯å¦ä¸ºç©º</li>
</ul>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> BSTIterator <span class="keyword">struct</span> &#123;</span><br><span class="line">    nodeStack []*TreeNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(root *TreeNode)</span></span> BSTIterator &#123;</span><br><span class="line">    iterator := BSTIterator&#123;</span><br><span class="line">        nodeStack: []*TreeNode&#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†æ ¹èŠ‚ç‚¹åŠå…¶æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆ</span></span><br><span class="line">    iterator.pushAllLeft(root)</span><br><span class="line">    <span class="keyword">return</span> iterator</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾…åŠ©å‡½æ•°ï¼šå°†èŠ‚ç‚¹åŠå…¶æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *BSTIterator)</span></span> pushAllLeft(node *TreeNode) &#123;</span><br><span class="line">    <span class="keyword">for</span> node != <span class="literal">nil</span> &#123;</span><br><span class="line">        this.nodeStack = <span class="built_in">append</span>(this.nodeStack, node)</span><br><span class="line">        node = node.Left</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *BSTIterator)</span></span> Next() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹</span></span><br><span class="line">    n := <span class="built_in">len</span>(this.nodeStack)</span><br><span class="line">    top := this.nodeStack[n<span class="number">-1</span>]</span><br><span class="line">    this.nodeStack = this.nodeStack[:n<span class="number">-1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœè¯¥èŠ‚ç‚¹æœ‰å³å­æ ‘ï¼Œå°†å³å­æ ‘çš„æ‰€æœ‰å·¦å­èŠ‚ç‚¹å‹å…¥æ ˆ</span></span><br><span class="line">    <span class="keyword">if</span> top.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">        this.pushAllLeft(top.Right)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> top.Val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *BSTIterator)</span></span> HasNext() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(this.nodeStack) &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>ä»¥ç¤ºä¾‹æ ‘ä¸ºä¾‹ï¼Œè¯¦ç»†è·Ÿè¸ªæ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹çŠ¶æ€ï¼šæ ˆ = [7, 3]  // ä»æ ¹èŠ‚ç‚¹7å¼€å§‹ï¼Œæ²¿å·¦å­æ ‘åˆ°3</span><br><span class="line"></span><br><span class="line">1. next() â†’ è¿”å›3</span><br><span class="line">   - å¼¹å‡º3ï¼Œ3æ— å³å­æ ‘</span><br><span class="line">   - æ ˆ = [7]</span><br><span class="line"></span><br><span class="line">2. next() â†’ è¿”å›7  </span><br><span class="line">   - å¼¹å‡º7ï¼Œ7æœ‰å³å­æ ‘15</span><br><span class="line">   - å°†15åŠå…¶å·¦å­èŠ‚ç‚¹9å‹å…¥æ ˆ</span><br><span class="line">   - æ ˆ = [15, 9]</span><br><span class="line"></span><br><span class="line">3. next() â†’ è¿”å›9</span><br><span class="line">   - å¼¹å‡º9ï¼Œ9æ— å³å­æ ‘</span><br><span class="line">   - æ ˆ = [15]</span><br><span class="line"></span><br><span class="line">4. next() â†’ è¿”å›15</span><br><span class="line">   - å¼¹å‡º15ï¼Œ15æœ‰å³å­æ ‘20</span><br><span class="line">   - å°†20å‹å…¥æ ˆï¼ˆ20æ— å·¦å­èŠ‚ç‚¹ï¼‰</span><br><span class="line">   - æ ˆ = [20]</span><br><span class="line"></span><br><span class="line">5. next() â†’ è¿”å›20</span><br><span class="line">   - å¼¹å‡º20ï¼Œ20æ— å³å­æ ‘</span><br><span class="line">   - æ ˆ = []</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<ul>
<li><strong>Constructor</strong>ï¼š$O(h)$ï¼Œå…¶ä¸­ $h$ æ˜¯æ ‘çš„é«˜åº¦ï¼Œéœ€è¦å°†æ ¹èŠ‚ç‚¹åˆ°æœ€å·¦å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹å‹å…¥æ ˆ</li>
<li><strong>next()</strong>ï¼š<strong>å‡æ‘Š</strong> $O(1)$</li>
<li><strong>hasNext()</strong>ï¼š$O(1)$</li>
</ul>
<p><strong>next() å‡æ‘Šæ—¶é—´å¤æ‚åº¦åˆ†æ</strong>ï¼š<br>
æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šè¢«å‹å…¥æ ˆä¸€æ¬¡ï¼Œæœ€å¤šè¢«å¼¹å‡ºæ ˆä¸€æ¬¡ã€‚å¯¹äº $n$ ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œæ€»å…±æ‰§è¡Œ $n$ æ¬¡ <code>next()</code> æ“ä½œï¼Œæ€»çš„æ ˆæ“ä½œæ¬¡æ•°ä¸º $2n$ï¼Œå› æ­¤å‡æ‘Šæ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<p>$O(h)$ï¼Œå…¶ä¸­ $h$ æ˜¯æ ‘çš„é«˜åº¦ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆå®Œå…¨ä¸å¹³è¡¡çš„æ ‘ï¼‰ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(n)$ï¼›åœ¨æœ€å¥½æƒ…å†µä¸‹ï¼ˆå®Œå…¨å¹³è¡¡çš„æ ‘ï¼‰ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(\log n)$ã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ ˆè¿­ä»£æ³•ï¼ˆæ¨èï¼‰</th>
<th>æ•°ç»„é¢„å¤„ç†æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>next(): å‡æ‘ŠO(1)</td>
<td>next(): O(1)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(h)</td>
<td>O(n)</td>
</tr>
<tr>
<td>åˆå§‹åŒ–æ—¶é—´</td>
<td>O(h)</td>
<td>O(n)</td>
</tr>
<tr>
<td>å†…å­˜ä½¿ç”¨</td>
<td>ä¼˜ç§€</td>
<td>è¾ƒå·®</td>
</tr>
<tr>
<td>æ‡’åŠ è½½</td>
<td>âœ… æ”¯æŒ</td>
<td>âŒ ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>BSTä¸­åºéå†çš„é‡è¦æ€§è´¨</strong>ï¼šä¸­åºéå†äºŒå‰æœç´¢æ ‘å¾—åˆ°çš„åºåˆ—æ˜¯æœ‰åºçš„</li>
<li><strong>æ ˆæ¨¡æ‹Ÿé€’å½’</strong>ï¼šä½¿ç”¨æ ˆå¯ä»¥å°†é€’å½’çš„ä¸­åºéå†è½¬æ¢ä¸ºè¿­ä»£å½¢å¼</li>
<li><strong>æ‡’åŠ è½½æ€æƒ³</strong>ï¼šä¸éœ€è¦ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰æ•°æ®ï¼ŒæŒ‰éœ€å¤„ç†å¯ä»¥æ˜¾è‘—ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦</li>
<li><strong>å‡æ‘Šåˆ†æ</strong>ï¼šè™½ç„¶å•æ¬¡ <code>next()</code> æ“ä½œå¯èƒ½éœ€è¦ $O(h)$ æ—¶é—´ï¼Œä½†å‡æ‘Šä¸‹æ¥æ˜¯ $O(1)$</li>
<li><strong>ç©ºé—´ä¼˜åŒ–æŠ€å·§</strong>ï¼šç›¸æ¯”äºé¢„å…ˆå­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹å€¼çš„æ–¹æ³•ï¼Œæ ˆæ–¹æ³•å°†ç©ºé—´å¤æ‚åº¦ä» $O(n)$ ä¼˜åŒ–åˆ° $O(h)$</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ul>
<li>å¿˜è®°åœ¨ <code>next()</code> æ–¹æ³•ä¸­å¤„ç†å³å­æ ‘çš„å·¦å­èŠ‚ç‚¹å‹æ ˆ</li>
<li>æ··æ·†ä¸­åºéå†çš„è®¿é—®é¡ºåºï¼ˆåº”è¯¥æ˜¯å·¦â†’æ ¹â†’å³ï¼‰</li>
<li>åœ¨æ„é€ å‡½æ•°ä¸­æ²¡æœ‰æ­£ç¡®åˆå§‹åŒ–æ ˆçŠ¶æ€</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ ˆ</tag>
        <tag>äºŒå‰æœç´¢æ ‘</tag>
        <tag>è¿­ä»£å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤ºï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</title>
    <url>/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/</url>
    <content><![CDATA[<h1>2.2 é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤ºï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h1>
<p>æƒ³å¿…ä¸å°‘å°ä¼™ä¼´é¢è¯•è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°ã€Œ<strong>å½“é”®å…¥ç½‘å€åï¼Œåˆ°ç½‘é¡µæ˜¾ç¤ºï¼Œå…¶é—´å‘ç”Ÿäº†ä»€ä¹ˆ</strong>ã€çš„é¢è¯•é¢˜ã€‚</p>
<p>è¿˜åˆ«è¯´ï¼Œè¿™é—®é¢˜çœŸæŒºå¸¸é—®çš„ï¼Œå‰å‡ å¤©ååœ¨æˆ‘æ—è¾¹çš„ä¸»ç®¡ç”µè¯é¢è¯•åº”è˜è€…çš„æ—¶å€™ï¼Œä¹Ÿé—®äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>æ¥ä¸‹æ¥ä»¥ä¸‹å›¾è¾ƒç®€å•çš„ç½‘ç»œæ‹“æ‰‘æ¨¡å‹ä½œä¸ºä¾‹å­ï¼Œæ¢ç©¶æ¢ç©¶å…¶é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003257891.png" alt="ç®€å•çš„ç½‘ç»œæ¨¡å‹"></p>
<h2 id="å­¤å•å°å¼Ÿ-â€”â€”-HTTP">å­¤å•å°å¼Ÿ â€”â€” HTTP</h2>
<blockquote>
<p>æµè§ˆå™¨åšçš„ç¬¬ä¸€æ­¥å·¥ä½œæ˜¯è§£æ URL</p>
</blockquote>
<p>é¦–å…ˆæµè§ˆå™¨åšçš„ç¬¬ä¸€æ­¥å·¥ä½œå°±æ˜¯è¦å¯¹ <code>URL</code> è¿›è¡Œè§£æï¼Œä»è€Œç”Ÿæˆå‘é€ç»™ <code>Web</code> æœåŠ¡å™¨çš„è¯·æ±‚ä¿¡æ¯ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸€æ¡é•¿é•¿çš„ URL é‡Œçš„å„ä¸ªå…ƒç´ çš„ä»£è¡¨ä»€ä¹ˆï¼Œè§ä¸‹å›¾ï¼š</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003271489.png" alt="1750003271489"></p>
<p>æ‰€ä»¥å›¾ä¸­çš„é•¿é•¿çš„ URL å®é™…ä¸Šæ˜¯è¯·æ±‚æœåŠ¡å™¨é‡Œçš„æ–‡ä»¶èµ„æºã€‚</p>
<blockquote>
<p>è¦æ˜¯ä¸Šå›¾ä¸­çš„è“è‰²éƒ¨åˆ† URL å…ƒç´ éƒ½çœç•¥äº†ï¼Œé‚£åº”è¯¥æ˜¯è¯·æ±‚å“ªä¸ªæ–‡ä»¶å‘¢ï¼Ÿ</p>
</blockquote>
<p>å½“æ²¡æœ‰è·¯å¾„åæ—¶ï¼Œå°±ä»£è¡¨è®¿é—®æ ¹ç›®å½•ä¸‹äº‹å…ˆè®¾ç½®çš„<strong>é»˜è®¤æ–‡ä»¶</strong>ï¼Œä¹Ÿå°±æ˜¯ <code>/index.html</code> æˆ–è€… <code>/default.html</code> è¿™äº›æ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šå‘ç”Ÿæ··ä¹±äº†ã€‚</p>
<blockquote>
<p>ç”Ÿäº§ HTTP è¯·æ±‚ä¿¡æ¯</p>
</blockquote>
<p>å¯¹ <code>URL</code> è¿›è¡Œè§£æä¹‹åï¼Œæµè§ˆå™¨ç¡®å®šäº† Web æœåŠ¡å™¨å’Œæ–‡ä»¶åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯æ¥ç”Ÿæˆ HTTP è¯·æ±‚æ¶ˆæ¯äº†ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003280759.png" alt="1750003280759"></p>
<blockquote>
<p>ä¸€ä¸ªå­¤å• HTTP æ•°æ®åŒ…è¡¨ç¤ºï¼š&quot;æˆ‘è¿™ä¹ˆä¸€ä¸ªå°å°çš„æ•°æ®åŒ…ï¼Œæ²¡äº²æ²¡å‹ï¼Œç›´æ¥å‘åˆ°æµ©ç€šçš„ç½‘ç»œï¼Œè°ä¼šçŸ¥é“æˆ‘å‘¢ï¼Ÿè°èƒ½è½½æˆ‘ä¸€ç¨‹å‘¢ï¼Ÿè°èƒ½ä¿æŠ¤æˆ‘å‘¢ï¼Ÿæˆ‘çš„ç›®çš„åœ°åœ¨å“ªå‘¢ï¼Ÿ&quot;å……æ»¡å„ç§ç–‘é—®çš„å®ƒï¼Œæ²¡æœ‰åœæ»ä¸å‰ï¼Œä¾ç„¶è¸ä¸Šäº†å¾é€”ï¼</p>
</blockquote>
<hr>
<h2 id="çœŸå®åœ°å€æŸ¥è¯¢-â€”â€”-DNS">çœŸå®åœ°å€æŸ¥è¯¢ â€”â€” DNS</h2>
<p>é€šè¿‡æµè§ˆå™¨è§£æ URL å¹¶ç”Ÿæˆ HTTP æ¶ˆæ¯åï¼Œéœ€è¦å§”æ‰˜æ“ä½œç³»ç»Ÿå°†æ¶ˆæ¯å‘é€ç»™ <code>Web</code>  æœåŠ¡å™¨ã€‚</p>
<p>ä½†åœ¨å‘é€ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€é¡¹å·¥ä½œéœ€è¦å®Œæˆï¼Œé‚£å°±æ˜¯<strong>æŸ¥è¯¢æœåŠ¡å™¨åŸŸåå¯¹åº”çš„ IP åœ°å€</strong>ï¼Œå› ä¸ºå§”æ‰˜æ“ä½œç³»ç»Ÿå‘é€æ¶ˆæ¯æ—¶ï¼Œå¿…é¡»æä¾›é€šä¿¡å¯¹è±¡çš„ IP åœ°å€ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬æ‰“ç”µè¯çš„æ—¶å€™ï¼Œå¿…é¡»è¦çŸ¥é“å¯¹æ–¹çš„ç”µè¯å·ç ï¼Œä½†ç”±äºç”µè¯å·ç éš¾ä»¥è®°å¿†ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬ä¼šå°†å¯¹æ–¹ç”µè¯å· + å§“åä¿å­˜åœ¨é€šè®¯å½•é‡Œã€‚</p>
<p>æ‰€ä»¥ï¼Œæœ‰ä¸€ç§æœåŠ¡å™¨å°±ä¸“é—¨ä¿å­˜äº† <code>Web</code> æœåŠ¡å™¨åŸŸåä¸ <code>IP</code> çš„å¯¹åº”å…³ç³»ï¼Œå®ƒå°±æ˜¯ <code>DNS</code> æœåŠ¡å™¨ã€‚</p>
<blockquote>
<p>åŸŸåçš„å±‚çº§å…³ç³»</p>
</blockquote>
<p>DNS ä¸­çš„åŸŸåéƒ½æ˜¯ç”¨<strong>å¥ç‚¹</strong>æ¥åˆ†éš”çš„ï¼Œæ¯”å¦‚ <code>www.server.com</code>ï¼Œè¿™é‡Œçš„å¥ç‚¹ä»£è¡¨äº†ä¸åŒå±‚æ¬¡ä¹‹é—´çš„<strong>ç•Œé™</strong>ã€‚</p>
<p>åœ¨åŸŸåä¸­ï¼Œ<strong>è¶Šé å³</strong>çš„ä½ç½®è¡¨ç¤ºå…¶å±‚çº§<strong>è¶Šé«˜</strong>ã€‚</p>
<p>æ¯•ç«ŸåŸŸåæ˜¯å¤–å›½äººå‘æ˜ï¼Œæ‰€ä»¥æ€ç»´å’Œä¸­å›½äººç›¸åï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªåŸå¸‚åœ°ç‚¹çš„æ—¶å€™ï¼Œå¤–å›½å–œæ¬¢ä»å°åˆ°å¤§çš„æ–¹å¼é¡ºåºè¯´èµ·ï¼ˆå¦‚ XX è¡—é“ XX åŒº XX å¸‚ XX çœï¼‰ï¼Œè€Œä¸­å›½åˆ™å–œæ¬¢ä»å¤§åˆ°å°çš„é¡ºåºï¼ˆå¦‚ XX çœ XX å¸‚ XX åŒº XX è¡—é“ï¼‰ã€‚</p>
<p>å®é™…ä¸ŠåŸŸåæœ€åè¿˜æœ‰ä¸€ä¸ªç‚¹ï¼Œæ¯”å¦‚ <code>www.server.com.</code>ï¼Œè¿™ä¸ªæœ€åçš„ä¸€ä¸ªç‚¹ä»£è¡¨æ ¹åŸŸåã€‚</p>
<p>ä¹Ÿå°±æ˜¯ï¼Œ<code>.</code> æ ¹åŸŸæ˜¯åœ¨æœ€é¡¶å±‚ï¼Œå®ƒçš„ä¸‹ä¸€å±‚å°±æ˜¯ <code>.com</code> é¡¶çº§åŸŸï¼Œå†ä¸‹é¢æ˜¯ <code>server.com</code>ã€‚</p>
<p>æ‰€ä»¥åŸŸåçš„å±‚çº§å…³ç³»ç±»ä¼¼ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼š</p>
<ul>
<li>æ ¹ DNS æœåŠ¡å™¨ï¼ˆ.ï¼‰</li>
<li>é¡¶çº§åŸŸ DNS æœåŠ¡å™¨ï¼ˆ.comï¼‰</li>
<li>æƒå¨ DNS æœåŠ¡å™¨ï¼ˆ<a href="http://server.com">server.com</a>ï¼‰</li>
</ul>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003303859.png" alt="1750003303859"></p>
<p>æ ¹åŸŸçš„ DNS æœåŠ¡å™¨ä¿¡æ¯ä¿å­˜åœ¨äº’è”ç½‘ä¸­æ‰€æœ‰çš„ DNS æœåŠ¡å™¨ä¸­ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œä»»ä½• DNS æœåŠ¡å™¨å°±éƒ½å¯ä»¥æ‰¾åˆ°å¹¶è®¿é—®æ ¹åŸŸ DNS æœåŠ¡å™¨äº†ã€‚</p>
<p>å› æ­¤ï¼Œå®¢æˆ·ç«¯åªè¦èƒ½å¤Ÿæ‰¾åˆ°ä»»æ„ä¸€å° DNS æœåŠ¡å™¨ï¼Œå°±å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°æ ¹åŸŸ DNS æœåŠ¡å™¨ï¼Œç„¶åå†ä¸€è·¯é¡ºè—¤æ‘¸ç“œæ‰¾åˆ°ä½äºä¸‹å±‚çš„æŸå°ç›®æ ‡ DNS æœåŠ¡å™¨ã€‚</p>
<blockquote>
<p>åŸŸåè§£æçš„å·¥ä½œæµç¨‹</p>
</blockquote>
<ol>
<li>å®¢æˆ·ç«¯é¦–å…ˆä¼šå‘å‡ºä¸€ä¸ª DNS è¯·æ±‚ï¼Œé—® <a href="http://www.server.com">www.server.com</a> çš„ IP æ˜¯å•¥ï¼Œå¹¶å‘ç»™æœ¬åœ° DNS æœåŠ¡å™¨ï¼ˆä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯çš„ TCP/IP è®¾ç½®ä¸­å¡«å†™çš„ DNS æœåŠ¡å™¨åœ°å€ï¼‰ã€‚</li>
<li>æœ¬åœ°åŸŸåæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œå¦‚æœç¼“å­˜é‡Œçš„è¡¨æ ¼èƒ½æ‰¾åˆ° <a href="http://www.server.com">www.server.com</a>ï¼Œåˆ™å®ƒç›´æ¥è¿”å› IP åœ°å€ã€‚å¦‚æœæ²¡æœ‰ï¼Œæœ¬åœ° DNS ä¼šå»é—®å®ƒçš„æ ¹åŸŸåæœåŠ¡å™¨ï¼š&quot;è€å¤§ï¼Œèƒ½å‘Šè¯‰æˆ‘ <a href="http://www.server.com">www.server.com</a> çš„ IP åœ°å€å—ï¼Ÿ&quot;æ ¹åŸŸåæœåŠ¡å™¨æ˜¯æœ€é«˜å±‚æ¬¡çš„ï¼Œå®ƒä¸ç›´æ¥ç”¨äºåŸŸåè§£æï¼Œä½†èƒ½æŒ‡æ˜ä¸€æ¡é“è·¯ã€‚</li>
<li>æ ¹ DNS æ”¶åˆ°æ¥è‡ªæœ¬åœ° DNS çš„è¯·æ±‚åï¼Œå‘ç°åç½®æ˜¯ .comï¼Œè¯´ï¼šâ€œ<a href="http://www.server.com">www.server.com</a> è¿™ä¸ªåŸŸåå½’ .com åŒºåŸŸç®¡ç†â€ï¼Œæˆ‘æŠŠ .com é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€ç»™ä½ ï¼Œä½ å»é—®é—®å®ƒå§ã€‚&quot;</li>
<li>æœ¬åœ° DNS æ”¶åˆ°é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€åï¼Œå‘èµ·è¯·æ±‚é—®&quot;è€äºŒï¼Œä½ èƒ½å‘Šè¯‰æˆ‘ <a href="http://www.server.com">www.server.com</a>  çš„ IP åœ°å€å—ï¼Ÿ&quot;</li>
<li>é¡¶çº§åŸŸåæœåŠ¡å™¨è¯´ï¼šâ€œæˆ‘ç»™ä½ è´Ÿè´£ <a href="http://www.server.com">www.server.com</a> åŒºåŸŸçš„æƒå¨ DNS æœåŠ¡å™¨çš„åœ°å€ï¼Œä½ å»é—®å®ƒåº”è¯¥èƒ½é—®åˆ°â€ã€‚</li>
<li>æœ¬åœ° DNS äºæ˜¯è½¬å‘é—®æƒå¨ DNS æœåŠ¡å™¨ï¼š&quot;è€ä¸‰ï¼Œ<a href="http://www.server.com">www.server.com</a> å¯¹åº”çš„ IP æ˜¯å•¥å‘€ï¼Ÿ&quot;<a href="http://server.com">server.com</a> çš„æƒå¨ DNS æœåŠ¡å™¨ï¼Œå®ƒæ˜¯åŸŸåè§£æç»“æœçš„åŸå‡ºå¤„ã€‚ä¸ºå•¥å«æƒå¨å‘¢ï¼Ÿå°±æ˜¯æˆ‘çš„åŸŸåæˆ‘åšä¸»ã€‚</li>
<li>æƒå¨ DNS æœåŠ¡å™¨æŸ¥è¯¢åå°†å¯¹åº”çš„ IP åœ°å€ X.X.X.X å‘Šè¯‰æœ¬åœ° DNSã€‚</li>
<li>æœ¬åœ° DNS å†å°† IP åœ°å€è¿”å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å’Œç›®æ ‡å»ºç«‹è¿æ¥ã€‚</li>
</ol>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº† DNS çš„è§£æè¿‡ç¨‹ã€‚ç°åœ¨æ€»ç»“ä¸€ä¸‹ï¼Œæ•´ä¸ªè¿‡ç¨‹æˆ‘ç”»æˆäº†ä¸€ä¸ªå›¾ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003311381.png" alt="1750003311381"></p>
<p>DNS åŸŸåè§£æçš„è¿‡ç¨‹è›®æœ‰æ„æ€çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±å’Œæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­æ‰¾äººé—®è·¯çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œ<strong>åªæŒ‡è·¯ä¸å¸¦è·¯</strong>ã€‚</p>
<blockquote>
<p>é‚£æ˜¯ä¸æ˜¯æ¯æ¬¡è§£æåŸŸåéƒ½è¦ç»è¿‡é‚£ä¹ˆå¤šçš„æ­¥éª¤å‘¢ï¼Ÿ</p>
</blockquote>
<p>å½“ç„¶ä¸æ˜¯äº†ï¼Œè¿˜æœ‰ç¼“å­˜è¿™ä¸ªä¸œè¥¿çš„å˜›ã€‚</p>
<p>æµè§ˆå™¨ä¼šå…ˆçœ‹è‡ªèº«æœ‰æ²¡æœ‰å¯¹è¿™ä¸ªåŸŸåçš„ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å»é—®æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šå»çœ‹è‡ªå·±çš„ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†å» hosts æ–‡ä»¶çœ‹ï¼Œä¹Ÿæ²¡æœ‰ï¼Œæ‰ä¼šå»é—®ã€Œæœ¬åœ° DNS æœåŠ¡å™¨ã€ã€‚</p>
<blockquote>
<p>æ•°æ®åŒ…è¡¨ç¤ºï¼šâ€œDNS è€å¤§å“¥å‰å®³å‘€ï¼Œæ‰¾åˆ°äº†ç›®çš„åœ°äº†ï¼æˆ‘è¿˜æ˜¯å¾ˆè¿·èŒ«å‘€ï¼Œæˆ‘è¦å‘å‡ºå»ï¼Œæ¥ä¸‹æ¥æˆ‘éœ€è¦è°çš„å¸®åŠ©å‘¢ï¼Ÿâ€</p>
</blockquote>
<hr>
<h2 id="æŒ‡å—å¥½å¸®æ‰‹-â€”â€”-åè®®æ ˆ">æŒ‡å—å¥½å¸®æ‰‹ â€”â€” åè®®æ ˆ</h2>
<p>é€šè¿‡ DNS è·å–åˆ° IP åï¼Œå°±å¯ä»¥æŠŠ HTTP çš„ä¼ è¾“å·¥ä½œäº¤ç»™æ“ä½œç³»ç»Ÿä¸­çš„<strong>åè®®æ ˆ</strong>ã€‚</p>
<p>åè®®æ ˆçš„å†…éƒ¨åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ‰¿æ‹…ä¸åŒçš„å·¥ä½œã€‚ä¸Šä¸‹å…³ç³»æ˜¯æœ‰ä¸€å®šçš„è§„åˆ™çš„ï¼Œä¸Šé¢çš„éƒ¨åˆ†ä¼šå‘ä¸‹é¢çš„éƒ¨åˆ†å§”æ‰˜å·¥ä½œï¼Œä¸‹é¢çš„éƒ¨åˆ†æ”¶åˆ°å§”æ‰˜çš„å·¥ä½œå¹¶æ‰§è¡Œã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003319314.png" alt="1750003319314"></p>
<p>åº”ç”¨ç¨‹åºï¼ˆæµè§ˆå™¨ï¼‰é€šè¿‡è°ƒç”¨ Socket åº“ï¼Œæ¥å§”æ‰˜åè®®æ ˆå·¥ä½œã€‚åè®®æ ˆçš„ä¸ŠåŠéƒ¨åˆ†æœ‰ä¸¤å—ï¼Œåˆ†åˆ«æ˜¯è´Ÿè´£æ”¶å‘æ•°æ®çš„ TCP å’Œ UDP åè®®ï¼Œè¿™ä¸¤ä¸ªä¼ è¾“åè®®ä¼šæ¥å—åº”ç”¨å±‚çš„å§”æ‰˜æ‰§è¡Œæ”¶å‘æ•°æ®çš„æ“ä½œã€‚</p>
<p>åè®®æ ˆçš„ä¸‹é¢ä¸€åŠæ˜¯ç”¨ IP åè®®æ§åˆ¶ç½‘ç»œåŒ…æ”¶å‘æ“ä½œï¼Œåœ¨äº’è”ç½‘ä¸Šä¼ æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè¢«åˆ‡åˆ†æˆä¸€å—å—çš„ç½‘ç»œåŒ…ï¼Œè€Œå°†ç½‘ç»œåŒ…å‘é€ç»™å¯¹æ–¹çš„æ“ä½œå°±æ˜¯ç”± IP è´Ÿè´£çš„ã€‚</p>
<p>æ­¤å¤– IP ä¸­è¿˜åŒ…æ‹¬ <code>ICMP</code> åè®®å’Œ <code>ARP</code> åè®®ã€‚</p>
<ul>
<li><code>ICMP</code> ç”¨äºå‘ŠçŸ¥ç½‘ç»œåŒ…ä¼ é€è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é”™è¯¯ä»¥åŠå„ç§æ§åˆ¶ä¿¡æ¯ã€‚</li>
<li><code>ARP</code> ç”¨äºæ ¹æ® IP åœ°å€æŸ¥è¯¢ç›¸åº”çš„ä»¥å¤ªç½‘ MAC åœ°å€ã€‚</li>
</ul>
<p>IP ä¸‹é¢çš„ç½‘å¡é©±åŠ¨ç¨‹åºè´Ÿè´£æ§åˆ¶ç½‘å¡ç¡¬ä»¶ï¼Œè€Œæœ€ä¸‹é¢çš„ç½‘å¡åˆ™è´Ÿè´£å®Œæˆå®é™…çš„æ”¶å‘æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¯¹ç½‘çº¿ä¸­çš„ä¿¡å·æ‰§è¡Œå‘é€å’Œæ¥æ”¶æ“ä½œã€‚</p>
<blockquote>
<p>æ•°æ®åŒ…çœ‹äº†è¿™ä»½æŒ‡å—è¡¨ç¤ºï¼šâ€œåŸæ¥æˆ‘éœ€è¦é‚£ä¹ˆå¤šå¤§ä½¬çš„ååŠ©å•Šï¼Œé‚£æˆ‘å…ˆå»æ‰¾æ‰¾ TCP å¤§ä½¬ï¼â€</p>
</blockquote>
<hr>
<h2 id="å¯é ä¼ è¾“-â€”â€”-TCP">å¯é ä¼ è¾“ â€”â€” TCP</h2>
<p>HTTP æ˜¯åŸºäº TCP åè®®ä¼ è¾“çš„ï¼Œæ‰€ä»¥åœ¨è¿™æˆ‘ä»¬å…ˆäº†è§£ä¸‹ TCP åè®®ã€‚</p>
<blockquote>
<p>TCP åŒ…å¤´æ ¼å¼</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹ TCP æŠ¥æ–‡å¤´éƒ¨çš„æ ¼å¼ï¼š</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003326579.png" alt="1750003326579"></p>
<p>é¦–å…ˆï¼Œ<strong>æºç«¯å£å·</strong>å’Œ<strong>ç›®æ ‡ç«¯å£</strong>å·æ˜¯ä¸å¯å°‘çš„ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸¤ä¸ªç«¯å£å·ï¼Œæ•°æ®å°±ä¸çŸ¥é“åº”è¯¥å‘ç»™å“ªä¸ªåº”ç”¨ã€‚</p>
<p>æ¥ä¸‹æ¥æœ‰åŒ…çš„<strong>åº</strong>å·ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†è§£å†³åŒ…ä¹±åºçš„é—®é¢˜ã€‚</p>
<p>è¿˜æœ‰åº”è¯¥æœ‰çš„æ˜¯<strong>ç¡®è®¤å·</strong>ï¼Œç›®çš„æ˜¯ç¡®è®¤å‘å‡ºå»å¯¹æ–¹æ˜¯å¦æœ‰æ”¶åˆ°ã€‚å¦‚æœæ²¡æœ‰æ”¶åˆ°å°±åº”è¯¥é‡æ–°å‘é€ï¼Œç›´åˆ°é€è¾¾ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜ã€‚</p>
<p>æ¥ä¸‹æ¥è¿˜æœ‰ä¸€äº›<strong>çŠ¶æ€ä½</strong>ã€‚ä¾‹å¦‚ <code>SYN</code> æ˜¯å‘èµ·ä¸€ä¸ªè¿æ¥ï¼Œ<code>ACK</code> æ˜¯å›å¤ï¼Œ<code>RST</code> æ˜¯é‡æ–°è¿æ¥ï¼Œ<code>FIN</code> æ˜¯ç»“æŸè¿æ¥ç­‰ã€‚TCP æ˜¯é¢å‘è¿æ¥çš„ï¼Œå› è€ŒåŒæ–¹è¦ç»´æŠ¤è¿æ¥çš„çŠ¶æ€ï¼Œè¿™äº›å¸¦çŠ¶æ€ä½çš„åŒ…çš„å‘é€ï¼Œä¼šå¼•èµ·åŒæ–¹çš„çŠ¶æ€å˜æ›´ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å°±æ˜¯<strong>çª—å£å¤§å°</strong>ã€‚TCP è¦åš<strong>æµé‡æ§åˆ¶</strong>ï¼Œé€šä¿¡åŒæ–¹å„å£°æ˜ä¸€ä¸ªçª—å£ï¼ˆç¼“å­˜å¤§å°ï¼‰ï¼Œæ ‡è¯†è‡ªå·±å½“å‰èƒ½å¤Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œåˆ«å‘é€çš„å¤ªå¿«ï¼Œæ’‘æ­»æˆ‘ï¼Œä¹Ÿåˆ«å‘çš„å¤ªæ…¢ï¼Œé¥¿æ­»æˆ‘ã€‚</p>
<p>é™¤äº†åšæµé‡æ§åˆ¶ä»¥å¤–ï¼ŒTCP è¿˜ä¼šåš<strong>æ‹¥å¡æ§åˆ¶</strong>ï¼Œå¯¹äºçœŸæ­£çš„é€šè·¯å µè½¦ä¸å µè½¦ï¼Œå®ƒæ— èƒ½ä¸ºåŠ›ï¼Œå”¯ä¸€èƒ½åšçš„å°±æ˜¯æ§åˆ¶è‡ªå·±ï¼Œä¹Ÿå³æ§åˆ¶å‘é€çš„é€Ÿåº¦ã€‚ä¸èƒ½æ”¹å˜ä¸–ç•Œï¼Œå°±æ”¹å˜è‡ªå·±å˜›ã€‚</p>
<blockquote>
<p>TCP ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œè¦å…ˆä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</p>
</blockquote>
<p>åœ¨ HTTP ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦ TCP å»ºç«‹è¿æ¥ï¼ŒTCP è¿æ¥çš„å»ºç«‹ï¼Œé€šå¸¸ç§°ä¸º<strong>ä¸‰æ¬¡æ¡æ‰‹</strong>ã€‚</p>
<p>è¿™ä¸ªæ‰€è°“çš„ã€Œè¿æ¥ã€ï¼Œåªæ˜¯åŒæ–¹è®¡ç®—æœºé‡Œç»´æŠ¤ä¸€ä¸ªçŠ¶æ€æœºï¼Œåœ¨è¿æ¥å»ºç«‹çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹çš„çŠ¶æ€å˜åŒ–æ—¶åºå›¾å°±åƒè¿™æ ·ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003334236.png" alt="1750003334236"></p>
<ul>
<li>
<p>ä¸€å¼€å§‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¤„äº <code>CLOSED</code> çŠ¶æ€ã€‚å…ˆæ˜¯æœåŠ¡ç«¯ä¸»åŠ¨ç›‘å¬æŸä¸ªç«¯å£ï¼Œå¤„äº <code>LISTEN</code> çŠ¶æ€ã€‚</p>
</li>
<li>
<p>ç„¶åå®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¿æ¥ <code>SYN</code>ï¼Œä¹‹åå¤„äº <code>SYN-SENT</code> çŠ¶æ€ã€‚</p>
</li>
<li>
<p>æœåŠ¡ç«¯æ”¶åˆ°å‘èµ·çš„è¿æ¥ï¼Œè¿”å› <code>SYN</code>ï¼Œå¹¶ä¸” <code>ACK</code> å®¢æˆ·ç«¯çš„ <code>SYN</code>ï¼Œä¹‹åå¤„äº <code>SYN-RCVD</code> çŠ¶æ€ã€‚</p>
</li>
<li>
<p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„ <code>SYN</code> å’Œ <code>ACK</code> ä¹‹åï¼Œå‘é€å¯¹ <code>SYN</code> ç¡®è®¤çš„ <code>ACK</code>ï¼Œä¹‹åå¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œå› ä¸ºå®ƒä¸€å‘ä¸€æ”¶æˆåŠŸäº†ã€‚</p>
</li>
<li>
<p>æœåŠ¡ç«¯æ”¶åˆ° <code>ACK</code> çš„ <code>ACK</code> ä¹‹åï¼Œå¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œå› ä¸ºå®ƒä¹Ÿä¸€å‘ä¸€æ”¶äº†ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹ç›®çš„æ˜¯<strong>ä¿è¯åŒæ–¹éƒ½æœ‰å‘é€å’Œæ¥æ”¶çš„èƒ½åŠ›</strong>ã€‚</p>
<blockquote>
<p>å¦‚ä½•æŸ¥çœ‹ TCP çš„è¿æ¥çŠ¶æ€ï¼Ÿ</p>
</blockquote>
<p>TCP çš„è¿æ¥çŠ¶æ€æŸ¥çœ‹ï¼Œåœ¨ Linux å¯ä»¥é€šè¿‡ <code>netstat -napt</code> å‘½ä»¤æŸ¥çœ‹ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003354831.png" alt="1750003354831"></p>
<blockquote>
<p>TCP åˆ†å‰²æ•°æ®</p>
</blockquote>
<p>å¦‚æœ HTTP è¯·æ±‚æ¶ˆæ¯æ¯”è¾ƒé•¿ï¼Œè¶…è¿‡äº† <code>MSS</code> çš„é•¿åº¦ï¼Œè¿™æ—¶ TCP å°±éœ€è¦æŠŠ HTTP çš„æ•°æ®æ‹†è§£æˆä¸€å—å—çš„æ•°æ®å‘é€ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æ•°æ®ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003586972.png" alt="1750003586972"></p>
<ul>
<li><code>MTU</code>ï¼šä¸€ä¸ªç½‘ç»œåŒ…çš„æœ€å¤§é•¿åº¦ï¼Œä»¥å¤ªç½‘ä¸­ä¸€èˆ¬ä¸º <code>1500</code> å­—èŠ‚ã€‚</li>
<li><code>MSS</code>ï¼šé™¤å» IP å’Œ TCP å¤´éƒ¨ä¹‹åï¼Œä¸€ä¸ªç½‘ç»œåŒ…æ‰€èƒ½å®¹çº³çš„ TCP æ•°æ®çš„æœ€å¤§é•¿åº¦ã€‚</li>
</ul>
<p>æ•°æ®ä¼šè¢«ä»¥ <code>MSS</code> çš„é•¿åº¦ä¸ºå•ä½è¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†å‡ºæ¥çš„æ¯ä¸€å—æ•°æ®éƒ½ä¼šè¢«æ”¾è¿›å•ç‹¬çš„ç½‘ç»œåŒ…ä¸­ã€‚ä¹Ÿå°±æ˜¯åœ¨æ¯ä¸ªè¢«æ‹†åˆ†çš„æ•°æ®åŠ ä¸Š TCP å¤´ä¿¡æ¯ï¼Œç„¶åäº¤ç»™ IP æ¨¡å—æ¥å‘é€æ•°æ®ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003609298.png" alt="1750003609298"></p>
<blockquote>
<p>TCP æŠ¥æ–‡ç”Ÿæˆ</p>
</blockquote>
<p>TCP åè®®é‡Œé¢ä¼šæœ‰ä¸¤ä¸ªç«¯å£ï¼Œä¸€ä¸ªæ˜¯æµè§ˆå™¨ç›‘å¬çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯éšæœºç”Ÿæˆçš„ï¼‰ï¼Œä¸€ä¸ªæ˜¯ Web æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ï¼ˆHTTP é»˜è®¤ç«¯å£å·æ˜¯ <code>80</code>ï¼ŒHTTPS é»˜è®¤ç«¯å£å·æ˜¯ <code>443</code>ï¼‰ã€‚</p>
<p>åœ¨åŒæ–¹å»ºç«‹äº†è¿æ¥åï¼ŒTCP æŠ¥æ–‡ä¸­çš„æ•°æ®éƒ¨åˆ†å°±æ˜¯å­˜æ”¾ HTTP å¤´éƒ¨ + æ•°æ®ï¼Œç»„è£…å¥½ TCP æŠ¥æ–‡ä¹‹åï¼Œå°±éœ€äº¤ç»™ä¸‹é¢çš„ç½‘ç»œå±‚å¤„ç†ã€‚</p>
<p>è‡³æ­¤ï¼Œç½‘ç»œåŒ…çš„æŠ¥æ–‡å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003618461.png" alt="1750003618461"></p>
<blockquote>
<p>æ­¤æ—¶ï¼Œé‡ä¸Šäº† TCP çš„  æ•°æ®åŒ…æ¿€åŠ¨è¡¨ç¤ºï¼šâ€œå¤ªå¥½äº†ï¼Œç¢°åˆ°äº†å¯é ä¼ è¾“çš„ TCP ä¼ è¾“ï¼Œå®ƒç»™æˆ‘åŠ ä¸Š TCP å¤´éƒ¨ï¼Œæˆ‘ä¸å†å­¤å•äº†ï¼Œå®‰å…¨æ„Ÿåè¶³å•Šï¼æœ‰å¤§ä½¬å¯ä»¥ä¿æŠ¤æˆ‘çš„å¯é é€è¾¾ï¼ä½†æˆ‘åº”è¯¥å¾€å“ªèµ°å‘¢ï¼Ÿâ€</p>
</blockquote>
<hr>
<h2 id="è¿œç¨‹å®šä½-â€”â€”-IP">è¿œç¨‹å®šä½ â€”â€” IP</h2>
<p>TCP æ¨¡å—åœ¨æ‰§è¡Œè¿æ¥ã€æ”¶å‘ã€æ–­å¼€ç­‰å„é˜¶æ®µæ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å§”æ‰˜ IP æ¨¡å—å°†æ•°æ®å°è£…æˆ<strong>ç½‘ç»œåŒ…</strong>å‘é€ç»™é€šä¿¡å¯¹è±¡ã€‚</p>
<blockquote>
<p>IP åŒ…å¤´æ ¼å¼</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹ IP æŠ¥æ–‡å¤´éƒ¨çš„æ ¼å¼ï¼š</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003628441.png" alt="1750003628441"></p>
<p>åœ¨ IP åè®®é‡Œé¢éœ€è¦æœ‰<strong>æºåœ°å€ IP</strong> å’Œ <strong>ç›®æ ‡åœ°å€ IP</strong>ï¼š</p>
<ul>
<li>æºåœ°å€ IPï¼Œå³æ˜¯å®¢æˆ·ç«¯è¾“å‡ºçš„ IP åœ°å€ï¼›</li>
<li>ç›®æ ‡åœ°å€ï¼Œå³é€šè¿‡ DNS åŸŸåè§£æå¾—åˆ°çš„ Web æœåŠ¡å™¨ IPã€‚</li>
</ul>
<p>å› ä¸º HTTP æ˜¯ç»è¿‡ TCP ä¼ è¾“çš„ï¼Œæ‰€ä»¥åœ¨ IP åŒ…å¤´çš„<strong>åè®®å·</strong>ï¼Œè¦å¡«å†™ä¸º <code>06</code>ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼Œè¡¨ç¤ºåè®®ä¸º TCPã€‚</p>
<blockquote>
<p>å‡è®¾å®¢æˆ·ç«¯æœ‰å¤šä¸ªç½‘å¡ï¼Œå°±ä¼šæœ‰å¤šä¸ª IP åœ°å€ï¼Œé‚£ IP å¤´éƒ¨çš„æºåœ°å€åº”è¯¥é€‰æ‹©å“ªä¸ª IP å‘¢ï¼Ÿ</p>
</blockquote>
<p>å½“å­˜åœ¨å¤šä¸ªç½‘å¡æ—¶ï¼Œåœ¨å¡«å†™æºåœ°å€ IP æ—¶ï¼Œå°±éœ€è¦åˆ¤æ–­åˆ°åº•åº”è¯¥å¡«å†™å“ªä¸ªåœ°å€ã€‚è¿™ä¸ªåˆ¤æ–­ç›¸å½“äºåœ¨å¤šå—ç½‘å¡ä¸­åˆ¤æ–­åº”è¯¥ä½¿ç”¨å“ªä¸ªä¸€å—ç½‘å¡æ¥å‘é€åŒ…ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ ¹æ®<strong>è·¯ç”±è¡¨</strong>è§„åˆ™ï¼Œæ¥åˆ¤æ–­å“ªä¸€ä¸ªç½‘å¡ä½œä¸ºæºåœ°å€ IPã€‚</p>
<p>åœ¨ Linux æ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>route -n</code> å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„è·¯ç”±è¡¨ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003637280.png" alt="1750003637280"></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ ¹æ®ä¸Šé¢çš„è·¯ç”±è¡¨ï¼Œæˆ‘ä»¬å‡è®¾ Web æœåŠ¡å™¨çš„ç›®æ ‡åœ°å€æ˜¯ <code>192.168.10.200</code>ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003642953.png" alt="1750003642953"></p>
<ol>
<li>é¦–å…ˆå…ˆå’Œç¬¬ä¸€æ¡ç›®çš„å­ç½‘æ©ç ï¼ˆ<code>Genmask</code>ï¼‰è¿›è¡Œ <strong>ä¸è¿ç®—</strong>ï¼Œå¾—åˆ°ç»“æœä¸º <code>192.168.10.0</code>ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ¡ç›®çš„ <code>Destination</code> æ˜¯ <code>192.168.3.0</code>ï¼Œä¸¤è€…ä¸ä¸€è‡´æ‰€ä»¥åŒ¹é…å¤±è´¥ã€‚</li>
<li>å†ä¸ç¬¬äºŒæ¡ç›®çš„å­ç½‘æ©ç è¿›è¡Œ <strong>ä¸è¿ç®—</strong>ï¼Œå¾—åˆ°çš„ç»“æœä¸º <code>192.168.10.0</code>ï¼Œä¸ç¬¬äºŒæ¡ç›®çš„ <code>Destination 192.168.10.0</code> åŒ¹é…æˆåŠŸï¼Œæ‰€ä»¥å°†ä½¿ç”¨ <code>eth1</code> ç½‘å¡çš„ IP åœ°å€ä½œä¸º IP åŒ…å¤´çš„æºåœ°å€ã€‚</li>
</ol>
<p>é‚£ä¹ˆå‡è®¾ Web æœåŠ¡å™¨çš„ç›®æ ‡åœ°å€æ˜¯ <code>10.100.20.100</code>ï¼Œé‚£ä¹ˆä¾ç„¶ä¾ç…§ä¸Šé¢çš„è·¯ç”±è¡¨è§„åˆ™åˆ¤æ–­ï¼Œåˆ¤æ–­åçš„ç»“æœæ˜¯å’Œç¬¬ä¸‰æ¡ç›®åŒ¹é…ã€‚</p>
<p>ç¬¬ä¸‰æ¡ç›®æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒç›®æ ‡åœ°å€å’Œå­ç½‘æ©ç éƒ½æ˜¯ <code>0.0.0.0</code>ï¼Œè¿™è¡¨ç¤º<strong>é»˜è®¤ç½‘å…³</strong>ï¼Œå¦‚æœå…¶ä»–æ‰€æœ‰æ¡ç›®éƒ½æ— æ³•åŒ¹é…ï¼Œå°±ä¼šè‡ªåŠ¨åŒ¹é…è¿™ä¸€è¡Œã€‚å¹¶ä¸”åç»­å°±æŠŠåŒ…å‘ç»™è·¯ç”±å™¨ï¼Œ<code>Gateway</code> å³æ˜¯è·¯ç”±å™¨çš„ IP åœ°å€ã€‚</p>
<blockquote>
<p>IP æŠ¥æ–‡ç”Ÿæˆ</p>
</blockquote>
<p>è‡³æ­¤ï¼Œç½‘ç»œåŒ…çš„æŠ¥æ–‡å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003651638.png" alt="1750003651638"></p>
<blockquote>
<p>æ­¤æ—¶ï¼ŒåŠ ä¸Šäº† IP å¤´éƒ¨çš„æ•°æ®åŒ…è¡¨ç¤ºï¼šâ€œæœ‰ IP å¤§ä½¬ç»™æˆ‘æŒ‡è·¯äº†ï¼Œæ„Ÿè°¢ IP å±‚ç»™æˆ‘åŠ ä¸Šäº† IP åŒ…å¤´ï¼Œè®©æˆ‘æœ‰äº†è¿œç¨‹å®šä½çš„èƒ½åŠ›ï¼Œä¸ä¼šå®³æ€•åœ¨æµ©ç€šçš„äº’è”ç½‘è¿·èŒ«äº†ï¼å¯æ˜¯ç›®çš„åœ°å¥½è¿œå•Šï¼Œæˆ‘ä¸‹ä¸€ç«™åº”è¯¥å»å“ªå‘¢ï¼Ÿâ€</p>
</blockquote>
<hr>
<h2 id="ä¸¤ç‚¹ä¼ è¾“-â€”â€”-MAC">ä¸¤ç‚¹ä¼ è¾“ â€”â€” MAC</h2>
<p>ç”Ÿæˆäº† IP å¤´éƒ¨ä¹‹åï¼Œæ¥ä¸‹æ¥ç½‘ç»œåŒ…è¿˜éœ€è¦åœ¨ IP å¤´éƒ¨çš„å‰é¢åŠ ä¸Š <strong>MAC å¤´éƒ¨</strong>ã€‚</p>
<blockquote>
<p>MAC åŒ…å¤´æ ¼å¼</p>
</blockquote>
<p>MAC å¤´éƒ¨æ˜¯ä»¥å¤ªç½‘ä½¿ç”¨çš„å¤´éƒ¨ï¼Œå®ƒåŒ…å«äº†æ¥æ”¶æ–¹å’Œå‘é€æ–¹çš„ MAC åœ°å€ç­‰ä¿¡æ¯ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003662249.png" alt="1750003662249"></p>
<p>åœ¨ MAC åŒ…å¤´é‡Œéœ€è¦<strong>å‘é€æ–¹ MAC åœ°å€</strong>å’Œ<strong>æ¥æ”¶æ–¹ç›®æ ‡ MAC åœ°å€</strong>ï¼Œç”¨äº<strong>ä¸¤ç‚¹ä¹‹é—´çš„ä¼ è¾“</strong>ã€‚</p>
<p>ä¸€èˆ¬åœ¨ TCP/IP é€šä¿¡é‡Œï¼ŒMAC åŒ…å¤´çš„<strong>åè®®ç±»å‹</strong>åªä½¿ç”¨ï¼š</p>
<ul>
<li><code>0800</code> ï¼šIP åè®®</li>
<li><code>0806</code> ï¼šARP åè®®</li>
</ul>
<blockquote>
<p>MAC å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¦‚ä½•ç¡®è®¤ï¼Ÿ</p>
</blockquote>
<p><strong>å‘é€æ–¹</strong>çš„ MAC åœ°å€è·å–å°±æ¯”è¾ƒç®€å•äº†ï¼ŒMAC åœ°å€æ˜¯åœ¨ç½‘å¡ç”Ÿäº§æ—¶å†™å…¥åˆ° ROM é‡Œçš„ï¼Œåªè¦å°†è¿™ä¸ªå€¼è¯»å–å‡ºæ¥å†™å…¥åˆ° MAC å¤´éƒ¨å°±å¯ä»¥äº†ã€‚</p>
<p><strong>æ¥æ”¶æ–¹</strong>çš„ MAC åœ°å€å°±æœ‰ç‚¹å¤æ‚äº†ï¼Œåªè¦å‘Šè¯‰ä»¥å¤ªç½‘å¯¹æ–¹çš„ MAC çš„åœ°å€ï¼Œä»¥å¤ªç½‘å°±ä¼šå¸®æˆ‘ä»¬æŠŠåŒ…å‘é€è¿‡å»ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶è¿™é‡Œåº”è¯¥å¡«å†™å¯¹æ–¹çš„ MAC åœ°å€ã€‚</p>
<p>æ‰€ä»¥å…ˆå¾—ææ¸…æ¥šåº”è¯¥æŠŠåŒ…å‘ç»™è°ï¼Œè¿™ä¸ªåªè¦æŸ¥ä¸€ä¸‹<strong>è·¯ç”±è¡¨</strong>å°±çŸ¥é“äº†ã€‚åœ¨è·¯ç”±è¡¨ä¸­æ‰¾åˆ°ç›¸åŒ¹é…çš„æ¡ç›®ï¼Œç„¶åæŠŠåŒ…å‘ç»™ <code>Gateway</code> åˆ—ä¸­çš„ IP åœ°å€å°±å¯ä»¥äº†ã€‚</p>
<blockquote>
<p>æ—¢ç„¶çŸ¥é“è¦å‘ç»™è°ï¼Œé‚£å¦‚ä½•è·å–å¯¹æ–¹çš„ MAC åœ°å€å‘¢ï¼Ÿ</p>
</blockquote>
<p>ä¸çŸ¥é“å¯¹æ–¹ MAC åœ°å€ï¼Ÿä¸çŸ¥é“å°±å–Šå‘—ã€‚</p>
<p>æ­¤æ—¶å°±éœ€è¦ <code>ARP</code> åè®®å¸®æˆ‘ä»¬æ‰¾åˆ°è·¯ç”±å™¨çš„ MAC åœ°å€ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003669410.png" alt="1750003669410"></p>
<p>ARP åè®®ä¼šåœ¨ä»¥å¤ªç½‘ä¸­ä»¥<strong>å¹¿æ’­</strong>çš„å½¢å¼ï¼Œå¯¹ä»¥å¤ªç½‘æ‰€æœ‰çš„è®¾å¤‡å–Šå‡ºï¼šâ€œè¿™ä¸ª IP åœ°å€æ˜¯è°çš„ï¼Ÿè¯·æŠŠä½ çš„ MAC åœ°å€å‘Šè¯‰æˆ‘â€ã€‚</p>
<p>ç„¶åå°±ä¼šæœ‰äººå›ç­”ï¼šâ€œè¿™ä¸ª IP åœ°å€æ˜¯æˆ‘çš„ï¼Œæˆ‘çš„ MAC åœ°å€æ˜¯ XXXXâ€ã€‚</p>
<p>å¦‚æœå¯¹æ–¹å’Œè‡ªå·±å¤„äºåŒä¸€ä¸ªå­ç½‘ä¸­ï¼Œé‚£ä¹ˆé€šè¿‡ä¸Šé¢çš„æ“ä½œå°±å¯ä»¥å¾—åˆ°å¯¹æ–¹çš„ MAC åœ°å€ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¿™ä¸ª MAC åœ°å€å†™å…¥ MAC å¤´éƒ¨ï¼ŒMAC å¤´éƒ¨å°±å®Œæˆäº†ã€‚</p>
<blockquote>
<p>å¥½åƒæ¯æ¬¡éƒ½è¦å¹¿æ’­è·å–ï¼Œè¿™ä¸æ˜¯å¾ˆéº»çƒ¦å—ï¼Ÿ</p>
</blockquote>
<p>æ”¾å¿ƒï¼Œåœ¨åç»­æ“ä½œç³»ç»Ÿä¼šæŠŠæœ¬æ¬¡æŸ¥è¯¢ç»“æœæ”¾åˆ°ä¸€å—å«åš <strong>ARP ç¼“å­˜</strong>çš„å†…å­˜ç©ºé—´ç•™ç€ä»¥åç”¨ï¼Œä¸è¿‡ç¼“å­˜çš„æ—¶é—´å°±å‡ åˆ†é’Ÿã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‘åŒ…æ—¶ï¼š</p>
<ul>
<li>å…ˆæŸ¥è¯¢ ARP ç¼“å­˜ï¼Œå¦‚æœå…¶ä¸­å·²ç»ä¿å­˜äº†å¯¹æ–¹çš„ MAC åœ°å€ï¼Œå°±ä¸éœ€è¦å‘é€ ARP æŸ¥è¯¢ï¼Œç›´æ¥ä½¿ç”¨ ARP ç¼“å­˜ä¸­çš„åœ°å€ã€‚</li>
<li>è€Œå½“ ARP ç¼“å­˜ä¸­ä¸å­˜åœ¨å¯¹æ–¹ MAC åœ°å€æ—¶ï¼Œåˆ™å‘é€ ARP å¹¿æ’­æŸ¥è¯¢ã€‚</li>
</ul>
<blockquote>
<p>æŸ¥çœ‹ ARP ç¼“å­˜å†…å®¹</p>
</blockquote>
<p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>arp -a</code> å‘½ä»¤æ¥æŸ¥çœ‹ ARP ç¼“å­˜çš„å†…å®¹ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003677846.png" alt="1750003677846"></p>
<blockquote>
<p>MAC æŠ¥æ–‡ç”Ÿæˆ</p>
</blockquote>
<p>è‡³æ­¤ï¼Œç½‘ç»œåŒ…çš„æŠ¥æ–‡å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003686373.png" alt="1750003686373"></p>
<blockquote>
<p>æ­¤æ—¶ï¼ŒåŠ ä¸Šäº† MAC å¤´éƒ¨çš„æ•°æ®åŒ…ä¸‡åˆ†æ„Ÿè°¢ï¼Œè¯´é“ï¼šâ€œæ„Ÿè°¢ MAC å¤§ä½¬ï¼Œæˆ‘çŸ¥é“æˆ‘ä¸‹ä¸€æ­¥è¦å»å“ªäº†ï¼æˆ‘ç°åœ¨æœ‰å¾ˆå¤šå¤´éƒ¨å…„å¼Ÿï¼Œç›¸ä¿¡æˆ‘å¯ä»¥åˆ°è¾¾æœ€ç»ˆçš„ç›®çš„åœ°ï¼â€ã€‚<br>
å¸¦ç€ä¼—å¤šå¤´éƒ¨å…„å¼Ÿçš„æ•°æ®åŒ…ï¼Œç»ˆäºå‡†å¤‡è¦å‡ºé—¨äº†ã€‚</p>
</blockquote>
<hr>
<h2 id="å‡ºå£-â€”â€”-ç½‘å¡">å‡ºå£ â€”â€” ç½‘å¡</h2>
<p>ç½‘ç»œåŒ…åªæ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ä¸€ä¸²äºŒè¿›åˆ¶æ•°å­—ä¿¡æ¯ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥å‘é€ç»™å¯¹æ–¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†<strong>æ•°å­—ä¿¡æ¯è½¬æ¢ä¸ºç”µä¿¡å·</strong>ï¼Œæ‰èƒ½åœ¨ç½‘çº¿ä¸Šä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„æ•°æ®å‘é€è¿‡ç¨‹ã€‚</p>
<p>è´Ÿè´£æ‰§è¡Œè¿™ä¸€æ“ä½œçš„æ˜¯<strong>ç½‘å¡</strong>ï¼Œè¦æ§åˆ¶ç½‘å¡è¿˜éœ€è¦é <strong>ç½‘å¡é©±åŠ¨ç¨‹åº</strong>ã€‚</p>
<p>ç½‘å¡é©±åŠ¨è·å–ç½‘ç»œåŒ…ä¹‹åï¼Œä¼šå°†å…¶<strong>å¤åˆ¶</strong>åˆ°ç½‘å¡å†…çš„ç¼“å­˜åŒºä¸­ï¼Œæ¥ç€ä¼šåœ¨å…¶<strong>å¼€å¤´åŠ ä¸ŠæŠ¥å¤´å’Œèµ·å§‹å¸§åˆ†ç•Œç¬¦ï¼Œåœ¨æœ«å°¾åŠ ä¸Šç”¨äºæ£€æµ‹é”™è¯¯çš„å¸§æ ¡éªŒåºåˆ—</strong>ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003422881.png" alt="1750003422881"></p>
<ul>
<li>èµ·å§‹å¸§åˆ†ç•Œç¬¦æ˜¯ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºåŒ…èµ·å§‹ä½ç½®çš„æ ‡è®°</li>
<li>æœ«å°¾çš„ <code>FCS</code>ï¼ˆå¸§æ ¡éªŒåºåˆ—ï¼‰ç”¨æ¥æ£€æŸ¥åŒ…ä¼ è¾“è¿‡ç¨‹æ˜¯å¦æœ‰æŸå</li>
</ul>
<p>æœ€åç½‘å¡ä¼šå°†åŒ…è½¬ä¸ºç”µä¿¡å·ï¼Œé€šè¿‡ç½‘çº¿å‘é€å‡ºå»ã€‚</p>
<blockquote>
<p>å”‰ï¼ŒçœŸæ˜¯ä¸å®¹æ˜“ï¼Œå‘ä¸€ä¸ªåŒ…ï¼ŒçœŸæ˜¯å†ç»åƒè¾›ä¸‡è‹¦ã€‚è‡´æ­¤ï¼Œä¸€ä¸ªå¸¦æœ‰è®¸å¤šå¤´éƒ¨çš„æ•°æ®ç»ˆäºè¸ä¸Šå¯»æ‰¾ç›®çš„åœ°çš„å¾é€”äº†ï¼</p>
</blockquote>
<hr>
<h2 id="é€åˆ«è€…-â€”â€”-äº¤æ¢æœº">é€åˆ«è€… â€”â€” äº¤æ¢æœº</h2>
<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹åŒ…æ˜¯å¦‚ä½•é€šè¿‡äº¤æ¢æœºçš„ã€‚äº¤æ¢æœºçš„è®¾è®¡æ˜¯å°†ç½‘ç»œåŒ…<strong>åŸæ ·</strong>è½¬å‘åˆ°ç›®çš„åœ°ã€‚äº¤æ¢æœºå·¥ä½œåœ¨ MAC å±‚ï¼Œä¹Ÿç§°ä¸º<strong>äºŒå±‚ç½‘ç»œè®¾å¤‡</strong>ã€‚</p>
<blockquote>
<p>äº¤æ¢æœºçš„åŒ…æ¥æ”¶æ“ä½œ</p>
</blockquote>
<p>é¦–å…ˆï¼Œç”µä¿¡å·åˆ°è¾¾ç½‘çº¿æ¥å£ï¼Œäº¤æ¢æœºé‡Œçš„æ¨¡å—è¿›è¡Œæ¥æ”¶ï¼Œæ¥ä¸‹æ¥äº¤æ¢æœºé‡Œçš„æ¨¡å—å°†ç”µä¿¡å·è½¬æ¢ä¸ºæ•°å­—ä¿¡å·ã€‚</p>
<p>ç„¶åé€šè¿‡åŒ…æœ«å°¾çš„ <code>FCS</code> æ ¡éªŒé”™è¯¯ï¼Œå¦‚æœæ²¡é—®é¢˜åˆ™æ”¾åˆ°ç¼“å†²åŒºã€‚è¿™éƒ¨åˆ†æ“ä½œåŸºæœ¬å’Œè®¡ç®—æœºçš„ç½‘å¡ç›¸åŒï¼Œä½†äº¤æ¢æœºçš„å·¥ä½œæ–¹å¼å’Œç½‘å¡ä¸åŒã€‚</p>
<p>è®¡ç®—æœºçš„ç½‘å¡æœ¬èº«å…·æœ‰ MAC åœ°å€ï¼Œå¹¶é€šè¿‡æ ¸å¯¹æ”¶åˆ°çš„åŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€åˆ¤æ–­æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„ï¼Œå¦‚æœä¸æ˜¯å‘ç»™è‡ªå·±çš„åˆ™ä¸¢å¼ƒï¼›ç›¸å¯¹åœ°ï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸æ ¸å¯¹æ¥æ”¶æ–¹ MAC åœ°å€ï¼Œè€Œæ˜¯ç›´æ¥æ¥æ”¶æ‰€æœ‰çš„åŒ…å¹¶å­˜æ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚å› æ­¤ï¼Œå’Œç½‘å¡ä¸åŒï¼Œ<strong>äº¤æ¢æœºçš„ç«¯å£ä¸å…·æœ‰ MAC åœ°å€</strong>ã€‚</p>
<p>å°†åŒ…å­˜å…¥ç¼“å†²åŒºåï¼Œæ¥ä¸‹æ¥éœ€è¦æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªåŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€æ˜¯å¦å·²ç»åœ¨ MAC åœ°å€è¡¨ä¸­æœ‰è®°å½•äº†ã€‚</p>
<p>äº¤æ¢æœºçš„ MAC åœ°å€è¡¨ä¸»è¦åŒ…å«ä¸¤ä¸ªä¿¡æ¯ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ˜¯è®¾å¤‡çš„ MAC åœ°å€ï¼Œ</li>
<li>å¦ä¸€ä¸ªæ˜¯è¯¥è®¾å¤‡è¿æ¥åœ¨äº¤æ¢æœºçš„å“ªä¸ªç«¯å£ä¸Šã€‚</li>
</ul>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003709687.png" alt="1750003709687"></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ”¶åˆ°çš„åŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€ä¸º <code>00-02-B3-1C-9C-F9</code>ï¼Œåˆ™ä¸å›¾ä¸­è¡¨ä¸­çš„ç¬¬ 3 è¡ŒåŒ¹é…ï¼Œæ ¹æ®ç«¯å£åˆ—çš„ä¿¡æ¯ï¼Œå¯çŸ¥è¿™ä¸ªåœ°å€ä½äº <code>3</code> å·ç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡äº¤æ¢ç”µè·¯å°†åŒ…å‘é€åˆ°ç›¸åº”çš„ç«¯å£äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>äº¤æ¢æœºæ ¹æ® MAC åœ°å€è¡¨æŸ¥æ‰¾ MAC åœ°å€ï¼Œç„¶åå°†ä¿¡å·å‘é€åˆ°ç›¸åº”çš„ç«¯å£</strong>ã€‚</p>
<blockquote>
<p>å½“ MAC åœ°å€è¡¨æ‰¾ä¸åˆ°æŒ‡å®šçš„ MAC åœ°å€ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>
</blockquote>
<p>åœ°å€è¡¨ä¸­æ‰¾ä¸åˆ°æŒ‡å®šçš„ MAC åœ°å€ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºå…·æœ‰è¯¥åœ°å€çš„è®¾å¤‡è¿˜æ²¡æœ‰å‘äº¤æ¢æœºå‘é€è¿‡åŒ…ï¼Œæˆ–è€…è¿™ä¸ªè®¾å¤‡ä¸€æ®µæ—¶é—´æ²¡æœ‰å·¥ä½œå¯¼è‡´åœ°å€è¢«ä»åœ°å€è¡¨ä¸­åˆ é™¤äº†ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ— æ³•åˆ¤æ–­åº”è¯¥æŠŠåŒ…è½¬å‘åˆ°å“ªä¸ªç«¯å£ï¼Œåªèƒ½å°†åŒ…è½¬å‘åˆ°é™¤äº†æºç«¯å£ä¹‹å¤–çš„æ‰€æœ‰ç«¯å£ä¸Šï¼Œæ— è®ºè¯¥è®¾å¤‡è¿æ¥åœ¨å“ªä¸ªç«¯å£ä¸Šéƒ½èƒ½æ”¶åˆ°è¿™ä¸ªåŒ…ã€‚</p>
<p>è¿™æ ·åšä¸ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºä»¥å¤ªç½‘çš„è®¾è®¡æœ¬æ¥å°±æ˜¯å°†åŒ…å‘é€åˆ°æ•´ä¸ªç½‘ç»œçš„ï¼Œç„¶å<strong>åªæœ‰ç›¸åº”çš„æ¥æ”¶è€…æ‰æ¥æ”¶åŒ…ï¼Œè€Œå…¶ä»–è®¾å¤‡åˆ™ä¼šå¿½ç•¥è¿™ä¸ªåŒ…</strong>ã€‚</p>
<p>æœ‰äººä¼šè¯´ï¼šâ€œè¿™æ ·åšä¼šå‘é€å¤šä½™çš„åŒ…ï¼Œä¼šä¸ä¼šé€ æˆç½‘ç»œæ‹¥å¡å‘¢ï¼Ÿâ€</p>
<p>å…¶å®å®Œå…¨ä¸ç”¨è¿‡äºæ‹…å¿ƒï¼Œå› ä¸ºå‘é€äº†åŒ…ä¹‹åç›®æ ‡è®¾å¤‡ä¼šä½œå‡ºå“åº”ï¼Œåªè¦è¿”å›äº†å“åº”åŒ…ï¼Œäº¤æ¢æœºå°±å¯ä»¥å°†å®ƒçš„åœ°å€å†™å…¥ MAC åœ°å€è¡¨ï¼Œä¸‹æ¬¡ä¹Ÿå°±ä¸éœ€è¦æŠŠåŒ…å‘åˆ°æ‰€æœ‰ç«¯å£äº†ã€‚</p>
<p>å±€åŸŸç½‘ä¸­æ¯ç§’å¯ä»¥ä¼ è¾“ä¸Šåƒä¸ªåŒ…ï¼Œå¤šå‡ºä¸€ä¸¤ä¸ªåŒ…å¹¶æ— å¤§ç¢ã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœæ¥æ”¶æ–¹ MAC åœ°å€æ˜¯ä¸€ä¸ª<strong>å¹¿æ’­åœ°å€</strong>ï¼Œé‚£ä¹ˆäº¤æ¢æœºä¼šå°†åŒ…å‘é€åˆ°é™¤æºç«¯å£ä¹‹å¤–çš„æ‰€æœ‰ç«¯å£ã€‚</p>
<p>ä»¥ä¸‹ä¸¤ä¸ªå±äºå¹¿æ’­åœ°å€ï¼š</p>
<ul>
<li>MAC åœ°å€ä¸­çš„ <code>FF:FF:FF:FF:FF:FF</code></li>
<li>IP åœ°å€ä¸­çš„ <code>255.255.255.255</code></li>
</ul>
<blockquote>
<p>æ•°æ®åŒ…é€šè¿‡äº¤æ¢æœºè½¬å‘æŠµè¾¾äº†è·¯ç”±å™¨ï¼Œå‡†å¤‡è¦ç¦»å¼€åœŸç”ŸåœŸé•¿çš„å­ç½‘äº†ã€‚æ­¤æ—¶ï¼Œæ•°æ®åŒ…å’Œäº¤æ¢æœºç¦»åˆ«æ—¶è¯´é“ï¼šâ€œæ„Ÿè°¢äº¤æ¢æœºå…„å¼Ÿï¼Œå¸®æˆ‘è½¬å‘åˆ°å‡ºå¢ƒçš„å¤§é—¨ï¼Œæˆ‘è¦å‡ºè¿œé—¨å•¦ï¼â€</p>
</blockquote>
<hr>
<h2 id="å‡ºå¢ƒå¤§é—¨-â€”â€”-è·¯ç”±å™¨">å‡ºå¢ƒå¤§é—¨ â€”â€” è·¯ç”±å™¨</h2>
<blockquote>
<p>è·¯ç”±å™¨ä¸äº¤æ¢æœºçš„åŒºåˆ«</p>
</blockquote>
<p>ç½‘ç»œåŒ…ç»è¿‡äº¤æ¢æœºä¹‹åï¼Œç°åœ¨åˆ°è¾¾äº†<strong>è·¯ç”±å™¨</strong>ï¼Œå¹¶åœ¨æ­¤è¢«è½¬å‘åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ç›®æ ‡è®¾å¤‡ã€‚</p>
<p>è¿™ä¸€æ­¥è½¬å‘çš„å·¥ä½œåŸç†å’Œäº¤æ¢æœºç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡æŸ¥è¡¨åˆ¤æ–­åŒ…è½¬å‘çš„ç›®æ ‡ã€‚</p>
<p>ä¸è¿‡åœ¨å…·ä½“çš„æ“ä½œè¿‡ç¨‹ä¸Šï¼Œè·¯ç”±å™¨å’Œäº¤æ¢æœºæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<ul>
<li>å› ä¸º<strong>è·¯ç”±å™¨</strong>æ˜¯åŸºäº IP è®¾è®¡çš„ï¼Œä¿—ç§°<strong>ä¸‰å±‚</strong>ç½‘ç»œè®¾å¤‡ï¼Œè·¯ç”±å™¨çš„å„ä¸ªç«¯å£éƒ½å…·æœ‰ MAC åœ°å€å’Œ IP åœ°å€ï¼›</li>
<li>è€Œ<strong>äº¤æ¢æœº</strong>æ˜¯åŸºäºä»¥å¤ªç½‘è®¾è®¡çš„ï¼Œä¿—ç§°<strong>äºŒå±‚</strong>ç½‘ç»œè®¾å¤‡ï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸å…·æœ‰ MAC åœ°å€ã€‚</li>
</ul>
<blockquote>
<p>è·¯ç”±å™¨åŸºæœ¬åŸç†</p>
</blockquote>
<p>è·¯ç”±å™¨çš„ç«¯å£å…·æœ‰ MAC åœ°å€ï¼Œå› æ­¤å®ƒå°±èƒ½å¤Ÿæˆä¸ºä»¥å¤ªç½‘çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹ï¼›åŒæ—¶è¿˜å…·æœ‰ IP åœ°å€ï¼Œä»è¿™ä¸ªæ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒå’Œè®¡ç®—æœºçš„ç½‘å¡æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å½“è½¬å‘åŒ…æ—¶ï¼Œé¦–å…ˆè·¯ç”±å™¨ç«¯å£ä¼šæ¥æ”¶å‘ç»™è‡ªå·±çš„ä»¥å¤ªç½‘åŒ…ï¼Œç„¶å<strong>è·¯ç”±è¡¨</strong>æŸ¥è¯¢è½¬å‘ç›®æ ‡ï¼Œå†ç”±ç›¸åº”çš„ç«¯å£ä½œä¸ºå‘é€æ–¹å°†ä»¥å¤ªç½‘åŒ…å‘é€å‡ºå»ã€‚</p>
<blockquote>
<p>è·¯ç”±å™¨çš„åŒ…æ¥æ”¶æ“ä½œ</p>
</blockquote>
<p>é¦–å…ˆï¼Œç”µä¿¡å·åˆ°è¾¾ç½‘çº¿æ¥å£éƒ¨åˆ†ï¼Œè·¯ç”±å™¨ä¸­çš„æ¨¡å—ä¼šå°†ç”µä¿¡å·è½¬æˆæ•°å­—ä¿¡å·ï¼Œç„¶åé€šè¿‡åŒ…æœ«å°¾çš„ <code>FCS</code> è¿›è¡Œé”™è¯¯æ ¡éªŒã€‚</p>
<p>å¦‚æœæ²¡é—®é¢˜åˆ™æ£€æŸ¥ MAC å¤´éƒ¨ä¸­çš„<strong>æ¥æ”¶æ–¹ MAC åœ°å€</strong>ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„åŒ…ï¼Œå¦‚æœæ˜¯å°±æ”¾åˆ°æ¥æ”¶ç¼“å†²åŒºä¸­ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œè·¯ç”±å™¨çš„ç«¯å£éƒ½å…·æœ‰ MAC åœ°å€ï¼Œåªæ¥æ”¶ä¸è‡ªèº«åœ°å€åŒ¹é…çš„åŒ…ï¼Œé‡åˆ°ä¸åŒ¹é…çš„åŒ…åˆ™ç›´æ¥ä¸¢å¼ƒã€‚</p>
<blockquote>
<p>æŸ¥è¯¢è·¯ç”±è¡¨ç¡®å®šè¾“å‡ºç«¯å£</p>
</blockquote>
<p>å®ŒæˆåŒ…æ¥æ”¶æ“ä½œä¹‹åï¼Œè·¯ç”±å™¨å°±ä¼š<strong>å»æ‰</strong>åŒ…å¼€å¤´çš„ MAC å¤´éƒ¨ã€‚</p>
<p><strong>MAC å¤´éƒ¨çš„ä½œç”¨å°±æ˜¯å°†åŒ…é€è¾¾è·¯ç”±å™¨</strong>ï¼Œå…¶ä¸­çš„æ¥æ”¶æ–¹ MAC åœ°å€å°±æ˜¯è·¯ç”±å™¨ç«¯å£çš„ MAC åœ°å€ã€‚å› æ­¤ï¼Œå½“åŒ…åˆ°è¾¾è·¯ç”±å™¨ä¹‹åï¼ŒMAC å¤´éƒ¨çš„ä»»åŠ¡å°±å®Œæˆäº†ï¼Œäºæ˜¯ MAC å¤´éƒ¨å°±ä¼š<strong>è¢«ä¸¢å¼ƒ</strong>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè·¯ç”±å™¨ä¼šæ ¹æ® MAC å¤´éƒ¨åæ–¹çš„ <code>IP</code> å¤´éƒ¨ä¸­çš„å†…å®¹è¿›è¡ŒåŒ…çš„è½¬å‘æ“ä½œã€‚</p>
<p>è½¬å‘æ“ä½œåˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼Œé¦–å…ˆæ˜¯æŸ¥è¯¢<strong>è·¯ç”±è¡¨</strong>åˆ¤æ–­è½¬å‘ç›®æ ‡ã€‚</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003721861.png" alt="1750003721861"></p>
<p>å…·ä½“çš„å·¥ä½œæµç¨‹æ ¹æ®ä¸Šå›¾ï¼Œä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>å‡è®¾åœ°å€ä¸º <code>10.10.1.101</code> çš„è®¡ç®—æœºè¦å‘åœ°å€ä¸º <code>192.168.1.100</code> çš„æœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒ…ï¼Œè¿™ä¸ªåŒ…å…ˆåˆ°è¾¾å›¾ä¸­çš„è·¯ç”±å™¨ã€‚</p>
<p>åˆ¤æ–­è½¬å‘ç›®æ ‡çš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯æ ¹æ®åŒ…çš„æ¥æ”¶æ–¹ IP åœ°å€æŸ¥è¯¢è·¯ç”±è¡¨ä¸­çš„ç›®æ ‡åœ°å€æ ï¼Œä»¥æ‰¾åˆ°ç›¸åŒ¹é…çš„è®°å½•ã€‚</p>
<p>è·¯ç”±åŒ¹é…å’Œå‰é¢è®²çš„ä¸€æ ·ï¼Œæ¯ä¸ªæ¡ç›®çš„å­ç½‘æ©ç å’Œ <code>192.168.1.100</code> IP åš <strong>&amp; ä¸è¿ç®—</strong>åï¼Œå¾—åˆ°çš„ç»“æœä¸å¯¹åº”æ¡ç›®çš„ç›®æ ‡åœ°å€è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…å°±ä¼šä½œä¸ºå€™é€‰è½¬å‘ç›®æ ‡ï¼Œå¦‚æœä¸åŒ¹é…å°±ç»§ç»­ä¸ä¸‹ä¸ªæ¡ç›®è¿›è¡Œè·¯ç”±åŒ¹é…ã€‚</p>
<p>å¦‚ç¬¬äºŒæ¡ç›®çš„å­ç½‘æ©ç  <code>255.255.255.0</code> ä¸ <code>192.168.1.100</code> IP åš <strong>&amp; ä¸è¿ç®—</strong>åï¼Œå¾—åˆ°ç»“æœæ˜¯ <code>192.168.1.0</code> ï¼Œè¿™ä¸ç¬¬äºŒæ¡ç›®çš„ç›®æ ‡åœ°å€ <code>192.168.1.0</code> åŒ¹é…ï¼Œè¯¥ç¬¬äºŒæ¡ç›®è®°å½•å°±ä¼šè¢«ä½œä¸ºè½¬å‘ç›®æ ‡ã€‚</p>
<p>å®åœ¨æ‰¾ä¸åˆ°åŒ¹é…è·¯ç”±æ—¶ï¼Œå°±ä¼šé€‰æ‹©<strong>é»˜è®¤è·¯ç”±</strong>ï¼Œè·¯ç”±è¡¨ä¸­å­ç½‘æ©ç ä¸º <code>0.0.0.0</code> çš„è®°å½•è¡¨ç¤ºã€Œé»˜è®¤è·¯ç”±ã€ã€‚</p>
<blockquote>
<p>è·¯ç”±å™¨çš„å‘é€æ“ä½œ</p>
</blockquote>
<p>æ¥ä¸‹æ¥å°±ä¼šè¿›å…¥åŒ…çš„<strong>å‘é€æ“ä½œ</strong>ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®<strong>è·¯ç”±è¡¨çš„ç½‘å…³åˆ—</strong>åˆ¤æ–­å¯¹æ–¹çš„åœ°å€ã€‚</p>
<ul>
<li>å¦‚æœç½‘å…³æ˜¯ä¸€ä¸ª IP åœ°å€ï¼Œåˆ™è¿™ä¸ª IP åœ°å€å°±æ˜¯æˆ‘ä»¬è¦è½¬å‘åˆ°çš„ç›®æ ‡åœ°å€ï¼Œ<strong>è¿˜æœªæŠµè¾¾ç»ˆç‚¹</strong>ï¼Œè¿˜éœ€ç»§ç»­éœ€è¦è·¯ç”±å™¨è½¬å‘ã€‚</li>
<li>å¦‚æœç½‘å…³ä¸ºç©ºï¼Œåˆ™ IP å¤´éƒ¨ä¸­çš„æ¥æ”¶æ–¹ IP åœ°å€å°±æ˜¯è¦è½¬å‘åˆ°çš„ç›®æ ‡åœ°å€ï¼Œä¹Ÿæ˜¯å°±ç»ˆäºæ‰¾åˆ° IP åŒ…å¤´é‡Œçš„ç›®æ ‡åœ°å€äº†ï¼Œè¯´æ˜<strong>å·²æŠµè¾¾ç»ˆç‚¹</strong>ã€‚</li>
</ul>
<p>çŸ¥é“å¯¹æ–¹çš„ IP åœ°å€ä¹‹åï¼Œæ¥ä¸‹æ¥éœ€è¦é€šè¿‡ <code>ARP</code> åè®®æ ¹æ® IP åœ°å€æŸ¥è¯¢ MAC åœ°å€ï¼Œå¹¶å°†æŸ¥è¯¢çš„ç»“æœä½œä¸ºæ¥æ”¶æ–¹ MAC åœ°å€ã€‚</p>
<p>è·¯ç”±å™¨ä¹Ÿæœ‰ ARP ç¼“å­˜ï¼Œå› æ­¤é¦–å…ˆä¼šåœ¨ ARP ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™å‘é€ ARP æŸ¥è¯¢è¯·æ±‚ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯å‘é€æ–¹ MAC åœ°å€å­—æ®µï¼Œè¿™é‡Œå¡«å†™è¾“å‡ºç«¯å£çš„ MAC åœ°å€ã€‚è¿˜æœ‰ä¸€ä¸ªä»¥å¤ªç±»å‹å­—æ®µï¼Œå¡«å†™ <code>0800</code> ï¼ˆåå…­è¿›åˆ¶ï¼‰è¡¨ç¤º IP åè®®ã€‚</p>
<p>ç½‘ç»œåŒ…å®Œæˆåï¼Œæ¥ä¸‹æ¥ä¼šå°†å…¶è½¬æ¢æˆç”µä¿¡å·å¹¶é€šè¿‡ç«¯å£å‘é€å‡ºå»ã€‚è¿™ä¸€æ­¥çš„å·¥ä½œè¿‡ç¨‹å’Œè®¡ç®—æœºä¹Ÿæ˜¯ç›¸åŒçš„ã€‚</p>
<p>å‘é€å‡ºå»çš„ç½‘ç»œåŒ…ä¼šé€šè¿‡<strong>äº¤æ¢æœº</strong>åˆ°è¾¾ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚ç”±äºæ¥æ”¶æ–¹ MAC åœ°å€å°±æ˜¯ä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„åœ°å€ï¼Œæ‰€ä»¥äº¤æ¢æœºä¼šæ ¹æ®è¿™ä¸€åœ°å€å°†åŒ…ä¼ è¾“åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä¸‹ä¸€ä¸ªè·¯ç”±å™¨ä¼šå°†åŒ…è½¬å‘ç»™å†ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç»è¿‡å±‚å±‚è½¬å‘ä¹‹åï¼Œç½‘ç»œåŒ…å°±åˆ°è¾¾äº†æœ€ç»ˆçš„ç›®çš„åœ°ã€‚</p>
<p>ä¸çŸ¥ä½ å‘ç°äº†æ²¡æœ‰ï¼Œåœ¨ç½‘ç»œåŒ…ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>æº IP å’Œç›®æ ‡ IP å§‹ç»ˆæ˜¯ä¸ä¼šå˜çš„ï¼Œä¸€ç›´å˜åŒ–çš„æ˜¯ MAC åœ°å€ï¼ˆNATé™¤å¤–ï¼‰</strong>ï¼Œå› ä¸ºéœ€è¦ MAC åœ°å€åœ¨ä»¥å¤ªç½‘å†…è¿›è¡Œ<strong>ä¸¤ä¸ªè®¾å¤‡</strong>ä¹‹é—´çš„åŒ…ä¼ è¾“ã€‚</p>
<blockquote>
<p>æ•°æ®åŒ…é€šè¿‡å¤šä¸ªè·¯ç”±å™¨é“å‹çš„å¸®åŠ©ï¼Œåœ¨ç½‘ç»œä¸–ç•Œé€”ç»äº†å¾ˆå¤šè·¯ç¨‹ï¼Œæœ€ç»ˆæŠµè¾¾äº†ç›®çš„åœ°çš„åŸé—¨ï¼åŸé—¨å€¼å®ˆçš„è·¯ç”±å™¨ï¼Œå‘ç°äº†è¿™ä¸ªå°å…„å¼Ÿæ•°æ®åŒ…åŸæ¥æ˜¯æ‰¾åŸå†…çš„äººï¼Œäºæ˜¯å®ƒå°±å°†æ•°æ®åŒ…é€è¿›äº†åŸå†…ï¼Œå†ç»ç”±åŸå†…çš„äº¤æ¢æœºå¸®åŠ©ä¸‹ï¼Œæœ€ç»ˆè½¬å‘åˆ°äº†ç›®çš„åœ°äº†ã€‚æ•°æ®åŒ…æ„Ÿæ…¨ä¸‡åƒçš„è¯´é“ï¼šâ€œå¤šè°¢è¿™ä¸€è·¯ä¸Šï¼Œå„è·¯å¤§ä¾ çš„ç›¸åŠ©ï¼â€</p>
</blockquote>
<hr>
<h2 id="äº’ç›¸æ‰’çš®-â€”â€”-æœåŠ¡å™¨-ä¸-å®¢æˆ·ç«¯">äº’ç›¸æ‰’çš® â€”â€” æœåŠ¡å™¨ ä¸ å®¢æˆ·ç«¯</h2>
<p>æ•°æ®åŒ…æŠµè¾¾äº†æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è‚¯å®šé«˜å…´å‘€ï¼Œæ­£æ‰€è°“æœ‰æœ‹è‡ªè¿œæ–¹æ¥ï¼Œä¸äº¦ä¹ä¹ï¼Ÿ</p>
<p>æœåŠ¡å™¨é«˜å…´çš„ä¸å¾—äº†ï¼Œäºæ˜¯å¼€å§‹æ‰’æ•°æ®åŒ…çš„çš®ï¼å°±å¥½åƒä½ æ”¶åˆ°å¿«é€’ï¼Œèƒ½ä¸å…´å¥‹å—ï¼Ÿ</p>
<p><img src="/2025/06/16/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%82%B9%E5%87%BBURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1750003733095.png" alt="1750003733095"></p>
<p>æ•°æ®åŒ…æŠµè¾¾æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨ä¼šå…ˆæ‰’å¼€æ•°æ®åŒ…çš„ MAC å¤´éƒ¨ï¼ŒæŸ¥çœ‹æ˜¯å¦å’ŒæœåŠ¡å™¨è‡ªå·±çš„ MAC åœ°å€ç¬¦åˆï¼Œç¬¦åˆå°±å°†åŒ…æ”¶èµ·æ¥ã€‚</p>
<p>æ¥ç€ç»§ç»­æ‰’å¼€æ•°æ®åŒ…çš„ IP å¤´ï¼Œå‘ç° IP åœ°å€ç¬¦åˆï¼Œæ ¹æ® IP å¤´ä¸­åè®®é¡¹ï¼ŒçŸ¥é“è‡ªå·±ä¸Šå±‚æ˜¯ TCP åè®®ã€‚</p>
<p>äºæ˜¯ï¼Œæ‰’å¼€ TCP çš„å¤´ï¼Œé‡Œé¢æœ‰åºåˆ—å·ï¼Œéœ€è¦çœ‹ä¸€çœ‹è¿™ä¸ªåºåˆ—åŒ…æ˜¯ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œå¦‚æœæ˜¯å°±æ”¾å…¥ç¼“å­˜ä¸­ç„¶åè¿”å›ä¸€ä¸ª ACKï¼Œå¦‚æœä¸æ˜¯å°±ä¸¢å¼ƒã€‚TCP å¤´éƒ¨é‡Œé¢è¿˜æœ‰ç«¯å£å·ï¼ŒHTTP çš„æœåŠ¡å™¨æ­£åœ¨ç›‘å¬è¿™ä¸ªç«¯å£å·ã€‚</p>
<p>äºæ˜¯ï¼ŒæœåŠ¡å™¨è‡ªç„¶å°±çŸ¥é“æ˜¯ HTTP è¿›ç¨‹æƒ³è¦è¿™ä¸ªåŒ…ï¼Œäºæ˜¯å°±å°†åŒ…å‘ç»™ HTTP è¿›ç¨‹ã€‚</p>
<p>æœåŠ¡å™¨çš„ HTTP è¿›ç¨‹çœ‹åˆ°ï¼ŒåŸæ¥è¿™ä¸ªè¯·æ±‚æ˜¯è¦è®¿é—®ä¸€ä¸ªé¡µé¢ï¼Œäºæ˜¯å°±æŠŠè¿™ä¸ªç½‘é¡µå°è£…åœ¨ HTTP å“åº”æŠ¥æ–‡é‡Œã€‚</p>
<p>HTTP å“åº”æŠ¥æ–‡ä¹Ÿéœ€è¦ç©¿ä¸Š TCPã€IPã€MAC å¤´éƒ¨ï¼Œä¸è¿‡è¿™æ¬¡æ˜¯æºåœ°å€æ˜¯æœåŠ¡å™¨ IP åœ°å€ï¼Œç›®çš„åœ°å€æ˜¯å®¢æˆ·ç«¯ IP åœ°å€ã€‚</p>
<p>ç©¿å¥½å¤´éƒ¨è¡£æœåï¼Œä»ç½‘å¡å‡ºå»ï¼Œäº¤ç”±äº¤æ¢æœºè½¬å‘åˆ°å‡ºåŸçš„è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨å°±æŠŠå“åº”æ•°æ®åŒ…å‘åˆ°äº†ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå°±è¿™æ ·è·³å•Šè·³ã€‚</p>
<p>æœ€åè·³åˆ°äº†å®¢æˆ·ç«¯çš„åŸé—¨æŠŠå®ˆçš„è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨æ‰’å¼€ IP å¤´éƒ¨å‘ç°æ˜¯è¦æ‰¾åŸå†…çš„äººï¼Œäºæ˜¯åˆæŠŠåŒ…å‘ç»™äº†åŸå†…çš„äº¤æ¢æœºï¼Œå†ç”±äº¤æ¢æœºè½¬å‘åˆ°å®¢æˆ·ç«¯ã€‚</p>
<p>å®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡å™¨çš„å“åº”æ•°æ®åŒ…åï¼ŒåŒæ ·ä¹Ÿéå¸¸çš„é«˜å…´ï¼Œå®¢æˆ·èƒ½æ‹†å¿«é€’äº†ï¼</p>
<p>äºæ˜¯ï¼Œå®¢æˆ·ç«¯å¼€å§‹æ‰’çš®ï¼ŒæŠŠæ”¶åˆ°çš„æ•°æ®åŒ…çš„çš®æ‰’å‰© HTTP å“åº”æŠ¥æ–‡åï¼Œäº¤ç»™æµè§ˆå™¨å»æ¸²æŸ“é¡µé¢ï¼Œä¸€ä»½ç‰¹åˆ«çš„æ•°æ®åŒ…å¿«é€’ï¼Œå°±è¿™æ ·æ˜¾ç¤ºå‡ºæ¥äº†ï¼</p>
<p>æœ€åï¼Œå®¢æˆ·ç«¯è¦ç¦»å¼€äº†ï¼Œå‘æœåŠ¡å™¨å‘èµ·äº† TCP å››æ¬¡æŒ¥æ‰‹ï¼Œè‡³æ­¤åŒæ–¹çš„è¿æ¥å°±æ–­å¼€äº†ã€‚</p>
<hr>
<h2 id="ä¸€ä¸ªæ•°æ®åŒ…è‡­ä¸è¦è„¸çš„æ„Ÿå—">ä¸€ä¸ªæ•°æ®åŒ…è‡­ä¸è¦è„¸çš„æ„Ÿå—</h2>
<blockquote>
<p>ä¸‹é¢å†…å®¹çš„ã€Œæˆ‘ã€ï¼Œä»£è¡¨ã€Œè‡­ç¾çš„æ•°æ®åŒ…è§’è‰²ã€ã€‚æ³¨ï¼šï¼ˆæ‹¬å·çš„å†…å®¹ï¼‰ä»£è¡¨æˆ‘çš„åæ§½ï¼Œä¸‰è¿å‘¸ï¼</p>
</blockquote>
<p>æˆ‘ä¸€å¼€å§‹æˆ‘è™½ç„¶å­¤å•ã€ä¸çŸ¥æ‰€æªï¼Œä½†æ²¡æœ‰åœæ»ä¸å‰ã€‚æˆ‘ä¾ç„¶æ»¡æ€€ä¿¡å¿ƒå’Œå‹‡æ°”å¼€å§‹äº†å¾é€”ã€‚ï¼ˆ<strong>ä½ å½“ç„¶æœ‰å‹‡æ°”ï¼Œä½ æ˜¯åº”ç”¨å±‚æ•°æ®ï¼Œåé¢æœ‰åº•å±‚å…„å¼Ÿå½“é å±±ï¼Œæˆ‘å‘¸ï¼</strong>ï¼‰</p>
<p>æˆ‘å¾ˆåº†å¹¸é‡åˆ°äº†å„è·¯ç¥é€šå¹¿å¤§çš„å¤§ä½¬ï¼Œæœ‰å¯é ä¼ è¾“çš„ TCPã€æœ‰è¿œç¨‹å®šä½åŠŸèƒ½çš„ IPã€æœ‰æŒ‡æ˜ä¸‹ä¸€ç«™ä½ç½®çš„ MAC ç­‰ï¼ˆ<strong>ä½ å½“ç„¶ä¼šé‡åˆ°ï¼Œå› ä¸ºéƒ½è¢«è®¡ç®—æœºå®‰æ’å¥½çš„ï¼Œæˆ‘å‘¸ï¼</strong>ï¼‰ã€‚</p>
<p>è¿™äº›å¤§ä½¬éƒ½ç»™æˆ‘å‰é¢åŠ ä¸Šäº†å¤´éƒ¨ï¼Œä½¿å¾—æˆ‘èƒ½åœ¨äº¤æ¢æœºå’Œè·¯ç”±å™¨çš„è½¬å‘ä¸‹ï¼ŒæŠµè¾¾åˆ°äº†ç›®çš„åœ°ï¼ï¼ˆ<strong>å“ï¼Œä½ ä¹Ÿä¸å®¹æ˜“ï¼Œä¸åæ§½äº†ï¼Œæ”¾è¿‡ä½ ï¼</strong>ï¼‰</p>
<p>è¿™ä¸€è·¯ä¸Šçš„ç»å†ï¼Œè®©æˆ‘è®¤è¯†åˆ°äº†ç½‘ç»œä¸–ç•Œä¸­å„è·¯å¤§ä¾ åä½œçš„é‡è¦æ€§ï¼Œæ˜¯ä»–ä»¬ç»´æŠ¤äº†ç½‘ç»œä¸–ç•Œçš„ç§©åºï¼Œæ„Ÿè°¢ä»–ä»¬ï¼ï¼ˆ<strong>æˆ‘å‘¸ï¼Œä½ åº”è¯¥æ„Ÿè°¢ä¼—å¤šè®¡ç®—æœºç§‘å­¦å®¶ï¼</strong>ï¼‰</p>
<hr>
<h2 id="è¯»è€…é—®ç­”">è¯»è€…é—®ç­”</h2>
<blockquote>
<p>è¯»è€…é—®ï¼šâ€œç¬”è®°æœ¬çš„æ˜¯è‡ªå¸¦äº¤æ¢æœºçš„å—ï¼Ÿäº¤æ¢æœºç°åœ¨æˆ‘è¿˜ä¸çŸ¥é“æ˜¯ä»€ä¹ˆâ€</p>
</blockquote>
<p>ç¬”è®°æœ¬ä¸æ˜¯äº¤æ¢æœºï¼Œäº¤æ¢æœºé€šå¸¸æ˜¯ 2 ä¸ªç½‘å£ä»¥ä¸Šã€‚</p>
<p>ç°åœ¨å®¶é‡Œçš„è·¯ç”±å™¨å…¶å®æœ‰äº†äº¤æ¢æœºçš„åŠŸèƒ½äº†ã€‚äº¤æ¢æœºå¯ä»¥ç®€å•ç†è§£æˆä¸€ä¸ªè®¾å¤‡ï¼Œä¸‰å°ç”µè„‘ç½‘çº¿æ¥åˆ°è¿™ä¸ªè®¾å¤‡ï¼Œè¿™ä¸‰å°ç”µè„‘å°±å¯ä»¥äº’ç›¸é€šä¿¡äº†ï¼Œäº¤æ¢æœºå˜›ï¼Œäº¤æ¢æ•°æ®è¿™ä¹ˆç†è§£å°±å¯ä»¥ã€‚</p>
<blockquote>
<p>è¯»è€…é—®ï¼šâ€œå¦‚æœçŸ¥é“ä½ ç”µè„‘çš„ Mac åœ°å€ï¼Œæˆ‘å¯ä»¥ç›´æ¥ç»™ä½ å‘æ¶ˆæ¯å—ï¼Ÿâ€</p>
</blockquote>
<p>Mac åœ°å€åªèƒ½æ˜¯ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´ä¼ é€’æ—¶ä½¿ç”¨çš„ï¼Œå¦‚æœä½ è¦ä»å¤§è€è¿œç»™æˆ‘å‘æ¶ˆæ¯ï¼Œæ˜¯ç¦»ä¸å¼€ IP çš„ã€‚</p>
<blockquote>
<p>è¯»è€…é—®ï¼šâ€œè¯·é—®å…¬ç½‘æœåŠ¡å™¨çš„ Mac åœ°å€æ˜¯åœ¨ä»€ä¹ˆæ—¶æœºé€šè¿‡ä»€ä¹ˆæ–¹å¼è·å–åˆ°çš„ï¼Ÿæˆ‘çœ‹ ARP è·å– Mac åœ°å€åªèƒ½è·å–åˆ°å†…ç½‘æœºå™¨çš„ Mac åœ°å€å§ï¼Ÿâ€</p>
</blockquote>
<p>åœ¨å‘é€æ•°æ®åŒ…æ—¶ï¼Œå¦‚æœç›®æ ‡ä¸»æœºä¸æ˜¯æœ¬åœ°å±€åŸŸç½‘ï¼Œå¡«å…¥çš„ Mac åœ°å€æ˜¯è·¯ç”±å™¨ï¼Œä¹Ÿå°±æ˜¯æŠŠæ•°æ®åŒ…è½¬å‘ç»™è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨ä¸€ç›´è½¬å‘ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç›´åˆ°è½¬å‘åˆ°ç›®æ ‡ä¸»æœºçš„è·¯ç”±å™¨ï¼Œå‘ç° IP åœ°å€æ˜¯è‡ªå·±å±€åŸŸç½‘å†…çš„ä¸»æœºï¼Œå°±ä¼š ARP è¯·æ±‚è·å–ç›®æ ‡ä¸»æœºçš„ Mac åœ°å€ï¼Œä»è€Œè½¬å‘åˆ°è¿™ä¸ªæœåŠ¡å™¨ä¸»æœºã€‚</p>
<p>è½¬å‘çš„è¿‡ç¨‹ä¸­ï¼Œæº IP åœ°å€å’Œç›®æ ‡ IP åœ°å€æ˜¯ä¸ä¼šå˜çš„ï¼ˆå‰æï¼šæ²¡æœ‰ä½¿ç”¨ NAT ç½‘ç»œçš„ï¼‰ï¼Œæº MAC åœ°å€å’Œç›®æ ‡ MAC åœ°å€æ˜¯ä¼šå˜åŒ–çš„ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: TCP/IPç½‘ç»œå±‚ç»“æ„è¯¦è§£</title>
    <url>/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<h1>TCP/IP ç½‘ç»œæ¨¡å‹çš„å››å±‚ç»“æ„è¯¦è§£</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>ä¸ºä»€ä¹ˆè¦æœ‰ TCP/IP ç½‘ç»œæ¨¡å‹ï¼Ÿ</p>
<p>å¯¹äºåŒä¸€å°è®¾å¤‡ä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ¯”å¦‚æœ‰ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ã€ä¿¡å·ç­‰æ–¹å¼ï¼Œè€Œå¯¹äºä¸åŒè®¾å¤‡ä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œå°±éœ€è¦ç½‘ç»œé€šä¿¡ã€‚ç”±äºè®¾å¤‡çš„å¤šæ ·æ€§ï¼ˆä¸åŒå‚å•†ã€ä¸åŒæ“ä½œç³»ç»Ÿã€ä¸åŒç¡¬ä»¶æ¶æ„ï¼‰ï¼Œä¸ºäº†å®ç°è®¾å¤‡é—´çš„äº’è”äº’é€šï¼Œå°±åå•†å‡ºäº†ä¸€å¥—<strong>é€šç”¨çš„ç½‘ç»œåè®®æ ‡å‡†</strong>ã€‚</p>
<p>è¿™ä¸ªç½‘ç»œåè®®é‡‡ç”¨<strong>åˆ†å±‚è®¾è®¡</strong>çš„ç†å¿µï¼Œæ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£å’ŒåŠŸèƒ½ï¼Œå±‚ä¸å±‚ä¹‹é—´é€šè¿‡æ ‡å‡†æ¥å£è¿›è¡Œé€šä¿¡ã€‚è¿™ç§è®¾è®¡æ–¹å¼çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>æ¨¡å—åŒ–</strong>ï¼šæ¯å±‚å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œç»´æŠ¤</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šå¯ä»¥åœ¨ä¸å½±å“å…¶ä»–å±‚çš„æƒ…å†µä¸‹å‡çº§æŸä¸€å±‚</li>
<li><strong>æ ‡å‡†åŒ–</strong>ï¼šä¸åŒå‚å•†çš„è®¾å¤‡å¯ä»¥äº’æ“ä½œ</li>
<li><strong>å¤æ‚æ€§ç®¡ç†</strong>ï¼šå°†å¤æ‚çš„ç½‘ç»œé€šä¿¡é—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªç®€å•çš„å­é—®é¢˜</li>
</ul>
<p>æ¥ä¸‹æ¥æ ¹æ®ã€ŒTCP/IP ç½‘ç»œæ¨¡å‹ã€åˆ†åˆ«å¯¹æ¯ä¸€å±‚è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>
<h2 id="åº”ç”¨å±‚ï¼ˆApplication-Layerï¼‰">åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h3>
<p>æœ€ä¸Šå±‚çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬èƒ½ç›´æ¥æ¥è§¦åˆ°çš„å°±æ˜¯<strong>åº”ç”¨å±‚</strong>ã€‚åº”ç”¨å±‚æ˜¯ç½‘ç»œåè®®æ ˆçš„æœ€é¡¶å±‚ï¼Œ<strong>ç›´æ¥ä¸ºç”¨æˆ·æä¾›ç½‘ç»œæœåŠ¡</strong>ã€‚æˆ‘ä»¬ç”µè„‘æˆ–æ‰‹æœºä¸Šä½¿ç”¨çš„æ‰€æœ‰ç½‘ç»œåº”ç”¨è½¯ä»¶éƒ½æ˜¯åœ¨åº”ç”¨å±‚å®ç°çš„ã€‚</p>
<h3 id="ä¸»è¦åè®®å’ŒåŠŸèƒ½">ä¸»è¦åè®®å’ŒåŠŸèƒ½</h3>
<p>åº”ç”¨å±‚åŒ…å«äº†ä¼—å¤šçš„åè®®ï¼Œæ¯ä¸ªåè®®éƒ½ä¸ºç‰¹å®šçš„åº”ç”¨åœºæ™¯æœåŠ¡ï¼š</p>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>ç«¯å£</th>
<th>åŠŸèƒ½</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HTTP/HTTPS</strong></td>
<td>80/443</td>
<td>è¶…æ–‡æœ¬ä¼ è¾“åè®®</td>
<td>ç½‘é¡µæµè§ˆã€APIè°ƒç”¨</td>
</tr>
<tr>
<td><strong>FTP</strong></td>
<td>20/21</td>
<td>æ–‡ä»¶ä¼ è¾“åè®®</td>
<td>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½</td>
</tr>
<tr>
<td><strong>SMTP</strong></td>
<td>25</td>
<td>ç®€å•é‚®ä»¶ä¼ è¾“åè®®</td>
<td>é‚®ä»¶å‘é€</td>
</tr>
<tr>
<td><strong>POP3/IMAP</strong></td>
<td>110/143</td>
<td>é‚®ä»¶æ¥æ”¶åè®®</td>
<td>é‚®ä»¶æ¥æ”¶</td>
</tr>
<tr>
<td><strong>DNS</strong></td>
<td>53</td>
<td>åŸŸåè§£æåè®®</td>
<td>åŸŸååˆ°IPåœ°å€è½¬æ¢</td>
</tr>
<tr>
<td><strong>Telnet</strong></td>
<td>23</td>
<td>è¿œç¨‹ç™»å½•åè®®</td>
<td>è¿œç¨‹ç»ˆç«¯è®¿é—®</td>
</tr>
<tr>
<td><strong>SSH</strong></td>
<td>22</td>
<td>å®‰å…¨å¤–å£³åè®®</td>
<td>å®‰å…¨çš„è¿œç¨‹ç™»å½•</td>
</tr>
</tbody>
</table>
<h3 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h3>
<p>å½“ä¸¤ä¸ªä¸åŒè®¾å¤‡çš„åº”ç”¨éœ€è¦é€šä¿¡æ—¶ï¼Œåº”ç”¨å±‚ä¼šï¼š</p>
<ol>
<li><strong>å°è£…åº”ç”¨æ•°æ®</strong>ï¼šå°†ç”¨æˆ·æ•°æ®æŒ‰ç…§ç‰¹å®šåè®®æ ¼å¼è¿›è¡Œå°è£…</li>
<li><strong>è°ƒç”¨ä¼ è¾“å±‚æœåŠ¡</strong>ï¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚socket APIï¼‰å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚</li>
<li><strong>å¤„ç†åº”ç”¨é€»è¾‘</strong>ï¼šä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€å…³å¿ƒåº•å±‚ä¼ è¾“ç»†èŠ‚</li>
</ol>
<p><strong>å®é™…ä¾‹å­</strong>ï¼šå½“ä½ åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>https://www.example.com</code> æ—¶ï¼š</p>
<ol>
<li>åº”ç”¨å±‚çš„HTTPåè®®æ„é€ è¯·æ±‚æŠ¥æ–‡</li>
<li>é€šè¿‡socketæ¥å£è°ƒç”¨ä¼ è¾“å±‚çš„TCPæœåŠ¡</li>
<li>TCPè´Ÿè´£å¯é ä¼ è¾“ï¼Œåº”ç”¨å±‚æ— éœ€å…³å¿ƒæ•°æ®å¦‚ä½•åˆ°è¾¾æœåŠ¡å™¨</li>
</ol>
<h3 id="è¿è¡Œç¯å¢ƒ">è¿è¡Œç¯å¢ƒ</h3>
<p>åº”ç”¨å±‚å·¥ä½œåœ¨æ“ä½œç³»ç»Ÿçš„<strong>ç”¨æˆ·æ€</strong>ï¼ˆUser Spaceï¼‰ï¼Œè€Œä¼ è¾“å±‚åŠä»¥ä¸‹å„å±‚å·¥ä½œåœ¨<strong>å†…æ ¸æ€</strong>ï¼ˆKernel Spaceï¼‰ã€‚è¿™ç§è®¾è®¡çš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li><strong>å®‰å…¨æ€§</strong>ï¼šç”¨æˆ·ç¨‹åºæ— æ³•ç›´æ¥è®¿é—®å†…æ ¸ï¼Œæé«˜ç³»ç»Ÿå®‰å…¨æ€§</li>
<li><strong>ç¨³å®šæ€§</strong>ï¼šåº”ç”¨ç¨‹åºå´©æºƒä¸ä¼šå½±å“ç³»ç»Ÿå†…æ ¸</li>
<li><strong>çµæ´»æ€§</strong>ï¼šç”¨æˆ·å¯ä»¥è‡ªç”±å¼€å‘åº”ç”¨ç¨‹åº</li>
</ul>
<h2 id="ä¼ è¾“å±‚ï¼ˆTransport-Layerï¼‰">ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ-2">åŸºæœ¬æ¦‚å¿µ</h3>
<p><strong>ä¼ è¾“å±‚</strong>æ˜¯åº”ç”¨å±‚å’Œç½‘ç»œå±‚ä¹‹é—´çš„æ¡¥æ¢ï¼Œä¸ºåº”ç”¨å±‚æä¾›<strong>ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“æœåŠ¡</strong>ã€‚ä¼ è¾“å±‚çš„æ ¸å¿ƒä½œç”¨æ˜¯å®ç°<strong>è¿›ç¨‹åˆ°è¿›ç¨‹</strong>çš„é€šä¿¡ã€‚</p>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000198486.png" alt="1750000198486"></p>
<h3 id="TCPåè®®è¯¦è§£">TCPåè®®è¯¦è§£</h3>
<p><strong>TCP</strong>ï¼ˆ<strong>Transmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®</strong>ï¼‰æ˜¯ä¸€ä¸ªé¢å‘è¿æ¥çš„ã€å¯é çš„ä¼ è¾“åè®®ã€‚</p>
<h4 id="TCPçš„å…³é”®ç‰¹æ€§ï¼š">TCPçš„å…³é”®ç‰¹æ€§ï¼š</h4>
<ol>
<li><strong>é¢å‘è¿æ¥</strong>ï¼šé€šä¿¡å‰å¿…é¡»å»ºç«‹è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰</li>
<li><strong>å¯é ä¼ è¾“</strong>ï¼šä¿è¯æ•°æ®æŒ‰åºã€æ— é‡å¤ã€æ— ä¸¢å¤±åœ°åˆ°è¾¾</li>
<li><strong>æµé‡æ§åˆ¶</strong>ï¼šé˜²æ­¢å‘é€æ–¹å‘é€é€Ÿåº¦è¿‡å¿«å¯¼è‡´æ¥æ”¶æ–¹ç¼“å†²åŒºæº¢å‡º</li>
<li><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šæ ¹æ®ç½‘ç»œçŠ¶å†µè°ƒæ•´å‘é€é€Ÿç‡ï¼Œé¿å…ç½‘ç»œæ‹¥å¡</li>
<li><strong>å…¨åŒå·¥é€šä¿¡</strong>ï¼šåŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®</li>
</ol>
<h4 id="TCPçš„å·¥ä½œæœºåˆ¶ï¼š">TCPçš„å·¥ä½œæœºåˆ¶ï¼š</h4>
<p><strong>æ•°æ®åˆ†æ®µ</strong>ï¼šå½“åº”ç”¨å±‚æ•°æ®è¶…è¿‡ <strong>MSSï¼ˆMaximum Segment Sizeï¼Œæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼‰</strong> æ—¶ï¼ŒTCPä¼šå°†æ•°æ®åˆ†å‰²æˆå¤šä¸ªæ®µï¼š</p>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000205916.png" alt="1750000205916"></p>
<ul>
<li><strong>MSSé€šå¸¸ä¸º1460å­—èŠ‚</strong>ï¼ˆä»¥å¤ªç½‘MTU 1500å­—èŠ‚ - IPå¤´éƒ¨20å­—èŠ‚ - TCPå¤´éƒ¨20å­—èŠ‚ï¼‰</li>
<li>æ¯ä¸ªTCPæ®µéƒ½æœ‰ç‹¬ç«‹çš„åºåˆ—å·ï¼Œä¾¿äºæ¥æ”¶æ–¹é‡æ–°ç»„è£…</li>
<li>å¦‚æœæŸä¸ªæ®µä¸¢å¤±ï¼Œåªéœ€é‡ä¼ è¯¥æ®µï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°æ®</li>
</ul>
<p><strong>å¯é æ€§ä¿éšœæœºåˆ¶</strong>ï¼š</p>
<ul>
<li><strong>åºåˆ—å·å’Œç¡®è®¤å·</strong>ï¼šæ¯ä¸ªå­—èŠ‚éƒ½æœ‰å”¯ä¸€çš„åºåˆ—å·</li>
<li><strong>è¶…æ—¶é‡ä¼ </strong>ï¼šå‘é€æ–¹è®¾ç½®é‡ä¼ å®šæ—¶å™¨ï¼Œè¶…æ—¶æœªæ”¶åˆ°ACKåˆ™é‡ä¼ </li>
<li><strong>å¿«é€Ÿé‡ä¼ </strong>ï¼šæ”¶åˆ°3ä¸ªé‡å¤ACKæ—¶ç«‹å³é‡ä¼ </li>
<li><strong>æ»‘åŠ¨çª—å£</strong>ï¼šæé«˜ä¼ è¾“æ•ˆç‡ï¼Œå…è®¸å‘é€å¤šä¸ªæœªç¡®è®¤çš„æ®µ</li>
</ul>
<h3 id="UDPåè®®è¯¦è§£">UDPåè®®è¯¦è§£</h3>
<p>ï¼ˆ<strong>UDPUser Datagram Protocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®</strong>ï¼‰æ˜¯ä¸€ä¸ªæ— è¿æ¥çš„ã€ä¸å¯é çš„ä¼ è¾“åè®®ã€‚</p>
<h4 id="UDPçš„ç‰¹ç‚¹ï¼š">UDPçš„ç‰¹ç‚¹ï¼š</h4>
<ol>
<li><strong>ç®€å•é«˜æ•ˆ</strong>ï¼šå¤´éƒ¨åªæœ‰8å­—èŠ‚ï¼Œå¼€é”€å°</li>
<li><strong>æ— è¿æ¥</strong>ï¼šå‘é€æ•°æ®å‰æ— éœ€å»ºç«‹è¿æ¥</li>
<li><strong>ä¸å¯é </strong>ï¼šä¸ä¿è¯æ•°æ®åˆ°è¾¾ã€é¡ºåºå’Œå®Œæ•´æ€§</li>
<li><strong>å®æ—¶æ€§å¥½</strong>ï¼šæ— éœ€ç­‰å¾…ç¡®è®¤ï¼Œä¼ è¾“å»¶è¿Ÿä½</li>
</ol>
<h4 id="UDPçš„åº”ç”¨åœºæ™¯ï¼š">UDPçš„åº”ç”¨åœºæ™¯ï¼š</h4>
<ul>
<li><strong>å®æ—¶éŸ³è§†é¢‘</strong>ï¼šå¦‚ç›´æ’­ã€è§†é¢‘é€šè¯ï¼ˆå¯¹å»¶è¿Ÿæ•æ„Ÿï¼Œå¯æ¥å—å°‘é‡ä¸¢åŒ…ï¼‰</li>
<li><strong>DNSæŸ¥è¯¢</strong>ï¼šè¯·æ±‚æ•°æ®å°ï¼Œé‡ä¼ æˆæœ¬ä½</li>
<li><strong>DHCP</strong>ï¼šç½‘ç»œé…ç½®åè®®ï¼Œç®€å•è¯·æ±‚-å“åº”æ¨¡å¼</li>
<li><strong>åœ¨çº¿æ¸¸æˆ</strong>ï¼šå¯¹å®æ—¶æ€§è¦æ±‚é«˜ï¼Œå¯é€šè¿‡åº”ç”¨å±‚è¡¥å¿ä¸¢åŒ…</li>
</ul>
<h3 id="ç«¯å£å·æœºåˆ¶">ç«¯å£å·æœºåˆ¶</h3>
<p>ä¼ è¾“å±‚ä½¿ç”¨<strong>ç«¯å£å·</strong>æ¥åŒºåˆ†ä¸åŒçš„åº”ç”¨è¿›ç¨‹ï¼š</p>
<h4 id="ç«¯å£å·åˆ†ç±»ï¼š">ç«¯å£å·åˆ†ç±»ï¼š</h4>
<ul>
<li><strong>çŸ¥åç«¯å£ï¼ˆ0-1023ï¼‰</strong>ï¼šç”±IANAåˆ†é…ç»™æ ‡å‡†æœåŠ¡</li>
<li><strong>æ³¨å†Œç«¯å£ï¼ˆ1024-49151ï¼‰</strong>ï¼šæ³¨å†Œç»™ç‰¹å®šåº”ç”¨</li>
<li><strong>åŠ¨æ€ç«¯å£ï¼ˆ49152-65535ï¼‰</strong>ï¼šæ“ä½œç³»ç»ŸåŠ¨æ€åˆ†é…ç»™å®¢æˆ·ç«¯</li>
</ul>
<h4 id="ç«¯å£å·å·¥ä½œåŸç†ï¼š">ç«¯å£å·å·¥ä½œåŸç†ï¼š</h4>
<p>å½“æ•°æ®åˆ°è¾¾ç›®æ ‡ä¸»æœºæ—¶ï¼Œä¼ è¾“å±‚æ ¹æ®ç›®æ ‡ç«¯å£å·å°†æ•°æ®é€’äº¤ç»™ç›¸åº”çš„åº”ç”¨è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>WebæœåŠ¡å™¨ç›‘å¬80ç«¯å£</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨ä½¿ç”¨åŠ¨æ€ç«¯å£ï¼ˆå¦‚50123ï¼‰</li>
<li>æ•°æ®åŒ…ä¸­åŒæ—¶åŒ…å«æºç«¯å£å’Œç›®æ ‡ç«¯å£ï¼Œç¡®ä¿åŒå‘é€šä¿¡</li>
</ul>
<h2 id="ç½‘ç»œå±‚ï¼ˆInternet-Layerï¼‰">ç½‘ç»œå±‚ï¼ˆInternet Layerï¼‰</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ-3">åŸºæœ¬æ¦‚å¿µ</h3>
<p>ä¼ è¾“å±‚å¹¶ä¸è´Ÿè´£æ•°æ®åœ¨ç½‘ç»œä¸­çš„å®é™…ä¼ è¾“è·¯å¾„é€‰æ‹©ã€‚å®é™…ç½‘ç»œç¯å¢ƒé”™ç»¼å¤æ‚ï¼Œä¸­é—´æœ‰å„ç§å„æ ·çš„è·¯ç”±å™¨ã€äº¤æ¢æœºå’Œçº¿è·¯ã€‚<strong>ç½‘ç»œå±‚</strong>çš„èŒè´£å°±æ˜¯åœ¨è¿™ä¸ªå¤æ‚çš„ç½‘ç»œä¸­ä¸ºæ•°æ®åŒ…å¯»æ‰¾æœ€ä½³è·¯å¾„ï¼Œå®ç°<strong>ä¸»æœºåˆ°ä¸»æœº</strong>çš„é€šä¿¡ã€‚</p>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000215075.png" alt="1750000215075"></p>
<h3 id="IPåè®®è¯¦è§£">IPåè®®è¯¦è§£</h3>
<p><strong>IPåè®®</strong>ï¼ˆ<strong>Internet Protocol</strong>ï¼‰æ˜¯ç½‘ç»œå±‚çš„æ ¸å¿ƒåè®®ï¼Œæä¾›æ— è¿æ¥çš„æ•°æ®æŠ¥æœåŠ¡ã€‚</p>
<h4 id="IPæŠ¥æ–‡ç»“æ„ï¼š">IPæŠ¥æ–‡ç»“æ„ï¼š</h4>
<p>IPåè®®å°†ä¼ è¾“å±‚çš„æ•°æ®ä½œä¸ºè½½è·ï¼ŒåŠ ä¸ŠIPå¤´éƒ¨å½¢æˆIPæ•°æ®æŠ¥ï¼š</p>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000222363.png" alt="1750000222363"></p>
<p><strong>IPå¤´éƒ¨å…³é”®å­—æ®µ</strong>ï¼š</p>
<ul>
<li><strong>ç‰ˆæœ¬</strong>ï¼šIPåè®®ç‰ˆæœ¬ï¼ˆIPv4ä¸º4ï¼ŒIPv6ä¸º6ï¼‰</li>
<li><strong>å¤´éƒ¨é•¿åº¦</strong>ï¼šIPå¤´éƒ¨é•¿åº¦ï¼ˆæœ€å°20å­—èŠ‚ï¼‰</li>
<li><strong>æ€»é•¿åº¦</strong>ï¼šæ•´ä¸ªIPæ•°æ®æŠ¥é•¿åº¦ï¼ˆæœ€å¤§65535å­—èŠ‚ï¼‰</li>
<li><strong>æ ‡è¯†ã€æ ‡å¿—ã€ç‰‡åç§»</strong>ï¼šç”¨äºæ•°æ®æŠ¥åˆ†ç‰‡å’Œé‡ç»„</li>
<li><strong>ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰</strong>ï¼šé˜²æ­¢æ•°æ®æŠ¥åœ¨ç½‘ç»œä¸­æ— é™å¾ªç¯</li>
<li><strong>åè®®</strong>ï¼šæŒ‡ç¤ºä¸Šå±‚åè®®ç±»å‹ï¼ˆTCP=6ï¼ŒUDP=17ï¼‰</li>
<li><strong>æºIPåœ°å€å’Œç›®æ ‡IPåœ°å€</strong>ï¼šæ ‡è¯†å‘é€æ–¹å’Œæ¥æ”¶æ–¹</li>
</ul>
<h4 id="IPåˆ†ç‰‡æœºåˆ¶ï¼š">IPåˆ†ç‰‡æœºåˆ¶ï¼š</h4>
<p>å½“IPæ•°æ®æŠ¥å¤§å°è¶…è¿‡é“¾è·¯çš„<strong>MTU</strong>ï¼ˆ<strong>Maximum Transmission Unit</strong>ï¼‰æ—¶ï¼Œéœ€è¦è¿›è¡Œåˆ†ç‰‡ï¼š</p>
<ul>
<li><strong>ä»¥å¤ªç½‘MTUé€šå¸¸ä¸º1500å­—èŠ‚</strong></li>
<li>å¤§çš„IPæ•°æ®æŠ¥è¢«åˆ†å‰²æˆå¤šä¸ªå°ç‰‡æ®µ</li>
<li>æ¯ä¸ªç‰‡æ®µéƒ½æœ‰ç‹¬ç«‹çš„IPå¤´éƒ¨</li>
<li>ç›®æ ‡ä¸»æœºè´Ÿè´£é‡æ–°ç»„è£…æ‰€æœ‰ç‰‡æ®µ</li>
</ul>
<h3 id="IPåœ°å€å’Œå­ç½‘">IPåœ°å€å’Œå­ç½‘</h3>
<h4 id="IPåœ°å€ç»“æ„ï¼š">IPåœ°å€ç»“æ„ï¼š</h4>
<p>ä»¥IPv4ä¸ºä¾‹ï¼ŒIPåœ°å€æ˜¯32ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œé€šå¸¸ç”¨ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºï¼ˆå¦‚192.168.1.1ï¼‰ã€‚</p>
<p>IPåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<ul>
<li><strong>ç½‘ç»œå·</strong>ï¼šæ ‡è¯†å­ç½‘</li>
<li><strong>ä¸»æœºå·</strong>ï¼šæ ‡è¯†å­ç½‘å†…çš„å…·ä½“ä¸»æœº</li>
</ul>
<h4 id="å­ç½‘æ©ç è®¡ç®—ï¼š">å­ç½‘æ©ç è®¡ç®—ï¼š</h4>
<p>å­ç½‘æ©ç ç”¨äºåŒºåˆ†ç½‘ç»œå·å’Œä¸»æœºå·ã€‚ä¾‹å¦‚ï¼š</p>
<p><strong>ç¤ºä¾‹</strong>ï¼šIPåœ°å€ 10.100.122.2ï¼Œå­ç½‘æ©ç  255.255.255.0ï¼ˆ/24ï¼‰</p>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000230907.png" alt="1750000230907"></p>
<p><strong>è®¡ç®—è¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li><strong>ç½‘ç»œåœ°å€è®¡ç®—</strong>ï¼šIPåœ°å€ AND å­ç½‘æ©ç 
<ul>
<li>10.100.122.2 AND 255.255.255.0 = 10.100.122.0</li>
</ul>
</li>
<li><strong>ä¸»æœºåœ°å€è®¡ç®—</strong>ï¼šIPåœ°å€ AND (NOT å­ç½‘æ©ç )
<ul>
<li>10.100.122.2 AND 0.0.0.255 = 0.0.0.2</li>
</ul>
</li>
</ol>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000237830.png" alt="1750000237830"></p>
<h4 id="åœ°å€åˆ†ç±»ï¼š">åœ°å€åˆ†ç±»ï¼š</h4>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>åœ°å€èŒƒå›´</th>
<th>é»˜è®¤å­ç½‘æ©ç </th>
<th>ç½‘ç»œæ•°é‡</th>
<th>ä¸»æœºæ•°é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>Aç±»</td>
<td>1.0.0.0-126.255.255.255</td>
<td>255.0.0.0 (/8)</td>
<td>126</td>
<td>16,777,214</td>
</tr>
<tr>
<td>Bç±»</td>
<td>128.0.0.0-191.255.255.255</td>
<td>255.255.0.0 (/16)</td>
<td>16,384</td>
<td>65,534</td>
</tr>
<tr>
<td>Cç±»</td>
<td>192.0.0.0-223.255.255.255</td>
<td>255.255.255.0 (/24)</td>
<td>2,097,152</td>
<td>254</td>
</tr>
</tbody>
</table>
<h3 id="è·¯ç”±æœºåˆ¶">è·¯ç”±æœºåˆ¶</h3>
<h4 id="è·¯ç”±åŸºæœ¬æ¦‚å¿µï¼š">è·¯ç”±åŸºæœ¬æ¦‚å¿µï¼š</h4>
<p>è·¯ç”±æ˜¯æŒ‡æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­ä»æºä¸»æœºåˆ°ç›®æ ‡ä¸»æœºæ‰€ç»è¿‡çš„è·¯å¾„é€‰æ‹©è¿‡ç¨‹ã€‚</p>
<p><strong>è·¯ç”± vs å¯»å€</strong>ï¼š</p>
<ul>
<li><strong>å¯»å€</strong>ï¼šç¡®å®šç›®æ ‡åœ¨å“ªé‡Œï¼ˆç±»ä¼¼äºå¯¼èˆªç¡®å®šç›®çš„åœ°ï¼‰</li>
<li><strong>è·¯ç”±</strong>ï¼šé€‰æ‹©åˆ°è¾¾ç›®æ ‡çš„æœ€ä½³è·¯å¾„ï¼ˆç±»ä¼¼äºé€‰æ‹©è¡Œé©¶è·¯çº¿ï¼‰</li>
</ul>
<h4 id="è·¯ç”±è¡¨ï¼š">è·¯ç”±è¡¨ï¼š</h4>
<p>æ¯ä¸ªè·¯ç”±å™¨ç»´æŠ¤ä¸€ä¸ªè·¯ç”±è¡¨ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>ç›®æ ‡ç½‘ç»œ</strong>ï¼šè¦åˆ°è¾¾çš„ç½‘ç»œåœ°å€</li>
<li><strong>ä¸‹ä¸€è·³</strong>ï¼šæ•°æ®åŒ…åº”è¯¥å‘é€ç»™å“ªä¸ªè·¯ç”±å™¨</li>
<li><strong>æ¥å£</strong>ï¼šä»å“ªä¸ªç½‘ç»œæ¥å£å‘é€</li>
<li><strong>åº¦é‡å€¼</strong>ï¼šè·¯å¾„çš„ä»£ä»·ï¼ˆè·³æ•°ã€å¸¦å®½ã€å»¶è¿Ÿç­‰ï¼‰</li>
</ul>
<h4 id="è·¯ç”±ç®—æ³•ï¼š">è·¯ç”±ç®—æ³•ï¼š</h4>
<p><strong>é™æ€è·¯ç”±</strong>ï¼š</p>
<ul>
<li>ç®¡ç†å‘˜æ‰‹åŠ¨é…ç½®è·¯ç”±è¡¨</li>
<li>é€‚ç”¨äºå°å‹ã€æ‹“æ‰‘ç¨³å®šçš„ç½‘ç»œ</li>
</ul>
<p><strong>åŠ¨æ€è·¯ç”±</strong>ï¼š</p>
<ul>
<li>è·¯ç”±å™¨è‡ªåŠ¨å­¦ä¹ å’Œæ›´æ–°è·¯ç”±ä¿¡æ¯</li>
<li>å¸¸è§åè®®ï¼šRIPã€OSPFã€BGP</li>
</ul>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000244693.png" alt="1750000244693"></p>
<p><strong>è·¯ç”±å†³ç­–è¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li>æŸ¥çœ‹ç›®æ ‡IPåœ°å€</li>
<li>åœ¨è·¯ç”±è¡¨ä¸­æŸ¥æ‰¾æœ€åŒ¹é…çš„ç½‘ç»œæ¡ç›®ï¼ˆæœ€é•¿å‰ç¼€åŒ¹é…ï¼‰</li>
<li>å°†æ•°æ®åŒ…è½¬å‘ç»™ä¸‹ä¸€è·³è·¯ç”±å™¨</li>
<li>é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°åˆ°è¾¾ç›®æ ‡ç½‘ç»œ</li>
</ol>
<h2 id="ç½‘ç»œæ¥å£å±‚ï¼ˆLink-Layerï¼‰">ç½‘ç»œæ¥å£å±‚ï¼ˆLink Layerï¼‰</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ-4">åŸºæœ¬æ¦‚å¿µ</h3>
<p><strong>ç½‘ç»œæ¥å£å±‚</strong>ï¼ˆä¹Ÿç§°æ•°æ®é“¾è·¯å±‚ï¼‰æ˜¯TCP/IPæ¨¡å‹çš„æœ€åº•å±‚ï¼Œè´Ÿè´£åœ¨ç‰©ç†ç½‘ç»œä¸Šä¼ è¾“æ•°æ®å¸§ã€‚è¿™ä¸€å±‚ç›´æ¥ä¸ç¡¬ä»¶äº¤äº’ï¼Œå¤„ç†æ¯”ç‰¹æµåœ¨ç‰©ç†ä»‹è´¨ä¸Šçš„ä¼ è¾“ã€‚</p>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000251901.png" alt="1750000251901"></p>
<h3 id="ä»¥å¤ªç½‘æŠ€æœ¯">ä»¥å¤ªç½‘æŠ€æœ¯</h3>
<h4 id="ä»€ä¹ˆæ˜¯ä»¥å¤ªç½‘ï¼Ÿ">ä»€ä¹ˆæ˜¯ä»¥å¤ªç½‘ï¼Ÿ</h4>
<p>ä»¥å¤ªç½‘æ˜¯ç›®å‰æœ€å¹¿æ³›ä½¿ç”¨çš„å±€åŸŸç½‘æŠ€æœ¯ã€‚ä»¥å¤ªç½‘çš„ç»„æˆéƒ¨åˆ†åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰</strong>ï¼šç”µè„‘ä¸Šçš„ä»¥å¤ªç½‘æ¥å£ã€Wi-Fiæ¥å£</li>
<li><strong>ç½‘ç»œè®¾å¤‡</strong>ï¼šäº¤æ¢æœºã€è·¯ç”±å™¨ä¸Šçš„åƒå…†ã€ä¸‡å…†ä»¥å¤ªç½‘å£</li>
<li><strong>ä¼ è¾“ä»‹è´¨</strong>ï¼šç½‘çº¿ï¼ˆåŒç»çº¿ï¼‰ã€å…‰çº¤ç­‰</li>
<li><strong>åè®®æ ‡å‡†</strong>ï¼šIEEE 802.3æ ‡å‡†</li>
</ul>
<p>ä»¥å¤ªç½‘æ˜¯ä¸€ç§åœ¨ã€Œå±€åŸŸç½‘ã€å†…è¿æ¥é™„è¿‘è®¾å¤‡çš„æŠ€æœ¯ï¼Œä½¿è®¾å¤‡ä¹‹é—´å¯ä»¥è¿›è¡Œé€šè®¯ã€‚</p>
<h4 id="ä»¥å¤ªç½‘çš„å‘å±•ï¼š">ä»¥å¤ªç½‘çš„å‘å±•ï¼š</h4>
<table>
<thead>
<tr>
<th>æ ‡å‡†</th>
<th>é€Ÿç‡</th>
<th>ä»‹è´¨</th>
<th>æœ€å¤§è·ç¦»</th>
</tr>
</thead>
<tbody>
<tr>
<td>10Base-T</td>
<td>10 Mbps</td>
<td>åŒç»çº¿</td>
<td>100m</td>
</tr>
<tr>
<td>100Base-TX</td>
<td>100 Mbps</td>
<td>åŒç»çº¿</td>
<td>100m</td>
</tr>
<tr>
<td>1000Base-T</td>
<td>1 Gbps</td>
<td>åŒç»çº¿</td>
<td>100m</td>
</tr>
<tr>
<td>10GBase-T</td>
<td>10 Gbps</td>
<td>åŒç»çº¿</td>
<td>100m</td>
</tr>
</tbody>
</table>
<h3 id="MACåœ°å€æœºåˆ¶">MACåœ°å€æœºåˆ¶</h3>
<h4 id="MACåœ°å€ç»“æ„ï¼š">MACåœ°å€ç»“æ„ï¼š</h4>
<p><strong>MACï¼ˆMedia Access Controlï¼‰åœ°å€</strong>æ˜¯ç½‘ç»œæ¥å£çš„ç¡¬ä»¶åœ°å€ï¼Œé•¿åº¦ä¸º48ä½ï¼ˆ6å­—èŠ‚ï¼‰ï¼Œé€šå¸¸ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼š</p>
<ul>
<li><strong>æ ¼å¼</strong>ï¼šXX:XX:XX:XX:XX:XXï¼ˆå¦‚ 00:1B:44:11:3A:B7ï¼‰</li>
<li><strong>å…¨çƒå”¯ä¸€</strong>ï¼šç”±IEEEç»Ÿä¸€åˆ†é…ï¼Œç†è®ºä¸Šæ¯ä¸ªç½‘å¡éƒ½æœ‰å”¯ä¸€çš„MACåœ°å€</li>
<li><strong>å‚å•†æ ‡è¯†</strong>ï¼šå‰3å­—èŠ‚æ˜¯å‚å•†æ ‡è¯†ï¼ˆOUIï¼ŒOrganizationally Unique Identifierï¼‰</li>
</ul>
<h4 id="MACåœ°å€-vs-IPåœ°å€ï¼š">MACåœ°å€ vs IPåœ°å€ï¼š</h4>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>MACåœ°å€</th>
<th>IPåœ°å€</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ä½œç”¨èŒƒå›´</strong></td>
<td>æœ¬åœ°é“¾è·¯ï¼ˆå±€åŸŸç½‘ï¼‰</td>
<td>å…¨çƒäº’è”ç½‘</td>
</tr>
<tr>
<td><strong>åˆ†é…æ–¹å¼</strong></td>
<td>ç¡¬ä»¶å›ºåŒ–ï¼Œå…¨çƒå”¯ä¸€</td>
<td>ç½‘ç»œç®¡ç†å‘˜åˆ†é…ï¼Œå¯å˜</td>
</tr>
<tr>
<td><strong>åœ°å€ç»“æ„</strong></td>
<td>å¹³é¢åœ°å€ï¼Œæ— å±‚æ¬¡æ€§</td>
<td>å±‚æ¬¡åœ°å€ï¼Œæœ‰ç½‘ç»œå·å’Œä¸»æœºå·</td>
</tr>
<tr>
<td><strong>è·¯ç”±æ”¯æŒ</strong></td>
<td>ä¸æ”¯æŒè·¯ç”±</td>
<td>æ”¯æŒè·¯ç”±</td>
</tr>
</tbody>
</table>
<h4 id="ä¸ºä»€ä¹ˆéœ€è¦MACåœ°å€ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦MACåœ°å€ï¼Ÿ</h4>
<p>è™½ç„¶IPåœ°å€å¯ä»¥æ ‡è¯†ç½‘ç»œä¸­çš„ä¸»æœºï¼Œä½†åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œè®¾å¤‡ä¹‹é—´çš„ç›´æ¥é€šä¿¡å¿…é¡»ä½¿ç”¨MACåœ°å€ï¼ŒåŸå› åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>å±€åŸŸç½‘å·¥ä½œæœºåˆ¶</strong>ï¼šä»¥å¤ªç½‘äº¤æ¢æœºå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œåªèƒ½è¯†åˆ«MACåœ°å€</li>
<li><strong>ARPåè®®</strong>ï¼šå°†IPåœ°å€è§£æä¸ºMACåœ°å€ï¼Œå®ç°IPå±‚åˆ°é“¾è·¯å±‚çš„æ˜ å°„</li>
<li><strong>å¸§è½¬å‘</strong>ï¼šåŒä¸€ç½‘ç»œå†…çš„æ•°æ®ä¼ è¾“åŸºäºMACåœ°å€è¿›è¡Œå¸§è½¬å‘</li>
</ol>
<h3 id="ARPåè®®">ARPåè®®</h3>
<h4 id="ARPå·¥ä½œåŸç†ï¼š">ARPå·¥ä½œåŸç†ï¼š</h4>
<p>**ARPï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰**ç”¨äºå°†IPåœ°å€è§£æä¸ºMACåœ°å€ã€‚</p>
<p><strong>ARPå·¥ä½œè¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li><strong>å‘é€ARPè¯·æ±‚</strong>ï¼šä¸»æœºAè¦ä¸ä¸»æœºBé€šä¿¡ï¼Œä½†åªçŸ¥é“Bçš„IPåœ°å€</li>
<li><strong>å¹¿æ’­æŸ¥è¯¢</strong>ï¼šAåœ¨å±€åŸŸç½‘å†…å¹¿æ’­ARPè¯·æ±‚&quot;è°æœ‰IPåœ°å€Xï¼Ÿ&quot;</li>
<li><strong>ç›®æ ‡å“åº”</strong>ï¼šæ‹¥æœ‰è¯¥IPåœ°å€çš„ä¸»æœºBå›å¤è‡ªå·±çš„MACåœ°å€</li>
<li><strong>ç¼“å­˜è®°å½•</strong>ï¼šAå°†IP-MACæ˜ å°„å…³ç³»å­˜å‚¨åœ¨ARPç¼“å­˜è¡¨ä¸­</li>
<li><strong>å‘é€æ•°æ®</strong>ï¼šAä½¿ç”¨è·å¾—çš„MACåœ°å€æ„é€ ä»¥å¤ªç½‘å¸§å¹¶å‘é€</li>
</ol>
<h4 id="ARPç¼“å­˜è¡¨ï¼š">ARPç¼“å­˜è¡¨ï¼š</h4>
<p>æ“ä½œç³»ç»Ÿç»´æŠ¤ARPç¼“å­˜è¡¨ï¼Œé¿å…é‡å¤æŸ¥è¯¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ARPç¼“å­˜è¡¨</span></span><br><span class="line">arp -a</span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹ï¼š</span></span><br><span class="line">192.168.1.1 (192.168.1.1) at 00:1a:2b:3c:4d:5e [ether] on eth0</span><br><span class="line">192.168.1.100 (192.168.1.100) at 00:11:22:33:44:55 [ether] on eth0</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®å¸§ç»“æ„">æ•°æ®å¸§ç»“æ„</h3>
<h4 id="ä»¥å¤ªç½‘å¸§æ ¼å¼ï¼š">ä»¥å¤ªç½‘å¸§æ ¼å¼ï¼š</h4>
<p>ä»¥å¤ªç½‘å¸§çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å‰å¯¼ç¬¦</th>
<th>ç›®æ ‡MAC</th>
<th>æºMAC</th>
<th>ç±»å‹/é•¿åº¦</th>
<th>æ•°æ®</th>
<th>FCS</th>
</tr>
</thead>
<tbody>
<tr>
<td>8å­—èŠ‚</td>
<td>6å­—èŠ‚</td>
<td>6å­—èŠ‚</td>
<td>2å­—èŠ‚</td>
<td>46-1500å­—èŠ‚</td>
<td>4å­—èŠ‚</td>
</tr>
</tbody>
</table>
<p><strong>å­—æ®µè¯´æ˜</strong>ï¼š</p>
<ul>
<li><strong>å‰å¯¼ç¬¦</strong>ï¼šç”¨äºåŒæ­¥ï¼ŒåŒ…å«å¸§èµ·å§‹å®šç•Œç¬¦</li>
<li><strong>ç›®æ ‡MACåœ°å€</strong>ï¼šæ¥æ”¶æ–¹çš„MACåœ°å€</li>
<li><strong>æºMACåœ°å€</strong>ï¼šå‘é€æ–¹çš„MACåœ°å€</li>
<li><strong>ç±»å‹/é•¿åº¦</strong>ï¼šæŒ‡ç¤ºä¸Šå±‚åè®®ç±»å‹ï¼ˆå¦‚0x0800è¡¨ç¤ºIPv4ï¼‰</li>
<li><strong>æ•°æ®</strong>ï¼šæ¥è‡ªç½‘ç»œå±‚çš„IPæ•°æ®æŠ¥</li>
<li><strong>FCS</strong>ï¼šå¸§æ ¡éªŒåºåˆ—ï¼Œç”¨äºé”™è¯¯æ£€æµ‹</li>
</ul>
<h3 id="ç½‘ç»œæ¥å£å±‚çš„ä¸»è¦åŠŸèƒ½">ç½‘ç»œæ¥å£å±‚çš„ä¸»è¦åŠŸèƒ½</h3>
<ol>
<li><strong>æˆå¸§</strong>ï¼šå°†ç½‘ç»œå±‚çš„IPæ•°æ®æŠ¥å°è£…æˆå¸§</li>
<li><strong>ç‰©ç†å¯»å€</strong>ï¼šä½¿ç”¨MACåœ°å€åœ¨å±€åŸŸç½‘å†…å®šä½è®¾å¤‡</li>
<li><strong>é”™è¯¯æ£€æµ‹</strong>ï¼šé€šè¿‡æ ¡éªŒå’Œæ£€æµ‹ä¼ è¾“é”™è¯¯</li>
<li><strong>æµé‡æ§åˆ¶</strong>ï¼šæ§åˆ¶å¸§çš„å‘é€é€Ÿç‡</li>
<li><strong>ä»‹è´¨è®¿é—®æ§åˆ¶</strong>ï¼šç®¡ç†å¤šä¸ªè®¾å¤‡å¯¹å…±äº«ä»‹è´¨çš„è®¿é—®</li>
</ol>
<h2 id="æ•°æ®å°è£…ä¸ä¼ è¾“è¿‡ç¨‹">æ•°æ®å°è£…ä¸ä¼ è¾“è¿‡ç¨‹</h2>
<h3 id="å‘é€è¿‡ç¨‹ï¼ˆæ•°æ®å°è£…ï¼‰">å‘é€è¿‡ç¨‹ï¼ˆæ•°æ®å°è£…ï¼‰</h3>
<p>å½“åº”ç”¨ç¨‹åºå‘é€æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šç»å†ä»¥ä¸‹å°è£…è¿‡ç¨‹ï¼š</p>
<ol>
<li><strong>åº”ç”¨å±‚</strong>ï¼šäº§ç”Ÿåº”ç”¨æ•°æ®ï¼ˆå¦‚HTTPè¯·æ±‚ï¼‰</li>
<li><strong>ä¼ è¾“å±‚</strong>ï¼šæ·»åŠ TCP/UDPå¤´éƒ¨ï¼Œå½¢æˆæ®µï¼ˆSegmentï¼‰</li>
<li><strong>ç½‘ç»œå±‚</strong>ï¼šæ·»åŠ IPå¤´éƒ¨ï¼Œå½¢æˆæ•°æ®æŠ¥ï¼ˆPacketï¼‰</li>
<li><strong>ç½‘ç»œæ¥å£å±‚</strong>ï¼šæ·»åŠ ä»¥å¤ªç½‘å¤´éƒ¨å’Œå°¾éƒ¨ï¼Œå½¢æˆå¸§ï¼ˆFrameï¼‰</li>
</ol>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000266759.png" alt="1750000266759"></p>
<h3 id="æ¥æ”¶è¿‡ç¨‹ï¼ˆæ•°æ®è§£å°è£…ï¼‰">æ¥æ”¶è¿‡ç¨‹ï¼ˆæ•°æ®è§£å°è£…ï¼‰</h3>
<p>å½“ç›®æ ‡ä¸»æœºæ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œä¼šè¿›è¡Œç›¸åçš„è§£å°è£…è¿‡ç¨‹ï¼š</p>
<ol>
<li><strong>ç½‘ç»œæ¥å£å±‚</strong>ï¼šæ£€æŸ¥å¸§æ ¡éªŒå’Œï¼Œç§»é™¤ä»¥å¤ªç½‘å¤´éƒ¨å’Œå°¾éƒ¨</li>
<li><strong>ç½‘ç»œå±‚</strong>ï¼šæ£€æŸ¥IPå¤´éƒ¨ï¼Œç¡®è®¤æ˜¯å¦ä¸ºæœ¬æœºæ•°æ®ï¼Œç§»é™¤IPå¤´éƒ¨</li>
<li><strong>ä¼ è¾“å±‚</strong>ï¼šæ ¹æ®ç«¯å£å·æ‰¾åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œç§»é™¤TCP/UDPå¤´éƒ¨</li>
<li><strong>åº”ç”¨å±‚</strong>ï¼šæ¥æ”¶åˆ°çº¯å‡€çš„åº”ç”¨æ•°æ®</li>
</ol>
<h3 id="å®é™…ä¼ è¾“ç¤ºä¾‹">å®é™…ä¼ è¾“ç¤ºä¾‹</h3>
<p><strong>åœºæ™¯</strong>ï¼šç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://www.example.com</code></p>
<p><strong>è¯¦ç»†è¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li>
<p><strong>DNSè§£æ</strong>ï¼š</p>
<ul>
<li>æµè§ˆå™¨å‘é€DNSæŸ¥è¯¢è·å– <a href="http://www.example.com">www.example.com</a> çš„IPåœ°å€</li>
<li>DNSæœåŠ¡å™¨è¿”å›IPåœ°å€ï¼ˆå¦‚ 93.184.216.34ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å»ºç«‹TCPè¿æ¥</strong>ï¼š</p>
<ul>
<li>æµè§ˆå™¨å‘ç›®æ ‡IPçš„80ç«¯å£å‘èµ·TCPè¿æ¥</li>
<li>è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</li>
</ul>
</li>
<li>
<p><strong>å‘é€HTTPè¯·æ±‚</strong>ï¼š</p>
<ul>
<li>åº”ç”¨å±‚ï¼šæ„é€ HTTP GETè¯·æ±‚</li>
<li>ä¼ è¾“å±‚ï¼šæ·»åŠ TCPå¤´éƒ¨ï¼ˆæºç«¯å£ï¼šåŠ¨æ€åˆ†é…ï¼Œç›®æ ‡ç«¯å£ï¼š80ï¼‰</li>
<li>ç½‘ç»œå±‚ï¼šæ·»åŠ IPå¤´éƒ¨ï¼ˆæºIPï¼šæœ¬æœºIPï¼Œç›®æ ‡IPï¼š93.184.216.34ï¼‰</li>
<li>ç½‘ç»œæ¥å£å±‚ï¼šæ·»åŠ ä»¥å¤ªç½‘å¤´éƒ¨ï¼ˆç›®æ ‡MACï¼šç½‘å…³MACåœ°å€ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è·¯ç”±è½¬å‘</strong>ï¼š</p>
<ul>
<li>æ•°æ®å¸§é¦–å…ˆå‘é€åˆ°æœ¬åœ°ç½‘å…³</li>
<li>è·¯ç”±å™¨æ ¹æ®è·¯ç”±è¡¨é€è·³è½¬å‘æ•°æ®åŒ…</li>
<li>æ¯ä¸€è·³éƒ½ä¼šé‡æ–°å°è£…é“¾è·¯å±‚å¤´éƒ¨</li>
</ul>
</li>
<li>
<p><strong>æœåŠ¡å™¨å“åº”</strong>ï¼š</p>
<ul>
<li>WebæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå¤„ç†åè¿”å›HTMLå†…å®¹</li>
<li>å“åº”æ•°æ®ç»è¿‡ç›¸åŒçš„å°è£…å’Œè·¯ç”±è¿‡ç¨‹è¿”å›ç»™å®¢æˆ·ç«¯</li>
</ul>
</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<h3 id="TCP-IPå››å±‚æ¨¡å‹æ¦‚è§ˆ">TCP/IPå››å±‚æ¨¡å‹æ¦‚è§ˆ</h3>
<p>TCP/IPç½‘ç»œæ¨¡å‹ä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºå››å±‚ï¼Œæ¯å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£ï¼š</p>
<p><img src="/2025/06/15/%E5%85%AB%E8%82%A1%E6%96%87/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/TCP-IP%E7%BD%91%E7%BB%9C%E5%B1%82%E7%BB%93%E6%9E%84/1750000261014.png" alt="1750000261014"></p>
<h3 id="å„å±‚çš„æ ¸å¿ƒèŒè´£">å„å±‚çš„æ ¸å¿ƒèŒè´£</h3>
<ol>
<li>
<p><strong>åº”ç”¨å±‚</strong>ï¼š</p>
<ul>
<li>ä¸ºç”¨æˆ·æä¾›ç½‘ç»œåº”ç”¨æœåŠ¡</li>
<li>å¤„ç†åº”ç”¨åè®®ï¼ˆHTTPã€FTPã€SMTPç­‰ï¼‰</li>
<li>å·¥ä½œåœ¨ç”¨æˆ·æ€</li>
</ul>
</li>
<li>
<p><strong>ä¼ è¾“å±‚</strong>ï¼š</p>
<ul>
<li>æä¾›ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“æœåŠ¡</li>
<li>å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼ˆç«¯å£å·æœºåˆ¶ï¼‰</li>
<li>æä¾›å¯é æ€§ä¿éšœï¼ˆTCPï¼‰æˆ–é«˜æ•ˆä¼ è¾“ï¼ˆUDPï¼‰</li>
</ul>
</li>
<li>
<p><strong>ç½‘ç»œå±‚</strong>ï¼š</p>
<ul>
<li>å®ç°ä¸»æœºé—´çš„æ•°æ®ä¼ è¾“</li>
<li>æä¾›è·¯ç”±å’Œå¯»å€åŠŸèƒ½</li>
<li>å¤„ç†æ•°æ®åŒ…çš„è·¨ç½‘ç»œä¼ è¾“</li>
</ul>
</li>
<li>
<p><strong>ç½‘ç»œæ¥å£å±‚</strong>ï¼š</p>
<ul>
<li>å¤„ç†ç‰©ç†ç½‘ç»œä¸Šçš„æ•°æ®ä¼ è¾“</li>
<li>å®ç°å¸§çš„å°è£…å’Œè§£å°è£…</li>
<li>æä¾›ç¡¬ä»¶å¯»å€ï¼ˆMACåœ°å€ï¼‰</li>
</ul>
</li>
</ol>
<h3 id="æ•°æ®ä¼ è¾“å•ä½">æ•°æ®ä¼ è¾“å•ä½</h3>
<table>
<thead>
<tr>
<th>å±‚æ¬¡</th>
<th>ä¼ è¾“å•ä½</th>
<th>ä¸»è¦å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>åº”ç”¨å±‚</td>
<td>æ¶ˆæ¯/æŠ¥æ–‡ï¼ˆMessageï¼‰</td>
<td>åº”ç”¨æ•°æ®</td>
</tr>
<tr>
<td>ä¼ è¾“å±‚</td>
<td>æ®µï¼ˆSegmentï¼‰</td>
<td>TCP/UDPå¤´éƒ¨ + åº”ç”¨æ•°æ®</td>
</tr>
<tr>
<td>ç½‘ç»œå±‚</td>
<td>æ•°æ®æŠ¥/åŒ…ï¼ˆPacketï¼‰</td>
<td>IPå¤´éƒ¨ + æ®µ</td>
</tr>
<tr>
<td>ç½‘ç»œæ¥å£å±‚</td>
<td>å¸§ï¼ˆFrameï¼‰</td>
<td>ä»¥å¤ªç½‘å¤´éƒ¨ + æ•°æ®æŠ¥ + æ ¡éªŒ</td>
</tr>
</tbody>
</table>
<h3 id="è®¾è®¡ä¼˜åŠ¿">è®¾è®¡ä¼˜åŠ¿</h3>
<p>TCP/IPåˆ†å±‚è®¾è®¡çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå„å±‚åŠŸèƒ½ç‹¬ç«‹ï¼Œä¾¿äºå¼€å‘å’Œç»´æŠ¤</li>
<li><strong>æ ‡å‡†åŒ–æ¥å£</strong>ï¼šå±‚é—´é€šè¿‡æ ‡å‡†æ¥å£é€šä¿¡ï¼Œä¿è¯äº’æ“ä½œæ€§</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šå¯ä»¥ç‹¬ç«‹å‡çº§æŸä¸€å±‚è€Œä¸å½±å“å…¶ä»–å±‚</li>
<li><strong>å¤æ‚æ€§ç®¡ç†</strong>ï¼šå°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºç®€å•çš„å­é—®é¢˜</li>
<li><strong>å‚å•†ä¸­ç«‹</strong>ï¼šä¸åŒå‚å•†çš„è®¾å¤‡å¯ä»¥äº’è”äº’é€š</li>
</ol>
<p>è¿™ç§åˆ†å±‚è®¾è®¡ä½¿å¾—äº’è”ç½‘èƒ½å¤Ÿæˆä¸ºä¸€ä¸ªå¼€æ”¾ã€å¯æ‰©å±•ã€å¯äº’æ“ä½œçš„å…¨çƒç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œä¸ºç°ä»£ä¿¡æ¯ç¤¾ä¼šçš„å‘å±•å¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åç«¯</tag>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 112 - è·¯å¾„æ€»å’Œï¼ˆPath Sumï¼‰</title>
    <url>/2025/06/15/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-112-%E8%B7%AF%E5%BE%84%E6%80%BB%E5%92%8C/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> å’Œä¸€ä¸ªè¡¨ç¤ºç›®æ ‡å’Œçš„æ•´æ•° <code>targetSum</code>ï¼Œåˆ¤æ–­è¯¥æ ‘ä¸­æ˜¯å¦å­˜åœ¨ <strong>æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹</strong> çš„è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹å€¼ç›¸åŠ ç­‰äºç›®æ ‡å’Œ <code>targetSum</code>ã€‚</p>
<p><strong>å¶å­èŠ‚ç‚¹</strong> æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [5,4,8,11,null,13,4,7,2,null,null,null,1], targetSum = 22</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è·¯å¾„ï¼š5 â†’ 4 â†’ 11 â†’ 2ï¼Œå’Œä¸º 22</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/15/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-112-%E8%B7%AF%E5%BE%84%E6%80%BB%E5%92%8C/1749983022014.png" alt="1749983022014"></p>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [1,2,3], targetSum = 5</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼šæ ‘ä¸­å­˜åœ¨ä¸¤æ¡æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ï¼š</span><br><span class="line">(1 â†’ 2): å’Œä¸º 3</span><br><span class="line">(1 â†’ 3): å’Œä¸º 4</span><br><span class="line">ä¸å­˜åœ¨å’Œä¸º 5 çš„æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/15/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-112-%E8%B7%AF%E5%BE%84%E6%80%BB%E5%92%8C/1749983039532.png" alt="1749983039532"></p>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [], targetSum = 0</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼šç”±äºæ ‘æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ <code>[0, 5000]</code> å†…</li>
<li><code>-1000 &lt;= Node.val &lt;= 1000</code></li>
<li><code>-1000 &lt;= targetSum &lt;= 1000</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨ <strong>é€’å½’</strong> å’Œ <strong>æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰</strong> æ¥éå†äºŒå‰æ ‘çš„æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚</p>
<h3 id="æ ¸å¿ƒæ€è·¯åˆ†æ">æ ¸å¿ƒæ€è·¯åˆ†æ</h3>
<ol>
<li>
<p><strong>é€’å½’ç»“æ„</strong>ï¼šå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸€æ¡ä»è¯¥èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„å’Œç­‰äºå‰©ä½™çš„ç›®æ ‡å€¼ã€‚</p>
</li>
<li>
<p><strong>çŠ¶æ€è½¬ç§»</strong>ï¼šæ¯å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå°†ç›®æ ‡å’Œå‡å»å½“å‰èŠ‚ç‚¹çš„å€¼ï¼Œç„¶åé€’å½’åœ°åœ¨å·¦å³å­æ ‘ä¸­å¯»æ‰¾å‰©ä½™ç›®æ ‡å’Œçš„è·¯å¾„ã€‚</p>
</li>
<li>
<p><strong>è¾¹ç•Œæ¡ä»¶</strong>ï¼š</p>
<ul>
<li>å¦‚æœèŠ‚ç‚¹ä¸ºç©ºï¼Œè¿”å› <code>false</code></li>
<li>å¦‚æœèŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ä¸”èŠ‚ç‚¹å€¼ç­‰äºå‰©ä½™ç›®æ ‡å’Œï¼Œè¿”å› <code>true</code></li>
</ul>
</li>
<li>
<p><strong>é€’å½’é€»è¾‘</strong>ï¼šå¯¹äºéå¶å­èŠ‚ç‚¹ï¼Œåªè¦å·¦å­æ ‘æˆ–å³å­æ ‘ä¸­å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è·¯å¾„ï¼Œå°±è¿”å› <code>true</code>ã€‚</p>
</li>
</ol>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li><strong>ç©ºæ ‘å¤„ç†</strong>ï¼šå¦‚æœæ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œç›´æ¥è¿”å› <code>false</code></li>
<li><strong>å¶å­èŠ‚ç‚¹åˆ¤æ–­</strong>ï¼šå¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œæ£€æŸ¥å…¶å€¼æ˜¯å¦ç­‰äºå‰©ä½™çš„ç›®æ ‡å’Œ</li>
<li><strong>é€’å½’æœç´¢</strong>ï¼šå¯¹äºéå¶å­èŠ‚ç‚¹ï¼Œé€’å½’æœç´¢å·¦å³å­æ ‘ï¼Œç›®æ ‡å’Œæ›´æ–°ä¸º <code>targetSum - root.Val</code></li>
<li><strong>ç»“æœåˆå¹¶</strong>ï¼šåªè¦å·¦å­æ ‘æˆ–å³å­æ ‘ä¸­æœ‰ä¸€æ¡è·¯å¾„æ»¡è¶³æ¡ä»¶ï¼Œå°±è¿”å› <code>true</code></li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>è®©æˆ‘ä»¬é€æ­¥åˆ†æä»£ç å®ç°ï¼š</p>
<h3 id="Go-è¯­è¨€å®ç°">Go è¯­è¨€å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasPathSum</span><span class="params">(root *TreeNode, targetSum <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// è¾¹ç•Œæ¡ä»¶ï¼šç©ºæ ‘æ²¡æœ‰è·¯å¾„</span></span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¶å­èŠ‚ç‚¹ï¼šæ£€æŸ¥å½“å‰èŠ‚ç‚¹å€¼æ˜¯å¦ç­‰äºå‰©ä½™ç›®æ ‡å’Œ</span></span><br><span class="line">    <span class="keyword">if</span> root.Left == <span class="literal">nil</span> &amp;&amp; root.Right == <span class="literal">nil</span> &amp;&amp; root.Val == targetSum &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€’å½’æœç´¢å·¦å³å­æ ‘ï¼Œç›®æ ‡å’Œå‡å»å½“å‰èŠ‚ç‚¹å€¼</span></span><br><span class="line">    <span class="keyword">return</span> hasPathSum(root.Left, targetSum-root.Val) ||</span><br><span class="line">           hasPathSum(root.Right, targetSum-root.Val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç å…³é”®ç‚¹è§£æ">ä»£ç å…³é”®ç‚¹è§£æ</h3>
<ol>
<li>
<p><strong>ç©ºèŠ‚ç‚¹å¤„ç†</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“éå†åˆ°ç©ºèŠ‚ç‚¹æ—¶ï¼Œè¯´æ˜è¿™æ¡è·¯å¾„æ— æ³•åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œè¿”å› <code>false</code>ã€‚</p>
</li>
<li>
<p><strong>å¶å­èŠ‚ç‚¹åˆ¤æ–­</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> root.Left == <span class="literal">nil</span> &amp;&amp; root.Right == <span class="literal">nil</span> &amp;&amp; root.Val == targetSum &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åªæœ‰å½“èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼ˆå·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼‰ä¸”èŠ‚ç‚¹å€¼ç­‰äºå‰©ä½™ç›®æ ‡å’Œæ—¶ï¼Œæ‰æ‰¾åˆ°äº†æ»¡è¶³æ¡ä»¶çš„è·¯å¾„ã€‚</p>
</li>
<li>
<p><strong>é€’å½’æœç´¢</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> hasPathSum(root.Left, targetSum-root.Val) ||</span><br><span class="line">       hasPathSum(root.Right, targetSum-root.Val)</span><br></pre></td></tr></table></figure>
<p>é€’å½’åœ°åœ¨å·¦å³å­æ ‘ä¸­å¯»æ‰¾è·¯å¾„ï¼Œç›®æ ‡å’Œæ›´æ–°ä¸º <code>targetSum - root.Val</code>ã€‚ä½¿ç”¨é€»è¾‘æˆ–æ“ä½œç¬¦ï¼Œåªè¦æœ‰ä¸€æ¡è·¯å¾„æ»¡è¶³æ¡ä»¶å°±è¿”å› <code>true</code>ã€‚</p>
</li>
</ol>
<h2 id="ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h2>
<p>ä»¥ç¤ºä¾‹ 1 ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬è·Ÿè¸ªç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ ‘ç»“æ„ï¼š     5     targetSum = 22</span><br><span class="line">           / \</span><br><span class="line">          4   8</span><br><span class="line">         /   / \</span><br><span class="line">        11  13  4</span><br><span class="line">       / \      \</span><br><span class="line">      7   2      1</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œè¿‡ç¨‹ï¼š</span><br><span class="line">1. hasPathSum(5, 22)</span><br><span class="line">   - ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé€’å½’è°ƒç”¨å­æ ‘</span><br><span class="line">   - hasPathSum(4, 17) || hasPathSum(8, 14)</span><br><span class="line"></span><br><span class="line">2. hasPathSum(4, 17)</span><br><span class="line">   - ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé€’å½’è°ƒç”¨</span><br><span class="line">   - hasPathSum(11, 13) || hasPathSum(null, 13)</span><br><span class="line"></span><br><span class="line">3. hasPathSum(11, 13)</span><br><span class="line">   - ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé€’å½’è°ƒç”¨</span><br><span class="line">   - hasPathSum(7, 6) || hasPathSum(2, 11)</span><br><span class="line"></span><br><span class="line">4. hasPathSum(7, 6)</span><br><span class="line">   - æ˜¯å¶å­èŠ‚ç‚¹ï¼Œä½† 7 â‰  6ï¼Œè¿”å› false</span><br><span class="line"></span><br><span class="line">5. hasPathSum(2, 11)</span><br><span class="line">   - æ˜¯å¶å­èŠ‚ç‚¹ï¼Œä½† 2 â‰  11ï¼Œè¿”å› false</span><br><span class="line"></span><br><span class="line">6. hasPathSum(null, 13) è¿”å› false</span><br><span class="line"></span><br><span class="line">7. ç»§ç»­æœç´¢å³å­æ ‘...</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆåœ¨è·¯å¾„ 5â†’4â†’11â†’2 æ‰¾åˆ°å’Œä¸º 22 çš„è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼š-O-n">æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$</h3>
<p>å…¶ä¸­ $n$ æ˜¯äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è®¿é—®æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸€æ¬¡æ¥å¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„è·¯å¾„ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼š-O-h">ç©ºé—´å¤æ‚åº¦ï¼š$O(h)$</h3>
<p>å…¶ä¸­ $h$ æ˜¯æ ‘çš„é«˜åº¦ã€‚ç©ºé—´å¤æ‚åº¦ä¸»è¦æ¥è‡ªé€’å½’è°ƒç”¨æ ˆçš„æ·±åº¦ï¼š</p>
<ul>
<li>æœ€å¥½æƒ…å†µï¼ˆå¹³è¡¡æ ‘ï¼‰ï¼š$O(\log n)$</li>
<li>æœ€åæƒ…å†µï¼ˆé€€åŒ–ä¸ºé“¾è¡¨ï¼‰ï¼š$O(n)$</li>
</ul>
<h2 id="ç›¸å…³å˜é¢˜ä¸æ‰©å±•">ç›¸å…³å˜é¢˜ä¸æ‰©å±•</h2>
<ol>
<li><strong>è·¯å¾„æ€»å’Œ IIï¼ˆLeetCode 113ï¼‰</strong>ï¼šè¿”å›æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è·¯å¾„</li>
<li><strong>è·¯å¾„æ€»å’Œ IIIï¼ˆLeetCode 437ï¼‰</strong>ï¼šè·¯å¾„ä¸å¿…ä»æ ¹èŠ‚ç‚¹å¼€å§‹æˆ–åœ¨å¶å­èŠ‚ç‚¹ç»“æŸ</li>
<li><strong>äºŒå‰æ ‘çš„æœ€å¤§è·¯å¾„å’Œï¼ˆLeetCode 124ï¼‰</strong>ï¼šå¯»æ‰¾ä»»æ„è·¯å¾„çš„æœ€å¤§å’Œ</li>
</ol>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>é€’å½’æ€ç»´</strong>ï¼šå°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºç›¸åŒç»“æ„çš„å­é—®é¢˜</li>
<li><strong>çŠ¶æ€ä¼ é€’</strong>ï¼šé€šè¿‡å‚æ•°ä¼ é€’å½“å‰çŠ¶æ€ï¼ˆå‰©ä½™ç›®æ ‡å’Œï¼‰</li>
<li><strong>è¾¹ç•Œæ¡ä»¶</strong>ï¼šæ­£ç¡®å¤„ç†ç©ºèŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹çš„æƒ…å†µ</li>
<li><strong>é€»è¾‘æ“ä½œ</strong>ï¼šåˆç†ä½¿ç”¨é€»è¾‘æˆ–æ“ä½œç¬¦è¿›è¡Œç»“æœåˆå¹¶</li>
</ol>
<p>è¿™é“é¢˜æ˜¯äºŒå‰æ ‘é€’å½’é—®é¢˜çš„ç»å…¸ä»£è¡¨ï¼ŒæŒæ¡äº†è¿™ç§æ€è·¯åï¼Œå¯ä»¥è½»æ¾è§£å†³å¾ˆå¤šç±»ä¼¼çš„æ ‘å½¢ç»“æ„é—®é¢˜ã€‚é‡ç‚¹æ˜¯ç†è§£é€’å½’çš„æœ¬è´¨ï¼š<strong>å°†å¤§é—®é¢˜åˆ†è§£ä¸ºç»“æ„ç›¸åŒçš„å°é—®é¢˜ï¼Œé€šè¿‡è§£å†³å°é—®é¢˜æ¥è§£å†³å¤§é—®é¢˜</strong>ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>é€’å½’</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 117 - å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ IIï¼ˆPopulating Next Right Pointers in Each Node IIï¼‰</title>
    <url>/2025/06/15/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-117-%E5%A1%AB%E5%85%85%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%8F%B3%E4%BE%A7%E8%8A%82%E7%82%B9%E6%8C%87%E9%92%88-ii/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œå¡«å……å®ƒçš„æ¯ä¸ª <code>next</code> æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† <code>next</code> æŒ‡é’ˆè®¾ç½®ä¸º <code>NULL</code>ã€‚</p>
<p>åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ <code>next</code> æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º <code>NULL</code>ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> è¿™é“é¢˜ä¸ç¬¬ 116 é¢˜çš„åŒºåˆ«åœ¨äºï¼Œè¿™é‡Œçš„äºŒå‰æ ‘ä¸ä¸€å®šæ˜¯å®Œç¾äºŒå‰æ ‘ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [1,2,3,4,5,null,7]</span><br><span class="line">è¾“å‡ºï¼š[1,#,2,3,#,4,5,7,#]</span><br><span class="line"></span><br><span class="line">     1 â†’ NULL</span><br><span class="line">   /  \</span><br><span class="line">  2 â†’ 3 â†’ NULL</span><br><span class="line"> / \    \</span><br><span class="line">4â†’ 5 â†’ 7 â†’ NULL</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/15/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-117-%E5%A1%AB%E5%85%85%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%8F%B3%E4%BE%A7%E8%8A%82%E7%82%B9%E6%8C%87%E9%92%88-ii/1749962458461.png" alt="1749962458461"></p>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡åœ¨ <code>[0, 6000]</code> èŒƒå›´å†…</li>
<li><code>-100 &lt;= Node.val &lt;= 100</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯è¦ä¸ºæ¯ä¸€å±‚çš„èŠ‚ç‚¹å»ºç«‹ä»å·¦åˆ°å³çš„è¿æ¥å…³ç³»ã€‚æˆ‘ä»¬éœ€è¦å¤„ç†çš„æ˜¯ä¸€ä¸ª<strong>éå®Œç¾äºŒå‰æ ‘</strong>ï¼Œè¿™æ„å‘³ç€æ¯å±‚çš„èŠ‚ç‚¹æ•°å¯èƒ½ä¸åŒï¼ŒæŸäº›èŠ‚ç‚¹å¯èƒ½æ²¡æœ‰å·¦å­æ ‘æˆ–å³å­æ ‘ã€‚</p>
<p><strong>å…³é”®æ´å¯Ÿï¼š</strong> æˆ‘ä»¬éœ€è¦æŒ‰å±‚å¤„ç†èŠ‚ç‚¹ï¼Œå°†åŒä¸€å±‚çš„èŠ‚ç‚¹ä»å·¦åˆ°å³è¿æ¥èµ·æ¥ã€‚</p>
<p>è®©æˆ‘è¯¦ç»†ä»‹ç»ä¸‰ç§ä¸åŒçš„è§£æ³•ï¼š</p>
<h2 id="è§£æ³•ä¸€ï¼šå“ˆå¸Œè¡¨-æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰">è§£æ³•ä¸€ï¼šå“ˆå¸Œè¡¨ + æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰</h2>
<h3 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3>
<p>ä½¿ç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸€å±‚æœ€å³ä¾§çš„èŠ‚ç‚¹ï¼Œé€šè¿‡ DFS éå†æ—¶ï¼Œå¦‚æœå½“å‰å±‚å·²ç»æœ‰èŠ‚ç‚¹äº†ï¼Œå°±å°†è¯¥èŠ‚ç‚¹çš„ <code>next</code> æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹ï¼Œç„¶åæ›´æ–°å½“å‰å±‚çš„æœ€å³ä¾§èŠ‚ç‚¹ã€‚</p>
<h3 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a Node.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">    Val <span class="type">int</span></span><br><span class="line">    Left *Node</span><br><span class="line">    Right *Node</span><br><span class="line">    Next *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connect</span><span class="params">(root *Node)</span></span> *Node &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å“ˆå¸Œè¡¨è®°å½•æ¯ä¸€å±‚çš„æœ€å³ä¾§èŠ‚ç‚¹</span></span><br><span class="line">    levelMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]*Node)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·±åº¦ä¼˜å…ˆæœç´¢éå†</span></span><br><span class="line">    dfs(root, <span class="number">0</span>, levelMap)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfs</span><span class="params">(node *Node, level <span class="type">int</span>, levelMap <span class="keyword">map</span>[<span class="type">int</span>]*Node)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰å±‚å·²ç»æœ‰èŠ‚ç‚¹äº†ï¼Œå°†å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ next æŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> prevNode, exists := levelMap[level]; exists &#123;</span><br><span class="line">        prevNode.Next = node</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°å½“å‰å±‚çš„æœ€å³ä¾§èŠ‚ç‚¹</span></span><br><span class="line">    levelMap[level] = node</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…ˆéå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘ï¼ˆä¿è¯ä»å·¦åˆ°å³çš„é¡ºåºï¼‰</span></span><br><span class="line">    dfs(node.Left, level+<span class="number">1</span>, levelMap)</span><br><span class="line">    dfs(node.Right, level+<span class="number">1</span>, levelMap)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>ä»¥ç¤ºä¾‹æ ‘ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">     1</span><br><span class="line">   /  \</span><br><span class="line">  2    3</span><br><span class="line"> / \    \</span><br><span class="line">4   5    7</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>Level 0</strong>: å¤„ç†èŠ‚ç‚¹ 1ï¼Œ<code>levelMap[0] = 1</code></li>
<li><strong>Level 1</strong>: å¤„ç†èŠ‚ç‚¹ 2ï¼Œ<code>levelMap[1] = 2</code>ï¼›å¤„ç†èŠ‚ç‚¹ 3ï¼Œ<code>2.next = 3</code>ï¼Œ<code>levelMap[1] = 3</code></li>
<li><strong>Level 2</strong>: å¤„ç†èŠ‚ç‚¹ 4ï¼Œ<code>levelMap[2] = 4</code>ï¼›å¤„ç†èŠ‚ç‚¹ 5ï¼Œ<code>4.next = 5</code>ï¼Œ<code>levelMap[2] = 5</code>ï¼›å¤„ç†èŠ‚ç‚¹ 7ï¼Œ<code>5.next = 7</code>ï¼Œ<code>levelMap[2] = 7</code></li>
</ol>
<h2 id="è§£æ³•äºŒï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰-å±‚åºéå†">è§£æ³•äºŒï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰+ å±‚åºéå†</h2>
<h3 id="æ ¸å¿ƒæ€æƒ³-2">æ ¸å¿ƒæ€æƒ³</h3>
<p>ä½¿ç”¨é˜Ÿåˆ—è¿›è¡Œå±‚åºéå†ï¼Œé€å±‚å¤„ç†èŠ‚ç‚¹ã€‚å¯¹äºæ¯ä¸€å±‚ï¼Œæˆ‘ä»¬çŸ¥é“è¯¥å±‚çš„èŠ‚ç‚¹æ•°é‡ï¼Œå¯ä»¥å°†åŒä¸€å±‚çš„èŠ‚ç‚¹ä¾æ¬¡è¿æ¥èµ·æ¥ã€‚</p>
<h3 id="å®ç°ç»†èŠ‚-2">å®ç°ç»†èŠ‚</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connectBFS</span><span class="params">(root *Node)</span></span> *Node &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨é˜Ÿåˆ—è¿›è¡Œå±‚åºéå†</span></span><br><span class="line">    queue := []*Node&#123;root&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        size := <span class="built_in">len</span>(queue) <span class="comment">// å½“å‰å±‚çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¤„ç†å½“å‰å±‚çš„æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; size; i++ &#123;</span><br><span class="line">            node := queue[<span class="number">0</span>]</span><br><span class="line">            queue = queue[<span class="number">1</span>:] <span class="comment">// å‡ºé˜Ÿ</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœä¸æ˜¯å½“å‰å±‚çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿æ¥åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> i &lt; size<span class="number">-1</span> &#123;</span><br><span class="line">                node.Next = queue[<span class="number">0</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å°†å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">            <span class="keyword">if</span> node.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">                queue = <span class="built_in">append</span>(queue, node.Left)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> node.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">                queue = <span class="built_in">append</span>(queue, node.Right)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ-2">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹: queue = [1]</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€è½® (Level 0):</span><br><span class="line">- size = 1</span><br><span class="line">- å¤„ç†èŠ‚ç‚¹ 1ï¼Œqueue = [2, 3]</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒè½® (Level 1):</span><br><span class="line">- size = 2</span><br><span class="line">- å¤„ç†èŠ‚ç‚¹ 2ï¼Œ2.next = 3ï¼Œqueue = [3, 4, 5]</span><br><span class="line">- å¤„ç†èŠ‚ç‚¹ 3ï¼Œqueue = [4, 5, 7]</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸‰è½® (Level 2):</span><br><span class="line">- size = 3</span><br><span class="line">- å¤„ç†èŠ‚ç‚¹ 4ï¼Œ4.next = 5ï¼Œqueue = [5, 7]</span><br><span class="line">- å¤„ç†èŠ‚ç‚¹ 5ï¼Œ5.next = 7ï¼Œqueue = [7]</span><br><span class="line">- å¤„ç†èŠ‚ç‚¹ 7ï¼Œqueue = []</span><br></pre></td></tr></table></figure>
<h2 id="è§£æ³•ä¸‰ï¼šO-1-ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–">è§£æ³•ä¸‰ï¼šO(1) ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–</h2>
<h3 id="æ ¸å¿ƒæ€æƒ³-3">æ ¸å¿ƒæ€æƒ³</h3>
<p>åˆ©ç”¨å·²ç»å»ºç«‹çš„ <code>next</code> æŒ‡é’ˆæ¥éå†ä¸‹ä¸€å±‚ï¼Œä¸ä½¿ç”¨é¢å¤–çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼š</p>
<ul>
<li><code>levelStart</code>: å½“å‰å±‚çš„èµ·å§‹èŠ‚ç‚¹</li>
<li><code>prev</code>: ä¸‹ä¸€å±‚çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</li>
</ul>
<h3 id="å®ç°ç»†èŠ‚-3">å®ç°ç»†èŠ‚</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connectOptimized</span><span class="params">(root *Node)</span></span> *Node &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// levelStart æŒ‡å‘å½“å‰å±‚çš„èµ·å§‹èŠ‚ç‚¹</span></span><br><span class="line">    levelStart := root</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> levelStart != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> prev *Node     <span class="comment">// ä¸‹ä¸€å±‚çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">var</span> nextStart *Node <span class="comment">// ä¸‹ä¸€å±‚çš„èµ·å§‹èŠ‚ç‚¹</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éå†å½“å‰å±‚çš„æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> node := levelStart; node != <span class="literal">nil</span>; node = node.Next &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> node.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> prev != <span class="literal">nil</span> &#123;</span><br><span class="line">                    prev.Next = node.Left</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nextStart = node.Left <span class="comment">// è®°å½•ä¸‹ä¸€å±‚çš„èµ·å§‹èŠ‚ç‚¹</span></span><br><span class="line">                &#125;</span><br><span class="line">                prev = node.Left</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¤„ç†å³å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> node.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> prev != <span class="literal">nil</span> &#123;</span><br><span class="line">                    prev.Next = node.Right</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nextStart = node.Right <span class="comment">// è®°å½•ä¸‹ä¸€å±‚çš„èµ·å§‹èŠ‚ç‚¹</span></span><br><span class="line">                &#125;</span><br><span class="line">                prev = node.Right</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€å±‚</span></span><br><span class="line">        levelStart = nextStart</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å“ˆå¸Œè¡¨ DFS</th>
<th>é˜Ÿåˆ— BFS</th>
<th>O(1) ç©ºé—´ä¼˜åŒ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç®€å•ï¼Œæ˜“ç†è§£</td>
<td>å±‚æ¬¡æ¸…æ™°ï¼Œç¬¦åˆç›´è§‰</td>
<td>ç©ºé—´æ•ˆç‡æœ€é«˜</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦é¢å¤–å“ˆå¸Œè¡¨</td>
<td>éœ€è¦é˜Ÿåˆ—å­˜å‚¨</td>
<td>å®ç°å¤æ‚ï¼Œç†è§£éš¾åº¦å¤§</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p>æ‰€æœ‰ä¸‰ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ <strong>O(n)</strong>ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚æˆ‘ä»¬éœ€è¦è®¿é—®æ¯ä¸ªèŠ‚ç‚¹æ°å¥½ä¸€æ¬¡ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<ul>
<li><strong>å“ˆå¸Œè¡¨ DFS</strong>: O(n)ï¼Œæœ€åæƒ…å†µä¸‹å“ˆå¸Œè¡¨éœ€è¦å­˜å‚¨æ‰€æœ‰å±‚çš„ä¿¡æ¯</li>
<li><strong>é˜Ÿåˆ— BFS</strong>: O(n)ï¼Œæœ€åæƒ…å†µä¸‹é˜Ÿåˆ—éœ€è¦å­˜å‚¨æœ€åº•å±‚çš„æ‰€æœ‰èŠ‚ç‚¹</li>
<li><strong>O(1) ä¼˜åŒ–</strong>: O(1)ï¼Œåªä½¿ç”¨å¸¸æ•°é¢å¤–ç©ºé—´</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>å±‚åºéå†çš„ä¸¤ç§å®ç°æ–¹å¼</strong>ï¼šé˜Ÿåˆ— BFS å’Œåˆ©ç”¨å·²å»ºç«‹çš„ next æŒ‡é’ˆ</li>
<li><strong>ç©ºé—´ä¼˜åŒ–æŠ€å·§</strong>ï¼šåˆ©ç”¨é—®é¢˜çš„ç‰¹æ®Šæ€§è´¨ï¼ˆnext æŒ‡é’ˆï¼‰æ¥é¿å…ä½¿ç”¨é¢å¤–æ•°æ®ç»“æ„</li>
<li><strong>DFS vs BFS</strong>ï¼šå¯¹äºæ ‘çš„å±‚æ¬¡å¤„ç†ï¼ŒBFS é€šå¸¸æ›´ç›´è§‚ï¼Œä½† DFS é…åˆå“ˆå¸Œè¡¨ä¹Ÿèƒ½è§£å†³</li>
<li><strong>å¸¸è§é™·é˜±</strong>ï¼š
<ul>
<li>å¿˜è®°å¤„ç†ç©ºèŠ‚ç‚¹çš„æƒ…å†µ</li>
<li>åœ¨ O(1) è§£æ³•ä¸­ï¼Œå®¹æ˜“ææ··å½“å‰å±‚å’Œä¸‹ä¸€å±‚çš„æŒ‡é’ˆå…³ç³»</li>
<li>DFS æ—¶è¦æ³¨æ„éå†é¡ºåºï¼ˆå…ˆå·¦åå³ï¼‰</li>
</ul>
</li>
</ol>
<p>è¿™é“é¢˜æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»ƒä¹ ï¼Œå±•ç¤ºäº†å¦‚ä½•ç”¨ä¸åŒçš„æ€è·¯è§£å†³åŒä¸€ä¸ªé—®é¢˜ï¼Œä»¥åŠå¦‚ä½•åœ¨ä¿æŒæ­£ç¡®æ€§çš„å‰æä¸‹ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>å¹¿åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>å±‚åºéå†</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 69 - x çš„å¹³æ–¹æ ¹ï¼ˆSqrt(x)ï¼‰</title>
    <url>/2025/06/13/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-69-x%E7%9A%84%E5%B9%B3%E6%96%B9%E6%A0%B9/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•° xï¼Œè®¡ç®—å¹¶è¿”å› x çš„ç®—æœ¯å¹³æ–¹æ ¹ã€‚</p>
<p>ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œç»“æœåªä¿ç•™<strong>æ•´æ•°éƒ¨åˆ†</strong>ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«<strong>èˆå»</strong>ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šä¸å…è®¸ä½¿ç”¨ä»»ä½•å†…ç½®æŒ‡æ•°å‡½æ•°å’Œç®—ç¬¦ï¼Œä¾‹å¦‚ <code>pow(x, 0.5)</code> æˆ–è€… <code>x ** 0.5</code>ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šx = 4</span><br><span class="line">è¾“å‡ºï¼š2</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šx = 8</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼š8 çš„ç®—æœ¯å¹³æ–¹æ ¹æ˜¯ 2.82842...ï¼Œç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«èˆå»ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>$0 \leq x \leq 2^{31} - 1$</li>
</ul>
<h3 id="æ ¸å¿ƒè¦æ±‚">æ ¸å¿ƒè¦æ±‚</h3>
<ul>
<li>è¿”å›å€¼å¿…é¡»æ˜¯<strong>ä¸è¶…è¿‡çœŸå®å¹³æ–¹æ ¹çš„æœ€å¤§æ•´æ•°</strong></li>
<li>ä¸èƒ½ä½¿ç”¨å†…ç½®çš„å¹³æ–¹æ ¹å‡½æ•°</li>
<li>éœ€è¦å¤„ç†è¾¹ç•Œæƒ…å†µå’Œæ•´æ•°æº¢å‡º</li>
</ul>
<span id="more"></span>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜ç›®çš„æ ¸å¿ƒæ˜¯è¦æ‰¾åˆ°<strong>ä¸è¶…è¿‡çœŸå®å¹³æ–¹æ ¹çš„æœ€å¤§æ•´æ•°</strong>ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜è½¬åŒ–ä¸ºï¼š<strong>åœ¨ [0, x] èŒƒå›´å†…ï¼Œæ‰¾åˆ°æœ€å¤§çš„æ•´æ•° midï¼Œä½¿å¾— midÂ² â‰¤ x</strong>ã€‚</p>
<h3 id="æ ¸å¿ƒæ´å¯Ÿ">æ ¸å¿ƒæ´å¯Ÿ</h3>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>æŸ¥æ‰¾é—®é¢˜</strong>ï¼Œè€Œä¸”æœç´¢ç©ºé—´å…·æœ‰<strong>å•è°ƒæ€§</strong>ï¼š</p>
<ul>
<li>å¦‚æœ midÂ² &gt; xï¼Œé‚£ä¹ˆç­”æ¡ˆä¸€å®šåœ¨ [0, mid-1] èŒƒå›´å†…</li>
<li>å¦‚æœ midÂ² â‰¤ xï¼Œé‚£ä¹ˆ mid å¯èƒ½æ˜¯ç­”æ¡ˆï¼Œä½†æ›´å¤§çš„ç­”æ¡ˆå¯èƒ½åœ¨ [mid+1, x] èŒƒå›´å†…</li>
</ul>
<p>è¿™ç§å•è°ƒæ€§è´¨ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>äºŒåˆ†æŸ¥æ‰¾</strong>æ¥è§£å†³ã€‚</p>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li><strong>åˆå§‹åŒ–æœç´¢èŒƒå›´</strong>ï¼šleft = 0, right = x</li>
<li><strong>äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹</strong>ï¼š
<ul>
<li>è®¡ç®—ä¸­ç‚¹ï¼šmid = (left + right) / 2</li>
<li>æ¯”è¾ƒ midÂ² ä¸ x çš„å…³ç³»ï¼š
<ul>
<li>å¦‚æœ midÂ² = xï¼šæ‰¾åˆ°ç²¾ç¡®å¹³æ–¹æ ¹ï¼Œç›´æ¥è¿”å› mid</li>
<li>å¦‚æœ midÂ² &gt; xï¼šç­”æ¡ˆåœ¨å·¦åŠéƒ¨åˆ†ï¼Œright = mid - 1</li>
<li>å¦‚æœ midÂ² &lt; xï¼šç­”æ¡ˆå¯èƒ½æ˜¯ mid æˆ–åœ¨å³åŠéƒ¨åˆ†ï¼Œleft = mid + 1</li>
</ul>
</li>
</ul>
</li>
<li><strong>è¿”å›ç»“æœ</strong>ï¼šå½“ left &gt; right æ—¶ï¼Œè¿”å› right</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆè¿”å›-rightï¼Ÿ">ä¸ºä»€ä¹ˆè¿”å› rightï¼Ÿ</h3>
<p>å½“äºŒåˆ†æŸ¥æ‰¾ç»“æŸæ—¶ï¼Œæœ‰ left &gt; rightã€‚æ­¤æ—¶ï¼š</p>
<ul>
<li>right æ˜¯<strong>æœ€å¤§çš„æ»¡è¶³ midÂ² â‰¤ x çš„æ•´æ•°</strong></li>
<li>left æ˜¯<strong>æœ€å°çš„æ»¡è¶³ midÂ² &gt; x çš„æ•´æ•°</strong></li>
</ul>
<p>ç”±äºæˆ‘ä»¬è¦æ‰¾çš„æ˜¯ä¸è¶…è¿‡çœŸå®å¹³æ–¹æ ¹çš„æœ€å¤§æ•´æ•°ï¼Œæ‰€ä»¥åº”è¯¥è¿”å› rightã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="è¾¹ç•Œæƒ…å†µå¤„ç†">è¾¹ç•Œæƒ…å†µå¤„ç†</h3>
<ol>
<li><strong>x = 0</strong>ï¼šå¹³æ–¹æ ¹ä¸º 0</li>
<li><strong>x = 1</strong>ï¼šå¹³æ–¹æ ¹ä¸º 1</li>
<li><strong>å¤§æ•°æƒ…å†µ</strong>ï¼šæ³¨æ„ mid * mid å¯èƒ½ä¼šæ•´æ•°æº¢å‡º</li>
</ol>
<h3 id="ç®—æ³•æ‰§è¡Œç¤ºä¾‹">ç®—æ³•æ‰§è¡Œç¤ºä¾‹</h3>
<p>ä»¥ x = 8 ä¸ºä¾‹ï¼Œå±•ç¤ºç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹ï¼šleft = 0, right = 8</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€è½®ï¼šmid = 4, 4Â² = 16 &gt; 8</span><br><span class="line">        â†’ right = 3, left = 0</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒè½®ï¼šmid = 1, 1Â² = 1 &lt; 8  </span><br><span class="line">        â†’ left = 2, right = 3</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸‰è½®ï¼šmid = 2, 2Â² = 4 &lt; 8</span><br><span class="line">        â†’ left = 3, right = 3</span><br><span class="line"></span><br><span class="line">ç¬¬å››è½®ï¼šmid = 3, 3Â² = 9 &gt; 8</span><br><span class="line">        â†’ right = 2, left = 3</span><br><span class="line"></span><br><span class="line">ç»“æŸï¼šleft &gt; rightï¼Œè¿”å› right = 2</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mySqrt</span><span class="params">(x <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    left, right := <span class="number">0</span>, x</span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">        mid := (left + right) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> mid*mid == x &#123;</span><br><span class="line">            <span class="keyword">return</span> mid        <span class="comment">// æ‰¾åˆ°ç²¾ç¡®å¹³æ–¹æ ¹</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> mid*mid &gt; x &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>   <span class="comment">// ç­”æ¡ˆåœ¨å·¦åŠéƒ¨åˆ†</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>    <span class="comment">// ç­”æ¡ˆåœ¨å³åŠéƒ¨åˆ†æˆ–å°±æ˜¯mid</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> right             <span class="comment">// è¿”å›ä¸è¶…è¿‡å¹³æ–¹æ ¹çš„æœ€å¤§æ•´æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç å…³é”®ç‚¹">ä»£ç å…³é”®ç‚¹</h3>
<ol>
<li><strong>æœç´¢èŒƒå›´</strong>ï¼š[0, x] åŒ…å«äº†æ‰€æœ‰å¯èƒ½çš„ç­”æ¡ˆ</li>
<li><strong>ä¸­ç‚¹è®¡ç®—</strong>ï¼š<code>mid = (left + right) / 2</code> é¿å…äº†æº¢å‡ºé—®é¢˜</li>
<li><strong>ä¸‰åˆ†æ”¯åˆ¤æ–­</strong>ï¼šç²¾ç¡®åŒ¹é…ã€è¿‡å¤§ã€è¿‡å°ä¸‰ç§æƒ…å†µ</li>
<li><strong>è¿”å›ç­–ç•¥</strong>ï¼šè¿”å› right ç¡®ä¿å¾—åˆ°æ­£ç¡®çš„æ•´æ•°éƒ¨åˆ†</li>
</ol>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p>$$T(n) = O(\log x)$$</p>
<p><strong>åˆ†æè¿‡ç¨‹</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡è¿­ä»£éƒ½å°†æœç´¢èŒƒå›´ç¼©å°ä¸€åŠ</li>
<li>æœç´¢èŒƒå›´ä» x å¼€å§‹ï¼Œæ¯æ¬¡é™¤ä»¥ 2</li>
<li>æœ€å¤šéœ€è¦ $\log_2 x$ æ¬¡è¿­ä»£</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<p>$$S(n) = O(1)$$</p>
<p>åªä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–å˜é‡ï¼ˆleft, right, midï¼‰ï¼Œç©ºé—´ä½¿ç”¨ä¸éšè¾“å…¥è§„æ¨¡å¢é•¿ã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>äºŒåˆ†æŸ¥æ‰¾æ³•</th>
<th>ç‰›é¡¿è¿­ä»£æ³•</th>
<th>æš´åŠ›æšä¸¾</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(\log x)$</td>
<td>$O(\log x)$</td>
<td>$O(\sqrt{x})$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(1)$</td>
<td>$O(1)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>å®ç°éš¾åº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
</tr>
<tr>
<td>ç¨³å®šæ€§</td>
<td>å¾ˆç¨³å®š</td>
<td>éœ€è¦å¤„ç†ç²¾åº¦é—®é¢˜</td>
<td>å¾ˆç¨³å®š</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="æ‰©å±•æ€è€ƒ">æ‰©å±•æ€è€ƒ</h2>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ol>
<li><strong>LeetCode 367 - Valid Perfect Square</strong>ï¼šåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºå®Œå…¨å¹³æ–¹æ•°</li>
<li><strong>LeetCode 50 - Pow(x, n)</strong>ï¼šå¿«é€Ÿå¹‚ç®—æ³•</li>
<li><strong>äºŒåˆ†æŸ¥æ‰¾çš„å…¶ä»–åº”ç”¨</strong>ï¼šåœ¨å„ç§å•è°ƒå‡½æ•°ä¸Šçš„æŸ¥æ‰¾é—®é¢˜</li>
</ol>
<h3 id="ä¼˜åŒ–æ€è·¯">ä¼˜åŒ–æ€è·¯</h3>
<ol>
<li><strong>æœç´¢èŒƒå›´ä¼˜åŒ–</strong>ï¼šå¯¹äºè¾ƒå¤§çš„ xï¼Œå¯ä»¥å°†å³è¾¹ç•Œè®¾ä¸º min(x, 46340)ï¼Œå› ä¸º 46340Â² æ¥è¿‘ 2Â³Â¹-1</li>
<li><strong>ç‰›é¡¿è¿­ä»£æ³•</strong>ï¼šä½¿ç”¨ $x_{n+1} = \frac{1}{2}(x_n + \frac{a}{x_n})$ å¯ä»¥æ›´å¿«æ”¶æ•›</li>
</ol>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="ç®—æ³•æ€æƒ³">ç®—æ³•æ€æƒ³</h3>
<ol>
<li><strong>äºŒåˆ†æŸ¥æ‰¾çš„æœ¬è´¨</strong>ï¼šåœ¨å•è°ƒåŒºé—´å†…å¿«é€Ÿå®šä½ç›®æ ‡å€¼</li>
<li><strong>é—®é¢˜è½¬åŒ–</strong>ï¼šå°†å¼€æ–¹é—®é¢˜è½¬åŒ–ä¸ºæŸ¥æ‰¾é—®é¢˜</li>
<li><strong>è¾¹ç•Œå¤„ç†</strong>ï¼šç†è§£ä¸ºä»€ä¹ˆè¿”å› right è€Œä¸æ˜¯ left</li>
</ol>
<h3 id="å®ç°æŠ€å·§">å®ç°æŠ€å·§</h3>
<ol>
<li><strong>é¿å…æº¢å‡º</strong>ï¼šä½¿ç”¨é™¤æ³•è€Œä¸æ˜¯ä¹˜æ³•æ¥æ¯”è¾ƒå¤§å°</li>
<li><strong>å¾ªç¯ä¸å˜é‡</strong>ï¼šç»´æŠ¤ right æ˜¯æ»¡è¶³æ¡ä»¶çš„æœ€å¤§å€¼</li>
<li><strong>è¾¹ç•Œæƒ…å†µ</strong>ï¼šç‰¹åˆ«æ³¨æ„ x = 0 å’Œ x = 1 çš„å¤„ç†</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>è¿”å›å€¼é”™è¯¯</strong>ï¼šå®¹æ˜“æ··æ·†åº”è¯¥è¿”å› left è¿˜æ˜¯ right</li>
<li><strong>æ•´æ•°æº¢å‡º</strong>ï¼šmid * mid å¯èƒ½è¶…å‡º int èŒƒå›´</li>
<li><strong>è¾¹ç•Œå¤„ç†</strong>ï¼šå¿˜è®°å¤„ç† x = 0 çš„ç‰¹æ®Šæƒ…å†µ</li>
</ol>
<p>è¿™é“é¢˜æ˜¯äºŒåˆ†æŸ¥æ‰¾åœ¨æ•°å­¦é—®é¢˜ä¸­çš„ç»å…¸åº”ç”¨ï¼ŒæŒæ¡äº†è¿™ä¸ªæ¨¡æ¿ï¼Œå°±èƒ½è§£å†³ä¸€å¤§ç±»ç±»ä¼¼çš„æŸ¥æ‰¾é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>äºŒåˆ†æŸ¥æ‰¾</category>
      </categories>
      <tags>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ•°å­¦</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis åˆ†å¸ƒå¼é”çš„å®ç°åŸç†ä¸ Redlock ç®—æ³•</title>
    <url>/2025/06/09/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>åˆ†å¸ƒå¼é”æ˜¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¹¶å‘æ§åˆ¶çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶æŸä¸ªå…±äº«èµ„æºåœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªåº”ç”¨æ‰€ä½¿ç”¨ã€‚Redis ä½œä¸ºå…±äº«å­˜å‚¨ç³»ç»Ÿï¼Œå‡­å€Ÿå…¶é«˜æ€§èƒ½çš„è¯»å†™èƒ½åŠ›ï¼Œæˆä¸ºå®ç°åˆ†å¸ƒå¼é”çš„çƒ­é—¨é€‰æ‹©ã€‚</p>
<p><img src="/2025/06/09/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0/1749398255591.png" alt="åˆ†å¸ƒå¼é”ç¤ºæ„å›¾"></p>
<h2 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 id="åˆ†å¸ƒå¼é”çš„åŸºæœ¬è¦æ±‚">åˆ†å¸ƒå¼é”çš„åŸºæœ¬è¦æ±‚</h3>
<p>åˆ†å¸ƒå¼é”å¿…é¡»æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼š</p>
<ol>
<li><strong>äº’æ–¥æ€§</strong>ï¼šåœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½å¤Ÿè·å¾—é”</li>
<li><strong>æ— æ­»é”</strong>ï¼šå³ä½¿æŒæœ‰é”çš„å®¢æˆ·ç«¯å´©æºƒï¼Œé”ä¹Ÿèƒ½å¤Ÿè¢«é‡Šæ”¾</li>
<li><strong>å®¹é”™æ€§</strong>ï¼šåªè¦å¤§éƒ¨åˆ† Redis èŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œå®¢æˆ·ç«¯å°±èƒ½å¤Ÿè·å–å’Œé‡Šæ”¾é”</li>
</ol>
<h3 id="Redis-å®ç°åˆ†å¸ƒå¼é”çš„åŸç†">Redis å®ç°åˆ†å¸ƒå¼é”çš„åŸç†</h3>
<p>Redis æœ¬èº«å¯ä»¥è¢«å¤šä¸ªå®¢æˆ·ç«¯å…±äº«è®¿é—®ï¼Œæ˜¯ç†æƒ³çš„å…±äº«å­˜å‚¨ç³»ç»Ÿã€‚Redis çš„ SET å‘½ä»¤å…·æœ‰ NX å‚æ•°ï¼Œå¯ä»¥å®ç°&quot;key ä¸å­˜åœ¨æ‰æ’å…¥&quot;çš„åŸå­æ“ä½œï¼Œè¿™æ˜¯å®ç°åˆ†å¸ƒå¼é”çš„åŸºç¡€ã€‚</p>
<h2 id="å•èŠ‚ç‚¹-Redis-åˆ†å¸ƒå¼é”å®ç°">å•èŠ‚ç‚¹ Redis åˆ†å¸ƒå¼é”å®ç°</h2>
<h3 id="åŠ é”æœºåˆ¶">åŠ é”æœºåˆ¶</h3>
<p>åŸºäºå•ä¸ª Redis èŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³ä¸‰ä¸ªå…³é”®æ¡ä»¶ï¼š</p>
<ol>
<li><strong>åŸå­æ€§æ“ä½œ</strong>ï¼šåŠ é”åŒ…æ‹¬è¯»å–é”å˜é‡ã€æ£€æŸ¥é”å˜é‡å€¼å’Œè®¾ç½®é”å˜é‡å€¼ä¸‰ä¸ªæ“ä½œï¼Œå¿…é¡»ä»¥åŸå­æ–¹å¼å®Œæˆ</li>
<li><strong>è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼šé¿å…å®¢æˆ·ç«¯å¼‚å¸¸å¯¼è‡´é”æ— æ³•é‡Šæ”¾</li>
<li><strong>å”¯ä¸€æ ‡è¯†</strong>ï¼šåŒºåˆ†æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„åŠ é”æ“ä½œï¼Œé˜²æ­¢è¯¯é‡Šæ”¾</li>
</ol>
<h3 id="å®ç°å‘½ä»¤">å®ç°å‘½ä»¤</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SET lock_key unique_value NX PX 10000</span><br></pre></td></tr></table></figure>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>lock_key</code>ï¼šé”çš„é”®å</li>
<li><code>unique_value</code>ï¼šå®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºåŒºåˆ†ä¸åŒå®¢æˆ·ç«¯</li>
<li><code>NX</code>ï¼šåªåœ¨ lock_key ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®</li>
<li><code>PX 10000</code>ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 10 ç§’</li>
</ul>
<h3 id="è§£é”æœºåˆ¶">è§£é”æœºåˆ¶</h3>
<p>è§£é”è¿‡ç¨‹éœ€è¦ç¡®ä¿æ“ä½œçš„å®¢æˆ·ç«¯å°±æ˜¯åŠ é”çš„å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ Lua è„šæœ¬ä¿è¯åŸå­æ€§ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è§£é” Lua è„šæœ¬</span></span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè„šæœ¬å…ˆæ¯”è¾ƒé”çš„ unique_value æ˜¯å¦åŒ¹é…ï¼ŒåŒ¹é…æ—¶æ‰åˆ é™¤é”ï¼Œé¿å…è¯¯é‡Šæ”¾ã€‚</p>
<h2 id="å•èŠ‚ç‚¹æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹åˆ†æ">å•èŠ‚ç‚¹æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹åˆ†æ</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<ol>
<li><strong>é«˜æ€§èƒ½</strong>ï¼šRedis çš„é«˜æ€§èƒ½è¯»å†™æ˜¯é€‰æ‹©å®ƒå®ç°åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒåŸå› </li>
<li><strong>å®ç°ç®€ä¾¿</strong>ï¼šRedis æä¾›çš„ SET NX å‘½ä»¤ä½¿å¾—å®ç°åˆ†å¸ƒå¼é”éå¸¸æ–¹ä¾¿</li>
<li><strong>é¿å…å•ç‚¹æ•…éšœ</strong>ï¼šé€šè¿‡é›†ç¾¤éƒ¨ç½²è‡ªç„¶é¿å…äº†å•ç‚¹æ•…éšœ</li>
</ol>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<h4 id="1-è¶…æ—¶æ—¶é—´è®¾ç½®éš¾é¢˜">1. è¶…æ—¶æ—¶é—´è®¾ç½®éš¾é¢˜</h4>
<p>è¶…æ—¶æ—¶é—´çš„è®¾ç½®æ˜¯ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ï¼š</p>
<ul>
<li><strong>è®¾ç½®è¿‡é•¿</strong>ï¼šå½±å“ç³»ç»Ÿæ€§èƒ½</li>
<li><strong>è®¾ç½®è¿‡çŸ­</strong>ï¼šå¯èƒ½æ— æ³•ä¿æŠ¤å…±äº«èµ„æº</li>
</ul>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼šçº¿ç¨‹ A è·å–é”åï¼Œç”±äºä¸šåŠ¡ä»£ç æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œé”è¶…æ—¶è‡ªåŠ¨å¤±æ•ˆï¼Œä½† A çº¿ç¨‹å°šæœªæ‰§è¡Œå®Œæˆï¼Œæ­¤æ—¶çº¿ç¨‹ B å¯èƒ½æ„å¤–è·å¾—é”ï¼Œå¯¼è‡´ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œå…±äº«èµ„æºã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ - é”ç»­çº¦æœºåˆ¶</strong>ï¼š</p>
<ol>
<li>è®¾ç½®åˆå§‹è¶…æ—¶æ—¶é—´</li>
<li>å¯åŠ¨å®ˆæŠ¤çº¿ç¨‹ç›‘æ§é”çŠ¶æ€</li>
<li>åœ¨é”å³å°†å¤±æ•ˆæ—¶è‡ªåŠ¨ç»­æœŸ</li>
<li>ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæˆåé”€æ¯ç»­çº¦é”</li>
</ol>
<p>è™½ç„¶è¿™ç§æ–¹å¼èƒ½è§£å†³é—®é¢˜ï¼Œä½†å®ç°å¤æ‚åº¦è¾ƒé«˜ã€‚</p>
<h4 id="2-ä¸»ä»å¤åˆ¶çš„å¼‚æ­¥é—®é¢˜">2. ä¸»ä»å¤åˆ¶çš„å¼‚æ­¥é—®é¢˜</h4>
<p>Redis ä¸»ä»å¤åˆ¶é‡‡ç”¨å¼‚æ­¥æ–¹å¼ï¼Œå¯èƒ½å¯¼è‡´åˆ†å¸ƒå¼é”ä¸å¯é ï¼š</p>
<p>å¦‚æœåœ¨ Redis ä¸»èŠ‚ç‚¹è·å–é”åï¼Œè¿˜æœªåŒæ­¥åˆ°ä»èŠ‚ç‚¹æ—¶ä¸»èŠ‚ç‚¹å®•æœºï¼Œæ–°çš„ä¸»èŠ‚ç‚¹ä¸Šæ²¡æœ‰é”æ•°æ®ï¼Œå…¶ä»–åº”ç”¨ä»å¯è·å–é”ï¼Œç ´åäº†é”çš„äº’æ–¥æ€§ã€‚</p>
<h2 id="Redlock-ç®—æ³•-é›†ç¾¤ç¯å¢ƒçš„è§£å†³æ–¹æ¡ˆ">Redlock ç®—æ³• - é›†ç¾¤ç¯å¢ƒçš„è§£å†³æ–¹æ¡ˆ</h2>
<h3 id="ç®—æ³•åŸç†">ç®—æ³•åŸç†</h3>
<p>Redis å®˜æ–¹ä¸ºè§£å†³é›†ç¾¤ç¯å¢ƒä¸‹åˆ†å¸ƒå¼é”çš„å¯é æ€§é—®é¢˜ï¼Œè®¾è®¡äº† Redlockï¼ˆçº¢é”ï¼‰ç®—æ³•ã€‚è¯¥ç®—æ³•åŸºäºå¤šä¸ªç‹¬ç«‹çš„ Redis èŠ‚ç‚¹ï¼Œå³ä½¿éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœï¼Œé”å˜é‡ä»ç„¶å­˜åœ¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­è¿›è¡Œé”æ“ä½œã€‚</p>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼šå®¢æˆ·ç«¯ä¸å¤šä¸ªç‹¬ç«‹çš„ Redis èŠ‚ç‚¹ä¾æ¬¡è¯·æ±‚åŠ é”ï¼Œå¦‚æœèƒ½å¤Ÿä¸åŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹æˆåŠŸå®ŒæˆåŠ é”æ“ä½œï¼Œåˆ™è®¤ä¸ºåŠ é”æˆåŠŸã€‚</p>
<h3 id="Redlock-åŠ é”æµç¨‹">Redlock åŠ é”æµç¨‹</h3>
<h4 id="ç¬¬ä¸€æ­¥ï¼šè·å–å½“å‰æ—¶é—´">ç¬¬ä¸€æ­¥ï¼šè·å–å½“å‰æ—¶é—´</h4>
<p>å®¢æˆ·ç«¯è®°å½•å½“å‰æ—¶é—´æˆ³ï¼Œç”¨äºåç»­è®¡ç®—æ€»è€—æ—¶ã€‚</p>
<h4 id="ç¬¬äºŒæ­¥ï¼šä¾æ¬¡å‘æ‰€æœ‰èŠ‚ç‚¹åŠ é”">ç¬¬äºŒæ­¥ï¼šä¾æ¬¡å‘æ‰€æœ‰èŠ‚ç‚¹åŠ é”</h4>
<ul>
<li>ä½¿ç”¨ç›¸åŒçš„ SET å‘½ä»¤ï¼ˆå¸¦ NXã€EX/PX é€‰é¡¹å’Œå”¯ä¸€æ ‡è¯†ï¼‰</li>
<li>å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„åŠ é”æ“ä½œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯å¯¹åŠ é”æ“ä½œçš„è¶…æ—¶ï¼Œä¸æ˜¯å¯¹é”æœ¬èº«çš„è¶…æ—¶ï¼‰</li>
<li>å¦‚æœæŸä¸ªèŠ‚ç‚¹æ•…éšœï¼Œä¸å½±å“ Redlock ç®—æ³•ç»§ç»­è¿è¡Œ</li>
</ul>
<h4 id="ç¬¬ä¸‰æ­¥ï¼šè®¡ç®—åŠ é”æ€»è€—æ—¶">ç¬¬ä¸‰æ­¥ï¼šè®¡ç®—åŠ é”æ€»è€—æ—¶</h4>
<p>å®¢æˆ·ç«¯å®Œæˆæ‰€æœ‰èŠ‚ç‚¹çš„åŠ é”æ“ä½œåï¼Œè®¡ç®—æ•´ä¸ªè¿‡ç¨‹çš„æ€»è€—æ—¶ï¼ˆt1ï¼‰ã€‚</p>
<h3 id="åŠ é”æˆåŠŸæ¡ä»¶">åŠ é”æˆåŠŸæ¡ä»¶</h3>
<p>åŠ é”æˆåŠŸéœ€è¦<strong>åŒæ—¶</strong>æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li><strong>èŠ‚ç‚¹æ•°é‡æ¡ä»¶</strong>ï¼šå®¢æˆ·ç«¯ä»è¶…è¿‡åŠæ•°ï¼ˆâ‰¥ N/2+1ï¼‰çš„ Redis èŠ‚ç‚¹æˆåŠŸè·å–åˆ°é”</li>
<li><strong>æ—¶é—´æ¡ä»¶</strong>ï¼šå®¢æˆ·ç«¯è·å–é”çš„æ€»è€—æ—¶ï¼ˆt1ï¼‰æ²¡æœ‰è¶…è¿‡é”çš„æœ‰æ•ˆæ—¶é—´</li>
</ol>
<h3 id="é”çš„æœ‰æ•ˆæ—¶é—´é‡æ–°è®¡ç®—">é”çš„æœ‰æ•ˆæ—¶é—´é‡æ–°è®¡ç®—</h3>
<p>åŠ é”æˆåŠŸåï¼Œéœ€è¦é‡æ–°è®¡ç®—é”çš„å®é™…æœ‰æ•ˆæ—¶é—´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®é™…æœ‰æ•ˆæ—¶é—´ = é”çš„æœ€åˆæœ‰æ•ˆæ—¶é—´ - å®¢æˆ·ç«¯è·å–é”çš„æ€»è€—æ—¶ï¼ˆt1ï¼‰</span><br></pre></td></tr></table></figure>
<h3 id="è§£é”æµç¨‹">è§£é”æµç¨‹</h3>
<p>æ— è®ºåŠ é”æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå®¢æˆ·ç«¯éƒ½åº”å‘æ‰€æœ‰ Redis èŠ‚ç‚¹å‘èµ·é‡Šæ”¾é”çš„æ“ä½œï¼Œä½¿ç”¨ä¸å•èŠ‚ç‚¹ç›¸åŒçš„ Lua è„šæœ¬ã€‚</p>
<h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´</strong>ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯è¯„ä¼°ï¼Œé¿å…è¿‡é•¿æˆ–è¿‡çŸ­</li>
<li><strong>å®ç°é”ç»­çº¦æœºåˆ¶</strong>ï¼šå¯¹äºæ‰§è¡Œæ—¶é—´ä¸ç¡®å®šçš„ä¸šåŠ¡</li>
<li><strong>é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹æ•°é‡</strong>ï¼šRedlock æ¨èå¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ 3ã€5ã€7 ä¸ª</li>
<li><strong>ç›‘æ§é”çš„ä½¿ç”¨æƒ…å†µ</strong>ï¼šåŠæ—¶å‘ç°é”ç«äº‰æ¿€çƒˆçš„åœºæ™¯</li>
<li><strong>è€ƒè™‘ä½¿ç”¨ä¸“ä¸šçš„åˆ†å¸ƒå¼é”æœåŠ¡</strong>ï¼šå¦‚ Zookeeperã€etcd ç­‰</li>
</ol>
<h2 id="å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 id="Q-å¦‚ä½•å¤„ç†ç½‘ç»œåˆ†åŒºï¼Ÿ">Q: å¦‚ä½•å¤„ç†ç½‘ç»œåˆ†åŒºï¼Ÿ</h3>
<p>A: Redlock ç®—æ³•é€šè¿‡è¦æ±‚åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹åŒæ„æ¥å¤„ç†ç½‘ç»œåˆ†åŒºé—®é¢˜ï¼Œä½†åœ¨ä¸¥é‡çš„ç½‘ç»œåˆ†åŒºæƒ…å†µä¸‹ï¼Œå¯èƒ½å‡ºç°è„‘è£‚é—®é¢˜ã€‚</p>
<h3 id="Q-é”ç»­çº¦çš„æœ€ä½³å®è·µï¼Ÿ">Q: é”ç»­çº¦çš„æœ€ä½³å®è·µï¼Ÿ</h3>
<p>A: è®¾ç½®ç»­çº¦é—´éš”ä¸ºé”è¶…æ—¶æ—¶é—´çš„ 1/3ï¼Œé¿å…é¢‘ç¹ç»­çº¦å½±å“æ€§èƒ½ã€‚</p>
<h3 id="Q-å¦‚ä½•é€‰æ‹©-Redis-èŠ‚ç‚¹æ•°é‡ï¼Ÿ">Q: å¦‚ä½•é€‰æ‹© Redis èŠ‚ç‚¹æ•°é‡ï¼Ÿ</h3>
<p>A: æ¨èä½¿ç”¨å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œ3-5 ä¸ªèŠ‚ç‚¹å¯¹å¤§å¤šæ•°åœºæ™¯å·²è¶³å¤Ÿï¼Œè¿‡å¤šèŠ‚ç‚¹ä¼šå½±å“æ€§èƒ½ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://redis.io/docs/reference/patterns/distributed-locks/">Redis å®˜æ–¹æ–‡æ¡£ - åˆ†å¸ƒå¼é”</a></li>
<li><a href="https://redis.io/docs/reference/patterns/distributed-locks/#the-redlock-algorithm">Redlock ç®—æ³•è¯¦è§£</a></li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>åˆ†å¸ƒå¼é”</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>åˆ†å¸ƒå¼é”</tag>
        <tag>Redlock</tag>
        <tag>SETå‘½ä»¤</tag>
        <tag>Luaè„šæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®åº“å’Œç¼“å­˜å¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼Ÿ</title>
    <url>/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/</url>
    <content><![CDATA[<h1>æ•°æ®åº“å’Œç¼“å­˜å¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼Ÿ</h1>
<h2 id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</h2>
<p>å½“ç³»ç»Ÿç”¨æˆ·é‡ä¸æ–­å¢é•¿æ—¶ï¼Œæ•°æ®åº“å¾€å¾€æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚æ­¤æ—¶å¼•å…¥ Redis ä½œä¸ºç¼“å­˜å±‚æ˜¯å¸¸è§çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p>
<p>é€šè¿‡ç¼“å­˜ï¼Œåœ¨å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®æ—¶ï¼Œå¦‚æœèƒ½åœ¨ç¼“å­˜ä¸­å‘½ä¸­æ•°æ®ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ç»“æœï¼Œæ— éœ€æŸ¥è¯¢æ•°æ®åº“ï¼Œä»è€Œå‡è½»æ•°æ®åº“å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¼•å…¥ç¼“å­˜åï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªæ–°çš„æŒ‘æˆ˜ï¼š<strong>å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</strong></p>
<h2 id="æ›´æ–°ç­–ç•¥å¯¹æ¯”åˆ†æ">æ›´æ–°ç­–ç•¥å¯¹æ¯”åˆ†æ</h2>
<h3 id="æ–¹æ¡ˆä¸€ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜">æ–¹æ¡ˆä¸€ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</h3>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398023212.png" alt="1749398023212"></p>
<h4 id="å­˜åœ¨çš„é—®é¢˜">å­˜åœ¨çš„é—®é¢˜</h4>
<p>åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œè¿™ç§æ–¹æ¡ˆå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p><strong>é—®é¢˜åœºæ™¯ï¼š</strong><br>
å‡è®¾ã€Œè¯·æ±‚ Aã€å’Œã€Œè¯·æ±‚ Bã€ä¸¤ä¸ªè¯·æ±‚ï¼ŒåŒæ—¶æ›´æ–°ã€ŒåŒä¸€æ¡ã€æ•°æ®ï¼Œå¯èƒ½å‡ºç°è¿™æ ·çš„æ‰§è¡Œé¡ºåºï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398033375.png" alt="1749398033375"></p>
<ol>
<li>è¯·æ±‚ A å…ˆå°†æ•°æ®åº“çš„æ•°æ®æ›´æ–°ä¸º 1</li>
<li>åœ¨ A æ›´æ–°ç¼“å­˜å‰ï¼Œè¯·æ±‚ B å°†æ•°æ®åº“çš„æ•°æ®æ›´æ–°ä¸º 2</li>
<li>è¯·æ±‚ B å°†ç¼“å­˜æ›´æ–°ä¸º 2</li>
<li>è¯·æ±‚ A æœ€åå°†ç¼“å­˜æ›´æ–°ä¸º 1</li>
</ol>
<p><strong>ç»“æœï¼š</strong> æ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯ 2ï¼Œè€Œç¼“å­˜ä¸­çš„æ•°æ®å´æ˜¯ 1ï¼Œå‡ºç°äº†æ•°æ®ä¸ä¸€è‡´ç°è±¡ã€‚</p>
<h3 id="æ–¹æ¡ˆäºŒï¼šå…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“">æ–¹æ¡ˆäºŒï¼šå…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</h3>
<p>è¿™ç§æ–¹æ¡ˆåŒæ ·å­˜åœ¨å¹¶å‘é—®é¢˜ã€‚</p>
<p><strong>é—®é¢˜åœºæ™¯ï¼š</strong></p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398042881.png" alt="1749398042881"></p>
<ol>
<li>è¯·æ±‚ A å…ˆå°†ç¼“å­˜çš„æ•°æ®æ›´æ–°ä¸º 1</li>
<li>åœ¨ A æ›´æ–°æ•°æ®åº“å‰ï¼Œè¯·æ±‚ B å°†ç¼“å­˜çš„æ•°æ®æ›´æ–°ä¸º 2</li>
<li>è¯·æ±‚ B å°†æ•°æ®åº“æ›´æ–°ä¸º 2</li>
<li>è¯·æ±‚ A æœ€åå°†æ•°æ®åº“çš„æ•°æ®æ›´æ–°ä¸º 1</li>
</ol>
<p><strong>ç»“æœï¼š</strong> æ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯ 1ï¼Œè€Œç¼“å­˜ä¸­çš„æ•°æ®å´æ˜¯ 2ï¼ŒåŒæ ·å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´ç°è±¡ã€‚</p>
<h4 id="ç»“è®º">ç»“è®º</h4>
<p>æ— è®ºæ˜¯ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ã€ï¼Œè¿˜æ˜¯ã€Œå…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€ï¼Œè¿™ä¸¤ä¸ªæ–¹æ¡ˆéƒ½å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œå½“ä¸¤ä¸ªè¯·æ±‚å¹¶å‘æ›´æ–°åŒä¸€æ¡æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ã€‚</p>
<h2 id="Cache-Aside-æ—è·¯ç¼“å­˜ç­–ç•¥">Cache Aside æ—è·¯ç¼“å­˜ç­–ç•¥</h2>
<p>æ—¢ç„¶æ›´æ–°ç¼“å­˜çš„æ–¹æ¡ˆå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¦ä¸€ç§ç­–ç•¥ï¼š<strong>åœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œä¸æ›´æ–°ç¼“å­˜ï¼Œè€Œæ˜¯åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ã€‚ç„¶åï¼Œåˆ°è¯»å–æ•°æ®æ—¶ï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡äº†æ•°æ®ä¹‹åï¼Œå†ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œæ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚</strong></p>
<p>è¿™ä¸ªç­–ç•¥å«åš <strong>Cache Aside ç­–ç•¥</strong>ï¼Œä¹Ÿç§°ä¸ºæ—è·¯ç¼“å­˜ç­–ç•¥ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398054481.png" alt="1749398054481"></p>
<h3 id="ç­–ç•¥è¯¦è§£">ç­–ç•¥è¯¦è§£</h3>
<p>Cache Aside ç­–ç•¥åˆ†ä¸ºã€Œè¯»ç­–ç•¥ã€å’Œã€Œå†™ç­–ç•¥ã€ï¼š</p>
<h4 id="å†™ç­–ç•¥æ­¥éª¤">å†™ç­–ç•¥æ­¥éª¤</h4>
<ol>
<li>æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®</li>
<li>åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®</li>
</ol>
<h4 id="è¯»ç­–ç•¥æ­¥éª¤">è¯»ç­–ç•¥æ­¥éª¤</h4>
<ol>
<li>å¦‚æœè¯»å–çš„æ•°æ®å‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®</li>
<li>å¦‚æœè¯»å–çš„æ•°æ®æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œåˆ™ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶ä¸”è¿”å›ç»™ç”¨æˆ·</li>
</ol>
<h3 id="å†™ç­–ç•¥çš„æ‰§è¡Œé¡ºåºåˆ†æ">å†™ç­–ç•¥çš„æ‰§è¡Œé¡ºåºåˆ†æ</h3>
<p>åœ¨ã€Œå†™ç­–ç•¥ã€ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©æ‰§è¡Œé¡ºåºï¼š</p>
<ul>
<li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</li>
<li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</li>
</ul>
<h4 id="æ–¹æ¡ˆä¸€ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“">æ–¹æ¡ˆä¸€ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</h4>
<p><strong>é—®é¢˜åœºæ™¯ï¼š</strong><br>
å‡è®¾æŸä¸ªç”¨æˆ·çš„å¹´é¾„æ˜¯ 20ï¼Œè¯·æ±‚ A è¦æ›´æ–°ç”¨æˆ·å¹´é¾„ä¸º 21ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398064441.png" alt="1749398064441"></p>
<ol>
<li>è¯·æ±‚ A åˆ é™¤ç¼“å­˜ä¸­çš„å†…å®¹</li>
<li>è¯·æ±‚ B è¯»å–è¯¥ç”¨æˆ·å¹´é¾„ï¼Œç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“è¯»å–åˆ°å¹´é¾„ä¸º 20</li>
<li>è¯·æ±‚ B å°†å¹´é¾„ 20 å†™å…¥ç¼“å­˜</li>
<li>è¯·æ±‚ A å°†æ•°æ®åº“ä¸­çš„å¹´é¾„æ›´æ–°ä¸º 21</li>
</ol>
<p><strong>ç»“æœï¼š</strong> ç¼“å­˜ä¸­æ˜¯ 20ï¼ˆæ—§å€¼ï¼‰ï¼Œæ•°æ®åº“ä¸­æ˜¯ 21ï¼ˆæ–°å€¼ï¼‰ï¼Œæ•°æ®ä¸ä¸€è‡´ã€‚</p>
<h4 id="æ–¹æ¡ˆäºŒï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜">æ–¹æ¡ˆäºŒï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</h4>
<p><strong>é—®é¢˜åœºæ™¯ï¼š</strong><br>
å‡å¦‚æŸä¸ªç”¨æˆ·æ•°æ®åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398072984.png" alt="1749398072984"></p>
<ol>
<li>è¯·æ±‚ A ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°å¹´é¾„ä¸º 20</li>
<li>è¯·æ±‚ B æ›´æ–°æ•°æ®åº“ä¸­çš„å¹´é¾„ä¸º 21ï¼Œå¹¶åˆ é™¤ç¼“å­˜</li>
<li>è¯·æ±‚ A å°†ä»æ•°æ®åº“ä¸­è¯»åˆ°çš„å¹´é¾„ 20 å†™å…¥ç¼“å­˜</li>
</ol>
<p><strong>ç»“æœï¼š</strong> ç¼“å­˜ä¸­æ˜¯ 20ï¼ˆæ—§å€¼ï¼‰ï¼Œæ•°æ®åº“ä¸­æ˜¯ 21ï¼ˆæ–°å€¼ï¼‰ï¼Œæ•°æ®ä¸ä¸€è‡´ã€‚</p>
<h4 id="æ¨èæ–¹æ¡ˆ">æ¨èæ–¹æ¡ˆ</h4>
<p>è™½ç„¶ä»ç†è®ºä¸Šåˆ†æï¼Œã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œ<strong>ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å‡ºç°çš„æ¦‚ç‡å¹¶ä¸é«˜</strong>ã€‚</p>
<p><strong>åŸå› ï¼š</strong></p>
<ul>
<li>ç¼“å­˜çš„å†™å…¥é€šå¸¸è¦è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥</li>
<li>åœ¨å®é™…ä¸­å¾ˆéš¾å‡ºç°è¯·æ±‚ B å·²ç»æ›´æ–°äº†æ•°æ®åº“å¹¶ä¸”åˆ é™¤äº†ç¼“å­˜ï¼Œè¯·æ±‚ A æ‰æ›´æ–°å®Œç¼“å­˜çš„æƒ…å†µ</li>
<li>ä¸€æ—¦è¯·æ±‚ A æ—©äºè¯·æ±‚ B åˆ é™¤ç¼“å­˜ä¹‹å‰æ›´æ–°äº†ç¼“å­˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„è¯·æ±‚å°±ä¼šå› ä¸ºç¼“å­˜ä¸å‘½ä¸­è€Œä»æ•°æ®åº“ä¸­é‡æ–°è¯»å–æ•°æ®</li>
</ul>
<p>å› æ­¤ï¼Œ<strong>ã€Œå…ˆæ›´æ–°æ•°æ®åº“ + å†åˆ é™¤ç¼“å­˜ã€çš„æ–¹æ¡ˆï¼Œæ˜¯å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„</strong>ã€‚</p>
<h3 id="è¿›ä¸€æ­¥çš„ä¿éšœæªæ–½">è¿›ä¸€æ­¥çš„ä¿éšœæªæ–½</h3>
<p>ä¸ºäº†ç¡®ä¿ä¸‡æ— ä¸€å¤±ï¼Œè¿˜å¯ä»¥ï¼š</p>
<ol>
<li><strong>ç»™ç¼“å­˜æ•°æ®åŠ ä¸Šè¿‡æœŸæ—¶é—´</strong>ï¼šå³ä½¿åœ¨è¿™æœŸé—´å­˜åœ¨ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ï¼Œæœ‰è¿‡æœŸæ—¶é—´æ¥å…œåº•ï¼Œä¹Ÿèƒ½è¾¾åˆ°æœ€ç»ˆä¸€è‡´</li>
<li><strong>å¤„ç†åˆ é™¤ç¼“å­˜å¤±è´¥çš„æƒ…å†µ</strong>ï¼šå½“åˆ é™¤ç¼“å­˜ï¼ˆç¬¬äºŒä¸ªæ“ä½œï¼‰å¤±è´¥æ—¶ï¼Œéœ€è¦æœ‰é‡è¯•æœºåˆ¶</li>
</ol>
<h2 id="åˆ é™¤ç¼“å­˜å¤±è´¥çš„è§£å†³æ–¹æ¡ˆ">åˆ é™¤ç¼“å­˜å¤±è´¥çš„è§£å†³æ–¹æ¡ˆ</h2>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½å‡ºç°è¿™æ ·çš„é—®é¢˜ï¼šæ˜æ˜æ›´æ–°äº†æ•°æ®ï¼Œä½†æ˜¯æ•°æ®è¦è¿‡ä¸€æ®µæ—¶é—´æ‰ç”Ÿæ•ˆã€‚</p>
<p>ç»è¿‡æ’æŸ¥å‘ç°ï¼Œé—®é¢˜çš„åŸå› æ˜¯ï¼š<strong>åœ¨åˆ é™¤ç¼“å­˜ï¼ˆç¬¬äºŒä¸ªæ“ä½œï¼‰çš„æ—¶å€™å¤±è´¥äº†ï¼Œå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æ—§å€¼</strong>ã€‚</p>
<h3 id="é—®é¢˜ç¤ºä¾‹">é—®é¢˜ç¤ºä¾‹</h3>
<p>åº”ç”¨è¦æŠŠæ•°æ® X çš„å€¼ä» 1 æ›´æ–°ä¸º 2ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398096637.png" alt="1749398096637"></p>
<ol>
<li>æˆåŠŸæ›´æ–°äº†æ•°æ®åº“ï¼ˆX = 2ï¼‰</li>
<li>åœ¨ Redis ç¼“å­˜ä¸­åˆ é™¤ X çš„ç¼“å­˜æ“ä½œå¤±è´¥</li>
<li>æ•°æ®åº“ä¸­ X çš„æ–°å€¼ä¸º 2ï¼ŒRedis ä¸­çš„ X çš„ç¼“å­˜å€¼ä¸º 1</li>
</ol>
<p>åç»­è®¿é—®æ•°æ® X çš„è¯·æ±‚ï¼Œä¼šå…ˆåœ¨ Redis ä¸­æŸ¥è¯¢ï¼Œå› ä¸ºç¼“å­˜å¹¶æ²¡æœ‰è¢«åˆ é™¤ï¼Œæ‰€ä»¥ä¼šç¼“å­˜å‘½ä¸­ï¼Œä½†æ˜¯è¯»åˆ°çš„å´æ˜¯æ—§å€¼ 1ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<p>é’ˆå¯¹åˆ é™¤ç¼“å­˜å¤±è´¥çš„é—®é¢˜ï¼Œæœ‰ä¸¤ç§æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼š</p>
<h4 id="æ–¹æ¡ˆä¸€ï¼šæ¶ˆæ¯é˜Ÿåˆ—é‡è¯•æœºåˆ¶">æ–¹æ¡ˆä¸€ï¼šæ¶ˆæ¯é˜Ÿåˆ—é‡è¯•æœºåˆ¶</h4>
<p>æˆ‘ä»¬å¯ä»¥å¼•å…¥<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œå°†ç¬¬äºŒä¸ªæ“ä½œï¼ˆåˆ é™¤ç¼“å­˜ï¼‰è¦æ“ä½œçš„æ•°æ®åŠ å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”±æ¶ˆè´¹è€…æ¥æ“ä½œæ•°æ®ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398106503.png" alt="1749398106503"></p>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<ol>
<li>å¦‚æœåº”ç”¨<strong>åˆ é™¤ç¼“å­˜å¤±è´¥</strong>ï¼Œå¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­é‡æ–°è¯»å–æ•°æ®ï¼Œç„¶åå†æ¬¡åˆ é™¤ç¼“å­˜ï¼ˆé‡è¯•æœºåˆ¶ï¼‰</li>
<li>å¦‚æœé‡è¯•è¶…è¿‡ä¸€å®šæ¬¡æ•°è¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼Œéœ€è¦å‘ä¸šåŠ¡å±‚å‘é€æŠ¥é”™ä¿¡æ¯</li>
<li>å¦‚æœ<strong>åˆ é™¤ç¼“å­˜æˆåŠŸ</strong>ï¼Œå°±è¦æŠŠæ•°æ®ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œé¿å…é‡å¤æ“ä½œ</li>
</ol>
<h4 id="æ–¹æ¡ˆäºŒï¼šè®¢é˜…-MySQL-binlog">æ–¹æ¡ˆäºŒï¼šè®¢é˜… MySQL binlog</h4>
<p>ã€Œ<strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜</strong>ã€ç­–ç•¥çš„ç¬¬ä¸€æ­¥æ˜¯æ›´æ–°æ•°æ®åº“ï¼Œæ›´æ–°æ•°æ®åº“æˆåŠŸå°±ä¼šäº§ç”Ÿä¸€æ¡å˜æ›´æ—¥å¿—ï¼Œè®°å½•åœ¨ binlog é‡Œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¢é˜… binlog æ—¥å¿—ï¼Œæ‹¿åˆ°å…·ä½“è¦æ“ä½œçš„æ•°æ®ï¼Œç„¶åå†æ‰§è¡Œç¼“å­˜åˆ é™¤ã€‚é˜¿é‡Œå·´å·´å¼€æºçš„ <strong>Canal ä¸­é—´ä»¶</strong>å°±æ˜¯åŸºäºè¿™ä¸ªå®ç°çš„ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E8%AF%81%E4%B8%80%E8%87%B4%E6%80%A7/1749398115662.png" alt="1749398115662"></p>
<p><strong>Canal å·¥ä½œåŸç†ï¼š</strong></p>
<ol>
<li>Canal æ¨¡æ‹Ÿ MySQL ä¸»ä»å¤åˆ¶çš„äº¤äº’åè®®ï¼ŒæŠŠè‡ªå·±ä¼ªè£…æˆä¸€ä¸ª MySQL çš„ä»èŠ‚ç‚¹</li>
<li>å‘ MySQL ä¸»èŠ‚ç‚¹å‘é€ dump è¯·æ±‚</li>
<li>MySQL æ”¶åˆ°è¯·æ±‚åï¼Œå¼€å§‹æ¨é€ Binlog ç»™ Canal</li>
<li>Canal è§£æ Binlog å­—èŠ‚æµï¼Œè½¬æ¢ä¸ºä¾¿äºè¯»å–çš„ç»“æ„åŒ–æ•°æ®</li>
<li>ä¾›ä¸‹æ¸¸ç¨‹åºè®¢é˜…ä½¿ç”¨ï¼Œæ‰§è¡Œç¼“å­˜åˆ é™¤æ“ä½œ</li>
</ol>
<p>æ‰€ä»¥ï¼Œ<strong>å¦‚æœè¦æƒ³ä¿è¯ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜ã€ç­–ç•¥ç¬¬äºŒä¸ªæ“ä½œèƒ½æ‰§è¡ŒæˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œæ¶ˆæ¯é˜Ÿåˆ—æ¥é‡è¯•ç¼“å­˜çš„åˆ é™¤ã€ï¼Œæˆ–è€…ã€Œè®¢é˜… MySQL binlog å†æ“ä½œç¼“å­˜ã€ï¼Œè¿™ä¸¤ç§æ–¹æ³•æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œéƒ½æ˜¯é‡‡ç”¨å¼‚æ­¥æ“ä½œç¼“å­˜ã€‚</strong></p>
<h2 id="å…¶ä»–ç­–ç•¥è¡¥å……">å…¶ä»–ç­–ç•¥è¡¥å……</h2>
<h3 id="å»¶è¿ŸåŒåˆ ç­–ç•¥">å»¶è¿ŸåŒåˆ ç­–ç•¥</h3>
<p>é’ˆå¯¹ã€Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€æ–¹æ¡ˆåœ¨ã€Œè¯» + å†™ã€å¹¶å‘è¯·æ±‚è€Œé€ æˆç¼“å­˜ä¸ä¸€è‡´çš„è§£å†³åŠæ³•æ˜¯ã€Œ<strong>å»¶è¿ŸåŒåˆ </strong>ã€ã€‚</p>
<p><strong>å®ç°ä¼ªä»£ç ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ é™¤ç¼“å­˜</span></span><br><span class="line">redis.delKey(X)</span><br><span class="line"><span class="comment">// æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">db.update(X)</span><br><span class="line"><span class="comment">// ç¡çœ </span></span><br><span class="line">Thread.sleep(N)</span><br><span class="line"><span class="comment">// å†åˆ é™¤ç¼“å­˜</span></span><br><span class="line">redis.delKey(X)</span><br></pre></td></tr></table></figure>
<p><strong>å·¥ä½œåŸç†ï¼š</strong><br>
åŠ äº†ä¸ªç¡çœ æ—¶é—´ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿è¯·æ±‚ A åœ¨ç¡çœ çš„æ—¶å€™ï¼Œè¯·æ±‚ B èƒ½å¤Ÿåœ¨è¿™ä¸€æ®µæ—¶é—´å®Œæˆã€Œä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå†æŠŠç¼ºå¤±çš„ç¼“å­˜å†™å…¥ç¼“å­˜ã€çš„æ“ä½œï¼Œç„¶åè¯·æ±‚ A ç¡çœ å®Œï¼Œå†åˆ é™¤ç¼“å­˜ã€‚</p>
<p><strong>å±€é™æ€§ï¼š</strong></p>
<ul>
<li>ç¡çœ æ—¶é—´éœ€è¦å¤§äºè¯·æ±‚ Bã€Œä»æ•°æ®åº“è¯»å–æ•°æ® + å†™å…¥ç¼“å­˜ã€çš„æ—¶é—´</li>
<li>å…·ä½“ç¡çœ å¤šä¹…å…¶å®æ˜¯ä¸ª<strong>ç„å­¦</strong>ï¼Œå¾ˆéš¾è¯„ä¼°å‡ºæ¥</li>
<li>è¿™ä¸ªæ–¹æ¡ˆä¹Ÿåªæ˜¯<strong>å°½å¯èƒ½</strong>ä¿è¯ä¸€è‡´æ€§ï¼Œæç«¯æƒ…å†µä¸‹ä¾ç„¶å¯èƒ½å‡ºç°ç¼“å­˜ä¸ä¸€è‡´</li>
</ul>
<h3 id="æ›´æ–°ç¼“å­˜ç­–ç•¥çš„ä¼˜åŒ–">æ›´æ–°ç¼“å­˜ç­–ç•¥çš„ä¼˜åŒ–</h3>
<p>å¦‚æœä¸šåŠ¡å¯¹ç¼“å­˜å‘½ä¸­ç‡æœ‰å¾ˆé«˜çš„è¦æ±‚ï¼Œå¯ä»¥é‡‡ç”¨ã€Œæ›´æ–°æ•°æ®åº“ + æ›´æ–°ç¼“å­˜ã€çš„æ–¹æ¡ˆï¼Œå› ä¸ºæ›´æ–°ç¼“å­˜å¹¶ä¸ä¼šå‡ºç°ç¼“å­˜æœªå‘½ä¸­çš„æƒ…å†µã€‚</p>
<p><strong>å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šåœ¨æ›´æ–°ç¼“å­˜å‰å…ˆåŠ ä¸ªåˆ†å¸ƒå¼é”ï¼Œä¿è¯åŒä¸€æ—¶é—´åªè¿è¡Œä¸€ä¸ªè¯·æ±‚æ›´æ–°ç¼“å­˜ï¼ˆä¼šå¯¹å†™å…¥æ€§èƒ½äº§ç”Ÿå½±å“ï¼‰</li>
<li><strong>è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</strong>ï¼šåœ¨æ›´æ–°å®Œç¼“å­˜æ—¶ï¼Œç»™ç¼“å­˜åŠ ä¸Šè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å³ä½¿å‡ºç°ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µï¼Œç¼“å­˜çš„æ•°æ®ä¹Ÿä¼šå¾ˆå¿«è¿‡æœŸ</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<h3 id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3>
<ol>
<li>
<p><strong>å¹¶å‘é—®é¢˜æ˜¯å…³é”®</strong>ï¼šæ— è®ºé€‰æ‹©ä»€ä¹ˆç­–ç•¥ï¼Œå¹¶å‘æ›´æ–°éƒ½æ˜¯å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æ ¹æœ¬åŸå› </p>
</li>
<li>
<p><strong>æ¨èæ–¹æ¡ˆ</strong>ï¼šã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€+ Cache Aside ç­–ç•¥</p>
<ul>
<li>ç†è®ºä¸Šå¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œä½†å®é™…å‘ç”Ÿæ¦‚ç‡å¾ˆä½</li>
<li>ç¼“å­˜å†™å…¥é€Ÿåº¦è¿œå¿«äºæ•°æ®åº“å†™å…¥</li>
</ul>
</li>
<li>
<p><strong>å¿…è¦çš„ä¿éšœæªæ–½</strong>ï¼š</p>
<ul>
<li>ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ä½œä¸ºå…œåº•</li>
<li>å¤„ç†åˆ é™¤ç¼“å­˜å¤±è´¥çš„æƒ…å†µ</li>
</ul>
</li>
<li>
<p><strong>åˆ é™¤ç¼“å­˜å¤±è´¥çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>æ¶ˆæ¯é˜Ÿåˆ—é‡è¯•æœºåˆ¶</li>
<li>è®¢é˜… MySQL binlog</li>
<li>ä¸¤ç§æ–¹æ¡ˆéƒ½é‡‡ç”¨å¼‚æ­¥æ“ä½œç¼“å­˜</li>
</ul>
</li>
</ol>
<h3 id="æ–¹æ¡ˆå¯¹æ¯”">æ–¹æ¡ˆå¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</td>
<td>å®é™…ä¸ä¸€è‡´æ¦‚ç‡ä½ï¼Œç®€å•æ˜“å®ç°</td>
<td>ç†è®ºä¸Šå­˜åœ¨ä¸ä¸€è‡´å¯èƒ½</td>
<td>æ¨èä½¿ç”¨</td>
</tr>
<tr>
<td>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</td>
<td>é€»è¾‘ç®€å•</td>
<td>å¹¶å‘æ—¶å®¹æ˜“å‡ºç°ä¸ä¸€è‡´</td>
<td>ä¸æ¨è</td>
</tr>
<tr>
<td>æ›´æ–°æ•°æ®åº“ + æ›´æ–°ç¼“å­˜</td>
<td>ç¼“å­˜å‘½ä¸­ç‡é«˜</td>
<td>å¹¶å‘é—®é¢˜æ˜æ˜¾ï¼Œéœ€è¦é¢å¤–æªæ–½</td>
<td>å¯¹ç¼“å­˜å‘½ä¸­ç‡è¦æ±‚æé«˜çš„åœºæ™¯</td>
</tr>
<tr>
<td>å»¶è¿ŸåŒåˆ </td>
<td>ä¸€å®šç¨‹åº¦è§£å†³å¹¶å‘é—®é¢˜</td>
<td>ç¡çœ æ—¶é—´éš¾ä»¥ç¡®å®šï¼Œä»æœ‰é£é™©</td>
<td>ç‰¹æ®Šåœºæ™¯ä¸‹çš„è¡¥å……æ–¹æ¡ˆ</td>
</tr>
</tbody>
</table>
<p>é€šè¿‡ã€Œæ¶ˆæ¯é˜Ÿåˆ—æ¥é‡è¯•ç¼“å­˜çš„åˆ é™¤ã€æˆ–ã€Œè®¢é˜… MySQL binlog å†æ“ä½œç¼“å­˜ã€çš„æ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³ç¼“å­˜åˆ é™¤å¤±è´¥çš„é—®é¢˜ï¼Œç¡®ä¿æ•°æ®åº“å’Œç¼“å­˜çš„ä¸€è‡´æ€§ã€‚è¿™äº›æ–¹æ¡ˆçš„å…±åŒç‰¹ç‚¹æ˜¯é‡‡ç”¨å¼‚æ­¥æ“ä½œç¼“å­˜ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯é æ€§å’Œæ•°æ®ä¸€è‡´æ€§ä¿éšœã€‚</p>
<h2 id="é¢è¯•è¦ç‚¹">é¢è¯•è¦ç‚¹</h2>
<ol>
<li><strong>èƒ½å¤Ÿåˆ†æå„ç§æ–¹æ¡ˆçš„å¹¶å‘é—®é¢˜</strong>ï¼šæ¸…æ¥šåœ°è§£é‡Šä¸ºä»€ä¹ˆä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´</li>
<li><strong>æ¨è Cache Aside ç­–ç•¥</strong>ï¼šã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€</li>
<li><strong>äº†è§£å®é™…åº”ç”¨ä¸­çš„ä¿éšœæªæ–½</strong>ï¼šè¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯é˜Ÿåˆ—é‡è¯•ã€binlog è®¢é˜…</li>
<li><strong>ç†è§£å»¶è¿ŸåŒåˆ çš„å±€é™æ€§</strong>ï¼šä¸ä½œä¸ºä¸»è¦æ–¹æ¡ˆæ¨è</li>
</ol>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>ç¼“å­˜</category>
      </categories>
      <tags>
        <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
        <tag>Redis</tag>
        <tag>ç¼“å­˜</tag>
        <tag>æ•°æ®ä¸€è‡´æ€§</tag>
        <tag>Cache Aside</tag>
        <tag>Binlog</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis ç¼“å­˜é›ªå´©ã€ç©¿é€ã€å‡»ç©¿é—®é¢˜è¯¦è§£ä¸è§£å†³æ–¹æ¡ˆ</title>
    <url>/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/</url>
    <content><![CDATA[<h1>Redis ç¼“å­˜é›ªå´©ã€ç©¿é€ã€å‡»ç©¿é—®é¢˜è¯¦è§£ä¸è§£å†³æ–¹æ¡ˆ</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>åœ¨ç°ä»£é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼ŒRedis ä½œä¸ºç¼“å­˜å±‚æå¤§åœ°æå‡äº†ç³»ç»Ÿæ€§èƒ½ã€‚ç„¶è€Œï¼Œç¼“å­˜çš„å¼•å…¥ä¹Ÿå¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ç¼“å­˜ç³»ç»Ÿä¸­çš„ä¸‰ä¸ªç»å…¸é—®é¢˜ï¼š<strong>ç¼“å­˜é›ªå´©</strong>ã€<strong>ç¼“å­˜ç©¿é€</strong>ã€<strong>ç¼“å­˜å‡»ç©¿</strong>ï¼Œåˆ†æå®ƒä»¬çš„äº§ç”ŸåŸå› ã€é€ æˆçš„å½±å“ï¼Œä»¥åŠç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ç”¨æˆ·çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨äºæ•°æ®åº“ï¼Œæ•°æ®åº“çš„æ•°æ®æ˜¯è½åœ¨ç£ç›˜ä¸Šçš„ï¼Œç£ç›˜çš„è¯»å†™é€Ÿåº¦å¯ä»¥è¯´æ˜¯è®¡ç®—æœºé‡Œæœ€æ…¢çš„ç¡¬ä»¶äº†ã€‚</p>
<p>å½“ç”¨æˆ·çš„è¯·æ±‚ï¼Œéƒ½è®¿é—®æ•°æ®åº“çš„è¯ï¼Œè¯·æ±‚æ•°é‡ä¸€ä¸Šæ¥ï¼Œæ•°æ®åº“å¾ˆå®¹æ˜“å°±å´©æºƒçš„äº†ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…ç”¨æˆ·ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä¼šç”¨ Redis ä½œä¸ºç¼“å­˜å±‚ã€‚</p>
<p>å› ä¸º Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“çš„æ•°æ®ç¼“å­˜åœ¨ Redis é‡Œï¼Œç›¸å½“äºæ•°æ®ç¼“å­˜åœ¨å†…å­˜ï¼Œå†…å­˜çš„è¯»å†™é€Ÿåº¦æ¯”ç¡¬ç›˜å¿«å¥½å‡ ä¸ªæ•°é‡çº§ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/1749390469334.png" alt="ç¼“å­˜æ¶æ„å›¾"></p>
<p>å¼•å…¥äº†ç¼“å­˜å±‚ï¼Œå°±ä¼šæœ‰ç¼“å­˜å¼‚å¸¸çš„ä¸‰ä¸ªé—®é¢˜ï¼Œåˆ†åˆ«æ˜¯<strong>ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€</strong>ã€‚</p>
<p>è¿™ä¸‰ä¸ªé—®é¢˜ä¹Ÿæ˜¯é¢è¯•ä¸­å¾ˆå¸¸è€ƒå¯Ÿçš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸å…‰è¦æ¸…æ¥šåœ°çŸ¥é“å®ƒä»¬æ˜¯æ€ä¹ˆå‘ç”Ÿï¼Œè¿˜éœ€è¦çŸ¥é“å¦‚ä½•è§£å†³å®ƒä»¬ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/1749390496458.png" alt="ä¸‰å¤§ç¼“å­˜é—®é¢˜æ¦‚è§ˆ"></p>
<hr>
<h2 id="ç¼“å­˜é›ªå´©ï¼ˆCache-Avalancheï¼‰">ç¼“å­˜é›ªå´©ï¼ˆCache Avalancheï¼‰</h2>
<h3 id="é—®é¢˜å®šä¹‰">é—®é¢˜å®šä¹‰</h3>
<p>é€šå¸¸æˆ‘ä»¬ä¸ºäº†ä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¼šç»™ Redis é‡Œçš„æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå½“ç¼“å­˜æ•°æ®è¿‡æœŸåï¼Œç”¨æˆ·è®¿é—®çš„æ•°æ®å¦‚æœä¸åœ¨ç¼“å­˜é‡Œï¼Œä¸šåŠ¡ç³»ç»Ÿéœ€è¦é‡æ–°ç”Ÿæˆç¼“å­˜ï¼Œå› æ­¤å°±ä¼šè®¿é—®æ•°æ®åº“ï¼Œå¹¶å°†æ•°æ®æ›´æ–°åˆ° Redis é‡Œï¼Œè¿™æ ·åç»­è¯·æ±‚éƒ½å¯ä»¥ç›´æ¥å‘½ä¸­ç¼“å­˜ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/1749390508024.png" alt="æ­£å¸¸ç¼“å­˜æœºåˆ¶"></p>
<p>å½“<strong>å¤§é‡ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼ˆå¤±æ•ˆï¼‰æˆ–è€… Redis æ•…éšœå®•æœº</strong>æ—¶ï¼Œå¦‚æœæ­¤æ—¶æœ‰å¤§é‡çš„ç”¨æˆ·è¯·æ±‚ï¼Œéƒ½æ— æ³•åœ¨ Redis ä¸­å¤„ç†ï¼Œäºæ˜¯å…¨éƒ¨è¯·æ±‚éƒ½ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œå¯¼è‡´æ•°æ®åº“çš„å‹åŠ›éª¤å¢ï¼Œä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºï¼Œä»è€Œå½¢æˆä¸€ç³»åˆ—è¿é”ååº”ï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜é›ªå´©</strong>çš„é—®é¢˜ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/1749390520684.png" alt="ç¼“å­˜é›ªå´©ç¤ºæ„å›¾"></p>
<h3 id="äº§ç”ŸåŸå› ">äº§ç”ŸåŸå› </h3>
<p>ç¼“å­˜é›ªå´©çš„å‘ç”Ÿä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p>
<ol>
<li><strong>å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ</strong></li>
<li><strong>Redis æ•…éšœå®•æœº</strong></li>
</ol>
<p>ä¸åŒçš„è¯±å› ï¼Œåº”å¯¹çš„ç­–ç•¥ä¹Ÿä¼šä¸åŒã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<h4 id="é’ˆå¯¹å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸçš„è§£å†³æ–¹æ¡ˆ">é’ˆå¯¹å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸçš„è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>1. å‡åŒ€è®¾ç½®è¿‡æœŸæ—¶é—´</strong></p>
<p>å¦‚æœè¦ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåº”è¯¥é¿å…å°†å¤§é‡çš„æ•°æ®è®¾ç½®æˆåŒä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¯¹ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œ<strong>ç»™è¿™äº›æ•°æ®çš„è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ªéšæœºæ•°</strong>ï¼Œè¿™æ ·å°±ä¿è¯æ•°æ®ä¸ä¼šåœ¨åŒä¸€æ—¶é—´è¿‡æœŸã€‚</p>
<p><strong>2. äº’æ–¥é”æœºåˆ¶</strong></p>
<p>å½“ä¸šåŠ¡çº¿ç¨‹åœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œ<strong>å¦‚æœå‘ç°è®¿é—®çš„æ•°æ®ä¸åœ¨ Redis é‡Œï¼Œå°±åŠ ä¸ªäº’æ–¥é”ï¼Œä¿è¯åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªè¯·æ±‚æ¥æ„å»ºç¼“å­˜</strong>ï¼ˆä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå†å°†æ•°æ®æ›´æ–°åˆ° Redis é‡Œï¼‰ï¼Œå½“ç¼“å­˜æ„å»ºå®Œæˆåï¼Œå†é‡Šæ”¾é”ã€‚æœªèƒ½è·å–äº’æ–¥é”çš„è¯·æ±‚ï¼Œè¦ä¹ˆç­‰å¾…é”é‡Šæ”¾åé‡æ–°è¯»å–ç¼“å­˜ï¼Œè¦ä¹ˆå°±è¿”å›ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ã€‚</p>
<p><strong>é‡è¦æé†’</strong>ï¼šå®ç°äº’æ–¥é”çš„æ—¶å€™ï¼Œæœ€å¥½è®¾ç½®<strong>è¶…æ—¶æ—¶é—´</strong>ï¼Œä¸ç„¶ç¬¬ä¸€ä¸ªè¯·æ±‚æ‹¿åˆ°äº†é”ï¼Œç„¶åè¿™ä¸ªè¯·æ±‚å‘ç”Ÿäº†æŸç§æ„å¤–è€Œä¸€ç›´é˜»å¡ï¼Œä¸€ç›´ä¸é‡Šæ”¾é”ï¼Œè¿™æ—¶å…¶ä»–è¯·æ±‚ä¹Ÿä¸€ç›´æ‹¿ä¸åˆ°é”ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šå‡ºç°æ— å“åº”çš„ç°è±¡ã€‚</p>
<p><strong>3. åŒ key ç­–ç•¥</strong></p>
<p>æˆ‘ä»¬å¯¹ç¼“å­˜æ•°æ®å¯ä»¥ä½¿ç”¨ä¸¤ä¸ª keyï¼Œä¸€ä¸ªæ˜¯<strong>ä¸» keyï¼Œä¼šè®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>å¤‡ keyï¼Œä¸ä¼šè®¾ç½®è¿‡æœŸ</strong>ï¼Œå®ƒä»¬åªæ˜¯ key ä¸ä¸€æ ·ï¼Œä½†æ˜¯ value å€¼æ˜¯ä¸€æ ·çš„ï¼Œç›¸å½“äºç»™ç¼“å­˜æ•°æ®åšäº†ä¸ªå‰¯æœ¬ã€‚</p>
<p>å½“ä¸šåŠ¡çº¿ç¨‹è®¿é—®ä¸åˆ°ã€Œä¸» keyã€çš„ç¼“å­˜æ•°æ®æ—¶ï¼Œå°±ç›´æ¥è¿”å›ã€Œå¤‡ keyã€çš„ç¼“å­˜æ•°æ®ï¼Œç„¶ååœ¨æ›´æ–°ç¼“å­˜çš„æ—¶å€™ï¼Œ<strong>åŒæ—¶æ›´æ–°ã€Œä¸» keyã€å’Œã€Œå¤‡ keyã€çš„æ•°æ®ã€‚</strong></p>
<p><strong>ä¼˜åŠ¿</strong>ï¼šå½“ä¸» key è¿‡æœŸäº†ï¼Œæœ‰å¤§é‡è¯·æ±‚è·å–ç¼“å­˜æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›å¤‡ key çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿå“åº”è¯·æ±‚ã€‚è€Œä¸ç”¨å› ä¸º key å¤±æ•ˆè€Œå¯¼è‡´å¤§é‡è¯·æ±‚è¢«é”é˜»å¡ä½ï¼ˆé‡‡ç”¨äº†äº’æ–¥é”ï¼Œä»…ä¸€ä¸ªè¯·æ±‚æ¥æ„å»ºç¼“å­˜ï¼‰ï¼Œåç»­å†é€šçŸ¥åå°çº¿ç¨‹ï¼Œé‡æ–°æ„å»ºä¸» key çš„æ•°æ®ã€‚</p>
<p><strong>4. åå°æ›´æ–°ç¼“å­˜</strong></p>
<p>ä¸šåŠ¡çº¿ç¨‹ä¸å†è´Ÿè´£æ›´æ–°ç¼“å­˜ï¼Œç¼“å­˜ä¹Ÿä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œè€Œæ˜¯<strong>è®©ç¼“å­˜&quot;æ°¸ä¹…æœ‰æ•ˆ&quot;ï¼Œå¹¶å°†æ›´æ–°ç¼“å­˜çš„å·¥ä½œäº¤ç”±åå°çº¿ç¨‹å®šæ—¶æ›´æ–°</strong>ã€‚</p>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šç¼“å­˜æ•°æ®ä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€æ•°æ®ä¸€ç›´èƒ½åœ¨å†…å­˜é‡Œï¼Œå› ä¸º<strong>å½“ç³»ç»Ÿå†…å­˜ç´§å¼ çš„æ—¶å€™ï¼Œæœ‰äº›ç¼“å­˜æ•°æ®ä¼šè¢«&quot;æ·˜æ±°&quot;</strong>ï¼Œè€Œåœ¨ç¼“å­˜è¢«&quot;æ·˜æ±°&quot;åˆ°ä¸‹ä¸€æ¬¡åå°å®šæ—¶æ›´æ–°ç¼“å­˜çš„è¿™æ®µæ—¶é—´å†…ï¼Œä¸šåŠ¡çº¿ç¨‹è¯»å–ç¼“å­˜å¤±è´¥å°±è¿”å›ç©ºå€¼ï¼Œä¸šåŠ¡çš„è§†è§’å°±ä»¥ä¸ºæ˜¯æ•°æ®ä¸¢å¤±äº†ã€‚</p>
<p><strong>è§£å†³æ•°æ®è¢«æ·˜æ±°çš„ä¸¤ç§æ–¹å¼ï¼š</strong></p>
<p><strong>æ–¹å¼ä¸€ï¼šé¢‘ç¹æ£€æµ‹</strong><br>
åå°çº¿ç¨‹ä¸ä»…è´Ÿè´£å®šæ—¶æ›´æ–°ç¼“å­˜ï¼Œè€Œä¸”ä¹Ÿè´Ÿè´£<strong>é¢‘ç¹åœ°æ£€æµ‹ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ</strong>ï¼Œæ£€æµ‹åˆ°ç¼“å­˜å¤±æ•ˆäº†ï¼ŒåŸå› å¯èƒ½æ˜¯ç³»ç»Ÿç´§å¼ è€Œè¢«æ·˜æ±°çš„ï¼Œäºæ˜¯å°±è¦é©¬ä¸Šä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå¹¶æ›´æ–°åˆ°ç¼“å­˜ã€‚</p>
<p>è¿™ç§æ–¹å¼çš„æ£€æµ‹æ—¶é—´é—´éš”ä¸èƒ½å¤ªé•¿ï¼Œå¤ªé•¿ä¹Ÿå¯¼è‡´ç”¨æˆ·è·å–çš„æ•°æ®æ˜¯ä¸€ä¸ªç©ºå€¼è€Œä¸æ˜¯çœŸæ­£çš„æ•°æ®ï¼Œæ‰€ä»¥æ£€æµ‹çš„é—´éš”æœ€å¥½æ˜¯æ¯«ç§’çº§çš„ï¼Œä½†æ˜¯æ€»å½’æ˜¯æœ‰ä¸ªé—´éš”æ—¶é—´ï¼Œç”¨æˆ·ä½“éªŒä¸€èˆ¬ã€‚</p>
<p><strong>æ–¹å¼äºŒï¼šæ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥</strong><br>
åœ¨ä¸šåŠ¡çº¿ç¨‹å‘ç°ç¼“å­˜æ•°æ®å¤±æ•ˆåï¼ˆç¼“å­˜æ•°æ®è¢«æ·˜æ±°ï¼‰ï¼Œ<strong>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯é€šçŸ¥åå°çº¿ç¨‹æ›´æ–°ç¼“å­˜</strong>ï¼Œåå°çº¿ç¨‹æ”¶åˆ°æ¶ˆæ¯åï¼Œåœ¨æ›´æ–°ç¼“å­˜å‰å¯ä»¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±ä¸æ‰§è¡Œæ›´æ–°ç¼“å­˜æ“ä½œï¼›ä¸å­˜åœ¨å°±è¯»å–æ•°æ®åº“æ•°æ®ï¼Œå¹¶å°†æ•°æ®åŠ è½½åˆ°ç¼“å­˜ã€‚è¿™ç§æ–¹å¼ç›¸æ¯”ç¬¬ä¸€ç§æ–¹å¼ç¼“å­˜çš„æ›´æ–°ä¼šæ›´åŠæ—¶ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿæ¯”è¾ƒå¥½ã€‚</p>
<p><strong>ç¼“å­˜é¢„çƒ­</strong>ï¼šåœ¨ä¸šåŠ¡åˆšä¸Šçº¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ€å¥½æå‰æŠŠæ•°æ®ç¼“å­˜èµ·æ¥ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç”¨æˆ·è®¿é—®æ‰æ¥è§¦å‘ç¼“å­˜æ„å»ºï¼Œè¿™å°±æ˜¯æ‰€è°“çš„<strong>ç¼“å­˜é¢„çƒ­</strong>ï¼Œåå°æ›´æ–°ç¼“å­˜çš„æœºåˆ¶åˆšå¥½ä¹Ÿé€‚åˆå¹²è¿™ä¸ªäº‹æƒ…ã€‚</p>
<h4 id="é’ˆå¯¹-Redis-æ•…éšœå®•æœºçš„è§£å†³æ–¹æ¡ˆ">é’ˆå¯¹ Redis æ•…éšœå®•æœºçš„è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>1. æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµæœºåˆ¶</strong></p>
<p>å› ä¸º Redis æ•…éšœå®•æœºè€Œå¯¼è‡´ç¼“å­˜é›ªå´©é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨<strong>æœåŠ¡ç†”æ–­</strong>æœºåˆ¶ï¼Œ<strong>æš‚åœä¸šåŠ¡åº”ç”¨å¯¹ç¼“å­˜æœåŠ¡çš„è®¿é—®ï¼Œç›´æ¥è¿”å›é”™è¯¯</strong>ï¼Œä¸ç”¨å†ç»§ç»­è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé™ä½å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ï¼Œä¿è¯æ•°æ®åº“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œï¼Œç„¶åç­‰åˆ° Redis æ¢å¤æ­£å¸¸åï¼Œå†å…è®¸ä¸šåŠ¡åº”ç”¨è®¿é—®ç¼“å­˜æœåŠ¡ã€‚</p>
<p>æœåŠ¡ç†”æ–­æœºåˆ¶æ˜¯ä¿æŠ¤æ•°æ®åº“çš„æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯æš‚åœäº†ä¸šåŠ¡åº”ç”¨è®¿é—®ç¼“å­˜æœç³»ç»Ÿï¼Œå…¨éƒ¨ä¸šåŠ¡éƒ½æ— æ³•æ­£å¸¸å·¥ä½œ</p>
<p>ä¸ºäº†å‡å°‘å¯¹ä¸šåŠ¡çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨<strong>è¯·æ±‚é™æµ</strong>æœºåˆ¶ï¼Œ<strong>åªå°†å°‘éƒ¨åˆ†è¯·æ±‚å‘é€åˆ°æ•°æ®åº“è¿›è¡Œå¤„ç†ï¼Œå†å¤šçš„è¯·æ±‚å°±åœ¨å…¥å£ç›´æ¥æ‹’ç»æœåŠ¡</strong>ï¼Œç­‰åˆ° Redis æ¢å¤æ­£å¸¸å¹¶æŠŠç¼“å­˜é¢„çƒ­å®Œåï¼Œå†è§£é™¤è¯·æ±‚é™æµçš„æœºåˆ¶ã€‚</p>
<p><strong>2. æ„å»º Redis ç¼“å­˜é«˜å¯é é›†ç¾¤</strong></p>
<p>æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµæœºåˆ¶æ˜¯ç¼“å­˜é›ªå´©å‘ç”Ÿåçš„åº”å¯¹æ–¹æ¡ˆï¼Œæˆ‘ä»¬æœ€å¥½é€šè¿‡<strong>ä¸»ä»èŠ‚ç‚¹çš„æ–¹å¼æ„å»º Redis ç¼“å­˜é«˜å¯é é›†ç¾¤</strong>ã€‚</p>
<p>å¦‚æœ Redis ç¼“å­˜çš„ä¸»èŠ‚ç‚¹æ•…éšœå®•æœºï¼Œä»èŠ‚ç‚¹å¯ä»¥åˆ‡æ¢æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œç»§ç»­æä¾›ç¼“å­˜æœåŠ¡ï¼Œé¿å…äº†ç”±äº Redis æ•…éšœå®•æœºè€Œå¯¼è‡´çš„ç¼“å­˜é›ªå´©é—®é¢˜ã€‚</p>
<hr>
<h2 id="ç¼“å­˜å‡»ç©¿ï¼ˆCache-Breakdownï¼‰">ç¼“å­˜å‡»ç©¿ï¼ˆCache Breakdownï¼‰</h2>
<h3 id="é—®é¢˜å®šä¹‰-2">é—®é¢˜å®šä¹‰</h3>
<p>æˆ‘ä»¬çš„ä¸šåŠ¡é€šå¸¸ä¼šæœ‰å‡ ä¸ªæ•°æ®ä¼šè¢«é¢‘ç¹åœ°è®¿é—®ï¼Œæ¯”å¦‚ç§’æ€æ´»åŠ¨ï¼Œè¿™ç±»è¢«é¢‘ç¹è®¿é—®çš„æ•°æ®è¢«ç§°ä¸ºçƒ­ç‚¹æ•°æ®ã€‚</p>
<p>å¦‚æœç¼“å­˜ä¸­çš„<strong>æŸä¸ªçƒ­ç‚¹æ•°æ®è¿‡æœŸ</strong>äº†ï¼Œæ­¤æ—¶å¤§é‡çš„è¯·æ±‚è®¿é—®äº†è¯¥çƒ­ç‚¹æ•°æ®ï¼Œå°±æ— æ³•ä»ç¼“å­˜ä¸­è¯»å–ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“å¾ˆå®¹æ˜“å°±è¢«é«˜å¹¶å‘çš„è¯·æ±‚å†²å®ï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜å‡»ç©¿</strong>çš„é—®é¢˜ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/1749390552778.png" alt="ç¼“å­˜å‡»ç©¿ç¤ºæ„å›¾"></p>
<h3 id="ä¸ç¼“å­˜é›ªå´©çš„å…³ç³»">ä¸ç¼“å­˜é›ªå´©çš„å…³ç³»</h3>
<p>å¯ä»¥å‘ç°ç¼“å­˜å‡»ç©¿è·Ÿç¼“å­˜é›ªå´©å¾ˆç›¸ä¼¼ï¼Œä½ å¯ä»¥è®¤ä¸ºç¼“å­˜å‡»ç©¿æ˜¯ç¼“å­˜é›ªå´©çš„ä¸€ä¸ªå­é›†ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h3>
<p>åº”å¯¹ç¼“å­˜å‡»ç©¿å¯ä»¥é‡‡å–å‰é¢è¯´åˆ°ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ol>
<li>
<p><strong>äº’æ–¥é”æ–¹æ¡ˆ</strong>ï¼šä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä¸šåŠ¡çº¿ç¨‹æ›´æ–°ç¼“å­˜ï¼Œæœªèƒ½è·å–äº’æ–¥é”çš„è¯·æ±‚ï¼Œè¦ä¹ˆç­‰å¾…é”é‡Šæ”¾åé‡æ–°è¯»å–ç¼“å­˜ï¼Œè¦ä¹ˆå°±è¿”å›ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ã€‚</p>
</li>
<li>
<p><strong>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸç­–ç•¥</strong>ï¼šä¸ç»™çƒ­ç‚¹æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç”±åå°å¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œæˆ–è€…åœ¨çƒ­ç‚¹æ•°æ®å‡†å¤‡è¦è¿‡æœŸå‰ï¼Œæå‰é€šçŸ¥åå°çº¿ç¨‹æ›´æ–°ç¼“å­˜ä»¥åŠé‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p>
</li>
</ol>
<hr>
<h2 id="ç¼“å­˜ç©¿é€ï¼ˆCache-Penetrationï¼‰">ç¼“å­˜ç©¿é€ï¼ˆCache Penetrationï¼‰</h2>
<h3 id="é—®é¢˜å®šä¹‰-3">é—®é¢˜å®šä¹‰</h3>
<p>å½“å‘ç”Ÿç¼“å­˜é›ªå´©æˆ–å‡»ç©¿æ—¶ï¼Œæ•°æ®åº“ä¸­è¿˜æ˜¯ä¿å­˜äº†åº”ç”¨è¦è®¿é—®çš„æ•°æ®ï¼Œä¸€æ—¦ç¼“å­˜æ¢å¤ç›¸å¯¹åº”çš„æ•°æ®ï¼Œå°±å¯ä»¥å‡è½»æ•°æ®åº“çš„å‹åŠ›ï¼Œè€Œç¼“å­˜ç©¿é€å°±ä¸ä¸€æ ·äº†ã€‚</p>
<p>å½“ç”¨æˆ·è®¿é—®çš„æ•°æ®ï¼Œ<strong>æ—¢ä¸åœ¨ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­</strong>ï¼Œå¯¼è‡´è¯·æ±‚åœ¨è®¿é—®ç¼“å­˜æ—¶ï¼Œå‘ç°ç¼“å­˜ç¼ºå¤±ï¼Œå†å»è®¿é—®æ•°æ®åº“æ—¶ï¼Œå‘ç°æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰è¦è®¿é—®çš„æ•°æ®ï¼Œæ²¡åŠæ³•æ„å»ºç¼“å­˜æ•°æ®ï¼Œæ¥æœåŠ¡åç»­çš„è¯·æ±‚ã€‚é‚£ä¹ˆå½“æœ‰å¤§é‡è¿™æ ·çš„è¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ•°æ®åº“çš„å‹åŠ›éª¤å¢ï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜ç©¿é€</strong>çš„é—®é¢˜ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/1749390566052.png" alt="ç¼“å­˜ç©¿é€ç¤ºæ„å›¾"></p>
<h3 id="äº§ç”ŸåŸå› -2">äº§ç”ŸåŸå› </h3>
<p>ç¼“å­˜ç©¿é€çš„å‘ç”Ÿä¸€èˆ¬æœ‰è¿™ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li><strong>ä¸šåŠ¡è¯¯æ“ä½œ</strong>ï¼šç¼“å­˜ä¸­çš„æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®éƒ½è¢«è¯¯åˆ é™¤äº†ï¼Œæ‰€ä»¥å¯¼è‡´ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰æ•°æ®</li>
<li><strong>é»‘å®¢æ¶æ„æ”»å‡»</strong>ï¼šæ•…æ„å¤§é‡è®¿é—®æŸäº›è¯»å–ä¸å­˜åœ¨æ•°æ®çš„ä¸šåŠ¡</li>
</ol>
<h3 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h3>
<p>åº”å¯¹ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆï¼Œå¸¸è§çš„æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p>
<p><strong>1. éæ³•è¯·æ±‚çš„é™åˆ¶</strong></p>
<p>å½“æœ‰å¤§é‡æ¶æ„è¯·æ±‚è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‘ç”Ÿç¼“å­˜ç©¿é€ï¼Œå› æ­¤åœ¨ API å…¥å£å¤„æˆ‘ä»¬è¦åˆ¤æ–­å‡ºè¯·æ±‚å‚æ•°æ˜¯å¦åˆç†ï¼Œè¯·æ±‚å‚æ•°æ˜¯å¦å«æœ‰éæ³•å€¼ã€è¯·æ±‚å­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœåˆ¤æ–­å‡ºæ˜¯æ¶æ„è¯·æ±‚å°±ç›´æ¥è¿”å›é”™è¯¯ï¼Œé¿å…è¿›ä¸€æ­¥è®¿é—®ç¼“å­˜å’Œæ•°æ®åº“ã€‚</p>
<p><strong>2. ç¼“å­˜ç©ºå€¼æˆ–è€…é»˜è®¤å€¼</strong></p>
<p>å½“æˆ‘ä»¬çº¿ä¸Šä¸šåŠ¡å‘ç°ç¼“å­˜ç©¿é€çš„ç°è±¡æ—¶ï¼Œå¯ä»¥é’ˆå¯¹æŸ¥è¯¢çš„æ•°æ®ï¼Œåœ¨ç¼“å­˜ä¸­è®¾ç½®ä¸€ä¸ªç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œè¿™æ ·åç»­è¯·æ±‚å°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–åˆ°ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œè¿”å›ç»™åº”ç”¨ï¼Œè€Œä¸ä¼šç»§ç»­æŸ¥è¯¢æ•°æ®åº“ã€‚</p>
<p><strong>3. ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨</strong></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨å†™å…¥æ•°æ®åº“æ•°æ®æ—¶ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åšä¸ªæ ‡è®°ï¼Œç„¶ååœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä¸šåŠ¡çº¿ç¨‹ç¡®è®¤ç¼“å­˜å¤±æ•ˆåï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¸ç”¨é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚</p>
<p>å³ä½¿å‘ç”Ÿäº†ç¼“å­˜ç©¿é€ï¼Œå¤§é‡è¯·æ±‚åªä¼šæŸ¥è¯¢ Redis å’Œå¸ƒéš†è¿‡æ»¤å™¨ï¼Œè€Œä¸ä¼šæŸ¥è¯¢æ•°æ®åº“ï¼Œä¿è¯äº†æ•°æ®åº“èƒ½æ­£å¸¸è¿è¡Œï¼ŒRedis è‡ªèº«ä¹Ÿæ˜¯æ”¯æŒå¸ƒéš†è¿‡æ»¤å™¨çš„ã€‚</p>
<h3 id="å¸ƒéš†è¿‡æ»¤å™¨å·¥ä½œåŸç†">å¸ƒéš†è¿‡æ»¤å™¨å·¥ä½œåŸç†</h3>
<p>å¸ƒéš†è¿‡æ»¤å™¨ç”±ã€Œåˆå§‹å€¼éƒ½ä¸º 0 çš„ä½å›¾æ•°ç»„ã€å’Œã€ŒN ä¸ªå“ˆå¸Œå‡½æ•°ã€ä¸¤éƒ¨åˆ†ç»„æˆã€‚å½“æˆ‘ä»¬åœ¨å†™å…¥æ•°æ®åº“æ•°æ®æ—¶ï¼Œåœ¨å¸ƒéš†è¿‡æ»¤å™¨é‡Œåšä¸ªæ ‡è®°ï¼Œè¿™æ ·ä¸‹æ¬¡æŸ¥è¯¢æ•°æ®æ˜¯å¦åœ¨æ•°æ®åº“æ—¶ï¼Œåªéœ€è¦æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¦‚æœæŸ¥è¯¢åˆ°æ•°æ®æ²¡æœ‰è¢«æ ‡è®°ï¼Œè¯´æ˜ä¸åœ¨æ•°æ®åº“ä¸­ã€‚</p>
<h4 id="å¸ƒéš†è¿‡æ»¤å™¨æ ‡è®°è¿‡ç¨‹">å¸ƒéš†è¿‡æ»¤å™¨æ ‡è®°è¿‡ç¨‹</h4>
<p>å¸ƒéš†è¿‡æ»¤å™¨ä¼šé€šè¿‡ 3 ä¸ªæ“ä½œå®Œæˆæ ‡è®°ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€æ­¥</strong>ï¼šä½¿ç”¨ N ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«å¯¹æ•°æ®åšå“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ° N ä¸ªå“ˆå¸Œå€¼</li>
<li><strong>ç¬¬äºŒæ­¥</strong>ï¼šå°†ç¬¬ä¸€æ­¥å¾—åˆ°çš„ N ä¸ªå“ˆå¸Œå€¼å¯¹ä½å›¾æ•°ç»„çš„é•¿åº¦å–æ¨¡ï¼Œå¾—åˆ°æ¯ä¸ªå“ˆå¸Œå€¼åœ¨ä½å›¾æ•°ç»„çš„å¯¹åº”ä½ç½®</li>
<li><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šå°†æ¯ä¸ªå“ˆå¸Œå€¼åœ¨ä½å›¾æ•°ç»„çš„å¯¹åº”ä½ç½®çš„å€¼è®¾ç½®ä¸º 1</li>
</ol>
<h4 id="å¸ƒéš†è¿‡æ»¤å™¨ç¤ºä¾‹">å¸ƒéš†è¿‡æ»¤å™¨ç¤ºä¾‹</h4>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªä½å›¾æ•°ç»„é•¿åº¦ä¸º 8ï¼Œå“ˆå¸Œå‡½æ•° 3 ä¸ªçš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/1749390582756.png" alt="å¸ƒéš†è¿‡æ»¤å™¨ç¤ºä¾‹"></p>
<p>åœ¨æ•°æ®åº“å†™å…¥æ•°æ® x åï¼ŒæŠŠæ•°æ® x æ ‡è®°åœ¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œæ•°æ® x ä¼šè¢« 3 ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«è®¡ç®—å‡º 3 ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶ååœ¨å¯¹è¿™ 3 ä¸ªå“ˆå¸Œå€¼å¯¹ 8 å–æ¨¡ï¼Œå‡è®¾å–æ¨¡çš„ç»“æœä¸º 1ã€4ã€6ï¼Œç„¶åæŠŠä½å›¾æ•°ç»„çš„ç¬¬ 1ã€4ã€6 ä½ç½®çš„å€¼è®¾ç½®ä¸º 1ã€‚<strong>å½“åº”ç”¨è¦æŸ¥è¯¢æ•°æ® x æ˜¯å¦æ•°æ®åº“æ—¶ï¼Œé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åªè¦æŸ¥åˆ°ä½å›¾æ•°ç»„çš„ç¬¬ 1ã€4ã€6 ä½ç½®çš„å€¼æ˜¯å¦å…¨ä¸º 1ï¼Œåªè¦æœ‰ä¸€ä¸ªä¸º 0ï¼Œå°±è®¤ä¸ºæ•°æ® x ä¸åœ¨æ•°æ®åº“ä¸­</strong>ã€‚</p>
<h4 id="å¸ƒéš†è¿‡æ»¤å™¨çš„ç‰¹ç‚¹">å¸ƒéš†è¿‡æ»¤å™¨çš„ç‰¹ç‚¹</h4>
<p>å¸ƒéš†è¿‡æ»¤å™¨ç”±äºæ˜¯åŸºäºå“ˆå¸Œå‡½æ•°å®ç°æŸ¥æ‰¾çš„ï¼Œé«˜æ•ˆæŸ¥æ‰¾çš„åŒæ—¶<strong>å­˜åœ¨å“ˆå¸Œå†²çªçš„å¯èƒ½æ€§</strong>ï¼Œæ¯”å¦‚æ•°æ® x å’Œæ•°æ® y å¯èƒ½éƒ½è½åœ¨ç¬¬ 1ã€4ã€6 ä½ç½®ï¼Œè€Œäº‹å®ä¸Šï¼Œå¯èƒ½æ•°æ®åº“ä¸­å¹¶ä¸å­˜åœ¨æ•°æ® yï¼Œå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨è¯´æ•°æ®å­˜åœ¨ï¼Œå¹¶ä¸ä¸€å®šè¯æ˜æ•°æ®åº“ä¸­å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œä½†æ˜¯æŸ¥è¯¢åˆ°æ•°æ®ä¸å­˜åœ¨ï¼Œæ•°æ®åº“ä¸­ä¸€å®šå°±ä¸å­˜åœ¨è¿™ä¸ªæ•°æ®</strong>ã€‚</p>
<hr>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ç¼“å­˜å¼‚å¸¸ä¼šé¢ä¸´çš„ä¸‰ä¸ªé—®é¢˜ï¼šç¼“å­˜é›ªå´©ã€å‡»ç©¿å’Œç©¿é€ã€‚</p>
<p>å…¶ä¸­ï¼Œç¼“å­˜é›ªå´©å’Œç¼“å­˜å‡»ç©¿ä¸»è¦åŸå› æ˜¯æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œè€Œå¯¼è‡´å¤§é‡è¯·æ±‚è®¿é—®äº†æ•°æ®åº“ï¼Œæ•°æ®åº“å‹åŠ›éª¤å¢ï¼Œå®¹æ˜“å¼•å‘ä¸€ç³»åˆ—è¿é”ååº”ï¼Œå¯¼è‡´ç³»ç»Ÿå¥”æºƒã€‚ä¸è¿‡ï¼Œä¸€æ—¦æ•°æ®è¢«é‡æ–°åŠ è½½å›ç¼“å­˜ï¼Œåº”ç”¨åˆå¯ä»¥ä»ç¼“å­˜å¿«é€Ÿè¯»å–æ•°æ®ï¼Œä¸å†ç»§ç»­è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“çš„å‹åŠ›ä¹Ÿä¼šç¬é—´é™ä¸‹æ¥ã€‚å› æ­¤ï¼Œç¼“å­˜é›ªå´©å’Œç¼“å­˜å‡»ç©¿åº”å¯¹çš„æ–¹æ¡ˆæ¯”è¾ƒç±»ä¼¼ã€‚</p>
<p>è€Œç¼“å­˜ç©¿é€ä¸»è¦åŸå› æ˜¯æ•°æ®æ—¢ä¸åœ¨ç¼“å­˜ä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ã€‚å› æ­¤ï¼Œç¼“å­˜ç©¿é€ä¸ç¼“å­˜é›ªå´©ã€å‡»ç©¿åº”å¯¹çš„æ–¹æ¡ˆä¸å¤ªä¸€æ ·ã€‚</p>
<p>æˆ‘è¿™é‡Œæ•´ç†äº†è¡¨æ ¼ï¼Œä½ å¯ä»¥ä»ä¸‹é¢è¿™å¼ è¡¨æ ¼å¾ˆå¥½çš„çŸ¥é“ç¼“å­˜é›ªå´©ã€å‡»ç©¿å’Œç©¿é€çš„åŒºåˆ«ä»¥åŠåº”å¯¹æ–¹æ¡ˆã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9or%E7%A9%BF%E9%80%8For%E5%87%BB%E7%A9%BF/1749390596934.png" alt="ä¸‰å¤§ç¼“å­˜é—®é¢˜å¯¹æ¯”è¡¨"></p>
<h2 id="é¢è¯•è¦ç‚¹">é¢è¯•è¦ç‚¹</h2>
<p>åœ¨æŠ€æœ¯é¢è¯•ä¸­ï¼Œè¿™ä¸‰ä¸ªç¼“å­˜é—®é¢˜ç»å¸¸è¢«æåŠï¼ŒæŒæ¡ä»¥ä¸‹è¦ç‚¹ï¼š</p>
<ol>
<li><strong>èƒ½å‡†ç¡®åŒºåˆ†ä¸‰è€…çš„åŒºåˆ«</strong>ï¼šé›ªå´©ï¼ˆå¤§é‡keyè¿‡æœŸæˆ–Rediså®•æœºï¼‰ã€å‡»ç©¿ï¼ˆçƒ­ç‚¹keyè¿‡æœŸï¼‰ã€ç©¿é€ï¼ˆæ•°æ®ä¸å­˜åœ¨ï¼‰</li>
<li><strong>ç†Ÿæ‚‰å„ç§è§£å†³æ–¹æ¡ˆçš„é€‚ç”¨åœºæ™¯</strong>ï¼šäº’æ–¥é”é€‚åˆå‡»ç©¿ï¼Œå¸ƒéš†è¿‡æ»¤å™¨é€‚åˆç©¿é€ï¼Œé›†ç¾¤+é™æµé€‚åˆé›ªå´©</li>
<li><strong>äº†è§£æ¯ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹</strong>ï¼šå¦‚äº’æ–¥é”å¯èƒ½å¯¼è‡´é˜»å¡ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤ç­‰</li>
<li><strong>èƒ½ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯åˆ†æ</strong>ï¼šæ¯”å¦‚ç§’æ€åœºæ™¯çš„çƒ­ç‚¹æ•°æ®ã€çˆ¬è™«æ”»å‡»çš„ä¸å­˜åœ¨æ•°æ®ç­‰</li>
</ol>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>ç¼“å­˜</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>ç¼“å­˜</tag>
        <tag>ç¼“å­˜é›ªå´©</tag>
        <tag>ç¼“å­˜ç©¿é€</tag>
        <tag>ç¼“å­˜å‡»ç©¿</tag>
        <tag>é«˜å¯ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis Cluster é›†ç¾¤è¯¦è§£ï¼šæ¶æ„åŸç†ã€å“ˆå¸Œæ§½ä¸æ•…éšœè½¬ç§»</title>
    <url>/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/</url>
    <content><![CDATA[<h1>Redis Cluster é›†ç¾¤è¯¦è§£ï¼šæ¶æ„åŸç†ã€å“ˆå¸Œæ§½ä¸æ•…éšœè½¬ç§»</h1>
<p>å½“é¢è¯•å®˜é—®ï¼š&quot;Redisçš„clusteré›†ç¾¤åŸç†ï¼Œå®¢æˆ·ç«¯æ˜¯æ€æ ·çŸ¥é“è¯¥è®¿é—®å“ªä¸ªåˆ†ç‰‡çš„ï¼Ÿ&quot;æ—¶ï¼Œä½ æ˜¯å¦èƒ½å¤Ÿå®Œæ•´å›ç­”ï¼Ÿæœ¬æ–‡å°†ä»å¤šä¸ªç»´åº¦æ·±å…¥è§£æRedis Clusteré›†ç¾¤çš„æ ¸å¿ƒæœºåˆ¶ã€‚</p>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>Redis Clusteræ˜¯Redis 3.0ç‰ˆæœ¬å¼€å§‹å®˜æ–¹æä¾›çš„ä¸€ç§åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œå®ƒå®ç°äº†æ•°æ®çš„è‡ªåŠ¨åˆ†ç‰‡ã€æ•…éšœè½¬ç§»å’Œçº¿æ€§æ‰©å®¹èƒ½åŠ›ã€‚ç›¸æ¯”ä¸»ä»å’Œå“¨å…µæ¨¡å¼ï¼ŒClusterè§£å†³äº†å•æœºå†…å­˜é™åˆ¶å’Œåœ¨çº¿æ‰©å®¹çš„é—®é¢˜ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦Redis-Clusterï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦Redis Clusterï¼Ÿ</h2>
<h3 id="å“¨å…µæ¨¡å¼çš„å±€é™æ€§">å“¨å…µæ¨¡å¼çš„å±€é™æ€§</h3>
<p>å“¨å…µæ¨¡å¼è™½ç„¶å®ç°äº†è¯»å†™åˆ†ç¦»å’Œè‡ªåŠ¨æ•…éšœåˆ‡æ¢ï¼Œä½†å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li><strong>æ•°æ®å†—ä½™</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ç›¸åŒæ•°æ®ï¼Œæµªè´¹å†…å­˜èµ„æº</li>
<li><strong>æ‰©å®¹å›°éš¾</strong>ï¼šæ— æ³•åœ¨çº¿æ‰©å®¹ï¼Œæ‰©å®¹éœ€è¦åœæœºæ“ä½œ</li>
<li><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šå•æœºå†…å­˜é™åˆ¶ï¼Œæ— æ³•å¤„ç†è¶…å¤§æ•°æ®é›†</li>
</ol>
<h3 id="Clusteræ¨¡å¼çš„ä¼˜åŠ¿">Clusteræ¨¡å¼çš„ä¼˜åŠ¿</h3>
<p>Redis Clusteré€šè¿‡æ•°æ®åˆ†ç‰‡æŠ€æœ¯ï¼Œå°†æ•°æ®åˆ†æ•£å­˜å‚¨åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/1749383883337.png" alt="1749383883337"></p>
<p><strong>å¯¹æ¯”ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>æ•°æ®åˆ†ç‰‡</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨éƒ¨åˆ†æ•°æ®ï¼Œå……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æº</li>
<li><strong>çº¿æ€§æ‰©å®¹</strong>ï¼šæ”¯æŒåœ¨çº¿æ·»åŠ /åˆ é™¤èŠ‚ç‚¹ï¼Œå®ç°åŠ¨æ€æ‰©å®¹</li>
<li><strong>é«˜å¯ç”¨</strong>ï¼šå†…ç½®æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»æœºåˆ¶</li>
<li><strong>æ€§èƒ½æå‡</strong>ï¼šåˆ†å¸ƒå¼æ¶æ„ï¼Œçªç ´å•æœºæ€§èƒ½é™åˆ¶</li>
</ul>
<h2 id="æ ¸å¿ƒæœºåˆ¶ï¼šå“ˆå¸Œæ§½åˆ†ç‰‡">æ ¸å¿ƒæœºåˆ¶ï¼šå“ˆå¸Œæ§½åˆ†ç‰‡</h2>
<h3 id="å“ˆå¸Œæ§½åŸç†">å“ˆå¸Œæ§½åŸç†</h3>
<p>Redis Clusteré‡‡ç”¨**å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰**æœºåˆ¶å®ç°æ•°æ®åˆ†ç‰‡ï¼š</p>
<ul>
<li><strong>æ§½ä½æ€»æ•°</strong>ï¼š16384ä¸ªæ§½ä½ï¼ˆ0-16383ï¼‰</li>
<li><strong>åˆ†é…ç®—æ³•</strong>ï¼š<code>slot = CRC16(key) % 16384</code></li>
<li><strong>æ§½ä½åˆ†é…</strong>ï¼šæ¯ä¸ªä¸»èŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†æ§½ä½</li>
</ul>
<h3 id="æ§½ä½åˆ†é…ç¤ºä¾‹">æ§½ä½åˆ†é…ç¤ºä¾‹</h3>
<p>å‡è®¾é›†ç¾¤æœ‰3ä¸ªä¸»èŠ‚ç‚¹Aã€Bã€Cï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">èŠ‚ç‚¹Aï¼šè´Ÿè´£æ§½ä½ 0-5460     ï¼ˆ5461ä¸ªæ§½ä½ï¼‰</span><br><span class="line">èŠ‚ç‚¹Bï¼šè´Ÿè´£æ§½ä½ 5461-10922  ï¼ˆ5462ä¸ªæ§½ä½ï¼‰ </span><br><span class="line">èŠ‚ç‚¹Cï¼šè´Ÿè´£æ§½ä½ 10923-16383 ï¼ˆ5461ä¸ªæ§½ä½ï¼‰</span><br></pre></td></tr></table></figure>
<h3 id="å®¢æˆ·ç«¯è·¯ç”±æµç¨‹">å®¢æˆ·ç«¯è·¯ç”±æµç¨‹</h3>
<ol>
<li><strong>è®¡ç®—æ§½ä½</strong>ï¼šå®¢æˆ·ç«¯æ ¹æ®keyè®¡ç®—å¯¹åº”æ§½ä½</li>
<li><strong>é€‰æ‹©èŠ‚ç‚¹</strong>ï¼šæ ¹æ®æ§½ä½æ˜ å°„æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹</li>
<li><strong>å‘é€è¯·æ±‚</strong>ï¼šç›´æ¥å‘ç›®æ ‡èŠ‚ç‚¹å‘é€æ“ä½œå‘½ä»¤</li>
</ol>
<h2 id="é‡å®šå‘æœºåˆ¶">é‡å®šå‘æœºåˆ¶</h2>
<p>å½“å®¢æˆ·ç«¯è®¿é—®çš„æ•°æ®ä¸åœ¨å½“å‰èŠ‚ç‚¹æ—¶ï¼ŒRedisé€šè¿‡é‡å®šå‘æœºåˆ¶å¤„ç†ï¼š</p>
<h3 id="MOVEDé‡å®šå‘">MOVEDé‡å®šå‘</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ­£å¸¸æƒ…å†µä¸‹çš„æ§½ä½é‡å®šå‘</p>
<p><strong>å¤„ç†æµç¨‹</strong>ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/1749383898270.png" alt="1749383898270"></p>
<ol>
<li>å®¢æˆ·ç«¯å‘èŠ‚ç‚¹Aè¯·æ±‚key1çš„æ•°æ®</li>
<li>èŠ‚ç‚¹Aå‘ç°key1ä¸å±äºè‡ªå·±çš„æ§½ä½</li>
<li>è¿”å›MOVEDé”™è¯¯ï¼ŒåŒ…å«æ­£ç¡®èŠ‚ç‚¹çš„åœ°å€</li>
<li>å®¢æˆ·ç«¯æ›´æ–°æ§½ä½æ˜ å°„ï¼Œç›´æ¥è®¿é—®æ­£ç¡®èŠ‚ç‚¹</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; GET user:1001</span><br><span class="line">-MOVED 9189 192.168.1.102:6379</span><br></pre></td></tr></table></figure>
<h3 id="ASKé‡å®šå‘">ASKé‡å®šå‘</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé›†ç¾¤æ‰©å®¹/ç¼©å®¹æœŸé—´çš„æ•°æ®è¿ç§»</p>
<p><strong>å¤„ç†æµç¨‹</strong>ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/1749383910842.png" alt="1749383910842"></p>
<ol>
<li>å®¢æˆ·ç«¯è®¿é—®æºèŠ‚ç‚¹ï¼Œæ•°æ®å¯èƒ½å·²è¿ç§»</li>
<li>æºèŠ‚ç‚¹è¿”å›ASKé‡å®šå‘åˆ°ç›®æ ‡èŠ‚ç‚¹</li>
<li>å®¢æˆ·ç«¯å‘ç›®æ ‡èŠ‚ç‚¹å‘é€ASKINGå‘½ä»¤</li>
<li>æ‰§è¡Œå®é™…çš„æ•°æ®æ“ä½œ</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; GET user:1001</span><br><span class="line">-ASK 9189 192.168.1.103:6379</span><br><span class="line">&gt; ASKING</span><br><span class="line">OK</span><br><span class="line">&gt; GET user:1001</span><br><span class="line">&quot;user_data&quot;</span><br></pre></td></tr></table></figure>
<h3 id="é‡å®šå‘å¯¹æ¯”">é‡å®šå‘å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>é‡å®šå‘ç±»å‹</th>
<th>è§¦å‘æ¡ä»¶</th>
<th>å®¢æˆ·ç«¯è¡Œä¸º</th>
<th>æŒç»­æ—¶é—´</th>
</tr>
</thead>
<tbody>
<tr>
<td>MOVED</td>
<td>æ§½ä½å›ºå®šåˆ†é…ä¸åŒ¹é…</td>
<td>æ›´æ–°æ§½ä½æ˜ å°„è¡¨</td>
<td>æ°¸ä¹…æœ‰æ•ˆ</td>
</tr>
<tr>
<td>ASK</td>
<td>æ•°æ®è¿ç§»è¿‡ç¨‹ä¸­</td>
<td>ä¸´æ—¶é‡å®šå‘ï¼Œä¸æ›´æ–°æ˜ å°„</td>
<td>è¿ç§»æœŸé—´</td>
</tr>
</tbody>
</table>
<h2 id="Gossipé€šä¿¡åè®®">Gossipé€šä¿¡åè®®</h2>
<h3 id="åè®®æ¦‚è¿°">åè®®æ¦‚è¿°</h3>
<p>Redis Clusterä½¿ç”¨<strong>Gossipåè®®</strong>å®ç°èŠ‚ç‚¹é—´çš„ä¿¡æ¯åŒæ­¥ï¼Œè¿™æ˜¯ä¸€ç§å»ä¸­å¿ƒåŒ–çš„é€šä¿¡æœºåˆ¶ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/1749383923502.png" alt="1749383923502"></p>
<h3 id="æ¶ˆæ¯ç±»å‹">æ¶ˆæ¯ç±»å‹</h3>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯ç±»å‹</th>
<th>ç”¨é€”</th>
<th>å‘é€æ—¶æœº</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PING</strong></td>
<td>å¿ƒè·³æ£€æµ‹</td>
<td>æ¯ç§’å‘éšæœºèŠ‚ç‚¹å‘é€</td>
</tr>
<tr>
<td><strong>PONG</strong></td>
<td>å¿ƒè·³å“åº”</td>
<td>æ”¶åˆ°PING/MEETæ¶ˆæ¯æ—¶å›å¤</td>
</tr>
<tr>
<td><strong>MEET</strong></td>
<td>èŠ‚ç‚¹åŠ å…¥</td>
<td>æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶</td>
</tr>
<tr>
<td><strong>FAIL</strong></td>
<td>æ•…éšœå¹¿æ’­</td>
<td>æ£€æµ‹åˆ°èŠ‚ç‚¹æ•…éšœæ—¶</td>
</tr>
</tbody>
</table>
<h3 id="é€šä¿¡æœºåˆ¶">é€šä¿¡æœºåˆ¶</h3>
<p><strong>é›†ç¾¤æ€»çº¿</strong>ï¼š</p>
<ul>
<li>ç«¯å£ï¼šæœåŠ¡ç«¯å£ + 10000ï¼ˆå¦‚6379 â†’ 16379ï¼‰</li>
<li>åè®®ï¼šäºŒè¿›åˆ¶åè®®ï¼Œæ•ˆç‡æ›´é«˜</li>
<li>é¢‘ç‡ï¼šæ¯ç§’éšæœºé€‰æ‹©èŠ‚ç‚¹è¿›è¡Œé€šä¿¡</li>
</ul>
<p><strong>ä¿¡æ¯ä¼ æ’­</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡PINGæ¶ˆæ¯æºå¸¦å‘é€è€…å·²çŸ¥çš„èŠ‚ç‚¹ä¿¡æ¯</li>
<li>æ¥æ”¶è€…æ›´æ–°æœ¬åœ°çš„é›†ç¾¤æ‹“æ‰‘ä¿¡æ¯</li>
<li>é€šè¿‡å¤šè½®ä¼ æ’­å®ç°æœ€ç»ˆä¸€è‡´æ€§</li>
</ul>
<h2 id="æ•…éšœæ£€æµ‹ä¸è½¬ç§»">æ•…éšœæ£€æµ‹ä¸è½¬ç§»</h2>
<h3 id="æ•…éšœæ£€æµ‹">æ•…éšœæ£€æµ‹</h3>
<h4 id="ä¸»è§‚ä¸‹çº¿ï¼ˆPFAILï¼‰">ä¸»è§‚ä¸‹çº¿ï¼ˆPFAILï¼‰</h4>
<p><strong>æ£€æµ‹æ¡ä»¶</strong>ï¼š</p>
<ul>
<li>æŸèŠ‚ç‚¹åœ¨<code>cluster-node-timeout</code>æ—¶é—´å†…æ— å“åº”</li>
<li>å•ä¸ªèŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå¯èƒ½å­˜åœ¨è¯¯åˆ¤</li>
</ul>
<p><strong>æ ‡è®°æµç¨‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">èŠ‚ç‚¹A â†’ PING â†’ èŠ‚ç‚¹Bï¼ˆæ— å“åº”ï¼‰</span><br><span class="line">èŠ‚ç‚¹Aæ ‡è®°èŠ‚ç‚¹Bä¸ºPFAILçŠ¶æ€</span><br></pre></td></tr></table></figure>
<h4 id="å®¢è§‚ä¸‹çº¿ï¼ˆFAILï¼‰">å®¢è§‚ä¸‹çº¿ï¼ˆFAILï¼‰</h4>
<p><strong>æ£€æµ‹æ¡ä»¶</strong>ï¼š</p>
<ul>
<li>è¶…è¿‡åŠæ•°ä¸»èŠ‚ç‚¹è®¤ä¸ºç›®æ ‡èŠ‚ç‚¹ä¸å¯ç”¨</li>
<li>é›†ç¾¤è¾¾æˆå…±è¯†ï¼Œç¡®è®¤èŠ‚ç‚¹æ•…éšœ</li>
</ul>
<p><strong>ç¡®è®¤æµç¨‹</strong>ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/1749383935543.png" alt="1749383935543"></p>
<ol>
<li>èŠ‚ç‚¹Aå°†Bæ ‡è®°ä¸ºPFAIL</li>
<li>Aé€šè¿‡Gossipå°†Bçš„PFAILçŠ¶æ€ä¼ æ’­</li>
<li>å…¶ä»–èŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯ï¼Œå¦‚æœä¹Ÿè®¤ä¸ºBæ•…éšœï¼Œåˆ™æŠ•ç¥¨</li>
<li>å½“æ•…éšœæŠ•ç¥¨æ•° &gt; é›†ç¾¤ä¸»èŠ‚ç‚¹æ•°/2æ—¶ï¼ŒBè¢«æ ‡è®°ä¸ºFAIL</li>
</ol>
<h3 id="æ•…éšœè½¬ç§»">æ•…éšœè½¬ç§»</h3>
<p><strong>è½¬ç§»æ¡ä»¶</strong>ï¼š</p>
<ul>
<li>ä¸»èŠ‚ç‚¹è¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿</li>
<li>è¯¥ä¸»èŠ‚ç‚¹è‡³å°‘æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹å¯ç”¨</li>
</ul>
<p><strong>è½¬ç§»æµç¨‹</strong>ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/1749384093494.png" alt="1749384093494"></p>
<ol>
<li><strong>èµ„æ ¼æ£€æŸ¥</strong>ï¼šä»èŠ‚ç‚¹æ£€æŸ¥è‡ªèº«æ˜¯å¦å…·å¤‡æ›¿æ¢ä¸»èŠ‚ç‚¹çš„æ¡ä»¶</li>
<li><strong>å‡†å¤‡é€‰ä¸¾</strong>ï¼šè®¡ç®—é€‰ä¸¾å»¶è¿Ÿæ—¶é—´ï¼Œæ•°æ®è¶Šæ–°å»¶è¿Ÿè¶ŠçŸ­</li>
<li><strong>å‘èµ·é€‰ä¸¾</strong>ï¼šå‘æ‰€æœ‰ä¸»èŠ‚ç‚¹å‘é€é€‰ä¸¾è¯·æ±‚</li>
<li><strong>æŠ•ç¥¨ç»Ÿè®¡</strong>ï¼šæ”¶é›†è¶³å¤Ÿé€‰ç¥¨ï¼ˆ&gt;ä¸»èŠ‚ç‚¹æ•°/2ï¼‰åï¼Œæå‡ä¸ºä¸»èŠ‚ç‚¹</li>
<li><strong>æ›´æ–°é…ç½®</strong>ï¼šå¹¿æ’­é…ç½®æ›´æ–°ï¼Œå®Œæˆæ•…éšœè½¬ç§»</li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆå“ˆå¸Œæ§½æ˜¯16384ï¼Ÿ">ä¸ºä»€ä¹ˆå“ˆå¸Œæ§½æ˜¯16384ï¼Ÿ</h2>
<p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„é¢è¯•é—®é¢˜ï¼Œä½œè€…çš„åŸå§‹å›ç­”æåˆ°äº†å‡ ä¸ªå…³é”®å› ç´ ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/1749384103361.png" alt="1749384103361"></p>
<h3 id="å†…å­˜ä¼˜åŒ–è€ƒè™‘">å†…å­˜ä¼˜åŒ–è€ƒè™‘</h3>
<p><strong>æ§½ä½å­˜å‚¨</strong>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> slots[REDIS_CLUSTER_SLOTS/<span class="number">8</span>];</span><br></pre></td></tr></table></figure>
<p><strong>ç©ºé—´å¯¹æ¯”</strong>ï¼š</p>
<ul>
<li>65536ä¸ªæ§½ä½ï¼š65536 Ã· 8 Ã· 1024 = 8KB</li>
<li>16384ä¸ªæ§½ä½ï¼š16384 Ã· 8 Ã· 1024 = 2KB</li>
<li><strong>èŠ‚çœç©ºé—´</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹èŠ‚çœ6KBï¼Œ100ä¸ªèŠ‚ç‚¹é›†ç¾¤èŠ‚çœ600KB</li>
</ul>
<h3 id="ç½‘ç»œå¼€é”€è€ƒè™‘">ç½‘ç»œå¼€é”€è€ƒè™‘</h3>
<p><strong>å¿ƒè·³åŒ…å¤§å°</strong>ï¼š</p>
<ul>
<li>Gossipåè®®éœ€è¦åœ¨å¿ƒè·³åŒ…ä¸­æºå¸¦æ§½ä½ä¿¡æ¯</li>
<li>16384ä¸ªæ§½ä½ä½¿å¿ƒè·³åŒ…æ›´å°ï¼Œç½‘ç»œå¼€é”€æ›´ä½</li>
<li>å¯¹äºå¤§è§„æ¨¡é›†ç¾¤ï¼Œç½‘ç»œæ•ˆç‡æ›´é‡è¦</li>
</ul>
<h3 id="é›†ç¾¤è§„æ¨¡è€ƒè™‘">é›†ç¾¤è§„æ¨¡è€ƒè™‘</h3>
<p><strong>å®é™…éœ€æ±‚</strong>ï¼š</p>
<ul>
<li>Rediså®˜æ–¹å»ºè®®é›†ç¾¤èŠ‚ç‚¹æ•°ä¸è¶…è¿‡1000</li>
<li>16384ä¸ªæ§½ä½å¯¹äº1000ä¸ªèŠ‚ç‚¹å®Œå…¨å¤Ÿç”¨</li>
<li>æ¯ä¸ªèŠ‚ç‚¹å¹³å‡16ä¸ªæ§½ä½ï¼Œåˆ†é…ç²’åº¦åˆç†</li>
</ul>
<h3 id="ä½è¿ç®—ä¼˜åŒ–">ä½è¿ç®—ä¼˜åŒ–</h3>
<p><strong>è®¡ç®—ä¼˜åŒ–</strong>ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4/1749384123768.png" alt="1749384123768"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ä½è¿ç®—æ›¿ä»£å–æ¨¡è¿ç®—</span></span><br><span class="line">slot = crc16(key) &amp; <span class="number">0x3FFF</span>;  <span class="comment">// ç­‰ä»·äº % 16384</span></span><br></pre></td></tr></table></figure>
<p><strong>æ€§èƒ½ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ä½è¿ç®—æ¯”å–æ¨¡è¿ç®—æ•ˆç‡æ›´é«˜</li>
<li>16384 = 2^14ï¼Œå¯ä»¥ä½¿ç”¨ä½è¿ç®—ä¼˜åŒ–</li>
<li>0x3FFF = 16383ï¼Œå³ 2^14 - 1</li>
</ul>
<h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>
<h3 id="é›†ç¾¤éƒ¨ç½²å»ºè®®">é›†ç¾¤éƒ¨ç½²å»ºè®®</h3>
<ol>
<li>
<p><strong>èŠ‚ç‚¹é…ç½®</strong>ï¼š</p>
<ul>
<li>è‡³å°‘3ä¸ªä¸»èŠ‚ç‚¹ï¼ˆä¿è¯æ•…éšœè½¬ç§»æŠ•ç¥¨ï¼‰</li>
<li>æ¯ä¸ªä¸»èŠ‚ç‚¹é…ç½®1-2ä¸ªä»èŠ‚ç‚¹</li>
<li>å»ºè®®å¥‡æ•°ä¸ªä¸»èŠ‚ç‚¹</li>
</ul>
</li>
<li>
<p><strong>ç¡¬ä»¶è§„åˆ’</strong>ï¼š</p>
<ul>
<li>ä¸»ä»èŠ‚ç‚¹éƒ¨ç½²åœ¨ä¸åŒç‰©ç†æœº</li>
<li>ä¿è¯ç½‘ç»œå»¶è¿Ÿä½ä¸”ç¨³å®š</li>
<li>åˆç†é…ç½®å†…å­˜å’ŒCPUèµ„æº</li>
</ul>
</li>
<li>
<p><strong>å‚æ•°è°ƒä¼˜</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cluster-enabled yes                    # å¯ç”¨é›†ç¾¤æ¨¡å¼</span><br><span class="line">cluster-node-timeout 15000           # èŠ‚ç‚¹è¶…æ—¶æ—¶é—´</span><br><span class="line">cluster-require-full-coverage no     # å…è®¸éƒ¨åˆ†æ§½ä½ä¸å¯ç”¨æ—¶ç»§ç»­æœåŠ¡</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="å®¢æˆ·ç«¯æœ€ä½³å®è·µ">å®¢æˆ·ç«¯æœ€ä½³å®è·µ</h3>
<ol>
<li>
<p><strong>è¿æ¥ç®¡ç†</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ”¯æŒé›†ç¾¤çš„å®¢æˆ·ç«¯åº“</li>
<li>ç»´æŠ¤å®Œæ•´çš„æ§½ä½æ˜ å°„è¡¨</li>
<li>å®ç°æ™ºèƒ½é‡è¯•æœºåˆ¶</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>æ‰¹é‡æ“ä½œä½¿ç”¨pipeline</li>
<li>é¿å…è·¨æ§½ä½çš„äº‹åŠ¡æ“ä½œ</li>
<li>åˆç†è®¾è®¡keyçš„åˆ†å¸ƒ</li>
</ul>
</li>
</ol>
<h2 id="å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 id="Q1ï¼šå¦‚ä½•é¿å…æ•°æ®å€¾æ–œï¼Ÿ">Q1ï¼šå¦‚ä½•é¿å…æ•°æ®å€¾æ–œï¼Ÿ</h3>
<p><strong>é—®é¢˜</strong>ï¼šæŸäº›èŠ‚ç‚¹æ•°æ®é‡è¿œè¶…å…¶ä»–èŠ‚ç‚¹</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>è®¾è®¡å‡åŒ€åˆ†å¸ƒçš„key</li>
<li>é¿å…ä½¿ç”¨çƒ­ç‚¹key</li>
<li>ç›‘æ§å„èŠ‚ç‚¹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
</ul>
<h3 id="Q2ï¼šé›†ç¾¤æ‰©å®¹æ—¶æ•°æ®å¦‚ä½•è¿ç§»ï¼Ÿ">Q2ï¼šé›†ç¾¤æ‰©å®¹æ—¶æ•°æ®å¦‚ä½•è¿ç§»ï¼Ÿ</h3>
<p><strong>è¿ç§»æµç¨‹</strong>ï¼š</p>
<ol>
<li>æ·»åŠ æ–°èŠ‚ç‚¹åˆ°é›†ç¾¤</li>
<li>é‡æ–°åˆ†é…æ§½ä½ç»™æ–°èŠ‚ç‚¹</li>
<li>æ‰§è¡Œæ•°æ®è¿ç§»æ“ä½œ</li>
<li>æ›´æ–°å®¢æˆ·ç«¯æ§½ä½æ˜ å°„</li>
</ol>
<h3 id="Q3ï¼šå¦‚ä½•å¤„ç†ç½‘ç»œåˆ†åŒºï¼Ÿ">Q3ï¼šå¦‚ä½•å¤„ç†ç½‘ç»œåˆ†åŒºï¼Ÿ</h3>
<p><strong>é˜²æŠ¤æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>è®¾ç½®åˆç†çš„<code>cluster-node-timeout</code></li>
<li>ä½¿ç”¨<code>cluster-require-full-coverage</code>æ§åˆ¶æœåŠ¡å¯ç”¨æ€§</li>
<li>éƒ¨ç½²æ—¶è€ƒè™‘ç½‘ç»œæ‹“æ‰‘ï¼Œé¿å…å•ç‚¹æ•…éšœ</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Redis Clusteré€šè¿‡å“ˆå¸Œæ§½æœºåˆ¶å®ç°äº†æ•°æ®çš„è‡ªåŠ¨åˆ†ç‰‡å’Œè´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡Gossipåè®®ä¿è¯äº†é›†ç¾¤ä¿¡æ¯çš„ä¸€è‡´æ€§ï¼Œé€šè¿‡å®Œå–„çš„æ•…éšœæ£€æµ‹å’Œè½¬ç§»æœºåˆ¶ç¡®ä¿äº†é«˜å¯ç”¨æ€§ã€‚ç†è§£è¿™äº›æ ¸å¿ƒæœºåˆ¶ï¼Œä¸ä»…èƒ½å¸®åŠ©ä½ åœ¨é¢è¯•ä¸­èƒ¸æœ‰æˆç«¹ï¼Œæ›´èƒ½åœ¨å®é™…é¡¹ç›®ä¸­åˆç†è®¾è®¡å’Œè¿ç»´Redisé›†ç¾¤ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://redis.io/topics/cluster-tutorial">Rediså®˜æ–¹æ–‡æ¡£ - Redis Cluster</a></li>
<li><a href="https://redisbook.readthedocs.io/en/latest/feature/cluster.html">Redisè®¾è®¡ä¸å®ç° - é›†ç¾¤</a></li>
<li><a href="https://github.com/redis/redis/blob/unstable/src/cluster.c">Redisæºç è§£æ - Clusterå®ç°</a></li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>é«˜å¯ç”¨</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>æ•…éšœè½¬ç§»</tag>
        <tag>é›†ç¾¤</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>å“ˆå¸Œæ§½</tag>
        <tag>Gossipåè®®</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis å“¨å…µæ¨¡å¼è¯¦è§£ï¼šæ•…éšœè½¬ç§»çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ</title>
    <url>/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/</url>
    <content><![CDATA[<h1>Redis å“¨å…µæ¨¡å¼è¯¦è§£ï¼šæ•…éšœè½¬ç§»çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ</h1>
<blockquote>
<p>Redis å“¨å…µï¼ˆSentinelï¼‰æ˜¯ Redis é«˜å¯ç”¨æ¶æ„çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒé€šè¿‡ç›‘æ§ã€æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œç¡®ä¿ Redis ä¸»ä»æ¶æ„çš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</p>
</blockquote>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦å“¨å…µæœºåˆ¶ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦å“¨å…µæœºåˆ¶ï¼Ÿ</h2>
<p>åœ¨ Redis çš„ä¸»ä»æ¶æ„ä¸­ï¼Œç”±äºä¸»ä»æ¨¡å¼æ˜¯è¯»å†™åˆ†ç¦»çš„ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰æŒ‚äº†ï¼Œé‚£ä¹ˆå°†æ²¡æœ‰ä¸»èŠ‚ç‚¹æ¥æœåŠ¡å®¢æˆ·ç«¯çš„å†™æ“ä½œè¯·æ±‚ï¼Œä¹Ÿæ²¡æœ‰ä¸»èŠ‚ç‚¹ç»™ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰è¿›è¡Œæ•°æ®åŒæ­¥äº†ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383596204.png" alt="å“¨å…µæ¶æ„æ¦‚è§ˆ"></p>
<h3 id="ä¼ ç»Ÿä¸»ä»æ¶æ„çš„å±€é™æ€§">ä¼ ç»Ÿä¸»ä»æ¶æ„çš„å±€é™æ€§</h3>
<ul>
<li><strong>å•ç‚¹æ•…éšœé£é™©</strong>ï¼šä¸»èŠ‚ç‚¹æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿæ— æ³•å†™å…¥</li>
<li><strong>äººå·¥å¹²é¢„æˆæœ¬</strong>ï¼šéœ€è¦æ‰‹åŠ¨é€‰æ‹©æ–°ä¸»èŠ‚ç‚¹å¹¶é‡æ–°é…ç½®</li>
<li><strong>åˆ‡æ¢æ—¶é—´é•¿</strong>ï¼šäººå·¥æ•…éšœè½¬ç§»æµç¨‹å¤æ‚ä¸”è€—æ—¶</li>
<li><strong>å®¢æˆ·ç«¯é‡è¿å¤æ‚</strong>ï¼šéœ€è¦æ‰‹åŠ¨æ›´æ–°å®¢æˆ·ç«¯é…ç½®</li>
</ul>
<p>è¿™æ—¶å¦‚æœè¦æ¢å¤æœåŠ¡çš„è¯ï¼Œéœ€è¦äººå·¥ä»‹å…¥ï¼Œé€‰æ‹©ä¸€ä¸ªã€Œä»èŠ‚ç‚¹ã€åˆ‡æ¢ä¸ºã€Œä¸»èŠ‚ç‚¹ã€ï¼Œç„¶åè®©å…¶ä»–ä»èŠ‚ç‚¹æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶è¿˜éœ€è¦é€šçŸ¥ä¸Šæ¸¸é‚£äº›è¿æ¥ Redis ä¸»èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ï¼Œå°†å…¶é…ç½®ä¸­çš„ä¸»èŠ‚ç‚¹ IP åœ°å€æ›´æ–°ä¸ºã€Œæ–°ä¸»èŠ‚ç‚¹ã€çš„ IP åœ°å€ã€‚</p>
<p>Redis åœ¨ 2.8 ç‰ˆæœ¬ä»¥åæä¾›çš„<strong>å“¨å…µï¼ˆSentinelï¼‰æœºåˆ¶</strong>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å®ç°<strong>ä¸»ä»èŠ‚ç‚¹æ•…éšœè½¬ç§»</strong>ã€‚å®ƒä¼šç›‘æµ‹ä¸»èŠ‚ç‚¹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå®ƒå°±ä¼šé€‰ä¸¾ä¸€ä¸ªä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠæ–°ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯é€šçŸ¥ç»™ä»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯ã€‚</p>
<h2 id="å“¨å…µæœºåˆ¶çš„å·¥ä½œåŸç†">å“¨å…µæœºåˆ¶çš„å·¥ä½œåŸç†</h2>
<p>å“¨å…µå…¶å®æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis è¿›ç¨‹ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä»&quot;å“¨å…µ&quot;è¿™ä¸ªåå­—ä¹Ÿå¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œå®ƒç›¸å½“äºæ˜¯&quot;è§‚å¯Ÿè€…èŠ‚ç‚¹&quot;ï¼Œè§‚å¯Ÿçš„å¯¹è±¡æ˜¯ä¸»ä»èŠ‚ç‚¹ã€‚</p>
<p>å½“ç„¶ï¼Œå®ƒä¸ä»…ä»…æ˜¯è§‚å¯Ÿé‚£ä¹ˆç®€å•ï¼Œåœ¨å®ƒè§‚å¯Ÿåˆ°æœ‰å¼‚å¸¸çš„çŠ¶å†µä¸‹ï¼Œä¼šåšå‡ºä¸€äº›&quot;åŠ¨ä½œ&quot;ï¼Œæ¥ä¿®å¤å¼‚å¸¸çŠ¶æ€ã€‚</p>
<h3 id="å“¨å…µçš„ä¸‰å¤§æ ¸å¿ƒèŒè´£">å“¨å…µçš„ä¸‰å¤§æ ¸å¿ƒèŒè´£</h3>
<p>å“¨å…µèŠ‚ç‚¹ä¸»è¦è´Ÿè´£ä¸‰ä»¶äº‹æƒ…ï¼š<strong>ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥</strong>ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383613400.png" alt="å“¨å…µèŒè´£å›¾"></p>
<ol>
<li>
<p><strong>ç›‘æ§ï¼ˆMonitoringï¼‰</strong></p>
<ul>
<li>å®šæœŸæ£€æŸ¥ä¸»ä»èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€</li>
<li>ç»´æŠ¤èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</li>
<li>æ£€æµ‹ç½‘ç»œè¿æ¥è´¨é‡</li>
</ul>
</li>
<li>
<p><strong>é€‰ä¸»ï¼ˆMaster Selectionï¼‰</strong></p>
<ul>
<li>åœ¨ä¸»èŠ‚ç‚¹æ•…éšœæ—¶é€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹</li>
<li>æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œ</li>
<li>é‡æ–°é…ç½®ä¸»ä»å…³ç³»</li>
</ul>
</li>
<li>
<p><strong>é€šçŸ¥ï¼ˆNotificationï¼‰</strong></p>
<ul>
<li>å‘å®¢æˆ·ç«¯é€šçŸ¥ä¸»èŠ‚ç‚¹å˜æ›´</li>
<li>æ›´æ–°ä»èŠ‚ç‚¹çš„å¤åˆ¶ç›®æ ‡</li>
<li>å‘å¸ƒæ•…éšœè½¬ç§»äº‹ä»¶</li>
</ul>
</li>
</ol>
<h2 id="æ•…éšœæ£€æµ‹æœºåˆ¶ï¼šå¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†ï¼Ÿ">æ•…éšœæ£€æµ‹æœºåˆ¶ï¼šå¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†ï¼Ÿ</h2>
<h3 id="ä¸»è§‚ä¸‹çº¿ï¼ˆSubjective-Downï¼‰">ä¸»è§‚ä¸‹çº¿ï¼ˆSubjective Downï¼‰</h3>
<p>å“¨å…µä¼šæ¯éš” 1 ç§’ç»™æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹å‘é€ PING å‘½ä»¤ï¼Œå½“ä¸»ä»èŠ‚ç‚¹æ”¶åˆ° PING å‘½ä»¤åï¼Œä¼šå‘é€ä¸€ä¸ªå“åº”å‘½ä»¤ç»™å“¨å…µï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å®ƒä»¬æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383622604.png" alt="æ•…éšœæ£€æµ‹æµç¨‹"></p>
<p>å¦‚æœä¸»èŠ‚ç‚¹æˆ–è€…ä»èŠ‚ç‚¹æ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šå°†å®ƒä»¬æ ‡è®°ä¸ºã€Œ<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€ã€‚è¿™ä¸ªã€Œè§„å®šçš„æ—¶é—´ã€æ˜¯é…ç½®é¡¹ <code>down-after-milliseconds</code> å‚æ•°è®¾å®šçš„ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</p>
<h3 id="å®¢è§‚ä¸‹çº¿ï¼ˆObjective-Downï¼‰">å®¢è§‚ä¸‹çº¿ï¼ˆObjective Downï¼‰</h3>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®¢è§‚ä¸‹çº¿ï¼Ÿ</strong></p>
<p>ä¹‹æ‰€ä»¥é’ˆå¯¹ã€Œä¸»èŠ‚ç‚¹ã€è®¾è®¡ã€Œä¸»è§‚ä¸‹çº¿ã€å’Œã€Œå®¢è§‚ä¸‹çº¿ã€ä¸¤ä¸ªçŠ¶æ€ï¼Œæ˜¯å› ä¸ºæœ‰å¯èƒ½ã€Œä¸»èŠ‚ç‚¹ã€å…¶å®å¹¶æ²¡æœ‰æ•…éšœï¼Œå¯èƒ½åªæ˜¯å› ä¸ºä¸»èŠ‚ç‚¹çš„ç³»ç»Ÿå‹åŠ›æ¯”è¾ƒå¤§æˆ–è€…ç½‘ç»œå‘é€äº†æ‹¥å¡ï¼Œå¯¼è‡´ä¸»èŠ‚ç‚¹æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºäº†å‡å°‘è¯¯åˆ¤çš„æƒ…å†µï¼Œå“¨å…µåœ¨éƒ¨ç½²çš„æ—¶å€™ä¸ä¼šåªéƒ¨ç½²ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œæ˜¯ç”¨å¤šä¸ªèŠ‚ç‚¹éƒ¨ç½²æˆ<strong>å“¨å…µé›†ç¾¤</strong>ï¼ˆ<em>æœ€å°‘éœ€è¦ä¸‰å°æœºå™¨æ¥éƒ¨ç½²å“¨å…µé›†ç¾¤</em>ï¼‰ï¼Œ<strong>é€šè¿‡å¤šä¸ªå“¨å…µèŠ‚ç‚¹ä¸€èµ·åˆ¤æ–­ï¼Œå°±å¯ä»¥å°±å¯ä»¥é¿å…å•ä¸ªå“¨å…µå› ä¸ºè‡ªèº«ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œè€Œè¯¯åˆ¤ä¸»èŠ‚ç‚¹ä¸‹çº¿çš„æƒ…å†µ</strong>ã€‚åŒæ—¶ï¼Œå¤šä¸ªå“¨å…µçš„ç½‘ç»œåŒæ—¶ä¸ç¨³å®šçš„æ¦‚ç‡è¾ƒå°ï¼Œç”±å®ƒä»¬ä¸€èµ·åšå†³ç­–ï¼Œè¯¯åˆ¤ç‡ä¹Ÿèƒ½é™ä½ã€‚</p>
<p><strong>å®¢è§‚ä¸‹çº¿çš„åˆ¤å®šæµç¨‹ï¼š</strong></p>
<p>å½“ä¸€ä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œä¸»è§‚ä¸‹çº¿ã€åï¼Œå°±ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·å‘½ä»¤ï¼Œå…¶ä»–å“¨å…µæ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæ ¹æ®è‡ªèº«å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œçŠ¶å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383632190.png" alt="å®¢è§‚ä¸‹çº¿æŠ•ç¥¨"></p>
<p>å½“è¿™ä¸ªå“¨å…µçš„èµåŒç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ <strong>quorum</strong> é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šè¢«è¯¥å“¨å…µæ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚</p>
<blockquote>
<p><strong>é…ç½®ç¤ºä¾‹</strong>ï¼šç°åœ¨æœ‰ 3 ä¸ªå“¨å…µï¼Œquorum é…ç½®çš„æ˜¯ 2ï¼Œé‚£ä¹ˆä¸€ä¸ªå“¨å…µéœ€è¦ 2 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥æ ‡è®°ä¸»èŠ‚ç‚¹ä¸º&quot;å®¢è§‚ä¸‹çº¿&quot;äº†ã€‚è¿™ 2 å¼ èµæˆç¥¨åŒ…æ‹¬å“¨å…µè‡ªå·±çš„ä¸€å¼ èµæˆç¥¨å’Œå¦å¤–ä¸¤ä¸ªå“¨å…µçš„èµæˆç¥¨ã€‚</p>
</blockquote>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šquorum çš„å€¼ä¸€èˆ¬è®¾ç½®ä¸ºå“¨å…µä¸ªæ•°çš„äºŒåˆ†ä¹‹ä¸€åŠ  1ï¼Œä¾‹å¦‚ 3 ä¸ªå“¨å…µå°±è®¾ç½® 2ã€‚</p>
<h2 id="å“¨å…µ-Leader-é€‰ä¸¾æœºåˆ¶">å“¨å…µ Leader é€‰ä¸¾æœºåˆ¶</h2>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦-Leader-é€‰ä¸¾ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ Leader é€‰ä¸¾ï¼Ÿ</h3>
<p>å‰é¢è¯´è¿‡ï¼Œä¸ºäº†æ›´åŠ &quot;å®¢è§‚&quot;çš„åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœäº†ï¼Œä¸€èˆ¬ä¸ä¼šåªç”±å•ä¸ªå“¨å…µçš„æ£€æµ‹ç»“æœæ¥åˆ¤æ–­ï¼Œè€Œæ˜¯å¤šä¸ªå“¨å…µä¸€èµ·åˆ¤æ–­ï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¯¯åˆ¤æ¦‚ç‡ï¼Œæ‰€ä»¥<strong>å“¨å…µæ˜¯ä»¥å“¨å…µé›†ç¾¤çš„æ–¹å¼å­˜åœ¨çš„</strong>ã€‚</p>
<p>é—®é¢˜æ¥äº†ï¼Œç”±å“¨å…µé›†ç¾¤ä¸­çš„å“ªä¸ªèŠ‚ç‚¹è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»å‘¢ï¼Ÿ</p>
<p>æ‰€ä»¥è¿™æ—¶å€™ï¼Œè¿˜éœ€è¦åœ¨å“¨å…µé›†ç¾¤ä¸­é€‰å‡ºä¸€ä¸ª leaderï¼Œè®© leader æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ã€‚</p>
<h3 id="Leader-é€‰ä¸¾æµç¨‹">Leader é€‰ä¸¾æµç¨‹</h3>
<p><strong>1. å€™é€‰è€…ç¡®å®š</strong><br>
å“ªä¸ªå“¨å…µèŠ‚ç‚¹åˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ï¼Œè¿™ä¸ªå“¨å…µèŠ‚ç‚¹å°±æ˜¯å€™é€‰è€…ï¼Œæ‰€è°“çš„å€™é€‰è€…å°±æ˜¯æƒ³å½“ Leader çš„å“¨å…µã€‚</p>
<p><strong>2. æŠ•ç¥¨è¿‡ç¨‹</strong><br>
ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸‰ä¸ªå“¨å…µã€‚å½“å“¨å…µ B å…ˆåˆ¤æ–­åˆ°ä¸»èŠ‚ç‚¹ã€Œä¸»è§‚ä¸‹çº¿åã€ï¼Œå°±ä¼šç»™å…¶ä»–å®ä¾‹å‘é€ <code>is-master-down-by-addr</code> å‘½ä»¤ã€‚æ¥ç€ï¼Œå…¶ä»–å“¨å…µä¼šæ ¹æ®è‡ªå·±å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œè¿æ¥æƒ…å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383645583.png" alt="Leaderé€‰ä¸¾æµç¨‹"></p>
<p>å½“å“¨å…µ B æ”¶åˆ°èµæˆç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œå°±ä¼šå°†ä¸»èŠ‚ç‚¹æ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ï¼Œæ­¤æ—¶çš„å“¨å…µ B å°±æ˜¯ä¸€ä¸ª Leader å€™é€‰è€…ã€‚</p>
<p><strong>3. é€‰ä¸¾æ¡ä»¶</strong><br>
å€™é€‰è€…ä¼šå‘å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›æˆä¸º Leader æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå¹¶è®©æ‰€æœ‰å…¶ä»–å“¨å…µå¯¹å®ƒè¿›è¡ŒæŠ•ç¥¨ã€‚</p>
<p>ä»»ä½•ä¸€ä¸ªã€Œå€™é€‰è€…ã€è¦æˆä¸º Leaderï¼Œå¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€</strong>ï¼šæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨</li>
<li><strong>ç¬¬äºŒ</strong>ï¼šæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼</li>
</ul>
<p><strong>4. æŠ•ç¥¨è§„åˆ™</strong></p>
<ul>
<li>æ¯ä¸ªå“¨å…µåªæœ‰ä¸€æ¬¡æŠ•ç¥¨æœºä¼š</li>
<li>å¯ä»¥æŠ•ç»™è‡ªå·±æˆ–æŠ•ç»™åˆ«äºº</li>
<li>åªæœ‰å€™é€‰è€…æ‰èƒ½æŠŠç¥¨æŠ•ç»™è‡ªå·±</li>
<li>å…ˆåˆ°å…ˆå¾—çš„æŠ•ç¥¨åŸåˆ™</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆå“¨å…µèŠ‚ç‚¹è‡³å°‘è¦æœ‰-3-ä¸ªï¼Ÿ">ä¸ºä»€ä¹ˆå“¨å…µèŠ‚ç‚¹è‡³å°‘è¦æœ‰ 3 ä¸ªï¼Ÿ</h3>
<p><strong>åŒèŠ‚ç‚¹çš„é—®é¢˜</strong>ï¼š<br>
å¦‚æœå“¨å…µé›†ç¾¤ä¸­åªæœ‰ 2 ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œæ­¤æ—¶å¦‚æœä¸€ä¸ªå“¨å…µæƒ³è¦æˆåŠŸæˆä¸º Leaderï¼Œå¿…é¡»è·å¾— 2 ç¥¨ï¼Œè€Œä¸æ˜¯ 1 ç¥¨ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœå“¨å…µé›†ç¾¤ä¸­æœ‰ä¸ªå“¨å…µæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆå°±åªå‰©ä¸€ä¸ªå“¨å…µäº†ï¼Œå¦‚æœè¿™ä¸ªå“¨å…µæƒ³è¦æˆä¸º Leaderï¼Œè¿™æ—¶ç¥¨æ•°å°±æ²¡åŠæ³•è¾¾åˆ° 2 ç¥¨ï¼Œå°±æ— æ³•æˆåŠŸæˆä¸º Leaderï¼Œè¿™æ—¶æ˜¯æ— æ³•è¿›è¡Œä¸»ä»èŠ‚ç‚¹åˆ‡æ¢çš„ã€‚</p>
<p><strong>ä¸‰èŠ‚ç‚¹çš„ä¼˜åŠ¿</strong>ï¼š<br>
å› æ­¤ï¼Œé€šå¸¸æˆ‘ä»¬è‡³å°‘ä¼šé…ç½® 3 ä¸ªå“¨å…µèŠ‚ç‚¹ã€‚è¿™æ—¶ï¼Œå¦‚æœå“¨å…µé›†ç¾¤ä¸­æœ‰ä¸ªå“¨å…µæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆè¿˜å‰©ä¸‹ä¸¤ä¸ªå“¨å…µï¼Œå¦‚æœè¿™ä¸ªå“¨å…µæƒ³è¦æˆä¸º Leaderï¼Œè¿™æ—¶è¿˜æ˜¯æœ‰æœºä¼šè¾¾åˆ° 2 ç¥¨çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯å¯ä»¥é€‰ä¸¾æˆåŠŸçš„ï¼Œä¸ä¼šå¯¼è‡´æ— æ³•è¿›è¡Œä¸»ä»èŠ‚ç‚¹åˆ‡æ¢ã€‚</p>
<h3 id="å®é™…åœºæ™¯åˆ†æ">å®é™…åœºæ™¯åˆ†æ</h3>
<p><strong>æ¡ˆä¾‹åˆ†æ</strong>ï¼šRedis 1 ä¸» 4 ä»ï¼Œ5 ä¸ªå“¨å…µï¼Œquorum è®¾ç½®ä¸º 3ï¼Œå¦‚æœ 2 ä¸ªå“¨å…µæ•…éšœï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå“¨å…µèƒ½å¦åˆ¤æ–­ä¸»èŠ‚ç‚¹&quot;å®¢è§‚ä¸‹çº¿&quot;ï¼Ÿä¸»ä»èƒ½å¦è‡ªåŠ¨åˆ‡æ¢ï¼Ÿ</p>
<p><strong>åˆ†æç»“æœ</strong>ï¼š</p>
<ul>
<li>
<p><strong>å“¨å…µé›†ç¾¤å¯ä»¥åˆ¤å®šä¸»èŠ‚ç‚¹&quot;å®¢è§‚ä¸‹çº¿&quot;</strong>ã€‚å“¨å…µé›†ç¾¤è¿˜å‰©ä¸‹ 3 ä¸ªå“¨å…µï¼Œå½“ä¸€ä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹&quot;ä¸»è§‚ä¸‹çº¿&quot;åï¼Œè¯¢é—®å¦å¤– 2 ä¸ªå“¨å…µåï¼Œæœ‰å¯èƒ½èƒ½æ‹¿åˆ° 3 å¼ èµåŒç¥¨ï¼Œè¿™æ—¶å°±è¾¾åˆ°äº† quorum çš„å€¼ï¼Œå› æ­¤ï¼Œå“¨å…µé›†ç¾¤å¯ä»¥åˆ¤å®šä¸»èŠ‚ç‚¹ä¸º&quot;å®¢è§‚ä¸‹çº¿&quot;ã€‚</p>
</li>
<li>
<p><strong>å“¨å…µé›†ç¾¤å¯ä»¥å®Œæˆä¸»ä»åˆ‡æ¢</strong>ã€‚å½“æœ‰ä¸ªå“¨å…µæ ‡è®°ä¸»èŠ‚ç‚¹ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€åï¼Œå°±ä¼šè¿›è¡Œé€‰ä¸¾ Leader çš„è¿‡ç¨‹ï¼Œå› ä¸ºæ­¤æ—¶å“¨å…µé›†ç¾¤è¿˜å‰©ä¸‹ 3 ä¸ªå“¨å…µï¼Œé‚£ä¹ˆè¿˜æ˜¯å¯ä»¥æ‹¿åˆ°åŠæ•°ä»¥ä¸Šï¼ˆ5/2+1=3ï¼‰çš„ç¥¨ï¼Œè€Œä¸”ä¹Ÿè¾¾åˆ°äº† quorum å€¼ï¼Œæ»¡è¶³äº†é€‰ä¸¾ Leader çš„ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰€ä»¥å°±èƒ½é€‰ä¸¾æˆåŠŸï¼Œå› æ­¤å“¨å…µé›†ç¾¤å¯ä»¥å®Œæˆä¸»ä»åˆ‡æ¢ã€‚</p>
</li>
</ul>
<p><strong>æœ€ä½³å®è·µå»ºè®®</strong>ï¼š</p>
<ul>
<li><strong>quorum çš„å€¼å»ºè®®è®¾ç½®ä¸ºå“¨å…µä¸ªæ•°çš„äºŒåˆ†ä¹‹ä¸€åŠ  1</strong>ï¼Œä¾‹å¦‚ 3 ä¸ªå“¨å…µå°±è®¾ç½® 2ï¼Œ5 ä¸ªå“¨å…µè®¾ç½®ä¸º 3</li>
<li><strong>å“¨å…µèŠ‚ç‚¹çš„æ•°é‡åº”è¯¥æ˜¯å¥‡æ•°</strong>ï¼Œé¿å…è„‘è£‚é—®é¢˜</li>
</ul>
<h2 id="ä¸»ä»æ•…éšœè½¬ç§»è¯¦ç»†æµç¨‹">ä¸»ä»æ•…éšœè½¬ç§»è¯¦ç»†æµç¨‹</h2>
<p>åœ¨å“¨å…µé›†ç¾¤ä¸­é€šè¿‡æŠ•ç¥¨çš„æ–¹å¼ï¼Œé€‰ä¸¾å‡ºäº†å“¨å…µ leader åï¼Œå°±å¯ä»¥è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹äº†ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383657283.png" alt="æ•…éšœè½¬ç§»æµç¨‹"></p>
<p>ä¸»ä»æ•…éšœè½¬ç§»æ“ä½œåŒ…å«ä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p>
<h3 id="æ­¥éª¤ä¸€ï¼šé€‰å‡ºæ–°ä¸»èŠ‚ç‚¹">æ­¥éª¤ä¸€ï¼šé€‰å‡ºæ–°ä¸»èŠ‚ç‚¹</h3>
<p>æ•…éšœè½¬ç§»æ“ä½œç¬¬ä¸€æ­¥è¦åšçš„å°±æ˜¯åœ¨å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€ä¸­ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªçŠ¶æ€è‰¯å¥½ã€æ•°æ®å®Œæ•´çš„ä»èŠ‚ç‚¹ï¼Œç„¶åå‘è¿™ä¸ªã€Œä»èŠ‚ç‚¹ã€å‘é€ <code>SLAVEOF no one</code> å‘½ä»¤ï¼Œå°†è¿™ä¸ªã€Œä»èŠ‚ç‚¹ã€è½¬æ¢ä¸ºã€Œä¸»èŠ‚ç‚¹ã€ã€‚</p>
<h4 id="ä»èŠ‚ç‚¹ç­›é€‰ç­–ç•¥">ä»èŠ‚ç‚¹ç­›é€‰ç­–ç•¥</h4>
<p><strong>1. åˆæ­¥ç­›é€‰</strong></p>
<ul>
<li>è¿‡æ»¤æ‰å·²ç»ä¸‹çº¿çš„ä»èŠ‚ç‚¹</li>
<li>è¿‡æ»¤æ‰ç½‘ç»œçŠ¶æ€ä¸ä½³çš„ä»èŠ‚ç‚¹</li>
</ul>
<p><strong>ç½‘ç»œçŠ¶æ€åˆ¤æ–­æ ‡å‡†</strong>ï¼šRedis æœ‰ä¸ªå« <code>down-after-milliseconds * 10</code> é…ç½®é¡¹ï¼Œå¦‚æœå‘ç”Ÿæ–­è¿çš„æ¬¡æ•°è¶…è¿‡äº† 10 æ¬¡ï¼Œå°±è¯´æ˜è¿™ä¸ªä»èŠ‚ç‚¹çš„ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œä¸é€‚åˆä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</p>
<p><strong>2. ä¸‰è½®è€ƒå¯Ÿé€‰æ‹©</strong></p>
<p><strong>ç¬¬ä¸€è½®ï¼šä¼˜å…ˆçº§è€ƒå¯Ÿ</strong></p>
<ul>
<li>Redis æœ‰ä¸ªå« <code>slave-priority</code> é…ç½®é¡¹ï¼Œå¯ä»¥ç»™ä»èŠ‚ç‚¹è®¾ç½®ä¼˜å…ˆçº§</li>
<li>ä¼˜å…ˆçº§è¶Šå°æ’åè¶Šé å‰</li>
<li>æ ¹æ®æœåŠ¡å™¨æ€§èƒ½é…ç½®æ¥è®¾ç½®ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§</li>
</ul>
<p><strong>ç¬¬äºŒè½®ï¼šå¤åˆ¶è¿›åº¦è€ƒå¯Ÿ</strong><br>
å¦‚æœä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™æ¯”è¾ƒå¤åˆ¶è¿›åº¦ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383672550.png" alt="å¤åˆ¶è¿›åº¦ç¤ºæ„å›¾"></p>
<ul>
<li>ä¸»èŠ‚ç‚¹ç”¨ <code>master_repl_offset</code> è®°å½•æœ€æ–°å†™æ“ä½œä½ç½®</li>
<li>ä»èŠ‚ç‚¹ç”¨ <code>slave_repl_offset</code> è®°å½•å½“å‰å¤åˆ¶è¿›åº¦</li>
<li><code>slave_repl_offset</code> æœ€æ¥è¿‘ <code>master_repl_offset</code> çš„ä»èŠ‚ç‚¹ä¼˜å…ˆ</li>
</ul>
<p><strong>ç¬¬ä¸‰è½®ï¼šID å·è€ƒå¯Ÿ</strong></p>
<ul>
<li>å¦‚æœä¼˜å…ˆçº§å’Œå¤åˆ¶è¿›åº¦éƒ½ç›¸åŒï¼Œæ¯”è¾ƒä»èŠ‚ç‚¹ ID å·</li>
<li>ID å·å°çš„ä»èŠ‚ç‚¹èƒœå‡º</li>
</ul>
<h4 id="é€‰ä¸»æµç¨‹æ€»ç»“">é€‰ä¸»æµç¨‹æ€»ç»“</h4>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383680804.png" alt="é€‰ä¸»æµç¨‹å›¾"></p>
<p>åœ¨é€‰ä¸¾å‡ºä»èŠ‚ç‚¹åï¼Œå“¨å…µ leader å‘è¢«é€‰ä¸­çš„ä»èŠ‚ç‚¹å‘é€ <code>SLAVEOF no one</code> å‘½ä»¤ï¼Œè®©è¿™ä¸ªä»èŠ‚ç‚¹è§£é™¤ä»èŠ‚ç‚¹çš„èº«ä»½ï¼Œå°†å…¶å˜ä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383688317.png" alt="æ–°ä¸»èŠ‚ç‚¹å‡çº§"></p>
<p>åœ¨å‘é€ <code>SLAVEOF no one</code> å‘½ä»¤ä¹‹åï¼Œå“¨å…µ leader ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘è¢«å‡çº§çš„ä»èŠ‚ç‚¹å‘é€ <code>INFO</code> å‘½ä»¤ï¼Œå¹¶è§‚å¯Ÿå‘½ä»¤å›å¤ä¸­çš„è§’è‰²ä¿¡æ¯ï¼Œå½“è¢«å‡çº§èŠ‚ç‚¹çš„è§’è‰²ä¿¡æ¯ä»åŸæ¥çš„ slave å˜ä¸º master æ—¶ï¼Œå“¨å…µ leader å°±çŸ¥é“è¢«é€‰ä¸­çš„ä»èŠ‚ç‚¹å·²ç»é¡ºåˆ©å‡çº§ä¸ºä¸»èŠ‚ç‚¹äº†ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383701839.png" alt="ä¸»èŠ‚ç‚¹å‡çº§å®Œæˆ"></p>
<h3 id="æ­¥éª¤äºŒï¼šå°†ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹">æ­¥éª¤äºŒï¼šå°†ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹</h3>
<p>å½“æ–°ä¸»èŠ‚ç‚¹å‡ºç°ä¹‹åï¼Œå“¨å…µ leader ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯ï¼Œè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€æŒ‡å‘ã€Œæ–°ä¸»èŠ‚ç‚¹ã€ï¼Œè¿™ä¸€åŠ¨ä½œå¯ä»¥é€šè¿‡å‘ã€Œä»èŠ‚ç‚¹ã€å‘é€ <code>SLAVEOF</code> å‘½ä»¤æ¥å®ç°ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383711332.png" alt="ä»èŠ‚ç‚¹é‡æ–°æŒ‡å‘"></p>
<p>æ‰€æœ‰ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹åçš„æ‹“æ‰‘å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383718230.png" alt="æ–°æ‹“æ‰‘ç»“æ„"></p>
<h3 id="æ­¥éª¤ä¸‰ï¼šé€šçŸ¥å®¢æˆ·ç«¯ä¸»èŠ‚ç‚¹å·²æ›´æ¢">æ­¥éª¤ä¸‰ï¼šé€šçŸ¥å®¢æˆ·ç«¯ä¸»èŠ‚ç‚¹å·²æ›´æ¢</h3>
<p>ç»è¿‡å‰é¢ä¸€ç³»åˆ—çš„æ“ä½œåï¼Œå“¨å…µé›†ç¾¤ç»ˆäºå®Œæˆä¸»ä»åˆ‡æ¢çš„å·¥ä½œï¼Œé‚£ä¹ˆæ–°ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯è¦å¦‚ä½•é€šçŸ¥ç»™å®¢æˆ·ç«¯å‘¢ï¼Ÿ</p>
<p>è¿™ä¸»è¦<strong>é€šè¿‡ Redis çš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶æ¥å®ç°</strong>çš„ã€‚æ¯ä¸ªå“¨å…µèŠ‚ç‚¹æä¾›å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä»å“¨å…µè®¢é˜…æ¶ˆæ¯ã€‚</p>
<h4 id="å“¨å…µæä¾›çš„äº‹ä»¶é¢‘é“">å“¨å…µæä¾›çš„äº‹ä»¶é¢‘é“</h4>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383729144.png" alt="äº‹ä»¶é¢‘é“åˆ—è¡¨"></p>
<p>å“¨å…µæä¾›çš„æ¶ˆæ¯è®¢é˜…é¢‘é“æœ‰å¾ˆå¤šï¼Œä¸åŒé¢‘é“åŒ…å«äº†ä¸»ä»èŠ‚ç‚¹åˆ‡æ¢è¿‡ç¨‹ä¸­çš„ä¸åŒå…³é”®äº‹ä»¶ï¼š</p>
<ul>
<li><code>+switch-master</code>ï¼šä¸»èŠ‚ç‚¹åˆ‡æ¢å®Œæˆ</li>
<li><code>+slave</code>ï¼šæ–°ä»èŠ‚ç‚¹è¿æ¥</li>
<li><code>+failover-start</code>ï¼šæ•…éšœè½¬ç§»å¼€å§‹</li>
<li><code>+failover-end</code>ï¼šæ•…éšœè½¬ç§»ç»“æŸ</li>
</ul>
<p><strong>å®¢æˆ·ç«¯é€šçŸ¥æµç¨‹</strong>ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å’Œå“¨å…µå»ºç«‹è¿æ¥</li>
<li>å®¢æˆ·ç«¯è®¢é˜…å“¨å…µæä¾›çš„é¢‘é“</li>
<li>ä¸»ä»åˆ‡æ¢å®Œæˆåï¼Œå“¨å…µå‘ <code>+switch-master</code> é¢‘é“å‘å¸ƒæ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œç«¯å£</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯ï¼Œæ›´æ–°è¿æ¥é…ç½®</li>
</ol>
<p>é€šè¿‡å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ï¼Œå®¢æˆ·ç«¯ä¸ä»…å¯ä»¥åœ¨ä¸»ä»åˆ‡æ¢åå¾—åˆ°æ–°ä¸»èŠ‚ç‚¹çš„è¿æ¥ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ç›‘æ§åˆ°ä¸»ä»èŠ‚ç‚¹åˆ‡æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿçš„å„ä¸ªé‡è¦äº‹ä»¶ï¼Œæœ‰åŠ©äºäº†è§£åˆ‡æ¢è¿›åº¦ã€‚</p>
<h3 id="æ­¥éª¤å››ï¼šå°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹">æ­¥éª¤å››ï¼šå°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹</h3>
<p>æ•…éšœè½¬ç§»æ“ä½œæœ€åè¦åšçš„æ˜¯ï¼Œç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“æ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå“¨å…µé›†ç¾¤å°±ä¼šå‘å®ƒå‘é€ <code>SLAVEOF</code> å‘½ä»¤ï¼Œè®©å®ƒæˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼š</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383740898.png" alt="æ—§ä¸»èŠ‚ç‚¹å˜ä»èŠ‚ç‚¹"></p>
<p>è‡³æ­¤ï¼Œæ•´ä¸ªä¸»ä»èŠ‚ç‚¹çš„æ•…éšœè½¬ç§»çš„å·¥ä½œç»“æŸã€‚</p>
<h2 id="å“¨å…µé›†ç¾¤çš„ç»„å»ºæœºåˆ¶">å“¨å…µé›†ç¾¤çš„ç»„å»ºæœºåˆ¶</h2>
<h3 id="å“¨å…µè‡ªåŠ¨å‘ç°æœºåˆ¶">å“¨å…µè‡ªåŠ¨å‘ç°æœºåˆ¶</h3>
<p>åœ¨æˆ‘ç¬¬ä¸€æ¬¡æ­å»ºå“¨å…µé›†ç¾¤çš„æ—¶å€™ï¼Œå½“æ—¶è§‰å¾—å¾ˆè¯§å¼‚ã€‚å› ä¸ºåœ¨é…ç½®å“¨å…µçš„ä¿¡æ¯æ—¶ï¼Œç«Ÿç„¶åªéœ€è¦å¡«ä¸‹é¢è¿™å‡ ä¸ªå‚æ•°ï¼Œè®¾ç½®ä¸»èŠ‚ç‚¹åå­—ã€ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œç«¯å£å·ä»¥åŠ quorum å€¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt; </span><br></pre></td></tr></table></figure>
<p>ä¸éœ€è¦å¡«å…¶ä»–å“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå®ƒä»¬æ˜¯å¦‚ä½•æ„ŸçŸ¥å¯¹æ–¹çš„ï¼Œåˆæ˜¯å¦‚ä½•ç»„æˆå“¨å…µé›†ç¾¤çš„ï¼Ÿ</p>
<h3 id="åŸºäºå‘å¸ƒ-è®¢é˜…çš„å‘ç°æœºåˆ¶">åŸºäºå‘å¸ƒ/è®¢é˜…çš„å‘ç°æœºåˆ¶</h3>
<p><strong>å“¨å…µèŠ‚ç‚¹ä¹‹é—´æ˜¯é€šè¿‡ Redis çš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶æ¥ç›¸äº’å‘ç°çš„</strong>ã€‚</p>
<p>åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¸Šæœ‰ä¸€ä¸ªåä¸º <code>__sentinel__:hello</code> çš„é¢‘é“ï¼Œä¸åŒå“¨å…µå°±æ˜¯é€šè¿‡å®ƒæ¥ç›¸äº’å‘ç°ï¼Œå®ç°äº’ç›¸é€šä¿¡çš„ã€‚</p>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383750958.png" alt="å“¨å…µç›¸äº’å‘ç°"></p>
<p><strong>å‘ç°æµç¨‹</strong>ï¼š</p>
<ol>
<li>å“¨å…µ A æŠŠè‡ªå·±çš„ IP åœ°å€å’Œç«¯å£ä¿¡æ¯å‘å¸ƒåˆ° <code>__sentinel__:hello</code> é¢‘é“</li>
<li>å“¨å…µ B å’Œ C è®¢é˜…äº†è¯¥é¢‘é“</li>
<li>å“¨å…µ B å’Œ C ä»é¢‘é“è·å–å“¨å…µ A çš„è¿æ¥ä¿¡æ¯</li>
<li>å“¨å…µ Bã€C ä¸å“¨å…µ A å»ºç«‹ç½‘ç»œè¿æ¥</li>
<li>é€šè¿‡åŒæ ·æ–¹å¼ï¼Œæ‰€æœ‰å“¨å…µäº’ç›¸å‘ç°å¹¶å»ºç«‹è¿æ¥</li>
</ol>
<h3 id="ä»èŠ‚ç‚¹ä¿¡æ¯è·å–">ä»èŠ‚ç‚¹ä¿¡æ¯è·å–</h3>
<p>å“¨å…µé›†ç¾¤ä¼šå¯¹ã€Œä»èŠ‚ç‚¹ã€çš„è¿è¡ŒçŠ¶æ€è¿›è¡Œç›‘æ§ï¼Œé‚£å“¨å…µé›†ç¾¤å¦‚ä½•çŸ¥é“ã€Œä»èŠ‚ç‚¹ã€çš„ä¿¡æ¯ï¼Ÿ</p>
<p><strong>ä¿¡æ¯è·å–æµç¨‹</strong>ï¼š</p>
<ol>
<li>ä¸»èŠ‚ç‚¹çŸ¥é“æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€çš„ä¿¡æ¯</li>
<li>å“¨å…µæ¯ 10 ç§’å‘ä¸»èŠ‚ç‚¹å‘é€ <code>INFO</code> å‘½ä»¤</li>
<li>ä¸»èŠ‚ç‚¹è¿”å›ä»èŠ‚ç‚¹åˆ—è¡¨ä¿¡æ¯</li>
<li>å“¨å…µæ ¹æ®ä»èŠ‚ç‚¹è¿æ¥ä¿¡æ¯å»ºç«‹è¿æ¥</li>
<li>åœ¨è¿æ¥ä¸ŠæŒç»­ç›‘æ§ä»èŠ‚ç‚¹çŠ¶æ€</li>
</ol>
<p><img src="/2025/06/08/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/1749383759411.png" alt="ä»èŠ‚ç‚¹ä¿¡æ¯è·å–"></p>
<p>æ­£æ˜¯é€šè¿‡ Redis çš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ï¼Œå“¨å…µä¹‹é—´å¯ä»¥ç›¸äº’æ„ŸçŸ¥ï¼Œç„¶åç»„æˆé›†ç¾¤ï¼ŒåŒæ—¶ï¼Œå“¨å…µåˆé€šè¿‡ <code>INFO</code> å‘½ä»¤ï¼Œåœ¨ä¸»èŠ‚ç‚¹é‡Œè·å¾—äº†æ‰€æœ‰ä»èŠ‚ç‚¹è¿æ¥ä¿¡æ¯ï¼Œäºæ˜¯å°±èƒ½å’Œä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œç›‘æ§äº†ã€‚</p>
<h2 id="å“¨å…µæ¨¡å¼çš„æ ¸å¿ƒç‰¹æ€§æ€»ç»“">å“¨å…µæ¨¡å¼çš„æ ¸å¿ƒç‰¹æ€§æ€»ç»“</h2>
<h3 id="æ ¸å¿ƒåŠŸèƒ½">æ ¸å¿ƒåŠŸèƒ½</h3>
<p><strong>1. æ•…éšœæ£€æµ‹</strong></p>
<ul>
<li>ä¸»è§‚ä¸‹çº¿ï¼šå•ä¸ªå“¨å…µçš„åˆ¤æ–­</li>
<li>å®¢è§‚ä¸‹çº¿ï¼šå¤šä¸ªå“¨å…µçš„å…±åŒåˆ¤æ–­</li>
<li>å‡å°‘è¯¯åˆ¤ï¼Œæé«˜å¯é æ€§</li>
</ul>
<p><strong>2. è‡ªåŠ¨æ•…éšœè½¬ç§»</strong></p>
<ul>
<li>Leader é€‰ä¸¾ï¼šç¡®ä¿å•ç‚¹æ‰§è¡Œæ•…éšœè½¬ç§»</li>
<li>æ™ºèƒ½é€‰ä¸»ï¼šåŸºäºä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID çš„é€‰æ‹©ç­–ç•¥</li>
<li>å®Œæ•´çš„åˆ‡æ¢æµç¨‹ï¼šä»é€‰ä¸»åˆ°é€šçŸ¥å®¢æˆ·ç«¯</li>
</ul>
<p><strong>3. é«˜å¯ç”¨ä¿éšœ</strong></p>
<ul>
<li>é›†ç¾¤åŒ–éƒ¨ç½²ï¼šé¿å…å•ç‚¹æ•…éšœ</li>
<li>è‡ªåŠ¨åŒ–è¿ç»´ï¼šå‡å°‘äººå·¥å¹²é¢„</li>
<li>å®æ—¶ç›‘æ§ï¼šæŒç»­å¥åº·æ£€æŸ¥</li>
</ul>
<h3 id="éƒ¨ç½²å»ºè®®">éƒ¨ç½²å»ºè®®</h3>
<p><strong>1. èŠ‚ç‚¹æ•°é‡</strong></p>
<ul>
<li>æœ€å°‘ 3 ä¸ªå“¨å…µèŠ‚ç‚¹</li>
<li>æ¨èå¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼ˆ3ã€5ã€7ï¼‰</li>
<li>é¿å…ç½‘ç»œåˆ†åŒºå¯¼è‡´çš„è„‘è£‚</li>
</ul>
<p><strong>2. é…ç½®å‚æ•°</strong></p>
<ul>
<li><code>quorum</code> è®¾ç½®ä¸ºèŠ‚ç‚¹æ•° / 2 + 1</li>
<li><code>down-after-milliseconds</code> æ ¹æ®ç½‘ç»œå»¶è¿Ÿè°ƒæ•´</li>
<li><code>failover-timeout</code> è®¾ç½®åˆç†çš„æ•…éšœè½¬ç§»è¶…æ—¶</li>
</ul>
<p><strong>3. ç½‘ç»œéƒ¨ç½²</strong></p>
<ul>
<li>å“¨å…µèŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨/æœºæˆ¿</li>
<li>ä¿è¯ç½‘ç»œè¿é€šæ€§å’Œç¨³å®šæ€§</li>
<li>è€ƒè™‘å®¢æˆ·ç«¯åˆ°å“¨å…µçš„ç½‘ç»œè´¨é‡</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Redis åœ¨ 2.8 ç‰ˆæœ¬ä»¥åæä¾›çš„<strong>å“¨å…µï¼ˆSentinelï¼‰æœºåˆ¶</strong>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å®ç°<strong>ä¸»ä»èŠ‚ç‚¹æ•…éšœè½¬ç§»</strong>ã€‚å®ƒä¼šç›‘æµ‹ä¸»èŠ‚ç‚¹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå®ƒå°±ä¼šé€‰ä¸¾ä¸€ä¸ªä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠæ–°ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯é€šçŸ¥ç»™ä»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯ã€‚</p>
<p>å“¨å…µä¸€èˆ¬æ˜¯ä»¥é›†ç¾¤çš„æ–¹å¼éƒ¨ç½²ï¼Œè‡³å°‘éœ€è¦ 3 ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œå“¨å…µé›†ç¾¤ä¸»è¦è´Ÿè´£ä¸‰ä»¶äº‹æƒ…ï¼š<strong>ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥</strong>ã€‚</p>
<h3 id="å·¥ä½œæµç¨‹æ€»ç»“">å·¥ä½œæµç¨‹æ€»ç»“</h3>
<p><strong>1. ç¬¬ä¸€è½®æŠ•ç¥¨ï¼šåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿</strong><br>
å½“å“¨å…µé›†ç¾¤ä¸­çš„æŸä¸ªå“¨å…µåˆ¤å®šä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼ˆä¸»è§‚ä¸‹çº¿ï¼‰åï¼Œå°±ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·å‘½ä»¤ï¼Œå…¶ä»–å“¨å…µæ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæ ¹æ®è‡ªèº«å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œçŠ¶å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚</p>
<p>å½“è¿™ä¸ªå“¨å…µçš„èµåŒç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šè¢«è¯¥å“¨å…µæ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚</p>
<p><strong>2. ç¬¬äºŒè½®æŠ•ç¥¨ï¼šé€‰å‡ºå“¨å…µ leader</strong><br>
æŸä¸ªå“¨å…µåˆ¤å®šä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿åï¼Œè¯¥å“¨å…µå°±ä¼šå‘èµ·æŠ•ç¥¨ï¼Œå‘Šè¯‰å…¶ä»–å“¨å…µï¼Œå®ƒæƒ³æˆä¸º leaderï¼Œæƒ³æˆä¸º leader çš„å“¨å…µèŠ‚ç‚¹ï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨</li>
<li>ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼</li>
</ul>
<p><strong>3. ç”±å“¨å…µ leader è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»</strong><br>
é€‰ä¸¾å‡ºäº†å“¨å…µ leader åï¼Œå°±å¯ä»¥è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹äº†ã€‚è¯¥æ“ä½œåŒ…å«ä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼šåœ¨å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹ï¼ˆæ—§ä¸»èŠ‚ç‚¹ï¼‰å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€é‡Œé¢ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œé€‰æ‹©çš„è§„åˆ™ï¼š</p>
<ul>
<li>è¿‡æ»¤æ‰å·²ç»ç¦»çº¿çš„ä»èŠ‚ç‚¹</li>
<li>è¿‡æ»¤æ‰å†å²ç½‘ç»œè¿æ¥çŠ¶æ€ä¸å¥½çš„ä»èŠ‚ç‚¹</li>
<li>å°†å‰©ä¸‹çš„ä»èŠ‚ç‚¹ï¼Œè¿›è¡Œä¸‰è½®è€ƒå¯Ÿï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID å·ã€‚åœ¨æ¯ä¸€è½®è€ƒå¯Ÿè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ªèƒœå‡ºçš„ä»èŠ‚ç‚¹ï¼Œå°±å°†å…¶ä½œä¸ºæ–°ä¸»èŠ‚ç‚¹</li>
</ul>
</li>
<li>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼šè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€ä¿®æ”¹å¤åˆ¶ç›®æ ‡ï¼Œä¿®æ”¹ä¸ºå¤åˆ¶ã€Œæ–°ä¸»èŠ‚ç‚¹ã€</p>
</li>
<li>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šå°†æ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œä¿¡æ¯ï¼Œé€šè¿‡ã€Œå‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ã€é€šçŸ¥ç»™å®¢æˆ·ç«¯</p>
</li>
<li>
<p><strong>ç¬¬å››æ­¥</strong>ï¼šç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªæ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹</p>
</li>
</ul>
<h3 id="æŠ€æœ¯åŸç†">æŠ€æœ¯åŸç†</h3>
<p>å“¨å…µèŠ‚ç‚¹é€šè¿‡ Redis çš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ï¼Œå“¨å…µä¹‹é—´å¯ä»¥ç›¸äº’æ„ŸçŸ¥ï¼Œç›¸äº’è¿æ¥ï¼Œç„¶åç»„æˆå“¨å…µé›†ç¾¤ï¼ŒåŒæ—¶å“¨å…µåˆé€šè¿‡ <code>INFO</code> å‘½ä»¤ï¼Œåœ¨ä¸»èŠ‚ç‚¹é‡Œè·å¾—äº†æ‰€æœ‰ä»èŠ‚ç‚¹è¿æ¥ä¿¡æ¯ï¼Œäºæ˜¯å°±èƒ½å’Œä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œç›‘æ§äº†ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li>ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹</li>
<li>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>é«˜å¯ç”¨</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>é«˜å¯ç”¨</tag>
        <tag>å“¨å…µ</tag>
        <tag>æ•…éšœè½¬ç§»</tag>
        <tag>é›†ç¾¤</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 224 - åŸºæœ¬è®¡ç®—å™¨ï¼ˆBasic Calculatorï¼‰</title>
    <url>/2025/06/08/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-224-%E5%9F%BA%E6%9C%AC%E8%AE%A1%E7%AE%97%E5%99%A8/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ <code>s</code>ï¼Œè¯·ä½ å®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚</p>
<p>æ³¨æ„ï¼šä¸å…è®¸ä½¿ç”¨ä»»ä½•å°†å­—ç¬¦ä¸²ä½œä¸ºæ•°å­¦è¡¨è¾¾å¼è®¡ç®—çš„å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚ <code>eval()</code>ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;1 + 1&quot;</span><br><span class="line">è¾“å‡ºï¼š2</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot; 2-1 + 2 &quot;</span><br><span class="line">è¾“å‡ºï¼š3</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;(1+(4+5+2)-3)+(6+8)&quot;</span><br><span class="line">è¾“å‡ºï¼š23</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>$1 \leq s.length \leq 3 \times 10^5$</li>
<li><code>s</code> ç”±æ•°å­—ã€<code>'+'</code>ã€<code>'-'</code>ã€<code>'('</code>ã€<code>')'</code>ã€å’Œ <code>' '</code> ç»„æˆ</li>
<li><code>s</code> è¡¨ç¤ºä¸€ä¸ªæœ‰æ•ˆçš„è¡¨è¾¾å¼</li>
<li><code>'+'</code> ä¸èƒ½ç”¨ä½œä¸€å…ƒè¿ç®—çš„æ­£å·</li>
<li><code>'-'</code> å¯ä»¥ç”¨ä½œä¸€å…ƒè¿ç®—çš„è´Ÿå·</li>
<li>è¾“å…¥ä¸­ä¸å­˜åœ¨ä¸¤ä¸ªè¿ç»­çš„æ“ä½œç¬¦</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒåœ¨äº<strong>å¤„ç†å¸¦æ‹¬å·çš„è¡¨è¾¾å¼è®¡ç®—</strong>ã€‚å…³é”®éš¾ç‚¹æ˜¯ï¼š</p>
<ol>
<li><strong>ç¬¦å·çš„ä¼ é€’</strong>ï¼šæ‹¬å·å†…çš„ç¬¦å·éœ€è¦ä¸æ‹¬å·å¤–çš„ç¬¦å·ç›¸ä¹˜</li>
<li><strong>ä¼˜å…ˆçº§å¤„ç†</strong>ï¼šæ‹¬å·å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§</li>
<li><strong>çŠ¶æ€ä¿å­˜</strong>ï¼šè¿›å…¥æ‹¬å·æ—¶éœ€è¦ä¿å­˜å½“å‰çŠ¶æ€</li>
</ol>
<h3 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3>
<p>ä½¿ç”¨<strong>æ ˆ</strong>æ¥å¤„ç†æ‹¬å·çš„åµŒå¥—ï¼š</p>
<ul>
<li><strong>é‡åˆ° <code>(</code></strong>ï¼šå°†å½“å‰çš„ç»“æœå’Œç¬¦å·å‹å…¥æ ˆä¸­ï¼Œé‡æ–°å¼€å§‹è®¡ç®—</li>
<li><strong>é‡åˆ° <code>)</code></strong>ï¼šä»æ ˆä¸­å¼¹å‡ºä¹‹å‰çš„ç»“æœå’Œç¬¦å·ï¼Œä¸å½“å‰ç»“æœåˆå¹¶</li>
</ul>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li>
<p><strong>åˆå§‹åŒ–å˜é‡</strong>ï¼š</p>
<ul>
<li><code>stack</code>ï¼šå­˜å‚¨å†å²çŠ¶æ€çš„æ ˆ</li>
<li><code>sign</code>ï¼šå½“å‰æ•°å­—çš„ç¬¦å·ï¼ˆ1 æˆ– -1ï¼‰</li>
<li><code>res</code>ï¼šå½“å‰è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœ</li>
</ul>
</li>
<li>
<p><strong>éå†å­—ç¬¦ä¸²</strong>ï¼š</p>
<ul>
<li><strong>æ•°å­—</strong>ï¼šè§£æå®Œæ•´æ•°å­—ï¼ŒåŠ åˆ°ç»“æœä¸­</li>
<li><strong>ç¬¦å· <code>+/-</code></strong>ï¼šæ›´æ–°ä¸‹ä¸€ä¸ªæ•°å­—çš„ç¬¦å·</li>
<li><strong>å·¦æ‹¬å· <code>(</code></strong>ï¼šä¿å­˜å½“å‰çŠ¶æ€åˆ°æ ˆï¼Œé‡ç½®è®¡ç®—</li>
<li><strong>å³æ‹¬å· <code>)</code></strong>ï¼šæ¢å¤ä¹‹å‰çŠ¶æ€ï¼Œåˆå¹¶è®¡ç®—ç»“æœ</li>
</ul>
</li>
<li>
<p><strong>çŠ¶æ€è½¬æ¢å›¾</strong>ï¼š</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ™®é€šè®¡ç®— â”€â”€â”</span><br><span class="line">           â”‚ é‡åˆ° &#x27;(&#x27;</span><br><span class="line">           â†“</span><br><span class="line">       ä¿å­˜çŠ¶æ€åˆ°æ ˆ</span><br><span class="line">           â”‚</span><br><span class="line">           â†“</span><br><span class="line">       é‡æ–°å¼€å§‹è®¡ç®—</span><br><span class="line">           â”‚ é‡åˆ° &#x27;)&#x27;</span><br><span class="line">           â†“</span><br><span class="line">       ä»æ ˆæ¢å¤çŠ¶æ€</span><br><span class="line">           â”‚</span><br><span class="line">           â†“</span><br><span class="line">       åˆå¹¶è®¡ç®—ç»“æœ</span><br></pre></td></tr></table></figure>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="å…³é”®ç‚¹åˆ†æ">å…³é”®ç‚¹åˆ†æ</h3>
<ol>
<li>
<p><strong>ç¬¦å·å¤„ç†</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>sign</code> å˜é‡è®°å½•å½“å‰æ•°å­—çš„ç¬¦å·</li>
<li>é‡åˆ° <code>+</code> è®¾ç½® <code>sign = 1</code>ï¼Œé‡åˆ° <code>-</code> è®¾ç½® <code>sign = -1</code></li>
</ul>
</li>
<li>
<p><strong>æ‹¬å·å¤„ç†</strong>ï¼š</p>
<ul>
<li>å·¦æ‹¬å·ï¼š<code>stack.push(sign)</code> â†’ <code>stack.push(res)</code> â†’ é‡ç½®çŠ¶æ€</li>
<li>å³æ‹¬å·ï¼šå¼¹å‡º <code>preRes</code> å’Œ <code>preSign</code>ï¼Œè®¡ç®— <code>preSign * res + preRes</code></li>
</ul>
</li>
<li>
<p><strong>æ•°å­—è§£æ</strong>ï¼š</p>
<ul>
<li>è¿ç»­è¯»å–æ•°å­—å­—ç¬¦ï¼Œæ„å»ºå®Œæ•´çš„æ•°å­—</li>
<li>æ³¨æ„å¤„ç†å¤šä½æ•°å­—çš„æƒ…å†µ</li>
</ul>
</li>
</ol>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ <code>&quot;(1+(4+5+2)-3)+(6+8)&quot;</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ­¥éª¤è¯¦è§£ï¼š</span><br><span class="line">1. é‡åˆ° &#x27;(&#x27;ï¼šstack = [1, 0], res = 0, sign = 1</span><br><span class="line">2. æ•°å­— 1ï¼šres = 1</span><br><span class="line">3. é‡åˆ° &#x27;+&#x27;ï¼šsign = 1</span><br><span class="line">4. é‡åˆ° &#x27;(&#x27;ï¼šstack = [1, 0, 1, 1], res = 0, sign = 1</span><br><span class="line">5. æ•°å­— 4ï¼šres = 4</span><br><span class="line">6. é‡åˆ° &#x27;+&#x27;ï¼šsign = 1</span><br><span class="line">7. æ•°å­— 5ï¼šres = 9</span><br><span class="line">8. é‡åˆ° &#x27;+&#x27;ï¼šsign = 1</span><br><span class="line">9. æ•°å­— 2ï¼šres = 11</span><br><span class="line">10. é‡åˆ° &#x27;)&#x27;ï¼špreRes = 1, preSign = 1, res = 1 * 11 + 1 = 12</span><br><span class="line">11. é‡åˆ° &#x27;-&#x27;ï¼šsign = -1</span><br><span class="line">12. æ•°å­— 3ï¼šres = 12 + (-1) * 3 = 9</span><br><span class="line">13. é‡åˆ° &#x27;)&#x27;ï¼špreRes = 0, preSign = 1, res = 1 * 9 + 0 = 9</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    stack := []<span class="type">int</span>&#123;&#125;      <span class="comment">// å­˜å‚¨å†å²çŠ¶æ€çš„æ ˆ</span></span><br><span class="line">    sign := <span class="number">1</span>             <span class="comment">// å½“å‰æ•°å­—çš„ç¬¦å·ï¼š1è¡¨ç¤ºæ­£ï¼Œ-1è¡¨ç¤ºè´Ÿ</span></span><br><span class="line">    res := <span class="number">0</span>              <span class="comment">// å½“å‰è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line">        char := s[i]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> unicode.IsDigit(<span class="type">rune</span>(char)) &#123;</span><br><span class="line">            <span class="comment">// è§£æå®Œæ•´çš„æ•°å­—ï¼ˆå¯èƒ½æ˜¯å¤šä½æ•°ï¼‰</span></span><br><span class="line">            num := <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i &lt; <span class="built_in">len</span>(s) &amp;&amp; unicode.IsDigit(<span class="type">rune</span>(s[i])) &#123;</span><br><span class="line">                num = num*<span class="number">10</span> + <span class="type">int</span>(s[i]-<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                i++</span><br><span class="line">            &#125;</span><br><span class="line">            i-- <span class="comment">// å›é€€ä¸€ä½ï¼Œå› ä¸ºå¤–å±‚å¾ªç¯ä¼šè‡ªåŠ¨ i++</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å°†æ•°å­—åŠ åˆ°å½“å‰ç»“æœä¸­</span></span><br><span class="line">            res += sign * num</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> char == <span class="string">&#x27;+&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸‹ä¸€ä¸ªæ•°å­—ä¸ºæ­£æ•°</span></span><br><span class="line">            sign = <span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> char == <span class="string">&#x27;-&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸‹ä¸€ä¸ªæ•°å­—ä¸ºè´Ÿæ•°</span></span><br><span class="line">            sign = <span class="number">-1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> char == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// é‡åˆ°å·¦æ‹¬å·ï¼šä¿å­˜å½“å‰çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹è®¡ç®—</span></span><br><span class="line">            stack = <span class="built_in">append</span>(stack, sign)  <span class="comment">// ä¿å­˜å½“å‰ç¬¦å·</span></span><br><span class="line">            stack = <span class="built_in">append</span>(stack, res)   <span class="comment">// ä¿å­˜å½“å‰ç»“æœ</span></span><br><span class="line">            res = <span class="number">0</span>                      <span class="comment">// é‡ç½®ç»“æœ</span></span><br><span class="line">            sign = <span class="number">1</span>                     <span class="comment">// é‡ç½®ç¬¦å·</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> char == <span class="string">&#x27;)&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// é‡åˆ°å³æ‹¬å·ï¼šæ¢å¤ä¹‹å‰çŠ¶æ€ï¼Œåˆå¹¶ç»“æœ</span></span><br><span class="line">            preRes := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]    <span class="comment">// å¼¹å‡ºä¹‹å‰çš„ç»“æœ</span></span><br><span class="line">            stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">            preSign := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]   <span class="comment">// å¼¹å‡ºä¹‹å‰çš„ç¬¦å·</span></span><br><span class="line">            stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆå¹¶è®¡ç®—ï¼špreSign * å½“å‰ç»“æœ + ä¹‹å‰ç»“æœ</span></span><br><span class="line">            res = preSign*res + preRes</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¿½ç•¥ç©ºæ ¼å­—ç¬¦</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$</li>
<li>æ¯ä¸ªå­—ç¬¦æœ€å¤šè¢«è®¿é—®ä¸€æ¬¡ï¼Œæ•°å­—å­—ç¬¦å¯èƒ½éœ€è¦é¢å¤–çš„å†…å±‚å¾ªç¯æ¥æ„å»ºå®Œæ•´æ•°å­—</li>
<li>æ ˆæ“ä½œï¼ˆå…¥æ ˆã€å‡ºæ ˆï¼‰éƒ½æ˜¯ $O(1)$ æ—¶é—´å¤æ‚åº¦</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<ul>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n)$</li>
<li>åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆå¦‚ <code>&quot;((((1))))&quot;</code> ï¼‰ï¼Œæ ˆçš„æ·±åº¦ç­‰äºæ‹¬å·çš„åµŒå¥—æ·±åº¦</li>
<li>æœ€å¤§åµŒå¥—æ·±åº¦å¯èƒ½è¾¾åˆ° $O(n)$</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="æ ¸å¿ƒæ€æƒ³-2">æ ¸å¿ƒæ€æƒ³</h3>
<ol>
<li><strong>æ ˆå¤„ç†æ‹¬å·</strong>ï¼šä½¿ç”¨æ ˆä¿å­˜å’Œæ¢å¤è®¡ç®—çŠ¶æ€æ˜¯å¤„ç†åµŒå¥—ç»“æ„çš„ç»å…¸æ–¹æ³•</li>
<li><strong>ç¬¦å·ä¼ é€’</strong>ï¼šæ‹¬å·å†…å¤–ç¬¦å·çš„æ­£ç¡®ä¼ é€’æ˜¯è§£é¢˜å…³é”®</li>
<li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šåˆç†è®¾è®¡çŠ¶æ€å˜é‡ï¼ˆ<code>res</code>ã€<code>sign</code>ã€<code>stack</code>ï¼‰</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>å¤šä½æ•°å­—å¤„ç†</strong>ï¼šç¡®ä¿æ­£ç¡®è§£æå®Œæ•´çš„æ•°å­—ï¼Œè€Œä¸æ˜¯å•ä¸ªå­—ç¬¦</li>
<li><strong>å¾ªç¯ç´¢å¼•</strong>ï¼šå†…å±‚æ•°å­—è§£æå¾ªç¯åéœ€è¦å›é€€ç´¢å¼•</li>
<li><strong>ç¬¦å·åˆå§‹åŒ–</strong>ï¼šè¿›å…¥æ–°æ‹¬å·æ—¶è¦é‡ç½®ç¬¦å·ä¸ºæ­£</li>
</ol>
<h3 id="æ‰©å±•åº”ç”¨">æ‰©å±•åº”ç”¨</h3>
<ul>
<li>è¿™ç§æ ˆçš„çŠ¶æ€ä¿å­˜æŠ€å·§å¯åº”ç”¨äºï¼š
<ul>
<li>è¡¨è¾¾å¼æ±‚å€¼ç±»é—®é¢˜</li>
<li>æ‹¬å·åŒ¹é…é—®é¢˜</li>
<li>é€’å½’ç»“æ„çš„è¿­ä»£å®ç°</li>
</ul>
</li>
</ul>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li>LeetCode 227: åŸºæœ¬è®¡ç®—å™¨ IIï¼ˆå¤„ç†ä¹˜é™¤è¿ç®—ï¼‰</li>
<li>LeetCode 772: åŸºæœ¬è®¡ç®—å™¨ IIIï¼ˆåŒæ—¶å¤„ç†åŠ å‡ä¹˜é™¤å’Œæ‹¬å·ï¼‰</li>
<li>LeetCode 394: å­—ç¬¦ä¸²è§£ç ï¼ˆç±»ä¼¼çš„æ ˆçŠ¶æ€ä¿å­˜æ€è·¯ï¼‰</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ˆ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>Hard</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>æ•°å­¦</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 452 - ç”¨æœ€å°‘æ•°é‡çš„ç®­å¼•çˆ†æ°”çƒï¼ˆMinimum Number of Arrows to Burst Balloonsï¼‰</title>
    <url>/2025/06/08/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-452-%E7%94%A8%E6%9C%80%E5%B0%91%E6%95%B0%E9%87%8F%E7%9A%84%E7%AE%AD%E5%BC%95%E7%88%86%E6%B0%94%E7%90%83/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>æœ‰ä¸€äº›çƒå½¢æ°”çƒè´´åœ¨ä¸€å µç”¨ XY å¹³é¢è¡¨ç¤ºçš„å¢™ä¸Šã€‚å¢™ä¸Šçš„æ°”çƒç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ <code>points</code> è¡¨ç¤ºï¼Œå…¶ä¸­ <code>points[i] = [xstart, xend]</code> è¡¨ç¤ºæ°´å¹³ç›´å¾„åœ¨ <code>xstart</code> å’Œ <code>xend</code> ä¹‹é—´çš„æ°”çƒã€‚ä½ ä¸çŸ¥é“æ°”çƒçš„ç¡®åˆ‡ y åæ ‡ã€‚</p>
<p>ä¸€æ”¯å¼“ç®­å¯ä»¥æ²¿ç€ x è½´ä»ä¸åŒç‚¹å®Œå…¨å‚ç›´åœ°å°„å‡ºã€‚åœ¨åæ ‡ x å¤„å°„å‡ºä¸€æ”¯ç®­ï¼Œè‹¥æœ‰ä¸€ä¸ªæ°”çƒçš„ç›´å¾„çš„å¼€å§‹å’Œç»“æŸåæ ‡ä¸º <code>xstart</code>ï¼Œ<code>xend</code>ï¼Œä¸”æ»¡è¶³ <code>xstart â‰¤ x â‰¤ xend</code>ï¼Œåˆ™è¯¥æ°”çƒä¼šè¢«å¼•çˆ†ã€‚å¯ä»¥å°„å‡ºçš„å¼“ç®­çš„æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚å¼“ç®­ä¸€æ—¦è¢«å°„å‡ºä¹‹åï¼Œå¯ä»¥æ— é™åœ°å‰è¿›ã€‚</p>
<p>ç»™ä½ ä¸€ä¸ªæ•°ç»„ <code>points</code>ï¼Œè¿”å›å¼•çˆ†æ‰€æœ‰æ°”çƒæ‰€å¿…é¡»å°„å‡ºçš„<strong>æœ€å°å¼“ç®­æ•°</strong>ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špoints = [[10,16],[2,8],[1,6],[7,12]]</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼šæ°”çƒå¯ä»¥ç”¨2æ”¯ç®­æ¥çˆ†ç ´:</span><br><span class="line">-åœ¨x = 6å¤„å°„å‡ºç®­ï¼Œå‡»ç ´æ°”çƒ[2,8]å’Œ[1,6]ã€‚</span><br><span class="line">-åœ¨x = 11å¤„å°„å‡ºç®­ï¼Œå‡»ç ´æ°”çƒ[10,16]å’Œ[7,12]ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špoints = [[1,2],[3,4],[5,6],[7,8]]</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼šæ¯ä¸ªæ°”çƒéœ€è¦å°„å‡ºä¸€æ”¯ç®­ï¼Œæ€»å…±éœ€è¦4æ”¯ç®­ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼špoints = [[1,2],[2,3],[3,4],[4,5]]</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼šæ°”çƒå¯ä»¥ç”¨2æ”¯ç®­æ¥çˆ†ç ´:</span><br><span class="line">- åœ¨x = 2å¤„å°„å‡ºç®­ï¼Œå‡»ç ´æ°”çƒ[1,2]å’Œ[2,3]ã€‚</span><br><span class="line">- åœ¨x = 4å¤„å°„å‡ºç®­ï¼Œå‡»ç ´æ°”çƒ[3,4]å’Œ[4,5]ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>1 â‰¤ points.length â‰¤ 10^5</code></li>
<li><code>points[i].length == 2</code></li>
<li><code>-2^31 â‰¤ xstart &lt; xend â‰¤ 2^31 - 1</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„<strong>åŒºé—´é‡å é—®é¢˜</strong>ï¼Œå¯ä»¥ç”¨<strong>è´ªå¿ƒç®—æ³•</strong>æ¥è§£å†³ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å°½å¯èƒ½è®©æ¯æ”¯ç®­å°„ä¸­æ›´å¤šçš„æ°”çƒ</strong>ã€‚</p>
<h3 id="å…³é”®æ´å¯Ÿ">å…³é”®æ´å¯Ÿ</h3>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼šå¦‚æœæˆ‘ä»¬æŒ‰ç…§æ°”çƒçš„å³ç«¯ç‚¹è¿›è¡Œæ’åºï¼Œç„¶åè´ªå¿ƒåœ°é€‰æ‹©å°„ç®­ä½ç½®ï¼Œå°±èƒ½ä¿è¯ç”¨æœ€å°‘çš„ç®­æ•°ã€‚</p>
<p>å…·ä½“æ€è·¯ï¼š</p>
<ol>
<li><strong>æŒ‰å³ç«¯ç‚¹æ’åº</strong>ï¼šå°†æ‰€æœ‰æ°”çƒæŒ‰ç…§å³ç«¯ç‚¹ä»å°åˆ°å¤§æ’åº</li>
<li><strong>è´ªå¿ƒé€‰æ‹©</strong>ï¼šæ¯æ¬¡é€‰æ‹©å½“å‰èƒ½å°„ä¸­çš„æ°”çƒä¸­å³ç«¯ç‚¹æœ€å°çš„ä½ç½®å°„ç®­</li>
<li><strong>æ›´æ–°çŠ¶æ€</strong>ï¼šå°„å‡ºä¸€ç®­åï¼Œæ‰€æœ‰è¢«è¿™æ”¯ç®­å°„ä¸­çš„æ°”çƒéƒ½è¢«ç§»é™¤ï¼Œç»§ç»­å¤„ç†å‰©ä½™æ°”çƒ</li>
</ol>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<h4 id="æ­¥éª¤-1ï¼šæ’åº">æ­¥éª¤ 1ï¼šæ’åº</h4>
<p>æŒ‰ç…§æ¯ä¸ªæ°”çƒçš„å³ç«¯ç‚¹ <code>points[i][1]</code> è¿›è¡Œå‡åºæ’åºã€‚</p>
<h4 id="æ­¥éª¤-2ï¼šè´ªå¿ƒé€‰æ‹©">æ­¥éª¤ 2ï¼šè´ªå¿ƒé€‰æ‹©</h4>
<ul>
<li>åˆå§‹åŒ–ç®­æ•° <code>ans = 1</code>ï¼ˆè‡³å°‘éœ€è¦ä¸€æ”¯ç®­ï¼‰</li>
<li>è®°å½•ç¬¬ä¸€æ”¯ç®­çš„å°„å‡»ä½ç½®ä¸ºç¬¬ä¸€ä¸ªæ°”çƒçš„å³ç«¯ç‚¹ <code>maxRight = points[0][1]</code></li>
</ul>
<h4 id="æ­¥éª¤-3ï¼šéå†å¤„ç†">æ­¥éª¤ 3ï¼šéå†å¤„ç†</h4>
<p>å¯¹äºæ¯ä¸ªåç»­æ°”çƒï¼š</p>
<ul>
<li>å¦‚æœå½“å‰æ°”çƒçš„å·¦ç«¯ç‚¹ <code>point[0] &gt; maxRight</code>ï¼Œè¯´æ˜å½“å‰ç®­æ— æ³•å°„ä¸­è¿™ä¸ªæ°”çƒ</li>
<li>éœ€è¦å°„å‡ºæ–°çš„ä¸€ç®­ï¼š<code>ans++</code>ï¼Œå¹¶æ›´æ–°å°„å‡»ä½ç½® <code>maxRight = point[1]</code></li>
<li>å¦åˆ™ï¼Œå½“å‰ç®­å¯ä»¥å°„ä¸­è¿™ä¸ªæ°”çƒï¼Œæ— éœ€é¢å¤–æ“ä½œ</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆæŒ‰å³ç«¯ç‚¹æ’åºï¼Ÿ">ä¸ºä»€ä¹ˆæŒ‰å³ç«¯ç‚¹æ’åºï¼Ÿ</h3>
<p>æŒ‰å³ç«¯ç‚¹æ’åºçš„åŸå› æ˜¯ï¼š<strong>è´ªå¿ƒåœ°é€‰æ‹©å°½å¯èƒ½é å³çš„ä½ç½®å°„ç®­ï¼Œèƒ½å¤Ÿè¦†ç›–æ›´å¤šçš„æ°”çƒ</strong>ã€‚</p>
<p>è€ƒè™‘ä¸¤ä¸ªé‡å çš„åŒºé—´ <code>[a1, b1]</code> å’Œ <code>[a2, b2]</code>ï¼Œå…¶ä¸­ <code>b1 â‰¤ b2</code>ï¼š</p>
<ul>
<li>å¦‚æœåœ¨ <code>b1</code> å¤„å°„ç®­ï¼Œå¯ä»¥åŒæ—¶å°„ä¸­ä¸¤ä¸ªæ°”çƒ</li>
<li>å¦‚æœåœ¨ <code>b2</code> å¤„å°„ç®­ï¼Œåªèƒ½å°„ä¸­ç¬¬äºŒä¸ªæ°”çƒ</li>
<li>å› æ­¤é€‰æ‹© <code>b1</code>ï¼ˆè¾ƒå°çš„å³ç«¯ç‚¹ï¼‰æ›´ä¼˜</li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ’åºç­–ç•¥">æ’åºç­–ç•¥</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">sort.Slice(points, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> points[i][<span class="number">1</span>] &lt; points[j][<span class="number">1</span>]  <span class="comment">// æŒ‰å³ç«¯ç‚¹å‡åºæ’åº</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="è´ªå¿ƒåˆ¤æ–­">è´ªå¿ƒåˆ¤æ–­</h3>
<p>å¯¹äºæ¯ä¸ªæ°”çƒï¼Œåˆ¤æ–­å…¶å·¦ç«¯ç‚¹æ˜¯å¦å¤§äºå½“å‰ç®­çš„å°„å‡»ä½ç½®ï¼š</p>
<ul>
<li><code>point[0] &gt; maxRight</code>ï¼šéœ€è¦æ–°ç®­</li>
<li><code>point[0] â‰¤ maxRight</code>ï¼šå½“å‰ç®­å¯ä»¥å°„ä¸­</li>
</ul>
<h3 id="æ‰§è¡Œç¤ºä¾‹">æ‰§è¡Œç¤ºä¾‹</h3>
<p>ä»¥ <code>points = [[10,16],[2,8],[1,6],[7,12]]</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li><strong>æ’åºå</strong>ï¼š<code>[[1,6],[2,8],[7,12],[10,16]]</code></li>
<li><strong>åˆå§‹çŠ¶æ€</strong>ï¼š<code>ans = 1</code>, <code>maxRight = 6</code></li>
<li><strong>å¤„ç† [2,8]</strong>ï¼š<code>2 â‰¤ 6</code>ï¼Œå½“å‰ç®­å¯å°„ä¸­ï¼Œæ— éœ€æ–°ç®­</li>
<li><strong>å¤„ç† [7,12]</strong>ï¼š<code>7 &gt; 6</code>ï¼Œéœ€è¦æ–°ç®­ï¼Œ<code>ans = 2</code>, <code>maxRight = 12</code></li>
<li><strong>å¤„ç† [10,16]</strong>ï¼š<code>10 â‰¤ 12</code>ï¼Œå½“å‰ç®­å¯å°„ä¸­ï¼Œæ— éœ€æ–°ç®­</li>
<li><strong>ç»“æœ</strong>ï¼š<code>ans = 2</code></li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findMinArrowShots</span><span class="params">(points [][]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‰å³ç«¯ç‚¹å‡åºæ’åº</span></span><br><span class="line">    sort.Slice(points, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> points[i][<span class="number">1</span>] &lt; points[j][<span class="number">1</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    ans := <span class="number">1</span>                    <span class="comment">// è‡³å°‘éœ€è¦ä¸€æ”¯ç®­</span></span><br><span class="line">    maxRight := points[<span class="number">0</span>][<span class="number">1</span>]    <span class="comment">// ç¬¬ä¸€æ”¯ç®­çš„å°„å‡»ä½ç½®</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†å‰©ä½™æ°”çƒ</span></span><br><span class="line">    <span class="keyword">for</span> _, point := <span class="keyword">range</span> points &#123;</span><br><span class="line">        <span class="keyword">if</span> point[<span class="number">0</span>] &gt; maxRight &#123;    <span class="comment">// å½“å‰ç®­æ— æ³•å°„ä¸­è¿™ä¸ªæ°”çƒ</span></span><br><span class="line">            ans++                   <span class="comment">// éœ€è¦æ–°ç®­</span></span><br><span class="line">            maxRight = point[<span class="number">1</span>]     <span class="comment">// æ›´æ–°å°„å‡»ä½ç½®</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦åˆ™å½“å‰ç®­å¯ä»¥å°„ä¸­ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªæ°”çƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n \log n)$</p>
<ul>
<li>æ’åºæ“ä½œéœ€è¦ $O(n \log n)$ æ—¶é—´</li>
<li>éå†æ•°ç»„éœ€è¦ $O(n)$ æ—¶é—´</li>
<li>æ€»ä½“æ—¶é—´å¤æ‚åº¦ä¸º $O(n \log n)$</li>
</ul>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$</p>
<ul>
<li>åªä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–å˜é‡</li>
<li>æ’åºæ˜¯åŸåœ°è¿›è¡Œçš„ï¼ˆGo çš„ sort.Slice æ˜¯åŸåœ°æ’åºï¼‰</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="æ ¸å¿ƒç®—æ³•æ¦‚å¿µ">æ ¸å¿ƒç®—æ³•æ¦‚å¿µ</h3>
<ol>
<li><strong>è´ªå¿ƒç®—æ³•</strong>ï¼šåœ¨æ¯ä¸€æ­¥éƒ½åšå‡ºå½“å‰çœ‹èµ·æ¥æœ€ä¼˜çš„é€‰æ‹©</li>
<li><strong>åŒºé—´é‡å é—®é¢˜</strong>ï¼šé€šè¿‡æ’åºå’Œè´ªå¿ƒç­–ç•¥è§£å†³</li>
<li><strong>æ’åºç­–ç•¥çš„é€‰æ‹©</strong>ï¼šæŒ‰å³ç«¯ç‚¹æ’åºæ˜¯å…³é”®</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>æ’åºæ–¹å‘é”™è¯¯</strong>ï¼šå¿…é¡»æŒ‰å³ç«¯ç‚¹å‡åºæ’åºï¼Œä¸æ˜¯å·¦ç«¯ç‚¹</li>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šæ³¨æ„ <code>point[0] &gt; maxRight</code> çš„åˆ¤æ–­æ¡ä»¶</li>
<li><strong>åˆå§‹åŒ–é”™è¯¯</strong>ï¼šç®­æ•°åº”è¯¥åˆå§‹åŒ–ä¸º 1ï¼Œä¸æ˜¯ 0</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li>LeetCode 435: æ— é‡å åŒºé—´</li>
<li>LeetCode 253: ä¼šè®®å®¤ II</li>
<li>LeetCode 56: åˆå¹¶åŒºé—´</li>
</ul>
<h3 id="ç®—æ³•æ¨¡æ¿">ç®—æ³•æ¨¡æ¿</h3>
<p>è¿™ç±»åŒºé—´é‡å é—®é¢˜çš„é€šç”¨è§£æ³•ï¼š</p>
<ol>
<li>æ ¹æ®é—®é¢˜ç‰¹ç‚¹é€‰æ‹©æ’åºç­–ç•¥ï¼ˆå·¦ç«¯ç‚¹æˆ–å³ç«¯ç‚¹ï¼‰</li>
<li>è´ªå¿ƒåœ°å¤„ç†æ¯ä¸ªåŒºé—´</li>
<li>ç»´æŠ¤å¿…è¦çš„çŠ¶æ€ä¿¡æ¯ï¼ˆå¦‚å½“å‰è¦†ç›–èŒƒå›´ï¼‰</li>
</ol>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>è´ªå¿ƒ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>è´ªå¿ƒç®—æ³•</tag>
        <tag>æ’åº</tag>
        <tag>åŒºé—´é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 57. æ’å…¥åŒºé—´ - Go é¢˜è§£</title>
    <url>/2025/06/07/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-57-%E6%8F%92%E5%85%A5%E5%8C%BA%E9%97%B4/</url>
    <content><![CDATA[<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>ç»™ä½ ä¸€ä¸ª <strong>æ— é‡å çš„</strong>ã€<strong>æŒ‰ç…§åŒºé—´èµ·å§‹ç«¯ç‚¹æ’åºçš„</strong> åŒºé—´åˆ—è¡¨ <code>intervals</code>ï¼Œå…¶ä¸­ <code>intervals[i] = [starti, endi]</code> è¡¨ç¤ºç¬¬ <code>i</code> ä¸ªåŒºé—´çš„å¼€å§‹å’Œç»“æŸï¼Œå¹¶ä¸” <code>intervals</code> ä¸­çš„åŒºé—´ä¸é‡å ã€‚</p>
<p>å¦ç»™å‡ºä¸€ä¸ªæ–°åŒºé—´ <code>newInterval = [start, end]</code>ã€‚</p>
<p>ä½ éœ€è¦å°† <code>newInterval</code> æ’å…¥ <code>intervals</code> ä¸­ï¼Œå¹¶ä¿è¯ <code>intervals</code> ä»ç„¶æ˜¯æŒ‰èµ·å§‹ç«¯ç‚¹æ’åºçš„æ— é‡å åŒºé—´ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<ul>
<li><strong>è¾“å…¥:</strong> <code>intervals = [[1,3],[6,9]]</code>, <code>newInterval = [2,5]</code></li>
<li><strong>è¾“å‡º:</strong> <code>[[1,5],[6,9]]</code></li>
</ul>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<ul>
<li><strong>è¾“å…¥:</strong> <code>intervals = [[1,2],[3,5],[6,7],[8,10],[12,16]]</code>, <code>newInterval = [4,8]</code></li>
<li><strong>è¾“å‡º:</strong> <code>[[1,2],[3,10],[12,16]]</code></li>
<li><strong>è§£é‡Š:</strong> æ–°åŒºé—´ <code>[4,8]</code> ä¸ <code>[3,5]</code>, <code>[6,7]</code>, <code>[8,10]</code> é‡å ã€‚</li>
</ul>
<h3 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h3>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯åœ¨ä¸€ä¸ªæœ‰åºä¸”æ— é‡å çš„åŒºé—´åˆ—è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°åŒºé—´ï¼Œå¹¶åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ã€‚ç”±äºåŸåŒºé—´åˆ—è¡¨å·²ç»æ˜¯æœ‰åºçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€æ¬¡éå†æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªæ–°çš„ç»“æœåˆ—è¡¨ <code>res</code>ã€‚éå†åŸå§‹åŒºé—´ <code>intervals</code>ï¼Œå¯¹äºæ¯ä¸ªåŒºé—´ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š</p>
<ol>
<li>
<p><strong>å½“å‰åŒºé—´åœ¨ <code>newInterval</code> çš„å·¦ä¾§ä¸”æ— äº¤é›†</strong>ï¼š<br>
å¦‚æœå½“å‰åŒºé—´çš„ç»“æŸç‚¹ <code>interval[1]</code> å°äº <code>newInterval</code> çš„èµ·å§‹ç‚¹ <code>left</code>ï¼Œè¯´æ˜å½“å‰åŒºé—´ä¸æ–°åŒºé—´æ²¡æœ‰äº¤é›†ï¼Œå¹¶ä¸”ä½äºæ–°åŒºé—´ä¹‹å‰ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å½“å‰åŒºé—´åŠ å…¥ç»“æœåˆ—è¡¨ <code>res</code>ã€‚</p>
</li>
<li>
<p><strong>å½“å‰åŒºé—´åœ¨ <code>newInterval</code> çš„å³ä¾§ä¸”æ— äº¤é›†</strong>ï¼š<br>
å¦‚æœå½“å‰åŒºé—´çš„èµ·å§‹ç‚¹ <code>interval[0]</code> å¤§äº <code>newInterval</code> çš„ç»“æŸç‚¹ <code>right</code>ï¼Œè¯´æ˜å½“å‰åŒºé—´ä¸æ–°åŒºé—´æ²¡æœ‰äº¤é›†ï¼Œå¹¶ä¸”ä½äºæ–°åŒºé—´ä¹‹åã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†åˆå¹¶åçš„æ–°åŒºé—´ï¼ˆå¯èƒ½æ˜¯ <code>newInterval</code> æœ¬èº«ï¼Œä¹Ÿå¯èƒ½æ˜¯å®ƒä¸å…¶ä»–åŒºé—´åˆå¹¶åçš„ç»“æœï¼‰åŠ å…¥ç»“æœåˆ—è¡¨ <code>res</code>ï¼Œç„¶åå†åŠ å…¥å½“å‰åŒºé—´ã€‚ä¸ºäº†é˜²æ­¢é‡å¤æ·»åŠ ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª <code>merged</code> æ ‡å¿—ä½æ¥è®°å½•æ˜¯å¦å·²ç»æ·»åŠ è¿‡åˆå¹¶åŒºé—´ã€‚</p>
</li>
<li>
<p><strong>å½“å‰åŒºé—´ä¸ <code>newInterval</code> æœ‰äº¤é›†</strong>ï¼š<br>
åªè¦ä¸æ»¡è¶³ä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œå°±è¯´æ˜å½“å‰åŒºé—´ä¸ <code>newInterval</code> å­˜åœ¨é‡å ã€‚æˆ‘ä»¬éœ€è¦æ›´æ–° <code>newInterval</code> çš„è¾¹ç•Œï¼Œä½¿å…¶èƒ½å¤Ÿè¦†ç›–å½“å‰åŒºé—´ã€‚å…·ä½“åšæ³•æ˜¯ï¼š</p>
<ul>
<li>å°† <code>newInterval</code> çš„å·¦è¾¹ç•Œ <code>left</code> æ›´æ–°ä¸º <code>min(left, interval[0])</code>ã€‚</li>
<li>å°† <code>newInterval</code> çš„å³è¾¹ç•Œ <code>right</code> æ›´æ–°ä¸º <code>max(right, interval[1])</code>ã€‚<br>
è¿™æ ·ï¼Œéå†ç»“æŸåï¼Œ<code>[left, right]</code> å°±ä»£è¡¨äº† <code>newInterval</code> ä¸æ‰€æœ‰é‡å åŒºé—´åˆå¹¶åçš„æœ€ç»ˆåŒºé—´ã€‚</li>
</ul>
</li>
</ol>
<p>éå†ç»“æŸåï¼Œå¦‚æœ <code>merged</code> æ ‡å¿—ä½ä»ç„¶æ˜¯ <code>false</code>ï¼Œè¯´æ˜åˆå¹¶åçš„åŒºé—´è¿˜æ²¡æœ‰è¢«æ·»åŠ åˆ°ç»“æœåˆ—è¡¨ä¸­ï¼ˆè¿™é€šå¸¸å‘ç”Ÿåœ¨ <code>newInterval</code> ä¸æ‰€æœ‰åŸåŒºé—´éƒ½åˆå¹¶ï¼Œæˆ–è€…å®ƒä½äºæ‰€æœ‰åŸåŒºé—´çš„æœ«å°¾ï¼‰ï¼Œæ­¤æ—¶éœ€è¦æ‰‹åŠ¨å°†å…¶æ·»åŠ åˆ° <code>res</code> ä¸­ã€‚</p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=57 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [57] æ’å…¥åŒºé—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">insert</span><span class="params">(intervals [][]<span class="type">int</span>, newInterval []<span class="type">int</span>)</span></span> (res [][]<span class="type">int</span>) &#123;</span><br><span class="line">	left, right := newInterval[<span class="number">0</span>], newInterval[<span class="number">1</span>]</span><br><span class="line">	merged := <span class="literal">false</span></span><br><span class="line">	<span class="keyword">for</span> _, interval := <span class="keyword">range</span> intervals &#123;</span><br><span class="line">		<span class="comment">// å½“å‰åŒºé—´åœ¨ newInterval çš„å³ä¾§ä¸”æ— äº¤é›†</span></span><br><span class="line">		<span class="keyword">if</span> interval[<span class="number">0</span>] &gt; right &#123;</span><br><span class="line">			<span class="keyword">if</span> !merged &#123;</span><br><span class="line">				res = <span class="built_in">append</span>(res, []<span class="type">int</span>&#123;left, right&#125;)</span><br><span class="line">				merged = <span class="literal">true</span></span><br><span class="line">			&#125;</span><br><span class="line">			res = <span class="built_in">append</span>(res, interval)</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> interval[<span class="number">1</span>] &lt; left &#123;</span><br><span class="line">			<span class="comment">// å½“å‰åŒºé—´åœ¨ newInterval çš„å·¦ä¾§ä¸”æ— äº¤é›†</span></span><br><span class="line">			res = <span class="built_in">append</span>(res, interval)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// æœ‰äº¤é›†ï¼Œæ›´æ–° newInterval çš„èŒƒå›´</span></span><br><span class="line">			<span class="keyword">if</span> interval[<span class="number">0</span>] &lt; left &#123;</span><br><span class="line">				left = interval[<span class="number">0</span>]</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> interval[<span class="number">1</span>] &gt; right &#123;</span><br><span class="line">				right = interval[<span class="number">1</span>]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !merged &#123;</span><br><span class="line">		res = <span class="built_in">append</span>(res, []<span class="type">int</span>&#123;left, right&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: $O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯ <code>intervals</code> çš„é•¿åº¦ã€‚æˆ‘ä»¬åªéœ€è¦éå†ä¸€æ¬¡åŒºé—´åˆ—è¡¨ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: $O(n)$ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¢å¤–çš„ç©ºé—´æ¥å­˜å‚¨ç»“æœåˆ—è¡¨ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼ˆæ²¡æœ‰åŒºé—´åˆå¹¶ï¼‰ï¼Œç»“æœåˆ—è¡¨ä¼šåŒ…å«æ‰€æœ‰åŸå§‹åŒºé—´å’Œæ–°åŒºé—´ã€‚</li>
</ul>
<h3 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h3>
<p>æœ¬é¢˜çš„å…³é”®åœ¨äºåˆ©ç”¨è¾“å…¥åŒºé—´çš„æœ‰åºæ€§ã€‚é€šè¿‡ä¸€æ¬¡éå†ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°åˆ’åˆ†å‡ºä¸æ–°åŒºé—´ä¸é‡å çš„å·¦ä¾§éƒ¨åˆ†ã€é‡å éƒ¨åˆ†ä»¥åŠä¸é‡å çš„å³ä¾§éƒ¨åˆ†ï¼Œä»è€Œé«˜æ•ˆåœ°å®Œæˆæ’å…¥å’Œåˆå¹¶æ“ä½œã€‚è¿™ç§æ€è·¯åœ¨å¤„ç†åŒºé—´é—®é¢˜æ—¶éå¸¸å¸¸ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>Go</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒºé—´</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 202 - å¿«ä¹æ•° (Happy Number)</title>
    <url>/2025/06/06/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-202-%E5%BF%AB%E4%B9%90%E6%95%B0/</url>
    <content><![CDATA[<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•° <code>n</code> æ˜¯ä¸æ˜¯å¿«ä¹æ•°ã€‚</p>
<p>ã€Œå¿«ä¹æ•°ã€å®šä¹‰ä¸ºï¼š</p>
<ul>
<li>å¯¹äºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸€æ¬¡å°†è¯¥æ•°æ›¿æ¢ä¸ºå®ƒæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—çš„å¹³æ–¹å’Œã€‚</li>
<li>ç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿™ä¸ªæ•°å˜ä¸º 1ï¼Œä¹Ÿå¯èƒ½æ˜¯ æ— é™å¾ªç¯ ä½†å§‹ç»ˆå˜ä¸åˆ° 1ã€‚</li>
<li>å¦‚æœè¿™ä¸ªè¿‡ç¨‹ ç»“æœä¸º 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¿«ä¹æ•°ã€‚</li>
</ul>
<p>å¦‚æœ <code>n</code> æ˜¯ å¿«ä¹æ•° å°±è¿”å› <code>true</code> ï¼›ä¸æ˜¯ï¼Œåˆ™è¿”å› <code>false</code> ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong><br>
è¾“å…¥ï¼šn = 19<br>
è¾“å‡ºï¼štrue<br>
è§£é‡Šï¼š<br>
1Â² + 9Â² = 82<br>
8Â² + 2Â² = 68<br>
6Â² + 8Â² = 100<br>
1Â² + 0Â² + 0Â² = 1</p>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong><br>
è¾“å…¥ï¼šn = 2<br>
è¾“å‡ºï¼šfalse</p>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= n &lt;= 2^31 - 1</code></li>
</ul>
<h3 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h3>
<p>åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º&quot;å¿«ä¹æ•°&quot;çš„æ ¸å¿ƒåœ¨äºæ£€æµ‹åœ¨è½¬æ¢è¿‡ç¨‹ä¸­æ˜¯å¦ä¼šå‡ºç°å¾ªç¯ã€‚å¦‚æœæ•°å­—æœ€ç»ˆå˜ä¸º 1ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¿«ä¹æ•°ã€‚å¦‚æœè¿›å…¥ä¸€ä¸ªä¸åŒ…å« 1 çš„å¾ªç¯ï¼Œé‚£ä¹ˆå®ƒå°±ä¸æ˜¯å¿«ä¹æ•°ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥å·§å¦™åœ°ä½¿ç”¨<strong>å¿«æ…¢æŒ‡é’ˆ</strong>ï¼ˆFloyd å¾ªç¯æŸ¥æ‰¾ç®—æ³•ï¼‰æ¥è§£å†³ï¼Œè¿™ç§æ–¹æ³•å¸¸ç”¨äºåˆ¤æ–­é“¾è¡¨ç­‰åºåˆ—ä¸­æ˜¯å¦å­˜åœ¨ç¯ã€‚</p>
<ol>
<li>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>calculateHappy(num)</code>ï¼Œç”¨äºè®¡ç®—ä¸€ä¸ªæ•°å„ä½æ•°å­—çš„å¹³æ–¹å’Œã€‚</li>
<li>åœ¨ä¸»å‡½æ•° <code>isHappy(n)</code> ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼š
<ul>
<li><code>low</code>ï¼ˆæ…¢æŒ‡é’ˆï¼‰ï¼šæ¯æ¬¡é€šè¿‡ <code>calculateHappy</code> è½¬æ¢ä¸€æ¬¡ã€‚</li>
<li><code>fast</code>ï¼ˆå¿«æŒ‡é’ˆï¼‰ï¼šæ¯æ¬¡é€šè¿‡ <code>calculateHappy</code> è½¬æ¢ä¸¤æ¬¡ã€‚</li>
</ul>
</li>
<li>æˆ‘ä»¬ä¸æ–­è¿­ä»£è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ï¼š
<ul>
<li><code>low = calculateHappy(low)</code></li>
<li><code>fast = calculateHappy(calculateHappy(fast))</code></li>
</ul>
</li>
<li>å¦‚æœ <code>fast</code> æŒ‡é’ˆè¿½ä¸Šäº† <code>low</code> æŒ‡é’ˆï¼ˆå³ <code>low == fast</code>ï¼‰ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¿›å…¥äº†ä¸€ä¸ªå¾ªç¯ã€‚</li>
<li>å¾ªç¯ç»“æŸæ—¶ï¼Œå¦‚æœç›¸é‡ç‚¹çš„å€¼æ˜¯ 1ï¼Œåˆ™åŸå§‹æ•° <code>n</code> æ˜¯å¿«ä¹æ•°ï¼›å¦åˆ™ï¼Œå®ƒä¸æ˜¯å¿«ä¹æ•°ã€‚</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆå¿«æ…¢æŒ‡é’ˆèƒ½æ£€æµ‹å¾ªç¯ï¼Ÿ</strong></p>
<ul>
<li>å¦‚æœåºåˆ—ä¸­æ²¡æœ‰å¾ªç¯ï¼ˆç†è®ºä¸Šå¯¹äºå¿«ä¹æ•°é—®é¢˜ï¼Œå®ƒæ€»ä¼šè¿›å…¥å¾ªç¯æˆ–åˆ°è¾¾1ï¼‰ï¼Œå¿«æŒ‡é’ˆå°†æ°¸è¿œé¢†å…ˆäºæ…¢æŒ‡é’ˆã€‚</li>
<li>å¦‚æœåºåˆ—ä¸­æœ‰å¾ªç¯ï¼Œæ…¢æŒ‡é’ˆè¿›å…¥å¾ªç¯åï¼Œå¿«æŒ‡é’ˆæœ€ç»ˆä¼šåœ¨å¾ªç¯å†…è¿½ä¸Šæ…¢æŒ‡é’ˆã€‚æƒ³è±¡ä¸€ä¸‹åœ¨æ“åœºè·‘åœˆï¼Œè·‘å¾—å¿«çš„äººæ€»ä¼šè¿½ä¸Šè·‘å¾—æ…¢çš„äººã€‚</li>
</ul>
<h3 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h3>
<h4 id="calculateHappy-num-int-å‡½æ•°"><code>calculateHappy(num int)</code> å‡½æ•°</h4>
<p>è¿™ä¸ªå‡½æ•°è´Ÿè´£è®¡ç®—ç»™å®šæ•°å­— <code>num</code> çš„å„ä½æ•°å­—çš„å¹³æ–¹å’Œã€‚</p>
<ul>
<li>å®ƒé€šè¿‡ä¸€ä¸ªå¾ªç¯æ¥å¤„ç†æ•°å­—çš„æ¯ä¸€ä½ï¼š
<ul>
<li><code>digit := num % 10</code> è·å–æœ€ä½ä½çš„æ•°å­—ã€‚</li>
<li><code>res += digit * digit</code> å°†è¯¥æ•°å­—çš„å¹³æ–¹ç´¯åŠ åˆ°ç»“æœ <code>res</code> ä¸­ã€‚</li>
<li><code>num /= 10</code> ç§»é™¤æœ€ä½ä½çš„æ•°å­—ã€‚</li>
</ul>
</li>
<li>å¾ªç¯ç›´åˆ° <code>num</code> å˜ä¸º 0ï¼Œæ­¤æ—¶æ‰€æœ‰ä½éƒ½å·²å¤„ç†å®Œæ¯•ã€‚</li>
</ul>
<h4 id="isHappy-n-int-å‡½æ•°"><code>isHappy(n int)</code> å‡½æ•°</h4>
<ul>
<li>åˆå§‹åŒ–æ…¢æŒ‡é’ˆ <code>low</code> ä¸ºåŸå§‹æ•° <code>n</code>ã€‚</li>
<li>åˆå§‹åŒ–å¿«æŒ‡é’ˆ <code>fast</code> ä¸º <code>calculateHappy(n)</code>ï¼ˆå³èµ°äº†ä¸€æ­¥ï¼‰ã€‚</li>
<li>è¿›å…¥ä¸»å¾ªç¯ï¼Œæ¡ä»¶æ˜¯ <code>low != fast</code>ã€‚
<ul>
<li>åœ¨å¾ªç¯å†…éƒ¨ï¼Œæ…¢æŒ‡é’ˆèµ°ä¸€æ­¥ï¼š<code>low = calculateHappy(low)</code>ã€‚</li>
<li>å¿«æŒ‡é’ˆèµ°ä¸¤æ­¥ï¼š<code>fast = calculateHappy(calculateHappy(fast))</code>ã€‚</li>
</ul>
</li>
<li>å½“ <code>low == fast</code> æ—¶ï¼Œå¾ªç¯ç»ˆæ­¢ã€‚æ­¤æ—¶ï¼Œå®ƒä»¬ç›¸é‡åœ¨æŸä¸ªç‚¹ä¸Šã€‚</li>
<li>è¿”å› <code>fast == 1</code>ï¼ˆæˆ– <code>low == 1</code>ï¼‰ï¼Œåˆ¤æ–­ç›¸é‡ç‚¹æ˜¯å¦ä¸º 1ã€‚</li>
</ul>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc app=leetcode.cn id=202 lang=golang</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// [202] å¿«ä¹æ•°</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isHappy</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="comment">// ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆåˆ¤æ–­æ˜¯å¦ä¼šé™·å…¥å¾ªç¯</span></span><br><span class="line">	<span class="comment">// æ…¢æŒ‡é’ˆæ¯æ¬¡èµ°ä¸€æ­¥</span></span><br><span class="line">	low := n</span><br><span class="line">	<span class="comment">// å¿«æŒ‡é’ˆæ¯æ¬¡èµ°ä¸¤æ­¥ï¼Œåˆå§‹èµ°ä¸€æ­¥</span></span><br><span class="line">	fast := calculateHappy(n)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å½“å¿«æ…¢æŒ‡é’ˆç›¸é‡æ—¶ï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">	<span class="comment">// å¦‚æœ n æœ¬èº«æ˜¯ 1ï¼ŒcalculateHappy(1) æ˜¯ 1ï¼Œlow å’Œ fast åˆå§‹å°±å¯èƒ½ç›¸ç­‰ï¼Œä½†éœ€è¦å…ˆåˆ¤æ–­</span></span><br><span class="line">    <span class="comment">// å¦‚æœ n=1, low=1, fast=calculateHappy(1)=1. å¾ªç¯ä¸è¿›å…¥ï¼Œç›´æ¥è¿”å› fast==1 (true).</span></span><br><span class="line">    <span class="comment">// å¦‚æœ n ä¸æ˜¯ 1, ä½† calculateHappy(n) = n (ä¾‹å¦‚ n=7, calculateHappy(7)=49, calculateHappy(49)=97...), ä¸ä¼šç«‹å³é™·å…¥.</span></span><br><span class="line">	<span class="keyword">for</span> low != fast &#123;</span><br><span class="line">		low = calculateHappy(low)</span><br><span class="line">		fast = calculateHappy(calculateHappy(fast)) <span class="comment">// å¿«æŒ‡é’ˆå†èµ°ä¸¤æ­¥</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å¦‚æœç›¸é‡ç‚¹æ˜¯ 1ï¼Œåˆ™æ˜¯å¿«ä¹æ•°ï¼›å¦åˆ™ä¸æ˜¯</span></span><br><span class="line">	<span class="keyword">return</span> fast == <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// calculateHappy è®¡ç®—ä¸€ä¸ªæ•°å„ä½æ•°å­—å¹³æ–¹å’Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculateHappy</span><span class="params">(num <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	res := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> num != <span class="number">0</span> &#123;</span><br><span class="line">		digit := num % <span class="number">10</span></span><br><span class="line">		res += digit * digit</span><br><span class="line">		num /= <span class="number">10</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦ï¼š(O(\log n))</strong></p>
<ul>
<li><code>calculateHappy(m)</code> å‡½æ•°çš„å¤æ‚åº¦ä¸æ•°å­— <code>m</code> çš„ä½æ•°ç›¸å…³ï¼Œå³ (O(\log m))ã€‚</li>
<li>å¯¹äºä¸€ä¸ªæ•° <code>n</code>ï¼Œç»è¿‡ <code>calculateHappy</code> è½¬æ¢åï¼Œå…¶å€¼ä¼šæ˜¾è‘—å‡å°ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª <code>d</code> ä½æ•°ï¼Œå…¶æœ€å¤§å¯èƒ½çš„å¹³æ–¹å’Œæ˜¯ (d \times 9^2)ã€‚
<ul>
<li>å¦‚æœ <code>n = 999</code> (3ä½æ•°), (3 \times 9^2 = 3 \times 81 = 243).</li>
<li>å¦‚æœ <code>n = 1999999999</code> (10ä½æ•°, çº¦ (2 \times 10^9)), æœ€å¤§å¹³æ–¹å’Œ (1^2 + 9 \times 9^2 = 1 + 729 = 730).</li>
<li>å¯¹äº (2^{31}-1) (æœ€å¤§çº¦ (2.1 \times 10^9)), ä¹Ÿæ˜¯10ä½æ•°ï¼Œæœ€å¤§å¹³æ–¹å’Œç±»ä¼¼ï¼Œä¸ä¼šè¶…è¿‡å‡ ç™¾ã€‚</li>
</ul>
</li>
<li>è¿™æ„å‘³ç€æ— è®ºåˆå§‹çš„ <code>n</code> æœ‰å¤šå¤§ï¼Œç»è¿‡å°‘æ•°å‡ æ­¥è½¬æ¢åï¼Œæ•°å€¼ä¼šè½å…¥ä¸€ä¸ªè¾ƒå°çš„èŒƒå›´å†…ï¼ˆä¾‹å¦‚ï¼Œå°äºå‡ ç™¾ï¼‰ã€‚</li>
<li>ä¸€æ—¦æ•°å€¼è¿›å…¥è¿™ä¸ªå°èŒƒå›´ï¼Œåç»­çš„è½¬æ¢åºåˆ—å’Œä»»ä½•å¯èƒ½çš„å¾ªç¯éƒ½å°†åœ¨è¿™ä¸ªæœ‰é™çš„æ•°å­—é›†åˆä¸­å‘ç”Ÿã€‚Floyd ç®—æ³•æ£€æµ‹åˆ°å¾ªç¯æˆ–è¾¾åˆ° 1 çš„è¿­ä»£æ¬¡æ•°æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥è§†ä¸ºä¸€ä¸ªå¸¸æ•° (C)ã€‚</li>
<li>å› æ­¤ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸»è¦ç”±åˆå§‹å‡ æ¬¡å¯¹è¾ƒå¤§æ•° <code>n</code> è¿›è¡Œ <code>calculateHappy</code> è½¬æ¢æ‰€ä¸»å¯¼ï¼Œå³ (O(\log n))ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦ï¼š(O(1))</strong></p>
<ul>
<li>æˆ‘ä»¬åªä½¿ç”¨äº† <code>low</code> å’Œ <code>fast</code> ä¸¤ä¸ªå˜é‡æ¥å­˜å‚¨ä¸­é—´å€¼ï¼Œä¸éšè¾“å…¥ <code>n</code> çš„å¤§å°è€Œæ”¹å˜ã€‚</li>
</ul>
</li>
</ul>
<h3 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h3>
<ul>
<li><strong>å¾ªç¯æ£€æµ‹</strong>ï¼šå¿«ä¹æ•°é—®é¢˜æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåºåˆ—ä¸­çš„å¾ªç¯æ£€æµ‹é—®é¢˜ã€‚</li>
<li><strong>å¿«æ…¢æŒ‡é’ˆ (Floyd ç®—æ³•)</strong>ï¼šè¿™æ˜¯ä¸€ç§éå¸¸ç»å…¸ä¸”é«˜æ•ˆçš„å¾ªç¯æ£€æµ‹ç®—æ³•ï¼Œç©ºé—´å¤æ‚åº¦ä¸º (O(1))ã€‚</li>
<li><strong>çŠ¶æ€æ”¶æ•›</strong>ï¼šç†è§£æ•°å­—ç»è¿‡&quot;å„ä½å¹³æ–¹å’Œ&quot;è½¬æ¢åä¼šè¿…é€Ÿå‡å°å¹¶è¿›å…¥ä¸€ä¸ªæœ‰é™çš„çŠ¶æ€ç©ºé—´ï¼Œæ˜¯ç†è§£ç®—æ³•æœ‰æ•ˆæ€§çš„å…³é”®ã€‚</li>
<li><strong>è¾…åŠ©å‡½æ•°</strong>ï¼šå°†æ ¸å¿ƒè®¡ç®—ï¼ˆå¦‚ <code>calculateHappy</code>ï¼‰å°è£…åœ¨è¾…åŠ©å‡½æ•°ä¸­å¯ä»¥ä½¿ä¸»é€»è¾‘æ›´æ¸…æ™°ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°å­¦</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>æ•°å­¦</tag>
        <tag>éš¾åº¦ (Easy)</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 128 æœ€é•¿è¿ç»­åºåˆ—ï¼šä¸€ä¸ªå¾ªç¯å¼•å‘çš„æ€§èƒ½è¡€æ¡ˆ</title>
    <url>/2025/06/06/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-128-%E6%9C%80%E9%95%BF%E8%BF%9E%E7%BB%AD%E5%BA%8F%E5%88%97/</url>
    <content><![CDATA[<h2 id="é—®é¢˜ç®€è¿°">é—®é¢˜ç®€è¿°</h2>
<p>ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œæ‰¾å‡ºæ•°å­—è¿ç»­çš„æœ€é•¿åºåˆ—ï¼ˆä¸è¦æ±‚åºåˆ—å…ƒç´ åœ¨åŸæ•°ç»„ä¸­è¿ç»­ï¼‰çš„é•¿åº¦ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<ul>
<li><strong>è¾“å…¥ï¼š</strong> <code>nums = [100, 4, 200, 1, 3, 2]</code></li>
<li><strong>è¾“å‡ºï¼š</strong> <code>4</code></li>
<li><strong>è§£é‡Šï¼š</strong> æœ€é•¿æ•°å­—è¿ç»­åºåˆ—æ˜¯ <code>[1, 2, 3, 4]</code>ã€‚å®ƒçš„é•¿åº¦ä¸º 4ã€‚</li>
</ul>
<p>è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</p>
<h2 id="ä¸¤ç§è§£æ³•ï¼Œå¤©å·®åœ°åˆ«">ä¸¤ç§è§£æ³•ï¼Œå¤©å·®åœ°åˆ«</h2>
<p>è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªç»å…¸è§£æ³•æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨æ¥ä¼˜åŒ–æŸ¥æ‰¾ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼š</p>
<ol>
<li>å°†æ‰€æœ‰æ•°å­—å­˜å…¥ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå®ç° O(1) çš„æŸ¥æ‰¾æ•ˆç‡ã€‚</li>
<li>éå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªæ•°å­—ï¼Œå¦‚æœæˆ‘ä»¬å‘ç°å®ƒæ˜¯ä¸€ä¸ªè¿ç»­åºåˆ—çš„èµ·ç‚¹ï¼ˆå³å®ƒçš„å‰ä¸€ä¸ªæ•° <code>num-1</code> ä¸åœ¨å“ˆå¸Œè¡¨ä¸­ï¼‰ï¼Œæˆ‘ä»¬å°±å¼€å§‹å‘åè®¡ç®—è¿™ä¸ªåºåˆ—çš„é•¿åº¦ã€‚</li>
</ol>
<p>ç„¶è€Œï¼Œæ­£æ˜¯åœ¨è¿™ç¬¬äºŒæ­¥çš„&quot;éå†&quot;ä¸­ï¼Œä¸€ä¸ªç»†èŠ‚å†³å®šäº†ä»£ç çš„æ€§èƒ½æ˜¯&quot;è¶…æ—¶&quot;è¿˜æ˜¯&quot;é€šè¿‡&quot;ã€‚</p>
<h3 id="è§£æ³•ä¸€ï¼šéå†åŸå§‹æ•°ç»„ï¼ˆå¯¼è‡´è¶…æ—¶ï¼‰">è§£æ³•ä¸€ï¼šéå†åŸå§‹æ•°ç»„ï¼ˆå¯¼è‡´è¶…æ—¶ï¼‰</h3>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆè‡ªç„¶ä¼šæƒ³åˆ°çš„å®ç°æ–¹å¼ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @lc app=leetcode.cn id=128 lang=golang</span></span><br><span class="line"><span class="comment">// è¶…æ—¶ç‰ˆæœ¬</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestConsecutive</span><span class="params">(nums []<span class="type">int</span>)</span></span> (ans <span class="type">int</span>) &#123;</span><br><span class="line">	hashTable := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">bool</span>, <span class="built_in">len</span>(nums))</span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		hashTable[num] = <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å…³é”®ç‚¹ï¼šè¿™é‡Œéå†çš„æ˜¯åŸå§‹æ•°ç»„ nums</span></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		<span class="comment">// å¦‚æœ num-1 å­˜åœ¨ï¼Œè¯´æ˜ num ä¸æ˜¯åºåˆ—çš„èµ·ç‚¹ï¼Œè·³è¿‡</span></span><br><span class="line">		<span class="keyword">if</span> hashTable[num<span class="number">-1</span>] &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ä» num å¼€å§‹è®¡ç®—è¿ç»­åºåˆ—çš„é•¿åº¦</span></span><br><span class="line">		currentLen := <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> i := num; hashTable[i]; i++ &#123;</span><br><span class="line">			currentLen++</span><br><span class="line">		&#125;</span><br><span class="line">		ans = max(ans, currentLen)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ€§èƒ½ç“¶é¢ˆåˆ†æ">æ€§èƒ½ç“¶é¢ˆåˆ†æ</h4>
<p>è¿™æ®µä»£ç çš„é—®é¢˜å‡ºåœ¨ç¬¬äºŒä¸ª <code>for</code> å¾ªç¯ï¼Œå®ƒéå†çš„æ˜¯åŸå§‹æ•°ç»„ <code>nums</code>ã€‚å¦‚æœ <code>nums</code> ä¸­åŒ…å«å¤§é‡é‡å¤çš„å…ƒç´ ï¼Œå°±ä¼šå¯¼è‡´é‡å¤è®¡ç®—ã€‚</p>
<p><strong>è€ƒè™‘ä¸€ä¸ªæœ€åæƒ…å†µï¼š</strong><br>
å‡è®¾è¾“å…¥ <code>nums</code> æ˜¯ <code>[1, 1, 1, 1, 1, 2, 3, 4, 5]</code>ã€‚</p>
<ol>
<li>å“ˆå¸Œè¡¨ <code>hashTable</code> ä¼šæ˜¯ <code>&#123;1:true, 2:true, 3:true, 4:true, 5:true&#125;</code>ã€‚</li>
<li>å½“å¤–å±‚å¾ªç¯ç¬¬ä¸€æ¬¡é‡åˆ° <code>1</code> æ—¶ï¼Œå®ƒå‘ç° <code>hashTable[0]</code> ä¸å­˜åœ¨ï¼Œäºæ˜¯å¼€å§‹è®¡ç®—åºåˆ—é•¿åº¦ï¼Œä» <code>1</code> éå†åˆ° <code>5</code>ï¼Œè®¡ç®—å‡ºé•¿åº¦ä¸º 5ã€‚</li>
<li>å½“å¤–å±‚å¾ªç¯ç¬¬äºŒæ¬¡ã€ç¬¬ä¸‰æ¬¡ã€ç›´åˆ°ç¬¬äº”æ¬¡é‡åˆ° <code>1</code> æ—¶ï¼Œå®ƒä¼š<strong>ä¸€éåˆä¸€éåœ°é‡å¤</strong>ä¸Šé¢çš„è®¡ç®—è¿‡ç¨‹ã€‚</li>
</ol>
<p>å¯¹äºä¸€ä¸ªé•¿åº¦ä¸º <code>N</code> çš„æ•°ç»„ï¼Œå¦‚æœå…¶ä¸­æœ‰ <code>k</code> ä¸ªé‡å¤çš„åºåˆ—èµ·ç‚¹ï¼Œè€Œåºåˆ—çš„å¹³å‡é•¿åº¦ä¸º <code>L</code>ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦ä¼šè¶‹è¿‘äº <code>O(k*L)</code>ï¼Œåœ¨æœ€åæƒ…å†µä¸‹ <code>k</code> å’Œ <code>L</code> éƒ½å¯èƒ½ä¸ <code>N</code> ç›¸å…³ï¼Œå¯¼è‡´æ•´ä½“å¤æ‚åº¦æ¥è¿‘ <code>O(NÂ²)</code>ï¼Œä»è€Œåœ¨æ•°æ®é‡å¤§æ—¶è¶…æ—¶ã€‚</p>
<h3 id="è§£æ³•äºŒï¼šéå†å“ˆå¸Œè¡¨ï¼ˆAC-é€šè¿‡ï¼‰">è§£æ³•äºŒï¼šéå†å“ˆå¸Œè¡¨ï¼ˆAC é€šè¿‡ï¼‰</h3>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¼˜åŒ–åçš„ç‰ˆæœ¬ï¼Œæ”¹åŠ¨éå¸¸å¾®å°ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @lc app=leetcode.cn id=128 lang=golang</span></span><br><span class="line"><span class="comment">// é€šè¿‡ç‰ˆæœ¬</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestConsecutive</span><span class="params">(nums []<span class="type">int</span>)</span></span> (ans <span class="type">int</span>) &#123;</span><br><span class="line">	hashTable := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">bool</span>, <span class="built_in">len</span>(nums))</span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		hashTable[num] = <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å…³é”®ç‚¹ï¼šè¿™é‡Œéå†çš„æ˜¯å“ˆå¸Œè¡¨çš„é”®</span></span><br><span class="line">	<span class="keyword">for</span> num := <span class="keyword">range</span> hashTable &#123;</span><br><span class="line">		<span class="comment">// å¦‚æœ num-1 å­˜åœ¨ï¼Œè¯´æ˜ num ä¸æ˜¯åºåˆ—çš„èµ·ç‚¹ï¼Œè·³è¿‡</span></span><br><span class="line">		<span class="keyword">if</span> hashTable[num<span class="number">-1</span>] &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ä» num å¼€å§‹è®¡ç®—è¿ç»­åºåˆ—çš„é•¿åº¦</span></span><br><span class="line">		currentLen := <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> i := num; hashTable[i]; i++ &#123;</span><br><span class="line">			currentLen++</span><br><span class="line">		&#125;</span><br><span class="line">		ans = max(ans, currentLen)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ€§èƒ½æå‡åˆ†æ">æ€§èƒ½æå‡åˆ†æ</h4>
<p>å”¯ä¸€çš„æ”¹åŠ¨ï¼Œå°±æ˜¯å°†ç¬¬äºŒä¸ªå¾ªç¯çš„éå†å¯¹è±¡ä» <code>nums</code> æ•°ç»„æ¢æˆäº† <code>hashTable</code>ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¿™ä¸ªæ”¹åŠ¨å¦‚æ­¤å…³é”®ï¼Ÿ</strong><br>
å› ä¸ºå“ˆå¸Œè¡¨ï¼ˆåœ¨ Go ä¸­æ˜¯ <code>map</code>ï¼‰çš„é”®ï¼ˆkeyï¼‰æ˜¯<strong>å”¯ä¸€çš„</strong>ã€‚å½“æˆ‘ä»¬å°† <code>nums</code> å­˜å…¥ <code>hashTable</code> æ—¶ï¼Œæ‰€æœ‰é‡å¤çš„å…ƒç´ éƒ½è¢«è‡ªç„¶åœ°å»é™¤äº†ã€‚</p>
<p><code>for num := range hashTable</code> éå†çš„æ˜¯ <code>nums</code> æ•°ç»„ä¸­æ‰€æœ‰<strong>ä¸é‡å¤çš„å…ƒç´ </strong>ã€‚</p>
<p>å›åˆ°åˆšæ‰çš„ä¾‹å­ <code>[1, 1, 1, 1, 1, 2, 3, 4, 5]</code>ï¼š</p>
<ol>
<li><code>hashTable</code> ä¾ç„¶æ˜¯ <code>&#123;1:true, 2:true, 3:true, 4:true, 5:true&#125;</code>ã€‚</li>
<li>å½“å¤–å±‚å¾ªç¯éå†åˆ°é”® <code>1</code> æ—¶ï¼Œå®ƒä¼šè®¡ç®—ä¸€æ¬¡åºåˆ—é•¿åº¦ï¼ˆä¸º 5ï¼‰ã€‚</li>
<li>å½“éå†åˆ° <code>2</code>, <code>3</code>, <code>4</code>, <code>5</code> è¿™äº›é”®æ—¶ï¼Œå› ä¸ºå®ƒä»¬çš„å‰ä¸€ä¸ªæ•°ï¼ˆ<code>num-1</code>ï¼‰éƒ½åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ‰€ä»¥éƒ½ä¼šè¢« <code>continue</code> è¯­å¥ç›´æ¥è·³è¿‡ã€‚</li>
</ol>
<p>è¿™ç§æ–¹æ³•å·§å¦™åœ°ä¿è¯äº†ï¼Œ<strong>æ¯ä¸€ä¸ªè¿ç»­åºåˆ—åªä¼šè¢«å…¶èµ·ç‚¹è®¡ç®—ä¸€æ¬¡</strong>ã€‚æ¯ä¸ªæ•°å­—æœ€å¤šè¢«è®¿é—®ä¸¤æ¬¡ï¼ˆä¸€æ¬¡æ˜¯å¤–å±‚å¾ªç¯çš„æ£€æŸ¥ï¼Œä¸€æ¬¡æ˜¯å†…å±‚å¾ªç¯çš„é€’å¢ï¼‰ï¼Œå› æ­¤æ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ä¸¥æ ¼çš„ O(n)ã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒä¸æ€»ç»“">æ–¹æ³•æ¯”è¾ƒä¸æ€»ç»“</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è§£æ³•ä¸€ï¼šéå†åŸå§‹æ•°ç»„</th>
<th>è§£æ³•äºŒï¼šéå†å“ˆå¸Œè¡¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>æœ€å O(nÂ²)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>æ ¸å¿ƒå·®å¼‚</td>
<td>éå†å«é‡å¤å…ƒç´ çš„æ•°ç»„</td>
<td>éå†å»é‡åçš„é”®é›†åˆ</td>
</tr>
<tr>
<td>ç»“æœ</td>
<td>è¶…æ—¶</td>
<td>é€šè¿‡</td>
</tr>
</tbody>
</table>
<h3 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h3>
<p>è¿™ä¸ªä¾‹å­ç”ŸåŠ¨åœ°å‘Šè¯‰æˆ‘ä»¬ï¼š</p>
<blockquote>
<p>åœ¨è®¾è®¡ç®—æ³•æ—¶ï¼Œé€‰æ‹©æ­£ç¡®çš„éå†å¯¹è±¡å’Œåˆ©ç”¨æ•°æ®ç»“æ„ï¼ˆå¦‚å“ˆå¸Œè¡¨ï¼‰çš„å†…ç”Ÿç‰¹æ€§ï¼ˆå¦‚é”®å”¯ä¸€æ€§ï¼‰è‡³å…³é‡è¦ã€‚ä¸€ä¸ªçœ‹ä¼¼å¾®ä¸è¶³é“çš„æ”¹åŠ¨ï¼Œå¯èƒ½å°±æ˜¯ O(nÂ²) å’Œ O(n) çš„åŒºåˆ«ã€‚</p>
</blockquote>
<p>ä¸‹æ¬¡é‡åˆ°éœ€è¦å»é‡å’ŒæŸ¥æ‰¾çš„åœºæ™¯æ—¶ï¼Œè®°å¾—ä¼˜å…ˆè€ƒè™‘éå†å“ˆå¸Œè¡¨æœ¬èº«ï¼Œè€Œä¸æ˜¯éå†åŸå§‹çš„ã€å¯èƒ½å«å¤§é‡é‡å¤å…ƒç´ çš„è¾“å…¥æ•°æ®ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>Go</tag>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 49 - å­—æ¯å¼‚ä½è¯åˆ†ç»„ï¼ˆGroup Anagramsï¼‰</title>
    <url>/2025/06/05/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-49-%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D%E5%88%86%E7%BB%84/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°†<strong>å­—æ¯å¼‚ä½è¯</strong>ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚</p>
<p><strong>å­—æ¯å¼‚ä½è¯</strong>æ˜¯ç”±é‡æ–°æ’åˆ—æºå•è¯çš„æ‰€æœ‰å­—æ¯å¾—åˆ°çš„ä¸€ä¸ªæ–°å•è¯ï¼Œæ‰€æœ‰æºå•è¯ä¸­çš„å­—æ¯é€šå¸¸æ°å¥½åªç”¨ä¸€æ¬¡ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: strs = [&quot;eat&quot;,&quot;tea&quot;,&quot;tan&quot;,&quot;ate&quot;,&quot;nat&quot;,&quot;bat&quot;]</span><br><span class="line">è¾“å‡º: [[&quot;bat&quot;],[&quot;nat&quot;,&quot;tan&quot;],[&quot;ate&quot;,&quot;eat&quot;,&quot;tea&quot;]]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: strs = [&quot;&quot;]</span><br><span class="line">è¾“å‡º: [[&quot;&quot;]]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: strs = [&quot;a&quot;]</span><br><span class="line">è¾“å‡º: [[&quot;a&quot;]]</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>1 &lt;= strs.length &lt;= 10^4</code></li>
<li><code>0 &lt;= strs[i].length &lt;= 100</code></li>
<li><code>strs[i]</code> ä»…åŒ…å«å°å†™å­—æ¯</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºå­—æ¯å¼‚ä½è¯ã€‚å­—æ¯å¼‚ä½è¯çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å®ƒä»¬åŒ…å«å®Œå…¨ç›¸åŒçš„å­—æ¯ï¼Œä¸”æ¯ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•°ä¹Ÿç›¸åŒ</strong>ã€‚åŸºäºè¿™ä¸€ç‰¹ç‚¹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§ä¸»è¦è§£æ³•ã€‚</p>
<h3 id="è§£æ³•ä¸€ï¼šæ’åº">è§£æ³•ä¸€ï¼šæ’åº</h3>
<p>æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯å¯¹æ¯ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ’åºã€‚å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å­—æ¯å¼‚ä½è¯ï¼Œé‚£ä¹ˆæ’åºåå®ƒä»¬å°†å®Œå…¨ç›¸åŒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ’åºåçš„å­—ç¬¦ä¸²ä½œä¸ºå“ˆå¸Œè¡¨çš„é”®ï¼Œå°†åŸå§‹å­—ç¬¦ä¸²æ·»åŠ åˆ°å¯¹åº”çš„åˆ†ç»„ä¸­ã€‚</p>
<p><strong>å…·ä½“æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œé”®ä¸ºæ’åºåçš„å­—ç¬¦ä¸²ï¼Œå€¼ä¸ºåŸå§‹å­—ç¬¦ä¸²åˆ—è¡¨</li>
<li>éå†è¾“å…¥çš„å­—ç¬¦ä¸²æ•°ç»„</li>
<li>å¯¹æ¯ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ’åºï¼Œå¾—åˆ°æ’åºåçš„å­—ç¬¦ä¸²</li>
<li>å°†åŸå§‹å­—ç¬¦ä¸²æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­å¯¹åº”é”®çš„åˆ—è¡¨ä¸­</li>
<li>è¿”å›å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å€¼åˆ—è¡¨</li>
</ol>
<h3 id="è§£æ³•äºŒï¼šè®¡æ•°">è§£æ³•äºŒï¼šè®¡æ•°</h3>
<p>æ’åºçš„æ–¹æ³•ç®€å•ç›´è§‚ï¼Œä½†æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»Ÿè®¡æ¯ä¸ªå­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„å‡ºç°æ¬¡æ•°æ¥ä¼˜åŒ–ã€‚ç”±äºé¢˜ç›®é™å®šåªåŒ…å«å°å†™å­—æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸º 26 çš„æ•°ç»„æ¥è®°å½•æ¯ä¸ªå­—ç¬¦çš„å‡ºç°æ¬¡æ•°ã€‚</p>
<p><strong>å…·ä½“æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œé”®ä¸ºå­—ç¬¦è®¡æ•°æ•°ç»„ï¼Œå€¼ä¸ºåŸå§‹å­—ç¬¦ä¸²åˆ—è¡¨</li>
<li>éå†è¾“å…¥çš„å­—ç¬¦ä¸²æ•°ç»„</li>
<li>å¯¹æ¯ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 26 çš„è®¡æ•°æ•°ç»„ï¼Œç»Ÿè®¡æ¯ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•°</li>
<li>å°†è®¡æ•°æ•°ç»„ä½œä¸ºé”®ï¼Œå°†åŸå§‹å­—ç¬¦ä¸²æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­å¯¹åº”çš„åˆ—è¡¨ä¸­</li>
<li>è¿”å›å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å€¼åˆ—è¡¨</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="è§£æ³•ä¸€ï¼šæ’åº-2">è§£æ³•ä¸€ï¼šæ’åº</h3>
<p>åœ¨ Go è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>sort</code> åŒ…å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ’åºã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGo çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†å…¶è½¬æ¢ä¸ºå­—èŠ‚åˆ‡ç‰‡ï¼Œæ’åºåå†è½¬å›å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sortStr</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    s2 := []<span class="type">byte</span>(s)</span><br><span class="line">    sort.Slice(s2, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s2[i] &lt; s2[j]</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">string</span>(s2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨æ’åºåçš„å­—ç¬¦ä¸²ä½œä¸ºå“ˆå¸Œè¡¨çš„é”®ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">groupAnagrams</span><span class="params">(strs []<span class="type">string</span>)</span></span> [][]<span class="type">string</span> &#123;</span><br><span class="line">    hashTable := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">    res := <span class="built_in">make</span>([][]<span class="type">string</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> _, str := <span class="keyword">range</span> strs &#123;</span><br><span class="line">        sortedStr := sortStr(str)</span><br><span class="line">        <span class="keyword">if</span> index, ok := hashTable[sortedStr]; ok &#123;</span><br><span class="line">            res[index] = <span class="built_in">append</span>(res[index], str)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res = <span class="built_in">append</span>(res, []<span class="type">string</span>&#123;str&#125;)</span><br><span class="line">            hashTable[sortedStr] = <span class="built_in">len</span>(res) - <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è§£æ³•äºŒï¼šè®¡æ•°-2">è§£æ³•äºŒï¼šè®¡æ•°</h3>
<p>åœ¨è®¡æ•°æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸º 26 çš„æ•´æ•°æ•°ç»„æ¥ç»Ÿè®¡æ¯ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">groupAnagrams</span><span class="params">(strs []<span class="type">string</span>)</span></span> [][]<span class="type">string</span> &#123;</span><br><span class="line">    mp := <span class="keyword">map</span>[[<span class="number">26</span>]<span class="type">int</span>][]<span class="type">string</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> _, str := <span class="keyword">range</span> strs &#123;</span><br><span class="line">        cnt := [<span class="number">26</span>]<span class="type">int</span>&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> _, b := <span class="keyword">range</span> str &#123;</span><br><span class="line">            cnt[b-<span class="string">&#x27;a&#x27;</span>]++</span><br><span class="line">        &#125;</span><br><span class="line">        mp[cnt] = <span class="built_in">append</span>(mp[cnt], str)</span><br><span class="line">    &#125;</span><br><span class="line">    ans := <span class="built_in">make</span>([][]<span class="type">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(mp))</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> mp &#123;</span><br><span class="line">        ans = <span class="built_in">append</span>(ans, v)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>[26]int</code> ç±»å‹çš„æ•°ç»„ä½œä¸ºå“ˆå¸Œè¡¨çš„é”®ã€‚åœ¨ Go ä¸­ï¼Œæ•°ç»„æ˜¯å¯æ¯”è¾ƒçš„ï¼Œå¯ä»¥ä½œä¸ºå“ˆå¸Œè¡¨çš„é”®ï¼Œè€Œåˆ‡ç‰‡åˆ™ä¸è¡Œã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è§£æ³•ä¸€ï¼šæ’åº</th>
<th>è§£æ³•äºŒï¼šè®¡æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n * k * log(k))</td>
<td>O(n * k)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n * k)</td>
<td>O(n * k)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>æ€è·¯ç®€å•ç›´è§‚</td>
<td>æ›´é«˜æ•ˆï¼Œå°¤å…¶æ˜¯å¯¹äºé•¿å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å¯¹äºé•¿å­—ç¬¦ä¸²æ•ˆç‡è¾ƒä½</td>
<td>å®ç°ç¨å¾®å¤æ‚ä¸€äº›</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­ï¼Œn æ˜¯å­—ç¬¦ä¸²æ•°ç»„çš„é•¿åº¦ï¼Œk æ˜¯å­—ç¬¦ä¸²çš„å¹³å‡é•¿åº¦ã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="è§£æ³•ä¸€ï¼šæ’åº-3">è§£æ³•ä¸€ï¼šæ’åº</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n \times k \times \log(k))$ï¼Œå…¶ä¸­ n æ˜¯å­—ç¬¦ä¸²æ•°ç»„çš„é•¿åº¦ï¼Œk æ˜¯å­—ç¬¦ä¸²çš„å¹³å‡é•¿åº¦ã€‚å¯¹æ¯ä¸ªå­—ç¬¦ä¸²æ’åºéœ€è¦ $O(k \times \log(k))$ çš„æ—¶é—´ï¼Œæ€»å…±æœ‰ n ä¸ªå­—ç¬¦ä¸²ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n \times k)$ï¼Œéœ€è¦å­˜å‚¨æ‰€æœ‰å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h3 id="è§£æ³•äºŒï¼šè®¡æ•°-3">è§£æ³•äºŒï¼šè®¡æ•°</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n \times k)$ï¼Œå…¶ä¸­ n æ˜¯å­—ç¬¦ä¸²æ•°ç»„çš„é•¿åº¦ï¼Œk æ˜¯å­—ç¬¦ä¸²çš„å¹³å‡é•¿åº¦ã€‚æˆ‘ä»¬éœ€è¦éå†æ¯ä¸ªå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n \times k)$ï¼Œéœ€è¦å­˜å‚¨æ‰€æœ‰å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>å­—æ¯å¼‚ä½è¯çš„æœ¬è´¨</strong>ï¼šå­—æ¯å¼‚ä½è¯æœ¬è´¨ä¸Šæ˜¯åŒ…å«ç›¸åŒå­—æ¯ä¸”æ¯ä¸ªå­—æ¯å‡ºç°æ¬¡æ•°ç›¸åŒçš„å­—ç¬¦ä¸²ã€‚</li>
<li><strong>å“ˆå¸Œè¡¨çš„åº”ç”¨</strong>ï¼šè¿™é“é¢˜å±•ç¤ºäº†å“ˆå¸Œè¡¨åœ¨åˆ†ç»„é—®é¢˜ä¸­çš„å…¸å‹åº”ç”¨ã€‚</li>
<li><strong>é”®çš„é€‰æ‹©</strong>ï¼šåœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æ—¶ï¼Œé€‰æ‹©åˆé€‚çš„é”®æ˜¯å…³é”®ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ’åºåçš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦è®¡æ•°æ•°ç»„ä½œä¸ºé”®ã€‚</li>
<li><strong>Goè¯­è¨€ç‰¹æ€§</strong>ï¼šåœ¨ Go ä¸­ï¼Œæ•°ç»„æ˜¯å¯æ¯”è¾ƒçš„ï¼Œå¯ä»¥ä½œä¸ºå“ˆå¸Œè¡¨çš„é”®ï¼Œè€Œåˆ‡ç‰‡åˆ™ä¸è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦æ³¨æ„çš„è¯­è¨€ç‰¹æ€§ã€‚</li>
<li><strong>æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–</strong>ï¼šé€šè¿‡ä½¿ç”¨è®¡æ•°æ–¹æ³•è€Œä¸æ˜¯æ’åºï¼Œæˆ‘ä»¬å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦ä» $O(n \times k \times \log(k))$ é™ä½åˆ° $O(n \times k)$ã€‚</li>
</ol>
<p>è¿™é“é¢˜æ˜¯å“ˆå¸Œè¡¨åº”ç”¨çš„ç»å…¸ä¾‹é¢˜ï¼ŒæŒæ¡äº†è¿™é“é¢˜çš„è§£æ³•ï¼Œå¯¹äºå…¶ä»–æ¶‰åŠå­—ç¬¦ä¸²åˆ†ç»„æˆ–å­—æ¯å¼‚ä½è¯çš„é—®é¢˜ä¹Ÿä¼šæœ‰å¾ˆå¥½çš„å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å­—ç¬¦ä¸²</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 73 - çŸ©é˜µç½®é›¶ï¼ˆMatrix Zeroesï¼‰è§£é¢˜æ€è·¯ä¸é”™è¯¯åˆ†æ</title>
    <url>/2025/06/04/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/leetcode-73-matrix-zeroes/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ª m x n çš„çŸ©é˜µï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ ä¸º 0ï¼Œåˆ™å°†å…¶æ‰€åœ¨è¡Œå’Œåˆ—çš„æ‰€æœ‰å…ƒç´ éƒ½è®¾ä¸º 0ã€‚è¯·ä½¿ç”¨<strong>åŸåœ°</strong>ç®—æ³•ã€‚</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™ä¸ªé—®é¢˜çœ‹ä¼¼ç®€å•ï¼Œä½†å®é™…ä¸Šæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„ç»†èŠ‚ï¼Œç‰¹åˆ«æ˜¯åœ¨åŸåœ°ä¿®æ”¹çŸ©é˜µæ—¶å®¹æ˜“å‡ºç°é”™è¯¯ã€‚æˆ‘æ€»ç»“äº†ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼Œä»ç®€å•åˆ°ä¼˜åŒ–çš„é¡ºåºã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šä½¿ç”¨é¢å¤–ç©ºé—´è®°å½•">æ–¹æ³•ä¸€ï¼šä½¿ç”¨é¢å¤–ç©ºé—´è®°å½•</h3>
<p>æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯å…ˆéå†ä¸€æ¬¡çŸ©é˜µï¼Œè®°å½•å“ªäº›è¡Œå’Œåˆ—éœ€è¦ç½®é›¶ï¼Œç„¶åå†è¿›è¡Œç½®é›¶æ“ä½œã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setZeroes</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    rows := <span class="built_in">len</span>(matrix)</span><br><span class="line">    cols := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½•éœ€è¦ç½®é›¶çš„è¡Œå’Œåˆ—</span></span><br><span class="line">    zeroRows := <span class="built_in">make</span>([]<span class="type">bool</span>, rows)</span><br><span class="line">    zeroCols := <span class="built_in">make</span>([]<span class="type">bool</span>, cols)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡éå†ï¼Œæ ‡è®°éœ€è¦ç½®é›¶çš„è¡Œå’Œåˆ—</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; rows; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; cols; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> matrix[i][j] == <span class="number">0</span> &#123;</span><br><span class="line">                zeroRows[i] = <span class="literal">true</span></span><br><span class="line">                zeroCols[j] = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ¬¡éå†ï¼Œæ‰§è¡Œç½®é›¶æ“ä½œ</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; rows; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; cols; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> zeroRows[i] || zeroCols[j] &#123;</span><br><span class="line">                matrix[i][j] = <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(m*n)ï¼Œéœ€è¦éå†çŸ©é˜µä¸¤æ¬¡</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(m+n)ï¼Œéœ€è¦ä¸¤ä¸ªé¢å¤–æ•°ç»„è®°å½•è¡Œåˆ—çŠ¶æ€</li>
</ul>
<h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨çŸ©é˜µé¦–è¡Œå’Œé¦–åˆ—ä½œä¸ºæ ‡è®°">æ–¹æ³•äºŒï¼šä½¿ç”¨çŸ©é˜µé¦–è¡Œå’Œé¦–åˆ—ä½œä¸ºæ ‡è®°</h3>
<p>ä¸ºäº†ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çŸ©é˜µçš„ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—æ¥è®°å½•å“ªäº›è¡Œå’Œåˆ—éœ€è¦ç½®é›¶ã€‚ä½†éœ€è¦ç‰¹åˆ«å¤„ç†ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—æœ¬èº«æ˜¯å¦éœ€è¦ç½®é›¶ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setZeroes</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    rows := <span class="built_in">len</span>(matrix)</span><br><span class="line">    cols := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ‡è®°ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—æ˜¯å¦éœ€è¦ç½®é›¶</span></span><br><span class="line">    firstRowHasZero := <span class="literal">false</span></span><br><span class="line">    firstColHasZero := <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥ç¬¬ä¸€è¡Œæ˜¯å¦æœ‰é›¶</span></span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; cols; j++ &#123;</span><br><span class="line">        <span class="keyword">if</span> matrix[<span class="number">0</span>][j] == <span class="number">0</span> &#123;</span><br><span class="line">            firstRowHasZero = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥ç¬¬ä¸€åˆ—æ˜¯å¦æœ‰é›¶</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; rows; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> matrix[i][<span class="number">0</span>] == <span class="number">0</span> &#123;</span><br><span class="line">            firstColHasZero = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—è®°å½•å…¶ä»–è¡Œåˆ—çš„é›¶çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; rows; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">1</span>; j &lt; cols; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> matrix[i][j] == <span class="number">0</span> &#123;</span><br><span class="line">                matrix[i][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">                matrix[<span class="number">0</span>][j] = <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„æ ‡è®°ï¼Œç½®é›¶å…¶ä»–è¡Œå’Œåˆ—</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; rows; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">1</span>; j &lt; cols; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> matrix[i][<span class="number">0</span>] == <span class="number">0</span> || matrix[<span class="number">0</span>][j] == <span class="number">0</span> &#123;</span><br><span class="line">                matrix[i][j] = <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœç¬¬ä¸€è¡Œæœ‰é›¶ï¼Œå°†ç¬¬ä¸€è¡Œå…¨éƒ¨ç½®é›¶</span></span><br><span class="line">    <span class="keyword">if</span> firstRowHasZero &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; cols; j++ &#123;</span><br><span class="line">            matrix[<span class="number">0</span>][j] = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœç¬¬ä¸€åˆ—æœ‰é›¶ï¼Œå°†ç¬¬ä¸€åˆ—å…¨éƒ¨ç½®é›¶</span></span><br><span class="line">    <span class="keyword">if</span> firstColHasZero &#123;</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; rows; i++ &#123;</span><br><span class="line">            matrix[i][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(m*n)</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œåªä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–å˜é‡</li>
</ul>
<h3 id="æ–¹æ³•ä¸‰ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–çš„åŸåœ°ç®—æ³•">æ–¹æ³•ä¸‰ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–çš„åŸåœ°ç®—æ³•</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæŠ€å·§è¿›ä¸€æ­¥ç®€åŒ–æ–¹æ³•äºŒï¼Œåªä½¿ç”¨ç¬¬ä¸€è¡Œæ¥è®°å½•ä¿¡æ¯ï¼Œå¹¶ç”¨ä¸€ä¸ªé¢å¤–å˜é‡è®°å½•ç¬¬ä¸€åˆ—çš„çŠ¶æ€ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setZeroes</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    rows := <span class="built_in">len</span>(matrix)</span><br><span class="line">    cols := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">    firstColHasZero := <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡éå†ï¼Œæ ‡è®°ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; rows; i++ &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç¬¬ä¸€åˆ—æ˜¯å¦æœ‰é›¶</span></span><br><span class="line">        <span class="keyword">if</span> matrix[i][<span class="number">0</span>] == <span class="number">0</span> &#123;</span><br><span class="line">            firstColHasZero = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">1</span>; j &lt; cols; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> matrix[i][j] == <span class="number">0</span> &#123;</span><br><span class="line">                matrix[i][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">                matrix[<span class="number">0</span>][j] = <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»åå‘å‰éå†ï¼Œæ ¹æ®æ ‡è®°ç½®é›¶</span></span><br><span class="line">    <span class="keyword">for</span> i := rows - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        <span class="keyword">for</span> j := cols - <span class="number">1</span>; j &gt;= <span class="number">1</span>; j-- &#123;</span><br><span class="line">            <span class="keyword">if</span> matrix[i][<span class="number">0</span>] == <span class="number">0</span> || matrix[<span class="number">0</span>][j] == <span class="number">0</span> &#123;</span><br><span class="line">                matrix[i][j] = <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¤„ç†ç¬¬ä¸€åˆ—</span></span><br><span class="line">        <span class="keyword">if</span> firstColHasZero &#123;</span><br><span class="line">            matrix[i][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(m*n)</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)</li>
</ul>
<h2 id="æˆ‘çš„é”™è¯¯åˆ†æ">æˆ‘çš„é”™è¯¯åˆ†æ</h2>
<p>è¿™é“é¢˜æˆ‘å·²ç»é”™äº†ä¸¤æ¬¡äº†ï¼Œè®©æˆ‘è¯¦ç»†åˆ†æä¸€ä¸‹ä¸¤æ¬¡çš„é”™è¯¯åŸå› ã€‚</p>
<h3 id="ç¬¬ä¸€æ¬¡é”™è¯¯è§£æ³•">ç¬¬ä¸€æ¬¡é”™è¯¯è§£æ³•</h3>
<p>ç¬¬ä¸€æ¬¡çš„è§£æ³•æ²¡æœ‰ä¿å­˜ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„åŸå§‹çŠ¶æ€ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setZeroes</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	row := <span class="built_in">len</span>(matrix)</span><br><span class="line">	col := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; row; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; col; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> matrix[i][j] == <span class="number">0</span> &#123;</span><br><span class="line">				matrix[i][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">				matrix[<span class="number">0</span>][j] = <span class="number">0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; row; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> matrix[i][<span class="number">0</span>] == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; col; j++ &#123;</span><br><span class="line">				matrix[i][j] = <span class="number">0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; col; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> matrix[<span class="number">0</span>][i] == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; row; j++ &#123;</span><br><span class="line">				matrix[j][i] = <span class="number">0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦é—®é¢˜ï¼š</p>
<ol>
<li><strong>æ²¡æœ‰ä¿å­˜é¦–è¡Œå’Œé¦–åˆ—çš„åŸå§‹çŠ¶æ€</strong>ï¼šæ²¡æœ‰äº‹å…ˆè®°å½•ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—æ˜¯å¦åŸæœ¬å°±æœ‰0</li>
<li><strong>æ ‡è®°å’Œç½®é›¶é¡ºåºé”™è¯¯</strong>ï¼šç›´æ¥æ ¹æ®å·²è¢«ä¿®æ”¹çš„é¦–è¡Œé¦–åˆ—è¿›è¡Œç½®é›¶æ“ä½œ</li>
<li><strong>å¤„ç†ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„äº¤å‰ç‚¹é—®é¢˜</strong>ï¼šmatrix[0][0]åŒæ—¶è¡¨ç¤ºè¡Œå’Œåˆ—æ ‡è®°ï¼Œä¿¡æ¯å†²çª</li>
</ol>
<h3 id="ç¬¬äºŒæ¬¡é”™è¯¯è§£æ³•ï¼ˆæœ€æ–°çš„é”™è¯¯ï¼‰">ç¬¬äºŒæ¬¡é”™è¯¯è§£æ³•ï¼ˆæœ€æ–°çš„é”™è¯¯ï¼‰</h3>
<p>ç¬¬äºŒæ¬¡æˆ‘å·²ç»çŸ¥é“è¦ä¿å­˜ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„åŸå§‹çŠ¶æ€ï¼Œä½†åœ¨å¤„ç†å†…éƒ¨å…ƒç´ æ—¶åˆçŠ¯äº†æ–°é”™è¯¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setZeroes</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	row := <span class="built_in">len</span>(matrix)</span><br><span class="line">	col := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">	row0, col0 := <span class="literal">false</span>, <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ­£ç¡®ä¿å­˜äº†ç¬¬ä¸€åˆ—çš„åŸå§‹çŠ¶æ€</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> row &#123;</span><br><span class="line">		<span class="keyword">if</span> matrix[i][<span class="number">0</span>] == <span class="number">0</span> &#123;</span><br><span class="line">			col0 = <span class="literal">true</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ­£ç¡®ä¿å­˜äº†ç¬¬ä¸€è¡Œçš„åŸå§‹çŠ¶æ€</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> col &#123;</span><br><span class="line">		<span class="keyword">if</span> matrix[<span class="number">0</span>][i] == <span class="number">0</span> &#123;</span><br><span class="line">			row0 = <span class="literal">true</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æ­£ç¡®æ ‡è®°äº†éœ€è¦ç½®é›¶çš„è¡Œå’Œåˆ—</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; row; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; col; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> matrix[i][j] == <span class="number">0</span> &#123;</span><br><span class="line">				matrix[i][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">				matrix[<span class="number">0</span>][j] = <span class="number">0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// âŒ é”™è¯¯ï¼šåˆ†ç¦»å¤„ç†è¡Œå’Œåˆ—ï¼Œä¸”ä»ç¬¬0è¡Œå¼€å§‹</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; row; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> matrix[i][<span class="number">0</span>] == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> j := <span class="number">1</span>; j &lt; col; j++ &#123;</span><br><span class="line">				matrix[i][j] = <span class="number">0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; col; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> matrix[<span class="number">0</span>][i] == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> j := <span class="number">1</span>; j &lt; row; j++ &#123;</span><br><span class="line">				matrix[j][i] = <span class="number">0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åé¢çš„å¤„ç†æ˜¯æ­£ç¡®çš„...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç¬¬äºŒæ¬¡é”™è¯¯çš„å…³é”®é—®é¢˜</strong>ï¼š</p>
<ol>
<li><strong>é”™è¯¯çš„å¤„ç†é¡ºåº</strong>ï¼šä» i=0 å¼€å§‹å¤„ç†è¡Œï¼Œè¿™ä¼šå½±å“ç¬¬ä¸€è¡Œï¼Œä½†ç¬¬ä¸€è¡Œåº”è¯¥æœ€åå•ç‹¬å¤„ç†</li>
<li><strong>åˆ†ç¦»å¤„ç†é€»è¾‘é”™è¯¯</strong>ï¼šç”¨ä¸¤ä¸ªåˆ†ç¦»çš„å¾ªç¯åˆ†åˆ«å¤„ç†è¡Œå’Œåˆ—ï¼Œè€Œä¸æ˜¯ç»Ÿä¸€å¤„ç†æ‰€æœ‰å†…éƒ¨å…ƒç´ </li>
<li><strong>é€»è¾‘ä¸ä¸€è‡´</strong>ï¼šè¿™ç§åˆ†ç¦»å¤„ç†å¯èƒ½å¯¼è‡´æŸäº›ä½ç½®è¢«é‡å¤ä¿®æ”¹æˆ–é—æ¼</li>
</ol>
<p><strong>æ­£ç¡®çš„å¤„ç†æ–¹å¼</strong>åº”è¯¥æ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šç»Ÿä¸€å¤„ç†æ‰€æœ‰å†…éƒ¨å…ƒç´ ï¼Œä»(1,1)å¼€å§‹</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; row; i++ &#123;</span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">1</span>; j &lt; col; j++ &#123;</span><br><span class="line">        <span class="keyword">if</span> matrix[i][<span class="number">0</span>] == <span class="number">0</span> || matrix[<span class="number">0</span>][j] == <span class="number">0</span> &#123;</span><br><span class="line">            matrix[i][j] = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› æ€»ç»“">é”™è¯¯åŸå› æ€»ç»“</h3>
<p>ä¸¤æ¬¡é”™è¯¯éƒ½åæ˜ äº†å¯¹åŸåœ°ç®—æ³•çš„ç†è§£ä¸å¤Ÿæ·±å…¥ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€æ¬¡</strong>ï¼šæ²¡æœ‰æ„è¯†åˆ°éœ€è¦ä¿å­˜ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„åŸå§‹çŠ¶æ€</li>
<li><strong>ç¬¬äºŒæ¬¡</strong>ï¼šè™½ç„¶ä¿å­˜äº†åŸå§‹çŠ¶æ€ï¼Œä½†åœ¨å¤„ç†å†…éƒ¨å…ƒç´ æ—¶é‡‡ç”¨äº†é”™è¯¯çš„åˆ†ç¦»å¤„ç†ç­–ç•¥</li>
</ol>
<p><strong>å…³é”®æ•™è®­</strong>ï¼šåœ¨åŸåœ°ä¿®æ”¹çŸ©é˜µæ—¶ï¼Œå¿…é¡»ä¸¥æ ¼åŒºåˆ†ï¼š</p>
<ul>
<li>ä¿¡æ¯æ”¶é›†é˜¶æ®µï¼ˆæ ‡è®°ï¼‰</li>
<li>ä¿¡æ¯å¤„ç†é˜¶æ®µï¼ˆç½®é›¶å†…éƒ¨å…ƒç´ ï¼‰</li>
<li>è¾¹ç•Œå¤„ç†é˜¶æ®µï¼ˆå¤„ç†ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—ï¼‰</li>
</ul>
<p>ä¸‰ä¸ªé˜¶æ®µä¸èƒ½æ··æ·†ï¼Œå¦åˆ™ä¼šå¯¼è‡´é”™è¯¯çš„ç»“æœã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>çŸ©é˜µç½®é›¶é—®é¢˜æ˜¯ä¸€ä¸ªå…¸å‹çš„åŸåœ°ä¿®æ”¹çŸ©é˜µçš„é—®é¢˜ï¼Œå…³é”®åœ¨äºå¦‚ä½•è®°å½•éœ€è¦ç½®é›¶çš„è¡Œå’Œåˆ—ä¿¡æ¯è€Œä¸å¹²æ‰°åŸçŸ©é˜µçš„éå†è¿‡ç¨‹ã€‚æˆ‘åœ¨è¿™é“é¢˜ä¸ŠçŠ¯äº†ä¸¤æ¬¡é”™è¯¯ï¼Œæ·±åˆ»ä½“ç°äº†åŸåœ°ç®—æ³•çš„å¤æ‚æ€§ã€‚</p>
<p><strong>æœ€ä¼˜è§£æ³•çš„æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<ol>
<li>åˆ©ç”¨çŸ©é˜µçš„ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—ä½œä¸ºæ ‡è®°ç©ºé—´</li>
<li>ç”¨é¢å¤–å˜é‡è®°å½•ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—æœ¬èº«æ˜¯å¦éœ€è¦ç½®é›¶</li>
<li>ä¸¥æ ¼æŒ‰ç…§ä¸‰ä¸ªé˜¶æ®µæ‰§è¡Œï¼šæ ‡è®°â†’å¤„ç†å†…éƒ¨â†’å¤„ç†è¾¹ç•Œ</li>
</ol>
<p><strong>å…³é”®æ•™è®­</strong>ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€æ¬¡é”™è¯¯</strong>æ•™ä¼šæˆ‘å¿…é¡»ä¿å­˜ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„åŸå§‹çŠ¶æ€</li>
<li><strong>ç¬¬äºŒæ¬¡é”™è¯¯</strong>æ•™ä¼šæˆ‘ä¸èƒ½åˆ†ç¦»å¤„ç†è¡Œå’Œåˆ—ï¼Œå¿…é¡»ç»Ÿä¸€å¤„ç†æ‰€æœ‰å†…éƒ¨å…ƒç´ </li>
<li><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šåœ¨åŸåœ°ç®—æ³•ä¸­ï¼Œè¦ä¸¥æ ¼åŒºåˆ†ä¿¡æ¯æ”¶é›†ã€ä¿¡æ¯å¤„ç†å’Œè¾¹ç•Œå¤„ç†ä¸‰ä¸ªé˜¶æ®µï¼Œé¿å…é˜¶æ®µé—´çš„ç›¸äº’å¹²æ‰°</li>
</ul>
<p>è¿™é“é¢˜çš„ç©ºé—´å¤æ‚åº¦å¯ä»¥ä¼˜åŒ–åˆ° O(1)ï¼Œä½†å®ç°çš„å¤æ‚åº¦è¿œé«˜äºçœ‹èµ·æ¥çš„æ ·å­ã€‚æ¯ä¸€ä¸ªç»†èŠ‚éƒ½å¾ˆé‡è¦ï¼Œä¸€ä¸ªå°çš„é€»è¾‘é”™è¯¯å°±å¯èƒ½å¯¼è‡´æ•´ä¸ªç®—æ³•å¤±è´¥ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>æ•°ç»„</tag>
        <tag>çŸ©é˜µ</tag>
        <tag>åŸåœ°ç®—æ³•</tag>
        <tag>ç©ºé—´ä¼˜åŒ–</tag>
        <tag>ğŸ”¥äºŒæ¬¡é”™è¯¯</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisä¸»ä»å¤åˆ¶è¯¦è§£ï¼šåŸç†ã€ä¼˜åŒ–ä¸æ•…éšœå¤„ç†</title>
    <url>/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
    <content><![CDATA[<h1>Redisä¸»ä»å¤åˆ¶è¯¦è§£</h1>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Redisçš„AOFå’ŒRDBæŒä¹…åŒ–æŠ€æœ¯ï¼Œè¿™ä¸¤ç§æŠ€æœ¯å¯ä»¥ä¿è¯å³ä½¿æœåŠ¡å™¨é‡å¯ä¹Ÿä¸ä¼šä¸¢å¤±æ•°æ®ï¼ˆæˆ–ä»…ä¸¢å¤±å°‘é‡æ•°æ®ï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œå°†æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šä»ç„¶å­˜åœ¨é£é™©ï¼š</p>
<ul>
<li><strong>æœåŠ¡å™¨å®•æœº</strong>ï¼šæ•°æ®æ¢å¤éœ€è¦æ—¶é—´ï¼ŒæœŸé—´æ— æ³•æä¾›æœåŠ¡</li>
<li><strong>ç¡¬ç›˜æ•…éšœ</strong>ï¼šå¯èƒ½å¯¼è‡´æ•°æ®å®Œå…¨ä¸¢å¤±</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›<strong>å•ç‚¹æ•…éšœ</strong>é—®é¢˜ï¼Œæœ€å¥½çš„æ–¹æ¡ˆæ˜¯å°†æ•°æ®å¤‡ä»½åˆ°å¤šå°æœåŠ¡å™¨ä¸Šï¼Œè®©è¿™äº›æœåŠ¡å™¨éƒ½èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚è¿™æ ·å³ä½¿ä¸€å°æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œå…¶ä»–æœåŠ¡å™¨ä»èƒ½ç»§ç»­å·¥ä½œã€‚</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1748956095442.png" alt="1748956095442"></p>
<p>ä½†è¿™æ ·åˆå¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼š</p>
<ul>
<li>å¤šå°æœåŠ¡å™¨ä¹‹é—´å¦‚ä½•ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Ÿ</li>
<li>è¯»å†™æ“ä½œåº”è¯¥å¦‚ä½•åˆ†é…ï¼Ÿ</li>
</ul>
<p>Redisé€šè¿‡<strong>ä¸»ä»å¤åˆ¶æ¨¡å¼</strong>è§£å†³äº†è¿™äº›é—®é¢˜ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯ä¸»ä»å¤åˆ¶ï¼Ÿ">ä»€ä¹ˆæ˜¯ä¸»ä»å¤åˆ¶ï¼Ÿ</h2>
<p>ä¸»ä»å¤åˆ¶æ˜¯ä¸€ç§æ•°æ®åŒæ­¥æœºåˆ¶ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li><strong>ä¸€ä¸»å¤šä»</strong>ï¼šä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼ˆMasterï¼‰ï¼Œå¤šä¸ªä»æœåŠ¡å™¨ï¼ˆSlaveï¼‰</li>
<li><strong>è¯»å†™åˆ†ç¦»</strong>ï¼šä¸»æœåŠ¡å™¨è´Ÿè´£å†™æ“ä½œï¼Œä»æœåŠ¡å™¨è´Ÿè´£è¯»æ“ä½œ</li>
<li><strong>è‡ªåŠ¨åŒæ­¥</strong>ï¼šä¸»æœåŠ¡å™¨çš„å†™æ“ä½œä¼šè‡ªåŠ¨åŒæ­¥åˆ°ä»æœåŠ¡å™¨</li>
</ol>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1748956101047.png" alt="1748956101047"></p>
<p>è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§</li>
<li>æé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§</li>
<li>å®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œæå‡äº†æ€§èƒ½</li>
</ul>
<h2 id="ä¸»ä»å¤åˆ¶çš„å·¥ä½œåŸç†">ä¸»ä»å¤åˆ¶çš„å·¥ä½œåŸç†</h2>
<h3 id="å»ºç«‹ä¸»ä»å…³ç³»">å»ºç«‹ä¸»ä»å…³ç³»</h3>
<p>è¦å»ºç«‹ä¸»ä»å…³ç³»ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>replicaof</code>å‘½ä»¤ï¼ˆRedis 5.0ä¹‹å‰ä½¿ç”¨<code>slaveof</code>ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</span></span><br><span class="line">replicaof &lt;ä¸»æœåŠ¡å™¨IP&gt; &lt;ä¸»æœåŠ¡å™¨ç«¯å£&gt;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œä»æœåŠ¡å™¨å°±ä¼šæˆä¸ºä¸»æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ï¼Œå¹¶å¼€å§‹åŒæ­¥æ•°æ®ã€‚</p>
<h3 id="ç¬¬ä¸€æ¬¡åŒæ­¥è¿‡ç¨‹">ç¬¬ä¸€æ¬¡åŒæ­¥è¿‡ç¨‹</h3>
<p>ä¸»ä»æœåŠ¡å™¨çš„ç¬¬ä¸€æ¬¡åŒæ­¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1748956109396.png" alt="1748956109396"></p>
<h4 id="ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥ã€åå•†åŒæ­¥">ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥ã€åå•†åŒæ­¥</h4>
<ol>
<li>
<p><strong>å‘é€psyncå‘½ä»¤</strong>ï¼šä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€<code>psync</code>å‘½ä»¤</p>
<ul>
<li><code>runID</code>ï¼šä¸»æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç¬¬ä¸€æ¬¡ä¸º&quot;?&quot;ï¼‰</li>
<li><code>offset</code>ï¼šå¤åˆ¶è¿›åº¦ï¼ˆç¬¬ä¸€æ¬¡ä¸º-1ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å“åº”FULLRESYNC</strong>ï¼šä¸»æœåŠ¡å™¨è¿”å›<code>FULLRESYNC</code>å‘½ä»¤</p>
<ul>
<li>åŒ…å«ä¸»æœåŠ¡å™¨çš„runIDå’Œå½“å‰å¤åˆ¶è¿›åº¦offset</li>
<li>è¡¨ç¤ºå°†è¿›è¡Œå…¨é‡å¤åˆ¶</li>
</ul>
</li>
</ol>
<h4 id="ç¬¬äºŒé˜¶æ®µï¼šä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®">ç¬¬äºŒé˜¶æ®µï¼šä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®</h4>
<ol>
<li><strong>ç”ŸæˆRDBæ–‡ä»¶</strong>ï¼šä¸»æœåŠ¡å™¨æ‰§è¡Œ<code>bgsave</code>å‘½ä»¤ç”ŸæˆRDBå¿«ç…§</li>
<li><strong>å‘é€RDBæ–‡ä»¶</strong>ï¼šå°†RDBæ–‡ä»¶ä¼ è¾“ç»™ä»æœåŠ¡å™¨</li>
<li><strong>åŠ è½½RDBæ–‡ä»¶</strong>ï¼šä»æœåŠ¡å™¨æ¸…ç©ºæ—§æ•°æ®ï¼ŒåŠ è½½æ–°çš„RDBæ–‡ä»¶</li>
</ol>
<p><strong>é‡è¦</strong>ï¼šåœ¨ç”Ÿæˆã€ä¼ è¾“ã€åŠ è½½RDBæœŸé—´ï¼Œä¸»æœåŠ¡å™¨æ”¶åˆ°çš„æ–°å†™å‘½ä»¤ä¼šä¿å­˜åœ¨<code>replication buffer</code>ç¼“å†²åŒºä¸­ã€‚</p>
<h4 id="ç¬¬ä¸‰é˜¶æ®µï¼šå‘é€å¢é‡æ•°æ®">ç¬¬ä¸‰é˜¶æ®µï¼šå‘é€å¢é‡æ•°æ®</h4>
<ol>
<li>ä»æœåŠ¡å™¨åŠ è½½å®ŒRDBåï¼Œå‘é€ç¡®è®¤æ¶ˆæ¯ç»™ä¸»æœåŠ¡å™¨</li>
<li>ä¸»æœåŠ¡å™¨å°†<code>replication buffer</code>ä¸­çš„å¢é‡æ•°æ®å‘é€ç»™ä»æœåŠ¡å™¨</li>
<li>ä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œå®Œæˆæ•°æ®åŒæ­¥</li>
</ol>
<h3 id="å‘½ä»¤ä¼ æ’­">å‘½ä»¤ä¼ æ’­</h3>
<p>ç¬¬ä¸€æ¬¡åŒæ­¥å®Œæˆåï¼Œä¸»ä»æœåŠ¡å™¨ç»´æŠ¤ä¸€ä¸ª<strong>é•¿è¿æ¥</strong>ï¼š</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1748956117873.png" alt="1748956117873"></p>
<ul>
<li>ä¸»æœåŠ¡å™¨é€šè¿‡è¿™ä¸ªè¿æ¥æŒç»­å°†å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨</li>
<li>ä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§</li>
<li>ä½¿ç”¨é•¿è¿æ¥é¿å…äº†é¢‘ç¹å»ºç«‹è¿æ¥çš„å¼€é”€</li>
</ul>
<h2 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥">æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h2>
<h3 id="åˆ†æ‘Šä¸»æœåŠ¡å™¨å‹åŠ›">åˆ†æ‘Šä¸»æœåŠ¡å™¨å‹åŠ›</h3>
<p>å½“ä»æœåŠ¡å™¨æ•°é‡å¾ˆå¤šæ—¶ï¼Œä¸»æœåŠ¡å™¨å¯èƒ½é¢ä¸´å‹åŠ›ï¼š</p>
<ul>
<li>é¢‘ç¹forkè¿›ç¨‹ç”ŸæˆRDBæ–‡ä»¶</li>
<li>å¤§é‡ç½‘ç»œå¸¦å®½ç”¨äºä¼ è¾“RDBæ–‡ä»¶</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå»ºç«‹å¤šçº§ä¸»ä»æ¶æ„</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1748956126945.png" alt="1748956126945"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®©ä»æœåŠ¡å™¨ä¹Ÿæˆä¸ºå…¶ä»–æœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨</span></span><br><span class="line">replicaof &lt;ä¸­é—´æœåŠ¡å™¨IP&gt; 6379</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥ï¼š</p>
<ul>
<li>å‡è½»ä¸»æœåŠ¡å™¨çš„CPUå‹åŠ›</li>
<li>åˆ†æ‘Šç½‘ç»œå¸¦å®½ä½¿ç”¨</li>
<li>æé«˜æ•´ä½“çš„æ‰©å±•æ€§</li>
</ul>
<h2 id="å¢é‡å¤åˆ¶æœºåˆ¶">å¢é‡å¤åˆ¶æœºåˆ¶</h2>
<h3 id="ç½‘ç»œæ–­å¼€é‡è¿é—®é¢˜">ç½‘ç»œæ–­å¼€é‡è¿é—®é¢˜</h3>
<p>åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œå¦‚æœç½‘ç»œä¸­æ–­ä¼šæ€ä¹ˆåŠï¼Ÿ</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1748956137173.png" alt="1748956137173"></p>
<p><strong>Redis 2.8ä¹‹å‰</strong>ï¼šé‡æ–°è¿›è¡Œå…¨é‡å¤åˆ¶ï¼ˆæ•ˆç‡ä½ï¼‰<br>
<strong>Redis 2.8ä¹‹å</strong>ï¼šé‡‡ç”¨å¢é‡å¤åˆ¶ï¼ˆåªåŒæ­¥æ–­çº¿æœŸé—´çš„æ•°æ®ï¼‰</p>
<h3 id="å¢é‡å¤åˆ¶è¿‡ç¨‹">å¢é‡å¤åˆ¶è¿‡ç¨‹</h3>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1748956142843.png" alt="1748956142843"></p>
<ol>
<li><strong>é‡è¿è¯·æ±‚</strong>ï¼šä»æœåŠ¡å™¨å‘é€psyncå‘½ä»¤ï¼ˆoffsetä¸æ˜¯-1ï¼‰</li>
<li><strong>å“åº”CONTINUE</strong>ï¼šä¸»æœåŠ¡å™¨å†³å®šé‡‡ç”¨å¢é‡å¤åˆ¶</li>
<li><strong>å‘é€å¢é‡æ•°æ®</strong>ï¼šä¸»æœåŠ¡å™¨å‘é€æ–­çº¿æœŸé—´çš„å†™å‘½ä»¤</li>
</ol>
<h3 id="å…³é”®ç»„ä»¶">å…³é”®ç»„ä»¶</h3>
<h4 id="repl-backlog-bufferç¯å½¢ç¼“å†²åŒº">repl_backlog_bufferç¯å½¢ç¼“å†²åŒº</h4>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šä¿å­˜æœ€è¿‘çš„å†™å‘½ä»¤</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šç¯å½¢ç»“æ„ï¼Œå†™æ»¡åè¦†ç›–æ—§æ•°æ®</li>
<li><strong>é»˜è®¤å¤§å°</strong>ï¼š1MB</li>
</ul>
<h4 id="replication-offsetå¤åˆ¶åç§»é‡">replication offsetå¤åˆ¶åç§»é‡</h4>
<ul>
<li><strong>master_repl_offset</strong>ï¼šä¸»æœåŠ¡å™¨å†™å…¥ä½ç½®</li>
<li><strong>slave_repl_offset</strong>ï¼šä»æœåŠ¡å™¨è¯»å–ä½ç½®</li>
</ul>
<h3 id="åŒæ­¥ç­–ç•¥åˆ¤æ–­">åŒæ­¥ç­–ç•¥åˆ¤æ–­</h3>
<p>ä¸»æœåŠ¡å™¨æ ¹æ®åç§»é‡å·®å¼‚å†³å®šåŒæ­¥æ–¹å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦‚æœ slaveè¦è¯»å–çš„æ•°æ® åœ¨ repl_backlog_bufferä¸­ï¼š</span><br><span class="line">    æ‰§è¡Œå¢é‡å¤åˆ¶</span><br><span class="line">å¦åˆ™ï¼š</span><br><span class="line">    æ‰§è¡Œå…¨é‡å¤åˆ¶</span><br></pre></td></tr></table></figure>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/1748956152362.png" alt="1748956152362"></p>
<h3 id="ç¼“å†²åŒºå¤§å°ä¼˜åŒ–">ç¼“å†²åŒºå¤§å°ä¼˜åŒ–</h3>
<p>ä¸ºé¿å…é¢‘ç¹å…¨é‡å¤åˆ¶ï¼Œéœ€è¦åˆç†è®¾ç½®ç¼“å†²åŒºå¤§å°ï¼š</p>
<p><strong>è®¡ç®—å…¬å¼</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">repl_backlog_buffer_size = write_size_per_second Ã— æ–­çº¿é‡è¿æ—¶é—´(ç§’)</span><br></pre></td></tr></table></figure>
<p><strong>ä¸¾ä¾‹</strong>ï¼š</p>
<ul>
<li>ä¸»æœåŠ¡å™¨æ¯ç§’äº§ç”Ÿ1MBå†™å‘½ä»¤</li>
<li>å¹³å‡æ–­çº¿é‡è¿éœ€è¦5ç§’</li>
<li>å»ºè®®ç¼“å†²åŒºå¤§å°ï¼š5MB Ã— 2 = 10MB</li>
</ul>
<p><strong>é…ç½®æ–¹æ³•</strong>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">repl-backlog-size 10mb</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Redisä¸»ä»å¤åˆ¶åŒ…å«ä¸‰ç§æ ¸å¿ƒæœºåˆ¶ï¼š</p>
<ol>
<li><strong>å…¨é‡å¤åˆ¶</strong>ï¼šç¬¬ä¸€æ¬¡åŒæ­¥ï¼Œä¼ è¾“å®Œæ•´æ•°æ®</li>
<li><strong>å‘½ä»¤ä¼ æ’­</strong>ï¼šåŸºäºé•¿è¿æ¥çš„å®æ—¶åŒæ­¥</li>
<li><strong>å¢é‡å¤åˆ¶</strong>ï¼šç½‘ç»œæ¢å¤åçš„å·®å¼‚åŒæ­¥</li>
</ol>
<p><strong>å…³é”®ä¼˜åŒ–ç‚¹</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨å¤šçº§ä¸»ä»æ¶æ„åˆ†æ‘Šå‹åŠ›</li>
<li>åˆç†é…ç½®repl_backlog_bufferå¤§å°</li>
<li>ä¿è¯ä¸»ä»èŠ‚ç‚¹ç½‘ç»œç¨³å®šæ€§</li>
</ul>
<h2 id="é¢è¯•é¢˜è¯¦è§£">é¢è¯•é¢˜è¯¦è§£</h2>
<h3 id="Redisä¸»ä»èŠ‚ç‚¹æ˜¯é•¿è¿æ¥è¿˜æ˜¯çŸ­è¿æ¥ï¼Ÿ">Redisä¸»ä»èŠ‚ç‚¹æ˜¯é•¿è¿æ¥è¿˜æ˜¯çŸ­è¿æ¥ï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆ</strong>ï¼šé•¿è¿æ¥</p>
<p><strong>è§£é‡Š</strong>ï¼šä¸»ä»æœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡å…¨é‡åŒæ­¥åï¼Œä¼šç»´æŠ¤ä¸€ä¸ªTCPé•¿è¿æ¥ç”¨äºå‘½ä»¤ä¼ æ’­ï¼Œé¿å…é¢‘ç¹å»ºç«‹å’Œæ–­å¼€è¿æ¥çš„æ€§èƒ½å¼€é”€ã€‚</p>
<h3 id="æ€ä¹ˆåˆ¤æ–­RedisæŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ">æ€ä¹ˆåˆ¤æ–­RedisæŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆ</strong>ï¼šé€šè¿‡ping-pongå¿ƒè·³æ£€æµ‹æœºåˆ¶</p>
<p><strong>è¯¦ç»†è¯´æ˜</strong>ï¼š</p>
<ul>
<li><strong>ä¸»èŠ‚ç‚¹ç›‘æ§</strong>ï¼šé»˜è®¤æ¯10ç§’å‘ä»èŠ‚ç‚¹å‘é€pingå‘½ä»¤ï¼ˆå¯é€šè¿‡<code>repl-ping-slave-period</code>é…ç½®ï¼‰</li>
<li><strong>ä»èŠ‚ç‚¹ä¸ŠæŠ¥</strong>ï¼šæ¯1ç§’å‘é€<code>replconf ack&#123;offset&#125;</code>å‘½ä»¤ï¼ŒåŒ…å«ï¼š
<ul>
<li>å®æ—¶ç›‘æµ‹ç½‘ç»œçŠ¶æ€</li>
<li>ä¸ŠæŠ¥å¤åˆ¶åç§»é‡</li>
<li>æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸¢å¤±</li>
</ul>
</li>
<li><strong>å¤±æ•ˆåˆ¤æ–­</strong>ï¼šå½“ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹pingæŸä¸ªèŠ‚ç‚¹æ— å“åº”æ—¶ï¼Œè®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸‹çº¿</li>
</ul>
<h3 id="ä¸»ä»å¤åˆ¶æ¶æ„ä¸­ï¼Œè¿‡æœŸkeyå¦‚ä½•å¤„ç†ï¼Ÿ">ä¸»ä»å¤åˆ¶æ¶æ„ä¸­ï¼Œè¿‡æœŸkeyå¦‚ä½•å¤„ç†ï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆ</strong>ï¼šç”±ä¸»èŠ‚ç‚¹ç»Ÿä¸€å¤„ç†</p>
<p><strong>å¤„ç†æµç¨‹</strong>ï¼š</p>
<ol>
<li>ä¸»èŠ‚ç‚¹æ£€æµ‹åˆ°keyè¿‡æœŸæˆ–é€šè¿‡æ·˜æ±°ç®—æ³•åˆ é™¤key</li>
<li>ä¸»èŠ‚ç‚¹æ¨¡æ‹Ÿå‘é€<code>del</code>å‘½ä»¤ç»™æ‰€æœ‰ä»èŠ‚ç‚¹</li>
<li>ä»èŠ‚ç‚¹æ”¶åˆ°åˆ é™¤å‘½ä»¤åæ‰§è¡Œç›¸åº”æ“ä½œ</li>
<li>ä¿è¯ä¸»ä»èŠ‚ç‚¹å¯¹è¿‡æœŸkeyå¤„ç†çš„ä¸€è‡´æ€§</li>
</ol>
<h3 id="Redisæ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Ÿ">Redisæ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆ</strong>ï¼šå¼‚æ­¥å¤åˆ¶</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ä¸»èŠ‚ç‚¹æ”¶åˆ°å†™å‘½ä»¤åç«‹å³è¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>å†™å‘½ä»¤å…ˆå­˜å…¥å†…éƒ¨ç¼“å†²åŒºï¼Œç„¶åå¼‚æ­¥å‘é€ç»™ä»èŠ‚ç‚¹</li>
<li>ä¼˜ç‚¹ï¼šå“åº”é€Ÿåº¦å¿«ï¼Œä¸é˜»å¡ä¸»èŠ‚ç‚¹</li>
<li>ç¼ºç‚¹ï¼šå¯èƒ½å­˜åœ¨çŸ­æš‚çš„æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<h3 id="ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ªBufferæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ªBufferæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p><strong>replication buffer vs repl backlog buffer</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>replication buffer</th>
<th>repl backlog buffer</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å‡ºç°é˜¶æ®µ</strong></td>
<td>å…¨é‡å¤åˆ¶ + å¢é‡å¤åˆ¶</td>
<td>ä»…å¢é‡å¤åˆ¶</td>
</tr>
<tr>
<td><strong>åˆ†é…æ–¹å¼</strong></td>
<td>æ¯ä¸ªä»èŠ‚ç‚¹ä¸€ä¸ª</td>
<td>æ•´ä¸ªä¸»èŠ‚ç‚¹ä¸€ä¸ª</td>
</tr>
<tr>
<td><strong>æ»¡äº†ä¹‹å</strong></td>
<td>æ–­å¼€è¿æ¥ï¼Œé‡æ–°å…¨é‡å¤åˆ¶</td>
<td>è¦†ç›–æ—§æ•°æ®ï¼ˆç¯å½¢ç»“æ„ï¼‰</td>
</tr>
<tr>
<td><strong>ä¸»è¦ä½œç”¨</strong></td>
<td>ç¼“å­˜å¾…å‘é€çš„å‘½ä»¤</td>
<td>æ”¯æŒå¢é‡å¤åˆ¶</td>
</tr>
</tbody>
</table>
<h3 id="å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Ÿ">å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Ÿ</h3>
<p><strong>äº§ç”ŸåŸå› </strong>ï¼šä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œå­˜åœ¨ç½‘ç»œå»¶è¿Ÿ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>ç½‘ç»œä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä¿è¯ä¸»ä»èŠ‚ç‚¹ç½‘ç»œè¿æ¥è´¨é‡</li>
<li>é¿å…è·¨æœºæˆ¿éƒ¨ç½²</li>
</ul>
</li>
<li>
<p><strong>ç›‘æ§å¤åˆ¶è¿›åº¦</strong>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å¤åˆ¶è¿›åº¦</span></span><br><span class="line">INFO replication</span><br></pre></td></tr></table></figure>
<ul>
<li>ç›‘æ§<code>master_repl_offset</code>å’Œ<code>slave_repl_offset</code>å·®å€¼</li>
<li>å½“å·®å€¼è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæš‚æ—¶åœæ­¢ä»è¯¥ä»èŠ‚ç‚¹è¯»å–æ•°æ®</li>
</ul>
</li>
<li>
<p><strong>è®¾ç½®åˆç†é˜ˆå€¼</strong>ï¼š</p>
<ul>
<li>æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®å¯æ¥å—çš„æ•°æ®å»¶è¿ŸèŒƒå›´</li>
<li>åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡</li>
</ul>
</li>
</ol>
<h3 id="ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ">ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ</h3>
<p><strong>æ•°æ®ä¸¢å¤±åœºæ™¯</strong>ï¼š</p>
<h4 id="1-å¼‚æ­¥å¤åˆ¶æ•°æ®ä¸¢å¤±">1. å¼‚æ­¥å¤åˆ¶æ•°æ®ä¸¢å¤±</h4>
<p><strong>åŸå› </strong>ï¼šä¸»èŠ‚ç‚¹æ”¶åˆ°å†™è¯·æ±‚åç«‹å³è¿”å›ï¼Œä½†è¿˜æœªåŒæ­¥åˆ°ä»èŠ‚ç‚¹æ—¶å®•æœº</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé…ç½®<code>min-slaves-max-lag</code>å‚æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å½“æ‰€æœ‰ä»èŠ‚ç‚¹å¤åˆ¶å»¶è¿Ÿè¶…è¿‡10ç§’æ—¶ï¼Œä¸»èŠ‚ç‚¹æ‹’ç»å†™å…¥</span></span><br><span class="line">min-slaves-max-lag 10</span><br></pre></td></tr></table></figure>
<p><strong>é™çº§ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å°†æ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜/ç£ç›˜</li>
<li>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Kafkaï¼‰ç¼“å­˜æ•°æ®</li>
<li>ä¸»èŠ‚ç‚¹æ¢å¤åé‡æ–°å†™å…¥</li>
</ul>
<h4 id="2-è„‘è£‚æ•°æ®ä¸¢å¤±">2. è„‘è£‚æ•°æ®ä¸¢å¤±</h4>
<p><strong>åŸå› </strong>ï¼šç½‘ç»œåˆ†åŒºå¯¼è‡´å‡ºç°ä¸¤ä¸ªä¸»èŠ‚ç‚¹ï¼Œæ—§ä¸»èŠ‚ç‚¹æ•°æ®åœ¨é‡æ–°åŠ å…¥æ—¶è¢«æ¸…ç©º</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç»„åˆä½¿ç”¨ä¸¤ä¸ªå‚æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è‡³å°‘éœ€è¦1ä¸ªä»èŠ‚ç‚¹è¿æ¥</span></span><br><span class="line">min-slaves-to-write 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤åˆ¶å»¶è¿Ÿä¸èƒ½è¶…è¿‡12ç§’</span></span><br><span class="line">min-slaves-max-lag 12</span><br></pre></td></tr></table></figure>
<p><strong>ä¿æŠ¤æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œä¸»èŠ‚ç‚¹æ‹’ç»å†™å…¥</li>
<li>é˜²æ­¢åœ¨ç½‘ç»œåˆ†åŒºæœŸé—´å†™å…¥æ— æ³•åŒæ­¥çš„æ•°æ®</li>
<li>ç¡®ä¿åªæœ‰å¥åº·çš„ä¸»èŠ‚ç‚¹èƒ½æ¥æ”¶å†™è¯·æ±‚</li>
</ul>
<p><strong>å®é™…æ¡ˆä¾‹</strong>ï¼š<br>
å‡è®¾é…ç½®ï¼š</p>
<ul>
<li><code>min-slaves-to-write = 1</code></li>
<li><code>min-slaves-max-lag = 12s</code></li>
<li>å“¨å…µ<code>down-after-milliseconds = 10s</code></li>
</ul>
<p>å½“ä¸»èŠ‚ç‚¹å¡ä½15ç§’æ—¶ï¼š</p>
<ol>
<li>å“¨å…µåœ¨10ç§’ååˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œå¼€å§‹ä¸»ä»åˆ‡æ¢</li>
<li>ç”±äºè¶…è¿‡12ç§’æ— æ³•ä¸ä»èŠ‚ç‚¹åŒæ­¥ï¼Œä¸»èŠ‚ç‚¹åœæ­¢æ¥æ”¶å†™è¯·æ±‚</li>
<li>åˆ‡æ¢å®Œæˆåï¼Œåªæœ‰æ–°ä¸»èŠ‚ç‚¹èƒ½æ¥æ”¶è¯·æ±‚ï¼Œé¿å…æ•°æ®ä¸¢å¤±</li>
</ol>
<h3 id="ä¸»ä»å¦‚ä½•åšåˆ°æ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼Ÿ">ä¸»ä»å¦‚ä½•åšåˆ°æ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼Ÿ</h3>
<p><strong>é—®é¢˜</strong>ï¼šä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œä»èŠ‚ç‚¹æ— æ³•è‡ªåŠ¨å‡çº§ä¸ºä¸»èŠ‚ç‚¹</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šRediså“¨å…µæœºåˆ¶ï¼ˆSentinelï¼‰</p>
<p><strong>å“¨å…µåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li><strong>æ•…éšœå‘ç°</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ä¸»èŠ‚ç‚¹æ˜¯å¦å¯ç”¨</li>
<li><strong>æ•…éšœè½¬ç§»</strong>ï¼šè‡ªåŠ¨é€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹</li>
<li><strong>é€šçŸ¥åº”ç”¨</strong>ï¼šå°†å˜æ›´é€šçŸ¥ç»™å®¢æˆ·ç«¯</li>
<li><strong>é…ç½®ç®¡ç†</strong>ï¼šæ›´æ–°ä¸»ä»é…ç½®ä¿¡æ¯</li>
</ul>
<p><strong>å®ç°é«˜å¯ç”¨</strong>ï¼š</p>
<ul>
<li>æ— éœ€äººå·¥å¹²é¢„</li>
<li>å¿«é€Ÿæ•…éšœæ¢å¤</li>
<li>ä¿è¯æœåŠ¡è¿ç»­æ€§</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>é«˜å¯ç”¨</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>Redis</tag>
        <tag>é«˜å¯ç”¨</tag>
        <tag>ä¸»ä»å¤åˆ¶</tag>
        <tag>æ•°æ®åŒæ­¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis è¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</title>
    <url>/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/</url>
    <content><![CDATA[<h1>Redis è¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1>
<p>Redis çš„ã€Œå†…å­˜æ·˜æ±°ç­–ç•¥ã€å’Œã€Œè¿‡æœŸåˆ é™¤ç­–ç•¥ã€ï¼Œå¾ˆå¤šå°ä¼™ä¼´å®¹æ˜“æ··æ·†ã€‚å°±åƒå®¶é‡Œçš„å†°ç®±ä¸€æ ·ï¼Œè¿™ä¸¤ä¸ªæœºåˆ¶è™½ç„¶éƒ½æ˜¯åœ¨&quot;æ¸…ç†ä¸œè¥¿&quot;ï¼Œä½†æ˜¯è§¦å‘çš„æ¡ä»¶å’Œæ¸…ç†çš„æ–¹å¼å®Œå…¨ä¸åŒã€‚</p>
<p>ä»Šå¤©å°±è·Ÿå¤§å®¶ç†ä¸€ç†ï¼Œã€Œå†…å­˜æ·˜æ±°ç­–ç•¥ã€å’Œã€Œè¿‡æœŸåˆ é™¤ç­–ç•¥ã€åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/1748940271743.png" alt="1748940271743"></p>
<h2 id="è¿‡æœŸåˆ é™¤ç­–ç•¥">è¿‡æœŸåˆ é™¤ç­–ç•¥</h2>
<p>Redis å¯ä»¥ç»™æ•°æ®è®¾ç½®&quot;ä¿è´¨æœŸ&quot;ï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ï¼Œå°±åƒè¶…å¸‚é‡Œçš„å•†å“éƒ½æœ‰ä¿è´¨æœŸä¸€æ ·ã€‚å½“æ•°æ®è¿‡æœŸåï¼ŒRedis éœ€è¦æœ‰ç›¸åº”çš„æœºåˆ¶æ¥æ¸…ç†è¿™äº›&quot;è¿‡æœŸå•†å“&quot;ï¼Œè¿™å°±æ˜¯è¿‡æœŸé”®å€¼åˆ é™¤ç­–ç•¥çš„ä½œç”¨ã€‚</p>
<h3 id="å¦‚ä½•ç»™æ•°æ®è®¾ç½®-ä¿è´¨æœŸ-ï¼Ÿ">å¦‚ä½•ç»™æ•°æ®è®¾ç½®&quot;ä¿è´¨æœŸ&quot;ï¼Ÿ</h3>
<p>Redis æä¾›äº†å¤šç§æ–¹å¼æ¥ç»™æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±åƒç»™é£Ÿç‰©è´´ä¸Šä¸åŒæ ¼å¼çš„ä¿è´¨æœŸæ ‡ç­¾ä¸€æ ·ã€‚</p>
<p><strong>è®¾ç½®è¿‡æœŸæ—¶é—´çš„å‘½ä»¤ï¼š</strong></p>
<ul>
<li><code>expire &lt;key&gt; &lt;n&gt;</code>ï¼šè®¾ç½®æ•°æ®åœ¨ n ç§’åè¿‡æœŸ
<ul>
<li>ä¾‹å¦‚ï¼š<code>expire milk 86400</code> è¡¨ç¤ºç‰›å¥¶åœ¨ 86400 ç§’ï¼ˆ1å¤©ï¼‰åè¿‡æœŸ</li>
</ul>
</li>
<li><code>pexpire &lt;key&gt; &lt;n&gt;</code>ï¼šè®¾ç½®æ•°æ®åœ¨ n æ¯«ç§’åè¿‡æœŸï¼ˆæ›´ç²¾ç¡®ï¼‰
<ul>
<li>ä¾‹å¦‚ï¼š<code>pexpire bread 3600000</code> è¡¨ç¤ºé¢åŒ…åœ¨ 3600000 æ¯«ç§’ï¼ˆ1å°æ—¶ï¼‰åè¿‡æœŸ</li>
</ul>
</li>
<li><code>expireat &lt;key&gt; &lt;n&gt;</code>ï¼šè®¾ç½®æ•°æ®åœ¨æŸä¸ªå…·ä½“æ—¶é—´ç‚¹è¿‡æœŸ
<ul>
<li>ä¾‹å¦‚ï¼š<code>expireat fruit 1655654400</code> è¡¨ç¤ºæ°´æœåœ¨æ—¶é—´æˆ³ 1655654400 åè¿‡æœŸ</li>
</ul>
</li>
<li><code>pexpireat &lt;key&gt; &lt;n&gt;</code>ï¼šè®¾ç½®æ•°æ®åœ¨æŸä¸ªå…·ä½“æ—¶é—´ç‚¹è¿‡æœŸï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>åœ¨å­˜å‚¨æ•°æ®æ—¶åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼š</strong></p>
<ul>
<li><code>set &lt;key&gt; &lt;value&gt; ex &lt;n&gt;</code>ï¼šå­˜æ•°æ®çš„åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</li>
<li><code>set &lt;key&gt; &lt;value&gt; px &lt;n&gt;</code>ï¼šå­˜æ•°æ®çš„åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</li>
<li><code>setex &lt;key&gt; &lt;n&gt; &lt;value&gt;</code>ï¼šå­˜æ•°æ®çš„åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</li>
</ul>
<p><strong>æŸ¥çœ‹å‰©ä½™&quot;ä¿è´¨æœŸ&quot;ï¼š</strong></p>
<p>ä½¿ç”¨ <code>TTL &lt;key&gt;</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ•°æ®è¿˜æœ‰å¤šé•¿æ—¶é—´è¿‡æœŸï¼Œå°±åƒæŸ¥çœ‹é£Ÿç‰©è¿˜èƒ½æ”¾å¤šä¹…ä¸€æ ·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­˜å‚¨ç‰›å¥¶ï¼Œè®¾ç½®60ç§’åè¿‡æœŸ</span></span><br><span class="line">&gt; setex milk 60 <span class="string">&quot;fresh_milk&quot;</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰›å¥¶è¿˜èƒ½æ”¾å¤šä¹…</span></span><br><span class="line">&gt; ttl milk</span><br><span class="line">(<span class="built_in">integer</span>) 56</span><br><span class="line">&gt; ttl milk</span><br><span class="line">(<span class="built_in">integer</span>) 52</span><br></pre></td></tr></table></figure>
<p><strong>å–æ¶ˆè¿‡æœŸæ—¶é—´ï¼š</strong></p>
<p>å¦‚æœçªç„¶ä¸æƒ³è®©æ•°æ®è¿‡æœŸäº†ï¼Œå¯ä»¥ä½¿ç”¨ <code>PERSIST &lt;key&gt;</code> å‘½ä»¤ï¼Œå°±åƒæŠŠé£Ÿç‰©æ”¾è¿›å†·å†»å®¤æ°¸ä¹…ä¿å­˜ä¸€æ ·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å–æ¶ˆç‰›å¥¶çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">&gt; persist milk</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç»“æœï¼Œ-1 è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ</span></span><br><span class="line">&gt; ttl milk </span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br></pre></td></tr></table></figure>
<h3 id="Redis-æ€ä¹ˆçŸ¥é“æ•°æ®å·²ç»-è¿‡æœŸ-äº†ï¼Ÿ">Redis æ€ä¹ˆçŸ¥é“æ•°æ®å·²ç»&quot;è¿‡æœŸ&quot;äº†ï¼Ÿ</h3>
<p>æ¯å½“æˆ‘ä»¬ç»™æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼ŒRedis å°±ä¼šæŠŠè¿™ä¸ªä¿¡æ¯è®°å½•åœ¨ä¸€ä¸ªå«åš**â€œè¿‡æœŸå­—å…¸â€**çš„åœ°æ–¹ï¼Œå°±åƒè¶…å¸‚çš„ç®¡ç†ç³»ç»Ÿè®°å½•æ¯ä¸ªå•†å“çš„ä¿è´¨æœŸä¸€æ ·ã€‚</p>
<p>è¿™ä¸ªè¿‡æœŸå­—å…¸çš„ç»“æ„å¾ˆç®€å•ï¼š</p>
<ul>
<li><strong>å­—å…¸çš„ key</strong>ï¼šæŒ‡å‘å…·ä½“çš„æ•°æ®</li>
<li><strong>å­—å…¸çš„ value</strong>ï¼šè®°å½•è¿™ä¸ªæ•°æ®ä»€ä¹ˆæ—¶å€™è¿‡æœŸ</li>
</ul>
<p>è¿‡æœŸå­—å…¸çš„æ•°æ®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/1748940284285.png" alt="1748940284285"></p>
<p><strong>åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„æµç¨‹ï¼š</strong></p>
<p>å½“æˆ‘ä»¬è¦ä½¿ç”¨æŸä¸ªæ•°æ®æ—¶ï¼ŒRedis ä¼šå…ˆæ£€æŸ¥è¿™ä¸ªæ•°æ®æ˜¯å¦åœ¨&quot;è¿‡æœŸå­—å…¸&quot;ä¸­ï¼š</p>
<ul>
<li>å¦‚æœä¸åœ¨ï¼šè¯´æ˜è¿™ä¸ªæ•°æ®æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨</li>
<li>å¦‚æœåœ¨ï¼šå°±æ‹¿å‡ºè¿‡æœŸæ—¶é—´å’Œå½“å‰æ—¶é—´æ¯”è¾ƒ
<ul>
<li>å¦‚æœè¿˜æ²¡åˆ°è¿‡æœŸæ—¶é—´ï¼šå¯ä»¥æ­£å¸¸ä½¿ç”¨</li>
<li>å¦‚æœå·²ç»è¿‡æœŸï¼šè¿™ä¸ªæ•°æ®å°±ä¸èƒ½ç”¨äº†</li>
</ul>
</li>
</ul>
<p>è¿™ä¸ªåˆ¤æ–­æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/1748940292820.png" alt="1748940292820"></p>
<h3 id="è¿‡æœŸæ•°æ®çš„æ¸…ç†æ–¹å¼æœ‰å“ªäº›ï¼Ÿ">è¿‡æœŸæ•°æ®çš„æ¸…ç†æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h3>
<p>å°±åƒå¤„ç†è¿‡æœŸé£Ÿç‰©ä¸€æ ·ï¼Œæˆ‘ä»¬æœ‰ä¸åŒçš„æ¸…ç†ç­–ç•¥ã€‚è®©æˆ‘ä»¬ç”¨ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥ç†è§£è¿™ä¸‰ç§ç­–ç•¥ï¼š</p>
<blockquote>
<p><strong>å®šæ—¶åˆ é™¤ç­–ç•¥</strong>ï¼šè®¾ç½®é—¹é’Ÿæé†’</p>
</blockquote>
<p><strong>å·¥ä½œæ–¹å¼</strong>ï¼šç»™æ¯ä¸ªæ•°æ®è®¾ç½®ä¸€ä¸ª&quot;é—¹é’Ÿ&quot;ï¼Œæ—¶é—´ä¸€åˆ°å°±ç«‹å³åˆ é™¤ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>è¿‡æœŸæ•°æ®èƒ½ç«‹å³è¢«æ¸…ç†ï¼Œå†…å­˜åˆ©ç”¨ç‡æœ€é«˜</li>
<li>å°±åƒè®¾ç½®é—¹é’Ÿæé†’æ‰”åƒåœ¾ï¼Œåƒåœ¾ä¸ä¼šå †ç§¯</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å¦‚æœè¿‡æœŸæ•°æ®å¾ˆå¤šï¼Œå°±éœ€è¦å¾ˆå¤š&quot;é—¹é’Ÿ&quot;ï¼Œä¼šæ¶ˆè€—å¤§é‡ CPU èµ„æº</li>
<li>å°±åƒåŒæ—¶è®¾ç½®100ä¸ªé—¹é’Ÿï¼Œä¼šè®©ä½ å¿™å¾—å›¢å›¢è½¬</li>
</ul>
<blockquote>
<p><strong>æƒ°æ€§åˆ é™¤ç­–ç•¥</strong>ï¼šç”¨æ—¶å†æ£€æŸ¥</p>
</blockquote>
<p><strong>å·¥ä½œæ–¹å¼</strong>ï¼šä¸ä¸»åŠ¨æ¸…ç†è¿‡æœŸæ•°æ®ï¼Œåªæœ‰åœ¨è¦ä½¿ç”¨æŸä¸ªæ•°æ®æ—¶ï¼Œæ‰æ£€æŸ¥å®ƒæ˜¯å¦è¿‡æœŸã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å¾ˆçœ CPU èµ„æºï¼Œå› ä¸ºåªåœ¨éœ€è¦æ—¶æ‰æ£€æŸ¥</li>
<li>å°±åƒå†°ç®±é‡Œçš„é£Ÿç‰©ï¼Œåªæœ‰åœ¨è¦åƒçš„æ—¶å€™æ‰æ£€æŸ¥æ˜¯å¦è¿‡æœŸ</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å¦‚æœæŸä¸ªè¿‡æœŸæ•°æ®ä¸€ç›´æ²¡äººç”¨ï¼Œå®ƒå°±ä¼šä¸€ç›´å ç”¨å†…å­˜ç©ºé—´</li>
<li>å°±åƒå†°ç®±é‡Œæ”¾äº†å¾ˆä¹…çš„è¿‡æœŸé£Ÿç‰©ï¼Œå¦‚æœä¸å»çœ‹å°±ä¸ä¼šæ¸…ç†</li>
</ul>
<blockquote>
<p><strong>å®šæœŸåˆ é™¤ç­–ç•¥</strong>ï¼šå®šæœŸå¤§æ‰«é™¤</p>
</blockquote>
<p><strong>å·¥ä½œæ–¹å¼</strong>ï¼šæ¯éš”ä¸€æ®µæ—¶é—´éšæœºæ£€æŸ¥ä¸€æ‰¹æ•°æ®ï¼Œåˆ é™¤å…¶ä¸­è¿‡æœŸçš„ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>åœ¨ CPU æ¶ˆè€—å’Œå†…å­˜åˆ©ç”¨ä¹‹é—´æ‰¾åˆ°äº†å¹³è¡¡</li>
<li>å°±åƒå®šæœŸæ•´ç†å†°ç®±ï¼Œæ—¢ä¸ä¼šå¤ªç´¯ï¼Œä¹Ÿä¸ä¼šè®©è¿‡æœŸé£Ÿç‰©å †ç§¯å¤ªå¤š</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>æ¸…ç†æ•ˆæœä¸å¦‚å®šæ—¶åˆ é™¤å½»åº•</li>
<li>èµ„æºæ¶ˆè€—æ¯”æƒ°æ€§åˆ é™¤å¤šä¸€äº›</li>
<li>å¾ˆéš¾ç¡®å®šå¤šä¹…æ£€æŸ¥ä¸€æ¬¡æœ€åˆé€‚</li>
</ul>
<h3 id="Redis-é€‰æ‹©äº†å“ªç§ç­–ç•¥ï¼Ÿ">Redis é€‰æ‹©äº†å“ªç§ç­–ç•¥ï¼Ÿ</h3>
<p>Redis å¾ˆèªæ˜ï¼Œå®ƒæ²¡æœ‰åªç”¨ä¸€ç§ç­–ç•¥ï¼Œè€Œæ˜¯é€‰æ‹©äº†**â€œæƒ°æ€§åˆ é™¤ + å®šæœŸåˆ é™¤â€**çš„ç»„åˆï¼Œå°±åƒæˆ‘ä»¬æ—¢ä¼šåœ¨ç”¨é£Ÿç‰©å‰æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œä¹Ÿä¼šå®šæœŸæ•´ç†å†°ç®±ä¸€æ ·ã€‚</p>
<blockquote>
<p><strong>Redis çš„æƒ°æ€§åˆ é™¤å®ç°</strong></p>
</blockquote>
<p>Redis åœ¨æ¯æ¬¡è®¿é—®æ•°æ®ä¹‹å‰ï¼Œéƒ½ä¼šå…ˆæ£€æŸ¥è¿™ä¸ªæ•°æ®æ˜¯å¦è¿‡æœŸï¼š</p>
<ul>
<li>å¦‚æœè¿‡æœŸäº†ï¼šåˆ é™¤è¿™ä¸ªæ•°æ®ï¼Œè¿”å›ç©ºå€¼ç»™ç”¨æˆ·</li>
<li>å¦‚æœæ²¡è¿‡æœŸï¼šæ­£å¸¸è¿”å›æ•°æ®</li>
</ul>
<p>è¿™ä¸ªæ£€æŸ¥æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/1748940304775.png" alt="1748940304775"></p>
<blockquote>
<p><strong>Redis çš„å®šæœŸåˆ é™¤å®ç°</strong></p>
</blockquote>
<p><strong>æ£€æŸ¥é¢‘ç‡</strong>ï¼šRedis é»˜è®¤æ¯ç§’è¿›è¡Œ 10 æ¬¡è¿‡æœŸæ£€æŸ¥ï¼Œè¿™ä¸ªé¢‘ç‡å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´ï¼ˆå‚æ•°åï¼šhzï¼Œé»˜è®¤å€¼æ˜¯ 10ï¼‰ã€‚</p>
<p><strong>æ£€æŸ¥æµç¨‹</strong>ï¼š</p>
<ol>
<li>éšæœºé€‰æ‹© 20 ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®</li>
<li>æ£€æŸ¥è¿™ 20 ä¸ªæ•°æ®æ˜¯å¦è¿‡æœŸï¼Œåˆ é™¤å·²è¿‡æœŸçš„</li>
<li>å¦‚æœè¿‡æœŸæ•°æ®è¶…è¿‡ 5 ä¸ªï¼ˆå³è¶…è¿‡ 25%ï¼‰ï¼Œç»§ç»­é‡å¤æ­¥éª¤ 1</li>
<li>å¦‚æœè¿‡æœŸæ•°æ®å°‘äº 25%ï¼Œç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥</li>
</ol>
<p><strong>æ—¶é—´é™åˆ¶</strong>ï¼šä¸ºäº†é˜²æ­¢æ£€æŸ¥æ—¶é—´è¿‡é•¿å½±å“æ­£å¸¸æœåŠ¡ï¼Œæ¯æ¬¡æ£€æŸ¥æœ€å¤šä¸è¶…è¿‡ 25 æ¯«ç§’ã€‚</p>
<p>ç”¨ä¼ªä»£ç æè¿°è¿™ä¸ªæµç¨‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">//ç»Ÿè®¡è¿‡æœŸçš„æ•°é‡</span></span><br><span class="line">    expired = <span class="number">0</span>ï¼›</span><br><span class="line">    <span class="comment">//æ¯æ¬¡æ£€æŸ¥20ä¸ª</span></span><br><span class="line">    num = <span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (num--) &#123;</span><br><span class="line">        <span class="comment">//1. éšæœºé€‰æ‹©1ä¸ªæœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®</span></span><br><span class="line">        <span class="comment">//2. æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤ï¼Œexpired++</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœæ£€æŸ¥æ—¶é—´è¶…è¿‡é™åˆ¶ï¼Œç«‹å³é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (æ—¶é—´è¶…è¿‡<span class="number">25</span>æ¯«ç§’) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å¦‚æœè¿‡æœŸæ•°æ®è¶…è¿‡25%ï¼Œç»§ç»­æ£€æŸ¥ï¼Œå¦åˆ™ç»“æŸæœ¬è½® */</span></span><br><span class="line">&#125; <span class="keyword">while</span> (expired &gt; <span class="number">20</span>/<span class="number">4</span>); </span><br></pre></td></tr></table></figure>
<p>å®šæœŸåˆ é™¤çš„å®Œæ•´æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/1748940315515.png" alt="1748940315515"></p>
<h2 id="å†…å­˜æ·˜æ±°ç­–ç•¥">å†…å­˜æ·˜æ±°ç­–ç•¥</h2>
<p>å¦‚æœè¯´è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯æ¸…ç†&quot;è¿‡æœŸé£Ÿç‰©&quot;ï¼Œé‚£ä¹ˆå†…å­˜æ·˜æ±°ç­–ç•¥å°±æ˜¯å½“&quot;å†°ç®±æ»¡äº†&quot;æ—¶å†³å®šæ‰”æ‰ä»€ä¹ˆä¸œè¥¿ã€‚</p>
<p>å½“ Redis ä½¿ç”¨çš„å†…å­˜è¶…è¿‡äº†æˆ‘ä»¬è®¾ç½®çš„ä¸Šé™æ—¶ï¼Œå°±ä¼šå¯åŠ¨å†…å­˜æ·˜æ±°ç­–ç•¥æ¥åˆ é™¤ä¸€äº›æ•°æ®ï¼Œç¡®ä¿ Redis èƒ½ç»§ç»­æ­£å¸¸å·¥ä½œã€‚</p>
<h3 id="å¦‚ä½•è®¾ç½®-Redis-çš„-å†°ç®±å¤§å°-ï¼Ÿ">å¦‚ä½•è®¾ç½® Redis çš„&quot;å†°ç®±å¤§å°&quot;ï¼Ÿ</h3>
<p>åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>maxmemory</code> å‚æ•°è®¾ç½®æœ€å¤§å†…å­˜é™åˆ¶ï¼š</p>
<p><strong>ä¸åŒç³»ç»Ÿçš„é»˜è®¤è®¾ç½®ï¼š</strong></p>
<ul>
<li><strong>64ä½ç³»ç»Ÿ</strong>ï¼šé»˜è®¤æ²¡æœ‰é™åˆ¶ï¼ˆmaxmemory = 0ï¼‰ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜ç”¨å®Œç³»ç»Ÿå´©æºƒ</li>
<li><strong>32ä½ç³»ç»Ÿ</strong>ï¼šé»˜è®¤é™åˆ¶ä¸º 3GBï¼Œå› ä¸º32ä½ç³»ç»Ÿæœ€å¤šåªèƒ½ä½¿ç”¨ 4GB å†…å­˜</li>
</ul>
<h3 id="Redis-çš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ">Redis çš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3>
<p>Redis æä¾›äº† 8 ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<p><strong>ç¬¬ä¸€ç±»ï¼šä¸æ·˜æ±°æ•°æ®</strong></p>
<p><strong>noeviction</strong>ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰ï¼š</p>
<ul>
<li>å½“å†…å­˜æ»¡äº†ï¼Œä¸åˆ é™¤ä»»ä½•æ•°æ®</li>
<li>æ–°çš„å†™å…¥æ“ä½œä¼šæŠ¥é”™ï¼Œä½†æŸ¥è¯¢å’Œåˆ é™¤æ“ä½œæ­£å¸¸</li>
<li>å°±åƒå†°ç®±æ»¡äº†å°±ä¸å†æ”¾æ–°ä¸œè¥¿ï¼Œä½†å¯ä»¥ç»§ç»­ä½¿ç”¨å·²æœ‰çš„</li>
</ul>
<p><strong>ç¬¬äºŒç±»ï¼šæ·˜æ±°æ•°æ®</strong></p>
<p>è¿™ç±»ç­–ç•¥åˆåˆ†ä¸ºä¸¤ä¸ªå­ç±»ï¼š</p>
<p><strong>åœ¨æœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­é€‰æ‹©ï¼š</strong></p>
<ul>
<li><strong>volatile-random</strong>ï¼šéšæœºåˆ é™¤æœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®</li>
<li><strong>volatile-ttl</strong>ï¼šä¼˜å…ˆåˆ é™¤å¿«è¦è¿‡æœŸçš„æ•°æ®</li>
<li><strong>volatile-lru</strong>ï¼šåˆ é™¤æœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­ï¼Œæœ€ä¹…æ²¡ç”¨è¿‡çš„</li>
<li><strong>volatile-lfu</strong>ï¼šåˆ é™¤æœ‰è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­ï¼Œä½¿ç”¨é¢‘ç‡æœ€ä½çš„</li>
</ul>
<p><strong>åœ¨æ‰€æœ‰æ•°æ®ä¸­é€‰æ‹©ï¼š</strong></p>
<ul>
<li><strong>allkeys-random</strong>ï¼šéšæœºåˆ é™¤ä»»æ„æ•°æ®</li>
<li><strong>allkeys-lru</strong>ï¼šåˆ é™¤æ‰€æœ‰æ•°æ®ä¸­æœ€ä¹…æ²¡ç”¨è¿‡çš„</li>
<li><strong>allkeys-lfu</strong>ï¼šåˆ é™¤æ‰€æœ‰æ•°æ®ä¸­ä½¿ç”¨é¢‘ç‡æœ€ä½çš„</li>
</ul>
<blockquote>
<p><strong>æŸ¥çœ‹å½“å‰ç­–ç•¥</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get maxmemory-policy</span><br><span class="line">1) <span class="string">&quot;maxmemory-policy&quot;</span></span><br><span class="line">2) <span class="string">&quot;noeviction&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>ä¿®æ”¹ç­–ç•¥</strong></p>
</blockquote>
<p>æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li><strong>ä¸´æ—¶ä¿®æ”¹</strong>ï¼š<code>config set maxmemory-policy allkeys-lru</code>ï¼ˆé‡å¯åå¤±æ•ˆï¼‰</li>
<li><strong>æ°¸ä¹…ä¿®æ”¹</strong>ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® <code>maxmemory-policy allkeys-lru</code>ï¼ˆéœ€è¦é‡å¯ï¼‰</li>
</ol>
<h3 id="LRU-å’Œ-LFU-ç®—æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">LRU å’Œ LFU ç®—æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p>è¿™ä¸¤ä¸ªç®—æ³•æ˜¯å†…å­˜æ·˜æ±°çš„æ ¸å¿ƒï¼Œè®©æˆ‘ä»¬ç”¨ç”Ÿæ´»ä¾‹å­æ¥ç†è§£ï¼š</p>
<blockquote>
<p><strong>LRU ç®—æ³•ï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨</strong></p>
</blockquote>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæœ€è¿‘ç”¨è¿‡çš„ä¸œè¥¿å°†æ¥å¯èƒ½è¿˜ä¼šç”¨ï¼Œå¾ˆä¹…æ²¡ç”¨çš„ä¸œè¥¿å¯ä»¥æ‰”æ‰ã€‚</p>
<p><strong>ç”Ÿæ´»ä¾‹å­</strong>ï¼š</p>
<ul>
<li>å°±åƒæ•´ç†è¡£æŸœï¼ŒæŠŠæœ€è¿‘ç©¿è¿‡çš„è¡£æœæ”¾åœ¨å®¹æ˜“æ‹¿åˆ°çš„åœ°æ–¹</li>
<li>æŠŠå¾ˆä¹…æ²¡ç©¿çš„è¡£æœæ”¾åœ¨æœ€é‡Œé¢ï¼Œè¡£æŸœæ»¡äº†å°±å…ˆæ‰”æ‰æœ€é‡Œé¢çš„</li>
</ul>
<p><strong>Redis çš„å®ç°æ–¹å¼</strong>ï¼š</p>
<ul>
<li>ä¸ä½¿ç”¨ä¼ ç»Ÿçš„é“¾è¡¨ï¼ˆå¤ªè€—èµ„æºï¼‰</li>
<li>è€Œæ˜¯è®°å½•æ¯ä¸ªæ•°æ®çš„æœ€åè®¿é—®æ—¶é—´</li>
<li>å†…å­˜ä¸å¤Ÿæ—¶ï¼Œéšæœºå–5ä¸ªæ•°æ®ï¼Œåˆ é™¤å…¶ä¸­æœ€ä¹…æ²¡ç”¨è¿‡çš„</li>
</ul>
<p><strong>LRU çš„é—®é¢˜</strong>ï¼š<br>
å‡å¦‚ä½ ä¸€æ¬¡æ€§çœ‹äº†å¾ˆå¤šç”µå½±ï¼Œè¿™äº›ç”µå½±å¯èƒ½ä»¥åå†ä¹Ÿä¸ä¼šçœ‹ï¼Œä½†å®ƒä»¬ä¼šåœ¨&quot;æœ€è¿‘ä½¿ç”¨&quot;åˆ—è¡¨çš„å‰é¢å¾ˆä¹…ï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜æ±¡æŸ“</strong>ã€‚</p>
<blockquote>
<p><strong>LFU ç®—æ³•ï¼šæœ€å°‘é¢‘ç‡ä½¿ç”¨</strong></p>
</blockquote>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç»å¸¸ç”¨çš„ä¸œè¥¿å°†æ¥è¿˜ä¼šç»å¸¸ç”¨ï¼Œå¾ˆå°‘ç”¨çš„ä¸œè¥¿å¯ä»¥æ‰”æ‰ã€‚</p>
<p><strong>ç”Ÿæ´»ä¾‹å­</strong>ï¼š</p>
<ul>
<li>å°±åƒæ•´ç†å¨æˆ¿ï¼Œç»å¸¸ç”¨çš„é”…ç¢—ç“¢ç›†æ”¾åœ¨æ–¹ä¾¿çš„åœ°æ–¹</li>
<li>å¾ˆå°‘ç”¨çš„å·¥å…·å¯ä»¥æ”¶èµ·æ¥æˆ–æ‰”æ‰</li>
<li>ä¸æ˜¯çœ‹æœ€è¿‘ç”¨æ²¡ç”¨ï¼Œè€Œæ˜¯çœ‹ç”¨çš„é¢‘ç‡é«˜ä¸é«˜</li>
</ul>
<p><strong>Redis çš„å®ç°æ–¹å¼</strong>ï¼š<br>
Redis ä¸ºæ¯ä¸ªæ•°æ®è®°å½•ä¸¤ä¸ªä¿¡æ¯ï¼š</p>
<ul>
<li><strong>è®¿é—®æ—¶é—´</strong>ï¼šæœ€åä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´</li>
<li><strong>è®¿é—®é¢‘ç‡</strong>ï¼šä½¿ç”¨çš„é¢‘ç¹ç¨‹åº¦ï¼ˆä¸æ˜¯ç®€å•çš„æ¬¡æ•°ï¼‰</li>
</ul>
<p><strong>é¢‘ç‡çš„è®¡ç®—å¾ˆå·§å¦™</strong>ï¼š</p>
<ol>
<li><strong>è¡°å‡</strong>ï¼šæ—¶é—´è¶Šä¹…ï¼Œé¢‘ç‡ä¼šè‡ªåŠ¨é™ä½</li>
<li><strong>å¢é•¿</strong>ï¼šæ¯æ¬¡è®¿é—®ä¼šå¢åŠ é¢‘ç‡ï¼Œä½†å·²ç»å¾ˆé«˜çš„é¢‘ç‡å¢é•¿ä¼šå¾ˆæ…¢</li>
</ol>
<p>è¿™æ ·è®¾è®¡çš„å¥½å¤„ï¼š</p>
<ul>
<li>è§£å†³äº† LRU çš„ç¼“å­˜æ±¡æŸ“é—®é¢˜</li>
<li>ä¸€æ¬¡æ€§è®¿é—®å¤§é‡æ•°æ®ä¸ä¼šå½±å“çœŸæ­£å¸¸ç”¨çš„æ•°æ®</li>
</ul>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/1748940330817.png" alt="1748940330817"></p>
<p><strong>å¯ä»¥è°ƒæ•´çš„å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>lfu-decay-time</code>ï¼šæ§åˆ¶é¢‘ç‡è¡°å‡é€Ÿåº¦ï¼ˆå€¼è¶Šå¤§è¡°å‡è¶Šæ…¢ï¼‰</li>
<li><code>lfu-log-factor</code>ï¼šæ§åˆ¶é¢‘ç‡å¢é•¿é€Ÿåº¦ï¼ˆå€¼è¶Šå¤§å¢é•¿è¶Šæ…¢ï¼‰</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå®Œæ•´çš„æ¯”å–»æ¥æ€»ç»“è¿™ä¸¤ä¸ªæœºåˆ¶ï¼š</p>
<p><strong>è¿‡æœŸåˆ é™¤ç­–ç•¥</strong>å°±åƒç®¡ç†å†°ç®±é‡Œçš„é£Ÿç‰©ï¼š</p>
<ul>
<li>ç»™é£Ÿç‰©è´´ä¸Šä¿è´¨æœŸæ ‡ç­¾ï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰</li>
<li>ç”¨çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼ˆæƒ°æ€§åˆ é™¤ï¼‰</li>
<li>å®šæœŸæ•´ç†å†°ç®±æ¸…ç†è¿‡æœŸé£Ÿç‰©ï¼ˆå®šæœŸåˆ é™¤ï¼‰</li>
</ul>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/1748940345098.png" alt="1748940345098"></p>
<p><strong>å†…å­˜æ·˜æ±°ç­–ç•¥</strong>å°±åƒå†°ç®±æ»¡äº†æ—¶çš„å¤„ç†æ–¹å¼ï¼š</p>
<ul>
<li>è®¾ç½®å†°ç®±çš„å®¹é‡ä¸Šé™</li>
<li>æ ¹æ®ä¸åŒç­–ç•¥å†³å®šæ‰”æ‰ä»€ä¹ˆä¸œè¥¿</li>
</ul>
<p><img src="/2025/06/03/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0/1748940352217.png" alt="1748940352217"></p>
<p><strong>ä¸¤è€…çš„åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>è§¦å‘æ¡ä»¶ä¸åŒ</strong>ï¼šè¿‡æœŸåˆ é™¤æ˜¯å› ä¸ºæ•°æ®è¿‡æœŸäº†ï¼Œå†…å­˜æ·˜æ±°æ˜¯å› ä¸ºç©ºé—´ä¸å¤Ÿäº†</li>
<li><strong>å¤„ç†å¯¹è±¡ä¸åŒ</strong>ï¼šè¿‡æœŸåˆ é™¤åªå¤„ç†è¿‡æœŸæ•°æ®ï¼Œå†…å­˜æ·˜æ±°å¯èƒ½åˆ é™¤ä»»ä½•æ•°æ®</li>
<li><strong>ç›®çš„ä¸åŒ</strong>ï¼šè¿‡æœŸåˆ é™¤æ˜¯ä¸ºäº†æ•°æ®æ—¶æ•ˆæ€§ï¼Œå†…å­˜æ·˜æ±°æ˜¯ä¸ºäº†ç©ºé—´ç®¡ç†</li>
</ul>
<p>è®°ä½è¿™ä¸ªæ ¸å¿ƒåŒºåˆ«ï¼Œå°±ä¸ä¼šå†ææ··äº†ï¼</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>å†…å­˜ç®¡ç†</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>è¿‡æœŸåˆ é™¤</tag>
        <tag>å†…å­˜æ·˜æ±°</tag>
        <tag>LRU</tag>
        <tag>LFU</tag>
        <tag>ç¼“å­˜ç­–ç•¥</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 76 - æœ€å°è¦†ç›–å­ä¸²ï¼ˆMinimum Window Substringï¼‰</title>
    <url>/2025/06/03/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-76-%E6%9C%80%E5%B0%8F%E8%A6%86%E7%9B%96%E5%AD%90%E4%B8%B2-%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ã€ä¸€ä¸ªå­—ç¬¦ä¸² <code>t</code> ã€‚è¿”å› <code>s</code> ä¸­æ¶µç›– <code>t</code> æ‰€æœ‰å­—ç¬¦çš„æœ€å°å­ä¸²ã€‚å¦‚æœ <code>s</code> ä¸­ä¸å­˜åœ¨æ¶µç›– <code>t</code> æ‰€æœ‰å­—ç¬¦çš„å­ä¸²ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² <code>&quot;&quot;</code> ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>å¯¹äº <code>t</code> ä¸­é‡å¤å­—ç¬¦ï¼Œæˆ‘ä»¬å¯»æ‰¾çš„å­å­—ç¬¦ä¸²ä¸­è¯¥å­—ç¬¦æ•°é‡å¿…é¡»ä¸å°‘äº <code>t</code> ä¸­è¯¥å­—ç¬¦æ•°é‡ã€‚</li>
<li>å¦‚æœ <code>s</code> ä¸­å­˜åœ¨è¿™æ ·çš„å­ä¸²ï¼Œæˆ‘ä»¬ä¿è¯å®ƒæ˜¯å”¯ä¸€çš„ç­”æ¡ˆã€‚</li>
</ul>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;ADOBECODEBANC&quot;, t = &quot;ABC&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;BANC&quot;</span><br><span class="line">è§£é‡Šï¼šæœ€å°è¦†ç›–å­ä¸² &quot;BANC&quot; åŒ…å«æ¥è‡ªå­—ç¬¦ä¸² t çš„ &#x27;A&#x27;ã€&#x27;B&#x27; å’Œ &#x27;C&#x27;ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;a&quot;, t = &quot;a&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;a&quot;</span><br><span class="line">è§£é‡Šï¼šæ•´ä¸ªå­—ç¬¦ä¸² s æ˜¯æœ€å°è¦†ç›–å­ä¸²ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;a&quot;, t = &quot;aa&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;&quot;</span><br><span class="line">è§£é‡Šï¼št ä¸­ä¸¤ä¸ªå­—ç¬¦ &#x27;a&#x27; å‡åº”åŒ…å«åœ¨ s çš„å­ä¸²ä¸­ï¼Œ</span><br><span class="line">å› æ­¤æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­ä¸²ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>m == s.length</code></li>
<li><code>n == t.length</code></li>
<li><code>1 &lt;= m, n &lt;= 10^5</code></li>
<li><code>s</code> å’Œ <code>t</code> ç”±è‹±æ–‡å­—æ¯ç»„æˆ</li>
</ul>
<h2 id="é”™è¯¯åˆ†æ">é”™è¯¯åˆ†æ</h2>
<p>åœ¨åˆå§‹å®ç°ä¸­ï¼Œå­˜åœ¨å‡ ä¸ªå…³é”®çš„é€»è¾‘é”™è¯¯ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹<strong>é”™è¯¯çš„ä»£ç </strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç‰ˆæœ¬çš„å…³é”®éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">for</span> right &lt; <span class="built_in">len</span>(s) &#123;</span><br><span class="line">    rightAlpha := s[right]</span><br><span class="line">    right++</span><br><span class="line">    windowMap[rightAlpha]++</span><br><span class="line">    <span class="keyword">if</span> windowMap[rightAlpha] &lt;= alphaCnt[rightAlpha] &#123;</span><br><span class="line">        alphaNumCnt++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯çš„æ”¶ç¼©é€»è¾‘</span></span><br><span class="line">    <span class="keyword">for</span> windowMap[rightAlpha] &gt; alphaCnt[rightAlpha] &#123;</span><br><span class="line">        leftAlpha := s[left]</span><br><span class="line">        <span class="keyword">if</span> windowMap[leftAlpha] &lt;= alphaCnt[leftAlpha] &#123;</span><br><span class="line">            alphaNumCnt--</span><br><span class="line">        &#125;</span><br><span class="line">        windowMap[leftAlpha]--</span><br><span class="line">        left++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯çš„æœ‰æ•ˆçª—å£æ£€æŸ¥ä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> alphaNumCnt == <span class="built_in">len</span>(t) &#123;</span><br><span class="line">        <span class="keyword">if</span> right-left &lt; minLength &#123;</span><br><span class="line">            minLength = right - left</span><br><span class="line">            minStart = left</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸»è¦é”™è¯¯ç‚¹">ä¸»è¦é”™è¯¯ç‚¹</h3>
<ol>
<li><strong>é”™è¯¯çš„æ”¶ç¼©æ—¶æœº</strong>ï¼šåŸä»£ç åœ¨åˆšæ·»åŠ å­—ç¬¦åç«‹å³å°è¯•æ”¶ç¼©çª—å£ï¼Œè¿™ä¼šå¯¼è‡´è¿‡æ—©åœ°ç§»é™¤å¿…è¦çš„å­—ç¬¦</li>
<li><strong>é”™è¯¯çš„æ”¶ç¼©æ¡ä»¶</strong>ï¼š<code>windowMap[rightAlpha] &gt; alphaCnt[rightAlpha]</code> åªè€ƒè™‘åˆšæ·»åŠ çš„å­—ç¬¦ï¼Œè€Œä¸æ˜¯æ•´ä¸ªçª—å£çŠ¶æ€</li>
<li><strong>é”™è¯¯çš„æœ‰æ•ˆæ€§æ£€æŸ¥</strong>ï¼šåœ¨æ”¶ç¼©åæ£€æŸ¥çª—å£æœ‰æ•ˆæ€§ï¼Œæ­¤æ—¶çª—å£å¯èƒ½å·²ç»è¢«ç ´å</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆä¼šå‡ºé”™ï¼Ÿ">ä¸ºä»€ä¹ˆä¼šå‡ºé”™ï¼Ÿ</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹ <code>s = &quot;ADOBECODEBANC&quot;</code>, <code>t = &quot;ABC&quot;</code> æ¥åˆ†æï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“å¤„ç†åˆ°ç¬¬ä¸€ä¸ª &#x27;A&#x27; æ—¶ï¼š</span><br><span class="line">- å³æŒ‡é’ˆï¼š0 â†’ 1ï¼Œçª—å£ï¼š&#x27;A&#x27;</span><br><span class="line">- alphaNumCnt = 1</span><br><span class="line">- windowMap[&#x27;A&#x27;] = 1, alphaCnt[&#x27;A&#x27;] = 1</span><br><span class="line">- æ¡ä»¶ windowMap[&#x27;A&#x27;] &gt; alphaCnt[&#x27;A&#x27;] ä¸º falseï¼Œä¸æ”¶ç¼© âœ“</span><br><span class="line"></span><br><span class="line">å½“å¤„ç†åˆ° &#x27;D&#x27;, &#x27;O&#x27;, &#x27;B&#x27; æ—¶ï¼š</span><br><span class="line">- å³æŒ‡é’ˆï¼š1 â†’ 4ï¼Œçª—å£ï¼š&#x27;ADOB&#x27;</span><br><span class="line">- alphaNumCnt = 2 (A, B)</span><br><span class="line">- è¿™é‡Œéƒ½æ˜¯æ­£å¸¸çš„ âœ“</span><br><span class="line"></span><br><span class="line">å½“å¤„ç†åˆ° &#x27;E&#x27; æ—¶ï¼š</span><br><span class="line">- å³æŒ‡é’ˆï¼š4 â†’ 5ï¼Œçª—å£ï¼š&#x27;ADOBE&#x27;</span><br><span class="line">- &#x27;E&#x27; ä¸åœ¨ t ä¸­ï¼ŒalphaCnt[&#x27;E&#x27;] = 0</span><br><span class="line">- âŒ åŸé€»è¾‘ï¼šwindowMap[&#x27;E&#x27;] &gt; alphaCnt[&#x27;E&#x27;] ä¸º true (1 &gt; 0)</span><br><span class="line">- âŒ å¼€å§‹æ”¶ç¼©ï¼Œå¯èƒ½ç§»é™¤ &#x27;A&#x27; æˆ– &#x27;B&#x27;ï¼Œç ´åçª—å£æœ‰æ•ˆæ€§</span><br></pre></td></tr></table></figure>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>æ»‘åŠ¨çª—å£</strong>é—®é¢˜ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼š</p>
<ol>
<li><strong>æ‰©å¼ çª—å£</strong>ï¼šä¸æ–­å‘å³ç§»åŠ¨å³æŒ‡é’ˆï¼Œç›´åˆ°çª—å£åŒ…å« <code>t</code> çš„æ‰€æœ‰å­—ç¬¦</li>
<li><strong>æ”¶ç¼©çª—å£</strong>ï¼šå½“çª—å£æœ‰æ•ˆæ—¶ï¼Œå°è¯•å‘å³ç§»åŠ¨å·¦æŒ‡é’ˆæ¥æœ€å°åŒ–çª—å£</li>
<li><strong>è®°å½•ç­”æ¡ˆ</strong>ï¼šåœ¨æ”¶ç¼©è¿‡ç¨‹ä¸­æ›´æ–°æœ€å°çª—å£</li>
</ol>
<h3 id="ç®—æ³•æµç¨‹">ç®—æ³•æµç¨‹</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹åŒ–ï¼šleft = 0, right = 0</span><br><span class="line">è®°å½• t ä¸­æ¯ä¸ªå­—ç¬¦çš„éœ€æ±‚æ•°é‡</span><br><span class="line">è®°å½•å½“å‰çª—å£ä¸­æ¯ä¸ªå­—ç¬¦çš„æ•°é‡</span><br><span class="line">è®°å½•å·²æ»¡è¶³çš„å­—ç¬¦æ•°é‡</span><br><span class="line"></span><br><span class="line">while right &lt; len(s):</span><br><span class="line">    1. å°† s[right] åŠ å…¥çª—å£</span><br><span class="line">    2. å¦‚æœåŠ å…¥çš„å­—ç¬¦æœ‰åŠ©äºæ»¡è¶³ t çš„éœ€æ±‚ï¼Œæ›´æ–°æ»¡è¶³è®¡æ•°</span><br><span class="line">    3. å½“çª—å£åŒ…å« t çš„æ‰€æœ‰å­—ç¬¦æ—¶ï¼š</span><br><span class="line">       a. å°è¯•æ›´æ–°æœ€å°çª—å£è®°å½•</span><br><span class="line">       b. æ”¶ç¼©çª—å£ï¼ˆç§»é™¤ s[left]ï¼‰</span><br><span class="line">       c. å¦‚æœç§»é™¤çš„å­—ç¬¦ç ´åäº†çª—å£æœ‰æ•ˆæ€§ï¼Œåœæ­¢æ”¶ç¼©</span><br><span class="line">    4. right++</span><br></pre></td></tr></table></figure>
<h3 id="å…³é”®æ´å¯Ÿ">å…³é”®æ´å¯Ÿ</h3>
<ul>
<li><strong>ä½•æ—¶æ”¶ç¼©</strong>ï¼šåªæœ‰å½“çª—å£<strong>å·²ç»æœ‰æ•ˆ</strong>æ—¶æ‰æ”¶ç¼©</li>
<li><strong>å¦‚ä½•åˆ¤æ–­æœ‰æ•ˆ</strong>ï¼šå½“ <code>alphaNumCnt == len(t)</code> æ—¶çª—å£æœ‰æ•ˆ</li>
<li><strong>æ”¶ç¼©ç­–ç•¥</strong>ï¼šè´ªå¿ƒåœ°æ”¶ç¼©ï¼Œç›´åˆ°çª—å£ä¸å†æœ‰æ•ˆ</li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minWindow</span><span class="params">(s <span class="type">string</span>, t <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ç»Ÿè®¡ t ä¸­æ¯ä¸ªå­—ç¬¦çš„éœ€æ±‚æ•°é‡</span></span><br><span class="line">    alphaCnt := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">256</span>)</span><br><span class="line">    <span class="keyword">for</span> _, c := <span class="keyword">range</span> t &#123;</span><br><span class="line">        alphaCnt[c]++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åˆå§‹åŒ–å˜é‡</span></span><br><span class="line">    minLength := <span class="built_in">len</span>(s) + <span class="number">1</span>  <span class="comment">// è®¾ä¸ºä¸å¯èƒ½çš„å€¼ï¼Œä¾¿äºåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°ç­”æ¡ˆ</span></span><br><span class="line">    minStart := <span class="number">0</span></span><br><span class="line">    left, right := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    windowMap := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">256</span>)  <span class="comment">// çª—å£ä¸­æ¯ä¸ªå­—ç¬¦çš„æ•°é‡</span></span><br><span class="line">    alphaNumCnt := <span class="number">0</span>  <span class="comment">// å·²æ»¡è¶³çš„ t ä¸­å­—ç¬¦çš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æ»‘åŠ¨çª—å£ä¸»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">for</span> right &lt; <span class="built_in">len</span>(s) &#123;</span><br><span class="line">        <span class="comment">// æ‰©å¼ çª—å£ï¼šåŠ å…¥ s[right]</span></span><br><span class="line">        rightAlpha := s[right]</span><br><span class="line">        right++</span><br><span class="line">        windowMap[rightAlpha]++</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœæ–°åŠ å…¥çš„å­—ç¬¦æœ‰åŠ©äºæ»¡è¶³ t çš„éœ€æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> windowMap[rightAlpha] &lt;= alphaCnt[rightAlpha] &#123;</span><br><span class="line">            alphaNumCnt++</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“çª—å£æœ‰æ•ˆæ—¶ï¼Œå°è¯•æ”¶ç¼©</span></span><br><span class="line">        <span class="keyword">for</span> alphaNumCnt == <span class="built_in">len</span>(t) &#123;</span><br><span class="line">            <span class="comment">// æ›´æ–°æœ€å°çª—å£è®°å½•</span></span><br><span class="line">            <span class="keyword">if</span> right-left &lt; minLength &#123;</span><br><span class="line">                minLength = right - left</span><br><span class="line">                minStart = left</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ”¶ç¼©çª—å£ï¼šç§»é™¤ s[left]</span></span><br><span class="line">            leftAlpha := s[left]</span><br><span class="line">            <span class="keyword">if</span> windowMap[leftAlpha] &lt;= alphaCnt[leftAlpha] &#123;</span><br><span class="line">                alphaNumCnt--  <span class="comment">// ç§»é™¤å…³é”®å­—ç¬¦ï¼Œçª—å£å°†å˜ä¸ºæ— æ•ˆ</span></span><br><span class="line">            &#125;</span><br><span class="line">            windowMap[leftAlpha]--</span><br><span class="line">            left++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> minLength &gt; <span class="built_in">len</span>(s) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>  <span class="comment">// æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçª—å£</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s[minStart : minStart+minLength]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç è§£æ">ä»£ç è§£æ</h3>
<ol>
<li><strong>å­—ç¬¦è®¡æ•°</strong>ï¼šä½¿ç”¨æ•°ç»„ <code>alphaCnt</code> è®°å½• <code>t</code> ä¸­æ¯ä¸ªå­—ç¬¦çš„éœ€æ±‚æ•°é‡</li>
<li><strong>çª—å£çŠ¶æ€</strong>ï¼š<code>windowMap</code> è®°å½•å½“å‰çª—å£ä¸­æ¯ä¸ªå­—ç¬¦çš„æ•°é‡</li>
<li><strong>æœ‰æ•ˆæ€§åˆ¤æ–­</strong>ï¼š<code>alphaNumCnt</code> è®°å½•å·²æ»¡è¶³éœ€æ±‚çš„å­—ç¬¦æ€»æ•°</li>
<li><strong>è¾¹ç•Œå¤„ç†</strong>ï¼š<code>minLength</code> åˆå§‹åŒ–ä¸º <code>len(s) + 1</code>ï¼Œä¾¿äºåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°è§£</li>
</ol>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ <code>s = &quot;ADOBECODEBANC&quot;</code>, <code>t = &quot;ABC&quot;</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">step 1: right=1, window=&quot;A&quot;, alphaNumCnt=1, çª—å£æ— æ•ˆ</span><br><span class="line">step 2: right=2, window=&quot;AD&quot;, alphaNumCnt=1, çª—å£æ— æ•ˆ  </span><br><span class="line">step 3: right=3, window=&quot;ADO&quot;, alphaNumCnt=1, çª—å£æ— æ•ˆ</span><br><span class="line">step 4: right=4, window=&quot;ADOB&quot;, alphaNumCnt=2, çª—å£æ— æ•ˆ</span><br><span class="line">step 5: right=5, window=&quot;ADOBE&quot;, alphaNumCnt=2, çª—å£æ— æ•ˆ</span><br><span class="line">step 6: right=6, window=&quot;ADOBEC&quot;, alphaNumCnt=3, çª—å£æœ‰æ•ˆï¼</span><br><span class="line">        å¼€å§‹æ”¶ç¼©ï¼šleft=0â†’1â†’2â†’3ï¼Œçª—å£=&quot;DOBEC&quot;â†’&quot;OBEC&quot;â†’&quot;BEC&quot;â†’&quot;EC&quot;</span><br><span class="line">        å½“ left=3 æ—¶ï¼Œç§»é™¤ &#x27;B&#x27;ï¼ŒalphaNumCnt=2ï¼Œçª—å£æ— æ•ˆï¼Œåœæ­¢æ”¶ç¼©</span><br><span class="line">        è®°å½•ç­”æ¡ˆï¼šminLength=6, minStart=0</span><br><span class="line">...ç»§ç»­å¤„ç†åç»­å­—ç¬¦...</span><br><span class="line">step 13: right=13, window=&quot;BANC&quot;, alphaNumCnt=3, çª—å£æœ‰æ•ˆï¼</span><br><span class="line">         æ”¶ç¼©åå¾—åˆ°æ›´çŸ­çš„çª—å£ &quot;BANC&quot;ï¼Œæ›´æ–°ç­”æ¡ˆ</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼š-O-s-t">æ—¶é—´å¤æ‚åº¦ï¼š$O(|s| + |t|)$</h3>
<ul>
<li>å³æŒ‡é’ˆ <code>right</code> éå†å­—ç¬¦ä¸² <code>s</code> ä¸€æ¬¡ï¼š$O(|s|)$</li>
<li>å·¦æŒ‡é’ˆ <code>left</code> æœ€å¤šä¹Ÿéå†å­—ç¬¦ä¸² <code>s</code> ä¸€æ¬¡ï¼š$O(|s|)$</li>
<li>ç»Ÿè®¡å­—ç¬¦ä¸² <code>t</code>ï¼š$O(|t|)$</li>
<li>æ€»è®¡ï¼š$O(|s| + |t|)$</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼š-O-1">ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$</h3>
<ul>
<li>ä½¿ç”¨å›ºå®šå¤§å°çš„æ•°ç»„ <code>alphaCnt</code> å’Œ <code>windowMap</code>ï¼š$O(256) = O(1)$</li>
<li>å…¶ä»–å˜é‡éƒ½æ˜¯å¸¸æ•°ç©ºé—´</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>æ»‘åŠ¨çª—å£çš„æ ‡å‡†æ¨¡æ¿</strong>ï¼š</p>
<ul>
<li>æ‰©å¼ çª—å£æ”¶é›†å…ƒç´ </li>
<li>å½“çª—å£æ»¡è¶³æ¡ä»¶æ—¶æ”¶ç¼©çª—å£</li>
<li>åœ¨æ”¶ç¼©è¿‡ç¨‹ä¸­æ›´æ–°ç­”æ¡ˆ</li>
</ul>
</li>
<li>
<p><strong>å¸¸è§é™·é˜±</strong>ï¼š</p>
<ul>
<li>âŒ ä¸è¦åœ¨çª—å£æ— æ•ˆæ—¶å°è¯•æ”¶ç¼©</li>
<li>âŒ ä¸è¦è¿‡æ—©åœ°ç§»é™¤çª—å£ä¸­çš„å­—ç¬¦</li>
<li>âŒ æ³¨æ„å¤„ç†å­—ç¬¦ä¸åœ¨ç›®æ ‡å­—ç¬¦ä¸²ä¸­çš„æƒ…å†µ</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ•°ç»„ä»£æ›¿å“ˆå¸Œè¡¨æé«˜æ•ˆç‡</li>
<li>åˆç†è®¾ç½®è¾¹ç•Œå€¼ä¾¿äºåˆ¤æ–­</li>
</ul>
</li>
<li>
<p><strong>ç›¸å…³é—®é¢˜</strong>ï¼š</p>
<ul>
<li>LeetCode 3: æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</li>
<li>LeetCode 438: æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯</li>
<li>LeetCode 567: å­—ç¬¦ä¸²çš„æ’åˆ—</li>
</ul>
</li>
</ol>
<p>è¿™é“é¢˜æ˜¯æ»‘åŠ¨çª—å£æŠ€å·§çš„ç»å…¸åº”ç”¨ï¼ŒæŒæ¡äº†è¿™ä¸ªæ¨¡æ¿åï¼Œå¾ˆå¤šç±»ä¼¼çš„å­—ç¬¦ä¸²/æ•°ç»„é—®é¢˜éƒ½èƒ½è¿åˆƒè€Œè§£ï¼</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŒæŒ‡é’ˆ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>Hard</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>æ»‘åŠ¨çª—å£</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 30 - ä¸²è”æ‰€æœ‰å•è¯çš„å­ä¸²ï¼ˆSubstring with Concatenation of All Wordsï¼‰</title>
    <url>/2025/06/02/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-30-%E4%B8%B2%E8%81%94%E6%89%80%E6%9C%89%E5%8D%95%E8%AF%8D%E7%9A%84%E5%AD%90%E4%B8%B2/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> å’Œä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ <code>words</code>ã€‚<code>words</code> ä¸­æ‰€æœ‰å­—ç¬¦ä¸²<strong>é•¿åº¦ç›¸åŒ</strong>ã€‚</p>
<p><code>s</code> ä¸­çš„<strong>ä¸²è”å­ä¸²</strong>æ˜¯æŒ‡ä¸€ä¸ªåŒ…å« <code>words</code> ä¸­æ‰€æœ‰å­—ç¬¦ä¸²ä»¥ä»»æ„é¡ºåºæ’åˆ—è¿æ¥èµ·æ¥çš„å­ä¸²ã€‚</p>
<p>è¿”å›æ‰€æœ‰ä¸²è”å­ä¸²åœ¨ <code>s</code> ä¸­çš„å¼€å§‹ç´¢å¼•ã€‚ä½ å¯ä»¥ä»¥<strong>ä»»æ„é¡ºåº</strong>è¿”å›ç­”æ¡ˆã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;barfoothefoobar&quot;, words = [&quot;foo&quot;,&quot;bar&quot;]</span><br><span class="line">è¾“å‡ºï¼š[0,9]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ä»ç´¢å¼• 0 å’Œ 9 å¼€å§‹çš„å­ä¸²åˆ†åˆ«æ˜¯ &quot;barfoo&quot; å’Œ &quot;foobar&quot; ã€‚</span><br><span class="line">è¾“å‡ºçš„é¡ºåºä¸é‡è¦, [9,0] ä¹Ÿæ˜¯æœ‰æ•ˆç­”æ¡ˆã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;wordgoodgoodgoodword&quot;, words = [&quot;word&quot;,&quot;good&quot;,&quot;best&quot;]</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;barfoobar&quot;, words = [&quot;foo&quot;,&quot;bar&quot;]</span><br><span class="line">è¾“å‡ºï¼š[0,3]</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= s.length &lt;= 10^4</code></li>
<li><code>1 &lt;= words.length &lt;= 5000</code></li>
<li><code>1 &lt;= words[i].length &lt;= 30</code></li>
<li><code>words[i]</code> å’Œ <code>s</code> ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæŒ‘æˆ˜åœ¨äº<strong>é«˜æ•ˆåœ°æ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„ä¸²è”å­ä¸²</strong>ã€‚å…³é”®æ´å¯Ÿæ˜¯ï¼š<strong>æ‰€æœ‰å•è¯é•¿åº¦ç›¸åŒ</strong>ï¼Œè¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¼˜åŒ–çš„æœºä¼šã€‚</p>
<h3 id="æœ´ç´ è§£æ³•åˆ†æ">æœ´ç´ è§£æ³•åˆ†æ</h3>
<p>æœ€ç›´è§‚çš„æƒ³æ³•æ˜¯ï¼š</p>
<ol>
<li>éå†å­—ç¬¦ä¸² <code>s</code> çš„æ¯ä¸ªå¯èƒ½èµ·å§‹ä½ç½®</li>
<li>ä»è¯¥ä½ç½®å¼€å§‹ï¼ŒæŒ‰å•è¯é•¿åº¦åˆ‡åˆ†ï¼Œæ£€æŸ¥æ˜¯å¦æ°å¥½åŒ…å«æ‰€æœ‰ <code>words</code></li>
<li>ä½¿ç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡å•è¯é¢‘æ¬¡</li>
</ol>
<p><strong>æœ´ç´ è§£æ³•çš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼š<strong>O(n Ã— m Ã— k)</strong>ï¼Œå…¶ä¸­ n æ˜¯å­—ç¬¦ä¸²é•¿åº¦ï¼Œm æ˜¯å•è¯ä¸ªæ•°ï¼Œk æ˜¯å•è¯é•¿åº¦</li>
<li>å¤§é‡é‡å¤è®¡ç®—å’Œé‡å¤åˆ›å»ºå“ˆå¸Œè¡¨</li>
</ul>
<h3 id="æ»‘åŠ¨çª—å£ä¼˜åŒ–æ€è·¯">æ»‘åŠ¨çª—å£ä¼˜åŒ–æ€è·¯</h3>
<p><strong>æ ¸å¿ƒæ´å¯Ÿ</strong>ï¼šç”±äºæ¯ä¸ªå•è¯é•¿åº¦éƒ½æ˜¯å›ºå®šçš„ <code>wordLen</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†é—®é¢˜åˆ†è§£ä¸º <code>wordLen</code> ä¸ªç‹¬ç«‹çš„å­é—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç¤ºä¾‹ï¼šs = &quot;barfoothefoobar&quot;, words = [&quot;foo&quot;, &quot;bar&quot;], wordLen = 3</span><br><span class="line"></span><br><span class="line">å­é—®é¢˜1: èµ·å§‹ä½ç½® 0, 3, 6, 9, 12... â†’ bar|foo|the|foo|bar</span><br><span class="line">å­é—®é¢˜2: èµ·å§‹ä½ç½® 1, 4, 7, 10, 13... â†’ arf|oot|hef|oob|ar</span><br><span class="line">å­é—®é¢˜3: èµ·å§‹ä½ç½® 2, 5, 8, 11, 14... â†’ rfo|oth|efo|oba|r</span><br></pre></td></tr></table></figure>
<p>å¯¹äºæ¯ä¸ªå­é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨<strong>æ»‘åŠ¨çª—å£</strong>ï¼š</p>
<ol>
<li>ç»´æŠ¤ä¸€ä¸ªå›ºå®šå¤§å°çš„çª—å£ï¼ˆåŒ…å« <code>len(words)</code> ä¸ªå•è¯ï¼‰</li>
<li>å½“çª—å£å³ç§»æ—¶ï¼Œç§»é™¤å·¦è¾¹çš„å•è¯ï¼Œæ·»åŠ å³è¾¹çš„å•è¯</li>
<li>æ£€æŸ¥å½“å‰çª—å£æ˜¯å¦åŒ¹é…æ‰€æœ‰ <code>words</code></li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ»‘åŠ¨çª—å£çš„ä¸‰ç§æƒ…å†µ">æ»‘åŠ¨çª—å£çš„ä¸‰ç§æƒ…å†µ</h3>
<ol>
<li><strong>é‡åˆ°æœ‰æ•ˆå•è¯ä¸”ä¸è¶…è¿‡é™åˆ¶</strong>ï¼šæ­£å¸¸æ‰©å±•çª—å£</li>
<li><strong>é‡åˆ°æœ‰æ•ˆå•è¯ä½†è¶…è¿‡é™åˆ¶</strong>ï¼šæ”¶ç¼©å·¦è¾¹ç•Œç›´åˆ°æ»¡è¶³é™åˆ¶</li>
<li><strong>é‡åˆ°æ— æ•ˆå•è¯</strong>ï¼šé‡ç½®æ•´ä¸ªçª—å£</li>
</ol>
<h3 id="å…³é”®æ•°æ®ç»“æ„">å…³é”®æ•°æ®ç»“æ„</h3>
<ul>
<li><code>wordMap</code>ï¼šè®°å½•ç›®æ ‡å•è¯çš„é¢‘æ¬¡</li>
<li><code>currentMap</code>ï¼šè®°å½•å½“å‰çª—å£ä¸­å•è¯çš„é¢‘æ¬¡</li>
<li><code>count</code>ï¼šå½“å‰çª—å£ä¸­æœ‰æ•ˆå•è¯çš„æ€»æ•°</li>
</ul>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="ä¼˜åŒ–åçš„æ»‘åŠ¨çª—å£è§£æ³•">ä¼˜åŒ–åçš„æ»‘åŠ¨çª—å£è§£æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findSubstring</span><span class="params">(s <span class="type">string</span>, words []<span class="type">string</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">0</span> || <span class="built_in">len</span>(words) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> []<span class="type">int</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    wordLen := <span class="built_in">len</span>(words[<span class="number">0</span>])</span><br><span class="line">    wordCount := <span class="built_in">len</span>(words)</span><br><span class="line">    totalLen := wordLen * wordCount</span><br><span class="line">    result := []<span class="type">int</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s) &lt; totalLen &#123;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„å»ºå•è¯é¢‘æ¬¡map</span></span><br><span class="line">    wordMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> words &#123;</span><br><span class="line">        wordMap[word]++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹äºæ¯ä¸ªå¯èƒ½çš„èµ·å§‹ä½™æ•°ä½ç½® (0 åˆ° wordLen-1)</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; wordLen; i++ &#123;</span><br><span class="line">        left := i</span><br><span class="line">        right := i</span><br><span class="line">        currentMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">        count := <span class="number">0</span> <span class="comment">// å½“å‰çª—å£ä¸­åŒ¹é…çš„å•è¯æ•°</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> right+wordLen &lt;= <span class="built_in">len</span>(s) &#123;</span><br><span class="line">            <span class="comment">// å³è¾¹ç•Œæ‰©å±•ï¼Œå–å‡ºæ–°å•è¯</span></span><br><span class="line">            rightWord := s[right : right+wordLen]</span><br><span class="line">            right += wordLen</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> _, exists := wordMap[rightWord]; exists &#123;</span><br><span class="line">                currentMap[rightWord]++</span><br><span class="line">                count++</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// å¦‚æœæŸä¸ªå•è¯å‡ºç°æ¬¡æ•°è¶…è¿‡éœ€è¦çš„æ¬¡æ•°ï¼Œç¼©å°å·¦è¾¹ç•Œ</span></span><br><span class="line">                <span class="keyword">for</span> currentMap[rightWord] &gt; wordMap[rightWord] &#123;</span><br><span class="line">                    leftWord := s[left : left+wordLen]</span><br><span class="line">                    left += wordLen</span><br><span class="line">                    currentMap[leftWord]--</span><br><span class="line">                    count--</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°å®Œæ•´åŒ¹é…</span></span><br><span class="line">                <span class="keyword">if</span> count == wordCount &#123;</span><br><span class="line">                    result = <span class="built_in">append</span>(result, left)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// é‡åˆ°ä¸åœ¨wordsä¸­çš„å•è¯ï¼Œé‡ç½®çª—å£</span></span><br><span class="line">                currentMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">                count = <span class="number">0</span></span><br><span class="line">                left = right</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æœ´ç´ è§£æ³•ï¼ˆå¯¹æ¯”ï¼‰">æœ´ç´ è§£æ³•ï¼ˆå¯¹æ¯”ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findSubstringNaive</span><span class="params">(s <span class="type">string</span>, words []<span class="type">string</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    wordLen := <span class="built_in">len</span>(words[<span class="number">0</span>])</span><br><span class="line">    wordMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">    totalLength := <span class="built_in">len</span>(words) * wordLen</span><br><span class="line">    result := []<span class="type">int</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> words &#123;</span><br><span class="line">        wordMap[word]++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="built_in">len</span>(s)-totalLength; i++ &#123;</span><br><span class="line">        wordCnt := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>) <span class="comment">// æ¯æ¬¡éƒ½é‡æ–°åˆ›å»º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> j := i; j &lt; i+totalLength; j += wordLen &#123;</span><br><span class="line">            word := s[j : j+wordLen]</span><br><span class="line">            wordCnt[word]++</span><br><span class="line">            <span class="keyword">if</span> wordCnt[word] &gt; wordMap[word] &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> j == i+totalLength-wordLen &#123;</span><br><span class="line">                result = <span class="built_in">append</span>(result, i)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æœ´ç´ è§£æ³•</th>
<th>æ»‘åŠ¨çª—å£è§£æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n Ã— m Ã— k)</td>
<td>O(n Ã— k)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(m)</td>
<td>O(m)</td>
</tr>
<tr>
<td>æ ¸å¿ƒæ€æƒ³</td>
<td>æš´åŠ›æšä¸¾æ¯ä¸ªèµ·å§‹ä½ç½®</td>
<td>æŒ‰ä½™æ•°åˆ†ç»„ + æ»‘åŠ¨çª—å£</td>
</tr>
<tr>
<td>é‡å¤è®¡ç®—</td>
<td>å¤§é‡é‡å¤è®¡ç®—</td>
<td>å……åˆ†åˆ©ç”¨ä¹‹å‰çš„è®¡ç®—ç»“æœ</td>
</tr>
<tr>
<td>Mapåˆ›å»º</td>
<td>æ¯ä¸ªèµ·å§‹ä½ç½®éƒ½é‡æ–°åˆ›å»º</td>
<td>æ¯ä¸ªå­é—®é¢˜åªåˆ›å»ºä¸€æ¬¡</td>
</tr>
<tr>
<td>æ€§èƒ½è¡¨ç°</td>
<td>åªèƒ½è¶…è¿‡ 25% çš„æäº¤</td>
<td>èƒ½è¶…è¿‡ 80%+ çš„æäº¤</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦è¯¦è§£">æ—¶é—´å¤æ‚åº¦è¯¦è§£</h3>
<p><strong>æœ´ç´ è§£æ³•ï¼šO(n Ã— m Ã— k)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¤–å±‚å¾ªç¯ï¼šO(n) - éå†æ‰€æœ‰å¯èƒ½çš„èµ·å§‹ä½ç½®</span><br><span class="line">å†…å±‚å¾ªç¯ï¼šO(m Ã— k) - æ£€æŸ¥æ¯ä¸ªèµ·å§‹ä½ç½®çš„ m ä¸ªå•è¯</span><br><span class="line">æ€»ä½“ï¼šO(n Ã— m Ã— k)</span><br></pre></td></tr></table></figure>
<p><strong>æ»‘åŠ¨çª—å£ï¼šO(n Ã— k)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¤–å±‚å¾ªç¯ï¼šO(k) - æŒ‰ wordLen åˆ†ç»„</span><br><span class="line">å†…å±‚å¾ªç¯ï¼šO(n) - æ¯ä¸ªå­—ç¬¦æœ€å¤šè¢«è®¿é—®å¸¸æ•°æ¬¡</span><br><span class="line">æ€»ä½“ï¼šO(n Ã— k)</span><br></pre></td></tr></table></figure>
<p><strong>å…³é”®å·®å¼‚åˆ†æï¼š</strong></p>
<p>æ»‘åŠ¨çª—å£ä¹‹æ‰€ä»¥æ›´å¿«ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºé¿å…äº†é‡å¤åˆ›å»º Mapï¼Œæ›´é‡è¦çš„æ˜¯<strong>ç®—æ³•å¤æ‚åº¦çš„æ ¹æœ¬æ€§æ”¹è¿›</strong>ï¼š</p>
<ol>
<li><strong>å‡å°‘äº†ä¸€ä¸ªç»´åº¦</strong>ï¼šä» O(n Ã— m Ã— k) é™åˆ° O(n Ã— k)</li>
<li><strong>é¿å…é‡å¤è®¡ç®—</strong>ï¼šæ¯ä¸ªå­—ç¬¦æœ€å¤šè¢«å¤„ç†å¸¸æ•°æ¬¡</li>
<li><strong>å……åˆ†åˆ©ç”¨å•è¯ç­‰é•¿ç‰¹æ€§</strong>ï¼šæŒ‰ä½™æ•°åˆ†ç»„ï¼Œé¿å…æ— æ•ˆæå‰ª</li>
</ol>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<p>ä¸¤ç§è§£æ³•çš„ç©ºé—´å¤æ‚åº¦éƒ½æ˜¯ <strong>O(m)</strong>ï¼Œä¸»è¦ç”¨äºå­˜å‚¨ï¼š</p>
<ul>
<li>ç›®æ ‡å•è¯çš„é¢‘æ¬¡æ˜ å°„</li>
<li>å½“å‰çª—å£çš„å•è¯ç»Ÿè®¡</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="ç®—æ³•ä¼˜åŒ–ç­–ç•¥">ç®—æ³•ä¼˜åŒ–ç­–ç•¥</h3>
<ol>
<li><strong>åˆ©ç”¨é—®é¢˜ç‰¹æ€§</strong>ï¼šå•è¯ç­‰é•¿è¿™ä¸ªçº¦æŸæ¡ä»¶æ˜¯ä¼˜åŒ–çš„å…³é”®</li>
<li><strong>æ»‘åŠ¨çª—å£æ€æƒ³</strong>ï¼šå½“é—®é¢˜æ¶‰åŠè¿ç»­å­åºåˆ—æ—¶ï¼Œè€ƒè™‘æ»‘åŠ¨çª—å£</li>
<li><strong>åˆ†æ²»æ€æƒ³</strong>ï¼šå°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºç®€å•å­é—®é¢˜</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šç¡®ä¿å¾ªç¯è¾¹ç•Œæ­£ç¡®ï¼Œé¿å…æ•°ç»„è¶Šç•Œ</li>
<li><strong>Map åˆå§‹åŒ–</strong>ï¼šæ³¨æ„åœ¨é€‚å½“æ—¶æœºé‡ç½® Map çŠ¶æ€</li>
<li><strong>å¤æ‚åº¦åˆ†æ</strong>ï¼šä¸è¦ä»…çœ‹è¡¨é¢ï¼Œè¦åˆ†æç®—æ³•çš„æœ¬è´¨å·®å¼‚</li>
</ol>
<h3 id="æ€§èƒ½ä¼˜åŒ–è¦ç‚¹">æ€§èƒ½ä¼˜åŒ–è¦ç‚¹</h3>
<p>å›ç­”æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼š<strong>æ—¶é—´å¤æ‚åº¦ç¡®å®ä¸åŒï¼</strong></p>
<p>è™½ç„¶é‡å¤åˆ›å»º Map ç¡®å®æœ‰æ€§èƒ½å¼€é”€ï¼Œä½†æ›´æ ¹æœ¬çš„å·®å¼‚åœ¨äºï¼š</p>
<ul>
<li>æœ´ç´ è§£æ³•ï¼š<strong>O(n Ã— m Ã— k)</strong> - æ¯ä¸ªä½ç½®éƒ½è¦é‡æ–°æ£€æŸ¥æ‰€æœ‰å•è¯</li>
<li>æ»‘åŠ¨çª—å£ï¼š<strong>O(n Ã— k)</strong> - åˆ©ç”¨çª—å£æ»‘åŠ¨ï¼Œé¿å…é‡å¤è®¡ç®—</li>
</ul>
<p>æ»‘åŠ¨çª—å£é€šè¿‡<strong>å‡å°‘ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ç»´åº¦</strong>å®ç°äº†è´¨çš„é£è·ƒï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ€§èƒ½æå‡å¦‚æ­¤æ˜¾è‘—çš„æ ¹æœ¬åŸå› ã€‚</p>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><a href="mdc:hexo-blog/2023/06/15/LeetCode-3-Longest-Substring-Without-Repeating-Characters">LeetCode 3: æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></li>
<li><a href="mdc:hexo-blog/2023/06/20/LeetCode-76-Minimum-Window-Substring">LeetCode 76: æœ€å°è¦†ç›–å­ä¸²</a></li>
<li><a href="mdc:hexo-blog/2023/06/25/LeetCode-438-Find-All-Anagrams-in-a-String">LeetCode 438: æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯</a></li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å­—ç¬¦ä¸²</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>Hard</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>æ»‘åŠ¨çª—å£</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 209 - é•¿åº¦æœ€å°çš„å­æ•°ç»„ï¼ˆMinimum Size Subarray Sumï¼‰</title>
    <url>/2025/06/01/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-209-%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªå«æœ‰ n ä¸ªæ­£æ•´æ•°çš„æ•°ç»„å’Œä¸€ä¸ªæ­£æ•´æ•° target ï¼Œæ‰¾å‡ºè¯¥æ•°ç»„ä¸­æ»¡è¶³å…¶å’Œ â‰¥ target çš„é•¿åº¦æœ€å°çš„ <strong>è¿ç»­å­æ•°ç»„</strong> <code>[numsl, numsl+1, ..., numsr-1, numsr]</code> ï¼Œå¹¶è¿”å›å…¶é•¿åº¦ã€‚å¦‚æœä¸å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„å­æ•°ç»„ï¼Œè¿”å› 0 ã€‚</p>
<h3 id="ç¤ºä¾‹è¾“å…¥è¾“å‡º">ç¤ºä¾‹è¾“å…¥è¾“å‡º</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼štarget = 7, nums = [2,3,1,2,4,3]</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼šå­æ•°ç»„ [4,3] æ˜¯è¯¥æ¡ä»¶ä¸‹çš„é•¿åº¦æœ€å°çš„å­æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼štarget = 4, nums = [1,4,4]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼štarget = 11, nums = [1,1,1,1,1,1,1,1]</span><br><span class="line">è¾“å‡ºï¼š0</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>1 â‰¤ target â‰¤ $10^9$</li>
<li>1 â‰¤ nums.length â‰¤ $10^5$</li>
<li>1 â‰¤ nums[i] â‰¤ $10^4$</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯æ‰¾åˆ°<strong>å’Œå¤§äºç­‰äºç›®æ ‡å€¼çš„æœ€çŸ­è¿ç»­å­æ•°ç»„</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§ä¸»è¦æ–¹æ³•æ¥è§£å†³ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šå‰ç¼€å’Œ-åŒæŒ‡é’ˆ"><strong>æ–¹æ³•ä¸€ï¼šå‰ç¼€å’Œ + åŒæŒ‡é’ˆ</strong></h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé¢„å…ˆè®¡ç®—å‰ç¼€å’Œæ•°ç»„ï¼Œç„¶åä½¿ç”¨åŒæŒ‡é’ˆæŠ€æœ¯å¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„æœ€çŸ­å­æ•°ç»„ã€‚</p>
<p>é€šè¿‡å‰ç¼€å’Œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ $O(1)$ æ—¶é—´å†…è®¡ç®—ä»»æ„åŒºé—´ <code>[left, right)</code> çš„å’Œï¼š<br>
$$\text{sum}(left, right) = \text{prefix}[right] - \text{prefix}[left]$$</p>
<h3 id="æ–¹æ³•äºŒï¼šæ»‘åŠ¨çª—å£ï¼ˆæ›´ä¼˜è§£æ³•ï¼‰"><strong>æ–¹æ³•äºŒï¼šæ»‘åŠ¨çª—å£ï¼ˆæ›´ä¼˜è§£æ³•ï¼‰</strong></h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨åŒæŒ‡é’ˆç»´æŠ¤ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼ŒåŠ¨æ€è°ƒæ•´çª—å£å¤§å°æ¥å¯»æ‰¾æœ€çŸ­çš„æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ã€‚</p>
<p>è¿™ç§æ–¹æ³•é¿å…äº†é¢å¤–ç©ºé—´çš„ä½¿ç”¨ï¼Œåªéœ€è¦ç»´æŠ¤å½“å‰çª—å£çš„å’Œã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šå‰ç¼€å’ŒåŒæŒ‡é’ˆå®ç°">æ–¹æ³•ä¸€ï¼šå‰ç¼€å’ŒåŒæŒ‡é’ˆå®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minSubArrayLen</span><span class="params">(target <span class="type">int</span>, nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„å»ºå‰ç¼€å’Œæ•°ç»„ï¼šprefix[i] è¡¨ç¤º nums[0...i-1] çš„å’Œ</span></span><br><span class="line">    prefix := <span class="built_in">make</span>([]<span class="type">int</span>, n+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        prefix[i+<span class="number">1</span>] = prefix[i] + nums[i]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    minLength := math.MaxInt32</span><br><span class="line">    left := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒæŒ‡é’ˆå¯»æ‰¾æœ€å°é•¿åº¦çš„å­æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> right := <span class="number">1</span>; right &lt;= n; right++ &#123;</span><br><span class="line">        <span class="comment">// å½“å‰çª—å£ [left, right) çš„å’Œ</span></span><br><span class="line">        currentSum := prefix[right] - prefix[left]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰å’Œæ»¡è¶³æ¡ä»¶ï¼Œå°è¯•æ”¶ç¼©å·¦è¾¹ç•Œ</span></span><br><span class="line">        <span class="keyword">for</span> currentSum &gt;= target &#123;</span><br><span class="line">            minLength = min(minLength, right-left)</span><br><span class="line">            left++</span><br><span class="line">            <span class="keyword">if</span> left &lt; right &#123;</span><br><span class="line">                currentSum = prefix[right] - prefix[left]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ï¼Œè¿”å› 0</span></span><br><span class="line">    <span class="keyword">if</span> minLength == math.MaxInt32 &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minLength</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šæ»‘åŠ¨çª—å£å®ç°ï¼ˆæ¨èï¼‰">æ–¹æ³•äºŒï¼šæ»‘åŠ¨çª—å£å®ç°ï¼ˆæ¨èï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minSubArrayLen</span><span class="params">(target <span class="type">int</span>, nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    left, right := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    windowSum := <span class="number">0</span></span><br><span class="line">    minLength := math.MaxInt32</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ»‘åŠ¨çª—å£æŠ€æœ¯</span></span><br><span class="line">    <span class="keyword">for</span> right &lt; n &#123;</span><br><span class="line">        <span class="comment">// æ‰©å±•å³è¾¹ç•Œï¼Œå¢åŠ çª—å£å†…çš„å’Œ</span></span><br><span class="line">        windowSum += nums[right]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å½“çª—å£å†…çš„å’Œæ»¡è¶³æ¡ä»¶æ—¶ï¼Œå°è¯•æ”¶ç¼©å·¦è¾¹ç•Œ</span></span><br><span class="line">        <span class="keyword">for</span> windowSum &gt;= target &#123;</span><br><span class="line">            <span class="comment">// æ›´æ–°æœ€å°é•¿åº¦</span></span><br><span class="line">            minLength = min(minLength, right-left+<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ”¶ç¼©å·¦è¾¹ç•Œ</span></span><br><span class="line">            windowSum -= nums[left]</span><br><span class="line">            left++</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç§»åŠ¨å³è¾¹ç•Œ</span></span><br><span class="line">        right++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ï¼Œè¿”å› 0</span></span><br><span class="line">    <span class="keyword">if</span> minLength == math.MaxInt32 &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minLength</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾…åŠ©å‡½æ•°ï¼šè·å–ä¸¤ä¸ªæ•´æ•°çš„æœ€å°å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &lt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å‰ç¼€å’ŒåŒæŒ‡é’ˆ</th>
<th>æ»‘åŠ¨çª—å£</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>$O(n)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>é¢„å¤„ç†</td>
<td>éœ€è¦æ„å»ºå‰ç¼€å’Œæ•°ç»„</td>
<td>æ— éœ€é¢„å¤„ç†</td>
</tr>
<tr>
<td>ä»£ç å¤æ‚åº¦</td>
<td>ç›¸å¯¹å¤æ‚</td>
<td>ç®€æ´ç›´è§‚</td>
</tr>
<tr>
<td>å†…å­˜ä½¿ç”¨</td>
<td>éœ€è¦é¢å¤– $O(n)$ ç©ºé—´</td>
<td>åªéœ€å¸¸æ•°ç©ºé—´</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="å‰ç¼€å’ŒåŒæŒ‡é’ˆæ–¹æ³•">å‰ç¼€å’ŒåŒæŒ‡é’ˆæ–¹æ³•</h3>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$</p>
<ul>
<li>æ„å»ºå‰ç¼€å’Œæ•°ç»„ï¼š$O(n)$</li>
<li>åŒæŒ‡é’ˆéå†ï¼š$O(n)$ï¼ˆæ¯ä¸ªå…ƒç´ æœ€å¤šè¢«è®¿é—®ä¸¤æ¬¡ï¼‰</li>
</ul>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n)$</p>
<ul>
<li>å‰ç¼€å’Œæ•°ç»„éœ€è¦ $O(n)$ é¢å¤–ç©ºé—´</li>
</ul>
<h3 id="æ»‘åŠ¨çª—å£æ–¹æ³•">æ»‘åŠ¨çª—å£æ–¹æ³•</h3>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$</p>
<ul>
<li>è™½ç„¶æœ‰åµŒå¥—å¾ªç¯ï¼Œä½†æ¯ä¸ªå…ƒç´ æœ€å¤šè¢« <code>left</code> å’Œ <code>right</code> æŒ‡é’ˆå„è®¿é—®ä¸€æ¬¡</li>
</ul>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$</p>
<ul>
<li>åªä½¿ç”¨äº†å‡ ä¸ªå˜é‡ï¼Œä¸ä¾èµ–äºè¾“å…¥æ•°ç»„çš„å¤§å°</li>
</ul>
<h2 id="ç®—æ³•æ‰§è¡Œç¤ºä¾‹">ç®—æ³•æ‰§è¡Œç¤ºä¾‹</h2>
<p>ä»¥ <code>target = 7, nums = [2,3,1,2,4,3]</code> ä¸ºä¾‹ï¼Œå±•ç¤ºæ»‘åŠ¨çª—å£çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹çŠ¶æ€ï¼šleft = 0, right = 0, windowSum = 0, minLength = âˆ</span><br><span class="line"></span><br><span class="line">Step 1: right = 0, windowSum = 2</span><br><span class="line">        [2] 3 1 2 4 3</span><br><span class="line">         â†‘</span><br><span class="line">       left,right</span><br><span class="line"></span><br><span class="line">Step 2: right = 1, windowSum = 5</span><br><span class="line">        [2,3] 1 2 4 3</span><br><span class="line">         â†‘   â†‘</span><br><span class="line">       left right</span><br><span class="line"></span><br><span class="line">Step 3: right = 2, windowSum = 6</span><br><span class="line">        [2,3,1] 2 4 3</span><br><span class="line">         â†‘     â†‘</span><br><span class="line">       left   right</span><br><span class="line"></span><br><span class="line">Step 4: right = 3, windowSum = 8 &gt;= 7 âœ“</span><br><span class="line">        [2,3,1,2] 4 3</span><br><span class="line">         â†‘       â†‘</span><br><span class="line">       left     right</span><br><span class="line">        æ›´æ–° minLength = 4</span><br><span class="line"></span><br><span class="line">Step 5: æ”¶ç¼© leftï¼ŒwindowSum = 6</span><br><span class="line">        2 [3,1,2] 4 3</span><br><span class="line">           â†‘     â†‘</span><br><span class="line">         left   right</span><br><span class="line"></span><br><span class="line">Step 6: right = 4, windowSum = 10 &gt;= 7 âœ“</span><br><span class="line">        2 [3,1,2,4] 3</span><br><span class="line">           â†‘       â†‘</span><br><span class="line">         left     right</span><br><span class="line">        æ›´æ–° minLength = 4</span><br><span class="line"></span><br><span class="line">Step 7: æ”¶ç¼© leftï¼ŒwindowSum = 7 &gt;= 7 âœ“</span><br><span class="line">        2 3 [1,2,4] 3</span><br><span class="line">             â†‘     â†‘</span><br><span class="line">           left   right</span><br><span class="line">        æ›´æ–° minLength = 3</span><br><span class="line"></span><br><span class="line">Step 8: æ”¶ç¼© leftï¼ŒwindowSum = 6</span><br><span class="line">        2 3 1 [2,4] 3</span><br><span class="line">               â†‘   â†‘</span><br><span class="line">             left right</span><br><span class="line"></span><br><span class="line">Step 9: right = 5, windowSum = 9 &gt;= 7 âœ“</span><br><span class="line">        2 3 1 [2,4,3]</span><br><span class="line">               â†‘     â†‘</span><br><span class="line">             left   right</span><br><span class="line">        æ›´æ–° minLength = 3</span><br><span class="line"></span><br><span class="line">Step 10: æ”¶ç¼© leftï¼ŒwindowSum = 7 &gt;= 7 âœ“</span><br><span class="line">         2 3 1 2 [4,3]</span><br><span class="line">                  â†‘   â†‘</span><br><span class="line">                left right</span><br><span class="line">         æ›´æ–° minLength = 2</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœï¼šminLength = 2</span><br></pre></td></tr></table></figure>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>æ»‘åŠ¨çª—å£æ˜¯å¤„ç†è¿ç»­å­æ•°ç»„é—®é¢˜çš„ç»å…¸æŠ€æ³•</strong>ï¼šé€šè¿‡åŠ¨æ€è°ƒæ•´çª—å£è¾¹ç•Œï¼Œå¯ä»¥é«˜æ•ˆåœ°æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ã€‚</p>
</li>
<li>
<p><strong>ç©ºé—´æ¢æ—¶é—´çš„æƒè¡¡</strong>ï¼šå‰ç¼€å’Œæ–¹æ³•ç”¨é¢å¤–ç©ºé—´æ¢å–äº†æ›´ç›´è§‚çš„å®ç°ï¼Œä½†æ»‘åŠ¨çª—å£åœ¨ä¸å¢åŠ ç©ºé—´å¤æ‚åº¦çš„æƒ…å†µä¸‹åŒæ ·é«˜æ•ˆã€‚</p>
</li>
<li>
<p><strong>åŒæŒ‡é’ˆçš„ç§»åŠ¨ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å½“çª—å£å’Œå°äºç›®æ ‡å€¼æ—¶ï¼Œæ‰©å±•å³è¾¹ç•Œå¢åŠ å’Œ</li>
<li>å½“çª—å£å’Œå¤§äºç­‰äºç›®æ ‡å€¼æ—¶ï¼Œæ”¶ç¼©å·¦è¾¹ç•Œå¯»æ‰¾æ›´çŸ­çš„è§£</li>
</ul>
</li>
<li>
<p><strong>å¸¸è§é™·é˜±</strong>ï¼š</p>
<ul>
<li>æ³¨æ„è¾¹ç•Œæ¡ä»¶çš„å¤„ç†ï¼ˆç©ºæ•°ç»„ã€æ— è§£æƒ…å†µï¼‰</li>
<li>ç¡®ä¿æŒ‡é’ˆç§»åŠ¨çš„æ­£ç¡®æ€§ï¼Œé¿å…è¶Šç•Œ</li>
<li>åˆå§‹åŒ– <code>minLength</code> ä¸ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼</li>
</ul>
</li>
<li>
<p><strong>ç›¸å…³åº”ç”¨</strong>ï¼šæ­¤ç±»æ»‘åŠ¨çª—å£æŠ€æ³•å¯ä»¥åº”ç”¨äºå…¶ä»–ç±»ä¼¼é—®é¢˜ï¼Œå¦‚æœ€é•¿æ— é‡å¤å­—ç¬¦å­ä¸²ã€æœ€å°è¦†ç›–å­ä¸²ç­‰ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>æ»‘åŠ¨çª—å£</tag>
        <tag>å‰ç¼€å’Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 15 - ä¸‰æ•°ä¹‹å’Œï¼ˆ3Sumï¼‰</title>
    <url>/2025/05/31/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-15-%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ <code>[nums[i], nums[j], nums[k]]</code> æ»¡è¶³ <code>i != j</code>ã€<code>i != k</code> ä¸” <code>j != k</code>ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ <code>nums[i] + nums[j] + nums[k] == 0</code>ã€‚</p>
<p>è¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [-1,0,1,2,-1,-4]</span><br><span class="line">è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">nums[0] + nums[1] + nums[2] = (-1) + 0 + 1 = 0 ã€‚</span><br><span class="line">nums[1] + nums[4] + nums[5] = 0 + (-1) + 1 = 0 ã€‚</span><br><span class="line">nums[0] + nums[3] + nums[4] = (-1) + 2 + (-1) = 0 ã€‚</span><br><span class="line">ä¸åŒçš„ä¸‰å…ƒç»„æ˜¯ [-1,0,1] å’Œ [-1,-1,2] ã€‚</span><br><span class="line">æ³¨æ„ï¼Œè¾“å‡ºçš„é¡ºåºå’Œä¸‰å…ƒç»„çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [0,1,1]</span><br><span class="line">è¾“å‡ºï¼š[]</span><br><span class="line">è§£é‡Šï¼šå”¯ä¸€å¯èƒ½çš„ä¸‰å…ƒç»„å’Œä¸ä¸º 0 ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [0,0,0]</span><br><span class="line">è¾“å‡ºï¼š[[0,0,0]]</span><br><span class="line">è§£é‡Šï¼šå”¯ä¸€å¯èƒ½çš„ä¸‰å…ƒç»„å’Œä¸º 0 ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>3 &lt;= nums.length &lt;= 3000</code></li>
<li><code>-10^5 &lt;= nums[i] &lt;= 10^5</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å°†ä¸‰æ•°ä¹‹å’Œè½¬åŒ–ä¸ºä¸¤æ•°ä¹‹å’Œé—®é¢˜</strong>ã€‚æˆ‘ä»¬å¯ä»¥ï¼š</p>
<ol>
<li><strong>å›ºå®šä¸€ä¸ªæ•°</strong>ï¼šéå†æ•°ç»„ï¼Œå°†å½“å‰æ•°ä½œä¸ºä¸‰å…ƒç»„çš„ç¬¬ä¸€ä¸ªæ•°</li>
<li><strong>åŒæŒ‡é’ˆå¯»æ‰¾å¦å¤–ä¸¤ä¸ªæ•°</strong>ï¼šåœ¨å‰©ä½™æ•°ç»„ä¸­ç”¨åŒæŒ‡é’ˆå¯»æ‰¾ä¸¤ä¸ªæ•°ï¼Œä½¿å¾—ä¸‰æ•°ä¹‹å’Œä¸º 0</li>
<li><strong>æ’åºå»é‡</strong>ï¼šå…ˆå¯¹æ•°ç»„æ’åºï¼Œä¾¿äºåŒæŒ‡é’ˆæ“ä½œå’Œå»é‡</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆè¦æ’åºï¼Ÿ">ä¸ºä»€ä¹ˆè¦æ’åºï¼Ÿ</h3>
<p>æ’åºçš„å¥½å¤„ï¼š</p>
<ul>
<li><strong>ä¾¿äºåŒæŒ‡é’ˆæ“ä½œ</strong>ï¼šæ’åºåå¯ä»¥æ ¹æ®å’Œçš„å¤§å°ç§»åŠ¨æŒ‡é’ˆ</li>
<li><strong>ä¾¿äºå»é‡</strong>ï¼šç›¸åŒçš„æ•°ä¼šç›¸é‚»ï¼Œå®¹æ˜“è·³è¿‡é‡å¤å…ƒç´ </li>
<li><strong>æå‰ç»ˆæ­¢</strong>ï¼šå¦‚æœå½“å‰æ•°å¤§äº 0ï¼Œåé¢çš„æ•°éƒ½æ›´å¤§ï¼Œä¸å¯èƒ½æ‰¾åˆ°å’Œä¸º 0 çš„ä¸‰å…ƒç»„</li>
</ul>
<h3 id="åŒæŒ‡é’ˆçš„ç§»åŠ¨ç­–ç•¥">åŒæŒ‡é’ˆçš„ç§»åŠ¨ç­–ç•¥</h3>
<p>å¯¹äºå›ºå®šçš„ç¬¬ä¸€ä¸ªæ•° <code>nums[i]</code>ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <code>nums[i+1:]</code> ä¸­æ‰¾åˆ°ä¸¤ä¸ªæ•°ï¼Œä½¿å¾—ä¸‰æ•°ä¹‹å’Œä¸º 0ï¼š</p>
<ul>
<li>å¦‚æœ <code>nums[i] + nums[left] + nums[right] == 0</code>ï¼šæ‰¾åˆ°ä¸€ä¸ªè§£</li>
<li>å¦‚æœ <code>nums[i] + nums[left] + nums[right] &lt; 0</code>ï¼šå’Œå¤ªå°ï¼Œéœ€è¦å¢å¤§ï¼Œ<code>left++</code></li>
<li>å¦‚æœ <code>nums[i] + nums[left] + nums[right] &gt; 0</code>ï¼šå’Œå¤ªå¤§ï¼Œéœ€è¦å‡å°ï¼Œ<code>right--</code></li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥æ¼”ç¤ºç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<h3 id="ä¾‹å­æ¼”ç¤ºï¼šnums-1-0-1-2-1-4">ä¾‹å­æ¼”ç¤ºï¼šnums = [-1,0,1,2,-1,-4]</h3>
<h4 id="æ­¥éª¤-1ï¼šæ’åº">æ­¥éª¤ 1ï¼šæ’åº</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸæ•°ç»„ï¼š[-1, 0, 1, 2, -1, -4]</span><br><span class="line">æ’åºåï¼š[-4, -1, -1, 0, 1, 2]</span><br><span class="line">          â†‘   â†‘   â†‘  â†‘  â†‘  â†‘</span><br><span class="line">          0   1   2  3  4  5</span><br></pre></td></tr></table></figure>
<h4 id="æ­¥éª¤-2ï¼šéå†å›ºå®šç¬¬ä¸€ä¸ªæ•°">æ­¥éª¤ 2ï¼šéå†å›ºå®šç¬¬ä¸€ä¸ªæ•°</h4>
<p><strong>ç¬¬ä¸€è½®ï¼ši = 0, nums[i] = -4</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°ç»„ï¼š[-4, -1, -1, 0, 1, 2]</span><br><span class="line">        â†‘   â†‘            â†‘</span><br><span class="line">        i   left        right</span><br></pre></td></tr></table></figure>
<p>å¯»æ‰¾ <code>-4 + nums[left] + nums[right] = 0</code>ï¼Œå³ <code>nums[left] + nums[right] = 4</code></p>
<ul>
<li><code>left = 1, right = 5</code>ï¼š<code>-1 + 2 = 1 &lt; 4</code>ï¼Œ<code>left++</code></li>
<li><code>left = 2, right = 5</code>ï¼š<code>-1 + 2 = 1 &lt; 4</code>ï¼Œ<code>left++</code></li>
<li><code>left = 3, right = 5</code>ï¼š<code>0 + 2 = 2 &lt; 4</code>ï¼Œ<code>left++</code></li>
<li><code>left = 4, right = 5</code>ï¼š<code>1 + 2 = 3 &lt; 4</code>ï¼Œ<code>left++</code></li>
<li><code>left = 5, right = 5</code>ï¼š<code>left &gt;= right</code>ï¼Œç»“æŸ</li>
</ul>
<p><strong>ç¬¬äºŒè½®ï¼ši = 1, nums[i] = -1</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°ç»„ï¼š[-4, -1, -1, 0, 1, 2]</span><br><span class="line">            â†‘   â†‘        â†‘</span><br><span class="line">            i   left     right</span><br></pre></td></tr></table></figure>
<p>å¯»æ‰¾ <code>-1 + nums[left] + nums[right] = 0</code>ï¼Œå³ <code>nums[left] + nums[right] = 1</code></p>
<ul>
<li><code>left = 2, right = 5</code>ï¼š<code>-1 + 2 = 1 = 1</code> âœ… <strong>æ‰¾åˆ°è§£ï¼š[-1, -1, 2]</strong></li>
</ul>
<p>æ‰¾åˆ°è§£åï¼Œéœ€è¦è·³è¿‡é‡å¤å…ƒç´ ï¼š</p>
<ul>
<li><code>left++</code>ï¼š<code>left = 3</code></li>
<li><code>right--</code>ï¼š<code>right = 4</code></li>
<li>æ£€æŸ¥ <code>nums[left] == nums[left-1]</code>ï¼Ÿ<code>nums[3] = 0, nums[2] = -1</code>ï¼Œä¸ç›¸ç­‰</li>
<li>æ£€æŸ¥ <code>nums[right] == nums[right+1]</code>ï¼Ÿ<code>nums[4] = 1, nums[5] = 2</code>ï¼Œä¸ç›¸ç­‰</li>
</ul>
<p>ç»§ç»­å¯»æ‰¾ï¼š</p>
<ul>
<li><code>left = 3, right = 4</code>ï¼š<code>0 + 1 = 1 = 1</code> âœ… <strong>æ‰¾åˆ°è§£ï¼š[-1, 0, 1]</strong></li>
</ul>
<p><strong>ç¬¬ä¸‰è½®ï¼ši = 2, nums[i] = -1</strong></p>
<p>ç”±äº <code>nums[2] == nums[1]</code>ï¼Œè·³è¿‡é‡å¤å…ƒç´ ã€‚</p>
<p><strong>ç¬¬å››è½®ï¼ši = 3, nums[i] = 0</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°ç»„ï¼š[-4, -1, -1, 0, 1, 2]</span><br><span class="line">                   â†‘  â†‘  â†‘</span><br><span class="line">                   i left right</span><br></pre></td></tr></table></figure>
<p>å¯»æ‰¾ <code>0 + nums[left] + nums[right] = 0</code>ï¼Œå³ <code>nums[left] + nums[right] = 0</code></p>
<ul>
<li><code>left = 4, right = 5</code>ï¼š<code>1 + 2 = 3 &gt; 0</code>ï¼Œ<code>right--</code></li>
<li><code>left = 4, right = 4</code>ï¼š<code>left &gt;= right</code>ï¼Œç»“æŸ</li>
</ul>
<h4 id="æœ€ç»ˆç»“æœ">æœ€ç»ˆç»“æœ</h4>
<p>æ‰¾åˆ°çš„ä¸‰å…ƒç»„ï¼š<code>[[-1, -1, 2], [-1, 0, 1]]</code></p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">threeSum</span><span class="params">(nums []<span class="type">int</span>)</span></span> (res [][]<span class="type">int</span>) &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    sort.Ints(nums)  <span class="comment">// æ’åº</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n<span class="number">-2</span>; i++ &#123;</span><br><span class="line">        <span class="comment">// ä¼˜åŒ–ï¼šå¦‚æœå½“å‰æ•°å¤§äº0ï¼Œåé¢ä¸å¯èƒ½æœ‰å’Œä¸º0çš„ä¸‰å…ƒç»„</span></span><br><span class="line">        <span class="keyword">if</span> nums[i] &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è·³è¿‡é‡å¤çš„ç¬¬ä¸€ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i<span class="number">-1</span>] &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        left := i + <span class="number">1</span></span><br><span class="line">        right := n - <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> left &lt; right &#123;</span><br><span class="line">            sum := nums[i] + nums[left] + nums[right]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> sum == <span class="number">0</span> &#123;</span><br><span class="line">                <span class="comment">// æ‰¾åˆ°ä¸€ä¸ªè§£</span></span><br><span class="line">                res = <span class="built_in">append</span>(res, []<span class="type">int</span>&#123;nums[i], nums[left], nums[right]&#125;)</span><br><span class="line">                left++</span><br><span class="line">                right--</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// è·³è¿‡é‡å¤çš„left</span></span><br><span class="line">                <span class="keyword">for</span> left &lt; right &amp;&amp; nums[left] == nums[left<span class="number">-1</span>] &#123;</span><br><span class="line">                    left++</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// è·³è¿‡é‡å¤çš„right</span></span><br><span class="line">                <span class="keyword">for</span> left &lt; right &amp;&amp; nums[right] == nums[right+<span class="number">1</span>] &#123;</span><br><span class="line">                    right--</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> sum &lt; <span class="number">0</span> &#123;</span><br><span class="line">                left++   <span class="comment">// å’Œå¤ªå°ï¼Œå¢å¤§left</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right--  <span class="comment">// å’Œå¤ªå¤§ï¼Œå‡å°right</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼š-O-n-2">æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$</h3>
<ul>
<li>æ’åºï¼š$O(n \log n)$</li>
<li>å¤–å±‚å¾ªç¯ï¼š$O(n)$</li>
<li>å†…å±‚åŒæŒ‡é’ˆï¼š$O(n)$</li>
<li>æ€»æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log n) + O(n^2) = O(n^2)$</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼š-O-1">ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$</h3>
<p>é™¤äº†å­˜å‚¨ç»“æœçš„æ•°ç»„å¤–ï¼Œåªä½¿ç”¨äº†å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ã€‚</p>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="æ ¸å¿ƒæŠ€å·§">æ ¸å¿ƒæŠ€å·§</h3>
<ol>
<li><strong>é™ç»´æ€æƒ³</strong>ï¼šå°†ä¸‰æ•°ä¹‹å’Œè½¬åŒ–ä¸ºä¸¤æ•°ä¹‹å’Œé—®é¢˜</li>
<li><strong>æ’åºçš„å¦™ç”¨</strong>ï¼šæ—¢ä¾¿äºåŒæŒ‡é’ˆæ“ä½œï¼Œåˆä¾¿äºå»é‡</li>
<li><strong>åŒæŒ‡é’ˆæŠ€å·§</strong>ï¼šæ ¹æ®å’Œçš„å¤§å°å†³å®šæŒ‡é’ˆç§»åŠ¨æ–¹å‘</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li>
<p><strong>å¿˜è®°å»é‡</strong>ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªæ•°çš„å»é‡ï¼š<code>if i &gt; 0 &amp;&amp; nums[i] == nums[i-1]</code></li>
<li>æ‰¾åˆ°è§£åçš„å»é‡ï¼šè·³è¿‡ç›¸åŒçš„ <code>left</code> å’Œ <code>right</code></li>
</ul>
</li>
<li>
<p><strong>è¾¹ç•Œæ¡ä»¶</strong>ï¼š</p>
<ul>
<li>å¤–å±‚å¾ªç¯åˆ° <code>n-2</code>ï¼šè‡³å°‘è¦ç•™ä¸¤ä¸ªä½ç½®ç»™ <code>left</code> å’Œ <code>right</code></li>
<li>åŒæŒ‡é’ˆçš„è¾¹ç•Œï¼š<code>left &lt; right</code></li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li>å½“ <code>nums[i] &gt; 0</code> æ—¶å¯ä»¥æå‰ç»ˆæ­¢</li>
<li>å»é‡æ—¶è¦æ³¨æ„æ•°ç»„è¶Šç•Œ</li>
</ul>
</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><strong>ä¸¤æ•°ä¹‹å’Œ</strong>ï¼šæœ¬é¢˜çš„åŸºç¡€</li>
<li><strong>å››æ•°ä¹‹å’Œ</strong>ï¼šå¯ä»¥ç”¨ç±»ä¼¼çš„æ€è·¯ï¼Œå›ºå®šä¸¤ä¸ªæ•°ï¼ŒåŒæŒ‡é’ˆæ‰¾å¦å¤–ä¸¤ä¸ªæ•°</li>
<li><strong>æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ</strong>ï¼šåŒæŒ‡é’ˆçš„å˜å½¢åº”ç”¨</li>
</ul>
<p>è¿™é“é¢˜æ˜¯åŒæŒ‡é’ˆæŠ€å·§çš„ç»å…¸åº”ç”¨ï¼ŒæŒæ¡äº†è¿™ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥è§£å†³å¾ˆå¤šç±»ä¼¼çš„é—®é¢˜ï¼</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis å¤§Keyå¯¹æŒä¹…åŒ–æ€§èƒ½çš„å½±å“åˆ†æä¸ä¼˜åŒ–ç­–ç•¥</title>
    <url>/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/BIGKEY/</url>
    <content><![CDATA[<h1>Redis å¤§ Key å¯¹æŒä¹…åŒ–æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</h1>
<p>æœ‰ä½è¯»è€…åœ¨å­—èŠ‚è·³åŠ¨ä¸€äºŒé¢æ—¶ï¼Œè¢«é—®åˆ°ï¼š<strong>Redis çš„å¤§ Key å¯¹æŒä¹…åŒ–æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</strong></p>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå®é™…çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›ç‰¹åˆ«å¤§çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªåŒ…å«å‡ ä¸‡æ¡è®°å½•çš„åˆ—è¡¨ï¼Œæˆ–è€…ä¸€ä¸ªå‡ MBçš„å­—ç¬¦ä¸²ã€‚è¿™äº›&quot;å¤§å®¶ä¼™&quot;ä¼šç»™Redisçš„æ•°æ®æŒä¹…åŒ–å¸¦æ¥ä»€ä¹ˆéº»çƒ¦å‘¢ï¼Ÿ</p>
<p>Redis æœ‰ä¸¤ç§æŠŠæ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜çš„æ–¹å¼ï¼š<strong>AOF æ—¥å¿—</strong>å’Œ <strong>RDB å¿«ç…§</strong>ã€‚å°±åƒæˆ‘ä»¬å¹³æ—¶æ—¢ä¼šå†™æ—¥è®°è®°å½•æ¯å¤©åšäº†ä»€ä¹ˆï¼ˆAOFï¼‰ï¼Œä¹Ÿä¼šå®šæœŸæ‹ç…§ç•™å¿µï¼ˆRDBï¼‰ä¸€æ ·ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«çœ‹çœ‹å¤§Keyæ˜¯å¦‚ä½•å½±å“è¿™ä¸¤ç§æŒä¹…åŒ–æ–¹å¼çš„ã€‚</p>
<h2 id="å¤§-Key-å¯¹-AOF-æ—¥å¿—çš„å½±å“">å¤§ Key å¯¹ AOF æ—¥å¿—çš„å½±å“</h2>
<h3 id="AOF-çš„ä¸‰ç§å†™å…¥ç­–ç•¥">AOF çš„ä¸‰ç§å†™å…¥ç­–ç•¥</h3>
<p>é¦–å…ˆè¦äº†è§£ Redis æä¾›çš„ 3 ç§ AOF æ—¥å¿—å†™å›ç¡¬ç›˜çš„ç­–ç•¥ï¼š</p>
<ol>
<li>
<p><strong>Alwaysï¼ˆæ€»æ˜¯å†™å…¥ï¼‰</strong>ï¼šæ¯æ¬¡æ‰§è¡Œå†™æ“ä½œåï¼Œç«‹å³æŠŠæ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜</p>
<ul>
<li>å°±åƒå†™æ—¥è®°æ—¶ï¼Œæ¯å†™ä¸€å¥è¯å°±ä¿å­˜ä¸€æ¬¡æ–‡ä»¶</li>
</ul>
</li>
<li>
<p><strong>Everysecï¼ˆæ¯ç§’å†™å…¥ï¼‰</strong>ï¼šæ¯æ¬¡å†™æ“ä½œåå…ˆæ”¾åˆ°å†…å­˜ç¼“å†²åŒºï¼Œæ¯ç§’ç»Ÿä¸€å†™å…¥ç¡¬ç›˜</p>
<ul>
<li>å°±åƒå†™æ—¥è®°æ—¶ï¼Œå…ˆå†™åœ¨è‰ç¨¿çº¸ä¸Šï¼Œæ¯è¿‡ä¸€æ®µæ—¶é—´å†èªŠå†™åˆ°æ­£å¼çš„æ—¥è®°æœ¬</li>
</ul>
</li>
<li>
<p><strong>Noï¼ˆæ“ä½œç³»ç»Ÿå†³å®šï¼‰</strong>ï¼šå†™æ“ä½œåæ”¾åˆ°å†…å­˜ç¼“å†²åŒºï¼Œè®©æ“ä½œç³»ç»Ÿè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™å†™å…¥ç¡¬ç›˜</p>
<ul>
<li>å°±åƒæŠŠæ—¥è®°æ”¾åœ¨é‚£é‡Œï¼Œä»€ä¹ˆæ—¶å€™æ•´ç†å®Œå…¨çœ‹å¿ƒæƒ…</li>
</ul>
</li>
</ol>
<p>ä¸ºäº†ä¿è¯æ•°æ®çœŸæ­£å†™åˆ°ç¡¬ç›˜ä¸Šï¼Œéœ€è¦è°ƒç”¨ä¸€ä¸ªå« <code>fsync()</code> çš„å‡½æ•°ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆ&quot;å¼ºåˆ¶ä¿å­˜&quot;æŒ‰é’®ã€‚</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/BIGKEY/1748595809942.png" alt="1748595809942"></p>
<h3 id="ä¸åŒç­–ç•¥ä¸‹å¤§Keyçš„å½±å“">ä¸åŒç­–ç•¥ä¸‹å¤§Keyçš„å½±å“</h3>
<p><strong>Always ç­–ç•¥çš„é—®é¢˜æœ€ä¸¥é‡</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡æ“ä½œå¤§Keyæ—¶ï¼Œä¸»çº¿ç¨‹å¿…é¡»ç­‰å¾… <code>fsync()</code> å‡½æ•°æ‰§è¡Œå®Œæˆ</li>
<li><strong>å°±åƒä½ è¦æŠŠä¸€æœ¬åšåšçš„ä¹¦å®Œæ•´æŠ„å†™ä¸€éï¼Œåœ¨æŠ„å®Œä¹‹å‰ä»€ä¹ˆä¹Ÿä¸èƒ½åš</strong></li>
<li>å¦‚æœå¤§Keyæœ‰å‡ MBå¤§å°ï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿ï¼ŒRedis å°±&quot;å¡&quot;ä½äº†</li>
</ul>
<p><strong>Everysec ç­–ç•¥ç›¸å¯¹è¾ƒå¥½</strong>ï¼š</p>
<ul>
<li>å› ä¸º <code>fsync()</code> æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼ˆåœ¨åå°è¿›è¡Œï¼‰ï¼Œä¸»çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡</li>
<li>å°±åƒæœ‰ä¸ªåŠ©æ‰‹å¸®ä½ æŠ„å†™ï¼Œä½ å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ…</li>
</ul>
<p><strong>No ç­–ç•¥ä¸å—å½±å“</strong>ï¼š</p>
<ul>
<li>ä»ä¸ä¸»åŠ¨è°ƒç”¨ <code>fsync()</code>ï¼Œæ‰€ä»¥ä¸ä¼šå› ä¸ºå¤§Keyè€Œé˜»å¡ä¸»çº¿ç¨‹</li>
</ul>
<blockquote>
<p><strong>å°ç»“</strong>ï¼šå¦‚æœä½¿ç”¨ Always ç­–ç•¥ï¼Œå¤§Keyä¼šè®©Redisä¸»çº¿ç¨‹&quot;å¡&quot;å¾ˆä¹…ï¼›å…¶ä»–ä¸¤ç§ç­–ç•¥å½±å“è¾ƒå°ã€‚</p>
</blockquote>
<h2 id="å¤§-Key-å¯¹-AOF-é‡å†™å’Œ-RDB-çš„å½±å“">å¤§ Key å¯¹ AOF é‡å†™å’Œ RDB çš„å½±å“</h2>
<h3 id="ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘é—®é¢˜ï¼Ÿ">ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘é—®é¢˜ï¼Ÿ</h3>
<p>å½“AOFæ—¥å¿—æ–‡ä»¶å› ä¸ºè®°å½•äº†å¾ˆå¤šå¤§Keyè€Œå˜å¾—å¾ˆå¤§æ—¶ï¼ŒRedisä¼šå¯åŠ¨ <strong>AOF é‡å†™æœºåˆ¶</strong> æ¥å‹ç¼©æ–‡ä»¶å¤§å°ã€‚</p>
<p>æ— è®ºæ˜¯AOFé‡å†™è¿˜æ˜¯RDBå¿«ç…§ï¼Œéƒ½éœ€è¦é€šè¿‡ <code>fork()</code> å‡½æ•°åˆ›å»ºä¸€ä¸ª&quot;å­è¿›ç¨‹&quot;æ¥å¤„ç†ã€‚ä½ å¯ä»¥æŠŠè¿™ç†è§£ä¸ºï¼š<strong>Redis ä¸»çº¿ç¨‹è¦&quot;å…‹éš†&quot;ä¸€ä¸ªè‡ªå·±å‡ºæ¥ä¸“é—¨å¹²æ´»ï¼Œè‡ªå·±ç»§ç»­æ¥å¾…å®¢æˆ·</strong>ã€‚</p>
<h3 id="fork-è¿‡ç¨‹ä¸­çš„é—®é¢˜">fork è¿‡ç¨‹ä¸­çš„é—®é¢˜</h3>
<h4 id="ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¤åˆ¶é¡µè¡¨è€—æ—¶">ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¤åˆ¶é¡µè¡¨è€—æ—¶</h4>
<p>åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„&quot;é¡µè¡¨&quot;ï¼ˆä¸€ä¸ªè®°å½•è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€å¯¹åº”å…³ç³»çš„è¡¨æ ¼ï¼‰ã€‚</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/BIGKEY/1748595821849.png" alt="1748595821849"></p>
<p><strong>ç®€å•ç±»æ¯”</strong>ï¼š</p>
<ul>
<li>æƒ³è±¡Redisçš„å†…å­˜å°±åƒä¸€ä¸ªå¤§å›¾ä¹¦é¦†</li>
<li>é¡µè¡¨å°±åƒå›¾ä¹¦é¦†çš„ç´¢å¼•ç›®å½•ï¼Œè®°å½•ç€&quot;ç¬¬å‡ æœ¬ä¹¦åœ¨ç¬¬å‡ ä¸ªä¹¦æ¶&quot;</li>
<li>åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œéœ€è¦æŠŠè¿™ä¸ªç›®å½•å®Œæ•´å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹</li>
<li><strong>å¦‚æœRediså­˜å‚¨äº†å¾ˆå¤šå¤§Keyï¼Œå°±åƒå›¾ä¹¦é¦†è—ä¹¦ç‰¹åˆ«å¤šï¼Œç´¢å¼•ç›®å½•å°±ä¼šå¾ˆåšï¼Œå¤åˆ¶èµ·æ¥å°±å¾ˆæ…¢</strong></li>
</ul>
<p><strong>å…·ä½“å½±å“</strong>ï¼š</p>
<ul>
<li>é¡µè¡¨è¶Šå¤§ï¼Œå¤åˆ¶æ—¶é—´è¶Šé•¿</li>
<li>å¤åˆ¶æœŸé—´ï¼ŒRedis ä¸»çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œæ— æ³•å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</li>
<li>å¯ä»¥é€šè¿‡ <code>info</code> å‘½ä»¤æŸ¥çœ‹ <code>latest_fork_usec</code> æŒ‡æ ‡æ¥äº†è§£æœ€è¿‘ä¸€æ¬¡ fork è€—æ—¶</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># æœ€è¿‘ä¸€æ¬¡ fork æ“ä½œè€—æ—¶ï¼ˆå¾®ç§’ï¼‰</span><br><span class="line">latest_fork_usec:<span class="number">315</span></span><br></pre></td></tr></table></figure>
<h4 id="ç¬¬äºŒä¸ªé—®é¢˜ï¼šå†™æ—¶å¤åˆ¶æœºåˆ¶">ç¬¬äºŒä¸ªé—®é¢˜ï¼šå†™æ—¶å¤åˆ¶æœºåˆ¶</h4>
<p>fork å®Œæˆåï¼Œçˆ¶å­è¿›ç¨‹å…±äº«åŒä¸€ä»½ç‰©ç†å†…å­˜ï¼Œä½†éƒ½æ ‡è®°ä¸º&quot;åªè¯»&quot;ã€‚å½“ä»»ä½•ä¸€æ–¹è¦ä¿®æ”¹æ•°æ®æ—¶ï¼Œå°±ä¼šè§¦å‘&quot;<strong>å†™æ—¶å¤åˆ¶</strong>&quot;æœºåˆ¶ã€‚</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/BIGKEY/1748595832830.png" alt="1748595832830"></p>
<p><strong>ç”Ÿæ´»åŒ–ç±»æ¯”</strong>ï¼š</p>
<ul>
<li>æƒ³è±¡ä½ å’Œå®¤å‹å…±ç”¨ä¸€æœ¬èœè°±ï¼ˆå…±äº«å†…å­˜ï¼‰</li>
<li>ä¸€å¼€å§‹å¤§å®¶éƒ½åªæ˜¯çœ‹çœ‹ï¼ˆåªè¯»çŠ¶æ€ï¼‰</li>
<li>å½“ä½ æƒ³åœ¨èœè°±ä¸Šåšç¬”è®°æ—¶ï¼ˆå†™æ“ä½œï¼‰ï¼Œå°±å¿…é¡»æŠŠè¿™ä¸€é¡µå®Œæ•´å¤å°ä¸€ä»½ç»™è‡ªå·±ç”¨ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰</li>
<li><strong>å¦‚æœè¦ä¿®æ”¹çš„æ˜¯ä¸€é“å¾ˆå¤æ‚çš„èœè°±ï¼ˆå¤§Keyï¼‰ï¼Œå¤å°çš„æ—¶é—´å°±ä¼šå¾ˆé•¿</strong></li>
</ul>
<p><strong>å®é™…å½±å“</strong>ï¼š</p>
<ul>
<li>å¦‚æœçˆ¶è¿›ç¨‹ä¿®æ”¹äº†å¤§Keyï¼Œéœ€è¦å¤åˆ¶å¯¹åº”çš„ç‰©ç†å†…å­˜</li>
<li>å¤§Keyå ç”¨çš„å†…å­˜è¶Šå¤§ï¼Œå¤åˆ¶æ—¶é—´è¶Šé•¿</li>
<li>å¤åˆ¶æœŸé—´ï¼Œçˆ¶è¿›ç¨‹ï¼ˆRedisä¸»çº¿ç¨‹ï¼‰ä¼šè¢«é˜»å¡</li>
</ul>
<h3 id="å†…å­˜å¤§é¡µçš„é¢å¤–å½±å“">å†…å­˜å¤§é¡µçš„é¢å¤–å½±å“</h3>
<p>Linuxç³»ç»Ÿæœ‰ä¸ª&quot;å†…å­˜å¤§é¡µ&quot;åŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹å†…å­˜æŒ‰4KBä¸ºå•ä½åˆ†é…ï¼Œå¼€å¯å¤§é¡µåæŒ‰2MBä¸ºå•ä½åˆ†é…ã€‚</p>
<p><strong>é—®é¢˜åœ¨å“ªé‡Œ</strong>ï¼Ÿ</p>
<ul>
<li>æ­£å¸¸æƒ…å†µï¼šä¿®æ”¹100Bæ•°æ®ï¼Œåªéœ€å¤åˆ¶4KBå†…å­˜é¡µ</li>
<li>å¼€å¯å¤§é¡µï¼šä¿®æ”¹100Bæ•°æ®ï¼Œéœ€è¦å¤åˆ¶æ•´ä¸ª2MBå¤§é¡µ</li>
<li><strong>ç›¸å½“äºæœ¬æ¥åªéœ€è¦å¤å°ä¸€å°æ®µæ–‡å­—ï¼Œç°åœ¨è¦å¤å°æ•´å¼ A4çº¸ï¼Œæ•ˆç‡å·®äº†512å€ï¼</strong></li>
</ul>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå…³é—­å†…å­˜å¤§é¡µï¼ˆé»˜è®¤å·²å…³é—­ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br></pre></td></tr></table></figure>
<h3 id="ä¼˜åŒ–å»ºè®®">ä¼˜åŒ–å»ºè®®</h3>
<p>å¦‚æœå‘ç° fork è€—æ—¶å¾ˆé•¿ï¼ˆæ¯”å¦‚è¶…è¿‡1ç§’ï¼‰ï¼Œå¯ä»¥è¿™æ ·ä¼˜åŒ–ï¼š</p>
<ol>
<li><strong>æ§åˆ¶å®ä¾‹å¤§å°</strong>ï¼šå•ä¸ªRediså®ä¾‹å†…å­˜æ§åˆ¶åœ¨10GBä»¥ä¸‹</li>
<li><strong>å…³é—­ä¸å¿…è¦çš„æŒä¹…åŒ–</strong>ï¼šå¦‚æœåªå½“ç¼“å­˜ç”¨ï¼Œå¯ä»¥å…³é—­AOFå’ŒAOFé‡å†™</li>
<li><strong>è°ƒæ•´ä¸»ä»é…ç½®</strong>ï¼šé€‚å½“è°ƒå¤§ <code>repl-backlog-size</code>ï¼Œé¿å…é¢‘ç¹å…¨é‡åŒæ­¥</li>
</ol>
<blockquote>
<p><strong>å°ç»“</strong>ï¼šå¤§Keyä¼šåœ¨ä¸¤ä¸ªé˜¶æ®µå½±å“Redisï¼šforkæ—¶å¤åˆ¶é¡µè¡¨è€—æ—¶ï¼Œå†™æ—¶å¤åˆ¶æ—¶å¤åˆ¶å†…å­˜è€—æ—¶ã€‚å†…å­˜è¶Šå¤§ï¼Œé—®é¢˜è¶Šä¸¥é‡ã€‚</p>
</blockquote>
<h2 id="å¤§Keyçš„å…¶ä»–å½±å“">å¤§Keyçš„å…¶ä»–å½±å“</h2>
<p>é™¤äº†æŒä¹…åŒ–é—®é¢˜ï¼Œå¤§Keyè¿˜ä¼šå¸¦æ¥ä»¥ä¸‹éº»çƒ¦ï¼š</p>
<h3 id="1-å®¢æˆ·ç«¯è¶…æ—¶">1. å®¢æˆ·ç«¯è¶…æ—¶</h3>
<ul>
<li>Redisæ˜¯å•çº¿ç¨‹å¤„ç†å‘½ä»¤çš„</li>
<li><strong>å°±åƒé“¶è¡Œåªæœ‰ä¸€ä¸ªæŸœå°ï¼Œå¦‚æœå‰é¢æœ‰äººåŠç†å¤æ‚ä¸šåŠ¡ï¼ˆæ“ä½œå¤§Keyï¼‰ï¼Œåé¢çš„äººéƒ½è¦ç­‰</strong></li>
<li>å®¢æˆ·ç«¯ä¼šè§‰å¾—Redis&quot;å¡æ­»&quot;äº†</li>
</ul>
<h3 id="2-ç½‘ç»œé˜»å¡">2. ç½‘ç»œé˜»å¡</h3>
<ul>
<li>æ¯æ¬¡è·å–å¤§Keyä¼šäº§ç”Ÿå¤§é‡ç½‘ç»œæµé‡</li>
<li><strong>ä¾‹å¦‚</strong>ï¼š1MBçš„å¤§Keyï¼Œæ¯ç§’è®¿é—®1000æ¬¡ï¼Œå°±ä¼šäº§ç”Ÿ1000MB/ç§’çš„æµé‡</li>
<li>å¯¹äºæ™®é€šåƒå…†ç½‘å¡æ¥è¯´æ˜¯ç¾éš¾æ€§çš„</li>
</ul>
<h3 id="3-é˜»å¡å·¥ä½œçº¿ç¨‹">3. é˜»å¡å·¥ä½œçº¿ç¨‹</h3>
<ul>
<li>ä½¿ç”¨ <code>DEL</code> åˆ é™¤å¤§Keyæ—¶ä¼šé˜»å¡ä¸»çº¿ç¨‹</li>
<li><strong>å°±åƒæ¸…ç†ä¸€ä¸ªç‰¹åˆ«å¤§çš„åƒåœ¾å †ï¼Œæ¸…ç†æœŸé—´ä»€ä¹ˆéƒ½å¹²ä¸äº†</strong></li>
</ul>
<h3 id="4-å†…å­˜åˆ†å¸ƒä¸å‡">4. å†…å­˜åˆ†å¸ƒä¸å‡</h3>
<ul>
<li>åœ¨é›†ç¾¤ç¯å¢ƒä¸­ï¼Œæœ‰å¤§Keyçš„èŠ‚ç‚¹å†…å­˜å ç”¨æ›´å¤š</li>
<li><strong>å°±åƒç­çº§é‡Œæœ‰å‡ ä¸ªåŒå­¦ä¹¦åŒ…ç‰¹åˆ«é‡ï¼Œè´Ÿæ‹…ä¸å‡</strong></li>
</ul>
<h2 id="å¦‚ä½•é¿å…å¤§Keyé—®é¢˜ï¼Ÿ">å¦‚ä½•é¿å…å¤§Keyé—®é¢˜ï¼Ÿ</h2>
<h3 id="è®¾è®¡é˜¶æ®µé¢„é˜²">è®¾è®¡é˜¶æ®µé¢„é˜²</h3>
<ul>
<li><strong>æœ€é‡è¦</strong>ï¼šåœ¨è®¾è®¡æ—¶å°±æŠŠå¤§Keyæ‹†åˆ†æˆå¤šä¸ªå°Key</li>
<li><strong>ä¾‹å¦‚</strong>ï¼šæŠŠä¸€ä¸ªåŒ…å«ä¸‡æ¡è®°å½•çš„åˆ—è¡¨ï¼Œæ‹†åˆ†æˆå¤šä¸ªå°åˆ—è¡¨</li>
</ul>
<h3 id="è¿ç»´é˜¶æ®µå¤„ç†">è¿ç»´é˜¶æ®µå¤„ç†</h3>
<ol>
<li><strong>å®šæœŸæ£€æŸ¥</strong>ï¼šä½¿ç”¨å·¥å…·å®šæœŸæ‰«æRedisä¸­çš„å¤§Key</li>
<li><strong>å®‰å…¨åˆ é™¤</strong>ï¼šä¸è¦ç”¨ <code>DEL</code> åˆ é™¤å¤§Keyï¼Œæ”¹ç”¨ <code>UNLINK</code>ï¼ˆRedis 4.0+ï¼‰
<ul>
<li><code>DEL</code>ï¼šåŒæ­¥åˆ é™¤ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹</li>
<li><code>UNLINK</code>ï¼šå¼‚æ­¥åˆ é™¤ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹</li>
</ul>
</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p><strong>å¤§Keyå¯¹æŒä¹…åŒ–çš„å½±å“å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼šè¶Šå¤§çš„ä¸œè¥¿ï¼Œå¤„ç†èµ·æ¥è¶Šè´¹æ—¶é—´ã€‚</strong></p>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<ol>
<li><strong>AOF Alwaysç­–ç•¥</strong>ï¼šå¤§Keyå†™å…¥æ—¶ï¼Œfsyncè€—æ—¶é•¿ï¼Œä¸»çº¿ç¨‹è¢«é˜»å¡</li>
<li><strong>AOFé‡å†™å’ŒRDB</strong>ï¼šforkæ—¶å¤åˆ¶é¡µè¡¨è€—æ—¶ï¼Œå†™æ—¶å¤åˆ¶æ—¶å¤åˆ¶å†…å­˜è€—æ—¶</li>
<li><strong>ä¼˜åŒ–åŸåˆ™</strong>ï¼šæ§åˆ¶Keyå¤§å°ï¼Œåˆç†é…ç½®æŒä¹…åŒ–ç­–ç•¥ï¼Œå®šæœŸç›‘æ§æ€§èƒ½æŒ‡æ ‡</li>
</ol>
<p>è®°ä½ï¼š<strong>é¢„é˜²èƒœäºæ²»ç–—ï¼Œåœ¨è®¾è®¡é˜¶æ®µå°±é¿å…å¤§Keyæ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆï¼</strong></p>
<p>å®Œï¼</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æŒä¹…åŒ–</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>Redis</tag>
        <tag>AOF</tag>
        <tag>æŒä¹…åŒ–</tag>
        <tag>BIGKEY</tag>
        <tag>RDB</tag>
        <tag>å†™æ—¶å¤åˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis RDB å¿«ç…§æŒä¹…åŒ–ï¼šåŸç†ã€ä¼˜åŒ–ä¸æ··åˆæŒä¹…åŒ–</title>
    <url>/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/RDB/</url>
    <content><![CDATA[<h1>Redis RDB å¿«ç…§ï¼šç»™å†…å­˜æ•°æ®æ‹ä¸ª&quot;ç…§ç‰‡&quot;</h1>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æ—å“¥ï¼</p>
<p>æƒ³è±¡ä¸€ä¸‹ä½ åœ¨æ—…æ¸¸æ—¶æ‹ç…§ç‰‡ğŸ“·ï¼Œæ¯å¼ ç…§ç‰‡éƒ½è®°å½•äº†é‚£ä¸€ç¬é—´çš„ç¾å¥½ç”»é¢ã€‚Redis çš„ RDB å¿«ç…§å°±åƒç»™å†…å­˜æ•°æ®æ‹ç…§ç‰‡ä¸€æ ·ï¼ŒæŠŠæŸä¸ªæ—¶åˆ»å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®å®Œæ•´åœ°ä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯RDBå¿«ç…§ï¼Ÿ">ä»€ä¹ˆæ˜¯RDBå¿«ç…§ï¼Ÿ</h2>
<p>Redis è™½ç„¶æ˜¯å†…å­˜æ•°æ®åº“ï¼Œä½†ä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå®ƒæä¾›äº†ä¸¤ç§æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>AOF æ—¥å¿—</strong>ï¼šè®°å½•æ¯ä¸ªæ“ä½œå‘½ä»¤ï¼Œå°±åƒè®°å½•æ—¥è®°ğŸ“</li>
<li><strong>RDB å¿«ç…§</strong>ï¼šç›´æ¥ä¿å­˜æ•°æ®æœ¬èº«ï¼Œå°±åƒæ‹ç…§ç‰‡ğŸ“¸</li>
</ul>
<p><strong>ç®€å•å¯¹æ¯”ï¼š</strong></p>
<ul>
<li>RDB ä¿å­˜çš„æ˜¯æ•°æ®çš„&quot;ç…§ç‰‡&quot;ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰</li>
<li>AOF ä¿å­˜çš„æ˜¯æ“ä½œçš„&quot;æ—¥è®°&quot;ï¼ˆå‘½ä»¤æ—¥å¿—ï¼‰</li>
</ul>
<p><strong>æ¢å¤é€Ÿåº¦å¯¹æ¯”ï¼š</strong></p>
<ul>
<li>RDBï¼šç›´æ¥æŠŠ&quot;ç…§ç‰‡&quot;æ”¾å›å†…å­˜ï¼Œé€Ÿåº¦å¿«âš¡</li>
<li>AOFï¼šè¦é‡æ–°æ‰§è¡Œ&quot;æ—¥è®°&quot;é‡Œçš„æ¯ä¸ªå‘½ä»¤ï¼Œé€Ÿåº¦æ…¢ğŸŒ</li>
</ul>
<h2 id="RDBå¿«ç…§æ€ä¹ˆç”¨ï¼Ÿ">RDBå¿«ç…§æ€ä¹ˆç”¨ï¼Ÿ</h2>
<p>Redis æä¾›äº†ä¸¤ä¸ªæ‹ç…§å‘½ä»¤ï¼š</p>
<h3 id="1-save-å‘½ä»¤-åŒæ­¥æ‹ç…§">1. save å‘½ä»¤ - åŒæ­¥æ‹ç…§</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">save</span><br></pre></td></tr></table></figure>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ</li>
<li>æ‹ç…§æœŸé—´Redisè¢«&quot;å†»ä½&quot;ï¼Œæ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚â„ï¸</li>
<li>é€‚åˆï¼šRediså³å°†å…³é—­æ—¶ä½¿ç”¨</li>
</ul>
<h3 id="2-bgsave-å‘½ä»¤-å¼‚æ­¥æ‹ç…§ï¼ˆæ¨èï¼‰">2. bgsave å‘½ä»¤ - å¼‚æ­¥æ‹ç…§ï¼ˆæ¨èï¼‰</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bgsave</span><br></pre></td></tr></table></figure>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>åˆ›å»ºå­è¿›ç¨‹å»æ‹ç…§</li>
<li>ä¸»çº¿ç¨‹ç»§ç»­å·¥ä½œï¼Œä¸å½±å“ç”¨æˆ·è¯·æ±‚âœ…</li>
<li>é€‚åˆï¼šæ—¥å¸¸ä½¿ç”¨</li>
</ul>
<h3 id="3-è‡ªåŠ¨æ‹ç…§è®¾ç½®">3. è‡ªåŠ¨æ‹ç…§è®¾ç½®</h3>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è‡ªåŠ¨æ‹ç…§æ¡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 900ç§’å†…æœ‰1æ¬¡ä¿®æ”¹å°±æ‹ç…§</span></span><br><span class="line">save 900 1</span><br><span class="line"><span class="comment"># 300ç§’å†…æœ‰10æ¬¡ä¿®æ”¹å°±æ‹ç…§</span></span><br><span class="line">save 300 10  </span><br><span class="line"><span class="comment"># 60ç§’å†…æœ‰10000æ¬¡ä¿®æ”¹å°±æ‹ç…§</span></span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong> è™½ç„¶é…ç½®åå«<code>save</code>ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯<code>bgsave</code></p>
<p><strong>æ‹ç…§é¢‘ç‡çš„æƒè¡¡ï¼š</strong></p>
<ul>
<li>ğŸ”„ <strong>é¢‘ç‡å¤ªé«˜</strong>ï¼šå½±å“æ€§èƒ½ï¼Œå ç”¨èµ„æºå¤š</li>
<li>ğŸ”„ <strong>é¢‘ç‡å¤ªä½</strong>ï¼šæ•…éšœæ—¶ä¸¢å¤±æ•°æ®å¤š</li>
<li>ğŸ“‹ <strong>å»ºè®®</strong>ï¼šè‡³å°‘5åˆ†é’Ÿæ‹ä¸€æ¬¡ï¼Œæœ€å¤šå¯èƒ½ä¸¢å¤±5åˆ†é’Ÿæ•°æ®</li>
</ul>
<h2 id="æ‹ç…§æ—¶æ•°æ®è¿˜èƒ½ä¿®æ”¹å—ï¼Ÿ">æ‹ç…§æ—¶æ•°æ®è¿˜èƒ½ä¿®æ”¹å—ï¼Ÿ</h2>
<p><strong>é—®é¢˜ï¼š</strong> bgsave æ‹ç…§æœŸé—´ï¼Œç”¨æˆ·è¿˜èƒ½ä¿®æ”¹æ•°æ®å—ï¼Ÿ</p>
<p><strong>ç­”æ¡ˆï¼š</strong> èƒ½ï¼è¿™å¾—ç›Šäºä¸€ä¸ªå·§å¦™çš„æŠ€æœ¯â€”â€”<strong>å†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰</strong></p>
<h3 id="å†™æ—¶å¤åˆ¶æŠ€æœ¯åŸç†">å†™æ—¶å¤åˆ¶æŠ€æœ¯åŸç†</h3>
<p>ç”¨ä¸€ä¸ªç”Ÿæ´»åŒ–çš„æ¯”å–»æ¥ç†è§£ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ï¼š</p>
<p><strong>åœºæ™¯ï¼š</strong> çˆ¸çˆ¸è¦ç»™å…¨å®¶ç¦æ‹ç…§ï¼Œä½†æ˜¯æ‹ç…§æœŸé—´å­©å­ä»¬è¿˜è¦ç»§ç»­ç©è€</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li><strong>å…±äº«é˜¶æ®µ</strong>ï¼šæ‹ç…§å¼€å§‹æ—¶ï¼Œçˆ¸çˆ¸å’Œå­©å­ä»¬åœ¨åŒä¸€ä¸ªæˆ¿é—´</li>
<li><strong>ä¸å˜çš„æƒ…å†µ</strong>ï¼šå¦‚æœå­©å­ä»¬åªæ˜¯å®‰é™åœ°çœ‹ï¼Œå¤§å®¶ç»§ç»­åœ¨ä¸€ä¸ªæˆ¿é—´</li>
<li><strong>æœ‰å˜åŒ–çš„æƒ…å†µ</strong>ï¼šå¦‚æœæŸä¸ªå­©å­è¦é‡æ–°æ‘†å§¿åŠ¿ï¼Œå°±æŠŠä»–/å¥¹å¸¦åˆ°å¦ä¸€ä¸ªæˆ¿é—´</li>
</ol>
<p><strong>æŠ€æœ¯å®ç°ï¼š</strong></p>
<h4 id="ç¬¬1æ­¥ï¼šåˆ›å»ºå­è¿›ç¨‹ï¼ˆå¼€å§‹æ‹ç…§ï¼‰">ç¬¬1æ­¥ï¼šåˆ›å»ºå­è¿›ç¨‹ï¼ˆå¼€å§‹æ‹ç…§ï¼‰</h4>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/RDB/1748595701878.png" alt="1748595701878"></p>
<ul>
<li>çˆ¶è¿›ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰å’Œå­è¿›ç¨‹æœ€åˆå…±äº«åŒä¸€å—å†…å­˜</li>
<li>å°±åƒçˆ¸çˆ¸å’Œå­©å­ä»¬åœ¨åŒä¸€ä¸ªæˆ¿é—´</li>
</ul>
<h4 id="ç¬¬2æ­¥ï¼šå‘ç”Ÿæ•°æ®ä¿®æ”¹ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰">ç¬¬2æ­¥ï¼šå‘ç”Ÿæ•°æ®ä¿®æ”¹ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰</h4>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/RDB/1748595710392.png" alt="1748595710392"></p>
<p>å½“éœ€è¦ä¿®æ”¹æ•°æ®æ—¶ï¼š</p>
<ul>
<li>ç³»ç»Ÿä¼šå¤åˆ¶ä¸€ä»½æ•°æ®ç»™çˆ¶è¿›ç¨‹</li>
<li>çˆ¶è¿›ç¨‹åœ¨æ–°æ•°æ®ä¸Šä¿®æ”¹</li>
<li>å­è¿›ç¨‹ç»§ç»­ä½¿ç”¨åŸæ•°æ®æ‹ç…§</li>
</ul>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong><br>
âœ… æ‹ç…§ä¸ä¼šé˜»å¡æ­£å¸¸ä¸šåŠ¡<br>
âœ… èŠ‚çœå†…å­˜ï¼ˆåªåœ¨ä¿®æ”¹æ—¶æ‰å¤åˆ¶ï¼‰<br>
âœ… ä¿è¯æ‹ç…§æ•°æ®çš„ä¸€è‡´æ€§</p>
<h3 id="âš ï¸-æ³¨æ„äº‹é¡¹">âš ï¸ æ³¨æ„äº‹é¡¹</h3>
<p><strong>å†…å­˜å ç”¨é£é™©ï¼š</strong></p>
<ul>
<li>æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ‹ç…§æœŸé—´æ‰€æœ‰æ•°æ®éƒ½è¢«ä¿®æ”¹</li>
<li>å†…å­˜å ç”¨å¯èƒ½è¾¾åˆ°åŸæ¥çš„2å€ï¼</li>
<li><strong>å»ºè®®ï¼š</strong> å†™æ“ä½œé¢‘ç¹æ—¶è¦ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
</ul>
<p><strong>æ•°æ®æ—¶æ•ˆæ€§ï¼š</strong></p>
<ul>
<li>RDBä¿å­˜çš„æ˜¯æ‹ç…§é‚£ä¸€ç¬é—´çš„æ•°æ®</li>
<li>æ‹ç…§æœŸé—´çš„ä¿®æ”¹ä¸ä¼šè¢«ä¿å­˜</li>
<li>åªèƒ½ç­‰ä¸‹æ¬¡æ‹ç…§æ‰èƒ½ä¿å­˜æ–°çš„ä¿®æ”¹</li>
</ul>
<h2 id="RDB-AOF-æ··åˆæŒä¹…åŒ–ï¼šé±¼å’Œç†ŠæŒå…¼å¾—">RDB + AOF æ··åˆæŒä¹…åŒ–ï¼šé±¼å’Œç†ŠæŒå…¼å¾—</h2>
<h3 id="å•ç‹¬ä½¿ç”¨çš„é—®é¢˜">å•ç‹¬ä½¿ç”¨çš„é—®é¢˜</h3>
<p><strong>RDBçš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>âŒ å¯èƒ½ä¸¢å¤±è¾ƒå¤šæ•°æ®ï¼ˆä¸¤æ¬¡æ‹ç…§é—´éš”å†…çš„æ•°æ®ï¼‰</li>
<li>âœ… æ¢å¤é€Ÿåº¦å¿«</li>
</ul>
<p><strong>AOFçš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>âœ… ä¸¢å¤±æ•°æ®å°‘ï¼ˆæœ€å¤š1ç§’ï¼‰</li>
<li>âŒ æ¢å¤é€Ÿåº¦æ…¢</li>
</ul>
<h3 id="æ··åˆæŒä¹…åŒ–ï¼šå®Œç¾ç»“åˆ">æ··åˆæŒä¹…åŒ–ï¼šå®Œç¾ç»“åˆ</h3>
<p><strong>å¼€å¯æ–¹å¼ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨redis.confä¸­è®¾ç½®</span></span><br><span class="line">aof-use-rdb-preamble <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
<p><strong>å·¥ä½œåŸç†ï¼š</strong><br>
<img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/RDB/1748595726282.png" alt="1748595726282"></p>
<p>æ··åˆæŒä¹…åŒ–ç”Ÿæˆçš„AOFæ–‡ä»¶ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[RDBæ ¼å¼æ•°æ®] + [AOFæ ¼å¼å¢é‡æ•°æ®]</span><br></pre></td></tr></table></figure>
<p><strong>å…·ä½“æµç¨‹ï¼š</strong></p>
<ol>
<li><strong>AOFé‡å†™æ—¶</strong>ï¼šå…ˆæŠŠå½“å‰å†…å­˜æ•°æ®ç”¨RDBæ ¼å¼å†™å…¥</li>
<li><strong>é‡å†™æœŸé—´</strong>ï¼šæ–°çš„æ“ä½œå‘½ä»¤ç”¨AOFæ ¼å¼è¿½åŠ </li>
<li><strong>æœ€ç»ˆç»“æœ</strong>ï¼šä¸€ä¸ªæ–‡ä»¶åŒ…å«RDBå¿«ç…§+AOFå¢é‡</li>
</ol>
<p><strong>æ··åˆæŒä¹…åŒ–çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>ğŸš€ <strong>æ¢å¤å¿«</strong>ï¼šå…ˆå¿«é€ŸåŠ è½½RDBéƒ¨åˆ†</li>
<li>ğŸ›¡ï¸ <strong>ä¸¢å¤±å°‘</strong>ï¼šå†åŠ è½½AOFå¢é‡éƒ¨åˆ†</li>
<li>ğŸ’¾ <strong>æ–‡ä»¶å°</strong>ï¼šRDBéƒ¨åˆ†å‹ç¼©ç‡é«˜</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>RDB</th>
<th>AOF</th>
<th>æ··åˆæŒä¹…åŒ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¢å¤é€Ÿåº¦</td>
<td>å¿«âš¡</td>
<td>æ…¢ğŸŒ</td>
<td>å¿«âš¡</td>
</tr>
<tr>
<td>æ•°æ®å®Œæ•´æ€§</td>
<td>ä¸€èˆ¬ğŸ˜</td>
<td>å¥½ğŸ˜Š</td>
<td>å¥½ğŸ˜Š</td>
</tr>
<tr>
<td>æ–‡ä»¶å¤§å°</td>
<td>å°ğŸ“¦</td>
<td>å¤§ğŸ“‚</td>
<td>ä¸­ç­‰ğŸ“‹</td>
</tr>
<tr>
<td>æ€§èƒ½å½±å“</td>
<td>ä½ğŸ’š</td>
<td>ä¸­ç­‰ğŸ’›</td>
<td>ä½ğŸ’š</td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨å»ºè®®ï¼š</strong></p>
<ul>
<li>ğŸ¯ <strong>é«˜æ€§èƒ½åœºæ™¯</strong>ï¼šå•ç‹¬ä½¿ç”¨RDB</li>
<li>ğŸ›¡ï¸ <strong>é«˜å¯é æ€§åœºæ™¯</strong>ï¼šå•ç‹¬ä½¿ç”¨AOF</li>
<li>ğŸ† <strong>ç”Ÿäº§ç¯å¢ƒæ¨è</strong>ï¼šå¼€å¯æ··åˆæŒä¹…åŒ–ï¼Œå…¼é¡¾æ€§èƒ½å’Œå¯é æ€§</li>
</ul>
<p>è®°ä½ï¼šæ•°æ®æŒä¹…åŒ–å°±åƒå¤‡ä»½é‡è¦æ–‡ä»¶ï¼Œé€‰æ‹©åˆé€‚çš„ç­–ç•¥æ‰èƒ½åœ¨æ€§èƒ½å’Œå®‰å…¨ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ï¼ğŸ“šâœ¨</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æŒä¹…åŒ–</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>Redis</tag>
        <tag>æŒä¹…åŒ–</tag>
        <tag>RDB</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis AOF æŒä¹…åŒ–è¯¦è§£ï¼šå°±åƒç»™æ•°æ®åº“å†™æ—¥è®°ä¸€æ ·ç®€å•</title>
    <url>/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/</url>
    <content><![CDATA[<h1>Redis AOF æŒä¹…åŒ–ï¼šç»™æ•°æ®åº“å†™&quot;æ—¥è®°&quot;</h1>
<h2 id="ä»€ä¹ˆæ˜¯AOFï¼Ÿä¸€ä¸ªç®€å•çš„æ¯”å–»">ä»€ä¹ˆæ˜¯AOFï¼Ÿä¸€ä¸ªç®€å•çš„æ¯”å–»</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ¯å¤©éƒ½åœ¨è®°æ—¥è®°ï¼ŒæŠŠä»Šå¤©åšäº†ä»€ä¹ˆäº‹æƒ…éƒ½è¯¦ç»†è®°å½•ä¸‹æ¥ï¼š</p>
<ul>
<li>â€œä»Šå¤©ä¹°äº†ä¸€ä¸ªè‹¹æœâ€</li>
<li>â€œæŠŠè‹¹æœåƒæ‰äº†â€</li>
<li>â€œåˆä¹°äº†ä¸€ä¸ªæ©™å­â€</li>
</ul>
<p>å¦‚æœæœ‰ä¸€å¤©ä½ å¤±å¿†äº†ï¼Œåªè¦ç¿»çœ‹æ—¥è®°ï¼ŒæŒ‰ç…§ä¸Šé¢è®°å½•çš„äº‹æƒ…é‡æ–°åšä¸€éï¼Œå°±èƒ½æ¢å¤åˆ°å¤±å¿†å‰çš„çŠ¶æ€ã€‚</p>
<p><strong>Redisçš„AOFæŒä¹…åŒ–å°±æ˜¯è¿™ä¸ªé“ç†ï¼</strong></p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595527508.png" alt="1748595527508"></p>
<p>AOF (Append Only File) å°±æ˜¯Redisçš„&quot;æ—¥è®°æœ¬&quot;ï¼š</p>
<ul>
<li>æ¯å½“æœ‰äººä¿®æ”¹æ•°æ®ï¼ˆå†™æ“ä½œï¼‰ï¼ŒRediså°±æŠŠè¿™ä¸ªæ“ä½œè®°å½•åˆ°AOFæ–‡ä»¶é‡Œ</li>
<li>å¦‚æœRedisé‡å¯äº†ï¼Œå®ƒå°±è¯»å–AOFæ–‡ä»¶ï¼ŒæŠŠé‡Œé¢çš„æ“ä½œé‡æ–°æ‰§è¡Œä¸€é</li>
<li>è¿™æ ·æ•°æ®å°±æ¢å¤äº†ï¼</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šRedisåªè®°å½•&quot;å†™æ“ä½œ&quot;ï¼ˆå¢åˆ æ”¹ï¼‰ï¼Œä¸è®°å½•&quot;è¯»æ“ä½œ&quot;ï¼Œå› ä¸ºè¯»æ“ä½œä¸ä¼šæ”¹å˜æ•°æ®ï¼Œè®°å½•äº†ä¹Ÿæ²¡ç”¨ã€‚</p>
</blockquote>
<h2 id="å¼€å¯AOFåŠŸèƒ½">å¼€å¯AOFåŠŸèƒ½</h2>
<p>AOFåŠŸèƒ½é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œå¼€å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ redis.conf æ–‡ä»¶ä¸­è®¾ç½®</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595534663.png" alt="1748595534663"></p>
<h2 id="AOFæ–‡ä»¶é•¿ä»€ä¹ˆæ ·ï¼Ÿ">AOFæ–‡ä»¶é•¿ä»€ä¹ˆæ ·ï¼Ÿ</h2>
<p>AOFæ–‡ä»¶å…¶å®å°±æ˜¯ä¸ªæ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ã€‚</p>
<p>å½“ä½ æ‰§è¡Œ <code>set name xiaolin</code> è¿™ä¸ªå‘½ä»¤æ—¶ï¼ŒAOFæ–‡ä»¶é‡Œä¼šè®°å½•ï¼š</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595541605.png" alt="1748595541605"></p>
<p>è¿™çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹ï¼š</p>
<ul>
<li><code>*3</code>ï¼šè¡¨ç¤ºè¿™ä¸ªå‘½ä»¤æœ‰3ä¸ªéƒ¨åˆ†</li>
<li><code>$3 set</code>ï¼šè¡¨ç¤ºç¬¬ä¸€éƒ¨åˆ†æ˜¯&quot;set&quot;ï¼Œé•¿åº¦æ˜¯3ä¸ªå­—ç¬¦</li>
<li><code>$4 name</code>ï¼šè¡¨ç¤ºç¬¬äºŒéƒ¨åˆ†æ˜¯&quot;name&quot;ï¼Œé•¿åº¦æ˜¯4ä¸ªå­—ç¬¦</li>
<li><code>$7 xiaolin</code>ï¼šè¡¨ç¤ºç¬¬ä¸‰éƒ¨åˆ†æ˜¯&quot;xiaolin&quot;ï¼Œé•¿åº¦æ˜¯7ä¸ªå­—ç¬¦</li>
</ul>
<p>å°±åƒæ˜¯æŠŠ <code>set name xiaolin</code> è¿™ä¸ªå‘½ä»¤æ‹†è§£å¹¶è¯¦ç»†è®°å½•ä¸‹æ¥ã€‚</p>
<h2 id="AOFçš„ä¸¤ä¸ªä¼˜ç‚¹">AOFçš„ä¸¤ä¸ªä¼˜ç‚¹</h2>
<p>Redisé‡‡ç”¨äº†&quot;<strong>å…ˆæ‰§è¡Œå‘½ä»¤ï¼Œå†è®°å½•æ—¥å¿—</strong>&quot;çš„æ–¹å¼ï¼Œè¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p>
<h3 id="ä¼˜ç‚¹1ï¼šé¿å…è®°å½•é”™è¯¯å‘½ä»¤">ä¼˜ç‚¹1ï¼šé¿å…è®°å½•é”™è¯¯å‘½ä»¤</h3>
<p>å°±åƒå†™æ—¥è®°ä¸€æ ·ï¼Œä½ åªä¼šè®°å½•çœŸæ­£å‘ç”Ÿçš„äº‹æƒ…ã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œå¤±è´¥äº†ï¼ŒRediså°±ä¸ä¼šæŠŠå®ƒå†™è¿›AOFæ–‡ä»¶ï¼Œä¿è¯AOFé‡Œçš„å‘½ä»¤éƒ½æ˜¯æ­£ç¡®çš„ã€‚</p>
<h3 id="ä¼˜ç‚¹2ï¼šä¸å½±å“å½“å‰æ“ä½œçš„é€Ÿåº¦">ä¼˜ç‚¹2ï¼šä¸å½±å“å½“å‰æ“ä½œçš„é€Ÿåº¦</h3>
<p>å› ä¸ºæ˜¯å…ˆæ‰§è¡Œå†è®°å½•ï¼Œæ‰€ä»¥å½“å‰çš„å‘½ä»¤ä¸ä¼šè¢«è®°å½•æ“ä½œæ‹–æ…¢ã€‚</p>
<h2 id="AOFçš„ä¸¤ä¸ªé£é™©">AOFçš„ä¸¤ä¸ªé£é™©</h2>
<p>å½“ç„¶ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæœ‰é£é™©ï¼š</p>
<h3 id="é£é™©1ï¼šæ•°æ®ä¸¢å¤±">é£é™©1ï¼šæ•°æ®ä¸¢å¤±</h3>
<p>å°±åƒå†™æ—¥è®°ä¸€æ ·ï¼Œå¦‚æœä½ åˆšåšå®Œä¸€ä»¶äº‹ï¼Œè¿˜æ²¡æ¥å¾—åŠè®°åˆ°æ—¥è®°é‡Œï¼Œçªç„¶å¤±å¿†äº†ï¼Œè¿™ä»¶äº‹å°±ä¸¢äº†ã€‚</p>
<p>Redisä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¦‚æœåˆšæ‰§è¡Œå®Œå‘½ä»¤ï¼Œè¿˜æ²¡æ¥å¾—åŠå†™å…¥ç¡¬ç›˜ï¼ŒæœåŠ¡å™¨å°±å®•æœºäº†ï¼Œè¿™ä¸ªæ•°æ®å°±ä¸¢äº†ã€‚</p>
<h3 id="é£é™©2ï¼šå¯èƒ½å½±å“ä¸‹ä¸€ä¸ªæ“ä½œ">é£é™©2ï¼šå¯èƒ½å½±å“ä¸‹ä¸€ä¸ªæ“ä½œ</h3>
<p>è™½ç„¶å½“å‰æ“ä½œä¸å—å½±å“ï¼Œä½†å¦‚æœå†™æ—¥è®°çš„è¿‡ç¨‹å¾ˆæ…¢ï¼ˆæ¯”å¦‚ç¡¬ç›˜å¾ˆå¿™ï¼‰ï¼Œå°±ä¼šå½±å“ä¸‹ä¸€ä¸ªæ“ä½œã€‚</p>
<h2 id="ä¸‰ç§å†™å…¥ç­–ç•¥ï¼šä»€ä¹ˆæ—¶å€™æŠŠæ—¥è®°å†™åˆ°ç¡¬ç›˜ï¼Ÿ">ä¸‰ç§å†™å…¥ç­–ç•¥ï¼šä»€ä¹ˆæ—¶å€™æŠŠæ—¥è®°å†™åˆ°ç¡¬ç›˜ï¼Ÿ</h2>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595562255.png" alt="1748595562255"></p>
<p>Rediså†™å…¥AOFçš„è¿‡ç¨‹åˆ†ä¸‰æ­¥ï¼š</p>
<ol>
<li><strong>æ‰§è¡Œå‘½ä»¤</strong>ï¼šæ¯”å¦‚æ‰§è¡Œ <code>set name xiaolin</code></li>
<li><strong>å†™å…¥ç¼“å†²åŒº</strong>ï¼šå…ˆæŠŠå‘½ä»¤å†™åˆ°å†…å­˜çš„ç¼“å†²åŒºé‡Œ</li>
<li><strong>å†™å…¥ç¡¬ç›˜</strong>ï¼šå†ä»ç¼“å†²åŒºå†™åˆ°ç¡¬ç›˜ä¸Š</li>
</ol>
<p>ç¬¬ä¸‰æ­¥&quot;ä»€ä¹ˆæ—¶å€™å†™å…¥ç¡¬ç›˜&quot;æœ‰ä¸‰ç§ç­–ç•¥ï¼š</p>
<h3 id="ç­–ç•¥1ï¼šAlwaysï¼ˆæ€»æ˜¯ç«‹å³å†™å…¥ï¼‰">ç­–ç•¥1ï¼šAlwaysï¼ˆæ€»æ˜¯ç«‹å³å†™å…¥ï¼‰</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šæ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤ï¼Œç«‹å³å†™å…¥ç¡¬ç›˜</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ•°æ®æœ€å®‰å…¨ï¼Œå‡ ä¹ä¸ä¼šä¸¢å¤±</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šé€Ÿåº¦æœ€æ…¢ï¼Œå› ä¸ºæ¯æ¬¡éƒ½è¦ç­‰ç¡¬ç›˜å†™å…¥å®Œæˆ</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¯¹æ•°æ®å®‰å…¨è¦æ±‚æé«˜çš„åœºæ™¯</p>
<h3 id="ç­–ç•¥2ï¼šEverysecï¼ˆæ¯ç§’å†™å…¥ä¸€æ¬¡ï¼‰">ç­–ç•¥2ï¼šEverysecï¼ˆæ¯ç§’å†™å…¥ä¸€æ¬¡ï¼‰</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šæ¯ç§’é’ŸæŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥ç¡¬ç›˜ä¸€æ¬¡</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå¹³è¡¡äº†å®‰å…¨æ€§å’Œæ€§èƒ½</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæœ€å¤šå¯èƒ½ä¸¢å¤±1ç§’çš„æ•°æ®</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§å¤šæ•°åº”ç”¨çš„æ¨èé€‰æ‹©</p>
<h3 id="ç­–ç•¥3ï¼šNoï¼ˆäº¤ç»™æ“ä½œç³»ç»Ÿå†³å®šï¼‰">ç­–ç•¥3ï¼šNoï¼ˆäº¤ç»™æ“ä½œç³»ç»Ÿå†³å®šï¼‰</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šRedisä¸ç®¡ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™å†™å…¥ç¡¬ç›˜</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ€§èƒ½æœ€å¥½</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½ä¸¢å¤±è¾ƒå¤šæ•°æ®</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¯¹æ€§èƒ½è¦æ±‚é«˜ï¼Œèƒ½å®¹å¿æ•°æ®ä¸¢å¤±çš„åœºæ™¯</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595570963.png" alt="1748595570963"></p>
<h3 id="ä¸‰ç§ç­–ç•¥çš„æŠ€æœ¯åŸç†">ä¸‰ç§ç­–ç•¥çš„æŠ€æœ¯åŸç†</h3>
<p>è¿™ä¸‰ç§ç­–ç•¥å…¶å®æ˜¯åœ¨æ§åˆ¶<code>fsync()</code>å‡½æ•°çš„è°ƒç”¨æ—¶æœºï¼š</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595577012.png" alt="1748595577012"></p>
<ul>
<li><strong>Always</strong>ï¼šæ¯æ¬¡å†™å…¥åç«‹å³è°ƒç”¨fsync()</li>
<li><strong>Everysec</strong>ï¼šåˆ›å»ºåå°ä»»åŠ¡æ¯ç§’è°ƒç”¨fsync()</li>
<li><strong>No</strong>ï¼šä»ä¸è°ƒç”¨fsync()ï¼Œè®©æ“ä½œç³»ç»Ÿè‡ªå·±å†³å®š</li>
</ul>
<blockquote>
<p><strong>fsync()å‡½æ•°</strong>ï¼šå‘Šè¯‰æ“ä½œç³»ç»Ÿ&quot;ç°åœ¨ç«‹å³æŠŠæ•°æ®å†™åˆ°ç¡¬ç›˜ä¸Š&quot;ï¼Œä¸è¦å†ç­‰äº†ã€‚</p>
</blockquote>
<h2 id="AOFé‡å†™ï¼šç»™æ—¥è®°æœ¬-ç˜¦èº«">AOFé‡å†™ï¼šç»™æ—¥è®°æœ¬&quot;ç˜¦èº«&quot;</h2>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦é‡å†™ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦é‡å†™ï¼Ÿ</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„æ—¥è®°æœ¬è®°å½•äº†ï¼š</p>
<ul>
<li>â€œä¹°äº†ä¸€ä¸ªè‹¹æœâ€</li>
<li>â€œæŠŠè‹¹æœåƒæ‰äº†â€</li>
<li>â€œåˆä¹°äº†ä¸€ä¸ªè‹¹æœâ€</li>
<li>â€œæŠŠè‹¹æœåˆåƒæ‰äº†â€</li>
<li>â€œå†ä¹°äº†ä¸€ä¸ªè‹¹æœâ€</li>
</ul>
<p>æ—¥è®°æœ¬è¶Šæ¥è¶Šåšï¼Œä½†å…¶å®æœ€åçš„çŠ¶æ€å°±æ˜¯&quot;æœ‰ä¸€ä¸ªè‹¹æœ&quot;ã€‚å¦‚æœé‡å†™æ—¥è®°ï¼Œåªéœ€è¦å†™&quot;æœ‰ä¸€ä¸ªè‹¹æœ&quot;å°±å¤Ÿäº†ã€‚</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595586549.png" alt="1748595586549"></p>
<p><strong>AOFé‡å†™å°±æ˜¯è¿™ä¸ªé“ç†</strong>ï¼š</p>
<ul>
<li>ä¸ç®¡ä¸€ä¸ªæ•°æ®è¢«ä¿®æ”¹äº†å¤šå°‘æ¬¡</li>
<li>é‡å†™æ—¶åªçœ‹å®ƒç°åœ¨çš„æœ€ç»ˆçŠ¶æ€</li>
<li>ç”¨ä¸€æ¡å‘½ä»¤å°±èƒ½è¡¨ç¤ºè¿™ä¸ªçŠ¶æ€</li>
</ul>
<h3 id="é‡å†™çš„å¥½å¤„">é‡å†™çš„å¥½å¤„</h3>
<ol>
<li><strong>AOFæ–‡ä»¶å˜å°</strong>ï¼šå‡å°‘äº†å†—ä½™å‘½ä»¤</li>
<li><strong>æ¢å¤æ•°æ®æ›´å¿«</strong>ï¼šæ‰§è¡Œçš„å‘½ä»¤æ›´å°‘äº†</li>
<li><strong>èŠ‚çœå­˜å‚¨ç©ºé—´</strong>ï¼šæ–‡ä»¶å°äº†ï¼Œå ç”¨ç£ç›˜ç©ºé—´å°‘</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆè¦åˆ›å»ºæ–°æ–‡ä»¶ï¼Ÿ">ä¸ºä»€ä¹ˆè¦åˆ›å»ºæ–°æ–‡ä»¶ï¼Ÿ</h3>
<p>é‡å†™æ—¶ä¸ç›´æ¥ä¿®æ”¹åŸAOFæ–‡ä»¶ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼ŒåŸå› å¾ˆç®€å•ï¼š</p>
<ul>
<li>å¦‚æœé‡å†™è¿‡ç¨‹ä¸­å‡ºé”™äº†ï¼ŒåŸæ–‡ä»¶è¿˜åœ¨ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±</li>
<li>å°±åƒé‡æ–°å†™ä¸€æœ¬æ–°æ—¥è®°ï¼Œå†™åäº†å¤§ä¸äº†æ‰”æ‰ï¼ŒåŸæ¥çš„æ—¥è®°è¿˜åœ¨</li>
</ul>
<h2 id="AOFåå°é‡å†™ï¼šä¸å½±å“æ­£å¸¸æœåŠ¡">AOFåå°é‡å†™ï¼šä¸å½±å“æ­£å¸¸æœåŠ¡</h2>
<h3 id="ä¸ºä»€ä¹ˆè¦åå°é‡å†™ï¼Ÿ">ä¸ºä»€ä¹ˆè¦åå°é‡å†™ï¼Ÿ</h3>
<p>é‡å†™AOFæ–‡ä»¶æ˜¯ä¸ªè€—æ—¶çš„å·¥ä½œï¼Œå°±åƒæ•´ç†ä¸€æœ¬å¾ˆåšçš„æ—¥è®°æœ¬ã€‚å¦‚æœRedisåœä¸‹æ¥ä¸“é—¨åšè¿™ä»¶äº‹ï¼Œå°±æ²¡æ³•å¤„ç†ç”¨æˆ·çš„è¯·æ±‚äº†ã€‚</p>
<p>æ‰€ä»¥Redisé‡‡ç”¨äº†**â€œåˆ†èº«æœ¯â€**ï¼š</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595595181.png" alt="1748595595181"></p>
<ol>
<li><strong>ä¸»è¿›ç¨‹</strong>ï¼šç»§ç»­å¤„ç†ç”¨æˆ·è¯·æ±‚</li>
<li><strong>å­è¿›ç¨‹</strong>ï¼šä¸“é—¨è´Ÿè´£é‡å†™AOFæ–‡ä»¶</li>
</ol>
<h3 id="å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼šç¥å¥‡çš„-åˆ†èº«æœ¯">å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼šç¥å¥‡çš„&quot;åˆ†èº«æœ¯&quot;</h3>
<p>å½“Rediséœ€è¦é‡å†™AOFæ—¶ï¼š</p>
<ol>
<li><strong>åˆ›å»ºå­è¿›ç¨‹</strong>ï¼šRedisåˆ›å»ºä¸€ä¸ª&quot;åˆ†èº«&quot;ï¼ˆå­è¿›ç¨‹ï¼‰</li>
<li><strong>å…±äº«å†…å­˜</strong>ï¼šåˆ†èº«å’Œæœ¬ä½“å…±äº«åŒä¸€ä»½æ•°æ®ï¼ŒèŠ‚çœå†…å­˜</li>
<li><strong>å†™æ—¶å¤åˆ¶</strong>ï¼šå¦‚æœæœ¬ä½“ä¿®æ”¹äº†æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºåˆ†èº«å¤åˆ¶ä¸€ä»½ç‹¬ç«‹çš„æ•°æ®</li>
</ol>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595625080.png" alt="1748595625080"></p>
<p>è¿™å°±åƒæ˜¯ï¼š</p>
<ul>
<li>ä½ å’Œä½ çš„åˆ†èº«å…±äº«ä¸€æœ¬ç¬”è®°æœ¬</li>
<li>å¹³æ—¶ä½ ä»¬éƒ½åªæ˜¯çœ‹ç¬”è®°æœ¬ï¼Œæ²¡é—®é¢˜</li>
<li>å¦‚æœä½ è¦ä¿®æ”¹ç¬”è®°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç»™åˆ†èº«å¤å°ä¸€ä»½ç‹¬ç«‹çš„ç¬”è®°æœ¬</li>
<li>è¿™æ ·ä½ ä»¬å„è‡ªä¿®æ”¹å„è‡ªçš„ï¼Œäº’ä¸å½±å“</li>
</ul>
<h3 id="æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼šæ€ä¹ˆä¿è¯åˆ†èº«çš„æ•°æ®æ˜¯æœ€æ–°çš„ï¼Ÿ">æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼šæ€ä¹ˆä¿è¯åˆ†èº«çš„æ•°æ®æ˜¯æœ€æ–°çš„ï¼Ÿ</h3>
<p>é—®é¢˜æ¥äº†ï¼šåˆ†èº«åœ¨é‡å†™AOFæœŸé—´ï¼Œæœ¬ä½“è¿˜åœ¨å¤„ç†æ–°çš„å‘½ä»¤ï¼Œè¿™æ ·åˆ†èº«çš„æ•°æ®å°±ä¸æ˜¯æœ€æ–°çš„äº†ã€‚</p>
<p>Redisçš„è§£å†³æ–¹æ¡ˆæ˜¯&quot;<strong>åŒå†™</strong>&quot;ï¼š</p>
<p><img src="/2025/05/30/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%8C%81%E4%B9%85%E5%8C%96/AOF/1748595635910.png" alt="1748595635910"></p>
<p>åœ¨é‡å†™æœŸé—´ï¼Œæ¯ä¸ªå†™å‘½ä»¤éƒ½ä¼šè¢«å†™å…¥ä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<ol>
<li><strong>AOFç¼“å†²åŒº</strong>ï¼šæ­£å¸¸çš„AOFæ–‡ä»¶</li>
<li><strong>AOFé‡å†™ç¼“å†²åŒº</strong>ï¼šä¸“é—¨ç»™é‡å†™ç”¨çš„ç¼“å†²åŒº</li>
</ol>
<p>å½“åˆ†èº«å®Œæˆé‡å†™åï¼š</p>
<ol>
<li>åˆ†èº«å‘Šè¯‰æœ¬ä½“ï¼šâ€œæˆ‘å†™å®Œäº†ï¼â€</li>
<li>æœ¬ä½“æŠŠé‡å†™ç¼“å†²åŒºé‡Œçš„æ–°å‘½ä»¤è¿½åŠ åˆ°æ–°AOFæ–‡ä»¶åé¢</li>
<li>ç”¨æ–°AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶</li>
</ol>
<p>è¿™æ ·å°±ä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<h3 id="å“ªäº›æ“ä½œä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Ÿ">å“ªäº›æ“ä½œä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Ÿ</h3>
<p>è™½ç„¶é‡å†™æ˜¯åœ¨åå°è¿›è¡Œçš„ï¼Œä½†æœ‰ä¸¤ä¸ªæ—¶å€™ä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼š</p>
<ol>
<li><strong>åˆ›å»ºå­è¿›ç¨‹æ—¶</strong>ï¼šéœ€è¦å¤åˆ¶é¡µè¡¨ç­‰æ•°æ®ç»“æ„ï¼Œæ•°æ®è¶Šå¤§é˜»å¡æ—¶é—´è¶Šé•¿</li>
<li><strong>å†™æ—¶å¤åˆ¶æ—¶</strong>ï¼šå¦‚æœä¿®æ”¹çš„æ˜¯å¤§æ•°æ®ï¼ˆbigkeyï¼‰ï¼Œå¤åˆ¶å†…å­˜çš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿</li>
</ol>
<h2 id="æ€»ç»“ï¼šAOFå°±åƒç»™æ•°æ®åº“å†™æ—¥è®°">æ€»ç»“ï¼šAOFå°±åƒç»™æ•°æ®åº“å†™æ—¥è®°</h2>
<p>è®©æˆ‘ä»¬ç”¨æœ€ç®€å•çš„è¯æ€»ç»“ä¸€ä¸‹AOFï¼š</p>
<ol>
<li><strong>åŸºæœ¬åŸç†</strong>ï¼šåƒå†™æ—¥è®°ä¸€æ ·ï¼ŒæŠŠæ¯ä¸ªå†™æ“ä½œéƒ½è®°å½•ä¸‹æ¥</li>
<li><strong>æ¢å¤æ•°æ®</strong>ï¼šé‡å¯æ—¶æŒ‰ç…§æ—¥è®°é‡æ–°æ‰§è¡Œä¸€éæ“ä½œ</li>
<li><strong>å†™å…¥ç­–ç•¥</strong>ï¼šå¯ä»¥é€‰æ‹©ç«‹å³å†™å…¥ã€æ¯ç§’å†™å…¥æˆ–è®©ç³»ç»Ÿå†³å®š</li>
<li><strong>æ–‡ä»¶é‡å†™</strong>ï¼šå®šæœŸæ•´ç†æ—¥è®°ï¼Œå»æ‰é‡å¤å’Œè¿‡æ—¶çš„å†…å®¹</li>
<li><strong>åå°é‡å†™</strong>ï¼šç”¨&quot;åˆ†èº«&quot;æ¥æ•´ç†æ—¥è®°ï¼Œä¸å½±å“æ­£å¸¸å·¥ä½œ</li>
</ol>
<p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p>
<ul>
<li>è¦æ±‚æ•°æ®ç»å¯¹å®‰å…¨ï¼šé€‰æ‹©Alwaysç­–ç•¥</li>
<li>å¹³è¡¡å®‰å…¨å’Œæ€§èƒ½ï¼šé€‰æ‹©Everysecç­–ç•¥ï¼ˆæ¨èï¼‰</li>
<li>è¿½æ±‚æœ€é«˜æ€§èƒ½ï¼šé€‰æ‹©Noç­–ç•¥</li>
</ul>
<p>AOFæŒä¹…åŒ–è™½ç„¶æ¢å¤æ•°æ®æ¯”è¾ƒæ…¢ï¼ˆå› ä¸ºè¦é‡æ–°æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ï¼‰ï¼Œä½†å®ƒçš„ä¼˜ç‚¹æ˜¯æ•°æ®ä¸¢å¤±å°‘ï¼Œç‰¹åˆ«é€‚åˆå¯¹æ•°æ®å®‰å…¨è¦æ±‚é«˜çš„åœºæ™¯ã€‚</p>
<hr>
<p><strong>å‚è€ƒèµ„æ–™</strong></p>
<ul>
<li>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹</li>
<li>ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ - æå®¢æ—¶é—´ã€‹</li>
<li>ã€ŠRedis æºç åˆ†æã€‹</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æŒä¹…åŒ–</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>Redis</tag>
        <tag>AOF</tag>
        <tag>æŒä¹…åŒ–</tag>
        <tag>fsync</tag>
        <tag>é‡å†™æœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 68 - æ–‡æœ¬å·¦å³å¯¹é½ï¼ˆText Justificationï¼‰</title>
    <url>/2025/05/30/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-68-%E6%96%87%E6%9C%AC%E5%B7%A6%E5%8F%B3%E5%AF%B9%E9%BD%90/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå•è¯æ•°ç»„ <code>words</code> å’Œä¸€ä¸ªé•¿åº¦ <code>maxWidth</code>ï¼Œé‡æ–°æ’ç‰ˆå•è¯ï¼Œä½¿å…¶æˆä¸ºæ¯è¡Œæ°å¥½æœ‰ <code>maxWidth</code> ä¸ªå­—ç¬¦ï¼Œä¸”å·¦å³ä¸¤ç«¯å¯¹é½çš„æ–‡æœ¬ã€‚</p>
<p>ä½ åº”è¯¥ä½¿ç”¨&quot;è´ªå¿ƒç®—æ³•&quot;æ¥æ”¾ç½®ç»™å®šçš„å•è¯ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½å¯èƒ½å¤šåœ°å¾€æ¯è¡Œä¸­æ”¾ç½®å•è¯ã€‚å¿…è¦æ—¶å¯ç”¨ç©ºæ ¼ <code>' '</code> å¡«å……ï¼Œä½¿å¾—æ¯è¡Œæ°å¥½æœ‰ <code>maxWidth</code> ä¸ªå­—ç¬¦ã€‚</p>
<p>è¦æ±‚å•è¯ä¹‹é—´çš„ç©ºæ ¼åº”è¯¥å°½å¯èƒ½å¹³å‡åˆ†é…ã€‚å¦‚æœæŸä¸€è¡Œå•è¯é—´çš„ç©ºæ ¼ä¸èƒ½å¹³å‡åˆ†é…ï¼Œåˆ™å·¦ä¾§æ”¾ç½®çš„ç©ºæ ¼æ•°è¦å¤šäºå³ä¾§çš„ç©ºæ ¼æ•°ã€‚</p>
<p><strong>æ–‡æœ¬çš„æœ€åä¸€è¡Œåº”ä¸ºå·¦å¯¹é½ï¼Œä¸”å•è¯ä¹‹é—´ä¸æ’å…¥é¢å¤–çš„ç©ºæ ¼ã€‚</strong></p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šwords = [&quot;This&quot;, &quot;is&quot;, &quot;an&quot;, &quot;example&quot;, &quot;of&quot;, &quot;text&quot;, &quot;justification.&quot;], maxWidth = 16</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">[</span><br><span class="line">   &quot;This    is    an&quot;,</span><br><span class="line">   &quot;example  of text&quot;,</span><br><span class="line">   &quot;justification.  &quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šwords = [&quot;What&quot;,&quot;must&quot;,&quot;be&quot;,&quot;acknowledgment&quot;,&quot;shall&quot;,&quot;be&quot;], maxWidth = 16</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">[</span><br><span class="line">  &quot;What   must   be&quot;,</span><br><span class="line">  &quot;acknowledgment  &quot;,</span><br><span class="line">  &quot;shall be        &quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>1 &lt;= words.length &lt;= 300</code></li>
<li><code>1 &lt;= words[i].length &lt;= 20</code></li>
<li><code>words[i]</code> ç”±å°å†™è‹±æ–‡å­—æ¯å’Œç¬¦å·ç»„æˆ</li>
<li><code>1 &lt;= maxWidth &lt;= 100</code></li>
<li><code>words[i].length &lt;= maxWidth</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯<strong>æ¨¡æ‹Ÿ</strong>æ–‡æœ¬ç¼–è¾‘å™¨çš„å·¦å³å¯¹é½åŠŸèƒ½ã€‚æˆ‘ä»¬éœ€è¦ï¼š</p>
<ol>
<li><strong>è´ªå¿ƒç­–ç•¥</strong>ï¼šæ¯è¡Œå°½å¯èƒ½å¤šåœ°æ”¾ç½®å•è¯</li>
<li><strong>ç©ºæ ¼åˆ†é…</strong>ï¼šå°†å‰©ä½™ç©ºæ ¼å‡åŒ€åˆ†å¸ƒåœ¨å•è¯é—´</li>
<li><strong>ç‰¹æ®Šå¤„ç†</strong>ï¼šæœ€åä¸€è¡Œé‡‡ç”¨å·¦å¯¹é½</li>
</ol>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<h4 id="æ­¥éª¤-1ï¼šè´ªå¿ƒå¡«å……å•è¯">æ­¥éª¤ 1ï¼šè´ªå¿ƒå¡«å……å•è¯</h4>
<p>å¯¹äºæ¯ä¸€è¡Œï¼Œæˆ‘ä»¬ä½¿ç”¨è´ªå¿ƒç®—æ³•å°½å¯èƒ½å¤šåœ°æ”¾ç½®å•è¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“å‰è¡Œé•¿åº¦ = å•è¯æ€»é•¿åº¦ + å•è¯é—´éš”æ•°ï¼ˆå•è¯æ•° - 1ï¼‰</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ·»åŠ ä¸‹ä¸€ä¸ªå•è¯ä¼šè¶…è¿‡ <code>maxWidth</code>ï¼Œå°±å¼€å§‹å¤„ç†å½“å‰è¡Œã€‚</p>
<h4 id="æ­¥éª¤-2ï¼šè®¡ç®—ç©ºæ ¼åˆ†é…">æ­¥éª¤ 2ï¼šè®¡ç®—ç©ºæ ¼åˆ†é…</h4>
<p>å¯¹äºéæœ€åä¸€è¡Œï¼Œéœ€è¦è®¡ç®—å¦‚ä½•åˆ†é…ç©ºæ ¼ï¼š</p>
<ul>
<li><strong>æ€»ç©ºæ ¼æ•°</strong> = <code>maxWidth</code> - å•è¯å­—ç¬¦æ€»æ•°</li>
<li><strong>é—´éš”æ•°</strong> = å•è¯æ•° - 1</li>
<li><strong>æ¯ä¸ªé—´éš”çš„åŸºç¡€ç©ºæ ¼</strong> = æ€»ç©ºæ ¼æ•° Ã· é—´éš”æ•°</li>
<li><strong>é¢å¤–ç©ºæ ¼æ•°</strong> = æ€»ç©ºæ ¼æ•° % é—´éš”æ•°</li>
</ul>
<p><strong>å…³é”®ç­–ç•¥</strong>ï¼šé¢å¤–ç©ºæ ¼ä»å·¦åˆ°å³ä¾æ¬¡åˆ†é…ï¼Œç¡®ä¿å·¦ä¾§ç©ºæ ¼ä¸å°‘äºå³ä¾§ã€‚</p>
<h4 id="æ­¥éª¤-3ï¼šå¤„ç†ç‰¹æ®Šæƒ…å†µ">æ­¥éª¤ 3ï¼šå¤„ç†ç‰¹æ®Šæƒ…å†µ</h4>
<ol>
<li><strong>å•ä¸ªå•è¯çš„è¡Œ</strong>ï¼šå•è¯åå¡«å……ç©ºæ ¼åˆ° <code>maxWidth</code></li>
<li><strong>æœ€åä¸€è¡Œ</strong>ï¼šå·¦å¯¹é½ï¼Œå•è¯é—´åªç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”ï¼Œæœ«å°¾å¡«å……ç©ºæ ¼</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ ¸å¿ƒç®—æ³•å¯è§†åŒ–">æ ¸å¿ƒç®—æ³•å¯è§†åŒ–</h3>
<p>ä»¥ <code>[&quot;This&quot;, &quot;is&quot;, &quot;an&quot;]</code> ä¸ºä¾‹ï¼Œ<code>maxWidth = 16</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ­¥éª¤ 1ï¼šè®¡ç®—ç©ºæ ¼åˆ†é…</span><br><span class="line">å•è¯: &quot;This&quot; &quot;is&quot; &quot;an&quot;  (é•¿åº¦: 4 + 2 + 2 = 8)</span><br><span class="line">æ€»ç©ºæ ¼: 16 - 8 = 8</span><br><span class="line">é—´éš”æ•°: 3 - 1 = 2</span><br><span class="line">åŸºç¡€ç©ºæ ¼: 8 Ã· 2 = 4</span><br><span class="line">é¢å¤–ç©ºæ ¼: 8 % 2 = 0</span><br><span class="line"></span><br><span class="line">æ­¥éª¤ 2ï¼šæ„å»ºç»“æœ</span><br><span class="line">&quot;This&quot; + 4ç©ºæ ¼ + &quot;is&quot; + 4ç©ºæ ¼ + &quot;an&quot;</span><br><span class="line">ç»“æœ: &quot;This    is    an&quot;</span><br></pre></td></tr></table></figure>
<h3 id="ç©ºæ ¼åˆ†é…ç­–ç•¥">ç©ºæ ¼åˆ†é…ç­–ç•¥</h3>
<p>å½“ç©ºæ ¼æ— æ³•å¹³å‡åˆ†é…æ—¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¾‹å¦‚ï¼š[&quot;What&quot;, &quot;must&quot;, &quot;be&quot;], maxWidth = 16</span><br><span class="line">å•è¯é•¿åº¦: 4 + 4 + 2 = 10</span><br><span class="line">æ€»ç©ºæ ¼: 16 - 10 = 6</span><br><span class="line">é—´éš”æ•°: 2</span><br><span class="line">åŸºç¡€ç©ºæ ¼: 6 Ã· 2 = 3</span><br><span class="line">é¢å¤–ç©ºæ ¼: 6 % 2 = 0</span><br><span class="line"></span><br><span class="line">ä½†å¦‚æœæ˜¯ [&quot;What&quot;, &quot;must&quot;, &quot;be&quot;], maxWidth = 17:</span><br><span class="line">æ€»ç©ºæ ¼: 17 - 10 = 7</span><br><span class="line">åŸºç¡€ç©ºæ ¼: 7 Ã· 2 = 3</span><br><span class="line">é¢å¤–ç©ºæ ¼: 7 % 2 = 1 (ç»™ç¬¬ä¸€ä¸ªé—´éš”)</span><br><span class="line"></span><br><span class="line">ç»“æœ: &quot;What    must   be&quot;</span><br><span class="line">      â†‘4ç©ºæ ¼    â†‘3ç©ºæ ¼</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fullJustify</span><span class="params">(words []<span class="type">string</span>, maxWidth <span class="type">int</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">    result := []<span class="type">string</span>&#123;&#125;</span><br><span class="line">    line := []<span class="type">string</span>&#123;&#125;</span><br><span class="line">    length := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> words &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> length + <span class="built_in">len</span>(word) + <span class="built_in">len</span>(line) &gt; maxWidth &#123;</span><br><span class="line">            result = <span class="built_in">append</span>(result, justify(line, maxWidth))</span><br><span class="line">            line = []<span class="type">string</span>&#123;word&#125;</span><br><span class="line">            length = <span class="built_in">len</span>(word)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            line = <span class="built_in">append</span>(line, word)</span><br><span class="line">            length += <span class="built_in">len</span>(word)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æœ€åä¸€è¡Œï¼ˆå·¦å¯¹é½ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(line) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        lastLine := strings.Join(line, <span class="string">&quot; &quot;</span>)</span><br><span class="line">        lastLine += strings.Repeat(<span class="string">&quot; &quot;</span>, maxWidth-<span class="built_in">len</span>(lastLine))</span><br><span class="line">        result = <span class="built_in">append</span>(result, lastLine)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">justify</span><span class="params">(words []<span class="type">string</span>, maxWidth <span class="type">int</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(words) == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> words[<span class="number">0</span>] + strings.Repeat(<span class="string">&quot; &quot;</span>, maxWidth-<span class="built_in">len</span>(words[<span class="number">0</span>]))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡ç®—éœ€è¦åˆ†é…çš„ç©ºæ ¼æ•°</span></span><br><span class="line">    wordChars := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> words &#123;</span><br><span class="line">        wordChars += <span class="built_in">len</span>(word)</span><br><span class="line">    &#125;</span><br><span class="line">    totalSpaces := maxWidth - wordChars</span><br><span class="line">    gaps := <span class="built_in">len</span>(words) - <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†é…ç©ºæ ¼</span></span><br><span class="line">    spacePerGap := totalSpaces / gaps</span><br><span class="line">    extraSpaces := totalSpaces % gaps</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> result strings.Builder</span><br><span class="line">    result.Grow(maxWidth)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, word := <span class="keyword">range</span> words &#123;</span><br><span class="line">        result.WriteString(word)</span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(words)<span class="number">-1</span> &#123; <span class="comment">// ä¸æ˜¯æœ€åä¸€ä¸ªå•è¯</span></span><br><span class="line">            spaces := spacePerGap</span><br><span class="line">            <span class="keyword">if</span> i &lt; extraSpaces &#123;</span><br><span class="line">                spaces++</span><br><span class="line">            &#125;</span><br><span class="line">            result.WriteString(strings.Repeat(<span class="string">&quot; &quot;</span>, spaces))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result.String()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>ä»¥ç¤ºä¾‹ 1 ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [&quot;This&quot;, &quot;is&quot;, &quot;an&quot;, &quot;example&quot;, &quot;of&quot;, &quot;text&quot;, &quot;justification.&quot;]</span><br><span class="line">maxWidth = 16</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€è¡Œå¤„ç†:</span><br><span class="line">- &quot;This&quot; (4) + &quot;is&quot; (2) + &quot;an&quot; (2) = 8 + 2é—´éš” = 10 â‰¤ 16 âœ“</span><br><span class="line">- å°è¯•åŠ å…¥ &quot;example&quot; (7): 10 + 1 + 7 = 18 &gt; 16 âœ—</span><br><span class="line">- å¤„ç† [&quot;This&quot;, &quot;is&quot;, &quot;an&quot;]: ç©ºæ ¼åˆ†é… 8ä¸ªï¼Œå¹³å‡åˆ†é…åˆ°2ä¸ªé—´éš”</span><br><span class="line">- ç»“æœ: &quot;This    is    an&quot;</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒè¡Œå¤„ç†:</span><br><span class="line">- &quot;example&quot; (7) + &quot;of&quot; (2) + &quot;text&quot; (4) = 13 + 2é—´éš” = 15 â‰¤ 16 âœ“</span><br><span class="line">- å°è¯•åŠ å…¥ &quot;justification.&quot;: è¶…å‡ºé™åˆ¶</span><br><span class="line">- å¤„ç† [&quot;example&quot;, &quot;of&quot;, &quot;text&quot;]: å‰©ä½™3ä¸ªç©ºæ ¼ï¼Œåˆ†é…åˆ°2ä¸ªé—´éš”</span><br><span class="line">- ç»“æœ: &quot;example  of text&quot;</span><br><span class="line"></span><br><span class="line">æœ€åä¸€è¡Œ:</span><br><span class="line">- [&quot;justification.&quot;] å·¦å¯¹é½ï¼Œåè¡¥ç©ºæ ¼</span><br><span class="line">- ç»“æœ: &quot;justification.  &quot;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p>$$T(n) = O(n)$$</p>
<p>å…¶ä¸­ $n$ æ˜¯å•è¯æ€»æ•°ã€‚æ¯ä¸ªå•è¯åªè¢«å¤„ç†ä¸€æ¬¡ï¼Œå­—ç¬¦ä¸²æ„å»ºæ“ä½œè™½ç„¶æ¶‰åŠç©ºæ ¼è®¡ç®—ï¼Œä½†æ€»çš„å­—ç¬¦æ•°æ˜¯å›ºå®šçš„ï¼ˆ$\text{maxWidth} \times \text{è¡Œæ•°}$ï¼‰ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<p>$$S(n) = O(k)$$</p>
<p>å…¶ä¸­ $k$ æ˜¯ç»“æœçš„æ€»å­—ç¬¦æ•°ã€‚é™¤äº†å­˜å‚¨ç»“æœå¤–ï¼Œåªä½¿ç”¨äº†å¸¸æ•°é¢å¤–ç©ºé—´æ¥å­˜å‚¨å½“å‰è¡Œçš„å•è¯ã€‚</p>
<h2 id="ç®—æ³•ç‰¹ç‚¹åˆ†æ">ç®—æ³•ç‰¹ç‚¹åˆ†æ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è¯„ä»·</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>æ¯ä¸ªå•è¯åªå¤„ç†ä¸€æ¬¡ï¼Œå­—ç¬¦ä¸²æ„å»ºæ—¶é—´ä¸æ€»è¾“å‡ºé•¿åº¦æˆæ­£æ¯”</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(k)$</td>
<td>ä¸»è¦ç”¨äºå­˜å‚¨ç»“æœï¼Œ$k$ ä¸ºè¾“å‡ºå­—ç¬¦æ€»æ•°</td>
</tr>
<tr>
<td>ä»£ç ç®€æ´åº¦</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>é€»è¾‘æ¸…æ™°ï¼Œä½¿ç”¨ Go æ ‡å‡†åº“ç®€åŒ–å®ç°</td>
</tr>
<tr>
<td>æ˜“ç†è§£æ€§</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>ç®—æ³•æ€è·¯ç›´è§‚ï¼Œåˆ†æ­¥éª¤å¤„ç†æ˜“äºç†è§£</td>
</tr>
<tr>
<td>å®ç°éš¾åº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>éœ€è¦æ­£ç¡®å¤„ç†å¤šç§è¾¹ç•Œæƒ…å†µ</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="æ ¸å¿ƒç®—æ³•æ€æƒ³">æ ¸å¿ƒç®—æ³•æ€æƒ³</h3>
<ol>
<li><strong>è´ªå¿ƒç­–ç•¥</strong>ï¼šæ¯è¡Œå°½å¯èƒ½å¤šåœ°æ”¾ç½®å•è¯ï¼Œè¿™æ˜¯æœ€ä¼˜ç­–ç•¥</li>
<li><strong>æ•°å­¦åˆ†é…</strong>ï¼šä½¿ç”¨é™¤æ³•å’Œå–æ¨¡è¿ç®—å®ç°ç©ºæ ¼çš„å‡åŒ€åˆ†é…</li>
<li><strong>è¾¹ç•Œå¤„ç†</strong>ï¼šåŒºåˆ†æ™®é€šè¡Œã€å•è¯è¡Œå’Œæœ€åä¸€è¡Œçš„ä¸åŒå¤„ç†é€»è¾‘</li>
</ol>
<h3 id="å¸¸è§é™·é˜±ä¸é¿å…æ–¹æ³•">å¸¸è§é™·é˜±ä¸é¿å…æ–¹æ³•</h3>
<ol>
<li>
<p><strong>ç©ºæ ¼åˆ†é…é”™è¯¯</strong>ï¼š</p>
<ul>
<li>âŒ é”™è¯¯ï¼šå¹³å‡åˆ†é…ç©ºæ ¼åå¿½ç•¥ä½™æ•°</li>
<li>âœ… æ­£ç¡®ï¼šä½™æ•°ç©ºæ ¼ä»å·¦åˆ°å³ä¾æ¬¡åˆ†é…</li>
</ul>
</li>
<li>
<p><strong>æœ€åä¸€è¡Œå¤„ç†</strong>ï¼š</p>
<ul>
<li>âŒ é”™è¯¯ï¼šæœ€åä¸€è¡Œä¹Ÿè¿›è¡Œå·¦å³å¯¹é½</li>
<li>âœ… æ­£ç¡®ï¼šæœ€åä¸€è¡Œåªéœ€å·¦å¯¹é½</li>
</ul>
</li>
<li>
<p><strong>å•è¯è¡Œå¤„ç†</strong>ï¼š</p>
<ul>
<li>âŒ é”™è¯¯ï¼šå•ä¸ªå•è¯ä¹Ÿå°è¯•è¿›è¡Œç©ºæ ¼åˆ†é…</li>
<li>âœ… æ­£ç¡®ï¼šå•ä¸ªå•è¯ç›´æ¥å³ä¾§å¡«å……ç©ºæ ¼</li>
</ul>
</li>
</ol>
<h3 id="æ‰©å±•åº”ç”¨">æ‰©å±•åº”ç”¨</h3>
<p>è¿™ä¸ªç®—æ³•çš„æ€æƒ³å¯ä»¥åº”ç”¨åˆ°ï¼š</p>
<ul>
<li>æ–‡æ¡£æ’ç‰ˆç³»ç»Ÿ</li>
<li>ä»£ç æ ¼å¼åŒ–å·¥å…·</li>
<li>è¡¨æ ¼å¯¹é½ç®—æ³•</li>
<li>UI å¸ƒå±€åˆ†é…ç®—æ³•</li>
</ul>
<p><strong>å‚è€ƒé“¾æ¥</strong>ï¼š<a href="https://leetcode.cn/problems/text-justification/description/">LeetCode 68. æ–‡æœ¬å·¦å³å¯¹é½</a></p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å­—ç¬¦ä¸²</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ•°ç»„</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>æ¨¡æ‹Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 28 - æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆFind the Index of the First Occurrence in a Stringï¼‰</title>
    <url>/2025/05/28/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-28-%E6%89%BE%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8C%B9%E9%85%8D%E9%A1%B9%E7%9A%84%E4%B8%8B%E6%A0%87/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² <code>haystack</code> å’Œ <code>needle</code> ï¼Œè¯·ä½ åœ¨ <code>haystack</code> å­—ç¬¦ä¸²ä¸­æ‰¾å‡º <code>needle</code> å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ <code>needle</code> ä¸æ˜¯ <code>haystack</code> çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å› <code>-1</code>ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhaystack = &quot;sadbutsad&quot;, needle = &quot;sad&quot;</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼š&quot;sad&quot; åœ¨ä¸‹æ ‡ 0 å’Œ 6 å¤„åŒ¹é…ã€‚ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡æ˜¯ 0ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhaystack = &quot;leetcode&quot;, needle = &quot;leeto&quot;</span><br><span class="line">è¾“å‡ºï¼š-1</span><br><span class="line">è§£é‡Šï¼š&quot;leeto&quot; æ²¡æœ‰åœ¨ &quot;leetcode&quot; ä¸­å‡ºç°ï¼Œæ‰€ä»¥è¿”å› -1ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>1 &lt;= haystack.length, needle.length &lt;= 10^4</code></li>
<li><code>haystack</code> å’Œ <code>needle</code> ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆ</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜æ˜¯ç»å…¸çš„å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜ï¼Œæœ€ä¼˜è§£æ˜¯ä½¿ç”¨ <strong>KMPï¼ˆKnuth-Morris-Prattï¼‰ç®—æ³•</strong>ã€‚KMPç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å½“åŒ¹é…å¤±è´¥æ—¶ï¼Œåˆ©ç”¨å·²åŒ¹é…çš„å‰ç¼€ä¿¡æ¯ï¼Œé¿å…ä»å¤´å¼€å§‹é‡æ–°åŒ¹é…</strong>ã€‚</p>
<h3 id="KMPç®—æ³•æ ¸å¿ƒæ¦‚å¿µ">KMPç®—æ³•æ ¸å¿ƒæ¦‚å¿µ</h3>
<ol>
<li><strong>nextæ•°ç»„ï¼ˆéƒ¨åˆ†åŒ¹é…è¡¨ï¼‰</strong>ï¼šè®°å½•æ¨¡å¼ä¸²ä¸­æ¯ä¸ªä½ç½®çš„æœ€é•¿ç›¸ç­‰å‰åç¼€é•¿åº¦</li>
<li><strong>å¤±é…è·³è½¬</strong>ï¼šå½“å­—ç¬¦ä¸åŒ¹é…æ—¶ï¼Œæ ¹æ®nextæ•°ç»„è·³è½¬åˆ°åˆé€‚ä½ç½®ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹</li>
</ol>
<h3 id="ç®—æ³•æ­¥éª¤è¯¦è§£">ç®—æ³•æ­¥éª¤è¯¦è§£</h3>
<h4 id="è§†é¢‘è®²è§£">è§†é¢‘è®²è§£</h4>
<p><video src="./KMPAnimation.mp4" controls></video></p>
<h4 id="æ­¥éª¤1ï¼šæ„å»ºnextæ•°ç»„">æ­¥éª¤1ï¼šæ„å»ºnextæ•°ç»„</h4>
<p>nextæ•°ç»„çš„å®šä¹‰ï¼š<code>next[i]</code> è¡¨ç¤ºæ¨¡å¼ä¸² <code>needle[0...i]</code> çš„æœ€é•¿ç›¸ç­‰å‰åç¼€çš„é•¿åº¦ã€‚</p>
<p><strong>æ„å»ºè¿‡ç¨‹ç¤ºä¾‹</strong>ï¼ˆä»¥ <code>needle = &quot;ababaca&quot;</code> ä¸ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ¨¡å¼ä¸²ï¼š  a  b  a  b  a  c  a</span><br><span class="line">ç´¢å¼•ï¼š    0  1  2  3  4  5  6</span><br><span class="line">nextï¼š   [0  0  1  2  3  0  1]</span><br></pre></td></tr></table></figure>
<p>è¯¦ç»†æ„å»ºè¿‡ç¨‹ï¼š</p>
<ul>
<li><code>i=0</code>: <code>next[0] = 0</code>ï¼ˆè§„å®šä¸º0ï¼‰</li>
<li><code>i=1</code>: <code>&quot;ab&quot;</code> æ— ç›¸ç­‰å‰åç¼€ï¼Œ<code>next[1] = 0</code></li>
<li><code>i=2</code>: <code>&quot;aba&quot;</code> æœ€é•¿ç›¸ç­‰å‰åç¼€æ˜¯ <code>&quot;a&quot;</code>ï¼Œé•¿åº¦ä¸º1ï¼Œ<code>next[2] = 1</code></li>
<li><code>i=3</code>: <code>&quot;abab&quot;</code> æœ€é•¿ç›¸ç­‰å‰åç¼€æ˜¯ <code>&quot;ab&quot;</code>ï¼Œé•¿åº¦ä¸º2ï¼Œ<code>next[3] = 2</code></li>
<li><code>i=4</code>: <code>&quot;ababa&quot;</code> æœ€é•¿ç›¸ç­‰å‰åç¼€æ˜¯ <code>&quot;aba&quot;</code>ï¼Œé•¿åº¦ä¸º3ï¼Œ<code>next[4] = 3</code></li>
<li><code>i=5</code>: <code>&quot;ababac&quot;</code> æ— ç›¸ç­‰å‰åç¼€ï¼Œ<code>next[5] = 0</code></li>
<li><code>i=6</code>: <code>&quot;ababaca&quot;</code> æœ€é•¿ç›¸ç­‰å‰åç¼€æ˜¯ <code>&quot;a&quot;</code>ï¼Œé•¿åº¦ä¸º1ï¼Œ<code>next[6] = 1</code></li>
</ul>
<h4 id="æ­¥éª¤2ï¼šæ¨¡å¼åŒ¹é…">æ­¥éª¤2ï¼šæ¨¡å¼åŒ¹é…</h4>
<p>ä½¿ç”¨æ„å»ºå¥½çš„nextæ•°ç»„è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…ã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="KMPç®—æ³•çš„ä¸¤ä¸ªå…³é”®å‡½æ•°">KMPç®—æ³•çš„ä¸¤ä¸ªå…³é”®å‡½æ•°</h3>
<ol>
<li><strong>æ„å»ºnextæ•°ç»„</strong>ï¼š</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildNext</span><span class="params">(str <span class="type">string</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">	length := <span class="built_in">len</span>(str)</span><br><span class="line">	next := <span class="built_in">make</span>([]<span class="type">int</span>, length)</span><br><span class="line">	next[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, j := <span class="number">1</span>, <span class="number">0</span>; i &lt; length; i++ &#123;</span><br><span class="line">		<span class="comment">// å½“å‰å­—ç¬¦ä¸åŒ¹é…æ—¶ï¼Œå›é€€j</span></span><br><span class="line">		<span class="keyword">for</span> j &gt; <span class="number">0</span> &amp;&amp; str[i] != str[j] &#123;</span><br><span class="line">			j = next[j<span class="number">-1</span>]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å­—ç¬¦åŒ¹é…ï¼Œjå‰è¿›</span></span><br><span class="line">		<span class="keyword">if</span> str[i] == str[j] &#123;</span><br><span class="line">			j++</span><br><span class="line">		&#125;</span><br><span class="line">		next[i] = j</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>æ‰§è¡ŒåŒ¹é…</strong>ï¼š</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strStr</span><span class="params">(haystack <span class="type">string</span>, needle <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n, m := <span class="built_in">len</span>(haystack), <span class="built_in">len</span>(needle)</span><br><span class="line">	next := buildNext(needle)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		<span class="comment">// å½“å‰å­—ç¬¦ä¸åŒ¹é…æ—¶ï¼Œæ ¹æ®nextæ•°ç»„è·³è½¬</span></span><br><span class="line">		<span class="keyword">for</span> j &gt; <span class="number">0</span> &amp;&amp; haystack[i] != needle[j] &#123;</span><br><span class="line">			j = next[j<span class="number">-1</span>]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å­—ç¬¦åŒ¹é…ï¼Œjå‰è¿›</span></span><br><span class="line">		<span class="keyword">if</span> haystack[i] == needle[j] &#123;</span><br><span class="line">			j++</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å®Œå…¨åŒ¹é…</span></span><br><span class="line">		<span class="keyword">if</span> j == m &#123;</span><br><span class="line">			<span class="keyword">return</span> i - m + <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…·ä½“ä¾‹å­æ¼”ç¤º">å…·ä½“ä¾‹å­æ¼”ç¤º</h3>
<p>è®©æˆ‘ä»¬ç”¨ <code>haystack = &quot;ababcababa&quot;</code> å’Œ <code>needle = &quot;ababa&quot;</code> æ¥æ¼”ç¤ºæ•´ä¸ªè¿‡ç¨‹ï¼š</p>
<h4 id="1-æ„å»ºnextæ•°ç»„">1. æ„å»ºnextæ•°ç»„</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">needle = &quot;ababa&quot;</span><br><span class="line">ç´¢å¼•ï¼š    0  1  2  3  4</span><br><span class="line">nextï¼š   [0  0  1  2  3]</span><br></pre></td></tr></table></figure>
<p>æ„å»ºè¿‡ç¨‹ï¼š</p>
<ul>
<li><code>i=1, j=0</code>: <code>'b' != 'a'</code>ï¼Œ<code>next[1] = 0</code></li>
<li><code>i=2, j=0</code>: <code>'a' == 'a'</code>ï¼Œ<code>j++</code>ï¼Œ<code>next[2] = 1</code></li>
<li><code>i=3, j=1</code>: <code>'b' == 'b'</code>ï¼Œ<code>j++</code>ï¼Œ<code>next[3] = 2</code></li>
<li><code>i=4, j=2</code>: <code>'a' == 'a'</code>ï¼Œ<code>j++</code>ï¼Œ<code>next[4] = 3</code></li>
</ul>
<h4 id="2-æ‰§è¡ŒåŒ¹é…è¿‡ç¨‹">2. æ‰§è¡ŒåŒ¹é…è¿‡ç¨‹</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">haystack: a b a b c a b a b a</span><br><span class="line">ç´¢å¼•:     0 1 2 3 4 5 6 7 8 9</span><br><span class="line">needle:   a b a b a</span><br><span class="line">          â†‘           (i=0, j=0)</span><br></pre></td></tr></table></figure>
<p><strong>åŒ¹é…æ­¥éª¤</strong>ï¼š</p>
<ol>
<li><code>i=0, j=0</code>: <code>'a' == 'a'</code> âœ“, <code>j++</code></li>
<li><code>i=1, j=1</code>: <code>'b' == 'b'</code> âœ“, <code>j++</code></li>
<li><code>i=2, j=2</code>: <code>'a' == 'a'</code> âœ“, <code>j++</code></li>
<li><code>i=3, j=3</code>: <code>'b' == 'b'</code> âœ“, <code>j++</code></li>
<li><code>i=4, j=4</code>: <code>'c' != 'a'</code> âœ—, <strong>å¤±é…ï¼</strong></li>
</ol>
<p><strong>å¤±é…å¤„ç†</strong>ï¼š</p>
<ul>
<li><code>j = next[j-1] = next[3] = 2</code></li>
<li>è·³è½¬åç»§ç»­æ¯”è¾ƒ <code>haystack[4]</code> å’Œ <code>needle[2]</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">haystack: a b a b c a b a b a</span><br><span class="line">          a b a b a   (å·²åŒ¹é…éƒ¨åˆ†)</span><br><span class="line">              a b a b a (è·³è½¬åçš„å¯¹é½)</span><br><span class="line">                  â†‘   (i=4, j=2)</span><br></pre></td></tr></table></figure>
<ol start="6">
<li><code>i=4, j=2</code>: <code>'c' != 'a'</code> âœ—, ç»§ç»­å¤±é…</li>
<li><code>j = next[j-1] = next[1] = 0</code></li>
<li><code>i=4, j=0</code>: <code>'c' != 'a'</code> âœ—, <code>j</code>ä¿æŒä¸º0</li>
<li><code>i=5, j=0</code>: <code>'a' == 'a'</code> âœ“, <code>j++</code></li>
<li>ç»§ç»­åŒ¹é…â€¦ æœ€ç»ˆåœ¨ä½ç½®5æ‰¾åˆ°å®Œæ•´åŒ¹é…</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strStr</span><span class="params">(haystack <span class="type">string</span>, needle <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// KMPç®—æ³•å®ç°</span></span><br><span class="line">	n, m := <span class="built_in">len</span>(haystack), <span class="built_in">len</span>(needle)</span><br><span class="line">	next := buildNext(needle)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		<span class="comment">// å½“å‰å­—ç¬¦ä¸åŒ¹é…æ—¶ï¼Œæ ¹æ®nextæ•°ç»„è·³è½¬</span></span><br><span class="line">		<span class="keyword">for</span> j &gt; <span class="number">0</span> &amp;&amp; haystack[i] != needle[j] &#123;</span><br><span class="line">			j = next[j<span class="number">-1</span>]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å­—ç¬¦åŒ¹é…ï¼Œjå‰è¿›</span></span><br><span class="line">		<span class="keyword">if</span> haystack[i] == needle[j] &#123;</span><br><span class="line">			j++</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> j == m &#123;</span><br><span class="line">			<span class="keyword">return</span> i - m + <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildNext</span><span class="params">(str <span class="type">string</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">	length := <span class="built_in">len</span>(str)</span><br><span class="line">	next := <span class="built_in">make</span>([]<span class="type">int</span>, length)</span><br><span class="line">	next[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, j := <span class="number">1</span>, <span class="number">0</span>; i &lt; length; i++ &#123;</span><br><span class="line">		<span class="comment">// å½“å‰å­—ç¬¦ä¸åŒ¹é…æ—¶ï¼Œå›é€€j</span></span><br><span class="line">		<span class="keyword">for</span> j &gt; <span class="number">0</span> &amp;&amp; str[i] != str[j] &#123;</span><br><span class="line">			j = next[j<span class="number">-1</span>]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å­—ç¬¦åŒ¹é…ï¼Œjå‰è¿›</span></span><br><span class="line">		<span class="keyword">if</span> str[i] == str[j] &#123;</span><br><span class="line">			j++</span><br><span class="line">		&#125;</span><br><span class="line">		next[i] = j</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç è§£æ">ä»£ç è§£æ</h3>
<p><strong>ä¸»å‡½æ•° <code>strStr</code></strong>ï¼š</p>
<ul>
<li>è·å–ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ <code>n</code> å’Œ <code>m</code></li>
<li>è°ƒç”¨ <code>buildNext</code> å‡½æ•°æ„å»ºnextæ•°ç»„</li>
<li>ä½¿ç”¨åŒæŒ‡é’ˆ <code>i</code> å’Œ <code>j</code> è¿›è¡ŒKMPåŒ¹é…</li>
<li>å½“å¤±é…æ—¶ï¼Œæ ¹æ®nextæ•°ç»„è¿›è¡Œæ™ºèƒ½è·³è½¬</li>
<li>å½“å®Œå…¨åŒ¹é…æ—¶ï¼Œè¿”å›èµ·å§‹ä½ç½® <code>i - m + 1</code></li>
</ul>
<p><strong>è¾…åŠ©å‡½æ•° <code>buildNext</code></strong>ï¼š</p>
<ul>
<li>åˆ›å»ºé•¿åº¦ä¸º <code>m</code> çš„nextæ•°ç»„ï¼Œåˆå§‹åŒ– <code>next[0] = 0</code></li>
<li>ä½¿ç”¨åŒæŒ‡é’ˆ <code>i</code> å’Œ <code>j</code> æ„å»ºnextæ•°ç»„</li>
<li>å½“å­—ç¬¦ä¸åŒ¹é…æ—¶ï¼Œæ ¹æ®å·²æœ‰çš„nextå€¼è¿›è¡Œå›é€€</li>
<li>å½“å­—ç¬¦åŒ¹é…æ—¶ï¼Œæ›´æ–°nextæ•°ç»„</li>
</ul>
<h3 id="ç®—æ³•ä¼˜åŠ¿">ç®—æ³•ä¼˜åŠ¿</h3>
<p>è¿™ä¸ªå®ç°çš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li><strong>ä»£ç ç»“æ„æ¸…æ™°</strong>ï¼šå°†nextæ•°ç»„æ„å»ºæŠ½å–ä¸ºç‹¬ç«‹å‡½æ•°ï¼ŒèŒè´£åˆ†ç¦»</li>
<li><strong>æ˜“äºç†è§£</strong>ï¼šä¸»å‡½æ•°ä¸“æ³¨äºåŒ¹é…é€»è¾‘ï¼Œè¾…åŠ©å‡½æ•°ä¸“æ³¨äºé¢„å¤„ç†</li>
<li><strong>å¯å¤ç”¨æ€§å¼º</strong>ï¼š<code>buildNext</code> å‡½æ•°å¯ä»¥åœ¨å…¶ä»–éœ€è¦nextæ•°ç»„çš„åœºæ™¯ä¸­å¤ç”¨</li>
<li><strong>ç©ºé—´æ•ˆç‡é«˜</strong>ï¼šåªä½¿ç”¨å¿…è¦çš„ç©ºé—´å­˜å‚¨nextæ•°ç»„</li>
</ol>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æš´åŠ›åŒ¹é…</th>
<th>KMPç®—æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(nÃ—m)</td>
<td>O(n+m)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(m)</td>
</tr>
<tr>
<td>é¢„å¤„ç†</td>
<td>æ— </td>
<td>éœ€è¦æ„å»ºnextæ•°ç»„</td>
</tr>
<tr>
<td>å¤±é…å¤„ç†</td>
<td>å›é€€åˆ°èµ·å§‹ä½ç½®+1</td>
<td>æ™ºèƒ½è·³è½¬ï¼Œé¿å…é‡å¤æ¯”è¾ƒ</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>çŸ­æ¨¡å¼ä¸²</td>
<td>é•¿æ¨¡å¼ä¸²æˆ–é‡å¤åŒ¹é…</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n + m)$</p>
<ul>
<li>æ„å»ºnextæ•°ç»„ï¼š$O(m)$</li>
<li>æ¨¡å¼åŒ¹é…ï¼š$O(n)$</li>
<li>è™½ç„¶æœ‰åµŒå¥—å¾ªç¯ï¼Œä½†æ¯ä¸ªå­—ç¬¦æœ€å¤šè¢«æ¯”è¾ƒå¸¸æ•°æ¬¡</li>
</ul>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(m)$</p>
<ul>
<li>nextæ•°ç»„éœ€è¦ $O(m)$ ç©ºé—´</li>
</ul>
<h2 id="KMPç®—æ³•ä¼˜åŒ–è¯¦è§£">KMPç®—æ³•ä¼˜åŒ–è¯¦è§£</h2>
<h3 id="1-nextæ•°ç»„çš„æœ¬è´¨">1. nextæ•°ç»„çš„æœ¬è´¨</h3>
<p>nextæ•°ç»„è®°å½•çš„æ˜¯<strong>æœ€é•¿ç›¸ç­‰å‰åç¼€é•¿åº¦</strong>ï¼Œè¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ï¼š</p>
<ul>
<li>å½“å¤±é…æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“å‰é¢å·²ç»åŒ¹é…çš„éƒ¨åˆ†ä¸­å“ªäº›å¯ä»¥å¤ç”¨</li>
<li>é¿å…ä¸å¿…è¦çš„å›é€€å’Œé‡å¤æ¯”è¾ƒ</li>
</ul>
<h3 id="2-å¤±é…è·³è½¬çš„æ•°å­¦åŸç†">2. å¤±é…è·³è½¬çš„æ•°å­¦åŸç†</h3>
<p>å‡è®¾åœ¨ä½ç½® <code>i</code> å¤±é…ï¼Œæ­¤æ—¶å·²åŒ¹é…é•¿åº¦ä¸º <code>j</code>ï¼š</p>
<ul>
<li>ä¼ ç»Ÿæ–¹æ³•ï¼šå›é€€åˆ°èµ·å§‹ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦é€€åŒ–ä¸º $O(n \times m)$</li>
<li>KMPæ–¹æ³•ï¼šè·³è½¬åˆ° <code>next[j-1]</code>ï¼Œåˆ©ç”¨å·²åŒ¹é…ä¿¡æ¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¿æŒ $O(n + m)$</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>KMPçš„æ ¸å¿ƒæ€æƒ³</strong>ï¼šåˆ©ç”¨å·²åŒ¹é…çš„ä¿¡æ¯ï¼Œé¿å…æ— æ•ˆçš„é‡å¤æ¯”è¾ƒ</li>
<li><strong>nextæ•°ç»„æ˜¯å…³é”®</strong>ï¼šæ­£ç¡®ç†è§£å’Œæ„å»ºnextæ•°ç»„æ˜¯æŒæ¡KMPçš„é‡ç‚¹</li>
<li><strong>å¤±é…å¤„ç†ç­–ç•¥</strong>ï¼š<code>j = next[j-1]</code> è€Œä¸æ˜¯ <code>j = 0</code>ï¼Œè¿™æ˜¯æ•ˆç‡æå‡çš„å…³é”®</li>
<li><strong>æ—¶é—´å¤æ‚åº¦ä¿è¯</strong>ï¼šè™½ç„¶æœ‰åµŒå¥—å¾ªç¯ï¼Œä½†æ¯ä¸ªä½ç½®æœ€å¤šè¢«è®¿é—®å¸¸æ•°æ¬¡</li>
<li><strong>å®é™…åº”ç”¨ä»·å€¼</strong>ï¼šKMPåœ¨æ–‡æœ¬ç¼–è¾‘å™¨ã€æœç´¢å¼•æ“ç­‰åœºæ™¯ä¸­æœ‰é‡è¦åº”ç”¨</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ul>
<li><strong>è¾¹ç•Œæ¡ä»¶</strong>ï¼šç©ºå­—ç¬¦ä¸²çš„å¤„ç†</li>
<li><strong>ç´¢å¼•è®¡ç®—</strong>ï¼šè¿”å›å€¼åº”è¯¥æ˜¯ <code>i - m + 1</code> è€Œä¸æ˜¯ <code>i</code></li>
<li><strong>nextæ•°ç»„ç†è§£</strong>ï¼šè¦æ˜ç¡®æ˜¯&quot;é•¿åº¦&quot;è€Œä¸æ˜¯&quot;ç´¢å¼•&quot;</li>
<li><strong>å¤±é…é€»è¾‘</strong>ï¼šå¿…é¡»æ˜¯ <code>j &gt; 0</code> æ—¶æ‰èƒ½è·³è½¬</li>
</ul>
<p>è¿™é“é¢˜ä¸ä»…è€ƒæŸ¥å­—ç¬¦ä¸²å¤„ç†èƒ½åŠ›ï¼Œæ›´é‡è¦çš„æ˜¯å¯¹KMPç®—æ³•æ€æƒ³çš„æ·±å…¥ç†è§£ã€‚æŒæ¡KMPç®—æ³•å¯¹äºè§£å†³å¤æ‚çš„å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜å…·æœ‰é‡è¦æ„ä¹‰ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å­—ç¬¦ä¸²</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>KMPç®—æ³•</tag>
        <tag>æ¨¡å¼åŒ¹é…</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç»“æ„ï¼šListPack è¯¦è§£</title>
    <url>/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/listpack/</url>
    <content><![CDATA[<h1>ListPack è¯¦è§£</h1>
<h2 id="1-ListPack-çš„ç”±æ¥">1. ListPack çš„ç”±æ¥</h2>
<h3 id="1-1-å‹ç¼©åˆ—è¡¨çš„ç—›ç‚¹">1.1 <a href="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/">å‹ç¼©åˆ—è¡¨</a>çš„ç—›ç‚¹</h3>
<p>è™½ç„¶ QuickList é€šè¿‡&quot;åˆ†æ®µå‹ç¼©åˆ—è¡¨&quot;çš„æ–¹å¼å‡è½»äº†è¿é”æ›´æ–°å¸¦æ¥çš„æ€§èƒ½å½±å“ï¼Œä½†å¹¶æœªä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>QuickList å†…éƒ¨ä»ç„¶ä½¿ç”¨å‹ç¼©åˆ—è¡¨å­˜å‚¨æ•°æ®</li>
<li>è¿é”æ›´æ–°é—®é¢˜æºäºå‹ç¼©åˆ—è¡¨çš„<strong>ç»“æ„è®¾è®¡</strong>
<ul>
<li>å¼•å…¥<code>prevLen</code>å­—æ®µï¼Œè®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œå½“å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæœ‰å¯èƒ½å¯¼è‡´åç»­èŠ‚ç‚¹çš„<code>prevLen</code>å­—æ®µä¹Ÿå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯åŸå…ˆçš„<code>prevLen</code>å­—æ®µé•¿åº¦æ— æ³•è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼Œäºæ˜¯<code>prevLen</code>å­—æ®µä¹Ÿè¦å˜å¤§ï¼Œå¯¼è‡´å½“å‰èŠ‚ç‚¹é•¿åº¦ä¹Ÿè¦å˜å¤§ï¼Œäºæ˜¯è¿é”æ›´æ–°å°±å‘ç”Ÿäº†ã€‚</li>
</ul>
</li>
<li>å½“å‹ç¼©åˆ—è¡¨ä¸­çš„å…ƒç´ è¾ƒå¤šæ—¶ï¼Œæ€§èƒ½é—®é¢˜ä»ç„¶å­˜åœ¨</li>
</ul>
<h3 id="1-2-é©æ–°çš„éœ€æ±‚">1.2 é©æ–°çš„éœ€æ±‚</h3>
<p>è¦å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis å¼€å‘å›¢é˜Ÿå†³å®šï¼š</p>
<blockquote>
<p>è®¾è®¡ä¸€ä¸ªå…¨æ–°çš„æ•°æ®ç»“æ„æ¥æ›¿ä»£å‹ç¼©åˆ—è¡¨ï¼Œä»æ ¹æœ¬ä¸Šæ¶ˆé™¤è¿é”æ›´æ–°çš„éšæ‚£</p>
</blockquote>
<p>äºæ˜¯ï¼Œåœ¨ <strong>Redis 5.0 ç‰ˆæœ¬</strong>ä¸­ï¼ŒListPack æ•°æ®ç»“æ„åº”è¿è€Œç”Ÿã€‚</p>
<h2 id="2-ä»€ä¹ˆæ˜¯-ListPackï¼Ÿ">2. ä»€ä¹ˆæ˜¯ ListPackï¼Ÿ</h2>
<p>ListPack æ˜¯ä¸€ç§ä¸“ä¸º Redis è®¾è®¡çš„ç´§å‡‘å‹çº¿æ€§æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li><strong>è®¾è®¡ç›®æ ‡</strong>ï¼šæ›¿ä»£å‹ç¼©åˆ—è¡¨ï¼Œæ¶ˆé™¤è¿é”æ›´æ–°é—®é¢˜</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹ä¸å†ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦</li>
<li><strong>ç»“æ„å¸ƒå±€</strong>ï¼šä½¿ç”¨è¿ç»­å†…å­˜ç©ºé—´å­˜å‚¨æ•°æ®</li>
<li><strong>ç¼–ç æ–¹å¼</strong>ï¼šé’ˆå¯¹ä¸åŒç±»å‹å’Œå¤§å°çš„æ•°æ®é‡‡ç”¨ä¸åŒç¼–ç </li>
</ul>
<h2 id="3-ListPack-vs-å‹ç¼©åˆ—è¡¨">3. ListPack vs å‹ç¼©åˆ—è¡¨</h2>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å‹ç¼©åˆ—è¡¨ (ziplist)</th>
<th>ListPack</th>
</tr>
</thead>
<tbody>
<tr>
<td>å†…å­˜å¸ƒå±€</td>
<td>è¿ç»­å†…å­˜ç©ºé—´</td>
<td>è¿ç»­å†…å­˜ç©ºé—´</td>
</tr>
<tr>
<td>èŠ‚ç‚¹è®¾è®¡</td>
<td>ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦</td>
<td>åªä¿å­˜å½“å‰èŠ‚ç‚¹é•¿åº¦</td>
</tr>
<tr>
<td>è¿é”æ›´æ–°</td>
<td>å­˜åœ¨é£é™©</td>
<td>å®Œå…¨é¿å…</td>
</tr>
<tr>
<td>æ’å…¥æ€§èƒ½</td>
<td>å¯èƒ½å¯¼è‡´æ•´ä½“é‡æ–°åˆ†é…</td>
<td>å±€éƒ¨è°ƒæ•´ï¼Œå½±å“å°</td>
</tr>
<tr>
<td>å®ç°å¤æ‚åº¦</td>
<td>ç›¸å¯¹ç®€å•</td>
<td>ç¨å¾®å¤æ‚</td>
</tr>
</tbody>
</table>
<h2 id="4-ListPack-ç»“æ„è®¾è®¡">4. ListPack ç»“æ„è®¾è®¡</h2>
<h3 id="4-1-æ•´ä½“ç»“æ„">4.1 æ•´ä½“ç»“æ„</h3>
<p>ListPack ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ol>
<li><strong>å¤´éƒ¨</strong>ï¼šåŒ…å« ListPack æ€»å­—èŠ‚æ•°å’Œå…ƒç´ æ•°é‡</li>
<li><strong>èŠ‚ç‚¹åˆ—è¡¨</strong>ï¼šä¸€ç³»åˆ—ç´§å¯†æ’åˆ—çš„ ListPack èŠ‚ç‚¹</li>
<li><strong>ç»“å°¾æ ‡è¯†</strong>ï¼šç‰¹æ®Šå­—èŠ‚æ ‡è®° ListPack ç»“æŸ</li>
</ol>
<p><img src="/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/listpack/1748331428008.png" alt="ListPackç»“æ„å›¾"></p>
<h3 id="4-2-èŠ‚ç‚¹ç»“æ„">4.2 èŠ‚ç‚¹ç»“æ„</h3>
<p>æ¯ä¸ª ListPack èŠ‚ç‚¹åŒ…å«ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p>
<p><img src="/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/listpack/1748331435055.png" alt="ListPackèŠ‚ç‚¹ç»“æ„"></p>
<ol>
<li>
<p><strong>encoding</strong>ï¼šæŒ‡å®šå…ƒç´ çš„ç¼–ç ç±»å‹</p>
<ul>
<li>å­˜å‚¨æ•°æ®çš„ç±»å‹ï¼ˆæ•´æ•°/å­—ç¬¦ä¸²ï¼‰</li>
<li>å­˜å‚¨æ•°æ®çš„é•¿åº¦</li>
<li>ä½¿ç”¨å˜é•¿ç¼–ç èŠ‚çœç©ºé—´</li>
</ul>
</li>
<li>
<p><strong>data</strong>ï¼šå®é™…å­˜å‚¨çš„æ•°æ®å†…å®¹</p>
<ul>
<li>æ ¹æ® encoding æŒ‡å®šçš„ç±»å‹å’Œé•¿åº¦è¿›è¡Œè§£æ</li>
</ul>
</li>
<li>
<p><strong>len</strong>ï¼šå½“å‰èŠ‚ç‚¹çš„æ€»é•¿åº¦ï¼ˆencoding + dataï¼‰</p>
<ul>
<li>å…³é”®æ”¹è¿›ï¼š<strong>åªè®°å½•è‡ªèº«é•¿åº¦</strong>ï¼Œä¸è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦</li>
</ul>
</li>
</ol>
<h2 id="5-ListPack-å¦‚ä½•è§£å†³è¿é”æ›´æ–°é—®é¢˜ï¼Ÿ">5. ListPack å¦‚ä½•è§£å†³è¿é”æ›´æ–°é—®é¢˜ï¼Ÿ</h2>
<h3 id="5-1-è¿é”æ›´æ–°çš„æœ¬è´¨">5.1 è¿é”æ›´æ–°çš„æœ¬è´¨</h3>
<p>å‹ç¼©åˆ—è¡¨ä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿè¿é”æ›´æ–°ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºï¼š</p>
<ol>
<li>æ¯ä¸ªèŠ‚ç‚¹éœ€è¦ä¿å­˜<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦</strong></li>
<li>å½“å‰é©±èŠ‚ç‚¹é•¿åº¦å˜åŒ–æ—¶ï¼Œåç»­èŠ‚ç‚¹éƒ½éœ€è¦æ›´æ–°è¿™ä¸ªå­—æ®µ</li>
<li>æ›´æ–°å¯èƒ½å¯¼è‡´èŠ‚ç‚¹è‡ªèº«é•¿åº¦å˜åŒ–ï¼Œè¿›è€Œå½±å“æ›´å¤šèŠ‚ç‚¹</li>
</ol>
<h3 id="5-2-ListPack-çš„è§£å†³æ–¹æ¡ˆ">5.2 ListPack çš„è§£å†³æ–¹æ¡ˆ</h3>
<p>ListPack çš„è§£å†³æ–¹æ¡ˆéå¸¸ç®€å•ä½†é«˜æ•ˆï¼š</p>
<blockquote>
<p><strong>åªè®°å½•å½“å‰èŠ‚ç‚¹é•¿åº¦ï¼Œä¸è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦</strong></p>
</blockquote>
<p>è¿™æ ·ä¸€æ¥ï¼š</p>
<ul>
<li>å½“æ’å…¥/åˆ é™¤/ä¿®æ”¹èŠ‚ç‚¹æ—¶ï¼Œåªä¼šå½±å“å½“å‰æ“ä½œçš„èŠ‚ç‚¹</li>
<li>ä¸ä¼šå¯¼è‡´åç»­èŠ‚ç‚¹çš„å…ƒæ•°æ®ä¿¡æ¯å˜æ›´</li>
<li>æœ‰æ•ˆé¿å…äº†è¿é”ååº”</li>
</ul>
<h2 id="6-ListPack-çš„åº”ç”¨">6. ListPack çš„åº”ç”¨</h2>
<h3 id="6-1-åœ¨-Redis-ä¸­çš„åº”ç”¨è¿›ç¨‹">6.1 åœ¨ Redis ä¸­çš„åº”ç”¨è¿›ç¨‹</h3>
<p>Redis ç‰ˆæœ¬å¯¹åº”çš„ ListPack åº”ç”¨æƒ…å†µï¼š</p>
<ul>
<li>Redis 5.0ï¼šå¼•å…¥ ListPack æ•°æ®ç»“æ„</li>
<li>Redis 6.0ï¼šéƒ¨åˆ†æ•°æ®ç±»å‹å¼€å§‹ä½¿ç”¨ ListPack</li>
<li>Redis 7.0ï¼šå…¨é¢æ›¿ä»£å‹ç¼©åˆ—è¡¨</li>
</ul>
<h3 id="6-2-æ”¯æŒçš„æ•°æ®ç±»å‹">6.2 æ”¯æŒçš„æ•°æ®ç±»å‹</h3>
<p>ListPack ç›®å‰åœ¨ Redis ä¸­ä¸»è¦ç”¨äºä»¥ä¸‹æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>Hash å¯¹è±¡ï¼ˆå°å‹å“ˆå¸Œï¼‰</li>
<li>Zset å¯¹è±¡ï¼ˆå°å‹æœ‰åºé›†åˆï¼‰</li>
<li>æœªæ¥ä¼šæ‰©å±•åˆ°æ›´å¤šæ•°æ®ç±»å‹</li>
</ul>
<h2 id="7-ListPack-çš„ä¼˜ç¼ºç‚¹">7. ListPack çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="7-1-ä¼˜ç‚¹">7.1 ä¼˜ç‚¹</h3>
<ul>
<li><strong>å½»åº•è§£å†³</strong>è¿é”æ›´æ–°é—®é¢˜</li>
<li><strong>ä¿æŒé«˜æ•ˆ</strong>çš„å†…å­˜ä½¿ç”¨ç‡</li>
<li><strong>å…¼å®¹</strong>å‹ç¼©åˆ—è¡¨çš„å¤§éƒ¨åˆ†ä¼˜åŠ¿</li>
</ul>
<h3 id="7-2-å±€é™æ€§">7.2 å±€é™æ€§</h3>
<ul>
<li>è®¿é—®ç‰¹å®šä½ç½®å…ƒç´ ä¾ç„¶éœ€è¦çº¿æ€§éå†</li>
<li>ä¸é€‚åˆå­˜å‚¨å¤§é‡å…ƒç´ </li>
</ul>
<h2 id="8-å°ç»“">8. å°ç»“</h2>
<p>ListPack æ˜¯ Redis å¯¹å‹ç¼©åˆ—è¡¨çš„ä¸€æ¬¡æˆåŠŸé©æ–°ï¼Œé€šè¿‡å·§å¦™çš„ç»“æ„è®¾è®¡ï¼Œæ—¢ä¿ç•™äº†å‹ç¼©åˆ—è¡¨èŠ‚çœå†…å­˜çš„ä¼˜åŠ¿ï¼Œåˆè§£å†³äº†å…¶æ€§èƒ½éšæ‚£ã€‚è¿™ä¸€æ”¹è¿›å……åˆ†ä½“ç°äº† Redis å›¢é˜Ÿåœ¨ä¼˜åŒ–æ•°æ®ç»“æ„æ–¹é¢çš„æ·±æ€ç†Ÿè™‘å’Œä¸æ–­åˆ›æ–°çš„ç²¾ç¥ã€‚</p>
<p>ä»å‹ç¼©åˆ—è¡¨åˆ° QuickList å†åˆ° ListPackï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Redis æ•°æ®ç»“æ„çš„æ¼”è¿›å†ç¨‹ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯ä¸ºäº†åœ¨å†…å­˜ä½¿ç”¨æ•ˆç‡å’Œæ“ä½œæ€§èƒ½ä¹‹é—´å¯»æ‰¾æ›´å¥½çš„å¹³è¡¡ç‚¹ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Redis</tag>
        <tag>å‹ç¼©åˆ—è¡¨</tag>
        <tag>ListPack</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç»“æ„ï¼šQuickList è¯¦è§£</title>
    <url>/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/quicklist/</url>
    <content><![CDATA[<h1>QuickList è¯¦è§£</h1>
<h2 id="1-QuickList-çš„ç”±æ¥">1. QuickList çš„ç”±æ¥</h2>
<p>åœ¨ Redis 3.2 ç‰ˆæœ¬ä¹‹å‰ï¼ŒRedis çš„ List å¯¹è±¡åº•å±‚å®ç°å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li><strong>åŒå‘é“¾è¡¨</strong>ï¼ˆæ˜“äºæ“ä½œä½†å†…å­˜å¼€é”€å¤§ï¼‰</li>
<li><strong>å‹ç¼©åˆ—è¡¨</strong>ï¼ˆèŠ‚çœå†…å­˜ä½†æœ‰æ€§èƒ½éšæ‚£ï¼‰</li>
</ul>
<p>è€Œ Redis 3.2 ç‰ˆæœ¬å¼€å§‹ï¼ŒList å¯¹è±¡çš„åº•å±‚å®ç°ç»Ÿä¸€æ”¹ä¸ºäº† <strong>QuickList</strong> æ•°æ®ç»“æ„ã€‚</p>
<h2 id="2-ä»€ä¹ˆæ˜¯-QuickListï¼Ÿ">2. ä»€ä¹ˆæ˜¯ QuickListï¼Ÿ</h2>
<p>QuickList æœ¬è´¨ä¸Šæ˜¯ã€Œ<strong>åŒå‘é“¾è¡¨ + å‹ç¼©åˆ—è¡¨</strong>ã€çš„æ··åˆä½“ï¼š</p>
<ul>
<li><strong>ç»“æ„ç‰¹ç‚¹</strong>ï¼šæ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå‹ç¼©åˆ—è¡¨</li>
<li><strong>è®¾è®¡ç†å¿µ</strong>ï¼šå…¼é¡¾äº†åŒå‘é“¾è¡¨çš„å¿«é€Ÿæ’å…¥åˆ é™¤å’Œå‹ç¼©åˆ—è¡¨çš„å†…å­˜èŠ‚çœä¼˜åŠ¿</li>
</ul>
<p><img src="/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/quicklist/1748329930030.png" alt="QuickListç»“æ„ç¤ºæ„å›¾"></p>
<h2 id="3-ä¸ºä»€ä¹ˆéœ€è¦-QuickListï¼Ÿ">3. ä¸ºä»€ä¹ˆéœ€è¦ QuickListï¼Ÿ</h2>
<h3 id="3-1-å‹ç¼©åˆ—è¡¨çš„é—®é¢˜">3.1 å‹ç¼©åˆ—è¡¨çš„é—®é¢˜</h3>
<p>å‹ç¼©åˆ—è¡¨è™½ç„¶å†…å­˜åˆ©ç”¨ç‡é«˜ï¼Œä½†å­˜åœ¨ä¸¥é‡ç¼ºé™·ï¼š</p>
<ul>
<li><strong>è¿é”æ›´æ–°é£é™©</strong>ï¼šå½“ä¸€ä¸ªå…ƒç´ å‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½å¯¼è‡´åç»­æ‰€æœ‰å…ƒç´ ä½ç½®éƒ½éœ€è¦è°ƒæ•´</li>
<li><strong>æ€§èƒ½ä¸‹é™</strong>ï¼šå…ƒç´ æ•°é‡å¢åŠ æˆ–å…ƒç´ å˜å¤§æ—¶ï¼Œè¿é”æ›´æ–°é£é™©å¢åŠ ï¼Œæ“ä½œæ€§èƒ½æ€¥å‰§ä¸‹é™</li>
</ul>
<h3 id="3-2-QuickList-çš„è§£å†³æ–¹æ¡ˆ">3.2 QuickList çš„è§£å†³æ–¹æ¡ˆ</h3>
<p>QuickList å·§å¦™åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><strong>åˆ†è€Œæ²»ä¹‹</strong>ï¼šå°†æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªå°å‹å‹ç¼©åˆ—è¡¨ä¸­</li>
<li><strong>é™åˆ¶è§„æ¨¡</strong>ï¼šé€šè¿‡æ§åˆ¶æ¯ä¸ªå‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–å…ƒç´ ä¸ªæ•°</li>
<li><strong>é™ä½é£é™©</strong>ï¼šå³ä½¿å‘ç”Ÿè¿é”æ›´æ–°ï¼Œå½±å“èŒƒå›´è¢«é™åˆ¶åœ¨å•ä¸ªèŠ‚ç‚¹å†…</li>
</ul>
<blockquote>
<p>ğŸ“Œ <strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå‹ç¼©åˆ—è¡¨è¶Šå°ï¼Œè¿é”æ›´æ–°çš„å½±å“å°±è¶Šå°ï¼Œè®¿é—®æ€§èƒ½å°±è¶Šå¥½ã€‚</p>
</blockquote>
<h2 id="4-QuickList-çš„ç»“æ„è®¾è®¡">4. QuickList çš„ç»“æ„è®¾è®¡</h2>
<h3 id="4-1-ä¸»ä½“ç»“æ„">4.1 ä¸»ä½“ç»“æ„</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">quicklist</span> &#123;</span></span><br><span class="line">    quicklistNode *head;      <span class="comment">// é“¾è¡¨å¤´èŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">    quicklistNode *tail;      <span class="comment">// é“¾è¡¨å°¾èŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> count;      <span class="comment">// æ‰€æœ‰å‹ç¼©åˆ—è¡¨ä¸­çš„å…ƒç´ æ€»æ•°</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> len;        <span class="comment">// quicklistNode èŠ‚ç‚¹æ€»æ•°</span></span><br><span class="line">    <span class="comment">// å…¶ä»–é…ç½®å‚æ•°...</span></span><br><span class="line">&#125; quicklist;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-èŠ‚ç‚¹ç»“æ„">4.2 èŠ‚ç‚¹ç»“æ„</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">quicklistNode</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">quicklistNode</span> *<span class="title">prev</span>;</span>  <span class="comment">// å‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">quicklistNode</span> *<span class="title">next</span>;</span>  <span class="comment">// åä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *zl;           <span class="comment">// æŒ‡å‘å‹ç¼©åˆ—è¡¨çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> sz;             <span class="comment">// å‹ç¼©åˆ—è¡¨çš„å­—èŠ‚å¤§å°</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> count : <span class="number">16</span>;     <span class="comment">// å‹ç¼©åˆ—è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="comment">// å…¶ä»–é…ç½®å‚æ•°...</span></span><br><span class="line">&#125; quicklistNode;</span><br></pre></td></tr></table></figure>
<h2 id="5-QuickList-å¦‚ä½•å·¥ä½œï¼Ÿ">5. QuickList å¦‚ä½•å·¥ä½œï¼Ÿ</h2>
<h3 id="5-1-å…ƒç´ æ·»åŠ è¿‡ç¨‹">5.1 å…ƒç´ æ·»åŠ è¿‡ç¨‹</h3>
<p>å½“å‘ QuickList æ·»åŠ å…ƒç´ æ—¶ï¼š</p>
<ol>
<li><strong>å…ˆæ£€æŸ¥</strong>ï¼šåˆ¤æ–­æ’å…¥ä½ç½®çš„å‹ç¼©åˆ—è¡¨æ˜¯å¦èƒ½å®¹çº³æ–°å…ƒç´ </li>
<li><strong>èƒ½å®¹çº³</strong>ï¼šç›´æ¥å°†å…ƒç´ æ’å…¥åˆ°å¯¹åº”å‹ç¼©åˆ—è¡¨ä¸­</li>
<li><strong>ä¸èƒ½å®¹çº³</strong>ï¼šåˆ›å»ºæ–°çš„ quicklistNode èŠ‚ç‚¹ï¼Œå¹¶åœ¨å…¶ä¸­å­˜å‚¨æ–°å…ƒç´ </li>
</ol>
<h3 id="5-2-é…ç½®å‚æ•°">5.2 é…ç½®å‚æ•°</h3>
<p>Redis æä¾›äº†é…ç½®å‚æ•° <code>list-max-ziplist-size</code> æ¥æ§åˆ¶å‹ç¼©åˆ—è¡¨çš„å¤§å°ï¼š</p>
<ul>
<li><strong>æ­£æ•°å€¼</strong>ï¼šè¡¨ç¤ºæ¯ä¸ªå‹ç¼©åˆ—è¡¨æœ€å¤šåŒ…å«çš„å…ƒç´ ä¸ªæ•°</li>
<li><strong>è´Ÿæ•°å€¼</strong>ï¼šè¡¨ç¤ºæ¯ä¸ªå‹ç¼©åˆ—è¡¨çš„æœ€å¤§å­—èŠ‚æ•°
<ul>
<li><code>-1</code>: â‰¤4KB</li>
<li><code>-2</code>: â‰¤8KB</li>
<li><code>-3</code>: â‰¤16KB</li>
<li><code>-4</code>: â‰¤32KB</li>
<li><code>-5</code>: â‰¤64KB</li>
</ul>
</li>
</ul>
<h2 id="6-QuickList-çš„ä¼˜ç¼ºç‚¹">6. QuickList çš„ä¼˜ç¼ºç‚¹</h2>
<h3 id="6-1-ä¼˜ç‚¹">6.1 ä¼˜ç‚¹</h3>
<ul>
<li><strong>å†…å­˜æ•ˆç‡é«˜</strong>ï¼šå‹ç¼©åˆ—è¡¨èŠ‚çœå†…å­˜</li>
<li><strong>è®¿é—®æ€§èƒ½å¥½</strong>ï¼šåˆ†æ®µå­˜å‚¨é™åˆ¶äº†è¿é”æ›´æ–°çš„å½±å“èŒƒå›´</li>
<li><strong>æ“ä½œçµæ´»</strong>ï¼šåŒæ—¶æ”¯æŒé«˜æ•ˆçš„è¡¨å¤´è¡¨å°¾æ“ä½œ</li>
</ul>
<h3 id="6-2-ç¼ºç‚¹">6.2 ç¼ºç‚¹</h3>
<ul>
<li><strong>ç»“æ„å¤æ‚</strong>ï¼šæ¯”å•ä¸€æ•°æ®ç»“æ„çš„å®ç°æ›´å¤æ‚</li>
<li><strong>æœªå®Œå…¨è§£å†³</strong>ï¼šè™½ç„¶é™ä½äº†é£é™©ï¼Œä½†æ²¡æœ‰å½»åº•æ¶ˆé™¤è¿é”æ›´æ–°é—®é¢˜</li>
</ul>
<h2 id="7-å°ç»“">7. å°ç»“</h2>
<p>QuickList æ˜¯ Redis åœ¨å†…å­˜ä½¿ç”¨å’Œæ“ä½œæ•ˆç‡ä¹‹é—´å¯»æ±‚å¹³è¡¡çš„äº§ç‰©ï¼Œé€šè¿‡&quot;åˆ†æ®µå‹ç¼©åˆ—è¡¨&quot;çš„æ–¹å¼ï¼Œæœ‰æ•ˆæ§åˆ¶äº†è¿é”æ›´æ–°çš„é£é™©èŒƒå›´ã€‚è™½ç„¶æ²¡æœ‰å½»åº•è§£å†³å‹ç¼©åˆ—è¡¨çš„å›ºæœ‰é—®é¢˜ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å·²ç»å–å¾—äº†å¾ˆå¥½çš„æ•ˆæœã€‚</p>
<p>è¿™ä¹Ÿå¯å‘äº† Redis åç»­å¼€å‘ ListPack æ•°æ®ç»“æ„ï¼Œä»¥å½»åº•è§£å†³è¿é”æ›´æ–°é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>é“¾è¡¨</tag>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Redis</tag>
        <tag>å‹ç¼©åˆ—è¡¨</tag>
        <tag>QuickList</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç»“æ„ï¼šè·³è¡¨è¯¦è§£</title>
    <url>/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%B7%B3%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="è·³è¡¨">è·³è¡¨</h2>
<p><strong>ä»€ä¹ˆæ˜¯è·³è¡¨ï¼Ÿ</strong></p>
<p>è·³è¡¨ï¼ˆSkip Listï¼‰å¯ä»¥ç®€å•ç†è§£ä¸º&quot;<strong>å¸¦ç”µæ¢¯çš„å¤šå±‚æ¥¼æˆ¿</strong>&quot;ã€‚æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<ul>
<li>æ™®é€šé“¾è¡¨å°±åƒä¸€å±‚æ¥¼çš„èµ°å»Šï¼Œè¦æ‰¾æŸä¸ªæˆ¿é—´åªèƒ½ä¸€ä¸ªä¸€ä¸ªæˆ¿é—´åœ°èµ°è¿‡å»</li>
<li>è·³è¡¨å°±åƒå¤šå±‚æ¥¼æˆ¿ï¼Œä¸Šå±‚æ¥¼æœ‰&quot;å¿«é€Ÿé€šé“&quot;ï¼Œå¯ä»¥å¿«é€Ÿè·³è·ƒåˆ°ç›®æ ‡åŒºåŸŸï¼Œç„¶åå†åˆ°ä¸‹å±‚ç²¾ç¡®æŸ¥æ‰¾</li>
</ul>
<p>Redis åªæœ‰ Zsetï¼ˆæœ‰åºé›†åˆï¼‰å¯¹è±¡çš„åº•å±‚å®ç°ç”¨åˆ°äº†è·³è¡¨ï¼Œè·³è¡¨çš„ä¼˜åŠ¿æ˜¯èƒ½æ”¯æŒå¹³å‡ O(logN) å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆ Zset åŒæ—¶ä½¿ç”¨è·³è¡¨å’Œå“ˆå¸Œè¡¨ï¼Ÿ</strong></p>
<p>zset ç»“æ„ä½“é‡Œæœ‰ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼šä¸€ä¸ªæ˜¯è·³è¡¨ï¼Œä¸€ä¸ªæ˜¯å“ˆå¸Œè¡¨ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li><strong>è·³è¡¨è´Ÿè´£èŒƒå›´æŸ¥è¯¢</strong>ï¼šæ¯”å¦‚æŸ¥æ‰¾åˆ†æ•°åœ¨ 80-90 ä¹‹é—´çš„æ‰€æœ‰å­¦ç”Ÿ</li>
<li><strong>å“ˆå¸Œè¡¨è´Ÿè´£å•ç‚¹æŸ¥è¯¢</strong>ï¼šæ¯”å¦‚å¿«é€ŸæŸ¥æ‰¾å¼ ä¸‰çš„å…·ä½“åˆ†æ•°</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">    dict *dict;</span><br><span class="line">    zskiplist *zsl;</span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure>
<p><strong>æ•°æ®ä¸€è‡´æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ</strong></p>
<p>Zset å¯¹è±¡åœ¨æ‰§è¡Œæ•°æ®æ’å…¥æˆ–æ›´æ–°æ—¶ï¼Œä¼šåŒæ—¶åœ¨è·³è¡¨å’Œå“ˆå¸Œè¡¨ä¸­è¿›è¡Œç›¸åŒæ“ä½œï¼Œç¡®ä¿ä¸¤ä¸ªæ•°æ®ç»“æ„çš„ä¿¡æ¯ä¿æŒä¸€è‡´ã€‚å°±åƒé…’åº—çš„æˆ¿é—´ç™»è®°ç³»ç»Ÿï¼Œæ—¢è¦åœ¨æ¥¼å±‚åˆ†å¸ƒå›¾ä¸Šæ ‡è®°ï¼Œä¹Ÿè¦åœ¨å®¢æˆ·ä¿¡æ¯è¡¨ä¸­è®°å½•ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<ul>
<li><strong>æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong>ï¼ˆå¦‚ ZRANGEBYSCORE æ“ä½œï¼‰ï¼šä¾é è·³è¡¨çš„æœ‰åºç‰¹æ€§</li>
<li><strong>æ”¯æŒå¿«é€Ÿå•ç‚¹æŸ¥è¯¢</strong>ï¼ˆå¦‚ ZSCORE æ“ä½œï¼‰ï¼šä¾é å“ˆå¸Œè¡¨çš„ O(1) æŸ¥æ‰¾</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€šå¸¸åªè¯´è·³è¡¨æ˜¯ Zset çš„åº•å±‚ç»“æ„ï¼Ÿ</strong></p>
<p>è™½ç„¶ Zset å®é™…ä½¿ç”¨çš„æ˜¯ã€Œå“ˆå¸Œè¡¨ + è·³è¡¨ã€çš„ç»„åˆç»“æ„ï¼Œä½†æˆ‘ä»¬è®¨è®ºæ—¶é€šå¸¸åªæè·³è¡¨ï¼Œæ˜¯å› ä¸ºï¼š</p>
<ul>
<li>å“ˆå¸Œè¡¨ä¸»è¦èµ·<strong>è¾…åŠ©ä½œç”¨</strong>ï¼Œç”¨äºå¿«é€Ÿè·å–å…ƒç´ æƒé‡</li>
<li><strong>æ ¸å¿ƒæ“ä½œéƒ½æ˜¯ç”±è·³è¡¨å®ç°çš„</strong>ï¼Œæ¯”å¦‚èŒƒå›´æŸ¥è¯¢ã€æ’åºç­‰</li>
<li>è·³è¡¨å†³å®šäº† Zset çš„ä¸»è¦ç‰¹æ€§å’Œæ€§èƒ½è¡¨ç°</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œè¯¦ç»†çš„è¯´ä¸‹è·³è¡¨ã€‚</p>
<h3 id="è·³è¡¨ç»“æ„è®¾è®¡">è·³è¡¨ç»“æ„è®¾è®¡</h3>
<p>åœ¨ç†è§£è·³è¡¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ™®é€šé“¾è¡¨çš„é—®é¢˜ã€‚</p>
<p><strong>æ™®é€šé“¾è¡¨çš„æŸ¥æ‰¾é—®é¢˜ï¼š</strong><br>
é“¾è¡¨åœ¨æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œåªèƒ½ä»å¤´å¼€å§‹ä¸€ä¸ªä¸€ä¸ªèŠ‚ç‚¹åœ°éå†ï¼Œå°±åƒåœ¨ä¸€æ¡é•¿é•¿çš„é˜Ÿä¼ä¸­æ‰¾äººï¼Œåªèƒ½ä»é˜Ÿå¤´å¼€å§‹ä¸€ä¸ªä¸ªé—®è¿‡å»ï¼Œæ•ˆç‡å¾ˆä½ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(N)ã€‚</p>
<p><strong>è·³è¡¨çš„è§£å†³æ–¹æ¡ˆï¼š</strong><br>
è·³è¡¨æ˜¯åœ¨é“¾è¡¨åŸºç¡€ä¸Šæ”¹è¿›è¿‡æ¥çš„ï¼Œå®ç°äº†ä¸€ç§ã€Œå¤šå±‚ã€çš„æœ‰åºé“¾è¡¨ã€‚å°±åƒç»™é˜Ÿä¼å®‰æ’äº†å¤šä¸ª&quot;é˜Ÿé•¿&quot;ï¼Œå¯ä»¥å…ˆé—®é˜Ÿé•¿å¤§æ¦‚ä½ç½®ï¼Œå†åœ¨å°èŒƒå›´å†…ç²¾ç¡®æŸ¥æ‰¾ï¼Œè¿™æ ·èƒ½å¿«é€Ÿå®šä½æ•°æ®ã€‚</p>
<p>é‚£è·³è¡¨é•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘è¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå±‚çº§ä¸º 3 çš„è·³è¡¨ã€‚</p>
<p><img src="/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%B7%B3%E8%A1%A8/1748326331702.png" alt="1748326331702"></p>
<p>å›¾ä¸­å¤´èŠ‚ç‚¹æœ‰ L0~L2 ä¸‰ä¸ªå¤´æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘äº†ä¸åŒå±‚çº§çš„èŠ‚ç‚¹ï¼Œç„¶åæ¯ä¸ªå±‚çº§çš„èŠ‚ç‚¹éƒ½é€šè¿‡æŒ‡é’ˆè¿æ¥èµ·æ¥ï¼š</p>
<ul>
<li><strong>L0 å±‚çº§</strong>ï¼ˆæœ€åº•å±‚ï¼‰ï¼šå…±æœ‰ 5 ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯èŠ‚ç‚¹ 1ã€2ã€3ã€4ã€5ï¼ˆåŒ…å«æ‰€æœ‰èŠ‚ç‚¹ï¼‰</li>
<li><strong>L1 å±‚çº§</strong>ï¼ˆä¸­é—´å±‚ï¼‰ï¼šå…±æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯èŠ‚ç‚¹ 2ã€3ã€5ï¼ˆéƒ¨åˆ†èŠ‚ç‚¹ï¼‰</li>
<li><strong>L2 å±‚çº§</strong>ï¼ˆæœ€é«˜å±‚ï¼‰ï¼šåªæœ‰ 1 ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹ 3ï¼ˆæ›´å°‘èŠ‚ç‚¹ï¼‰</li>
</ul>
<p><strong>æŸ¥æ‰¾æ•ˆç‡å¯¹æ¯”ï¼š</strong></p>
<ul>
<li><strong>æ™®é€šé“¾è¡¨</strong>ï¼šè¦æ‰¾èŠ‚ç‚¹ 4ï¼Œéœ€è¦ä»å¤´å¼€å§‹ï¼š1â†’2â†’3â†’4ï¼ŒæŸ¥æ‰¾ 4 æ¬¡</li>
<li><strong>è·³è¡¨æŸ¥æ‰¾</strong>ï¼šåªéœ€è¦ 2 æ¬¡è·³è·ƒï¼š
<ol>
<li>ä» L2 å±‚ç›´æ¥è·³åˆ°èŠ‚ç‚¹ 3</li>
<li>ä»èŠ‚ç‚¹ 3 åœ¨ L0 å±‚å‘å‰ä¸€æ­¥æ‰¾åˆ°èŠ‚ç‚¹ 4</li>
</ol>
</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å°±æ˜¯åœ¨å¤šä¸ªå±‚çº§ä¸Šè·³æ¥è·³å»ï¼Œæœ€åå®šä½åˆ°å…ƒç´ ã€‚å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œè·³è¡¨çš„æŸ¥æ‰¾å¤æ‚åº¦å°±æ˜¯ O(logN)ã€‚</p>
<p><strong>è·³è¡¨èŠ‚ç‚¹æ˜¯æ€ä¹ˆå®ç°å¤šå±‚çº§çš„ï¼Ÿ</strong></p>
<p>è¦ç†è§£è·³è¡¨çš„å¤šå±‚çº§ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦çœ‹çœ‹ã€Œè·³è¡¨èŠ‚ç‚¹ã€çš„æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> &#123;</span></span><br><span class="line">    <span class="comment">//Zset å¯¹è±¡çš„å…ƒç´ å€¼</span></span><br><span class="line">    sds ele;</span><br><span class="line">    <span class="comment">//å…ƒç´ æƒé‡å€¼</span></span><br><span class="line">    <span class="type">double</span> score;</span><br><span class="line">    <span class="comment">//åå‘æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">backward</span>;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„ level æ•°ç»„ï¼Œä¿å­˜æ¯å±‚ä¸Šçš„å‰å‘æŒ‡é’ˆå’Œè·¨åº¦</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistLevel</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">forward</span>;</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> span;</span><br><span class="line">    &#125; level[];</span><br><span class="line">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬é€ä¸ªåˆ†æè¿™ä¸ªç»“æ„ä½“çš„å­—æ®µï¼š</p>
<p><strong>1. æ•°æ®å­˜å‚¨å­—æ®µï¼š</strong></p>
<ul>
<li><code>sds ele</code>ï¼šå­˜å‚¨ Zset å¯¹è±¡çš„å…ƒç´ å€¼ï¼ˆæ¯”å¦‚å­¦ç”Ÿå§“å&quot;å¼ ä¸‰&quot;ï¼‰</li>
<li><code>double score</code>ï¼šå­˜å‚¨å…ƒç´ çš„æƒé‡å€¼ï¼ˆæ¯”å¦‚å­¦ç”Ÿåˆ†æ•° 85.5ï¼‰</li>
</ul>
<p><strong>2. åå‘æŒ‡é’ˆï¼š</strong></p>
<ul>
<li><code>struct zskiplistNode *backward</code>ï¼šæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹</li>
<li>ä½œç”¨ï¼šæ–¹ä¾¿ä»è·³è¡¨å°¾èŠ‚ç‚¹å¼€å§‹å€’åºéå†ï¼Œå°±åƒå¯ä»¥ä»é˜Ÿå°¾å¾€å‰èµ°ä¸€æ ·</li>
</ul>
<p><strong>3. å…³é”®çš„å¤šå±‚çº§å®ç°ï¼š</strong></p>
<ul>
<li><code>struct zskiplistLevel level[]</code>ï¼šè¿™æ˜¯å®ç°å¤šå±‚çº§çš„å…³é”®ï¼</li>
</ul>
<p><strong>level æ•°ç»„æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</strong></p>
<ul>
<li>level æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨è·³è¡¨çš„ä¸€å±‚</li>
<li><code>level[0]</code> è¡¨ç¤ºç¬¬ä¸€å±‚ï¼ˆL0ï¼‰ï¼Œ<code>level[1]</code> è¡¨ç¤ºç¬¬äºŒå±‚ï¼ˆL1ï¼‰ï¼Œä»¥æ­¤ç±»æ¨</li>
<li>æ¯å±‚åŒ…å«ä¸¤ä¸ªä¿¡æ¯ï¼š
<ul>
<li><code>forward</code>ï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªè·³è¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆ</li>
<li><code>span</code>ï¼šè·¨åº¦ï¼Œè®°å½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»</li>
</ul>
</li>
</ul>
<p>æ¯”å¦‚ï¼Œä¸‹é¢è¿™å¼ å›¾ï¼Œå±•ç¤ºäº†å„ä¸ªèŠ‚ç‚¹çš„è·¨åº¦ã€‚</p>
<p><img src="/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%B7%B3%E8%A1%A8/1748326342079.png" alt="1748326342079"></p>
<p><strong>è·¨åº¦ï¼ˆspanï¼‰çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>å¾ˆå¤šäººç¬¬ä¸€çœ¼çœ‹åˆ°è·¨åº¦ï¼Œä¼šä»¥ä¸ºæ˜¯ç”¨æ¥è¾…åŠ©éå†çš„ï¼Œä½†å®é™…ä¸Šå¹¶ä¸æ˜¯ã€‚éå†æ“ä½œåªéœ€è¦ç”¨å‰å‘æŒ‡é’ˆï¼ˆforwardï¼‰å°±å¯ä»¥å®Œæˆäº†ã€‚</p>
<p><strong>è·¨åº¦çš„çœŸæ­£ä½œç”¨ï¼šè®¡ç®—èŠ‚ç‚¹æ’ä½</strong></p>
<ul>
<li>è·³è¡¨ä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯æŒ‰åˆ†æ•°æ’åºçš„</li>
<li>è¦è®¡ç®—æŸä¸ªèŠ‚ç‚¹åœ¨è·³è¡¨ä¸­çš„æ’ä½ï¼ˆæ’ç¬¬å‡ åï¼‰ï¼Œå°±éœ€è¦ç”¨åˆ°è·¨åº¦</li>
<li>è®¡ç®—æ–¹æ³•ï¼šä»å¤´èŠ‚ç‚¹åˆ°ç›®æ ‡èŠ‚ç‚¹çš„æŸ¥æ‰¾è·¯å¾„ä¸Šï¼Œå°†æ²¿é€”ç»è¿‡çš„æ‰€æœ‰å±‚çš„è·¨åº¦ç´¯åŠ èµ·æ¥</li>
</ul>
<p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong><br>
æŸ¥æ‰¾å›¾ä¸­èŠ‚ç‚¹ 3 åœ¨è·³è¡¨ä¸­çš„æ’ä½ï¼š</p>
<ol>
<li>ä»å¤´èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾èŠ‚ç‚¹ 3</li>
<li>æŸ¥æ‰¾è¿‡ç¨‹åªç»è¿‡äº†ä¸€ä¸ªå±‚ï¼ˆL2ï¼‰</li>
<li>L2 å±‚çš„è·¨åº¦æ˜¯ 3</li>
<li>æ‰€ä»¥èŠ‚ç‚¹ 3 åœ¨è·³è¡¨ä¸­çš„æ’ä½æ˜¯ç¬¬ 3 å</li>
</ol>
<p>è¿™å°±åƒé©¬æ‹‰æ¾æ¯”èµ›ä¸­çš„è·ç¦»æ ‡è®°ï¼Œé€šè¿‡ç´¯åŠ ç»è¿‡çš„è·ç¦»æ ‡è®°ï¼Œå¯ä»¥çŸ¥é“è·‘äº†å¤šè¿œã€‚</p>
<p><strong>å¤´èŠ‚ç‚¹çš„ç‰¹æ®Šæ€§ï¼š</strong><br>
å›¾ä¸­çš„å¤´èŠ‚ç‚¹å…¶å®ä¹Ÿæ˜¯ zskiplistNode è·³è¡¨èŠ‚ç‚¹ï¼Œåªä¸è¿‡å¤´èŠ‚ç‚¹æ¯”è¾ƒç‰¹æ®Šï¼š</p>
<ul>
<li>åå‘æŒ‡é’ˆã€æƒé‡ã€å…ƒç´ å€¼éƒ½æ²¡æœ‰ç”¨åˆ°ï¼ˆæ‰€ä»¥å›¾ä¸­çœç•¥äº†ï¼‰</li>
<li>ä¸»è¦ä½œç”¨æ˜¯ä½œä¸ºå„å±‚é“¾è¡¨çš„èµ·å§‹ç‚¹</li>
</ul>
<p><strong>è·³è¡¨çš„æ•´ä½“ç®¡ç†ç»“æ„ï¼š</strong><br>
é‚£ä¹ˆï¼Œç”±è°æ¥ç®¡ç†æ•´ä¸ªè·³è¡¨ï¼Œå®šä¹‰å“ªä¸ªèŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹å‘¢ï¼Ÿè¿™å°±éœ€è¦ä»‹ç»ã€Œè·³è¡¨ã€ç»“æ„ä½“äº†ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplist</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">header</span>, *<span class="title">tail</span>;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> length;</span><br><span class="line">    <span class="type">int</span> level;</span><br><span class="line">&#125; zskiplist;</span><br></pre></td></tr></table></figure>
<p>è·³è¡¨ç»“æ„é‡ŒåŒ…å«äº†å››ä¸ªé‡è¦ä¿¡æ¯ï¼š</p>
<ul>
<li>
<p><strong>header/tail</strong>ï¼šè·³è¡¨çš„å¤´å°¾èŠ‚ç‚¹æŒ‡é’ˆ</p>
<ul>
<li>å¥½å¤„ï¼šå¯ä»¥åœ¨ O(1) æ—¶é—´å†…ç›´æ¥è®¿é—®å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹</li>
<li>å°±åƒç”µæ¢¯æ¥¼å±‚æ˜¾ç¤ºå™¨ï¼Œå¯ä»¥ç›´æ¥çŸ¥é“æœ€é«˜å±‚å’Œæœ€ä½å±‚</li>
</ul>
</li>
<li>
<p><strong>length</strong>ï¼šè·³è¡¨çš„èŠ‚ç‚¹æ•°é‡</p>
<ul>
<li>å¥½å¤„ï¼šå¯ä»¥åœ¨ O(1) æ—¶é—´å†…è·å–è·³è¡¨æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹</li>
<li>å°±åƒæ¥¼æˆ¿çš„ä½æˆ·ç»Ÿè®¡è¡¨ï¼Œç›´æ¥çŸ¥é“æ€»å…±æœ‰å¤šå°‘ä½æˆ·</li>
</ul>
</li>
<li>
<p><strong>level</strong>ï¼šè·³è¡¨çš„æœ€å¤§å±‚æ•°</p>
<ul>
<li>å¥½å¤„ï¼šå¯ä»¥åœ¨ O(1) æ—¶é—´å†…çŸ¥é“è·³è¡¨çš„æœ€é«˜å±‚æ˜¯ç¬¬å‡ å±‚</li>
<li>å°±åƒå»ºç­‘ç‰©çš„æ¥¼å±‚æ ‡è¯†ï¼Œç›´æ¥çŸ¥é“è¿™æ ‹æ¥¼æœ‰å¤šé«˜</li>
</ul>
</li>
</ul>
<h3 id="è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹">è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹</h3>
<p><strong>è·³è¡¨æŸ¥æ‰¾çš„åŸºæœ¬ç­–ç•¥ï¼š</strong><br>
è·³è¡¨æŸ¥æ‰¾å°±åƒåœ¨å¤šå±‚åœè½¦åœºæ‰¾è½¦ä½ä¸€æ ·ï¼Œå…ˆä»æœ€é«˜å±‚å¿«é€Ÿå®šä½åŒºåŸŸï¼Œå†é€å±‚ä¸‹é™ç²¾ç¡®æŸ¥æ‰¾ã€‚</p>
<p><strong>å…·ä½“æŸ¥æ‰¾è¿‡ç¨‹ï¼š</strong><br>
è·³è¡¨ä¼šä»å¤´èŠ‚ç‚¹çš„æœ€é«˜å±‚å¼€å§‹ï¼Œé€ä¸€éå†æ¯ä¸€å±‚ã€‚åœ¨æ¯ä¸€å±‚æŸ¥æ‰¾æ—¶ï¼Œæœ‰æ˜ç¡®çš„åˆ¤æ–­è§„åˆ™ï¼š</p>
<p><strong>ä½•æ—¶ç»§ç»­åœ¨å½“å‰å±‚å‰è¿›ï¼Ÿ</strong><br>
æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶å°±ç»§ç»­åœ¨å½“å‰å±‚å‘å‰ç§»åŠ¨ï¼š</p>
<ol>
<li><strong>æƒé‡æ¯”è¾ƒ</strong>ï¼šä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æƒé‡ &lt; ç›®æ ‡æƒé‡</li>
<li><strong>ç›¸åŒæƒé‡æ—¶çš„å…ƒç´ æ¯”è¾ƒ</strong>ï¼šä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æƒé‡ = ç›®æ ‡æƒé‡ï¼Œä½†å…ƒç´ å€¼ &lt; ç›®æ ‡å…ƒç´ å€¼</li>
</ol>
<p><strong>ä½•æ—¶è·³åˆ°ä¸‹ä¸€å±‚ï¼Ÿ</strong><br>
å¦‚æœä¸Šé¢ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œå°±è·³åˆ°ä¸‹ä¸€å±‚ç»§ç»­æŸ¥æ‰¾ã€‚</p>
<p>è¿™ä¸ªç­–ç•¥ç¡®ä¿äº†ï¼š</p>
<ul>
<li>åœ¨æ¯ä¸€å±‚éƒ½èƒ½å¿«é€Ÿè·³è¿‡æ˜æ˜¾ä¸ç¬¦åˆçš„èŠ‚ç‚¹</li>
<li>æƒé‡ç›¸åŒæ—¶è¿˜èƒ½æ ¹æ®å…ƒç´ å€¼è¿›è¡Œç²¾ç¡®æ¯”è¾ƒ</li>
<li>é€å±‚ä¸‹é™ï¼Œæœ€ç»ˆç²¾ç¡®å®šä½ç›®æ ‡èŠ‚ç‚¹</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾æœ‰ä¸ª 3 å±‚çº§çš„è·³è¡¨ã€‚</p>
<p><img src="/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%B7%B3%E8%A1%A8/1748326431445.png" alt="1748326431445"></p>
<p><strong>å®é™…æŸ¥æ‰¾ç¤ºä¾‹ï¼š</strong><br>
å‡è®¾è¦æŸ¥æ‰¾ã€Œå…ƒç´ ï¼šabcdï¼Œæƒé‡ï¼š4ã€çš„èŠ‚ç‚¹ï¼Œæ•´ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šä» L2 å±‚å¼€å§‹</strong></p>
<ul>
<li>å½“å‰ä½ç½®ï¼šå¤´èŠ‚ç‚¹çš„ L2 å±‚</li>
<li>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼šã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€</li>
<li>åˆ¤æ–­ï¼š3 &lt; 4ï¼ˆç›®æ ‡æƒé‡ï¼‰ï¼Œç¬¦åˆæ¡ä»¶1ï¼Œç»§ç»­åœ¨ L2 å±‚å‰è¿›</li>
<li>åˆ°è¾¾ã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€èŠ‚ç‚¹</li>
</ul>
<p><strong>ç¬¬äºŒæ­¥ï¼šç»§ç»­åœ¨ L2 å±‚æŸ¥æ‰¾</strong></p>
<ul>
<li>å½“å‰ä½ç½®ï¼šã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€çš„ L2 å±‚</li>
<li>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼šç©ºèŠ‚ç‚¹</li>
<li>åˆ¤æ–­ï¼šä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œè·³åˆ°ä¸‹ä¸€å±‚ï¼ˆL1ï¼‰</li>
</ul>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šåœ¨ L1 å±‚æŸ¥æ‰¾</strong></p>
<ul>
<li>å½“å‰ä½ç½®ï¼šã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€çš„ L1 å±‚</li>
<li>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼šã€Œå…ƒç´ ï¼šabcdeï¼Œæƒé‡ï¼š4ã€</li>
<li>åˆ¤æ–­ï¼šæƒé‡ç›¸åŒï¼ˆ4=4ï¼‰ï¼Œä½† â€œabcdeâ€ &gt; â€œabcdâ€ï¼Œä¸ç¬¦åˆæ¡ä»¶2ï¼Œè·³åˆ°ä¸‹ä¸€å±‚ï¼ˆL0ï¼‰</li>
</ul>
<p><strong>ç¬¬å››æ­¥ï¼šåœ¨ L0 å±‚æŸ¥æ‰¾</strong></p>
<ul>
<li>å½“å‰ä½ç½®ï¼šã€Œå…ƒç´ ï¼šabcï¼Œæƒé‡ï¼š3ã€çš„ L0 å±‚</li>
<li>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼šã€Œå…ƒç´ ï¼šabcdï¼Œæƒé‡ï¼š4ã€</li>
<li>åˆ¤æ–­ï¼šæ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼æŸ¥æ‰¾ç»“æŸ</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹å±•ç¤ºäº†è·³è¡¨å¦‚ä½•åˆ©ç”¨å¤šå±‚ç»“æ„å¿«é€Ÿå®šä½ï¼Œé¿å…äº†é€ä¸ªéå†æ‰€æœ‰èŠ‚ç‚¹ã€‚</p>
<h3 id="è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®">è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®</h3>
<p><strong>å±‚çº§æ¯”ä¾‹å¯¹æ€§èƒ½çš„å½±å“</strong></p>
<p>è·³è¡¨çš„æ€§èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºç›¸é‚»ä¸¤å±‚èŠ‚ç‚¹æ•°é‡çš„æ¯”ä¾‹ã€‚å¦‚æœæ¯”ä¾‹ä¸å½“ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚</p>
<p><strong>ä¸è‰¯è®¾è®¡çš„ä¾‹å­ï¼š</strong><br>
ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªè®¾è®¡ä¸ä½³çš„è·³è¡¨ï¼Œç¬¬äºŒå±‚åªæœ‰ 1 ä¸ªèŠ‚ç‚¹ï¼Œè€Œç¬¬ä¸€å±‚æœ‰ 6 ä¸ªèŠ‚ç‚¹ã€‚</p>
<p><img src="/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%B7%B3%E8%A1%A8/1748326449383.png" alt="1748326449383"></p>
<p><strong>é—®é¢˜åˆ†æï¼š</strong><br>
å¦‚æœè¦æŸ¥è¯¢èŠ‚ç‚¹ 6ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>ç¬¬äºŒå±‚åªèƒ½è·³åˆ°èŠ‚ç‚¹ 3ï¼Œç„¶åå°±æ²¡æœ‰æ›´å¤šèŠ‚ç‚¹äº†</li>
<li>åªèƒ½åœ¨ç¬¬ä¸€å±‚ä»èŠ‚ç‚¹ 3 å¼€å§‹ï¼š3â†’4â†’5â†’6ï¼Œé€ä¸ªæŸ¥æ‰¾</li>
<li>è¿™æ ·å°±å¤±å»äº†è·³è¡¨çš„ä¼˜åŠ¿ï¼ŒæŸ¥è¯¢å¤æ‚åº¦é€€åŒ–ä¸º O(N)</li>
</ul>
<p><strong>ç†æƒ³çš„å±‚çº§æ¯”ä¾‹ï¼š</strong><br>
ä¸ºäº†ä¿æŒè·³è¡¨çš„é«˜æ•ˆæ€§ï¼Œ<strong>ç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡æœ€ç†æƒ³çš„æ¯”ä¾‹æ˜¯ 2:1</strong>ï¼Œè¿™æ ·å¯ä»¥å°†æŸ¥æ‰¾å¤æ‚åº¦ç»´æŒåœ¨ O(logN)ã€‚</p>
<p><strong>è‰¯å¥½è®¾è®¡çš„ä¾‹å­ï¼š</strong><br>
ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„è·³è¡¨ï¼Œç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡æ¯”ä¾‹æ¥è¿‘ 2:1ã€‚</p>
<p><img src="/2025/05/27/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%B7%B3%E8%A1%A8/1748326457615.png" alt="1748326457615"></p>
<blockquote>
<p>é‚£æ€æ ·æ‰èƒ½ç»´æŒç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡çš„æ¯”ä¾‹ä¸º 2 : 1  å‘¢ï¼Ÿ</p>
</blockquote>
<p><strong>å¦‚ä½•ç»´æŒç†æƒ³çš„å±‚çº§æ¯”ä¾‹ï¼Ÿ</strong></p>
<p>ä¼ ç»Ÿåšæ³•æ˜¯åœ¨æ–°å¢æˆ–åˆ é™¤èŠ‚ç‚¹æ—¶è°ƒæ•´è·³è¡¨ç»“æ„æ¥ç»´æŒ 2:1 æ¯”ä¾‹ï¼Œä½†è¿™ä¼šå¸¦æ¥é¢å¤–çš„è®¡ç®—å¼€é”€ã€‚</p>
<p><strong>Redis çš„å·§å¦™è§£å†³æ–¹æ¡ˆï¼šéšæœºå±‚æ•°ç”Ÿæˆ</strong></p>
<p>Redis é‡‡ç”¨äº†ä¸€ç§æ›´å·§å¦™çš„æ–¹æ³•ï¼š<strong>åœ¨åˆ›å»ºèŠ‚ç‚¹æ—¶éšæœºç”Ÿæˆæ¯ä¸ªèŠ‚ç‚¹çš„å±‚æ•°</strong>ï¼Œè€Œä¸æ˜¯ä¸¥æ ¼ç»´æŒ 2:1 æ¯”ä¾‹ã€‚</p>
<p><strong>éšæœºç”Ÿæˆç®—æ³•ï¼š</strong></p>
<ol>
<li>ç”Ÿæˆä¸€ä¸ª [0-1] èŒƒå›´çš„éšæœºæ•°</li>
<li>å¦‚æœéšæœºæ•° &lt; 0.25ï¼ˆ25% æ¦‚ç‡ï¼‰ï¼Œå±‚æ•°å¢åŠ  1</li>
<li>ç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œé‡å¤æ­¥éª¤ 2</li>
<li>ç›´åˆ°éšæœºæ•° â‰¥ 0.25 ä¸ºæ­¢ï¼Œç¡®å®šæœ€ç»ˆå±‚æ•°</li>
</ol>
<p><strong>è¿™ç§æ–¹æ³•çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ¯å¢åŠ ä¸€å±‚çš„æ¦‚ç‡æ˜¯ 25%</li>
<li>å±‚æ•°è¶Šé«˜ï¼Œå‡ºç°æ¦‚ç‡è¶Šä½</li>
<li>å±‚é«˜æœ€å¤§é™åˆ¶æ˜¯ 64ï¼ˆRedis 7.0 ä¸­æ˜¯ 32ï¼‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéšæœºæ–¹æ³•æœ‰æ•ˆï¼Ÿ</strong></p>
<ul>
<li>25% çš„æ¦‚ç‡æ„å‘³ç€å¹³å‡æ¯ 4 ä¸ªèŠ‚ç‚¹ä¸­æœ‰ 1 ä¸ªä¼šå‡ºç°åœ¨æ›´é«˜å±‚</li>
<li>è¿™è‡ªç„¶å½¢æˆäº†æ¥è¿‘ 4:1 çš„æ¯”ä¾‹å…³ç³»ï¼ˆè™½ç„¶ä¸æ˜¯ä¸¥æ ¼çš„ 2:1ï¼Œä½†ä»ç„¶æœ‰æ•ˆï¼‰</li>
<li>é¿å…äº†å¤æ‚çš„å¹³è¡¡è°ƒæ•´æ“ä½œ</li>
</ul>
<p><strong>å…³äºå¤´èŠ‚ç‚¹çš„å±‚æ•°ï¼š</strong><br>
å‰é¢å›¾ä¾‹ä¸­ä¸ºäº†ç®€åŒ–è¯´æ˜ï¼Œå¤´èŠ‚ç‚¹åªç”»äº† 3 å±‚ï¼Œä½†å®é™…ä¸Š<strong>å¤´èŠ‚ç‚¹ä¼šç›´æ¥åˆ›å»ºæœ€å¤§å±‚æ•°çš„ç»“æ„</strong>ã€‚å¦‚æœæœ€å¤§å±‚æ•°é™åˆ¶æ˜¯ 32ï¼Œé‚£ä¹ˆå¤´èŠ‚ç‚¹å°±æœ‰ 32 å±‚ï¼Œè¿™æ ·å¯ä»¥æ”¯æŒä»»æ„é«˜åº¦çš„èŠ‚ç‚¹æ’å…¥ã€‚</p>
<p><strong>å¤´èŠ‚ç‚¹çš„åˆ›å»ºè¿‡ç¨‹ï¼š</strong><br>
ä»ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºè·³è¡¨æ—¶ï¼š</p>
<ul>
<li>å¤´èŠ‚ç‚¹çš„ level æ•°ç»„æœ‰ ZSKIPLIST_MAXLEVEL ä¸ªå…ƒç´ ï¼ˆå±‚ï¼‰</li>
<li>å¤´èŠ‚ç‚¹ä¸å­˜å‚¨ä»»ä½•å®é™…æ•°æ®ï¼ˆmember å’Œ score éƒ½ä¸ºç©ºï¼‰</li>
<li>æ‰€æœ‰å±‚çš„ forward æŒ‡é’ˆéƒ½æŒ‡å‘ NULL</li>
<li>æ‰€æœ‰å±‚çš„ span å€¼éƒ½ä¸º 0</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Create a new skiplist. */</span></span><br><span class="line">zskiplist *<span class="title function_">zslCreate</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    zskiplist *zsl;</span><br><span class="line"></span><br><span class="line">    zsl = zmalloc(<span class="keyword">sizeof</span>(*zsl));</span><br><span class="line">    zsl-&gt;level = <span class="number">1</span>;</span><br><span class="line">    zsl-&gt;length = <span class="number">0</span>;</span><br><span class="line">    zsl-&gt;header = zslCreateNode(ZSKIPLIST_MAXLEVEL,<span class="number">0</span>,<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; ZSKIPLIST_MAXLEVEL; j++) &#123;</span><br><span class="line">        zsl-&gt;header-&gt;level[j].forward = <span class="literal">NULL</span>;</span><br><span class="line">        zsl-&gt;header-&gt;level[j].span = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    zsl-&gt;header-&gt;backward = <span class="literal">NULL</span>;</span><br><span class="line">    zsl-&gt;tail = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> zsl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¸åŒç‰ˆæœ¬çš„æœ€å¤§å±‚æ•°é™åˆ¶ï¼š</strong></p>
<ul>
<li>Redis 7.0ï¼š32 å±‚</li>
<li>Redis 5.0ï¼š64 å±‚</li>
<li>Redis 3.0ï¼š32 å±‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒRedis åœ¨ä¸åŒç‰ˆæœ¬ä¸­å¯¹æœ€å¤§å±‚æ•°è¿›è¡Œäº†è°ƒæ•´ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°æ›´å¥½çš„å¹³è¡¡ç‚¹ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ">ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</h3>
<p><strong>å¸¸è§é¢è¯•é¢˜è§£æ</strong></p>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆ Zset é€‰æ‹©è·³è¡¨è€Œä¸æ˜¯å¹³è¡¡æ ‘ï¼ˆå¦‚ AVL æ ‘ã€çº¢é»‘æ ‘ç­‰ï¼‰ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ Redis ä½œè€… @antirez çš„<a href="https://news.ycombinator.com/item?id=1171423">åŸè¯</a>ï¼š</p>
<blockquote>
<p>There are a few reasons:</p>
<ol>
<li>
<p>They are not very memory intensive. Itâ€™s up to you basically. Changing parameters about the probability of a node to have a given number of levels will make then less memory intensive than btrees.</p>
</li>
<li>
<p>A sorted set is often target of many ZRANGE or ZREVRANGE operations, that is, traversing the skip list as a linked list. With this operation the cache locality of skip lists is at least as good as with other kind of balanced trees.</p>
</li>
<li>
<p>They are simpler to implement, debug, and so forth. For instance thanks to the skip list simplicity I received a patch (already in Redis master) with augmented skip lists implementing ZRANK in O(log(N)). It required little changes to the code.</p>
</li>
</ol>
</blockquote>
<p><strong>ä½œè€…è§‚ç‚¹çš„æ€»ç»“å’Œæ·±å…¥åˆ†æï¼š</strong></p>
<p>ä½œè€…ä¸»è¦ä»ä¸‰ä¸ªæ–¹é¢è¯´æ˜äº†é€‰æ‹©è·³è¡¨çš„åŸå› ï¼Œè®©æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p>
<p><strong>1. å†…å­˜ä½¿ç”¨æ›´çµæ´»</strong></p>
<ul>
<li><strong>å¹³è¡¡æ ‘</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹å›ºå®šåŒ…å« 2 ä¸ªæŒ‡é’ˆï¼ˆå·¦å³å­æ ‘ï¼‰</li>
<li><strong>è·³è¡¨</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆæ•°é‡æ˜¯åŠ¨æ€çš„ï¼Œå¹³å‡ä¸º 1/(1-p)</li>
<li>åœ¨ Redis ä¸­ï¼Œp=1/4ï¼Œæ‰€ä»¥å¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 1.33 ä¸ªæŒ‡é’ˆ</li>
<li><strong>ç»“è®º</strong>ï¼šè·³è¡¨æ¯”å¹³è¡¡æ ‘èŠ‚çœå†…å­˜</li>
</ul>
<p><strong>2. èŒƒå›´æŸ¥è¯¢æ›´ç®€å•</strong></p>
<ul>
<li><strong>å¹³è¡¡æ ‘çš„é—®é¢˜</strong>ï¼šæ‰¾åˆ°èŒƒå›´çš„èµ·å§‹å€¼åï¼Œéœ€è¦è¿›è¡Œå¤æ‚çš„ä¸­åºéå†æ¥æ‰¾åˆ°èŒƒå›´å†…çš„æ‰€æœ‰èŠ‚ç‚¹</li>
<li><strong>è·³è¡¨çš„ä¼˜åŠ¿</strong>ï¼šæ‰¾åˆ°èµ·å§‹å€¼åï¼Œåªéœ€è¦åœ¨ç¬¬ 1 å±‚ï¼ˆæœ€åº•å±‚ï¼‰é“¾è¡¨ä¸Šè¿ç»­éå†å³å¯</li>
<li><strong>æ¯”å–»</strong>ï¼šå°±åƒåœ¨å›¾ä¹¦é¦†æ‰¾ä¹¦ï¼Œè·³è¡¨ç›¸å½“äºæ‰¾åˆ°ä¹¦æ¶åç›´æ¥ä»å·¦åˆ°å³æ‹¿ä¹¦ï¼Œè€Œå¹³è¡¡æ ‘éœ€è¦åœ¨æ•´ä¸ªå›¾ä¹¦é¦†é‡ŒæŒ‰ç‰¹å®šé¡ºåºè·³ç€æ‰¾ä¹¦</li>
</ul>
<p><strong>3. å®ç°å’Œç»´æŠ¤æ›´ç®€å•</strong></p>
<ul>
<li><strong>å¹³è¡¡æ ‘çš„å¤æ‚æ€§</strong>ï¼šæ’å…¥å’Œåˆ é™¤å¯èƒ½è§¦å‘å¤æ‚çš„æ ‘ç»“æ„è°ƒæ•´ï¼ˆæ—‹è½¬æ“ä½œï¼‰ï¼Œä»£ç å¤æ‚ï¼Œè°ƒè¯•å›°éš¾</li>
<li><strong>è·³è¡¨çš„ç®€å•æ€§</strong>ï¼šæ’å…¥å’Œåˆ é™¤åªéœ€è¦ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå°±åƒåœ¨é“¾è¡¨ä¸­æ’å…¥èŠ‚ç‚¹ä¸€æ ·ç®€å•</li>
<li><strong>å®é™…å¥½å¤„</strong>ï¼šä»£ç æ˜“è¯»ã€æ˜“ç»´æŠ¤ã€æ˜“æ‰©å±•ï¼ˆæ¯”å¦‚æ·»åŠ  ZRANK åŠŸèƒ½åªéœ€è¦å°‘é‡ä»£ç ä¿®æ”¹ï¼‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¿™äº›ç‰¹ç‚¹å¯¹ Redis å¾ˆé‡è¦ï¼Ÿ</strong></p>
<ul>
<li><strong>Zset ç»å¸¸éœ€è¦èŒƒå›´æŸ¥è¯¢</strong>ï¼ˆZRANGEã€ZREVRANGE ç­‰å‘½ä»¤ï¼‰</li>
<li><strong>Redis å¼ºè°ƒç®€å•å’Œå¯é æ€§</strong>ï¼Œå¤æ‚çš„å¹³è¡¡æ ‘å¢åŠ äº†å‡ºé”™é£é™©</li>
<li><strong>å†…å­˜æ˜¯ Redis çš„é‡è¦è€ƒé‡</strong>ï¼Œè·³è¡¨çš„å†…å­˜æ•ˆç‡æ›´ç¬¦åˆéœ€æ±‚</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Redis</tag>
        <tag>è·³è¡¨</tag>
        <tag>skiplist</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 135 - åˆ†å‘ç³–æœï¼ˆCandyï¼‰</title>
    <url>/2025/05/27/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-135-%E5%88%86%E5%8F%91%E7%B3%96%E6%9E%9C/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯ä¸€ä½è€å¸ˆï¼Œè¦ç»™ç­ä¸Šçš„å­©å­ä»¬åˆ†å‘ç³–æœ ğŸ­ã€‚å­©å­ä»¬æ’æˆä¸€æ’ï¼Œæ¯ä¸ªå­©å­éƒ½æœ‰ä¸€ä¸ªè¯„åˆ†ï¼ˆå¯ä»¥ç†è§£ä¸ºè€ƒè¯•æˆç»©ï¼‰ã€‚</p>
<p><strong>åˆ†ç³–æœçš„è§„åˆ™å¾ˆç®€å•ï¼š</strong></p>
<ol>
<li>æ¯ä¸ªå­©å­è‡³å°‘è¦æœ‰ 1 é¢—ç³–æœï¼ˆä¸èƒ½è®©ä»»ä½•å­©å­ç©ºæ‰‹è€Œå½’ï¼‰</li>
<li>å¦‚æœç›¸é‚»çš„ä¸¤ä¸ªå­©å­ï¼Œè¯„åˆ†é«˜çš„é‚£ä¸ªå¿…é¡»æ¯”è¯„åˆ†ä½çš„æ‹¿åˆ°æ›´å¤šç³–æœ</li>
</ol>
<p><strong>ä½ çš„ä»»åŠ¡ï¼š</strong> ç”¨æœ€å°‘çš„ç³–æœæ•°é‡ï¼Œè®©æ‰€æœ‰å­©å­éƒ½æ»¡æ„ï¼</p>
<p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å­©å­è¯„åˆ†ï¼š[1, 0, 2]</span><br><span class="line">æœ€ä¼˜åˆ†é…ï¼š[2, 1, 2]  æ€»å…±éœ€è¦ 5 é¢—ç³–æœ</span><br></pre></td></tr></table></figure>
<p>ä¸ºä»€ä¹ˆè¿™æ ·åˆ†é…ï¼Ÿ</p>
<ul>
<li>ç¬¬1ä¸ªå­©å­(è¯„åˆ†1) vs ç¬¬2ä¸ªå­©å­(è¯„åˆ†0)ï¼š1 &gt; 0ï¼Œæ‰€ä»¥ç¬¬1ä¸ªå­©å­è¦æ¯”ç¬¬2ä¸ªå¤š â†’ 2é¢— vs 1é¢— âœ…</li>
<li>ç¬¬2ä¸ªå­©å­(è¯„åˆ†0) vs ç¬¬3ä¸ªå­©å­(è¯„åˆ†2)ï¼š0 &lt; 2ï¼Œæ‰€ä»¥ç¬¬3ä¸ªå­©å­è¦æ¯”ç¬¬2ä¸ªå¤š â†’ 1é¢— vs 2é¢— âœ…</li>
</ul>
<h2 id="æˆ‘æœ€å¼€å§‹çš„é”™è¯¯æƒ³æ³•-ğŸ˜…">æˆ‘æœ€å¼€å§‹çš„é”™è¯¯æƒ³æ³• ğŸ˜…</h2>
<h3 id="âŒ-æƒ³æ³•ä¸€ï¼šåªçœ‹å·¦è¾¹é‚»å±…">âŒ æƒ³æ³•ä¸€ï¼šåªçœ‹å·¦è¾¹é‚»å±…</h3>
<p>æˆ‘åˆšå¼€å§‹æƒ³ï¼Œæ—¢ç„¶è¦æ»¡è¶³è§„åˆ™ï¼Œé‚£å°±ä»å·¦åˆ°å³éå†ï¼Œæ¯æ¬¡åªè¦æ¯”å·¦è¾¹é‚»å±…æ»¡è¶³æ¡ä»¶å°±è¡Œäº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ è¿™æ ·æƒ³æ˜¯é”™çš„ï¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">candy</span><span class="params">(ratings []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(ratings)</span><br><span class="line">    candies := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    candies[<span class="number">0</span>] = <span class="number">1</span>  <span class="comment">// ç¬¬ä¸€ä¸ªå­©å­ç»™1é¢—</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> ratings[i] &gt; ratings[i<span class="number">-1</span>] &#123;</span><br><span class="line">            candies[i] = candies[i<span class="number">-1</span>] + <span class="number">1</span>  <span class="comment">// æ¯”å·¦è¾¹å¤š1é¢—</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            candies[i] = <span class="number">1</span>  <span class="comment">// å¦åˆ™å°±ç»™1é¢—</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¡ç®—æ€»æ•°...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿™æ ·åšé”™åœ¨å“ªé‡Œï¼Ÿ</strong></p>
<p>è®©æˆ‘ä»¬ç”¨ä¾‹å­ <code>[1,0,2]</code> è¯•è¯•ï¼š</p>
<ul>
<li>ç¬¬1ä¸ªå­©å­ï¼šç»™1é¢—</li>
<li>ç¬¬2ä¸ªå­©å­ï¼šè¯„åˆ†0 &lt; è¯„åˆ†1ï¼Œæ‰€ä»¥ç»™1é¢—</li>
<li>ç¬¬3ä¸ªå­©å­ï¼šè¯„åˆ†2 &gt; è¯„åˆ†0ï¼Œæ‰€ä»¥ç»™2é¢—</li>
</ul>
<p>ç»“æœï¼š<code>[1,1,2]</code></p>
<p><strong>é—®é¢˜å‡ºç°äº†ï¼</strong> ç¬¬1ä¸ªå­©å­è¯„åˆ†1ï¼Œç¬¬2ä¸ªå­©å­è¯„åˆ†0ï¼Œä½†æ˜¯ä»–ä»¬éƒ½æ‹¿1é¢—ç³–æœï¼è¿™è¿åäº†è§„åˆ™ï¼šè¯„åˆ†é«˜çš„åº”è¯¥æ‹¿æ›´å¤šç³–æœã€‚</p>
<p><strong>æ•™è®­ï¼šåªçœ‹ä¸€è¾¹æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶æ»¡è¶³å·¦å³ä¸¤è¾¹çš„å…³ç³»ï¼</strong></p>
<h3 id="âŒ-æƒ³æ³•äºŒï¼šè¾¹éå†è¾¹ä¿®æ­£">âŒ æƒ³æ³•äºŒï¼šè¾¹éå†è¾¹ä¿®æ­£</h3>
<p>ç„¶åæˆ‘æƒ³ï¼Œé‚£æˆ‘åœ¨éå†çš„æ—¶å€™ï¼Œå‘ç°é—®é¢˜å°±ç«‹å³ä¿®æ­£ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ è¿™æ ·ä¹Ÿæ˜¯é”™çš„ï¼</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">    <span class="keyword">if</span> ratings[i] &gt; ratings[i<span class="number">-1</span>] &#123;</span><br><span class="line">        candies[i] = candies[i<span class="number">-1</span>] + <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        candies[i] = <span class="number">1</span></span><br><span class="line">        <span class="comment">// å‘ç°å·¦è¾¹çš„å­©å­ç³–æœå¯èƒ½ä¸å¤Ÿï¼Œé©¬ä¸Šä¿®æ­£</span></span><br><span class="line">        <span class="keyword">if</span> ratings[i<span class="number">-1</span>] &gt; ratings[i] &amp;&amp; candies[i<span class="number">-1</span>] &lt;= candies[i] &#123;</span><br><span class="line">            candies[i<span class="number">-1</span>] = candies[i] + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿™æ ·è¿˜æ˜¯é”™çš„ï¼</strong> å› ä¸ºå½“æˆ‘ä¿®æ”¹å‰é¢å­©å­çš„ç³–æœæ•°æ—¶ï¼Œå¯èƒ½åˆå½±å“äº†æ›´å‰é¢çš„å­©å­ï¼Œéœ€è¦è¿é”ä¿®æ­£ï¼Œä¸€ééå†æ ¹æœ¬æä¸å®šã€‚</p>
<p><strong>æ•™è®­ï¼šè¿™ç§é—®é¢˜éœ€è¦æ›´ç³»ç»Ÿçš„æ€è€ƒæ–¹å¼ï¼</strong></p>
<h2 id="æ­£ç¡®è§£æ³•ï¼šåˆ†æ­¥éª¤æ€è€ƒ">æ­£ç¡®è§£æ³•ï¼šåˆ†æ­¥éª¤æ€è€ƒ</h2>
<h3 id="ğŸ’¡-æ ¸å¿ƒæ€æƒ³ï¼šåˆ†è€Œæ²»ä¹‹">ğŸ’¡ æ ¸å¿ƒæ€æƒ³ï¼šåˆ†è€Œæ²»ä¹‹</h3>
<p>æ—¢ç„¶ä¸€æ¬¡æå®šå·¦å³å…³ç³»å¾ˆå›°éš¾ï¼Œé‚£æˆ‘ä»¬å°±åˆ†ä¸¤æ­¥ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€æ­¥ï¼š</strong> åªè€ƒè™‘å·¦è¾¹å…³ç³»ï¼Œä»å·¦åˆ°å³éå†</li>
<li><strong>ç¬¬äºŒæ­¥ï¼š</strong> åªè€ƒè™‘å³è¾¹å…³ç³»ï¼Œä»å³åˆ°å·¦éå†</li>
<li><strong>æœ€åï¼š</strong> æ¯ä¸ªä½ç½®å–ä¸¤ç§è¦æ±‚çš„æœ€å¤§å€¼</li>
</ol>
<h3 id="æ–¹æ³•ä¸€ï¼šä¸¤æ¬¡éå†ï¼ˆæ¨èæ–°æ‰‹ç†è§£ï¼‰">æ–¹æ³•ä¸€ï¼šä¸¤æ¬¡éå†ï¼ˆæ¨èæ–°æ‰‹ç†è§£ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">candy</span><span class="params">(ratings []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(ratings)</span><br><span class="line">    left := <span class="built_in">make</span>([]<span class="type">int</span>, n)  <span class="comment">// å­˜å‚¨åªè€ƒè™‘å·¦è¾¹å…³ç³»çš„ç»“æœ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ğŸš¶â€â™‚ï¸ ç¬¬ä¸€æ¬¡éå†ï¼šä»å·¦åˆ°å³ï¼Œåªç®¡å·¦è¾¹é‚»å±…</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> &amp;&amp; ratings[i] &gt; ratings[i<span class="number">-1</span>] &#123;</span><br><span class="line">            left[i] = left[i<span class="number">-1</span>] + <span class="number">1</span>  <span class="comment">// æ¯”å·¦è¾¹å¤š1é¢—</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left[i] = <span class="number">1</span>  <span class="comment">// æœ€å°‘1é¢—</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ğŸš¶â€â™€ï¸ ç¬¬äºŒæ¬¡éå†ï¼šä»å³åˆ°å·¦ï¼Œåªç®¡å³è¾¹é‚»å±…</span></span><br><span class="line">    right := <span class="number">1</span>  <span class="comment">// å½“å‰ä½ç½®ä»å³è¾¹çœ‹éœ€è¦çš„ç³–æœæ•°</span></span><br><span class="line">    total := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        <span class="keyword">if</span> i &lt; n<span class="number">-1</span> &amp;&amp; ratings[i] &gt; ratings[i+<span class="number">1</span>] &#123;</span><br><span class="line">            right++  <span class="comment">// æ¯”å³è¾¹å¤š1é¢—</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = <span class="number">1</span>  <span class="comment">// æœ€å°‘1é¢—</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ğŸ¯ å…³é”®ï¼šå–ä¸¤ä¸ªè¦æ±‚çš„æœ€å¤§å€¼</span></span><br><span class="line">        total += max(left[i], right)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è®©æˆ‘ä»¬ç”¨ä¾‹å­ <code>[1,0,2]</code> è¯¦ç»†èµ°ä¸€éï¼š</strong></p>
<p><strong>ç¬¬ä¸€æ¬¡éå†ï¼ˆä»å·¦åˆ°å³ï¼‰ï¼š</strong></p>
<ul>
<li>i=0: ratings[0]=1ï¼Œç¬¬ä¸€ä¸ªå­©å­ï¼Œç»™1é¢— â†’ left[0]=1</li>
<li>i=1: ratings[1]=0 &lt; ratings[0]=1ï¼Œç»™1é¢— â†’ left[1]=1</li>
<li>i=2: ratings[2]=2 &gt; ratings[1]=0ï¼Œç»™2é¢— â†’ left[2]=2</li>
</ul>
<p>ç»“æœï¼šleft = [1,1,2]</p>
<p><strong>ç¬¬äºŒæ¬¡éå†ï¼ˆä»å³åˆ°å·¦ï¼‰ï¼š</strong></p>
<ul>
<li>i=2: ratings[2]=2ï¼Œæœ€åä¸€ä¸ªå­©å­ï¼Œç»™1é¢— â†’ right=1ï¼Œtotal += max(2,1) = 2</li>
<li>i=1: ratings[1]=0 &lt; ratings[2]=2ï¼Œç»™1é¢— â†’ right=1ï¼Œtotal += max(1,1) = 1ï¼Œtotal=3</li>
<li>i=0: ratings[0]=1 &gt; ratings[1]=0ï¼Œç»™2é¢— â†’ right=2ï¼Œtotal += max(1,2) = 2ï¼Œtotal=5</li>
</ul>
<p><strong>æœ€ç»ˆç»“æœï¼š</strong> 5é¢—ç³–æœï¼Œåˆ†é…æ–¹æ¡ˆæ˜¯ [2,1,2] âœ…</p>
<h3 id="æ–¹æ³•äºŒï¼šä¸€æ¬¡éå†ï¼ˆé«˜çº§æŠ€å·§ï¼‰">æ–¹æ³•äºŒï¼šä¸€æ¬¡éå†ï¼ˆé«˜çº§æŠ€å·§ï¼‰</h3>
<p>å¦‚æœä½ å·²ç»ç†è§£äº†ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ ä¸€ä¸ªæ›´å·§å¦™çš„æŠ€å·§ï¼šç”¨&quot;çˆ¬å±±&quot;çš„æ€ç»´æ¥æ€è€ƒè¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong> æŠŠè¯„åˆ†åºåˆ—æƒ³è±¡æˆä¸€åº§åº§å±±å³°å’Œå±±è°·ï¼Œæˆ‘ä»¬è¦æ²¿ç€å±±è·¯åˆ†å‘ç³–æœã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">candy</span><span class="params">(ratings []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(ratings)</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    total := <span class="number">1</span>       <span class="comment">// ç¬¬ä¸€ä¸ªå­©å­çš„ç³–æœ</span></span><br><span class="line">    upSlope := <span class="number">0</span>     <span class="comment">// å½“å‰ä¸Šå¡çš„é•¿åº¦</span></span><br><span class="line">    downSlope := <span class="number">0</span>   <span class="comment">// å½“å‰ä¸‹å¡çš„é•¿åº¦</span></span><br><span class="line">    peakHeight := <span class="number">0</span>  <span class="comment">// å±±å³°çš„é«˜åº¦ï¼ˆä¸Šå¡é•¿åº¦ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> ratings[i] &gt; ratings[i<span class="number">-1</span>] &#123;</span><br><span class="line">            <span class="comment">// ğŸ“ˆ ä¸Šå¡ï¼šè¯„åˆ†åœ¨ä¸Šå‡</span></span><br><span class="line">            downSlope = <span class="number">0</span>           <span class="comment">// é‡ç½®ä¸‹å¡</span></span><br><span class="line">            upSlope++               <span class="comment">// ä¸Šå¡é•¿åº¦+1</span></span><br><span class="line">            peakHeight = upSlope    <span class="comment">// æ›´æ–°å±±å³°é«˜åº¦</span></span><br><span class="line">            total += upSlope + <span class="number">1</span>    <span class="comment">// å½“å‰å­©å­å¾—åˆ° upSlope+1 é¢—ç³–æœ</span></span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ratings[i] == ratings[i<span class="number">-1</span>] &#123;</span><br><span class="line">            <span class="comment">// â¡ï¸ å¹³åœ°ï¼šè¯„åˆ†ç›¸ç­‰</span></span><br><span class="line">            upSlope = <span class="number">0</span>     <span class="comment">// é‡ç½®æ‰€æœ‰çŠ¶æ€</span></span><br><span class="line">            downSlope = <span class="number">0</span></span><br><span class="line">            peakHeight = <span class="number">0</span></span><br><span class="line">            total += <span class="number">1</span>      <span class="comment">// å¹³åœ°ä¸Šåªéœ€è¦1é¢—ç³–æœ</span></span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ğŸ“‰ ä¸‹å¡ï¼šè¯„åˆ†åœ¨ä¸‹é™</span></span><br><span class="line">            upSlope = <span class="number">0</span>     <span class="comment">// é‡ç½®ä¸Šå¡</span></span><br><span class="line">            downSlope++     <span class="comment">// ä¸‹å¡é•¿åº¦+1</span></span><br><span class="line">            total += downSlope  <span class="comment">// è¿™æ˜¯å…³é”®çš„ä¸€æ­¥ï¼</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ğŸ”ï¸ ç‰¹æ®Šå¤„ç†ï¼šå±±å³°å¯èƒ½éœ€è¦æ›´å¤šç³–æœ</span></span><br><span class="line">            <span class="keyword">if</span> peakHeight &lt; downSlope &#123;</span><br><span class="line">                total += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è®©æˆ‘ç”¨çˆ¬å±±çš„æ¯”å–»è§£é‡Š <code>total += downSlope</code> è¿™ä¸ªå…³é”®æ­¥éª¤ï¼š</strong></p>
<p>æƒ³è±¡ä½ åœ¨ä¸€ä¸ªä¸‹å¡è·¯æ®µï¼š<code>[5, 4, 3, 2, 1]</code></p>
<p>æŒ‰ç…§è§„åˆ™ï¼Œç³–æœåº”è¯¥è¿™æ ·åˆ†é…ï¼š<code>[5, 4, 3, 2, 1]</code></p>
<p>å½“æˆ‘ä»¬èµ°åˆ°æœ€åä¸€ä¸ªå­©å­ï¼ˆè¯„åˆ†1ï¼‰æ—¶ï¼š</p>
<ul>
<li>ä»–éœ€è¦1é¢—ç³–æœ</li>
<li>å€’æ•°ç¬¬2ä¸ªå­©å­éœ€è¦2é¢—ç³–æœ</li>
<li>å€’æ•°ç¬¬3ä¸ªå­©å­éœ€è¦3é¢—ç³–æœ</li>
<li>â€¦</li>
</ul>
<p><code>total += downSlope</code> å·§å¦™åœ°å®ç°äº†è¿™ä¸ªåˆ†é…ï¼š</p>
<ul>
<li>ç»™å½“å‰å­©å­1é¢—</li>
<li>åŒæ—¶ç»™å‰é¢çš„æ¯ä¸ªå­©å­&quot;è¡¥&quot;1é¢—</li>
</ul>
<p><strong>å±±å³°çš„ç‰¹æ®Šå¤„ç†ï¼š</strong></p>
<p>è¿™æ˜¯ç®—æ³•ä¸­æœ€ç²¾å¦™çš„éƒ¨åˆ†ï¼è®©æˆ‘è¯¦ç»†è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ <code>total += 1</code> è¿™ä¸ªä¿®æ­£ã€‚</p>
<p>è€ƒè™‘è¿™ä¸ªä¾‹å­ï¼š<code>[1, 3, 2, 1]</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  /\</span><br><span class="line"> /  \</span><br><span class="line">/    \</span><br></pre></td></tr></table></figure>
<p><strong>å…³é”®é—®é¢˜ï¼šå±±å³°æ—¢æ˜¯ä¸Šå¡çš„ç»ˆç‚¹ï¼Œä¹Ÿæ˜¯ä¸‹å¡çš„èµ·ç‚¹ï¼</strong></p>
<p>è®©æˆ‘ä»¬åˆ†æ­¥åˆ†æï¼š</p>
<ol>
<li><strong>ä¸Šå¡é˜¶æ®µ</strong>ï¼šå±±å³°ï¼ˆè¯„åˆ†3ï¼‰å› ä¸ºä¸Šå¡å¾—åˆ°äº† <code>peakHeight + 1 = 2</code> é¢—ç³–æœ</li>
<li><strong>ä¸‹å¡é˜¶æ®µ</strong>ï¼šå½“æˆ‘ä»¬å¤„ç†ä¸‹å¡æ—¶
<ul>
<li>æœ€å³è¾¹çš„å­©å­ï¼ˆè¯„åˆ†1ï¼‰å¾—åˆ° 1 é¢—ç³–æœ</li>
<li>å€’æ•°ç¬¬2ä¸ªå­©å­ï¼ˆè¯„åˆ†2ï¼‰éœ€è¦æ¯”å³è¾¹å¤šï¼Œå¾—åˆ° 2 é¢—ç³–æœ</li>
<li>å±±å³°ï¼ˆè¯„åˆ†3ï¼‰éœ€è¦æ¯”å³è¾¹çš„å­©å­ï¼ˆè¯„åˆ†2ï¼‰å¤šï¼Œè‡³å°‘éœ€è¦ 3 é¢—ç³–æœ</li>
</ul>
</li>
</ol>
<p><strong>çŸ›ç›¾å‡ºç°äº†ï¼</strong></p>
<ul>
<li>å±±å³°ä»ä¸Šå¡è§’åº¦åªå¾—åˆ°äº† 2 é¢—ç³–æœ</li>
<li>ä½†ä»ä¸‹å¡è§’åº¦éœ€è¦è‡³å°‘ 3 é¢—ç³–æœ</li>
</ul>
<p><strong>ç®—æ³•æ˜¯æ€ä¹ˆå‘ç°å’Œè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å½“å¤„ç†ä¸‹å¡æ—¶ï¼ŒdownSlope = 2ï¼ˆä¸‹å¡é•¿åº¦ï¼‰</span></span><br><span class="line">total += downSlope  <span class="comment">// è¿™ç»™ä¸‹å¡è·¯å¾„åˆ†é…äº†ç³–æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥å±±å³°æ˜¯å¦éœ€è¦é¢å¤–ç³–æœ</span></span><br><span class="line"><span class="keyword">if</span> peakHeight &lt; downSlope &#123;  <span class="comment">// 1 &lt; 2ï¼Œæ¡ä»¶æˆç«‹</span></span><br><span class="line">    total += <span class="number">1</span>  <span class="comment">// ç»™å±±å³°è¡¥1é¢—ç³–æœ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¸ºä»€ä¹ˆè¡¥1é¢—å°±å¤Ÿäº†ï¼Ÿ</strong></p>
<p>è¿™é‡Œæœ‰ä¸ªå·§å¦™çš„æ•°å­¦å…³ç³»ï¼š</p>
<ul>
<li>å±±å³°å³è¾¹ç¬¬ä¸€ä¸ªå­©å­ï¼ˆä¸‹å¡èµ·ç‚¹ï¼‰ç°åœ¨æœ‰ <code>downSlope</code> é¢—ç³–æœ</li>
<li>å±±å³°éœ€è¦æ¯”å®ƒå¤š1é¢—ï¼Œå³éœ€è¦ <code>downSlope + 1</code> é¢—</li>
<li>å±±å³°åŸæ¥æœ‰ <code>peakHeight + 1</code> é¢—</li>
<li>å·®å€¼å°±æ˜¯ï¼š<code>(downSlope + 1) - (peakHeight + 1) = downSlope - peakHeight</code></li>
<li>å½“ <code>peakHeight &lt; downSlope</code> æ—¶ï¼Œå·®å€¼å°±æ˜¯1ï¼</li>
</ul>
<p><strong>ç”¨å…·ä½“æ•°å­—éªŒè¯ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¾‹å­ [1, 3, 2, 1]ï¼š</span><br><span class="line">- peakHeight = 1ï¼ˆä¸Šå¡é•¿åº¦ï¼‰</span><br><span class="line">- downSlope = 2ï¼ˆä¸‹å¡é•¿åº¦ï¼‰</span><br><span class="line">- å±±å³°åŸæœ‰ç³–æœï¼š1 + 1 = 2é¢—</span><br><span class="line">- å±±å³°éœ€è¦ç³–æœï¼š2 + 1 = 3é¢—</span><br><span class="line">- éœ€è¦è¡¥å……ï¼š3 - 2 = 1é¢— âœ…</span><br></pre></td></tr></table></figure>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>total += 1</code> è¿™ä¸€è¡Œä»£ç å¦‚æ­¤å…³é”®â€”â€”å®ƒç¡®ä¿äº†å±±å³°èƒ½åŒæ—¶æ»¡è¶³å·¦å³ä¸¤è¾¹çš„çº¦æŸæ¡ä»¶ï¼</p>
<h2 id="ç”¨å…·ä½“ä¾‹å­æ¼”ç¤ºæ•´ä¸ªè¿‡ç¨‹">ç”¨å…·ä½“ä¾‹å­æ¼”ç¤ºæ•´ä¸ªè¿‡ç¨‹</h2>
<p>è®©æˆ‘ä»¬ç”¨ <code>[1, 3, 2, 1]</code> è¯¦ç»†æ¼”ç¤ºä¸€æ¬¡éå†çš„è¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹çŠ¶æ€ï¼š</span><br><span class="line">- total = 1 (ç¬¬ä¸€ä¸ªå­©å­)</span><br><span class="line">- upSlope = 0, downSlope = 0, peakHeight = 0</span><br><span class="line"></span><br><span class="line">i=1: ratings[1]=3 &gt; ratings[0]=1 (ä¸Šå¡)</span><br><span class="line">- downSlope = 0</span><br><span class="line">- upSlope = 1</span><br><span class="line">- peakHeight = 1  </span><br><span class="line">- total += 2 (upSlope+1)</span><br><span class="line">- total = 1 + 2 = 3</span><br><span class="line"></span><br><span class="line">i=2: ratings[2]=2 &lt; ratings[1]=3 (ä¸‹å¡)</span><br><span class="line">- upSlope = 0</span><br><span class="line">- downSlope = 1</span><br><span class="line">- total += 1 (downSlope)</span><br><span class="line">- total = 3 + 1 = 4</span><br><span class="line">- peakHeight(1) &lt; downSlope(1)? å¦ï¼Œä¸éœ€è¦è¡¥å……</span><br><span class="line"></span><br><span class="line">i=3: ratings[3]=1 &lt; ratings[2]=2 (ç»§ç»­ä¸‹å¡)  </span><br><span class="line">- downSlope = 2</span><br><span class="line">- total += 2 (downSlope)</span><br><span class="line">- total = 4 + 2 = 6</span><br><span class="line">- peakHeight(1) &lt; downSlope(2)? æ˜¯ï¼éœ€è¦è¡¥å……</span><br><span class="line">- total += 1 = 7</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆï¼štotal = 7ï¼Œå¯¹åº”åˆ†é… [1, 3, 2, 1]</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦å¯¹æ¯”">å¤æ‚åº¦å¯¹æ¯”</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
<th>ç©ºé—´å¤æ‚åº¦</th>
<th>ç†è§£éš¾åº¦</th>
<th>æ¨èæŒ‡æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸¤æ¬¡éå†</td>
<td>O(n)</td>
<td>O(n)</td>
<td>â­â­</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td>ä¸€æ¬¡éå†</td>
<td>O(n)</td>
<td>O(1)</td>
<td>â­â­â­â­</td>
<td>â­â­â­</td>
</tr>
</tbody>
</table>
<h2 id="å¸¸è§é”™è¯¯æ€»ç»“">å¸¸è§é”™è¯¯æ€»ç»“</h2>
<h3 id="1-åªè€ƒè™‘ä¸€ä¸ªæ–¹å‘çš„çº¦æŸ">1. åªè€ƒè™‘ä¸€ä¸ªæ–¹å‘çš„çº¦æŸ</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯</span></span><br><span class="line"><span class="keyword">if</span> ratings[i] &gt; ratings[i<span class="number">-1</span>] &#123;</span><br><span class="line">    candies[i] = candies[i<span class="number">-1</span>] + <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    candies[i] = <span class="number">1</span>  <span class="comment">// è¿™é‡Œæ²¡è€ƒè™‘å³è¾¹é‚»å±…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-è¾¹ç•Œæ¡ä»¶å¤„ç†ä¸å½“">2. è¾¹ç•Œæ¡ä»¶å¤„ç†ä¸å½“</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ å¿˜è®°æ£€æŸ¥æ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="comment">// âŒ æ•°ç»„ä¸‹æ ‡è¶Šç•Œ</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;  <span class="comment">// åº”è¯¥æ˜¯ i &lt; n</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-çŠ¶æ€é‡ç½®é—æ¼">3. çŠ¶æ€é‡ç½®é—æ¼</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ åœ¨å¹³åœ°æ—¶å¿˜è®°é‡ç½®çŠ¶æ€</span></span><br><span class="line"><span class="keyword">if</span> ratings[i] == ratings[i<span class="number">-1</span>] &#123;</span><br><span class="line">    total += <span class="number">1</span>  <span class="comment">// åªåŠ äº†ç³–æœï¼Œå¿˜è®°é‡ç½®çŠ¶æ€å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å­¦åˆ°çš„ç»éªŒ">å­¦åˆ°çš„ç»éªŒ</h2>
<h3 id="ğŸ¯-è§£é¢˜æ€è·¯">ğŸ¯ è§£é¢˜æ€è·¯</h3>
<ol>
<li><strong>åˆ†è§£é—®é¢˜ï¼š</strong> å¤æ‚çš„åŒå‘çº¦æŸ â†’ åˆ†åˆ«å¤„ç†å·¦å³çº¦æŸ</li>
<li><strong>è´ªå¿ƒç­–ç•¥ï¼š</strong> æ¯ä¸ªä½ç½®å–æ»¡è¶³æ‰€æœ‰çº¦æŸçš„æœ€å°å€¼</li>
<li><strong>ä¼˜åŒ–ç©ºé—´ï¼š</strong> ç”¨çŠ¶æ€å˜é‡ä»£æ›¿é¢å¤–æ•°ç»„</li>
</ol>
<h3 id="ğŸ”—-ç›¸å…³é—®é¢˜">ğŸ”— ç›¸å…³é—®é¢˜</h3>
<ul>
<li><a href="/2025/04/18/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-42-trapping-rain-water/">LeetCode 42: æ¥é›¨æ°´</a> - ä¹Ÿç”¨åˆ°äº†&quot;å±±å³°å±±è°·&quot;çš„æ€æƒ³</li>
<li><a href="/2025/05/13/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-84-%E6%9F%B1%E7%8A%B6%E5%9B%BE%E4%B8%AD%E6%9C%80%E5%A4%A7%E7%9A%84%E7%9F%A9%E5%BD%A2/">LeetCode 84: æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢</a> - ç±»ä¼¼çš„å•è°ƒæ€§å¤„ç†</li>
</ul>
<h3 id="ğŸ’¡-è®°å¿†å£è¯€">ğŸ’¡ è®°å¿†å£è¯€</h3>
<blockquote>
<p><strong>â€œçˆ¬å±±åˆ†ç³–æœï¼Œå·¦å³éƒ½è¦é¡¾ï¼Œåˆ†æ­¥æ¥è§£å†³ï¼Œè´ªå¿ƒå®šæœ€ä¼˜â€</strong></p>
</blockquote>
<p>è¿™é“é¢˜æ•™ä¼šæˆ‘ä»¬ï¼šçœ‹ä¼¼å¤æ‚çš„é—®é¢˜ï¼Œå¾€å¾€å¯ä»¥é€šè¿‡å·§å¦™çš„åˆ†è§£å’Œè´ªå¿ƒç­–ç•¥æ¥è§£å†³ã€‚å…³é”®æ˜¯è¦æ‰¾åˆ°æ­£ç¡®çš„æ€è€ƒè§’åº¦ï¼ ğŸ‰</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>è´ªå¿ƒ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>Hard</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>è´ªå¿ƒç®—æ³•</tag>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 134 - åŠ æ²¹ç«™ï¼ˆGas Stationï¼‰</title>
    <url>/2025/05/26/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-134-%E5%8A%A0%E6%B2%B9%E7%AB%99/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>åœ¨ä¸€æ¡ç¯è·¯ä¸Šæœ‰ n ä¸ªåŠ æ²¹ç«™ï¼Œå…¶ä¸­ç¬¬ i ä¸ªåŠ æ²¹ç«™æœ‰æ±½æ²¹ <code>gas[i]</code> å‡ã€‚</p>
<p>ä½ æœ‰ä¸€è¾†æ²¹ç®±å®¹é‡æ— é™çš„çš„æ±½è½¦ï¼Œä»ç¬¬ i ä¸ªåŠ æ²¹ç«™å¼€å¾€ç¬¬ i+1 ä¸ªåŠ æ²¹ç«™éœ€è¦æ¶ˆè€—æ±½æ²¹ <code>cost[i]</code> å‡ã€‚ä½ ä»å…¶ä¸­çš„ä¸€ä¸ªåŠ æ²¹ç«™å‡ºå‘ï¼Œå¼€å§‹æ—¶æ²¹ç®±ä¸ºç©ºã€‚</p>
<p>ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ <code>gas</code> å’Œ <code>cost</code>ï¼Œå¦‚æœä½ å¯ä»¥ç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ï¼Œåˆ™è¿”å›å‡ºå‘æ—¶åŠ æ²¹ç«™çš„ç¼–å·ï¼Œå¦åˆ™è¿”å› -1ã€‚å¦‚æœé¢˜ç›®æœ‰è§£ï¼Œè¯¥ç­”æ¡ˆå³ä¸ºå”¯ä¸€ç­”æ¡ˆã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: gas = [1,2,3,4,5], cost = [3,4,5,1,2]</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä» 3 å·åŠ æ²¹ç«™(ç´¢å¼•ä¸º 3 å¤„)å‡ºå‘ï¼Œå¯è·å¾— 4 å‡æ±½æ²¹ã€‚æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 4 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 1 = 3 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 3 + 5 - 2 = 6 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 6 + 1 - 3 = 4 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 2 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 + 2 - 4 = 2 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 3 å·åŠ æ²¹ç«™ï¼Œä½ éœ€è¦æ¶ˆè€— 5 å‡æ±½æ²¹ï¼Œæ­£å¥½è¶³å¤Ÿä½ è¿”å›åˆ° 3 å·åŠ æ²¹ç«™ã€‚</span><br><span class="line">å› æ­¤ï¼Œ3 å¯ä»¥ä½œä¸ºèµ·å§‹ç´¢å¼•ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: gas = [2,3,4], cost = [3,4,3]</span><br><span class="line">è¾“å‡º: -1</span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä½ ä¸èƒ½ä» 0 å·æˆ– 1 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„æ±½æ²¹å¯ä»¥è®©ä½ è¡Œé©¶åˆ°ä¸‹ä¸€ä¸ªåŠ æ²¹ç«™ã€‚</span><br><span class="line">æˆ‘ä»¬ä» 2 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå¯ä»¥è·å¾— 4 å‡æ±½æ²¹ã€‚ æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 3 = 1 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 1 + 2 - 3 = 0 å‡æ±½æ²¹</span><br><span class="line">å¼€å¾€ 2 å·åŠ æ²¹ç«™ï¼Œä½ éœ€è¦æ¶ˆè€— 4 å‡æ±½æ²¹ï¼Œä½†æ˜¯ä½ çš„æ²¹ç®±åªæœ‰ 0 å‡æ±½æ²¹ã€‚</span><br><span class="line">å› æ­¤ï¼Œæ— è®ºæ€æ ·ï¼Œä½ éƒ½ä¸å¯èƒ½ç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸï¼š</strong></p>
<ul>
<li>gas.length == n</li>
<li>cost.length == n</li>
<li>1 &lt;= n &lt;= 10^5</li>
<li>0 &lt;= gas[i], cost[i] &lt;= 10^4</li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘çš„åˆå§‹è§£æ³•æ˜¯æš´åŠ›æšä¸¾æ¯ä¸ªå¯èƒ½çš„èµ·å§‹ä½ç½®ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canCompleteCircuit</span><span class="params">(gas []<span class="type">int</span>, cost []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(gas)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> start := <span class="number">0</span>; start &lt; n; start++ &#123;</span><br><span class="line">        cnt := <span class="number">0</span></span><br><span class="line">        cur := start</span><br><span class="line">        remain := <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> cnt &lt; n &#123;</span><br><span class="line">            remain += gas[cur]</span><br><span class="line">            remain -= cost[cur]</span><br><span class="line">            <span class="keyword">if</span> remain &lt; <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            cur = (cur + <span class="number">1</span>) % n</span><br><span class="line">            cnt++  <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šæ¯æ¬¡éƒ½è¦å®Œæ•´éå†ä¸€åœˆï¼Œå¯¼è‡´ O(nÂ²) å¤æ‚åº¦</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cnt == n &#123;</span><br><span class="line">            <span class="keyword">return</span> start</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>è¿™ä¸ªè§£æ³•åœ¨ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ä¸­ä¼š<strong>è¶…æ—¶</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šgas = [1,1,1,...,1] (10^5ä¸ª1), cost = [2,2,2,...,2] (10^5ä¸ª2)</span><br><span class="line">é¢„æœŸè¾“å‡ºï¼š-1</span><br><span class="line">æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²) = O(10^10) â†’ è¶…æ—¶ï¼</span><br></pre></td></tr></table></figure>
<p><strong>å…³é”®é—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>æ—¶é—´å¤æ‚åº¦è¿‡é«˜</strong>ï¼šå¯¹äºæ¯ä¸ªèµ·å§‹ä½ç½®ï¼Œéƒ½è¦å°è¯•ç»•å®Œæ•´ä¸ªç¯è·¯ï¼Œæœ€åæƒ…å†µä¸‹æ˜¯ $O(n^2)$</li>
<li><strong>é‡å¤è®¡ç®—</strong>ï¼šæ²¡æœ‰åˆ©ç”¨ä¹‹å‰è®¡ç®—çš„ç»“æœï¼Œå­˜åœ¨å¤§é‡é‡å¤è®¡ç®—</li>
<li><strong>ç¼ºä¹å‰ªæ</strong>ï¼šæ²¡æœ‰åˆ©ç”¨é—®é¢˜çš„æ•°å­¦æ€§è´¨è¿›è¡Œä¼˜åŒ–</li>
</ol>
<p>å½“ $n = 10^5$ æ—¶ï¼Œ$O(n^2) = 10^{10}$ æ¬¡æ“ä½œï¼Œå¿…ç„¶è¶…æ—¶ã€‚</p>
<h2 id="æ­£ç¡®è§£æ³•-è´ªå¿ƒç®—æ³•">æ­£ç¡®è§£æ³• - è´ªå¿ƒç®—æ³•</h2>
<p>ç»è¿‡åˆ†æï¼Œæˆ‘å‘ç°äº†å‡ ä¸ªå…³é”®æ´å¯Ÿï¼š</p>
<h3 id="æ ¸å¿ƒæ´å¯Ÿ">æ ¸å¿ƒæ´å¯Ÿ</h3>
<ol>
<li><strong>æ€»é‡åˆ¤æ–­</strong>ï¼šå¦‚æœ $\sum gas[i] &lt; \sum cost[i]$ï¼Œæ— è®ºä»å“ªé‡Œå¼€å§‹éƒ½ä¸å¯èƒ½å®Œæˆä¸€åœˆ</li>
<li><strong>å”¯ä¸€æ€§</strong>ï¼šå¦‚æœèƒ½å®Œæˆä¸€åœˆï¼Œèµ·å§‹ç‚¹æ˜¯å”¯ä¸€çš„</li>
<li><strong>å…³é”®å®šç†</strong>ï¼šå¦‚æœä»ä½ç½® <code>start</code> å¼€å§‹ï¼Œèƒ½åˆ°è¾¾ä½ç½® <code>i</code> ä½†æ— æ³•åˆ°è¾¾ <code>i+1</code>ï¼Œé‚£ä¹ˆä» <code>start</code> åˆ° <code>i</code> ä¹‹é—´çš„ä»»ä½•ä½ç½®ä½œä¸ºèµ·ç‚¹éƒ½æ— æ³•åˆ°è¾¾ <code>i+1</code></li>
</ol>
<h3 id="å®šç†è¯æ˜">å®šç†è¯æ˜</h3>
<p>å‡è®¾ä»ä½ç½® $j$ï¼ˆ$start \leq j \leq i$ï¼‰å¼€å§‹èƒ½åˆ°è¾¾ $i+1$ï¼Œè®¾ï¼š</p>
<ul>
<li>ä» $start$ åˆ° $j-1$ çš„å‡€æ”¶ç›Šï¼š$sum_1 \geq 0$</li>
<li>ä» $j$ åˆ° $i$ çš„å‡€æ”¶ç›Šï¼š$sum_2$</li>
<li>ç¬¬ $i$ ç«™çš„å‡€æ”¶ç›Šï¼š$diff_i = gas[i] - cost[i]$</li>
</ul>
<p>ä» $start$ å¼€å§‹åˆ°è¾¾ $i$ ä½†æ— æ³•åˆ°è¾¾ $i+1$ï¼š<br>
$$sum_1 + sum_2 + diff_i &lt; 0$$</p>
<p>ä» $j$ å¼€å§‹èƒ½åˆ°è¾¾ $i+1$ï¼š<br>
$$sum_2 + diff_i \geq 0$$</p>
<p>è¿™å¯¼è‡´çŸ›ç›¾ï¼š$sum_1 &lt; 0$ï¼Œä½†æˆ‘ä»¬çŸ¥é“ä» $start$ èƒ½åˆ°è¾¾ $j-1$ï¼Œæ‰€ä»¥ $sum_1 \geq 0$ã€‚</p>
<h3 id="ç®—æ³•å®ç°">ç®—æ³•å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canCompleteCircuit</span><span class="params">(gas []<span class="type">int</span>, cost []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(gas)</span><br><span class="line">    tank := <span class="number">0</span>    <span class="comment">// å½“å‰æ²¹ç®±å‰©ä½™</span></span><br><span class="line">    total := <span class="number">0</span>   <span class="comment">// æ€»çš„æ±½æ²¹é‡ä¸æ¶ˆè€—é‡çš„å·®å€¼</span></span><br><span class="line">    start := <span class="number">0</span>   <span class="comment">// èµ·å§‹ä½ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        diff := gas[i] - cost[i]</span><br><span class="line">        tank += diff</span><br><span class="line">        total += diff</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰æ²¹é‡ä¸å¤Ÿï¼Œè¯´æ˜ä»startåˆ°iéƒ½æ— æ³•ä½œä¸ºèµ·å§‹ç‚¹</span></span><br><span class="line">        <span class="comment">// ä¸‹ä¸€ä¸ªå¯èƒ½çš„èµ·å§‹ç‚¹æ˜¯i+1</span></span><br><span class="line">        <span class="keyword">if</span> tank &lt; <span class="number">0</span> &#123;</span><br><span class="line">            start = i + <span class="number">1</span></span><br><span class="line">            tank = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ€»çš„æ±½æ²¹é‡å°äºæ€»æ¶ˆè€—é‡ï¼Œæ— è§£</span></span><br><span class="line">    <span class="keyword">if</span> total &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> start</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç®—æ³•æ‰§è¡Œè¿‡ç¨‹">ç®—æ³•æ‰§è¡Œè¿‡ç¨‹</h3>
<p>ä»¥ <code>gas = [1,2,3,4,5], cost = [3,4,5,1,2]</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">i=0: diff=-2, tank=-2, total=-2, tank&lt;0 â†’ start=1, tank=0</span><br><span class="line">i=1: diff=-2, tank=-2, total=-4, tank&lt;0 â†’ start=2, tank=0  </span><br><span class="line">i=2: diff=-2, tank=-2, total=-6, tank&lt;0 â†’ start=3, tank=0</span><br><span class="line">i=3: diff=3,  tank=3,  total=-3, tankâ‰¥0 â†’ ç»§ç»­</span><br><span class="line">i=4: diff=3,  tank=6,  total=0,  tankâ‰¥0 â†’ ç»§ç»­</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆ total=0â‰¥0ï¼Œè¿”å› start=3</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æš´åŠ›è§£æ³•</th>
<th>è´ªå¿ƒç®—æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n^2)$</td>
<td>$O(n)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(1)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>æ ¸å¿ƒæ€æƒ³</td>
<td>æšä¸¾æ‰€æœ‰èµ·å§‹ä½ç½®</td>
<td>åˆ©ç”¨æ•°å­¦æ€§è´¨å‰ªæ</td>
</tr>
<tr>
<td>æ˜¯å¦è¶…æ—¶</td>
<td>âŒ å¤§æ•°æ®é‡è¶…æ—¶</td>
<td>âœ… é«˜æ•ˆé€šè¿‡</td>
</tr>
<tr>
<td>å®ç°éš¾åº¦</td>
<td>ç®€å•ç›´è§‚</td>
<td>éœ€è¦ç†è§£è´ªå¿ƒæ€æƒ³</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦ï¼š-O-n">æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$</h3>
<p>åªéœ€è¦éå†ä¸€æ¬¡æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ è®¿é—®ä¸€æ¬¡ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦ï¼š-O-1">ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$</h3>
<p>åªä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–å˜é‡ï¼š<code>tank</code>ã€<code>total</code>ã€<code>start</code>ã€‚</p>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>è´ªå¿ƒç®—æ³•çš„æœ¬è´¨</strong>ï¼šåˆ©ç”¨é—®é¢˜çš„æ•°å­¦æ€§è´¨ï¼Œé¿å…é‡å¤è®¡ç®—</li>
<li><strong>ä¼˜åŒ–æ€è·¯</strong>ï¼šä» $O(n^2)$ åˆ° $O(n)$ çš„å…³é”®æ˜¯æ‰¾åˆ°å‰ªææ¡ä»¶</li>
<li><strong>è¯æ˜çš„é‡è¦æ€§</strong>ï¼šç†è§£ä¸ºä»€ä¹ˆè´ªå¿ƒç­–ç•¥æ˜¯æ­£ç¡®çš„</li>
<li><strong>å®é™…åº”ç”¨</strong>ï¼šç±»ä¼¼çš„&quot;ç¯å½¢æ•°ç»„&quot;é—®é¢˜éƒ½å¯ä»¥ç”¨è¿™ç§æ€è·¯ä¼˜åŒ–</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ul>
<li>âŒ å¿½ç•¥æ€»é‡æ£€æŸ¥ï¼Œå¯¼è‡´é”™è¯¯åˆ¤æ–­</li>
<li>âŒ æ²¡æœ‰é‡ç½® <code>tank</code> ä¸º 0ï¼Œå¯¼è‡´ç´¯ç§¯é”™è¯¯</li>
<li>âŒ è¾¹ç•Œæ¡ä»¶å¤„ç†ä¸å½“ï¼ˆå¦‚ç©ºæ•°ç»„ï¼‰</li>
</ul>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><a href="https://leetcode.cn/problems/candy/">LeetCode 135 - åˆ†å‘ç³–æœ</a>ï¼šç±»ä¼¼çš„è´ªå¿ƒæ€æƒ³</li>
<li><a href="https://leetcode.cn/problems/jump-game/">LeetCode 55 - è·³è·ƒæ¸¸æˆ</a>ï¼šè´ªå¿ƒ + æ•°ç»„éå†</li>
<li><a href="https://leetcode.cn/problems/jump-game-ii/">LeetCode 45 - è·³è·ƒæ¸¸æˆ II</a>ï¼šè´ªå¿ƒä¼˜åŒ–</li>
</ul>
<p>é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘æ·±åˆ»ç†è§£äº†<strong>è´ªå¿ƒç®—æ³•çš„æ ¸å¿ƒæ˜¯æ‰¾åˆ°é—®é¢˜çš„æ•°å­¦æ€§è´¨ï¼Œé¿å…æš´åŠ›æšä¸¾</strong>ã€‚æ—¶é—´å¤æ‚åº¦çš„ä¼˜åŒ–å¾€å¾€æ¥è‡ªäºå¯¹é—®é¢˜æœ¬è´¨çš„æ·±å…¥ç†è§£ï¼</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>è´ªå¿ƒ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>è´ªå¿ƒç®—æ³•</tag>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Buffer Pool è¯¦è§£ï¼šæ•°æ®åº“æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒ</title>
    <url>/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/</url>
    <content><![CDATA[<h1>MySQL Buffer Pool è¯¦è§£ï¼šæ•°æ®åº“æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒ</h1>
<h2 id="ä¸ºä»€ä¹ˆè¦æœ‰-Buffer-Poolï¼Ÿ">ä¸ºä»€ä¹ˆè¦æœ‰ Buffer Poolï¼Ÿ</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ¯æ¬¡æŸ¥è¯¢æ•°æ®éƒ½è¦ä»ç¡¬ç›˜è¯»å–ï¼Œå°±åƒæ¯æ¬¡æƒ³çœ‹ä¹¦éƒ½è¦å»å›¾ä¹¦é¦†å€Ÿä¸€æ ·ï¼Œæ•ˆç‡ä¼šéå¸¸ä½ã€‚MySQL çš„æ•°æ®è™½ç„¶å­˜å‚¨åœ¨ç£ç›˜é‡Œï¼Œä½†å¦‚æœæ¯æ¬¡éƒ½ä»ç£ç›˜è¯»å–ï¼Œæ€§èƒ½ä¼šéå¸¸å·®ã€‚</p>
<p>æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå¾ˆç®€å•â€”â€”<strong>åŠ ä¸ªç¼“å­˜</strong>ï¼</p>
<p>å°±åƒæˆ‘ä»¬ä¼šæŠŠå¸¸ç”¨çš„ä¹¦æ”¾åœ¨å®¶é‡Œä¹¦æ¶ä¸Šä¸€æ ·ï¼ŒMySQL ä¼šæŠŠç»å¸¸ä½¿ç”¨çš„æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ã€‚å½“æ•°æ®ä»ç£ç›˜å–å‡ºåï¼Œå…ˆç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸‹æ¬¡æŸ¥è¯¢ç›¸åŒæ•°æ®æ—¶ï¼Œç›´æ¥ä»å†…å­˜è¯»å–ï¼Œé€Ÿåº¦é£å¿«ï¼</p>
<p>ä¸ºæ­¤ï¼ŒInnoDB å­˜å‚¨å¼•æ“è®¾è®¡äº†ä¸€ä¸ªä¸“é—¨çš„<strong>ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰</strong>ï¼Œè¿™å°±æ˜¯æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒç»„ä»¶ã€‚</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229548952.png" alt="1748229548952"></p>
<p>æœ‰äº†ç¼“å†²æ± åï¼Œæ•°æ®åº“çš„å·¥ä½œæ–¹å¼å°±åƒè¿™æ ·ï¼š</p>
<ul>
<li><strong>è¯»å–æ•°æ®æ—¶</strong>ï¼šå…ˆçœ‹çœ‹ Buffer Pool é‡Œæœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯ç›´æ¥æ‹¿æ¥ç”¨ï¼›æ²¡æœ‰çš„è¯å†å»ç£ç›˜è¯»å–ï¼Œç„¶åæ”¾åˆ° Buffer Pool é‡Œå¤‡ç”¨</li>
<li><strong>ä¿®æ”¹æ•°æ®æ—¶</strong>ï¼šä¸æ€¥ç€å†™ç£ç›˜ï¼Œå…ˆåœ¨ Buffer Pool é‡Œæ”¹ï¼ŒæŠŠè¿™ä¸ªé¡µæ ‡è®°ä¸º&quot;è„é¡µ&quot;ï¼ˆè¡¨ç¤ºå·²ä¿®æ”¹ï¼‰ï¼Œç„¶åè®©åå°çº¿ç¨‹æ…¢æ…¢å†™åˆ°ç£ç›˜</li>
</ul>
<p>è¿™æ ·æ—¢æé«˜äº†è¯»å–é€Ÿåº¦ï¼Œåˆé¿å…äº†é¢‘ç¹çš„ç£ç›˜å†™å…¥æ“ä½œã€‚</p>
<h3 id="Buffer-Pool-æœ‰å¤šå¤§ï¼Ÿ">Buffer Pool æœ‰å¤šå¤§ï¼Ÿ</h3>
<p>Buffer Pool å°±åƒæ˜¯ MySQL çš„&quot;å†…å­˜ä»“åº“&quot;ï¼Œåœ¨ MySQL å¯åŠ¨æ—¶å‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚</p>
<p><strong>é»˜è®¤å¤§å°</strong>ï¼šåªæœ‰ 128MBï¼ˆå¤ªå°äº†ï¼Œç”Ÿäº§ç¯å¢ƒè‚¯å®šä¸å¤Ÿç”¨ï¼‰</p>
<p><strong>å¦‚ä½•è°ƒæ•´</strong>ï¼šé€šè¿‡ <code>innodb_buffer_pool_size</code> å‚æ•°è®¾ç½®</p>
<ul>
<li><strong>æ¨èå¤§å°</strong>ï¼šç‰©ç†å†…å­˜çš„ 60%~80%</li>
<li><strong>ä¸¾ä¾‹</strong>ï¼šå¦‚æœæœåŠ¡å™¨æœ‰ 8GB å†…å­˜ï¼Œå¯ä»¥è®¾ç½®ä¸º 5-6GB</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹å½“å‰ Buffer Pool å¤§å°</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;innodb_buffer_pool_size&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è®¾ç½® Buffer Pool å¤§å°ä¸º 4GB</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> innodb_buffer_pool_size <span class="operator">=</span> <span class="number">4294967296</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Buffer-Pool-ç¼“å­˜ä»€ä¹ˆï¼Ÿ">Buffer Pool ç¼“å­˜ä»€ä¹ˆï¼Ÿ</h3>
<p>ä½ å¯èƒ½ä¼šé—®ï¼šBuffer Pool åˆ°åº•ç¼“å­˜ä»€ä¹ˆæ•°æ®å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆè¦äº†è§£ä¸€ä¸ªæ¦‚å¿µï¼š<strong>æ•°æ®é¡µ</strong>ã€‚InnoDB æŠŠæ•°æ®åˆ†æˆä¸€ä¸ªä¸ª&quot;é¡µ&quot;ï¼Œå°±åƒæŠŠä¹¦åˆ†æˆä¸€é¡µé¡µçº¸ä¸€æ ·ã€‚æ¯é¡µçš„å¤§å°æ˜¯ 16KBï¼Œè¿™æ˜¯ç£ç›˜å’Œå†…å­˜äº¤æ¢æ•°æ®çš„åŸºæœ¬å•ä½ã€‚</p>
<p><strong>Buffer Pool çš„å·¥ä½œåŸç†</strong>ï¼š</p>
<ol>
<li>MySQL å¯åŠ¨æ—¶ï¼Œç”³è¯·ä¸€å¤§å—å†…å­˜ç©ºé—´</li>
<li>æŠŠè¿™å—å†…å­˜æŒ‰ 16KB åˆ‡åˆ†æˆå¾ˆå¤š&quot;ç¼“å­˜é¡µ&quot;</li>
<li>åˆšå¼€å§‹è¿™äº›ç¼“å­˜é¡µéƒ½æ˜¯ç©ºçš„</li>
<li>éšç€æŸ¥è¯¢çš„è¿›è¡Œï¼Œç£ç›˜ä¸Šçš„æ•°æ®é¡µä¼šè¢«è½½å…¥è¿™äº›ç¼“å­˜é¡µ</li>
</ol>
<p><strong>æœ‰è¶£çš„ç°è±¡</strong>ï¼šMySQL åˆšå¯åŠ¨æ—¶ï¼Œä½ ä¼šå‘ç°è™šæ‹Ÿå†…å­˜å¾ˆå¤§ï¼Œä½†å®é™…ç‰©ç†å†…å­˜ä½¿ç”¨å¾ˆå°ã€‚è¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿé‡‡ç”¨äº†&quot;æ‡’åŠ è½½&quot;æœºåˆ¶â€”â€”åªæœ‰çœŸæ­£è®¿é—®å†…å­˜æ—¶ï¼Œæ‰ä¼šåˆ†é…ç‰©ç†å†…å­˜ã€‚</p>
<p><strong>Buffer Pool ç¼“å­˜çš„å†…å®¹</strong>ï¼š</p>
<ul>
<li><strong>æ•°æ®é¡µ</strong>ï¼šè¡¨ä¸­çš„å®é™…æ•°æ®</li>
<li><strong>ç´¢å¼•é¡µ</strong>ï¼šB+æ ‘ç´¢å¼•ç»“æ„</li>
<li><strong>undo é¡µ</strong>ï¼šç”¨äºäº‹åŠ¡å›æ»šçš„æ•°æ®</li>
<li><strong>æ’å…¥ç¼“å­˜</strong>ï¼šä¼˜åŒ–æ’å…¥æ“ä½œçš„ç¼“å­˜</li>
<li><strong>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</strong>ï¼šInnoDB è‡ªåŠ¨åˆ›å»ºçš„å“ˆå¸Œç´¢å¼•</li>
<li><strong>é”ä¿¡æ¯</strong>ï¼šå¹¶å‘æ§åˆ¶ç›¸å…³ä¿¡æ¯</li>
</ul>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠç»å¸¸ç”¨åˆ°çš„å„ç§æ•°æ®éƒ½æ”¾åœ¨å†…å­˜é‡Œï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229578943.png" alt="1748229578943"></p>
<h3 id="æ§åˆ¶å—ï¼šç¼“å­˜é¡µçš„-èº«ä»½è¯">æ§åˆ¶å—ï¼šç¼“å­˜é¡µçš„&quot;èº«ä»½è¯&quot;</h3>
<p>å…‰æœ‰ç¼“å­˜é¡µè¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦ç®¡ç†è¿™äº›é¡µé¢ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰å¾ˆå¤šä¹¦ï¼Œä½†æ²¡æœ‰ç›®å½•å’Œæ ‡ç­¾ï¼Œæ€ä¹ˆå¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„é‚£æœ¬ä¹¦å‘¢ï¼Ÿ</p>
<p>InnoDB ä¸ºæ¯ä¸ªç¼“å­˜é¡µéƒ½åˆ›å»ºäº†ä¸€ä¸ª<strong>æ§åˆ¶å—</strong>ï¼Œå°±åƒç»™æ¯ä¸ªç¼“å­˜é¡µå‘äº†ä¸€å¼ &quot;èº«ä»½è¯&quot;ï¼Œè®°å½•ç€ï¼š</p>
<ul>
<li><strong>è¡¨ç©ºé—´ ID</strong>ï¼šè¿™ä¸ªé¡µå±äºå“ªä¸ªæ•°æ®åº“è¡¨</li>
<li><strong>é¡µå·</strong>ï¼šåœ¨è¡¨ä¸­çš„ç¬¬å‡ é¡µ</li>
<li><strong>ç¼“å­˜é¡µåœ°å€</strong>ï¼šåœ¨å†…å­˜ä¸­çš„å…·ä½“ä½ç½®</li>
<li><strong>é“¾è¡¨èŠ‚ç‚¹ä¿¡æ¯</strong>ï¼šç”¨äºå„ç§é“¾è¡¨ç®¡ç†</li>
</ul>
<p><strong>å†…å­˜å¸ƒå±€</strong>ï¼šæ§åˆ¶å—æ”¾åœ¨ Buffer Pool çš„æœ€å‰é¢ï¼Œåé¢æ‰æ˜¯ç¼“å­˜é¡µï¼š</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229586453.png" alt="1748229586453"></p>
<p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†å›¾ä¸­çš„ç°è‰²éƒ¨åˆ†â€”â€”è¿™æ˜¯<strong>ç¢ç‰‡ç©ºé—´</strong>ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¼šæœ‰ç¢ç‰‡ç©ºé—´ï¼Ÿ</strong></p>
<p>è¿™å¾ˆå¥½ç†è§£ï¼šæ¯ä¸ªæ§åˆ¶å—éƒ½è¦å¯¹åº”ä¸€ä¸ªç¼“å­˜é¡µï¼Œå½“åˆ†é…å®Œæ‰€æœ‰çš„æ§åˆ¶å—å’Œç¼“å­˜é¡µåï¼Œå¯èƒ½å‰©ä½™çš„å†…å­˜ç©ºé—´ä¸å¤Ÿå†åˆ†é…ä¸€å¯¹æ§åˆ¶å—å’Œç¼“å­˜é¡µï¼Œè¿™éƒ¨åˆ†&quot;å‰©ä½™&quot;çš„å†…å­˜å°±æ˜¯ç¢ç‰‡ç©ºé—´ã€‚</p>
<blockquote>
<p><strong>å°è´´å£«</strong>ï¼šå¦‚æœä½ ç²¾ç¡®è®¡ç®— Buffer Pool çš„å¤§å°ï¼Œä¹Ÿå¯ä»¥é¿å…äº§ç”Ÿç¢ç‰‡ç©ºé—´ã€‚</p>
</blockquote>
<h3 id="å¸¸è§ç–‘é—®ï¼šæŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œåªç¼“å­˜è¿™æ¡è®°å½•å—ï¼Ÿ">å¸¸è§ç–‘é—®ï¼šæŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œåªç¼“å­˜è¿™æ¡è®°å½•å—ï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆæ˜¯ï¼šä¸æ˜¯çš„ï¼</strong></p>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ã€‚å½“ä½ æŸ¥è¯¢ä¸€æ¡è®°å½•æ—¶ï¼ŒMySQL å®é™…ä¸Šä¼šæŠŠ<strong>æ•´ä¸ªé¡µ</strong>ï¼ˆ16KBï¼‰éƒ½åŠ è½½åˆ° Buffer Pool ä¸­ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ</strong></p>
<p>æƒ³è±¡ä¸€ä¸‹åœ¨å›¾ä¹¦é¦†æ‰¾ä¹¦çš„åœºæ™¯ï¼š</p>
<ol>
<li>ä½ æƒ³çœ‹æŸæœ¬ä¹¦çš„ç¬¬ 100 é¡µç¬¬ 5 è¡Œ</li>
<li>ä½†å›¾ä¹¦ç®¡ç†å‘˜åªèƒ½å‘Šè¯‰ä½ è¿™æœ¬ä¹¦åœ¨å“ªä¸ªä¹¦æ¶ä¸Š</li>
<li>ä½ æ‹¿åˆ°æ•´æœ¬ä¹¦åï¼Œå†ç¿»åˆ°ç¬¬ 100 é¡µç¬¬ 5 è¡Œ</li>
</ol>
<p>MySQL çš„å·¥ä½œåŸç†ç±»ä¼¼ï¼š</p>
<ol>
<li><strong>ç´¢å¼•å®šä½</strong>ï¼šé€šè¿‡ç´¢å¼•åªèƒ½å®šä½åˆ°æ•°æ®åœ¨å“ªä¸ª&quot;é¡µ&quot;ä¸Š</li>
<li><strong>åŠ è½½æ•´é¡µ</strong>ï¼šæŠŠæ•´ä¸ª 16KB çš„é¡µåŠ è½½åˆ° Buffer Pool</li>
<li><strong>é¡µå†…æŸ¥æ‰¾</strong>ï¼šé€šè¿‡é¡µç›®å½•å®šä½åˆ°å…·ä½“çš„è®°å½•</li>
</ol>
<p><strong>è¿™æ ·åšçš„å¥½å¤„</strong>ï¼š</p>
<ul>
<li><strong>ç©ºé—´å±€éƒ¨æ€§</strong>ï¼šåŒä¸€é¡µçš„å…¶ä»–æ•°æ®å¾ˆå¯èƒ½ä¹Ÿä¼šè¢«è®¿é—®</li>
<li><strong>å‡å°‘ I/O</strong>ï¼šä¸€æ¬¡æ€§è¯»å– 16KB æ¯”å¤šæ¬¡è¯»å–å°å—æ•°æ®æ›´é«˜æ•ˆ</li>
<li><strong>é¡µæ˜¯åŸå­å•ä½</strong>ï¼šæ•°æ®åº“ä»¥é¡µä¸ºå•ä½ç®¡ç†æ•°æ®æ›´åŠ é«˜æ•ˆ</li>
</ul>
<blockquote>
<p><strong>å»¶ä¼¸é˜…è¯»</strong>ï¼šæƒ³äº†è§£é¡µç»“æ„å’Œç´¢å¼•æŸ¥è¯¢çš„è¯¦ç»†åŸç†ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/">æ¢ä¸€ä¸ªè§’åº¦çœ‹ B+ æ ‘</a></p>
</blockquote>
<h2 id="å¦‚ä½•ç®¡ç†-Buffer-Poolï¼Ÿ">å¦‚ä½•ç®¡ç† Buffer Poolï¼Ÿ</h2>
<p>Buffer Pool æœ‰å¾ˆå¤šç¼“å­˜é¡µï¼Œå°±åƒä¸€ä¸ªå¤§ä»“åº“æœ‰å¾ˆå¤šè´§æ¶ã€‚è¦é«˜æ•ˆç®¡ç†è¿™äº›é¡µé¢ï¼ŒMySQL è®¾è®¡äº†å‡ ç§ä¸åŒçš„&quot;é“¾è¡¨&quot;æ¥åˆ†ç±»ç®¡ç†ã€‚</p>
<h3 id="ç©ºé—²é¡µç®¡ç†ï¼šFree-é“¾è¡¨">ç©ºé—²é¡µç®¡ç†ï¼šFree é“¾è¡¨</h3>
<p><strong>é—®é¢˜</strong>ï¼šMySQL éœ€è¦åŠ è½½æ–°æ•°æ®æ—¶ï¼Œæ€ä¹ˆå¿«é€Ÿæ‰¾åˆ°ç©ºé—²çš„ç¼“å­˜é¡µï¼Ÿ</p>
<p>å¦‚æœæ¯æ¬¡éƒ½éå†æ•´ä¸ª Buffer Pool æ¥æ‰¾ç©ºé—²é¡µï¼Œæ•ˆç‡å¤ªä½äº†ã€‚å°±åƒåœ¨ä¸€ä¸ªå¤§ä»“åº“é‡ŒæŒ¨ä¸ªæ£€æŸ¥æ¯ä¸ªè´§æ¶æ˜¯å¦ç©ºç€ä¸€æ ·ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ <strong>Free é“¾è¡¨</strong>ï¼ˆç©ºé—²é“¾è¡¨ï¼‰</p>
<p>æŠŠæ‰€æœ‰ç©ºé—²ç¼“å­˜é¡µçš„æ§åˆ¶å—ä¸²æˆä¸€ä¸ªé“¾è¡¨ï¼Œéœ€è¦ç©ºé—²é¡µæ—¶ï¼Œç›´æ¥ä»é“¾è¡¨å¤´å–ä¸€ä¸ªå°±è¡Œäº†ã€‚</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229596157.png" alt="1748229596157"></p>
<p><strong>Free é“¾è¡¨çš„ç»„æˆ</strong>ï¼š</p>
<ul>
<li><strong>é“¾è¡¨å¤´èŠ‚ç‚¹</strong>ï¼šè®°å½•é“¾è¡¨çš„åŸºæœ¬ä¿¡æ¯
<ul>
<li>å¤´èŠ‚ç‚¹åœ°å€å’Œå°¾èŠ‚ç‚¹åœ°å€</li>
<li>å½“å‰ç©ºé—²é¡µçš„æ•°é‡</li>
</ul>
</li>
<li><strong>æ§åˆ¶å—èŠ‚ç‚¹</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªç©ºé—²çš„ç¼“å­˜é¡µ</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>éœ€è¦åŠ è½½æ–°æ•°æ®æ—¶</strong>ï¼šä» Free é“¾è¡¨å¤´éƒ¨å–ä¸€ä¸ªç©ºé—²ç¼“å­˜é¡µ</li>
<li><strong>å¡«å……æ§åˆ¶å—ä¿¡æ¯</strong>ï¼šè®°å½•è¡¨ç©ºé—´ã€é¡µå·ç­‰ä¿¡æ¯</li>
<li><strong>ä»é“¾è¡¨ä¸­ç§»é™¤</strong>ï¼šè¯¥æ§åˆ¶å—ä¸å†æ˜¯&quot;ç©ºé—²&quot;çŠ¶æ€</li>
</ol>
<p>è¿™æ ·çš„è®¾è®¡è®©æŸ¥æ‰¾ç©ºé—²é¡µçš„æ—¶é—´å¤æ‚åº¦ä» O(n) é™åˆ°äº† O(1)ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p>
<h3 id="è„é¡µç®¡ç†ï¼šFlush-é“¾è¡¨">è„é¡µç®¡ç†ï¼šFlush é“¾è¡¨</h3>
<p>Buffer Pool ä¸ä»…èƒ½æé«˜è¯»æ€§èƒ½ï¼Œè¿˜èƒ½æé«˜å†™æ€§èƒ½ã€‚å½“ä½ ä¿®æ”¹æ•°æ®æ—¶ï¼ŒMySQL å¹¶ä¸æ€¥ç€å†™ç£ç›˜ï¼Œè€Œæ˜¯å…ˆåœ¨å†…å­˜ä¸­ä¿®æ”¹ï¼Œç„¶åæŠŠè¿™ä¸ªé¡µæ ‡è®°ä¸º<strong>è„é¡µ</strong>ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯è„é¡µï¼Ÿ</strong></p>
<ul>
<li><strong>è„é¡µ</strong>ï¼šå†…å­˜ä¸­çš„æ•°æ®å·²ç»è¢«ä¿®æ”¹ï¼Œä½†è¿˜æ²¡åŒæ­¥åˆ°ç£ç›˜</li>
<li><strong>å¹²å‡€é¡µ</strong>ï¼šå†…å­˜å’Œç£ç›˜çš„æ•°æ®æ˜¯ä¸€è‡´çš„</li>
</ul>
<p><strong>é—®é¢˜</strong>ï¼šåå°çº¿ç¨‹æ€ä¹ˆçŸ¥é“å“ªäº›é¡µæ˜¯è„é¡µï¼Œéœ€è¦å†™å…¥ç£ç›˜å‘¢ï¼Ÿ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ <strong>Flush é“¾è¡¨</strong></p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229649895.png" alt="1748229649895"></p>
<p><strong>Flush é“¾è¡¨çš„ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>é“¾è¡¨ç»“æ„å’Œ Free é“¾è¡¨ç±»ä¼¼</li>
<li>åŒºåˆ«æ˜¯ï¼šFlush é“¾è¡¨ä¸­çš„éƒ½æ˜¯è„é¡µçš„æ§åˆ¶å—</li>
<li>åå°çº¿ç¨‹å®šæœŸéå† Flush é“¾è¡¨ï¼Œå°†è„é¡µå†™å…¥ç£ç›˜</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>æ•°æ®ä¿®æ”¹æ—¶</strong>ï¼šé¡µé¢æ ‡è®°ä¸ºè„é¡µï¼Œæ§åˆ¶å—åŠ å…¥ Flush é“¾è¡¨</li>
<li><strong>åå°åˆ·ç›˜</strong>ï¼šåå°çº¿ç¨‹éå† Flush é“¾è¡¨ï¼Œå†™å…¥ç£ç›˜</li>
<li><strong>å†™å…¥å®Œæˆ</strong>ï¼šä» Flush é“¾è¡¨ä¸­ç§»é™¤ï¼Œé¡µé¢å˜ä¸ºå¹²å‡€é¡µ</li>
</ol>
<p>è¿™ç§è®¾è®¡å®ç°äº†<strong>å»¶è¿Ÿå†™å…¥</strong>ï¼Œå¤§å¤§æé«˜äº†å†™æ“ä½œçš„æ€§èƒ½ã€‚</p>
<h3 id="ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼šæ”¹è¿›ç‰ˆ-LRU-ç®—æ³•">ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼šæ”¹è¿›ç‰ˆ LRU ç®—æ³•</h3>
<p>Buffer Pool çš„ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå°±åƒä½ çš„ä¹¦æ¡Œç©ºé—´æœ‰é™ä¸€æ ·ã€‚æˆ‘ä»¬å¸Œæœ›ï¼š</p>
<ul>
<li><strong>å¸¸ç”¨æ•°æ®</strong>ï¼šä¸€ç›´ç•™åœ¨ Buffer Pool ä¸­</li>
<li><strong>ä¸å¸¸ç”¨æ•°æ®</strong>ï¼šåŠæ—¶æ·˜æ±°æ‰ï¼Œè…¾å‡ºç©ºé—´</li>
</ul>
<p>è¿™æ˜¯å…¸å‹çš„ç¼“å­˜æ·˜æ±°é—®é¢˜ã€‚æœ€ç›´è§‚çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ <strong>LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•</strong>ã€‚</p>
<p><strong>ç»å…¸ LRU ç®—æ³•åŸç†</strong>ï¼š</p>
<ul>
<li><strong>é“¾è¡¨å¤´éƒ¨</strong>ï¼šæœ€è¿‘ä½¿ç”¨çš„æ•°æ®ï¼ˆçƒ­æ•°æ®ï¼‰</li>
<li><strong>é“¾è¡¨å°¾éƒ¨</strong>ï¼šæœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ï¼ˆå†·æ•°æ®ï¼‰</li>
<li><strong>æ·˜æ±°ç­–ç•¥</strong>ï¼šç©ºé—´ä¸è¶³æ—¶ï¼Œæ·˜æ±°é“¾è¡¨å°¾éƒ¨çš„æ•°æ®</li>
</ul>
<p><strong>ç»å…¸ LRU ç®—æ³•çš„æ“ä½œ</strong>ï¼š</p>
<ol>
<li><strong>é¡µé¢å‘½ä¸­</strong>ï¼ˆåœ¨ Buffer Pool ä¸­ï¼‰ï¼šå°†è¯¥é¡µç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨</li>
<li><strong>é¡µé¢æœªå‘½ä¸­</strong>ï¼ˆä¸åœ¨ Buffer Pool ä¸­ï¼‰ï¼šæ·˜æ±°å°¾éƒ¨é¡µé¢ï¼Œæ–°é¡µé¢åŠ å…¥å¤´éƒ¨</li>
</ol>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥ç†è§£ï¼š</p>
<p>å‡è®¾ LRU é“¾è¡¨é•¿åº¦ä¸º 5ï¼Œå½“å‰æœ‰é¡µé¢ 1ã€2ã€3ã€4ã€5ï¼š</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229660469.png" alt="1748229660469"></p>
<p><strong>åœºæ™¯ä¸€ï¼šè®¿é—®å·²å­˜åœ¨çš„é¡µé¢</strong><br>
è®¿é—® 3 å·é¡µæ—¶ï¼Œç”±äºå®ƒå·²ç»åœ¨ Buffer Pool ä¸­ï¼Œç›´æ¥ç§»åŠ¨åˆ°å¤´éƒ¨ï¼š</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229667608.png" alt="1748229667608"></p>
<p><strong>åœºæ™¯äºŒï¼šè®¿é—®ä¸å­˜åœ¨çš„é¡µé¢</strong><br>
è®¿é—® 8 å·é¡µæ—¶ï¼Œç”±äºå®ƒä¸åœ¨ Buffer Pool ä¸­ï¼š</p>
<ol>
<li>æ·˜æ±°å°¾éƒ¨çš„ 5 å·é¡µ</li>
<li>å°† 8 å·é¡µåŠ å…¥åˆ°å¤´éƒ¨</li>
</ol>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229675238.png" alt="1748229675238"></p>
<h3 id="Buffer-Pool-ä¸­çš„ä¸‰ç§é¡µé¢çŠ¶æ€">Buffer Pool ä¸­çš„ä¸‰ç§é¡µé¢çŠ¶æ€</h3>
<p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ Buffer Pool ä½¿ç”¨ä¸‰ç§é“¾è¡¨æ¥ç®¡ç†ä¸åŒçŠ¶æ€çš„é¡µé¢ï¼š</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229683283.png" alt="1748229683283"></p>
<p><strong>ä¸‰ç§é¡µé¢çŠ¶æ€</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>é¡µé¢ç±»å‹</th>
<th>çŠ¶æ€æè¿°</th>
<th>æ‰€åœ¨é“¾è¡¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Free Pageï¼ˆç©ºé—²é¡µï¼‰</strong></td>
<td>æœªè¢«ä½¿ç”¨çš„é¡µé¢</td>
<td>Free é“¾è¡¨</td>
</tr>
<tr>
<td><strong>Clean Pageï¼ˆå¹²å‡€é¡µï¼‰</strong></td>
<td>å·²ä½¿ç”¨ä½†æœªä¿®æ”¹çš„é¡µé¢<br>å†…å­˜å’Œç£ç›˜æ•°æ®ä¸€è‡´</td>
<td>LRU é“¾è¡¨</td>
</tr>
<tr>
<td><strong>Dirty Pageï¼ˆè„é¡µï¼‰</strong></td>
<td>å·²ä½¿ç”¨ä¸”å·²ä¿®æ”¹çš„é¡µé¢<br>å†…å­˜å’Œç£ç›˜æ•°æ®ä¸ä¸€è‡´</td>
<td>LRU é“¾è¡¨ + Flush é“¾è¡¨</td>
</tr>
</tbody>
</table>
<p><strong>é¡µé¢çŠ¶æ€è½¬æ¢</strong>ï¼š</p>
<ul>
<li><strong>ç©ºé—²é¡µ â†’ å¹²å‡€é¡µ</strong>ï¼šåŠ è½½ç£ç›˜æ•°æ®å</li>
<li><strong>å¹²å‡€é¡µ â†’ è„é¡µ</strong>ï¼šä¿®æ”¹æ•°æ®å</li>
<li><strong>è„é¡µ â†’ å¹²å‡€é¡µ</strong>ï¼šå†™å…¥ç£ç›˜å</li>
<li><strong>ä»»ä½•é¡µ â†’ ç©ºé—²é¡µ</strong>ï¼šä» Buffer Pool ä¸­æ·˜æ±°å</li>
</ul>
<h3 id="ç»å…¸-LRU-ç®—æ³•çš„ä¸¤å¤§é—®é¢˜">ç»å…¸ LRU ç®—æ³•çš„ä¸¤å¤§é—®é¢˜</h3>
<p>è™½ç„¶ LRU ç®—æ³•æ€è·¯å¾ˆå¥½ï¼Œä½† MySQL å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ç»å…¸çš„ LRU ç®—æ³•ï¼Œå› ä¸ºå®ƒæ— æ³•è§£å†³ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<h4 id="é—®é¢˜ä¸€ï¼šé¢„è¯»å¤±æ•ˆ">é—®é¢˜ä¸€ï¼šé¢„è¯»å¤±æ•ˆ</h4>
<p><strong>ä»€ä¹ˆæ˜¯é¢„è¯»æœºåˆ¶ï¼Ÿ</strong></p>
<p>MySQL æœ‰ä¸€ä¸ªå¾ˆèªæ˜çš„è®¾è®¡å«&quot;é¢„è¯»&quot;ã€‚åŸºäºç¨‹åºçš„<strong>ç©ºé—´å±€éƒ¨æ€§åŸç†</strong>ï¼Œå½“ä½ è®¿é—®æŸä¸ªæ•°æ®é¡µæ—¶ï¼ŒMySQL ä¼šçŒœæµ‹ä½ æ¥ä¸‹æ¥å¯èƒ½è®¿é—®ç›¸é‚»çš„æ•°æ®é¡µï¼Œäºæ˜¯æå‰åŠ è½½å®ƒä»¬ã€‚</p>
<p>å°±åƒä½ åœ¨çœ‹è¿ç»­å‰§ï¼Œçœ‹å®Œç¬¬ 5 é›†ï¼Œå¾ˆå¯èƒ½æ¥ä¸‹æ¥ä¼šçœ‹ç¬¬ 6ã€7 é›†ï¼Œæ‰€ä»¥è§†é¢‘ç½‘ç«™ä¼šæå‰ç¼“å­˜è¿™äº›é›†æ•°ã€‚</p>
<p><strong>é¢„è¯»å¤±æ•ˆçš„é—®é¢˜</strong>ï¼š</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœè¿™äº›é¢„è¯»çš„é¡µé¢å®é™…ä¸Šæ²¡æœ‰è¢«è®¿é—®ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼š</p>
<ol>
<li><strong>é¢„è¯»é¡µå æ®çƒ­ç‚¹ä½ç½®</strong>ï¼šè¿™äº›æ— ç”¨çš„é¢„è¯»é¡µè¢«æ”¾åœ¨ LRU é“¾è¡¨å¤´éƒ¨</li>
<li><strong>çœŸæ­£çš„çƒ­æ•°æ®è¢«æ·˜æ±°</strong>ï¼šBuffer Pool ç©ºé—´ä¸è¶³æ—¶ï¼Œé“¾è¡¨å°¾éƒ¨çš„çƒ­æ•°æ®åè€Œè¢«æ·˜æ±°</li>
<li><strong>ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™</strong>ï¼šå¯¼è‡´æ›´å¤šçš„ç£ç›˜ I/O</li>
</ol>
<p><strong>å…·ä½“ä¾‹å­</strong>ï¼š</p>
<ul>
<li>ä½ æŸ¥è¯¢ç”¨æˆ·è¡¨çš„ç¬¬ 100 é¡µæ•°æ®</li>
<li>MySQL é¢„è¯»äº†ç¬¬ 101ã€102ã€103 é¡µ</li>
<li>ä½†ä½ å®é™…åªéœ€è¦ç¬¬ 100 é¡µçš„æ•°æ®</li>
<li>ç»“æœï¼šæ— ç”¨çš„ 101ã€102ã€103 é¡µå æ®äº†å®è´µçš„ç¼“å­˜ç©ºé—´</li>
</ul>
<h4 id="è§£å†³æ–¹æ¡ˆï¼šLRU-é“¾è¡¨åˆ†åŒº">è§£å†³æ–¹æ¡ˆï¼šLRU é“¾è¡¨åˆ†åŒº</h4>
<p>æˆ‘ä»¬ä¸èƒ½å› ä¸ºå®³æ€•é¢„è¯»å¤±æ•ˆå°±å–æ¶ˆé¢„è¯»æœºåˆ¶ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹ç©ºé—´å±€éƒ¨æ€§åŸç†æ˜¯æˆç«‹çš„ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šè®©é¢„è¯»çš„é¡µåœç•™æ—¶é—´å°½å¯èƒ½çŸ­ï¼ŒçœŸæ­£è¢«è®¿é—®çš„é¡µæ‰èƒ½è¿›å…¥çƒ­ç‚¹åŒºåŸŸã€‚</p>
<p><strong>MySQL çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼šå°† LRU é“¾è¡¨åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸ</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229697824.png" alt="1748229697824"></p>
<p><strong>ä¸¤ä¸ªåŒºåŸŸçš„è®¾è®¡</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>åŒºåŸŸ</th>
<th>ä½ç½®</th>
<th>ä½œç”¨</th>
<th>é»˜è®¤æ¯”ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Young åŒºåŸŸ</strong></td>
<td>é“¾è¡¨å‰åŠéƒ¨åˆ†</td>
<td>å­˜æ”¾çƒ­ç‚¹æ•°æ®</td>
<td>63%</td>
</tr>
<tr>
<td><strong>Old åŒºåŸŸ</strong></td>
<td>é“¾è¡¨ååŠéƒ¨åˆ†</td>
<td>å­˜æ”¾æ–°åŠ è½½/é¢„è¯»æ•°æ®</td>
<td>37%</td>
</tr>
</tbody>
</table>
<p><strong>é…ç½®å‚æ•°</strong>ï¼š<code>innodb_old_blocks_pct = 37</code>ï¼ˆè¡¨ç¤º old åŒºåŸŸå  37%ï¼‰</p>
<p><strong>æ–°çš„å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>é¢„è¯»é¡µé¢</strong>ï¼šç›´æ¥æ”¾å…¥ old åŒºåŸŸå¤´éƒ¨ï¼ˆä¸æ˜¯æ•´ä¸ª LRU çš„å¤´éƒ¨ï¼‰</li>
<li><strong>é¡µé¢è¢«è®¿é—®</strong>ï¼šä» old åŒºåŸŸç§»åŠ¨åˆ° young åŒºåŸŸå¤´éƒ¨</li>
<li><strong>é¢„è¯»é¡µé¢æœªè¢«è®¿é—®</strong>ï¼šåœ¨ old åŒºåŸŸè‡ªç„¶è€åŒ–ï¼Œæœ€ç»ˆè¢«æ·˜æ±°</li>
</ol>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<ul>
<li>âœ… é¢„è¯»é¡µé¢ä¸ä¼šç«‹å³å æ®çƒ­ç‚¹ä½ç½®</li>
<li>âœ… çœŸæ­£ä½¿ç”¨çš„æ•°æ®æ‰èƒ½è¿›å…¥ young åŒºåŸŸ</li>
<li>âœ… æœªä½¿ç”¨çš„é¢„è¯»é¡µé¢ä¼šè¾ƒå¿«è¢«æ·˜æ±°</li>
<li>âœ… çƒ­ç‚¹æ•°æ®å¾—åˆ°æ›´å¥½çš„ä¿æŠ¤</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œç»™å¤§å®¶ä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªé•¿åº¦ä¸º 10 çš„ LRU é“¾è¡¨ï¼Œå…¶ä¸­ young åŒºåŸŸå æ¯” 70 %ï¼Œold åŒºåŸŸå æ¯” 30 %ã€‚</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229706232.png" alt="1748229706232"></p>
<p>ç°åœ¨æœ‰ä¸ªç¼–å·ä¸º 20 çš„é¡µè¢«é¢„è¯»äº†ï¼Œè¿™ä¸ªé¡µåªä¼šè¢«æ’å…¥åˆ°  old åŒºåŸŸå¤´éƒ¨ï¼Œè€Œ old åŒºåŸŸæœ«å°¾çš„é¡µï¼ˆ10 å·ï¼‰ä¼šè¢«æ·˜æ±°æ‰ã€‚</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229713256.png" alt="1748229713256"></p>
<p>å¦‚æœ 20 å·é¡µä¸€ç›´ä¸ä¼šè¢«è®¿é—®ï¼Œå®ƒä¹Ÿæ²¡æœ‰å ç”¨åˆ° young åŒºåŸŸçš„ä½ç½®ï¼Œè€Œä¸”è¿˜ä¼šæ¯” young åŒºåŸŸçš„æ•°æ®æ›´æ—©è¢«æ·˜æ±°å‡ºå»ã€‚</p>
<p>å¦‚æœ 20 å·é¡µè¢«é¢„è¯»åï¼Œç«‹åˆ»è¢«è®¿é—®äº†ï¼Œé‚£ä¹ˆå°±ä¼šå°†å®ƒæ’å…¥åˆ° young åŒºåŸŸçš„å¤´éƒ¨ï¼Œyoung åŒºåŸŸæœ«å°¾çš„é¡µï¼ˆ7 å·ï¼‰ï¼Œä¼šè¢«æŒ¤åˆ° old åŒºåŸŸï¼Œä½œä¸º old åŒºåŸŸçš„å¤´éƒ¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸ä¼šæœ‰é¡µè¢«æ·˜æ±°ã€‚</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229721586.png" alt="1748229721586"></p>
<p>è™½ç„¶é€šè¿‡åˆ’åˆ† old åŒºåŸŸ å’Œ young åŒºåŸŸé¿å…äº†é¢„è¯»å¤±æ•ˆå¸¦æ¥çš„å½±å“ï¼Œä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜æ— æ³•è§£å†³ï¼Œé‚£å°±æ˜¯  Buffer Pool  æ±¡æŸ“çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯  Buffer Pool  æ±¡æŸ“ï¼Ÿ</p>
</blockquote>
<p>å½“æŸä¸€ä¸ª SQL è¯­å¥<strong>æ‰«æäº†å¤§é‡çš„æ•°æ®</strong>æ—¶ï¼Œåœ¨  Buffer Pool ç©ºé—´æ¯”è¾ƒæœ‰é™çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå°† <strong>Buffer Pool é‡Œçš„æ‰€æœ‰é¡µéƒ½æ›¿æ¢å‡ºå»ï¼Œå¯¼è‡´å¤§é‡çƒ­æ•°æ®è¢«æ·˜æ±°äº†</strong>ï¼Œç­‰è¿™äº›çƒ­æ•°æ®åˆè¢«å†æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œç”±äºç¼“å­˜æœªå‘½ä¸­ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„ç£ç›˜ IOï¼ŒMySQL æ€§èƒ½å°±ä¼šæ€¥å‰§ä¸‹é™ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º <strong>Buffer Pool  æ±¡æŸ“</strong>ã€‚</p>
<p>æ³¨æ„ï¼ŒBuffer Pool  æ±¡æŸ“å¹¶ä¸åªæ˜¯æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å‡ºäº†å¤§é‡çš„æ•°æ®æ‰å‡ºç°çš„é—®é¢˜ï¼Œå³ä½¿æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†å¾ˆå°ï¼Œä¹Ÿä¼šé€ æˆ Buffer Pool  æ±¡æŸ“ã€‚</p>
<p>æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªæ•°æ®é‡éå¸¸å¤§çš„è¡¨ï¼Œæ‰§è¡Œäº†è¿™æ¡è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> name <span class="keyword">like</span> &quot;%xiaolin%&quot;;</span><br></pre></td></tr></table></figure>
<p>å¯èƒ½è¿™ä¸ªæŸ¥è¯¢å‡ºæ¥çš„ç»“æœå°±å‡ æ¡è®°å½•ï¼Œä½†æ˜¯ç”±äºè¿™æ¡è¯­å¥ä¼šå‘ç”Ÿç´¢å¼•å¤±æ•ˆï¼Œæ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹æ˜¯å…¨è¡¨æ‰«æçš„ï¼Œæ¥ç€ä¼šå‘ç”Ÿå¦‚ä¸‹çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>ä»ç£ç›˜è¯»åˆ°çš„é¡µåŠ å…¥åˆ° LRU é“¾è¡¨çš„ old åŒºåŸŸå¤´éƒ¨ï¼›</li>
<li>å½“ä»é¡µé‡Œè¯»å–è¡Œè®°å½•æ—¶ï¼Œä¹Ÿå°±æ˜¯é¡µè¢«è®¿é—®çš„æ—¶å€™ï¼Œå°±è¦å°†è¯¥é¡µæ”¾åˆ° young åŒºåŸŸå¤´éƒ¨ï¼›</li>
<li>æ¥ä¸‹æ¥æ‹¿è¡Œè®°å½•çš„ name å­—æ®µå’Œå­—ç¬¦ä¸² xiaolin è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚æœç¬¦åˆæ¡ä»¶ï¼Œå°±åŠ å…¥åˆ°ç»“æœé›†é‡Œï¼›</li>
<li>å¦‚æ­¤å¾€å¤ï¼Œç›´åˆ°æ‰«æå®Œè¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</li>
</ul>
<p>ç»è¿‡è¿™ä¸€ç•ªæŠ˜è…¾ï¼ŒåŸæœ¬ young åŒºåŸŸçš„çƒ­ç‚¹æ•°æ®éƒ½ä¼šè¢«æ›¿æ¢æ‰ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾éœ€è¦æ‰¹é‡æ‰«æï¼š21ï¼Œ22ï¼Œ23ï¼Œ24ï¼Œ25 è¿™äº”ä¸ªé¡µï¼Œè¿™äº›é¡µéƒ½ä¼šè¢«é€ä¸€è®¿é—®ï¼ˆè¯»å–é¡µé‡Œçš„è®°å½•ï¼‰ã€‚</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229731726.png" alt="1748229731726"></p>
<p>åœ¨æ‰¹é‡è®¿é—®è¿™äº›æ•°æ®çš„æ—¶å€™ï¼Œä¼šè¢«é€ä¸€æ’å…¥åˆ° young åŒºåŸŸå¤´éƒ¨ã€‚</p>
<p><img src="/2025/05/26/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%86%85%E5%AD%98/BufferPool/1748229738373.png" alt="1748229738373"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸæœ¬åœ¨ young åŒºåŸŸçš„çƒ­ç‚¹æ•°æ® 6 å’Œ 7 å·é¡µéƒ½è¢«æ·˜æ±°äº†ï¼Œè¿™å°±æ˜¯  Buffer Pool  æ±¡æŸ“çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>æ€ä¹ˆè§£å†³å‡ºç°   Buffer Pool  æ±¡æŸ“è€Œå¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™çš„é—®é¢˜ï¼Ÿ</p>
</blockquote>
<p>åƒå‰é¢è¿™ç§å…¨è¡¨æ‰«æçš„æŸ¥è¯¢ï¼Œå¾ˆå¤šç¼“å†²é¡µå…¶å®åªä¼šè¢«è®¿é—®ä¸€æ¬¡ï¼Œä½†æ˜¯å®ƒå´åªå› ä¸ºè¢«è®¿é—®äº†ä¸€æ¬¡è€Œè¿›å…¥åˆ° young åŒºåŸŸï¼Œä»è€Œå¯¼è‡´çƒ­ç‚¹æ•°æ®è¢«æ›¿æ¢äº†ã€‚</p>
<p>LRU é“¾è¡¨ä¸­ young åŒºåŸŸå°±æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œåªè¦æˆ‘ä»¬æé«˜è¿›å…¥åˆ° young åŒºåŸŸçš„é—¨æ§›ï¼Œå°±èƒ½æœ‰æ•ˆåœ°ä¿è¯ young åŒºåŸŸé‡Œçš„çƒ­ç‚¹æ•°æ®ä¸ä¼šè¢«æ›¿æ¢æ‰ã€‚</p>
<p>MySQL æ˜¯è¿™æ ·åšçš„ï¼Œè¿›å…¥åˆ° young åŒºåŸŸæ¡ä»¶å¢åŠ äº†ä¸€ä¸ª<strong>åœç•™åœ¨ old åŒºåŸŸçš„æ—¶é—´åˆ¤æ–­</strong>ã€‚</p>
<p>å…·ä½“æ˜¯è¿™æ ·åšçš„ï¼Œåœ¨å¯¹æŸä¸ªå¤„åœ¨ old åŒºåŸŸçš„ç¼“å­˜é¡µè¿›è¡Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œå°±åœ¨å®ƒå¯¹åº”çš„æ§åˆ¶å—ä¸­è®°å½•ä¸‹æ¥è¿™ä¸ªè®¿é—®æ—¶é—´ï¼š</p>
<ul>
<li>å¦‚æœåç»­çš„è®¿é—®æ—¶é—´ä¸ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶é—´<strong>åœ¨æŸä¸ªæ—¶é—´é—´éš”å†…</strong>ï¼Œé‚£ä¹ˆ<strong>è¯¥ç¼“å­˜é¡µå°±ä¸ä¼šè¢«ä» old åŒºåŸŸç§»åŠ¨åˆ° young åŒºåŸŸçš„å¤´éƒ¨</strong>ï¼›</li>
<li>å¦‚æœåç»­çš„è®¿é—®æ—¶é—´ä¸ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶é—´<strong>ä¸åœ¨æŸä¸ªæ—¶é—´é—´éš”å†…</strong>ï¼Œé‚£ä¹ˆ<strong>è¯¥ç¼“å­˜é¡µç§»åŠ¨åˆ° young åŒºåŸŸçš„å¤´éƒ¨</strong>ï¼›</li>
</ul>
<p>è¿™ä¸ªé—´éš”æ—¶é—´æ˜¯ç”± <code>innodb_old_blocks_time</code> æ§åˆ¶çš„ï¼Œé»˜è®¤æ˜¯ 1000 msã€‚</p>
<p>ä¹Ÿå°±è¯´ï¼Œ<strong>åªæœ‰åŒæ—¶æ»¡è¶³ã€Œè¢«è®¿é—®ã€ä¸ã€Œåœ¨ old åŒºåŸŸåœç•™æ—¶é—´è¶…è¿‡ 1 ç§’ã€ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰ä¼šè¢«æ’å…¥åˆ° young åŒºåŸŸå¤´éƒ¨</strong>ï¼Œè¿™æ ·å°±è§£å†³äº† Buffer Pool  æ±¡æŸ“çš„é—®é¢˜ã€‚</p>
<p>å¦å¤–ï¼ŒMySQL é’ˆå¯¹ young åŒºåŸŸå…¶å®åšäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œä¸ºäº†é˜²æ­¢ young åŒºåŸŸèŠ‚ç‚¹é¢‘ç¹ç§»åŠ¨åˆ°å¤´éƒ¨ã€‚young åŒºåŸŸå‰é¢ 1/4 è¢«è®¿é—®ä¸ä¼šç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œåªæœ‰åé¢çš„ 3/4 è¢«è®¿é—®äº†æ‰ä¼šã€‚</p>
<h3 id="è„é¡µä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ·å…¥ç£ç›˜ï¼Ÿ">è„é¡µä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ·å…¥ç£ç›˜ï¼Ÿ</h3>
<p>å¼•å…¥äº† Buffer Pool  åï¼Œå½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œé¦–å…ˆæ˜¯ä¿®æ”¹  Buffer Pool  ä¸­æ•°æ®æ‰€åœ¨çš„é¡µï¼Œç„¶åå°†å…¶é¡µè®¾ç½®ä¸ºè„é¡µï¼Œä½†æ˜¯ç£ç›˜ä¸­è¿˜æ˜¯åŸæ•°æ®ã€‚</p>
<p>å› æ­¤ï¼Œè„é¡µéœ€è¦è¢«åˆ·å…¥ç£ç›˜ï¼Œä¿è¯ç¼“å­˜å’Œç£ç›˜æ•°æ®ä¸€è‡´ï¼Œä½†æ˜¯è‹¥æ¯æ¬¡ä¿®æ”¹æ•°æ®éƒ½åˆ·å…¥ç£ç›˜ï¼Œåˆ™æ€§èƒ½ä¼šå¾ˆå·®ï¼Œå› æ­¤ä¸€èˆ¬éƒ½ä¼šåœ¨ä¸€å®šæ—¶æœºè¿›è¡Œæ‰¹é‡åˆ·ç›˜ã€‚</p>
<p>å¯èƒ½å¤§å®¶æ‹…å¿ƒï¼Œå¦‚æœåœ¨è„é¡µè¿˜æ²¡æœ‰æ¥å¾—åŠåˆ·å…¥åˆ°ç£ç›˜æ—¶ï¼ŒMySQL å®•æœºäº†ï¼Œä¸å°±ä¸¢å¤±æ•°æ®äº†å—ï¼Ÿ</p>
<p>è¿™ä¸ªä¸ç”¨æ‹…å¿ƒï¼ŒInnoDB çš„æ›´æ–°æ“ä½œé‡‡ç”¨çš„æ˜¯ Write Ahead Log ç­–ç•¥ï¼Œå³å…ˆå†™æ—¥å¿—ï¼Œå†å†™å…¥ç£ç›˜ï¼Œé€šè¿‡ redo log æ—¥å¿—è®© MySQL æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</p>
<p>ä¸‹é¢å‡ ç§æƒ…å†µä¼šè§¦å‘è„é¡µçš„åˆ·æ–°ï¼š</p>
<ul>
<li>å½“ redo log æ—¥å¿—æ»¡äº†çš„æƒ…å†µä¸‹ï¼Œä¼šä¸»åŠ¨è§¦å‘è„é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼›</li>
<li>Buffer Pool ç©ºé—´ä¸è¶³æ—¶ï¼Œéœ€è¦å°†ä¸€éƒ¨åˆ†æ•°æ®é¡µæ·˜æ±°æ‰ï¼Œå¦‚æœæ·˜æ±°çš„æ˜¯è„é¡µï¼Œéœ€è¦å…ˆå°†è„é¡µåŒæ­¥åˆ°ç£ç›˜ï¼›</li>
<li>MySQL è®¤ä¸ºç©ºé—²æ—¶ï¼Œåå°çº¿ç¨‹å›å®šæœŸå°†é€‚é‡çš„è„é¡µåˆ·å…¥åˆ°ç£ç›˜ï¼›</li>
<li>MySQL æ­£å¸¸å…³é—­ä¹‹å‰ï¼Œä¼šæŠŠæ‰€æœ‰çš„è„é¡µåˆ·å…¥åˆ°ç£ç›˜ï¼›</li>
</ul>
<p>åœ¨æˆ‘ä»¬å¼€å¯äº†æ…¢ SQL ç›‘æ§åï¼Œå¦‚æœä½ å‘ç°**ã€Œå¶å°”ã€ä¼šå‡ºç°ä¸€äº›ç”¨æ—¶ç¨é•¿çš„ SQL**ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºè„é¡µåœ¨åˆ·æ–°åˆ°ç£ç›˜æ—¶å¯èƒ½ä¼šç»™æ•°æ®åº“å¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œå¯¼è‡´æ•°æ®åº“æ“ä½œæŠ–åŠ¨ã€‚</p>
<p>å¦‚æœé—´æ–­å‡ºç°è¿™ç§ç°è±¡ï¼Œå°±éœ€è¦è°ƒå¤§ Buffer Pool ç©ºé—´æˆ– redo log æ—¥å¿—çš„å¤§å°ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Buffer Pool æ˜¯ MySQL InnoDB å­˜å‚¨å¼•æ“çš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡å†…å­˜ç¼“å­˜å¤§å¤§æå‡äº†æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ã€‚</p>
<h3 id="æ ¸å¿ƒæ¦‚å¿µå›é¡¾">æ ¸å¿ƒæ¦‚å¿µå›é¡¾</h3>
<p><strong>åŸºæœ¬æ¦‚å¿µ</strong>ï¼š</p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå‡å°‘ç£ç›˜ I/O</li>
<li><strong>å•ä½</strong>ï¼šä»¥ 16KB çš„é¡µä¸ºåŸºæœ¬å•ä½</li>
<li><strong>å¤§å°</strong>ï¼šé»˜è®¤ 128MBï¼Œå»ºè®®è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ 60%~80%</li>
</ul>
<p><strong>ä¸‰ç§é“¾è¡¨ç®¡ç†</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>é“¾è¡¨ç±»å‹</th>
<th>ç®¡ç†å¯¹è±¡</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Free é“¾è¡¨</strong></td>
<td>ç©ºé—²é¡µ</td>
<td>å¿«é€Ÿåˆ†é…ç©ºé—²ç¼“å­˜é¡µ</td>
</tr>
<tr>
<td><strong>Flush é“¾è¡¨</strong></td>
<td>è„é¡µ</td>
<td>ç®¡ç†éœ€è¦å†™å…¥ç£ç›˜çš„é¡µé¢</td>
</tr>
<tr>
<td><strong>LRU é“¾è¡¨</strong></td>
<td>æ‰€æœ‰ä½¿ç”¨ä¸­çš„é¡µ</td>
<td>ç¼“å­˜æ·˜æ±°ç­–ç•¥</td>
</tr>
</tbody>
</table>
<h3 id="MySQL-çš„-LRU-ä¼˜åŒ–">MySQL çš„ LRU ä¼˜åŒ–</h3>
<p>ä¸ºäº†è§£å†³ç»å…¸ LRU ç®—æ³•çš„é—®é¢˜ï¼ŒMySQL åšäº†ä¸¤ä¸ªå…³é”®ä¼˜åŒ–ï¼š</p>
<p><strong>1. é“¾è¡¨åˆ†åŒº</strong>ï¼š</p>
<ul>
<li><strong>Young åŒºåŸŸ</strong>ï¼ˆ63%ï¼‰ï¼šå­˜æ”¾çƒ­ç‚¹æ•°æ®</li>
<li><strong>Old åŒºåŸŸ</strong>ï¼ˆ37%ï¼‰ï¼šå­˜æ”¾æ–°åŠ è½½çš„æ•°æ®</li>
<li><strong>è§£å†³é—®é¢˜</strong>ï¼šé¢„è¯»å¤±æ•ˆ</li>
</ul>
<p><strong>2. æ—¶é—´é—¨æ§›</strong>ï¼š</p>
<ul>
<li><strong>æ¡ä»¶</strong>ï¼šé¡µé¢åœ¨ old åŒºåŸŸåœç•™æ—¶é—´ &gt; 1 ç§’æ‰èƒ½è¿›å…¥ young åŒºåŸŸ</li>
<li><strong>è§£å†³é—®é¢˜</strong>ï¼šBuffer Pool æ±¡æŸ“ï¼ˆå…¨è¡¨æ‰«æç­‰ï¼‰</li>
</ul>
<h3 id="é‡è¦å‚æ•°">é‡è¦å‚æ•°</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- Buffer Pool å¤§å°</span></span><br><span class="line">innodb_buffer_pool_size <span class="operator">=</span> <span class="number">4</span>G</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Old åŒºåŸŸæ¯”ä¾‹</span></span><br><span class="line">innodb_old_blocks_pct <span class="operator">=</span> <span class="number">37</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¿›å…¥ Young åŒºåŸŸçš„æ—¶é—´é—¨æ§›</span></span><br><span class="line">innodb_old_blocks_time <span class="operator">=</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure>
<h3 id="æ€§èƒ½ç›‘æ§è¦ç‚¹">æ€§èƒ½ç›‘æ§è¦ç‚¹</h3>
<p>å¦‚æœå‘ç°å¶å°”å‡ºç°çš„æ…¢ SQLï¼Œå¯èƒ½æ˜¯è„é¡µåˆ·ç›˜å¯¼è‡´çš„æ€§èƒ½æŠ–åŠ¨ï¼Œå¯ä»¥è€ƒè™‘ï¼š</p>
<ul>
<li>è°ƒå¤§ Buffer Pool å¤§å°</li>
<li>è°ƒå¤§ redo log å¤§å°</li>
<li>ç›‘æ§è„é¡µæ¯”ä¾‹å’Œåˆ·ç›˜é¢‘ç‡</li>
</ul>
<p>Buffer Pool çš„è®¾è®¡ä½“ç°äº† MySQL åœ¨æ€§èƒ½ä¼˜åŒ–æ–¹é¢çš„ç²¾å¦™ä¹‹å¤„ï¼Œç†è§£å…¶åŸç†å¯¹äºæ•°æ®åº“è°ƒä¼˜å’Œæ•…éšœæ’æŸ¥éƒ½éå¸¸é‡è¦ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>å†…å­˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>MySQL</tag>
        <tag>Buffer Pool</tag>
        <tag>æ•°æ®åº“ä¼˜åŒ–</tag>
        <tag>å†…å­˜ç®¡ç†</tag>
        <tag>InnoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 238 - é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ï¼ˆProduct of Array Except Selfï¼‰</title>
    <url>/2025/05/25/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-238-%E9%99%A4%E8%87%AA%E8%BA%AB%E4%BB%A5%E5%A4%96%E6%95%B0%E7%BB%84%E7%9A%84%E4%B9%98%E7%A7%AF/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œè¿”å›æ•°ç»„ <code>answer</code> ï¼Œå…¶ä¸­ <code>answer[i]</code> ç­‰äº <code>nums</code> ä¸­é™¤ <code>nums[i]</code> ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯ã€‚</p>
<p>é¢˜ç›®æ•°æ® <strong>ä¿è¯</strong> æ•°ç»„ <code>nums</code> ä¹‹ä¸­ä»»æ„å…ƒç´ çš„å…¨éƒ¨å‰ç¼€å…ƒç´ å’Œåç¼€å…ƒç´ çš„ä¹˜ç§¯éƒ½åœ¨ 32 ä½æ•´æ•°èŒƒå›´å†…ã€‚</p>
<p>è¯· <strong>ä¸è¦ä½¿ç”¨é™¤æ³•</strong>ï¼Œä¸”åœ¨ <code>O(n)</code> æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ­¤é¢˜ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [1,2,3,4]</span><br><span class="line">è¾“å‡º: [24,12,8,6]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [-1,1,0,-3,3]</span><br><span class="line">è¾“å‡º: [0,0,9,0,0]</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>2 â‰¤ nums.length â‰¤ 10âµ</code></li>
<li><code>-30 â‰¤ nums[i] â‰¤ 30</code></li>
<li><strong>ä¿è¯</strong> æ•°ç»„ <code>nums</code> ä¹‹ä¸­ä»»æ„å…ƒç´ çš„å…¨éƒ¨å‰ç¼€å…ƒç´ å’Œåç¼€å…ƒç´ çš„ä¹˜ç§¯éƒ½åœ¨ 32 ä½æ•´æ•°èŒƒå›´å†…</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>å¯¹äºä½ç½® <code>i</code> çš„ç»“æœï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ‰€æœ‰é™¤äº† <code>nums[i]</code> ä»¥å¤–çš„å…ƒç´ ä¹˜ç§¯ã€‚å¯ä»¥å°†è¿™ä¸ªä¹˜ç§¯åˆ†è§£ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå¯¹äºä½ç½® <code>i</code>ï¼Œç»“æœç­‰äº <strong>å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</strong> Ã— <strong>å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°ç»„: [1, 2, 3, 4]</span><br><span class="line">ä½ç½®:  0  1  2  3</span><br><span class="line"></span><br><span class="line">å¯¹äºä½ç½® i=1 (å€¼ä¸º2):</span><br><span class="line">å·¦ä¾§ä¹˜ç§¯: nums[0] = 1</span><br><span class="line">å³ä¾§ä¹˜ç§¯: nums[2] Ã— nums[3] = 3 Ã— 4 = 12</span><br><span class="line">ç»“æœ: 1 Ã— 12 = 12</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§å®ç°æ–¹æ³•ã€‚</p>
<h2 id="æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•">æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•</h2>
<h3 id="å®ç°æ€è·¯">å®ç°æ€è·¯</h3>
<p>å¯¹äºæ¯ä¸ªä½ç½® <code>i</code>ï¼Œéå†æ•´ä¸ªæ•°ç»„è®¡ç®—é™¤äº† <code>nums[i]</code> ä»¥å¤–æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ã€‚</p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">productExceptSelfBruteForce</span><span class="params">(nums []<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        product := <span class="number">1</span></span><br><span class="line">        <span class="comment">// è®¡ç®—é™¤nums[i]ä»¥å¤–æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; n; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> i != j &#123;</span><br><span class="line">                product *= nums[j]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        result[i] = product</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n^2)$ - å¯¹äºæ¯ä¸ªä½ç½®éƒ½è¦éå†æ•´ä¸ªæ•°ç»„</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$ - é™¤äº†ç»“æœæ•°ç»„å¤–ï¼Œåªä½¿ç”¨å¸¸é‡é¢å¤–ç©ºé—´</li>
</ul>
<h2 id="æ–¹æ³•äºŒï¼šå‰ç¼€å’Œåç¼€ä¹˜ç§¯æ•°ç»„">æ–¹æ³•äºŒï¼šå‰ç¼€å’Œåç¼€ä¹˜ç§¯æ•°ç»„</h2>
<h3 id="å®ç°æ€è·¯-2">å®ç°æ€è·¯</h3>
<ol>
<li><strong>å·¦ä¹˜ç§¯æ•°ç»„</strong>ï¼š<code>left[i]</code> è¡¨ç¤º <code>nums[i]</code> å·¦ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</li>
<li><strong>å³ä¹˜ç§¯æ•°ç»„</strong>ï¼š<code>right[i]</code> è¡¨ç¤º <code>nums[i]</code> å³ä¾§æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯</li>
<li><strong>ç»“æœ</strong>ï¼š<code>result[i] = left[i] Ã— right[i]</code></li>
</ol>
<h3 id="è¯¦ç»†æ­¥éª¤">è¯¦ç»†æ­¥éª¤</h3>
<p>ä»¥ <code>nums = [1, 2, 3, 4]</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸæ•°ç»„:     [1, 2, 3, 4]</span><br><span class="line">å·¦ä¹˜ç§¯:     [1, 1, 2, 6]    // left[i] = nums[0] * ... * nums[i-1]</span><br><span class="line">å³ä¹˜ç§¯:     [24, 12, 4, 1]  // right[i] = nums[i+1] * ... * nums[n-1]</span><br><span class="line">ç»“æœ:       [24, 12, 8, 6]  // result[i] = left[i] * right[i]</span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">productExceptSelfTwoArrays</span><span class="params">(nums []<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    left := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    right := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„å»ºå·¦ä¹˜ç§¯æ•°ç»„</span></span><br><span class="line">    left[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">        left[i] = left[i<span class="number">-1</span>] * nums[i<span class="number">-1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„å»ºå³ä¹˜ç§¯æ•°ç»„</span></span><br><span class="line">    right[n<span class="number">-1</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := n - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        right[i] = right[i+<span class="number">1</span>] * nums[i+<span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡ç®—ç»“æœ</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        result[i] = left[i] * right[i]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ-2">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$ - ä¸‰æ¬¡éå†æ•°ç»„</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n)$ - éœ€è¦é¢å¤–çš„ left å’Œ right æ•°ç»„</li>
</ul>
<h2 id="æ–¹æ³•ä¸‰ï¼šç©ºé—´ä¼˜åŒ–è§£æ³•ï¼ˆæ¨èï¼‰">æ–¹æ³•ä¸‰ï¼šç©ºé—´ä¼˜åŒ–è§£æ³•ï¼ˆæ¨èï¼‰</h2>
<h3 id="å®ç°æ€è·¯-3">å®ç°æ€è·¯</h3>
<p>ä¼˜åŒ–æ–¹æ³•äºŒï¼Œä½¿ç”¨ç»“æœæ•°ç»„æ¥å­˜å‚¨å·¦ä¹˜ç§¯ï¼Œç„¶åç”¨ä¸€ä¸ªå˜é‡æ¥ç»´æŠ¤å³ä¹˜ç§¯ï¼Œä»å³å‘å·¦æ›´æ–°ç»“æœã€‚</p>
<h3 id="è¯¦ç»†æ­¥éª¤-2">è¯¦ç»†æ­¥éª¤</h3>
<ol>
<li><strong>ç¬¬ä¸€é</strong>ï¼šç»“æœæ•°ç»„å­˜å‚¨æ¯ä¸ªä½ç½®çš„å·¦ä¹˜ç§¯</li>
<li><strong>ç¬¬äºŒé</strong>ï¼šä»å³å¾€å·¦éå†ï¼Œç”¨å˜é‡ <code>right</code> ç»´æŠ¤å³ä¹˜ç§¯ï¼ŒåŒæ—¶æ›´æ–°ç»“æœ</li>
</ol>
<h3 id="æ‰§è¡Œè¿‡ç¨‹æ¼”ç¤º">æ‰§è¡Œè¿‡ç¨‹æ¼”ç¤º</h3>
<p>ä»¥ <code>nums = [1, 2, 3, 4]</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹åŒ–: nums = [1, 2, 3, 4], result = [0, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€é - è®¡ç®—å·¦ä¹˜ç§¯:</span><br><span class="line">i=0: result[0] = 1              â†’ result = [1, 0, 0, 0]</span><br><span class="line">i=1: result[1] = result[0] * nums[0] = 1 * 1 = 1   â†’ result = [1, 1, 0, 0]</span><br><span class="line">i=2: result[2] = result[1] * nums[1] = 1 * 2 = 2   â†’ result = [1, 1, 2, 0]</span><br><span class="line">i=3: result[3] = result[2] * nums[2] = 2 * 3 = 6   â†’ result = [1, 1, 2, 6]</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒé - è®¡ç®—æœ€ç»ˆç»“æœ:</span><br><span class="line">right = 1</span><br><span class="line">i=3: result[3] *= right = 6 * 1 = 6, right *= nums[3] = 1 * 4 = 4   â†’ result = [1, 1, 2, 6]</span><br><span class="line">i=2: result[2] *= right = 2 * 4 = 8, right *= nums[2] = 4 * 3 = 12  â†’ result = [1, 1, 8, 6]</span><br><span class="line">i=1: result[1] *= right = 1 * 12 = 12, right *= nums[1] = 12 * 2 = 24 â†’ result = [1, 12, 8, 6]</span><br><span class="line">i=0: result[0] *= right = 1 * 24 = 24, right *= nums[0] = 24 * 1 = 24 â†’ result = [24, 12, 8, 6]</span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç å®ç°-3">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">productExceptSelf</span><span class="params">(nums []<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¬¬ä¸€éï¼šè®¡ç®—å·¦ä¹˜ç§¯</span></span><br><span class="line">    result[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">        result[i] = result[i<span class="number">-1</span>] * nums[i<span class="number">-1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¬¬äºŒéï¼šä»å³å¾€å·¦è®¡ç®—å³ä¹˜ç§¯å¹¶æ›´æ–°ç»“æœ</span></span><br><span class="line">    right := <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        result[i] *= right</span><br><span class="line">        right *= nums[i]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ-3">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$ - ä¸¤æ¬¡éå†æ•°ç»„</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$ - é™¤äº†ç»“æœæ•°ç»„å¤–ï¼Œåªä½¿ç”¨å¸¸é‡é¢å¤–ç©ºé—´</li>
</ul>
<h2 id="æ–¹æ³•å››ï¼šå¤„ç†é›¶å€¼çš„ç‰¹æ®Šè§£æ³•">æ–¹æ³•å››ï¼šå¤„ç†é›¶å€¼çš„ç‰¹æ®Šè§£æ³•</h2>
<h3 id="å®ç°æ€è·¯-4">å®ç°æ€è·¯</h3>
<p>è€ƒè™‘åˆ°æ•°ç»„ä¸­å¯èƒ½åŒ…å«é›¶å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ol>
<li>ç»Ÿè®¡é›¶çš„ä¸ªæ•°</li>
<li>è®¡ç®—æ‰€æœ‰éé›¶å…ƒç´ çš„ä¹˜ç§¯</li>
<li>æ ¹æ®é›¶çš„ä¸ªæ•°å†³å®šç»“æœ</li>
</ol>
<h3 id="ä»£ç å®ç°-4">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">productExceptSelfWithZeros</span><span class="params">(nums []<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    </span><br><span class="line">    zeroCount := <span class="number">0</span></span><br><span class="line">    product := <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»Ÿè®¡é›¶çš„ä¸ªæ•°å’Œè®¡ç®—éé›¶å…ƒç´ ä¹˜ç§¯</span></span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        <span class="keyword">if</span> num == <span class="number">0</span> &#123;</span><br><span class="line">            zeroCount++</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            product *= num</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> zeroCount &gt; <span class="number">1</span> &#123;</span><br><span class="line">            <span class="comment">// æœ‰å¤šä¸ªé›¶ï¼Œæ‰€æœ‰ä½ç½®ç»“æœéƒ½æ˜¯0</span></span><br><span class="line">            result[i] = <span class="number">0</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> zeroCount == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="comment">// åªæœ‰ä¸€ä¸ªé›¶</span></span><br><span class="line">            <span class="keyword">if</span> nums[i] == <span class="number">0</span> &#123;</span><br><span class="line">                result[i] = product</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result[i] = <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰é›¶ï¼Œä½¿ç”¨é™¤æ³•</span></span><br><span class="line">            result[i] = product / nums[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸ªæ–¹æ³•è¿åäº†é¢˜ç›®&quot;ä¸è¦ä½¿ç”¨é™¤æ³•&quot;çš„è¦æ±‚ï¼Œä»…ä½œä¸ºæ€è·¯æ‰©å±•ã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ–¹æ³•ä¸€ï¼šæš´åŠ›</th>
<th>æ–¹æ³•äºŒï¼šä¸¤æ•°ç»„</th>
<th>æ–¹æ³•ä¸‰ï¼šç©ºé—´ä¼˜åŒ–</th>
<th>æ–¹æ³•å››ï¼šç‰¹æ®Šå¤„ç†</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ—¶é—´å¤æ‚åº¦</strong></td>
<td>$O(n^2)$</td>
<td>$O(n)$</td>
<td>$O(n)$</td>
<td>$O(n)$</td>
</tr>
<tr>
<td><strong>ç©ºé—´å¤æ‚åº¦</strong></td>
<td>$O(1)$</td>
<td>$O(n)$</td>
<td>$O(1)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td><strong>å¯è¯»æ€§</strong></td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
<tr>
<td><strong>æ•ˆç‡</strong></td>
<td>â˜…â˜†â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
<tr>
<td><strong>æ¨èåº¦</strong></td>
<td>â˜…â˜†â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
</tr>
<tr>
<td><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td>å­¦ä¹ ç†è§£</td>
<td>é¢è¯•æ¼”ç¤ºæ€è·¯</td>
<td>æœ€ä¼˜è§£æ³•</td>
<td>è¿åé¢˜ç›®è¦æ±‚</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="æ ¸å¿ƒç®—æ³•æ¦‚å¿µ">æ ¸å¿ƒç®—æ³•æ¦‚å¿µ</h3>
<ol>
<li><strong>å‰ç¼€ç§¯å’Œåç¼€ç§¯</strong>ï¼šå°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºå·¦å³ä¸¤éƒ¨åˆ†çš„ä¹˜ç§¯</li>
<li><strong>ç©ºé—´ä¼˜åŒ–</strong>ï¼šé€šè¿‡é‡å¤åˆ©ç”¨æ•°ç»„ç©ºé—´æ¥å‡å°‘é¢å¤–å†…å­˜ä½¿ç”¨</li>
<li><strong>åŒæŒ‡é’ˆæ€æƒ³</strong>ï¼šä¸€æ¬¡ä»å·¦åˆ°å³ï¼Œä¸€æ¬¡ä»å³åˆ°å·¦çš„éå†æ¨¡å¼</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>è¾¹ç•Œå¤„ç†</strong>ï¼šæ³¨æ„æ•°ç»„é¦–å°¾å…ƒç´ çš„ç‰¹æ®Šå¤„ç†</li>
<li><strong>åˆå§‹å€¼è®¾ç½®</strong>ï¼šä¹˜ç§¯è¿ç®—çš„åˆå§‹å€¼åº”è¯¥æ˜¯ 1ï¼Œä¸æ˜¯ 0</li>
<li><strong>ç†è§£é¢˜æ„</strong>ï¼šé¢˜ç›®è¦æ±‚ä¸ä½¿ç”¨é™¤æ³•ï¼Œè¦é¿å… <code>product / nums[i]</code> çš„æ€è·¯</li>
</ol>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li>LeetCode 152: ä¹˜ç§¯æœ€å¤§å­æ•°ç»„</li>
<li>LeetCode 628: ä¸‰ä¸ªæ•°çš„æœ€å¤§ä¹˜ç§¯</li>
<li>LeetCode 724: å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒç´¢å¼•</li>
</ul>
<p>è¿™é“é¢˜æ˜¯ä¸€ä¸ªç»å…¸çš„å‰ç¼€ç§¯åº”ç”¨ï¼ŒæŒæ¡äº†è¿™ä¸ªæ€è·¯å¯¹è§£å†³ç±»ä¼¼çš„æ•°ç»„ä¹˜ç§¯é—®é¢˜éƒ½å¾ˆæœ‰å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ•°ç»„</tag>
        <tag>å‰ç¼€å’Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL æ‰§è¡Œä¸€æ¡ SELECT è¯­å¥çš„å®Œæ•´è¿‡ç¨‹è¯¦è§£</title>
    <url>/2025/05/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%89%A7%E8%A1%8C%E8%AF%AD%E5%8F%A5%E7%9A%84%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<h1>MySQL æ‰§è¡Œä¸€æ¡ SELECT è¯­å¥çš„å®Œæ•´è¿‡ç¨‹è¯¦è§£</h1>
<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>å½“æˆ‘ä»¬åœ¨ MySQL ä¸­æ‰§è¡Œä¸€æ¡ç®€å•çš„æŸ¥è¯¢è¯­å¥æ—¶ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>çœ‹èµ·æ¥åªæ˜¯ä¸€è¡Œä»£ç ï¼Œä½†åœ¨ MySQL å†…éƒ¨å´ç»å†äº†ä¸€ä¸ªå¤æ‚è€Œç²¾å¯†çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥æ­å¼€è¿™ä¸ª&quot;é»‘ç›’å­&quot;ï¼Œçœ‹çœ‹ MySQL æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥å¤„ç†æˆ‘ä»¬çš„æŸ¥è¯¢è¯·æ±‚çš„ã€‚</p>
<h2 id="MySQL-æ¶æ„æ¦‚è§ˆ">MySQL æ¶æ„æ¦‚è§ˆ</h2>
<p>åœ¨æ·±å…¥äº†è§£æ‰§è¡Œæµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ MySQL çš„æ•´ä½“æ¶æ„ï¼š</p>
<p><img src="/2025/05/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%89%A7%E8%A1%8C%E8%AF%AD%E5%8F%A5%E7%9A%84%E8%BF%87%E7%A8%8B/1748166843430.png" alt="MySQLæ¶æ„å›¾"></p>
<p>MySQL çš„æ¶æ„ä¸»è¦åˆ†ä¸ºä¸¤å±‚ï¼š</p>
<h3 id="Server-å±‚ï¼ˆæœåŠ¡å±‚ï¼‰">Server å±‚ï¼ˆæœåŠ¡å±‚ï¼‰</h3>
<p><strong>ä¸»è¦èŒè´£</strong>ï¼šæ¥æ”¶è¯·æ±‚ã€è§£æ SQLã€åˆ¶å®šæ‰§è¡Œè®¡åˆ’</p>
<ul>
<li><strong>è¿æ¥å™¨</strong>ï¼šè´Ÿè´£å»ºç«‹è¿æ¥ï¼ŒéªŒè¯ç”¨æˆ·èº«ä»½</li>
<li><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šç¼“å­˜æŸ¥è¯¢ç»“æœï¼ˆMySQL 8.0 å·²ç§»é™¤ï¼‰</li>
<li><strong>è§£æå™¨</strong>ï¼šè§£æ SQL è¯­å¥ï¼Œæ£€æŸ¥è¯­æ³•</li>
<li><strong>ä¼˜åŒ–å™¨</strong>ï¼šé€‰æ‹©æœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆ</li>
<li><strong>æ‰§è¡Œå™¨</strong>ï¼šçœŸæ­£æ‰§è¡Œ SQL è¯­å¥</li>
</ul>
<h3 id="å­˜å‚¨å¼•æ“å±‚">å­˜å‚¨å¼•æ“å±‚</h3>
<p><strong>ä¸»è¦èŒè´£</strong>ï¼šè´Ÿè´£æ•°æ®çš„å®é™…å­˜å‚¨å’Œè¯»å–</p>
<ul>
<li>æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼šInnoDBã€MyISAMã€Memory ç­‰</li>
<li>InnoDB æ˜¯å½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“</li>
</ul>
<blockquote>
<p><strong>é¢è¯•é‡ç‚¹</strong>ï¼šè¿™ç§åˆ†å±‚æ¶æ„çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>åˆ†å±‚æ¶æ„ä½¿å¾— MySQL å¯ä»¥æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œä¸åŒçš„åº”ç”¨åœºæ™¯å¯ä»¥é€‰æ‹©æœ€é€‚åˆçš„å­˜å‚¨å¼•æ“ï¼Œè€Œä¸Šå±‚çš„ SQL å¤„ç†é€»è¾‘ä¿æŒä¸å˜ã€‚</p>
</blockquote>
<h2 id="è¯¦ç»†æ‰§è¡Œæµç¨‹">è¯¦ç»†æ‰§è¡Œæµç¨‹</h2>
<h3 id="ç¬¬ä¸€æ­¥ï¼šè¿æ¥å™¨-å»ºç«‹-æ¡¥æ¢">ç¬¬ä¸€æ­¥ï¼šè¿æ¥å™¨ - å»ºç«‹&quot;æ¡¥æ¢&quot;</h3>
<p><strong>ä½œç”¨</strong>ï¼šå»ºç«‹å®¢æˆ·ç«¯ä¸ MySQL æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥</p>
<h4 id="è¿æ¥è¿‡ç¨‹">è¿æ¥è¿‡ç¨‹</h4>
<ol>
<li><strong>TCP ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼šå»ºç«‹ç½‘ç»œè¿æ¥</li>
<li><strong>èº«ä»½éªŒè¯</strong>ï¼šéªŒè¯ç”¨æˆ·åå’Œå¯†ç </li>
<li><strong>æƒé™è·å–</strong>ï¼šè¯»å–ç”¨æˆ·æƒé™å¹¶ç¼“å­˜</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥ MySQL çš„å¸¸ç”¨å‘½ä»¤</span></span><br><span class="line">mysql -h 127.0.0.1 -u root -p</span><br></pre></td></tr></table></figure>
<h4 id="è¿æ¥ç®¡ç†">è¿æ¥ç®¡ç†</h4>
<p><strong>æŸ¥çœ‹å½“å‰è¿æ¥æ•°</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br></pre></td></tr></table></figure>
<p><strong>é‡è¦å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>max_connections</code>ï¼šæœ€å¤§è¿æ¥æ•°ï¼ˆé»˜è®¤ 151ï¼‰</li>
<li><code>wait_timeout</code>ï¼šç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ 8 å°æ—¶ï¼‰</li>
</ul>
<h4 id="é•¿è¿æ¥-vs-çŸ­è¿æ¥">é•¿è¿æ¥ vs çŸ­è¿æ¥</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">çŸ­è¿æ¥ï¼šè¿æ¥ â†’ æ‰§è¡ŒSQL â†’ æ–­å¼€è¿æ¥</span><br><span class="line">é•¿è¿æ¥ï¼šè¿æ¥ â†’ æ‰§è¡ŒSQL â†’ æ‰§è¡ŒSQL â†’ ... â†’ æ–­å¼€è¿æ¥</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>é¢è¯•é‡ç‚¹</strong>ï¼šä¸ºä»€ä¹ˆæ¨èä½¿ç”¨é•¿è¿æ¥ï¼Ÿ</p>
<p>é•¿è¿æ¥å¯ä»¥é¿å…é¢‘ç¹å»ºç«‹å’Œæ–­å¼€è¿æ¥çš„å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€‚ä½†éœ€è¦æ³¨æ„å†…å­˜å ç”¨é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å®šæœŸæ–­å¼€é•¿è¿æ¥æˆ–ä½¿ç”¨ <code>mysql_reset_connection()</code> æ¥é‡Šæ”¾å†…å­˜ã€‚</p>
</blockquote>
<h3 id="ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ç¼“å­˜-å¿«é€Ÿé€šé“">ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ç¼“å­˜ - å¿«é€Ÿé€šé“</h3>
<p><strong>ä½œç”¨</strong>ï¼šå¦‚æœä¹‹å‰æ‰§è¡Œè¿‡å®Œå…¨ç›¸åŒçš„æŸ¥è¯¢ï¼Œç›´æ¥è¿”å›ç¼“å­˜ç»“æœ</p>
<h4 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h4>
<ul>
<li>ä»¥ <code>key-value</code> å½¢å¼å­˜å‚¨åœ¨å†…å­˜ä¸­</li>
<li><code>key</code>ï¼šSQL è¯­å¥çš„å®Œæ•´æ–‡æœ¬</li>
<li><code>value</code>ï¼šæŸ¥è¯¢ç»“æœ</li>
</ul>
<h4 id="ä¸ºä»€ä¹ˆè¢«åºŸå¼ƒï¼Ÿ">ä¸ºä»€ä¹ˆè¢«åºŸå¼ƒï¼Ÿ</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é—®é¢˜ï¼šåªè¦è¡¨æœ‰ä»»ä½•æ›´æ–°ï¼Œæ‰€æœ‰ç›¸å…³çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©º</span><br><span class="line">ç»“æœï¼šå‘½ä¸­ç‡æä½ï¼Œæ€§èƒ½æå‡å¾®ä¹å…¶å¾®</span><br><span class="line">å†³å®šï¼šMySQL 8.0 ç›´æ¥ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>é¢è¯•é‡ç‚¹</strong>ï¼šæŸ¥è¯¢ç¼“å­˜ä¸ºä»€ä¹ˆæ•ˆæœä¸å¥½ï¼Ÿ</p>
<p>å› ä¸ºæŸ¥è¯¢ç¼“å­˜è¦æ±‚ SQL è¯­å¥å®Œå…¨ä¸€è‡´æ‰èƒ½å‘½ä¸­ï¼Œè€Œä¸”ä»»ä½•è¡¨æ›´æ–°éƒ½ä¼šæ¸…ç©ºç›¸å…³ç¼“å­˜ï¼Œåœ¨é«˜å¹¶å‘çš„å†™å¤šè¯»å°‘åœºæ™¯ä¸‹ï¼Œç¼“å­˜å¤±æ•ˆé¢‘ç¹ï¼Œåè€Œå½±å“æ€§èƒ½ã€‚</p>
</blockquote>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šè§£æå™¨-ç†è§£-SQL">ç¬¬ä¸‰æ­¥ï¼šè§£æå™¨ - ç†è§£ SQL</h3>
<p><strong>ä½œç”¨</strong>ï¼šè§£æ SQL è¯­å¥ï¼Œæ„å»ºè¯­æ³•æ ‘</p>
<h4 id="ä¸¤ä¸ªä¸»è¦æ­¥éª¤">ä¸¤ä¸ªä¸»è¦æ­¥éª¤</h4>
<p><strong>1. è¯æ³•åˆ†æ</strong></p>
<ul>
<li>è¯†åˆ« SQL ä¸­çš„å…³é”®å­—ï¼š<code>SELECT</code>ã€<code>FROM</code>ã€<code>WHERE</code> ç­‰</li>
<li>æå–è¡¨åã€å­—æ®µåã€æ¡ä»¶ç­‰ä¿¡æ¯</li>
</ul>
<p><strong>2. è¯­æ³•åˆ†æ</strong></p>
<ul>
<li>æ£€æŸ¥ SQL è¯­æ³•æ˜¯å¦æ­£ç¡®</li>
<li>æ„å»ºè¯­æ³•æ ‘ï¼Œä¾¿äºåç»­å¤„ç†</li>
</ul>
<p><img src="/2025/05/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%89%A7%E8%A1%8C%E8%AF%AD%E5%8F%A5%E7%9A%84%E8%BF%87%E7%A8%8B/1748166913401.png" alt="è¯­æ³•æ ‘ç¤ºä¾‹"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¯­æ³•é”™è¯¯ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> FORM product <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- é”™è¯¯ï¼šFORM åº”è¯¥æ˜¯ FROM</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šè§£æå™¨åªæ£€æŸ¥è¯­æ³•ï¼Œä¸æ£€æŸ¥è¡¨æˆ–å­—æ®µæ˜¯å¦å­˜åœ¨</p>
</blockquote>
<h3 id="ç¬¬å››æ­¥ï¼šé¢„å¤„ç†å™¨-éªŒè¯æœ‰æ•ˆæ€§">ç¬¬å››æ­¥ï¼šé¢„å¤„ç†å™¨ - éªŒè¯æœ‰æ•ˆæ€§</h3>
<p><strong>ä½œç”¨</strong>ï¼šæ£€æŸ¥ SQL è¯­å¥ä¸­å¼•ç”¨çš„è¡¨å’Œå­—æ®µæ˜¯å¦å­˜åœ¨</p>
<h4 id="ä¸»è¦å·¥ä½œ">ä¸»è¦å·¥ä½œ</h4>
<ol>
<li><strong>æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨</strong></li>
<li><strong>æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨</strong></li>
<li><strong>å±•å¼€ <code>SELECT *</code></strong>ï¼šå°† <code>*</code> æ›¿æ¢ä¸ºå…·ä½“çš„å­—æ®µåˆ—è¡¨</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¦‚æœ test è¡¨ä¸å­˜åœ¨ï¼Œä¼šåœ¨è¿™ä¸ªé˜¶æ®µæŠ¥é”™</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test;</span><br><span class="line"><span class="comment">-- ERROR 1146 (42S02): Table &#x27;database.test&#x27; doesn&#x27;t exist</span></span><br></pre></td></tr></table></figure>
<h3 id="ç¬¬äº”æ­¥ï¼šä¼˜åŒ–å™¨-åˆ¶å®šæœ€ä½³æ–¹æ¡ˆ">ç¬¬äº”æ­¥ï¼šä¼˜åŒ–å™¨ - åˆ¶å®šæœ€ä½³æ–¹æ¡ˆ</h3>
<p><strong>ä½œç”¨</strong>ï¼šä¸º SQL æŸ¥è¯¢é€‰æ‹©æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’</p>
<h4 id="ä¼˜åŒ–å™¨çš„å·¥ä½œ">ä¼˜åŒ–å™¨çš„å·¥ä½œ</h4>
<p><strong>é€‰æ‹©ç´¢å¼•</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¦‚æœ product è¡¨æœ‰å¤šä¸ªç´¢å¼•ï¼Œä¼˜åŒ–å™¨ä¼šé€‰æ‹©æˆæœ¬æœ€ä½çš„</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">100</span> <span class="keyword">AND</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;iPhone%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h4 id="æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹">æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹</h4>
<table>
<thead>
<tr>
<th>id</th>
<th>select_type</th>
<th>table</th>
<th>type</th>
<th>key</th>
<th>rows</th>
<th>Extra</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>SIMPLE</td>
<td>product</td>
<td>const</td>
<td>PRIMARY</td>
<td>1</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><strong>type</strong>ï¼šè®¿é—®ç±»å‹ï¼ˆconst &gt; eq_ref &gt; ref &gt; range &gt; ALLï¼‰</li>
<li><strong>key</strong>ï¼šä½¿ç”¨çš„ç´¢å¼•</li>
<li><strong>rows</strong>ï¼šé¢„è®¡æ‰«æçš„è¡Œæ•°</li>
</ul>
<blockquote>
<p><strong>é¢è¯•é‡ç‚¹</strong>ï¼šä¼˜åŒ–å™¨å¦‚ä½•é€‰æ‹©ç´¢å¼•ï¼Ÿ</p>
<p>ä¼˜åŒ–å™¨åŸºäºæˆæœ¬æ¨¡å‹ï¼ˆCost-Based Optimizerï¼‰ï¼Œä¼šè®¡ç®—ä¸åŒæ‰§è¡Œè®¡åˆ’çš„æˆæœ¬ï¼ŒåŒ…æ‹¬ I/O æˆæœ¬ã€CPU æˆæœ¬ç­‰ï¼Œé€‰æ‹©æ€»æˆæœ¬æœ€ä½çš„æ‰§è¡Œè®¡åˆ’ã€‚</p>
</blockquote>
<h3 id="ç¬¬å…­æ­¥ï¼šæ‰§è¡Œå™¨-çœŸæ­£å¹²æ´»">ç¬¬å…­æ­¥ï¼šæ‰§è¡Œå™¨ - çœŸæ­£å¹²æ´»</h3>
<p><strong>ä½œç”¨</strong>ï¼šæ ¹æ®æ‰§è¡Œè®¡åˆ’ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£è·å–æ•°æ®</p>
<h4 id="ä¸‰ç§å…¸å‹çš„æ‰§è¡Œåœºæ™¯">ä¸‰ç§å…¸å‹çš„æ‰§è¡Œåœºæ™¯</h4>
<h4 id="1-ä¸»é”®ç´¢å¼•æŸ¥è¯¢">1. ä¸»é”®ç´¢å¼•æŸ¥è¯¢</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨å­˜å‚¨å¼•æ“çš„ç´¢å¼•æŸ¥è¯¢æ¥å£</li>
<li>å­˜å‚¨å¼•æ“é€šè¿‡ B+ æ ‘å¿«é€Ÿå®šä½è®°å½•</li>
<li>è¿”å›å®Œæ•´è®°å½•ç»™æ‰§è¡Œå™¨</li>
<li>æ‰§è¡Œå™¨éªŒè¯æ¡ä»¶å¹¶è¿”å›ç»“æœ</li>
</ol>
<h4 id="2-å…¨è¡¨æ‰«æ">2. å…¨è¡¨æ‰«æ</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;iPhone&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<ol>
<li>ä»è¡¨çš„ç¬¬ä¸€æ¡è®°å½•å¼€å§‹è¯»å–</li>
<li>é€æ¡æ£€æŸ¥ <code>name</code> å­—æ®µæ˜¯å¦ç­‰äº â€˜iPhoneâ€™</li>
<li>ç¬¦åˆæ¡ä»¶çš„è®°å½•è¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>ç»§ç»­è¯»å–ä¸‹ä¸€æ¡è®°å½•ï¼Œç›´åˆ°è¡¨ç»“æŸ</li>
</ol>
<h4 id="3-ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–">3. ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–</h4>
<p><strong>ä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æ¨ï¼Ÿ</strong><br>
å°†åŸæœ¬åœ¨ Server å±‚è¿›è¡Œçš„æ¡ä»¶åˆ¤æ–­ï¼Œ&quot;ä¸‹æ¨&quot;åˆ°å­˜å‚¨å¼•æ“å±‚æ‰§è¡Œã€‚</p>
<p><strong>ä¸¾ä¾‹è¯´æ˜</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾åœ¨ (age, reward) å­—æ®µä¸Šæœ‰è”åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">20</span> <span class="keyword">AND</span> reward <span class="operator">=</span> <span class="number">100000</span>;</span><br></pre></td></tr></table></figure>
<p><strong>ä¼ ç»Ÿæ–¹å¼</strong>ï¼š</p>
<ol>
<li>å­˜å‚¨å¼•æ“è¿”å›æ‰€æœ‰ <code>age &gt; 20</code> çš„è®°å½•</li>
<li>Server å±‚å†è¿‡æ»¤ <code>reward = 100000</code></li>
</ol>
<p><strong>ç´¢å¼•ä¸‹æ¨æ–¹å¼</strong>ï¼š</p>
<ol>
<li>å­˜å‚¨å¼•æ“ç›´æ¥è¿‡æ»¤ <code>age &gt; 20 AND reward = 100000</code></li>
<li>åªè¿”å›å®Œå…¨ç¬¦åˆæ¡ä»¶çš„è®°å½•</li>
</ol>
<p><strong>ä¼˜åŠ¿</strong>ï¼šå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">20</span> <span class="keyword">AND</span> reward <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line"><span class="comment">-- Extra åˆ—æ˜¾ç¤º &quot;Using index condition&quot; è¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨</span></span><br></pre></td></tr></table></figure>
<h2 id="å®Œæ•´æµç¨‹æ€»ç»“">å®Œæ•´æµç¨‹æ€»ç»“</h2>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„å›¾è¡¨æ¥æ€»ç»“æ•´ä¸ªæ‰§è¡Œæµç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®¢æˆ·ç«¯è¯·æ±‚</span><br><span class="line">    â†“</span><br><span class="line">è¿æ¥å™¨ï¼ˆå»ºç«‹è¿æ¥ï¼ŒéªŒè¯èº«ä»½ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">æŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL 8.0 å·²ç§»é™¤ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">è§£æå™¨ï¼ˆè¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æï¼‰</span><br><span class="line">    â†“</span><br><span class="line">é¢„å¤„ç†å™¨ï¼ˆæ£€æŸ¥è¡¨å’Œå­—æ®µï¼‰</span><br><span class="line">    â†“</span><br><span class="line">ä¼˜åŒ–å™¨ï¼ˆé€‰æ‹©æ‰§è¡Œè®¡åˆ’ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">æ‰§è¡Œå™¨ï¼ˆè°ƒç”¨å­˜å‚¨å¼•æ“ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">å­˜å‚¨å¼•æ“ï¼ˆè¿”å›æ•°æ®ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">è¿”å›ç»“æœç»™å®¢æˆ·ç«¯</span><br></pre></td></tr></table></figure>
<h2 id="å¸¸è§é¢è¯•é¢˜">å¸¸è§é¢è¯•é¢˜</h2>
<h3 id="Q1ï¼šMySQL-çš„ä¸¤å±‚æ¶æ„æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ">Q1ï¼šMySQL çš„ä¸¤å±‚æ¶æ„æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ul>
<li><strong>è§£è€¦</strong>ï¼šSQL å¤„ç†é€»è¾‘ä¸æ•°æ®å­˜å‚¨åˆ†ç¦»</li>
<li><strong>çµæ´»æ€§</strong>ï¼šå¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸åŒçš„å­˜å‚¨å¼•æ“</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ˜“äºæ·»åŠ æ–°çš„å­˜å‚¨å¼•æ“æˆ–ä¼˜åŒ–ç°æœ‰åŠŸèƒ½</li>
</ul>
<h3 id="Q2ï¼šä¸ºä»€ä¹ˆ-MySQL-8-0-ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜ï¼Ÿ">Q2ï¼šä¸ºä»€ä¹ˆ MySQL 8.0 ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜ï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ul>
<li><strong>å‘½ä¸­ç‡ä½</strong>ï¼šéœ€è¦ SQL å®Œå…¨ä¸€è‡´æ‰èƒ½å‘½ä¸­</li>
<li><strong>ç»´æŠ¤æˆæœ¬é«˜</strong>ï¼šä»»ä½•å†™æ“ä½œéƒ½ä¼šå¯¼è‡´ç›¸å…³ç¼“å­˜å¤±æ•ˆ</li>
<li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œç¼“å­˜çš„ç»´æŠ¤åè€Œæˆä¸ºç“¶é¢ˆ</li>
</ul>
<h3 id="Q3ï¼šè§£æå™¨å’Œé¢„å¤„ç†å™¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">Q3ï¼šè§£æå™¨å’Œé¢„å¤„ç†å™¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ul>
<li><strong>è§£æå™¨</strong>ï¼šåªè´Ÿè´£è¯­æ³•æ£€æŸ¥å’Œæ„å»ºè¯­æ³•æ ‘</li>
<li><strong>é¢„å¤„ç†å™¨</strong>ï¼šæ£€æŸ¥è¡¨å’Œå­—æ®µçš„å­˜åœ¨æ€§ï¼Œè¿›è¡Œè¯­ä¹‰éªŒè¯</li>
</ul>
<h3 id="Q4ï¼šç´¢å¼•ä¸‹æ¨çš„åŸç†å’Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ">Q4ï¼šç´¢å¼•ä¸‹æ¨çš„åŸç†å’Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ul>
<li><strong>åŸç†</strong>ï¼šå°†éƒ¨åˆ†æ¡ä»¶åˆ¤æ–­ä» Server å±‚ä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚</li>
<li><strong>ä½œç”¨</strong>ï¼šå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè”åˆç´¢å¼•ä¸­éƒ¨åˆ†å­—æ®µæ— æ³•ä½¿ç”¨ç´¢å¼•ä½†åŒ…å«åœ¨ç´¢å¼•ä¸­çš„æƒ…å†µ</li>
</ul>
<h2 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2>
<h3 id="1-è¿æ¥ä¼˜åŒ–">1. è¿æ¥ä¼˜åŒ–</h3>
<ul>
<li>ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥</li>
<li>åˆç†è®¾ç½® <code>max_connections</code> å’Œ <code>wait_timeout</code></li>
<li>é¿å…åˆ›å»ºè¿‡å¤šçš„æ— ç”¨è¿æ¥</li>
</ul>
<h3 id="2-SQL-ä¼˜åŒ–">2. SQL ä¼˜åŒ–</h3>
<ul>
<li>é¿å…ä½¿ç”¨ <code>SELECT *</code>ï¼Œæ˜ç¡®æŒ‡å®šéœ€è¦çš„å­—æ®µ</li>
<li>åˆç†ä½¿ç”¨ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ</li>
<li>åˆ©ç”¨ <code>EXPLAIN</code> åˆ†ææ‰§è¡Œè®¡åˆ’</li>
</ul>
<h3 id="3-ç´¢å¼•ä¼˜åŒ–">3. ç´¢å¼•ä¼˜åŒ–</h3>
<ul>
<li>ä¸ºç»å¸¸æŸ¥è¯¢çš„å­—æ®µåˆ›å»ºç´¢å¼•</li>
<li>é¿å…åœ¨å°è¡¨ä¸Šåˆ›å»ºè¿‡å¤šç´¢å¼•</li>
<li>åˆ©ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨æ“ä½œ</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ·±å…¥äº†è§£äº† MySQL æ‰§è¡Œä¸€æ¡ SELECT è¯­å¥çš„å®Œæ•´è¿‡ç¨‹ï¼š</p>
<ol>
<li><strong>è¿æ¥å™¨</strong>ï¼šå»ºç«‹è¿æ¥ï¼ŒéªŒè¯èº«ä»½</li>
<li><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šå¿«é€Ÿè¿”å›ç¼“å­˜ç»“æœï¼ˆå·²åºŸå¼ƒï¼‰</li>
<li><strong>è§£æå™¨</strong>ï¼šè§£æ SQLï¼Œæ„å»ºè¯­æ³•æ ‘</li>
<li><strong>é¢„å¤„ç†å™¨</strong>ï¼šéªŒè¯è¡¨å’Œå­—æ®µçš„æœ‰æ•ˆæ€§</li>
<li><strong>ä¼˜åŒ–å™¨</strong>ï¼šåˆ¶å®šæœ€ä¼˜æ‰§è¡Œè®¡åˆ’</li>
<li><strong>æ‰§è¡Œå™¨</strong>ï¼šè°ƒç”¨å­˜å‚¨å¼•æ“è·å–æ•°æ®</li>
</ol>
<p>ç†è§£è¿™ä¸ªè¿‡ç¨‹ä¸ä»…æœ‰åŠ©äºæˆ‘ä»¬å†™å‡ºæ›´é«˜æ•ˆçš„ SQLï¼Œä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬åœ¨é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨ã€‚åœ¨é¢è¯•ä¸­ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªç»å¸¸è¢«é—®åˆ°çš„æ ¸å¿ƒé—®é¢˜ã€‚</p>
<blockquote>
<p><strong>è®°ä½</strong>ï¼šæ¯ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„æŸ¥è¯¢èƒŒåï¼Œéƒ½æœ‰ä¸€å¥—ç²¾å¯†çš„æœºåˆ¶åœ¨ä¿è¯å…¶æ­£ç¡®å’Œé«˜æ•ˆçš„æ‰§è¡Œã€‚</p>
</blockquote>
<hr>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ul>
<li>ã€ŠMySQL 45 è®²ã€‹</li>
<li>ã€ŠMySQL æ˜¯æ€æ ·è¿è¡Œçš„ï¼šä»æ ¹å„¿ä¸Šç†è§£ MySQLã€‹</li>
<li>MySQL å®˜æ–¹æ–‡æ¡£</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>å­˜å‚¨åŸç†</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>SQLæ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 380 - O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ </title>
    <url>/2025/05/25/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-380-O1%E6%97%B6%E9%97%B4%E6%8F%92%E5%85%A5%E5%88%A0%E9%99%A4%E5%92%8C%E8%8E%B7%E5%8F%96%E9%9A%8F%E6%9C%BA%E5%85%83%E7%B4%A0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>è®¾è®¡ä¸€ä¸ªæ”¯æŒåœ¨<strong>å¹³å‡</strong>æ—¶é—´å¤æ‚åº¦ <strong>O(1)</strong> ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œçš„æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li><code>insert(val)</code>ï¼šå½“å…ƒç´  val ä¸å­˜åœ¨æ—¶è¿”å› trueï¼Œå¹¶å‘é›†åˆä¸­æ’å…¥è¯¥é¡¹ï¼Œå¦åˆ™è¿”å› false</li>
<li><code>remove(val)</code>ï¼šå½“å…ƒç´  val å­˜åœ¨æ—¶è¿”å› trueï¼Œå¹¶ä»é›†åˆä¸­ç§»é™¤è¯¥é¡¹ï¼Œå¦åˆ™è¿”å› false</li>
<li><code>getRandom()</code>ï¼šéšæœºè¿”å›ç°æœ‰é›†åˆä¸­çš„ä¸€é¡¹ã€‚æ¯ä¸ªå…ƒç´ åº”è¯¥æœ‰<strong>ç›¸åŒçš„æ¦‚ç‡</strong>è¢«è¿”å›</li>
</ul>
<p>ä½ å¿…é¡»å®ç°ç±»çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶æ»¡è¶³æ¯ä¸ªå‡½æ•°çš„<strong>å¹³å‡</strong>æ—¶é—´å¤æ‚åº¦ä¸º <strong>O(1)</strong>ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥</span><br><span class="line">[&quot;RandomizedSet&quot;, &quot;insert&quot;, &quot;remove&quot;, &quot;insert&quot;, &quot;getRandom&quot;, &quot;remove&quot;, &quot;insert&quot;, &quot;getRandom&quot;]</span><br><span class="line">[[], [1], [2], [2], [], [1], [2], []]</span><br><span class="line">è¾“å‡º</span><br><span class="line">[null, true, false, true, 2, true, false, 2]</span><br><span class="line"></span><br><span class="line">è§£é‡Š</span><br><span class="line">RandomizedSet randomizedSet = new RandomizedSet();</span><br><span class="line">randomizedSet.insert(1); // å‘é›†åˆä¸­æ’å…¥ 1 ã€‚è¿”å› true è¡¨ç¤º 1 è¢«æˆåŠŸåœ°æ’å…¥ã€‚</span><br><span class="line">randomizedSet.remove(2); // è¿”å› false ï¼Œè¡¨ç¤ºé›†åˆä¸­ä¸å­˜åœ¨ 2 ã€‚</span><br><span class="line">randomizedSet.insert(2); // å‘é›†åˆä¸­æ’å…¥ 2 ã€‚è¿”å› true ã€‚é›†åˆç°åœ¨åŒ…å« [1,2] ã€‚</span><br><span class="line">randomizedSet.getRandom(); // getRandom åº”éšæœºè¿”å› 1 æˆ– 2 ã€‚</span><br><span class="line">randomizedSet.remove(1); // ä»é›†åˆä¸­ç§»é™¤ 1 ï¼Œè¿”å› true ã€‚é›†åˆç°åœ¨åŒ…å« [2] ã€‚</span><br><span class="line">randomizedSet.insert(2); // 2 å·²åœ¨é›†åˆä¸­ï¼Œæ‰€ä»¥è¿”å› false ã€‚</span><br><span class="line">randomizedSet.getRandom(); // ç”±äº 2 æ˜¯é›†åˆä¸­å”¯ä¸€çš„æ•°å­—ï¼ŒgetRandom æ€»æ˜¯è¿”å› 2 ã€‚</span><br></pre></td></tr></table></figure>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘çš„åˆå§‹è§£æ³•é‡‡ç”¨äº†å“ˆå¸Œè¡¨ + æ•°ç»„ + begin æŒ‡é’ˆçš„è®¾è®¡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> RandomizedSet <span class="keyword">struct</span> &#123;</span><br><span class="line">    hashTable <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span></span><br><span class="line">    nums      []<span class="type">int</span></span><br><span class="line">    begin     <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *RandomizedSet)</span></span> Remove(val <span class="type">int</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> index, ok := this.hashTable[val]; ok &#123;</span><br><span class="line">        beginVal := this.nums[this.begin]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šåªæ›´æ–°äº†ç´¢å¼•ï¼Œæ²¡æœ‰äº¤æ¢å®é™…å…ƒç´ ä½ç½®</span></span><br><span class="line">        this.hashTable[beginVal] = index</span><br><span class="line"></span><br><span class="line">        this.begin++</span><br><span class="line">        <span class="built_in">delete</span>(this.hashTable, val)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>è¿™ä¸ªè§£æ³•åœ¨ Remove æ–¹æ³•ä¸­çŠ¯äº†ä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼š<strong>åªæ›´æ–°äº†å“ˆå¸Œè¡¨çš„ç´¢å¼•æ˜ å°„ï¼Œä½†æ²¡æœ‰å®é™…äº¤æ¢æ•°ç»„ä¸­çš„å…ƒç´ ä½ç½®</strong>ï¼Œå¯¼è‡´ç´¢å¼•ä¸å®é™…ä½ç½®ä¸ä¸€è‡´ã€‚</p>
<p>è®©æˆ‘ç”¨å…·ä½“ä¾‹å­è¯´æ˜é—®é¢˜ï¼š</p>
<p><strong>åˆå§‹çŠ¶æ€ï¼š</strong></p>
<ul>
<li><code>nums = [1, 2, 3, 4]</code></li>
<li><code>hashTable = &#123;1: 0, 2: 1, 3: 2, 4: 3&#125;</code></li>
<li><code>begin = 0</code></li>
</ul>
<p><strong>åˆ é™¤å…ƒç´  3 æ—¶ï¼š</strong></p>
<ol>
<li><code>index = 2</code>ï¼ˆå…ƒç´  3 çš„ä½ç½®ï¼‰</li>
<li><code>beginVal = nums[0] = 1</code></li>
<li><code>hashTable[1] = 2</code> âŒï¼ˆå°†å…ƒç´  1 çš„ç´¢å¼•æ”¹ä¸º 2ï¼‰</li>
<li><code>begin = 1</code></li>
<li>åˆ é™¤ <code>hashTable[3]</code></li>
</ol>
<p><strong>é”™è¯¯ç»“æœï¼š</strong></p>
<ul>
<li><code>nums = [1, 2, 3, 4]</code>ï¼ˆæ•°ç»„æ²¡å˜ï¼ï¼‰</li>
<li><code>hashTable = &#123;1: 2, 2: 1, 4: 3&#125;</code>ï¼ˆå…ƒç´  1 çš„ç´¢å¼•å˜æˆäº† 2ï¼‰</li>
<li><code>begin = 1</code></li>
</ul>
<p>ç°åœ¨å“ˆå¸Œè¡¨è¯´å…ƒç´  1 åœ¨ç´¢å¼• 2ï¼Œä½†å®é™…ä¸Šå…ƒç´  1 è¿˜åœ¨ç´¢å¼• 0ï¼Œè€Œç´¢å¼• 2 ä½ç½®æ˜¯å…ƒç´  3ï¼è¿™å¯¼è‡´äº†<strong>æ•°æ®ç»“æ„å†…éƒ¨çŠ¶æ€ä¸ä¸€è‡´</strong>çš„ä¸¥é‡é—®é¢˜ã€‚</p>
<h2 id="æ­£ç¡®è§£æ³•">æ­£ç¡®è§£æ³•</h2>
<p>è¦å®ç° O(1) çš„æ’å…¥ã€åˆ é™¤å’Œéšæœºè·å–ï¼Œéœ€è¦ç»“åˆ<strong>å“ˆå¸Œè¡¨</strong>å’Œ<strong>åŠ¨æ€æ•°ç»„</strong>ï¼š</p>
<ul>
<li><strong>å“ˆå¸Œè¡¨</strong>ï¼šæä¾› O(1) çš„æŸ¥æ‰¾èƒ½åŠ›</li>
<li><strong>åŠ¨æ€æ•°ç»„</strong>ï¼šæä¾› O(1) çš„éšæœºè®¿é—®èƒ½åŠ›</li>
</ul>
<p>å…³é”®æ˜¯åœ¨åˆ é™¤å…ƒç´ æ—¶ï¼Œé‡‡ç”¨<strong>äº¤æ¢åˆ°æœ«å°¾å†åˆ é™¤</strong>çš„ç­–ç•¥ï¼Œé¿å…æ•°ç»„å…ƒç´ çš„ç§»åŠ¨ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šä¸æœ€åå…ƒç´ äº¤æ¢ï¼ˆæ¨èï¼‰">æ–¹æ³•ä¸€ï¼šä¸æœ€åå…ƒç´ äº¤æ¢ï¼ˆæ¨èï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> RandomizedSet <span class="keyword">struct</span> &#123;</span><br><span class="line">    hashTable <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>  <span class="comment">// val -&gt; index</span></span><br><span class="line">    nums      []<span class="type">int</span>        <span class="comment">// å­˜å‚¨å®é™…å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span></span> RandomizedSet &#123;</span><br><span class="line">    <span class="keyword">return</span> RandomizedSet&#123;</span><br><span class="line">        hashTable: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>),</span><br><span class="line">        nums:      <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *RandomizedSet)</span></span> Insert(val <span class="type">int</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> _, ok := this.hashTable[val]; ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>  <span class="comment">// å·²å­˜åœ¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ åˆ°æ•°ç»„æœ«å°¾</span></span><br><span class="line">    this.hashTable[val] = <span class="built_in">len</span>(this.nums)</span><br><span class="line">    this.nums = <span class="built_in">append</span>(this.nums, val)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *RandomizedSet)</span></span> Remove(val <span class="type">int</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> index, ok := this.hashTable[val]; !ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>  <span class="comment">// ä¸å­˜åœ¨</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lastIndex := <span class="built_in">len</span>(this.nums) - <span class="number">1</span></span><br><span class="line">        lastVal := this.nums[lastIndex]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æœ€åä¸€ä¸ªå…ƒç´ ç§»åˆ°è¦åˆ é™¤çš„ä½ç½®</span></span><br><span class="line">        this.nums[index] = lastVal</span><br><span class="line">        this.hashTable[lastVal] = index</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        this.nums = this.nums[:lastIndex]</span><br><span class="line">        <span class="built_in">delete</span>(this.hashTable, val)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *RandomizedSet)</span></span> GetRandom() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.nums[rand.Intn(<span class="built_in">len</span>(this.nums))]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨-begin-æŒ‡é’ˆçš„æ­£ç¡®å®ç°">æ–¹æ³•äºŒï¼šä½¿ç”¨ begin æŒ‡é’ˆçš„æ­£ç¡®å®ç°</h3>
<p>å¦‚æœåšæŒä½¿ç”¨ begin æŒ‡é’ˆçš„è®¾è®¡ï¼Œéœ€è¦<strong>å®é™…äº¤æ¢å…ƒç´ ä½ç½®</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *RandomizedSet)</span></span> Remove(val <span class="type">int</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> index, ok := this.hashTable[val]; ok &#123;</span><br><span class="line">        beginVal := this.nums[this.begin]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âœ… å®é™…äº¤æ¢æ•°ç»„ä¸­çš„å…ƒç´ ä½ç½®</span></span><br><span class="line">        this.nums[index] = beginVal</span><br><span class="line">        this.nums[this.begin] = val</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âœ… æ›´æ–°å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•</span></span><br><span class="line">        this.hashTable[beginVal] = index</span><br><span class="line"></span><br><span class="line">        this.begin++</span><br><span class="line">        <span class="built_in">delete</span>(this.hashTable, val)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *RandomizedSet)</span></span> GetRandom() <span class="type">int</span> &#123;</span><br><span class="line">    validLength := <span class="built_in">len</span>(this.nums) - this.begin</span><br><span class="line">    randomIndex := rand.Intn(validLength) + this.begin</span><br><span class="line">    <span class="keyword">return</span> this.nums[randomIndex]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç®—æ³•æ ¸å¿ƒæ€æƒ³">ç®—æ³•æ ¸å¿ƒæ€æƒ³</h2>
<ol>
<li><strong>å“ˆå¸Œè¡¨å­˜å‚¨å€¼åˆ°ç´¢å¼•çš„æ˜ å°„</strong>ï¼šå®ç° O(1) æŸ¥æ‰¾</li>
<li><strong>æ•°ç»„å­˜å‚¨å®é™…å€¼</strong>ï¼šå®ç° O(1) éšæœºè®¿é—®</li>
<li><strong>åˆ é™¤æ—¶ä¸æœ«å°¾å…ƒç´ äº¤æ¢</strong>ï¼šé¿å…æ•°ç»„å…ƒç´ ç§»åŠ¨ï¼Œä¿æŒ O(1) å¤æ‚åº¦</li>
</ol>
<p>åˆ é™¤æ“ä½œçš„å…³é”®æ­¥éª¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ é™¤å…ƒç´  Xï¼š</span><br><span class="line">1. æ‰¾åˆ° X åœ¨æ•°ç»„ä¸­çš„ä½ç½® index</span><br><span class="line">2. å°†æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´  Y ç§»åŠ¨åˆ° index ä½ç½®</span><br><span class="line">3. æ›´æ–° Y åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä¸º index</span><br><span class="line">4. åˆ é™¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ </span><br><span class="line">5. ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ X</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šæ‰€æœ‰æ“ä½œå‡ä¸º $O(1)$</p>
<ul>
<li>Insertï¼šå“ˆå¸Œè¡¨æ’å…¥ + æ•°ç»„è¿½åŠ  = $O(1)$</li>
<li>Removeï¼šå“ˆå¸Œè¡¨æŸ¥æ‰¾ + å…ƒç´ äº¤æ¢ + å“ˆå¸Œè¡¨åˆ é™¤ = $O(1)$</li>
<li>GetRandomï¼šéšæœºæ•°ç”Ÿæˆ + æ•°ç»„è®¿é—® = $O(1)$</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ’å…¥çš„å…ƒç´ ä¸ªæ•°</p>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>æ•°æ®ç»“æ„ä¸€è‡´æ€§</strong>ï¼šå½“ä½ æ›´æ–°ç´¢å¼•æ˜ å°„æ—¶ï¼Œå¿…é¡»åŒæ—¶æ›´æ–°å®é™…çš„æ•°æ®å­˜å‚¨</li>
<li><strong>åˆ é™¤ç­–ç•¥</strong>ï¼šåœ¨éœ€è¦ä¿æŒ O(1) å¤æ‚åº¦çš„åœºæ™¯ä¸‹ï¼Œ&quot;äº¤æ¢åˆ°æœ«å°¾å†åˆ é™¤&quot;æ˜¯å¸¸ç”¨æŠ€å·§</li>
<li><strong>ç»„åˆæ•°æ®ç»“æ„</strong>ï¼šå“ˆå¸Œè¡¨ + æ•°ç»„çš„ç»„åˆå¯ä»¥åŒæ—¶è·å¾—å¿«é€ŸæŸ¥æ‰¾å’Œéšæœºè®¿é—®çš„èƒ½åŠ›</li>
<li><strong>è¾¹ç•Œæƒ…å†µ</strong>ï¼šç‰¹åˆ«æ³¨æ„åˆ é™¤æ“ä½œä¸­çš„ç´¢å¼•æ›´æ–°é€»è¾‘</li>
</ol>
<p>è¿™é“é¢˜å¾ˆå¥½åœ°å±•ç¤ºäº†å¦‚ä½•é€šè¿‡å·§å¦™çš„æ•°æ®ç»“æ„è®¾è®¡æ¥æ»¡è¶³å¤æ‚çš„æ€§èƒ½è¦æ±‚ï¼Œåˆ é™¤æ“ä½œçš„å®ç°æ˜¯å…³é”®éš¾ç‚¹ã€‚</p>
<h2 id="ç›¸å…³é¢˜ç›®">ç›¸å…³é¢˜ç›®</h2>
<ul>
<li><a href="mdc:hexo-blog/2025/05/25/LeetCode-381-Insert-Delete-GetRandom-O1-Duplicates-allowed">LeetCode 381 - O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤</a></li>
<li><a href="mdc:hexo-blog/source/_posts/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-146-LRU-Cache.md">LeetCode 146 - LRU ç¼“å­˜</a></li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>æ•°ç»„</tag>
        <tag>æ•°æ®ç»“æ„è®¾è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 274 - HæŒ‡æ•°ï¼ˆH-Indexï¼‰</title>
    <url>/2025/05/25/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-274-H%E6%8C%87%E6%95%B0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>citations</code>ï¼Œå…¶ä¸­ <code>citations[i]</code> è¡¨ç¤ºç ”ç©¶è€…ç¬¬ <code>i</code> ç¯‡è®ºæ–‡è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚è®¡ç®—å¹¶è¿”å›è¯¥ç ”ç©¶è€…çš„ <code>h</code> æŒ‡æ•°ã€‚</p>
<p><strong>H æŒ‡æ•°çš„å®šä¹‰</strong>ï¼šh ä»£è¡¨&quot;é«˜å¼•ç”¨æ¬¡æ•°&quot;ï¼ˆhigh citationsï¼‰ï¼Œä¸€åç§‘ç ”äººå‘˜çš„ h æŒ‡æ•°æ˜¯æŒ‡ä»–ï¼ˆå¥¹ï¼‰çš„ï¼ˆ<code>n</code> ç¯‡è®ºæ–‡ä¸­ï¼‰<strong>æ€»å…±</strong>æœ‰ <code>h</code> ç¯‡è®ºæ–‡åˆ†åˆ«è¢«å¼•ç”¨äº†<strong>è‡³å°‘</strong> <code>h</code> æ¬¡ã€‚ä¸”å…¶ä½™çš„ <code>n - h</code> ç¯‡è®ºæ–‡æ¯ç¯‡è¢«å¼•ç”¨æ¬¡æ•° <strong>ä¸è¶…è¿‡</strong> <code>h</code> æ¬¡ã€‚</p>
<p>å¦‚æœ <code>h</code> æœ‰å¤šç§å¯èƒ½çš„å€¼ï¼Œ<strong>h æŒ‡æ•°</strong> æ˜¯å…¶ä¸­çš„ <strong>æœ€å¤§å€¼</strong>ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šcitations = [3,0,6,1,5]</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼šç»™å®šæ•°ç»„è¡¨ç¤ºç ”ç©¶è€…æ€»å…±æœ‰ 5 ç¯‡è®ºæ–‡ï¼Œæ¯ç¯‡è®ºæ–‡ç›¸åº”çš„è¢«å¼•ç”¨äº† 3, 0, 6, 1, 5 æ¬¡ã€‚</span><br><span class="line">     ç”±äºç ”ç©¶è€…æœ‰ 3 ç¯‡è®ºæ–‡æ¯ç¯‡ è‡³å°‘ è¢«å¼•ç”¨äº† 3 æ¬¡ï¼Œå…¶ä½™ 2 ç¯‡è®ºæ–‡æ¯ç¯‡è¢«å¼•ç”¨ ä¸å¤šäº 3 æ¬¡ï¼Œæ‰€ä»¥å¥¹çš„ h æŒ‡æ•°æ˜¯ 3ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šcitations = [1,3,1]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>n == citations.length</code></li>
<li><code>1 &lt;= n &lt;= 5000</code></li>
<li><code>0 &lt;= citations[i] &lt;= 1000</code></li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘æœ€åˆå°è¯•çš„è§£æ³•æ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hIndex</span><span class="params">(citations []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    slices.Sort(citations)</span><br><span class="line">    n := <span class="built_in">len</span>(citations)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> citations[n<span class="number">-1</span>] == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res := <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        <span class="keyword">if</span> citations[i] &lt;= n-i &#123;  <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šåº”è¯¥æ˜¯ &gt;=</span></span><br><span class="line">            res = max(res, citations[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<ol>
<li><strong>æ¡ä»¶åˆ¤æ–­é”™è¯¯</strong>ï¼šä½¿ç”¨äº† <code>citations[i] &lt;= n-i</code>ï¼Œä½†æ ¹æ® H æŒ‡æ•°å®šä¹‰ï¼Œåº”è¯¥æ˜¯ <code>citations[i] &gt;= n-i</code></li>
<li><strong>è¿”å›å€¼é€»è¾‘é”™è¯¯</strong>ï¼šåœ¨å¯»æ‰¾æ»¡è¶³é”™è¯¯æ¡ä»¶çš„æœ€å¤§å¼•ç”¨æ¬¡æ•°ï¼Œè€Œä¸æ˜¯å¯»æ‰¾æ»¡è¶³ H æŒ‡æ•°å®šä¹‰çš„æœ€å¤§ h å€¼</li>
<li><strong>åˆå§‹å€¼è®¾ç½®ä¸å½“</strong>ï¼š<code>res := 1</code> æ— æ³•å¤„ç† H æŒ‡æ•°ä¸º 0 çš„æƒ…å†µ</li>
</ol>
<h2 id="æ–¹æ³•ä¸€ï¼šæ’åºæ³•">æ–¹æ³•ä¸€ï¼šæ’åºæ³•</h2>
<h3 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h3>
<p>H æŒ‡æ•°çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†è®ºæ–‡æŒ‰å¼•ç”¨æ¬¡æ•°æ’åºåï¼Œæ‰¾åˆ°ä¸€ä¸ªä½ç½®ï¼Œä½¿å¾—ä»è¯¥ä½ç½®åˆ°æ•°ç»„æœ«å°¾çš„æ‰€æœ‰è®ºæ–‡å¼•ç”¨æ¬¡æ•°éƒ½è‡³å°‘ä¸ºè¿™ä¸ªä½ç½®å¯¹åº”çš„è®ºæ–‡æ•°é‡ã€‚</p>
<p>æ’åºåä»å·¦åˆ°å³éå†ï¼Œå¯¹äºä½ç½® <code>i</code>ï¼š</p>
<ul>
<li>ä»ä½ç½® <code>i</code> åˆ°æ•°ç»„æœ«å°¾å…±æœ‰ <code>h = n - i</code> ç¯‡è®ºæ–‡</li>
<li>å¦‚æœ <code>citations[i] &gt;= h</code>ï¼Œè¯´æ˜è¿™ <code>h</code> ç¯‡è®ºæ–‡çš„å¼•ç”¨æ¬¡æ•°éƒ½ â‰¥ h</li>
<li>ç”±äºæˆ‘ä»¬è¦æ‰¾æœ€å¤§çš„ hï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ h å€¼å³å¯</li>
</ul>
<h3 id="å®ç°ä»£ç ">å®ç°ä»£ç </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hIndex</span><span class="params">(citations []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    slices.Sort(citations)</span><br><span class="line">    n := <span class="built_in">len</span>(citations)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        h := n - i  <span class="comment">// ä»ä½ç½®iåˆ°æœ«å°¾çš„è®ºæ–‡æ•°</span></span><br><span class="line">        <span class="keyword">if</span> citations[i] &gt;= h &#123;</span><br><span class="line">            <span class="keyword">return</span> h</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n \log n)$ï¼Œä¸»è¦æ˜¯æ’åºçš„æ—¶é—´å¤æ‚åº¦</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$ï¼Œåªä½¿ç”¨äº†å¸¸æ•°é¢å¤–ç©ºé—´</li>
</ul>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ <code>citations = [3,0,6,1,5]</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>æ’åºåï¼š<code>[0,1,3,5,6]</code></li>
<li>éå†è¿‡ç¨‹ï¼š
<ul>
<li>i=0: h=5, citations[0]=0 &lt; 5 âŒ</li>
<li>i=1: h=4, citations[1]=1 &lt; 4 âŒ</li>
<li>i=2: h=3, citations[2]=3 â‰¥ 3 âœ…</li>
</ul>
</li>
</ol>
<p>è¿”å› h=3</p>
<h2 id="æ–¹æ³•äºŒï¼šè®¡æ•°æ’åºæ³•">æ–¹æ³•äºŒï¼šè®¡æ•°æ’åºæ³•</h2>
<h3 id="è§£é¢˜æ€è·¯-2">è§£é¢˜æ€è·¯</h3>
<p>ç”±äºå¼•ç”¨æ¬¡æ•°æœ‰ä¸Šé™ï¼ˆé¢˜ç›®ä¸­æœ€å¤§ä¸º 1000ï¼‰ï¼Œè€Œä¸” H æŒ‡æ•°æœ€å¤§ä¸ä¼šè¶…è¿‡è®ºæ–‡æ€»æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è®¡æ•°æ’åºçš„æ€æƒ³ã€‚</p>
<p>å…³é”®è§‚å¯Ÿï¼š</p>
<ul>
<li>H æŒ‡æ•°æœ€å¤§ä¸ºè®ºæ–‡æ€»æ•° n</li>
<li>å¼•ç”¨æ¬¡æ•°è¶…è¿‡ n çš„è®ºæ–‡å¯¹ H æŒ‡æ•°çš„è´¡çŒ®ç­‰åŒäºå¼•ç”¨æ¬¡æ•°ä¸º n çš„è®ºæ–‡</li>
</ul>
<h3 id="å®ç°ä»£ç -2">å®ç°ä»£ç </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hIndex</span><span class="params">(citations []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(citations)</span><br><span class="line">    count := <span class="built_in">make</span>([]<span class="type">int</span>, n+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»Ÿè®¡æ¯ä¸ªå¼•ç”¨æ¬¡æ•°çš„è®ºæ–‡æ•°é‡</span></span><br><span class="line">    <span class="keyword">for</span> _, c := <span class="keyword">range</span> citations &#123;</span><br><span class="line">        <span class="keyword">if</span> c &gt;= n &#123;</span><br><span class="line">            count[n]++  <span class="comment">// å¼•ç”¨æ¬¡æ•°â‰¥nçš„éƒ½ç»Ÿè®¡åˆ°count[n]</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            count[c]++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»é«˜åˆ°ä½è®¡ç®—ç´¯è®¡è®ºæ–‡æ•°</span></span><br><span class="line">    total := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := n; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        total += count[i]</span><br><span class="line">        <span class="keyword">if</span> total &gt;= i &#123;  <span class="comment">// è‡³å°‘æœ‰iç¯‡è®ºæ–‡å¼•ç”¨æ¬¡æ•°â‰¥i</span></span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ-2">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œéå†æ•°ç»„ä¸¤æ¬¡</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œéœ€è¦è®¡æ•°æ•°ç»„</li>
</ul>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹-2">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ <code>citations = [3,0,6,1,5]</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>åˆå§‹åŒ–ï¼š<code>count = [0,0,0,0,0,0]</code> (é•¿åº¦ä¸º 6)</li>
<li>ç»Ÿè®¡ï¼š
<ul>
<li>citations[0]=3: count[3]++</li>
<li>citations[1]=0: count[0]++</li>
<li>citations[2]=6â‰¥5: count[5]++</li>
<li>citations[3]=1: count[1]++</li>
<li>citations[4]=5â‰¥5: count[5]++</li>
<li>ç»“æœï¼š<code>count = [1,1,0,1,0,2]</code></li>
</ul>
</li>
<li>ç´¯è®¡è®¡ç®—ï¼š
<ul>
<li>i=5: total=2, 2&lt;5 âŒ</li>
<li>i=4: total=2, 2&lt;4 âŒ</li>
<li>i=3: total=3, 3â‰¥3 âœ…</li>
</ul>
</li>
</ol>
<p>è¿”å› h=3</p>
<h2 id="æ–¹æ³•ä¸‰ï¼šäºŒåˆ†æŸ¥æ‰¾æ³•">æ–¹æ³•ä¸‰ï¼šäºŒåˆ†æŸ¥æ‰¾æ³•</h2>
<h3 id="è§£é¢˜æ€è·¯-3">è§£é¢˜æ€è·¯</h3>
<p>H æŒ‡æ•°å…·æœ‰å•è°ƒæ€§ï¼šå¦‚æœ H æŒ‡æ•°ä¸º hï¼Œé‚£ä¹ˆ H æŒ‡æ•°ä¸€å®šä¸ä¼šæ˜¯ h+1ã€h+2â€¦ã€‚æˆ‘ä»¬å¯ä»¥åœ¨[0, n]èŒƒå›´å†…äºŒåˆ†æŸ¥æ‰¾æœ€å¤§çš„æ»¡è¶³æ¡ä»¶çš„ h å€¼ã€‚</p>
<p>å¯¹äºç»™å®šçš„ hï¼Œæ£€æŸ¥æ˜¯å¦è‡³å°‘æœ‰ h ç¯‡è®ºæ–‡çš„å¼•ç”¨æ¬¡æ•° â‰¥hã€‚</p>
<h3 id="å®ç°ä»£ç -3">å®ç°ä»£ç </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hIndex</span><span class="params">(citations []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(citations)</span><br><span class="line">    left, right := <span class="number">0</span>, n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">        mid := (left + right) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> canAchieveH(citations, mid) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid - <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦èƒ½è¾¾åˆ°HæŒ‡æ•°ä¸ºh</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canAchieveH</span><span class="params">(citations []<span class="type">int</span>, h <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, c := <span class="keyword">range</span> citations &#123;</span><br><span class="line">        <span class="keyword">if</span> c &gt;= h &#123;</span><br><span class="line">            count++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count &gt;= h</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ-3">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n \log n)$ï¼ŒäºŒåˆ†æŸ¥æ‰¾$O(\log n)$æ¬¡ï¼Œæ¯æ¬¡éœ€è¦$O(n)$æ—¶é—´æ£€æŸ¥</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$ï¼Œåªä½¿ç”¨äº†å¸¸æ•°é¢å¤–ç©ºé—´</li>
</ul>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹-3">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ <code>citations = [3,0,6,1,5]</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>åˆå§‹ï¼šleft=0, right=5</li>
<li>mid=2: canAchieveH([3,0,6,1,5], 2) â†’ count=3â‰¥2 âœ… â†’ left=3</li>
<li>mid=4: canAchieveH([3,0,6,1,5], 4) â†’ count=2&lt;4 âŒ â†’ right=3</li>
<li>mid=3: canAchieveH([3,0,6,1,5], 3) â†’ count=3â‰¥3 âœ… â†’ left=4</li>
<li>left&gt;rightï¼Œè¿”å› right=3</li>
</ol>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ’åºæ³•</th>
<th>è®¡æ•°æ’åºæ³•</th>
<th>äºŒåˆ†æŸ¥æ‰¾æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n \log n)$</td>
<td>$O(n)$</td>
<td>$O(n \log n)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(1)$</td>
<td>$O(n)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>å®ç°éš¾åº¦</td>
<td>ç®€å•</td>
<td>ä¸­ç­‰</td>
<td>ä¸­ç­‰</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>é€šç”¨</td>
<td>å¼•ç”¨æ¬¡æ•°èŒƒå›´è¾ƒå°æ—¶</td>
<td>ç†è§£äºŒåˆ†æŸ¥æ‰¾æ€æƒ³</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>ç†è§£ H æŒ‡æ•°å®šä¹‰</strong>ï¼šè‡³å°‘æœ‰ h ç¯‡è®ºæ–‡çš„å¼•ç”¨æ¬¡æ•°éƒ½ â‰¥h æ¬¡</li>
<li><strong>æ’åºçš„å¨åŠ›</strong>ï¼šé€šè¿‡æ’åºå¯ä»¥å°†å¤æ‚çš„è®¡æ•°é—®é¢˜è½¬åŒ–ä¸ºç®€å•çš„ä½ç½®åˆ¤æ–­</li>
<li><strong>è®¡æ•°ä¼˜åŒ–</strong>ï¼šå½“æ•°æ®èŒƒå›´æœ‰é™æ—¶ï¼Œè®¡æ•°æ’åºå¯ä»¥å°†æ—¶é—´å¤æ‚åº¦é™åˆ°çº¿æ€§</li>
<li><strong>äºŒåˆ†æŸ¥æ‰¾çš„åº”ç”¨</strong>ï¼šå•è°ƒæ€§æ˜¯åº”ç”¨äºŒåˆ†æŸ¥æ‰¾çš„å…³é”®æ¡ä»¶</li>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šæ³¨æ„ H æŒ‡æ•°å¯èƒ½ä¸º 0 çš„æƒ…å†µ</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>H æŒ‡æ•°é—®é¢˜æ˜¯ä¸€ä¸ªç»å…¸çš„æ•°ç»„å¤„ç†é—®é¢˜ï¼Œå±•ç¤ºäº†å¤šç§ä¸åŒçš„è§£é¢˜æ€è·¯ã€‚æ’åºæ³•æœ€ç›´è§‚æ˜“æ‡‚ï¼Œè®¡æ•°æ’åºæ³•åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æœ€ä¼˜ï¼ŒäºŒåˆ†æŸ¥æ‰¾æ³•ä½“ç°äº†ç®—æ³•çš„å·§å¦™æ€§ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®æ ¹æ®æ•°æ®ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>æ•°ç»„</tag>
        <tag>æ’åº</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
        <tag>è®¡æ•°æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡: MySQL æ—¥å¿—ç³»ç»Ÿè¯¦è§£ - undo logã€redo logã€binlog</title>
    <url>/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<h1>MySQL æ—¥å¿—ç³»ç»Ÿï¼šä¸‰ç§æ—¥å¿—çš„ä½œç”¨å’ŒåŸç†</h1>
<h2 id="å¼•è¨€ï¼šä»ä¸€ä¸ªæ›´æ–°è¯­å¥è¯´èµ·">å¼•è¨€ï¼šä»ä¸€ä¸ªæ›´æ–°è¯­å¥è¯´èµ·</h2>
<p>å½“æˆ‘ä»¬æ‰§è¡Œä¸€æ¡æ›´æ–°è¯­å¥æ—¶ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> t_user <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;xiaolin&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ¡è¯­å¥çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†åœ¨ MySQL å†…éƒ¨å´æ¶‰åŠåˆ°ä¸‰ç§é‡è¦çš„æ—¥å¿—ç³»ç»Ÿï¼š</p>
<ul>
<li><strong>undo logï¼ˆæ’¤é”€æ—¥å¿—ï¼‰</strong>ï¼šå°±åƒæ˜¯æ•°æ®çš„&quot;åæ‚”è¯&quot;ï¼Œè®°å½•ä¿®æ”¹å‰çš„æ•°æ®ï¼Œç”¨äºäº‹åŠ¡å›æ»š</li>
<li><strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong>ï¼šå°±åƒæ˜¯æ•°æ®çš„&quot;å¤‡ä»½ä¿é™©&quot;ï¼Œè®°å½•ä¿®æ”¹åçš„æ•°æ®ï¼Œç”¨äºæ•…éšœæ¢å¤</li>
<li><strong>binlogï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰</strong>ï¼šå°±åƒæ˜¯æ•°æ®çš„&quot;æ“ä½œè®°å½•æœ¬&quot;ï¼Œè®°å½•æ‰€æœ‰å˜æ›´æ“ä½œï¼Œç”¨äºæ•°æ®å¤‡ä»½å’Œä¸»ä»åŒæ­¥</li>
</ul>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747967912006.png" alt="1747967912006"></p>
<p>è¿™ä¸‰ç§æ—¥å¿—å„æœ‰å„çš„ç”¨é€”ï¼Œå®ƒä»¬å…±åŒä¿è¯äº† MySQL æ•°æ®çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¯¦ç»†äº†è§£ä¸€ä¸‹è¿™ä¸‰ç§æ—¥å¿—çš„ä½œç”¨åŸç†ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦-undo-logï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ undo logï¼Ÿ</h2>
<p>æˆ‘ä»¬åœ¨æ‰§è¡Œæ‰§è¡Œä¸€æ¡â€œå¢åˆ æ”¹â€è¯­å¥çš„æ—¶å€™ï¼Œè™½ç„¶æ²¡æœ‰è¾“å…¥ begin å¼€å¯äº‹åŠ¡å’Œ commit æäº¤äº‹åŠ¡ï¼Œä½†æ˜¯ MySQL ä¼š<strong>éšå¼å¼€å¯äº‹åŠ¡</strong>æ¥æ‰§è¡Œâ€œå¢åˆ æ”¹â€è¯­å¥çš„ï¼Œæ‰§è¡Œå®Œå°±è‡ªåŠ¨æäº¤äº‹åŠ¡çš„ï¼Œè¿™æ ·å°±ä¿è¯äº†æ‰§è¡Œå®Œâ€œå¢åˆ æ”¹â€è¯­å¥åï¼Œæˆ‘ä»¬å¯ä»¥åŠæ—¶åœ¨æ•°æ®åº“è¡¨çœ‹åˆ°â€œå¢åˆ æ”¹â€çš„ç»“æœäº†ã€‚</p>
<p>æ‰§è¡Œä¸€æ¡è¯­å¥æ˜¯å¦è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œæ˜¯ç”± <code>autocommit</code> å‚æ•°å†³å®šçš„ï¼Œé»˜è®¤æ˜¯å¼€å¯ã€‚æ‰€ä»¥ï¼Œæ‰§è¡Œä¸€æ¡ update è¯­å¥ä¹Ÿæ˜¯ä¼šä½¿ç”¨äº‹åŠ¡çš„ã€‚</p>
<p>é‚£ä¹ˆï¼Œè€ƒè™‘ä¸€ä¸ªé—®é¢˜ã€‚ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåœ¨è¿˜æ²¡æœ‰æäº¤äº‹åŠ¡ä¹‹å‰ï¼Œå¦‚æœ MySQL å‘ç”Ÿäº†å´©æºƒï¼Œè¦æ€ä¹ˆå›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„æ•°æ®å‘¢ï¼Ÿ</p>
<p>å¦‚æœæˆ‘ä»¬æ¯æ¬¡åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéƒ½è®°å½•ä¸‹å›æ»šæ—¶éœ€è¦çš„ä¿¡æ¯åˆ°ä¸€ä¸ªæ—¥å¿—é‡Œï¼Œé‚£ä¹ˆåœ¨äº‹åŠ¡æ‰§è¡Œä¸­é€”å‘ç”Ÿäº† MySQL å´©æºƒåï¼Œå°±ä¸ç”¨æ‹…å¿ƒæ— æ³•å›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ—¥å¿—å›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„æ•°æ®ã€‚</p>
<p>å®ç°è¿™ä¸€æœºåˆ¶å°±æ˜¯ <strong>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ï¼Œå®ƒä¿è¯äº†äº‹åŠ¡çš„ <a href="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">ACID ç‰¹æ€§</a>ä¸­çš„åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>ã€‚</p>
<h3 id="undo-log-çš„å·¥ä½œåŸç†">undo log çš„å·¥ä½œåŸç†</h3>
<p>undo log å°±åƒæ˜¯ä¸€ä¸ª&quot;åå‘æ“ä½œæ‰‹å†Œ&quot;ï¼Œè®°å½•ç€å¦‚ä½•æ’¤é”€æ¯ä¸€ä¸ªæ“ä½œã€‚å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747967926095.png" alt="1747967926095"></p>
<p>æ¯å½“ InnoDB å¼•æ“è¦ä¿®æ”¹ä¸€æ¡è®°å½•æ—¶ï¼Œéƒ½ä¼šå…ˆæŠŠ&quot;åå‘æ“ä½œ&quot;è®°å½•åˆ° undo log ä¸­ï¼š</p>
<ul>
<li><strong>æ’å…¥è®°å½•</strong>æ—¶ï¼šè®°å½•è¿™æ¡è®°å½•çš„ä¸»é”®ï¼Œå›æ»šæ—¶åªéœ€è¦<strong>åˆ é™¤</strong>è¿™ä¸ªä¸»é”®å¯¹åº”çš„è®°å½•</li>
<li><strong>åˆ é™¤è®°å½•</strong>æ—¶ï¼šè®°å½•æ•´æ¡è®°å½•çš„å†…å®¹ï¼Œå›æ»šæ—¶<strong>é‡æ–°æ’å…¥</strong>è¿™æ¡è®°å½•</li>
<li><strong>æ›´æ–°è®°å½•</strong>æ—¶ï¼šè®°å½•è¢«ä¿®æ”¹å­—æ®µçš„<strong>æ—§å€¼</strong>ï¼Œå›æ»šæ—¶<strong>æ¢å¤ä¸ºæ—§å€¼</strong></li>
</ul>
<p>ä¸¾ä¸ªå…·ä½“ä¾‹å­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åŸå§‹è®°å½•ï¼šid=1, name=&#x27;å¼ ä¸‰&#x27;, balance=1000</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>undo log ä¼šè®°å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ“ä½œç±»å‹ï¼šUPDATE</span><br><span class="line">è¡¨ï¼šusers</span><br><span class="line">ä¸»é”®ï¼šid=1</span><br><span class="line">æ—§å€¼ï¼šbalance=1000</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦å›æ»šï¼ŒMySQL å°±è¯»å–è¿™æ¡ undo logï¼Œæ‰§è¡Œç›¸åæ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- æ¢å¤æ—§å€¼</span></span><br></pre></td></tr></table></figure>
<h3 id="ç‰ˆæœ¬é“¾ï¼šè®°å½•ä¿®æ”¹å†å²">ç‰ˆæœ¬é“¾ï¼šè®°å½•ä¿®æ”¹å†å²</h3>
<p>ä¸åŒç±»å‹çš„æ“ä½œä¼šäº§ç”Ÿä¸åŒæ ¼å¼çš„ undo logï¼Œä½†æ¯æ¡ undo log éƒ½åŒ…å«ä¸¤ä¸ªé‡è¦ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>trx_idï¼ˆäº‹åŠ¡ IDï¼‰</strong>ï¼šè®°å½•æ˜¯å“ªä¸ªäº‹åŠ¡ä¿®æ”¹äº†è¿™æ¡æ•°æ®</li>
<li><strong>roll_pointerï¼ˆå›æ»šæŒ‡é’ˆï¼‰</strong>ï¼šæŒ‡å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ undo log</li>
</ul>
<p>é€šè¿‡è¿™äº›æŒ‡é’ˆï¼ŒMySQL å¯ä»¥æŠŠåŒä¸€æ¡è®°å½•çš„æ‰€æœ‰å†å²ç‰ˆæœ¬ä¸²æˆä¸€æ¡é“¾ï¼Œè¿™å°±æ˜¯<strong>ç‰ˆæœ¬é“¾</strong>ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747967935054.png" alt="1747967935054"></p>
<p>æƒ³è±¡ä¸€æ¡ç”¨æˆ·è®°å½•è¢«å¤šæ¬¡ä¿®æ”¹ï¼š</p>
<ol>
<li>äº‹åŠ¡ 100ï¼šname=â€˜å¼ ä¸‰â€™ â†’ name=â€˜æå››â€™</li>
<li>äº‹åŠ¡ 200ï¼šname=â€˜æå››â€™ â†’ name=â€˜ç‹äº”â€™</li>
<li>äº‹åŠ¡ 300ï¼šname=â€˜ç‹äº”â€™ â†’ name=â€˜èµµå…­â€™</li>
</ol>
<p>ç‰ˆæœ¬é“¾å°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“å‰è®°å½•(name=&#x27;èµµå…­&#x27;) â†’ undo log(name=&#x27;ç‹äº”&#x27;) â†’ undo log(name=&#x27;æå››&#x27;) â†’ undo log(name=&#x27;å¼ ä¸‰&#x27;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œä»»ä½•æ—¶å€™éƒ½èƒ½é€šè¿‡ç‰ˆæœ¬é“¾æ‰¾åˆ°è®°å½•çš„ä»»ä½•å†å²ç‰ˆæœ¬ã€‚</p>
<h3 id="undo-log-çš„ç¬¬äºŒä¸ªä½œç”¨ï¼šå®ç°-MVCC">undo log çš„ç¬¬äºŒä¸ªä½œç”¨ï¼šå®ç° MVCC</h3>
<p>é™¤äº†äº‹åŠ¡å›æ»šï¼Œ<strong>undo log è¿˜æœ‰ä¸€ä¸ªé‡è¦ä½œç”¨ï¼šé…åˆ ReadView å®ç° MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</strong>ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ŒMVCC è®©ä¸åŒçš„äº‹åŠ¡èƒ½å¤Ÿ&quot;çœ‹åˆ°&quot;æ•°æ®çš„ä¸åŒç‰ˆæœ¬ï¼Œä»è€Œå®ç°è¯»å†™ä¸é˜»å¡ï¼š</p>
<p><strong>è¯»æäº¤éš”ç¦»çº§åˆ«</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡æ‰§è¡Œ SELECT éƒ½ä¼šç”Ÿæˆæ–°çš„ ReadView</li>
<li>å¯èƒ½å‰åä¸¤æ¬¡è¯»å–åŒä¸€æ¡æ•°æ®ï¼Œç»“æœä¸ä¸€æ ·ï¼ˆå› ä¸ºå…¶ä»–äº‹åŠ¡å¯èƒ½å·²ç»ä¿®æ”¹å¹¶æäº¤äº†ï¼‰</li>
</ul>
<p><strong>å¯é‡å¤è¯»éš”ç¦»çº§åˆ«</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡å¼€å§‹æ—¶ç”Ÿæˆä¸€ä¸ª ReadViewï¼Œæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½ä½¿ç”¨è¿™ä¸ª ReadView</li>
<li>ä¿è¯äº‹åŠ¡æœŸé—´å¤šæ¬¡è¯»å–åŒä¸€æ¡æ•°æ®ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„</li>
</ul>
<p>MVCC çš„æ ¸å¿ƒæœºåˆ¶æ˜¯ï¼š</p>
<ol>
<li>æ ¹æ®äº‹åŠ¡çš„ ReadView å’Œè®°å½•çš„ trx_idã€roll_pointer è¿›è¡Œæ¯”è¾ƒ</li>
<li>å¦‚æœå½“å‰ç‰ˆæœ¬ä¸ç¬¦åˆå¯è§æ€§è¦æ±‚ï¼Œå°±æ²¿ç€ç‰ˆæœ¬é“¾å¾€å‰æ‰¾</li>
<li>ç›´åˆ°æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å†å²ç‰ˆæœ¬</li>
</ol>
<p>è¿™æ ·å°±å®ç°äº†&quot;ä¸€ä¸ªäº‹åŠ¡åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥æ­£å¸¸ä¿®æ”¹æ•°æ®ï¼Œäº’ä¸å¹²æ‰°&quot;ã€‚</p>
<p>å…·ä½“çš„å®ç°ç»†èŠ‚å¯ä»¥å‚è€ƒï¼š<a href="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</a></p>
<h3 id="undo-log-çš„ä¸¤å¤§ä½œç”¨æ€»ç»“">undo log çš„ä¸¤å¤§ä½œç”¨æ€»ç»“</h3>
<ul>
<li><strong>å®ç°äº‹åŠ¡å›æ»š</strong>ï¼šä¿éšœäº‹åŠ¡çš„åŸå­æ€§ï¼Œç¡®ä¿å‡ºé”™æ—¶èƒ½æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€</li>
<li><strong>å®ç° MVCC</strong>ï¼šé€šè¿‡ç‰ˆæœ¬é“¾ä¸ºä¸åŒäº‹åŠ¡æä¾›æ•°æ®çš„ä¸åŒç‰ˆæœ¬è§†å›¾ï¼Œå®ç°è¯»å†™å¹¶å‘</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦-Buffer-Poolï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ Buffer Poolï¼Ÿ</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ¯æ¬¡æŸ¥è¯¢æˆ–ä¿®æ”¹æ•°æ®éƒ½è¦ç›´æ¥è®¿é—®ç£ç›˜ï¼Œé‚£å°±åƒæ¯æ¬¡æƒ³çœ‹ä¹¦éƒ½è¦è·‘å›¾ä¹¦é¦†ä¸€æ ·ï¼Œæ•ˆç‡ä¼šéå¸¸ä½ã€‚æ›´èªæ˜çš„åšæ³•æ˜¯æŠŠå¸¸ç”¨çš„ä¹¦å€Ÿå›å®¶æ”¾åœ¨ä¹¦æ¡Œä¸Šï¼Œéœ€è¦æ—¶éšæ‰‹å°±èƒ½ç¿»é˜…ã€‚</p>
<p>MySQL ä¹Ÿæ˜¯åŒæ ·çš„æ€è·¯ã€‚ç”±äºç£ç›˜è¯»å†™é€Ÿåº¦è¿œè¿œæ…¢äºå†…å­˜ï¼ŒMySQL è®¾è®¡äº†ä¸€ä¸ª<strong>ç¼“å†²æ± </strong>ï¼ˆ<strong>Buffer Pool</strong>ï¼‰æ¥æé«˜æ€§èƒ½ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747967945641.png" alt="1747967945641"></p>
<p>æœ‰äº† Buffer Pool ä¹‹åï¼Œæ•°æ®çš„è¯»å†™æµç¨‹å˜æˆï¼š</p>
<p><strong>è¯»å–æ•°æ®æ—¶</strong>ï¼š</p>
<ul>
<li>å…ˆæ£€æŸ¥ Buffer Pool ä¸­æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªæ•°æ®é¡µ</li>
<li>å¦‚æœæœ‰ï¼Œç›´æ¥ä»å†…å­˜è¯»å–ï¼ˆé€Ÿåº¦å¿«ï¼‰</li>
<li>å¦‚æœæ²¡æœ‰ï¼Œä»ç£ç›˜åŠ è½½åˆ° Buffer Poolï¼Œå†è¿”å›æ•°æ®</li>
</ul>
<p><strong>ä¿®æ”¹æ•°æ®æ—¶</strong>ï¼š</p>
<ul>
<li>ç›´æ¥ä¿®æ”¹ Buffer Pool ä¸­çš„æ•°æ®é¡µ</li>
<li>å°†è¿™ä¸ªé¡µæ ‡è®°ä¸º&quot;è„é¡µ&quot;ï¼ˆè¡¨ç¤ºå†…å­˜å’Œç£ç›˜çš„æ•°æ®ä¸ä¸€è‡´äº†ï¼‰</li>
<li>ä¸ç«‹å³å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯ç”±åå°çº¿ç¨‹åœ¨åˆé€‚çš„æ—¶æœºç»Ÿä¸€åˆ·ç›˜</li>
</ul>
<p>è¿™ç§&quot;å…ˆæ”¹å†…å­˜ï¼Œåå†™ç£ç›˜&quot;çš„ç­–ç•¥å¤§å¤§æé«˜äº†æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ã€‚</p>
<h3 id="Buffer-Pool-ç¼“å­˜ä»€ä¹ˆï¼Ÿ">Buffer Pool ç¼“å­˜ä»€ä¹ˆï¼Ÿ</h3>
<p>InnoDB å°†æ•°æ®æŒ‰<strong>é¡µ</strong>æ¥ç®¡ç†ï¼Œæ¯é¡µé»˜è®¤å¤§å°æ˜¯ 16KBã€‚å°±åƒå›¾ä¹¦é¦†æŒ‰å†Œæ•´ç†ä¹¦ç±ä¸€æ ·ï¼ŒMySQL ä¹Ÿæ˜¯æŒ‰é¡µæ•´ç†æ•°æ®çš„ã€‚</p>
<p><strong>Buffer Pool çš„åˆå§‹åŒ–è¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li>MySQL å¯åŠ¨æ—¶ï¼Œç”³è¯·ä¸€å¤§å—è¿ç»­å†…å­˜ç©ºé—´</li>
<li>æŒ‰ 16KB å¤§å°åˆ’åˆ†æˆè‹¥å¹²ä¸ªç¼“å­˜é¡µ</li>
<li>è¿™äº›ç¼“å­˜é¡µåˆå§‹éƒ½æ˜¯ç©ºçš„ï¼Œç­‰å¾…æ•°æ®åŠ è½½</li>
</ol>
<p>è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆ MySQL åˆšå¯åŠ¨æ—¶è™šæ‹Ÿå†…å­˜å¾ˆå¤§ï¼Œä½†ç‰©ç†å†…å­˜ä½¿ç”¨å¾ˆå°‘â€”â€”åªæœ‰å½“ç¼“å­˜é¡µè¢«å®é™…ä½¿ç”¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šåˆ†é…ç‰©ç†å†…å­˜ã€‚</p>
<p><strong>Buffer Pool ä¸»è¦ç¼“å­˜è¿™äº›å†…å®¹</strong>ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747967989940.png" alt="1747967989940"></p>
<ul>
<li><strong>æ•°æ®é¡µ</strong>ï¼šå­˜å‚¨è¡¨ä¸­çš„å®é™…æ•°æ®</li>
<li><strong>ç´¢å¼•é¡µ</strong>ï¼šå­˜å‚¨ç´¢å¼•ç»“æ„ï¼Œç”¨äºå¿«é€ŸæŸ¥æ‰¾æ•°æ®</li>
<li><strong>Undo é¡µ</strong>ï¼šå­˜å‚¨ undo logï¼Œç”¨äºäº‹åŠ¡å›æ»šå’Œ MVCC</li>
<li><strong>æ’å…¥ç¼“å­˜</strong>ï¼šä¼˜åŒ–éä¸»é”®ç´¢å¼•çš„æ’å…¥æ€§èƒ½</li>
<li><strong>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</strong>ï¼šMySQL è‡ªåŠ¨åˆ›å»ºçš„å“ˆå¸Œç´¢å¼•ï¼ŒåŠ é€ŸæŸ¥è¯¢</li>
<li><strong>é”ä¿¡æ¯</strong>ï¼šäº‹åŠ¡é”çš„ç›¸å…³ä¿¡æ¯</li>
</ul>
<h3 id="å¸¸è§ç–‘é—®è§£ç­”">å¸¸è§ç–‘é—®è§£ç­”</h3>
<p><strong>Qï¼šUndo é¡µè®°å½•ä»€ä¹ˆï¼Ÿ</strong></p>
<p>å½“äº‹åŠ¡å¼€å§‹åï¼ŒInnoDB åœ¨ä¿®æ”¹è®°å½•å‰ä¼šå…ˆç”Ÿæˆ undo logã€‚è¿™äº› undo log å°±å­˜å‚¨åœ¨ Buffer Pool çš„ Undo é¡µä¸­ã€‚</p>
<p><strong>Qï¼šæŸ¥è¯¢ä¸€æ¡è®°å½•æ—¶ï¼ŒåªåŠ è½½è¿™ä¸€æ¡è®°å½•åˆ° Buffer Pool å—ï¼Ÿ</strong></p>
<p>ä¸æ˜¯çš„ï¼InnoDB ä¼šæŠŠ<strong>æ•´ä¸ªé¡µ</strong>ï¼ˆ16KBï¼‰åŠ è½½åˆ° Buffer Pool ä¸­ï¼Œç„¶åé€šè¿‡é¡µå†…çš„&quot;é¡µç›®å½•&quot;å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚è¿™æ˜¯å› ä¸ºï¼š</p>
<ul>
<li>ç£ç›˜ I/O çš„æœ€å°å•ä½å°±æ˜¯é¡µ</li>
<li>åŒä¸€é¡µå†…çš„å…¶ä»–è®°å½•å¾ˆå¯èƒ½ä¹Ÿä¼šè¢«è®¿é—®åˆ°ï¼ˆç©ºé—´å±€éƒ¨æ€§åŸç†ï¼‰</li>
</ul>
<p>æƒ³äº†è§£æ›´å¤šå…³äºé¡µç»“æ„å’Œç´¢å¼•æŸ¥è¯¢çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/">æ¢ä¸€ä¸ªè§’åº¦çœ‹ B+ æ ‘</a></p>
<div class="note info flat"><p><strong>undo log æ˜¯å¦‚ä½•æŒä¹…åŒ–çš„ï¼Ÿ</strong></p>
<p>å¾ˆå¤šäººä¼šç–‘é—®ï¼šundo log å­˜åœ¨å†…å­˜çš„ Buffer Pool ä¸­ï¼Œå¦‚ä½•ä¿è¯æŒä¹…åŒ–å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼šundo log å’Œæ•°æ®é¡µä½¿ç”¨ç›¸åŒçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œéƒ½ä¾é  redo log æ¥ä¿è¯ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<ul>
<li>Buffer Pool ä¸­çš„ undo é¡µè¢«ä¿®æ”¹æ—¶ï¼Œä¹Ÿä¼šç”Ÿæˆç›¸åº”çš„ redo log</li>
<li>redo log æ¯ç§’åˆ·ç›˜ä¸€æ¬¡ï¼Œäº‹åŠ¡æäº¤æ—¶ä¹Ÿä¼šåˆ·ç›˜</li>
<li>é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œæ•°æ®é¡µå’Œ undo é¡µéƒ½èƒ½ä¿è¯æŒä¹…åŒ–</li>
</ul>
</div>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦-redo-logï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ redo logï¼Ÿ</h2>
<p>Buffer Pool ç¡®å®æé«˜äº†è¯»å†™æ•ˆç‡ï¼Œä½†ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼š<strong>å†…å­˜ä¸­çš„æ•°æ®åœ¨æ–­ç”µåä¼šä¸¢å¤±ï¼</strong></p>
<p>æƒ³è±¡è¿™æ ·çš„åœºæ™¯ï¼šä½ åœ¨ç”µè„‘ä¸Šå†™äº†ä¸€ç¯‡é‡è¦æ–‡æ¡£ï¼Œè¿˜æ²¡æ¥å¾—åŠä¿å­˜ï¼Œçªç„¶åœç”µäº†ã€‚å¦‚æœæ²¡æœ‰è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œä½ çš„å¿ƒè¡€å°±ç™½è´¹äº†ã€‚</p>
<p>MySQL é¢ä¸´åŒæ ·çš„é£é™©ï¼šBuffer Pool ä¸­ä¿®æ”¹åçš„æ•°æ®ï¼ˆè„é¡µï¼‰å¦‚æœè¿˜æ²¡å†™å…¥ç£ç›˜ï¼Œä¸€æ—¦æ–­ç”µé‡å¯ï¼Œè¿™äº›ä¿®æ”¹å°±ä¼šæ¶ˆå¤±ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMySQL é‡‡ç”¨äº† <strong>WALï¼ˆWrite-Ahead Loggingï¼‰æŠ€æœ¯</strong>ï¼š</p>
<ol>
<li><strong>å…ˆå†™æ—¥å¿—ï¼Œå†å†™æ•°æ®</strong>ï¼šå½“æœ‰æ•°æ®éœ€è¦ä¿®æ”¹æ—¶ï¼ŒInnoDB å…ˆæ›´æ–°å†…å­˜ï¼Œç„¶åæŠŠè¿™æ¬¡ä¿®æ”¹ä»¥æ—¥å¿—å½¢å¼è®°å½•ä¸‹æ¥</li>
<li><strong>æ­¤æ—¶æ›´æ–°å°±ç®—å®Œæˆäº†</strong>ï¼šä¸éœ€è¦ç«‹å³æŠŠè„é¡µå†™å…¥ç£ç›˜</li>
<li><strong>åå°å¼‚æ­¥åˆ·ç›˜</strong>ï¼šç”±åå°çº¿ç¨‹åœ¨åˆé€‚çš„æ—¶æœºå°†è„é¡µå†™å…¥ç£ç›˜</li>
</ol>
<p>è¿™ä¸ªæ—¥å¿—å°±æ˜¯ <strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong>ï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968001777.png" alt="1747968001777"></p>
<h3 id="ä»€ä¹ˆæ˜¯-redo-logï¼Ÿ">ä»€ä¹ˆæ˜¯ redo logï¼Ÿ</h3>
<p><strong>redo log æ˜¯ç‰©ç†æ—¥å¿—</strong>ï¼Œå®ƒè®°å½•çš„æ˜¯&quot;åœ¨æŸä¸ªæ•°æ®é¡µçš„æŸä¸ªä½ç½®åšäº†ä»€ä¹ˆä¿®æ”¹&quot;ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹è¡¨ç©ºé—´ XXX ä¸­çš„æ•°æ®é¡µ YYY åœ¨åç§»é‡ ZZZ çš„ä½ç½®ï¼Œå°†å€¼ä» &#x27;A&#x27; ä¿®æ”¹ä¸º &#x27;B&#x27;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§è®°å½•æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li><strong>è®°å½•ç²¾ç¡®</strong>ï¼šå‡†ç¡®è®°å½•äº†æ•°æ®çš„ç‰©ç†å˜åŒ–</li>
<li><strong>æ¢å¤å¿«é€Ÿ</strong>ï¼šç³»ç»Ÿå´©æºƒåï¼Œç›´æ¥æŒ‰ç…§ redo log é‡æ–°æ‰§è¡Œä¿®æ”¹å³å¯</li>
<li><strong>å ç”¨ç©ºé—´å°</strong>ï¼šåªè®°å½•å˜åŒ–çš„éƒ¨åˆ†ï¼Œä¸è®°å½•å®Œæ•´æ•°æ®</li>
</ul>
<p><strong>redo log çš„å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªä¿®æ”¹æ“ä½œéƒ½ä¼šç”Ÿæˆ redo log</li>
<li>äº‹åŠ¡æäº¤æ—¶ï¼Œç¡®ä¿ redo log å·²ç»å†™å…¥ç£ç›˜</li>
<li>å¦‚æœç³»ç»Ÿå´©æºƒï¼ŒMySQL é‡å¯åä¼šæ‰«æ redo log</li>
<li>æ ¹æ® redo log ä¸­çš„è®°å½•ï¼Œé‡æ–°æ‰§è¡Œæ‰€æœ‰å·²æäº¤äº‹åŠ¡çš„ä¿®æ”¹</li>
</ol>
<p>è¿™æ ·å°±å®ç°äº† <strong>crash-safe</strong>(<strong>å´©æºƒæ¢å¤</strong>)èƒ½åŠ›ï¼šå³ä½¿æ•°æ®åº“å¼‚å¸¸é‡å¯ï¼Œå·²æäº¤çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚<strong>redo log ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§</strong>ã€‚</p>
<h3 id="redo-log-vs-undo-log">redo log vs undo log</h3>
<p>è¿™ä¸¤ç§æ—¥å¿—ç»å¸¸è¢«æ··æ·†ï¼Œè®©æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>redo log</th>
<th>undo log</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ä½œç”¨</strong></td>
<td>ä¿è¯æŒä¹…æ€§ï¼ˆå´©æºƒæ¢å¤ï¼‰</td>
<td>ä¿è¯åŸå­æ€§ï¼ˆäº‹åŠ¡å›æ»šï¼‰å’Œå®ç° MVCC</td>
</tr>
<tr>
<td><strong>è®°å½•å†…å®¹</strong></td>
<td>ä¿®æ”¹<strong>ä¹‹å</strong>çš„æ•°æ®çŠ¶æ€</td>
<td>ä¿®æ”¹<strong>ä¹‹å‰</strong>çš„æ•°æ®çŠ¶æ€</td>
</tr>
<tr>
<td><strong>æ—¥å¿—ç±»å‹</strong></td>
<td>ç‰©ç†æ—¥å¿—ï¼ˆè®°å½•é¡µé¢å˜åŒ–ï¼‰</td>
<td>é€»è¾‘æ—¥å¿—ï¼ˆè®°å½•æ“ä½œè¿‡ç¨‹ï¼‰</td>
</tr>
<tr>
<td><strong>ä½¿ç”¨æ—¶æœº</strong></td>
<td>ç³»ç»Ÿå´©æºƒåæ¢å¤å·²æäº¤äº‹åŠ¡</td>
<td>äº‹åŠ¡å›æ»šæ—¶æ’¤é”€æœªæäº¤ä¿®æ”¹</td>
</tr>
</tbody>
</table>
<p>ç®€å•è®°å¿†ï¼š</p>
<ul>
<li><strong>redo = é‡åš</strong>ï¼šç³»ç»Ÿå´©æºƒå&quot;é‡æ–°åšä¸€é&quot;å·²æäº¤çš„ä¿®æ”¹</li>
<li><strong>undo = æ’¤é”€</strong>ï¼šäº‹åŠ¡å¤±è´¥æ—¶&quot;æ’¤é”€&quot;æœªæäº¤çš„ä¿®æ”¹</li>
</ul>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968054115.png" alt="1747968054115"></p>
<h3 id="ä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿæ—¢ç„¶éƒ½è¦å†™ç£ç›˜ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å†™æ•°æ®é¡µï¼Ÿ">ä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿæ—¢ç„¶éƒ½è¦å†™ç£ç›˜ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å†™æ•°æ®é¡µï¼Ÿ</h3>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼ç­”æ¡ˆåœ¨äº<strong>ç£ç›˜å†™å…¥æ–¹å¼çš„å·®å¼‚</strong>ï¼š</p>
<p><strong>redo log çš„å†™å…¥</strong>ï¼š</p>
<ul>
<li><strong>é¡ºåºå†™</strong>ï¼šredo log æ–‡ä»¶æ˜¯é¡ºåºè¿½åŠ å†™å…¥çš„</li>
<li>å°±åƒåœ¨ç¬”è®°æœ¬ä¸Šä»ç¬¬ä¸€é¡µå¼€å§‹ï¼Œä¸€é¡µé¡µå¾€åå†™</li>
</ul>
<p><strong>æ•°æ®é¡µçš„å†™å…¥</strong>ï¼š</p>
<ul>
<li><strong>éšæœºå†™</strong>ï¼šéœ€è¦å…ˆå®šä½åˆ°æ•°æ®é¡µåœ¨ç£ç›˜ä¸Šçš„å…·ä½“ä½ç½®ï¼Œç„¶åå†™å…¥</li>
<li>å°±åƒåœ¨ä¸€æœ¬å¾ˆåšçš„å­—å…¸é‡Œï¼Œéœ€è¦å…ˆç¿»åˆ°ç‰¹å®šé¡µç ï¼Œå†ä¿®æ”¹å†…å®¹</li>
</ul>
<p><strong>ç£ç›˜çš„&quot;é¡ºåºå†™&quot;æ¯”&quot;éšæœºå†™&quot;å¿«å¾—å¤šï¼</strong></p>
<p>å½¢è±¡æ¯”å–»ï¼š</p>
<ul>
<li>é¡ºåºå†™ = æŒ‰é¡ºåºçœ‹å°è¯´ï¼Œä»ç¬¬ 1 é¡µçœ‹åˆ°ç¬¬ 100 é¡µ</li>
<li>éšæœºå†™ = åœ¨å­—å…¸é‡ŒæŸ¥å•è¯ï¼Œä¸æ–­ç¿»æ¥ç¿»å»æ‰¾ç‰¹å®šé¡µé¢</li>
</ul>
<p>å› æ­¤ï¼ŒWAL æŠ€æœ¯å¸¦æ¥äº†ä¸¤ä¸ªé‡è¦ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>ä¿è¯æŒä¹…æ€§</strong>ï¼šè®© MySQL å…·å¤‡ crash-safe èƒ½åŠ›ï¼Œä»»ä½•æ—¶å€™å´©æºƒéƒ½ä¸ä¼šä¸¢å¤±å·²æäº¤çš„æ•°æ®</li>
<li><strong>æå‡æ€§èƒ½</strong>ï¼šå°†ç£ç›˜æ“ä½œä»&quot;éšæœºå†™&quot;å˜æˆ&quot;é¡ºåºå†™&quot;ï¼Œå¤§å¹…æå‡å†™å…¥æ€§èƒ½</li>
</ol>
<h3 id="redo-log-çš„ç¼“å­˜æœºåˆ¶">redo log çš„ç¼“å­˜æœºåˆ¶</h3>
<p>å®é™…ä¸Šï¼Œredo log ä¹Ÿä¸æ˜¯ç›´æ¥å†™å…¥ç£ç›˜çš„ã€‚ä¸ºäº†é¿å…é¢‘ç¹çš„ç£ç›˜ I/Oï¼ŒMySQL è®¾è®¡äº† <strong>redo log buffer</strong>ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968063556.png" alt="1747968063556"></p>
<p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li>äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œredo log å…ˆå†™å…¥ redo log bufferï¼ˆå†…å­˜ä¸­ï¼‰</li>
<li>åœ¨ç‰¹å®šæ—¶æœºï¼Œå†å°† redo log buffer ä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜</li>
</ol>
<p><strong>redo log buffer çš„é…ç½®</strong>ï¼š</p>
<ul>
<li>é»˜è®¤å¤§å°ï¼š16 MB</li>
<li>é…ç½®å‚æ•°ï¼š<code>innodb_log_buffer_size</code></li>
<li>å¢å¤§ç¼“å†²åŒºå¯ä»¥è®© MySQL å¤„ç†å¤§äº‹åŠ¡æ—¶å‡å°‘ç£ç›˜å†™å…¥ï¼Œæå‡æ€§èƒ½</li>
</ul>
<h3 id="redo-log-ä»€ä¹ˆæ—¶å€™åˆ·ç›˜ï¼Ÿ">redo log ä»€ä¹ˆæ—¶å€™åˆ·ç›˜ï¼Ÿ</h3>
<p>redo log è™½ç„¶ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä½†æ€»éœ€è¦å†™å…¥ç£ç›˜æ‰èƒ½çœŸæ­£ä¿è¯æ•°æ®å®‰å…¨ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåˆ·ç›˜æ—¶æœºï¼š</p>
<p><strong>è‡ªåŠ¨åˆ·ç›˜æ—¶æœº</strong>ï¼š</p>
<ul>
<li><strong>MySQL æ­£å¸¸å…³é—­æ—¶</strong>ï¼šç¡®ä¿æ‰€æœ‰æ—¥å¿—éƒ½æŒä¹…åŒ–</li>
<li><strong>ç¼“å†²åŒºå†™æ»¡ä¸€åŠæ—¶</strong>ï¼šå½“ redo log buffer ä½¿ç”¨é‡è¶…è¿‡ 50% æ—¶è§¦å‘</li>
<li><strong>åå°çº¿ç¨‹å®šæ—¶åˆ·ç›˜</strong>ï¼šæ¯éš” 1 ç§’è‡ªåŠ¨å°† redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜</li>
</ul>
<p><strong>äº‹åŠ¡æäº¤æ—¶åˆ·ç›˜</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šæ ¹æ® <code>innodb_flush_log_at_trx_commit</code> å‚æ•°å†³å®šåˆ·ç›˜ç­–ç•¥</li>
</ul>
<h3 id="innodb-flush-log-at-trx-commit-å‚æ•°è¯¦è§£">innodb_flush_log_at_trx_commit å‚æ•°è¯¦è§£</h3>
<p>è¿™ä¸ªå‚æ•°æ§åˆ¶äº‹åŠ¡æäº¤æ—¶ redo log çš„åˆ·ç›˜è¡Œä¸ºï¼Œæœ‰ 3 ä¸ªå¯é€‰å€¼ï¼š</p>
<p><strong>å‚æ•°å€¼ = 0ï¼ˆæ€§èƒ½æœ€å¥½ï¼Œå®‰å…¨æ€§æœ€å·®ï¼‰</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡æäº¤æ—¶ï¼Œredo log åœç•™åœ¨ redo log buffer ä¸­ï¼Œä¸å†™å…¥ç£ç›˜</li>
<li>ä¾èµ–åå°çº¿ç¨‹æ¯ç§’åˆ·ç›˜</li>
<li><strong>é£é™©</strong>ï¼šMySQL è¿›ç¨‹å´©æºƒä¼šä¸¢å¤±æœ€è¿‘ 1 ç§’çš„æ‰€æœ‰äº‹åŠ¡æ•°æ®</li>
</ul>
<p><strong>å‚æ•°å€¼ = 1ï¼ˆæ€§èƒ½ä¸€èˆ¬ï¼Œå®‰å…¨æ€§æœ€å¥½ï¼‰- é»˜è®¤å€¼</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡æäº¤æ—¶ï¼Œç«‹å³å°† redo log buffer ä¸­çš„å†…å®¹æŒä¹…åŒ–åˆ°ç£ç›˜</li>
<li><strong>æœ€å®‰å…¨</strong>ï¼šMySQL å¼‚å¸¸é‡å¯ä¹Ÿä¸ä¼šä¸¢å¤±å·²æäº¤çš„æ•°æ®</li>
</ul>
<p><strong>å‚æ•°å€¼ = 2ï¼ˆæ€§èƒ½å’Œå®‰å…¨æ€§çš„æŠ˜ä¸­ï¼‰</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡æäº¤æ—¶ï¼Œå°† redo log å†™å…¥æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç¼“å­˜ï¼ˆPage Cacheï¼‰</li>
<li>ä¸ç«‹å³ fsync åˆ°ç£ç›˜ï¼Œäº¤ç»™æ“ä½œç³»ç»Ÿæ§åˆ¶</li>
<li><strong>é£é™©</strong>ï¼šåªæœ‰åœ¨æ“ä½œç³»ç»Ÿå´©æºƒæˆ–æ–­ç”µæ—¶æ‰ä¼šä¸¢å¤±æ•°æ®</li>
</ul>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968082559.png" alt="1747968082559"></p>
<h3 id="å‚æ•°é€‰æ‹©å»ºè®®">å‚æ•°é€‰æ‹©å»ºè®®</h3>
<p><strong>å®‰å…¨æ€§å¯¹æ¯”</strong>ï¼šå‚æ•° 1 &gt; å‚æ•° 2 &gt; å‚æ•° 0<br>
<strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼šå‚æ•° 0 &gt; å‚æ•° 2 &gt; å‚æ•° 1</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>é‡‘èã€æ”¯ä»˜ç³»ç»Ÿ</strong>ï¼šé€‰æ‹©å‚æ•° 1ï¼Œæ•°æ®å®‰å…¨æœ€é‡è¦</li>
</ul>
<h3 id="åå°çº¿ç¨‹çš„åˆ·ç›˜ç­–ç•¥">åå°çº¿ç¨‹çš„åˆ·ç›˜ç­–ç•¥</h3>
<p>æ— è®º <code>innodb_flush_log_at_trx_commit</code> è®¾ç½®ä¸ºä»€ä¹ˆå€¼ï¼ŒInnoDB çš„åå°çº¿ç¨‹æ¯éš” 1 ç§’éƒ½ä¼šæ‰§è¡Œåˆ·ç›˜æ“ä½œï¼š</p>
<p><strong>å¯¹äºå‚æ•° 0</strong>ï¼š</p>
<ul>
<li>å°† redo log buffer â†’ æ“ä½œç³»ç»Ÿ Page Cache â†’ ç£ç›˜</li>
<li>å®Œæ•´çš„åˆ·ç›˜æµç¨‹ï¼š<code>write()</code> + <code>fsync()</code></li>
</ul>
<p><strong>å¯¹äºå‚æ•° 2</strong>ï¼š</p>
<ul>
<li>åªæ‰§è¡Œ <code>fsync()</code>ï¼Œå°† Page Cache ä¸­çš„æ•°æ®å†™å…¥ç£ç›˜</li>
<li>å› ä¸ºäº‹åŠ¡æäº¤æ—¶å·²ç»æ‰§è¡Œäº† <code>write()</code> æ“ä½œ</li>
</ul>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968096087.png" alt="1747968096087"></p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆï¼š</p>
<ul>
<li><strong>å‚æ•° 0</strong>ï¼šMySQL è¿›ç¨‹å´©æºƒå¯èƒ½ä¸¢å¤± 1 ç§’æ•°æ®</li>
<li><strong>å‚æ•° 2</strong>ï¼šåªæœ‰æ“ä½œç³»ç»Ÿå´©æºƒæ‰å¯èƒ½ä¸¢å¤± 1 ç§’æ•°æ®</li>
</ul>
<h3 id="redo-log-æ–‡ä»¶å†™æ»¡äº†æ€ä¹ˆåŠï¼Ÿ">redo log æ–‡ä»¶å†™æ»¡äº†æ€ä¹ˆåŠï¼Ÿ</h3>
<p>redo log ä¸æ˜¯æ— é™å¢é•¿çš„ï¼Œè€Œæ˜¯ä½¿ç”¨<strong>å›ºå®šå¤§å°çš„å¾ªç¯æ–‡ä»¶</strong>æ¥å­˜å‚¨ã€‚</p>
<p><strong>é»˜è®¤é…ç½®</strong>ï¼š</p>
<ul>
<li>1 ä¸ªé‡åšæ—¥å¿—æ–‡ä»¶ç»„ï¼ˆredo log Groupï¼‰</li>
<li>åŒ…å« 2 ä¸ª redo log æ–‡ä»¶ï¼š<code>ib_logfile0</code> å’Œ <code>ib_logfile1</code></li>
<li>æ¯ä¸ªæ–‡ä»¶å¤§å°å›ºå®šï¼ˆæ¯”å¦‚ 1GBï¼‰ï¼Œæ€»å…±å¯è®°å½• 2GB çš„æ“ä½œ</li>
</ul>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968106307.png" alt="1747968106307"></p>
<p><strong>å¾ªç¯å†™å…¥æœºåˆ¶</strong>ï¼š</p>
<ol>
<li>å…ˆå†™ <code>ib_logfile0</code>ï¼Œå†™æ»¡ååˆ‡æ¢åˆ° <code>ib_logfile1</code></li>
<li><code>ib_logfile1</code> å†™æ»¡åï¼Œå›åˆ° <code>ib_logfile0</code> å¼€å¤´ç»§ç»­å†™</li>
<li>å°±åƒä¸€ä¸ªç¯å½¢è·‘é“ï¼Œä¸æ–­å¾ªç¯</li>
</ol>
<h3 id="å¾ªç¯å†™å…¥çš„å…³é”®æŒ‡é’ˆ">å¾ªç¯å†™å…¥çš„å…³é”®æŒ‡é’ˆ</h3>
<p>MySQL ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆæ¥ç®¡ç† redo log çš„å¾ªç¯å†™å…¥ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968119294.png" alt="1747968119294"></p>
<p><strong>write posï¼ˆå†™å…¥ä½ç½®ï¼‰</strong>ï¼š</p>
<ul>
<li>å½“å‰ redo log è®°å½•å†™åˆ°çš„ä½ç½®</li>
<li>é¡ºæ—¶é’ˆæ–¹å‘ç§»åŠ¨</li>
</ul>
<p><strong>check pointï¼ˆæ£€æŸ¥ç‚¹ï¼‰</strong>ï¼š</p>
<ul>
<li>å½“å‰å¯ä»¥æ“¦é™¤çš„ä½ç½®</li>
<li>ä¹Ÿæ˜¯é¡ºæ—¶é’ˆæ–¹å‘ç§»åŠ¨</li>
</ul>
<p><strong>åŒºåŸŸåˆ’åˆ†</strong>ï¼š</p>
<ul>
<li><strong>çº¢è‰²åŒºåŸŸï¼ˆwrite pos ~ check pointï¼‰</strong>ï¼šå¯ä»¥ç”¨æ¥è®°å½•æ–°çš„æ›´æ–°æ“ä½œ</li>
<li><strong>è“è‰²åŒºåŸŸï¼ˆcheck point ~ write posï¼‰</strong>ï¼šå·²å†™å…¥ä½†è¿˜æœªåˆ·ç›˜çš„è„é¡µè®°å½•</li>
</ul>
<h3 id="æ–‡ä»¶å†™æ»¡çš„å¤„ç†æœºåˆ¶">æ–‡ä»¶å†™æ»¡çš„å¤„ç†æœºåˆ¶</h3>
<p><strong>å½“ write pos è¿½ä¸Š check point æ—¶</strong>ï¼š</p>
<ul>
<li>è¡¨ç¤º redo log æ–‡ä»¶ç©ºé—´ç”¨å®Œäº†</li>
<li><strong>MySQL è¢«è¿«åœæ­¢å¤„ç†æ–°çš„æ›´æ–°æ“ä½œ</strong>ï¼ˆç³»ç»Ÿé˜»å¡ï¼ï¼‰</li>
<li>å¿…é¡»å…ˆæ¸…ç†ç©ºé—´æ‰èƒ½ç»§ç»­</li>
</ul>
<p><strong>æ¸…ç†è¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li><strong>å¼ºåˆ¶åˆ·ç›˜</strong>ï¼šå°† Buffer Pool ä¸­çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜</li>
<li><strong>æ ‡è®°å¯æ“¦é™¤</strong>ï¼šæ ‡è®°å“ªäº› redo log è®°å½•å¯ä»¥è¢«è¦†ç›–</li>
<li><strong>ç§»åŠ¨ check point</strong>ï¼šcheck point å‘å‰ç§»åŠ¨ï¼Œé‡Šæ”¾ç©ºé—´</li>
<li><strong>æ¢å¤è¿è¡Œ</strong>ï¼šMySQL é‡æ–°å¼€å§‹å¤„ç†æ›´æ–°æ“ä½œ</li>
</ol>
<p><strong>æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong>ï¼š</p>
<ul>
<li>å¯¹äºé«˜å¹¶å‘ç³»ç»Ÿï¼Œé€‚å½“å¢å¤§ redo log æ–‡ä»¶å¤§å°éå¸¸é‡è¦</li>
<li>é¿å…é¢‘ç¹è§¦å‘&quot;æ–‡ä»¶å†™æ»¡&quot;å¯¼è‡´çš„ç³»ç»Ÿé˜»å¡</li>
</ul>
<h2 id="binlogï¼šæ•°æ®åº“çš„-å…¨ç¨‹å½•åƒ">binlogï¼šæ•°æ®åº“çš„&quot;å…¨ç¨‹å½•åƒ&quot;</h2>
<p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº† undo logï¼ˆåæ‚”è¯ï¼‰å’Œ redo logï¼ˆå¤‡ä»½ä¿é™©ï¼‰ï¼Œç°åœ¨è®©æˆ‘ä»¬è®¤è¯†ç¬¬ä¸‰ä¸ªé‡è¦è§’è‰²ï¼šbinlogï¼Œå¯ä»¥æŠŠå®ƒç†è§£ä¸ºæ•°æ®åº“çš„&quot;å…¨ç¨‹å½•åƒ&quot;æˆ–&quot;æ“ä½œè®°å½•æœ¬&quot;ã€‚</p>
<h3 id="binlog-çš„ä½œç”¨ï¼šä¸ºä»€ä¹ˆéœ€è¦-å…¨ç¨‹å½•åƒ-ï¼Ÿ">binlog çš„ä½œç”¨ï¼šä¸ºä»€ä¹ˆéœ€è¦&quot;å…¨ç¨‹å½•åƒ&quot;ï¼Ÿ</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„æœ‹å‹å‘ä½ å€Ÿäº†ä¸€æœ¬çè´µçš„ä¹¦ï¼Œä¸ºäº†é˜²æ­¢æ„å¤–ï¼Œä½ å¯èƒ½ä¼šï¼š</p>
<ol>
<li>ğŸ“ è®°å½•ä¸‹è°å€Ÿäº†ä»€ä¹ˆä¹¦ï¼ˆæ“ä½œè®°å½•ï¼‰</li>
<li>ğŸ• è®°å½•å€Ÿä¹¦çš„æ—¶é—´</li>
<li>ğŸ“„ è®°å½•ä¹¦çš„å…·ä½“ä¿¡æ¯</li>
</ol>
<p><strong>binlog å°±åƒè¿™ä¸ªå€Ÿä¹¦è®°å½•æœ¬</strong>ï¼Œå®ƒè¯¦ç»†è®°å½•äº†æ•°æ®åº“ä¸­å‘ç”Ÿçš„æ¯ä¸€ä¸ªæ•°æ®å˜æ›´æ“ä½œï¼š</p>
<ul>
<li>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œäº†ä»€ä¹ˆ SQL è¯­å¥</li>
<li>å“ªäº›æ•°æ®è¢«ä¿®æ”¹äº†</li>
<li>ä¿®æ”¹å‰åçš„å…·ä½“å†…å®¹</li>
</ul>
<h3 id="binlog-ä¸-redo-log-çš„åŒºåˆ«ï¼šä¸ºä»€ä¹ˆéœ€è¦ä¸¤å¥—æ—¥å¿—ï¼Ÿ">binlog ä¸ redo log çš„åŒºåˆ«ï¼šä¸ºä»€ä¹ˆéœ€è¦ä¸¤å¥—æ—¥å¿—ï¼Ÿ</h3>
<p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šæ—¢ç„¶æœ‰äº† redo logï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ binlogï¼Ÿè¿™å…¶å®æ˜¯ MySQL å†å²å‘å±•çš„ç»“æœã€‚</p>
<p><strong>å†å²èƒŒæ™¯</strong>ï¼š</p>
<ul>
<li>æœ€åˆçš„ MySQL ä½¿ç”¨ MyISAM å­˜å‚¨å¼•æ“ï¼Œåªæœ‰ binlog</li>
<li>åæ¥å¼•å…¥ InnoDB å¼•æ“ï¼Œå¸¦æ¥äº† redo log</li>
<li>ä¸¤ä¸ªæ—¥å¿—ç³»ç»Ÿå„æœ‰ç‰¹è‰²ï¼Œäº’ç›¸è¡¥å……</li>
</ul>
<p><strong>å››å¤§å…³é”®åŒºåˆ«</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å¯¹æ¯”ç»´åº¦</th>
<th>redo log</th>
<th>binlog</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å½’å±</strong></td>
<td>InnoDB å­˜å‚¨å¼•æ“ä¸“ç”¨</td>
<td>MySQL Server å±‚ï¼Œæ‰€æœ‰å¼•æ“å…±ç”¨</td>
</tr>
<tr>
<td><strong>ç”¨é€”</strong></td>
<td>å´©æºƒæ¢å¤ï¼ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼‰</td>
<td>æ•°æ®å¤‡ä»½ã€ä¸»ä»å¤åˆ¶</td>
</tr>
<tr>
<td><strong>å†™å…¥æ–¹å¼</strong></td>
<td>å¾ªç¯å†™ï¼ˆè¦†ç›–æ—§æ•°æ®ï¼‰</td>
<td>è¿½åŠ å†™ï¼ˆä¿ç•™å…¨éƒ¨å†å²ï¼‰</td>
</tr>
<tr>
<td><strong>æ—¥å¿—ç±»å‹</strong></td>
<td>ç‰©ç†æ—¥å¿—ï¼ˆé¡µé¢çº§ä¿®æ”¹ï¼‰</td>
<td>é€»è¾‘æ—¥å¿—ï¼ˆSQL è¯­å¥çº§ï¼‰</td>
</tr>
</tbody>
</table>
<h3 id="binlog-çš„ä¸‰ç§è®°å½•æ ¼å¼">binlog çš„ä¸‰ç§è®°å½•æ ¼å¼</h3>
<p>binlog æä¾›äº†ä¸‰ç§è®°å½•æ ¼å¼ï¼Œå°±åƒä¸åŒçš„æ‘„åƒæ–¹å¼ï¼š</p>
<h4 id="1-STATEMENT-æ ¼å¼ï¼ˆè¯­å¥è®°å½•ï¼‰">1. STATEMENT æ ¼å¼ï¼ˆè¯­å¥è®°å½•ï¼‰</h4>
<p><strong>è®°å½•å†…å®¹</strong>ï¼šå®Œæ•´çš„ SQL è¯­å¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- binlog ä¸­è®°å½•çš„å†…å®¹</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ—¥å¿—æ–‡ä»¶å°ï¼Œè®°å½•ç®€æ´<br>
<strong>ç¼ºç‚¹</strong>ï¼šé‡åˆ° <code>NOW()</code>ã€<code>UUID()</code> ç­‰å‡½æ•°æ—¶ï¼Œä¸»ä»åº“æ‰§è¡Œç»“æœå¯èƒ½ä¸ä¸€è‡´</p>
<h4 id="2-ROW-æ ¼å¼ï¼ˆè¡Œè®°å½•ï¼‰â­">2. ROW æ ¼å¼ï¼ˆè¡Œè®°å½•ï¼‰â­</h4>
<p><strong>è®°å½•å†…å®¹</strong>ï¼šæ¯ä¸€è¡Œæ•°æ®çš„å…·ä½“å˜åŒ–</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è®°å½•çš„æ˜¯å…·ä½“æ•°æ®å˜åŒ–</span></span><br><span class="line"><span class="comment">-- ç”¨æˆ·ID=1çš„ä½™é¢ä»1000å˜æˆ900</span></span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ•°æ®ä¸€è‡´æ€§æœ€å¥½ï¼Œä¸ä¼šæœ‰å‡½æ•°å¯¼è‡´çš„é—®é¢˜<br>
<strong>ç¼ºç‚¹</strong>ï¼šæ‰¹é‡æ“ä½œæ—¶æ—¥å¿—æ–‡ä»¶ä¼šå¾ˆå¤§</p>
<h4 id="3-MIXED-æ ¼å¼ï¼ˆæ··åˆæ¨¡å¼ï¼‰">3. MIXED æ ¼å¼ï¼ˆæ··åˆæ¨¡å¼ï¼‰</h4>
<p><strong>æ™ºèƒ½é€‰æ‹©</strong>ï¼šæ ¹æ® SQL è¯­å¥çš„ç±»å‹è‡ªåŠ¨é€‰æ‹© STATEMENT æˆ– ROW æ ¼å¼</p>
<blockquote>
<p>ğŸ’¡ <strong>ç‰ˆæœ¬æç¤º</strong>ï¼šMySQL 5.7.7 ä¹‹å‰é»˜è®¤æ˜¯ STATEMENTï¼Œä¹‹åé»˜è®¤æ˜¯ ROW</p>
</blockquote>
<h3 id="æ•°æ®æ¢å¤ï¼šbinlog-vs-redo-log">æ•°æ®æ¢å¤ï¼šbinlog vs redo log</h3>
<p><strong>åœºæ™¯ï¼šæ•°æ®åº“è¢«è¯¯åˆ äº†ï¼Œèƒ½ç”¨ redo log æ¢å¤å—ï¼Ÿ</strong></p>
<p>âŒ <strong>ä¸èƒ½ç”¨ redo log æ¢å¤</strong></p>
<ul>
<li>redo log æ˜¯å¾ªç¯å†™ï¼Œæ—§æ•°æ®ä¼šè¢«è¦†ç›–</li>
<li>åªä¿å­˜æœªåˆ·ç›˜çš„æœ€æ–°æ•°æ®</li>
</ul>
<p>âœ… <strong>åªèƒ½ç”¨ binlog æ¢å¤</strong></p>
<ul>
<li>binlog ä¿å­˜äº†æ‰€æœ‰å†å²æ“ä½œ</li>
<li>å¯ä»¥é‡æ–°&quot;æ’­æ”¾&quot;æ‰€æœ‰æ•°æ®å˜æ›´</li>
</ul>
<p>è¿™å°±åƒï¼š</p>
<ul>
<li>redo log æ˜¯&quot;æœ€è¿‘é€šè¯è®°å½•&quot;ï¼ˆåªä¿å­˜æœ€æ–°çš„å‡ æ¡ï¼‰</li>
<li>binlog æ˜¯&quot;å®Œæ•´é€šè¯å½•éŸ³&quot;ï¼ˆä¿å­˜æ‰€æœ‰å†…å®¹ï¼‰</li>
</ul>
<h3 id="ä¸»ä»å¤åˆ¶ï¼šbinlog-çš„é‡è¦åº”ç”¨">ä¸»ä»å¤åˆ¶ï¼šbinlog çš„é‡è¦åº”ç”¨</h3>
<p>MySQL çš„ä¸»ä»å¤åˆ¶ä¾èµ–äº binlogï¼Œä¹Ÿå°±æ˜¯è®°å½• MySQL ä¸Šçš„æ‰€æœ‰å˜åŒ–å¹¶ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸Šã€‚å¤åˆ¶çš„è¿‡ç¨‹å°±æ˜¯å°† binlog ä¸­çš„æ•°æ®ä»ä¸»åº“ä¼ è¾“åˆ°ä»åº“ä¸Šã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸€èˆ¬æ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“ä¸Šæ‰§è¡Œäº‹åŠ¡æ“ä½œçš„çº¿ç¨‹ä¸ä¼šç­‰å¾…å¤åˆ¶ binlog çš„çº¿ç¨‹åŒæ­¥å®Œæˆã€‚</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968131560.png" alt="1747968131560"></p>
<p>MySQL é›†ç¾¤çš„ä¸»ä»å¤åˆ¶è¿‡ç¨‹æ¢³ç†æˆ 3 ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><strong>å†™å…¥ Binlog</strong>ï¼šä¸»åº“å†™ binlog æ—¥å¿—ï¼Œæäº¤äº‹åŠ¡ï¼Œå¹¶æ›´æ–°æœ¬åœ°å­˜å‚¨æ•°æ®ã€‚</li>
<li><strong>åŒæ­¥ Binlog</strong>ï¼šæŠŠ binlog å¤åˆ¶åˆ°æ‰€æœ‰ä»åº“ä¸Šï¼Œæ¯ä¸ªä»åº“æŠŠ binlog å†™åˆ°æš‚å­˜æ—¥å¿—ä¸­ã€‚</li>
<li><strong>å›æ”¾ Binlog</strong>ï¼šå›æ”¾ binlogï¼Œå¹¶æ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ã€‚</li>
</ul>
<p>å…·ä½“è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>MySQL ä¸»åº“åœ¨æ”¶åˆ°å®¢æˆ·ç«¯æäº¤äº‹åŠ¡çš„è¯·æ±‚ä¹‹åï¼Œä¼šå…ˆå†™å…¥ binlogï¼Œå†æäº¤äº‹åŠ¡ï¼Œæ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ï¼Œäº‹åŠ¡æäº¤å®Œæˆåï¼Œè¿”å›ç»™å®¢æˆ·ç«¯â€œæ“ä½œæˆåŠŸâ€çš„å“åº”ã€‚</li>
<li>ä»åº“ä¼šåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ I/O çº¿ç¨‹ï¼Œè¿æ¥ä¸»åº“çš„ log dump çº¿ç¨‹ï¼Œæ¥æ¥æ”¶ä¸»åº“çš„ binlog æ—¥å¿—ï¼Œå†æŠŠ binlog ä¿¡æ¯å†™å…¥ relay log çš„ä¸­ç»§æ—¥å¿—é‡Œï¼Œå†è¿”å›ç»™ä¸»åº“â€œå¤åˆ¶æˆåŠŸâ€çš„å“åº”ã€‚</li>
<li>ä»åº“ä¼šåˆ›å»ºä¸€ä¸ªç”¨äºå›æ”¾ binlog çš„çº¿ç¨‹ï¼Œå»è¯» relay log ä¸­ç»§æ—¥å¿—ï¼Œç„¶åå›æ”¾ binlog æ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ï¼Œæœ€ç»ˆå®ç°ä¸»ä»çš„æ•°æ®ä¸€è‡´æ€§ã€‚</li>
</ul>
<p>åœ¨å®Œæˆä¸»ä»å¤åˆ¶ä¹‹åï¼Œä½ å°±å¯ä»¥åœ¨å†™æ•°æ®æ—¶åªå†™ä¸»åº“ï¼Œåœ¨è¯»æ•°æ®æ—¶åªè¯»ä»åº“ï¼Œè¿™æ ·å³ä½¿å†™è¯·æ±‚ä¼šé”è¡¨æˆ–è€…é”è®°å½•ï¼Œä¹Ÿä¸ä¼šå½±å“è¯»è¯·æ±‚çš„æ‰§è¡Œã€‚</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968138828.png" alt="1747968138828"></p>
<blockquote>
<p>ä»åº“æ˜¯ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Ÿ</p>
</blockquote>
<p>ä¸æ˜¯çš„ã€‚</p>
<p>å› ä¸ºä»åº“æ•°é‡å¢åŠ ï¼Œä»åº“è¿æ¥ä¸Šæ¥çš„ I/O çº¿ç¨‹ä¹Ÿæ¯”è¾ƒå¤šï¼Œ<strong>ä¸»åº“ä¹Ÿè¦åˆ›å»ºåŒæ ·å¤šçš„ log dump çº¿ç¨‹æ¥å¤„ç†å¤åˆ¶çš„è¯·æ±‚ï¼Œå¯¹ä¸»åº“èµ„æºæ¶ˆè€—æ¯”è¾ƒé«˜ï¼ŒåŒæ—¶è¿˜å—é™äºä¸»åº“çš„ç½‘ç»œå¸¦å®½</strong>ã€‚</p>
<p>æ‰€ä»¥åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸€ä¸ªä¸»åº“ä¸€èˆ¬è·Ÿ 2 ï½ 3 ä¸ªä»åº“ï¼ˆ1 å¥—æ•°æ®åº“ï¼Œ1 ä¸» 2 ä» 1 å¤‡ä¸»ï¼‰ï¼Œè¿™å°±æ˜¯ä¸€ä¸»å¤šä»çš„ MySQL é›†ç¾¤ç»“æ„ã€‚</p>
<blockquote>
<p>MySQL ä¸»ä»å¤åˆ¶è¿˜æœ‰å“ªäº›æ¨¡å‹ï¼Ÿ</p>
</blockquote>
<p>ä¸»è¦æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li><strong>åŒæ­¥å¤åˆ¶</strong>ï¼šMySQL ä¸»åº“æäº¤äº‹åŠ¡çš„çº¿ç¨‹è¦ç­‰å¾…æ‰€æœ‰ä»åº“çš„å¤åˆ¶æˆåŠŸå“åº”ï¼Œæ‰è¿”å›å®¢æˆ·ç«¯ç»“æœã€‚è¿™ç§æ–¹å¼åœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒåŸºæœ¬ä¸Šæ²¡æ³•ç”¨ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯æ€§èƒ½å¾ˆå·®ï¼Œå› ä¸ºè¦å¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹æ‰è¿”å›å“åº”ï¼›äºŒæ˜¯å¯ç”¨æ€§ä¹Ÿå¾ˆå·®ï¼Œä¸»åº“å’Œæ‰€æœ‰ä»åº“ä»»ä½•ä¸€ä¸ªæ•°æ®åº“å‡ºé—®é¢˜ï¼Œéƒ½ä¼šå½±å“ä¸šåŠ¡ã€‚</li>
<li><strong>å¼‚æ­¥å¤åˆ¶</strong>ï¼ˆé»˜è®¤æ¨¡å‹ï¼‰ï¼šMySQL ä¸»åº“æäº¤äº‹åŠ¡çš„çº¿ç¨‹å¹¶ä¸ä¼šç­‰å¾… binlog åŒæ­¥åˆ°å„ä»åº“ï¼Œå°±è¿”å›å®¢æˆ·ç«¯ç»“æœã€‚è¿™ç§æ¨¡å¼ä¸€æ—¦ä¸»åº“å®•æœºï¼Œæ•°æ®å°±ä¼šå‘ç”Ÿä¸¢å¤±ã€‚</li>
<li><strong>åŠåŒæ­¥å¤åˆ¶</strong>ï¼šMySQL 5.7 ç‰ˆæœ¬ä¹‹åå¢åŠ çš„ä¸€ç§å¤åˆ¶æ–¹å¼ï¼Œä»‹äºä¸¤è€…ä¹‹é—´ï¼Œäº‹åŠ¡çº¿ç¨‹ä¸ç”¨ç­‰å¾…æ‰€æœ‰çš„ä»åº“å¤åˆ¶æˆåŠŸå“åº”ï¼Œåªè¦ä¸€éƒ¨åˆ†å¤åˆ¶æˆåŠŸå“åº”å›æ¥å°±è¡Œï¼Œæ¯”å¦‚ä¸€ä¸»äºŒä»çš„é›†ç¾¤ï¼Œåªè¦æ•°æ®æˆåŠŸå¤åˆ¶åˆ°ä»»æ„ä¸€ä¸ªä»åº“ä¸Šï¼Œä¸»åº“çš„äº‹åŠ¡çº¿ç¨‹å°±å¯ä»¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ç§<strong>åŠåŒæ­¥å¤åˆ¶çš„æ–¹å¼ï¼Œå…¼é¡¾äº†å¼‚æ­¥å¤åˆ¶å’ŒåŒæ­¥å¤åˆ¶çš„ä¼˜ç‚¹ï¼Œå³ä½¿å‡ºç°ä¸»åº“å®•æœºï¼Œè‡³å°‘è¿˜æœ‰ä¸€ä¸ªä»åº“æœ‰æœ€æ–°çš„æ•°æ®ï¼Œä¸å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©</strong>ã€‚</li>
</ul>
<h3 id="binlog-ä»€ä¹ˆæ—¶å€™åˆ·ç›˜ï¼Ÿ">binlog ä»€ä¹ˆæ—¶å€™åˆ·ç›˜ï¼Ÿ</h3>
<p>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ° binlog cacheï¼ˆServer å±‚çš„ cacheï¼‰ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠ binlog cache å†™åˆ° binlog æ–‡ä»¶ä¸­ã€‚</p>
<p>MySQL ç»™ binlog cache åˆ†é…äº†ä¸€ç‰‡å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼Œå‚æ•° binlog_cache_size ç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†… binlog cache æ‰€å å†…å­˜çš„å¤§å°ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ—¶å€™ binlog cache ä¼šå†™åˆ° binlog æ–‡ä»¶ï¼Ÿ</p>
</blockquote>
<p>åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨æŠŠ binlog cache é‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ° binlog æ–‡ä»¶ä¸­ï¼Œå¹¶æ¸…ç©º binlog cacheã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968148748.png" alt="1747968148748"></p>
<p>è™½ç„¶æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·± binlog cacheï¼Œä½†æ˜¯æœ€ç»ˆéƒ½å†™åˆ°åŒä¸€ä¸ª binlog æ–‡ä»¶ï¼š</p>
<ul>
<li>å›¾ä¸­çš„ writeï¼ŒæŒ‡çš„å°±æ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ° binlog æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå› ä¸ºæ•°æ®è¿˜ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ page cache é‡Œï¼Œwrite çš„å†™å…¥é€Ÿåº¦è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œå› ä¸ºä¸æ¶‰åŠç£ç›˜ I/Oã€‚</li>
<li>å›¾ä¸­çš„ fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œï¼Œè¿™é‡Œå°±ä¼šæ¶‰åŠç£ç›˜ I/Oï¼Œæ‰€ä»¥é¢‘ç¹çš„ fsync ä¼šå¯¼è‡´ç£ç›˜çš„ I/O å‡é«˜ã€‚</li>
</ul>
<p>MySQL æä¾›ä¸€ä¸ª sync_binlog å‚æ•°æ¥æ§åˆ¶æ•°æ®åº“çš„ binlog åˆ·åˆ°ç£ç›˜ä¸Šçš„é¢‘ç‡ï¼š</p>
<ul>
<li>sync_binlog = 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª writeï¼Œä¸ fsyncï¼Œåç»­äº¤ç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li>
<li>sync_binlog = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼š writeï¼Œç„¶åé©¬ä¸Šæ‰§è¡Œ fsyncï¼›</li>
<li>sync_binlog = N(N&gt;1) çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ writeï¼Œä½†ç´¯ç§¯ N ä¸ªäº‹åŠ¡åæ‰ fsyncã€‚</li>
</ul>
<p>åœ¨ MySQL ä¸­ç³»ç»Ÿé»˜è®¤çš„è®¾ç½®æ˜¯ sync_binlog = 1ï¼Œæ˜¯æœ€å®‰å…¨ä½†æ˜¯æ€§èƒ½æŸè€—æœ€å¤§çš„è®¾ç½®ã€‚å› ä¸ºå½“è®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œå³ä½¿ä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œæœ€å¤šä¸¢å¤±ä¸€ä¸ªäº‹åŠ¡çš„ binlogï¼Œè€Œå·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ•°æ®å°±ä¸ä¼šæœ‰å½±å“ï¼Œä¸è¿‡å°±æ˜¯å¯¹å†™å…¥æ€§èƒ½å½±å“å¤ªå¤§ã€‚</p>
<p>è€Œå½“ sync_binlog è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ä¸åšä»»ä½•å¼ºåˆ¶æ€§çš„ç£ç›˜åˆ·æ–°æŒ‡ä»¤ï¼Œè¿™æ—¶å€™çš„æ€§èƒ½æ˜¯æœ€å¥½çš„ï¼Œä½†æ˜¯é£é™©ä¹Ÿæ˜¯æœ€å¤§çš„ã€‚å› ä¸ºä¸€æ—¦ä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œè¿˜æ²¡æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚</p>
<p>å¦‚æœèƒ½å®¹å¿å°‘é‡äº‹åŠ¡çš„ binlog æ—¥å¿—å­˜åœ¨ä¸¢å¤±é£é™©çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶ä¸ºäº†æé«˜å†™å…¥çš„æ€§èƒ½ï¼Œä¸€èˆ¬å¯ä»¥å°† sync_binlog è®¾ç½®ä¸º 100~1000 ä¸­çš„æŸä¸ªæ•°å€¼ã€‚</p>
<blockquote>
<p>ä¸‰ä¸ªæ—¥å¿—è®²å®Œäº†ï¼Œè‡³æ­¤æˆ‘ä»¬å¯ä»¥å…ˆå°ç»“ä¸‹ï¼Œupdate è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
</blockquote>
<p>å½“ä¼˜åŒ–å™¨åˆ†æå‡ºæˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’åï¼Œæ‰§è¡Œå™¨å°±æŒ‰ç…§æ‰§è¡Œè®¡åˆ’å¼€å§‹è¿›è¡Œæ›´æ–°æ“ä½œã€‚</p>
<p>å…·ä½“æ›´æ–°ä¸€æ¡è®°å½• <code>UPDATE t_user SET name = 'xiaolin' WHERE id = 1;</code> çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰§è¡Œå™¨è´Ÿè´£å…·ä½“æ‰§è¡Œï¼Œä¼šè°ƒç”¨å­˜å‚¨å¼•æ“çš„æ¥å£ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ ‘æœç´¢è·å– id = 1 è¿™ä¸€è¡Œè®°å½•ï¼š
<ul>
<li>å¦‚æœ id=1 è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨ buffer pool ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨æ›´æ–°ï¼›</li>
<li>å¦‚æœè®°å½•ä¸åœ¨ buffer poolï¼Œå°†æ•°æ®é¡µä»ç£ç›˜è¯»å…¥åˆ° buffer poolï¼Œè¿”å›è®°å½•ç»™æ‰§è¡Œå™¨ã€‚</li>
</ul>
</li>
<li>æ‰§è¡Œå™¨å¾—åˆ°èšç°‡ç´¢å¼•è®°å½•åï¼Œä¼šçœ‹ä¸€ä¸‹æ›´æ–°å‰çš„è®°å½•å’Œæ›´æ–°åçš„è®°å½•æ˜¯å¦ä¸€æ ·ï¼š
<ul>
<li>å¦‚æœä¸€æ ·çš„è¯å°±ä¸è¿›è¡Œåç»­æ›´æ–°æµç¨‹ï¼›</li>
<li>å¦‚æœä¸ä¸€æ ·çš„è¯å°±æŠŠæ›´æ–°å‰çš„è®°å½•å’Œæ›´æ–°åçš„è®°å½•éƒ½å½“ä½œå‚æ•°ä¼ ç»™ InnoDB å±‚ï¼Œè®© InnoDB çœŸæ­£çš„æ‰§è¡Œæ›´æ–°è®°å½•çš„æ“ä½œï¼›</li>
</ul>
</li>
<li>å¼€å¯äº‹åŠ¡ï¼ŒInnoDB å±‚æ›´æ–°è®°å½•å‰ï¼Œé¦–å…ˆè¦è®°å½•ç›¸åº”çš„ undo logï¼Œå› ä¸ºè¿™æ˜¯æ›´æ–°æ“ä½œï¼Œéœ€è¦æŠŠè¢«æ›´æ–°çš„åˆ—çš„æ—§å€¼è®°ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¦ç”Ÿæˆä¸€æ¡ undo logï¼Œundo log ä¼šå†™å…¥ Buffer Pool ä¸­çš„ Undo é¡µé¢ï¼Œä¸è¿‡åœ¨å†…å­˜ä¿®æ”¹è¯¥ Undo é¡µé¢åï¼Œéœ€è¦è®°å½•å¯¹åº”çš„ redo logã€‚</li>
<li>InnoDB å±‚å¼€å§‹æ›´æ–°è®°å½•ï¼Œä¼šå…ˆæ›´æ–°å†…å­˜ï¼ˆåŒæ—¶æ ‡è®°ä¸ºè„é¡µï¼‰ï¼Œç„¶åå°†è®°å½•å†™åˆ° redo log é‡Œé¢ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚ä¸ºäº†å‡å°‘ç£ç›˜ I/Oï¼Œä¸ä¼šç«‹å³å°†è„é¡µå†™å…¥ç£ç›˜ï¼Œåç»­ç”±åå°çº¿ç¨‹é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ—¶æœºå°†è„é¡µå†™å…¥åˆ°ç£ç›˜ã€‚è¿™å°±æ˜¯ <strong>WAL æŠ€æœ¯</strong>ï¼ŒMySQL çš„å†™æ“ä½œå¹¶ä¸æ˜¯ç«‹åˆ»å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆå†™ redo æ—¥å¿—ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å†å°†ä¿®æ”¹çš„è¡Œæ•°æ®å†™åˆ°ç£ç›˜ä¸Šã€‚</li>
<li>è‡³æ­¤ï¼Œä¸€æ¡è®°å½•æ›´æ–°å®Œäº†ã€‚</li>
<li>åœ¨ä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œç„¶åå¼€å§‹è®°å½•è¯¥è¯­å¥å¯¹åº”çš„ binlogï¼Œæ­¤æ—¶è®°å½•çš„ binlog ä¼šè¢«ä¿å­˜åˆ° binlog cacheï¼Œå¹¶æ²¡æœ‰åˆ·æ–°åˆ°ç¡¬ç›˜ä¸Šçš„ binlog æ–‡ä»¶ï¼Œåœ¨äº‹åŠ¡æäº¤æ—¶æ‰ä¼šç»Ÿä¸€å°†è¯¥äº‹åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ binlog åˆ·æ–°åˆ°ç¡¬ç›˜ã€‚</li>
<li>äº‹åŠ¡æäº¤ï¼Œå‰©ä¸‹çš„å°±æ˜¯ã€Œä¸¤é˜¶æ®µæäº¤ã€çš„äº‹æƒ…äº†ï¼Œæ¥ä¸‹æ¥å°±è®²è¿™ä¸ªã€‚</li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤ï¼Ÿ</h2>
<p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä½ åœ¨é“¶è¡Œè½¬è´¦ï¼Œéœ€è¦åŒæ—¶åšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>åœ¨ä½ çš„è´¦æˆ·è®°å½•ä¸­å‡å°‘ 100 å…ƒ</li>
<li>åœ¨æœ‹å‹çš„è´¦æˆ·è®°å½•ä¸­å¢åŠ  100 å…ƒ</li>
</ol>
<p><strong>å¦‚æœé“¶è¡Œç³»ç»Ÿåœ¨å®Œæˆç¬¬ä¸€æ­¥åçªç„¶å®•æœºï¼Œè€Œç¬¬äºŒæ­¥è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li>ä½ çš„é’±æ²¡äº†ï¼ˆä½ çš„è´¦æˆ·å‡å°‘äº† 100 å…ƒï¼‰</li>
<li>æœ‹å‹æ²¡æ”¶åˆ°é’±ï¼ˆæœ‹å‹çš„è´¦æˆ·æ²¡æœ‰å¢åŠ ï¼‰</li>
<li>è¿™ 100 å…ƒå°±&quot;è’¸å‘&quot;äº†ï¼</li>
</ul>
<p><strong>MySQL é¢ä¸´çš„ä¹Ÿæ˜¯ç±»ä¼¼é—®é¢˜</strong>ã€‚å½“äº‹åŠ¡æäº¤æ—¶ï¼Œéœ€è¦åŒæ—¶å†™å…¥ä¸¤ä¸ªæ—¥å¿—ï¼š</p>
<ul>
<li><strong>redo log</strong>ï¼šä¿è¯ä¸»åº“æ•°æ®çš„æŒä¹…æ€§</li>
<li><strong>binlog</strong>ï¼šç”¨äºä¸»ä»å¤åˆ¶ï¼Œä¿è¯ä»åº“æ•°æ®ä¸€è‡´</li>
</ul>
<p>å¦‚æœè¿™ä¸¤ä¸ªæ“ä½œå‡ºç°&quot;åŠæˆåŠŸ&quot;çŠ¶æ€ï¼Œå°±ä¼šå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<h3 id="é—®é¢˜å®ä¾‹ï¼šä¸»ä»æ•°æ®ä¸ä¸€è‡´">é—®é¢˜å®ä¾‹ï¼šä¸»ä»æ•°æ®ä¸ä¸€è‡´</h3>
<p>å‡è®¾æ‰§è¡Œè¿™æ¡æ›´æ–°è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> t_user <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;xiaolin&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- åŸå€¼ï¼šname = &#x27;jay&#x27;</span></span><br><span class="line"><span class="comment">-- æ–°å€¼ï¼šname = &#x27;xiaolin&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>æƒ…å†µä¸€ï¼šredo log å†™å…¥æˆåŠŸï¼Œbinlog å†™å…¥å¤±è´¥</strong></p>
<ul>
<li>ä¸»åº“ï¼šé€šè¿‡ redo log æ¢å¤ï¼Œname = â€˜xiaolinâ€™ âœ…</li>
<li>ä»åº“ï¼šæ²¡æœ‰æ”¶åˆ° binlogï¼Œname = â€˜jayâ€™ âŒ</li>
<li><strong>ç»“æœ</strong>ï¼šä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<p><strong>æƒ…å†µäºŒï¼šbinlog å†™å…¥æˆåŠŸï¼Œredo log å†™å…¥å¤±è´¥</strong></p>
<ul>
<li>ä¸»åº“ï¼šredo log ä¸¢å¤±ï¼Œäº‹åŠ¡å›æ»šï¼Œname = â€˜jayâ€™ âŒ</li>
<li>ä»åº“ï¼šæ”¶åˆ° binlog å¹¶æ‰§è¡Œï¼Œname = â€˜xiaolinâ€™ âœ…</li>
<li><strong>ç»“æœ</strong>ï¼šä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<h3 id="è§£å†³æ–¹æ¡ˆï¼šä¸¤é˜¶æ®µæäº¤">è§£å†³æ–¹æ¡ˆï¼šä¸¤é˜¶æ®µæäº¤</h3>
<p><strong>ä¸¤é˜¶æ®µæäº¤å°±åƒä¸€ä¸ª&quot;åŒé‡ç¡®è®¤&quot;æœºåˆ¶</strong>ï¼Œç¡®ä¿ redo log å’Œ binlog è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæŠŠäº‹åŠ¡æäº¤æ‹†åˆ†æˆä¸¤ä¸ªé˜¶æ®µ</p>
<ul>
<li><strong>å‡†å¤‡é˜¶æ®µï¼ˆPrepareï¼‰</strong>ï¼šæ‰€æœ‰å‚ä¸è€…å‡†å¤‡å°±ç»ª</li>
<li><strong>æäº¤é˜¶æ®µï¼ˆCommitï¼‰</strong>ï¼šåè°ƒè€…å®£å¸ƒæ­£å¼æäº¤</li>
</ul>
<h3 id="ç”Ÿæ´»åŒ–æ¯”å–»ï¼šç»“å©šä»ªå¼">ç”Ÿæ´»åŒ–æ¯”å–»ï¼šç»“å©šä»ªå¼</h3>
<p>æƒ³è±¡ä¸€åœºå©šç¤¼ï¼Œéœ€è¦æ–°éƒå’Œæ–°å¨˜éƒ½åŒæ„æ‰èƒ½å®Œæˆï¼š</p>
<p><strong>å‡†å¤‡é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ç‰§å¸ˆé—®æ–°éƒï¼šâ€œä½ æ„¿æ„å—ï¼Ÿâ€</li>
<li>ç‰§å¸ˆé—®æ–°å¨˜ï¼šâ€œä½ æ„¿æ„å—ï¼Ÿâ€</li>
<li>åªæœ‰ä¸¤äººéƒ½è¯´&quot;æˆ‘æ„¿æ„&quot;ï¼Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µ</li>
</ul>
<p><strong>æäº¤é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>å¦‚æœä¸¤äººéƒ½åŒæ„ï¼šç‰§å¸ˆå®£å¸ƒ&quot;ä½ ä»¬ç°åœ¨æ˜¯å¤«å¦»äº†&quot;</li>
<li>å¦‚æœä»»ä½•ä¸€äººæ‹’ç»ï¼šä»ªå¼å–æ¶ˆ</li>
</ul>
<p>åœ¨ MySQL ä¸­ï¼š</p>
<ul>
<li><strong>æ–°éƒ</strong> = redo log</li>
<li><strong>æ–°å¨˜</strong> = binlog</li>
<li><strong>ç‰§å¸ˆ</strong> = äº‹åŠ¡åè°ƒè€…</li>
<li><strong>ç»“å©šè¯ä¹¦</strong> = äº‹åŠ¡æäº¤æˆåŠŸ</li>
</ul>
<h3 id="ä¸¤é˜¶æ®µæäº¤çš„è¯¦ç»†è¿‡ç¨‹">ä¸¤é˜¶æ®µæäº¤çš„è¯¦ç»†è¿‡ç¨‹</h3>
<p>åœ¨ MySQL ä¸­ï¼Œä¸¤é˜¶æ®µæäº¤ä½¿ç”¨<strong>å†…éƒ¨ XA äº‹åŠ¡</strong>æ¥å®ç°ï¼š</p>
<ul>
<li><strong>åè°ƒè€…</strong>ï¼šbinlog</li>
<li><strong>å‚ä¸è€…</strong>ï¼šInnoDB å­˜å‚¨å¼•æ“ï¼ˆredo logï¼‰</li>
</ul>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968172124.png" alt="1747968172124"></p>
<p><strong>å…·ä½“æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<h4 id="å‡†å¤‡é˜¶æ®µï¼ˆPrepare-Phaseï¼‰">å‡†å¤‡é˜¶æ®µï¼ˆPrepare Phaseï¼‰</h4>
<ol>
<li><strong>ç”Ÿæˆäº‹åŠ¡ ID</strong>ï¼šä¸ºäº‹åŠ¡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ XIDï¼ˆäº‹åŠ¡æ ‡è¯†ç¬¦ï¼‰</li>
<li><strong>è®°å½• redo log</strong>ï¼šå°† XID å†™å…¥ redo logï¼Œå¹¶æ ‡è®°çŠ¶æ€ä¸º <code>prepare</code></li>
<li><strong>åˆ·ç›˜ä¿å­˜</strong>ï¼šå°† prepare çŠ¶æ€çš„ redo log æŒä¹…åŒ–åˆ°ç£ç›˜</li>
</ol>
<blockquote>
<p>ğŸ’¡ <strong>æ­¤æ—¶äº‹åŠ¡è¿˜æ²¡æœ‰æ­£å¼æäº¤</strong>ï¼Œåªæ˜¯è¡¨ç¤º redo log å‡†å¤‡å°±ç»ª</p>
</blockquote>
<h4 id="æäº¤é˜¶æ®µï¼ˆCommit-Phaseï¼‰">æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰</h4>
<ol>
<li><strong>è®°å½• binlog</strong>ï¼šå°†äº‹åŠ¡çš„ XID å’Œå…·ä½“æ“ä½œå†™å…¥ binlog</li>
<li><strong>binlog åˆ·ç›˜</strong>ï¼šå°† binlog æŒä¹…åŒ–åˆ°ç£ç›˜</li>
<li><strong>æœ€ç»ˆæäº¤</strong>ï¼šè°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£ï¼Œå°† redo log çŠ¶æ€æ”¹ä¸º <code>commit</code></li>
<li><strong>redo log åˆ·ç›˜</strong>ï¼šå°† commit çŠ¶æ€æŒä¹…åŒ–åˆ°ç£ç›˜</li>
</ol>
<blockquote>
<p>âœ… <strong>äº‹åŠ¡æ­£å¼æäº¤æˆåŠŸ</strong></p>
</blockquote>
<h3 id="å´©æºƒæ¢å¤ï¼šå¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼Ÿ">å´©æºƒæ¢å¤ï¼šå¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼Ÿ</h3>
<p><strong>å…³é”®æ—¶åˆ»çš„å´©æºƒåœºæ™¯</strong>ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968183453.png" alt="1747968183453"></p>
<p><strong>æ—¶åˆ» A å´©æºƒ</strong>ï¼ˆredo log å·²å†™ï¼Œbinlog æœªå†™ï¼‰ï¼š</p>
<ul>
<li>redo log çŠ¶æ€ï¼š<code>prepare</code></li>
<li>binlog çŠ¶æ€ï¼šæ— è®°å½•</li>
<li><strong>æ¢å¤ç­–ç•¥</strong>ï¼šå›æ»šäº‹åŠ¡ï¼ˆå› ä¸º binlog ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„ XIDï¼‰</li>
</ul>
<p><strong>æ—¶åˆ» B å´©æºƒ</strong>ï¼ˆredo log å’Œ binlog éƒ½å·²å†™ï¼Œä½†è¿˜æœªæ ‡è®° commitï¼‰ï¼š</p>
<ul>
<li>redo log çŠ¶æ€ï¼š<code>prepare</code></li>
<li>binlog çŠ¶æ€ï¼šæœ‰å¯¹åº”çš„ XID è®°å½•</li>
<li><strong>æ¢å¤ç­–ç•¥</strong>ï¼šæäº¤äº‹åŠ¡ï¼ˆå› ä¸º binlog ä¸­èƒ½æ‰¾åˆ°å¯¹åº”çš„ XIDï¼‰</li>
</ul>
<h3 id="æ¢å¤åˆ¤æ–­é€»è¾‘">æ¢å¤åˆ¤æ–­é€»è¾‘</h3>
<p>MySQL é‡å¯åçš„è‡ªåŠ¨æ¢å¤è¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. æ‰«æ redo log æ–‡ä»¶</span><br><span class="line">2. å‘ç°çŠ¶æ€ä¸º prepare çš„äº‹åŠ¡</span><br><span class="line">3. æå–è¯¥äº‹åŠ¡çš„ XID</span><br><span class="line">4. åœ¨ binlog ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åŒçš„ XID</span><br><span class="line">   â”œâ”€â”€ æ‰¾åˆ°äº† â†’ æäº¤äº‹åŠ¡ âœ…</span><br><span class="line">   â””â”€â”€ æ²¡æ‰¾åˆ° â†’ å›æ»šäº‹åŠ¡ âŒ</span><br></pre></td></tr></table></figure>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼š<strong>ä»¥ binlog å†™å…¥æˆåŠŸä¸ºå‡†</strong></p>
<ul>
<li>binlog å†™æˆåŠŸ = äº‹åŠ¡åº”è¯¥æäº¤ï¼ˆå› ä¸ºä»åº“ä¼šæ”¶åˆ°è¿™ä¸ªæ“ä½œï¼‰</li>
<li>binlog å†™å¤±è´¥ = äº‹åŠ¡åº”è¯¥å›æ»šï¼ˆä¿æŒä¸»ä»ä¸€è‡´ï¼‰</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆä»¥-binlog-ä¸ºå‡†ï¼Ÿ">ä¸ºä»€ä¹ˆä»¥ binlog ä¸ºå‡†ï¼Ÿ</h3>
<p><strong>åŸå› å¾ˆç®€å•</strong>ï¼š</p>
<ul>
<li>binlog ä¸€æ—¦å†™å…¥ï¼Œå°±ä¼šè¢«å¤åˆ¶åˆ°ä»åº“</li>
<li>ä»åº“ä¼šæ ¹æ® binlog æ‰§è¡Œç›¸åŒçš„æ“ä½œ</li>
<li>å¦‚æœä¸»åº“ä¸æäº¤è¿™ä¸ªäº‹åŠ¡ï¼Œå°±ä¼šé€ æˆä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<p><strong>æ‰€ä»¥å¿…é¡»ä¿è¯</strong>ï¼šä¸»åº“å’Œä»åº“çš„å¤„ç†ç­–ç•¥å®Œå…¨ä¸€è‡´</p>
<h3 id="ç‰¹æ®Šæƒ…å†µï¼šæœªæäº¤äº‹åŠ¡çš„-redo-log-åˆ·ç›˜">ç‰¹æ®Šæƒ…å†µï¼šæœªæäº¤äº‹åŠ¡çš„ redo log åˆ·ç›˜</h3>
<p><strong>ç–‘é—®</strong>ï¼šäº‹åŠ¡è¿˜æ²¡æäº¤ï¼Œredo log ä¼šè¢«æŒä¹…åŒ–å—ï¼Ÿ</p>
<p><strong>ç­”æ¡ˆ</strong>ï¼šä¼šçš„ï¼</p>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>redo log buffer ä¸­çš„å†…å®¹ä¼šè¢«åå°çº¿ç¨‹æ¯ç§’åˆ·ç›˜ä¸€æ¬¡</li>
<li>è¿™æ„å‘³ç€æœªæäº¤äº‹åŠ¡çš„ redo log ä¹Ÿå¯èƒ½åœ¨ç£ç›˜ä¸Š</li>
</ul>
<p><strong>å®‰å…¨ä¿éšœ</strong>ï¼š</p>
<ul>
<li>æœªæäº¤äº‹åŠ¡çš„ binlog ç»å¯¹ä¸ä¼šè¢«æŒä¹…åŒ–</li>
<li>MySQL é‡å¯æ—¶å‘ç°&quot;æœ‰ redo log ä½†æ—  binlog&quot;çš„äº‹åŠ¡ï¼Œä¼šè‡ªåŠ¨å›æ»š</li>
<li>æ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯</li>
</ul>
<p><strong>è®°å¿†è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… redo log å¯ä»¥åœ¨äº‹åŠ¡æäº¤å‰æŒä¹…åŒ–</li>
<li>âŒ binlog åªèƒ½åœ¨äº‹åŠ¡æäº¤åæŒä¹…åŒ–</li>
</ul>
<h2 id="ä¸¤é˜¶æ®µæäº¤æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ">ä¸¤é˜¶æ®µæäº¤æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>ä¸¤é˜¶æ®µæäº¤è™½ç„¶ä¿è¯äº†ä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢çš„å½±å“ï¼š</p>
<ul>
<li><strong>ç£ç›˜ I/O æ¬¡æ•°é«˜</strong>ï¼šå¯¹äºâ€œåŒ 1â€é…ç½®ï¼Œæ¯ä¸ªäº‹åŠ¡æäº¤éƒ½ä¼šè¿›è¡Œä¸¤æ¬¡ fsyncï¼ˆåˆ·ç›˜ï¼‰ï¼Œä¸€æ¬¡æ˜¯ redo log åˆ·ç›˜ï¼Œå¦ä¸€æ¬¡æ˜¯ binlog åˆ·ç›˜ã€‚</li>
<li><strong>é”ç«äº‰æ¿€çƒˆ</strong>ï¼šä¸¤é˜¶æ®µæäº¤è™½ç„¶èƒ½å¤Ÿä¿è¯ã€Œå•äº‹åŠ¡ã€ä¸¤ä¸ªæ—¥å¿—çš„å†…å®¹ä¸€è‡´ï¼Œä½†åœ¨ã€Œå¤šäº‹åŠ¡ã€çš„æƒ…å†µä¸‹ï¼Œå´ä¸èƒ½ä¿è¯ä¸¤è€…çš„æäº¤é¡ºåºä¸€è‡´ï¼Œå› æ­¤ï¼Œåœ¨ä¸¤é˜¶æ®µæäº¤çš„æµç¨‹åŸºç¡€ä¸Šï¼Œè¿˜éœ€è¦åŠ ä¸€ä¸ªé”æ¥ä¿è¯æäº¤çš„åŸå­æ€§ï¼Œä»è€Œä¿è¯å¤šäº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªæ—¥å¿—çš„æäº¤é¡ºåºä¸€è‡´ã€‚</li>
</ul>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¸¤é˜¶æ®µæäº¤çš„ç£ç›˜ I/O æ¬¡æ•°ä¼šå¾ˆé«˜ï¼Ÿ</p>
</blockquote>
<p>binlog å’Œ redo log åœ¨å†…å­˜ä¸­éƒ½å¯¹åº”çš„ç¼“å­˜ç©ºé—´ï¼Œbinlog ä¼šç¼“å­˜åœ¨ binlog cacheï¼Œredo log ä¼šç¼“å­˜åœ¨ redo log bufferï¼Œå®ƒä»¬æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ—¶æœºåˆ†åˆ«ç”±ä¸‹é¢è¿™ä¸¤ä¸ªå‚æ•°æ§åˆ¶ã€‚ä¸€èˆ¬æˆ‘ä»¬ä¸ºäº†é¿å…æ—¥å¿—ä¸¢å¤±çš„é£é™©ï¼Œä¼šå°†è¿™ä¸¤ä¸ªå‚æ•°è®¾ç½®ä¸º 1ï¼š</p>
<ul>
<li>å½“ sync_binlog = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šå°† binlog cache é‡Œçš„ binlog ç›´æ¥æŒä¹…åˆ°ç£ç›˜ï¼›</li>
<li>å½“ innodb_flush_log_at_trx_commit = 1 æ—¶ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ï¼Œéƒ½å°†ç¼“å­˜åœ¨ redo log buffer é‡Œçš„ redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœ sync_binlog å’Œ å½“ innodb_flush_log_at_trx_commit éƒ½è®¾ç½®ä¸º 1ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªäº‹åŠ¡æäº¤è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šè‡³å°‘è°ƒç”¨ 2 æ¬¡åˆ·ç›˜æ“ä½œï¼Œä¸€æ¬¡æ˜¯ redo log åˆ·ç›˜ï¼Œä¸€æ¬¡æ˜¯ binlog è½ç›˜ï¼Œæ‰€ä»¥è¿™ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆé”ç«äº‰æ¿€çƒˆï¼Ÿ</p>
</blockquote>
<p>åœ¨æ—©æœŸçš„ MySQL ç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ prepare_commit_mutex é”æ¥ä¿è¯äº‹åŠ¡æäº¤çš„é¡ºåºï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡è·å–åˆ°é”æ—¶æ‰èƒ½è¿›å…¥ prepare é˜¶æ®µï¼Œä¸€ç›´åˆ° commit é˜¶æ®µç»“æŸæ‰èƒ½é‡Šæ”¾é”ï¼Œä¸‹ä¸ªäº‹åŠ¡æ‰å¯ä»¥ç»§ç»­è¿›è¡Œ prepare æ“ä½œã€‚</p>
<p>é€šè¿‡åŠ é”è™½ç„¶å®Œç¾åœ°è§£å†³äº†é¡ºåºä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä½†åœ¨å¹¶å‘é‡è¾ƒå¤§çš„æ—¶å€™ï¼Œå°±ä¼šå¯¼è‡´å¯¹é”çš„äº‰ç”¨ï¼Œæ€§èƒ½ä¸ä½³ã€‚</p>
<h3 id="ç»„æäº¤ï¼šé›†ä½“åå…¬äº¤ï¼Œä¸€æ¬¡æå®šï¼">ç»„æäº¤ï¼šé›†ä½“åå…¬äº¤ï¼Œä¸€æ¬¡æå®šï¼</h3>
<p><strong>æƒ³è±¡ä½ æ¯å¤©ä¸Šç­éƒ½è¦åå…¬äº¤è½¦</strong>ï¼š</p>
<p><strong>ä»¥å‰çš„åšæ³•</strong>ï¼šæ¯ä¸ªäººéƒ½æ‰“ç§å®¶è½¦</p>
<ul>
<li>æ¯ä¸ªäº‹åŠ¡å•ç‹¬æäº¤ï¼Œå•ç‹¬åˆ·ç›˜</li>
<li>10 ä¸ªäº‹åŠ¡ = 10 æ¬¡ç£ç›˜æ“ä½œ</li>
<li>å°±åƒ 10 ä¸ªäººå¼€ 10 è¾†è½¦ä¸Šç­ï¼Œæ•ˆç‡ä½ï¼Œè¿˜å µè½¦</li>
</ul>
<p><strong>ç»„æäº¤çš„åšæ³•</strong>ï¼šå¤§å®¶ä¸€èµ·åå…¬äº¤</p>
<ul>
<li><strong>å¤šä¸ªäº‹åŠ¡ä¸€èµ·æäº¤ï¼Œä¸€æ¬¡åˆ·ç›˜</strong></li>
<li>10 ä¸ªäº‹åŠ¡ = 1 æ¬¡ç£ç›˜æ“ä½œ</li>
<li>å°±åƒ 10 ä¸ªäººå 1 è¾†å…¬äº¤è½¦ï¼Œæ•ˆç‡é«˜å¤šäº†ï¼</li>
</ul>
<p><strong>MySQL ç»„æäº¤çš„æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<ul>
<li>ä¸è®©äº‹åŠ¡&quot;å•æ‰“ç‹¬æ–—&quot;ï¼Œè€Œæ˜¯&quot;æŠ±å›¢å–æš–&quot;</li>
<li>å¤šä¸ªäº‹åŠ¡ä¸€èµ·åˆ·ç›˜ï¼Œå¤§å¤§å‡å°‘ç£ç›˜ I/O æ¬¡æ•°</li>
<li><strong>å¦‚æœ 10 ä¸ªäº‹åŠ¡å•ç‹¬åˆ·ç›˜æˆæœ¬æ˜¯ 10ï¼Œé‚£ä¹ˆä¸€èµ·åˆ·ç›˜çš„æˆæœ¬æ¥è¿‘ 1</strong></li>
</ul>
<h3 id="ç»„æäº¤çš„ä¸‰ä¸ªé˜¶æ®µ">ç»„æäº¤çš„ä¸‰ä¸ªé˜¶æ®µ</h3>
<p>ä¸ºäº†å®ç°ç»„æäº¤ï¼ŒMySQL æŠŠåŸæ¥çš„ commit é˜¶æ®µæ‹†åˆ†æˆä¸‰ä¸ªæ›´ç²¾ç»†çš„æ­¥éª¤ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968207864.png" alt="1747968207864"></p>
<p><strong>ä¸‰ä¸ªé˜¶æ®µçš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li><strong>Flush é˜¶æ®µ</strong>ï¼šæŠŠ binlog ä»å†…å­˜å†™åˆ°æ–‡ä»¶ï¼ˆä½†ä¸åˆ·ç›˜ï¼‰</li>
<li><strong>Sync é˜¶æ®µ</strong>ï¼šå¤šä¸ªäº‹åŠ¡çš„ binlog ä¸€èµ·åˆ·ç›˜ï¼ˆå…³é”®æ­¥éª¤ï¼ï¼‰</li>
<li><strong>Commit é˜¶æ®µ</strong>ï¼šå‘Šè¯‰å­˜å‚¨å¼•æ“æ­£å¼æäº¤</li>
</ul>
<p><strong>é˜Ÿåˆ—æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªé˜¶æ®µéƒ½æœ‰è‡ªå·±çš„é˜Ÿåˆ—</li>
<li>ç¬¬ä¸€ä¸ªåˆ°è¾¾çš„äº‹åŠ¡æˆä¸º&quot;é˜Ÿé•¿&quot;ï¼ˆLeaderï¼‰</li>
<li>é˜Ÿé•¿è´Ÿè´£å¸¦é¢†æ•´ä¸ªé˜Ÿä¼å®Œæˆæ“ä½œ</li>
<li>å®Œæˆåé€šçŸ¥é˜Ÿå‘˜ä»¬&quot;ä»»åŠ¡å®Œæˆ&quot;</li>
</ul>
<h3 id="é”ç²’åº¦ä¼˜åŒ–ï¼šä»-ç‹¬å æ•´ä¸ªé“¶è¡Œ-åˆ°-ç‹¬å å•ä¸ªçª—å£">é”ç²’åº¦ä¼˜åŒ–ï¼šä»&quot;ç‹¬å æ•´ä¸ªé“¶è¡Œ&quot;åˆ°&quot;ç‹¬å å•ä¸ªçª—å£&quot;</h3>
<p><strong>ä»¥å‰çš„é”æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>å°±åƒæ•´ä¸ªé“¶è¡Œåªæœ‰ä¸€ä¸ª VIP é€šé“</li>
<li>ä¸€ä¸ªå®¢æˆ·è¿›å»åï¼ŒæŠŠæ•´ä¸ªé“¶è¡Œéƒ½é”ä½</li>
<li>å…¶ä»–æ‰€æœ‰å®¢æˆ·éƒ½è¦ç­‰ç€</li>
</ul>
<p><strong>ç»„æäº¤çš„é”æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>å°±åƒé“¶è¡Œæœ‰ä¸‰ä¸ªä¸“é—¨çª—å£ï¼šå–å·çª—å£ã€åŠç†çª—å£ã€ç¡®è®¤çª—å£</li>
<li>æ¯ä¸ªçª—å£å¯ä»¥åŒæ—¶æœåŠ¡ï¼Œåªæ˜¯çª—å£å†…éƒ¨éœ€è¦æ’é˜Ÿ</li>
<li><strong>é”ç²’åº¦å˜å°ï¼Œå¹¶å‘åº¦æé«˜</strong></li>
</ul>
<h3 id="redo-log-ä¹Ÿæœ‰ç»„æäº¤å—ï¼Ÿ">redo log ä¹Ÿæœ‰ç»„æäº¤å—ï¼Ÿ</h3>
<p><strong>è¿™è¦çœ‹ MySQL ç‰ˆæœ¬</strong>ï¼š</p>
<p><strong>MySQL 5.6</strong>ï¼šâŒ æ²¡æœ‰ redo log ç»„æäº¤</p>
<ul>
<li>æ¯ä¸ªäº‹åŠ¡åœ¨ prepare é˜¶æ®µå„è‡ªåˆ·ç›˜</li>
<li>å°±åƒæ¯ä¸ªäººéƒ½è¦å•ç‹¬è¿‡å®‰æ£€</li>
</ul>
<p><strong>MySQL 5.7+</strong>ï¼šâœ… æœ‰ redo log ç»„æäº¤</p>
<ul>
<li>æŠŠ redo log åˆ·ç›˜æ¨è¿Ÿåˆ° flush é˜¶æ®µ</li>
<li>å¤šä¸ªäº‹åŠ¡çš„ redo log ä¸€èµ·åˆ·ç›˜</li>
<li><strong>binlog å’Œ redo log éƒ½èƒ½äº«å—ç»„æäº¤çš„å¥½å¤„</strong></li>
</ul>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968216941.png" alt="1747968216941"></p>
<p>è¿™ä¸ªè¦çœ‹ MySQL ç‰ˆæœ¬ï¼ŒMySQL 5.6 æ²¡æœ‰ redo log ç»„æäº¤ï¼ŒMySQL 5.7 æœ‰ redo log ç»„æäº¤ã€‚</p>
<p>åœ¨ MySQL 5.6 çš„ç»„æäº¤é€»è¾‘ä¸­ï¼Œæ¯ä¸ªäº‹åŠ¡å„è‡ªæ‰§è¡Œ prepare é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯å„è‡ªå°† redo log åˆ·ç›˜ï¼Œè¿™æ ·å°±æ²¡åŠæ³•å¯¹ redo log è¿›è¡Œç»„æäº¤ã€‚</p>
<p>æ‰€ä»¥åœ¨ MySQL 5.7 ç‰ˆæœ¬ä¸­ï¼Œåšäº†ä¸ªæ”¹è¿›ï¼Œåœ¨ prepare é˜¶æ®µä¸å†è®©äº‹åŠ¡å„è‡ªæ‰§è¡Œ redo log åˆ·ç›˜æ“ä½œï¼Œè€Œæ˜¯æ¨è¿Ÿåˆ°ç»„æäº¤çš„ flush é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ prepare é˜¶æ®µèåˆåœ¨äº† flush é˜¶æ®µã€‚</p>
<p>è¿™ä¸ªä¼˜åŒ–æ˜¯å°† redo log çš„åˆ·ç›˜å»¶è¿Ÿåˆ°äº† flush é˜¶æ®µä¹‹ä¸­ï¼Œsync é˜¶æ®µä¹‹å‰ã€‚é€šè¿‡å»¶è¿Ÿå†™ redo log çš„æ–¹å¼ï¼Œä¸º redolog åšäº†ä¸€æ¬¡ç»„å†™å…¥ï¼Œè¿™æ · binlog å’Œ redo log éƒ½è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p>
<p>æ¥ä¸‹æ¥ä»‹ç»æ¯ä¸ªé˜¶æ®µçš„è¿‡ç¨‹ï¼Œæ³¨æ„ä¸‹é¢çš„è¿‡ç¨‹é’ˆå¯¹çš„æ˜¯â€œåŒ 1â€é…ç½®ï¼ˆsync_binlog å’Œ innodb_flush_log_at_trx_commit éƒ½é…ç½®ä¸º 1ï¼‰ã€‚</p>
<blockquote>
<p>flush é˜¶æ®µ</p>
</blockquote>
<p>ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¼šæˆä¸º flush é˜¶æ®µçš„ Leaderï¼Œæ­¤æ—¶åé¢åˆ°æ¥çš„äº‹åŠ¡éƒ½æ˜¯ Followerï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968216941.png" alt="1747968216941"></p>
<p>æ¥ç€ï¼Œè·å–é˜Ÿåˆ—ä¸­çš„äº‹åŠ¡ç»„ï¼Œç”±ç»¿è‰²äº‹åŠ¡ç»„çš„ Leader å¯¹ rodo log åšä¸€æ¬¡ write + fsyncï¼Œå³ä¸€æ¬¡å°†åŒç»„äº‹åŠ¡çš„ redolog åˆ·ç›˜ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968226511.png" alt="1747968226511"></p>
<p>å®Œæˆäº† prepare é˜¶æ®µåï¼Œå°†ç»¿è‰²è¿™ä¸€ç»„äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ binlog å†™å…¥ binlog æ–‡ä»¶ï¼ˆè°ƒç”¨ writeï¼Œä¸ä¼šè°ƒç”¨ fsyncï¼Œæ‰€ä»¥ä¸ä¼šåˆ·ç›˜ï¼Œbinlog ç¼“å­˜åœ¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼‰ã€‚</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968233827.png" alt="1747968233827"></p>
<p>ä»ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥çŸ¥é“ flush é˜¶æ®µé˜Ÿåˆ—çš„ä½œç”¨æ˜¯<strong>ç”¨äºæ”¯æ’‘ redo log çš„ç»„æäº¤</strong>ã€‚</p>
<p>å¦‚æœåœ¨è¿™ä¸€æ­¥å®Œæˆåæ•°æ®åº“å´©æºƒï¼Œç”±äº binlog ä¸­æ²¡æœ‰è¯¥ç»„äº‹åŠ¡çš„è®°å½•ï¼Œæ‰€ä»¥ MySQL ä¼šåœ¨é‡å¯åå›æ»šè¯¥ç»„äº‹åŠ¡ã€‚</p>
<blockquote>
<p>sync é˜¶æ®µ</p>
</blockquote>
<p>ç»¿è‰²è¿™ä¸€ç»„äº‹åŠ¡çš„ binlog å†™å…¥åˆ° binlog æ–‡ä»¶åï¼Œå¹¶ä¸ä¼šé©¬ä¸Šæ‰§è¡Œåˆ·ç›˜çš„æ“ä½œï¼Œè€Œæ˜¯<strong>ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´</strong>ï¼Œè¿™ä¸ªç­‰å¾…çš„æ—¶é•¿ç”± <code>Binlog_group_commit_sync_delay</code> å‚æ•°æ§åˆ¶ï¼Œ<strong>ç›®çš„æ˜¯ä¸ºäº†ç»„åˆæ›´å¤šäº‹åŠ¡çš„ binlogï¼Œç„¶åå†ä¸€èµ·åˆ·ç›˜</strong>ï¼Œå¦‚ä¸‹è¿‡ç¨‹ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968240604.png" alt="1747968240604"></p>
<p>ä¸è¿‡ï¼Œåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœäº‹åŠ¡çš„æ•°é‡æå‰è¾¾åˆ°äº† <code>Binlog_group_commit_sync_no_delay_count</code> å‚æ•°è®¾ç½®çš„å€¼ï¼Œå°±ä¸ç”¨ç»§ç»­ç­‰å¾…äº†ï¼Œå°±é©¬ä¸Šå°† binlog åˆ·ç›˜ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968249657.png" alt="1747968249657"></p>
<p>ä»ä¸Šé¢çš„è¿‡ç¨‹ï¼Œå¯ä»¥çŸ¥é“ sync é˜¶æ®µé˜Ÿåˆ—çš„ä½œç”¨æ˜¯<strong>ç”¨äºæ”¯æŒ binlog çš„ç»„æäº¤</strong>ã€‚</p>
<p>å¦‚æœæƒ³æå‡ binlog ç»„æäº¤çš„æ•ˆæœï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸‹é¢è¿™ä¸¤ä¸ªå‚æ•°æ¥å®ç°ï¼š</p>
<ul>
<li><code>binlog_group_commit_sync_delay= N</code>ï¼Œè¡¨ç¤ºåœ¨ç­‰å¾… N å¾®å¦™åï¼Œç›´æ¥è°ƒç”¨ fsyncï¼Œå°†å¤„äºæ–‡ä»¶ç³»ç»Ÿä¸­ page cache ä¸­çš„ binlog åˆ·ç›˜ï¼Œä¹Ÿå°±æ˜¯å°†ã€Œbinlog æ–‡ä»¶ã€æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li>
<li><code>binlog_group_commit_sync_no_delay_count = N</code>ï¼Œè¡¨ç¤ºå¦‚æœé˜Ÿåˆ—ä¸­çš„äº‹åŠ¡æ•°è¾¾åˆ° N ä¸ªï¼Œå°±å¿½è§† binlog_group_commit_sync_delay çš„è®¾ç½®ï¼Œç›´æ¥è°ƒç”¨ fsyncï¼Œå°†å¤„äºæ–‡ä»¶ç³»ç»Ÿä¸­ page cache ä¸­çš„ binlog åˆ·ç›˜ã€‚</li>
</ul>
<p>å¦‚æœåœ¨è¿™ä¸€æ­¥å®Œæˆåæ•°æ®åº“å´©æºƒï¼Œç”±äº binlog ä¸­å·²ç»æœ‰äº†äº‹åŠ¡è®°å½•ï¼ŒMySQL ä¼šåœ¨é‡å¯åé€šè¿‡ redo log åˆ·ç›˜çš„æ•°æ®ç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚</p>
<blockquote>
<p>commit é˜¶æ®µ</p>
</blockquote>
<p>æœ€åè¿›å…¥ commit é˜¶æ®µï¼Œè°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå°† redo log çŠ¶æ€è®¾ç½®ä¸º commitã€‚</p>
<p><img src="/2025/05/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97/1747968257038.png" alt="1747968257038"></p>
<p>commit é˜¶æ®µé˜Ÿåˆ—çš„ä½œç”¨æ˜¯æ‰¿æ¥ sync é˜¶æ®µçš„äº‹åŠ¡ï¼Œå®Œæˆæœ€åçš„å¼•æ“æäº¤ï¼Œä½¿å¾— sync å¯ä»¥å°½æ—©çš„å¤„ç†ä¸‹ä¸€ç»„äº‹åŠ¡ï¼Œæœ€å¤§åŒ–ç»„æäº¤çš„æ•ˆç‡ã€‚</p>
<h2 id="MySQL-ç£ç›˜-I-O-å¾ˆé«˜ï¼Œæœ‰ä»€ä¹ˆä¼˜åŒ–çš„æ–¹æ³•ï¼Ÿ">MySQL ç£ç›˜ I/O å¾ˆé«˜ï¼Œæœ‰ä»€ä¹ˆä¼˜åŒ–çš„æ–¹æ³•ï¼Ÿ</h2>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº‹åŠ¡åœ¨æäº¤çš„æ—¶å€™ï¼Œéœ€è¦å°† binlog å’Œ redo log æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé‚£ä¹ˆå¦‚æœå‡ºç° MySQL ç£ç›˜ I/O å¾ˆé«˜çš„ç°è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶ä»¥ä¸‹å‚æ•°ï¼Œæ¥â€œå»¶è¿Ÿâ€binlog å’Œ redo log åˆ·ç›˜çš„æ—¶æœºï¼Œä»è€Œé™ä½ç£ç›˜ I/O çš„é¢‘ç‡ï¼š</p>
<ul>
<li>è®¾ç½®ç»„æäº¤çš„ä¸¤ä¸ªå‚æ•°ï¼šbinlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_count å‚æ•°ï¼Œå»¶è¿Ÿ binlog åˆ·ç›˜çš„æ—¶æœºï¼Œä»è€Œå‡å°‘ binlog çš„åˆ·ç›˜æ¬¡æ•°ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åŸºäºâ€œé¢å¤–çš„æ•…æ„ç­‰å¾…â€æ¥å®ç°çš„ï¼Œå› æ­¤å¯èƒ½ä¼šå¢åŠ è¯­å¥çš„å“åº”æ—¶é—´ï¼Œä½†å³ä½¿ MySQL è¿›ç¨‹ä¸­é€”æŒ‚äº†ï¼Œä¹Ÿæ²¡æœ‰ä¸¢å¤±æ•°æ®çš„é£é™©ï¼Œå› ä¸º binlog æ—©è¢«å†™å…¥åˆ° page cache äº†ï¼Œåªè¦ç³»ç»Ÿæ²¡æœ‰å®•æœºï¼Œç¼“å­˜åœ¨ page cache é‡Œçš„ binlog å°±ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li>
<li>å°† sync_binlog è®¾ç½®ä¸ºå¤§äº 1 çš„å€¼ï¼ˆæ¯”è¾ƒå¸¸è§æ˜¯ 100~1000ï¼‰ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ writeï¼Œä½†ç´¯ç§¯ N ä¸ªäº‹åŠ¡åæ‰ fsyncï¼Œç›¸å½“äºå»¶è¿Ÿäº† binlog åˆ·ç›˜çš„æ—¶æœºã€‚ä½†æ˜¯è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µæ—¶ä¼šä¸¢ N ä¸ªäº‹åŠ¡çš„ binlog æ—¥å¿—ã€‚</li>
<li>å°† innodb_flush_log_at_trx_commit è®¾ç½®ä¸º 2ã€‚è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ï¼Œéƒ½åªæ˜¯ç¼“å­˜åœ¨ redo log buffer é‡Œçš„ redo log å†™åˆ° redo log æ–‡ä»¶ï¼Œæ³¨æ„å†™å…¥åˆ°ã€Œredo log æ–‡ä»¶ã€å¹¶ä¸æ„å‘³ç€å†™å…¥åˆ°äº†ç£ç›˜ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰ä¸ª Page Cacheï¼Œä¸“é—¨ç”¨æ¥ç¼“å­˜æ–‡ä»¶æ•°æ®çš„ï¼Œæ‰€ä»¥å†™å…¥ã€Œredo log æ–‡ä»¶ã€æ„å‘³ç€å†™å…¥åˆ°äº†æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç¼“å­˜ï¼Œç„¶åäº¤ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ—¶æœºã€‚ä½†æ˜¯è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µçš„æ—¶å€™ä¼šä¸¢æ•°æ®ã€‚</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å…·ä½“æ›´æ–°ä¸€æ¡è®°å½• <code>UPDATE t_user SET name = 'xiaolin' WHERE id = 1;</code> çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰§è¡Œå™¨è´Ÿè´£å…·ä½“æ‰§è¡Œï¼Œä¼šè°ƒç”¨å­˜å‚¨å¼•æ“çš„æ¥å£ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ ‘æœç´¢è·å– id = 1 è¿™ä¸€è¡Œè®°å½•ï¼š
<ul>
<li>å¦‚æœ id=1 è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨ buffer pool ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨æ›´æ–°ï¼›</li>
<li>å¦‚æœè®°å½•ä¸åœ¨ buffer poolï¼Œå°†æ•°æ®é¡µä»ç£ç›˜è¯»å…¥åˆ° buffer poolï¼Œè¿”å›è®°å½•ç»™æ‰§è¡Œå™¨ã€‚</li>
</ul>
</li>
<li>æ‰§è¡Œå™¨å¾—åˆ°èšç°‡ç´¢å¼•è®°å½•åï¼Œä¼šçœ‹ä¸€ä¸‹æ›´æ–°å‰çš„è®°å½•å’Œæ›´æ–°åçš„è®°å½•æ˜¯å¦ä¸€æ ·ï¼š
<ul>
<li>å¦‚æœä¸€æ ·çš„è¯å°±ä¸è¿›è¡Œåç»­æ›´æ–°æµç¨‹ï¼›</li>
<li>å¦‚æœä¸ä¸€æ ·çš„è¯å°±æŠŠæ›´æ–°å‰çš„è®°å½•å’Œæ›´æ–°åçš„è®°å½•éƒ½å½“ä½œå‚æ•°ä¼ ç»™ InnoDB å±‚ï¼Œè®© InnoDB çœŸæ­£çš„æ‰§è¡Œæ›´æ–°è®°å½•çš„æ“ä½œï¼›</li>
</ul>
</li>
<li>å¼€å¯äº‹åŠ¡ï¼ŒInnoDB å±‚æ›´æ–°è®°å½•å‰ï¼Œé¦–å…ˆè¦è®°å½•ç›¸åº”çš„ undo logï¼Œå› ä¸ºè¿™æ˜¯æ›´æ–°æ“ä½œï¼Œéœ€è¦æŠŠè¢«æ›´æ–°çš„åˆ—çš„æ—§å€¼è®°ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¦ç”Ÿæˆä¸€æ¡ undo logï¼Œundo log ä¼šå†™å…¥ Buffer Pool ä¸­çš„ Undo é¡µé¢ï¼Œä¸è¿‡åœ¨å†…å­˜ä¿®æ”¹è¯¥ Undo é¡µé¢åï¼Œéœ€è¦è®°å½•å¯¹åº”çš„ redo logã€‚</li>
<li>InnoDB å±‚å¼€å§‹æ›´æ–°è®°å½•ï¼Œå…ˆç”Ÿæˆå¯¹åº” redo logï¼Œå¹¶å­˜å…¥ redo log buffer é‡Œé¢ï¼Œå½“äº‹åŠ¡æäº¤æ—¶ï¼Œå°† redo log å†™å…¥ redo log fileï¼Œå¹¶æ›´æ–° buffer pool ä¸­çš„æ•°æ®é¡µï¼Œå°†å…¶æ”¾å…¥ flush é“¾è¡¨å¹¶æ ‡è®°è„é¡µå’Œè®°å½• redo log å¯¹åº”çš„ lsn åˆ°è¯¥é¡µçš„ oldest_modificationï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚ä¸ºäº†å‡å°‘ç£ç›˜ I/Oï¼Œä¸ä¼šç«‹å³å°†è„é¡µå†™å…¥ç£ç›˜ï¼Œåç»­ç”±åå°çº¿ç¨‹é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ—¶æœºå°†è„é¡µå†™å…¥åˆ°ç£ç›˜ã€‚è¿™å°±æ˜¯ <strong>WAL æŠ€æœ¯</strong>ï¼ŒMySQL çš„å†™æ“ä½œå¹¶ä¸æ˜¯ç«‹åˆ»å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆå†™ redo æ—¥å¿—ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å†å°†ä¿®æ”¹çš„è¡Œæ•°æ®å†™åˆ°ç£ç›˜ä¸Šã€‚</li>
<li>è‡³æ­¤ï¼Œä¸€æ¡è®°å½•æ›´æ–°å®Œäº†ã€‚</li>
<li>åœ¨ä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œç„¶åå¼€å§‹è®°å½•è¯¥è¯­å¥å¯¹åº”çš„ binlogï¼Œæ­¤æ—¶è®°å½•çš„ binlog ä¼šè¢«ä¿å­˜åˆ° binlog cacheï¼Œå¹¶æ²¡æœ‰åˆ·æ–°åˆ°ç¡¬ç›˜ä¸Šçš„ binlog æ–‡ä»¶ï¼Œåœ¨äº‹åŠ¡æäº¤æ—¶æ‰ä¼šç»Ÿä¸€å°†è¯¥äº‹åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ binlog åˆ·æ–°åˆ°ç¡¬ç›˜ã€‚</li>
<li>äº‹åŠ¡æäº¤ï¼ˆä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œè¿™é‡Œä¸è¯´ç»„æäº¤çš„è¿‡ç¨‹ï¼Œåªè¯´ä¸¤é˜¶æ®µæäº¤ï¼‰ï¼š
<ul>
<li><strong>prepare é˜¶æ®µ</strong>ï¼šå°† redo log å¯¹åº”çš„äº‹åŠ¡çŠ¶æ€è®¾ç½®ä¸º prepareï¼Œç„¶åå°† redo log åˆ·æ–°åˆ°ç¡¬ç›˜ï¼›</li>
<li><strong>commit é˜¶æ®µ</strong>ï¼šå°† binlog åˆ·æ–°åˆ°ç£ç›˜ï¼Œæ¥ç€è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå°† redo log çŠ¶æ€è®¾ç½®ä¸º commitï¼ˆå°†äº‹åŠ¡è®¾ç½®ä¸º commit çŠ¶æ€åï¼Œåˆ·å…¥åˆ°ç£ç›˜ redo log æ–‡ä»¶ï¼‰ï¼›</li>
</ul>
</li>
<li>è‡³æ­¤ï¼Œä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œå®Œæˆã€‚</li>
</ol>
<hr>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li>ã€ŠMySQL 45 è®²ã€‹</li>
<li>ã€ŠMySQL æ˜¯æ€æ ·è¿è¡Œçš„ï¼Ÿã€‹</li>
<li><a href="https://developer.aliyun.com/article/617776">https://developer.aliyun.com/article/617776</a></li>
<li><a href="http://mysql.taobao.org/monthly/2021/10/01/">http://mysql.taobao.org/monthly/2021/10/01/</a></li>
<li><a href="https://www.cnblogs.com/Neeo/articles/13883976.html">https://www.cnblogs.com/Neeo/articles/13883976.html</a></li>
<li><a href="https://www.cnblogs.com/mengxinJ/p/14211427.html">https://www.cnblogs.com/mengxinJ/p/14211427.html</a></li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>MVCC</tag>
        <tag>undo log</tag>
        <tag>redo log</tag>
        <tag>binlog</tag>
        <tag>äº‹åŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 80 - åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ IIï¼ˆRemove Duplicates from Sorted Array IIï¼‰</title>
    <url>/2025/05/24/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-80-%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9-II/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæœ‰åºæ•°ç»„ <code>nums</code>ï¼Œè¯·ä½ <strong>åŸåœ°</strong>åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸¤æ¬¡çš„å…ƒç´ <strong>åªå‡ºç°ä¸¤æ¬¡</strong>ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p>
<p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨<strong>åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„</strong>å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,1,1,2,2,3]</span><br><span class="line">è¾“å‡ºï¼š5, nums = [1,1,2,2,3]</span><br><span class="line">è§£é‡Šï¼šå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = 5, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 1, 2, 2, 3ã€‚</span><br><span class="line">ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [0,0,1,1,1,1,2,3,3]</span><br><span class="line">è¾“å‡ºï¼š7, nums = [0,0,1,1,2,3,3]</span><br><span class="line">è§£é‡Šï¼šå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = 7, å¹¶ä¸”åŸæ•°ç»„çš„å‰ä¸ƒä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 0, 1, 1, 2, 3, 3ã€‚</span><br><span class="line">ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= nums.length &lt;= 3 * 10^4</code></li>
<li><code>-10^4 &lt;= nums[i] &lt;= 10^4</code></li>
<li><code>nums</code> å·²æŒ‰<strong>éä¸¥æ ¼é€’å¢</strong>é¡ºåºæ’åˆ—</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜æ˜¯ç»å…¸çš„<strong>åŒæŒ‡é’ˆ</strong>é—®é¢˜ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ç»´æŠ¤ä¸€ä¸ª&quot;æœ‰æ•ˆåŒºåŸŸ&quot;ï¼Œç¡®ä¿æ¯ä¸ªå…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡ã€‚</p>
<h3 id="æ ¸å¿ƒæ´å¯Ÿ">æ ¸å¿ƒæ´å¯Ÿ</h3>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼šå¯¹äºä½ç½® <code>left</code>ï¼Œå¦‚æœ <code>nums[left-2] != nums[right]</code>ï¼Œé‚£ä¹ˆ <code>nums[right]</code> å¯ä»¥å®‰å…¨åœ°æ”¾å…¥ä½ç½® <code>left</code>ï¼Œå› ä¸ºè¿™ä¿è¯äº†æœ€å¤šè¿ç»­ä¸¤ä¸ªç›¸åŒå…ƒç´ ã€‚</p>
<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h3>
<ol>
<li><strong>åˆå§‹åŒ–</strong>ï¼šç”±äºå‰ä¸¤ä¸ªå…ƒç´ æ— è®ºå¦‚ä½•éƒ½å¯ä»¥ä¿ç•™ï¼Œæ‰€ä»¥ä»ç´¢å¼• 2 å¼€å§‹å¤„ç†</li>
<li><strong>åŒæŒ‡é’ˆéå†</strong>ï¼š
<ul>
<li><code>left</code>ï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªè¦å¡«å…¥çš„ä½ç½®</li>
<li><code>right</code>ï¼šéå†æ•´ä¸ªæ•°ç»„</li>
</ul>
</li>
<li><strong>åˆ¤æ–­æ¡ä»¶</strong>ï¼šæ¯”è¾ƒ <code>nums[left-2]</code> å’Œ <code>nums[right]</code>
<ul>
<li>å¦‚æœä¸ç›¸ç­‰ï¼Œè¯´æ˜ <code>nums[right]</code> å¯ä»¥æ”¾å…¥ï¼Œå› ä¸ºå®ƒä¸å‰é¢ç¬¬äºŒä¸ªå…ƒç´ ä¸åŒ</li>
<li>å¦‚æœç›¸ç­‰ï¼Œè¯´æ˜å·²ç»æœ‰ä¸¤ä¸ªç›¸åŒå…ƒç´ äº†ï¼Œè·³è¿‡å½“å‰å…ƒç´ </li>
</ul>
</li>
</ol>
<h3 id="å¯è§†åŒ–ç¤ºä¾‹">å¯è§†åŒ–ç¤ºä¾‹</h3>
<p>ä»¥ <code>nums = [1,1,1,2,2,3]</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹çŠ¶æ€: [1,1,1,2,2,3]</span><br><span class="line">           â†‘     â†‘</span><br><span class="line">         left  right</span><br><span class="line"></span><br><span class="line">æ­¥éª¤1: nums[0] != nums[2] â†’ 1 != 1 (false)</span><br><span class="line">       right++</span><br><span class="line"></span><br><span class="line">æ­¥éª¤2: nums[0] != nums[3] â†’ 1 != 2 (true)</span><br><span class="line">       nums[2] = nums[3] = 2</span><br><span class="line">       [1,1,2,2,2,3]</span><br><span class="line">             â†‘   â†‘</span><br><span class="line">           left right</span><br><span class="line"></span><br><span class="line">æ­¥éª¤3: nums[1] != nums[4] â†’ 1 != 2 (true)</span><br><span class="line">       nums[3] = nums[4] = 2</span><br><span class="line">       [1,1,2,2,2,3]</span><br><span class="line">               â†‘ â†‘</span><br><span class="line">             left right</span><br><span class="line"></span><br><span class="line">æ­¥éª¤4: nums[2] != nums[5] â†’ 2 != 3 (true)</span><br><span class="line">       nums[4] = nums[5] = 3</span><br><span class="line">       [1,1,2,2,3,3]</span><br><span class="line">                 â†‘</span><br><span class="line">               left</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœ: [1,1,2,2,3], length = 5</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeDuplicates</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¾¹ç•Œæƒ…å†µï¼šé•¿åº¦å°äºç­‰äº2æ—¶ï¼Œæ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥ä¿ç•™</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŒæŒ‡é’ˆï¼šleftæŒ‡å‘ä¸‹ä¸€ä¸ªè¦å¡«å…¥çš„ä½ç½®ï¼Œrightéå†æ•°ç»„</span></span><br><span class="line">    left, right := <span class="number">2</span>, <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> right &lt; n &#123;</span><br><span class="line">        <span class="comment">// å…³é”®åˆ¤æ–­ï¼šå¦‚æœå½“å‰å…ƒç´ ä¸left-2ä½ç½®çš„å…ƒç´ ä¸åŒ</span></span><br><span class="line">        <span class="comment">// è¯´æ˜å¯ä»¥å®‰å…¨æ”¾å…¥ï¼Œä¿è¯æœ€å¤šè¿ç»­ä¸¤ä¸ªç›¸åŒå…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> nums[left<span class="number">-2</span>] != nums[right] &#123;</span><br><span class="line">            nums[left] = nums[right]</span><br><span class="line">            left++</span><br><span class="line">        &#125;</span><br><span class="line">        right++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> left</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>ä»¥ <code>nums = [0,0,1,1,1,1,2,3,3]</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹: [0,0,1,1,1,1,2,3,3]  left=2, right=2</span><br><span class="line">      </span><br><span class="line">right=2: nums[0] != nums[2] â†’ 0 != 1 (true)</span><br><span class="line">         nums[2] = 1, left=3</span><br><span class="line">         [0,0,1,1,1,1,2,3,3]</span><br><span class="line"></span><br><span class="line">right=3: nums[1] != nums[3] â†’ 0 != 1 (true)  </span><br><span class="line">         nums[3] = 1, left=4</span><br><span class="line">         [0,0,1,1,1,1,2,3,3]</span><br><span class="line"></span><br><span class="line">right=4: nums[2] != nums[4] â†’ 1 != 1 (false)</span><br><span class="line">         è·³è¿‡</span><br><span class="line"></span><br><span class="line">right=5: nums[3] != nums[5] â†’ 1 != 1 (false)</span><br><span class="line">         è·³è¿‡</span><br><span class="line"></span><br><span class="line">right=6: nums[4] != nums[6] â†’ 1 != 2 (true)</span><br><span class="line">         nums[4] = 2, left=5</span><br><span class="line">         [0,0,1,1,2,1,2,3,3]</span><br><span class="line"></span><br><span class="line">right=7: nums[5] != nums[7] â†’ 1 != 3 (true)</span><br><span class="line">         nums[5] = 3, left=6</span><br><span class="line">         [0,0,1,1,2,3,2,3,3]</span><br><span class="line"></span><br><span class="line">right=8: nums[6] != nums[8] â†’ 2 != 3 (true)</span><br><span class="line">         nums[6] = 3, left=7</span><br><span class="line">         [0,0,1,1,2,3,3,3,3]</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœ: [0,0,1,1,2,3,3], length = 7</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$</p>
<ul>
<li>åªéœ€è¦éå†æ•°ç»„ä¸€æ¬¡ï¼Œæ¯ä¸ªå…ƒç´ æœ€å¤šè¢«è®¿é—®ä¸¤æ¬¡</li>
</ul>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$</p>
<ul>
<li>åªä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–å˜é‡ï¼ŒåŸåœ°ä¿®æ”¹æ•°ç»„</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<h3 id="æ ¸å¿ƒæŠ€å·§">æ ¸å¿ƒæŠ€å·§</h3>
<ol>
<li><strong>åŒæŒ‡é’ˆæ¨¡å¼</strong>ï¼šä¸€ä¸ªæŒ‡é’ˆè´Ÿè´£éå†ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆç»´æŠ¤æœ‰æ•ˆåŒºåŸŸ</li>
<li><strong>å‰ç»æ¯”è¾ƒ</strong>ï¼šé€šè¿‡æ¯”è¾ƒ <code>nums[left-2]</code> å’Œ <code>nums[right]</code> æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥ä¿ç•™å…ƒç´ </li>
<li><strong>åŸåœ°ä¿®æ”¹</strong>ï¼šç›´æ¥åœ¨åŸæ•°ç»„ä¸Šæ“ä½œï¼ŒèŠ‚çœç©ºé—´</li>
</ol>
<h3 id="å¸¸è§é™·é˜±">å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>è¾¹ç•Œå¤„ç†</strong>ï¼šå¿˜è®°å¤„ç†æ•°ç»„é•¿åº¦å°äºç­‰äº 2 çš„æƒ…å†µ</li>
<li><strong>ç´¢å¼•è¶Šç•Œ</strong>ï¼š<code>left-2</code> å¯èƒ½è¶Šç•Œï¼Œéœ€è¦ä»ç´¢å¼• 2 å¼€å§‹</li>
<li><strong>ç†è§£é”™è¯¯</strong>ï¼šè¯¯ä»¥ä¸ºéœ€è¦è®¡æ•°æ¯ä¸ªå…ƒç´ çš„å‡ºç°æ¬¡æ•°</li>
</ol>
<h3 id="æ‰©å±•åº”ç”¨">æ‰©å±•åº”ç”¨</h3>
<ul>
<li>å¯ä»¥è½»æ¾æ‰©å±•åˆ°&quot;æœ€å¤šä¿ç•™ k ä¸ªé‡å¤å…ƒç´ &quot;çš„æƒ…å†µ</li>
<li>ç±»ä¼¼çš„åŸåœ°ä¿®æ”¹æ•°ç»„é—®é¢˜éƒ½å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆæŠ€æœ¯</li>
<li>è¿™ç§æ¨¡å¼åœ¨å¤„ç†æœ‰åºæ•°ç»„æ—¶ç‰¹åˆ«æœ‰æ•ˆ</li>
</ul>
<h3 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h3>
<ul>
<li><a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array/">LeetCode 26: Remove Duplicates from Sorted Array</a></li>
<li><a href="https://leetcode.cn/problems/remove-element/">LeetCode 27: Remove Element</a></li>
<li><a href="https://leetcode.cn/problems/move-zeroes/">LeetCode 283: Move Zeroes</a></li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 287 - å¯»æ‰¾é‡å¤æ•°</title>
    <url>/2025/05/22/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-287-%E5%AF%BB%E6%89%BE%E9%87%8D%E5%A4%8D%E6%95%B0/</url>
    <content><![CDATA[<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>ç»™å®šä¸€ä¸ªåŒ…å« <code>n + 1</code> ä¸ªæ•´æ•°çš„æ•°ç»„ <code>nums</code>ï¼Œå…¶æ•°å­—éƒ½åœ¨ <code>[1, n]</code> èŒƒå›´å†…ï¼ˆåŒ…æ‹¬ <code>1</code> å’Œ <code>n</code>ï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚</p>
<p>å‡è®¾ <code>nums</code> ä¸­åªå­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ï¼Œä½†è¿™ä¸ªé‡å¤çš„æ•´æ•°å¯èƒ½ä¼šé‡å¤å¤šæ¬¡ï¼Œè¯·æ‰¾å‡ºè¿™ä¸ªé‡å¤çš„æ•´æ•°ã€‚</p>
<p><strong>è¦æ±‚ï¼š</strong></p>
<ul>
<li>ä¸èƒ½ä¿®æ”¹åŸæ•°ç»„ï¼ˆå‡è®¾æ•°ç»„æ˜¯åªè¯»çš„ï¼‰ã€‚</li>
<li>åªèƒ½ä½¿ç”¨é¢å¤–çš„ O(1) çš„ç©ºé—´ã€‚</li>
<li>æ—¶é—´å¤æ‚åº¦å°äº O(n^2) ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<p>è¾“å…¥: <code>nums = [1,3,4,2,2]</code><br>
è¾“å‡º: <code>2</code></p>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<p>è¾“å…¥: <code>nums = [3,1,3,4,2]</code><br>
è¾“å‡º: <code>3</code></p>
<p><strong>ç¤ºä¾‹ 3:</strong></p>
<p>è¾“å…¥: <code>nums = [1,1]</code><br>
è¾“å‡º: <code>1</code></p>
<p><strong>ç¤ºä¾‹ 4:</strong></p>
<p>è¾“å…¥: <code>nums = [1,1,2]</code><br>
è¾“å‡º: <code>1</code></p>
<p><strong>çº¦æŸæ¡ä»¶:</strong></p>
<ul>
<li><code>1 &lt;= n &lt;= 10^5</code></li>
<li><code>nums.length == n + 1</code></li>
<li><code>1 &lt;= nums[i] &lt;= n</code></li>
<li><code>nums</code> ä¸­åªæœ‰ä¸€ä¸ªæ•´æ•°å‡ºç°ä¸¤æ¬¡æˆ–å¤šæ¬¡ï¼Œå…¶ä½™æ•´æ•°å‡åªå‡ºç°ä¸€æ¬¡ã€‚</li>
</ul>
<h3 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h3>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒéš¾ç‚¹åœ¨äºå¯¹ç©ºé—´å¤æ‚åº¦å’Œæ—¶é—´å¤æ‚åº¦çš„é™åˆ¶ï¼Œä»¥åŠä¸èƒ½ä¿®æ”¹åŸæ•°ç»„çš„è¦æ±‚ã€‚åˆçœ‹ä¹‹ä¸‹ï¼Œå¯èƒ½ä¼šæƒ³åˆ°ç”¨å“ˆå¸Œè¡¨æ¥è®°å½•æ•°å­—å‡ºç°çš„æ¬¡æ•°ï¼Œä½†è¿™æ ·ç©ºé—´å¤æ‚åº¦ä¼šè¾¾åˆ° O(n)ã€‚å¯¹æ•°ç»„è¿›è¡Œæ’åºä¹Ÿä¸å¯è¡Œï¼Œå› ä¸ºé¢˜ç›®è§„å®šä¸èƒ½ä¿®æ”¹åŸæ•°ç»„ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨ O(1) ç©ºé—´å¤æ‚åº¦ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å°†æ­¤é—®é¢˜å·§å¦™åœ°è½¬åŒ–ä¸º<strong>å¯»æ‰¾é“¾è¡¨ä¸­çš„ç¯</strong>ã€‚</p>
<h4 id="æ ¸å¿ƒæ€æƒ³ï¼šå¿«æ…¢æŒ‡é’ˆ-Floyd-åˆ¤åœˆç®—æ³•">æ ¸å¿ƒæ€æƒ³ï¼šå¿«æ…¢æŒ‡é’ˆ (Floyd åˆ¤åœˆç®—æ³•)</h4>
<p>æˆ‘ä»¬å¯ä»¥å°†æ•°ç»„ <code>nums</code> è§†ä¸ºä¸€ä¸ªé“¾è¡¨ã€‚æ•°ç»„çš„<strong>ä¸‹æ ‡</strong>å¯ä»¥çœ‹ä½œæ˜¯é“¾è¡¨èŠ‚ç‚¹çš„â€œéšå¼â€åœ°å€ï¼Œè€Œæ•°ç»„ä¸­<strong>å­˜å‚¨çš„å€¼</strong> <code>nums[i]</code> åˆ™å¯ä»¥çœ‹ä½œæ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼ˆå³ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹æ ‡ï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºæ•°ç»„ <code>nums = [1,3,4,2,2]</code>ï¼š</p>
<ul>
<li>æˆ‘ä»¬ä»ä¸‹æ ‡ <code>0</code> å¼€å§‹ï¼Œ<code>nums[0] = 1</code>ï¼Œè¿™æ„å‘³ç€ä»èŠ‚ç‚¹ <code>0</code> è·³è½¬åˆ°èŠ‚ç‚¹ <code>1</code>ã€‚</li>
<li>å½“å‰åœ¨ä¸‹æ ‡ <code>1</code>ï¼Œ<code>nums[1] = 3</code>ï¼Œæ‰€ä»¥ä»èŠ‚ç‚¹ <code>1</code> è·³è½¬åˆ°èŠ‚ç‚¹ <code>3</code>ã€‚</li>
<li>å½“å‰åœ¨ä¸‹æ ‡ <code>3</code>ï¼Œ<code>nums[3] = 2</code>ï¼Œæ‰€ä»¥ä»èŠ‚ç‚¹ <code>3</code> è·³è½¬åˆ°èŠ‚ç‚¹ <code>2</code>ã€‚</li>
<li>å½“å‰åœ¨ä¸‹æ ‡ <code>2</code>ï¼Œ<code>nums[2] = 4</code>ï¼Œæ‰€ä»¥ä»èŠ‚ç‚¹ <code>2</code> è·³è½¬åˆ°èŠ‚ç‚¹ <code>4</code>ã€‚</li>
<li>å½“å‰åœ¨ä¸‹æ ‡ <code>4</code>ï¼Œ<code>nums[4] = 2</code>ï¼Œæ‰€ä»¥åˆä»èŠ‚ç‚¹ <code>4</code> è·³è½¬å›äº†èŠ‚ç‚¹ <code>2</code>ã€‚</li>
</ul>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ„å»ºäº†ä¸€ä¸ªä»¥æ•°ç»„ä¸‹æ ‡ä¸ºèŠ‚ç‚¹çš„åºåˆ—ï¼š<code>0 -&gt; 1 -&gt; 3 -&gt; 2 -&gt; 4 -&gt; 2 -&gt; ...</code>ã€‚åœ¨è¿™ä¸ªåºåˆ—ä¸­ï¼ŒèŠ‚ç‚¹ <code>2</code> è¢«é‡å¤è®¿é—®ï¼Œå½¢æˆäº†ä¸€ä¸ªç¯ã€‚</p>
<p><strong>ç¯æ˜¯å¦‚ä½•å½¢æˆçš„ï¼Ÿ</strong><br>
æˆ‘ä»¬å°†æ•°ç»„çš„æ¯ä¸ª<strong>ç´¢å¼• <code>i</code></strong> è§†ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œ <code>nums[i]</code> çš„å€¼è§†ä¸ºä»èŠ‚ç‚¹ <code>i</code> å‡ºå‘ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„<strong>ç´¢å¼•</strong>ã€‚<br>
ç”±äºæ•°ç»„ <code>nums</code> åŒ…å« <code>n + 1</code> ä¸ªæ•´æ•°ï¼Œè¿™äº›æ•´æ•°çš„èŒƒå›´æ˜¯ <code>[1, n]</code>ã€‚è¿™æ„å‘³ç€æ•°ç»„ä¸­çš„å€¼éƒ½å¯ä»¥ä½œä¸ºæœ‰æ•ˆçš„æ•°ç»„ä¸‹æ ‡ï¼ˆé¢˜ç›®æ•°å€¼èŒƒå›´ <code>[1,n]</code> ä¿è¯äº† <code>nums[i]</code> ä½œä¸ºä¸‹æ ‡ä¸ä¼šè¶Šç•Œè®¿é—® <code>0</code> åˆ° <code>n</code> ä¹‹å¤–çš„åŒºåŸŸï¼Œé™¤é <code>n</code> éå¸¸å°ï¼Œä½†å³ä½¿å¦‚æ­¤ï¼Œå…¶å€¼ä¹Ÿåœ¨ <code>[1,n]</code> å†…ï¼Œå¯ä½œä¸ºæœ‰æ•ˆä¸‹æ ‡ï¼‰ã€‚<br>
æˆ‘ä»¬ä»ç´¢å¼• <code>0</code> å¼€å§‹ï¼ˆè¿™å¯ä»¥çœ‹ä½œæ˜¯é“¾è¡¨çš„â€œå¤´éƒ¨â€æˆ–èµ·å§‹æ¢æµ‹ç‚¹ï¼‰ï¼Œç„¶åæ ¹æ® <code>nums[å½“å‰ç´¢å¼•]</code> ä¸æ–­è·³è½¬åˆ°ä¸‹ä¸€ä¸ªç´¢å¼•ã€‚<br>
åºåˆ—å¯ä»¥è¡¨ç¤ºä¸ºï¼š<code>x_0 = 0</code>, <code>x_1 = nums[x_0]</code>, <code>x_2 = nums[x_1]</code>, â€¦, <code>x_&#123;i+1&#125; = nums[x_i]</code>ã€‚<br>
ç”±äºæ•°ç»„ä¸­åªæœ‰ <code>n+1</code> ä¸ªä¸åŒçš„ç´¢å¼•ï¼ˆä» <code>0</code> åˆ° <code>n</code>ï¼‰ï¼Œè€Œæˆ‘ä»¬é€šè¿‡ <code>nums[x_i]</code> è¿›è¡Œè·³è½¬ï¼Œè¿™ä¸ªåºåˆ—æœ€ç»ˆå¿…ç„¶ä¼šè®¿é—®åˆ°ä¸€ä¸ªå·²ç»è®¿é—®è¿‡çš„<strong>ç´¢å¼•</strong>ï¼Œä»è€Œå½¢æˆä¸€ä¸ªç¯ã€‚è¿™ä¸ªç¯çš„å…¥å£ç‚¹ï¼ˆå³ç¬¬ä¸€ä¸ªè¢«é‡å¤è®¿é—®çš„ç´¢å¼•ï¼‰å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é‡å¤æ•°å­—ã€‚</p>
<p>Floyd åˆ¤åœˆç®—æ³•ï¼ˆä¹Ÿç§°ä¸ºé¾Ÿå…”èµ›è·‘ç®—æ³•ï¼‰åŒ…å«ä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼š</p>
<ol>
<li>
<p><strong>æ‰¾åˆ°ç›¸é‡ç‚¹</strong>ï¼šè®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæ…¢æŒ‡é’ˆ <code>slow</code>ï¼Œä¸€ä¸ªå¿«æŒ‡é’ˆ <code>fast</code>ã€‚å®ƒä»¬éƒ½ä»æˆ‘ä»¬å®šä¹‰çš„â€œé“¾è¡¨å¤´â€ï¼ˆå³æ•°ç»„ç´¢å¼• <code>0</code>ï¼‰å¼€å§‹ã€‚</p>
<ul>
<li><code>slow</code> æ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼š<code>slow = nums[slow]</code> (å³ <code>slow</code> æŒ‡é’ˆæ›´æ–°ä¸ºå…¶å½“å‰æŒ‡å‘çš„æ•°ç»„å…ƒç´ çš„å€¼ï¼Œè¿™ä¸ªå€¼ä½œä¸ºä¸‹ä¸€ä¸ªç´¢å¼•)ã€‚</li>
<li><code>fast</code> æ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ï¼š<code>fast = nums[nums[fast]]</code> (ç±»ä¼¼åœ°ï¼Œ<code>fast</code> æŒ‡é’ˆè¿›è¡Œä¸¤æ¬¡è·³è½¬)ã€‚<br>
å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œ<code>fast</code> æŒ‡é’ˆæœ€ç»ˆä¼šåœ¨ç¯å†…è¿½ä¸Š <code>slow</code> æŒ‡é’ˆã€‚</li>
</ul>
</li>
<li>
<p><strong>æ‰¾åˆ°ç¯çš„å…¥å£</strong>ï¼šå½“ <code>slow</code> å’Œ <code>fast</code> ç›¸é‡åï¼Œæˆ‘ä»¬å°† <code>slow</code> æŒ‡é’ˆé‡ç½®å›â€œé“¾è¡¨å¤´â€ï¼ˆå³ç´¢å¼• <code>0</code>ï¼‰ã€‚ç„¶åï¼Œ<code>slow</code> å’Œ <code>fast</code> éƒ½ä»¥æ¯æ¬¡ä¸€æ­¥çš„é€Ÿåº¦å‰è¿› (<code>slow = nums[slow]</code>, <code>fast = nums[fast]</code>)ã€‚å®ƒä»¬å†æ¬¡ç›¸é‡çš„é‚£ä¸ªç‚¹ï¼ˆç´¢å¼•ï¼‰ï¼Œå°±æ˜¯ç¯çš„å…¥å£ï¼Œè¿™ä¸ªç´¢å¼•å€¼ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯»æ‰¾çš„é‡å¤æ•°å­—ã€‚</p>
</li>
</ol>
<h4 id="ç®—æ³•æ­£ç¡®æ€§å›¾è§£ä¸æ¨å¯¼">ç®—æ³•æ­£ç¡®æ€§å›¾è§£ä¸æ¨å¯¼</h4>
<p>ä»¥ <code>nums = [1,3,4,2,2]</code> ä¸ºä¾‹ï¼š<br>
æ•°ç»„ç´¢å¼•ä½œä¸ºèŠ‚ç‚¹ï¼š<code>0, 1, 2, 3, 4</code><br>
æ•°ç»„å€¼ä½œä¸ºæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼š<code>nums[0]=1, nums[1]=3, nums[2]=4, nums[3]=2, nums[4]=2</code></p>
<p>å½¢æˆçš„è·¯å¾„ï¼ˆç´¢å¼•åºåˆ—ï¼‰ï¼š<br>
<code>0 --(nums[0]=1)--&gt; 1 --(nums[1]=3)--&gt; 3 --(nums[3]=2)--&gt; 2 --(nums[2]=4)--&gt; 4 --(nums[4]=2)--&gt; 2 ...</code><br>
è¿™æ¡è·¯å¾„ä»ç´¢å¼• <code>0</code> å¼€å§‹ï¼Œç»è¿‡ <code>1</code> å’Œ <code>3</code> åˆ°è¾¾ <code>2</code>ï¼Œç„¶åå½¢æˆä¸€ä¸ªç¯ <code>2 -&gt; 4 -&gt; 2</code>ã€‚ç¯çš„å…¥å£ç‚¹æ˜¯ç´¢å¼• <code>2</code>ã€‚</p>
<p><strong>é˜¶æ®µ 1ï¼šå¯»æ‰¾ç›¸é‡ç‚¹</strong><br>
åˆå§‹æ—¶ï¼Œ<code>slow = 0</code>, <code>fast = 0</code>ã€‚<br>
æ ¹æ®ä»£ç é€»è¾‘ (<code>for slow, fast = nums[slow], nums[nums[fast]]; slow != fast; ...</code>)ï¼š</p>
<ol>
<li>
<p><strong>é¦–æ¬¡èµ‹å€¼ (å¾ªç¯åˆå§‹åŒ–éƒ¨åˆ†)</strong>:<br>
<code>slow = nums[0] = 1</code><br>
<code>fast = nums[nums[0]] = nums[1] = 3</code><br>
æ­¤æ—¶ <code>slow = 1</code>, <code>fast = 3</code>ã€‚ç”±äº <code>1 != 3</code>ï¼Œå¾ªç¯ç»§ç»­ã€‚</p>
</li>
<li>
<p><strong>ç¬¬äºŒæ¬¡è¿­ä»£ (å¾ªç¯è¿­ä»£åéƒ¨åˆ†)</strong>:<br>
<code>slow = nums[slow] = nums[1] = 3</code><br>
<code>fast = nums[nums[fast]] = nums[nums[3]] = nums[2] = 4</code><br>
æ­¤æ—¶ <code>slow = 3</code>, <code>fast = 4</code>ã€‚ç”±äº <code>3 != 4</code>ï¼Œå¾ªç¯ç»§ç»­ã€‚</p>
</li>
<li>
<p><strong>ç¬¬ä¸‰æ¬¡è¿­ä»£</strong>:<br>
<code>slow = nums[slow] = nums[3] = 2</code><br>
<code>fast = nums[nums[fast]] = nums[nums[4]] = nums[2] = 4</code><br>
æ­¤æ—¶ <code>slow = 2</code>, <code>fast = 4</code>ã€‚ç”±äº <code>2 != 4</code>ï¼Œå¾ªç¯ç»§ç»­ã€‚</p>
</li>
<li>
<p><strong>ç¬¬å››æ¬¡è¿­ä»£</strong>:<br>
<code>slow = nums[slow] = nums[2] = 4</code><br>
<code>fast = nums[nums[fast]] = nums[nums[4]] = nums[2] = 4</code><br>
æ­¤æ—¶ <code>slow = 4</code>, <code>fast = 4</code>ã€‚ç”±äº <code>4 == 4</code>ï¼Œå¾ªç¯ç»ˆæ­¢ã€‚<br>
å¿«æ…¢æŒ‡é’ˆåœ¨ç´¢å¼• <code>4</code> å¤„ç›¸é‡ã€‚è®¾ç›¸é‡ç‚¹ä¸º <code>M</code>ï¼Œåˆ™ <code>M=4</code>ã€‚</p>
</li>
</ol>
<p><strong>é˜¶æ®µ 2ï¼šå¯»æ‰¾ç¯çš„å…¥å£</strong><br>
ç›¸é‡åï¼Œ<code>slow</code> è¢«é‡ç½®ä¸º <code>0</code>ï¼Œè€Œ <code>fast</code> ä¿æŒåœ¨ç›¸é‡ç‚¹ <code>M=4</code>ã€‚<br>
ç„¶åä¸¤è€…åŒæ­¥å‰è¿›ï¼Œæ¯æ¬¡ä¸€æ­¥ï¼š</p>
<ol>
<li>
<p><code>slow = nums[slow] = nums[0] = 1</code><br>
<code>fast = nums[fast] = nums[4] = 2</code><br>
æ­¤æ—¶ <code>slow = 1</code>, <code>fast = 2</code>ã€‚ç”±äº <code>1 != 2</code>ï¼Œå¾ªç¯ç»§ç»­ã€‚</p>
</li>
<li>
<p><code>slow = nums[slow] = nums[1] = 3</code><br>
<code>fast = nums[fast] = nums[2] = 4</code><br>
æ­¤æ—¶ <code>slow = 3</code>, <code>fast = 4</code>ã€‚ç”±äº <code>3 != 4</code>ï¼Œå¾ªç¯ç»§ç»­ã€‚</p>
</li>
<li>
<p><code>slow = nums[slow] = nums[3] = 2</code><br>
<code>fast = nums[fast] = nums[4] = 2</code><br>
æ­¤æ—¶ <code>slow = 2</code>, <code>fast = 2</code>ã€‚ç”±äº <code>2 == 2</code>ï¼Œå¾ªç¯ç»ˆæ­¢ã€‚<br>
ä¸¤è€…åœ¨ç´¢å¼• <code>2</code> å¤„ç›¸é‡ã€‚è¿™ä¸ªç‚¹å°±æ˜¯ç¯çš„å…¥å£ <code>E</code>ï¼Œæ‰€ä»¥ <code>E=2</code>ã€‚<br>
å‡½æ•°è¿”å› <code>slow</code> çš„å€¼ï¼Œå³ <code>2</code>ã€‚è¿™æ­£æ˜¯ <code>nums = [1,3,4,2,2]</code> ä¸­çš„é‡å¤æ•°å­—ã€‚</p>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆæ­¤æ–¹æ³•èƒ½æ‰¾åˆ°é‡å¤æ•°å­—ï¼Ÿ</strong></p>
<p>è®¾ä»èµ·ç‚¹ï¼ˆç´¢å¼• <code>0</code>ï¼‰åˆ°ç¯çš„å…¥å£ç‚¹ï¼ˆç´¢å¼• <code>E</code>ï¼‰çš„è·¯å¾„é•¿åº¦ä¸º <code>L</code>ã€‚<br>
è®¾ç¯çš„é•¿åº¦ä¸º <code>C</code>ã€‚<br>
å½“æ…¢æŒ‡é’ˆ <code>slow</code> å’Œå¿«æŒ‡é’ˆ <code>fast</code> åœ¨ç¯ä¸­æŸç‚¹ï¼ˆç´¢å¼• <code>M</code>ï¼‰ç›¸é‡æ—¶ï¼š<br>
æ…¢æŒ‡é’ˆèµ°è¿‡çš„è·ç¦»ï¼š<code>Dist_slow = L + x</code> (å…¶ä¸­ <code>x</code> æ˜¯ä» <code>E</code> åˆ° <code>M</code> æ²¿ç¯æ–¹å‘çš„è·ç¦»)<br>
å¿«æŒ‡é’ˆèµ°è¿‡çš„è·ç¦»ï¼š<code>Dist_fast = L + x + k*C</code> (å…¶ä¸­ <code>k &gt;= 1</code> æ˜¯å¿«æŒ‡é’ˆæ¯”æ…¢æŒ‡é’ˆå¤šç»•ç¯çš„åœˆæ•°)<br>
ç”±äºå¿«æŒ‡é’ˆé€Ÿåº¦æ˜¯æ…¢æŒ‡é’ˆçš„ä¸¤å€ï¼Œæ‰€ä»¥ <code>Dist_fast = 2 * Dist_slow</code>ã€‚<br>
<code>L + x + k*C = 2 * (L + x)</code><br>
<code>L + x + k*C = 2L + 2x</code><br>
<code>k*C = L + x</code><br>
è¿™æ„å‘³ç€ <code>L + x</code> æ˜¯ç¯é•¿çš„æ•´æ•°å€ã€‚<br>
æˆ‘ä»¬æƒ³æ‰¾åˆ° <code>L</code>ã€‚ç”±ä¸Šå¼å¯å¾— <code>L = k*C - x</code>ã€‚<br>
è¿™ä¸ªç­‰å¼å‘Šè¯‰æˆ‘ä»¬ï¼šä»èµ·ç‚¹ <code>0</code> èµ° <code>L</code> æ­¥å¯ä»¥åˆ°è¾¾ç¯å…¥å£ <code>E</code>ã€‚åŒæ—¶ï¼Œä»ç›¸é‡ç‚¹ <code>M</code>ï¼ˆå®ƒè·ç¦»ç¯å…¥å£ <code>E</code> ä¸º <code>x</code> æ­¥ï¼‰å‘å‰èµ° <code>L</code> æ­¥ï¼Œä¹Ÿä¼šåˆ°è¾¾ç¯å…¥å£ <code>E</code>ã€‚<br>
è¿™æ˜¯å› ä¸ºä» <code>M</code> èµ° <code>L</code> æ­¥ï¼Œç›¸å½“äºèµ°äº† <code>k*C - x</code> æ­¥ã€‚åœ¨ç¯ä¸Šï¼Œèµ° <code>k*C</code> æ­¥ç­‰äºå›åˆ°åŸåœ°ï¼Œå†èµ° <code>-x</code> æ­¥ï¼ˆå³åé€€ <code>x</code> æ­¥ï¼Œæˆ–è€…ç­‰æ•ˆäºå‰è¿› <code>C-x</code> æ­¥ï¼Œå¦‚æœ <code>x &gt; 0</code>ï¼‰ï¼Œéƒ½ä¼šåˆ°è¾¾ç¯çš„å…¥å£ <code>E</code>ï¼ˆå¦‚æœ <code>x=0</code>ï¼Œåˆ™ <code>M</code> å°±æ˜¯ <code>E</code>ï¼Œèµ° <code>kC</code> æ­¥ä¹Ÿå›åˆ° <code>E</code>ï¼‰ã€‚<br>
å› æ­¤ï¼Œå½“ä¸€ä¸ªæŒ‡é’ˆä»èµ·ç‚¹ <code>0</code> å‡ºå‘ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆä»ç›¸é‡ç‚¹ <code>M</code> å‡ºå‘ï¼Œä¸¤è€…éƒ½ä»¥ç›¸åŒé€Ÿåº¦ï¼ˆæ¯æ¬¡ä¸€æ­¥ï¼‰å‰è¿›æ—¶ï¼Œå®ƒä»¬å¿…ç„¶ä¼šåœ¨ç¯çš„å…¥å£ç‚¹ <code>E</code> ç›¸é‡ã€‚<br>
è¿™ä¸ªç›¸é‡ç‚¹ <code>E</code> æ˜¯ä¸€ä¸ªç´¢å¼•å€¼ã€‚ç”±äºé¢˜ç›®è®¾å®š <code>nums[i]</code> çš„å€¼åœ¨ <code>[1, n]</code> èŒƒå›´å†…ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼è¢«ç”¨ä½œä¸‹ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆç¯çš„å…¥å£ç´¢å¼• <code>E</code> æœ¬èº«ä¹Ÿå¿…é¡»æ˜¯ <code>[1, n]</code> èŒƒå›´å†…çš„ä¸€ä¸ªå€¼ã€‚<br>
å¦‚æœç´¢å¼• <code>E</code> æ˜¯ç¯çš„å…¥å£ï¼Œæ„å‘³ç€è‡³å°‘æœ‰ä¸¤æ¡ä¸åŒçš„â€œè·¯å¾„â€æŒ‡å‘äº†ç´¢å¼• <code>E</code>ï¼šä¸€æ¡æ˜¯é¦–æ¬¡è¿›å…¥ç¯çš„è·¯å¾„ (<code>... -&gt; x_&#123;L-1&#125; --(nums[x_&#123;L-1&#125;]=E)--&gt; E</code>)ï¼Œå¦ä¸€æ¡æ˜¯ç¯å†…çš„è·¯å¾„ (<code>... -&gt; x_&#123;L+C-1&#125; --(nums[x_&#123;L+C-1&#125;]=E)--&gt; E</code>)ã€‚ç”±äº <code>x_&#123;L-1&#125;</code> å’Œ <code>x_&#123;L+C-1&#125;</code> æ˜¯ä¸åŒçš„ç´¢å¼•ï¼ˆé™¤é L=0ï¼Œå³èµ·ç‚¹å°±åœ¨ç¯ä¸Šï¼‰ï¼Œä½†å®ƒä»¬æŒ‡å‘çš„ä¸‹ä¸€ä¸ªç´¢å¼•éƒ½æ˜¯ <code>E</code> (<code>nums[x_&#123;L-1&#125;] = E</code> ä¸” <code>nums[x_&#123;L+C-1&#125;] = E</code>)ï¼Œè¿™è¡¨æ˜å€¼ <code>E</code> å°±æ˜¯é‚£ä¸ªè¢«é‡å¤æŒ‡å‘çš„æ•°å­—ï¼Œå³é‡å¤æ•°ã€‚</p>
<p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼š<code>nums = [3,1,3,4,2]</code>ã€‚é‡å¤æ•°æ˜¯ <code>3</code>ã€‚<br>
è·¯å¾„ï¼ˆç´¢å¼•åºåˆ—ï¼‰ï¼š<code>0 --(3)--&gt; 3 --(4)--&gt; 4 --(2)--&gt; 2 --(3)--&gt; 3 ...</code><br>
ç¯æ˜¯ <code>3 -&gt; 4 -&gt; 2 -&gt; 3</code>ã€‚ç¯çš„å…¥å£ç´¢å¼• <code>E = 3</code>ã€‚</p>
<p>é˜¶æ®µ 1ï¼š<code>slow=0, fast=0</code></p>
<ol>
<li><code>slow = nums[0]=3</code>, <code>fast = nums[nums[0]]=nums[3]=4</code>. (<code>slow=3, fast=4</code>)</li>
<li><code>slow = nums[3]=4</code>, <code>fast = nums[nums[4]]=nums[2]=3</code>. (<code>slow=4, fast=3</code>)</li>
<li><code>slow = nums[4]=2</code>, <code>fast = nums[nums[3]]=nums[4]=2</code>. (<code>slow=2, fast=2</code>)<br>
ç›¸é‡äºç´¢å¼• <code>M=2</code>ã€‚</li>
</ol>
<p>é˜¶æ®µ 2ï¼š<code>slow=0, fast=2</code> (ç›¸é‡ç‚¹)</p>
<ol>
<li><code>slow = nums[0]=3</code>, <code>fast = nums[2]=3</code>. (<code>slow=3, fast=3</code>)<br>
ç›¸é‡äºç´¢å¼• <code>3</code>ã€‚è¿”å› <code>slow</code>ï¼Œå³ <code>3</code>ã€‚è¿™æ­£æ˜¯é‡å¤çš„æ•°å­—ã€‚</li>
</ol>
<h3 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h3>
<p>Go è¯­è¨€ä»£ç ç›´æ¥å®ç°äº†ä¸Šè¿° Floyd åˆ¤åœˆç®—æ³•ã€‚</p>
<ol>
<li>
<p><strong>åˆå§‹åŒ–</strong>:<br>
<code>slow, fast := 0, 0</code><br>
ä¸¤ä¸ªæŒ‡é’ˆéƒ½ä»ç´¢å¼• <code>0</code> å¼€å§‹ã€‚</p>
</li>
<li>
<p><strong>é˜¶æ®µ 1: æ‰¾åˆ°ç›¸é‡ç‚¹</strong>:<br>
<code>for slow, fast = nums[slow], nums[nums[fast]]; slow != fast; slow, fast = nums[slow], nums[nums[fast]] &#123; &#125;</code></p>
<ul>
<li>è¿™ä¸ª <code>for</code> å¾ªç¯çš„ç»“æ„æ¯”è¾ƒç´§å‡‘ï¼š
<ul>
<li><strong>åˆå§‹åŒ–éƒ¨åˆ†</strong> (ä»…æ‰§è¡Œä¸€æ¬¡): <code>slow</code> è¢«èµ‹å€¼ä¸º <code>nums[0]</code>ï¼Œ<code>fast</code> è¢«èµ‹å€¼ä¸º <code>nums[nums[0]]</code>ã€‚</li>
<li><strong>æ¡ä»¶åˆ¤æ–­éƒ¨åˆ†</strong>: æ£€æŸ¥ <code>slow != fast</code>ã€‚</li>
<li><strong>å¾ªç¯ä½“</strong>: ä¸ºç©ºã€‚</li>
<li><strong>è¿­ä»£åéƒ¨åˆ†</strong>: <code>slow</code> æ›´æ–°ä¸º <code>nums[å½“å‰slow]</code>ï¼Œ<code>fast</code> æ›´æ–°ä¸º <code>nums[nums[å½“å‰fast]]</code>ã€‚ç„¶åå›åˆ°æ¡ä»¶åˆ¤æ–­ã€‚</li>
</ul>
</li>
<li>å¾ªç¯ä¼šä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ° <code>slow</code> å’Œ <code>fast</code> æŒ‡å‘ç›¸åŒçš„ç´¢å¼•ã€‚</li>
</ul>
</li>
<li>
<p><strong>é˜¶æ®µ 2: æ‰¾åˆ°ç¯çš„å…¥å£ (å³é‡å¤æ•°å­—)</strong>:<br>
<code>slow = 0</code></p>
<ul>
<li><code>slow</code> æŒ‡é’ˆè¢«é‡ç½®å›èµ·å§‹ç´¢å¼• <code>0</code>ã€‚<code>fast</code> æŒ‡é’ˆä¿æŒåœ¨é˜¶æ®µ 1 çš„ç›¸é‡ç‚¹ã€‚<br>
<code>for slow != fast &#123;</code><br>
<code>  slow = nums[slow]</code><br>
<code>  fast = nums[fast]</code><br>
<code>&#125;</code></li>
<li>æ­¤æ—¶ï¼Œ<code>slow</code> å’Œ <code>fast</code> éƒ½ä»¥æ¯æ¬¡ä¸€æ­¥çš„é€Ÿåº¦å‰è¿›ã€‚</li>
<li>å½“å®ƒä»¬å†æ¬¡ç›¸é‡æ—¶ï¼Œç›¸é‡ç‚¹ï¼ˆä¸€ä¸ªç´¢å¼•å€¼ï¼‰å°±æ˜¯ç¯çš„å…¥å£ï¼Œè¿™ä¸ªç´¢å¼•å€¼ä¹Ÿç­‰äºé‡å¤çš„æ•°å­—ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¿”å›å€¼</strong>:<br>
<code>return slow</code></p>
<ul>
<li>è¿”å›å®ƒä»¬åœ¨é˜¶æ®µ 2 ç›¸é‡æ—¶çš„ç´¢å¼• <code>slow</code>ã€‚</li>
</ul>
</li>
</ol>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<p>è¿™é‡Œæ˜¯é¢˜ç›®ä¸­æä¾›çš„ Go è¯­è¨€è§£å†³æ–¹æ¡ˆï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=287 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [287] å¯»æ‰¾é‡å¤æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findDuplicate</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// é˜¶æ®µ 1: æ‰¾åˆ°å¿«æ…¢æŒ‡é’ˆçš„ç›¸é‡ç‚¹ã€‚</span></span><br><span class="line">	<span class="comment">// &#x27;slow&#x27; å’Œ &#x27;fast&#x27; å˜é‡ä»£è¡¨æ•°ç»„ä¸­çš„ç´¢å¼•ã€‚</span></span><br><span class="line">	<span class="comment">// åˆå§‹æ—¶ï¼Œå®ƒä»¬éƒ½æŒ‡å‘ç´¢å¼• 0ã€‚</span></span><br><span class="line">	slow, fast := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿™ä¸ª for å¾ªç¯çš„ç»“æ„ï¼š</span></span><br><span class="line">	<span class="comment">// 1. åˆå§‹åŒ–å­å¥ (åªæ‰§è¡Œä¸€æ¬¡): slow æŒ‡å‘ nums[0], fast æŒ‡å‘ nums[nums[0]]ã€‚</span></span><br><span class="line">	<span class="comment">// 2. æ¡ä»¶å­å¥: slow != fastã€‚å¦‚æœä¸ºçœŸï¼Œæ‰§è¡Œå¾ªç¯ä½“ï¼ˆåœ¨æ­¤ä¸ºç©ºï¼‰ï¼Œç„¶åæ‰§è¡Œè¿­ä»£åå­å¥ã€‚</span></span><br><span class="line">	<span class="comment">// 3. è¿­ä»£åå­å¥: slow æ›´æ–°ä¸º nums[å½“å‰slow], fast æ›´æ–°ä¸º nums[nums[å½“å‰fast]]ã€‚</span></span><br><span class="line">	<span class="comment">// è¿™ä¸ªå¾ªç¯ä¼šæŒç»­ç›´åˆ° slow å’Œ fast ç›¸é‡ã€‚</span></span><br><span class="line">	<span class="keyword">for</span> slow, fast = nums[slow], nums[nums[fast]]; slow != fast; slow, fast = nums[slow], nums[nums[fast]] &#123;</span><br><span class="line">		<span class="comment">// å¾ªç¯ä½“ä¸ºç©ºï¼Œæ‰€æœ‰ç§»åŠ¨é€»è¾‘éƒ½åœ¨ for è¯­å¥çš„å¤´éƒ¨å®Œæˆã€‚</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// é˜¶æ®µ 2: æ‰¾åˆ°ç¯çš„å…¥å£ã€‚</span></span><br><span class="line">	<span class="comment">// å°† slow æŒ‡é’ˆé‡ç½®å›æ•°ç»„çš„èµ·å§‹ä½ç½® (ç´¢å¼• 0)ã€‚</span></span><br><span class="line">	<span class="comment">// fast æŒ‡é’ˆä¿æŒåœ¨é˜¶æ®µ 1 ä¸­ç›¸é‡çš„ä½ç½®ã€‚</span></span><br><span class="line">	slow = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> slow != fast &#123;</span><br><span class="line">		slow = nums[slow] <span class="comment">// slow ä»èµ·ç‚¹å¼€å§‹ï¼Œæ¯æ¬¡å‰è¿›ä¸€æ­¥ã€‚</span></span><br><span class="line">		fast = nums[fast] <span class="comment">// fast ä»ç›¸é‡ç‚¹å¼€å§‹ï¼Œæ¯æ¬¡å‰è¿›ä¸€æ­¥ã€‚</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å½“ slow å’Œ fast å†æ¬¡ç›¸é‡æ—¶ï¼Œå®ƒä»¬æ‰€åœ¨çš„ç´¢å¼•å°±æ˜¯ç¯çš„å…¥å£ï¼Œ</span></span><br><span class="line">	<span class="comment">// è¿™ä¸ªç´¢å¼•å€¼ä¹Ÿæ­£æ˜¯é¢˜ç›®æ‰€æ±‚çš„é‡å¤æ•°å­—ã€‚</span></span><br><span class="line">	<span class="keyword">return</span> slow</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h3>
<p>æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿçš„å°±æ˜¯è¿™ç§ O(1) ç©ºé—´å¤æ‚åº¦çš„è§£æ³•ã€‚å…¶ä»–å¯èƒ½æƒ³åˆ°çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>å“ˆå¸Œè¡¨/é›†åˆ</strong>ï¼šéå†æ•°ç»„ï¼Œå°†æ•°å­—å­˜å…¥å“ˆå¸Œè¡¨ã€‚å¦‚æœæ•°å­—å·²å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼Œåˆ™è¯´æ˜æ‰¾åˆ°äº†é‡å¤æ•°ã€‚
<ul>
<li>æ—¶é—´å¤æ‚åº¦: O(n)</li>
<li>ç©ºé—´å¤æ‚åº¦: O(n) (ä¸ç¬¦åˆé¢˜ç›®å¯¹ç©ºé—´å¤æ‚åº¦çš„è¦æ±‚)</li>
</ul>
</li>
<li><strong>æ’åº</strong>ï¼šå¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œç„¶åéå†æŸ¥æ‰¾ç›¸é‚»ä¸”ç›¸ç­‰çš„å…ƒç´ ã€‚
<ul>
<li>æ—¶é—´å¤æ‚åº¦: O(n log n) (å–å†³äºæ‰€ç”¨æ’åºç®—æ³•)</li>
<li>ç©ºé—´å¤æ‚åº¦: O(1) æˆ– O(n) (å–å†³äºæ’åºç®—æ³•æ˜¯å¦ä¸ºåŸåœ°æ’åºï¼Œä¸”é¢˜ç›®è¦æ±‚ä¸èƒ½ä¿®æ”¹åŸæ•°ç»„)</li>
</ul>
</li>
<li><strong>æš´åŠ›æ³•</strong>ï¼šä½¿ç”¨åŒé‡å¾ªç¯ï¼Œæ¯”è¾ƒæ•°ç»„ä¸­æ¯ä¸€å¯¹æ•°å­—æ˜¯å¦ç›¸ç­‰ã€‚
<ul>
<li>æ—¶é—´å¤æ‚åº¦: O(n^2) (å¯èƒ½å› æ•ˆç‡è¿‡ä½è€Œè¶…æ—¶ï¼Œä¸ç¬¦åˆé¢˜ç›®å¯¹æ—¶é—´å¤æ‚åº¦çš„è¦æ±‚)</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å¿«æ…¢æŒ‡é’ˆ (Floyd ç®—æ³•)</th>
<th>å“ˆå¸Œè¡¨</th>
<th>æ’åº + éå†</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n log n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(n)</td>
<td>O(1) è‹¥åŸåœ°æ’åº*</td>
</tr>
<tr>
<td>ä¿®æ”¹åŸæ•°ç»„</td>
<td>å¦</td>
<td>å¦</td>
<td>æ˜¯* / å¦ (è‹¥å¤åˆ¶æ•°ç»„)</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜… (ç¬¦åˆæ‰€æœ‰è¦æ±‚)</td>
<td>â˜…â˜…â˜†â˜†â˜† (ç©ºé—´ä¸ç¬¦)</td>
<td>â˜…â˜…â˜†â˜†â˜† (ä¿®æ”¹æˆ–æ—¶é—´ä¸ä¼˜)</td>
</tr>
</tbody>
</table>
<p><em>æ³¨ï¼šè‹¥è¦è¾¾åˆ° O(1) ç©ºé—´å¤æ‚åº¦ï¼Œæ’åºé€šå¸¸éœ€è¦åŸåœ°è¿›è¡Œï¼Œè¿™ä¼šä¿®æ”¹åŸæ•°ç»„ã€‚å¦‚æœä¸ä¿®æ”¹åŸæ•°ç»„ï¼ˆä¾‹å¦‚å…ˆå¤åˆ¶å†æ’åºï¼‰ï¼Œåˆ™ç©ºé—´å¤æ‚åº¦ä¸º O(n)ã€‚</em></p>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n)</p>
<ul>
<li>é˜¶æ®µ 1 (æ‰¾åˆ°ç›¸é‡ç‚¹): æ…¢æŒ‡é’ˆ <code>slow</code> æœ€å¤šèµ° <code>n</code> æ­¥å°±ä¼šè¿›å…¥ç¯ã€‚ä¸€æ—¦è¿›å…¥ç¯ï¼Œå¿«æŒ‡é’ˆ <code>fast</code> æœ€å¤šåœ¨ç¯å†…æ¯”æ…¢æŒ‡é’ˆå¤šèµ°ä¸€åœˆçš„è·ç¦»å°±èƒ½è¿½ä¸Šå®ƒã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ˆä½œä¸ºç´¢å¼•ï¼‰æœ€å¤šè¢«è®¿é—®å¸¸æ•°æ¬¡ã€‚å› æ­¤ï¼Œæ­¤é˜¶æ®µçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚</li>
<li>é˜¶æ®µ 2 (æ‰¾åˆ°ç¯çš„å…¥å£): <code>slow</code> ä»æ•°ç»„å¤´éƒ¨å¼€å§‹ï¼Œ<code>fast</code> ä»ç›¸é‡ç‚¹å¼€å§‹ï¼Œå®ƒä»¬éƒ½èµ° <code>L</code> æ­¥ï¼ˆå…¶ä¸­ <code>L</code> æ˜¯ä»æ•°ç»„å¤´éƒ¨åˆ°ç¯å…¥å£çš„è·¯å¾„é•¿åº¦ï¼‰ã€‚ç”±äº <code>L &lt;= n</code>ï¼Œæ­¤é˜¶æ®µçš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(n)ã€‚</li>
<li>æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(n) + O(n) = O(n)ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(1)</p>
<ul>
<li>ç®—æ³•ä»…ä½¿ç”¨äº† <code>slow</code> å’Œ <code>fast</code> ä¸¤ä¸ªé¢å¤–çš„æ•´å‹å˜é‡æ¥å­˜å‚¨ç´¢å¼•ã€‚å› æ­¤ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œå®Œå…¨ç¬¦åˆé¢˜ç›®çš„è¦æ±‚ã€‚</li>
</ul>
</li>
</ul>
<h3 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h3>
<ul>
<li><strong>é—®é¢˜è½¬åŒ–èƒ½åŠ›</strong>: å°†çœ‹ä¼¼ä¸ç›¸å…³çš„æ•°ç»„æŸ¥æ‰¾é—®é¢˜è½¬åŒ–ä¸ºé“¾è¡¨åˆ¤ç¯é—®é¢˜ï¼Œæ˜¯è§£å†³æœ¬é¢˜çš„æ ¸å¿ƒæŠ€å·§ã€‚è¿™ç§æŠ½è±¡å’Œå»ºæ¨¡èƒ½åŠ›åœ¨è§£å†³å¤æ‚ç®—æ³•é—®é¢˜æ—¶è‡³å…³é‡è¦ã€‚</li>
<li><strong>Floyd åˆ¤åœˆç®—æ³• (é¾Ÿå…”èµ›è·‘ç®—æ³•)</strong>:
<ul>
<li>è¯¥ç®—æ³•ä¸ä»…èƒ½æœ‰æ•ˆåœ°æ£€æµ‹é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨ç¯ï¼Œè¿˜èƒ½ç²¾ç¡®åœ°å®šä½ç¯çš„å…¥å£ç‚¹ã€‚</li>
<li>å®ƒæ˜¯ä¸€ç§åº”ç”¨å¹¿æ³›çš„ç®—æ³•ï¼Œä¾‹å¦‚åœ¨æ£€æµ‹å•å‘é“¾è¡¨ä¸­çš„å¾ªç¯ã€æŸäº›å¯†ç å­¦åº”ç”¨ä¸­çš„åºåˆ—åˆ†æç­‰åœºæ™¯éƒ½æœ‰åº”ç”¨ã€‚</li>
</ul>
</li>
<li><strong>æ•°å­¦åŸç†çš„ç†è§£</strong>: æ·±åˆ»ç†è§£ä¸ºä»€ä¹ˆåœ¨ç¬¬äºŒé˜¶æ®µï¼Œä¸€ä¸ªæŒ‡é’ˆä»èµ·ç‚¹å‡ºå‘ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆä»ç›¸é‡ç‚¹å‡ºå‘ï¼Œä¸¤è€…åŒæ­¥å‰è¿›æœ€ç»ˆä¼šåœ¨ç¯çš„å…¥å£ç›¸é‡ï¼Œè¿™éœ€è¦ä¸€å®šçš„æ•°å­¦æ¨å¯¼ï¼ˆå¦‚å‰æ–‡â€œè§£é¢˜æ€è·¯â€éƒ¨åˆ†æ‰€è¿°ï¼‰ã€‚
<ul>
<li>æ ¸å¿ƒç­‰å¼ï¼š<code>L = k*C - x</code> (å…¶ä¸­ <code>L</code> æ˜¯ä»èµ·ç‚¹åˆ°ç¯å…¥å£çš„è·ç¦»ï¼Œ<code>C</code> æ˜¯ç¯çš„é•¿åº¦ï¼Œ<code>x</code> æ˜¯ä»ç¯å…¥å£åˆ°å¿«æ…¢æŒ‡é’ˆé¦–æ¬¡ç›¸é‡ç‚¹çš„è·ç¦»)ã€‚è¿™ä¸ªå…³ç³»ç¡®ä¿äº†ç¬¬äºŒé˜¶æ®µä¸¤ä¸ªæŒ‡é’ˆä¼šåœ¨ç¯å…¥å£å¤„ç›¸é‡ã€‚</li>
</ul>
</li>
<li><strong>å…³æ³¨é¢˜ç›®çº¦æŸ</strong>: é¢˜ç›®ä¸­çš„é™åˆ¶æ¡ä»¶ï¼Œå¦‚â€œä¸èƒ½ä¿®æ”¹åŸæ•°ç»„â€ã€â€œåªèƒ½ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´â€ï¼Œæ˜¯å¼•å¯¼æˆ‘ä»¬æ‰¾åˆ°æ­£ç¡®è§£æ³•æ–¹å‘çš„å…³é”®çº¿ç´¢ã€‚</li>
</ul>
<p>è¿™é“é¢˜ç›®æ˜¯ä¸€é“éå¸¸ç»å…¸çš„é¢è¯•é¢˜ï¼Œæ·±å…¥ç†è§£å…¶è§£æ³•ã€èƒŒåçš„æ•°å­¦åŸç†ä»¥åŠå¦‚ä½•å°†é—®é¢˜è¿›è¡ŒæŠ½è±¡è½¬æ¢ï¼Œå¯¹äºæå‡ç®—æ³•æ€ç»´å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›å¤§æœ‰è£¨ç›Šã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>é“¾è¡¨åˆ¤ç¯</tag>
        <tag>Floydç®—æ³•</tag>
        <tag>ä¸­ç­‰</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 31 - ä¸‹ä¸€ä¸ªæ’åˆ— (Next Permutation)</title>
    <url>/2025/05/22/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/leetcode-31-next-permutation/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œæ‰¾å‡ºå…¶ä¸‹ä¸€ä¸ªå­—å…¸åºä¸­æ›´å¤§çš„æ’åˆ—ã€‚</p>
<p>å¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ï¼Œåˆ™å°†æ•°å­—é‡æ–°æ’åˆ—æˆæœ€å°çš„æ’åˆ—ï¼ˆå³å‡åºæ’åˆ—ï¼‰ã€‚</p>
<p>å¿…é¡»<strong>åŸåœ°</strong>ä¿®æ”¹ï¼Œåªå…è®¸ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<ul>
<li><code>1,2,3</code> â†’ <code>1,3,2</code></li>
<li><code>3,2,1</code> â†’ <code>1,2,3</code></li>
<li><code>1,1,5</code> â†’ <code>1,5,1</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>&quot;ä¸‹ä¸€ä¸ªæ’åˆ—&quot;çš„ç®—æ³•æ€æƒ³å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>
<p><strong>ä»å³å‘å·¦æŸ¥æ‰¾&quot;è¾ƒå°æ•°&quot;</strong>ï¼š<br>
ä»æ•°ç»„çš„æœ«å°¾å¼€å§‹å‘å‰æ‰«æï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ nums[i-1] &lt; nums[i] çš„ç´¢å¼• i-1ã€‚è¿™ä¸ª nums[i-1] å°±æ˜¯æˆ‘ä»¬å¯»æ‰¾çš„&quot;è¾ƒå°æ•°&quot;ã€‚ä¸ºä»€ä¹ˆæ˜¯ nums[i-1] å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬è¦å°½å¯èƒ½åœ°ä¿æŒé«˜ä½çš„æ•°å­—ä¸å˜ï¼Œåªåœ¨è¾ƒä½ä½è¿›è¡Œè°ƒæ•´ï¼Œä»¥å¾—åˆ°å­—å…¸åº&quot;ä¸‹ä¸€ä¸ª&quot;æ›´å¤§çš„æ’åˆ—ã€‚æ‰¾åˆ°è¿™ä¸ª nums[i-1] åï¼Œæ„å‘³ç€ä» nums[i] å¼€å§‹åˆ°æ•°ç»„æœ«å°¾çš„è¿™éƒ¨åˆ†æ˜¯é™åºçš„ï¼ˆæˆ–è€…è¯´æ˜¯éå‡åºçš„ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å¤„ç†ç‰¹æ®Šæƒ…å†µï¼šå·²ç»æ˜¯æœ€å¤§æ’åˆ—</strong>ï¼š<br>
å¦‚æœåœ¨æ­¥éª¤ 1 ä¸­æ²¡æœ‰æ‰¾åˆ°è¿™æ ·çš„ i-1ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œleft ä»ç„¶æ˜¯åˆå§‹å€¼ -1ï¼‰ï¼Œè¿™æ„å‘³ç€æ•´ä¸ªæ•°ç»„æ˜¯ä»å¤§åˆ°å°æ’åˆ—çš„ï¼ˆé™åºï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå·²ç»æ˜¯å­—å…¸åºæœ€å¤§çš„æ’åˆ—äº†ã€‚æ ¹æ®é¢˜ç›®è¦æ±‚ï¼Œæ­¤æ—¶åº”è¯¥å°†å…¶å˜ä¸ºæœ€å°çš„æ’åˆ—ï¼Œä¹Ÿå°±æ˜¯å°†æ•´ä¸ªæ•°ç»„åè½¬ï¼ˆå˜ä¸ºå‡åºï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä»å³å‘å·¦æŸ¥æ‰¾&quot;è¾ƒå¤§æ•°&quot;</strong>ï¼š<br>
å¦‚æœæ‰¾åˆ°äº†&quot;è¾ƒå°æ•°&quot; nums[left]ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨ nums[left] å³è¾¹çš„éƒ¨åˆ†ï¼ˆå³ä»ç´¢å¼• left+1 åˆ°æ•°ç»„æœ«å°¾ï¼‰æ‰¾åˆ°ä¸€ä¸ª&quot;è¾ƒå¤§æ•°&quot;ã€‚è¿™ä¸ª&quot;è¾ƒå¤§æ•°&quot; nums[right] å¿…é¡»æ»¡è¶³ nums[right] &gt; nums[left]ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„æ•°ä¸­ï¼Œå®ƒåº”è¯¥æ˜¯æœ€å°çš„é‚£ä¸ªï¼Œä½†ä¸ºäº†æ–¹ä¾¿å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä»å³å‘å·¦æ‰¾ç¬¬ä¸€ä¸ªå¤§äº nums[left] çš„æ•°ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ nums[right] å°½å¯èƒ½å°ä¸”ä½ç½®é å³ï¼Œä»è€Œä½¿å¾—äº¤æ¢åå¯¹åç»­å‡åºæ’åˆ—çš„å½±å“æœ€å°ã€‚</p>
</li>
<li>
<p><strong>äº¤æ¢&quot;è¾ƒå°æ•°&quot;å’Œ&quot;è¾ƒå¤§æ•°&quot;</strong>ï¼š<br>
å°†æ­¥éª¤ 1 ä¸­æ‰¾åˆ°çš„&quot;è¾ƒå°æ•°&quot; nums[left] ä¸æ­¥éª¤ 3 ä¸­æ‰¾åˆ°çš„&quot;è¾ƒå¤§æ•°&quot; nums[right] è¿›è¡Œäº¤æ¢ã€‚</p>
</li>
<li>
<p><strong>åè½¬&quot;è¾ƒå°æ•°&quot;ä¹‹åçš„éƒ¨åˆ†</strong>ï¼š<br>
äº¤æ¢å®Œæˆåï¼Œæ•°ç»„ nums ä¸­ç´¢å¼• left å³è¾¹çš„éƒ¨åˆ†ï¼ˆå³ä» left+1 åˆ°æœ«å°¾ï¼‰ä»ç„¶æ˜¯é™åºçš„ã€‚ä¸ºäº†å¾—åˆ°å­—å…¸åºä¸­ç´§é‚»çš„ä¸‹ä¸€ä¸ªæ’åˆ—ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™éƒ¨åˆ†å­æ•°ç»„åè½¬ï¼Œä½¿å…¶å˜ä¸ºå‡åºã€‚è¿™æ ·ï¼Œæ•´ä¸ªæ•°ç»„å°±æ„æˆäº†ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ã€‚</p>
</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ <code>[1, 3, 2]</code>ï¼š</p>
<ol>
<li>ä»å³å¾€å·¦ï¼Œ<code>2 &lt; 3</code> ä¸æ»¡è¶³ï¼Œ<code>3 &gt; 1</code>ï¼Œæ‰€ä»¥ nums[i-1] æ˜¯ <code>1</code> (<code>left = 0</code>)ã€‚</li>
<li><code>left</code> ä¸æ˜¯ <code>-1</code>ã€‚</li>
<li>åœ¨ <code>1</code> çš„å³è¾¹ <code>[3, 2]</code> ä¸­ï¼Œä»å³å¾€å·¦æ‰¾ç¬¬ä¸€ä¸ªå¤§äº <code>1</code> çš„æ•°ï¼Œæ˜¯ <code>2</code> (<code>right = 2</code>)ã€‚</li>
<li>äº¤æ¢ nums[0] å’Œ nums[2]ï¼š<code>[2, 3, 1]</code>ã€‚</li>
<li>åè½¬ nums[left+1:] å³ <code>[3, 1]</code> å˜ä¸º <code>[1, 3]</code>ã€‚æœ€ç»ˆç»“æœæ˜¯ <code>[2, 1, 3]</code>ã€‚</li>
</ol>
<p>å†ä¸¾ä¸ªä¾‹å­ <code>[4, 5, 2, 6, 3, 1]</code>ï¼š</p>
<ol>
<li>ä»å³å¾€å·¦ï¼š<code>1 &lt; 3</code>ï¼Œ<code>3 &lt; 6</code>ï¼Œ<code>6 &gt; 2</code>ã€‚æ‰€ä»¥ nums[i-1] æ˜¯ <code>2</code> (<code>left = 2</code>)ã€‚</li>
<li><code>left</code> ä¸æ˜¯ <code>-1</code>ã€‚</li>
<li>åœ¨ <code>2</code> çš„å³è¾¹ <code>[6, 3, 1]</code> ä¸­ï¼Œä»å³å¾€å·¦æ‰¾ç¬¬ä¸€ä¸ªå¤§äº <code>2</code> çš„æ•°ï¼š<code>1 &lt; 2</code> (å¦)ï¼Œ<code>3 &gt; 2</code> (æ˜¯)ã€‚æ‰€ä»¥ nums[right] æ˜¯ <code>3</code> (<code>right = 4</code>)ã€‚</li>
<li>äº¤æ¢ nums[left] (<code>2</code>) å’Œ nums[right] (<code>3</code>)ï¼šæ•°ç»„å˜ä¸º <code>[4, 5, 3, 6, 2, 1]</code>ã€‚</li>
<li>åè½¬ nums[left+1:] å³ <code>[6, 2, 1]</code>ã€‚åè½¬åå˜ä¸º <code>[1, 2, 6]</code>ã€‚</li>
<li>æœ€ç»ˆç»“æœï¼š<code>[4, 5, 3, 1, 2, 6]</code>ã€‚</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯æ­£ç¡®çš„ï¼Ÿï¼ˆé€šä¿—è§£é‡Šï¼‰">ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯æ­£ç¡®çš„ï¼Ÿï¼ˆé€šä¿—è§£é‡Šï¼‰</h3>
<p>æ‚¨å¯ä»¥å°†å¯»æ‰¾&quot;ä¸‹ä¸€ä¸ªæ’åˆ—&quot;çš„è¿‡ç¨‹æƒ³è±¡æˆç»™ä¸€ä¸²æ•°å­—&quot;å‡çº§&quot;ï¼Œç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ¯”å½“å‰æ•°å­—ä¸²&quot;å¤§ä¸€ç‚¹ç‚¹&quot;çš„æ–°æ•°å­—ä¸²ï¼Œè€Œä¸”è¿™ä¸ª&quot;å¤§ä¸€ç‚¹ç‚¹&quot;çš„å¹…åº¦è¦å°½å¯èƒ½å°ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬æœ‰ä¸€ä¸²æ•°å­—ï¼Œæ¯”å¦‚ <code>[4, 5, 2, 6, 3, 1]</code>ï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°æ¯”å®ƒç¨å¾®å¤§ä¸€ç‚¹ç‚¹çš„ä¸‹ä¸€ä¸ªæ’åˆ—ã€‚</p>
<ol>
<li>
<p><strong>ä»å³å¾€å·¦ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª&quot;å¯ä»¥å˜å¾—æ›´å¤§&quot;çš„æ•°å­—ï¼ˆæˆ‘ä»¬çš„&quot;æ‹ç‚¹&quot;ï¼‰</strong></p>
<ul>
<li>æˆ‘ä»¬ä»æœ€å³è¾¹çš„æ•°å­—å¼€å§‹çœ‹ã€‚<code>1</code> æ²¡æ³•å˜å¾—æ›´å¤§ï¼ˆé™¤éå‰é¢çš„æ•°å­—å˜äº†ï¼‰ã€‚<code>3</code> æ¯” <code>1</code> å¤§ï¼Œä½† <code>3,1</code> è¿™ä¸ªç»„åˆå·²ç»æ˜¯ <code>3</code> å¼€å¤´çš„æœ€å¤§ç»„åˆäº†ã€‚<code>6,3,1</code> ä¹Ÿæ˜¯ <code>6</code> å¼€å¤´çš„æœ€å¤§ç»„åˆã€‚</li>
<li>ç›´åˆ°æˆ‘ä»¬çœ‹åˆ° <code>2</code> å’Œ <code>6</code> (<code>nums[i-1]=2</code>, <code>nums[i]=6</code>)ã€‚å•Šå“ˆï¼è¿™é‡Œçš„ <code>2</code> æ˜¯ä¸€ä¸ª&quot;æ‹ç‚¹&quot;ï¼Œå› ä¸º <code>2 &lt; 6</code>ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ <code>2</code> æ¢æˆä¸€ä¸ªæ¯”å®ƒç¨å¾®å¤§ä¸€ç‚¹çš„æ•°ï¼Œå¹¶ä¸”è®© <code>2</code> åé¢çš„æ•°å­—æ’åˆ—å¾—å°½å¯èƒ½å°ï¼Œæˆ‘ä»¬å¯èƒ½å°±èƒ½æ‰¾åˆ°ç­”æ¡ˆã€‚</li>
<li>è¿™ä¸ª&quot;æ‹ç‚¹&quot;å°±æ˜¯æˆ‘ä»¬ä»£ç ä¸­çš„ <code>nums[left]</code> (å³æ•°å­— <code>2</code>)ã€‚å®ƒå·¦è¾¹çš„ <code>[4, 5]</code> æˆ‘ä»¬æš‚æ—¶ä¸åŠ¨ï¼Œå› ä¸ºæ”¹åŠ¨å®ƒä»¬ä¼šä½¿å¾—æ•°å­—ä¸²çš„&quot;å‡çº§&quot;å¹…åº¦è¿‡å¤§ã€‚æˆ‘ä»¬å¸Œæœ›æ”¹åŠ¨å°½å¯èƒ½é å³ã€‚</li>
<li><strong>ç‰¹æ®Šæƒ…å†µ</strong>ï¼šå¦‚æœä¸€è·¯ä»å³åˆ°å·¦éƒ½æ˜¯é™åºçš„ï¼Œæ¯”å¦‚ <code>[6, 5, 4, 3, 2, 1]</code>ï¼Œé‚£å°±è¯´æ˜è¿™å·²ç»æ˜¯&quot;é¡¶çº§é…ç½®&quot;ï¼Œä¸å¯èƒ½æœ‰æ¯”å®ƒæ›´å¤§çš„äº†ã€‚æ­¤æ—¶ï¼Œå®ƒçš„&quot;ä¸‹ä¸€ä¸ª&quot;å°±æ˜¯æœ€å°çš„æ’åˆ— <code>[1, 2, 3, 4, 5, 6]</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>åœ¨&quot;æ‹ç‚¹&quot;å³è¾¹ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ¯”å®ƒ&quot;å¤§ä¸€ç‚¹ç‚¹&quot;çš„æ•°å­—æ¥æ›¿æ¢å®ƒ</strong></p>
<ul>
<li>ç°åœ¨æˆ‘ä»¬ç›¯ä½äº†&quot;æ‹ç‚¹&quot; <code>2</code>ã€‚åœ¨å®ƒå³è¾¹çš„ <code>[6, 3, 1]</code> ä¸­ï¼Œæˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªæ¯” <code>2</code> å¤§ï¼Œä½†åˆå°½å¯èƒ½å°çš„æ•°å­—ã€‚</li>
<li><code>6</code> æ¯” <code>2</code> å¤§ï¼Œ<code>3</code> æ¯” <code>2</code> å¤§ï¼Œ<code>1</code> æ¯” <code>2</code> å°ã€‚åœ¨ <code>6</code> å’Œ <code>3</code> ä¸­ï¼Œ<code>3</code> æ˜¯é‚£ä¸ª&quot;å¤§ä¸€ç‚¹ç‚¹&quot;çš„æ•°å­—ã€‚è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä»£ç ä¸­çš„ <code>nums[right]</code>ã€‚</li>
<li>ä¸ºä»€ä¹ˆè¦æ‰¾&quot;å¤§ä¸€ç‚¹ç‚¹&quot;çš„ï¼Ÿå› ä¸ºæˆ‘ä»¬è¦çš„åªæ˜¯&quot;ä¸‹ä¸€ä¸ª&quot;æ’åˆ—ï¼Œä¸æ˜¯éšä¾¿ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ã€‚</li>
</ul>
</li>
<li>
<p><strong>äº¤æ¢è¿™ä¸¤ä¸ªæ•°å­—</strong></p>
<ul>
<li>æˆ‘ä»¬æŠŠ <code>2</code> å’Œ <code>3</code> äº¤æ¢ä½ç½®ã€‚åŸåºåˆ— <code>[4, 5, 2, 6, 3, 1]</code> å˜ä¸º <code>[4, 5, 3, 6, 2, 1]</code>ã€‚</li>
<li>ç°åœ¨ï¼Œ<code>[4, 5, 3, ...]</code> è‚¯å®šæ¯” <code>[4, 5, 2, ...]</code> è¦å¤§äº†ã€‚</li>
</ul>
</li>
<li>
<p><strong>å°†&quot;æ‹ç‚¹&quot;ä¹‹åçš„éƒ¨åˆ†é‡æ–°æ’åˆ—æˆæœ€å°çš„é¡ºåº</strong></p>
<ul>
<li>äº¤æ¢åï¼Œåºåˆ—æ˜¯ <code>[4, 5, 3, 6, 2, 1]</code>ã€‚&quot;æ‹ç‚¹&quot;ä¹‹åçš„éƒ¨åˆ†æ˜¯ <code>[6, 2, 1]</code>ã€‚</li>
<li>ä¸ºäº†ç¡®ä¿æˆ‘ä»¬å¾—åˆ°çš„æ˜¯<strong>ç´§é‚»</strong>åŸåºåˆ—çš„ä¸‹ä¸€ä¸ªæ’åˆ—ï¼ˆè€Œä¸æ˜¯éšä¾¿ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è®© <code>[6, 2, 1]</code> è¿™éƒ¨åˆ†å˜æˆå®ƒèƒ½å½¢æˆçš„æœ€å°æ’åˆ—ã€‚</li>
<li>ä¸€ä¸ªï¼ˆå¤§è‡´ï¼‰é™åºçš„åºåˆ—ï¼ˆå¦‚ <code>[6, 2, 1]</code>ï¼‰å¦‚ä½•å˜æˆæœ€å°çš„æ’åˆ—å‘¢ï¼Ÿç›´æ¥åè½¬å®ƒï¼<code>[6, 2, 1]</code> åè½¬åå˜æˆ <code>[1, 2, 6]</code>ã€‚</li>
<li>æ‰€ä»¥ï¼Œæœ€ç»ˆçš„ä¸‹ä¸€ä¸ªæ’åˆ—å°±æ˜¯ <code>[4, 5, 3, 1, 2, 6]</code>ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ä¸€ä¸‹è¿™ä¸ª&quot;å‡çº§&quot;ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>æ‰¾å¯¹åœ°æ–¹å‡çº§</strong>ï¼šä»å³è¾¹æ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½è®©æ•°å­—ä¸²&quot;å¢å€¼&quot;çš„&quot;æ‹ç‚¹&quot;ã€‚</li>
<li><strong>å°å¹…åº¦å‡çº§</strong>ï¼šç”¨ä¸€ä¸ªåªæ¯”&quot;æ‹ç‚¹&quot;å¤§ä¸€ç‚¹ç‚¹çš„æ•°å­—æ›¿æ¢å®ƒã€‚</li>
<li><strong>åç»­éƒ¨é˜Ÿæœ€å°åŒ–</strong>ï¼šè®©&quot;æ‹ç‚¹&quot;åé¢çš„æ•°å­—æ’åˆ—æˆæœ€å°çš„é¡ºåºï¼Œç¡®ä¿æ•´ä½“&quot;å‡çº§&quot;å¹…åº¦æœ€å°ã€‚</li>
</ul>
<p>è¿™æ ·ä¸€å¥—æ“ä½œä¸‹æ¥ï¼Œå°±èƒ½ä¿è¯æˆ‘ä»¬æ‰¾åˆ°çš„æ˜¯å­—å…¸åºä¸­ï¼Œåˆšå¥½æ¯”åŸæ¥å¤§ä¸€ç‚¹ç‚¹çš„é‚£ä¸ªæ’åˆ—ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>ä»¥ä¸‹æ˜¯ä¼˜åŒ–åçš„ Go è¯­è¨€ä»£ç å®ç°ï¼Œå¹¶é™„æœ‰è¯¦ç»†æ³¨é‡Šï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nextPermutation</span><span class="params">(nums []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="comment">// å¦‚æœæ•°ç»„é•¿åº¦å°äºç­‰äº1ï¼Œåˆ™æ— éœ€æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¥éª¤ 1: ä»å³å‘å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ nums[i-1] &lt; nums[i] çš„ i-1</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ª nums[i-1] å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„&quot;è¾ƒå°æ•°&quot;</span></span><br><span class="line">    <span class="comment">// å®ƒçš„å³è¾¹éƒ¨åˆ† (nums[i] åˆ° nums[n-1]) æ˜¯é™åºçš„</span></span><br><span class="line">    left := <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> i := n - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i-- &#123;</span><br><span class="line">        <span class="keyword">if</span> nums[i<span class="number">-1</span>] &lt; nums[i] &#123;</span><br><span class="line">            left = i - <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¥éª¤ 2: å¦‚æœ left == -1ï¼Œè¯´æ˜æ•´ä¸ªæ•°ç»„æ˜¯é™åºçš„ï¼Œå·²ç»æ˜¯æœ€å¤§çš„æ’åˆ—</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶ï¼Œä¸‹ä¸€ä¸ªæ’åˆ—å°±æ˜¯æœ€å°çš„æ’åˆ—ï¼Œå³æ•´ä¸ªæ•°ç»„åè½¬</span></span><br><span class="line">    <span class="keyword">if</span> left == <span class="number">-1</span> &#123;</span><br><span class="line">        reverse(nums)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¥éª¤ 3: ä»å³å‘å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ nums[j] &gt; nums[left] çš„ j</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ª nums[j] å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„&quot;è¾ƒå¤§æ•°&quot;</span></span><br><span class="line">    <span class="comment">// å› ä¸º nums[left+1:] æ˜¯é™åºçš„ï¼Œæ‰€ä»¥ä»å³å¾€å·¦ç¬¬ä¸€ä¸ªå¤§äº nums[left] çš„æ•°</span></span><br><span class="line">    <span class="comment">// å°±æ˜¯ nums[left+1:] ä¸­å¤§äº nums[left] çš„æœ€å°çš„æ•°</span></span><br><span class="line">    right := <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> i := n - <span class="number">1</span>; i &gt; left; i-- &#123; <span class="comment">// æ³¨æ„è¿™é‡Œçš„å¾ªç¯æ¡ä»¶æ˜¯ i &gt; left</span></span><br><span class="line">        <span class="keyword">if</span> nums[i] &gt; nums[left] &#123;</span><br><span class="line">            right = i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¥éª¤ 4: äº¤æ¢ nums[left] å’Œ nums[right]</span></span><br><span class="line">    nums[left], nums[right] = nums[right], nums[left]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¥éª¤ 5: åè½¬ nums[left+1:] éƒ¨åˆ†ï¼Œä½¿å…¶å˜ä¸ºå‡åº</span></span><br><span class="line">    <span class="comment">// å› ä¸ºäº¤æ¢åï¼Œnums[left+1:] éƒ¨åˆ†ä»ç„¶æ˜¯é™åºçš„</span></span><br><span class="line">    <span class="comment">// å°†å…¶åè½¬å¯ä»¥å¾—åˆ°è¿™éƒ¨åˆ†æ•°çš„æœ€å°æ’åˆ—</span></span><br><span class="line">    reverse(nums[left+<span class="number">1</span>:])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reverse å‡½æ•°ç”¨äºåè½¬ä¸€ä¸ªæ•´æ•°åˆ‡ç‰‡ (åŸåœ°æ“ä½œ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverse</span><span class="params">(nums []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span>; i &lt; j; i, j = i+<span class="number">1</span>, j<span class="number">-1</span> &#123;</span><br><span class="line">        nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>: $O(N)$</p>
<ul>
<li>æŸ¥æ‰¾ <code>left</code> æœ€å¤šéœ€è¦éå†ä¸€æ¬¡æ•°ç»„ï¼Œå¤æ‚åº¦ä¸º $O(N)$ã€‚</li>
<li>æŸ¥æ‰¾ <code>right</code> æœ€å¤šéœ€è¦éå†ä¸€æ¬¡æ•°ç»„ï¼ˆä» <code>n-1</code>åˆ° <code>left+1</code>ï¼‰ï¼Œå¤æ‚åº¦ä¸º $O(N)$ã€‚</li>
<li><code>reverse</code> å‡½æ•°åè½¬æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œæœ€å¤šåè½¬æ•´ä¸ªæ•°ç»„ï¼Œå¤æ‚åº¦ä¸º $O(N)$ã€‚</li>
<li>å› æ­¤ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(N)$ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>: $O(1)$</p>
<ul>
<li>ç®—æ³•æ˜¯åœ¨åŸåœ°ä¿®æ”¹æ•°ç»„ï¼Œåªä½¿ç”¨äº†å‡ ä¸ªé¢å¤–çš„å˜é‡æ¥å­˜å‚¨ç´¢å¼•ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯å¸¸æ•°çº§åˆ«çš„ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li>ç†è§£&quot;ä¸‹ä¸€ä¸ªå­—å…¸åºæ’åˆ—&quot;çš„å«ä¹‰æ˜¯å…³é”®ã€‚ç›®æ ‡æ˜¯æ‰¾åˆ°æ¯”å½“å‰æ’åˆ—&quot;å¤§ä¸€ç‚¹ç‚¹&quot;çš„ä¸‹ä¸€ä¸ªæ’åˆ—ã€‚</li>
<li>ç®—æ³•çš„æ ¸å¿ƒåœ¨äºä»å³è¾¹æ‰¾åˆ°ä¸€ä¸ª&quot;æ‹ç‚¹&quot;ï¼ˆè¾ƒå°æ•°ï¼‰ï¼Œç„¶åç”¨å³è¾¹ä¸€ä¸ªæ°å¥½æ¯”å®ƒå¤§çš„æ•°ï¼ˆè¾ƒå¤§æ•°ï¼‰æ›¿æ¢å®ƒï¼Œå¹¶é‡æ’å‰©ä½™éƒ¨åˆ†ä¸ºæœ€å°åºåˆ—ã€‚</li>
<li>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„æ•°ç»„æ“ä½œé—®é¢˜ï¼Œé€šè¿‡å·§å¦™çš„æŸ¥æ‰¾å’Œåè½¬æ“ä½œï¼Œå¯ä»¥åœ¨çº¿æ€§æ—¶é—´å’Œå¸¸æ•°ç©ºé—´å†…è§£å†³ã€‚</li>
<li>æ³¨æ„è¾¹ç•Œæ¡ä»¶ï¼Œä¾‹å¦‚æ•°ç»„æœ¬èº«å°±æ˜¯æœ€å¤§æ’åˆ—ï¼ˆå®Œå…¨é™åºï¼‰çš„æƒ…å†µã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç»“æ„ï¼šæ•´æ•°é›†åˆè¯¦è§£</title>
    <url>/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>æ•´æ•°é›†åˆï¼ˆintsetï¼‰æ˜¯ Redis ä¸­çš„ä¸€ä¸ªé‡è¦åº•å±‚æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºä¼˜åŒ– Set æ•°æ®ç±»å‹åœ¨ç‰¹å®šåœºæ™¯ä¸‹çš„å†…å­˜ä½¿ç”¨æ•ˆç‡ã€‚å½“ä¸€ä¸ª Set é›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ æ•°é‡è¾ƒå°‘æ—¶ï¼ŒRedis ä¼šä½¿ç”¨æ•´æ•°é›†åˆè€Œéå“ˆå¸Œè¡¨æ¥å­˜å‚¨æ•°æ®ï¼Œä»è€Œå¤§å¹…é™ä½å†…å­˜å ç”¨ã€‚æ•´æ•°é›†åˆçš„è®¾è®¡ä½“ç°äº† Redis å¯¹å†…å­˜æ•ˆç‡çš„æè‡´è¿½æ±‚ï¼Œä¹Ÿæ˜¯ç†è§£ Redis å†…å­˜ä¼˜åŒ–ç­–ç•¥çš„å…¸å‹æ¡ˆä¾‹ã€‚</p>
<h2 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 id="æ•´æ•°é›†åˆçš„å®šä¹‰">æ•´æ•°é›†åˆçš„å®šä¹‰</h3>
<p>æ•´æ•°é›†åˆæ˜¯ Redis Set å¯¹è±¡çš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚å½“ä¸€ä¸ª Set å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼ŒRedis ä¼šé€‰æ‹©ä½¿ç”¨æ•´æ•°é›†åˆä½œä¸ºå…¶åº•å±‚å®ç°ï¼š</p>
<ol>
<li>é›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼</li>
<li>é›†åˆçš„å…ƒç´ æ•°é‡ä¸è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆé»˜è®¤é…ç½®ä¸‹ä¸º 512 ä¸ªå…ƒç´ ï¼‰</li>
</ol>
<h3 id="æ•´æ•°é›†åˆç»“æ„è®¾è®¡">æ•´æ•°é›†åˆç»“æ„è®¾è®¡</h3>
<p>æ•´æ•°é›†åˆæœ¬è´¨ä¸Šæ˜¯ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ï¼Œå®ƒçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">intset</span> &#123;</span></span><br><span class="line">    <span class="comment">// ç¼–ç æ–¹å¼ï¼Œå†³å®šæ•´æ•°çš„ç±»å‹å’Œé•¿åº¦</span></span><br><span class="line">    <span class="type">uint32_t</span> encoding;</span><br><span class="line">    <span class="comment">// é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡</span></span><br><span class="line">    <span class="type">uint32_t</span> length;</span><br><span class="line">    <span class="comment">// ä¿å­˜å…ƒç´ çš„æ•°ç»„ï¼Œå®é™…ç±»å‹å–å†³äºencoding</span></span><br><span class="line">    <span class="type">int8_t</span> contents[];</span><br><span class="line">&#125; intset;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶ contents è¢«å£°æ˜ä¸º int8_t ç±»å‹çš„æ•°ç»„ï¼Œä½†å®é™…ä¸Šå®ƒå­˜å‚¨çš„å…ƒç´ ç±»å‹ç”± encoding å±æ€§å†³å®šï¼š</p>
<ul>
<li><code>INTSET_ENC_INT16</code>ï¼šcontents ä½œä¸º int16_t ç±»å‹æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ å  2 å­—èŠ‚</li>
<li><code>INTSET_ENC_INT32</code>ï¼šcontents ä½œä¸º int32_t ç±»å‹æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ å  4 å­—èŠ‚</li>
<li><code>INTSET_ENC_INT64</code>ï¼šcontents ä½œä¸º int64_t ç±»å‹æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ å  8 å­—èŠ‚</li>
</ul>
<h2 id="å®ç°æœºåˆ¶">å®ç°æœºåˆ¶</h2>
<h3 id="æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ">æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œ</h3>
<p>æ•´æ•°é›†åˆçš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯<strong>å‡çº§æœºåˆ¶</strong>ã€‚å½“å‘æ•´æ•°é›†åˆä¸­æ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ ï¼Œå¦‚æœè¯¥å…ƒç´ çš„ç±»å‹æ¯”é›†åˆç°æœ‰æ‰€æœ‰å…ƒç´ çš„ç±»å‹éƒ½è¦é•¿æ—¶ï¼Œæ•´æ•°é›†åˆä¼šè¿›è¡Œå‡çº§æ“ä½œï¼š</p>
<ol>
<li>æ ¹æ®æ–°å…ƒç´ çš„ç±»å‹æ‰©å±• contents æ•°ç»„çš„ç©ºé—´</li>
<li>å°†ç°æœ‰å…ƒç´ è½¬æ¢ä¸ºæ–°ç±»å‹å¹¶é‡æ–°æ’åˆ—åˆ°æ­£ç¡®çš„ä½ç½®</li>
<li>å°†æ–°å…ƒç´ æ·»åŠ åˆ°é›†åˆä¸­å¹¶ä¿æŒæœ‰åºæ€§</li>
</ol>
<p>ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªå­˜å‚¨ int16_t ç±»å‹å…ƒç´ çš„æ•´æ•°é›†åˆéœ€è¦æ·»åŠ ä¸€ä¸ª int32_t ç±»å‹çš„æ–°å…ƒç´ æ—¶ï¼š</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88/1747897381977.png" alt="å‡çº§å‰çš„æ•´æ•°é›†åˆ"></p>
<p>å‡è®¾è¦æ·»åŠ çš„æ–°å…ƒç´ æ˜¯ 65535ï¼ˆéœ€è¦ int32_t ç±»å‹å­˜å‚¨ï¼‰ï¼Œé¦–å…ˆéœ€è¦æ‰©å±• contents æ•°ç»„ç©ºé—´ï¼š</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88/1747897388714.png" alt="æ‰©å®¹åçš„ç©ºé—´"></p>
<p>ç„¶åå°†åŸæœ‰çš„ä¸‰ä¸ª int16_t ç±»å‹å…ƒç´ è½¬æ¢ä¸º int32_t ç±»å‹ï¼Œå¹¶æ”¾ç½®åˆ°æ­£ç¡®çš„ä½ç½®ï¼š</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88/1747897403523.png" alt="å…ƒç´ é‡æ’åçš„æ•´æ•°é›†åˆ"></p>
<h3 id="å‡çº§çš„å¥½å¤„ä¸é™åˆ¶">å‡çº§çš„å¥½å¤„ä¸é™åˆ¶</h3>
<p>æ•´æ•°é›†åˆå‡çº§çš„ä¸»è¦å¥½å¤„æ˜¯<strong>èŠ‚çœå†…å­˜èµ„æº</strong>ã€‚å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½èƒ½ç”¨è¾ƒå°çš„æ•´æ•°ç±»å‹è¡¨ç¤ºï¼Œå°±ä¸å¿…ä¸ºæ‰€æœ‰å…ƒç´ éƒ½åˆ†é…æœ€å¤§ç±»å‹çš„ç©ºé—´ã€‚åªæœ‰åœ¨ç¡®å®éœ€è¦æ›´å¤§ç±»å‹æ—¶ï¼Œæ•´æ•°é›†åˆæ‰ä¼šè¿›è¡Œå‡çº§ã€‚</p>
<p>ç„¶è€Œï¼Œæ•´æ•°é›†åˆ<strong>ä¸æ”¯æŒé™çº§æ“ä½œ</strong>ã€‚ä¸€æ—¦å‡çº§åˆ°æ›´å¤§çš„æ•´æ•°ç±»å‹ï¼Œå³ä½¿åˆ é™¤äº†æ‰€æœ‰éœ€è¦è¯¥ç±»å‹çš„å…ƒç´ ï¼Œæ•´æ•°é›†åˆä¹Ÿä¸ä¼šå›é€€åˆ°è¾ƒå°çš„ç±»å‹ã€‚è¿™æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘çš„è®¾è®¡å†³ç­–ï¼Œé¿å…äº†é¢‘ç¹çš„å†…å­˜é‡åˆ†é…æ“ä½œã€‚</p>
<h2 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h2>
<p>Redis è‡ªåŠ¨ç®¡ç†æ•´æ•°é›†åˆçš„ä½¿ç”¨ï¼Œç”¨æˆ·æ— éœ€ç›´æ¥æ“ä½œã€‚å½“ä½¿ç”¨ Set ç›¸å…³å‘½ä»¤ä¸”æ»¡è¶³ä½¿ç”¨æ•´æ•°é›†åˆçš„æ¡ä»¶æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨é€‰æ‹©æ•´æ•°é›†åˆä½œä¸ºåº•å±‚å®ç°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåŒ…å«æ•´æ•°çš„é›†åˆ</span></span><br><span class="line">SADD numbers 1 2 3 4 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹åº•å±‚å®ç°ï¼ˆåœ¨å°é›†åˆä¸”éƒ½æ˜¯æ•´æ•°æ—¶ä¼šæ˜¯intsetï¼‰</span></span><br><span class="line">OBJECT ENCODING numbers  <span class="comment"># è¿”å› &quot;intset&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä¸€ä¸ªéæ•´æ•°å…ƒç´ ä¼šå¯¼è‡´è½¬æ¢ä¸ºå“ˆå¸Œè¡¨å®ç°</span></span><br><span class="line">SADD numbers <span class="string">&quot;a&quot;</span></span><br><span class="line">OBJECT ENCODING numbers  <span class="comment"># è¿”å› &quot;hashtable&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ•´æ•°é›†åˆçš„æ“ä½œå¤æ‚åº¦">æ•´æ•°é›†åˆçš„æ“ä½œå¤æ‚åº¦</h2>
<p>æ•´æ•°é›†åˆçš„ä¸»è¦æ“ä½œæ—¶é—´å¤æ‚åº¦å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>æŸ¥æ‰¾å…ƒç´ </strong>ï¼šO(log N)ï¼Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</li>
<li><strong>æ·»åŠ å…ƒç´ </strong>ï¼šO(N)ï¼Œå¯èƒ½éœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ </li>
<li><strong>åˆ é™¤å…ƒç´ </strong>ï¼šO(N)ï¼Œéœ€è¦ç§»åŠ¨è¢«åˆ é™¤å…ƒç´ ä¹‹åçš„æ‰€æœ‰å…ƒç´ </li>
</ul>
<p>æ•´æ•°é›†åˆè™½ç„¶èŠ‚çœå†…å­˜ï¼Œä½†åœ¨æ·»åŠ å’Œåˆ é™¤æ“ä½œä¸Šå¹¶ä¸å¦‚å“ˆå¸Œè¡¨é«˜æ•ˆï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®ƒåªç”¨äºå°å‹é›†åˆçš„åŸå› ã€‚</p>
<h2 id="å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 id="é—®é¢˜ï¼šæ•´æ•°é›†åˆä½•æ—¶ä¼šè½¬æ¢ä¸ºå“ˆå¸Œè¡¨ï¼Ÿ">é—®é¢˜ï¼šæ•´æ•°é›†åˆä½•æ—¶ä¼šè½¬æ¢ä¸ºå“ˆå¸Œè¡¨ï¼Ÿ</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼ŒRedis ä¼šå°†æ•´æ•°é›†åˆè½¬æ¢ä¸ºå“ˆå¸Œè¡¨ï¼š</p>
<ol>
<li>æ·»åŠ äº†éæ•´æ•°å…ƒç´ </li>
<li>å…ƒç´ æ•°é‡è¶…è¿‡äº†è®¾å®šé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 512ï¼‰</li>
</ol>
<h3 id="é—®é¢˜ï¼šä¸ºä»€ä¹ˆæ•´æ•°é›†åˆä¸æ”¯æŒé™çº§ï¼Ÿ">é—®é¢˜ï¼šä¸ºä»€ä¹ˆæ•´æ•°é›†åˆä¸æ”¯æŒé™çº§ï¼Ÿ</h3>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä¸æ”¯æŒé™çº§æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘ã€‚é™çº§æ“ä½œéœ€è¦é‡æ–°åˆ†é…å†…å­˜å¹¶ç§»åŠ¨å…ƒç´ ï¼Œè¿™äº›æ“ä½œæˆæœ¬è¾ƒé«˜ï¼Œè€Œä¸”å¯èƒ½ä¼šå› ä¸ºåå¤çš„å‡çº§å’Œé™çº§å¯¼è‡´æ€§èƒ½æ³¢åŠ¨ã€‚</p>
<h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>å°å‹æ•´æ•°é›†åˆçš„ä¼˜åŠ¿</strong>ï¼šå½“ç¡®å®š Set åªåŒ…å«å°‘é‡æ•´æ•°æ—¶ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼ŒRedis ä¼šè‡ªåŠ¨ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
<li><strong>é¿å…æ··åˆç±»å‹</strong>ï¼šå¦‚æœè¦åˆ©ç”¨æ•´æ•°é›†åˆçš„å†…å­˜ä¼˜åŒ–ï¼Œç¡®ä¿é›†åˆä¸­åªå­˜å‚¨æ•´æ•°å€¼</li>
<li><strong>æ§åˆ¶é›†åˆå¤§å°</strong>ï¼šå½“æ•´æ•°é›†åˆå…ƒç´ æ•°é‡è¶…è¿‡é˜ˆå€¼åï¼Œä¼šè½¬æ¢ä¸ºå“ˆå¸Œè¡¨ï¼Œå¤±å»å†…å­˜ä¼˜åŒ–çš„å¥½å¤„</li>
</ol>
<h2 id="é¢è¯•è¦ç‚¹">é¢è¯•è¦ç‚¹</h2>
<ol>
<li><strong>æ•´æ•°é›†åˆçš„å®šä¹‰ä¸ä½¿ç”¨åœºæ™¯</strong>ï¼šç”¨äºä¼˜åŒ–åªåŒ…å«æ•´æ•°ä¸”å…ƒç´ æ•°é‡è¾ƒå°‘çš„ Set é›†åˆ</li>
<li><strong>å‡çº§æœºåˆ¶</strong>ï¼šå½“æ·»åŠ æ›´å¤§ç±»å‹çš„æ•´æ•°æ—¶å¦‚ä½•è¿›è¡Œå‡çº§ï¼Œä»¥åŠå‡çº§çš„å…·ä½“æ­¥éª¤</li>
<li><strong>ä¸æ”¯æŒé™çº§çš„åŸå› </strong>ï¼šæ€§èƒ½è€ƒè™‘ï¼Œé¿å…é¢‘ç¹çš„å†…å­˜é‡åˆ†é…</li>
<li><strong>æ•´æ•°é›†åˆçš„ä¼˜ç¼ºç‚¹</strong>ï¼š
<ul>
<li>ä¼˜ç‚¹ï¼šå†…å­˜æ•ˆç‡é«˜ï¼Œé€‚åˆå­˜å‚¨å°å‹æ•´æ•°é›†åˆ</li>
<li>ç¼ºç‚¹ï¼šæ·»åŠ å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œä¸å¦‚å“ˆå¸Œè¡¨</li>
</ul>
</li>
</ol>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="http://redisbook.com/">Redis è®¾è®¡ä¸å®ç°</a></li>
<li><a href="https://redis.io/documentation">Redis å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="http://zhangtielei.com/posts/blog-redis-dict.html">Redis å†…éƒ¨æ•°æ®ç»“æ„è¯¦è§£</a></li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Redis</tag>
        <tag>æ•´æ•°é›†åˆ</tag>
        <tag>intset</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç»“æ„ï¼šå“ˆå¸Œè¡¨è¯¦è§£</title>
    <url>/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="å“ˆå¸Œè¡¨">å“ˆå¸Œè¡¨</h2>
<p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨é”®å€¼å¯¹ï¼ˆkey-valueï¼‰çš„é«˜æ•ˆæ•°æ®ç»“æ„ã€‚åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯ä¸ªé”®éƒ½æ˜¯å”¯ä¸€çš„ï¼Œé€šè¿‡é”®å¯ä»¥å¿«é€ŸæŸ¥æ‰¾ã€æ›´æ–°æˆ–åˆ é™¤å¯¹åº”çš„å€¼ã€‚</p>
<p>Redis çš„ Hash å¯¹è±¡æœ‰ä¸¤ç§åº•å±‚å®ç°ï¼šä¸€ç§æ˜¯æœ¬æ–‡å°†è¦è¯¦ç»†ä»‹ç»çš„å“ˆå¸Œè¡¨ï¼Œå¦ä¸€ç§æ˜¯å‹ç¼©åˆ—è¡¨ï¼ˆåœ¨æœ€æ–°çš„ Redis ç‰ˆæœ¬ä¸­å·²è¢« listpack æ›¿ä»£ï¼‰ã€‚</p>
<p>å“ˆå¸Œè¡¨çš„æœ€å¤§ä¼˜åŠ¿åœ¨äºå…¶<strong>æ—¶é—´å¤æ‚åº¦ä¸º O(1) çš„æŸ¥è¯¢æ•ˆç‡</strong>ã€‚å®ç°åŸç†æ˜¯å°†é”®é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å¾—åˆ°å“ˆå¸Œå€¼ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå“ˆå¸Œå€¼å®šä½åˆ°å“ˆå¸Œè¡¨ï¼ˆæœ¬è´¨æ˜¯æ•°ç»„ï¼‰ä¸­çš„å…·ä½“ä½ç½®ï¼Œä»è€Œå®ç°å¿«é€Ÿè®¿é—®æ•°æ®ã€‚</p>
<p>ç„¶è€Œï¼Œå½“å“ˆå¸Œè¡¨å¤§å°å›ºå®šè€Œæ•°æ®é‡ä¸æ–­å¢åŠ æ—¶ï¼Œ<strong>å“ˆå¸Œå†²çª</strong>çš„æ¦‚ç‡ä¼šæ˜¾è‘—æé«˜ï¼Œè¿™ä¼šå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚ä¸ºè§£å†³è¿™ä¸€é—®é¢˜ï¼ŒRedis é‡‡ç”¨äº†ã€Œé“¾å¼å“ˆå¸Œã€å’Œã€Œrehashã€ä¸¤ç§å…³é”®æœºåˆ¶ï¼Œä¸‹é¢å°†è¯¦ç»†ä»‹ç»ã€‚</p>
<h3 id="å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡">å“ˆå¸Œè¡¨ç»“æ„è®¾è®¡</h3>
<p>Redis ä¸­å“ˆå¸Œè¡¨çš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictht</span> &#123;</span></span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨æ•°ç»„</span></span><br><span class="line">    dictEntry **table;</span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨å¤§å°</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> size;  </span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨å¤§å°æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> sizemask;</span><br><span class="line">    <span class="comment">//è¯¥å“ˆå¸Œè¡¨å·²æœ‰çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> used;</span><br><span class="line">&#125; dictht;</span><br></pre></td></tr></table></figure>
<p>ä»ç»“æ„ä½“å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œå“ˆå¸Œè¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆ<code>dictEntry **table</code>ï¼‰ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æŒ‡å‘å“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼ˆ<code>dictEntry</code>ï¼‰çš„æŒ‡é’ˆã€‚</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/1747896893898.png" alt="Rediså“ˆå¸Œè¡¨ç»“æ„ç¤ºæ„å›¾"></p>
<p>å“ˆå¸Œè¡¨èŠ‚ç‚¹çš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> &#123;</span></span><br><span class="line">    <span class="comment">//é”®å€¼å¯¹ä¸­çš„é”®</span></span><br><span class="line">    <span class="type">void</span> *key;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//é”®å€¼å¯¹ä¸­çš„å€¼</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="type">void</span> *val;</span><br><span class="line">        <span class="type">uint64_t</span> u64;</span><br><span class="line">        <span class="type">int64_t</span> s64;</span><br><span class="line">        <span class="type">double</span> d;</span><br><span class="line">    &#125; v;</span><br><span class="line">    <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; dictEntry;</span><br></pre></td></tr></table></figure>
<p><code>dictEntry</code> ç»“æ„ä¸ä»…åŒ…å«æŒ‡å‘é”®å’Œå€¼çš„æŒ‡é’ˆï¼Œè¿˜åŒ…å«æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚è¿™ä¸ª <code>next</code> æŒ‡é’ˆä½¿å¾—å¤šä¸ªå“ˆå¸Œå€¼ç›¸åŒçš„é”®å€¼å¯¹èƒ½å¤Ÿé“¾æ¥æˆé“¾è¡¨ï¼Œä»è€Œè§£å†³å“ˆå¸Œå†²çªé—®é¢˜ï¼Œè¿™å°±æ˜¯é“¾å¼å“ˆå¸Œçš„å®ç°åŸºç¡€ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>dictEntry</code> ç»“æ„ä¸­çš„å€¼ä½¿ç”¨äº†è”åˆä½“ï¼ˆ<code>union</code>ï¼‰å®šä¹‰ï¼Œè¿™æ„å‘³ç€å€¼å¯ä»¥æ˜¯æŒ‡å‘å®é™…æ•°æ®çš„æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ˜¯ 64 ä½æ•´æ•°ï¼ˆæœ‰ç¬¦å·æˆ–æ— ç¬¦å·ï¼‰æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚è¿™ç§è®¾è®¡èƒ½å¤ŸèŠ‚çœå†…å­˜ç©ºé—´â€”â€”å½“å€¼ä¸ºæ•´æ•°æˆ–æµ®ç‚¹æ•°æ—¶ï¼Œå¯ä»¥ç›´æ¥å†…åµŒåœ¨ <code>dictEntry</code> ç»“æ„ä¸­ï¼Œæ— éœ€é¢å¤–çš„æŒ‡é’ˆå¼•ç”¨ï¼Œä»è€Œå‡å°‘å†…å­˜å¼€é”€ã€‚</p>
<h3 id="å“ˆå¸Œå†²çª">å“ˆå¸Œå†²çª</h3>
<p>å“ˆå¸Œè¡¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ç§°ä¸ºå“ˆå¸Œæ¡¶ã€‚é”®å€¼å¯¹åœ¨å“ˆå¸Œè¡¨ä¸­çš„å­˜å‚¨ä½ç½®æ˜¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤ç¡®å®šçš„ï¼š</p>
<ol>
<li>é”®é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å¾—åˆ°å“ˆå¸Œå€¼</li>
<li>å°†å“ˆå¸Œå€¼ä¸å“ˆå¸Œè¡¨å¤§å°è¿›è¡Œå–æ¨¡è¿ç®—ï¼ˆå“ˆå¸Œå€¼ % å“ˆå¸Œè¡¨å¤§å°ï¼‰</li>
<li>å–æ¨¡çš„ç»“æœå°±æ˜¯è¯¥é”®å€¼å¯¹åœ¨å“ˆå¸Œè¡¨æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®</li>
</ol>
<p>å½“ä¸¤ä¸ªæˆ–å¤šä¸ªä¸åŒçš„é”®ç»è¿‡ä¸Šè¿°è®¡ç®—åå¾—åˆ°ç›¸åŒçš„ç´¢å¼•ä½ç½®æ—¶ï¼Œå°±å‘ç”Ÿäº†å“ˆå¸Œå†²çªã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªåŒ…å« 8 ä¸ªå“ˆå¸Œæ¡¶çš„å“ˆå¸Œè¡¨ã€‚å¦‚æœ key1 å’Œ key9 é€šè¿‡å“ˆå¸Œè®¡ç®—åéƒ½æ˜ å°„åˆ°å“ˆå¸Œæ¡¶ 1ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªé”®å°±å‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/1747896904751.png" alt="å“ˆå¸Œå†²çªç¤ºä¾‹å›¾"></p>
<h3 id="é“¾å¼å“ˆå¸Œ">é“¾å¼å“ˆå¸Œ</h3>
<p>ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªï¼ŒRedis é‡‡ç”¨äº†ã€Œé“¾å¼å“ˆå¸Œã€ï¼ˆchain hashingï¼‰æŠ€æœ¯ã€‚</p>
<p>é“¾å¼å“ˆå¸Œçš„åŸç†æ˜¯ï¼šå½“å¤šä¸ªé”®æ˜ å°„åˆ°åŒä¸€ä¸ªå“ˆå¸Œæ¡¶æ—¶ï¼Œè¿™äº›é”®å€¼å¯¹ä¼šé€šè¿‡ <code>next</code> æŒ‡é’ˆè¿æ¥æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚è¿™æ ·ï¼Œå³ä½¿å‘ç”Ÿå“ˆå¸Œå†²çªï¼Œä¹Ÿèƒ½é€šè¿‡éå†é“¾è¡¨æ‰¾åˆ°ç›®æ ‡é”®å€¼å¯¹ã€‚</p>
<p>ä»¥å‰é¢çš„ä¾‹å­ä¸ºä¾‹ï¼Œå½“ key1 å’Œ key9 éƒ½æ˜ å°„åˆ°å“ˆå¸Œæ¡¶ 1 æ—¶ï¼Œå®ƒä»¬ä¼šå½¢æˆå¦‚ä¸‹å›¾æ‰€ç¤ºçš„é“¾è¡¨ç»“æ„ï¼š</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/1747896913213.png" alt="é“¾å¼å“ˆå¸Œè§£å†³å†²çªç¤ºä¾‹å›¾"></p>
<p>ç„¶è€Œï¼Œé“¾å¼å“ˆå¸Œä¹Ÿæœ‰å…¶å±€é™æ€§ã€‚éšç€é“¾è¡¨é•¿åº¦å¢åŠ ï¼Œåœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾ç‰¹å®šé”®çš„æ—¶é—´å¤æ‚åº¦ä¼šä» O(1) é€€åŒ–ä¸º O(n)ï¼Œè¿™ä¼šæ˜¾è‘—é™ä½æŸ¥è¯¢æ•ˆç‡ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦é€šè¿‡ rehash æ“ä½œæ¥æ‰©å±•å“ˆå¸Œè¡¨çš„å¤§å°ï¼Œå‡å°‘å“ˆå¸Œå†²çªçš„æ¦‚ç‡ã€‚</p>
<h3 id="rehash-æœºåˆ¶">rehash æœºåˆ¶</h3>
<p>åœ¨å‰é¢ä»‹ç»å“ˆå¸Œè¡¨ç»“æ„æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† Redis ä½¿ç”¨ <code>dictht</code> ç»“æ„ä½“è¡¨ç¤ºå“ˆå¸Œè¡¨ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒRedis å®šä¹‰äº†ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨çš„ <code>dict</code> ç»“æ„ä½“ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dict</span> &#123;</span></span><br><span class="line">    â€¦</span><br><span class="line">    <span class="comment">//ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œäº¤æ›¿ä½¿ç”¨ï¼Œç”¨äº rehash æ“ä½œ</span></span><br><span class="line">    dictht ht[<span class="number">2</span>]; </span><br><span class="line">    â€¦</span><br><span class="line">&#125; dict;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤ä¸ªå“ˆå¸Œè¡¨çš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†æ”¯æŒ rehash æ“ä½œã€‚ä¸‹å›¾å±•ç¤ºäº†åŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨çš„ <code>dict</code> ç»“æ„ï¼š</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/1747896920473.png" alt="Redis dictç»“æ„åŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨"></p>
<p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨ã€Œå“ˆå¸Œè¡¨ 1ã€ä¸­ï¼Œè€Œã€Œå“ˆå¸Œè¡¨ 2ã€å¹¶ä¸åˆ†é…ç©ºé—´ã€‚å½“éœ€è¦æ‰©å±•å“ˆå¸Œè¡¨å®¹é‡æ—¶ï¼ŒRedis ä¼šè§¦å‘ rehash æ“ä½œï¼Œè¯¥è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ä¸ºã€Œå“ˆå¸Œè¡¨ 2ã€åˆ†é…ç©ºé—´ï¼Œé€šå¸¸æ˜¯ã€Œå“ˆå¸Œè¡¨ 1ã€å®¹é‡çš„ä¸¤å€</li>
<li>å°†ã€Œå“ˆå¸Œè¡¨ 1ã€ä¸­çš„æ‰€æœ‰æ•°æ®é‡æ–°è®¡ç®—å“ˆå¸Œå€¼å¹¶è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ä¸­</li>
<li>è¿ç§»å®Œæˆåï¼Œé‡Šæ”¾ã€Œå“ˆå¸Œè¡¨ 1ã€çš„ç©ºé—´ï¼Œå°†ã€Œå“ˆå¸Œè¡¨ 2ã€è®¾ç½®ä¸ºã€Œå“ˆå¸Œè¡¨ 1ã€ï¼Œå¹¶åœ¨ã€Œå“ˆå¸Œè¡¨ 2ã€ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹ä¸€æ¬¡ rehash åšå‡†å¤‡</li>
</ol>
<p>rehash è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/1747896929113.png" alt="rehashè¿‡ç¨‹ç¤ºæ„å›¾"></p>
<p>ç„¶è€Œï¼Œè¿™ç§ä¸€æ¬¡æ€§è¿ç§»çš„æ–¹å¼å­˜åœ¨é—®é¢˜ï¼šå½“ã€Œå“ˆå¸Œè¡¨ 1ã€ä¸­çš„æ•°æ®é‡éå¸¸å¤§æ—¶ï¼Œä¸€æ¬¡æ€§è¿ç§»ä¼šæ¶‰åŠå¤§é‡æ•°æ®æ‹·è´ï¼Œå¯èƒ½å¯¼è‡´ Redis æœåŠ¡æš‚æ—¶é˜»å¡ï¼Œæ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚ï¼Œè¿™å¯¹äºè¦æ±‚é«˜æ€§èƒ½çš„ Redis æœåŠ¡æ˜¯ä¸å¯æ¥å—çš„ã€‚</p>
<h3 id="æ¸è¿›å¼-rehash">æ¸è¿›å¼ rehash</h3>
<p>ä¸ºäº†é¿å… rehash è¿‡ç¨‹ä¸­çš„æœåŠ¡é˜»å¡ï¼ŒRedis å®ç°äº†ã€Œæ¸è¿›å¼ rehashã€æœºåˆ¶ï¼Œå°†æ•°æ®è¿ç§»å·¥ä½œåˆ†æ•£åˆ°å¤šæ¬¡æ“ä½œä¸­å®Œæˆã€‚</p>
<p>æ¸è¿›å¼ rehash çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸ºã€Œå“ˆå¸Œè¡¨ 2ã€åˆ†é…ç©ºé—´</li>
<li>åœ¨ rehash è¿›è¡ŒæœŸé—´ï¼Œæ¯æ¬¡å¯¹å“ˆå¸Œè¡¨æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œæ—¶ï¼Œé™¤äº†å®Œæˆè¯·æ±‚çš„æ“ä½œå¤–ï¼Œè¿˜ä¼šé¡ºå¸¦å°†ã€Œå“ˆå¸Œè¡¨ 1ã€ä¸­ä¸€éƒ¨åˆ†æ•°æ®è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€</li>
<li>éšç€å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸æ–­å¤„ç†ï¼Œã€Œå“ˆå¸Œè¡¨ 1ã€çš„æ•°æ®ä¼šé€æ¸è¿ç§»å®Œæ¯•ï¼Œæœ€ç»ˆå®Œæˆæ•´ä¸ª rehash è¿‡ç¨‹</li>
</ol>
<p>è¿™ç§æ–¹å¼å·§å¦™åœ°å°†å¤§é‡æ•°æ®è¿ç§»çš„å¼€é”€åˆ†æ‘Šåˆ°äº†å¤šæ¬¡æ“ä½œä¸­ï¼Œé¿å…äº†ä¸€æ¬¡æ€§ rehash å¯èƒ½å¯¼è‡´çš„æœåŠ¡é˜»å¡ã€‚</p>
<p>åœ¨æ¸è¿›å¼ rehash æœŸé—´ï¼Œä¸¤ä¸ªå“ˆå¸Œè¡¨åŒæ—¶æœ‰æ•ˆï¼Œæ•°æ®æ“ä½œä¼šæŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¿›è¡Œï¼š</p>
<ul>
<li>æŸ¥æ‰¾æ“ä½œï¼šå…ˆåœ¨ã€Œå“ˆå¸Œè¡¨ 1ã€ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œå†åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ä¸­æŸ¥æ‰¾</li>
<li>æ–°å¢æ“ä½œï¼šåªåœ¨ã€Œå“ˆå¸Œè¡¨ 2ã€ä¸­è¿›è¡Œï¼Œç¡®ä¿ã€Œå“ˆå¸Œè¡¨ 1ã€çš„æ•°æ®åªå‡ä¸å¢</li>
<li>æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼šåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ä¸­éƒ½å¯èƒ½æ‰§è¡Œï¼Œå–å†³äºè¦æ“ä½œçš„é”®æ‰€åœ¨çš„å“ˆå¸Œè¡¨</li>
</ul>
<p>éšç€ rehash æ“ä½œçš„è¿›è¡Œï¼Œã€Œå“ˆå¸Œè¡¨ 1ã€ä¸­çš„æ•°æ®ä¼šé€æ¸å‡å°‘ï¼Œæœ€ç»ˆå˜ä¸ºç©ºè¡¨ï¼Œæ­¤æ—¶æ•´ä¸ª rehash è¿‡ç¨‹å®Œæˆã€‚</p>
<h3 id="rehash-è§¦å‘æ¡ä»¶">rehash è§¦å‘æ¡ä»¶</h3>
<p>rehash çš„è§¦å‘ä¸ã€Œè´Ÿè½½å› å­ã€(load factor) å¯†åˆ‡ç›¸å…³ã€‚è´Ÿè½½å› å­è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<p>$$<br>
è´Ÿè½½å› å­ = å“ˆå¸Œè¡¨å·²ä¿å­˜èŠ‚ç‚¹æ•°é‡ / å“ˆå¸Œè¡¨å¤§å°<br>
$$</p>
<p>Redis è§¦å‘ rehash æ“ä½œçš„æ¡ä»¶ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li>
<p><strong>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 1ï¼Œä¸” Redis æ²¡æœ‰åœ¨æ‰§è¡Œ RDB å¿«ç…§ï¼ˆbgsaveï¼‰æˆ– AOF é‡å†™ï¼ˆbgrewriteaofï¼‰æ—¶</strong>ï¼Œè§¦å‘ rehash æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªè¾ƒä¸ºå®½æ¾çš„æ¡ä»¶ï¼Œè¡¨ç¤ºå“ˆå¸Œè¡¨å·²ç»è£…æ»¡ï¼Œä½†ç³»ç»Ÿèµ„æºå°šæœ‰ç©ºé—²ï¼Œå¯ä»¥è¿›è¡Œ rehashã€‚</p>
</li>
<li>
<p><strong>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 5 æ—¶</strong>ï¼Œæ— è®ºå½“å‰æ˜¯å¦åœ¨æ‰§è¡Œ RDB å¿«ç…§æˆ– AOF é‡å†™ï¼Œéƒ½ä¼šå¼ºåˆ¶è¿›è¡Œ rehash æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªè¾ƒä¸ºä¸¥æ ¼çš„æ¡ä»¶ï¼Œè¡¨ç¤ºå“ˆå¸Œå†²çªå·²ç»éå¸¸ä¸¥é‡ï¼Œå¿…é¡»ç«‹å³æ‰©å®¹ï¼Œå¦åˆ™ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚</p>
</li>
</ol>
<p>é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒRedis åœ¨ä¿è¯æ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿèƒ½å¤Ÿæœ‰æ•ˆç®¡ç†å†…å­˜èµ„æºï¼Œè¾¾åˆ°æ€§èƒ½ä¸èµ„æºåˆ©ç”¨çš„å¹³è¡¡ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Redis å“ˆå¸Œè¡¨æ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡å®ç°äº† O(1) æ—¶é—´å¤æ‚åº¦çš„æ•°æ®è®¿é—®ã€‚å…¶æ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>é“¾å¼å“ˆå¸Œ</strong>ï¼šé€šè¿‡å°†å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„é”®å€¼å¯¹é“¾æ¥æˆé“¾è¡¨ï¼Œæœ‰æ•ˆè§£å†³äº†å“ˆå¸Œå†²çªé—®é¢˜</li>
<li><strong>rehash æœºåˆ¶</strong>ï¼šå½“å“ˆå¸Œè¡¨è´Ÿè½½è¿‡é«˜æ—¶ï¼Œé€šè¿‡æ‰©å®¹å¹¶é‡æ–°åˆ†å¸ƒé”®å€¼å¯¹ï¼Œé™ä½å“ˆå¸Œå†²çªæ¦‚ç‡</li>
<li><strong>æ¸è¿›å¼ rehash</strong>ï¼šå°†æ•°æ®è¿ç§»å·¥ä½œåˆ†æ•£åˆ°å¤šæ¬¡æ“ä½œä¸­ï¼Œé¿å…æœåŠ¡é˜»å¡ï¼Œä¿è¯äº† Redis çš„é«˜æ€§èƒ½ç‰¹æ€§</li>
</ol>
<p>è¿™äº›ç²¾å¿ƒè®¾è®¡çš„æœºåˆ¶ä½¿å¾— Redis å“ˆå¸Œè¡¨èƒ½å¤Ÿåœ¨ä¿æŒé«˜æ€§èƒ½çš„åŒæ—¶ï¼Œæœ‰æ•ˆåº”å¯¹å¤§è§„æ¨¡æ•°æ®å­˜å‚¨å’Œé«˜å¹¶å‘è®¿é—®çš„æŒ‘æˆ˜ï¼Œæ˜¯ Redis é«˜æ€§èƒ½çš„é‡è¦åŸºç¡€ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Redis</tag>
        <tag>å­—å…¸</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç»“æ„ï¼šå‹ç¼©åˆ—è¡¨è¯¦è§£</title>
    <url>/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="å‹ç¼©åˆ—è¡¨">å‹ç¼©åˆ—è¡¨</h2>
<p>å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æ˜¯ Redis ä¸ºäº†æè‡´ä¼˜åŒ–å†…å­˜ä½¿ç”¨è€Œè®¾è®¡çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚å®ƒå°†æ‰€æœ‰å…ƒç´ å­˜å‚¨åœ¨<strong>ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´</strong>ä¸­ï¼Œé€šè¿‡é’ˆå¯¹ä¸åŒé•¿åº¦çš„æ•°æ®è¿›è¡Œç‰¹æ®Šç¼–ç ï¼Œä»è€Œ<strong>æ˜¾è‘—èŠ‚çœå†…å­˜</strong>ã€‚è¿™ç§è®¾è®¡ä½¿å…¶èƒ½å¤Ÿå¾ˆå¥½åœ°åˆ©ç”¨ CPU ç¼“å­˜ã€‚</p>
<p>ç„¶è€Œï¼Œå‹ç¼©åˆ—è¡¨ä¹Ÿå­˜åœ¨å›ºæœ‰çš„ç¼ºé™·ï¼š</p>
<ul>
<li><strong>æŸ¥è¯¢æ•ˆç‡</strong>: å½“ä¿å­˜çš„å…ƒç´ è¿‡å¤šæ—¶ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šæ˜æ˜¾ä¸‹é™ï¼Œå› ä¸ºæŸ¥æ‰¾éå¤´å°¾èŠ‚ç‚¹éœ€è¦éå†ã€‚</li>
<li><strong>æ›´æ–°æ•ˆç‡</strong>: æ–°å¢æˆ–ä¿®æ”¹å…ƒç´ æ—¶ï¼Œå¯èƒ½éœ€è¦é‡æ–°åˆ†é…æ•´ä¸ªå‹ç¼©åˆ—è¡¨çš„å†…å­˜ç©ºé—´ï¼Œæç«¯æƒ…å†µä¸‹ç”šè‡³å¯èƒ½å¼•å‘**è¿é”æ›´æ–°ï¼ˆcascade updateï¼‰**é—®é¢˜ã€‚</li>
</ul>
<p>å› æ­¤ï¼ŒRedis ä»…åœ¨åˆ—è¡¨å¯¹è±¡ï¼ˆListï¼‰ã€å“ˆå¸Œå¯¹è±¡ï¼ˆHashï¼‰ã€æœ‰åºé›†åˆå¯¹è±¡ï¼ˆZsetï¼‰åŒ…å«çš„å…ƒç´ æ•°é‡è¾ƒå°‘æˆ–å…ƒç´ å€¼è¾ƒå°æ—¶ï¼Œæ‰ä¼šé€‰æ‹©å‹ç¼©åˆ—è¡¨ä½œä¸ºå…¶åº•å±‚å®ç°ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å‹ç¼©åˆ—è¡¨çš„å†…éƒ¨ç»“æ„ä¸è¿ä½œæœºåˆ¶ã€‚</p>
<h3 id="å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡">å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡</h3>
<p>å‹ç¼©åˆ—è¡¨æ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯<strong>ç©ºé—´æ¢æ—¶é—´</strong>ã€‚</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/1747884602034.png" alt="1747884602034"><br>
<em>å›¾1: å‹ç¼©åˆ—è¡¨æ•´ä½“å†…å­˜å¸ƒå±€</em></p>
<p>å‹ç¼©åˆ—è¡¨çš„å¤´éƒ¨åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®å­—æ®µï¼š</p>
<ul>
<li><em><strong>zlbytes</strong></em> (4å­—èŠ‚): è®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ã€‚</li>
<li><em><strong>zltail</strong></em> (4å­—èŠ‚): è®°å½•å‹ç¼©åˆ—è¡¨å°¾èŠ‚ç‚¹ç›¸å¯¹äºèµ·å§‹åœ°å€çš„åç§»é‡ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½å°¾èŠ‚ç‚¹ã€‚</li>
<li><em><strong>zllen</strong></em> (2å­—èŠ‚): è®°å½•å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ã€‚</li>
<li><em><strong>zlend</strong></em> (1å­—èŠ‚): ç‰¹æ®Šæ ‡è®°ï¼Œå›ºå®šå€¼ä¸º <code>0xFF</code> (åè¿›åˆ¶255)ï¼Œè¡¨ç¤ºå‹ç¼©åˆ—è¡¨çš„ç»“æŸã€‚</li>
</ul>
<p>é€šè¿‡è¿™äº›å¤´éƒ¨å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥ O(1) å¤æ‚åº¦å®šä½é¦–å°¾èŠ‚ç‚¹ã€‚ä½†<strong>æŸ¥æ‰¾å…¶ä»–èŠ‚ç‚¹æ—¶ï¼Œåˆ™éœ€è¦ä»å¤´æˆ–å°¾å¼€å§‹é€ä¸ªéå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)</strong>ã€‚å› æ­¤ï¼Œå‹ç¼©åˆ—è¡¨ä¸é€‚åˆå­˜å‚¨å¤§é‡å…ƒç´ ã€‚</p>
<p>å‹ç¼©åˆ—è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆentryï¼‰åˆ™ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†æ„æˆï¼š</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/1747884610200.png" alt="1747884610200"><br>
<em>å›¾2: å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹ç»“æ„</em></p>
<ul>
<li><em><strong>prevlen</strong></em>: è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ã€‚è¿™ä¸ªå­—æ®µä½¿å¾—å‹ç¼©åˆ—è¡¨å¯ä»¥ä»åå‘å‰éå†ã€‚å…¶è‡ªèº«å ç”¨çš„ç©ºé—´æ ¹æ®å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å®é™…é•¿åº¦åŠ¨æ€è°ƒæ•´ï¼ˆ1å­—èŠ‚æˆ–5å­—èŠ‚ï¼‰ã€‚</li>
<li><em><strong>encoding</strong></em>: è®°å½•å½“å‰èŠ‚ç‚¹å®é™…æ•°æ®çš„ç±»å‹ï¼ˆæ•´æ•°æˆ–å­—ç¬¦ä¸²ï¼‰å’Œé•¿åº¦ã€‚å…¶è‡ªèº«å ç”¨çš„ç©ºé—´æ ¹æ®æ•°æ®çš„ç±»å‹å’Œå¤§å°åŠ¨æ€è°ƒæ•´ã€‚</li>
<li><em><strong>data</strong></em>: å­˜å‚¨èŠ‚ç‚¹çš„å®é™…æ•°æ®ï¼Œå…¶ç±»å‹å’Œé•¿åº¦ç”± <code>encoding</code> å­—æ®µå†³å®šã€‚</li>
</ul>
<p>è¿™ç§æ ¹æ®æ•°æ®å®é™…å¤§å°å’Œç±»å‹åŠ¨æ€è°ƒæ•´ <code>prevlen</code> å’Œ <code>encoding</code> å­—æ®µé•¿åº¦çš„è®¾è®¡ï¼Œæ˜¯å‹ç¼©åˆ—è¡¨å®ç°<strong>æè‡´å†…å­˜ä¼˜åŒ–çš„å…³é”®</strong>ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<p><strong>prevlen å­—æ®µçš„é•¿åº¦</strong>:</p>
<ul>
<li>å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦<strong>å°äº 254 å­—èŠ‚</strong>ï¼Œ<code>prevlen</code> å­—æ®µå ç”¨ <strong>1 å­—èŠ‚</strong>ã€‚</li>
<li>å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦<strong>å¤§äºç­‰äº 254 å­—èŠ‚</strong>ï¼Œ<code>prevlen</code> å­—æ®µå ç”¨ <strong>5 å­—èŠ‚</strong> (ç¬¬ä¸€ä¸ªå­—èŠ‚å›ºå®šä¸º <code>0xFE</code>ï¼Œåå››ä¸ªå­—èŠ‚å­˜å‚¨å®é™…é•¿åº¦)ã€‚</li>
</ul>
<p><strong>encoding å­—æ®µçš„ç¼–ç è§„åˆ™</strong>:</p>
<p><code>encoding</code> å­—æ®µä¼šæ ¹æ®å­˜å‚¨çš„æ•°æ®æ˜¯æ•´æ•°è¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œä»¥åŠå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œé‡‡ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ï¼Œå…¶è‡ªèº«å ç”¨çš„ç©ºé—´å¯èƒ½æ˜¯1å­—èŠ‚ã€2å­—èŠ‚æˆ–5å­—èŠ‚ã€‚</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/1747884619843.png" alt="1747884619843"><br>
<em>å›¾3: encoding å­—æ®µçš„ç¼–ç è§„åˆ™ (content å³ data å­—æ®µ)</em></p>
<ul>
<li>è‹¥<strong>æ•°æ®æ˜¯æ•´æ•°</strong>ï¼š<code>encoding</code> å­—æ®µä¸º <strong>1 å­—èŠ‚</strong>ï¼Œå…¶å…·ä½“å€¼æŒ‡æ˜äº†æ•´æ•°çš„ç±»å‹ï¼ˆå¦‚int16, int32ç­‰ï¼‰ï¼Œ<code>data</code> å­—æ®µåˆ™ç›´æ¥å­˜å‚¨è¯¥æ•´æ•°å€¼ã€‚</li>
<li>è‹¥<strong>æ•°æ®æ˜¯å­—ç¬¦ä¸²</strong>ï¼š<code>encoding</code> å­—æ®µçš„<strong>å‰å‡ ä½</strong>ç”¨äºæ ‡è¯†ç±»å‹å’Œå­—ç¬¦ä¸²é•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œ<strong>åç»­ä½</strong>åˆ™å­˜å‚¨å­—ç¬¦ä¸²çš„å®é™…é•¿åº¦ã€‚<code>data</code> å­—æ®µå­˜å‚¨å­—ç¬¦ä¸²å†…å®¹ã€‚<code>encoding</code> å­—æ®µæœ¬èº«å¯èƒ½å ç”¨1ã€2æˆ–5å­—èŠ‚ã€‚</li>
</ul>
<h3 id="è¿é”æ›´æ–°">è¿é”æ›´æ–°</h3>
<p>é™¤äº†æŸ¥è¯¢æ•ˆç‡è¾ƒä½å¤–ï¼Œå‹ç¼©åˆ—è¡¨è¿˜é¢ä¸´ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼š<strong>è¿é”æ›´æ–°</strong>ã€‚</p>
<p>å½“å‘å‹ç¼©åˆ—è¡¨æ’å…¥æ–°å…ƒç´ æˆ–ä¿®æ”¹ç°æœ‰å…ƒç´ å¯¼è‡´ç©ºé—´ä¸è¶³æ—¶ï¼Œéœ€è¦é‡æ–°åˆ†é…å†…å­˜ã€‚å¦‚æœè¿™ä¸ªæ“ä½œå¯¼è‡´æŸä¸ªèŠ‚ç‚¹çš„é•¿åº¦å‘ç”Ÿå˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œä»å°äº254å­—èŠ‚å˜ä¸ºå¤§äºç­‰äº254å­—èŠ‚ï¼‰ï¼Œé‚£ä¹ˆå…¶åç»§èŠ‚ç‚¹çš„ <code>prevlen</code> å­—æ®µå¯èƒ½ä¹Ÿéœ€è¦è°ƒæ•´å¤§å°ï¼ˆä»1å­—èŠ‚æ‰©å±•åˆ°5å­—èŠ‚ï¼‰ã€‚è¿™ç§è°ƒæ•´å¯èƒ½ä¼šåƒå¤šç±³è¯ºéª¨ç‰Œä¸€æ ·ï¼Œ<strong>ä»è¢«ä¿®æ”¹çš„èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å‘åä¼ æ’­ï¼Œå¯¼è‡´åç»­å¤šä¸ªèŠ‚ç‚¹çš„ <code>prevlen</code> å­—æ®µéƒ½éœ€è¦æ‰©å±•ï¼Œè¿›è€Œå¼•å‘å¤šæ¬¡å†…å­˜é‡åˆ†é…</strong>ã€‚</p>
<p><strong>è¿é”æ›´æ–°çš„è§¦å‘æ¡ä»¶</strong>ï¼š<br>
å½“ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ä¸­å­˜åœ¨å¤šä¸ªè¿ç»­çš„ã€é•¿åº¦æ¥è¿‘254å­—èŠ‚ï¼ˆä¾‹å¦‚250-253å­—èŠ‚ï¼‰çš„èŠ‚ç‚¹æ—¶ï¼Œå®ƒä»¬å„è‡ªçš„åç»§èŠ‚ç‚¹çš„ <code>prevlen</code> å­—æ®µéƒ½ä¸º1å­—èŠ‚ã€‚</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/1747884628613.png" alt="1747884628613"><br>
<em>å›¾4: è¿é”æ›´æ–°å‰å„èŠ‚ç‚¹ prevlen ä¸º1å­—èŠ‚</em></p>
<p>æ­¤æ—¶ï¼Œè‹¥åœ¨è¿™äº›èŠ‚ç‚¹ä¹‹å‰æ’å…¥ä¸€ä¸ªé•¿åº¦å¤§äºç­‰äº254å­—èŠ‚çš„æ–°èŠ‚ç‚¹ï¼ˆæˆ–ä¿®æ”¹ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä½¿å…¶é•¿åº¦è¶…è¿‡253å­—èŠ‚ï¼‰ï¼Œä¼šå¯¼è‡´ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ <code>prevlen</code> å­—æ®µä»1å­—èŠ‚æ‰©å±•åˆ°5å­—èŠ‚ã€‚</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/1747884636779.png" alt="1747884636779"><br>
<em>å›¾5: æ–°èŠ‚ç‚¹å¯¼è‡´èŠ‚ç‚¹e1çš„ prevlen æ‰©å±•</em></p>
<p>è¿™ä¸ªæ‰©å±•æ“ä½œä½¿å¾—èŠ‚ç‚¹e1çš„æ€»é•¿åº¦å¢åŠ ï¼Œå¦‚æœå¢åŠ åçš„é•¿åº¦ä¹Ÿè¶…è¿‡äº†253å­—èŠ‚ï¼Œé‚£ä¹ˆe1çš„åç»§èŠ‚ç‚¹e2åŸå…ˆç”¨1å­—èŠ‚å­˜å‚¨çš„ <code>prevlen</code> ä¹Ÿä¸å†è¶³å¤Ÿï¼ŒåŒæ ·éœ€è¦æ‰©å±•åˆ°5å­—èŠ‚ã€‚</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/1747884655205.png" alt="1747884655205"><br>
<em>å›¾6: è¿é”æ›´æ–°çš„å¤šç±³è¯ºæ•ˆåº”</em></p>
<p>è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ª <code>prevlen</code> æ‰©å±•åæ€»é•¿åº¦ä»æœªè¶…è¿‡253å­—èŠ‚çš„èŠ‚ç‚¹ï¼Œæˆ–è€…åˆ°è¾¾åˆ—è¡¨æœ«å°¾ã€‚</p>
<p><strong>è¿é”æ›´æ–°çš„ä»£ä»·æ˜¯é«˜æ˜‚çš„ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°å¤šæ¬¡è¿ç»­çš„å†…å­˜ç©ºé—´æ‰©å±•å’Œæ•°æ®è¿ç§»ï¼Œä¼šä¸¥é‡å½±å“å‹ç¼©åˆ—è¡¨çš„æ€§èƒ½ã€‚</strong></p>
<h3 id="å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·ä¸æ¼”è¿›">å‹ç¼©åˆ—è¡¨çš„ç¼ºé™·ä¸æ¼”è¿›</h3>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œå‹ç¼©åˆ—è¡¨çš„ä¸»è¦ç¼ºé™·åœ¨äºï¼š</p>
<ul>
<li><strong>è¯»å–/æŸ¥æ‰¾æ•ˆç‡ä½</strong>ï¼šå¯¹äºéå¤´å°¾èŠ‚ç‚¹çš„è®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚</li>
<li><strong>å†™æ“ä½œä»£ä»·é«˜</strong>ï¼šæ’å…¥æˆ–åˆ é™¤å…ƒç´ å¯èƒ½å¯¼è‡´æ•´ä¸ªåˆ—è¡¨çš„å†…å­˜é‡åˆ†é…ã€‚</li>
<li><strong>è¿é”æ›´æ–°é£é™©</strong>ï¼šåœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œæ›´æ–°æ“ä½œå¯èƒ½è§¦å‘è¿é”æ›´æ–°ï¼Œå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½æŠ–åŠ¨ã€‚</li>
</ul>
<p><strong>å°½ç®¡å‹ç¼©åˆ—è¡¨é€šè¿‡å…¶ç´§å‡‘çš„å†…å­˜å¸ƒå±€å®ç°äº†æè‡´çš„å†…å­˜èŠ‚çœï¼Œä½†å…¶æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯è¿é”æ›´æ–°çš„é£é™©ï¼Œé™åˆ¶äº†å…¶é€‚ç”¨åœºæ™¯ã€‚</strong></p>
<p>å› æ­¤ï¼Œå‹ç¼©åˆ—è¡¨é€šå¸¸åªé€‚ç”¨äºå­˜å‚¨èŠ‚ç‚¹æ•°é‡ä¸å¤šä¸”å…ƒç´ è¾ƒå°çš„åœºæ™¯ã€‚åªè¦èŠ‚ç‚¹æ•°é‡æ§åˆ¶åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œå³ä½¿å‘ç”Ÿè¿é”æ›´æ–°ï¼Œå…¶å½±å“ä¹Ÿæ˜¯å¯æ§çš„ã€‚</p>
<p>ä¸ºäº†å…‹æœå‹ç¼©åˆ—è¡¨çš„è¿™äº›ä¸è¶³ï¼ŒåŒæ—¶å°½å¯èƒ½ä¿ç•™å…¶èŠ‚çœå†…å­˜çš„ä¼˜ç‚¹ï¼ŒRedis åœ¨åç»­ç‰ˆæœ¬ä¸­å¼•å…¥äº†æ–°çš„æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li><strong>Quicklist</strong> (Redis 3.2 å¼•å…¥)ï¼šä½œä¸ºåˆ—è¡¨å¯¹è±¡ï¼ˆListï¼‰æ–°çš„åº•å±‚å®ç°ï¼Œå®ƒæ˜¯ç”±å¤šä¸ªå‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰ç»„æˆçš„åŒå‘é“¾è¡¨ã€‚è¿™æ—¢å‡å°‘äº†å•ä¸ªå‹ç¼©åˆ—è¡¨çš„é•¿åº¦ï¼Œé™ä½äº†è¿é”æ›´æ–°çš„é£é™©å’Œå½±å“èŒƒå›´ï¼Œåˆä¿ç•™äº†å‹ç¼©åˆ—è¡¨çš„å†…å­˜æ•ˆç‡ã€‚</li>
<li><strong>Listpack</strong> (Redis 5.0 å¼•å…¥)ï¼šè®¾è®¡ä¸Šæ¯”å‹ç¼©åˆ—è¡¨æ›´ç®€å•ï¼Œå®ƒå»é™¤äº† <code>prevlen</code> å­—æ®µï¼Œè½¬è€Œåœ¨æ¯ä¸ªèŠ‚ç‚¹å¤´éƒ¨è®°å½•è‡ªå·±çš„æ€»é•¿åº¦å’Œç¼–ç ç±»å‹ï¼Œä»è€Œå½»åº•é¿å…äº†è¿é”æ›´æ–°é—®é¢˜ã€‚Listpack ä¸»è¦ç”¨äºæ›¿æ¢ Hash å’Œ Zset å¯¹è±¡åº•å±‚çš„å‹ç¼©åˆ—è¡¨å®ç°ï¼Œä»¥åŠåœ¨ Stream æ•°æ®ç±»å‹ä¸­ä½¿ç”¨ã€‚</li>
</ul>
<p>è¿™äº›æ¼”è¿›ä½“ç°äº† Redis åœ¨æ•°æ®ç»“æ„è®¾è®¡ä¸Šå¯¹å†…å­˜æ•ˆç‡å’Œæ€§èƒ½ä¹‹é—´çš„æŒç»­æƒè¡¡ä¸ä¼˜åŒ–ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Redis</tag>
        <tag>å‹ç¼©åˆ—è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç»“æ„ï¼šé“¾è¡¨è¯¦è§£</title>
    <url>/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="é“¾è¡¨">é“¾è¡¨</h2>
<p>é“¾è¡¨æ˜¯é™¤äº†æ•°ç»„ä¹‹å¤–ï¼Œå¦ä¸€ç§å¹¿ä¸ºäººçŸ¥çš„åŸºç¡€æ•°æ®ç»“æ„ã€‚</p>
<p>C è¯­è¨€æ ‡å‡†åº“å¹¶æœªå†…ç½®é“¾è¡¨ï¼Œå› æ­¤ Redis å®ç°äº†è‡ªå®šä¹‰çš„é“¾è¡¨ç»“æ„ã€‚</p>
<h3 id="é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡">é“¾è¡¨èŠ‚ç‚¹ç»“æ„è®¾è®¡</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ Redis ä¸­ã€Œé“¾è¡¨èŠ‚ç‚¹ã€ï¼ˆ<code>listNode</code>ï¼‰çš„å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> &#123;</span></span><br><span class="line">    <span class="comment">//å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">prev</span>;</span></span><br><span class="line">    <span class="comment">//åç½®èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">next</span>;</span></span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">    <span class="type">void</span> *value;</span><br><span class="line">&#125; listNode;</span><br></pre></td></tr></table></figure>
<p>ä» <code>prev</code> å’Œ <code>next</code> æŒ‡é’ˆå¯ä»¥çœ‹å‡ºï¼ŒRedis çš„é“¾è¡¨æ˜¯åŒå‘é“¾è¡¨ã€‚</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%93%BE%E8%A1%A8/1747824009059.png" alt="Redis åŒå‘é“¾è¡¨èŠ‚ç‚¹ç¤ºæ„å›¾"></p>
<h3 id="é“¾è¡¨ç»“æ„è®¾è®¡">é“¾è¡¨ç»“æ„è®¾è®¡</h3>
<p>åœ¨ <code>listNode</code> çš„åŸºç¡€ä¸Šï¼ŒRedis è¿›ä¸€æ­¥å°è£…äº† <code>list</code> ç»“æ„ä½“æ¥ç®¡ç†æ•´ä¸ªé“¾è¡¨ï¼Œä»¥æ–¹ä¾¿æ“ä½œã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">list</span> &#123;</span></span><br><span class="line">    <span class="comment">//é“¾è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">    listNode *head;</span><br><span class="line">    <span class="comment">//é“¾è¡¨å°¾èŠ‚ç‚¹</span></span><br><span class="line">    listNode *tail;</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°</span></span><br><span class="line">    <span class="type">void</span> *(*dup)(<span class="type">void</span> *ptr);</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°</span></span><br><span class="line">    <span class="type">void</span> (*<span class="built_in">free</span>)(<span class="type">void</span> *ptr);</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line">    <span class="type">int</span> (*match)(<span class="type">void</span> *ptr, <span class="type">void</span> *key);</span><br><span class="line">    <span class="comment">//é“¾è¡¨èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> len;</span><br><span class="line">&#125; <span class="built_in">list</span>;</span><br></pre></td></tr></table></figure>
<p><code>list</code> ç»“æ„åŒ…å«äº†å¤´æŒ‡é’ˆ <code>head</code>ã€å°¾æŒ‡é’ˆ <code>tail</code>ã€èŠ‚ç‚¹æ•°é‡ <code>len</code>ï¼Œä»¥åŠä¸‰ä¸ªå‡½æ•°æŒ‡é’ˆï¼š<code>dup</code> (ç”¨äºå¤åˆ¶èŠ‚ç‚¹å€¼)ã€<code>free</code> (ç”¨äºé‡Šæ”¾èŠ‚ç‚¹å€¼)ã€<code>match</code> (ç”¨äºæ¯”è¾ƒèŠ‚ç‚¹å€¼)ã€‚è¿™äº›å‡½æ•°æŒ‡é’ˆä½¿å¾—é“¾è¡¨å¯ä»¥å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®å¹¶æ”¯æŒè‡ªå®šä¹‰æ“ä½œï¼Œèµ‹äºˆäº† Redis é“¾è¡¨æ›´å¼ºçš„çµæ´»æ€§ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯ç”± <code>list</code> ç»“æ„å’Œ 3 ä¸ª <code>listNode</code> ç»“æ„ç»„æˆçš„é“¾è¡¨ã€‚</p>
<p><img src="/2025/05/21/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%93%BE%E8%A1%A8/1747824019349.png" alt="Redis list ç»“æ„ä¸é“¾è¡¨èŠ‚ç‚¹å…³ç³»ç¤ºæ„å›¾"></p>
<h3 id="é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·">é“¾è¡¨çš„ä¼˜åŠ¿ä¸ç¼ºé™·</h3>
<p>Redis çš„é“¾è¡¨å®ç°å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>èŠ‚ç‚¹åŒ…å« <code>prev</code> å’Œ <code>next</code> æŒ‡é’ˆï¼Œæ„æˆ<strong>åŒå‘æ— ç¯é“¾è¡¨</strong>ã€‚è¿™ä½¿å¾—è·å–ä»»æ„èŠ‚ç‚¹çš„å‰é©±å’Œåç»§èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚</li>
<li>é€šè¿‡ <code>list</code> ç»“æ„ä¸­çš„ <code>head</code> å’Œ <code>tail</code> æŒ‡é’ˆï¼Œå¯ä»¥åœ¨ O(1) æ—¶é—´å†…è®¿é—®é“¾è¡¨çš„å¤´å°¾èŠ‚ç‚¹ã€‚</li>
<li><code>len</code> å±æ€§ä½¿å¾—è·å–é“¾è¡¨é•¿åº¦çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</li>
<li>èŠ‚ç‚¹å€¼é€šè¿‡ <code>void*</code> æŒ‡é’ˆä¿å­˜ï¼Œç»“åˆ <code>list</code>ç»“æ„ä¸­çš„ <code>dup</code>ã€<code>free</code> å’Œ <code>match</code> å‡½æ•°æŒ‡é’ˆï¼Œå®ç°äº†<strong>å¤šæ€é“¾è¡¨</strong>ï¼Œå¯ä»¥å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®å¹¶è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚</li>
</ul>
<p>é“¾è¡¨ä¹Ÿå­˜åœ¨ä¸€äº›å›ºæœ‰çš„ç¼ºé™·ï¼š</p>
<ul>
<li>èŠ‚ç‚¹çš„å†…å­˜éè¿ç»­åˆ†é…ï¼Œè¿™é™ä½äº† <strong>CPU ç¼“å­˜çš„å‘½ä¸­ç‡</strong>ï¼Œå½±å“è®¿é—®æ•ˆç‡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ•°ç»„ç”±äºå…¶å†…å­˜è¿ç»­æ€§ï¼Œèƒ½æ›´å¥½åœ°åˆ©ç”¨ CPU ç¼“å­˜ï¼ˆåŸºäºç©ºé—´å±€éƒ¨æ€§åŸç†ï¼‰ã€‚</li>
<li>æ¯ä¸ªèŠ‚ç‚¹é™¤äº†å­˜å‚¨æ•°æ®å¤–ï¼Œè¿˜éœ€è¦é¢å¤–çš„ç©ºé—´å­˜å‚¨å‰åæŒ‡é’ˆï¼ˆ<code>prev</code> å’Œ <code>next</code>ï¼‰ï¼Œå¯¼è‡´<strong>å†…å­˜å¼€é”€ç›¸å¯¹è¾ƒå¤§</strong>ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨ Redis 3.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œå½“ List å¯¹è±¡åŒ…å«çš„å…ƒç´ è¾ƒå°‘æ—¶ï¼Œä¼šé‡‡ç”¨ã€Œå‹ç¼©åˆ—è¡¨ã€ï¼ˆziplistï¼‰ä½œä¸ºå…¶åº•å±‚å®ç°ï¼Œä»¥èŠ‚çœå†…å­˜å¹¶åˆ©ç”¨å…¶å†…å­˜ç´§å‡‘çš„ç‰¹æ€§ã€‚</p>
<p>ç„¶è€Œï¼Œå‹ç¼©åˆ—è¡¨åœ¨æŸäº›åœºæ™¯ä¸‹å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼ˆä¾‹å¦‚è¿é”æ›´æ–°ï¼‰ã€‚ä¸ºæ­¤ï¼ŒRedis 3.2 ç‰ˆæœ¬å¼•å…¥äº† <code>quicklist</code>ï¼Œå®ƒç»“åˆäº†é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨çš„ä¼˜ç‚¹ï¼Œå¹¶æˆä¸º List å¯¹è±¡æ–°çš„åº•å±‚å®ç°ã€‚</p>
<p>åç»­ï¼ŒRedis 5.0 æ¨å‡ºäº† <code>listpack</code>ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ç§ç´§å‡‘çš„åºåˆ—åŒ–æ•°æ®ç»“æ„ï¼Œæ—¨åœ¨æ›¿ä»£å‹ç¼©åˆ—è¡¨ã€‚åœ¨è¾ƒæ–°çš„ Redis ç‰ˆæœ¬ä¸­ï¼Œ<code>listpack</code> å·²è¢«ç”¨äºå®ç° Hash å’Œ Zset å¯¹è±¡çš„éƒ¨åˆ†åº•å±‚ç»“æ„ï¼Œé€æ­¥å–ä»£äº†åŸå…ˆçš„å‹ç¼©åˆ—è¡¨ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>é“¾è¡¨</tag>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 75 - é¢œè‰²åˆ†ç±» (Sort Colors)</title>
    <url>/2025/05/21/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-75-%E9%A2%9C%E8%89%B2%E5%88%86%E7%B1%BB/</url>
    <content><![CDATA[<h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3>
<p>ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€å…± <code>n</code> ä¸ªå…ƒç´ çš„æ•°ç»„ <code>nums</code> ï¼Œ<strong>åŸåœ°</strong>å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²çš„é¡ºåºæ’åˆ—ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨æ•´æ•° <code>0</code>ã€ <code>1</code> å’Œ <code>2</code> åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚</p>
<p>ä½ å¿…é¡»åœ¨ä¸ä½¿ç”¨åº“çš„ sort å‡½æ•°çš„æƒ…å†µä¸‹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [2,0,2,1,1,0]</span><br><span class="line">è¾“å‡ºï¼š[0,0,1,1,2,2]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [2,0,1]</span><br><span class="line">è¾“å‡ºï¼š[0,1,2]</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>n == nums.length</code></li>
<li><code>1 &lt;= n &lt;= 300</code></li>
<li><code>nums[i]</code> ä¸º <code>0</code>ã€<code>1</code> æˆ– <code>2</code></li>
</ul>
<h3 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ‰‹é‡Œæœ‰ä¸€å †æ··æ‚ç€çº¢è‰²ï¼ˆ0ï¼‰ã€ç™½è‰²ï¼ˆ1ï¼‰å’Œè“è‰²ï¼ˆ2ï¼‰çš„ç å­ï¼Œç›®æ ‡æ˜¯æŠŠå®ƒä»¬æ’æˆçº¢ã€ç™½ã€è“çš„é¡ºåºï¼Œè€Œä¸”åªèƒ½åœ¨åŸæ¥çš„ä½ç½®ä¸Šè°ƒæ•´ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸‰ä¸ª&quot;æ ‡è®°&quot;æ¥å¸®åŠ©æˆ‘ä»¬ï¼š</p>
<ol>
<li><code>left</code> æ ‡è®°ï¼šå®ƒæŒ‡å‘æ•°ç»„æœ€å·¦è¾¹ï¼Œè¡¨ç¤º&quot;è¿™é‡Œåº”è¯¥æ˜¯çº¢è‰²ç å­ï¼ˆ0ï¼‰çš„åœ°ç›˜&quot;ã€‚æ‰€æœ‰åœ¨ <code>left</code> å·¦è¾¹çš„ç å­ä¿è¯éƒ½æ˜¯çº¢è‰²çš„ã€‚åˆå§‹æ—¶ï¼Œ<code>left</code> åœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆç´¢å¼• 0ï¼‰ã€‚</li>
<li><code>right</code> æ ‡è®°ï¼šå®ƒæŒ‡å‘æ•°ç»„æœ€å³è¾¹ï¼Œè¡¨ç¤º&quot;è¿™é‡Œåº”è¯¥æ˜¯è“è‰²ç å­ï¼ˆ2ï¼‰çš„åœ°ç›˜&quot;ã€‚æ‰€æœ‰åœ¨ <code>right</code> å³è¾¹çš„ç å­ä¿è¯éƒ½æ˜¯è“è‰²çš„ã€‚åˆå§‹æ—¶ï¼Œ<code>right</code> åœ¨æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚</li>
<li><code>current</code> æ ‡è®°ï¼ˆåœ¨ä»£ç ä¸­æˆ‘ä»¬ç”¨å˜é‡ <code>i</code>ï¼‰ï¼šè¿™æ˜¯æˆ‘ä»¬å½“å‰æ­£åœ¨æ£€æŸ¥çš„ç å­ã€‚æˆ‘ä»¬ä»å·¦åˆ°å³ä¸€ä¸ªä¸€ä¸ªåœ°çœ‹è¿™äº›ç å­ã€‚åˆå§‹æ—¶ï¼Œ<code>current</code> å’Œ <code>left</code> ä¸€æ ·ï¼Œéƒ½åœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹ç§»åŠ¨ <code>current</code> æ ‡è®°ï¼Œæ£€æŸ¥å®ƒæŒ‡å‘çš„ç å­æ˜¯ä»€ä¹ˆé¢œè‰²ï¼š</p>
<ul>
<li>
<p><strong>å¦‚æœ <code>nums[current]</code> æ˜¯çº¢è‰² (0)ï¼š</strong></p>
<ul>
<li>å¤ªå¥½äº†ï¼çº¢è‰²ç å­å°±åº”è¯¥åœ¨å·¦è¾¹ã€‚æˆ‘ä»¬æŠŠå®ƒå’Œ <code>left</code> æ ‡è®°æŒ‡å‘çš„ç å­äº¤æ¢ä½ç½®ã€‚</li>
<li>è¿™æ ·ä¸€æ¥ï¼Œ<code>left</code> æ ‡è®°å·¦è¾¹çš„åŒºåŸŸåˆå¤šäº†ä¸€ä¸ªç¡®å®šçš„çº¢è‰²ç å­ï¼Œæ‰€ä»¥ <code>left</code> å‘å³ç§»åŠ¨ä¸€ä½ã€‚</li>
<li><code>current</code> æ ‡è®°ä¹Ÿå‘å³ç§»åŠ¨ä¸€ä½ï¼Œå»çœ‹ä¸‹ä¸€ä¸ªç å­ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯ä»å·¦è¾¹æ¢è¿‡æ¥çš„ï¼Œæ‰€ä»¥æ¢åˆ° <code>current</code> ä½ç½®çš„ç å­ä¸å¯èƒ½æ˜¯è“è‰²ï¼ˆ2ï¼‰ï¼Œåªå¯èƒ½æ˜¯çº¢è‰²ï¼ˆ0ï¼‰æˆ–ç™½è‰²ï¼ˆ1ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯ <code>current</code> å·¦è¾¹å·²ç»å¤„ç†è¿‡çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç»§ç»­ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¦‚æœ <code>nums[current]</code> æ˜¯è“è‰² (2)ï¼š</strong></p>
<ul>
<li>è“è‰²ç å­åº”è¯¥åœ¨æœ€å³è¾¹ã€‚æˆ‘ä»¬æŠŠå®ƒå’Œ <code>right</code> æ ‡è®°æŒ‡å‘çš„ç å­äº¤æ¢ä½ç½®ã€‚</li>
<li>è¿™æ ·ä¸€æ¥ï¼Œ<code>right</code> æ ‡è®°å³è¾¹çš„åŒºåŸŸåˆå¤šäº†ä¸€ä¸ªç¡®å®šçš„è“è‰²ç å­ï¼Œæ‰€ä»¥ <code>right</code> å‘å·¦ç§»åŠ¨ä¸€ä½ã€‚</li>
<li><strong>é‡ç‚¹æ¥äº†ï¼š</strong> <code>current</code> æ ‡è®°è¿™æ¬¡å…ˆ<strong>ä¸ç§»åŠ¨</strong>ï¼ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä» <code>right</code>é‚£è¾¹æ¢è¿‡æ¥çš„ç å­é¢œè‰²æ˜¯ä¸ç¡®å®šçš„ï¼ˆå¯èƒ½æ˜¯çº¢ã€ç™½ã€è“ä»»ä½•ä¸€ç§ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸‹ä¸€è½®å¾ªç¯ä¸­é‡æ–°æ£€æŸ¥ä¸€ä¸‹ <code>current</code> å½“å‰ä½ç½®è¿™ä¸ªæ–°æ¢æ¥çš„ç å­æ˜¯ä»€ä¹ˆé¢œè‰²ã€‚ä¸ºäº†æŠµæ¶ˆ <code>for</code> å¾ªç¯æœ«å°¾ <code>current</code> (å³ <code>i</code>)ä¼šè‡ªåŠ¨å¢åŠ çš„æ•ˆæœï¼Œæˆ‘ä»¬ä¼šè®© <code>i</code> å‡ 1ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¦‚æœ <code>nums[current]</code> æ˜¯ç™½è‰² (1)ï¼š</strong></p>
<ul>
<li>ç™½è‰²ç å­å°±åº”è¯¥åœ¨çº¢è‰²å’Œè“è‰²ä¹‹é—´ã€‚å®ƒç°åœ¨çš„ä½ç½®æŒºå¥½ï¼Œä¸éœ€è¦åŠ¨ã€‚</li>
<li><code>current</code> æ ‡è®°å‘å³ç§»åŠ¨ä¸€ä½ï¼Œå»çœ‹ä¸‹ä¸€ä¸ªç å­ã€‚</li>
</ul>
</li>
</ul>
<p>æˆ‘ä»¬ä¸€ç›´é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ° <code>current</code> æ ‡è®°è¶…è¿‡äº† <code>right</code> æ ‡è®°ã€‚å½“ <code>current &gt; right</code> æ—¶ï¼Œå°±è¯´æ˜æ‰€æœ‰çš„ç å­éƒ½å·²ç»å„å°±å„ä½äº†ï¼</p>
<p>è¿™ç§æ–¹æ³•å¾ˆå·§å¦™ï¼Œåªéœ€è¦çœ‹ä¸€éæ‰€æœ‰çš„ç å­ï¼ˆæ—¶é—´å¤æ‚åº¦ $O(n)$ï¼‰ï¼Œè€Œä¸”ä¸éœ€è¦é¢å¤–çš„ç©ºé—´æ¥å­˜æ”¾ç å­ï¼ˆç©ºé—´å¤æ‚åº¦ $O(1)$ï¼‰ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š<code>nums = [2,0,2,1,1,0]</code></p>
<p>åˆå§‹çŠ¶æ€: <code>left = 0</code>, <code>right = 5</code> (æ•°ç»„æœ€åä¸€ä¸ªç´¢å¼•), <code>current = 0</code><br>
<code>nums = [2, 0, 2, 1, 1, 0]</code><br>
^ ^<br>
curr (i) right<br>
left</p>
<ol>
<li>
<p><code>current = 0</code>, <code>nums[0] = 2</code> (è“è‰²)ã€‚</p>
<ul>
<li>æ˜¯è“è‰²ï¼å’Œ <code>nums[right]</code> (å³ <code>nums[5]</code>, å€¼ä¸º 0) äº¤æ¢ã€‚</li>
<li>æ•°ç»„å˜ä¸º <code>[0, 0, 2, 1, 1, 2]</code></li>
<li><code>right</code> å·¦ç§»åˆ°ç´¢å¼• 4ã€‚</li>
<li><code>current</code> (å³ <code>i</code>) ä¿æŒåœ¨ 0 (é€šè¿‡ <code>i--</code> å®ç°)ï¼Œå› ä¸ºæ¢è¿‡æ¥çš„ <code>nums[0]</code> (ç°åœ¨æ˜¯ 0) éœ€è¦é‡æ–°æ£€æŸ¥ã€‚<br>
<code>nums = [0, 0, 2, 1, 1, 2]</code><br>
^ ^<br>
curr right<br>
left</li>
</ul>
</li>
<li>
<p><code>current = 0</code>, <code>nums[0] = 0</code> (çº¢è‰²)ã€‚</p>
<ul>
<li>æ˜¯çº¢è‰²ï¼å’Œ <code>nums[left]</code> (å³ <code>nums[0]</code>, å€¼ä¸º 0) äº¤æ¢ (åŸåœ°ä¸åŠ¨)ã€‚</li>
<li>æ•°ç»„ä»ä¸º <code>[0, 0, 2, 1, 1, 2]</code></li>
<li><code>left</code> å³ç§»åˆ°ç´¢å¼• 1ã€‚</li>
<li><code>current</code> (å³ <code>i</code>) å³ç§»åˆ°ç´¢å¼• 1ã€‚<br>
<code>nums = [0, 0, 2, 1, 1, 2]</code><br>
^ ^<br>
curr right<br>
left</li>
</ul>
</li>
<li>
<p><code>current = 1</code>, <code>nums[1] = 0</code> (çº¢è‰²)ã€‚</p>
<ul>
<li>æ˜¯çº¢è‰²ï¼å’Œ <code>nums[left]</code> (å³ <code>nums[1]</code>, å€¼ä¸º 0) äº¤æ¢ (åŸåœ°ä¸åŠ¨)ã€‚</li>
<li>æ•°ç»„ä»ä¸º <code>[0, 0, 2, 1, 1, 2]</code></li>
<li><code>left</code> å³ç§»åˆ°ç´¢å¼• 2ã€‚</li>
<li><code>current</code> (å³ <code>i</code>) å³ç§»åˆ°ç´¢å¼• 2ã€‚<br>
<code>nums = [0, 0, 2, 1, 1, 2]</code><br>
^ ^<br>
curr right<br>
left</li>
</ul>
</li>
<li>
<p><code>current = 2</code>, <code>nums[2] = 2</code> (è“è‰²)ã€‚</p>
<ul>
<li>æ˜¯è“è‰²ï¼å’Œ <code>nums[right]</code> (å³ <code>nums[4]</code>, å€¼ä¸º 1) äº¤æ¢ã€‚</li>
<li>æ•°ç»„å˜ä¸º <code>[0, 0, 1, 1, 2, 2]</code></li>
<li><code>right</code> å·¦ç§»åˆ°ç´¢å¼• 3ã€‚</li>
<li><code>current</code> (å³ <code>i</code>) ä¿æŒåœ¨ 2 (é€šè¿‡ <code>i--</code> å®ç°)ï¼Œå› ä¸ºæ¢è¿‡æ¥çš„ <code>nums[2]</code> (ç°åœ¨æ˜¯ 1) éœ€è¦é‡æ–°æ£€æŸ¥ã€‚<br>
<code>nums = [0, 0, 1, 1, 2, 2]</code><br>
^ ^<br>
curr right<br>
left</li>
</ul>
</li>
<li>
<p><code>current = 2</code>, <code>nums[2] = 1</code> (ç™½è‰²)ã€‚</p>
<ul>
<li>æ˜¯ç™½è‰²ï¼ä½ç½®æ­£ç¡®ï¼Œä¸åŠ¨ã€‚</li>
<li><code>current</code> (å³ <code>i</code>) å³ç§»åˆ°ç´¢å¼• 3ã€‚<br>
<code>nums = [0, 0, 1, 1, 2, 2]</code><br>
^ ^<br>
curr right<br>
left</li>
</ul>
</li>
<li>
<p><code>current = 3</code>, <code>nums[3] = 1</code> (ç™½è‰²)ã€‚</p>
<ul>
<li>æ˜¯ç™½è‰²ï¼ä½ç½®æ­£ç¡®ï¼Œä¸åŠ¨ã€‚</li>
<li><code>current</code> (å³ <code>i</code>) å³ç§»åˆ°ç´¢å¼• 4ã€‚<br>
<code>nums = [0, 0, 1, 1, 2, 2]</code><br>
^<br>
curr,right<br>
left</li>
</ul>
</li>
<li>
<p><code>current = 4</code>ã€‚æ­¤æ—¶ <code>current</code> (4) &gt; <code>right</code> (3)ã€‚å¾ªç¯ç»“æŸã€‚</p>
</li>
</ol>
<p>æœ€ç»ˆæ’åºç»“æœ: <code>[0,0,1,1,2,2]</code></p>
<h3 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h3>
<p>ä»£ç çš„é€»è¾‘å’Œæˆ‘ä»¬ä¸Šé¢æè¿°çš„&quot;ç å­æ’åº&quot;æ€è·¯æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p>
<ul>
<li><code>left</code> å˜é‡ç”¨æ¥æ ‡è®°çº¢è‰²ç å­ï¼ˆ0ï¼‰åŒºåŸŸçš„å³è¾¹ç•Œã€‚</li>
<li><code>right</code> å˜é‡ç”¨æ¥æ ‡è®°è“è‰²ç å­ï¼ˆ2ï¼‰åŒºåŸŸçš„å·¦è¾¹ç•Œã€‚</li>
<li>å¾ªç¯å˜é‡ <code>i</code> å°±æ˜¯æˆ‘ä»¬çš„ <code>current</code> æ ‡è®°ï¼Œå®ƒä»æ•°ç»„å¼€å¤´ï¼ˆç´¢å¼• 0ï¼‰ä¸€ç›´æ‰«æåˆ° <code>right</code> æ ‡è®°çš„ä½ç½®ã€‚</li>
</ul>
<p>åœ¨ <code>for</code> å¾ªç¯é‡Œé¢ï¼š</p>
<ul>
<li>å¦‚æœ <code>nums[i]</code> æ˜¯ <code>0</code>ï¼ˆçº¢è‰²ï¼‰ï¼šå°±æŠŠå®ƒè·Ÿ <code>nums[left]</code> äº¤æ¢ï¼Œç„¶å <code>left</code> å’Œ <code>i</code> éƒ½å‘å³æŒªä¸€ä¸ªä½ç½®ã€‚</li>
<li>å¦‚æœ <code>nums[i]</code> æ˜¯ <code>2</code>ï¼ˆè“è‰²ï¼‰ï¼šå°±æŠŠå®ƒè·Ÿ <code>nums[right]</code> äº¤æ¢ï¼Œç„¶å <code>right</code> å‘å·¦æŒªä¸€ä¸ªä½ç½®ã€‚<strong>ç‰¹åˆ«æ³¨æ„ï¼š</strong> è¿™æ—¶å€™ <code>i</code> è¦å‡ <code>1</code> (<code>i--</code>)ï¼Œè¿™æ˜¯å› ä¸ºä» <code>right</code>é‚£è¾¹æ¢è¿‡æ¥çš„ç å­æˆ‘ä»¬è¿˜æ²¡çœ‹è¿‡æ˜¯å•¥é¢œè‰²ï¼Œé€šè¿‡ <code>i--</code> å¯ä»¥æŠµæ¶ˆæ‰ <code>for</code> å¾ªç¯è‡ªå·±ä¼šåšçš„ <code>i++</code>ï¼Œè¿™æ ·ä¸‹ä¸€è½®å¾ªç¯å°±èƒ½é‡æ–°æ£€æŸ¥å½“å‰ <code>i</code> ä½ç½®çš„è¿™ä¸ªæ–°ç å­äº†ã€‚</li>
<li>å¦‚æœ <code>nums[i]</code> æ˜¯ <code>1</code>ï¼ˆç™½è‰²ï¼‰ï¼šé‚£å®ƒå°±åœ¨æ­£ç¡®çš„ä½ç½®ï¼ˆçº¢å’Œè“çš„ä¸­é—´ï¼‰ï¼Œæˆ‘ä»¬å•¥ä¹Ÿä¸ç”¨åšï¼Œ<code>i</code> ä¼šåœ¨ <code>for</code> å¾ªç¯ç»“æŸæ—¶è‡ªåŠ¨å‘å³æŒªã€‚</li>
</ul>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=75 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [75] é¢œè‰²åˆ†ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sortColors</span><span class="params">(nums []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	left, right := <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span> <span class="comment">// åˆå§‹åŒ– left å’Œ right æ ‡è®°</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// current æ ‡è®° i ä»æ•°ç»„å¤´æ‰«æåˆ° right æ ‡è®°çš„ä½ç½®</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= right; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> nums[i] == <span class="number">0</span> &#123; <span class="comment">// é‡åˆ°çº¢è‰²ç å­ (0)</span></span><br><span class="line">			<span class="comment">// å’Œ left ä½ç½®çš„ç å­äº¤æ¢</span></span><br><span class="line">			nums[i], nums[left] = nums[left], nums[i]</span><br><span class="line">			<span class="comment">// left æ ‡è®°å‘å³ç§»åŠ¨</span></span><br><span class="line">			left++</span><br><span class="line">			<span class="comment">// current æ ‡è®° (i) ä¹Ÿä¼šåœ¨ for å¾ªç¯æœ«å°¾è‡ªåŠ¨å³ç§»</span></span><br><span class="line">			<span class="comment">// å› ä¸ºä» left æ¢è¿‡æ¥çš„ç å­åªå¯èƒ½æ˜¯ 0 æˆ– 1, å·²ç»å¤„ç†è¿‡æˆ–å³å°†æ­£ç¡®å¤„ç†</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> nums[i] == <span class="number">2</span> &#123; <span class="comment">// é‡åˆ°è“è‰²ç å­ (2)</span></span><br><span class="line">			<span class="comment">// å’Œ right ä½ç½®çš„ç å­äº¤æ¢</span></span><br><span class="line">			nums[i], nums[right] = nums[right], nums[i]</span><br><span class="line">			<span class="comment">// right æ ‡è®°å‘å·¦ç§»åŠ¨</span></span><br><span class="line">			right--</span><br><span class="line">			<span class="comment">// å…³é”®ï¼šcurrent æ ‡è®° (i) é€€ä¸€æ­¥ï¼Œé‡æ–°æ£€æŸ¥å½“å‰ä½ç½®æ¢è¿‡æ¥çš„æ–°ç å­</span></span><br><span class="line">			i--</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å¦‚æœ nums[i] == 1 (ç™½è‰²ç å­)ï¼Œå•¥ä¹Ÿä¸åšï¼Œi ä¼šè‡ªåŠ¨å³ç§»</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h3>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>åŒæŒ‡é’ˆæ³• (è·å…°å›½æ——é—®é¢˜è§£æ³•)</th>
<th>è®¡æ•°æ’åºæ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>$O(n)$ (ä¸¤æ¬¡éå†)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(1)$ (åŸåœ°)</td>
<td>$O(k)$ (k=3, é¢œè‰²æ•°é‡)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>åŸåœ°æ’åºï¼Œç©ºé—´æ•ˆç‡é«˜</td>
<td>å®ç°ç®€å•ç›´è§‚</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>é€»è¾‘ç¨å¤æ‚</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
</tbody>
</table>
<p><strong>è®¡æ•°æ’åºæ³•æ€è·¯ï¼š</strong></p>
<ol>
<li>éå†æ•°ç»„ï¼Œç»Ÿè®¡ 0, 1, 2 å„è‡ªå‡ºç°çš„æ¬¡æ•°ã€‚</li>
<li>æ ¹æ®ç»Ÿè®¡çš„æ¬¡æ•°ï¼Œé‡å†™åŸæ•°ç»„ã€‚å…ˆå†™æ‰€æœ‰çš„ 0ï¼Œç„¶åå†™æ‰€æœ‰çš„ 1ï¼Œæœ€åå†™æ‰€æœ‰çš„ 2ã€‚</li>
</ol>
<p>è¿™ç§æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œä½†é¢˜ç›®è¦æ±‚åŸåœ°æ’åºï¼Œå¹¶ä¸”å¦‚æœé¢œè‰²ç§ç±»å¾ˆå¤šï¼Œè®¡æ•°æ’åºçš„ç©ºé—´å¤æ‚åº¦ä¼šä¸Šå‡ã€‚å¯¹äºæœ¬é¢˜ï¼Œé¢œè‰²åªæœ‰ä¸‰ç§ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ $O(1)$ã€‚</p>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<p><strong>åŒæŒ‡é’ˆæ³•ï¼š</strong></p>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(n)$ã€‚<br>
<code>left</code> å’Œ <code>current</code> æŒ‡é’ˆä»å·¦å‘å³ç§»åŠ¨ï¼Œ<code>right</code> æŒ‡é’ˆä»å³å‘å·¦ç§»åŠ¨ã€‚æ¯ä¸ªå…ƒç´ æœ€å¤šè¢«è®¿é—®å’Œäº¤æ¢å¸¸æ•°æ¬¡ã€‚<code>current</code> æŒ‡é’ˆæœ€å¤šéå†æ•°ç»„ä¸€æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> $O(1)$ã€‚<br>
æˆ‘ä»¬åªä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–çš„å˜é‡ï¼ˆ<code>left</code>, <code>right</code>, <code>current</code>ï¼‰ï¼Œæ˜¯åœ¨åŸåœ°ä¿®æ”¹æ•°ç»„ã€‚</li>
</ul>
<h3 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h3>
<ul>
<li><strong>åŒæŒ‡é’ˆï¼ˆæˆ–ä¸‰æ ‡è®°ï¼‰æ˜¯ä¸ªå¥½æŠ€å·§</strong>ï¼šå¯¹äºæ•°ç»„æ’åºæˆ–åˆ†åŒºé—®é¢˜ï¼Œè¿™ç§æ–¹æ³•éå¸¸é«˜æ•ˆã€‚è¿™ä¸ªç‰¹å®šçš„é—®é¢˜ä¹Ÿå«&quot;è·å…°å›½æ——é—®é¢˜&quot;ï¼Œå› ä¸ºè·å…°å›½æ——å°±æ˜¯çº¢ã€ç™½ã€è“ä¸‰è‰²æ¡çº¹ã€‚</li>
<li><strong>åŸåœ°æ’åºçœåœ°æ–¹</strong>ï¼šæˆ‘ä»¬æ²¡æœ‰ç”¨é¢å¤–çš„æ•°ç»„ï¼Œç›´æ¥åœ¨åŸæ¥çš„æ•°ç»„ä¸Šæ“ä½œï¼Œè¿™å¾ˆèŠ‚çœå†…å­˜ã€‚</li>
<li><strong>æŒ‡é’ˆç§»åŠ¨è¦å°å¿ƒ</strong>ï¼š
<ul>
<li>å½“é‡åˆ°è“è‰²ç å­ï¼ˆ2ï¼‰å¹¶ä¸å³è¾¹äº¤æ¢åï¼Œ<code>current</code> (å³ <code>i</code>) æŒ‡é’ˆéœ€è¦&quot;é€€ä¸€æ­¥&quot; (<code>i--</code>) æ˜¯è¿™ä¸ªç®—æ³•çš„å…³é”®ã€‚è¿™èƒ½ç¡®ä¿æˆ‘ä»¬ä¸ä¼šé”™è¿‡æ£€æŸ¥ä»å³è¾¹æ¢è¿‡æ¥çš„é‚£ä¸ªæœªçŸ¥é¢œè‰²çš„ç å­ã€‚</li>
<li>å½“é‡åˆ°çº¢è‰²ç å­ï¼ˆ0ï¼‰å¹¶ä¸å·¦è¾¹äº¤æ¢åï¼Œ<code>current</code> (å³ <code>i</code>) å’Œ <code>left</code> éƒ½å‰è¿›ã€‚è¿™æ˜¯å› ä¸º <code>left</code> å·¦è¾¹çš„åŒºåŸŸä¿è¯éƒ½æ˜¯çº¢è‰²ï¼Œè€Œ <code>current</code> æ˜¯ä»å·¦å¾€å³æ‰«æçš„ï¼Œæ‰€ä»¥ä» <code>left</code> æ¢åˆ° <code>current</code> ä½ç½®çš„ç å­ä¸å¯èƒ½æ˜¯è“è‰²ï¼ˆ2ï¼‰ã€‚å®ƒåªå¯èƒ½æ˜¯çº¢è‰²ï¼ˆ0ï¼‰æˆ–ç™½è‰²ï¼ˆ1ï¼‰ã€‚å¦‚æœæ¢è¿‡æ¥çš„æ˜¯çº¢è‰²ï¼Œ<code>current</code> ä¸‹æ¬¡æ£€æŸ¥æ—¶ä¼šå†æ¬¡æŠŠå®ƒæ”¾åˆ° <code>left</code>åŒºåŸŸï¼›å¦‚æœæ¢è¿‡æ¥çš„æ˜¯ç™½è‰²ï¼Œ<code>current</code> ä¸‹æ¬¡æ£€æŸ¥æ—¶ä¼šç›´æ¥è·³è¿‡ã€‚</li>
</ul>
</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œè¿™é“é¢˜é€šè¿‡å·§å¦™çš„æŒ‡é’ˆæ“ä½œï¼Œå®ç°äº†é«˜æ•ˆçš„é¢œè‰²æ’åºï¼Œæ˜¯ä¸€ä¸ªå€¼å¾—å­¦ä¹ çš„ç»å…¸ç®—æ³•ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 72 - ç¼–è¾‘è·ç¦» (Edit Distance)</title>
    <url>/2025/05/21/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-72-%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸¤ä¸ªå•è¯ <code>word1</code> å’Œ <code>word2</code>ï¼Œè®¡ç®—å°† <code>word1</code> è½¬æ¢æˆ <code>word2</code> æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•°ã€‚</p>
<p>ä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š</p>
<ol>
<li>æ’å…¥ä¸€ä¸ªå­—ç¬¦</li>
<li>åˆ é™¤ä¸€ä¸ªå­—ç¬¦</li>
<li>æ›¿æ¢ä¸€ä¸ªå­—ç¬¦</li>
</ol>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šword1 = &quot;horse&quot;, word2 = &quot;ros&quot;</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">horse -&gt; rorse (å°† &#x27;h&#x27; æ›¿æ¢ä¸º &#x27;r&#x27;)</span><br><span class="line">rorse -&gt; rose (åˆ é™¤ &#x27;r&#x27;)</span><br><span class="line">rose -&gt; ros (åˆ é™¤ &#x27;e&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šword1 = &quot;intention&quot;, word2 = &quot;execution&quot;</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">intention -&gt; inention (åˆ é™¤ &#x27;t&#x27;)</span><br><span class="line">inention -&gt; enention (å°† &#x27;i&#x27; æ›¿æ¢ä¸º &#x27;e&#x27;)</span><br><span class="line">enention -&gt; exention (å°† &#x27;n&#x27; æ›¿æ¢ä¸º &#x27;x&#x27;)</span><br><span class="line">exention -&gt; exection (å°† &#x27;n&#x27; æ›¿æ¢ä¸º &#x27;c&#x27;)</span><br><span class="line">exection -&gt; execution (æ’å…¥ &#x27;u&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>0 &lt;= word1.length, word2.length &lt;= 500</code></li>
<li><code>word1</code> å’Œ <code>word2</code> ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜æ˜¯ç»å…¸çš„åŠ¨æ€è§„åˆ’é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ <code>dp[i][j]</code> è¡¨ç¤ºå°† <code>word1</code> çš„å‰ <code>i</code> ä¸ªå­—ç¬¦è½¬æ¢æˆ <code>word2</code> çš„å‰ <code>j</code> ä¸ªå­—ç¬¦æ‰€éœ€è¦çš„æœ€å°‘æ“ä½œæ•°ã€‚</p>
<h3 id="çŠ¶æ€å®šä¹‰">çŠ¶æ€å®šä¹‰</h3>
<p><code>dp[i][j]</code>ï¼š<code>word1</code> çš„å­ä¸² <code>word1[0...i-1]</code> (é•¿åº¦ä¸º <code>i</code>) è½¬æ¢æˆ <code>word2</code> çš„å­ä¸² <code>word2[0...j-1]</code> (é•¿åº¦ä¸º <code>j</code>) æ‰€éœ€çš„æœ€å°æ“ä½œæ•°ã€‚</p>
<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<ol>
<li><code>dp[0][0] = 0</code>ï¼šç©ºå­—ç¬¦ä¸²è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæ“ä½œæ•°ä¸º 0ã€‚</li>
<li><code>dp[i][0] = i</code> (å½“ <code>j=0</code> æ—¶)ï¼š<code>word1</code> çš„å‰ <code>i</code> ä¸ªå­—ç¬¦è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œéœ€è¦ <code>i</code> æ¬¡åˆ é™¤æ“ä½œã€‚<br>
ä¾‹å¦‚ï¼Œå°† â€œabcâ€ è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œéœ€è¦åˆ é™¤ â€˜aâ€™, â€˜bâ€™, â€˜câ€™ï¼Œå…± 3 æ¬¡æ“ä½œã€‚</li>
<li><code>dp[0][j] = j</code> (å½“ <code>i=0</code> æ—¶)ï¼šç©ºå­—ç¬¦ä¸²è½¬æ¢æˆ <code>word2</code> çš„å‰ <code>j</code> ä¸ªå­—ç¬¦ï¼Œéœ€è¦ <code>j</code> æ¬¡æ’å…¥æ“ä½œã€‚<br>
ä¾‹å¦‚ï¼Œå°†ç©ºå­—ç¬¦ä¸²è½¬æ¢æˆ â€œxyzâ€ï¼Œéœ€è¦æ’å…¥ â€˜xâ€™, â€˜yâ€™, â€˜zâ€™ï¼Œå…± 3 æ¬¡æ“ä½œã€‚</li>
</ol>
<h3 id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h3>
<p>è€ƒè™‘ <code>dp[i][j]</code> çš„è®¡ç®—ï¼Œå³å¦‚ä½•å°† <code>word1[0...i-1]</code> è½¬æ¢æˆ <code>word2[0...j-1]</code>ã€‚æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹ä¸‰ç§æƒ…å†µè¿›è¡Œè½¬ç§»ï¼š</p>
<ol>
<li>
<p><strong>æ›¿æ¢æ“ä½œ (Modify)</strong>:<br>
å¦‚æœ <code>word1[i-1] == word2[j-1]</code>ï¼Œè¯´æ˜ <code>word1</code> çš„ç¬¬ <code>i</code> ä¸ªå­—ç¬¦ä¸ <code>word2</code> çš„ç¬¬ <code>j</code> ä¸ªå­—ç¬¦ç›¸åŒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹è¿™ä¸¤ä¸ªå­—ç¬¦è¿›è¡Œä»»ä½•æ“ä½œï¼Œé—®é¢˜å°±è½¬åŒ–ä¸ºå°† <code>word1[0...i-2]</code> è½¬æ¢æˆ <code>word2[0...j-2]</code> çš„æœ€å°æ“ä½œæ•°ã€‚<br>
æ‰€ä»¥ï¼Œ<code>dp[i][j] = dp[i-1][j-1]</code>ã€‚</p>
<p>å¦‚æœ <code>word1[i-1] != word2[j-1]</code>ï¼Œè¯´æ˜ <code>word1</code> çš„ç¬¬ <code>i</code> ä¸ªå­—ç¬¦ä¸ <code>word2</code> çš„ç¬¬ <code>j</code> ä¸ªå­—ç¬¦ä¸åŒã€‚æˆ‘ä»¬å¯ä»¥å°† <code>word1[i-1]</code> æ›¿æ¢ä¸º <code>word2[j-1]</code>ï¼Œè¿™æ ·è¿™ä¸¤ä¸ªå­—ç¬¦å°±åŒ¹é…äº†ã€‚æ­¤æ—¶ï¼Œæ“ä½œæ•°åŠ  1ï¼Œé—®é¢˜è½¬åŒ–ä¸ºå°† <code>word1[0...i-2]</code> è½¬æ¢æˆ <code>word2[0...j-2]</code> çš„æœ€å°æ“ä½œæ•°ã€‚<br>
æ‰€ä»¥ï¼Œ<code>dp[i][j] = dp[i-1][j-1] + 1</code>ã€‚</p>
</li>
<li>
<p><strong>åˆ é™¤æ“ä½œ (Delete)</strong>:<br>
æˆ‘ä»¬å¯ä»¥åˆ é™¤ <code>word1[i-1]</code> è¿™ä¸ªå­—ç¬¦ï¼Œç„¶åé—®é¢˜å°±è½¬åŒ–ä¸ºå°† <code>word1[0...i-2]</code> (é•¿åº¦ä¸º <code>i-1</code>) è½¬æ¢æˆ <code>word2[0...j-1]</code> (é•¿åº¦ä¸º <code>j</code>) çš„æœ€å°æ“ä½œæ•°ã€‚<br>
æ‰€ä»¥ï¼Œ<code>dp[i][j] = dp[i-1][j] + 1</code>ã€‚</p>
</li>
<li>
<p><strong>æ’å…¥æ“ä½œ (Insert)</strong>:<br>
æˆ‘ä»¬å¯ä»¥åœ¨ <code>word1[0...i-1]</code> çš„æœ«å°¾æ’å…¥ä¸€ä¸ªå­—ç¬¦ <code>word2[j-1]</code>ï¼Œä½¿å¾— <code>word1</code> çš„æ–°å­ä¸²ä¸ <code>word2[0...j-1]</code> çš„æœ«å°¾å­—ç¬¦åŒ¹é…ã€‚ç„¶åé—®é¢˜å°±è½¬åŒ–ä¸ºå°† <code>word1[0...i-1]</code> (é•¿åº¦ä¸º <code>i</code>) è½¬æ¢æˆ <code>word2[0...j-2]</code> (é•¿åº¦ä¸º <code>j-1</code>) çš„æœ€å°æ“ä½œæ•°ã€‚<br>
æ‰€ä»¥ï¼Œ<code>dp[i][j] = dp[i][j-1] + 1</code>ã€‚</p>
</li>
</ol>
<p>ç»¼åˆä»¥ä¸Šä¸‰ç§æƒ…å†µï¼Œå½“ <code>word1[i-1] != word2[j-1]</code> æ—¶ï¼Œ<code>dp[i][j]</code> åº”è¯¥å–è¿™ä¸‰ç§æ“ä½œä¸­æ“ä½œæ•°æœ€å°çš„ä¸€ä¸ªï¼š<br>
<code>dp[i][j] = min(dp[i-1][j-1] + 1, dp[i-1][j] + 1, dp[i][j-1] + 1)</code></p>
<p>æˆ‘ä»¬å¯ä»¥å°†æ›¿æ¢æ“ä½œçš„ä¸¤ç§æƒ…å†µåˆå¹¶ã€‚<br>
å¦‚æœ <code>word1[i-1] == word2[j-1]</code>ï¼Œåˆ™ <code>cost = 0</code>ï¼Œå¦åˆ™ <code>cost = 1</code>ã€‚<br>
é‚£ä¹ˆï¼Œ<code>dp[i][j]</code> çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯ä»¥ç»Ÿä¸€ä¸ºï¼š<br>
<code>dp[i][j] = min(dp[i-1][j-1] + cost, dp[i-1][j] + 1, dp[i][j-1] + 1)</code></p>
<p>æ›´ç®€æ´çš„å†™æ³•æ˜¯ï¼š</p>
<ul>
<li>å¦‚æœ <code>word1[i-1] == word2[j-1]</code>ï¼š<br>
<code>dp[i][j] = dp[i-1][j-1]</code> (æ­¤æ—¶ä¸éœ€è¦æ“ä½œï¼Œç­‰ä»·äºä» <code>dp[i-1][j-1]</code> è½¬ç§»è¿‡æ¥ï¼Œæ“ä½œæ•°ä¸º 0)</li>
<li>å¦‚æœ <code>word1[i-1] != word2[j-1]</code>ï¼š<br>
<code>dp[i][j] = min(dp[i-1][j-1], dp[i-1][j], dp[i][j-1]) + 1</code><br>
è¿™é‡Œ <code>dp[i-1][j-1]</code> å¯¹åº”æ›¿æ¢æ“ä½œï¼Œ<code>dp[i-1][j]</code> å¯¹åº”åˆ é™¤ <code>word1[i-1]</code>ï¼Œ<code>dp[i][j-1]</code> å¯¹åº”åœ¨ <code>word1</code> æœ«å°¾æ’å…¥ <code>word2[j-1]</code>ã€‚</li>
</ul>
<p>æœ€ç»ˆç»“æœæ˜¯ <code>dp[n][m]</code>ï¼Œå…¶ä¸­ <code>n</code> æ˜¯ <code>word1</code> çš„é•¿åº¦ï¼Œ<code>m</code> æ˜¯ <code>word2</code> çš„é•¿åº¦ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// filepath: /Users/adrianwang/.leetcode/72.ç¼–è¾‘è·ç¦».go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;math&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=72 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [72] ç¼–è¾‘è·ç¦»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minDistance</span><span class="params">(word1 <span class="type">string</span>, word2 <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n, m := <span class="built_in">len</span>(word1), <span class="built_in">len</span>(word2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// dp[i][j] è¡¨ç¤º word1 çš„å‰ i ä¸ªå­—ç¬¦è½¬æ¢æˆ word2 çš„å‰ j ä¸ªå­—ç¬¦æ‰€éœ€çš„æœ€å°‘æ“ä½œæ•°</span></span><br><span class="line">	dp := <span class="built_in">make</span>([][]<span class="type">int</span>, n+<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> dp &#123;</span><br><span class="line">		dp[i] = <span class="built_in">make</span>([]<span class="type">int</span>, m+<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–ï¼šç†è®ºä¸Šå¯ä»¥å°†æ‰€æœ‰ dp[i][j] åˆå§‹åŒ–ä¸º math.MaxInt32</span></span><br><span class="line">	<span class="comment">// ä½†ç”±äºé€’æ¨å…³ç³»ï¼Œè¿™é‡Œçš„åˆå§‹åŒ–å¯ä»¥æ›´ç²¾ç®€</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—</span></span><br><span class="line">	<span class="comment">// dp[i][0]ï¼šword1 çš„å‰ i ä¸ªå­—ç¬¦è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œéœ€è¦ i æ¬¡åˆ é™¤</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= n; i++ &#123;</span><br><span class="line">		dp[i][<span class="number">0</span>] = i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// dp[0][j]ï¼šç©ºå­—ç¬¦ä¸²è½¬æ¢æˆ word2 çš„å‰ j ä¸ªå­—ç¬¦ï¼Œéœ€è¦ j æ¬¡æ’å…¥</span></span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt;= m; j++ &#123;</span><br><span class="line">		dp[<span class="number">0</span>][j] = j</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// çŠ¶æ€è½¬ç§»</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= m; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> word1[i<span class="number">-1</span>] == word2[j<span class="number">-1</span>] &#123;</span><br><span class="line">				<span class="comment">// å¦‚æœ word1[i-1] == word2[j-1]ï¼Œåˆ™å½“å‰å­—ç¬¦åŒ¹é…ï¼Œä¸éœ€è¦æ“ä½œ</span></span><br><span class="line">				<span class="comment">// æ“ä½œæ•°ç­‰äº dp[i-1][j-1]</span></span><br><span class="line">				dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>]</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// å¦‚æœ word1[i-1] != word2[j-1]ï¼Œåˆ™éœ€è¦è¿›è¡Œæ“ä½œ</span></span><br><span class="line">				<span class="comment">// dp[i-1][j-1] + 1: æ›¿æ¢ word1[i-1] ä¸º word2[j-1]</span></span><br><span class="line">				<span class="comment">// dp[i-1][j] + 1:   åˆ é™¤ word1[i-1]</span></span><br><span class="line">				<span class="comment">// dp[i][j-1] + 1:   åœ¨ word1 æœ«å°¾æ’å…¥ word2[j-1]</span></span><br><span class="line">				dp[i][j] = Min(dp[i<span class="number">-1</span>][j<span class="number">-1</span>], dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>]) + <span class="number">1</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dp[n][m]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Min è¿”å›ä¸€ç»„æ•´æ•°ä¸­çš„æœ€å°å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Min</span><span class="params">(nums ...<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="comment">// æˆ–è€…è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œæˆ–è€…æ ¹æ®ä¸šåŠ¡åœºæ™¯è¿”å›ä¸€ä¸ªç‰¹å®šçš„å€¼</span></span><br><span class="line">		<span class="keyword">return</span> math.MaxInt32 <span class="comment">// ç¤ºä¾‹ï¼šå¦‚æœæ²¡æœ‰æ•°å­—ï¼Œåˆ™è¿”å›æœ€å¤§æ•´æ•°</span></span><br><span class="line">	&#125;</span><br><span class="line">	minVal := nums[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		<span class="keyword">if</span> num &lt; minVal &#123;</span><br><span class="line">			minVal = num</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> minVal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n<em>m)ï¼Œå…¶ä¸­ n æ˜¯ <code>word1</code> çš„é•¿åº¦ï¼Œm æ˜¯ <code>word2</code> çš„é•¿åº¦ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦å¡«å……ä¸€ä¸ª n</em>m å¤§å°çš„ DP è¡¨ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(n*m)ï¼Œç”¨äºå­˜å‚¨ DP è¡¨ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li><strong>åŠ¨æ€è§„åˆ’çŠ¶æ€å®šä¹‰</strong>ï¼šæ¸…æ™°åœ°å®šä¹‰ <code>dp[i][j]</code> çš„å«ä¹‰æ˜¯è§£å†³é—®é¢˜çš„å…³é”®ã€‚</li>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šæ­£ç¡®åˆå§‹åŒ– <code>dp</code> è¡¨çš„ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—ã€‚</li>
<li><strong>çŠ¶æ€è½¬ç§»é€»è¾‘</strong>ï¼šç†è§£ä¸‰ç§åŸºæœ¬æ“ä½œï¼ˆæ’å…¥ã€åˆ é™¤ã€æ›¿æ¢ï¼‰å¦‚ä½•å½±å“çŠ¶æ€è½¬ç§»ã€‚</li>
<li><strong>å­—ç¬¦ç´¢å¼•ä¸ DP ç´¢å¼•</strong>ï¼šæ³¨æ„å­—ç¬¦ä¸²ç´¢å¼• <code>word1[i-1]</code> å¯¹åº”çš„æ˜¯ <code>dp</code> è¡¨ä¸­çš„ç¬¬ <code>i</code> ä¸ªå…ƒç´ ã€‚</li>
</ul>
<p>è¿™ä¸ªé¢˜ç›®æ˜¯å­—ç¬¦ä¸²åŠ¨æ€è§„åˆ’ä¸­çš„ä¸€ä¸ªåŸºç¡€ä¸”é‡è¦çš„é—®é¢˜ï¼ŒæŒæ¡å…¶è§£æ³•å¯¹äºç†è§£æ›´å¤æ‚çš„å­—ç¬¦ä¸² DP é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>å­—ç¬¦ä¸²</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 5 - æœ€é•¿å›æ–‡å­ä¸²ï¼šåŠ¨æ€è§„åˆ’å¡«è¡¨é¡ºåºé”™è¯¯åˆ†æ</title>
    <url>/2025/05/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-5-%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œæ‰¾åˆ° <code>s</code> ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<p>è¾“å…¥ï¼šs = â€œbabadâ€<br>
è¾“å‡ºï¼šâ€œbabâ€<br>
è§£é‡Šï¼šâ€œabaâ€ åŒæ ·æ˜¯ç¬¦åˆé¢˜æ„çš„ç­”æ¡ˆã€‚</p>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<p>è¾“å…¥ï¼šs = â€œcbbdâ€<br>
è¾“å‡ºï¼šâ€œbbâ€</p>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= s.length &lt;= 1000</code></li>
<li><code>s</code> ä»…ç”±æ•°å­—å’Œè‹±æ–‡å­—æ¯ç»„æˆ</li>
</ul>
<h2 id="é”™è¯¯çš„è§£æ³•ä¸åˆ†æ">é”™è¯¯çš„è§£æ³•ä¸åˆ†æ</h2>
<p>ä¸€ä¸ªå¸¸è§çš„è§£å†³æ­¤é—®é¢˜çš„æ€è·¯æ˜¯ä½¿ç”¨åŠ¨æ€è§„åˆ’ã€‚æˆ‘ä»¬å®šä¹‰ <code>dp[i][j]</code> è¡¨ç¤ºå­—ç¬¦ä¸² <code>s</code> ä¸­ä»ç´¢å¼• <code>i</code> åˆ° <code>j</code> çš„å­ä¸²æ˜¯å¦æ˜¯å›æ–‡ä¸²ã€‚</p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯ä»¥è¿™æ ·å®šä¹‰ï¼š</p>
<ul>
<li>å¦‚æœ <code>s[i] == s[j]</code>ï¼š
<ul>
<li>å¦‚æœå­ä¸²é•¿åº¦å°äºç­‰äº 2ï¼ˆå³ <code>j - i &lt; 2</code>ï¼‰ï¼Œé‚£ä¹ˆ <code>dp[i][j]</code> ä¸º <code>true</code>ã€‚</li>
<li>å¦‚æœå­ä¸²é•¿åº¦å¤§äº 2ï¼Œé‚£ä¹ˆ <code>dp[i][j]</code> å–å†³äº <code>dp[i+1][j-1]</code> æ˜¯å¦ä¸ºå›æ–‡ä¸²ã€‚</li>
</ul>
</li>
<li>å¦‚æœ <code>s[i] != s[j]</code>ï¼Œé‚£ä¹ˆ <code>dp[i][j]</code> ä¸º <code>false</code>ã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå°è¯•å®ç°è¯¥æ€è·¯çš„ Go ä»£ç ï¼Œä½†å®ƒå­˜åœ¨ä¸€ä¸ªå…³é”®çš„é”™è¯¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestPalindrome</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(s)</span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s</span><br><span class="line">	&#125;</span><br><span class="line">	dp := <span class="built_in">make</span>([][]<span class="type">bool</span>, n)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> dp &#123;</span><br><span class="line">		dp[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, n)</span><br><span class="line">	&#125;</span><br><span class="line">	maxLen := <span class="number">1</span></span><br><span class="line">	start := <span class="number">0</span></span><br><span class="line">	end := <span class="number">1</span> <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šend åˆå§‹åŒ–ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´é•¿åº¦ä¸º1æ—¶å‡ºé”™</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> s &#123;</span><br><span class="line">		dp[i][i] = <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šå¡«è¡¨é¡ºåºé—®é¢˜</span></span><br><span class="line">	<span class="comment">// å½“è®¡ç®— dp[i][j] æ—¶ï¼Œdp[i+1][j-1] å¯èƒ½å°šæœªè¢«è®¡ç®—</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; n; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> j-i &lt; <span class="number">2</span> &#123; <span class="comment">// å­ä¸²é•¿åº¦ä¸º2</span></span><br><span class="line">				dp[i][j] = s[i] == s[j]</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123; <span class="comment">// å­ä¸²é•¿åº¦å¤§äº2</span></span><br><span class="line">				dp[i][j] = dp[i+<span class="number">1</span>][j<span class="number">-1</span>] &amp;&amp; s[i] == s[j]</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> dp[i][j] &amp;&amp; j-i+<span class="number">1</span> &gt; maxLen &#123;</span><br><span class="line">				maxLen = j - i + <span class="number">1</span></span><br><span class="line">				start = i</span><br><span class="line">				end = j</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> s[start : end+<span class="number">1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>ä¸»è¦çš„é”™è¯¯åœ¨äº <strong>DP è¡¨çš„å¡«å……é¡ºåº</strong>ã€‚</p>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¤–å±‚å¾ªç¯ <code>i</code> ä» <code>0</code> éå†åˆ° <code>n-1</code>ï¼Œå†…å±‚å¾ªç¯ <code>j</code> ä» <code>i+1</code> éå†åˆ° <code>n-1</code>ã€‚å½“æˆ‘ä»¬è®¡ç®— <code>dp[i][j]</code> æ—¶ï¼Œå®ƒä¾èµ–äº <code>dp[i+1][j-1]</code> çš„å€¼ã€‚</p>
<p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è®¡ç®— <code>dp[0][3]</code>ã€‚æ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå®ƒä¾èµ–äº <code>dp[1][2]</code>ã€‚<br>
åœ¨å½“å‰çš„éå†é¡ºåºä¸‹ï¼š</p>
<ul>
<li><code>i = 0</code>:
<ul>
<li><code>j = 1</code>: è®¡ç®— <code>dp[0][1]</code></li>
<li><code>j = 2</code>: è®¡ç®— <code>dp[0][2]</code> (ä¾èµ– <code>dp[1][1]</code>)</li>
<li><code>j = 3</code>: è®¡ç®— <code>dp[0][3]</code> (ä¾èµ– <code>dp[1][2]</code>)</li>
</ul>
</li>
</ul>
<p>å½“ <code>i=0, j=3</code> æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ <code>dp[1][2]</code> çš„å€¼ã€‚ä½†æ˜¯ï¼Œ<code>dp[1][2]</code> ä¼šåœ¨ <code>i=1, j=2</code> æ—¶æ‰è¢«è®¡ç®—ã€‚è¿™æ„å‘³ç€åœ¨è®¡ç®— <code>dp[0][3]</code> æ—¶ï¼Œ<code>dp[1][2]</code> è¿˜æ²¡æœ‰è¢«æ­£ç¡®è®¡ç®—å‡ºæ¥ï¼ˆå…¶å€¼ä»ä¸ºé»˜è®¤çš„ <code>false</code>ï¼‰ï¼Œä»è€Œå¯¼è‡´ <code>dp[0][3]</code> çš„è®¡ç®—é”™è¯¯ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>end</code> å˜é‡çš„åˆå§‹åŒ–ä¸º <code>1</code>ï¼Œå½“å­—ç¬¦ä¸²é•¿åº¦ä¸º <code>1</code> æ—¶ï¼Œå¦‚æœ <code>maxLen</code> æ²¡æœ‰æ›´æ–°ï¼ˆä¾‹å¦‚å­—ç¬¦ä¸²æœ¬èº«å°±æ˜¯å•ä¸ªå­—ç¬¦ï¼Œå·²ç»æ˜¯å›æ–‡ï¼‰ï¼Œ<code>s[start : end+1]</code> ä¼šå˜æˆ <code>s[0:2]</code>ï¼Œè¿™ä¼šå¯¼è‡´æ•°ç»„è¶Šç•Œã€‚å¯¹äºé•¿åº¦ä¸º 1 çš„å­—ç¬¦ä¸²ï¼Œ<code>start</code>åº”ä¸º<code>0</code>ï¼Œ<code>end</code>åº”ä¸º<code>0</code>ã€‚</p>
<h2 id="æ­£ç¡®çš„è§£æ³•ä¸æ€è·¯">æ­£ç¡®çš„è§£æ³•ä¸æ€è·¯</h2>
<p>ä¸ºäº†è§£å†³å¡«è¡¨é¡ºåºçš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨è®¡ç®— <code>dp[i][j]</code> æ—¶ï¼Œå…¶ä¾èµ–çš„ <code>dp[i+1][j-1]</code> å·²ç»è¢«è®¡ç®—è¿‡ã€‚è¿™å¯ä»¥é€šè¿‡æ”¹å˜å¾ªç¯çš„éå†é¡ºåºæ¥å®ç°ã€‚</p>
<p>æ­£ç¡®çš„æ€è·¯æ˜¯ï¼š</p>
<ol>
<li><strong>å¤–å±‚å¾ªç¯ <code>i</code> ä» <code>n-1</code> å‘ä¸‹éå†åˆ° <code>0</code>ã€‚</strong></li>
<li><strong>å†…å±‚å¾ªç¯ <code>j</code> ä» <code>i+1</code> å‘ä¸Šéå†åˆ° <code>n-1</code>ã€‚</strong></li>
</ol>
<p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬è®¡ç®— <code>dp[i][j]</code> æ—¶ï¼š</p>
<ul>
<li><code>i</code> çš„å€¼æ¯” <code>i+1</code> å°ã€‚</li>
<li><code>j</code> çš„å€¼æ¯” <code>j-1</code> å¤§ã€‚<br>
ç”±äº <code>i</code> æ˜¯ä»å¤§åˆ°å°éå†çš„ï¼Œå½“è®¡ç®— <code>dp[i][...]</code> æ—¶ï¼Œæ‰€æœ‰ <code>dp[i+1][...]</code> çš„è¡Œéƒ½å·²ç»è¢«è®¡ç®—å®Œæ¯•ã€‚å› æ­¤ï¼Œ<code>dp[i+1][j-1]</code> çš„å€¼æ˜¯å·²çŸ¥çš„ã€‚</li>
</ul>
<p>åŒæ—¶ï¼Œå¯¹äº <code>end</code> çš„åˆå§‹åŒ–ï¼Œå½“ <code>maxLen</code> ä¸º <code>1</code> æ—¶ï¼Œ<code>start</code> å’Œ <code>end</code> éƒ½åº”è¯¥æ˜¯ <code>0</code>ï¼ˆæˆ–è€…è¯´ï¼Œå­ä¸²å°±æ˜¯ <code>s[0:1]</code>ï¼‰ã€‚</p>
<h3 id="æ­£ç¡®çš„-Go-ä»£ç å®ç°">æ­£ç¡®çš„ Go ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestPalindrome</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(s)</span><br><span class="line">	<span class="keyword">if</span> n &lt; <span class="number">2</span> &#123; <span class="comment">// å¤„ç†ç©ºå­—ç¬¦ä¸²æˆ–å•å­—ç¬¦å­—ç¬¦ä¸²çš„æƒ…å†µ</span></span><br><span class="line">		<span class="keyword">return</span> s</span><br><span class="line">	&#125;</span><br><span class="line">	dp := <span class="built_in">make</span>([][]<span class="type">bool</span>, n)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> dp &#123;</span><br><span class="line">		dp[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, n)</span><br><span class="line">	&#125;</span><br><span class="line">	maxLen := <span class="number">1</span></span><br><span class="line">	start := <span class="number">0</span></span><br><span class="line">	<span class="comment">// end ä¸éœ€è¦å•ç‹¬åˆå§‹åŒ–ä¸º1ï¼Œé€šè¿‡dp[i][i] å’Œåç»­æ›´æ–°æ¥ç¡®å®š</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ‰€æœ‰é•¿åº¦ä¸º1çš„å­ä¸²éƒ½æ˜¯å›æ–‡ä¸²</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		dp[i][i] = <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä»åå¾€å‰éå† iï¼Œç¡®ä¿ dp[i+1][j-1] å·²è¢«è®¡ç®—</span></span><br><span class="line">	<span class="keyword">for</span> i := n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">		<span class="comment">// ä» i+1 å¼€å§‹éå† j</span></span><br><span class="line">		<span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; n; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> s[i] == s[j] &#123;</span><br><span class="line">				<span class="comment">// å¦‚æœå­ä¸²é•¿åº¦ä¸º2 (j-i == 1) æˆ–è€…å†…éƒ¨å­ä¸² dp[i+1][j-1] æ˜¯å›æ–‡</span></span><br><span class="line">				<span class="keyword">if</span> j-i &lt; <span class="number">2</span> || dp[i+<span class="number">1</span>][j<span class="number">-1</span>] &#123;</span><br><span class="line">					dp[i][j] = <span class="literal">true</span></span><br><span class="line">					<span class="keyword">if</span> j-i+<span class="number">1</span> &gt; maxLen &#123;</span><br><span class="line">						maxLen = j - i + <span class="number">1</span></span><br><span class="line">						start = i</span><br><span class="line">						<span class="comment">// end = j // end å¯ä»¥ä¸åœ¨è¿™é‡Œæ›´æ–°ï¼Œæœ€åé€šè¿‡ start å’Œ maxLen è®¡ç®—</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡ start å’Œ maxLen æ¥ç¡®å®šæœ€ç»ˆçš„å­ä¸²</span></span><br><span class="line">	<span class="keyword">return</span> s[start : start+maxLen]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¿®æ­£åçš„ç‰ˆæœ¬ä¸­ï¼š</p>
<ol>
<li><code>i</code> ä» <code>n-1</code> é€’å‡åˆ° <code>0</code>ã€‚</li>
<li><code>j</code> ä» <code>i+1</code> é€’å¢åˆ° <code>n-1</code>ã€‚</li>
<li>ç®€åŒ–äº† <code>dp[i][j]</code> çš„åˆ¤æ–­é€»è¾‘ï¼šå¦‚æœ <code>s[i] == s[j]</code>ï¼Œé‚£ä¹ˆå½“å­ä¸²é•¿åº¦ä¸º 2 (<code>j-i == 1</code>ï¼Œç­‰ä»·äº <code>j-i &lt; 2</code>) æˆ–è€…å†…éƒ¨å­ä¸² <code>dp[i+1][j-1]</code> ä¸ºå›æ–‡æ—¶ï¼Œ<code>dp[i][j]</code> æ‰ä¸º <code>true</code>ã€‚</li>
<li><code>end</code> çš„æ›´æ–°è¢«ç§»é™¤äº†ï¼Œæœ€åç›´æ¥é€šè¿‡ <code>start</code> å’Œ <code>maxLen</code> æ¥æˆªå–å­ä¸²ï¼Œè¿™æ ·æ›´ç®€æ´ä¸”ä¸æ˜“å‡ºé”™ã€‚å¯¹äº <code>maxLen</code> åˆå§‹åŒ–ä¸º <code>1</code>ï¼Œ<code>start</code> åˆå§‹åŒ–ä¸º <code>0</code>ï¼Œå¦‚æœå¾ªç¯æ²¡æœ‰æ‰¾åˆ°æ›´é•¿çš„å›æ–‡ä¸²ï¼Œä¼šè¿”å› <code>s[0:1]</code>ï¼Œè¿™æ˜¯æ­£ç¡®çš„ã€‚</li>
<li>å¤„ç†äº† <code>n &lt; 2</code> çš„è¾¹ç•Œæƒ…å†µã€‚</li>
</ol>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>åŠ¨æ€è§„åˆ’é—®é¢˜çš„æ ¸å¿ƒä¹‹ä¸€åœ¨äºç¡®å®šæ­£ç¡®çš„çŠ¶æ€è½¬ç§»é¡ºåºã€‚å½“ä¸€ä¸ªçŠ¶æ€ <code>dp[i][j]</code> ä¾èµ–äºå…¶ä»–çŠ¶æ€æ—¶ï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„ <code>dp[i+1][j-1]</code>ï¼‰ï¼Œå¿…é¡»ç¡®ä¿åœ¨è®¡ç®—å½“å‰çŠ¶æ€ä¹‹å‰ï¼Œæ‰€æœ‰ä¾èµ–çš„çŠ¶æ€éƒ½å·²ç»è¢«æ­£ç¡®è®¡ç®—ã€‚</p>
<p>å¯¹äºäºŒç»´ DP è¡¨ï¼Œå¸¸è§çš„éå†é¡ºåºæœ‰ï¼š</p>
<ul>
<li>ä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³ã€‚</li>
<li>ä»ä¸‹åˆ°ä¸Šï¼Œä»å·¦åˆ°å³ã€‚</li>
<li>ä»ä¸Šåˆ°ä¸‹ï¼Œä»å³åˆ°å·¦ã€‚</li>
<li>ä»ä¸‹åˆ°ä¸Šï¼Œä»å³åˆ°å·¦ã€‚</li>
</ul>
<p>é€‰æ‹©å“ªç§é¡ºåºå–å†³äºçŠ¶æ€ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œç”±äº <code>dp[i][j]</code> ä¾èµ–äº <code>dp[i+1][j-1]</code>ï¼ˆå³å·¦ä¸‹æ–¹çš„å•å…ƒæ ¼ï¼‰ï¼Œå› æ­¤ä»ä¸‹å¾€ä¸Šï¼ˆ<code>i</code> é€’å‡ï¼‰ã€ä»å·¦å¾€å³ï¼ˆ<code>j</code> é€’å¢ï¼Œä¸” <code>j &gt; i</code>ï¼‰çš„éå†é¡ºåºæ˜¯åˆé€‚çš„ã€‚</p>
<p>å¦å¤–ï¼Œåˆå§‹åŒ–è¾¹ç•Œæ¡ä»¶å’Œæœ€ç»ˆç»“æœçš„æå–æ–¹å¼ä¹Ÿéœ€è¦ä»”ç»†è€ƒè™‘ï¼Œä»¥é¿å…æ•°ç»„è¶Šç•Œæˆ–é€»è¾‘é”™è¯¯ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>å­—ç¬¦ä¸²</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 1143 - æœ€é•¿å…¬å…±å­åºåˆ— (Longest Common Subsequence)</title>
    <url>/2025/05/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-1143-%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² <code>text1</code> å’Œ <code>text2</code>ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ã€‚å¦‚æœä¸å­˜åœ¨å…¬å…±å­åºåˆ—ï¼Œè¿”å› 0ã€‚</p>
<p>ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­åºåˆ—æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚</p>
<p>ä¾‹å¦‚ï¼Œâ€œaceâ€ æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ï¼Œä½† â€œaecâ€ ä¸æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ã€‚<br>
ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å…¬å…±å­åºåˆ—æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<p>è¾“å…¥ï¼štext1 = â€œabcdeâ€, text2 = â€œaceâ€<br>
è¾“å‡ºï¼š3<br>
è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ â€œaceâ€ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚</p>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<p>è¾“å…¥ï¼štext1 = â€œabcâ€, text2 = â€œabcâ€<br>
è¾“å‡ºï¼š3<br>
è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ â€œabcâ€ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚</p>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<p>è¾“å…¥ï¼štext1 = â€œabcâ€, text2 = â€œdefâ€<br>
è¾“å‡ºï¼š0<br>
è§£é‡Šï¼šä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œè¿”å› 0ã€‚</p>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li><code>1 &lt;= text1.length, text2.length &lt;= 1000</code></li>
<li><code>text1</code> å’Œ <code>text2</code> ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆã€‚</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜æ˜¯å…¸å‹çš„åŠ¨æ€è§„åˆ’é—®é¢˜ã€‚åŠ¨æ€è§„åˆ’çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªå­é—®é¢˜ï¼Œé€šè¿‡è§£å†³è¿™äº›å­é—®é¢˜ï¼Œå¹¶å­˜å‚¨å®ƒä»¬çš„ç»“æœï¼Œæ¥æœ€ç»ˆè§£å†³å¤§é—®é¢˜ã€‚</p>
<p><strong>1. å®šä¹‰ DP æ•°ç»„çš„å«ä¹‰</strong></p>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ <code>dp</code>ï¼Œå…¶ä¸­ <code>dp[i][j]</code> ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸² <code>text1</code> çš„å‰ <code>i</code> ä¸ªå­—ç¬¦ï¼ˆå³å­ä¸² <code>text1[0...i-1]</code>ï¼‰ä¸å­—ç¬¦ä¸² <code>text2</code> çš„å‰ <code>j</code> ä¸ªå­—ç¬¦ï¼ˆå³å­ä¸² <code>text2[0...j-1]</code>ï¼‰çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœ <code>text1 = &quot;abc&quot;</code>ï¼Œ<code>text2 = &quot;axc&quot;</code>ï¼š</p>
<ul>
<li><code>dp[1][1]</code> è¡¨ç¤º <code>text1</code> çš„å‰ 1 ä¸ªå­—ç¬¦ â€œaâ€ å’Œ <code>text2</code> çš„å‰ 1 ä¸ªå­—ç¬¦ â€œaâ€ çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦ã€‚</li>
<li><code>dp[3][2]</code> è¡¨ç¤º <code>text1</code> çš„å‰ 3 ä¸ªå­—ç¬¦ â€œabcâ€ å’Œ <code>text2</code> çš„å‰ 2 ä¸ªå­—ç¬¦ â€œaxâ€ çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦ã€‚</li>
</ul>
<p><strong>2. çŠ¶æ€è½¬ç§»æ–¹ç¨‹</strong></p>
<p>å½“æˆ‘ä»¬è®¡ç®— <code>dp[i][j]</code> æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è§‚å¯Ÿ <code>text1</code> çš„ç¬¬ <code>i</code> ä¸ªå­—ç¬¦ï¼ˆå³ <code>text1[i-1]</code>ï¼‰å’Œ <code>text2</code> çš„ç¬¬ <code>j</code> ä¸ªå­—ç¬¦ï¼ˆå³ <code>text2[j-1]</code>ï¼‰ï¼š</p>
<ul>
<li>
<p><strong>æƒ…å†µä¸€ï¼š<code>text1[i-1] == text2[j-1]</code></strong><br>
å¦‚æœè¿™ä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸ªç›¸ç­‰çš„å­—ç¬¦ <code>text1[i-1]</code> (æˆ– <code>text2[j-1]</code>) å¿…ç„¶å¯ä»¥ä½œä¸º <code>text1[0...i-1]</code> å’Œ <code>text2[0...j-1]</code> çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„æœ€åä¸€ä¸ªå­—ç¬¦ã€‚<br>
å› æ­¤ï¼Œ<code>dp[i][j]</code> å°±ç­‰äº <code>text1[0...i-2]</code> å’Œ <code>text2[0...j-2]</code> çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ï¼Œå†åŠ ä¸Šè¿™ä¸ªå…±åŒçš„å­—ç¬¦ï¼ˆé•¿åº¦åŠ  1ï¼‰ã€‚<br>
æ‰€ä»¥ï¼Œ<code>dp[i][j] = dp[i-1][j-1] + 1</code>ã€‚</p>
</li>
<li>
<p><strong>æƒ…å†µäºŒï¼š<code>text1[i-1] != text2[j-1]</code></strong><br>
å¦‚æœè¿™ä¸¤ä¸ªå­—ç¬¦ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆ <code>text1[i-1]</code> å’Œ <code>text2[j-1]</code> ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦ä¸èƒ½åŒ…å«åœ¨ <code>text1[0...i-1]</code> å’Œ <code>text2[0...j-1]</code> çš„æœ€é•¿å…¬å…±å­åºåˆ—ä¸­ã€‚<br>
è¿™æ—¶ï¼Œ<code>dp[i][j]</code> çš„å€¼å–å†³äºä»¥ä¸‹ä¸¤ç§å¯èƒ½ä¸­è¾ƒå¤§çš„é‚£ä¸ªï¼š</p>
<ol>
<li>ä¸è€ƒè™‘ <code>text1[i-1]</code>ï¼Œå³ <code>text1[0...i-2]</code> å’Œ <code>text2[0...j-1]</code> çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ <code>dp[i-1][j]</code>ã€‚</li>
<li>ä¸è€ƒè™‘ <code>text2[j-1]</code>ï¼Œå³ <code>text1[0...i-1]</code> å’Œ <code>text2[0...j-2]</code> çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ <code>dp[i][j-1]</code>ã€‚<br>
æ‰€ä»¥ï¼Œ<code>dp[i][j] = max(dp[i-1][j], dp[i][j-1])</code>.</li>
</ol>
</li>
</ul>
<p><strong>3. åˆå§‹åŒ– DP æ•°ç»„ï¼ˆè¾¹ç•Œæ¡ä»¶ï¼‰</strong></p>
<ul>
<li><code>dp[0][j]</code>ï¼šè¡¨ç¤º <code>text1</code> ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆé•¿åº¦ä¸º 0ï¼‰ä¸ <code>text2</code> çš„å‰ <code>j</code> ä¸ªå­—ç¬¦çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚ç©ºå­—ç¬¦ä¸²ä¸ä»»ä½•å­—ç¬¦ä¸²çš„å…¬å…±å­åºåˆ—é•¿åº¦éƒ½æ˜¯ 0ã€‚æ‰€ä»¥ <code>dp[0][j] = 0</code> å¯¹æ‰€æœ‰ <code>j</code> æˆç«‹ã€‚</li>
<li><code>dp[i][0]</code>ï¼šè¡¨ç¤º <code>text1</code> çš„å‰ <code>i</code> ä¸ªå­—ç¬¦ä¸ <code>text2</code> ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆé•¿åº¦ä¸º 0ï¼‰çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚åŒç†ï¼Œé•¿åº¦ä¹Ÿæ˜¯ 0ã€‚æ‰€ä»¥ <code>dp[i][0] = 0</code> å¯¹æ‰€æœ‰ <code>i</code> æˆç«‹ã€‚</li>
<li>å› æ­¤ï¼Œ<code>dp[0][0]</code> (ç©ºä¸²ä¸ç©ºä¸²çš„ LCS) è‡ªç„¶ä¹Ÿæ˜¯ 0ã€‚<br>
åœ¨ Go è¯­è¨€ä¸­ï¼Œ<code>make</code> åˆ›å»ºçš„ <code>int</code> ç±»å‹åˆ‡ç‰‡é»˜è®¤å€¼ä¸º 0ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†åˆå§‹åŒ–å¯ä»¥çœç•¥æ˜¾å¼èµ‹å€¼ã€‚</li>
</ul>
<p><strong>4. å¡«è¡¨é¡ºåºä¸æœ€ç»ˆç»“æœ</strong></p>
<p>æˆ‘ä»¬ä» <code>dp[1][1]</code> å¼€å§‹ï¼Œé€è¡Œé€åˆ—åœ°å¡«å…… <code>dp</code> è¡¨ï¼Œç›´åˆ° <code>dp[n][m]</code>ï¼Œå…¶ä¸­ <code>n</code> æ˜¯ <code>text1</code> çš„é•¿åº¦ï¼Œ<code>m</code> æ˜¯ <code>text2</code> çš„é•¿åº¦ã€‚<br>
æœ€ç»ˆ <code>dp[n][m]</code> å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„ <code>text1</code> å’Œ <code>text2</code> æ•´ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ã€‚</p>
<p><strong>ä¸¾ä¾‹æ‰‹åŠ¨æ¨æ¼”ï¼š</strong></p>
<p>å‡è®¾ <code>text1 = &quot;ab&quot;</code>ï¼Œ<code>text2 = &quot;axb&quot;</code>ã€‚<br>
<code>n = 2</code>, <code>m = 3</code>ã€‚<br>
DP è¡¨å¤§å°ä¸º <code>(2+1) x (3+1) = 3x4</code>.</p>
<p>åˆå§‹åŒ–ï¼š<br>
<code>dp</code> è¡¨æ‰€æœ‰å…ƒç´ ä¸º 0ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      &quot;&quot;  a   x   b   (text2)</span><br><span class="line">&quot;&quot;    0   0   0   0</span><br><span class="line">a     0</span><br><span class="line">b     0</span><br><span class="line">(text1)</span><br></pre></td></tr></table></figure>
<p>å¼€å§‹å¡«å……ï¼š</p>
<ul>
<li><code>i=1, j=1</code>: <code>text1[0]</code> (â€˜aâ€™) == <code>text2[0]</code> (â€˜aâ€™)<br>
<code>dp[1][1] = dp[0][0] + 1 = 0 + 1 = 1</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      &quot;&quot;  a   x   b</span><br><span class="line">&quot;&quot;    0   0   0   0</span><br><span class="line">a     0   1</span><br><span class="line">b     0</span><br></pre></td></tr></table></figure>
<ul>
<li><code>i=1, j=2</code>: <code>text1[0]</code> (â€˜aâ€™) != <code>text2[1]</code> (â€˜xâ€™)<br>
<code>dp[1][2] = max(dp[0][2], dp[1][1]) = max(0, 1) = 1</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      &quot;&quot;  a   x   b</span><br><span class="line">&quot;&quot;    0   0   0   0</span><br><span class="line">a     0   1   1</span><br><span class="line">b     0</span><br></pre></td></tr></table></figure>
<ul>
<li><code>i=1, j=3</code>: <code>text1[0]</code> (â€˜aâ€™) != <code>text2[2]</code> (â€˜bâ€™)<br>
<code>dp[1][3] = max(dp[0][3], dp[1][2]) = max(0, 1) = 1</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      &quot;&quot;  a   x   b</span><br><span class="line">&quot;&quot;    0   0   0   0</span><br><span class="line">a     0   1   1   1</span><br><span class="line">b     0</span><br></pre></td></tr></table></figure>
<ul>
<li><code>i=2, j=1</code>: <code>text1[1]</code> (â€˜bâ€™) != <code>text2[0]</code> (â€˜aâ€™)<br>
<code>dp[2][1] = max(dp[1][1], dp[2][0]) = max(1, 0) = 1</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      &quot;&quot;  a   x   b</span><br><span class="line">&quot;&quot;    0   0   0   0</span><br><span class="line">a     0   1   1   1</span><br><span class="line">b     0   1</span><br></pre></td></tr></table></figure>
<ul>
<li><code>i=2, j=2</code>: <code>text1[1]</code> (â€˜bâ€™) != <code>text2[1]</code> (â€˜xâ€™)<br>
<code>dp[2][2] = max(dp[1][2], dp[2][1]) = max(1, 1) = 1</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      &quot;&quot;  a   x   b</span><br><span class="line">&quot;&quot;    0   0   0   0</span><br><span class="line">a     0   1   1   1</span><br><span class="line">b     0   1   1</span><br></pre></td></tr></table></figure>
<ul>
<li><code>i=2, j=3</code>: <code>text1[1]</code> (â€˜bâ€™) == <code>text2[2]</code> (â€˜bâ€™)<br>
<code>dp[2][3] = dp[1][2] + 1 = 1 + 1 = 2</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      &quot;&quot;  a   x   b</span><br><span class="line">&quot;&quot;    0   0   0   0</span><br><span class="line">a     0   1   1   1</span><br><span class="line">b     0   1   1   2</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆç»“æœ <code>dp[2][3] = 2</code>ã€‚æœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ â€œabâ€.</p>
<p>æœ€ç»ˆçš„ç»“æœæ˜¯ <code>dp[n][m]</code>ï¼Œå…¶ä¸­ <code>n</code> æ˜¯ <code>text1</code> çš„é•¿åº¦ï¼Œ<code>m</code> æ˜¯ <code>text2</code> çš„é•¿åº¦ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// filepath: /Users/adrianwang/.leetcode/1143.æœ€é•¿å…¬å…±å­åºåˆ—.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=1143 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [1143] æœ€é•¿å…¬å…±å­åºåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestCommonSubsequence</span><span class="params">(text1 <span class="type">string</span>, text2 <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n, m := <span class="built_in">len</span>(text1), <span class="built_in">len</span>(text2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// dp[i][j] è¡¨ç¤º text1[0...i-1] å’Œ text2[0...j-1] çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦</span></span><br><span class="line">	dp := <span class="built_in">make</span>([][]<span class="type">int</span>, n+<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> dp &#123;</span><br><span class="line">		dp[i] = <span class="built_in">make</span>([]<span class="type">int</span>, m+<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// base case: dp[0][...] å’Œ dp[...][0] å‡ä¸º 0ï¼ŒGo è¯­è¨€ä¸­é»˜è®¤åˆå§‹åŒ–ä¸º 0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= m; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> text1[i<span class="number">-1</span>] == text2[j<span class="number">-1</span>] &#123;</span><br><span class="line">				<span class="comment">// å½“å‰å­—ç¬¦åŒ¹é…ï¼ŒLCS é•¿åº¦åŠ  1</span></span><br><span class="line">				dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// å½“å‰å­—ç¬¦ä¸åŒ¹é…ï¼Œå–ä¸¤ç§æƒ…å†µçš„æœ€å¤§å€¼</span></span><br><span class="line">				<span class="comment">// 1. text1[0...i-2] å’Œ text2[0...j-1] çš„ LCS</span></span><br><span class="line">				<span class="comment">// 2. text1[0...i-1] å’Œ text2[0...j-2] çš„ LCS</span></span><br><span class="line">				dp[i][j] = max(dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>])</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dp[n][m]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// max å‡½æ•°è¾…åŠ©</span></span><br><span class="line"><span class="comment">// func max(a, b int) int &#123;</span></span><br><span class="line"><span class="comment">// 	if a &gt; b &#123;</span></span><br><span class="line"><span class="comment">// 		return a</span></span><br><span class="line"><span class="comment">// 	&#125;</span></span><br><span class="line"><span class="comment">// 	return b</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong> ä¸Šè¿°ä»£ç ä¸­ <code>max</code> å‡½æ•°åœ¨ LeetCode ç¯å¢ƒä¸­é€šå¸¸æ˜¯å†…ç½®çš„æˆ–å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœæœ¬åœ°è¿è¡Œéœ€è¦è‡ªè¡Œå®šä¹‰ã€‚åœ¨ <code>1143.æœ€é•¿å…¬å…±å­åºåˆ—.go</code> æ–‡ä»¶ä¸­ï¼Œ<code>max</code> å‡½æ•°æ˜¯å­˜åœ¨çš„ã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> O(n*m)ï¼Œå…¶ä¸­ <code>n</code> æ˜¯ <code>text1</code> çš„é•¿åº¦ï¼Œ<code>m</code> æ˜¯ <code>text2</code> çš„é•¿åº¦ã€‚æˆ‘ä»¬éœ€è¦å¡«å……ä¸€ä¸ª <code>n*m</code> å¤§å°çš„ DP è¡¨ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> O(n*m)ï¼Œç”¨äºå­˜å‚¨ DP è¡¨ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li>åŠ¨æ€è§„åˆ’æ˜¯è§£å†³æœ€é•¿å…¬å…±å­åºåˆ—é—®é¢˜çš„ç»å…¸æ–¹æ³•ã€‚</li>
<li>æ­£ç¡®å®šä¹‰ DP çŠ¶æ€ <code>dp[i][j]</code> çš„å«ä¹‰è‡³å…³é‡è¦ï¼Œé€šå¸¸è¡¨ç¤ºè€ƒè™‘å­é—®é¢˜ <code>text1[0...i-1]</code> å’Œ <code>text2[0...j-1]</code>.</li>
<li>ä»”ç»†æ¨å¯¼çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œè€ƒè™‘å­—ç¬¦åŒ¹é…å’Œä¸åŒ¹é…ä¸¤ç§æƒ…å†µã€‚</li>
<li>æ³¨æ„ DP è¡¨çš„åˆå§‹åŒ–å’Œè¾¹ç•Œæ¡ä»¶ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title>RedisåŸºç¡€ - é”®å€¼å¯¹æ•°æ®åº“å®ç°åŸç†</title>
    <url>/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%81%A5%E5%80%BC%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84/</url>
    <content><![CDATA[<h2 id="é”®å€¼å¯¹æ•°æ®åº“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ">é”®å€¼å¯¹æ•°æ®åº“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h2>
<p>åœ¨ä»‹ç»å…·ä½“æ•°æ®ç»“æ„ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ Redis æ˜¯å¦‚ä½•å®ç°é”®å€¼å¯¹ï¼ˆkey-valueï¼‰æ•°æ®åº“çš„åŸºæœ¬åŸç†ã€‚</p>
<p>Redis çš„é”®å€¼å¯¹ä¸­çš„ key æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œ <strong>value å¯ä»¥æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†åˆæ•°æ®ç±»å‹çš„å¯¹è±¡</strong>ï¼Œæ¯”å¦‚ List å¯¹è±¡ã€Hash å¯¹è±¡ã€Set å¯¹è±¡å’Œ Zset å¯¹è±¡ã€‚</p>
<p>ä¸‹é¢æ˜¯å‡ ç§ Redis æ–°å¢é”®å€¼å¯¹çš„å‘½ä»¤ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; SET name &quot;xiaolincoding&quot;</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">&gt; HSET person name &quot;xiaolincoding&quot; age 18</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">&gt; RPUSH stu &quot;xiaolin&quot; &quot;xiaomei&quot;</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>
<p>è¿™äº›å‘½ä»¤åˆ†åˆ«è¡¨ç¤ºï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¡å‘½ä»¤ï¼šname æ˜¯ä¸€ä¸ª<strong>å­—ç¬¦ä¸²é”®</strong>ï¼Œå› ä¸ºé”®çš„<strong>å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</strong>ï¼›</li>
<li>ç¬¬äºŒæ¡å‘½ä»¤ï¼šperson æ˜¯ä¸€ä¸ª<strong>å“ˆå¸Œè¡¨é”®</strong>ï¼Œå› ä¸ºé”®çš„<strong>å€¼æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œè¡¨å¯¹è±¡</strong>ï¼›</li>
<li>ç¬¬ä¸‰æ¡å‘½ä»¤ï¼šstu æ˜¯ä¸€ä¸ª<strong>åˆ—è¡¨é”®</strong>ï¼Œå› ä¸ºé”®çš„<strong>å€¼æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„åˆ—è¡¨å¯¹è±¡</strong>ï¼›</li>
</ul>
<p>é‚£ä¹ˆè¿™äº›ä¸åŒç±»å‹çš„é”®å€¼å¯¹æ˜¯å¦‚ä½•ä¿å­˜åœ¨ Redis ä¸­çš„å‘¢ï¼Ÿ</p>
<p>Redis ä½¿ç”¨ã€Œå“ˆå¸Œè¡¨ã€æ¥å­˜å‚¨æ‰€æœ‰çš„é”®å€¼å¯¹ã€‚å“ˆå¸Œè¡¨çš„ä¸€å¤§ä¼˜åŠ¿æ˜¯èƒ½å¤Ÿä»¥ O(1) çš„æ—¶é—´å¤æ‚åº¦å¿«é€ŸæŸ¥æ‰¾æ•°æ®â€”â€”ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªé«˜æ•ˆçš„ç´¢å¼•ç³»ç»Ÿã€‚ä»æ ¹æœ¬ä¸Šè¯´ï¼Œå“ˆå¸Œè¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªä½ç½®è¢«ç§°ä¸ºä¸€ä¸ªã€Œå“ˆå¸Œæ¡¶ã€ã€‚</p>
<p>æ¯ä¸ªå“ˆå¸Œæ¡¶ä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘ã€Œå“ˆå¸Œè¡¨èŠ‚ç‚¹ã€ï¼ˆ<code>dictEntry</code>ï¼‰çš„æŒ‡é’ˆã€‚è¿™ä¸ªèŠ‚ç‚¹æ˜¯ç†è§£ Redis å¦‚ä½•å­˜å‚¨æ•°æ®çš„å…³é”®ã€‚ä¸€ä¸ª <code>dictEntry</code> ç»“æ„å¹¶ä¸ç›´æ¥åŒ…å«é”®å’Œå€¼çš„æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯é€šè¿‡ä¸¤ä¸ªç‰¹æ®Šçš„æŒ‡é’ˆ <code>void* key</code> å’Œ <code>void* value</code>ï¼Œåˆ†åˆ«æŒ‡å‘å®é™…çš„é”®å¯¹è±¡å’Œå€¼å¯¹è±¡ã€‚è¿™ç§è®¾è®¡ä½¿å¾— Redis èƒ½å¤Ÿçµæ´»åœ°å¤„ç†å„ç§ä¸åŒç±»å‹çš„å€¼ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº† Redis ä¿å­˜é”®å€¼å¯¹æ‰€æ¶‰åŠçš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%81%A5%E5%80%BC%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84/1747569688715.png" alt="1747569688715"></p>
<p>è¿™äº›æ•°æ®ç»“æ„çš„å†…éƒ¨ç»†èŠ‚æˆ‘ä»¬ç¨ååœ¨è®¨è®ºå“ˆå¸Œè¡¨æ—¶ä¼šæ·±å…¥æ¢ç©¶ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€ä¸‹å›¾ä¸­è¿™äº›ç»“æ„å„è‡ªæ‰®æ¼”çš„è§’è‰²ï¼š</p>
<ul>
<li><code>redisDb</code> ç»“æ„ï¼šå¯ä»¥çœ‹ä½œæ˜¯ Redis ä¸­çš„ä¸€ä¸ªâ€œæ•°æ®åº“å®ä¾‹â€ã€‚å®ƒé‡Œé¢æœ€é‡è¦çš„å°±æ˜¯æŒ‡å‘ <code>dict</code> ç»“æ„çš„æŒ‡é’ˆï¼Œè¿™ä¸ª <code>dict</code> ç»“æ„æ˜¯å®ç°æˆ‘ä»¬å¸¸è¯´çš„å­—å…¸ï¼ˆæˆ–å“ˆå¸Œè¡¨ï¼‰çš„æ ¸å¿ƒã€‚</li>
<li><code>dict</code> ç»“æ„ï¼šè¿™å°±æ˜¯å­—å…¸ï¼ˆæˆ–ç§°ä¸ºå…³è”æ•°ç»„ã€mapï¼‰çš„å®ç°ã€‚æœ‰è¶£çš„æ˜¯ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼ˆå³ä¸¤ä¸ª <code>dictht</code> ç»“æ„ï¼‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ•°æ®éƒ½å­˜åœ¨ã€Œå“ˆå¸Œè¡¨ 1ã€ä¸­ã€‚ã€Œå“ˆå¸Œè¡¨ 2ã€åˆ™æ˜¯åœ¨ç‰¹æ®Šæ—¶æœŸâ€”â€”æ¯”å¦‚å“ˆå¸Œè¡¨éœ€è¦æ‰©å®¹æˆ–ç¼©å®¹ï¼ˆè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º rehashï¼‰æ—¶æ‰ä¼šç”¨åˆ°ã€‚</li>
<li><code>dictht</code> ç»“æ„ï¼šä»£è¡¨ä¸€ä¸ªå®é™…çš„å“ˆå¸Œè¡¨ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯å“ˆå¸Œè¡¨çš„ä¸»ä½“ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªã€Œå“ˆå¸Œè¡¨èŠ‚ç‚¹ã€ï¼ˆ<code>dictEntry</code>ï¼‰ã€‚</li>
<li><code>dictEntry</code> ç»“æ„ï¼šè¿™å°±æ˜¯å“ˆå¸Œè¡¨ä¸­çš„åŸºæœ¬å•å…ƒâ€”â€”ã€Œå“ˆå¸Œè¡¨èŠ‚ç‚¹ã€ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¿å­˜ä¸€ä¸ªé”®å€¼å¯¹ã€‚å®ƒåŒ…å«ä¸¤ä¸ªè‡³å…³é‡è¦çš„æŒ‡é’ˆï¼š
<ul>
<li><code>void* key</code>ï¼šæŒ‡å‘é”®å¯¹è±¡ã€‚åœ¨ Redis ä¸­ï¼Œé”®æ€»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚</li>
<li><code>void* value</code>ï¼šæŒ‡å‘å€¼å¯¹è±¡ã€‚è¿™ä¸ªå€¼å¯¹è±¡æ—¢å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æ›´å¤æ‚çš„é›†åˆç±»å‹ï¼Œå¦‚åˆ—è¡¨ï¼ˆListï¼‰ã€å“ˆå¸Œï¼ˆHashï¼‰ã€é›†åˆï¼ˆSetï¼‰æˆ–æœ‰åºé›†åˆï¼ˆZSetï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™é‡Œéœ€è¦ç‰¹åˆ«å¼ºè°ƒçš„æ˜¯ï¼Œ<code>dictEntry</code> ä¸­çš„ <code>key</code> å’Œ <code>value</code> æŒ‡é’ˆï¼Œå®ƒä»¬æŒ‡å‘çš„å¹¶ä¸æ˜¯åŸå§‹æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯æŒ‡å‘ä¸€ç§å«åšã€ŒRedis å¯¹è±¡ã€ï¼ˆ<code>redisObject</code>ï¼‰çš„ç»Ÿä¸€å°è£…ç»“æ„ã€‚å¯ä»¥è¯´ï¼Œåœ¨ Redis çš„ä¸–ç•Œé‡Œï¼Œæ— è®ºæ˜¯é”®è¿˜æ˜¯å€¼ï¼Œéƒ½ä¼šè¢«åŒ…è£…æˆä¸€ä¸ª <code>redisObject</code>ã€‚è¿™ç§å¯¹è±¡çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%81%A5%E5%80%BC%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84/1747569698413.png" alt="1747569698413"></p>
<p>ä¸€ä¸ª <code>redisObject</code> åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªå…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li><code>type</code>ï¼šæ ‡è®°äº†è¿™ä¸ªå¯¹è±¡æ˜¯å“ªç§æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å“ˆå¸Œç­‰ï¼‰ï¼Œæ˜ç¡®äº†å®ƒå¯ä»¥æ‰§è¡Œå“ªäº›æ“ä½œã€‚</li>
<li><code>encoding</code>ï¼šæŒ‡æ˜äº†è¯¥å¯¹è±¡å†…éƒ¨ä½¿ç”¨äº†å“ªç§æ›´åº•å±‚çš„å…·ä½“æ•°æ®ç»“æ„æ¥å®ç°ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªåˆ—è¡¨ç±»å‹çš„å¯¹è±¡ï¼Œå…¶åº•å±‚å¯èƒ½æ˜¯ç”¨å‹ç¼©åˆ—è¡¨æˆ–åŒå‘é“¾è¡¨å®ç°çš„ï¼ŒRedis ä¼šæ ¹æ®æƒ…å†µé€‰æ‹©æœ€ä¼˜çš„ç¼–ç æ–¹å¼ï¼‰ã€‚</li>
<li><code>ptr</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ ¸å¿ƒæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘äº†çœŸæ­£å­˜å‚¨æ•°æ®çš„åº•å±‚æ•°æ®ç»“æ„ã€‚</li>
</ul>
<p>ä¸‹å›¾å±•ç¤ºäº† Redis é”®å€¼å¯¹æ•°æ®åº“çš„å…¨æ™¯å›¾ï¼Œæ¸…æ™°å±•ç¤ºäº† Redis å¯¹è±¡å’Œæ•°æ®ç»“æ„ä¹‹é—´çš„å…³ç³»ï¼š</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%81%A5%E5%80%BC%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84/1747569712816.png" alt="1747569712816"></p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>åŸºç¡€çŸ¥è¯†</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>Redis</tag>
        <tag>é”®å€¼å¯¹</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç»“æ„ï¼šSDS è¯¦è§£</title>
    <url>/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/SDS/</url>
    <content><![CDATA[<h2 id="å‰è¨€ï¼šä¸ºä»€ä¹ˆ-Redis-ä¸ç›´æ¥ç”¨-C-å­—ç¬¦ä¸²ï¼Ÿ">å‰è¨€ï¼šä¸ºä»€ä¹ˆ Redis ä¸ç›´æ¥ç”¨ C å­—ç¬¦ä¸²ï¼Ÿ</h2>
<p>å­—ç¬¦ä¸²åœ¨ Redis ä¸­æ— å¤„ä¸åœ¨ï¼Œæ— è®ºæ˜¯é”®ï¼ˆKeyï¼‰è¿˜æ˜¯å€¼ï¼ˆValueï¼‰ï¼Œå­—ç¬¦ä¸²éƒ½æ˜¯æ ¸å¿ƒæ•°æ®ç±»å‹ä¹‹ä¸€ã€‚</p>
<p>Redis æ˜¯ç”¨ C è¯­è¨€ç¼–å†™çš„ï¼Œä½†å®ƒå¹¶æ²¡æœ‰ç›´æ¥é‡‡ç”¨ C è¯­è¨€ä¼ ç»Ÿçš„ <code>char*</code> å­—ç¬¦æ•°ç»„æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚ç›¸åï¼ŒRedis è®¾è®¡å¹¶å®ç°äº†ä¸€ç§åä¸º<strong>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</strong>ï¼ˆSimple Dynamic Stringï¼Œç®€ç§° SDSï¼‰çš„æ•°æ®ç»“æ„ã€‚</p>
<p>ä½ å¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶ C è¯­è¨€å·²ç»æœ‰äº†å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸ºä»€ä¹ˆ Redis è¿˜è¦â€œé‡å¤é€ è½®å­â€å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼šC è¯­è¨€çš„åŸç”Ÿå­—ç¬¦ä¸²åœ¨æŸäº›æ–¹é¢å­˜åœ¨ä¸è¶³ï¼Œæ— æ³•å®Œå…¨æ»¡è¶³ Redis å¯¹é«˜æ€§èƒ½å’Œå®‰å…¨æ€§çš„è¦æ±‚ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ C è¯­è¨€å­—ç¬¦ä¸²æœ‰å“ªäº›â€œç—›ç‚¹â€ï¼Œç„¶åçœ‹çœ‹ Redis çš„ SDS æ˜¯å¦‚ä½•å·§å¦™è§£å†³è¿™äº›é—®é¢˜çš„ã€‚</p>
<h2 id="C-è¯­è¨€å­—ç¬¦ä¸²çš„â€œç—›ç‚¹â€">C è¯­è¨€å­—ç¬¦ä¸²çš„â€œç—›ç‚¹â€</h2>
<p>C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä»¥ç©ºå­—ç¬¦ <code>\0</code> ç»“å°¾çš„å­—ç¬¦æ•°ç»„ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸² â€œxiaolinâ€ åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/SDS/1747750173011.png" alt="1747750173011"></p>
<p>è¿™ç§è®¾è®¡è™½ç„¶ç®€å•ï¼Œä½†ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼š</p>
<h3 id="1-è·å–é•¿åº¦æ•ˆç‡ä½ï¼šO-N-å¤æ‚åº¦">1. è·å–é•¿åº¦æ•ˆç‡ä½ï¼šO(N) å¤æ‚åº¦</h3>
<p>C è¯­è¨€æ ‡å‡†åº“å‡½æ•°ï¼ˆå¦‚ <code>strlen</code>ï¼‰åœ¨è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦æ—¶ï¼Œéœ€è¦ä»å¤´å¼€å§‹éå†å­—ç¬¦æ•°ç»„ï¼Œç›´åˆ°é‡åˆ° <code>\0</code> ç»“æŸç¬¦ã€‚è¿™æ„å‘³ç€è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N)ï¼Œå…¶ä¸­ N æ˜¯å­—ç¬¦ä¸²çš„å®é™…é•¿åº¦ã€‚å¯¹äºé•¿å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ“ä½œä¼šæ¯”è¾ƒè€—æ—¶ã€‚</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/SDS/1747750179732.png" alt="1747750179732"></p>
<h3 id="2-äºŒè¿›åˆ¶ä¸å®‰å…¨ï¼šæ— æ³•å­˜å‚¨ä»»æ„æ•°æ®">2. äºŒè¿›åˆ¶ä¸å®‰å…¨ï¼šæ— æ³•å­˜å‚¨ä»»æ„æ•°æ®</h3>
<p>ç”±äº <code>\0</code> è¢«ç”¨ä½œå­—ç¬¦ä¸²çš„ç»“æŸæ ‡å¿—ï¼ŒC å­—ç¬¦ä¸²æœ¬èº«ä¸èƒ½åŒ…å« <code>\0</code> å­—ç¬¦ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­é—´å‡ºç°äº† <code>\0</code>ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²æ“ä½œï¼ˆå¦‚é•¿åº¦è®¡ç®—ã€æ‹·è´ç­‰ï¼‰ä¼šæå‰ç»ˆæ­¢ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºå­—ç¬¦ä¸² â€œxiao\0linâ€ï¼Œä½¿ç”¨ <code>strlen</code> è®¡ç®—å…¶é•¿åº¦ä¼šå¾—åˆ° 4ï¼Œè€Œä¸æ˜¯å®é™…çš„ 7ã€‚</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/SDS/1747750187410.png" alt="1747750187410"></p>
<p>è¿™ä¸ªé™åˆ¶ä½¿å¾— C å­—ç¬¦ä¸²åªèƒ½å­˜å‚¨çº¯æ–‡æœ¬æ•°æ®ï¼Œæ— æ³•å®‰å…¨åœ°å­˜å‚¨åƒå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¯èƒ½åŒ…å« <code>\0</code> å­—ç¬¦çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
<h3 id="3-ç¼“å†²åŒºæº¢å‡ºé£é™©ï¼šæ“ä½œä¸å®‰å…¨">3. ç¼“å†²åŒºæº¢å‡ºé£é™©ï¼šæ“ä½œä¸å®‰å…¨</h3>
<p>C è¯­è¨€çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ï¼ˆå¦‚ <code>strcat</code> ç”¨äºæ‹¼æ¥å­—ç¬¦ä¸²ï¼‰é€šå¸¸ä¸æ£€æŸ¥ç›®æ ‡ç¼“å†²åŒºçš„å‰©ä½™ç©ºé—´ã€‚å®ƒä»¬å‡å®šå¼€å‘è€…å·²ç»åˆ†é…äº†è¶³å¤Ÿçš„å†…å­˜ã€‚å¦‚æœè¿™ä¸ªå‡å®šä¸æˆç«‹ï¼Œå°±ä¼šå‘ç”Ÿ<strong>ç¼“å†²åŒºæº¢å‡º</strong>ï¼Œæ•°æ®ä¼šå†™å…¥åˆ°æœªæˆæƒçš„å†…å­˜åŒºåŸŸï¼Œè½»åˆ™ç¨‹åºå´©æºƒï¼Œé‡åˆ™å¯èƒ½å¯¼è‡´å®‰å…¨æ¼æ´ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°† src å­—ç¬¦ä¸²æ‹¼æ¥åˆ° dest å­—ç¬¦ä¸²åé¢</span></span><br><span class="line"><span class="type">char</span> *<span class="title function_">strcat</span><span class="params">(<span class="type">char</span> *dest, <span class="type">const</span> <span class="type">char</span>* src)</span>;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼Œ<code>strcat</code> å‡½æ•°åœ¨æ‹¼æ¥æ—¶ï¼Œä¸ä¼šæ£€æŸ¥ <code>dest</code> æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´å®¹çº³ <code>src</code>ã€‚</p>
<h3 id="4-ä¿®æ”¹æ•ˆç‡ä½ï¼šé¢‘ç¹çš„å†…å­˜é‡åˆ†é…">4. ä¿®æ”¹æ•ˆç‡ä½ï¼šé¢‘ç¹çš„å†…å­˜é‡åˆ†é…</h3>
<p>C å­—ç¬¦ä¸²æœ¬èº«ä¸è®°å½•å·²åˆ†é…çš„å†…å­˜å¤§å°ã€‚å½“éœ€è¦å¢é•¿æˆ–ç¼©çŸ­å­—ç¬¦ä¸²æ—¶ï¼ˆä¾‹å¦‚ï¼Œè¿½åŠ å†…å®¹ï¼‰ï¼Œç¨‹åºé€šå¸¸éœ€è¦ï¼š</p>
<ol>
<li>åˆ†é…ä¸€ä¸ªæ–°çš„ã€æ›´å¤§ï¼ˆæˆ–æ›´å°ï¼‰çš„å†…å­˜å—ã€‚</li>
<li>å°†åŸæ¥çš„å­—ç¬¦ä¸²å†…å®¹æ‹·è´åˆ°æ–°å†…å­˜å—ã€‚</li>
<li>é‡Šæ”¾åŸæ¥çš„å†…å­˜å—ã€‚<br>
è¿™ç§æ“ä½œæ¶‰åŠå¤šæ¬¡å†…å­˜åˆ†é…å’Œæ•°æ®æ‹·è´ï¼Œæ•ˆç‡è¾ƒä½ã€‚</li>
</ol>
<p>æ€»ç»“ä¸€ä¸‹ C è¯­è¨€å­—ç¬¦ä¸²çš„ä¸»è¦ç¼ºé™·ï¼š</p>
<ul>
<li>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚</li>
<li>ä»¥ <code>\0</code> ä½œä¸ºç»“å°¾ï¼Œå¯¼è‡´äºŒè¿›åˆ¶ä¸å®‰å…¨ï¼Œä¸èƒ½å­˜å‚¨ä»»æ„æ•°æ®ã€‚</li>
<li>å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ï¼ˆå¦‚æ‹¼æ¥ï¼‰å®¹æ˜“å¼•å‘ç¼“å†²åŒºæº¢å‡ºã€‚</li>
<li>ä¿®æ”¹å­—ç¬¦ä¸²ï¼ˆå¢é•¿æˆ–ç¼©çŸ­ï¼‰æ—¶ï¼Œå†…å­˜ç®¡ç†å¤æ‚ä¸”æ•ˆç‡ä¸é«˜ã€‚</li>
</ul>
<p>ä¸ºäº†å…‹æœè¿™äº›é™åˆ¶ï¼ŒRedis è®¾è®¡äº† SDSã€‚</p>
<h2 id="SDSï¼šRedis-çš„è§£å†³æ–¹æ¡ˆ">SDSï¼šRedis çš„è§£å†³æ–¹æ¡ˆ</h2>
<p>SDS (Simple Dynamic String) æ˜¯ Redis è‡ªå·±å®ç°çš„ä¸€ç§å­—ç¬¦ä¸²æ•°æ®ç»“æ„ã€‚å®ƒé€šè¿‡åœ¨ä¼ ç»Ÿå­—ç¬¦æ•°ç»„çš„åŸºç¡€ä¸Šå¢åŠ ä¸€äº›å…ƒæ•°æ®ï¼Œå·§å¦™åœ°è§£å†³äº† C å­—ç¬¦ä¸²çš„è¯¸å¤šç—›ç‚¹ã€‚</p>
<h3 id="SDS-çš„ç»“æ„è®¾è®¡">SDS çš„ç»“æ„è®¾è®¡</h3>
<p>ä¸‹å›¾å±•ç¤ºäº† Redis 5.0 ä¸­ SDS çš„åŸºæœ¬ç»“æ„ï¼š</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/SDS/1747750286295.png" alt="1747750286295"></p>
<p>ä¸€ä¸ª SDS ç»“æ„é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><strong><code>len</code></strong>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè®°å½•äº† <code>buf</code> æ•°ç»„ä¸­å·²å­˜å‚¨å­—ç¬¦ä¸²çš„å®é™…é•¿åº¦ï¼ˆä¸åŒ…æ‹¬æœ«å°¾çš„ <code>\0</code>ï¼‰ã€‚</li>
<li><strong><code>alloc</code></strong>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè®°å½•äº† <code>buf</code> æ•°ç»„æ€»å…±åˆ†é…çš„å†…å­˜ç©ºé—´å¤§å°ï¼ˆä¸åŒ…æ‹¬æœ«å°¾çš„ <code>\0</code>ï¼‰ã€‚</li>
<li><strong><code>flags</code></strong>ï¼šä¸€ä¸ªå­—èŠ‚ï¼Œç”¨äºè¡¨ç¤º SDS çš„ç±»å‹ã€‚Redis è®¾è®¡äº†å¤šç§ SDS ç±»å‹ä»¥ä¼˜åŒ–ä¸åŒé•¿åº¦å­—ç¬¦ä¸²çš„å­˜å‚¨ã€‚</li>
<li><strong><code>buf[]</code></strong>ï¼šä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œå®é™…å­˜å‚¨å­—ç¬¦ä¸²å†…å®¹ã€‚ä¸ C å­—ç¬¦ä¸²ç±»ä¼¼ï¼ŒSDS ä¹Ÿä¼šåœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ ä¸€ä¸ª <code>\0</code> å­—ç¬¦ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†èƒ½å¤Ÿå…¼å®¹éƒ¨åˆ† C è¯­è¨€æ ‡å‡†åº“å‡½æ•°ã€‚ä½†è¿™å¹¶ä¸ä¼šå½±å“ SDS å­˜å‚¨åŒ…å« <code>\0</code> çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå› ä¸º SDS ä¾èµ– <code>len</code> å±æ€§æ¥åˆ¤æ–­å­—ç¬¦ä¸²çš„å®é™…é•¿åº¦ã€‚</li>
</ul>
<p>é€šè¿‡è¿™å‡ ä¸ªå…ƒæ•°æ®ï¼ŒSDS å¸¦æ¥äº†è¯¸å¤šä¼˜åŠ¿ã€‚</p>
<h3 id="SDS-çš„æ ¸å¿ƒä¼˜åŠ¿">SDS çš„æ ¸å¿ƒä¼˜åŠ¿</h3>
<h4 id="1-O-1-å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦">1. O(1) å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦</h4>
<p>ç”±äº SDS ç»“æ„ä¸­ç›´æ¥å­˜å‚¨äº†å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆ<code>len</code> å±æ€§ï¼‰ï¼Œè·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ“ä½œåªéœ€è¦è¯»å–è¿™ä¸ªå±æ€§å€¼å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚è¿™æ¯” C å­—ç¬¦ä¸²çš„ O(N) éå†é«˜æ•ˆå¾—å¤šã€‚</p>
<h4 id="2-äºŒè¿›åˆ¶å®‰å…¨ï¼šå¯ä»¥å­˜å‚¨ä»»æ„æ•°æ®">2. äºŒè¿›åˆ¶å®‰å…¨ï¼šå¯ä»¥å­˜å‚¨ä»»æ„æ•°æ®</h4>
<p>SDS é€šè¿‡ <code>len</code> å±æ€§æ¥åˆ¤æ–­å­—ç¬¦ä¸²çš„ç»“æŸï¼Œè€Œä¸æ˜¯ä¾èµ– <code>\0</code> å­—ç¬¦ã€‚è¿™æ„å‘³ç€ <code>buf</code> æ•°ç»„ä¸­å¯ä»¥åŒ…å«ä»»æ„äºŒè¿›åˆ¶æ•°æ®ï¼ŒåŒ…æ‹¬ <code>\0</code> å­—ç¬¦æœ¬èº«ã€‚</p>
<p>è™½ç„¶ SDS ä¹Ÿä¼šåœ¨ <code>buf</code> çš„æœ«å°¾è¿½åŠ ä¸€ä¸ª <code>\0</code>ï¼ˆä¸ºäº†å…¼å®¹ C åº“å‡½æ•°ï¼‰ï¼Œä½†è¿™éƒ¨åˆ†å¹¶ä¸è®¡å…¥ <code>len</code> ä¸­ï¼Œä¹Ÿä¸ä¼šå½±å“ SDS å¯¹äºŒè¿›åˆ¶æ•°æ®çš„å¤„ç†ã€‚å› æ­¤ï¼ŒSDS å¯ä»¥å®‰å…¨åœ°å­˜å‚¨æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ç­‰å„ç§ç±»å‹çš„æ•°æ®ã€‚</p>
<h4 id="3-æœç»ç¼“å†²åŒºæº¢å‡ºï¼šå®‰å…¨çš„å­—ç¬¦ä¸²æ“ä½œ">3. æœç»ç¼“å†²åŒºæº¢å‡ºï¼šå®‰å…¨çš„å­—ç¬¦ä¸²æ“ä½œ</h4>
<p>SDS åœ¨è¿›è¡Œå­—ç¬¦ä¸²ä¿®æ”¹æ“ä½œï¼ˆå¦‚æ‹¼æ¥ã€æ‹·è´ï¼‰æ—¶ï¼Œä¼šé¦–å…ˆæ£€æŸ¥ <code>alloc</code> è®°å½•çš„å·²åˆ†é…ç©ºé—´æ˜¯å¦è¶³å¤Ÿã€‚</p>
<ul>
<li>å¦‚æœç©ºé—´è¶³å¤Ÿï¼Œç›´æ¥è¿›è¡Œä¿®æ”¹ã€‚</li>
<li>å¦‚æœç©ºé—´ä¸è¶³ï¼ŒSDS ä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å®¹ï¼Œåˆ†é…è¶³å¤Ÿå¤§çš„æ–°å†…å­˜ç©ºé—´ï¼Œç„¶åå†æ‰§è¡Œä¿®æ”¹æ“ä½œã€‚</li>
</ul>
<p>è¿™ç§æœºåˆ¶ç¡®ä¿äº† SDS åœ¨æ“ä½œè¿‡ç¨‹ä¸­ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºï¼Œæé«˜äº†ä»£ç çš„å®‰å…¨æ€§ã€‚</p>
<p><strong>æ™ºèƒ½çš„å†…å­˜é¢„åˆ†é…ä¸æƒ°æ€§ç©ºé—´é‡Šæ”¾ç­–ç•¥ï¼š</strong></p>
<p>ä¸ºäº†è¿›ä¸€æ­¥æé«˜æ•ˆç‡ï¼ŒSDS åœ¨æ‰©å®¹æ—¶é‡‡ç”¨äº†â€œç©ºé—´é¢„åˆ†é…â€ç­–ç•¥ï¼š</p>
<ul>
<li>å½“ä¿®æ”¹å SDS çš„é•¿åº¦ <code>len</code> å°äº 1MB æ—¶ï¼Œç¨‹åºåˆ†é…æ–°ç©ºé—´æ—¶ï¼Œ<code>alloc</code> çš„å¤§å°ä¼šæ˜¯ <code>len</code> çš„ä¸¤å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¿®æ”¹åå­—ç¬¦ä¸²é•¿åº¦æ˜¯ 10 å­—èŠ‚ï¼ŒSDS ä¼šåˆ†é… 20 å­—èŠ‚çš„ç©ºé—´ï¼ˆ<code>len=10</code>, <code>alloc=20</code>ï¼‰ï¼Œå…¶ä¸­æœ‰ 10 å­—èŠ‚çš„æœªä½¿ç”¨ç©ºé—´ã€‚</li>
<li>å½“ä¿®æ”¹å SDS çš„é•¿åº¦ <code>len</code> å¤§äºç­‰äº 1MB æ—¶ï¼Œç¨‹åºä¼šé¢å¤–å¤šåˆ†é… 1MB çš„æœªä½¿ç”¨ç©ºé—´ã€‚å³ <code>alloc</code> çš„å¤§å°ä¼šæ˜¯ <code>len + 1MB</code>ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SDS æ‰©å®¹è§„åˆ™çš„ç®€åŒ–é€»è¾‘</span></span><br><span class="line">hisds <span class="title function_">hi_sdsMakeRoomFor</span><span class="params">(hisds s, <span class="type">size_t</span> addlen)</span> <span class="comment">// addlen æ˜¯éœ€è¦å¢åŠ çš„é•¿åº¦</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ... çœç•¥éƒ¨åˆ†ä»£ç  ...</span></span><br><span class="line">    <span class="type">size_t</span> avail = sdsavail(s); <span class="comment">// è·å–å½“å‰å¯ç”¨ç©ºé—´</span></span><br><span class="line">    <span class="comment">// å¦‚æœå¯ç”¨ç©ºé—´è¶³å¤Ÿï¼Œåˆ™æ— éœ€æ‰©å±•</span></span><br><span class="line">    <span class="keyword">if</span> (avail &gt;= addlen) <span class="keyword">return</span> s;</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> len = sdslen(s); <span class="comment">// è·å–å½“å‰å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">    <span class="type">size_t</span> newlen = (len + addlen); <span class="comment">// ä¿®æ”¹åè‡³å°‘éœ€è¦çš„æ€»é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æ–°é•¿åº¦å†³å®šå¦‚ä½•åˆ†é…ç©ºé—´</span></span><br><span class="line">    <span class="keyword">if</span> (newlen &lt; HI_SDS_MAX_PREALLOC) <span class="comment">// HI_SDS_MAX_PREALLOC é€šå¸¸æ˜¯ 1MB</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ–°é•¿åº¦å°äº 1MBï¼Œåˆ™åˆ†é…æ‰€éœ€ç©ºé—´çš„ä¸¤å€</span></span><br><span class="line">        newlen *= <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ–°é•¿åº¦å¤§äºç­‰äº 1MBï¼Œåˆ™é¢å¤–åˆ†é… 1MB</span></span><br><span class="line">        newlen += HI_SDS_MAX_PREALLOC;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... æ‰§è¡Œå®é™…çš„å†…å­˜é‡åˆ†é… ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§<strong>ç©ºé—´é¢„åˆ†é…</strong>ç­–ç•¥çš„å¥½å¤„æ˜¯ï¼Œå½“ä¸‹æ¬¡å†å¯¹ SDS è¿›è¡Œå¢é•¿æ“ä½œæ—¶ï¼Œå¦‚æœé¢„åˆ†é…çš„ç©ºé—´è¶³å¤Ÿï¼Œå°±ä¸éœ€è¦å†æ¬¡è¿›è¡Œå†…å­˜é‡åˆ†é…ï¼Œä»è€Œå‡å°‘äº†å†…å­˜åˆ†é…çš„æ¬¡æ•°ï¼Œæé«˜äº†æ€§èƒ½ã€‚</p>
<p>ç›¸åº”åœ°ï¼Œå½“ SDS å­—ç¬¦ä¸²ç¼©çŸ­æ—¶ï¼ŒSDS å¹¶ä¸ä¼šç«‹å³å›æ”¶å¤šå‡ºæ¥çš„ç©ºé—´ï¼Œè€Œæ˜¯é€šè¿‡ <code>len</code> å±æ€§æ›´æ–°å®é™…é•¿åº¦ï¼Œå¤šä½™çš„ç©ºé—´å°±æˆäº†æœªä½¿ç”¨çš„ç©ºé—´ï¼Œå¯ä»¥ä¾›åç»­çš„å¢é•¿æ“ä½œä½¿ç”¨ã€‚è¿™è¢«ç§°ä¸º<strong>æƒ°æ€§ç©ºé—´é‡Šæ”¾</strong>ã€‚</p>
<h4 id="4-èŠ‚çœå†…å­˜ç©ºé—´ï¼šå¤šç§-SDS-ç±»å‹ä¸ç´§å‡‘ç»“æ„">4. èŠ‚çœå†…å­˜ç©ºé—´ï¼šå¤šç§ SDS ç±»å‹ä¸ç´§å‡‘ç»“æ„</h4>
<p>ä¸ºäº†æ›´æœ‰æ•ˆåœ°åˆ©ç”¨å†…å­˜ï¼ŒRedis ä¸º SDS è®¾è®¡äº†å¤šç§å¤´éƒ¨ç»“æ„ï¼ˆé€šè¿‡ <code>flags</code> å­—æ®µåŒºåˆ†ï¼‰ï¼Œä»¥é€‚åº”ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ï¼š</p>
<ul>
<li><code>sdshdr5</code> (Redis 3.2 ä¹‹åä¸å†ä½¿ç”¨ï¼Œè¢« <code>sdshdr8</code> çš„ <code>flags</code> ä½ 3 ä½è¡¨ç¤ºç±»å‹ï¼Œé«˜ 5 ä½è¡¨ç¤ºé•¿åº¦æ‰€å–ä»£)</li>
<li><code>sdshdr8</code></li>
<li><code>sdshdr16</code></li>
<li><code>sdshdr32</code></li>
<li><code>sdshdr64</code></li>
</ul>
<p>è¿™äº›ç±»å‹çš„åŒºåˆ«ä¸»è¦åœ¨äº <code>len</code> å’Œ <code>alloc</code> æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹å¤§å°ä¸åŒï¼Œä»è€Œä½¿å¾—å­˜å‚¨çŸ­å­—ç¬¦ä¸²æ—¶ï¼Œå¤´éƒ¨ç»“æ„æœ¬èº«å ç”¨çš„å†…å­˜ä¹Ÿæ›´å°‘ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>sdshdr8</code>: <code>len</code> å’Œ <code>alloc</code> é€šå¸¸æ˜¯ <code>uint8_t</code> ç±»å‹ï¼Œæœ€å¤§é•¿åº¦çº¦ 2^8 - 1ã€‚</li>
<li><code>sdshdr16</code>: <code>len</code> å’Œ <code>alloc</code> æ˜¯ <code>uint16_t</code> ç±»å‹ï¼Œæœ€å¤§é•¿åº¦çº¦ 2^16 - 1ã€‚</li>
<li><code>sdshdr32</code>: <code>len</code> å’Œ <code>alloc</code> æ˜¯ <code>uint32_t</code> ç±»å‹ï¼Œæœ€å¤§é•¿åº¦çº¦ 2^32 - 1ã€‚</li>
<li><code>sdshdr64</code>: <code>len</code> å’Œ <code>alloc</code> æ˜¯ <code>uint64_t</code> ç±»å‹ï¼Œç”¨äºè¶…å¤§å­—ç¬¦ä¸²ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šsdshdr16 å’Œ sdshdr32 çš„ç»“æ„ (æ³¨æ„ï¼šå®é™… Redis æºç ä¸­ flags çš„ä½ç½®å’Œä½œç”¨æ›´å¤æ‚)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr16</span> &#123;</span></span><br><span class="line">    <span class="type">uint16_t</span> len;          <span class="comment">// 16ä½æ— ç¬¦å·æ•´æ•°å­˜å‚¨é•¿åº¦</span></span><br><span class="line">    <span class="type">uint16_t</span> alloc;        <span class="comment">// 16ä½æ— ç¬¦å·æ•´æ•°å­˜å‚¨å·²åˆ†é…ç©ºé—´</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags;   <span class="comment">// æ ‡å¿—ä½ï¼Œè¡¨ç¤ºç±»å‹ç­‰ä¿¡æ¯</span></span><br><span class="line">    <span class="type">char</span> buf[];            <span class="comment">// å®é™…å­—ç¬¦æ•°ç»„</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr32</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> len;          <span class="comment">// 32ä½æ— ç¬¦å·æ•´æ•°å­˜å‚¨é•¿åº¦</span></span><br><span class="line">    <span class="type">uint32_t</span> alloc;        <span class="comment">// 32ä½æ— ç¬¦å·æ•´æ•°å­˜å‚¨å·²åˆ†é…ç©ºé—´</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags;   <span class="comment">// æ ‡å¿—ä½</span></span><br><span class="line">    <span class="type">char</span> buf[];            <span class="comment">// å®é™…å­—ç¬¦æ•°ç»„</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒRedis å¯ä»¥æ ¹æ®å­—ç¬¦ä¸²çš„å®é™…å¤§å°é€‰æ‹©æœ€åˆé€‚çš„ SDS å¤´éƒ¨ç»“æ„ï¼Œé¿å…äº†ä¸å¿…è¦çš„å†…å­˜æµªè´¹ã€‚</p>
<p>æ­¤å¤–ï¼ŒRedis åœ¨å®šä¹‰è¿™äº›ç»“æ„ä½“æ—¶ï¼Œä½¿ç”¨äº† <code>__attribute__ ((__packed__))</code> ç¼–è¯‘æŒ‡ä»¤ï¼ˆGCC ç‰¹æ€§ï¼‰ã€‚è¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰ç¼–è¯‘å™¨å–æ¶ˆç»“æ„ä½“æˆå‘˜å˜é‡ä¹‹é—´çš„å¯¹é½å¡«å……å­—èŠ‚ï¼Œä½¿å¾—ç»“æ„ä½“æŒ‰ç…§å®é™…å ç”¨çš„å­—èŠ‚æ•°è¿›è¡Œå†…å­˜åˆ†é…ï¼Œä»è€Œè¿›ä¸€æ­¥èŠ‚çœå†…å­˜ã€‚</p>
<p><strong><code>__attribute__ ((__packed__))</code> çš„ä½œç”¨ç¤ºä¾‹ï¼š</strong></p>
<p>è€ƒè™‘ä¸€ä¸ªæ™®é€šçš„ C ç»“æ„ä½“ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test1</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> a; <span class="comment">// 1å­—èŠ‚</span></span><br><span class="line">    <span class="type">int</span> b;  <span class="comment">// 4å­—èŠ‚</span></span><br><span class="line"> &#125; test1_instance; <span class="comment">// å˜é‡åä¿®æ­£ä¸º instance</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;sizeof(test1_instance) = %lu\n&quot;</span>, <span class="keyword">sizeof</span>(test1_instance)); <span class="comment">// æ‰“å°ç»“æ„ä½“å¤§å°</span></span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å¤§å¤šæ•°ç¼–è¯‘å™¨å’Œä½“ç³»ç»“æ„ä¸‹ï¼Œ<code>sizeof(test1_instance)</code> çš„ç»“æœé€šå¸¸æ˜¯ 8 å­—èŠ‚ã€‚è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨ä¸ºäº†æé«˜å†…å­˜è®¿é—®æ•ˆç‡ï¼Œä¼šå¯¹ç»“æ„ä½“æˆå‘˜è¿›è¡Œ<strong>å­—èŠ‚å¯¹é½</strong>ã€‚<code>char a</code> å  1 å­—èŠ‚ï¼Œä½†ä¸ºäº†è®©æ¥ä¸‹æ¥çš„ <code>int b</code> (é€šå¸¸æ˜¯ 4 å­—èŠ‚å¯¹é½) ä»ä¸€ä¸ªåˆé€‚çš„åœ°å€å¼€å§‹ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ <code>a</code> å’Œ <code>b</code> ä¹‹é—´å¡«å…… 3 ä¸ªå­—èŠ‚ã€‚</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/SDS/1747750306112.png" alt="1747750306112"></p>
<p>è€Œå¦‚æœä½¿ç”¨äº† <code>__attribute__ ((__packed__))</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span>((<span class="title">packed</span>)) <span class="title">test2</span>  &#123;</span></span><br><span class="line">    <span class="type">char</span> a; <span class="comment">// 1å­—èŠ‚</span></span><br><span class="line">    <span class="type">int</span> b;  <span class="comment">// 4å­—èŠ‚</span></span><br><span class="line"> &#125; test2_instance; <span class="comment">// å˜é‡åä¿®æ­£ä¸º instance</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;sizeof(test2_instance) = %lu\n&quot;</span>, <span class="keyword">sizeof</span>(test2_instance)); <span class="comment">// æ‰“å°ç»“æ„ä½“å¤§å°</span></span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œ<code>sizeof(test2_instance)</code> çš„ç»“æœä¼šæ˜¯ 5 å­—èŠ‚ (1 å­—èŠ‚ for <code>char a</code> + 4 å­—èŠ‚ for <code>int b</code>)ã€‚ç¼–è¯‘å™¨å–æ¶ˆäº†å¯¹é½å¡«å……ï¼Œä½¿å¾—ç»“æ„ä½“æ›´åŠ ç´§å‡‘ã€‚</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/SDS/1747750323570.png" alt="1747750323570"></p>
<p>é€šè¿‡è¿™äº›ç²¾å¿ƒè®¾è®¡ï¼ŒSDS åœ¨ä¿è¯åŠŸèƒ½å¼ºå¤§å’Œå®‰å…¨çš„åŒæ—¶ï¼Œä¹Ÿå…¼é¡¾äº†å†…å­˜ä½¿ç”¨æ•ˆç‡ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Redis çš„ SDS é€šè¿‡å¼•å…¥ <code>len</code>ã€<code>alloc</code> å’Œ <code>flags</code> ç­‰å…ƒæ•°æ®ï¼Œå¹¶ç»“åˆå·§å¦™çš„å†…å­˜ç®¡ç†ç­–ç•¥ï¼ˆå¦‚ç©ºé—´é¢„åˆ†é…ã€æƒ°æ€§é‡Šæ”¾ã€å¤šç§å¤´éƒ¨ç±»å‹å’Œç´§å‡‘ç»“æ„ï¼‰ï¼ŒæˆåŠŸåœ°å…‹æœäº†ä¼ ç»Ÿ C è¯­è¨€å­—ç¬¦ä¸²åœ¨æ•ˆç‡ã€å®‰å…¨æ€§å’ŒåŠŸèƒ½ä¸Šçš„è¯¸å¤šé™åˆ¶ã€‚è¿™ä½¿å¾— SDS æˆä¸º Redis é«˜æ€§èƒ½å’Œå¯é æ€§çš„é‡è¦åŸºçŸ³ä¹‹ä¸€ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Redis</tag>
        <tag>SDS</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 32 - æœ€é•¿æœ‰æ•ˆæ‹¬å·ï¼šåŠ¨æ€è§„åˆ’æ€è·¯é”™é¢˜åˆ†æ</title>
    <url>/2025/05/18/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/leetcode-32-longest-valid-parentheses-dp-error-analysis/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p><a href="https://leetcode.com/problems/longest-valid-parentheses/">LeetCode 32 é¢˜ - æœ€é•¿æœ‰æ•ˆæ‹¬å·</a>è¦æ±‚æˆ‘ä»¬æ‰¾åˆ°ç»™å®šå­—ç¬¦ä¸²ä¸­ç”±åŒ¹é…æ‹¬å·ç»„æˆçš„æœ€é•¿æœ‰æ•ˆï¼ˆæ ¼å¼æ­£ç¡®ä¸”è¿ç»­ï¼‰æ‹¬å·å­ä¸²çš„é•¿åº¦ã€‚</p>
<p>æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç©ºå­—ç¬¦ä¸²æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²</li>
<li>å¦‚æœ<code>s</code>æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆ<code>(s)</code>ä¹Ÿæ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²</li>
<li>å¦‚æœ<code>s</code>å’Œ<code>t</code>éƒ½æ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆ<code>st</code>ï¼ˆå®ƒä»¬çš„è¿æ¥ï¼‰ä¹Ÿæ˜¯æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸²</li>
</ol>
<p><strong>ç¤ºä¾‹è¾“å…¥è¾“å‡ºï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥: s = &quot;(()&quot;</span><br><span class="line">è¾“å‡º: 2</span><br><span class="line">è§£é‡Š: æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²æ˜¯ &quot;()&quot;</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥: s = &quot;)()())&quot;</span><br><span class="line">è¾“å‡º: 4</span><br><span class="line">è§£é‡Š: æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²æ˜¯ &quot;()()&quot;</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3:</span><br><span class="line">è¾“å…¥: s = &quot;&quot;</span><br><span class="line">è¾“å‡º: 0</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>0 &lt;= s.length &lt;= 3 * 10^4</code></li>
<li><code>s[i]</code> åªåŒ…å« <code>'('</code> å’Œ <code>')'</code></li>
</ul>
<h2 id="æœ€åˆçš„é”™è¯¯è§£æ³•">æœ€åˆçš„é”™è¯¯è§£æ³•</h2>
<p>æˆ‘æœ€åˆå°è¯•ä½¿ç”¨åŠ¨æ€è§„åˆ’è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å®šä¹‰ <code>dp[i]</code> è¡¨ç¤ºä»¥å­—ç¬¦ä¸² <code>s</code> ä¸­ç¬¬ <code>i-1</code> ä¸ªå­—ç¬¦ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·çš„é•¿åº¦ï¼Œ<code>dp</code> æ•°ç»„çš„å¤§å°ä¸º <code>n+1</code>ï¼ˆå…¶ä¸­ <code>n</code> æ˜¯å­—ç¬¦ä¸²é•¿åº¦ï¼‰ï¼Œ<code>dp[0]</code> åˆå§‹åŒ–ä¸º 0ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘æœ€åˆçš„è§£æ³•ï¼ˆåŒ…å«é”™è¯¯ï¼‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ä»£ç ç‰‡æ®µ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestValidParentheses_buggy</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(s)</span><br><span class="line">    dp := <span class="built_in">make</span>([]<span class="type">int</span>, n+<span class="number">1</span>) <span class="comment">// dp[i] è¡¨ç¤ºä»¥ s[i-1] ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123; <span class="comment">// éå† s[1] åˆ° s[n-1]</span></span><br><span class="line">        <span class="comment">// å½“å‰è€ƒè™‘çš„å­—ç¬¦æ˜¯ s[i]ï¼Œå¯¹åº” dp[i+1]</span></span><br><span class="line">        <span class="keyword">if</span> s[i] == <span class="string">&#x27;)&#x27;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> s[i<span class="number">-1</span>] == <span class="string">&#x27;(&#x27;</span> &#123; <span class="comment">// æƒ…å†µ 1: ...()</span></span><br><span class="line">                <span class="comment">// s[i-2] ç»“å°¾çš„ LVP + &quot;()&quot;</span></span><br><span class="line">                <span class="comment">// å¦‚æœ i-2 &lt; 0, dp[i-1] (å³ dp[i-2+1]) ä¼šæ˜¯ dp[-1+1]=dp[0]=0</span></span><br><span class="line">                dp[i+<span class="number">1</span>] = dp[i<span class="number">-1</span>] + <span class="number">2</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i<span class="number">-1</span>] == <span class="string">&#x27;)&#x27;</span> &#123; <span class="comment">// æƒ…å†µ 2: ...))</span></span><br><span class="line">                <span class="comment">// j æŒ‡å‘ s[i-1] å¯¹åº” LVP (é•¿åº¦ dp[i]) å‰ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">                <span class="comment">// dp[i] æ˜¯ä»¥ s[i-1] ç»“å°¾çš„ LVP é•¿åº¦</span></span><br><span class="line">                j := i - dp[i] - <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> j &gt;= <span class="number">0</span> &amp;&amp; s[j] == <span class="string">&#x27;(&#x27;</span> &#123; <span class="comment">// å¦‚æœ s[j] æ˜¯ &#x27;(&#x27;ï¼Œå½¢æˆ s[j]...s[i] çš„åŒ¹é…</span></span><br><span class="line">                    <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šçŠ¶æ€è½¬ç§»é€»è¾‘é”™è¯¯</span></span><br><span class="line">                    dp[i+<span class="number">1</span>] = dp[j] + <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ans := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k := <span class="number">0</span>; k &lt;= n; k++ &#123;</span><br><span class="line">        ans = max(ans, dp[k])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè§£æ³•åœ¨ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ä¸­å¤±è´¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;)()())&quot;</span><br><span class="line">é¢„æœŸè¾“å‡º: 4</span><br><span class="line">å®é™…è¾“å‡º: 2</span><br></pre></td></tr></table></figure>
<h2 id="é”™è¯¯åˆ†æ">é”™è¯¯åˆ†æ</h2>
<p>ä¸»è¦çš„é”™è¯¯å‡ºç°åœ¨å¤„ç† <code>s[i] == ')'</code> å¹¶ä¸” <code>s[i-1] == ')'</code> çš„æƒ…å†µï¼Œå³å½¢å¦‚ <code>...))</code> çš„å­ä¸²ã€‚å…·ä½“æ¥è¯´ï¼Œé”™è¯¯å‘ç”Ÿåœ¨çŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„è®¡ç®—ä¸­ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥åˆ†æè¿™ä¸ªé”™è¯¯ï¼š</p>
<p>å¯¹äºå­—ç¬¦ä¸² <code>&quot;)()())&quot;</code>ï¼Œæˆ‘ä»¬é€æ­¥æ‰§è¡ŒåŠ¨æ€è§„åˆ’ï¼š</p>
<ol>
<li><code>dp[0] = 0</code>ï¼ˆåˆå§‹åŒ–ï¼‰</li>
<li>å¯¹äº <code>s[0] = ')':</code> ä¸å¯èƒ½å½¢æˆæœ‰æ•ˆæ‹¬å·ï¼Œ<code>dp[1] = 0</code></li>
<li>å¯¹äº <code>s[1] = '(':</code> ä¸å¯èƒ½ä»¥å·¦æ‹¬å·ç»“å°¾ï¼Œ<code>dp[2] = 0</code></li>
<li>å¯¹äº <code>s[2] = ')':</code> ä¸å‰ä¸€ä¸ªå­—ç¬¦ <code>s[1] = '('</code> åŒ¹é…ï¼Œ<code>dp[3] = dp[1] + 2 = 0 + 2 = 2</code></li>
<li>å¯¹äº <code>s[3] = '(':</code> ä¸å¯èƒ½ä»¥å·¦æ‹¬å·ç»“å°¾ï¼Œ<code>dp[4] = 0</code></li>
<li>å¯¹äº <code>s[4] = ')':</code> ä¸å‰ä¸€ä¸ªå­—ç¬¦ <code>s[3] = '('</code> åŒ¹é…ï¼Œ<code>dp[5] = dp[3] + 2 = 2 + 2 = 4</code></li>
<li>å¯¹äº <code>s[5] = ')':</code> éœ€è¦æ£€æŸ¥æ˜¯å¦å¯ä»¥ä¸æŸä¸ªå·¦æ‹¬å·åŒ¹é…</li>
</ol>
<p>åœ¨ç¬¬ 7 æ­¥ï¼Œä¹Ÿå°±æ˜¯å¤„ç†å­—ç¬¦ä¸²æœ€åä¸€ä¸ªå­—ç¬¦ <code>)</code> æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å®ƒèƒ½å¦ä¸æŸä¸ªå·¦æ‹¬å·åŒ¹é…ã€‚è¿™æ—¶ï¼š</p>
<ul>
<li><code>s[5] = ')'</code></li>
<li><code>s[4] = ')'</code>ï¼ˆå‰ä¸€ä¸ªå­—ç¬¦ä¹Ÿæ˜¯å³æ‹¬å·ï¼‰</li>
<li><code>dp[5] = 4</code>ï¼ˆè¡¨ç¤ºä»¥ <code>s[4]</code> ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦ï¼‰</li>
<li><code>j = 5 - 4 - 1 = 0</code>ï¼ˆ<code>j</code> æ˜¯æŒ‡å‘å½“å‰æœ‰æ•ˆæ‹¬å·å­ä¸²å‰ä¸€ä¸ªä½ç½®çš„ç´¢å¼•ï¼‰</li>
<li><code>s[j] = s[0] = ')'</code>ï¼ˆä¸æ˜¯å·¦æ‹¬å·ï¼‰</li>
</ul>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äº <code>s[j]</code> ä¸æ˜¯å·¦æ‹¬å·ï¼Œæ‰€ä»¥ä¸ä¼šå½¢æˆæ–°çš„åŒ¹é…ã€‚ä½†è¿™å¹¶ä¸æ˜¯æˆ‘æƒ³è¦å…³æ³¨çš„é”™è¯¯ã€‚</p>
<p><strong>å…³é”®é”™è¯¯åˆ†æ</strong>ï¼š</p>
<p>å½“ <code>s[i] == ')'</code> ä¸” <code>s[i-1] == ')'</code> ä¸” <code>j &gt;= 0</code> ä¸” <code>s[j] == '('</code> æ—¶ï¼Œæˆ‘é”™è¯¯åœ°å°†çŠ¶æ€è½¬ç§»æ–¹ç¨‹å†™æˆäº† <code>dp[i+1] = dp[j] + 1</code>ã€‚</p>
<p>è¿™ä¸ªé”™è¯¯çš„çŠ¶æ€è½¬ç§»å…¬å¼æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><code>+1</code> æ˜¯é”™è¯¯çš„ï¼Œåº”è¯¥æ˜¯ <code>+2</code>ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åŠ ä¸Š <code>s[j]</code> å’Œ <code>s[i]</code> è¿™ä¸¤ä¸ªæ–°åŒ¹é…çš„æ‹¬å·ã€‚</li>
<li>æ²¡æœ‰è€ƒè™‘åˆ° <code>s[j+1...i-1]</code> è¿™éƒ¨åˆ†å·²ç»å½¢æˆçš„æœ‰æ•ˆæ‹¬å·é•¿åº¦ï¼Œå³ <code>dp[i]</code>ã€‚</li>
</ol>
<p>æ­£ç¡®çš„æ€è·¯æ˜¯ï¼šæ–°å½¢æˆçš„æœ‰æ•ˆæ‹¬å·å­ä¸²é•¿åº¦åº”è¯¥æ˜¯ä¸‰éƒ¨åˆ†ä¹‹å’Œï¼š</p>
<ul>
<li><code>dp[j]</code>ï¼šä»¥ <code>s[j-1]</code> ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦ï¼ˆå¯èƒ½è¿æ¥åˆ°æ–°åŒ¹é…å‰é¢çš„éƒ¨åˆ†ï¼‰</li>
<li><code>+ dp[i]</code>ï¼šä»¥ <code>s[i-1]</code> ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦ï¼ˆ<code>s[j+1...i-1]</code> çš„éƒ¨åˆ†ï¼‰</li>
<li><code>+ 2</code>ï¼š<code>s[j]</code> å’Œ <code>s[i]</code> è¿™ä¸¤ä¸ªæ–°åŒ¹é…çš„æ‹¬å·</li>
</ul>
<h2 id="æ­£ç¡®çš„åŠ¨æ€è§„åˆ’æ€è·¯">æ­£ç¡®çš„åŠ¨æ€è§„åˆ’æ€è·¯</h2>
<p>è¦è§£å†³æœ€é•¿æœ‰æ•ˆæ‹¬å·é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’æ¥è¿½è¸ªä»¥æ¯ä¸ªä½ç½®ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²é•¿åº¦ã€‚ä¸‹é¢è¯¦ç»†è®²è§£æ€è·¯ï¼š</p>
<h3 id="çŠ¶æ€å®šä¹‰">çŠ¶æ€å®šä¹‰</h3>
<ul>
<li>å®šä¹‰ <code>dp[i]</code> è¡¨ç¤ºä»¥å­—ç¬¦ä¸² <code>s</code> ä¸­ç´¢å¼• <code>i-1</code> çš„å­—ç¬¦ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·çš„é•¿åº¦</li>
<li>ä½¿ç”¨ <code>dp</code> æ•°ç»„å¤§å°ä¸º <code>n+1</code>ï¼Œå…¶ä¸­ <code>dp[0]=0</code> è¡¨ç¤ºç©ºä¸²</li>
</ul>
<h3 id="çŠ¶æ€åˆå§‹åŒ–">çŠ¶æ€åˆå§‹åŒ–</h3>
<ul>
<li><code>dp[0] = 0</code>ï¼ˆç©ºä¸²ï¼‰</li>
<li>å¯¹äºæ‰€æœ‰çš„ <code>i â‰¥ 1</code>ï¼Œåˆå§‹æ—¶ <code>dp[i] = 0</code></li>
</ul>
<h3 id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h3>
<p>ç”±äºæœ‰æ•ˆæ‹¬å·å­ä¸²å¿…é¡»ä»¥å³æ‹¬å· <code>')'</code> ç»“å°¾ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è€ƒè™‘ <code>s[i-1] = ')'</code> çš„æƒ…å†µã€‚æ ¹æ®å‰ä¸€ä¸ªå­—ç¬¦ï¼Œæœ‰ä¸¤ç§ä¸»è¦æƒ…å†µï¼š</p>
<ol>
<li>
<p><strong>æƒ…å†µä¸€ï¼š<code>s[i-1] = ')'</code> ä¸” <code>s[i-2] = '('</code></strong> (å½¢å¦‚ <code>...()</code>)</p>
<ul>
<li>è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>s[i-2]</code> å’Œ <code>s[i-1]</code> æ„æˆä¸€å¯¹åŒ¹é…çš„æ‹¬å· <code>&quot;()&quot;</code></li>
<li>å¦‚æœ <code>i-3</code> ä½ç½®ä¹‹å‰ä¹Ÿæœ‰æœ‰æ•ˆæ‹¬å·å­ä¸²ï¼Œéœ€è¦åŠ ä¸Šå®ƒçš„é•¿åº¦</li>
<li>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š<code>dp[i] = dp[i-2] + 2</code></li>
<li>å…¶ä¸­ <code>dp[i-2]</code> æ˜¯ä»¥ <code>s[i-3]</code> ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦</li>
<li><code>+2</code> è¡¨ç¤ºæ–°å¢äº†ä¸€å¯¹åŒ¹é…çš„æ‹¬å·</li>
</ul>
</li>
<li>
<p><strong>æƒ…å†µäºŒï¼š<code>s[i-1] = ')'</code> ä¸” <code>s[i-2] = ')'</code></strong> (å½¢å¦‚ <code>...))</code>)</p>
<ul>
<li>è¿™ç§æƒ…å†µæ›´å¤æ‚ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸ <code>s[i-1]</code> åŒ¹é…çš„å·¦æ‹¬å·</li>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ä»¥ <code>s[i-2]</code> ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦ä¸º <code>dp[i-1]</code></li>
<li>è¿™æ„å‘³ç€å­ä¸² <code>s[(i-1-dp[i-1])...(i-2)]</code> æ˜¯æœ‰æ•ˆçš„</li>
<li>æˆ‘ä»¬éœ€è¦æŸ¥çœ‹è¿™ä¸ªå­ä¸²ä¹‹å‰çš„å­—ç¬¦ <code>s[i-1-dp[i-1]-1]</code>ï¼Œè®°ä¸º <code>s[j]</code></li>
<li>å¦‚æœ <code>s[j] = '('</code>ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ä¸ <code>s[i-1]</code> åŒ¹é…</li>
<li>è¿™æ ·ä¼šå½¢æˆä¸€ä¸ªæ–°çš„æœ‰æ•ˆæ‹¬å·å­ä¸²ï¼Œé•¿åº¦ä¸ºï¼š
<ul>
<li><code>dp[i-1]</code>ï¼šä»¥ <code>s[i-2]</code> ç»“å°¾çš„æœ‰æ•ˆæ‹¬å·é•¿åº¦</li>
<li><code>+2</code>ï¼šæ–°å¢çš„ä¸€å¯¹åŒ¹é…æ‹¬å· <code>s[j]</code> å’Œ <code>s[i-1]</code></li>
<li><code>+dp[j]</code>ï¼šä»¥ <code>s[j-1]</code> ç»“å°¾çš„æœ‰æ•ˆæ‹¬å·é•¿åº¦ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</li>
</ul>
</li>
<li>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š<code>dp[i] = dp[i-1] + 2 + dp[j]</code>ï¼Œå…¶ä¸­ <code>j = i-1-dp[i-1]-1</code></li>
</ul>
</li>
</ol>
<h3 id="æ±‚è§£è¿‡ç¨‹">æ±‚è§£è¿‡ç¨‹</h3>
<ol>
<li>åˆå§‹åŒ– <code>dp</code> æ•°ç»„ï¼Œæ‰€æœ‰å…ƒç´ ä¸º 0</li>
<li>ä»å·¦åˆ°å³éå†å­—ç¬¦ä¸²ï¼Œåªæœ‰å½“ <code>s[i] = ')'</code> æ—¶æ‰å¯èƒ½æ›´æ–° <code>dp[i+1]</code></li>
<li>æ ¹æ®ä¸åŒæƒ…å†µåº”ç”¨çŠ¶æ€è½¬ç§»æ–¹ç¨‹</li>
<li>éå†å®Œæˆåï¼Œ<code>dp</code> æ•°ç»„ä¸­çš„æœ€å¤§å€¼å³ä¸ºç­”æ¡ˆ</li>
</ol>
<h3 id="å›¾è§£çŠ¶æ€è½¬ç§»">å›¾è§£çŠ¶æ€è½¬ç§»</h3>
<p>ä¸¾ä¾‹è¯´æ˜ä¸¤ç§æƒ…å†µçš„çŠ¶æ€è½¬ç§»ï¼š</p>
<p><strong>æƒ…å†µä¸€</strong>ï¼šå½“å‰å­—ç¬¦ä¸å‰ä¸€ä¸ªå­—ç¬¦å½¢æˆ <code>&quot;()&quot;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">s = &quot;......()&quot;</span><br><span class="line">           ^^</span><br><span class="line">        i-2 i-1</span><br><span class="line"></span><br><span class="line">dp[i] = dp[i-2] + 2</span><br></pre></td></tr></table></figure>
<p><strong>æƒ…å†µäºŒ</strong>ï¼šå½“å‰å­—ç¬¦ä¸æ›´å‰é¢çš„å­—ç¬¦å½¢æˆåŒ¹é…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">s = &quot;...(.......)&quot;</span><br><span class="line">        ^       ^</span><br><span class="line">        j       i-1</span><br><span class="line"></span><br><span class="line">å…¶ä¸­ j = i-1-dp[i-1]-1</span><br><span class="line">dp[i] = dp[i-1] + 2 + dp[j]</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œåœ¨æƒ…å†µäºŒä¸­ï¼Œ<code>dp[i-1]</code> è¡¨ç¤ºä»¥ <code>s[i-2]</code> ç»“å°¾çš„æœ‰æ•ˆæ‹¬å·çš„é•¿åº¦ã€‚è¿™ä¸ªæœ‰æ•ˆæ‹¬å·å­ä¸²çš„èµ·å§‹ä½ç½®æ˜¯ <code>i-1-dp[i-1]</code>ï¼Œå› æ­¤ <code>j</code> æ˜¯è¯¥å­ä¸²å‰ä¸€ä¸ªä½ç½®çš„ç´¢å¼•ã€‚</p>
<h2 id="æ”¹è¿›çš„è§£å†³æ–¹æ¡ˆ">æ”¹è¿›çš„è§£å†³æ–¹æ¡ˆ</h2>
<p>æ ¹æ®ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ­£çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ä»¥ä¸‹æ˜¯æ”¹è¿›åçš„ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ­£åçš„æ ¸å¿ƒéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">if</span> s[i<span class="number">-1</span>] == <span class="string">&#x27;)&#x27;</span> &#123;</span><br><span class="line">    j := i - dp[i] - <span class="number">1</span> <span class="comment">// dp[i] æ˜¯ä»¥ s[i-1] ç»“å°¾çš„LVPçš„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span> j &gt;= <span class="number">0</span> &amp;&amp; s[j] == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">        <span class="comment">// ä¿®æ­£ç‚¹ï¼šæ­£ç¡®çš„çŠ¶æ€è½¬ç§»é€»è¾‘</span></span><br><span class="line">        dp[i+<span class="number">1</span>] = dp[i] + <span class="number">2</span> + dp[j]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®Œæ•´çš„ä¿®æ­£ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestValidParentheses</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(s)</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dp[k] è¡¨ç¤ºä»¥ s[k-1] ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·çš„é•¿åº¦</span></span><br><span class="line">    <span class="comment">// ä¸ºäº†æ–¹ä¾¿å¤„ç†è¾¹ç•Œï¼Œdp æ•°ç»„å¤§å°ä¸º n+1ï¼Œdp[0] å§‹ç»ˆä¸º 0</span></span><br><span class="line">    <span class="comment">// å¾ªç¯ä¸­ i ä»£è¡¨å½“å‰å­—ç¬¦ s[i] çš„ç´¢å¼•ï¼Œæ›´æ–°çš„æ˜¯ dp[i+1]</span></span><br><span class="line">    dp := <span class="built_in">make</span>([]<span class="type">int</span>, n+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123; <span class="comment">// éå† s[1] åˆ° s[n-1]</span></span><br><span class="line">        <span class="keyword">if</span> s[i] == <span class="string">&#x27;)&#x27;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> s[i<span class="number">-1</span>] == <span class="string">&#x27;(&#x27;</span> &#123; <span class="comment">// æƒ…å†µ 1: å­—ç¬¦ä¸²å½¢å¦‚ &quot;...()&quot;</span></span><br><span class="line">                <span class="comment">// dp[i-1] æ˜¯ä»¥ s[i-2] ç»“å°¾çš„LVPé•¿åº¦</span></span><br><span class="line">                dp[i+<span class="number">1</span>] = dp[i<span class="number">-1</span>] + <span class="number">2</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// æƒ…å†µ 2: å­—ç¬¦ä¸²å½¢å¦‚ &quot;...))&quot;</span></span><br><span class="line">                <span class="comment">// s[i-1] æ˜¯ &#x27;)&#x27;</span></span><br><span class="line">                <span class="comment">// dp[i] æ˜¯ä»¥ s[i-1] ç»“å°¾çš„LVPé•¿åº¦</span></span><br><span class="line">                <span class="comment">// j æ˜¯ s[i-1] ç»“å°¾çš„LVPå‰ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•</span></span><br><span class="line">                j := i - dp[i] - <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> j &gt;= <span class="number">0</span> &amp;&amp; s[j] == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">                    <span class="comment">// s[j] æ˜¯ &#x27;(&#x27;, s[i] æ˜¯ &#x27;)&#x27;</span></span><br><span class="line">                    <span class="comment">// ä»¥ s[i] ç»“å°¾çš„LVP = (ä»¥ s[i-1] ç»“å°¾çš„LVP) + s[j]...s[i] + (ä»¥ s[j-1] ç»“å°¾çš„LVP)</span></span><br><span class="line">                    <span class="comment">// é•¿åº¦ = dp[i] (s[j+1...i-1]éƒ¨åˆ†) + 2 (s[j]å’Œs[i]) + dp[j] (ä»¥s[j-1]ç»“å°¾çš„LVP)</span></span><br><span class="line">                    dp[i+<span class="number">1</span>] = dp[i] + <span class="number">2</span> + dp[j]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœ s[i] == &#x27;(&#x27;ï¼Œdp[i+1] ä¿æŒä¸º 0ï¼Œå› ä¸ºæœ‰æ•ˆæ‹¬å·å­ä¸²ä¸å¯èƒ½ä»¥ &#x27;(&#x27; ç»“å°¾</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ans := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k := <span class="number">0</span>; k &lt;= n; k++ &#123;</span><br><span class="line">        <span class="keyword">if</span> dp[k] &gt; ans &#123;</span><br><span class="line">            ans = dp[k]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ">ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ</h3>
<p>ä¿®æ­£åçš„è§£æ³•æ­£ç¡®è€ƒè™‘äº†æ‰€æœ‰æƒ…å†µï¼š</p>
<ol>
<li>
<p>å½“å‰å­—ç¬¦ <code>s[i] = ')'</code> ä¸”å‰ä¸€ä¸ªå­—ç¬¦ <code>s[i-1] = '('</code> æ—¶ï¼š</p>
<ul>
<li>ç›´æ¥å½¢æˆä¸€å¯¹æ–°çš„æœ‰æ•ˆæ‹¬å· <code>()</code></li>
<li>åŠ ä¸Šä¹‹å‰å¯èƒ½å·²ç»å½¢æˆçš„æœ‰æ•ˆæ‹¬å·å­ä¸²é•¿åº¦ï¼š<code>dp[i+1] = dp[i-1] + 2</code></li>
</ul>
</li>
<li>
<p>å½“å‰å­—ç¬¦ <code>s[i] = ')'</code> ä¸”å‰ä¸€ä¸ªå­—ç¬¦ <code>s[i-1] = ')'</code> æ—¶ï¼š</p>
<ul>
<li>å‰ä¸€ä¸ªä½ç½®å·²ç»å½¢æˆäº†é•¿åº¦ä¸º <code>dp[i]</code> çš„æœ‰æ•ˆæ‹¬å·å­ä¸²</li>
<li>éœ€è¦æ‰¾åˆ°è¿™ä¸ªå­ä¸²å‰ä¸€ä¸ªä½ç½® <code>j = i - dp[i] - 1</code></li>
<li>å¦‚æœ <code>s[j] = '('</code>ï¼Œåˆ™ <code>s[j]</code> å’Œ <code>s[i]</code> å½¢æˆæ–°çš„åŒ¹é…ï¼ŒåŒæ—¶è¿æ¥äº†ä¸‰éƒ¨åˆ†ï¼š
<ul>
<li>ä»¥ <code>s[j-1]</code> ç»“å°¾çš„æœ‰æ•ˆæ‹¬å·å­ä¸²ï¼š<code>dp[j]</code></li>
<li><code>s[j]</code> å’Œ <code>s[i]</code> å½¢æˆçš„æ–°åŒ¹é…ï¼š<code>+2</code></li>
<li>ä¸­é—´éƒ¨åˆ† <code>s[j+1...i-1]</code> çš„æœ‰æ•ˆæ‹¬å·å­ä¸²ï¼š<code>dp[i]</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬æ­£ç¡®è®¡ç®—äº†ä»¥æ¯ä¸ªä½ç½®ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯å…¶ä¸­çš„æœ€å¤§å€¼ã€‚</p>
<h2 id="å¦ä¸€ç§è§£æ³•ï¼šä½¿ç”¨æ ˆ">å¦ä¸€ç§è§£æ³•ï¼šä½¿ç”¨æ ˆ</h2>
<p>é™¤äº†åŠ¨æ€è§„åˆ’ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ ˆæ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šç”¨æ ˆæ¥åŒ¹é…æ‹¬å·ï¼Œå¹¶è®¡ç®—åŒ¹é…åå½¢æˆçš„æœ‰æ•ˆæ‹¬å·å­ä¸²çš„é•¿åº¦ã€‚</p>
<h3 id="æ ˆæ–¹æ³•çš„ç®—æ³•æ€è·¯">æ ˆæ–¹æ³•çš„ç®—æ³•æ€è·¯</h3>
<ol>
<li>åˆå§‹åŒ–æ ˆï¼Œå…ˆæ”¾å…¥ä¸€ä¸ªå“¨å…µå…ƒç´  <code>-1</code>ï¼ˆç”¨äºå¤„ç†è¾¹ç•Œæƒ…å†µï¼‰</li>
<li>éå†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼š
<ul>
<li>å¦‚æœæ˜¯å·¦æ‹¬å· <code>'('</code>ï¼Œå°†å…¶ç´¢å¼•å…¥æ ˆ</li>
<li>å¦‚æœæ˜¯å³æ‹¬å· <code>')'</code>ï¼š
<ul>
<li>å…ˆå¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼ˆå¯èƒ½æ˜¯å·¦æ‹¬å·çš„ç´¢å¼•æˆ–å‰ä¸€ä¸ªæ— æ³•åŒ¹é…çš„å³æ‹¬å·çš„ç´¢å¼•ï¼‰</li>
<li>å¦‚æœæ­¤æ—¶æ ˆä¸ºç©ºï¼Œå°†å½“å‰å³æ‹¬å·çš„ç´¢å¼•å…¥æ ˆï¼ˆè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ— æ³•åŒ¹é…çš„å³æ‹¬å·ï¼‰</li>
<li>å¦‚æœæ ˆä¸ä¸ºç©ºï¼Œè®¡ç®—å½“å‰ä½ç½®ä¸æ ˆé¡¶å…ƒç´ çš„è·ç¦»ï¼Œæ›´æ–°æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="æ ˆæ–¹æ³•ä»£ç å®ç°">æ ˆæ–¹æ³•ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestValidParenthesesUsingStack</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    maxLen := <span class="number">0</span></span><br><span class="line">    stack := []<span class="type">int</span>&#123;<span class="number">-1</span>&#125; <span class="comment">// æ ˆåº•æ”¾ä¸€ä¸ª-1ä½œä¸ºå“¨å…µï¼Œæ–¹ä¾¿è®¡ç®—é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> s[i] == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">            stack = <span class="built_in">append</span>(stack, i) <span class="comment">// å·¦æ‹¬å·ï¼Œç´¢å¼•å…¥æ ˆ</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// s[i] == &#x27;)&#x27;</span></span><br><span class="line">            stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>] <span class="comment">// å¼¹å‡ºæ ˆé¡¶ï¼Œå¯èƒ½æ˜¯å·¦æ‹¬å·æˆ–å‰ä¸€ä¸ªæ— æ³•åŒ¹é…çš„å³æ‹¬å·</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(stack) == <span class="number">0</span> &#123;</span><br><span class="line">                stack = <span class="built_in">append</span>(stack, i) <span class="comment">// æ ˆä¸ºç©ºï¼Œå½“å‰å³æ‹¬å·æ— æ³•åŒ¹é…ï¼Œå…¥æ ˆä½œä¸ºæ–°çš„èµ·å§‹ç‚¹</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// è®¡ç®—å½“å‰æœ‰æ•ˆå­ä¸²çš„é•¿åº¦ï¼šå½“å‰ä½ç½® - æ ˆé¡¶å…ƒç´ </span></span><br><span class="line">                <span class="comment">// æ ˆé¡¶å…ƒç´ æ˜¯ä¸Šä¸€ä¸ªæ— æ³•åŒ¹é…çš„ä½ç½®ï¼ˆå¯èƒ½æ˜¯å³æ‹¬å·ï¼Œä¹Ÿå¯èƒ½æ˜¯åˆå§‹çš„-1ï¼‰</span></span><br><span class="line">                maxLen = max(maxLen, i - stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> maxLen</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ ˆæ–¹æ³•çš„å·¥ä½œåŸç†ç¤ºä¾‹">æ ˆæ–¹æ³•çš„å·¥ä½œåŸç†ç¤ºä¾‹</h3>
<p>ä»¥è¾“å…¥ <code>&quot;)()())&quot;</code> ä¸ºä¾‹ï¼Œæˆ‘ä»¬è·Ÿè¸ªæ ˆçš„å˜åŒ–ï¼š</p>
<ol>
<li>åˆå§‹åŒ–ï¼šstack = [-1]</li>
<li>å¤„ç† <code>s[0] = ')'</code>:
<ul>
<li>å¼¹å‡º -1ï¼Œæ ˆä¸ºç©º</li>
<li>å°† 0 å…¥æ ˆï¼šstack = [0]</li>
</ul>
</li>
<li>å¤„ç† <code>s[1] = '('</code>:
<ul>
<li>å°† 1 å…¥æ ˆï¼šstack = [0, 1]</li>
</ul>
</li>
<li>å¤„ç† <code>s[2] = ')'</code>:
<ul>
<li>å¼¹å‡º 1ï¼Œæ ˆä¸ä¸ºç©º</li>
<li>è®¡ç®—é•¿åº¦ï¼š2 - 0 = 2ï¼Œæ›´æ–° maxLen = 2</li>
<li>å½“å‰æ ˆï¼šstack = [0]</li>
</ul>
</li>
<li>å¤„ç† <code>s[3] = '('</code>:
<ul>
<li>å°† 3 å…¥æ ˆï¼šstack = [0, 3]</li>
</ul>
</li>
<li>å¤„ç† <code>s[4] = ')'</code>:
<ul>
<li>å¼¹å‡º 3ï¼Œæ ˆä¸ä¸ºç©º</li>
<li>è®¡ç®—é•¿åº¦ï¼š4 - 0 = 4ï¼Œæ›´æ–° maxLen = 4</li>
<li>å½“å‰æ ˆï¼šstack = [0]</li>
</ul>
</li>
<li>å¤„ç† <code>s[5] = ')'</code>:
<ul>
<li>å¼¹å‡º 0ï¼Œæ ˆä¸ºç©º</li>
<li>å°† 5 å…¥æ ˆï¼šstack = [5]</li>
</ul>
</li>
</ol>
<p>æœ€ç»ˆ maxLen = 4ï¼Œè¿™æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚</p>
<h3 id="ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒ">ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒ</h3>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>åŠ¨æ€è§„åˆ’</th>
<th>æ ˆæ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>å®ç°éš¾åº¦</td>
<td>ä¸­ç­‰ï¼ˆçŠ¶æ€è½¬ç§»éœ€è¦ä»”ç»†æ¨å¯¼ï¼‰</td>
<td>ç®€å•ï¼ˆæ‹¬å·åŒ¹é…çš„å…¸å‹åº”ç”¨ï¼‰</td>
</tr>
<tr>
<td>æ€è·¯ç†è§£</td>
<td>éœ€è¦ç†è§£çŠ¶æ€å®šä¹‰å’ŒçŠ¶æ€è½¬ç§»</td>
<td>ç›´è§‚ï¼ŒåŸºäºæ‹¬å·åŒ¹é…</td>
</tr>
<tr>
<td>ä»£ç é‡</td>
<td>ä¸­ç­‰</td>
<td>è¾ƒå°‘</td>
</tr>
<tr>
<td>é€‚ç”¨æ€§</td>
<td>ç±»ä¼¼çš„å­ä¸²é—®é¢˜</td>
<td>æ‹¬å·ç›¸å…³é—®é¢˜</td>
</tr>
</tbody>
</table>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>é€šè¿‡åˆ†æè¿™ä¸ªé”™è¯¯ï¼Œæˆ‘å­¦åˆ°äº†ä»¥ä¸‹é‡è¦æ•™è®­ï¼š</p>
<ol>
<li>
<p><strong>çŠ¶æ€å®šä¹‰çš„ç²¾ç¡®ç†è§£</strong>ï¼šåœ¨åŠ¨æ€è§„åˆ’ä¸­ï¼Œå‡†ç¡®ç†è§£çŠ¶æ€çš„å®šä¹‰è‡³å…³é‡è¦ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œ<code>dp[k]</code> è¡¨ç¤ºä»¥ <code>s[k-1]</code> ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·é•¿åº¦ï¼Œéœ€è¦æ¸…æ™°ç†è§£è¿™ä¸ªå®šä¹‰ã€‚</p>
</li>
<li>
<p><strong>å®Œæ•´çš„çŠ¶æ€è½¬ç§»åˆ†æ</strong>ï¼šåœ¨æ¨å¯¼çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ—¶ï¼Œå¿…é¡»è€ƒè™‘æ‰€æœ‰å¯èƒ½çš„ç»„æˆéƒ¨åˆ†ã€‚å¯¹äºæ‹¬å·åŒ¹é…è¿™ç±»é—®é¢˜ï¼Œæ–°å½¢æˆçš„æœ‰æ•ˆæ‹¬å·å­ä¸²å¯èƒ½ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œéœ€è¦å…¨é¢åˆ†æå„éƒ¨åˆ†çš„è´¡çŒ®ã€‚</p>
</li>
<li>
<p><strong>ç»†å¿ƒå¤„ç†ç´¢å¼•å’Œè¾¹ç•Œæ¡ä»¶</strong>ï¼šåŠ¨æ€è§„åˆ’ä¸­çš„ç´¢å¼•å¤„ç†å°¤ä¸ºé‡è¦ï¼Œç‰¹åˆ«æ˜¯å½“çŠ¶æ€æ•°ç»„å’ŒåŸå§‹æ•°æ®çš„ç´¢å¼•æœ‰åç§»æ—¶ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œ<code>dp[i+1]</code> å¯¹åº” <code>s[i]</code>ï¼Œè¿™ç§å¯¹åº”å…³ç³»éœ€è¦æ—¶åˆ»ç‰¢è®°ã€‚</p>
</li>
<li>
<p><strong>å¯è§†åŒ–è¾…åŠ©ç†è§£</strong>ï¼šå¯¹äºå¤æ‚çš„çŠ¶æ€è½¬ç§»ï¼Œå¯ä»¥é€šè¿‡ç”»å›¾æˆ–å…·ä½“ç¤ºä¾‹æ¥éªŒè¯æ€è·¯ã€‚ä¾‹å¦‚ï¼Œå¯¹äº <code>...))</code> æ¨¡å¼ï¼Œå¯ä»¥ç”»å‡ºä¸åŒæƒ…å†µä¸‹çš„æ‹¬å·ç»„åˆå’Œå¯¹åº”çš„ dp å€¼æ˜¯å¦‚ä½•ç´¯åŠ çš„ã€‚</p>
</li>
<li>
<p><strong>å¤šç§è§£æ³•å¯¹æ¯”å­¦ä¹ </strong>ï¼šåŒä¸€ä¸ªé—®é¢˜å¾€å¾€æœ‰å¤šç§è§£æ³•ã€‚åŠ¨æ€è§„åˆ’å’Œæ ˆæ–¹æ³•å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œé€šè¿‡å¯¹æ¯”å­¦ä¹ ï¼Œå¯ä»¥åŠ æ·±å¯¹é—®é¢˜çš„ç†è§£ï¼Œä¹Ÿæœ‰åŠ©äºåœ¨å®é™…åº”ç”¨ä¸­é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ³•ã€‚</p>
</li>
<li>
<p><strong>æµ‹è¯•å…³é”®ç”¨ä¾‹</strong>ï¼šé’ˆå¯¹ç‰¹å®šçš„çŠ¶æ€è½¬ç§»é€»è¾‘ï¼Œæ„é€ å…³é”®æµ‹è¯•ç”¨ä¾‹è¿›è¡ŒéªŒè¯éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œåº”è¯¥ç‰¹åˆ«æµ‹è¯•åŒ…å« <code>...))</code>ã€<code>...()</code> ç­‰æ¨¡å¼çš„å­—ç¬¦ä¸²ã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªé”™è¯¯æé†’æˆ‘ï¼Œåœ¨åŠ¨æ€è§„åˆ’é—®é¢˜ä¸­ï¼Œå³ä½¿å¤§æ–¹å‘æ­£ç¡®ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸­çš„ä¸€ä¸ªå°ç»†èŠ‚åå·®ä¹Ÿå¯èƒ½å¯¼è‡´å®Œå…¨é”™è¯¯çš„ç»“æœã€‚ç»†å¿ƒæ¨å¯¼å’ŒéªŒè¯æ¯ä¸€ç§æƒ…å†µæ˜¯è§£å†³å¤æ‚åŠ¨æ€è§„åˆ’é—®é¢˜çš„å…³é”®ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>Go</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>å­—èŠ‚é¢è¯•ï¼šåŠ äº†ä»€ä¹ˆé”ï¼Œå¯¼è‡´æ­»é”ï¼Ÿ</title>
    <url>/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95-%E5%8A%A0%E4%BA%86%E4%BB%80%E4%B9%88%E9%94%81%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81/</url>
    <content><![CDATA[<h1>å­—èŠ‚é¢è¯•ï¼šåŠ äº†ä»€ä¹ˆé”ï¼Œå¯¼è‡´æ­»é”çš„ï¼Ÿ</h1>
<p>è¿™æ˜¯ä¸€ä¸ªæ¥è‡ªå­—èŠ‚è·³åŠ¨é¢è¯•çš„ç»å…¸ MySQL é—®é¢˜ã€‚é¢è¯•å®˜å¯èƒ½ä¼šè¿™æ ·æé—®ï¼šâ€œåœ¨<strong>å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰éš”ç¦»çº§åˆ«</strong>ä¸‹ï¼Œä»¥ä¸‹åœºæ™¯ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿâ€</p>
<p>é¢è¯•é¢˜ä¸­æ¶‰åŠä¸€ä¸ªåä¸º <code>students</code> çš„è¡¨ï¼Œå…¶ç»“æ„åŒ…å« <code>id</code> (ä¸»é”®), <code>no</code>, <code>name</code>, <code>age</code>, <code>score</code> å­—æ®µã€‚ä¸ºäº†ä¾¿äºå®éªŒå’Œåˆ†æï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°†ä½¿ç”¨ä¸€ä¸ªç»“æ„ç›¸åŒä½†è¡¨åä¸º <code>t_student</code> çš„è¡¨ã€‚<br>
<code>students</code> (å³æˆ‘ä»¬å®éªŒä¸­çš„ <code>t_student</code>) è¡¨çš„åˆå§‹æ•°æ®å¤§è‡´å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>no</th>
<th>name</th>
<th>age</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>15</td>
<td>S0001</td>
<td>Bob</td>
<td>25</td>
<td>34</td>
</tr>
<tr>
<td>18</td>
<td>S0002</td>
<td>Alice</td>
<td>24</td>
<td>77</td>
</tr>
<tr>
<td>20</td>
<td>S0003</td>
<td>Jim</td>
<td>24</td>
<td>5</td>
</tr>
<tr>
<td>30</td>
<td>S0004</td>
<td>Eric</td>
<td>23</td>
<td>91</td>
</tr>
<tr>
<td>37</td>
<td>S0005</td>
<td>Tom</td>
<td>22</td>
<td>22</td>
</tr>
<tr>
<td>49</td>
<td>S0006</td>
<td>Tom</td>
<td>25</td>
<td>83</td>
</tr>
<tr>
<td>50</td>
<td>S0007</td>
<td>Rose</td>
<td>23</td>
<td>89</td>
</tr>
</tbody>
</table>
<p>åœ¨æ­¤åœºæ™¯ä¸­ï¼Œæœ‰ä¸¤ä¸ªå¹¶å‘äº‹åŠ¡æ­£åœ¨æ‰§è¡Œï¼š</p>
<ul>
<li><strong>äº‹åŠ¡ A</strong> æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
<ol>
<li><code>time1</code>: <code>UPDATE students SET score=100 WHERE id=25;</code></li>
<li><code>time3</code>: <code>INSERT INTO students(id, no, name, age, score) VALUES (25, 's0025', 'sony', 28, 90);</code></li>
</ol>
</li>
<li><strong>äº‹åŠ¡ B</strong> æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
<ol>
<li><code>time2</code>: <code>UPDATE students SET score=100 WHERE id=26;</code></li>
<li><code>time4</code>: <code>INSERT INTO students(id, no, name, age, score) VALUES (26, 's0026', 'ace', 28, 90);</code></li>
</ol>
</li>
</ul>
<p>å¦‚æœå¯¹ MySQL åŠ é”æœºåˆ¶æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¯èƒ½ä¸€çœ¼å°±èƒ½çœ‹å‡ºè¿™ä¸ªåœºæ™¯ä¸‹<strong>ä¼šå‘ç”Ÿæ­»é”</strong>ã€‚ä½†æ›´è¿›ä¸€æ­¥çš„é—®é¢˜æ˜¯ï¼šå…·ä½“æ˜¯åŠ äº†ä»€ä¹ˆé”ï¼Ÿè¿™äº›é”ä¹‹é—´æ˜¯å¦‚ä½•ç›¸äº’ä½œç”¨æœ€ç»ˆå¯¼è‡´æ­»é”çš„ï¼Ÿ</p>
<p>æ¥ä¸‹æ¥ï¼Œæœ¬æ–‡å°†è¯¦ç»†åˆ†æä¸Šè¿°ä¸¤ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œ SQL è¯­å¥çš„è¿‡ç¨‹ä¸­ï¼Œåˆ†åˆ«è·å–äº†å“ªäº›é”ï¼Œä»¥åŠè¿™äº›é”æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥å¯¼è‡´æ­»é”çš„ã€‚</p>
<h2 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h2>
<p>å…ˆåˆ›å»ºä¸€å¼  t_student è¡¨ï¼Œå‡è®¾é™¤äº† id å­—æ®µï¼Œå…¶ä»–å­—æ®µéƒ½æ˜¯æ™®é€šå­—æ®µã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `t_student` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `<span class="keyword">no</span>` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `score` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæ’å…¥ç›¸å…³çš„æ•°æ®åï¼Œt_student è¡¨ä¸­çš„è®°å½•å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>no</th>
<th>name</th>
<th>age</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>15</td>
<td>S0001</td>
<td>Bob</td>
<td>25</td>
<td>34</td>
</tr>
<tr>
<td>18</td>
<td>S0002</td>
<td>Alice</td>
<td>24</td>
<td>77</td>
</tr>
<tr>
<td>20</td>
<td>S0003</td>
<td>Jim</td>
<td>24</td>
<td>5</td>
</tr>
<tr>
<td>30</td>
<td>S0004</td>
<td>Eric</td>
<td>23</td>
<td>91</td>
</tr>
<tr>
<td>37</td>
<td>S0005</td>
<td>Tom</td>
<td>22</td>
<td>22</td>
</tr>
<tr>
<td>49</td>
<td>S0006</td>
<td>Tom</td>
<td>25</td>
<td>83</td>
</tr>
<tr>
<td>50</td>
<td>S0007</td>
<td>Rose</td>
<td>23</td>
<td>89</td>
</tr>
</tbody>
</table>
<h2 id="å¼€å§‹å®éªŒ">å¼€å§‹å®éªŒ</h2>
<p>åœ¨å®éªŒå¼€å§‹å‰ï¼Œå…ˆè¯´æ˜ä¸‹å®éªŒç¯å¢ƒï¼š</p>
<ul>
<li>MySQL ç‰ˆæœ¬ï¼š8.0.26</li>
<li>éš”ç¦»çº§åˆ«ï¼šå¯é‡å¤è¯»ï¼ˆRRï¼‰</li>
</ul>
<p>å¯åŠ¨ä¸¤ä¸ªäº‹åŠ¡ï¼ŒæŒ‰ç…§é¢˜ç›®çš„ SQL æ‰§è¡Œé¡ºåºï¼Œè¿‡ç¨‹å¦‚ä¸‹è¡¨æ ¼ï¼š</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95-%E5%8A%A0%E4%BA%86%E4%BB%80%E4%B9%88%E9%94%81%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81/1747568234814.png" alt="1747568234814"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡ A å’Œ äº‹åŠ¡ B éƒ½åœ¨æ‰§è¡Œ insert è¯­å¥åï¼Œéƒ½é™·å…¥äº†ç­‰å¾…çŠ¶æ€ï¼ˆå‰ææ²¡æœ‰æ‰“å¼€æ­»é”æ£€æµ‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿäº†æ­»é”ï¼Œå› ä¸ºéƒ½åœ¨ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ã€‚ï¼ˆæ³¨æ„ï¼šåœ¨ MySQL é»˜è®¤é…ç½®ä¸‹ï¼Œæ­»é”æ£€æµ‹æ˜¯å¼€å¯çš„ã€‚å¦‚æœå¼€å¯ï¼Œå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡ï¼ˆé€šå¸¸æ˜¯æŒæœ‰é”è¾ƒå°‘æˆ–å›æ»šä»£ä»·è¾ƒå°çš„é‚£ä¸ªï¼‰ä¼šè¢«é€‰ä¸­ä½œä¸ºç‰ºç‰²è€…å¹¶å›æ»šï¼ŒåŒæ—¶å‘å®¢æˆ·ç«¯è¿”å›æ­»é”é”™è¯¯ï¼Œä¾‹å¦‚ <code>ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</code>ã€‚æœ¬æ–‡æè¿°ä¸¤ä¸ªäº‹åŠ¡éƒ½é™·å…¥ç­‰å¾…æ˜¯ä¸ºäº†æ¸…æ™°å±•ç¤ºæ­»é”å½¢æˆçš„å®Œæ•´è¿‡ç¨‹ã€‚ï¼‰</p>
<h2 id="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæ­»é”ï¼Ÿ">ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæ­»é”ï¼Ÿ</h2>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> è¿™æ¡è¯­å¥ï¼ŒæŸ¥çœ‹äº‹åŠ¡æ‰§è¡Œ SQL è¿‡ç¨‹ä¸­åŠ äº†ä»€ä¹ˆé”ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œé’ˆå¯¹æ¯ä¸€æ¡ SQL è¯­å¥åˆ†æå…·ä½“åŠ äº†ä»€ä¹ˆé”ã€‚</p>
<h3 id="Time-1-é˜¶æ®µåŠ é”åˆ†æ">Time 1 é˜¶æ®µåŠ é”åˆ†æ</h3>
<p>Time 1 é˜¶æ®µï¼Œäº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ A</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">update</span> t_student <span class="keyword">set</span> score <span class="operator">=</span> <span class="number">100</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">0</span>  Changed: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæ‰§è¡Œ <code>select * from performance_schema.data_locks\G;</code> è¿™æ¡è¯­å¥ï¼ŒæŸ¥çœ‹äº‹åŠ¡ A æ­¤æ—¶åŠ äº†ä»€ä¹ˆé”ã€‚</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95-%E5%8A%A0%E4%BA%86%E4%BB%80%E4%B9%88%E9%94%81%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81/1747568246886.png" alt="1747568246886"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå…±åŠ äº†ä¸¤ä¸ªé”ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>è¡¨çº§é”ï¼šä¸€ä¸ª X ç±»å‹çš„æ„å‘é” (IX lock)ã€‚è¿™æ˜¯å› ä¸ºäº‹åŠ¡éœ€è¦åœ¨è¡¨ä¸­çš„è¡Œä¸ŠåŠ  X é”ï¼ˆæ— è®ºæ˜¯è®°å½•é”è¿˜æ˜¯é—´éš™é”ï¼‰ï¼Œæ‰€ä»¥å…ˆåœ¨è¡¨ä¸ŠåŠ  IX é”ã€‚</li>
<li>è¡Œçº§é”ï¼šä¸€ä¸ª X ç±»å‹çš„é—´éš™é” (Gap Lock)ï¼›</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨è¡Œé”ï¼Œå›¾ä¸­ LOCK_TYPE ä¸­çš„ RECORD è¡¨ç¤ºè¡Œçº§é”ï¼Œè€Œä¸æ˜¯è®°å½•é”çš„æ„æ€ï¼Œé€šè¿‡ LOCK_MODE å¯ä»¥ç¡®è®¤æ˜¯ next-key é”ï¼Œè¿˜æ˜¯é—´éš™é”ï¼Œè¿˜æ˜¯è®°å½•é”ï¼š</p>
<ul>
<li>å¦‚æœ LOCK_MODE ä¸º <code>X</code>ï¼Œè¯´æ˜æ˜¯ next-key é”ï¼›</li>
<li>å¦‚æœ LOCK_MODE ä¸º <code>X, REC_NOT_GAP</code>ï¼Œè¯´æ˜æ˜¯è®°å½•é”ï¼›</li>
<li>å¦‚æœ LOCK_MODE ä¸º <code>X, GAP</code>ï¼Œè¯´æ˜æ˜¯é—´éš™é”ï¼›</li>
</ul>
<p><strong>å› æ­¤ï¼Œæ­¤æ—¶äº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ï¼ˆINDEX_NAME : PRIMARYï¼‰ä¸ŠåŠ çš„æ˜¯ X å‹é—´éš™é”ï¼Œé”èŒƒå›´æ˜¯<code>(20, 30)</code></strong>ã€‚</p>
<blockquote>
<p>é—´éš™é”çš„èŒƒå›´<code>(20, 30)</code> ï¼Œæ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Ÿ</p>
</blockquote>
<p>å½“ <code>UPDATE</code> è¯­å¥çš„ <code>WHERE</code> æ¡ä»¶ï¼ˆå¦‚ <code>id = 25</code>ï¼‰æ²¡æœ‰å‘½ä¸­ä»»ä½•ç°æœ‰è®°å½•æ—¶ï¼Œåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDB ä¼šä¸ºäº†é˜²æ­¢å¹»è¯»è€ŒåŠ ä¸Šé—´éš™é”ã€‚<br>
è¯¥é—´éš™é”çš„èŒƒå›´ç¡®å®šæ–¹å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>LOCK_DATA</code> (åœ¨æ­¤ä¾‹ä¸­ä¸º <code>30</code>) é€šå¸¸è¡¨ç¤ºè¯¥é—´éš™é”èŒƒå›´çš„å³è¾¹ç•Œï¼ˆä¸åŒ…å«ï¼‰ã€‚è¿™æ˜¯å› ä¸º <code>id=30</code> æ˜¯ä¸»é”®ç´¢å¼•ä¸­å¤§äº <code>25</code> çš„ç¬¬ä¸€æ¡è®°å½•ã€‚</li>
<li>é—´éš™é”èŒƒå›´çš„å·¦è¾¹ç•Œï¼ˆä¸åŒ…å«ï¼‰åˆ™æ˜¯ä¸»é”®ç´¢å¼•ä¸­å°äº <code>25</code> çš„æœ€å¤§ä¸€æ¡è®°å½•çš„ <code>id</code> å€¼ï¼Œå³ <code>20</code>ã€‚<br>
æ‰€ä»¥ï¼Œå½¢æˆçš„é—´éš™ä¸º <code>(20, 30)</code>ã€‚è¿™ä¸ªé”ç¡®ä¿äº†åœ¨ <code>id</code> å€¼ä¸º 20 å’Œ 30 ä¹‹é—´çš„è¿™ä¸ªåŒºé—´ï¼Œæ²¡æœ‰æ–°çš„è®°å½•å¯ä»¥è¢«æ’å…¥ï¼Œä»è€Œä¿è¯äº†äº‹åŠ¡ A çš„å¯é‡å¤è¯»ã€‚</li>
</ul>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95-%E5%8A%A0%E4%BA%86%E4%BB%80%E4%B9%88%E9%94%81%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81/1748172465154.png" alt="1748172465154"></p>
<p>å› æ­¤ï¼Œé—´éš™é”çš„èŒƒå›´æ˜¯ <code>(20, 30)</code>ã€‚</p>
<h3 id="Time-2-é˜¶æ®µåŠ é”åˆ†æ">Time 2 é˜¶æ®µåŠ é”åˆ†æ</h3>
<p>Time 2 é˜¶æ®µï¼Œäº‹åŠ¡ B æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ B</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">update</span> t_student <span class="keyword">set</span> score <span class="operator">=</span> <span class="number">100</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">26</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">0</span>  Changed: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæ‰§è¡Œ <code>select * from performance_schema.data_locks\G;</code> è¿™æ¡è¯­å¥ï¼ŒæŸ¥çœ‹äº‹åŠ¡ B æ­¤æ—¶åŠ äº†ä»€ä¹ˆé”ã€‚</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95-%E5%8A%A0%E4%BA%86%E4%BB%80%E4%B9%88%E9%94%81%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81/1747568314475.png" alt="1747568314475"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¡Œé”æ˜¯ X ç±»å‹çš„é—´éš™é”ï¼Œé—´éš™é”çš„èŒƒå›´æ˜¯<code>(20, 30)</code>ã€‚</p>
<blockquote>
<p>äº‹åŠ¡ A å’Œ äº‹åŠ¡ B çš„é—´éš™é”èŒƒå›´éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆä¸ä¼šå†²çªï¼Ÿ</p>
</blockquote>
<p>ä¸¤ä¸ªäº‹åŠ¡çš„é—´éš™é”ä¹‹é—´æ˜¯ç›¸äº’å…¼å®¹çš„ï¼Œä¸ä¼šäº§ç”Ÿå†²çªã€‚</p>
<p>åœ¨ MySQL å®˜ç½‘ä¸Šè¿˜æœ‰ä¸€æ®µéå¸¸å…³é”®çš„æè¿°ï¼š</p>
<p><em>Gap locks in InnoDB are â€œpurely inhibitiveâ€, which means that their only purpose is to prevent other transactions from Inserting to the gap. Gap locks can co-exist. A gap lock taken by one transaction does not prevent another transaction from taking a gap lock on the same gap. There is no difference between shared and exclusive gap locks. They do not conflict with each other, and they perform the same function.</em></p>
<p><strong>é—´éš™é”çš„æ„ä¹‰åªåœ¨äºé˜»æ­¢åŒºé—´è¢«æ’å…¥</strong>ï¼Œå› æ­¤æ˜¯å¯ä»¥å…±å­˜çš„ã€‚<strong>ä¸€ä¸ªäº‹åŠ¡è·å–çš„é—´éš™é”ä¸ä¼šé˜»æ­¢å¦ä¸€ä¸ªäº‹åŠ¡è·å–åŒä¸€ä¸ªé—´éš™èŒƒå›´çš„é—´éš™é”</strong>ï¼Œå…±äº«ï¼ˆS å‹ï¼‰å’Œæ’ä»–ï¼ˆX å‹ï¼‰çš„é—´éš™é”æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä»–ä»¬ç›¸äº’ä¸å†²çªï¼Œä¸”åŠŸèƒ½ç›¸åŒã€‚</p>
<h3 id="Time-3-é˜¶æ®µåŠ é”åˆ†æ">Time 3 é˜¶æ®µåŠ é”åˆ†æ</h3>
<p>Time 3ï¼Œäº‹åŠ¡ A æ’å…¥äº†ä¸€æ¡è®°å½•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># <span class="type">Time</span> <span class="number">3</span> é˜¶æ®µï¼Œäº‹åŠ¡ A æ’å…¥äº†ä¸€æ¡è®°å½•</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert into</span> t_student(id, <span class="keyword">no</span>, name, age,score) <span class="keyword">value</span> (<span class="number">25</span>, <span class="string">&#x27;S0025&#x27;</span>, <span class="string">&#x27;sony&#x27;</span>, <span class="number">28</span>, <span class="number">90</span>);</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span><span class="operator">/</span> é˜»å¡ç­‰å¾…......</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œäº‹åŠ¡ A å°±é™·å…¥äº†ç­‰å¾…çŠ¶æ€ã€‚</p>
<p>ç„¶åæ‰§è¡Œ <code>select * from performance_schema.data_locks\G;</code> è¿™æ¡è¯­å¥ï¼ŒæŸ¥çœ‹äº‹åŠ¡ A åœ¨è·å–ä»€ä¹ˆé”è€Œå¯¼è‡´è¢«é˜»å¡ã€‚</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95-%E5%8A%A0%E4%BA%86%E4%BB%80%E4%B9%88%E9%94%81%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81/1747568326650.png" alt="1747568326650"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡ A çš„çŠ¶æ€ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆLOCK_STATUS: WAITINGï¼‰ã€‚è¿™æ˜¯å› ä¸ºå®ƒè¯•å›¾åœ¨ <code>id=25</code> çš„ä½ç½®æ’å…¥è®°å½•ï¼Œè¯¥ä½ç½®ä½äºäº‹åŠ¡ B æŒæœ‰çš„é—´éš™é” <code>(20, 30)</code> èŒƒå›´å†…ã€‚ä¸ºäº†æ‰§è¡Œæ’å…¥ï¼Œäº‹åŠ¡ A éœ€è¦è·å–ä¸€ä¸ªæ’å…¥æ„å‘é”ã€‚ç„¶è€Œï¼Œ<strong>æ’å…¥æ„å‘é”ä¸å¦ä¸€ä¸ªäº‹åŠ¡æŒæœ‰çš„é—´éš™é”æ˜¯å†²çªçš„</strong>ã€‚å› æ­¤ï¼Œäº‹åŠ¡ A çš„æ’å…¥æ“ä½œè¢«é˜»å¡ï¼Œç­‰å¾…äº‹åŠ¡ B é‡Šæ”¾å…¶åœ¨ <code>(20, 30)</code> ä¸Šçš„é—´éš™é”ã€‚æ­¤æ—¶ï¼Œäº‹åŠ¡ A è‡ªèº«ä¹ŸæŒæœ‰ <code>(20,30)</code> çš„é—´éš™é”ã€‚</p>
<blockquote>
<p>æ’å…¥æ„å‘é”æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>æ³¨æ„ï¼æ’å…¥æ„å‘é”åå­—é‡Œè™½ç„¶æœ‰æ„å‘é”è¿™ä¸‰ä¸ªå­—ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯æ„å‘é”ï¼Œå®ƒå±äºè¡Œçº§é”ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ã€‚</p>
<p>åœ¨ MySQL çš„å®˜æ–¹æ–‡æ¡£ä¸­æœ‰ä»¥ä¸‹é‡è¦æè¿°ï¼š</p>
<p><em>An Insert intention lock is a type of gap lock set by Insert operations prior to row Insertion. This lock signals the intent to Insert in such a way that multiple transactions Inserting into the same index gap need not wait for each other if they are not Inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to Insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with Insert intention locks prior to obtaining the exclusive lock on the Inserted row, but do not block each other because the rows are nonconflicting.</em></p>
<p>è¿™æ®µè¯è¡¨æ˜å°½ç®¡<strong>æ’å…¥æ„å‘é”æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œä½†ä¸åŒäºé—´éš™é”çš„æ˜¯ï¼Œè¯¥é”åªç”¨äºå¹¶å‘æ’å…¥æ“ä½œ</strong>ã€‚</p>
<p>å¦‚æœè¯´é—´éš™é”é”ä½çš„æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œé‚£ä¹ˆã€Œæ’å…¥æ„å‘é”ã€é”ä½çš„å°±æ˜¯ä¸€ä¸ªç‚¹ã€‚å› è€Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œæ’å…¥æ„å‘é”ç¡®å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ã€‚</p>
<p>æ’å…¥æ„å‘é”ä¸é—´éš™é”çš„å¦ä¸€ä¸ªéå¸¸é‡è¦çš„å·®åˆ«æ˜¯ï¼š<strong>å°½ç®¡ã€Œæ’å…¥æ„å‘é”ã€ä¹Ÿå±äºé—´éš™é”ï¼Œä½†ä¸¤ä¸ªäº‹åŠ¡å´ä¸èƒ½åœ¨åŒä¸€æ—¶é—´å†…ï¼Œä¸€ä¸ªæ‹¥æœ‰é—´éš™é”ï¼Œå¦ä¸€ä¸ªæ‹¥æœ‰è¯¥é—´éš™åŒºé—´å†…çš„æ’å…¥æ„å‘é”ï¼ˆå½“ç„¶ï¼Œæ’å…¥æ„å‘é”å¦‚æœä¸åœ¨é—´éš™é”åŒºé—´å†…åˆ™æ˜¯å¯ä»¥çš„ï¼‰ã€‚æ‰€ä»¥ï¼Œæ’å…¥æ„å‘é”å’Œé—´éš™é”ä¹‹é—´æ˜¯å†²çªçš„</strong>ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘è¡¥å……ä¸€ç‚¹ï¼Œæ’å…¥æ„å‘é”çš„ç”Ÿæˆæ—¶æœºï¼š</p>
<ul>
<li>æ¯æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½éœ€è¦çœ‹ä¸€ä¸‹å¾…æ’å…¥è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•ä¸Šæ˜¯å¦å·²ç»è¢«åŠ äº†é—´éš™é”ï¼Œå¦‚æœå·²åŠ é—´éš™é”ï¼Œæ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç„¶åé”çš„çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆ<em>PSï¼šMySQL åŠ é”æ—¶ï¼Œæ˜¯å…ˆç”Ÿæˆé”ç»“æ„ï¼Œç„¶åè®¾ç½®é”çš„çŠ¶æ€ï¼Œå¦‚æœé”çŠ¶æ€æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”ï¼Œåªæœ‰å½“é”çŠ¶æ€ä¸ºæ­£å¸¸çŠ¶æ€æ—¶ï¼Œæ‰ä»£è¡¨äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”</em>ï¼‰ï¼Œç°è±¡å°±æ˜¯ Insert è¯­å¥ä¼šè¢«é˜»å¡ã€‚</li>
</ul>
<h3 id="Time-4-é˜¶æ®µåŠ é”åˆ†æ">Time 4 é˜¶æ®µåŠ é”åˆ†æ</h3>
<p>Time 4ï¼Œäº‹åŠ¡ B æ’å…¥äº†ä¸€æ¡è®°å½•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># <span class="type">Time</span> <span class="number">4</span> é˜¶æ®µï¼Œäº‹åŠ¡ B æ’å…¥äº†ä¸€æ¡è®°å½•</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert into</span> t_student(id, <span class="keyword">no</span>, name, age,score) <span class="keyword">value</span> (<span class="number">26</span>, <span class="string">&#x27;S0026&#x27;</span>, <span class="string">&#x27;ace&#x27;</span>, <span class="number">28</span>, <span class="number">90</span>);</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span><span class="operator">/</span> é˜»å¡ç­‰å¾…......</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œäº‹åŠ¡ B å°±é™·å…¥äº†ç­‰å¾…çŠ¶æ€ã€‚</p>
<p>ç„¶åæ‰§è¡Œ <code>select * from performance_schema.data_locks\G;</code> è¿™æ¡è¯­å¥ï¼ŒæŸ¥çœ‹äº‹åŠ¡ B åœ¨è·å–ä»€ä¹ˆé”è€Œå¯¼è‡´è¢«é˜»å¡ã€‚</p>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95-%E5%8A%A0%E4%BA%86%E4%BB%80%E4%B9%88%E9%94%81%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81/1747568340862.png" alt="1747568340862"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡ B ä¹Ÿå› å°è¯•è·å–æ’å…¥æ„å‘é”è€Œè¢«é˜»å¡ï¼ˆLOCK_STATUS: WAITINGï¼‰ã€‚äº‹åŠ¡ B è¯•å›¾åœ¨ <code>id=26</code> çš„ä½ç½®æ’å…¥è®°å½•ï¼Œè¯¥ä½ç½®åŒæ ·ä½äºäº‹åŠ¡ A æŒæœ‰çš„é—´éš™é” <code>(20, 30)</code> èŒƒå›´å†…ã€‚ä¸äº‹åŠ¡ A çš„æƒ…å†µç±»ä¼¼ï¼Œäº‹åŠ¡ B çš„æ’å…¥æ“ä½œéœ€è¦è·å–æ’å…¥æ„å‘é”ï¼Œè€Œè¿™ä¸ªé”ä¸äº‹åŠ¡ A æŒæœ‰çš„é—´éš™é” <code>(20, 30)</code> å†²çªã€‚å› æ­¤ï¼Œäº‹åŠ¡ B ç­‰å¾…äº‹åŠ¡ A é‡Šæ”¾å…¶é—´éš™é”ã€‚</p>
<blockquote>
<p>æœ€åå›ç­”ï¼Œä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæ­»é”ï¼Ÿ</p>
</blockquote>
<p>æ­»é”çš„å‘ç”Ÿæ˜¯å› ä¸ºä¸¤ä¸ªäº‹åŠ¡å½¢æˆäº†å¾ªç¯ç­‰å¾…èµ„æºã€‚å…·ä½“åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>åˆå§‹çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡ A æ‰§è¡Œ <code>UPDATE ... WHERE id = 25</code>ï¼Œæœªæ‰¾åˆ°è®°å½•ï¼Œè·å¾—äº†é—´éš™é” G_A å¯¹ <code>(20, 30)</code>ã€‚</li>
<li>äº‹åŠ¡ B æ‰§è¡Œ <code>UPDATE ... WHERE id = 26</code>ï¼Œæœªæ‰¾åˆ°è®°å½•ï¼Œè·å¾—äº†é—´éš™é” G_B å¯¹ <code>(20, 30)</code>ã€‚</li>
<li>é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œæ‰€ä»¥äº‹åŠ¡ A å’Œ B æ­¤æ—¶éƒ½æˆåŠŸæŒæœ‰å„è‡ªçš„é—´éš™é”ã€‚</li>
</ul>
</li>
<li>
<p><strong>äº‹åŠ¡ A å°è¯•æ’å…¥</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡ A æ‰§è¡Œ <code>INSERT INTO t_student VALUES (25, ...)</code>ã€‚</li>
<li>ä¸ºäº†æ’å…¥ <code>id=25</code>ï¼Œäº‹åŠ¡ A éœ€è¦è·å–ä¸€ä¸ªæ’å…¥æ„å‘é” (II_A) ä½œç”¨äº <code>id=25</code> æ‰€åœ¨çš„ä½ç½®ã€‚</li>
<li>è¿™ä¸ªä½ç½® <code>id=25</code> ä½äºäº‹åŠ¡ B æŒæœ‰çš„é—´éš™é” G_B <code>(20, 30)</code> èŒƒå›´å†…ã€‚</li>
<li>æ’å…¥æ„å‘é” II_A ä¸å…¶ä»–äº‹åŠ¡æŒæœ‰çš„é—´éš™é” G_B å†²çªã€‚</li>
<li>å› æ­¤ï¼Œäº‹åŠ¡ A ç­‰å¾…äº‹åŠ¡ B é‡Šæ”¾é—´éš™é” G_Bã€‚</li>
</ul>
</li>
<li>
<p><strong>äº‹åŠ¡ B å°è¯•æ’å…¥</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡ B æ‰§è¡Œ <code>INSERT INTO t_student VALUES (26, ...)</code>ã€‚</li>
<li>ä¸ºäº†æ’å…¥ <code>id=26</code>ï¼Œäº‹åŠ¡ B éœ€è¦è·å–ä¸€ä¸ªæ’å…¥æ„å‘é” (II_B) ä½œç”¨äº <code>id=26</code> æ‰€åœ¨çš„ä½ç½®ã€‚</li>
<li>è¿™ä¸ªä½ç½® <code>id=26</code> ä½äºäº‹åŠ¡ A æŒæœ‰çš„é—´éš™é” G_A <code>(20, 30)</code> èŒƒå›´å†…ã€‚</li>
<li>æ’å…¥æ„å‘é” II_B ä¸å…¶ä»–äº‹åŠ¡æŒæœ‰çš„é—´éš™é” G_A å†²çªã€‚</li>
<li>å› æ­¤ï¼Œäº‹åŠ¡ B ç­‰å¾…äº‹åŠ¡ A é‡Šæ”¾é—´éš™é” G_Aã€‚</li>
</ul>
</li>
<li>
<p><strong>å¾ªç¯ç­‰å¾…</strong>ï¼š</p>
<ul>
<li>äº‹åŠ¡ A æŒæœ‰ G_Aï¼Œç­‰å¾… G_Bã€‚</li>
<li>äº‹åŠ¡ B æŒæœ‰ G_Bï¼Œç­‰å¾… G_Aã€‚</li>
<li>è¿™å°±æ„æˆäº†å¾ªç¯ç­‰å¾…ï¼Œæ»¡è¶³äº†æ­»é”çš„æ¡ä»¶ï¼ˆäº’æ–¥ã€å æœ‰å¹¶ç­‰å¾…ã€ä¸å¯æŠ¢å ã€å¾ªç¯ç­‰å¾…ï¼‰ï¼Œå› æ­¤å‘ç”Ÿæ­»é”ã€‚</li>
</ul>
</li>
</ol>
<p>ç®€è€Œè¨€ä¹‹ï¼Œä¸¤ä¸ªäº‹åŠ¡éƒ½å…ˆè·å–äº†ç›¸åŒèŒƒå›´çš„é—´éš™é”ï¼ˆè¿™æ˜¯å…è®¸çš„ï¼‰ï¼Œç„¶ååˆéƒ½è¯•å›¾åœ¨è¿™ä¸ªè¢«å¯¹æ–¹é”å®šçš„é—´éš™å†…æ’å…¥æ•°æ®ï¼Œä»è€Œéœ€è¦è·å–æ’å…¥æ„å‘é”ã€‚ç”±äºæ’å…¥æ„å‘é”ä¸å¯¹æ–¹çš„é—´éš™é”å†²çªï¼Œå¯¼è‡´äº†ç›¸äº’ç­‰å¾…ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ä¸¤ä¸ªäº‹åŠ¡å³ä½¿ç”Ÿæˆçš„é—´éš™é”çš„èŒƒå›´æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿå†²çªï¼Œå› ä¸ºé—´éš™é”ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æ•°æ®ï¼Œå› æ­¤é—´éš™é”ä¸é—´éš™é”ä¹‹é—´æ˜¯ç›¸äº’å…¼å®¹çš„ã€‚</p>
<p>åœ¨æ‰§è¡Œæ’å…¥è¯­å¥æ—¶ï¼Œå¦‚æœæ’å…¥çš„è®°å½•åœ¨å…¶ä»–äº‹åŠ¡æŒæœ‰é—´éš™é”èŒƒå›´å†…ï¼Œæ’å…¥è¯­å¥å°±ä¼šè¢«é˜»å¡ï¼Œå› ä¸ºæ’å…¥è¯­å¥åœ¨ç¢°åˆ°é—´éš™é”æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç„¶åæ’å…¥æ„å‘é”å’Œé—´éš™é”ä¹‹é—´æ˜¯äº’æ–¥çš„å…³ç³»ã€‚</p>
<p>å¦‚æœä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«å‘å¯¹æ–¹æŒæœ‰çš„é—´éš™é”èŒƒå›´å†…æ’å…¥ä¸€æ¡è®°å½•ï¼Œè€Œæ’å…¥æ“ä½œä¸ºäº†è·å–åˆ°æ’å…¥æ„å‘é”ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹äº‹åŠ¡çš„é—´éš™é”é‡Šæ”¾ï¼Œäºæ˜¯å°±é€ æˆäº†å¾ªç¯ç­‰å¾…ï¼Œæ»¡è¶³äº†æ­»é”çš„å››ä¸ªæ¡ä»¶ï¼š<strong>äº’æ–¥ã€å æœ‰ä¸”ç­‰å¾…ã€ä¸å¯å¼ºå ç”¨ã€å¾ªç¯ç­‰å¾…</strong>ï¼Œå› æ­¤å‘ç”Ÿäº†æ­»é”ã€‚</p>
<h2 id="è¯»è€…é—®ç­”">è¯»è€…é—®ç­”</h2>
<p><img src="/2025/05/18/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95-%E5%8A%A0%E4%BA%86%E4%BB%80%E4%B9%88%E9%94%81%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81/1747568351456.png" alt="1747568351456"></p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>é”</category>
      </categories>
      <tags>
        <tag>é¢è¯•é¢˜</tag>
        <tag>MySQL</tag>
        <tag>æ­»é”</tag>
        <tag>é”</tag>
        <tag>å­—èŠ‚è·³åŠ¨</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 416 - åˆ†å‰²ç­‰å’Œå­é›† (Partition Equal Subset Sum)</title>
    <url>/2025/05/17/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-416-%E5%88%86%E5%89%B2%E7%AD%89%E5%92%8C%E5%AD%90%E9%9B%86/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ª<strong>åªåŒ…å«æ­£æ•´æ•°</strong>çš„éç©ºæ•°ç»„ <code>nums</code>ã€‚è¯·ä½ åˆ¤æ–­æ˜¯å¦å¯ä»¥å°†è¿™ä¸ªæ•°ç»„åˆ†å‰²æˆä¸¤ä¸ªå­é›†ï¼Œä½¿å¾—ä¸¤ä¸ªå­é›†çš„å…ƒç´ å’Œç›¸ç­‰ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,5,11,5]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šæ•°ç»„å¯ä»¥åˆ†å‰²æˆ [1, 5, 5] å’Œ [11] ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,2,3,5]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼šæ•°ç»„ä¸èƒ½åˆ†å‰²æˆä¸¤ä¸ªå…ƒç´ å’Œç›¸ç­‰çš„å­é›†ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= nums.length &lt;= 200</code></li>
<li><code>1 &lt;= nums[i] &lt;= 100</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªç»å…¸çš„ç»„åˆä¼˜åŒ–é—®é¢˜ï¼š<strong>0/1 èƒŒåŒ…é—®é¢˜</strong>ã€‚</p>
<p>é¦–å…ˆï¼Œè®¡ç®—æ•´ä¸ªæ•°ç»„çš„æ€»å’Œ <code>sum</code>ã€‚å¦‚æœ <code>sum</code> æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆä¸å¯èƒ½å°†æ•°ç»„åˆ†å‰²æˆä¸¤ä¸ªå…ƒç´ å’Œç›¸ç­‰çš„å­é›†ï¼Œå› ä¸ºä¸¤ä¸ªå­é›†çš„å’Œå¿…é¡»éƒ½æ˜¯ <code>sum / 2</code>ï¼Œè€Œ <code>sum / 2</code> å¿…é¡»æ˜¯æ•´æ•°ã€‚å› æ­¤ï¼Œå¦‚æœ <code>sum</code> ä¸ºå¥‡æ•°ï¼Œç›´æ¥è¿”å› <code>false</code>ã€‚</p>
<p>å¦‚æœ <code>sum</code> æ˜¯å¶æ•°ï¼Œè®¾ç›®æ ‡å’Œ <code>target = sum / 2</code>ã€‚é—®é¢˜å°±è½¬åŒ–ä¸ºï¼šèƒ½å¦ä»æ•°ç»„ <code>nums</code> ä¸­é€‰å–è‹¥å¹²ä¸ªå…ƒç´ ï¼Œä½¿å¾—è¿™äº›å…ƒç´ çš„å’Œæ°å¥½ç­‰äº <code>target</code>ï¼Ÿ</p>
<p>è¿™å°±å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª 0/1 èƒŒåŒ…é—®é¢˜ï¼š</p>
<ul>
<li><strong>èƒŒåŒ…çš„å®¹é‡ (W)</strong>ï¼š<code>target</code></li>
<li><strong>ç‰©å“çš„é‡é‡ (weight[i])</strong>ï¼šæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´  <code>nums[i]</code></li>
<li><strong>ç‰©å“çš„ä»·å€¼ (value[i])</strong>ï¼šåŒæ ·æ˜¯æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´  <code>nums[i]</code> (å› ä¸ºæˆ‘ä»¬å…³å¿ƒçš„æ˜¯å’Œï¼Œæ‰€ä»¥é‡é‡å’Œä»·å€¼æ˜¯ç›¸åŒçš„)</li>
<li><strong>é—®é¢˜</strong>ï¼šèƒ½å¦æ°å¥½è£…æ»¡å®¹é‡ä¸º <code>target</code> çš„èƒŒåŒ…ï¼Ÿ</li>
</ul>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŠ¨æ€è§„åˆ’æ•°ç»„ <code>dp</code>ï¼Œå…¶ä¸­ <code>dp[j]</code> è¡¨ç¤ºæ˜¯å¦å­˜åœ¨ä¸€ç§é€‰å–æ–¹å¼ï¼Œä½¿å¾—é€‰å–çš„å…ƒç´ ä¹‹å’Œç­‰äº <code>j</code>ã€‚<code>dp[j]</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œ<code>true</code> è¡¨ç¤ºå­˜åœ¨ï¼Œ<code>false</code> è¡¨ç¤ºä¸å­˜åœ¨ã€‚</p>
<p><strong>çŠ¶æ€å®šä¹‰ï¼š</strong><br>
<code>dp[j]</code>ï¼šè¡¨ç¤ºä»æ•°ç»„ <code>nums</code> ä¸­é€‰å–å…ƒç´ ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªå­é›†çš„å’Œæ°å¥½ä¸º <code>j</code>ã€‚</p>
<p><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</strong><br>
å¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´  <code>num</code> (å³ <code>nums[i]</code>)ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° <code>dp</code> æ•°ç»„ã€‚<br>
éå† <code>dp</code> æ•°ç»„æ—¶ï¼Œä¸ºäº†ç¡®ä¿æ¯ä¸ªå…ƒç´ åªè¢«ä½¿ç”¨ä¸€æ¬¡ï¼ˆ0/1 èƒŒåŒ…çš„ç‰¹æ€§ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä»åå¾€å‰éå† <code>j</code> (ä» <code>target</code> åˆ° <code>num</code>)ã€‚</p>
<p>å¯¹äºå½“å‰çš„å…ƒç´  <code>num</code> å’Œå½“å‰çš„å’Œ <code>j</code>ï¼š</p>
<ul>
<li>å¦‚æœä¸é€‰å– <code>num</code>ï¼Œé‚£ä¹ˆ <code>dp[j]</code> çš„å€¼ä¿æŒä¸å˜ï¼Œå³ <code>dp[j]</code>ã€‚</li>
<li>å¦‚æœé€‰å– <code>num</code> (å‰ææ˜¯ <code>j &gt;= num</code>)ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦çœ‹ <code>dp[j - num]</code> æ˜¯å¦ä¸º <code>true</code>ã€‚å¦‚æœ <code>dp[j - num]</code> ä¸º <code>true</code>ï¼Œè¡¨ç¤ºåœ¨ä¸åŒ…å«å½“å‰ <code>num</code> çš„æƒ…å†µä¸‹ï¼Œå·²ç»å¯ä»¥å‡‘æˆ <code>j - num</code>ï¼Œé‚£ä¹ˆåŠ ä¸Š <code>num</code> ä¹‹åå°±å¯ä»¥å‡‘æˆ <code>j</code>ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š<br>
<code>dp[j] = dp[j] || dp[j - num]</code> (å½“ <code>j &gt;= num</code> æ—¶)</p>
<p><strong>åˆå§‹åŒ–ï¼š</strong><br>
<code>dp[0] = true</code>ï¼Œå› ä¸ºä¸é€‰å–ä»»ä½•å…ƒç´ æ—¶ï¼Œå’Œä¸º 0ï¼Œè¿™æ˜¯è‚¯å®šå¯ä»¥è¾¾æˆçš„ã€‚<br>
å…¶ä½™ <code>dp[j]</code> (j &gt; 0) åˆå§‹åŒ–ä¸º <code>false</code>ã€‚</p>
<p><strong>éå†é¡ºåºï¼š</strong></p>
<ol>
<li>å¤–å±‚å¾ªç¯éå†æ•°ç»„ <code>nums</code> ä¸­çš„æ¯ä¸ªå…ƒç´  <code>num</code>ã€‚</li>
<li>å†…å±‚å¾ªç¯éå†èƒŒåŒ…å®¹é‡ <code>j</code>ï¼Œä» <code>target</code> å‘ä¸‹åˆ° <code>num</code> (ç¡®ä¿æ¯ä¸ªç‰©å“åªç”¨ä¸€æ¬¡)ã€‚</li>
</ol>
<p><strong>æœ€ç»ˆç»“æœï¼š</strong><br>
éå†å®Œæ‰€æœ‰å…ƒç´ åï¼Œ<code>dp[target]</code> çš„å€¼å°±æ˜¯æœ€ç»ˆç­”æ¡ˆã€‚å¦‚æœ <code>dp[target]</code> ä¸º <code>true</code>ï¼Œåˆ™å¯ä»¥åˆ†å‰²æˆä¸¤ä¸ªå’Œç›¸ç­‰çš„å­é›†ï¼›å¦åˆ™ï¼Œä¸å¯ä»¥ã€‚</p>
<h2 id="æ¨å¯¼è¿‡ç¨‹">æ¨å¯¼è¿‡ç¨‹</h2>
<p>å‡è®¾ <code>nums = [1, 5, 11, 5]</code></p>
<ol>
<li>è®¡ç®—æ€»å’Œ <code>sum = 1 + 5 + 11 + 5 = 22</code>ã€‚</li>
<li><code>sum</code> æ˜¯å¶æ•°ï¼Œ<code>target = sum / 2 = 11</code>ã€‚</li>
<li>åˆå§‹åŒ– <code>dp</code> æ•°ç»„ï¼Œé•¿åº¦ä¸º <code>target + 1 = 12</code>ã€‚<br>
<code>dp = [true, false, false, false, false, false, false, false, false, false, false, false]</code><br>
(<code>dp[0] = true</code>)</li>
</ol>
<p><strong>éå† <code>nums</code>:</strong></p>
<p><strong>1. <code>num = 1</code>:</strong><br>
å†…å±‚å¾ªç¯ <code>j</code> ä» <code>11</code> åˆ° <code>1</code>ï¼š</p>
<ul>
<li><code>j = 11</code>: <code>dp[11] = dp[11] || dp[11-1] = false || dp[10] = false</code></li>
<li><code>j = 10</code>: <code>dp[10] = dp[10] || dp[10-1] = false || dp[9] = false</code></li>
<li>â€¦</li>
<li><code>j = 1</code>: <code>dp[1] = dp[1] || dp[1-1] = false || dp[0] = false || true = true</code><br>
<code>dp</code> å˜ä¸º: <code>[true, true, false, false, false, false, false, false, false, false, false, false]</code></li>
</ul>
<p><strong>2. <code>num = 5</code>:</strong><br>
å†…å±‚å¾ªç¯ <code>j</code> ä» <code>11</code> åˆ° <code>5</code>ï¼š</p>
<ul>
<li><code>j = 11</code>: <code>dp[11] = dp[11] || dp[11-5] = false || dp[6]</code> (æ­¤æ—¶ <code>dp[6]</code> è¿˜æ˜¯ <code>false</code>) <code>= false</code></li>
<li><code>j = 10</code>: <code>dp[10] = dp[10] || dp[10-5] = false || dp[5]</code> (æ­¤æ—¶ <code>dp[5]</code> è¿˜æ˜¯ <code>false</code>) <code>= false</code></li>
<li>â€¦</li>
<li><code>j = 6</code>: <code>dp[6] = dp[6] || dp[6-5] = false || dp[1] = false || true = true</code></li>
<li><code>j = 5</code>: <code>dp[5] = dp[5] || dp[5-5] = false || dp[0] = false || true = true</code><br>
<code>dp</code> å˜ä¸º: <code>[true, true, false, false, false, true, true, false, false, false, false, false]</code> (dp[1], dp[5], dp[6] ä¸º true)</li>
</ul>
<p><strong>3. <code>num = 11</code>:</strong><br>
å†…å±‚å¾ªç¯ <code>j</code> ä» <code>11</code> åˆ° <code>11</code>ï¼š</p>
<ul>
<li><code>j = 11</code>: <code>dp[11] = dp[11] || dp[11-11] = false || dp[0] = false || true = true</code><br>
<code>dp</code> å˜ä¸º: <code>[true, true, false, false, false, true, true, false, false, false, false, true]</code> (dp[1], dp[5], dp[6], dp[11] ä¸º true)</li>
</ul>
<p><strong>4. <code>num = 5</code> (ç¬¬äºŒä¸ª 5):</strong><br>
å†…å±‚å¾ªç¯ <code>j</code> ä» <code>11</code> åˆ° <code>5</code>ï¼š</p>
<ul>
<li><code>j = 11</code>: <code>dp[11]</code> å·²ç»æ˜¯ <code>true</code>ã€‚<code>dp[11] = dp[11] || dp[11-5] = true || dp[6] = true || true = true</code></li>
<li><code>j = 10</code>: <code>dp[10] = dp[10] || dp[10-5] = false || dp[5] = false || true = true</code></li>
<li><code>j = 9</code>: <code>dp[9] = dp[9] || dp[9-5] = false || dp[4]</code> (æ­¤æ—¶ <code>dp[4]</code> ä¸º <code>false</code>) <code>= false</code></li>
<li><code>j = 8</code>: <code>dp[8] = dp[8] || dp[8-5] = false || dp[3]</code> (æ­¤æ—¶ <code>dp[3]</code> ä¸º <code>false</code>) <code>= false</code></li>
<li><code>j = 7</code>: <code>dp[7] = dp[7] || dp[7-5] = false || dp[2]</code> (æ­¤æ—¶ <code>dp[2]</code> ä¸º <code>false</code>) <code>= false</code></li>
<li><code>j = 6</code>: <code>dp[6]</code> å·²ç»æ˜¯ <code>true</code>ã€‚<code>dp[6] = dp[6] || dp[6-5] = true || dp[1] = true || true = true</code></li>
<li><code>j = 5</code>: <code>dp[5]</code> å·²ç»æ˜¯ <code>true</code>ã€‚<code>dp[5] = dp[5] || dp[5-5] = true || dp[0] = true || true = true</code></li>
</ul>
<p>After this iteration, <code>dp</code> might look like:<br>
<code>dp[0]=true</code> (initial)<br>
<code>dp[1]=true</code> (from num=1)<br>
<code>dp[5]=true</code> (from first num=5)<br>
<code>dp[6]=true</code> (from first num=5 + num=1)<br>
<code>dp[10]=true</code> (from second num=5 + first num=5)<br>
<code>dp[11]=true</code> (from num=11 or from second num=5 + dp[6])</p>
<p>æœ€ç»ˆ <code>dp[11]</code> ä¸º <code>true</code>ã€‚æ‰€ä»¥è¿”å› <code>true</code>ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// filepath: /Users/adrianwang/.leetcode/416.åˆ†å‰²ç­‰å’Œå­é›†.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=416 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [416] åˆ†å‰²ç­‰å’Œå­é›†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canPartition</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	total := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		total += num</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å¦‚æœæ€»å’Œæ˜¯å¥‡æ•°ï¼Œåˆ™ä¸å¯èƒ½åˆ†å‰²æˆä¸¤ä¸ªå’Œç›¸ç­‰çš„å­é›†</span></span><br><span class="line">	<span class="keyword">if</span> total%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	half := total / <span class="number">2</span></span><br><span class="line">	<span class="comment">// dp[i] è¡¨ç¤ºæ˜¯å¦å­˜åœ¨å’Œä¸º i çš„å­é›†</span></span><br><span class="line">	dp := <span class="built_in">make</span>([]<span class="type">bool</span>, half+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å’Œä¸º0çš„å­é›†æ€»æ˜¯å­˜åœ¨çš„ï¼ˆå³ç©ºé›†ï¼‰</span></span><br><span class="line">	dp[<span class="number">0</span>] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 0/1 èƒŒåŒ…é—®é¢˜</span></span><br><span class="line">	<span class="comment">// å¤–å±‚å¾ªç¯éå†ç‰©å“ï¼ˆæ•°ç»„ä¸­çš„æ•°å­—ï¼‰</span></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		<span class="comment">// å†…å±‚å¾ªç¯éå†èƒŒåŒ…å®¹é‡ï¼ˆç›®æ ‡å’Œï¼‰ï¼Œå¿…é¡»ä»å¤§åˆ°å°ï¼Œä¿è¯æ¯ä¸ªç‰©å“åªç”¨ä¸€æ¬¡</span></span><br><span class="line">		<span class="keyword">for</span> j := half; j &gt;= num; j-- &#123;</span><br><span class="line">			<span class="comment">// å¯¹äºå½“å‰æ•°å­— numï¼Œå¦‚æœ dp[j-num] ä¸º trueï¼ˆå³å­˜åœ¨å’Œä¸º j-num çš„å­é›†ï¼‰</span></span><br><span class="line">			<span class="comment">// é‚£ä¹ˆåŠ ä¸Š num ä¹‹åï¼Œå°±å­˜åœ¨å’Œä¸º j çš„å­é›†</span></span><br><span class="line">			<span class="comment">// æˆ–è€…ï¼Œå¦‚æœ dp[j] æœ¬èº«å·²ç»æ˜¯ trueï¼ˆä¸åŒ…å«å½“å‰ num æ—¶å·²ç»å¯ä»¥å‡‘æˆ jï¼‰ï¼Œåˆ™ä¿æŒ true</span></span><br><span class="line">			dp[j] = dp[j] || dp[j-num]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dp[half]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n * target)ï¼Œå…¶ä¸­ <code>n</code> æ˜¯æ•°ç»„ <code>nums</code> çš„é•¿åº¦ï¼Œ<code>target</code> æ˜¯æ•°ç»„æ€»å’Œçš„ä¸€åŠã€‚æˆ‘ä»¬éœ€è¦éå†æ¯ä¸ªæ•°å­—ï¼Œå¹¶å¯¹æ¯ä¸ªæ•°å­—æ›´æ–° <code>dp</code> æ•°ç»„ä¸­æœ€å¤š <code>target</code> ä¸ªçŠ¶æ€ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(target)ï¼Œ<code>dp</code> æ•°ç»„çš„å¤§å°ä¸º <code>target + 1</code>ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li>è¯†åˆ«é—®é¢˜æ˜¯å¦å¯ä»¥è½¬åŒ–ä¸ºèƒŒåŒ…é—®é¢˜æ˜¯è§£å†³è¿™ç±»åŠ¨æ€è§„åˆ’é—®é¢˜çš„å…³é”®ã€‚</li>
<li>0/1 èƒŒåŒ…é—®é¢˜çš„æ ¸å¿ƒåœ¨äºæ¯ä¸ªç‰©å“åªèƒ½é€‰æ‹©ä¸€æ¬¡ï¼Œè¿™é€šå¸¸é€šè¿‡å†…å±‚å¾ªç¯é€†åºéå†å®¹é‡æ¥å®ç°ã€‚</li>
<li>åŠ¨æ€è§„åˆ’çš„çŠ¶æ€å®šä¹‰å’ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯è§£é¢˜çš„æ ¸å¿ƒã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>èƒŒåŒ…é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 300: æœ€é•¿é€’å¢å­åºåˆ— - åŠ¨æ€è§„åˆ’ä¸è´ªå¿ƒä¼˜åŒ–</title>
    <url>/2025/05/17/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-300-%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚</p>
<p>å­åºåˆ—æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ<code>[3,6,2,7]</code> æ˜¯æ•°ç»„ <code>[0,3,1,6,2,2,7]</code> çš„å­åºåˆ—ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<p>è¾“å…¥ï¼š<code>nums = [10,9,2,5,3,7,101,18]</code><br>
è¾“å‡ºï¼š<code>4</code><br>
è§£é‡Šï¼šæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ <code>[2,3,7,101]</code>ï¼Œå› æ­¤é•¿åº¦ä¸º 4 ã€‚</p>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<p>è¾“å…¥ï¼š<code>nums = [0,1,0,3,2,3]</code><br>
è¾“å‡ºï¼š<code>4</code></p>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<p>è¾“å…¥ï¼š<code>nums = [7,7,7,7,7,7,7]</code><br>
è¾“å‡ºï¼š<code>1</code></p>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= nums.length &lt;= 2500</code></li>
<li><code>-10^4 &lt;= nums[i] &lt;= 10^4</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’-Dynamic-Programming">æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’ (Dynamic Programming)</h3>
<p>è¿™æ˜¯è§£å†³ LIS (Longest Increasing Subsequence) é—®é¢˜çš„ç»å…¸æ–¹æ³•ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong></p>
<p>æˆ‘ä»¬å®šä¹‰ <code>dp[i]</code> ä¸ºä»¥ <code>nums[i]</code> è¿™ä¸ªæ•°ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚<br>
ä¸ºäº†è®¡ç®— <code>dp[i]</code>ï¼Œæˆ‘ä»¬éœ€è¦éå† <code>i</code> ä¹‹å‰çš„æ‰€æ‰€æœ‰å…ƒç´  <code>nums[j]</code> (å…¶ä¸­ <code>0 &lt;= j &lt; i</code>)ï¼š</p>
<ul>
<li>å¦‚æœ <code>nums[i] &gt; nums[j]</code>ï¼Œè¯´æ˜ <code>nums[i]</code> å¯ä»¥æ¥åœ¨ä»¥ <code>nums[j]</code> ç»“å°¾çš„é€’å¢å­åºåˆ—ä¹‹åï¼Œå½¢æˆä¸€ä¸ªæ›´é•¿çš„é€’å¢å­åºåˆ—ã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªæ–°çš„é€’å¢å­åºåˆ—çš„é•¿åº¦å°±æ˜¯ <code>dp[j] + 1</code>ã€‚</li>
<li>å¦‚æœ <code>nums[i] &lt;= nums[j]</code>ï¼Œåˆ™ <code>nums[i]</code> ä¸èƒ½æ¥åœ¨ <code>nums[j]</code> ä¹‹åå½¢æˆä¸¥æ ¼é€’å¢å­åºåˆ—ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œ<code>dp[i]</code> çš„å€¼åº”è¯¥æ˜¯æ‰€æœ‰æ»¡è¶³ <code>nums[i] &gt; nums[j]</code> çš„ <code>dp[j] + 1</code> ä¸­çš„æœ€å¤§å€¼ã€‚å¦‚æœæ²¡æœ‰ä»»ä½• <code>j</code> æ»¡è¶³æ¡ä»¶ï¼ˆä¾‹å¦‚ <code>nums[i]</code> æ˜¯å½“å‰æ‰€æœ‰æ•°å­—ä¸­æœ€å°çš„ï¼‰ï¼Œé‚£ä¹ˆ <code>dp[i]</code> å°±æ˜¯ 1ï¼ˆå³ <code>nums[i]</code> è‡ªèº«æ„æˆä¸€ä¸ªå­åºåˆ—ï¼‰ã€‚</p>
<p><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</strong></p>
<p><code>dp[i] = max(dp[j]) + 1</code>ï¼Œå…¶ä¸­ <code>0 â‰¤ j &lt; i</code> ä¸” <code>nums[i] &gt; nums[j]</code>ã€‚<br>
å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„ <code>j</code>ï¼Œåˆ™ <code>dp[i] = 1</code>ã€‚</p>
<p><strong>åˆå§‹åŒ–ï¼š</strong></p>
<p><code>dp</code> æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ çš„åˆå§‹å€¼éƒ½ä¸º 1ï¼Œå› ä¸ºæ¯ä¸ªå…ƒç´ æœ¬èº«è‡³å°‘å¯ä»¥æ„æˆä¸€ä¸ªé•¿åº¦ä¸º 1 çš„é€’å¢å­åºåˆ—ã€‚</p>
<p><strong>æœ€ç»ˆç»“æœï¼š</strong></p>
<p>éå†æ•´ä¸ª <code>dp</code> æ•°ç»„ï¼Œå…¶ä¸­çš„æœ€å¤§å€¼å³ä¸ºæ•´ä¸ªæ•°ç»„çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚å› ä¸º LIS å¯èƒ½ä»¥ä»»ä½•å…ƒç´ ç»“å°¾ã€‚</p>
<h4 id="ä»£ç å®ç°-Go">ä»£ç å®ç° (Go)</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// max è¿”å›ä¸¤ä¸ªæ•´æ•°ä¸­çš„è¾ƒå¤§å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lengthOfLIS ä½¿ç”¨åŠ¨æ€è§„åˆ’è®¡ç®—æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lengthOfLIS_dp</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line">	<span class="comment">// dp[i] è¡¨ç¤ºä»¥ nums[i] ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦</span></span><br><span class="line">	dp := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ– dp æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ è‡ªèº«æ„æˆé•¿åº¦ä¸º 1 çš„é€’å¢å­åºåˆ—</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		dp[i] = <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¡«å…… dp æ•°ç»„</span></span><br><span class="line">	<span class="comment">// i ä»ç¬¬ 1 ä¸ªå…ƒç´ å¼€å§‹ï¼ˆç´¢å¼• 0 å·²ç»åˆå§‹åŒ–ä¸º 1ï¼‰</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		<span class="comment">// éå† i ä¹‹å‰çš„æ‰€æœ‰å…ƒç´  j</span></span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; i; j++ &#123;</span><br><span class="line">			<span class="comment">// å¦‚æœ nums[i] å¤§äº nums[j]ï¼Œè¯´æ˜ nums[i] å¯ä»¥æ¥åœ¨ nums[j] åé¢</span></span><br><span class="line">			<span class="keyword">if</span> nums[i] &gt; nums[j] &#123;</span><br><span class="line">				<span class="comment">// æ›´æ–° dp[i]ï¼Œå–å½“å‰ dp[i] å’Œ dp[j]+1 ä¸­çš„è¾ƒå¤§å€¼</span></span><br><span class="line">				dp[i] = max(dp[i], dp[j]+<span class="number">1</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ‰¾åˆ° dp æ•°ç»„ä¸­çš„æœ€å¤§å€¼ï¼Œå³ä¸ºæ•´ä¸ªåºåˆ—çš„ LIS é•¿åº¦</span></span><br><span class="line">	maxLength := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		maxLength = max(maxLength, dp[i])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> maxLength</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h4>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> <code>O(n^2)</code>ã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªåµŒå¥—å¾ªç¯ï¼Œå¤–å±‚å¾ªç¯ <code>n</code> æ¬¡ï¼Œå†…å±‚å¾ªç¯å¹³å‡ <code>n/2</code> æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> <code>O(n)</code>ã€‚éœ€è¦ä¸€ä¸ª <code>dp</code> æ•°ç»„æ¥å­˜å‚¨ä¸­é—´çŠ¶æ€ã€‚</li>
</ul>
<h3 id="æ–¹æ³•äºŒï¼šè´ªå¿ƒ-äºŒåˆ†æŸ¥æ‰¾">æ–¹æ³•äºŒï¼šè´ªå¿ƒ + äºŒåˆ†æŸ¥æ‰¾</h3>
<p>è¿™ç§æ–¹æ³•æ›´ä¸ºé«˜æ•ˆï¼Œå¯ä»¥å°†æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ° <code>O(n log n)</code>ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong></p>
<p>æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ <code>tails</code>ï¼ˆæˆ–è€…å« <code>min_end_elements_of_lis_with_length_k</code>ï¼‰ï¼Œå…¶ä¸­ <code>tails[k]</code> å­˜å‚¨çš„æ˜¯æ‰€æœ‰é•¿åº¦ä¸º <code>k+1</code> çš„é€’å¢å­åºåˆ—ä¸­ï¼Œæœ«å°¾å…ƒç´ çš„æœ€å°å€¼ã€‚è¿™ä¸ª <code>tails</code> æ•°ç»„ä¸€å®šæ˜¯ä¸¥æ ¼é€’å¢çš„ã€‚</p>
<p><strong>è¯æ˜ <code>tails</code> æ•°ç»„çš„å•è°ƒæ€§ï¼š</strong><br>
å‡è®¾ <code>tails[k]</code> (é•¿åº¦ä¸º <code>k+1</code> çš„ LIS çš„æœ€å°æœ«å°¾) &gt;= <code>tails[k+1]</code> (é•¿åº¦ä¸º <code>k+2</code> çš„ LIS çš„æœ€å°æœ«å°¾)ã€‚<br>
è¿™æ„å‘³ç€å­˜åœ¨ä¸€ä¸ªé•¿åº¦ä¸º <code>k+2</code> çš„ LISï¼Œå…¶æœ«å°¾å…ƒç´  <code>tails[k+1]</code> å°äºç­‰äº é•¿åº¦ä¸º <code>k+1</code> çš„ LIS çš„æœ€å°æœ«å°¾å…ƒç´  <code>tails[k]</code>ã€‚<br>
é‚£ä¹ˆè¿™ä¸ªé•¿åº¦ä¸º <code>k+2</code> çš„ LIS çš„å‰ <code>k+1</code> ä¸ªå…ƒç´ æ„æˆçš„å­åºåˆ—ï¼Œå…¶æœ«å°¾å…ƒç´ ä¸€å®šå°äº <code>tails[k+1]</code>ï¼Œä¹Ÿå°±å°äºç­‰äº <code>tails[k]</code>ã€‚è¿™ä¸ <code>tails[k]</code> æ˜¯é•¿åº¦ä¸º <code>k+1</code> çš„ LIS çš„æœ€å°æœ«å°¾å…ƒç´ çŸ›ç›¾ã€‚<br>
æ‰€ä»¥ <code>tails</code> æ•°ç»„å¿…é¡»æ˜¯ä¸¥æ ¼é€’å¢çš„ã€‚</p>
<p><strong>ç®—æ³•æ­¥éª¤ï¼š</strong></p>
<ol>
<li>
<p>åˆå§‹åŒ–ä¸€ä¸ªç©ºæ•°ç»„ <code>tails</code>ã€‚è¿™ä¸ªæ•°ç»„å°†ç”¨æ¥å­˜å‚¨æˆ‘ä»¬æ„å»ºçš„æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯å„é•¿åº¦é€’å¢å­åºåˆ—çš„æœ€å°æœ«å°¾å…ƒç´ ï¼‰ã€‚</p>
</li>
<li>
<p>éå†è¾“å…¥æ•°ç»„ <code>nums</code> ä¸­çš„æ¯ä¸ªå…ƒç´  <code>num</code>ï¼š</p>
<ul>
<li><strong>æƒ…å†µ 1ï¼š</strong> å¦‚æœ <code>num</code> å¤§äº <code>tails</code> æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆå³ <code>num &gt; tails[len(tails)-1]</code>ï¼Œå¦‚æœ <code>tails</code> éç©ºï¼‰ï¼Œæˆ–è€… <code>tails</code> ä¸ºç©ºï¼Œé‚£ä¹ˆ <code>num</code> å¯ä»¥æ‰©å±•å½“å‰æœ€é•¿çš„é€’å¢å­åºåˆ—ã€‚æˆ‘ä»¬å°† <code>num</code> æ·»åŠ åˆ° <code>tails</code> çš„æœ«å°¾ã€‚è¿™è¡¨ç¤ºæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªæ›´é•¿çš„é€’å¢å­åºåˆ—ã€‚</li>
<li><strong>æƒ…å†µ 2ï¼š</strong> å¦‚æœ <code>num</code> ä¸å¤§äº <code>tails</code> ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œè¿™æ„å‘³ç€ <code>num</code> ä¸èƒ½ç›´æ¥æ‰©å±•å½“å‰å·²çŸ¥çš„æœ€é•¿é€’å¢å­åºåˆ—ã€‚ä½†æ˜¯ï¼Œ<code>num</code> å¯èƒ½å¯ä»¥æ›¿æ¢ <code>tails</code> æ•°ç»„ä¸­æŸä¸ªå…ƒç´ ï¼Œå½¢æˆä¸€ä¸ªé•¿åº¦ç›¸åŒä½†æœ«å°¾å…ƒç´ æ›´å°çš„é€’å¢å­åºåˆ—ã€‚<br>
æˆ‘ä»¬ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œåœ¨ <code>tails</code> æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº <code>num</code> çš„å…ƒç´  <code>tails[j]</code>ï¼Œç„¶åç”¨ <code>num</code> æ›¿æ¢ <code>tails[j]</code>ã€‚<br>
è¿™æ ·åšçš„æ„ä¹‰æ˜¯ï¼šæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå¯ä»¥æ„æˆé•¿åº¦ä¸º <code>j+1</code> çš„é€’å¢å­åºåˆ—ï¼Œå¹¶ä¸”å…¶æœ«å°¾å…ƒç´ æ˜¯ <code>num</code>ï¼ˆæ¯”åŸæ¥çš„ <code>tails[j]</code> æ›´å°æˆ–ç›¸ç­‰ï¼‰ã€‚è¿™ä¸ºåç»­å…ƒç´ æä¾›äº†æ›´å¤šå¯èƒ½æ€§ï¼ˆå› ä¸ºæœ«å°¾å…ƒç´ è¶Šå°ï¼Œè¶Šå®¹æ˜“æ¥ä¸Šæ–°å…ƒç´ ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p>éå†å®Œæˆåï¼Œ<code>tails</code> æ•°ç»„çš„é•¿åº¦å°±æ˜¯æ•´ä¸ªåºåˆ—çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚</p>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆè¿™ç§æ–¹æ³•æœ‰æ•ˆï¼Ÿ</strong><br>
<code>tails</code> æ•°ç»„çš„é•¿åº¦ <code>len</code> å§‹ç»ˆä»£è¡¨å½“å‰å·²å‘ç°çš„ LIS çš„é•¿åº¦ã€‚<br>
å½“æˆ‘ä»¬ç”¨ <code>num</code> æ›¿æ¢ <code>tails[j]</code> æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ”¹å˜ LIS çš„é•¿åº¦ï¼Œè€Œæ˜¯ä¼˜åŒ–äº†æ„æˆé•¿åº¦ä¸º <code>j+1</code> çš„ LIS çš„æ¡ä»¶ï¼ˆä½¿å…¶æœ«å°¾å…ƒç´ æ›´å°ï¼‰ã€‚å¦‚æœ <code>num</code> å¤§äº <code>tails</code> çš„æ‰€æœ‰å…ƒç´ ï¼Œæˆ‘ä»¬å°±å¢åŠ  LIS çš„é•¿åº¦ã€‚<br>
è¿™ä¸ªè¿‡ç¨‹ä¿è¯äº† <code>tails</code> æ•°ç»„å§‹ç»ˆå­˜å‚¨ç€åœ¨å½“å‰éå†è¿›åº¦ä¸‹ï¼Œæ„å»ºä¸åŒé•¿åº¦é€’å¢å­åºåˆ—çš„&quot;æœ€ä¼˜&quot;ï¼ˆå³æœ«å°¾å…ƒç´ æœ€å°ï¼‰é€‰æ‹©ã€‚</p>
<h4 id="ä»£ç å®ç°-Go-2">ä»£ç å®ç° (Go)</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// lengthOfLIS ä½¿ç”¨è´ªå¿ƒ + äºŒåˆ†æŸ¥æ‰¾è®¡ç®—æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lengthOfLIS_greedy_binary_search</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// tails[i] è¡¨ç¤ºé•¿åº¦ä¸º i+1 çš„æ‰€æœ‰é€’å¢å­åºåˆ—ä¸­ï¼Œæœ«å°¾å…ƒç´ çš„æœ€å°å€¼</span></span><br><span class="line">	tails := []<span class="type">int</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		<span class="comment">// å¦‚æœ tails ä¸ºç©ºï¼Œæˆ–è€… num å¤§äº tails ä¸­æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">		<span class="comment">// åˆ™ num å¯ä»¥æ‰©å±•å½“å‰æœ€é•¿çš„é€’å¢å­åºåˆ—</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(tails) == <span class="number">0</span> || num &gt; tails[<span class="built_in">len</span>(tails)<span class="number">-1</span>] &#123;</span><br><span class="line">			tails = <span class="built_in">append</span>(tails, num)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// å¦åˆ™ï¼Œåœ¨ tails æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº num çš„å…ƒç´ ï¼Œå¹¶æ›¿æ¢å®ƒ</span></span><br><span class="line">			<span class="comment">// è¿™æ„å‘³ç€æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªé•¿åº¦ç›¸åŒçš„é€’å¢å­åºåˆ—ï¼Œä½†å…¶æœ«å°¾å…ƒç´ æ›´å°</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">// äºŒåˆ†æŸ¥æ‰¾ï¼šåœ¨ tails æ•°ç»„ä¸­æ‰¾åˆ° num çš„æ’å…¥ä½ç½®</span></span><br><span class="line">			<span class="comment">// ç›®çš„æ˜¯æ‰¾åˆ°æœ€å°çš„ j ä½¿å¾— tails[j] &gt;= num</span></span><br><span class="line">			left, right := <span class="number">0</span>, <span class="built_in">len</span>(tails)<span class="number">-1</span></span><br><span class="line">			pos := right <span class="comment">// å¦‚æœ num æ¯” tails æ‰€æœ‰å…ƒç´ éƒ½å°ï¼Œåˆ™æ›¿æ¢ tails[0]</span></span><br><span class="line">			</span><br><span class="line">			<span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">				mid := left + (right-left)/<span class="number">2</span></span><br><span class="line">				<span class="keyword">if</span> tails[mid] &gt;= num &#123;</span><br><span class="line">					pos = mid <span class="comment">// æ‰¾åˆ°äº†ä¸€ä¸ªå¯èƒ½çš„æ›¿æ¢ä½ç½®</span></span><br><span class="line">					right = mid - <span class="number">1</span> <span class="comment">// å°è¯•åœ¨å·¦åŠéƒ¨åˆ†æ‰¾æ›´å°çš„ç´¢å¼•</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					left = mid + <span class="number">1</span> <span class="comment">// num è¾ƒå¤§ï¼Œéœ€è¦åœ¨å³åŠéƒ¨åˆ†æ‰¾</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			tails[pos] = num</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// tails æ•°ç»„çš„é•¿åº¦å³ä¸ºæœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(tails)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¤æ‚åº¦åˆ†æ-2">å¤æ‚åº¦åˆ†æ</h4>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> <code>O(n log n)</code>ã€‚å¤–å±‚å¾ªç¯éå† <code>nums</code> æ•°ç»„éœ€è¦ <code>n</code> æ¬¡ï¼Œå†…å±‚äºŒåˆ†æŸ¥æ‰¾æ“ä½œéœ€è¦ <code>log k</code> æ¬¡ï¼Œå…¶ä¸­ <code>k</code> æ˜¯ <code>tails</code> æ•°ç»„çš„å½“å‰é•¿åº¦ï¼ˆ<code>k &lt;= n</code>ï¼‰ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> <code>O(n)</code>ã€‚æœ€åæƒ…å†µä¸‹ï¼Œ<code>tails</code> æ•°ç»„å¯èƒ½å­˜å‚¨æ‰€æœ‰ <code>n</code> ä¸ªå…ƒç´ ï¼ˆä¾‹å¦‚å½“ <code>nums</code> æœ¬èº«å°±æ˜¯ä¸¥æ ¼é€’å¢çš„æ—¶å€™ï¼‰ã€‚</li>
</ul>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th style="text-align:left">æ–¹é¢</th>
<th style="text-align:left">åŠ¨æ€è§„åˆ’ (DP)</th>
<th style="text-align:left">è´ªå¿ƒ + äºŒåˆ†æŸ¥æ‰¾</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">æ—¶é—´å¤æ‚åº¦</td>
<td style="text-align:left"><code>O(n^2)</code></td>
<td style="text-align:left"><code>O(n log n)</code></td>
</tr>
<tr>
<td style="text-align:left">ç©ºé—´å¤æ‚åº¦</td>
<td style="text-align:left"><code>O(n)</code></td>
<td style="text-align:left"><code>O(n)</code></td>
</tr>
<tr>
<td style="text-align:left">å®ç°éš¾åº¦</td>
<td style="text-align:left">ç›¸å¯¹ç®€å•ï¼Œæ˜“äºç†è§£</td>
<td style="text-align:left">ç¨å¤æ‚ï¼Œéœ€è¦ç†è§£è´ªå¿ƒæ€æƒ³å’ŒäºŒåˆ†æŸ¥æ‰¾çš„åº”ç”¨</td>
</tr>
<tr>
<td style="text-align:left">ä¼˜ç‚¹</td>
<td style="text-align:left">æ€è·¯ç›´æ¥</td>
<td style="text-align:left">æ•ˆç‡æ›´é«˜</td>
</tr>
<tr>
<td style="text-align:left">ç¼ºç‚¹</td>
<td style="text-align:left">æ•ˆç‡è¾ƒä½ï¼Œå¤§æ•°æ®é‡ä¸‹å¯èƒ½è¶…æ—¶</td>
<td style="text-align:left">ç†è§£èµ·æ¥ä¸å¦‚DPç›´è§‚</td>
</tr>
<tr>
<td style="text-align:left">æ¨èåº¦</td>
<td style="text-align:left">â˜…â˜…â˜…â˜†â˜†</td>
<td style="text-align:left">â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li><strong>åŠ¨æ€è§„åˆ’</strong>æ˜¯è§£å†³ LIS é—®é¢˜çš„åŸºç¡€æ–¹æ³•ï¼Œç†è§£ <code>dp[i]</code> çš„å®šä¹‰ï¼ˆä»¥ <code>nums[i]</code> ç»“å°¾çš„ LIS é•¿åº¦ï¼‰æ˜¯å…³é”®ã€‚</li>
<li><strong>è´ªå¿ƒ + äºŒåˆ†æŸ¥æ‰¾</strong> æä¾›äº†ä¸€ç§æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚æ ¸å¿ƒåœ¨äºç»´æŠ¤ <code>tails</code> æ•°ç»„ï¼Œå®ƒå­˜å‚¨äº†ä¸åŒé•¿åº¦é€’å¢å­åºåˆ—çš„æœ€å°æœ«å°¾å…ƒç´ ã€‚è¿™ç§ç­–ç•¥ç¡®ä¿æˆ‘ä»¬æ€»æ˜¯åœ¨ä¸ºæœªæ¥ç•™ä¸‹æœ€å¥½çš„å¯èƒ½æ€§ã€‚</li>
<li>å¯¹äºå­åºåˆ—é—®é¢˜ï¼ŒåŠ¨æ€è§„åˆ’æ˜¯ä¸€ä¸ªå¸¸è§çš„æ€è€ƒæ–¹å‘ã€‚å½“ DP å‡ºç°å¹³æ–¹å¤æ‚åº¦æ—¶ï¼Œå¯ä»¥è€ƒè™‘æ˜¯å¦æœ‰è´ªå¿ƒç­–ç•¥æˆ–è€…æ•°æ®ç»“æ„ï¼ˆå¦‚äºŒåˆ†æŸ¥æ‰¾ã€æ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘ï¼‰å¯ä»¥ä¼˜åŒ–ã€‚</li>
</ul>
<p>è¿™é“é¢˜æ˜¯ç†è§£åŠ¨æ€è§„åˆ’å’Œåºåˆ—é—®é¢˜ä¼˜åŒ–çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ä¸¤ç§æ–¹æ³•éƒ½å€¼å¾—æŒæ¡ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>è´ªå¿ƒç®—æ³•</tag>
        <tag>æ•°ç»„</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 139. å•è¯æ‹†åˆ†ï¼šå°ç™½ä¹Ÿèƒ½çœ‹æ‡‚çš„åŠ¨æ€è§„åˆ’è§£æ³•</title>
    <url>/2025/05/17/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-139-Word-Break/</url>
    <content><![CDATA[<h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªéç©ºå­—ç¬¦ä¸² <code>s</code> å’Œä¸€ä¸ªåŒ…å«éç©ºå•è¯åˆ—è¡¨çš„å­—å…¸ <code>wordDict</code>ï¼Œåˆ¤å®š <code>s</code> æ˜¯å¦å¯ä»¥è¢«ç©ºæ ¼æ‹†åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåœ¨å­—å…¸ä¸­å‡ºç°çš„å•è¯ã€‚</p>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li>å­—å…¸ä¸­çš„å•è¯å¯ä»¥é‡å¤ä½¿ç”¨ã€‚</li>
<li>ä½ å¯ä»¥å‡è®¾å­—å…¸ä¸­æ²¡æœ‰é‡å¤çš„å•è¯ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;leetcode&quot;, wordDict = [&quot;leet&quot;, &quot;code&quot;]</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: è¿”å› true å› ä¸º &quot;leetcode&quot; å¯ä»¥è¢«æ‹†åˆ†æˆ &quot;leet code&quot;ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;applepenapple&quot;, wordDict = [&quot;apple&quot;, &quot;pen&quot;]</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: è¿”å› true å› ä¸º &quot;applepenapple&quot; å¯ä»¥è¢«æ‹†åˆ†æˆ &quot;apple pen apple&quot;ã€‚</span><br><span class="line">     æ³¨æ„ä½ å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: s = &quot;catsandog&quot;, wordDict = [&quot;cats&quot;, &quot;dog&quot;, &quot;sand&quot;, &quot;and&quot;, &quot;cat&quot;]</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= s.length &lt;= 300</code></li>
<li><code>1 &lt;= wordDict.length &lt;= 1000</code></li>
<li><code>1 &lt;= wordDict[i].length &lt;= 20</code></li>
<li><code>s</code> å’Œ <code>wordDict[i]</code> ä»…æœ‰å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
<li><code>wordDict</code> ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸² <strong>äº’ä¸ç›¸åŒ</strong></li>
</ul>
<h2 id="æ€è·¯åˆ†æï¼šåŠ¨æ€è§„åˆ’">æ€è·¯åˆ†æï¼šåŠ¨æ€è§„åˆ’</h2>
<p>è¿™é“é¢˜æ˜¯å…¸å‹çš„å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼ˆDynamic Programming, DPï¼‰è§£å†³çš„é—®é¢˜ã€‚å½“æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªè¾ƒé•¿çš„å­—ç¬¦ä¸²æ˜¯å¦èƒ½è¢«æ‹†åˆ†æ—¶ï¼Œå…¶ç»“æœå¯ä»¥ä¾èµ–äºå…¶è¾ƒçŸ­çš„å‰ç¼€å­ä¸²æ˜¯å¦èƒ½è¢«æ‹†åˆ†ã€‚è¿™ç§å…·æœ‰&quot;æœ€ä¼˜å­ç»“æ„&quot;å’Œ&quot;é‡å å­é—®é¢˜&quot;ç‰¹å¾çš„é—®é¢˜ï¼Œé€šå¸¸æ˜¯ DP çš„ç”¨æ­¦ä¹‹åœ°ã€‚</p>
<h3 id="1-å®šä¹‰çŠ¶æ€-DP-æ•°ç»„">1. å®šä¹‰çŠ¶æ€ (DP æ•°ç»„)</h3>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„æ•°ç»„ <code>dp</code>ï¼Œå…¶ä¸­ <code>dp[i]</code> è¡¨ç¤ºå­—ç¬¦ä¸² <code>s</code> çš„<strong>å‰ <code>i</code> ä¸ªå­—ç¬¦</strong>ï¼ˆå³å­ä¸² <code>s[0...i-1]</code>ï¼Œæ³¨æ„æ˜¯é•¿åº¦ä¸º <code>i</code> çš„å‰ç¼€ï¼‰æ˜¯å¦å¯ä»¥è¢«æˆåŠŸæ‹†åˆ†æˆå­—å…¸ä¸­çš„å•è¯ã€‚<br>
æ•°ç»„çš„é•¿åº¦è®¾ä¸º <code>n+1</code>ï¼Œå…¶ä¸­ <code>n</code> æ˜¯å­—ç¬¦ä¸² <code>s</code> çš„é•¿åº¦ã€‚</p>
<ul>
<li><code>dp[0]</code>ï¼šä»£è¡¨ç©ºå­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å®šä¹‰å®ƒä¸º <code>true</code>ï¼Œå› ä¸ºç©ºå­—ç¬¦ä¸²å¯ä»¥è¢«&quot;æ‹†åˆ†&quot;ï¼ˆä¸åŒ…å«ä»»ä½•å•è¯ï¼Œæˆ–è€…è¯´ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆæ³•çš„æ‹†åˆ†èµ·ç‚¹ï¼‰ã€‚è¿™æ˜¯åŠ¨æ€è§„åˆ’éå¸¸é‡è¦çš„<strong>åˆå§‹æ¡ä»¶</strong>æˆ–<strong>åŸºæœ¬æƒ…å†µ (base case)</strong>ã€‚</li>
<li><code>dp[1]</code>ï¼šä»£è¡¨ <code>s[0...0]</code> (å³ <code>s</code> çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç»„æˆçš„å­ä¸²) æ˜¯å¦å¯ä»¥è¢«æ‹†åˆ†ã€‚</li>
<li>â€¦</li>
<li><code>dp[i]</code>ï¼šä»£è¡¨ <code>s[0...i-1]</code> (å³ <code>s</code> çš„å‰ <code>i</code> ä¸ªå­—ç¬¦ç»„æˆçš„å­ä¸²) æ˜¯å¦å¯ä»¥è¢«æ‹†åˆ†ã€‚</li>
<li><code>dp[n]</code>ï¼šä»£è¡¨ <code>s[0...n-1]</code> (å³æ•´ä¸ªå­—ç¬¦ä¸² <code>s</code>) æ˜¯å¦å¯ä»¥è¢«æ‹†åˆ†ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦æ±‚çš„ç›®æ ‡ã€‚</li>
</ul>
<h3 id="2-çŠ¶æ€è½¬ç§»æ–¹ç¨‹">2. çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h3>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ€è€ƒå¦‚ä½•è®¡ç®— <code>dp[i]</code> çš„å€¼ã€‚<br>
è¦åˆ¤æ–­ <code>s</code> çš„å‰ <code>i</code> ä¸ªå­—ç¬¦ <code>s[0...i-1]</code> èƒ½å¦è¢«æ‹†åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å°†å…¶æ‹†åˆ†æˆä¸¤éƒ¨åˆ†ï¼š<br>
<code>s[0...i-1] = s[0...j-1] + s[j...i-1]</code></p>
<p>å…¶ä¸­ï¼Œ<code>j</code> æ˜¯ä¸€ä¸ªåˆ†å‰²ç‚¹ï¼Œ<code>0 &lt;= j &lt; i</code>ã€‚</p>
<ul>
<li><code>s[0...j-1]</code>ï¼šè¿™æ˜¯å­—ç¬¦ä¸² <code>s</code> çš„å‰ <code>j</code> ä¸ªå­—ç¬¦ã€‚å®ƒèƒ½å¦è¢«æ‹†åˆ†ï¼Œå¯¹åº”çš„æ˜¯ <code>dp[j]</code> çš„å€¼ã€‚</li>
<li><code>s[j...i-1]</code>ï¼šè¿™æ˜¯ä»ç´¢å¼• <code>j</code> å¼€å§‹ï¼Œåˆ°ç´¢å¼• <code>i-1</code> ç»“æŸçš„å­ä¸²ã€‚æˆ‘ä»¬éœ€è¦åˆ¤æ–­è¿™ä¸ªå­ä¸²æœ¬èº«æ˜¯å¦å­˜åœ¨äºæˆ‘ä»¬çš„ <code>wordDict</code> å­—å…¸ä¸­ã€‚</li>
</ul>
<p>å¦‚æœå­˜åœ¨ä¸€ä¸ª <code>j</code> ( <code>0 &lt;= j &lt; i</code> )ï¼Œä½¿å¾— <code>dp[j]</code> ä¸º <code>true</code> (å³ <code>s</code> çš„å‰ <code>j</code> ä¸ªå­—ç¬¦å¯ä»¥è¢«æ‹†åˆ†)ï¼Œ<strong>å¹¶ä¸”</strong>å­ä¸² <code>s[j...i-1]</code> æ˜¯å­—å…¸ <code>wordDict</code> ä¸­çš„ä¸€ä¸ªå•è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ–­å®š <code>s</code> çš„å‰ <code>i</code> ä¸ªå­—ç¬¦ <code>s[0...i-1]</code> æ˜¯å¯ä»¥è¢«æˆåŠŸæ‹†åˆ†çš„ã€‚æ­¤æ—¶ï¼Œ<code>dp[i]</code> å°±åº”è¯¥ä¸º <code>true</code>ã€‚</p>
<p>æ‰€ä»¥ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯ä»¥è¡¨ç¤ºä¸ºï¼š<br>
<code>dp[i] = OR (dp[j] &amp;&amp; wordDict.contains(s[j...i-1]))</code> å¯¹äºæ‰€æœ‰ <code>0 &lt;= j &lt; i</code>ã€‚</p>
<p>ç”¨æ›´æ˜“æ‡‚çš„è¯­è¨€æ¥è¯´ï¼š<code>dp[i]</code> ä¸ºçœŸï¼Œå½“ä¸”ä»…å½“ï¼Œå­˜åœ¨ä¸€ä¸ª <code>j</code>ï¼ˆ<code>j</code> åœ¨ <code>0</code> å’Œ <code>i-1</code> ä¹‹é—´ï¼‰ï¼Œä½¿å¾— <code>dp[j]</code> ä¸ºçœŸï¼Œå¹¶ä¸”ä» <code>j</code> åˆ° <code>i-1</code> çš„é‚£æ®µå­å­—ç¬¦ä¸² <code>s[j:i]</code> æ­£å¥½æ˜¯å­—å…¸é‡Œçš„ä¸€ä¸ªå•è¯ã€‚</p>
<p>åªè¦æˆ‘ä»¬èƒ½æ‰¾åˆ°<strong>ä»»ä½•ä¸€ä¸ª</strong>è¿™æ ·çš„ <code>j</code>ï¼Œ<code>dp[i]</code> å°±å¯ä»¥è¢«è®¾ç½®ä¸º <code>true</code>ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åœæ­¢å¯¹å½“å‰ <code>i</code> çš„æ£€æŸ¥ï¼ˆå› ä¸ºå·²ç»æ‰¾åˆ°ä¸€ç§æ‹†åˆ†æ–¹æ³•äº†ï¼‰ã€‚</p>
<h3 id="3-åˆå§‹åŒ–">3. åˆå§‹åŒ–</h3>
<ul>
<li><code>dp[0] = true</code>ï¼šå¦‚å‰æ‰€è¿°ï¼Œè¿™æ˜¯åŸºç¡€æƒ…å†µã€‚</li>
<li><code>dp</code> æ•°ç»„çš„å…¶ä»–æ‰€æœ‰å…ƒç´ ï¼ˆ<code>dp[1]</code> åˆ° <code>dp[n]</code>ï¼‰åœ¨å¼€å§‹è®¡ç®—å‰ï¼Œå¯ä»¥é»˜è®¤ä¸º <code>false</code>ã€‚</li>
</ul>
<h3 id="4-éå†é¡ºåº">4. éå†é¡ºåº</h3>
<ul>
<li>å¤–å±‚å¾ªç¯ï¼šæˆ‘ä»¬éœ€è¦è®¡ç®— <code>dp[1], dp[2], ..., dp[n]</code>ã€‚æ‰€ä»¥ <code>i</code> ä» <code>1</code> éå†åˆ° <code>n</code>ã€‚</li>
<li>å†…å±‚å¾ªç¯ï¼šå¯¹äºæ¯ä¸€ä¸ª <code>dp[i]</code>ï¼Œæˆ‘ä»¬éœ€è¦å°è¯•æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²ç‚¹ <code>j</code>ã€‚æ‰€ä»¥ <code>j</code> ä» <code>0</code> éå†åˆ° <code>i-1</code>ã€‚</li>
</ul>
<h3 id="ä¸¾ä¸ªä¾‹å­">ä¸¾ä¸ªä¾‹å­</h3>
<p>è®©æˆ‘ä»¬ç”¨ <code>s = &quot;leetcode&quot;</code>, <code>wordDict = [&quot;leet&quot;, &quot;code&quot;]</code> æ¥æ¨¡æ‹Ÿä¸€ä¸‹ï¼š</p>
<ul>
<li><code>n = 8</code> (å­—ç¬¦ä¸² â€œleetcodeâ€ çš„é•¿åº¦)</li>
<li><code>dp</code> æ•°ç»„å¤§å°ä¸º <code>9</code> (<code>dp[0]</code> åˆ° <code>dp[8]</code>)</li>
<li><code>wordDictSet = &#123;&quot;leet&quot;: true, &quot;code&quot;: true&#125;</code> (ä¸ºäº†å¿«é€ŸæŸ¥æ‰¾ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæŠŠå­—å…¸è½¬æˆå“ˆå¸Œé›†åˆ)</li>
</ul>
<p><strong>åˆå§‹åŒ–ï¼š</strong><br>
<code>dp[0] = true</code><br>
<code>dp[1...8]</code> åˆå§‹åŒ–ä¸º <code>false</code></p>
<p><strong>è®¡ç®— <code>dp[i]</code>:</strong></p>
<ul>
<li>
<p><strong>i = 1</strong> (<code>s[0:1]</code> = â€œlâ€):</p>
<ul>
<li><code>j = 0</code>: <code>dp[0]</code> (true) &amp;&amp; <code>wordDictSet[&quot;l&quot;]</code> (false)</li>
<li><code>dp[1]</code> = false</li>
</ul>
</li>
<li>
<p><strong>i = 2</strong> (<code>s[0:2]</code> = â€œleâ€):</p>
<ul>
<li><code>j = 0</code>: <code>dp[0]</code> (true) &amp;&amp; <code>wordDictSet[&quot;le&quot;]</code> (false)</li>
<li><code>j = 1</code>: <code>dp[1]</code> (false) &amp;&amp; <code>wordDictSet[&quot;e&quot;]</code> (false)</li>
<li><code>dp[2]</code> = false</li>
</ul>
</li>
<li>
<p><strong>i = 3</strong> (<code>s[0:3]</code> = â€œleeâ€):</p>
<ul>
<li>â€¦</li>
<li><code>dp[3]</code> = false</li>
</ul>
</li>
<li>
<p><strong>i = 4</strong> (<code>s[0:4]</code> = â€œleetâ€):</p>
<ul>
<li><code>j = 0</code>: <code>dp[0]</code> (true) &amp;&amp; <code>wordDictSet[&quot;leet&quot;]</code> (true)  -&gt; æ¡ä»¶æ»¡è¶³ï¼</li>
<li><code>dp[4]</code> = true (è·³å‡ºå†…å±‚ j çš„å¾ªç¯)</li>
</ul>
</li>
<li>
<p><strong>i = 5</strong> (<code>s[0:5]</code> = â€œleetcâ€):</p>
<ul>
<li><code>j = 0</code>: <code>dp[0]</code> (true) &amp;&amp; <code>wordDictSet[&quot;leetc&quot;]</code> (false)</li>
<li><code>j = 1</code>: <code>dp[1]</code> (false) &amp;&amp; <code>wordDictSet[&quot;eetc&quot;]</code> (false)</li>
<li>â€¦</li>
<li><code>j = 4</code>: <code>dp[4]</code> (true) &amp;&amp; <code>wordDictSet[&quot;c&quot;]</code> (false)</li>
<li><code>dp[5]</code> = false</li>
</ul>
</li>
<li>
<p>â€¦ (ä»¥æ­¤ç±»æ¨)</p>
</li>
<li>
<p><strong>i = 8</strong> (<code>s[0:8]</code> = â€œleetcodeâ€):</p>
<ul>
<li><code>j = 0</code>: <code>dp[0]</code> (true) &amp;&amp; <code>wordDictSet[&quot;leetcode&quot;]</code> (false)</li>
<li><code>j = 1</code>: â€¦</li>
<li>â€¦</li>
<li><code>j = 4</code>: <code>dp[4]</code> (true) &amp;&amp; <code>wordDictSet[s[4:8]]</code> (<code>wordDictSet[&quot;code&quot;]</code>) (true) -&gt; æ¡ä»¶æ»¡è¶³ï¼</li>
<li><code>dp[8]</code> = true (è·³å‡ºå†…å±‚ j çš„å¾ªç¯)</li>
</ul>
</li>
</ul>
<p>æœ€ç»ˆï¼Œæˆ‘ä»¬å¾—åˆ° <code>dp[8] = true</code>ï¼Œè¿™å°±æ˜¯é¢˜ç›®çš„ç­”æ¡ˆã€‚</p>
<h2 id="ä»£ç å®ç°-Go">ä»£ç å®ç° (Go)</h2>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨ Go è¯­è¨€å®ç°çš„ <code>wordBreak</code> å‡½æ•°ï¼Œå…¶ä¸­åŒ…å«äº†è¯¦ç»†çš„æ³¨é‡Šã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc app=leetcode.cn id=139 lang=golang</span></span><br><span class="line"><span class="comment">// [139] å•è¯æ‹†åˆ†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wordBreak</span><span class="params">(s <span class="type">string</span>, wordDict []<span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="comment">// 1. å°†è¯å…¸è½¬æ¢ä¸ºå“ˆå¸Œé›†åˆï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾å•è¯æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">	<span class="comment">// wordDictSet ç”¨äºå­˜å‚¨è¯å…¸ä¸­çš„æ‰€æœ‰å•è¯ã€‚</span></span><br><span class="line">	<span class="comment">// é”®æ˜¯å•è¯æœ¬èº«ï¼Œå€¼æ˜¯å¸ƒå°”ç±»å‹çš„ trueï¼Œè¡¨ç¤ºè¯¥å•è¯åœ¨å­—å…¸ä¸­ã€‚</span></span><br><span class="line">	<span class="comment">// ä½¿ç”¨ map (å“ˆå¸Œè¡¨) å®ç°é›†åˆï¼Œå¯ä»¥ä½¿å¾—æŸ¥æ‰¾å•è¯çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(L)ï¼Œå…¶ä¸­ L æ˜¯å•è¯é•¿åº¦ã€‚</span></span><br><span class="line">	wordDictSet := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span>)</span><br><span class="line">	<span class="keyword">for</span> _, word := <span class="keyword">range</span> wordDict &#123; <span class="comment">// éå†è¯å…¸ä¸­çš„æ¯ä¸ªå•è¯ word</span></span><br><span class="line">		wordDictSet[word] = <span class="literal">true</span> <span class="comment">// å°†å•è¯ word æ·»åŠ åˆ°å“ˆå¸Œé›†åˆä¸­</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	n := <span class="built_in">len</span>(s) <span class="comment">// è·å–è¾“å…¥å­—ç¬¦ä¸² s çš„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. å®šä¹‰ DP æ•°ç»„</span></span><br><span class="line">	<span class="comment">// dp[i] è¡¨ç¤ºå­—ç¬¦ä¸² s çš„å‰ i ä¸ªå­—ç¬¦ (å³å­ä¸² s[0...i-1]) </span></span><br><span class="line">	<span class="comment">// æ˜¯å¦å¯ä»¥è¢«è¯å…¸ä¸­çš„å•è¯æˆåŠŸæ‹†åˆ†ã€‚</span></span><br><span class="line">	<span class="comment">// dp æ•°ç»„çš„å¤§å°ä¸º n+1ï¼Œç´¢å¼•ä» 0 åˆ° nã€‚</span></span><br><span class="line">	<span class="comment">// dp[0] å¯¹åº”ç©ºå­—ç¬¦ä¸²ã€‚</span></span><br><span class="line">	<span class="comment">// dp[n] å¯¹åº”æ•´ä¸ªå­—ç¬¦ä¸² sã€‚</span></span><br><span class="line">	dp := <span class="built_in">make</span>([]<span class="type">bool</span>, n+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. åˆå§‹åŒ– DP æ•°ç»„</span></span><br><span class="line">	<span class="comment">// dp[0] = trueï¼Œå› ä¸ºç©ºå­—ç¬¦ä¸²æ€»æ˜¯å¯ä»¥è¢«&quot;æ‹†åˆ†&quot;çš„ï¼Œè¿™æ˜¯åŠ¨æ€è§„åˆ’çš„åŸºç¡€ã€‚</span></span><br><span class="line">	dp[<span class="number">0</span>] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. çŠ¶æ€è½¬ç§»ï¼šå¡«å…… DP æ•°ç»„</span></span><br><span class="line">	<span class="comment">// å¤–å±‚å¾ªç¯ i ä» 1 åˆ° nã€‚dp[i] å¯¹åº” s çš„å‰ i ä¸ªå­—ç¬¦ (s[0...i-1])ã€‚</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;</span><br><span class="line">		<span class="comment">// å†…å±‚å¾ªç¯ j ä» 0 åˆ° i-1ã€‚j æ˜¯ä¸€ä¸ªæ½œåœ¨çš„åˆ†å‰²ç‚¹ã€‚</span></span><br><span class="line">		<span class="comment">// æˆ‘ä»¬å°è¯•å°† s[0...i-1] åˆ†å‰²ä¸º s[0...j-1] å’Œ s[j...i-1]ã€‚</span></span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; i; j++ &#123;</span><br><span class="line">			<span class="comment">// s[j:i] åœ¨ Go ä¸­è¡¨ç¤ºä»ç´¢å¼• j (åŒ…å«) åˆ°ç´¢å¼• i (ä¸åŒ…å«) çš„å­ä¸²ï¼Œ</span></span><br><span class="line">			<span class="comment">// ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢åˆ†æçš„ s[j...i-1]ã€‚</span></span><br><span class="line">			<span class="comment">// æ£€æŸ¥ä¸¤ä¸ªæ¡ä»¶ï¼š</span></span><br><span class="line">			<span class="comment">// 1. dp[j] is true: å­—ç¬¦ä¸² s çš„å‰ j ä¸ªå­—ç¬¦ s[0...j-1] å¯ä»¥è¢«æ‹†åˆ†ã€‚</span></span><br><span class="line">			<span class="comment">// 2. wordDictSet[s[j:i]] is true: å­ä¸² s[j...i-1] æ˜¯å­—å…¸ä¸­çš„ä¸€ä¸ªå•è¯ã€‚</span></span><br><span class="line">			<span class="keyword">if</span> dp[j] &amp;&amp; wordDictSet[s[j:i]] &#123;</span><br><span class="line">				dp[i] = <span class="literal">true</span> <span class="comment">// å¦‚æœä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œåˆ™ s çš„å‰ i ä¸ªå­—ç¬¦ s[0...i-1] å¯ä»¥è¢«æ‹†åˆ†ã€‚</span></span><br><span class="line">				<span class="keyword">break</span>        <span class="comment">// å·²ç»æ‰¾åˆ°äº†ä¸€ä¸ªæœ‰æ•ˆçš„æ‹†åˆ†æ–¹å¼ï¼Œæ— éœ€ç»§ç»­æ£€æŸ¥å…¶ä»–åˆ†å‰²ç‚¹ jï¼Œè·³å‡ºå†…å±‚å¾ªç¯ã€‚</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 5. è¿”å›ç»“æœ</span></span><br><span class="line">	<span class="comment">// dp[n] å­˜å‚¨äº†æ•´ä¸ªå­—ç¬¦ä¸² s (å³ s[0...n-1]) æ˜¯å¦å¯ä»¥è¢«æ‹†åˆ†çš„ç»“æœã€‚</span></span><br><span class="line">	<span class="keyword">return</span> dp[n]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> <code>O(n^3)</code></p>
<ul>
<li>æˆ‘ä»¬æœ‰ä¸¤å±‚åµŒå¥—å¾ªç¯ï¼šå¤–å±‚å¾ªç¯ <code>i</code> ä» <code>1</code> åˆ° <code>n</code>ï¼Œå†…å±‚å¾ªç¯ <code>j</code> ä» <code>0</code> åˆ° <code>i-1</code>ã€‚è¿™éƒ¨åˆ†æ˜¯ <code>O(n^2)</code> æ¬¡è¿­ä»£ã€‚</li>
<li>åœ¨å†…å±‚å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œäº† <code>s[j:i]</code> æ¥è·å–å­ä¸²ï¼Œå¹¶åœ¨ <code>wordDictSet</code> ä¸­æŸ¥æ‰¾å®ƒã€‚</li>
<li>åœ¨ Go ä¸­ï¼Œå­—ç¬¦ä¸²åˆ‡ç‰‡ <code>s[j:i]</code> çš„æ“ä½œæœ¬èº«æ˜¯ <code>O(1)</code> çš„ï¼Œå› ä¸ºå®ƒåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæŒ‡å‘åŸå§‹å­—ç¬¦ä¸²æ•°æ®çš„è§†å›¾ï¼Œå¹¶ä¸å¤åˆ¶å­—ç¬¦æ•°æ®ã€‚</li>
<li>å“ˆå¸Œè¡¨ï¼ˆ<code>map</code>ï¼‰æŸ¥æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸² <code>key</code> çš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(length of key)</code>ã€‚åœ¨è¿™é‡Œï¼Œ<code>key</code> æ˜¯å­ä¸² <code>s[j:i]</code>ï¼Œå…¶é•¿åº¦æœ€å¤§å¯ä»¥è¾¾åˆ° <code>i</code>ï¼Œä¹Ÿå°±æ˜¯ <code>O(n)</code>ã€‚</li>
<li>å› æ­¤ï¼Œå†…å±‚å¾ªç¯ä¸­çš„æ“ä½œ <code>wordDictSet[s[j:i]]</code> æœ€åæƒ…å†µä¸‹æ˜¯ <code>O(n)</code>ã€‚</li>
<li>æ‰€ä»¥æ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(n^2 * n) = O(n^3)</code>ã€‚</li>
<li>æ›´ç²¾ç¡®åœ°å†™å‡ºæ¨å¯¼è¿‡ç¨‹ï¼š<br>
[ T(n) = \sum_{i=1}^{n} \sum_{j=0}^{i-1} O(i-j) ]<br>
å…¶ä¸­ ( O(i-j) ) æ˜¯æŸ¥æ‰¾é•¿åº¦ä¸º ( i-j ) çš„å­ä¸²çš„æˆæœ¬ã€‚<br>
[ T(n) = \sum_{i=1}^{n} \sum_{k=1}^{i} O(k) = \sum_{i=1}^{n} O(i^2) = O(n^3) ]</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong> <code>O(n + M)</code></p>
<ul>
<li><code>dp</code> æ•°ç»„ï¼šéœ€è¦ <code>O(n)</code> çš„ç©ºé—´ï¼Œå…¶ä¸­ <code>n</code> æ˜¯å­—ç¬¦ä¸² <code>s</code> çš„é•¿åº¦ã€‚</li>
<li><code>wordDictSet</code> å“ˆå¸Œé›†åˆï¼šéœ€è¦å­˜å‚¨å­—å…¸ä¸­çš„æ‰€æœ‰å•è¯ã€‚å¦‚æœå­—å…¸ä¸­æœ‰ <code>k</code> ä¸ªå•è¯ï¼Œå¹³å‡é•¿åº¦ä¸º <code>L</code>ï¼Œé‚£ä¹ˆç©ºé—´å¤æ‚åº¦æ˜¯ <code>O(k * L)</code>ã€‚åœ¨é¢˜ç›®çº¦æŸä¸‹ï¼Œ<code>wordDict.length &lt;= 1000</code>, <code>wordDict[i].length &lt;= 20</code>ï¼Œæ‰€ä»¥ <code>M</code> æœ€å¤§çº¦ä¸º <code>1000 * 20</code>ã€‚é€šå¸¸æˆ‘ä»¬æŠŠè¿™ä¸ªè¡¨ç¤ºä¸º <code>O(M)</code>ï¼Œå…¶ä¸­ <code>M</code> æ˜¯å­—å…¸ä¸­æ‰€æœ‰å­—ç¬¦çš„æ€»æ•°ã€‚</li>
<li>æ‰€ä»¥æ€»ç©ºé—´å¤æ‚åº¦æ˜¯ <code>O(n + M)</code>ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li><strong>åŠ¨æ€è§„åˆ’çš„è¯†åˆ«</strong>ï¼šå½“é—®é¢˜å¯ä»¥åˆ†è§£ä¸ºå…·æœ‰é‡å æ€§è´¨çš„å­é—®é¢˜ï¼Œå¹¶ä¸”å­é—®é¢˜çš„è§£å¯ä»¥ç”¨æ¥æ„å»ºåŸé—®é¢˜çš„è§£æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨åŠ¨æ€è§„åˆ’ã€‚</li>
<li><strong>DP çŠ¶æ€å®šä¹‰</strong>ï¼šæ¸…æ™°åœ°å®šä¹‰ <code>dp[i]</code> çš„å«ä¹‰è‡³å…³é‡è¦ã€‚åœ¨è¿™é‡Œï¼Œ<code>dp[i]</code> ä»£è¡¨&quot;å­—ç¬¦ä¸²çš„å‰ <code>i</code> ä¸ªå­—ç¬¦æ˜¯å¦å¯åˆ†&quot;ã€‚</li>
<li><strong>Base Case (åˆå§‹æ¡ä»¶)</strong>ï¼š<code>dp[0] = true</code> æ˜¯æœ¬é¢˜ DP èƒ½å¤Ÿæ­£ç¡®é€’æ¨çš„å…³é”®ã€‚</li>
<li><strong>çŠ¶æ€è½¬ç§»</strong>ï¼šä»”ç»†æ€è€ƒå¦‚ä½•ä»å·²çŸ¥çš„å­é—®é¢˜è§£ï¼ˆä¾‹å¦‚ <code>dp[j]</code>ï¼‰æ¨å¯¼å‡ºå½“å‰é—®é¢˜è§£ï¼ˆä¾‹å¦‚ <code>dp[i]</code>ï¼‰ã€‚</li>
<li><strong>æ•°æ®ç»“æ„è¾…åŠ©</strong>ï¼šå°† <code>wordDict</code> è½¬æ¢ä¸ºå“ˆå¸Œé›†åˆ <code>wordDictSet</code> æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¼˜åŒ–æŠ€å·§ï¼Œå¯ä»¥å°†å•è¯æŸ¥æ‰¾æ—¶é—´ä» <code>O(num_words_in_dict * word_length)</code>ï¼ˆå¦‚æœçº¿æ€§æ‰«æåˆ—è¡¨ï¼‰é™ä½åˆ°å¹³å‡ <code>O(word_length)</code>ã€‚</li>
</ul>
<p>è¿™é“&quot;å•è¯æ‹†åˆ†&quot;é—®é¢˜æ˜¯åŠ¨æ€è§„åˆ’åœ¨å­—ç¬¦ä¸²å¤„ç†ä¸­çš„ä¸€ä¸ªç»å…¸åº”ç”¨ï¼Œç†è§£å®ƒæœ‰åŠ©äºæŒæ¡ DP çš„åŸºæœ¬æ€æƒ³ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>å­—ç¬¦ä¸²</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 152 - ä¹˜ç§¯æœ€å¤§å­æ•°ç»„ (Maximum Product Subarray)</title>
    <url>/2025/05/17/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-152-%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ æ‰¾å‡ºæ•°ç»„ä¸­ä¹˜ç§¯æœ€å¤§çš„éç©ºè¿ç»­å­æ•°ç»„ï¼ˆè¯¥å­æ•°ç»„ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°å­—ï¼‰ï¼Œå¹¶è¿”å›è¯¥å­æ•°ç»„æ‰€å¯¹åº”çš„ä¹˜ç§¯ã€‚</p>
<p>æµ‹è¯•ç”¨ä¾‹çš„ç­”æ¡ˆæ˜¯ä¸€ä¸ª 32-ä½ æ•´æ•°ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [2,3,-2,4]</span><br><span class="line">è¾“å‡º: 6</span><br><span class="line">è§£é‡Š: å­æ•°ç»„ [2,3] æœ‰æœ€å¤§ä¹˜ç§¯ 6ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [-2,0,-1]</span><br><span class="line">è¾“å‡º: 0</span><br><span class="line">è§£é‡Š: ç»“æœä¸èƒ½ä¸º 2, å› ä¸º [-2,-1] ä¸æ˜¯å­æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶:</strong></p>
<ul>
<li><code>1 &lt;= nums.length &lt;= 2 * 10^4</code></li>
<li><code>-10 &lt;= nums[i] &lt;= 10</code></li>
<li><code>nums</code> çš„ä»»ä½•å‰ç¼€æˆ–åç¼€çš„ä¹˜ç§¯éƒ½ä¿è¯æ˜¯ä¸€ä¸ª 32-ä½ æ•´æ•°ã€‚</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’æ¥è§£å†³ã€‚æˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸¤ä¸ªå˜é‡ï¼šåˆ°å½“å‰ä½ç½®ä¸ºæ­¢çš„æœ€å¤§ä¹˜ç§¯å’Œæœ€å°ä¹˜ç§¯ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦ç»´æŠ¤æœ€å°ä¹˜ç§¯å‘¢ï¼Ÿå› ä¸ºå½“é‡åˆ°ä¸€ä¸ªè´Ÿæ•°æ—¶ï¼Œä¹‹å‰çš„æœ€å°ä¹˜ç§¯ä¹˜ä»¥è¿™ä¸ªè´Ÿæ•°å¯èƒ½ä¼šå˜æˆæœ€å¤§ä¹˜ç§¯ï¼ŒåŒæ ·ï¼Œä¹‹å‰çš„æœ€å¤§ä¹˜ç§¯ä¹˜ä»¥è¿™ä¸ªè´Ÿæ•°å¯èƒ½ä¼šå˜æˆæœ€å°ä¹˜ç§¯ã€‚</p>
<p>æˆ‘ä»¬å®šä¹‰ <code>maxDp[i]</code> ä¸ºä»¥ <code>nums[i]</code> ç»“å°¾çš„è¿ç»­å­æ•°ç»„çš„æœ€å¤§ä¹˜ç§¯ï¼Œ<code>minDp[i]</code> ä¸ºä»¥ <code>nums[i]</code> ç»“å°¾çš„è¿ç»­å­æ•°ç»„çš„æœ€å°ä¹˜ç§¯ã€‚</p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>maxDp[i] = max(nums[i], nums[i] * maxDp[i-1], nums[i] * minDp[i-1])</code></li>
<li><code>minDp[i] = min(nums[i], nums[i] * maxDp[i-1], nums[i] * minDp[i-1])</code></li>
</ul>
<p>æœ€ç»ˆçš„ç»“æœæ˜¯æ‰€æœ‰ <code>maxDp[i]</code> ä¸­çš„æœ€å¤§å€¼ã€‚</p>
<p>ä¸ºäº†ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ° <code>maxDp[i]</code> å’Œ <code>minDp[i]</code> åªä¾èµ–äº <code>maxDp[i-1]</code> å’Œ <code>minDp[i-1]</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ»šåŠ¨æ•°ç»„çš„æ€æƒ³ï¼Œåªç”¨ä¸¤ä¸ªå˜é‡æ¥å­˜å‚¨å‰ä¸€ä¸ªçŠ¶æ€çš„æœ€å¤§å’Œæœ€å°ä¹˜ç§¯ã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>æˆ‘ä»¬åˆå§‹åŒ– <code>maxProductSoFar</code> å’Œ <code>minProductSoFar</code> ä¸º <code>nums[0]</code>ï¼ŒåŒæ—¶åˆå§‹åŒ– <code>maxAns</code> ä¸º <code>nums[0]</code>ã€‚<br>
ç„¶åä»æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹éå†ï¼š<br>
å¯¹äºæ¯ä¸ªå…ƒç´  <code>nums[i]</code>ï¼š</p>
<ol>
<li>è®¡ç®—å½“å‰çš„ <code>currentMax = max(nums[i], nums[i] * prevMax, nums[i] * prevMin)</code></li>
<li>è®¡ç®—å½“å‰çš„ <code>currentMin = min(nums[i], nums[i] * prevMax, nums[i] * prevMin)</code></li>
<li>æ›´æ–° <code>maxAns = max(maxAns, currentMax)</code></li>
<li>æ›´æ–° <code>prevMax = currentMax</code>ï¼Œ<code>prevMin = currentMin</code></li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=152 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [152] ä¹˜ç§¯æœ€å¤§å­æ•°ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxProduct</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	maxDp := nums[<span class="number">0</span>] <span class="comment">// ä»¥å½“å‰å…ƒç´ ç»“å°¾çš„æœ€å¤§ä¹˜ç§¯</span></span><br><span class="line">	minDp := nums[<span class="number">0</span>] <span class="comment">// ä»¥å½“å‰å…ƒç´ ç»“å°¾çš„æœ€å°ä¹˜ç§¯</span></span><br><span class="line">	maxAns := nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">		<span class="comment">// å½“ nums[i] &lt; 0 æ—¶ï¼Œæœ€å¤§å€¼å’Œæœ€å°å€¼ä¼šäº’æ¢</span></span><br><span class="line">		<span class="comment">// æ‰€ä»¥éœ€è¦ä¸€ä¸ªä¸´æ—¶å˜é‡å­˜å‚¨ä¹‹å‰çš„ maxDp</span></span><br><span class="line">		prevMaxDp := maxDp</span><br><span class="line">		maxDp = maxx(nums[i], nums[i]*maxDp, nums[i]*minDp)</span><br><span class="line">		minDp = minn(nums[i], nums[i]*prevMaxDp, nums[i]*minDp) <span class="comment">// æ³¨æ„è¿™é‡Œç”¨ prevMaxDp</span></span><br><span class="line">		maxAns = max(maxAns, maxDp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> maxAns</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxx</span><span class="params">(a ...<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	maxAns := a[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">		<span class="keyword">if</span> v &gt; maxAns &#123;</span><br><span class="line">			maxAns = v</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> maxAns</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minn</span><span class="params">(a ...<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	minAns := a[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">		<span class="keyword">if</span> v &lt; minAns &#123;</span><br><span class="line">			minAns = v</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> minAns</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ–¹æ³•ä¸€ (åŠ¨æ€è§„åˆ’)</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(1)$ (ä½¿ç”¨æ»šåŠ¨å˜é‡ä¼˜åŒ–å)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>æ€è·¯æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œå®ç°</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦æ³¨æ„è´Ÿæ•°å¸¦æ¥çš„å½±å“</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: $O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ•°ç»„ <code>nums</code> çš„é•¿åº¦ã€‚æˆ‘ä»¬åªéœ€è¦éå†æ•°ç»„ä¸€æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: $O(1)$ã€‚æˆ‘ä»¬åªä½¿ç”¨äº†å¸¸æ•°ä¸ªå˜é‡æ¥å­˜å‚¨ä¸­é—´ç»“æœã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li>åŠ¨æ€è§„åˆ’é—®é¢˜ä¸­ï¼ŒçŠ¶æ€çš„å®šä¹‰è‡³å…³é‡è¦ã€‚</li>
<li>å¤„ç†ä¹˜ç§¯é—®é¢˜æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„è´Ÿæ•°çš„å½±å“ï¼Œè´Ÿè´Ÿå¾—æ­£å¯èƒ½ä½¿å¾—ä¸€ä¸ªå¾ˆå°çš„è´Ÿæ•°å˜æˆä¸€ä¸ªå¾ˆå¤§çš„æ­£æ•°ã€‚</li>
<li>ç»´æŠ¤æœ€å¤§å€¼çš„åŒæ—¶ï¼Œå¾€å¾€ä¹Ÿéœ€è¦ç»´æŠ¤æœ€å°å€¼ï¼Œä»¥åº”å¯¹è´Ÿæ•°çš„æƒ…å†µã€‚</li>
<li>ç©ºé—´å¤æ‚åº¦å¯ä»¥é€šè¿‡æ»šåŠ¨æ•°ç»„æˆ–åªä¿ç•™å‰ä¸€ä¸ªçŠ¶æ€çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL æ­»é”äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</title>
    <url>/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/</url>
    <content><![CDATA[<h1>MySQL æ­»é”äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</h1>
<p>åœ¨æ•°æ®åº“çš„ä¸–ç•Œé‡Œï¼Œâ€œæ­»é”&quot;æ˜¯ä¸ªæ—¶ä¸æ—¶ä¼šå‡ºæ¥æ£ä¹±çš„å®¶ä¼™ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªæ“ä½œäº’ç›¸ç­‰ç€å¯¹æ–¹æ‰‹é‡Œçš„&quot;ä¸œè¥¿â€ï¼ˆæ¯”å¦‚æ•°æ®ï¼‰ï¼Œç»“æœè°ä¹ŸåŠ¨ä¸äº†ï¼Œåƒäº¤é€šå µå¡ä¸€æ ·å¡ä½äº†ã€‚è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¸€ä¸ªè®¢å•ç³»ç»Ÿçš„å®é™…ä¾‹å­ï¼ŒèŠèŠæ­»é”æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Œä»¥åŠæ€ä¹ˆå°½é‡é¿å…å®ƒã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿé‡Œæœ‰æ–°å¢ã€ä¿®æ”¹ã€æŸ¥è¯¢è®¢å•è¿™äº›åŠŸèƒ½ã€‚ä¸ºäº†ä¿è¯æ¯ä¸ªè®¢å•éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼ˆæ¯”å¦‚é˜²æ­¢ç”¨æˆ·æ‰‹å¿«ï¼Œé‡å¤æäº¤äº†åŒä¸€ä¸ªè®¢å•ï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨åˆ›å»ºæ–°è®¢å•å‰åšä¸ª&quot;å¹‚ç­‰æ€§æ ¡éªŒ&quot;ã€‚å¸¸è§„æ“ä½œæ˜¯ï¼šå…ˆç”¨ <code>select ... for update</code> è¯­å¥æŸ¥ä¸€ä¸‹è¿™ä¸ªè®¢å•å·æ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨äº†ã€‚è¿™ä¸ª <code>for update</code> å¾ˆå…³é”®ï¼Œå®ƒä¼šå°è¯•æš‚æ—¶&quot;é”å®š&quot;æˆ‘ä»¬è¦æ£€æŸ¥çš„è®¢å•å·ï¼ˆæˆ–è€…å®ƒå¯èƒ½å­˜åœ¨çš„ä½ç½®ï¼‰ï¼Œç›®çš„æ˜¯é˜²æ­¢åœ¨æˆ‘ä»¬æ£€æŸ¥å’Œæ’å…¥çš„çŸ­æš‚é—´éš™ï¼Œæœ‰å…¶ä»–æ“ä½œä¹Ÿæ¥æ’åŒä¸€ä¸ªè®¢å•å·ã€‚å¦‚æœæŸ¥ä¸‹æ¥å‘ç°è®¢å•ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ‰çœŸæ­£åŠ¨æ‰‹æ’å…¥è¿™æ¡æ–°è®¢å•è®°å½•ã€‚</p>
<p>å¬èµ·æ¥æŒºç¨³å¦¥ï¼Œå¯¹å§ï¼Ÿä½†åœ¨ä¸šåŠ¡é‡ä¸€å¤§ï¼Œå¹¶å‘æ“ä½œï¼ˆå¾ˆå¤šç”¨æˆ·åŒæ—¶æ“ä½œï¼‰ä¸€å¤šçš„æ—¶å€™ï¼Œè¿™ç§åšæ³•æœ‰æ—¶å°±ä¼šä¸å°å¿ƒè§¦å‘æ­»é”ã€‚</p>
<p>åˆ«æ‹…å¿ƒï¼Œä¸‹é¢æˆ‘ä»¬å°±ä¸€æ­¥æ­¥æ‹†è§£<strong>æ­»é”æ˜¯æ€ä¹ˆæ¥çš„ï¼Œä»¥åŠæœ‰å“ªäº›æ‹›æ•°å¯ä»¥å¯¹ä»˜å®ƒ</strong>ã€‚</p>
<h2 id="æ­»é”çš„å‘ç”Ÿ">æ­»é”çš„å‘ç”Ÿ</h2>
<p>æœ¬æ¬¡æ¡ˆä¾‹æˆ‘ä»¬ç”¨çš„æ˜¯ MySQL æ•°æ®åº“ï¼Œå­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼ˆä¸€ç§å¸¸ç”¨çš„æ•°æ®&quot;ä»“åº“ç®¡ç†å‘˜&quot;ï¼‰ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾å®šä¸ºå¯é‡å¤è¯»ï¼ˆRepeatable Read, RRï¼Œä¸€ç§äº‹åŠ¡å¤„ç†è§„åˆ™ï¼Œä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œå¤šæ¬¡è¯»å–åŒæ ·çš„æ•°æ®ï¼Œç»“æœæ˜¯ä¸€è‡´çš„ï¼‰ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ç”¨å®é™…æ“ä½œå¸¦å¤§å®¶çœ‹çœ‹æ­»é”æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ã€‚</p>
<p>æˆ‘å»ºäº†ä¸€å¼ è®¢å•è¡¨ <code>t_order</code>ï¼Œç»“æ„å¦‚ä¸‹ï¼Œå…¶ä¸­ <code>id</code> å­—æ®µæ˜¯ä¸»é”®ï¼ˆå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•ï¼‰ï¼Œ<code>order_no</code> å­—æ®µå»ºäº†ä¸ªæ™®é€šç´¢å¼•ï¼ˆéå”¯ä¸€ç´¢å¼•ï¼Œå¯ä»¥åŠ å¿«æŒ‰è®¢å•å·æŸ¥è¯¢çš„é€Ÿåº¦ï¼‰ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `t_order` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `order_no` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `create_date` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">  KEY `index_order` (`order_no`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB ;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œ<code>t_order</code> è¡¨é‡Œç°åœ¨å·²ç»æœ‰äº† 6 æ¡è®°å½•ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>order_no</th>
<th>create_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1001</td>
<td>2021-12-28 13:59:07</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>2021-12-28 13:59:14</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>2021-12-28 13:59:21</td>
</tr>
<tr>
<td>4</td>
<td>1004</td>
<td>2021-12-28 13:59:30</td>
</tr>
<tr>
<td>5</td>
<td>1005</td>
<td>2021-12-28 13:59:36</td>
</tr>
<tr>
<td>6</td>
<td>1006</td>
<td>2021-12-28 14:24:33</td>
</tr>
</tbody>
</table>
<p>å‡è®¾è¿™æ—¶æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ä¸šåŠ¡æ“ä½œæµç¨‹ï¼‰ï¼Œä¸€ä¸ªäº‹åŠ¡ï¼ˆæˆ‘ä»¬å«å®ƒäº‹åŠ¡Aï¼‰è¦æ’å…¥è®¢å•å·ä¸º 1007 çš„è®¢å•ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ï¼ˆäº‹åŠ¡Bï¼‰è¦æ’å…¥è®¢å•å·ä¸º 1008 çš„è®¢å•ã€‚å› ä¸ºéœ€è¦å¯¹è®¢å•åšå¹‚ç­‰æ€§æ ¡éªŒï¼Œæ‰€ä»¥ä¸¤ä¸ªäº‹åŠ¡éƒ½ä¼šå…ˆæŸ¥è¯¢å¯¹åº”çš„è®¢å•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰æ’å…¥è®°å½•ã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747411836905.png" alt="1747411836905"></p>
<p>ä¸Šå›¾çš„æ“ä½œä¸­ï¼Œå¦‚æœæ•°æ®åº“æ²¡æœ‰å¼€å¯æ­»é”æ£€æµ‹æœºåˆ¶ï¼ˆæˆ–è€…æ£€æµ‹éœ€è¦æ—¶é—´ï¼‰ï¼Œä½ å°±ä¼šçœ‹åˆ°ï¼Œä¸¤ä¸ªäº‹åŠ¡éƒ½å¡ä½äº†ï¼Œé™·å…¥äº†ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯æ­»é”ã€‚</p>
<p>è¿™é‡Œåœ¨æŸ¥è¯¢è®¢å•æ˜¯å¦å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬ç‰¹æ„ç”¨äº† <code>select ... for update</code> è¯­å¥ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯&quot;å ä½&quot;ï¼Œå³åœ¨å½“å‰äº‹åŠ¡æ£€æŸ¥å’Œæ’å…¥è®¢å•çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡ä¹Ÿæ¥æ’å…¥ç›¸åŒçš„è®¢å•å·ï¼Œæˆ–è€…å½±å“åˆ°æˆ‘ä»¬æ­£åœ¨åˆ¤æ–­çš„è¿™ä¸ª&quot;ç©ºä½&quot;ã€‚å¦‚æœä¸ç”¨å®ƒï¼Œå°±å¯èƒ½å‡ºç°&quot;å¹»è¯»&quot;ï¼ˆPhantom Readï¼‰çš„é—®é¢˜â€”â€”æ¯”å¦‚æˆ‘ä»¬åˆšæŸ¥å®Œå‘ç°è®¢å•1007ä¸å­˜åœ¨ï¼Œæ­£å‡†å¤‡æ’å…¥ï¼Œç»“æœå¦ä¸€ä¸ªäº‹åŠ¡æŠ¢å…ˆä¸€æ­¥æ’äº†1007ï¼Œå¯¼è‡´æˆ‘ä»¬åç»­æ“ä½œå‡ºé”™ï¼Œæˆ–è€…æœ€ç»ˆç³»ç»Ÿé‡Œæœ‰äº†ä¸¤æ¡è®¢å•1007ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747411844244.png" alt="1747411844244"></p>
<h2 id="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”ï¼Ÿ">ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”ï¼Ÿ</h2>
<p>å‰é¢æåˆ°ï¼Œ<code>select ... for update</code> æ˜¯ä¸ºäº†é˜²æ­¢å¹»è¯»ã€‚åœ¨MySQLçš„InnoDBå­˜å‚¨å¼•æ“å’Œ&quot;å¯é‡å¤è¯»&quot;ï¼ˆRRï¼‰è¿™ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸ºäº†ä»æ ¹æœ¬ä¸Šè§£å†³å¹»è¯»é—®é¢˜ï¼ˆå³åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå‰åä¸¤æ¬¡æ‰§è¡ŒåŒæ ·çš„æŸ¥è¯¢ï¼Œç»“æœé›†å´ä¸ä¸€è‡´ï¼Œåƒå‡ºç°äº†&quot;å¹½çµ&quot;æ•°æ®ä¸€æ ·ï¼‰ï¼Œå¼•å…¥äº†ä¸€ç§ç‰¹æ®Šçš„é”æœºåˆ¶ï¼Œå«åš <strong>next-key é”</strong>ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ç§ç»„åˆé”ï¼Œå®ƒåŒ…å«äº†ä¸¤ç§é”çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>Record Lockï¼ˆè®°å½•é”ï¼‰ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç›´æ¥é”ä½æŸæ¡å…·ä½“çš„è®°å½•æœ¬èº«ã€‚</li>
<li>Gap Lockï¼ˆé—´éš™é”ï¼‰ï¼šå®ƒé”çš„ä¸æ˜¯æŸæ¡å…·ä½“çš„è®°å½•ï¼Œè€Œæ˜¯è®°å½•ä¸è®°å½•ä¹‹é—´çš„&quot;ç©ºæ¡£&quot;æˆ–&quot;ç¼éš™&quot;ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ çš„è¡¨é‡Œæœ‰è®¢å•å·1005å’Œ1009ï¼Œé—´éš™é”å°±èƒ½é”ä½1005å’Œ1009ä¹‹é—´çš„è¿™ä¸ªèŒƒå›´ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸­é—´æ’å…¥æ–°çš„è®¢å•å·ï¼ˆæ¯”å¦‚1007ï¼‰ã€‚è¿™æ ·å°±é¿å…äº†ä½ åœ¨è¿™ä¸ªäº‹åŠ¡é‡Œå‰åä¸¤æ¬¡æŸ¥è¯¢ï¼Œå‘ç°ä¸­é—´çªç„¶å¤šå‡ºæ¥ä¸€æ¡è®°å½•çš„å¹»è¯»æƒ…å†µã€‚</li>
</ul>
<p>é€šå¸¸ï¼Œæˆ‘ä»¬æ‰§è¡Œæ™®é€šçš„ <code>select</code> è¯­å¥æ˜¯ä¸ä¼šåŠ é”çš„ï¼ˆå®ƒé€šè¿‡ä¸€ç§å«åšMVCCçš„æœºåˆ¶æ¥å®ç°&quot;å¿«ç…§è¯»&quot;ï¼Œä¿è¯å¯é‡å¤è¯»ï¼‰ã€‚å¦‚æœæƒ³åœ¨æŸ¥è¯¢æ—¶å°±ç»™è®°å½•åŠ ä¸Šè¡Œé”ï¼ˆä¸€ç§é’ˆå¯¹æ•°æ®è¡Œçš„é”ï¼‰ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸¤ç§æ–¹å¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span>; <span class="comment">-- å¼€å§‹äº‹åŠ¡</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é” (Sé”)</span><br><span class="line"><span class="keyword">select</span> ... lock <span class="keyword">in</span> share mode;</span><br><span class="line"><span class="keyword">commit</span>; <span class="comment">-- æäº¤äº‹åŠ¡ï¼Œé”è¢«é‡Šæ”¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span>; <span class="comment">-- å¼€å§‹äº‹åŠ¡</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> å¯¹è¯»å–çš„è®°å½•åŠ æ’ä»–é” (Xé”)</span><br><span class="line"><span class="keyword">select</span> ... <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">commit</span>; <span class="comment">-- æäº¤äº‹åŠ¡ï¼Œé”è¢«é‡Šæ”¾</span></span><br></pre></td></tr></table></figure>
<p>è¦æ³¨æ„ï¼Œè¡Œé”é€šå¸¸æ˜¯åœ¨æ•´ä¸ªäº‹åŠ¡æäº¤ï¼ˆcommitï¼‰æˆ–å›æ»šï¼ˆrollbackï¼‰åæ‰ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶ä¸æ˜¯æŸä¸€æ¡SQLè¯­å¥æ‰§è¡Œå®Œå°±ç«‹åˆ»æ”¾é”ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢äº‹åŠ¡Açš„æŸ¥è¯¢è¯­å¥ä¼šé”ä½è®¢å•å·å¤§äº2çš„èŒƒå›´ï¼Œå³ <code>(2, +âˆ]</code> è¿™ä¸ªåŒºé—´ã€‚åœ¨äº‹åŠ¡Aæäº¤å‰ï¼Œå¦‚æœæœ‰å…¶ä»–äº‹åŠ¡æƒ³åœ¨è¿™ä¸ªé”ä½çš„èŒƒå›´é‡Œæ’å…¥æ•°æ®ï¼Œå°±ä¼šè¢«é˜»å¡ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747411854584.png" alt="1747411854584"></p>
<p>next-key é”çš„åŠ é”è§„åˆ™å…¶å®æŒºå¤æ‚çš„ï¼Œåœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹å®ƒå¯èƒ½ä¼š&quot;é€€åŒ–&quot;æˆå•çº¯çš„è®°å½•é”æˆ–é—´éš™é”ã€‚æˆ‘ä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡ä¸“é—¨è®²åŠ é”è§„åˆ™çš„æ–‡ç« ï¼Œæƒ³æ·±å…¥äº†è§£çš„åŒå­¦å¯ä»¥çœ‹çœ‹ï¼š<a href="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/">MySQL æ˜¯æ€ä¹ˆåŠ é”çš„ï¼Ÿ</a></p>
<p>è¿™é‡Œæœ‰ä¸ªéå¸¸é‡è¦æé†’ï¼šå¦‚æœä½ çš„ <code>update</code> è¯­å¥çš„ <code>where</code> æ¡ä»¶æ²¡æœ‰ç”¨åˆ°ç´¢å¼•åˆ—ï¼ŒMySQLå°±ä¸å¾—ä¸åšå…¨è¡¨æ‰«æã€‚åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼Œå®ƒä¸ä»…ä¼šç»™æ¯ä¸€è¡Œè®°å½•éƒ½åŠ ä¸Šè¡Œé”ï¼Œè¿˜ä¼šç»™è®°å½•ä¸¤è¾¹çš„ç©ºéš™éƒ½åŠ ä¸Šé—´éš™é”ã€‚è¿™ç›¸å½“äºæŠŠæ•´å¼ è¡¨éƒ½é”äº†ï¼ç›´åˆ°äº‹åŠ¡ç»“æŸè¿™äº›é”æ‰ä¼šè¢«é‡Šæ”¾ã€‚æ‰€ä»¥ï¼Œ<strong>åœ¨çº¿ä¸Šç³»ç»Ÿåƒä¸‡åˆ«æ‰§è¡Œæ²¡æœ‰å¸¦ç´¢å¼•æ¡ä»¶çš„ <code>update</code> è¯­å¥</strong>ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ä¸šåŠ¡å¤§é¢ç§¯åœé¡¿ã€‚æˆ‘æœ‰ä¸ªè¯»è€…å°±å› ä¸ºè¿™ä¹ˆå¹²äº†ï¼Œç»“æœè¢«è€æ¿ç‹ ç‹ åœ°&quot;æ•™è‚²&quot;äº†ä¸€ç•ªï¼Œè¯¦æƒ…å¯ä»¥çœ‹è¿™ç¯‡ï¼š<a href="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/update%E6%B2%A1%E5%8A%A0%E7%B4%A2%E5%BC%95%E4%BC%9A%E9%94%81%E5%85%A8%E8%A1%A8/">update æ²¡åŠ ç´¢å¼•ä¼šé”å…¨è¡¨ï¼Ÿ</a></p>
<p>å¥½äº†ï¼Œè®©æˆ‘ä»¬å›åˆ°å‰é¢é‚£ä¸ªæ­»é”çš„ä¾‹å­ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747411865196.png" alt="1747411865196"></p>
<p>å½“äº‹åŠ¡Aæ‰§è¡Œè¿™æ¡è¯­å¥æ—¶ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> t_order <span class="keyword">where</span> order_no <span class="operator">=</span> <span class="number">1007</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> è¿™æ¡è¯­å¥ï¼ŒæŸ¥çœ‹äº‹åŠ¡æ‰§è¡ŒSQLè¿‡ç¨‹ä¸­å…·ä½“åŠ äº†å“ªäº›é”ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747411875923.png" alt="1747411875923"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡Aä¸»è¦åŠ äº†ä¸¤ç§é”ï¼š</p>
<ul>
<li>è¡¨é”ï¼šä¸€ä¸ªXç±»å‹çš„æ„å‘é”ï¼ˆIXé”ï¼Œè¡¨ç¤ºäº‹åŠ¡å‡†å¤‡åœ¨è¡¨é‡Œçš„æŸäº›è¡Œä¸ŠåŠ Xé”ï¼‰ã€‚</li>
<li>è¡Œé”ï¼šä¸€ä¸ªXç±»å‹çš„next-keyé”ã€‚</li>
</ul>
<p>æˆ‘ä»¬é‡ç‚¹å…³æ³¨è¡Œé”ã€‚å›¾ä¸­ <code>LOCK_TYPE</code> çš„ <code>RECORD</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¡Œçº§é”ï¼ˆä¸æ˜¯ç‰¹æŒ‡è®°å½•é”ï¼‰ã€‚å…·ä½“æ˜¯next-keyé”ã€é—´éš™é”è¿˜æ˜¯è®°å½•é”ï¼Œéœ€è¦çœ‹ <code>LOCK_MODE</code>ï¼š</p>
<ul>
<li><code>X</code>ï¼šè¡¨ç¤ºXå‹çš„next-keyé”ã€‚</li>
<li><code>X, REC_NOT_GAP</code>ï¼šè¡¨ç¤ºXå‹çš„è®°å½•é”ã€‚</li>
<li><code>X, GAP</code>ï¼šè¡¨ç¤ºXå‹çš„é—´éš™é”ã€‚</li>
</ul>
<p><strong>å› æ­¤ï¼Œæ­¤æ—¶äº‹åŠ¡Aåœ¨ <code>order_no</code> è¿™ä¸ªäºŒçº§ç´¢å¼•ï¼ˆ<code>INDEX_NAME : index_order</code>ï¼‰ä¸ŠåŠ çš„æ˜¯Xå‹çš„next-keyé”ï¼Œé”å®šçš„èŒƒå›´æ˜¯ <code>(1006, +âˆ]</code></strong>ã€‚è¿™é‡Œçš„1006æ˜¯æ‰§è¡Œè¿™æ¡æŸ¥è¯¢æ—¶ï¼Œ<code>t_order</code> è¡¨ä¸­ <code>order_no</code> åˆ—ä¸Šå°äº1007ä¸”æœ€æ¥è¿‘1007çš„å€¼ï¼ˆå¦‚æœè¡¨é‡Œæœ‰å°äº1007çš„ï¼Œå°±æ˜¯é‚£ä¸ªæœ€å¤§çš„ï¼›å¦‚æœæ²¡æœ‰ï¼Œå¯èƒ½ä¼šæ˜¯æ›´å°çš„ä¸€ä¸ªèŒƒå›´èµ·ç‚¹ï¼‰ã€‚ç”±äº1006æ˜¯å½“æ—¶è¡¨é‡Œæœ€å¤§çš„è®¢å•å·ï¼Œæ‰€ä»¥ <code>(1006, +âˆ]</code> é”ä½äº†ä»1006è®¢å•å·ä¹‹åçš„æ‰€æœ‰å¯èƒ½é—´éš™ï¼Œä¸€ç›´åˆ°è¡¨å°¾ã€‚</p>
<blockquote>
<p>next-key é”çš„èŒƒå›´ (1006, +âˆ]ï¼Œæ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Ÿ</p>
<p>æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå¦‚æœ <code>LOCK_MODE</code> æ˜¾ç¤ºæ˜¯next-keyé”æˆ–è€…é—´éš™é”ï¼Œé‚£ä¹ˆ <code>LOCK_DATA</code> é€šå¸¸è¡¨ç¤ºè¿™ä¸ªé”èŒƒå›´çš„æœ€å³è¾¹çš„é‚£ä¸ªå€¼ã€‚åœ¨äº‹åŠ¡Açš„ä¾‹å­é‡Œï¼Œ<code>LOCK_DATA</code> æ˜¯ <code>supremum pseudo-record</code>ï¼Œè¿™ä»£è¡¨çš„æ˜¯æ­£æ— ç©·å¤§ï¼ˆ<code>+âˆ</code>ï¼‰ã€‚è€Œé”èŒƒå›´çš„æœ€å·¦è¾¹çš„å€¼ï¼Œåˆ™æ˜¯ <code>t_order</code> è¡¨ä¸­ï¼Œåœ¨ <code>order_no</code> ç´¢å¼•ä¸Šï¼Œå°äºæˆ‘ä»¬æŸ¥è¯¢å€¼ï¼ˆ1007ï¼‰çš„é‚£ä¸ªæœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯1006ã€‚å› æ­¤ï¼Œäº‹åŠ¡Açš„next-keyé”é”å®šçš„å°±æ˜¯ <code>(1006, +âˆ]</code> è¿™ä¸ªå¼€åŒºé—´ã€‚</p>
</blockquote>
<div class="note warning flat"><p>æœ‰çš„è¯»è€…å¯èƒ½ä¼šé—®ï¼Œæˆ‘åœ¨<a href="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/">MySQL æ˜¯æ€ä¹ˆåŠ é”çš„ï¼Ÿ</a>è¿™ç¯‡æ–‡ç« é‡Œè®²åˆ°ï¼Œå½“åœ¨éå”¯ä¸€ç´¢å¼•ä¸Šè¿›è¡Œç­‰å€¼æŸ¥è¯¢ï¼Œå¹¶ä¸”æŸ¥è¯¢çš„è®°å½•ä¸å­˜åœ¨æ—¶ï¼Œnext-key lockä¼šé€€åŒ–æˆé—´éš™é”ã€‚é‚£ä¸ºä»€ä¹ˆä¸Šé¢äº‹åŠ¡Açš„next-key lockæ²¡æœ‰é€€åŒ–å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œçš„å…³é”®åœ¨äºæŸ¥è¯¢çš„å€¼ï¼ˆ1007ï¼‰ä¸ç´¢å¼•ä¸­å·²å­˜åœ¨çš„å€¼çš„ç›¸å¯¹ä½ç½®ã€‚</p>
<ul>
<li>å¦‚æœè¡¨ä¸­ <code>order_no</code> ç´¢å¼•çš„æœ€å¤§å€¼æ˜¯1006ï¼ˆå¦‚æ­¤æ¡ˆä¾‹ï¼‰ï¼Œç„¶åæˆ‘ä»¬æŸ¥è¯¢ <code>order_no = 1007</code>ï¼ˆä¸€ä¸ªä¸å­˜åœ¨ä¸”å¤§äºæ‰€æœ‰ç°æœ‰å€¼çš„è®°å½•ï¼‰ï¼Œæ­¤æ—¶åŠ çš„æ˜¯next-key lockï¼ŒèŒƒå›´æ˜¯ <code>(1006, +âˆ]</code>ï¼Œå®ƒä¸ä¼šé€€åŒ–ã€‚</li>
<li>ä½†å¦‚æœè¡¨ä¸­ <code>order_no</code> ç´¢å¼•çš„æœ€å¤§å€¼æ˜¯1010ï¼Œæˆ‘ä»¬æŸ¥è¯¢ <code>order_no = 1007</code>ï¼ˆä¸€ä¸ªä¸å­˜åœ¨ä½†åœ¨ç°æœ‰å€¼ä¹‹é—´çš„è®°å½•ï¼‰ï¼Œæ­¤æ—¶next-key lockä¼šé”å®š <code>(1006, 1010]</code> è¿™ä¸ªåŒºé—´ï¼ˆå‡è®¾1006æ˜¯å°äº1007çš„æœ€å¤§å€¼ï¼‰ï¼Œç„¶åå®ƒä¼šé€€åŒ–æˆä¸€ä¸ªé—´éš™é”ï¼Œé”ä½ <code>(1006, 1010)</code> è¿™ä¸ªé—´éš™ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ul>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747411917531.png" alt="1747411917531"></p>
</div>
<p>å½“äº‹åŠ¡Bæƒ³è¦åœ¨äº‹åŠ¡Açš„next-keyé”èŒƒå›´ <code>(1006, +âˆ]</code> é‡Œæ’å…¥è®¢å•å·ä¸º1008çš„è®°å½•æ—¶ï¼Œå®ƒå°±ä¼šè¢«å¡ä½ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Insert into</span> t_order (order_no, create_date) <span class="keyword">values</span> (<span class="number">1008</span>, now()); <span class="comment">-- äº‹åŠ¡Bçš„æ“ä½œ</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºï¼Œå½“ä¸€ä¸ªäº‹åŠ¡ï¼ˆæ¯”å¦‚äº‹åŠ¡Bï¼‰å°è¯•å‘ä¸€ä¸ªé—´éš™ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå®ƒéœ€è¦å…ˆè·å¾—ä¸€ç§å«åš<strong>æ’å…¥æ„å‘é”</strong>ï¼ˆInsert Intention Lockï¼‰çš„&quot;è®¸å¯&quot;ã€‚</p>
<p>å…³é”®ç‚¹æ¥äº†ï¼š</p>
<ol>
<li><strong>æ’å…¥æ„å‘é” ä¸ (å…¶ä»–äº‹åŠ¡æŒæœ‰çš„)é—´éš™é” æ˜¯å†²çªçš„</strong>ï¼šå¦‚æœäº‹åŠ¡Açš„next-keyé”ï¼ˆå®ƒåŒ…å«äº†ä¸€ä¸ªé—´éš™é”ï¼‰å·²ç»é”ä½äº†äº‹åŠ¡Bæƒ³æ’å…¥çš„é‚£ä¸ª&quot;ç¼éš™&quot;ï¼Œé‚£ä¹ˆäº‹åŠ¡Bå°±å¿…é¡»ç­‰å¾…äº‹åŠ¡AæŠŠè¿™ä¸ªé—´éš™é”æ”¾æ‰ï¼Œæ‰èƒ½æ‹¿åˆ°è‡ªå·±çš„æ’å…¥æ„å‘é”ã€‚</li>
<li><strong>é—´éš™é” ä¸ (å…¶ä»–äº‹åŠ¡æŒæœ‰çš„)é—´éš™é” æ˜¯å…¼å®¹çš„</strong>ï¼šè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€å¼€å§‹ä¸¤ä¸ªäº‹åŠ¡éƒ½èƒ½æˆåŠŸæ‰§è¡Œ <code>select ... for update</code> è¯­å¥ã€‚å®ƒä»¬å„è‡ªè·å–çš„next-keyé”è™½ç„¶éƒ½è¦†ç›–äº† <code>(1006, +âˆ]</code> è¿™ä¸ªèŒƒå›´ï¼Œä½†å®ƒä»¬æ‰€åŒ…å«çš„é—´éš™é”éƒ¨åˆ†å¹¶ä¸ä¼šäº’ç›¸&quot;æ‰“æ¶&quot;ã€‚å¤šä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æ‹¥æœ‰è¦†ç›–ç›¸åŒé—´éš™çš„é—´éš™é”ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼Œæ­»é”çš„å‰§æœ¬æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>äº‹åŠ¡Aæ‰§è¡Œ <code>select ... for update where order_no = 1007;</code>ï¼ŒæˆåŠŸè·å¾—äº†è¦†ç›– <code>(1006, +âˆ]</code> èŒƒå›´çš„next-keyé”ï¼ˆè¿™ä¸ªé”é‡ŒåŒ…å«äº†é—´éš™é”æˆåˆ†ï¼‰ã€‚</li>
<li>äº‹åŠ¡Bæ‰§è¡Œ <code>select ... for update where order_no = 1008;</code>ï¼Œä¹ŸæˆåŠŸè·å¾—äº†è¦†ç›– <code>(1006, +âˆ]</code> èŒƒå›´çš„next-keyé”ï¼ˆåŒæ ·åŒ…å«é—´éš™é”ï¼Œå¹¶ä¸”ä¸äº‹åŠ¡Açš„é—´éš™é”å…¼å®¹ï¼‰ã€‚</li>
<li>ç°åœ¨ï¼Œäº‹åŠ¡Aæƒ³æ’å…¥è®¢å•1007ã€‚å®ƒéœ€è¦è·å–æ’å…¥æ„å‘é”ã€‚ä½†è¿™ä¸ªä½ç½®ï¼ˆæˆ–è€…è¯´è¿™ä¸ªæ„å›¾ï¼‰ä¸äº‹åŠ¡BæŒæœ‰çš„ <code>(1006, +âˆ]</code> é—´éš™é”å†²çªäº†ï¼Œæ‰€ä»¥äº‹åŠ¡Aå¼€å§‹ç­‰å¾…äº‹åŠ¡Bé‡Šæ”¾é”ã€‚</li>
<li>åŒæ—¶ï¼Œäº‹åŠ¡Bæƒ³æ’å…¥è®¢å•1008ã€‚å®ƒä¹Ÿéœ€è¦è·å–æ’å…¥æ„å‘é”ã€‚åŒæ ·ï¼Œè¿™ä¸ªæ„å›¾ä¸äº‹åŠ¡AæŒæœ‰çš„ <code>(1006, +âˆ]</code> é—´éš™é”å†²çªäº†ï¼Œæ‰€ä»¥äº‹åŠ¡Bä¹Ÿå¼€å§‹ç­‰å¾…äº‹åŠ¡Aé‡Šæ”¾é”ã€‚</li>
</ul>
<p>çœ‹ï¼Œå®ƒä»¬äº’ç›¸ç­‰å¾…å¯¹æ–¹æ‰‹é‡Œçš„&quot;é’¥åŒ™&quot;ï¼Œè°ä¹ŸåŠ¨ä¸äº†ï¼Œæ­»é”å°±è¿™ä¹ˆåä¸½ä¸½åœ°å‘ç”Ÿäº†ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆé—´éš™é”ä¸é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Ÿ</p>
<p>MySQLå®˜æ–¹æ–‡æ¡£æœ‰è¿™ä¹ˆä¸€æ®µæè¿°ï¼ˆæˆ‘ç¿»è¯‘å¹¶æç‚¼ä¸€ä¸‹ï¼‰ï¼š</p>
<p><em>â€œInnoDBä¸­çš„é—´éš™é”æ˜¯&quot;çº¯ç²¹æŠ‘åˆ¶æ€§&quot;çš„ï¼Œæ„æ€æ˜¯å®ƒä»¬å”¯ä¸€çš„ä½œç”¨å°±æ˜¯é˜»æ­¢å…¶ä»–äº‹åŠ¡å¾€è¿™ä¸ªé—´éš™é‡Œæ’å…¥æ•°æ®ã€‚é—´éš™é”å¯ä»¥å…±å­˜ã€‚ä¸€ä¸ªäº‹åŠ¡æŒæœ‰çš„é—´éš™é”å¹¶ä¸ä¼šé˜»æ­¢å¦ä¸€ä¸ªäº‹åŠ¡åœ¨åŒä¸€ä¸ªé—´éš™ä¸ŠæŒæœ‰é—´éš™é”ã€‚å…±äº«é—´éš™é”å’Œæ’ä»–é—´éš™é”ä¹‹é—´æ²¡æœ‰åŒºåˆ«ï¼Œå®ƒä»¬äº’ä¸å†²çªï¼Œå¹¶ä¸”åŠŸèƒ½ç›¸åŒã€‚â€</em></p>
<p>ç®€å•è¯´ï¼Œ<strong>é—´éš™é”çš„æ ¸å¿ƒä»»åŠ¡å°±æ˜¯&quot;å®ˆä½è¿™å—ç©ºåœ°ï¼Œä¸å‡†åˆ«äººè¿›æ¥ç›–æˆ¿å­ï¼ˆæ’å…¥æ•°æ®ï¼‰&quot;</strong>ã€‚æ—¢ç„¶å¤§å®¶çš„ç›®çš„éƒ½æ˜¯å®ˆåœ°ï¼Œé‚£å°±å¯ä»¥ä¸€èµ·å®ˆï¼Œäº’ä¸å¹²æ‰°ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œè¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ä¸€ç‚¹ï¼š<strong>next-keyé” = è®°å½•é” + é—´éš™é”</strong>ã€‚è™½ç„¶é—´éš™é”éƒ¨åˆ†æ˜¯å…¼å®¹çš„ï¼Œä½†å¦‚æœä¸¤ä¸ªnext-keyé”è¯•å›¾é”å®šçš„æ˜¯åŒä¸€ä¸ª <em>å®é™…å­˜åœ¨çš„è®°å½•</em>ï¼Œé‚£è®°å½•é”éƒ¨åˆ†å°±å¯èƒ½ä¼šå†²çªäº†ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡è·å–äº†æŸæ¡è®°å½•çš„Xå‹è®°å½•é”ï¼ˆåŒ…å«åœ¨next-keyé”é‡Œï¼‰ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿæƒ³è·å–è¿™æ¡è®°å½•çš„Xå‹è®°å½•é”ï¼Œé‚£å°±ä¼šè¢«é˜»å¡ã€‚</p>
<p>ä¸è¿‡ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªæ­»é”æ¡ˆä¾‹ä¸­ï¼Œä¸¤ä¸ªäº‹åŠ¡çš„next-keyé” <code>(1006, +âˆ]</code> éƒ½æŒ‡å‘äº†ä¸€ä¸ª&quot;æ— ç©·è¿œ&quot;çš„è™šæ‹Ÿè¾¹ç•Œï¼Œå¹¶æ²¡æœ‰é”å®šåŒä¸€ä¸ªå®é™…å­˜åœ¨çš„è®°å½•ã€‚<code>+âˆ</code> å¹¶ä¸æ˜¯ä¸€æ¡çœŸå®çš„æ•°æ®è®°å½•ï¼Œæ‰€ä»¥å®ƒä»¬åœ¨è®°å½•é”å±‚é¢ä¸ä¼šç›´æ¥å†²çªã€‚å†²çªä¸»è¦æ¥è‡ªäºåç»­æ’å…¥æ“ä½œæ—¶ï¼Œæ’å…¥æ„å‘é”ä¸å¯¹æ–¹é—´éš™é”çš„çŸ›ç›¾ã€‚</p>
<blockquote>
<p>æ’å…¥æ„å‘é”æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>æ³¨æ„ï¼â€œæ’å…¥æ„å‘é”&quot;è™½ç„¶åå­—é‡Œå¸¦&quot;æ„å‘é”â€ï¼Œä½†å®ƒå’Œæˆ‘ä»¬å¸¸è¯´çš„è¡¨çº§æ„å‘é”ï¼ˆå¦‚IX, ISï¼‰ä¸æ˜¯ä¸€å›äº‹ã€‚å®ƒå…¶å®æ˜¯ä¸€ç§<strong>ç‰¹æ®Šç±»å‹çš„é—´éš™é”</strong>ã€‚</p>
<p>MySQLå®˜æ–¹æ–‡æ¡£æ˜¯è¿™ä¹ˆè¯´çš„ï¼ˆåŒæ ·ï¼Œæˆ‘æ¥æ¦‚æ‹¬ä¸‹ï¼‰ï¼š</p>
<p><em>â€œæ’å…¥æ„å‘é”æ˜¯ä¸€ç§åœ¨è¡Œæ’å…¥æ“ä½œä¹‹å‰è®¾ç½®çš„é—´éš™é”ã€‚è¿™ç§é”è¡¨æ˜äº†æ’å…¥çš„&quot;æ„å›¾â€ï¼Œä½¿å¾—å¤šä¸ªäº‹åŠ¡å¦‚æœä¸æ˜¯åœ¨é—´éš™ä¸­çš„å®Œå…¨ç›¸åŒä½ç½®æ’å…¥æ•°æ®ï¼Œå®ƒä»¬å°±ä¸å¿…äº’ç›¸ç­‰å¾…ã€‚æ¯”å¦‚ï¼Œæœ‰ç´¢å¼•è®°å½•4å’Œ7ã€‚ä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡åˆ†åˆ«å°è¯•æ’å…¥5å’Œ6ï¼Œåœ¨çœŸæ­£è·å¾—æ’å…¥è¡Œçš„æ’ä»–é”ä¹‹å‰ï¼Œå®ƒä»¬éƒ½ä¼šç”¨æ’å…¥æ„å‘é”æ¥é”å®š4å’Œ7ä¹‹é—´çš„é—´éš™ï¼Œä½†å®ƒä»¬ä¸ä¼šäº’ç›¸é˜»å¡ï¼Œå› ä¸ºæ’å…¥çš„è¡Œæ˜¯ä¸å†²çªçš„ã€‚&quot;</em></p>
<p>è¿™æ®µè¯å‘Šè¯‰æˆ‘ä»¬ï¼š</p>
<ul>
<li>æ’å…¥æ„å‘é”ä¹Ÿæ˜¯ä¸€ç§é—´éš™é”ï¼Œä½†å®ƒéå¸¸ç‰¹æ®Šï¼Œ<strong>ä¸»è¦ç”¨äºå¤„ç†å¹¶å‘æ’å…¥æ“ä½œ</strong>ã€‚</li>
<li>å¦‚æœè¯´æ™®é€šçš„é—´éš™é”é”ä½çš„æ˜¯ä¸€ä¸ª&quot;åŒºé—´&quot;ï¼Œé‚£ä¹ˆ<strong>æ’å…¥æ„å‘é”æ›´åƒæ˜¯é”ä½ä¸€ä¸ª&quot;ç‚¹&quot;</strong>ï¼ˆå³ä½ æ‰“ç®—æ’å…¥çš„å…·ä½“ä½ç½®ï¼‰ã€‚è¿™å¯èƒ½æ˜¯æˆ‘èƒ½æƒ³åˆ°çš„æœ€å½¢è±¡çš„æ¯”å–»äº†ã€‚</li>
<li>æ’å…¥æ„å‘é”å’Œæ™®é€šé—´éš™é”çš„ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯ï¼šè™½ç„¶å®ƒä»¬éƒ½æ²¾ç‚¹&quot;é—´éš™&quot;çš„è¾¹ï¼Œä½†<strong>ä¸€ä¸ªäº‹åŠ¡ä¸èƒ½åœ¨æŒæœ‰æ™®é€šé—´éš™é”çš„åŒæ—¶ï¼Œè®©å¦ä¸€ä¸ªäº‹åŠ¡åœ¨è¯¥é—´éš™å†…æŒæœ‰æ’å…¥æ„å‘é”</strong>ï¼ˆé™¤éæ’å…¥æ„å‘é”çš„ä½ç½®ä¸åœ¨è¿™ä¸ªæ™®é€šé—´éš™é”çš„ä¿æŠ¤èŒƒå›´å†…ï¼‰ã€‚è¿™å°±æ˜¯å®ƒä»¬å†²çªçš„æ ¹æºã€‚</li>
</ul>
</blockquote>
<p>å¦å¤–ï¼Œæˆ‘è¡¥å……ä¸€ç‚¹æ’å…¥æ„å‘é”çš„ç”Ÿæˆæ—¶æœºï¼šå½“ä¸€ä¸ªäº‹åŠ¡å‡†å¤‡æ’å…¥ä¸€æ¡æ–°è®°å½•æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥è¿™æ¡æ–°è®°å½•ç´§é‚»çš„ä¸‹ä¸€æ¡ç´¢å¼•è®°å½•ä¸Šæ˜¯å¦å·²ç»è¢«å…¶ä»–äº‹åŠ¡åŠ äº†é—´éš™é”ã€‚å¦‚æœåŠ äº†ï¼Œå½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œå¹¶ä¸”è¿™ä¸ªé”ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆMySQLåŠ é”æ—¶ï¼Œæ˜¯å…ˆåˆ›å»ºé”ç»“æ„ï¼Œå†è®¾ç½®é”çš„çŠ¶æ€ã€‚ç­‰å¾…çŠ¶æ€æ„å‘³ç€é”è¿˜æ²¡æ‹¿åˆ°æ‰‹ï¼Œäº‹åŠ¡ä¼šè¢«é˜»å¡ï¼‰ï¼Œç›´åˆ°é‚£ä¸ªé—´éš™é”è¢«é‡Šæ”¾ã€‚</p>
<h2 id="Insert-è¯­å¥æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ">Insert è¯­å¥æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ</h2>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡<code>INSERT</code>ä¸€æ¡è®°å½•ï¼Œæ•°æ®åº“éƒ½ä¼šé©¬ä¸Šç»™å®ƒä¸Šä¸€å †é”å‘¢ï¼Ÿå…¶å®ä¸ä¸€å®šã€‚InnoDBæœ‰ä¸ªèªæ˜çš„æœºåˆ¶å«åš<strong>éšå¼é”</strong>ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯éšå¼é”ï¼Ÿ</p>
<p>ç®€å•è¯´ï¼Œå°±æ˜¯&quot;èƒ½ä¸åŠ é”å°±ä¸åŠ é”ï¼Œé™¤éä¸‡ä¸å¾—å·²&quot;ã€‚å½“æ’å…¥ä¸€æ¡æ–°è®°å½•æ—¶ï¼ŒInnoDBå¹¶ä¸ä¼šç«‹åˆ»ç»™è¿™æ¡è®°å½•åˆ†é…ä¸€ä¸ªæ˜ç¡®çš„é”ç»“æ„ï¼ˆæ¯”å¦‚æˆ‘ä»¬å‰é¢çœ‹åˆ°çš„é‚£äº›è®°å½•é”ã€next-keyé”ï¼‰ã€‚å®ƒä¾èµ–è®°å½•æœ¬èº«çš„ä¸€äº›å†…éƒ¨ä¿¡æ¯ï¼ˆæ¯”å¦‚ä¸€ä¸ªéšè—çš„äº‹åŠ¡IDåˆ— <code>trx_id</code>ï¼‰æ¥é—´æ¥å®ç°ä¿æŠ¤ã€‚åªæœ‰åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚è¿™æ¡è®°å½•å¯èƒ½è¦å’Œåˆ«çš„äº‹åŠ¡å‘ç”Ÿå†²çªäº†ï¼Œè¿™ä¸ª&quot;éšå½¢&quot;çš„é”æ‰ä¼šè½¬æ¢æˆæˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„é‚£äº›&quot;å®ä½“&quot;é”ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å‡å°‘äº†ä¸å¿…è¦çš„é”å¼€é”€ï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚</p>
<p>é‚£ä¹ˆï¼Œä»€ä¹ˆæƒ…å†µä¸‹éšå¼é”ä¼š&quot;ç°èº«&quot;å˜æˆæ˜¾å¼é”å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ç§åœºæ™¯ï¼š</p>
<ol>
<li><strong>è¦æ’å…¥çš„åœ°æ–¹å·²ç»è¢«é—´éš™é”&quot;å°è·¯&quot;äº†</strong>ï¼šå¦‚æœå…¶ä»–äº‹åŠ¡ç”¨é—´éš™é”é”ä½äº†ä½ è¦æ’å…¥è®°å½•çš„é‚£ä¸ª&quot;ç¼éš™&quot;ï¼Œé‚£ä½ è¿™æ¡<code>INSERT</code>è¯­å¥å°±å¾—ç­‰ç€ï¼Œå¹¶ä¸”ä¼šå°è¯•è·å–ä¸€ä¸ªæ’å…¥æ„å‘é”ï¼ˆæ­¤æ—¶éšå¼é”æœºåˆ¶å¯èƒ½å°±ä¸å¤Ÿç”¨äº†ï¼Œéœ€è¦æ˜¾å¼çš„é”ä»‹å…¥ï¼‰ã€‚</li>
<li><strong>æ’å…¥çš„è®°å½•å’Œå·²æœ‰è®°å½•çš„å”¯ä¸€é”®å†²çªäº†</strong>ï¼šæ¯”å¦‚ä½ è¦æ’å…¥ä¸€ä¸ªä¸»é”®å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œæˆ–è€…ä¸€ä¸ªå”¯ä¸€ç´¢å¼•åˆ—å·²ç»æœ‰ç›¸åŒå€¼çš„è®°å½•ã€‚è¿™æ—¶ï¼Œæ’å…¥ä¼šå¤±è´¥ï¼Œå¹¶ä¸”InnoDBä¼šå¯¹é‚£æ¡å·²ç»å­˜åœ¨çš„ã€é€ æˆå†²çªçš„è®°å½•åŠ ä¸Šä¸€ä¸ªSå‹çš„é”ã€‚</li>
</ol>
</blockquote>
<h3 id="1ã€è®°å½•ä¹‹é—´åŠ æœ‰é—´éš™é”">1ã€è®°å½•ä¹‹é—´åŠ æœ‰é—´éš™é”</h3>
<p>æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ã€‚ç°åœ¨<code>t_order</code>è¡¨ä¸­åªæœ‰ä»¥ä¸‹æ•°æ®ï¼Œå¹¶ä¸”<code>order_no</code>æ˜¯äºŒçº§ç´¢å¼•ï¼ˆéå”¯ä¸€ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>id</th>
<th>order_no</th>
<th>create_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1001</td>
<td>(NULL)</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>(NULL)</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>(NULL)</td>
</tr>
<tr>
<td>4</td>
<td>1004</td>
<td>(NULL)</td>
</tr>
<tr>
<td>5</td>
<td>1005</td>
<td>(NULL)</td>
</tr>
</tbody>
</table>
<p>ç°åœ¨ï¼Œäº‹åŠ¡Aæ‰§è¡Œäº†ä¸‹é¢è¿™æ¡è¯­å¥ï¼Œè¯•å›¾æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„è®¢å•å·1006å¹¶é”å®šå®ƒï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ A</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_order <span class="keyword">where</span> order_no <span class="operator">=</span> <span class="number">1006</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec) <span class="comment">-- æŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œå› ä¸º1006ä¸å­˜åœ¨</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç”¨ <code>select * from performance_schema.data_locks\G;</code> æŸ¥ä¸€ä¸‹äº‹åŠ¡AåŠ äº†ä»€ä¹ˆé”ï¼ˆåªå…³æ³¨è®°å½•ä¸Šçš„é”ï¼‰ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412272712.png" alt="1747412272712"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡Aåœ¨<code>order_no</code>ç´¢å¼•ä¸ŠåŠ äº†ä¸€ä¸ªnext-keyé”ï¼Œé”å®šçš„èŒƒå›´æ˜¯ <code>(1005, +âˆ]</code>ï¼ˆå› ä¸º1005æ˜¯å°äº1006çš„æœ€å¤§å€¼ï¼‰ã€‚</p>
<p>ç„¶åï¼Œäº‹åŠ¡Bå°è¯•åœ¨è¿™ä¸ªè¢«é”å®šçš„é—´éš™ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼ˆè®¢å•å·1010ï¼‰ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ B æ’å…¥ä¸€æ¡è®°å½•</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert into</span> t_order(order_no, create_date) <span class="keyword">values</span>(<span class="number">1010</span>,now());</span><br><span class="line">### é˜»å¡çŠ¶æ€ã€‚ã€‚ã€‚ã€‚</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡Bçš„<code>INSERT</code>è¯­å¥è¢«é˜»å¡äº†ã€‚æˆ‘ä»¬å†æŸ¥ä¸€ä¸‹äº‹åŠ¡Bçš„é”ä¿¡æ¯ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412280944.png" alt="1747412280944"></p>
<p>äº‹åŠ¡Bçš„çŠ¶æ€æ˜¯ <code>WAITING</code>ï¼ˆç­‰å¾…ï¼‰ã€‚å®ƒè¯•å›¾è·å–ä¸€ä¸ª <code>X,INSERT_INTENTION</code>ï¼ˆXå‹æ’å…¥æ„å‘é”ï¼‰ï¼Œä½†ç”±äºå®ƒæƒ³æ’å…¥çš„ä½ç½®ï¼ˆ1010ï¼‰è½åœ¨äº†äº‹åŠ¡AæŒæœ‰çš„next-keyé”èŒƒå›´ <code>(1005, +âˆ]</code> å†…ï¼Œæ‰€ä»¥å®ƒå¿…é¡»ç­‰å¾…ã€‚</p>
<h3 id="2ã€é‡åˆ°å”¯ä¸€é”®å†²çª">2ã€é‡åˆ°å”¯ä¸€é”®å†²çª</h3>
<p>å¦‚æœåœ¨æ’å…¥æ–°è®°å½•æ—¶ï¼Œå‘ç°æ–°çºªå½•çš„æŸä¸ªå”¯ä¸€é”®ï¼ˆä¸»é”®æˆ–å”¯ä¸€äºŒçº§ç´¢å¼•ï¼‰çš„å€¼ä¸å·²å­˜åœ¨çš„è®°å½•é‡å¤äº†ï¼Œæ’å…¥æ“ä½œä¼šå¤±è´¥ã€‚å¹¶ä¸”ï¼ŒInnoDBè¿˜ä¼šå¯¹é‚£æ¡å·²ç»å­˜åœ¨çš„ã€å¯¼è‡´å†²çªçš„è®°å½•åŠ ä¸Šä¸€ä¸ª<strong>Så‹ï¼ˆå…±äº«å‹ï¼‰çš„é”</strong>ã€‚</p>
<p>å…·ä½“åŠ çš„æ˜¯Så‹è®°å½•é”è¿˜æ˜¯Så‹next-keyé”ï¼Œä¼šæ ¹æ®å†²çªçš„æ˜¯ä¸»é”®è¿˜æ˜¯å”¯ä¸€äºŒçº§ç´¢å¼•ï¼Œä»¥åŠå½“å‰çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li>
<p><strong>å¦‚æœä¸»é”®å€¼é‡å¤</strong>ï¼š</p>
<ul>
<li>åœ¨**è¯»å·²æäº¤ï¼ˆRead Committed, RCï¼‰**éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ’å…¥äº‹åŠ¡ä¼šç»™å·²å­˜åœ¨çš„ä¸»é”®é‡å¤çš„èšç°‡ç´¢å¼•è®°å½•ï¼ˆå³æ•°æ®è¡Œæœ¬èº«ï¼‰æ·»åŠ  <strong>Så‹è®°å½•é”</strong>ã€‚</li>
<li>åœ¨**å¯é‡å¤è¯»ï¼ˆRepeatable Read, RRï¼‰**éš”ç¦»çº§åˆ«ä¸‹ï¼ˆMySQLé»˜è®¤ï¼‰ï¼ŒåŒæ ·æ˜¯æ·»åŠ  <strong>Så‹è®°å½•é”</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¦‚æœå”¯ä¸€äºŒçº§ç´¢å¼•åˆ—çš„å€¼é‡å¤</strong>ï¼š</p>
<ul>
<li><strong>æ— è®ºæ˜¯åœ¨RCè¿˜æ˜¯RRéš”ç¦»çº§åˆ«ä¸‹</strong>ï¼Œæ’å…¥äº‹åŠ¡éƒ½ä¼šç»™å·²å­˜åœ¨çš„ã€äºŒçº§ç´¢å¼•å€¼é‡å¤çš„äºŒçº§ç´¢å¼•è®°å½•æ·»åŠ  <strong>Så‹next-keyé”</strong>ã€‚æ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œå³ä½¿æ˜¯è¯»å·²æäº¤éš”ç¦»çº§åˆ«ï¼Œè¿™é‡Œä¹Ÿä¼šåŠ next-keyé”ï¼ˆåŒ…å«é—´éš™é”æˆåˆ†ï¼‰ã€‚è¿™ç®—æ˜¯RCéš”ç¦»çº§åˆ«ä¸‹ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ã€ä¼šä½¿ç”¨é—´éš™é”çš„åœºæ™¯ã€‚è‡³äºä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Œæˆ‘æš‚æ—¶è¿˜æ²¡æ‰¾åˆ°å®˜æ–¹çš„æ˜ç¡®è§£é‡Šã€‚</li>
</ul>
</li>
</ul>
<h4 id="ä¸»é”®ç´¢å¼•å†²çª">ä¸»é”®ç´¢å¼•å†²çª</h4>
<p>æˆ‘ä»¬æ¥çœ‹ä¸ªä¸»é”®å†²çªçš„ä¾‹å­ã€‚MySQL 8.0ç‰ˆæœ¬ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼ˆRRï¼‰ã€‚<br>
<code>t_order</code> è¡¨çš„ <code>id</code> å­—æ®µæ˜¯ä¸»é”®ã€‚å‡è®¾è¡¨é‡Œå·²ç»æœ‰ä¸€æ¡ <code>id</code> ä¸º 5 çš„è®°å½•ã€‚ç°åœ¨ä¸€ä¸ªäº‹åŠ¡å°è¯•æ’å…¥ä¸€æ¡æ–°çš„ <code>id</code> ä¸º 5 çš„è®°å½•ï¼Œè¿™å¿…ç„¶ä¼šå¤±è´¥ï¼Œå¹¶æŠ¥å‘Šä¸»é”®å†²çªé”™è¯¯ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412292466.png" alt="1747412292466"></p>
<p>é™¤äº†æŠ¥é”™ï¼Œæ•°æ®åº“è¿˜åšäº†ä¸€ä»¶é‡è¦çš„äº‹æƒ…ï¼šå®ƒç»™åŸæ¥é‚£æ¡ <code>id</code> ä¸º 5 çš„è®°å½•åŠ ä¸Šäº†ä¸€ä¸ª<strong>Så‹çš„è®°å½•é”</strong>ã€‚<br>
æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> ç¡®è®¤è¿™ä¸€ç‚¹ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412298840.png" alt="1747412298840"></p>
<p>çœ‹åˆ°æ²¡ï¼Ÿ<code>LOCK_DATA</code> æ˜¯ 5ï¼ˆè¡¨ç¤ºä¸»é”®å€¼ä¸º5çš„è®°å½•ï¼‰ï¼Œ<code>LOCK_MODE</code> æ˜¯ <code>S, REC_NOT_GAP</code>ï¼ˆSå‹è®°å½•é”ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœæ’å…¥æ•°æ®æ—¶å‘ç”Ÿä¸»é”®å†²çªï¼Œæ’å…¥äº‹åŠ¡ä¼šç»™é‚£æ¡å·²ç»å­˜åœ¨çš„ã€ä¸»é”®å€¼ç›¸åŒçš„è®°å½•ä¸Šä¸€ä¸ªSå‹è®°å½•é”ã€‚</p>
<h4 id="å”¯ä¸€äºŒçº§ç´¢å¼•å†²çª">å”¯ä¸€äºŒçº§ç´¢å¼•å†²çª</h4>
<p>å†æ¥çœ‹å”¯ä¸€äºŒçº§ç´¢å¼•å†²çªçš„ä¾‹å­ã€‚åŒæ ·æ˜¯MySQL 8.0ï¼ŒRRéš”ç¦»çº§åˆ«ã€‚<br>
å‡è®¾ <code>t_order</code> è¡¨çš„ <code>order_no</code> å­—æ®µç°åœ¨æ˜¯ä¸€ä¸ªå”¯ä¸€äºŒçº§ç´¢å¼•ï¼Œå¹¶ä¸”è¡¨é‡Œå·²ç»æœ‰ä¸€æ¡ <code>order_no</code> ä¸º 1001 çš„è®°å½•ã€‚äº‹åŠ¡Aå°è¯•æ’å…¥ä¸€æ¡æ–°çš„ <code>order_no</code> ä¹Ÿä¸º 1001 çš„è®°å½•ï¼ŒåŒæ ·ä¼šæŠ¥é”™ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412314882.png" alt="1747412314882"></p>
<p>é™¤äº†æŠ¥é”™ï¼Œæ•°æ®åº“è¿™æ—¶ä¼šå¯¹ <code>order_no</code> å€¼ä¸º 1001 çš„é‚£æ¡äºŒçº§ç´¢å¼•è®°å½•åŠ ä¸Šä¸€ä¸ª<strong>Så‹çš„next-keyé”</strong>ã€‚<br>
æŸ¥çœ‹é”ä¿¡æ¯ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412321985.png" alt="1747412321985"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ <code>index_order</code> è¿™ä¸ªäºŒçº§ç´¢å¼•ä¸Šï¼Œ<code>LOCK_MODE</code> æ˜¯ <code>S</code>ï¼ˆè¡¨ç¤ºSå‹next-keyé”ï¼‰ï¼Œå®ƒé”å®šçš„èŒƒå›´å¤§è‡´æ˜¯ <code>(-âˆ, 1001]</code> ï¼ˆå…·ä½“èŒƒå›´å–å†³äº1001ä¹‹å‰çš„å€¼ï¼‰ã€‚</p>
<p>å¦‚æœè¿™æ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡Bæƒ³å¯¹ <code>order_no = 1001</code> çš„è®°å½•æ‰§è¡Œ <code>select ... for update</code>ï¼ˆå³æƒ³ç»™å®ƒåŠ Xå‹é”ï¼‰ï¼Œäº‹åŠ¡Bå°±ä¼šè¢«é˜»å¡ï¼Œå› ä¸ºXå‹é”å’ŒSå‹é”æ˜¯å†²çªçš„ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412342011.png" alt="1747412342011"></p>
<p>æŸ¥çœ‹äº‹åŠ¡Bçš„é”çŠ¶æ€ï¼Œä¼šå‘ç°å®ƒåœ¨ç­‰å¾…ä¸€ä¸ªXå‹çš„è®°å½•é” (<code>LOCK_MODE: X,REC_NOT_GAP</code>)ï¼ŒçŠ¶æ€æ˜¯ <code>WAITING</code>ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412349198.png" alt="1747412349198"></p>
<h4 id="ä¸¤ä¸ªäº‹åŠ¡æ’å…¥ç›¸åŒçš„å”¯ä¸€äºŒçº§ç´¢å¼•è®°å½•">ä¸¤ä¸ªäº‹åŠ¡æ’å…¥ç›¸åŒçš„å”¯ä¸€äºŒçº§ç´¢å¼•è®°å½•</h4>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸ªæ›´æœ‰æ„æ€çš„åœºæ™¯ï¼šä¸¤ä¸ªäº‹åŠ¡å…ˆåå°è¯•æ’å…¥å…·æœ‰ç›¸åŒå”¯ä¸€äºŒçº§ç´¢å¼•å€¼çš„è®°å½•ã€‚<br>
å‡è®¾ <code>t_order</code> è¡¨ä¸­ç›®å‰çš„æ•°æ®å¦‚ä¸‹ï¼Œå¹¶ä¸” <code>order_no</code> æ˜¯å”¯ä¸€äºŒçº§ç´¢å¼•ã€‚</p>
<table>
<thead>
<tr>
<th>id</th>
<th>order_no</th>
<th>create_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1001</td>
<td>(NULL)</td>
</tr>
<tr>
<td>2</td>
<td>1002</td>
<td>(NULL)</td>
</tr>
<tr>
<td>3</td>
<td>1003</td>
<td>(NULL)</td>
</tr>
<tr>
<td>4</td>
<td>1004</td>
<td>(NULL)</td>
</tr>
<tr>
<td>5</td>
<td>1005</td>
<td>(NULL)</td>
</tr>
</tbody>
</table>
<p>åœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aå…ˆæ‰§è¡Œæ’å…¥ï¼Œç„¶åäº‹åŠ¡Bä¹Ÿæ‰§è¡Œç›¸åŒçš„æ’å…¥è¯­å¥ã€‚è¿™æ—¶ï¼Œ<strong>äº‹åŠ¡Bçš„INSERTè¯­å¥ä¼šè¢«é˜»å¡</strong>ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412382887.png" alt="1747412382887"></p>
<p>è¿™ä¸¤ä¸ªäº‹åŠ¡çš„åŠ é”è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li><strong>äº‹åŠ¡A</strong>æ’å…¥ <code>order_no</code> ä¸º 1006 çš„è®°å½•ã€‚ç”±äºè¿™æ˜¯ä¸ªæ–°è®°å½•ï¼Œå¹¶ä¸”æ²¡æœ‰è¿åå”¯ä¸€æ€§çº¦æŸï¼ˆå‡è®¾æ­¤æ—¶è¿˜æ²¡æœ‰1006ï¼‰ï¼Œæ’å…¥æˆåŠŸã€‚è¿™æ¡æ–°æ’å…¥çš„è®°å½•çš„å”¯ä¸€äºŒçº§ç´¢å¼•ï¼ˆ<code>order_no = 1006</code>ï¼‰æ­¤æ—¶å—åˆ°&quot;éšå¼é”&quot;çš„ä¿æŠ¤ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¦‚æœå»æŸ¥ <code>performance_schema.data_locks</code>ï¼Œé€šå¸¸çœ‹ä¸åˆ°è¿™æ¡è®°å½•æœ‰æ˜¾å¼çš„é”ç»“æ„ã€‚</li>
<li><strong>äº‹åŠ¡B</strong>ä¹Ÿå°è¯•æ’å…¥ <code>order_no</code> ä¸º 1006 çš„è®°å½•ã€‚å½“å®ƒæ£€æŸ¥å”¯ä¸€äºŒçº§ç´¢å¼•æ—¶ï¼Œå‘ç°äº‹åŠ¡Aï¼ˆè™½ç„¶è¿˜æœªæäº¤ï¼‰å·²ç»&quot;å ç”¨&quot;äº†1006è¿™ä¸ªå€¼ã€‚äºæ˜¯ï¼Œäº‹åŠ¡Bçš„æ’å…¥æ“ä½œå› å”¯ä¸€é”®å†²çªè€Œå—é˜»ã€‚å®ƒä¼šå°è¯•ä¸ºè¿™ä¸ªå†²çªçš„äºŒçº§ç´¢å¼•è®°å½•ï¼ˆå³ <code>order_no = 1006</code>ï¼‰è·å–ä¸€ä¸ªSå‹çš„next-keyé”ã€‚</li>
<li>ä½†ä¸æ­¤åŒæ—¶ï¼Œç”±äºäº‹åŠ¡Bçš„æ“ä½œä¸äº‹åŠ¡Aæ’å…¥çš„è®°å½•å‘ç”Ÿäº†æ½œåœ¨å†²çªï¼Œäº‹åŠ¡Aåœ¨è¿™æ¡ <code>order_no = 1006</code> çš„è®°å½•ä¸Šçš„&quot;éšå¼é”&quot;ä¼š<strong>å‡çº§ä¸ºæ˜¾å¼çš„Xå‹è®°å½•é”</strong>ã€‚</li>
<li>ç»“æœå°±æ˜¯ï¼Œäº‹åŠ¡Bæƒ³è·å–Så‹next-keyé”ï¼Œä½†äº‹åŠ¡Aå·²ç»æŒæœ‰äº†Xå‹è®°å½•é”ï¼ˆåœ¨åŒä¸€ä¸ªç´¢å¼•è®°å½•ä¸Šï¼‰ã€‚Xå‹é”å’ŒSå‹é”æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥äº‹åŠ¡Bè¢«è¿«è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°äº‹åŠ¡Aæäº¤æˆ–å›æ»šã€‚</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>performance_schema.data_locks</code> æ¥éªŒè¯è¿™ä¸ªè¿‡ç¨‹ã€‚<br>
å…ˆçœ‹äº‹åŠ¡Aåœ¨ <code>order_no = 1006</code> çš„è®°å½•ä¸Šæœ€ç»ˆæŒæœ‰ä»€ä¹ˆé”ï¼ˆè¿™æ˜¯åœ¨äº‹åŠ¡Bå°è¯•æ’å…¥åäº§ç”Ÿçš„ï¼‰ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412390597.png" alt="1747412390597"><br>
å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡Aåœ¨ <code>index_order</code> ç´¢å¼•çš„ <code>order_no = 1006</code> è¿™æ¡è®°å½•ä¸Šï¼ŒæŒæœ‰äº†ä¸€ä¸ªXå‹çš„è®°å½•é” (<code>LOCK_MODE: X,REC_NOT_GAP</code>)ã€‚</p>
<p>å†çœ‹äº‹åŠ¡Bæƒ³è·å–ä»€ä¹ˆé”ï¼Œä»¥åŠå®ƒçš„çŠ¶æ€ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412395893.png" alt="1747412395893"><br>
äº‹åŠ¡Bæƒ³åœ¨ <code>index_order</code> ç´¢å¼•çš„ <code>order_no = 1006</code> è®°å½•ä¸Šè·å–ä¸€ä¸ªSå‹çš„next-keyé” (<code>LOCK_MODE: S</code>)ï¼Œä½†å› ä¸ºä¸äº‹åŠ¡Açš„Xå‹è®°å½•é”å†²çªï¼Œæ‰€ä»¥å®ƒçš„çŠ¶æ€æ˜¯ <code>WAITING</code>ã€‚</p>
<p>è¿™ä¸ªå®éªŒå‘Šè¯‰æˆ‘ä»¬ï¼šå½“å¤šä¸ªäº‹åŠ¡å¹¶å‘æ’å…¥å…·æœ‰å”¯ä¸€äºŒçº§ç´¢å¼•çš„è®°å½•æ—¶ï¼Œç¬¬ä¸€ä¸ªæˆåŠŸæ’å…¥çš„äº‹åŠ¡ï¼ˆå³ä½¿æœªæäº¤ï¼‰çš„è®°å½•ä¼šå—åˆ°éšå¼é”ä¿æŠ¤ã€‚å½“åç»­äº‹åŠ¡å°è¯•æ’å…¥ç›¸åŒå”¯ä¸€é”®çš„è®°å½•æ—¶ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡çš„éšå¼é”ä¼šå¼ºåŒ–ä¸ºæ˜¾å¼çš„Xå‹è®°å½•é”ï¼Œè€Œåç»­äº‹åŠ¡åˆ™å› è¯·æ±‚Så‹next-keyé”ä¸ä¹‹å†²çªè€Œè¢«é˜»å¡ã€‚</p>
<p><strong>å½¢æˆå¯¹æ¯”çš„æ˜¯</strong>ï¼šå¦‚æœ <code>order_no</code> å­—æ®µåªæ˜¯ä¸€ä¸ªæ™®é€šçš„éå”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆä¸¤ä¸ªäº‹åŠ¡å…ˆåæ‰§è¡Œç›¸åŒçš„INSERTè¯­å¥ï¼Œé€šå¸¸æ˜¯ä¸ä¼šäº’ç›¸é˜»å¡çš„ï¼ˆé™¤éæœ‰å…¶ä»–é”æœºåˆ¶ä»‹å…¥ï¼Œæ¯”å¦‚é—´éš™é”å¯¼è‡´çš„é˜»å¡ï¼Œå°±åƒæˆ‘ä»¬æœ€åˆçš„æ­»é”æ¡ˆä¾‹é‚£æ ·ï¼‰ã€‚å®ƒä»¬éƒ½èƒ½æˆåŠŸæ’å…¥å„è‡ªçš„è®°å½•ï¼Œè¡¨é‡Œå°±ä¼šå‡ºç°ä¸¤æ¡ <code>order_no</code> ç›¸åŒçš„è®°å½•ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1747412403318.png" alt="1747412403318"></p>
<h2 id="å¦‚ä½•é¿å…æ­»é”ï¼Ÿ">å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</h2>
<p>æ­»é”çš„å‘ç”Ÿéœ€è¦æ»¡è¶³å››ä¸ªå¿…è¦æ¡ä»¶ï¼š<strong>äº’æ–¥</strong>ï¼ˆèµ„æºä¸èƒ½å…±äº«ï¼‰ã€<strong>å æœ‰ä¸”ç­‰å¾…</strong>ï¼ˆæ‹¿ç€è‡ªå·±çš„ï¼Œè¿˜æƒ³è¦åˆ«äººçš„ï¼‰ã€<strong>ä¸å¯å¼ºå ç”¨</strong>ï¼ˆä¸èƒ½æŠ¢åˆ«äººçš„ï¼‰ã€<strong>å¾ªç¯ç­‰å¾…</strong>ï¼ˆå½¢æˆä¸€ä¸ªç­‰å¾…é“¾ï¼‰ã€‚åªè¦ç ´åå…¶ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶ï¼Œç†è®ºä¸Šå°±å¯ä»¥é¿å…æ­»é”ã€‚</p>
<p>åœ¨æ•°æ®åº“å±‚é¢ï¼Œé€šå¸¸æœ‰ä¸¤ç§ç­–ç•¥æ¥å¤„ç†å·²ç»å‘ç”Ÿçš„æ­»é”ï¼Œå®ƒä»¬ä¸»è¦æ˜¯é€šè¿‡&quot;æ‰“ç ´å¾ªç¯ç­‰å¾…æ¡ä»¶&quot;æ¥å®ç°çš„ï¼š</p>
<ol>
<li>
<p><strong>è®¾ç½®äº‹åŠ¡ç­‰å¾…é”çš„è¶…æ—¶æ—¶é—´</strong>ï¼šå¯ä»¥ç»™äº‹åŠ¡è®¾ç½®ä¸€ä¸ªæœ€é•¿ç­‰å¾…é”çš„æ—¶é—´ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡ç­‰å¾…è¶…è¿‡äº†è¿™ä¸ªè®¾å®šçš„é˜ˆå€¼ï¼Œæ•°æ®åº“å°±ä¼šè‡ªåŠ¨å›æ»šè¿™ä¸ªè¶…æ—¶çš„äº‹åŠ¡ï¼Œä»è€Œé‡Šæ”¾å®ƒå æœ‰çš„é”ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚åœ¨InnoDBä¸­ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ <code>innodb_lock_wait_timeout</code>ï¼Œé»˜è®¤å€¼é€šå¸¸æ˜¯50ç§’ã€‚<br>
å½“å‘ç”Ÿè¶…æ—¶åï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„é”™è¯¯æç¤ºï¼š<br>
<img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1748172386672.png" alt="1748172386672"></p>
</li>
<li>
<p><strong>å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹</strong>ï¼šInnoDBå¼•æ“æœ‰ä¸€ä¸ªå†…ç½®çš„æ­»é”æ£€æµ‹æœºåˆ¶ã€‚å½“å®ƒå‘ç°æ­»é”æ—¶ï¼Œä¼šä¸»åŠ¨é€‰æ‹©ä¸€ä¸ª&quot;ç‰ºç‰²è€…&quot;ï¼ˆé€šå¸¸æ˜¯å›æ»šä»£ä»·æœ€å°çš„é‚£ä¸ªäº‹åŠ¡ï¼‰ï¼Œå°†å®ƒå›æ»šæ‰ï¼Œä»è€Œè§£å¼€æ­»é”é“¾æ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡ç»§ç»­ã€‚è¿™ä¸ªåŠŸèƒ½é€šè¿‡å‚æ•° <code>innodb_deadlock_detect</code> æ§åˆ¶ï¼Œé»˜è®¤å°±æ˜¯å¼€å¯çš„ã€‚<br>
å½“æ£€æµ‹åˆ°æ­»é”å¹¶å›æ»šäº†æŸä¸ªäº‹åŠ¡åï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°è¿™æ ·çš„æç¤ºï¼š<br>
<img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL-%E6%AD%BB%E9%94%81%E4%BA%86-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/1748172399956.png" alt="1748172399956"></p>
</li>
</ol>
<p>ä¸Šé¢è¿™ä¸¤ç§ç­–ç•¥æ›´åƒæ˜¯&quot;æ­»é”å‘ç”Ÿåçš„åº”å¯¹æªæ–½&quot;ï¼Œè€Œä¸æ˜¯å®Œå…¨çš„&quot;é¢„é˜²&quot;ã€‚</p>
<p>é‚£ä¹ˆï¼Œä»ä¸šåŠ¡é€»è¾‘çš„è§’åº¦ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ä¸»åŠ¨åšäº›ä»€ä¹ˆæ¥é¢„é˜²ç±»ä¼¼æˆ‘ä»¬æ¡ˆä¾‹ä¸­çš„æ­»é”å‘¢ï¼Ÿ<br>
å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ€åˆä½¿ç”¨ <code>select ... for update</code> åšå¹‚ç­‰æ€§æ ¡éªŒï¼Œæ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°é‡å¤è®¢å•ã€‚å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°æ®åº“æœ¬èº«çš„çº¦æŸæœºåˆ¶æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼š<strong>ç›´æ¥å°† <code>order_no</code> å­—æ®µè®¾ç½®ä¸ºå”¯ä¸€ç´¢å¼•åˆ—</strong>ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“å°è¯•æ’å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ <code>order_no</code> æ—¶ï¼Œæ•°æ®åº“å±‚é¢å°±ä¼šç›´æ¥æŠ¥é”™ï¼ˆå”¯ä¸€æ€§å†²çªï¼‰ï¼Œä»æ ¹æœ¬ä¸Šé˜»æ­¢äº†é‡å¤è®¢å•çš„äº§ç”Ÿã€‚è¿™ç§æ–¹å¼ç®€å•ç›´æ¥ï¼Œè™½ç„¶åœ¨æ’å…¥é‡å¤è®¢å•æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆåº”ç”¨å±‚é¢éœ€è¦å¦¥å–„å¤„ç†è¿™ç§å¼‚å¸¸ï¼‰ï¼Œä½†å®ƒé€šå¸¸èƒ½æœ‰æ•ˆé¿å…å› å¤æ‚çš„é”ç«äº‰è€Œå¯¼è‡´çš„æ­»é”é—®é¢˜ã€‚</p>
<p>å½“ç„¶ï¼Œå…·ä½“çš„è§£å†³æ–¹æ¡ˆè¿˜éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯å’Œå¹¶å‘æƒ…å†µæ¥ç»¼åˆè¯„ä¼°ã€‚ç†è§£é”æœºåˆ¶ï¼Œåˆç†è®¾è®¡è¡¨ç»“æ„å’Œäº‹åŠ¡é€»è¾‘ï¼Œæ˜¯å‡å°‘æ­»é”çš„å…³é”®ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li>ã€ŠMySQL æ˜¯æ€æ ·è¿è¡Œçš„ï¼Ÿã€‹</li>
<li><a href="http://mysql.taobao.org/monthly/2020/09/06/">http://mysql.taobao.org/monthly/2020/09/06/</a></li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>é”</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>é”æœºåˆ¶</tag>
        <tag>æ­»é”</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸­çš„è®°å½•é”ä¸é—´éš™é”ï¼šèƒ½å¦æŠµæŒ¡åˆ é™¤æ“ä½œå¼•å‘çš„å¹»è¯»ï¼Ÿ</title>
    <url>/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/</url>
    <content><![CDATA[<h1>MySQL è®°å½•é” + é—´éš™é”èƒ½æŒ¡ä½åˆ é™¤æ“ä½œçš„å¹»è¯»å—ï¼Ÿ</h1>
<p>æœ‰ä½å€™é€‰äººåˆ†äº«äº†ä»–åœ¨ç¾å›¢äºŒé¢æ—¶é‡åˆ°çš„ä¸€ä¸ªå…³äº MySQL å¹»è¯»çš„åœºæ™¯ã€‚é¢è¯•ä¸­ï¼Œä»–æåˆ°åœ¨å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œå½“å‰è¯»é€šè¿‡è®°å½•é”å’Œé—´éš™é”æ¥è§£å†³å¹»è¯»ï¼Œå¹¶è¯´æ˜é—´éš™é”çš„ç›®çš„æ˜¯é˜²æ­¢æ•°æ®çš„æ’å…¥ã€‚é¢è¯•å®˜éšå³åé—®ï¼šâ€œå¦‚æœæ­¤æ—¶æ‰§è¡Œåˆ é™¤ï¼ˆDELETEï¼‰æŒ‡ä»¤ï¼Œæ˜¯å¦ä¼šå¯¼è‡´å¹»è¯»ï¼Ÿâ€ è¿™ä½å€™é€‰äººå½“æ—¶å›ç­”â€œä¼šâ€ï¼Œä½†äº‹åå¯¹æ­¤ç­”æ¡ˆæ„Ÿåˆ°ä¸ç¡®å®šï¼Œå› æ­¤å¸Œæœ›èƒ½æ˜ç¡®è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒå¯ä»¥å½’çº³ä¸ºï¼š<strong>MySQL è®°å½•é” + é—´éš™é”å¯ä»¥é˜²æ­¢åˆ é™¤æ“ä½œè€Œå¯¼è‡´çš„å¹»è¯»å—ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>èƒ½ï¼</strong></p>
<p>åˆ«æ€¥ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªå°å®éªŒæ¥ä¸€æ­¥æ­¥æ­å¼€è¿™ä¸ªè°œåº•ï¼Œé¡ºä¾¿ä¹Ÿæ¸©ä¹ ä¸€ä¸‹è®°å½•é”å’Œé—´éš™é”è¿™ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯å¹»è¯»ï¼Ÿ">ä»€ä¹ˆæ˜¯å¹»è¯»ï¼Ÿ</h2>
<p>å’±ä»¬å…ˆçœ‹çœ‹ MySQL å®˜æ–¹æ–‡æ¡£æ˜¯æ€ä¹ˆè§£é‡Š&quot;å¹»è¯»&quot;ï¼ˆPhantom Readï¼‰çš„ï¼š</p>
<blockquote>
<p><strong><em>The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a â€œphantomâ€ row.</em></strong></p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œå¹»è¯»å°±æ˜¯<strong>åœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ç³»åˆ—æ“ä½œçš„é›†åˆï¼‰é‡Œï¼ŒåŒæ ·çš„æŸ¥è¯¢å‘½ä»¤ï¼Œåœ¨ä¸åŒæ—¶é—´æ‰§è¡Œåï¼Œå¾—åˆ°çš„ç»“æœé›†ä¸ä¸€æ ·äº†ã€‚</strong> æ¯”å¦‚ï¼Œä½ ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œè¿”å›äº†5æ¡æ•°æ®ï¼›è¿‡äº†ä¸€ä¼šå„¿ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œä½ å†æ¬¡æ‰§è¡ŒåŒæ ·çš„æŸ¥è¯¢ï¼Œç»“æœå´è¿”å›äº†6æ¡æ•°æ®ï¼ˆå¤šäº†ä¸€æ¡&quot;å¹½çµ&quot;èˆ¬çš„æ•°æ®ï¼‰ï¼Œæˆ–è€…åªè¿”å›äº†4æ¡æ•°æ®ï¼ˆå°‘äº†ä¸€æ¡æ•°æ®ï¼‰ã€‚è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±è¯´å‘ç”Ÿäº†å¹»è¯»ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ªäº‹åŠ¡åœ¨ T1 å’Œ T2 ä¸¤ä¸ªæ—¶é—´ç‚¹éƒ½æ‰§è¡Œäº†ä¸‹é¢è¿™æ¡æŸ¥è¯¢è¯­å¥ï¼Œå¹¶ä¸”ä¸­é—´æ²¡æœ‰åšä»»ä½•å…¶ä»–æ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_test <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ T1 æ—¶åˆ»æŸ¥è¯¢åˆ° 5 æ¡è®°å½•ï¼Œè€Œ T2 æ—¶åˆ»æŸ¥è¯¢åˆ°äº† 6 æ¡è®°å½•ï¼Œè¿™å°±æ˜¯å¹»è¯»ã€‚<br>
åè¿‡æ¥ï¼Œå¦‚æœ T1 æ—¶åˆ»æŸ¥è¯¢åˆ° 5 æ¡è®°å½•ï¼Œè€Œ T2 æ—¶åˆ»æŸ¥è¯¢åˆ°äº† 4 æ¡è®°å½•ï¼Œè¿™ä¹Ÿç®—æ˜¯å¹»è¯»ã€‚</p>
<blockquote>
<p>MySQL æ˜¯æ€ä¹ˆè§£å†³å¹»è¯»çš„ï¼Ÿ</p>
</blockquote>
<p>MySQL çš„ InnoDB å­˜å‚¨å¼•æ“ï¼Œåœ¨å®ƒé»˜è®¤çš„&quot;å¯é‡å¤è¯»&quot;éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»é—®é¢˜ï¼ˆè™½ç„¶ä¸æ˜¯100%å®Œç¾è§£å†³ï¼Œæœ‰äº›æç«¯æƒ…å†µè¿˜æ˜¯å¯èƒ½å‘ç”Ÿï¼Œæƒ³æ·±å…¥äº†è§£å¯ä»¥çœ‹çœ‹è¿™ç¯‡<a href="/2025/05/07/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-07-MySQL-%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E%E5%B9%BB%E8%AF%BB/">æ–‡ç« </a>ã€‚å®ƒä¸»è¦ç”¨äº†ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>å¯¹äº<strong>å¿«ç…§è¯»</strong>ï¼ˆå°±æ˜¯æˆ‘ä»¬å¹³æ—¶ç”¨çš„æ™®é€š <code>SELECT</code> è¯­å¥ï¼‰ï¼ŒMySQL é€šè¿‡ä¸€ç§å«åš <strong>MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</strong> çš„æœºåˆ¶æ¥è§£å†³å¹»è¯»ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œå§‹ç»ˆå’Œå®ƒåˆšå¯åŠ¨æ—¶çœ‹åˆ°çš„ä¸€æ ·ï¼Œå°±ç®—å…¶ä»–äº‹åŠ¡åœ¨è¿™æœŸé—´æ’å…¥äº†æ–°æ•°æ®ï¼Œå½“å‰äº‹åŠ¡ä¹Ÿ&quot;çœ‹ä¸è§&quot;ï¼Œè‡ªç„¶å°±é¿å…äº†å¹»è¯»ã€‚</li>
<li>å¯¹äº<strong>å½“å‰è¯»</strong>ï¼ˆæ¯”å¦‚ <code>SELECT ... FOR UPDATE</code> è¿™ç§ä¼šåŠ é”çš„æŸ¥è¯¢ï¼‰ï¼ŒMySQL åˆ™é€šè¿‡ <strong>next-key lockï¼ˆå®ƒå…¶å®æ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆï¼‰</strong> æ¥è§£å†³å¹»è¯»ã€‚å½“æ‰§è¡Œè¿™ç±»æŸ¥è¯¢æ—¶ï¼ŒMySQL ä¼šåœ¨ç›¸å…³çš„æ•°æ®èŒƒå›´ä¸ŠåŠ ä¸Š next-key lockã€‚è¿™æ—¶ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡æƒ³åœ¨è¿™ä¸ªé”å®šçš„èŒƒå›´å†…æ’å…¥æ–°æ•°æ®ï¼Œå°±ä¼šè¢«é˜»å¡ï¼Œæ’ä¸è¿›å»ï¼Œä¹Ÿå°±é¿å…äº†å¹»è¯»ã€‚</li>
</ul>
<h2 id="å®éªŒéªŒè¯">å®éªŒéªŒè¯</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥éªŒè¯ä¸€ä¸‹å‰é¢çš„ç»“è®ºï¼šâ€œMySQL çš„è®°å½•é” + é—´éš™é”<strong>ç¡®å®å¯ä»¥é˜²æ­¢</strong>å› åˆ é™¤æ•°æ®è€Œå¼•å‘çš„å¹»è¯»é—®é¢˜â€ã€‚</p>
<p>å®éªŒç¯å¢ƒï¼šMySQL 8.0 ç‰ˆæœ¬ï¼Œéš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ã€‚</p>
<p>æˆ‘ä»¬å…ˆå‡†å¤‡ä¸€å¼ ç”¨æˆ·è¡¨ <code>t_user</code>ï¼Œè¿™å¼ è¡¨ç»“æ„å¾ˆç®€å•ï¼Œ<strong>åªæœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼• <code>id</code></strong>ã€‚è¡¨é‡Œå·²ç»æœ‰ä¸€äº›æ•°æ®ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>reward</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>è·¯é£</td>
<td>19</td>
<td>3000000000</td>
</tr>
<tr>
<td>2</td>
<td>ç´¢éš†</td>
<td>21</td>
<td>11100000000</td>
</tr>
<tr>
<td>3</td>
<td>å±±æ²»</td>
<td>21</td>
<td>1000000000</td>
</tr>
<tr>
<td>4</td>
<td>ä¹Œç´¢æ™®</td>
<td>19</td>
<td>500000000</td>
</tr>
<tr>
<td>5</td>
<td>é¦™å…‹æ–¯</td>
<td>39</td>
<td>4000000000</td>
</tr>
<tr>
<td>6</td>
<td>é¹°çœ¼</td>
<td>43</td>
<td>3500000000</td>
</tr>
<tr>
<td>7</td>
<td>ç½—</td>
<td>23</td>
<td>3000000000</td>
</tr>
<tr>
<td>8</td>
<td>åŸºå¾·</td>
<td>23</td>
<td>3000000000</td>
</tr>
<tr>
<td>9</td>
<td>ä¹”å·´</td>
<td>17</td>
<td>1000</td>
</tr>
</tbody>
</table>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¼€å¯ä¸€ä¸ªäº‹åŠ¡ Aï¼Œæ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥æ‰¾å¹´é¾„å¤§äº 20 å²çš„ç”¨æˆ·ï¼Œå‘ç°æœ‰ 6 æ¡è®°å½•ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1747398796814.png" alt="1747398796814"></p>
<p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬å¼€å¯å¦ä¸€ä¸ªäº‹åŠ¡ Bï¼Œå°è¯•åˆ é™¤ <code>id = 2</code> çš„è¿™æ¡è®°å½•ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1747398946132.png" alt="1747398946132"></p>
<p>ä½ ä¼šå‘ç°ï¼Œäº‹åŠ¡ B çš„åˆ é™¤æ“ä½œä¼šä¸€ç›´å¡åœ¨é‚£é‡Œï¼Œæ˜¾ç¤º<strong>ç­‰å¾…çŠ¶æ€</strong>ï¼Œæ ¹æœ¬åˆ ä¸æ‰ã€‚</p>
<p>è¿™å°±è¯æ˜äº†ï¼šMySQL çš„è®°å½•é” + é—´éš™é”<strong>ç¡®å®å¯ä»¥é˜²æ­¢</strong>å› ä¸ºåˆ é™¤æ•°æ®è€Œå¼•å‘çš„å¹»è¯»é—®é¢˜ã€‚</p>
<h3 id="åŠ é”åˆ†æ">åŠ é”åˆ†æ</h3>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œäº‹åŠ¡ A åœ¨æ‰§è¡Œ <code>SELECT ... FOR UPDATE</code> è¯­å¥æ—¶ï¼Œåˆ°åº•ç»™æ•°æ®åŠ äº†å“ªäº›é”å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ <code>select * from performance_schema.data_locks\G;</code> è¿™æ¡å‘½ä»¤æ¥æŸ¥çœ‹äº‹åŠ¡åœ¨æ‰§è¡Œ SQL æ—¶éƒ½åŠ äº†å“ªäº›é”ã€‚</p>
<p>è¿™æ¡å‘½ä»¤è¾“å‡ºçš„ä¿¡æ¯é€šå¸¸æ¯”è¾ƒå¤šï¼Œè¿™é‡Œæˆ‘ä»¬åªçœ‹å…³é”®éƒ¨åˆ†ï¼ˆæ€»å…±æœ‰11è¡Œï¼Œæˆ‘åšäº†ä¸€äº›åˆ å‡ï¼‰ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1747398955476.png" alt="1747398955476"></p>
<p>ä»ä¸Šé¢çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦åŠ äº†ä¸¤ç§ç±»å‹çš„é”ï¼š</p>
<ul>
<li><strong>è¡¨é”</strong> (<code>LOCK_TYPE: TABLE</code>)ï¼šè¿™é‡Œæ˜¯ä¸€ä¸ª X ç±»å‹çš„æ„å‘é”ï¼ˆç®€å•ç†è§£ä¸ºï¼Œæˆ‘è¦å¯¹è¡¨é‡ŒæŸäº›è¡ŒåŠ é”äº†ï¼Œå…ˆåœ¨è¡¨çº§åˆ«æ‰“ä¸ªæ‹›å‘¼ï¼‰ã€‚</li>
<li><strong>è¡Œé”</strong> (<code>LOCK_TYPE: RECORD</code>)ï¼šè¿™é‡Œæ˜¯å¤šä¸ª X ç±»å‹çš„ next-key é”ã€‚</li>
</ul>
<p>æˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„æ˜¯&quot;è¡Œé”&quot;ã€‚æ³¨æ„ï¼Œå›¾ä¸­çš„ <code>LOCK_TYPE</code> æ˜¾ç¤ºä¸º <code>RECORD</code>ï¼Œä½†è¿™æŒ‡çš„æ˜¯è¡Œçº§é”çš„æ€»ç§°ï¼Œå…·ä½“æ˜¯å“ªç§è¡Œé”ï¼Œè¿˜éœ€è¦çœ‹ <code>LOCK_MODE</code>ï¼š</p>
<ul>
<li>å¦‚æœ <code>LOCK_MODE</code> æ˜¯ <code>X</code>ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª next-key é”ï¼ˆè®°å½•é” + é—´éš™é”çš„ç»„åˆï¼‰ã€‚</li>
<li>å¦‚æœ <code>LOCK_MODE</code> æ˜¯ <code>X, REC_NOT_GAP</code>ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªè®°å½•é”ï¼ˆåªé”ä½æŸæ¡è®°å½•ï¼Œä¸é”é—´éš™ï¼‰ã€‚</li>
<li>å¦‚æœ <code>LOCK_MODE</code> æ˜¯ <code>X, GAP</code>ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªé—´éš™é”ï¼ˆåªé”ä½è®°å½•ä¹‹é—´çš„é—´éš™ï¼Œä¸é”è®°å½•æœ¬èº«ï¼‰ã€‚</li>
</ul>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>LOCK_DATA</code> æ¥ç¡®å®š next-key é”çš„å…·ä½“èŒƒå›´ã€‚æ€ä¹ˆçœ‹å‘¢ï¼Ÿ</p>
<ul>
<li>æ ¹æ®ç»éªŒï¼Œå¦‚æœ <code>LOCK_MODE</code> æ˜¯ next-key é”æˆ–é—´éš™é”ï¼Œé‚£ä¹ˆ <strong><code>LOCK_DATA</code> é€šå¸¸è¡¨ç¤ºè¿™ä¸ªé”ç®¡è¾–èŒƒå›´çš„&quot;å³è¾¹ç•Œ&quot;</strong>ã€‚è€Œè¿™ä¸ªé”çš„&quot;å·¦è¾¹ç•Œ&quot;ï¼Œå°±æ˜¯ <code>LOCK_DATA</code> å¯¹åº”å€¼çš„å‰ä¸€æ¡è®°å½•çš„å€¼ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œäº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ï¼ˆ<code>INDEX_NAME : PRIMARY</code>ï¼‰ä¸ŠåŠ äº† 10 ä¸ª next-key é”ï¼Œå®ƒä»¬çš„èŒƒå›´åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(-âˆ, 1] (è¡¨ç¤ºå°äºç­‰äº1çš„èŒƒå›´)</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(1, 2]  (è¡¨ç¤ºå¤§äº1ä¸”å°äºç­‰äº2çš„èŒƒå›´)</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(2, 3]</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(3, 4]</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(4, 5]</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(5, 6]</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(6, 7]</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(7, 8]</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(8, 9]</li>
<li>X å‹çš„ next-key é”ï¼ŒèŒƒå›´ï¼š(9, +âˆ] (è¡¨ç¤ºå¤§äº9çš„èŒƒå›´)</li>
</ul>
<p><strong>ç®€å•æ¥è¯´ï¼Œè¿™ç›¸å½“äºæŠŠæ•´å¼ è¡¨ä»å¤´åˆ°å°¾éƒ½ç»™é”ä¸Šäº†ï¼</strong> ä»»ä½•å…¶ä»–äº‹åŠ¡æƒ³è¦åœ¨è¿™å¼ è¡¨ä¸Šè¿›è¡Œå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ“ä½œï¼Œéƒ½ä¼šè¢«é˜»å¡ã€‚</p>
<p>åªæœ‰å½“äº‹åŠ¡ A å®Œæˆï¼ˆæäº¤æˆ–å›æ»šï¼‰åï¼Œå®ƒåŠ çš„è¿™äº›é”æ‰ä¼šè¢«é‡Šæ”¾ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆåªæ˜¯æŸ¥è¯¢å¹´é¾„å¤§äº 20 å²çš„è®°å½•ï¼Œå´æŠŠæ•´å¼ è¡¨éƒ½é”äº†å‘¢ï¼Ÿ</p>
</blockquote>
<p>è¿™æ˜¯å› ä¸ºäº‹åŠ¡ A çš„è¿™æ¡æŸ¥è¯¢è¯­å¥ (<code>SELECT * FROM t_user WHERE age &gt; 20 FOR UPDATE;</code>) å®é™…ä¸Šè¿›è¡Œçš„æ˜¯<strong>å…¨è¡¨æ‰«æ</strong>ã€‚MySQL åœ¨åŠ é”æ—¶ï¼Œå¹¶ä¸æ˜¯åªé’ˆå¯¹æœ€åæŸ¥è¯¢å‡ºæ¥çš„ç»“æœåŠ é”ï¼Œè€Œæ˜¯åœ¨éå†ç´¢å¼•ï¼ˆè¿™é‡Œå› ä¸ºæ²¡æœ‰ <code>age</code> ç´¢å¼•ï¼Œæ‰€ä»¥æ˜¯éå†ä¸»é”®ç´¢å¼•ï¼Œå³å…¨è¡¨æ‰«æï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œé€ä¸ªç»™æ‰«æåˆ°çš„ç´¢å¼•é¡¹åŠ ä¸Šé”ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1747398970013.png" alt="1747398970013"></p>
<p>å› æ­¤ï¼Œ<strong>æ•²é»‘æ¿åˆ’é‡ç‚¹ï¼šåœ¨çº¿ä¸Šç¯å¢ƒæ‰§è¡Œ <code>UPDATE</code>ã€<code>DELETE</code> æˆ–è€… <code>SELECT ... FOR UPDATE</code>è¿™ç±»ä¼šåŠ é”çš„è¯­å¥æ—¶ï¼Œä¸€å®šè¦ç¡®ä¿æŸ¥è¯¢æ¡ä»¶èƒ½ç”¨ä¸Šç´¢å¼•ã€‚å¦‚æœèµ°äº†å…¨è¡¨æ‰«æï¼ŒMySQL å°±ä¼šç»™æ‰«æåˆ°çš„æ¯ä¸€ä¸ªç´¢å¼•é¡¹éƒ½åŠ ä¸Š next-key é”ï¼Œç»“æœå°±æ˜¯æ•´å¼ è¡¨éƒ½è¢«é”ä½ï¼Œè¿™å¯æ˜¯ä¸ªå¤§éº»çƒ¦ï¼Œä¼šä¸¥é‡å½±å“å¹¶å‘æ€§èƒ½ï¼</strong></p>
<blockquote>
<p>å¦‚æœç»™ <code>age</code> å­—æ®µåŠ ä¸Šç´¢å¼•ï¼Œäº‹åŠ¡ A è¿™æ¡æŸ¥è¯¢åˆä¼šåŠ å“ªäº›é”å‘¢ï¼Ÿ</p>
</blockquote>
<p>å¥½é—®é¢˜ï¼æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬<strong>ç»™ <code>age</code> å­—æ®µåˆ›å»ºä¸€ä¸ªç´¢å¼•</strong>ï¼Œç„¶åå†æ¥æ‰§è¡ŒåŒæ ·çš„æŸ¥è¯¢è¯­å¥ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1747398980779.png" alt="1747398980779"></p>
<p>å†æ¬¡ä½¿ç”¨ <code>select * from performance_schema.data_locks\G;</code> æ¥æŸ¥çœ‹åŠ é”æƒ…å†µã€‚</p>
<p>è¿™æ¬¡çš„è¾“å‡ºæˆ‘å°±ä¸å…¨è´´å‡ºæ¥äº†ï¼Œç›´æ¥è¯´ç»“è®ºï¼š</p>
<p><strong>å› ä¸ºç°åœ¨è¡¨é‡Œæœ‰ä¸¤ä¸ªç´¢å¼•äº†ï¼šä¸»é”®ç´¢å¼• <code>id</code> å’Œæˆ‘ä»¬åˆšåŠ çš„ <code>age</code> ç´¢å¼•ã€‚æ‰€ä»¥ï¼ŒMySQL ä¼šåˆ†åˆ«åœ¨è¿™ä¸¤ä¸ªç´¢å¼•ä¸ŠåŠ é”ã€‚</strong></p>
<p>åœ¨<strong>ä¸»é”®ç´¢å¼•</strong>ä¸Šï¼Œä¼šåŠ ä»¥ä¸‹é”ï¼š</p>
<ul>
<li>X å‹çš„è®°å½•é”ï¼Œé”ä½ <code>id = 2</code> è¿™æ¡è®°å½•ã€‚</li>
<li>X å‹çš„è®°å½•é”ï¼Œé”ä½ <code>id = 3</code> è¿™æ¡è®°å½•ã€‚</li>
<li>X å‹çš„è®°å½•é”ï¼Œé”ä½ <code>id = 5</code> è¿™æ¡è®°å½•ã€‚</li>
<li>X å‹çš„è®°å½•é”ï¼Œé”ä½ <code>id = 6</code> è¿™æ¡è®°å½•ã€‚</li>
<li>X å‹çš„è®°å½•é”ï¼Œé”ä½ <code>id = 7</code> è¿™æ¡è®°å½•ã€‚</li>
<li>X å‹çš„è®°å½•é”ï¼Œé”ä½ <code>id = 8</code> è¿™æ¡è®°å½•ã€‚<br>
(è¿™äº›éƒ½æ˜¯ <code>age &gt; 20</code> å¯¹åº”çš„ä¸»é”®id)</li>
</ul>
<p>åœ¨åˆ†æ <strong><code>age</code> ç´¢å¼•</strong>ä¸Šçš„åŠ é”æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬è¦å…ˆåœ¨è„‘æµ·é‡ŒæŠŠ <code>age</code> å­—æ®µçš„å€¼æ’ä¸ªåºï¼ˆå› ä¸ºB+æ ‘ç´¢å¼•æœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼‰ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1748172446598.png" alt="1748172446598"></p>
<p><code>age</code> ç´¢å¼•ä¸Šä¼šåŠ è¿™äº›é”ï¼š</p>
<ul>
<li>X å‹çš„ next-key lockï¼Œé”ä½ <code>age</code> ç´¢å¼•ä¸Š <code>(19, 21]</code> è¿™ä¸ªèŒƒå›´ã€‚</li>
<li>X å‹çš„ next-key lockï¼Œé”ä½ <code>age</code> ç´¢å¼•ä¸Š <code>(21, 21]</code> è¿™ä¸ªèŒƒå›´ (è¿™é‡Œè™½ç„¶å·¦å³è¾¹ç•Œç›¸åŒï¼Œä½†å› ä¸ºæ˜¯next-keyï¼Œå®ƒä¼šé”ä½å€¼ä¸º21çš„è®°å½•ä»¥åŠå…¶åçš„é—´éš™)ã€‚</li>
<li>X å‹çš„ next-key lockï¼Œé”ä½ <code>age</code> ç´¢å¼•ä¸Š <code>(21, 23]</code> è¿™ä¸ªèŒƒå›´ã€‚</li>
<li>X å‹çš„ next-key lockï¼Œé”ä½ <code>age</code> ç´¢å¼•ä¸Š <code>(23, 23]</code> è¿™ä¸ªèŒƒå›´ã€‚</li>
<li>X å‹çš„ next-key lockï¼Œé”ä½ <code>age</code> ç´¢å¼•ä¸Š <code>(23, 39]</code> è¿™ä¸ªèŒƒå›´ã€‚</li>
<li>X å‹çš„ next-key lockï¼Œé”ä½ <code>age</code> ç´¢å¼•ä¸Š <code>(39, 43]</code> è¿™ä¸ªèŒƒå›´ã€‚</li>
<li>X å‹çš„ next-key lockï¼Œé”ä½ <code>age</code> ç´¢å¼•ä¸Š <code>(43, +âˆ]</code> è¿™ä¸ªèŒƒå›´ (é”ä½å¤§äºç­‰äº43çš„è®°å½•ä»¥åŠä¹‹åæ— ç©·å¤§çš„é—´éš™)ã€‚</li>
</ul>
<p>ç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼Œ<strong>åœ¨ <code>age</code> ç´¢å¼•ä¸Šï¼Œnext-key é”è¦†ç›–çš„èŒƒå›´æ˜¯ <code>(19, +âˆ]</code>ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰ <code>age &gt; 19</code> çš„è®°å½•ä»¥åŠå®ƒä»¬ä¹‹é—´çš„é—´éš™ï¼Œä¸€ç›´åˆ°æ­£æ— ç©·ã€‚</strong></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç»™ <code>age</code> å­—æ®µåŠ ä¸Šç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥å°±ä»å…¨è¡¨æ‰«æå˜æˆäº†ç´¢å¼•æŸ¥è¯¢ï¼Œå› æ­¤<strong>ä¸ä¼šå†é”ä½æ•´å¼ è¡¨äº†</strong>ï¼Œé”çš„èŒƒå›´ç²¾å‡†äº†å¾ˆå¤šã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1747399030724.png" alt="1747399030724"></p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨ç»™ <code>age</code> å­—æ®µåˆ›å»ºç´¢å¼•åï¼Œå½“äº‹åŠ¡ A æ‰§è¡Œ <code>SELECT * FROM t_user WHERE age &gt; 20 FOR UPDATE;</code> è¿™æ¡æŸ¥è¯¢æ—¶ï¼Œä¸»é”®ç´¢å¼•å’Œ <code>age</code> ç´¢å¼•ä¸Šä¼šåŠ ä¸Šå¦‚ä¸‹å›¾æ‰€ç¤ºçš„é”ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1747399042109.png" alt="1747399042109"></p>
<p>å½“äº‹åŠ¡ A åŠ ä¸Šè¿™äº›é”ä¹‹åï¼Œå…¶ä»–çš„äº‹åŠ¡ï¼ˆæ¯”å¦‚ Bã€Cã€Dã€Eï¼‰å¦‚æœæƒ³æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œéƒ½ä¼šè¢«é˜»å¡ï¼š</p>
<ul>
<li><strong>äº‹åŠ¡ B (åˆ é™¤):</strong> <code>DELETE FROM t_user WHERE id = 2;</code> (å› ä¸º <code>id=2</code> çš„ä¸»é”®è®°å½•è¢«é”äº†ï¼Œä¸” <code>age=21</code> ä¹Ÿåœ¨ <code>age</code> ç´¢å¼•çš„é”å®šèŒƒå›´å†…)</li>
<li><strong>äº‹åŠ¡ C (æ›´æ–°):</strong> <code>UPDATE t_user SET name = 'å¨œç¾' WHERE id = 3;</code> (å› ä¸º <code>id=3</code> çš„ä¸»é”®è®°å½•è¢«é”äº†)</li>
<li><strong>äº‹åŠ¡ D (æ’å…¥):</strong> <code>INSERT INTO t_user (id, name, age, reward) VALUES (10, 'ç½—å®¾', 30, 130000000);</code> (å› ä¸º <code>age=30</code> è½åœ¨äº† <code>age</code> ç´¢å¼•çš„ <code>(23, 39]</code> è¿™ä¸ª next-key é”çš„é—´éš™å†…)</li>
<li><strong>äº‹åŠ¡ E (æ›´æ–°):</strong> <code>UPDATE t_user SET age = 22 WHERE id = 1;</code> (è™½ç„¶ <code>id=1</code> çš„ä¸»é”®è®°å½•æ²¡è¢«é”ï¼Œä½†æ˜¯è¦æ›´æ–°çš„ <code>age=22</code> è½åœ¨äº† <code>age</code> ç´¢å¼•çš„ <code>(21, 23]</code> è¿™ä¸ª next-key é”çš„é—´éš™å†…)</li>
</ul>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-16-MySQL%E8%AE%B0%E5%BD%95%E9%94%81%E4%B8%8E%E9%97%B4%E9%9A%99%E9%94%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E7%9A%84%E5%B9%BB%E8%AF%BB/1747399048011.png" alt="1747399048011"></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨ MySQL çš„&quot;å¯é‡å¤è¯»&quot;éš”ç¦»çº§åˆ«ä¸‹ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œä¼šåŠ é”çš„æŸ¥è¯¢è¯­å¥ï¼ˆæ¯”å¦‚ <code>SELECT ... FOR UPDATE</code>ï¼‰æ—¶ï¼ŒMySQL ä¼šåœ¨ç›¸å…³çš„<strong>ç´¢å¼•</strong>ä¸ŠåŠ ä¸Šè®°å½•é”å’Œé—´éš™é”ï¼ˆä¹Ÿå°±æ˜¯ next-key é”ï¼‰ã€‚è¿™å¥—ç»„åˆæ‹³éå¸¸æœ‰æ•ˆï¼Œå¯ä»¥é˜²æ­¢å…¶ä»–äº‹åŠ¡é€šè¿‡æ’å…¥ã€åˆ é™¤æˆ–ä¿®æ”¹æ•°æ®æ¥æ£ä¹±ï¼Œä»è€Œé¿å…äº†å¹»è¯»é—®é¢˜ã€‚</p>
<p>æœ€é‡è¦çš„ä¸€ç‚¹å†æ¬¡å¼ºè°ƒï¼šåœ¨æ‰§è¡Œ <code>UPDATE</code>ã€<code>DELETE</code>ã€<code>SELECT ... FOR UPDATE</code> è¿™ç±»è¯­å¥æ—¶ï¼Œ<strong>ä¸€å®šè¦æ£€æŸ¥å®ƒä»¬æ˜¯å¦èƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•</strong>ã€‚å¦‚æœèµ°äº†å…¨è¡¨æ‰«æï¼ŒMySQL ä¼šç»™æ‰«æåˆ°çš„æ¯ä¸€ä¸ªç´¢å¼•é¡¹ï¼ˆé€šå¸¸æ˜¯ä¸»é”®ç´¢å¼•çš„æ¯ä¸€æ¡è®°å½•ï¼‰éƒ½åŠ ä¸Š next-key é”ï¼Œç»“æœå°±æ˜¯æ•´å¼ è¡¨éƒ½è¢«é”å¾—æ­»æ­»çš„ï¼Œè¿™å¯¹ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›æ˜¯ä¸ªå·¨å¤§çš„æ‰“å‡»ã€‚</p>
<p>æå®šï¼å¸Œæœ›è¿™æ¬¡çš„è§£é‡Šèƒ½è®©ä½ å½»åº•æ˜ç™½ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>é”</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>å¹»è¯»</tag>
        <tag>InnoDB</tag>
        <tag>äº‹åŠ¡</tag>
        <tag>è®°å½•é”</tag>
        <tag>é—´éš™é”</tag>
        <tag>Next-Keyé”</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸­updateä¸å¸¦ç´¢å¼•çš„å±é™©ï¼šå…¨è¡¨é”å®šè¯¦è§£</title>
    <url>/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/update%E6%B2%A1%E5%8A%A0%E7%B4%A2%E5%BC%95%E4%BC%9A%E9%94%81%E5%85%A8%E8%A1%A8/</url>
    <content><![CDATA[<h1>update æ²¡åŠ ç´¢å¼•ä¼šé”å…¨è¡¨ï¼Ÿ åˆ«å†è®©ä½ çš„æ•°æ®åº“&quot;ç½¢å·¥&quot;äº†ï¼</h1>
<p>æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šä¸€ä¸ªå¹³å¹³æ— å¥‡çš„å·¥ä½œæ—¥ï¼Œä½ ç†Ÿç»ƒåœ°åœ¨ç”Ÿäº§æ•°æ®åº“ä¸Šæ•²ä¸‹äº†ä¸€è¡Œçœ‹ä¼¼äººç•œæ— å®³çš„ <code>UPDATE</code> è¯­å¥ã€‚å‡ åˆ†é’Ÿåï¼Œç›‘æ§ç³»ç»Ÿè­¦æŠ¥å£°æ­¤èµ·å½¼ä¼ï¼Œç”¨æˆ·æŠ±æ€¨é›ªç‰‡èˆ¬é£æ¥ï¼Œç½‘ç«™å¡å¾—åƒåœ¨æ’­æ”¾æ…¢åŠ¨ä½œï¼Œæ•´ä¸ªä¸šåŠ¡å‡ ä¹é™·å…¥åœé¡¿ã€‚ç„¶åï¼Œä½ çš„è€æ¿â€œäº²åˆ‡â€åœ°è¯·ä½ å»åŠå…¬å®¤â€œèŠèŠäººç”Ÿâ€â€¦â€¦</p>
<p>è¿™å¯ä¸æ˜¯å±è¨€è€¸å¬ï¼Œè€Œæ˜¯ä¸å°‘å¼€å‘è€…éƒ½æ›¾è¸©è¿‡çš„â€œå¤©å‘â€ã€‚è€Œå¼•å‘è¿™åœºâ€œç¾éš¾â€çš„ï¼Œå¾€å¾€å°±æ˜¯ä¸€æ¡å†æ™®é€šä¸è¿‡çš„ <code>UPDATE</code> è¯­å¥â€”â€”ä»…ä»…å› ä¸ºå®ƒçš„ <code>WHERE</code> æ¡ä»¶é‡Œå¿˜äº†å¸¦ç´¢å¼•ï¼Œæˆ–è€…ç´¢å¼•æ²¡ç”Ÿæ•ˆã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¼šç”¨å¤§ç™½è¯ç»™ä½ è®²æ¸…æ¥šï¼š</p>
<ul>
<li>ä¸ºå•¥ä¸€æ¡æ²¡ç”¨å¯¹ç´¢å¼•çš„ <code>UPDATE</code> è¯­å¥èƒ½æŠŠæ•´ä¸ªç³»ç»Ÿæå®ï¼Ÿ</li>
<li>ä½œä¸ºâ€œæ‰“å·¥äººâ€ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•é¿å…è¿™ç§â€œé£æ¥æ¨ªç¥¸â€ï¼Ÿ</li>
</ul>
<p>æ¥ä¸‹æ¥çš„å†…å®¹ï¼Œå’±ä»¬éƒ½ä»¥ MySQL æœ€å¸¸ç”¨çš„ InnoDB å­˜å‚¨å¼•æ“å’Œå®ƒé»˜è®¤çš„â€œå¯é‡å¤è¯»â€ï¼ˆRepeatable Readï¼‰éš”ç¦»çº§åˆ«ä¸ºèƒŒæ™¯ã€‚ä¸€èµ·æ¥æ­å¼€è¿™ä¸ªæ•°æ®åº“â€œå®šæ—¶ç‚¸å¼¹â€çš„ç¥ç§˜é¢çº±å§ï¼</p>
<h2 id="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§â€œæƒ¨æ¡ˆâ€ï¼Ÿ">ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§â€œæƒ¨æ¡ˆâ€ï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼ŒInnoDB ä¸ºäº†è§£å†³åœ¨â€œå¯é‡å¤è¯»â€è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹å¯èƒ½å‡ºç°çš„â€œå¹»è¯»â€é—®é¢˜ï¼ˆå°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œä¸¤æ¬¡ç›¸åŒçš„æŸ¥è¯¢çœ‹åˆ°äº†ä¸ä¸€æ ·çš„ç»“æœï¼‰ï¼Œå¼•å…¥äº†ä¸€ç§å«åš <code>next-key</code> é”çš„æœºåˆ¶ã€‚è¿™ä¸ªé”å¾ˆéœ¸é“ï¼Œå®ƒä¸ä»…ä¼šé”ä½ä½ è¦æ“ä½œçš„é‚£è¡Œæ•°æ®ï¼ˆè¿™å«è®°å½•é”ï¼‰ï¼Œè¿˜ä¼šæŠŠè¿™è¡Œæ•°æ®å‰åçš„â€œç©ºéš™â€ä¹Ÿç»™é”ä¸Šï¼ˆè¿™å«é—´éš™é”ï¼‰ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™äº›ç©ºéš™é‡Œæå°åŠ¨ä½œï¼ˆæ¯”å¦‚æ’å…¥æ–°æ•°æ®ï¼‰ã€‚</p>
<p>å½“æˆ‘ä»¬æ‰§è¡Œ <code>UPDATE</code> è¯­å¥æ—¶ï¼ŒInnoDB ä¼šç»™ç¬¦åˆæ¡ä»¶çš„è®°å½•åŠ ä¸Šç‹¬å é”ï¼ˆX é”ï¼‰ã€‚è¿™ä¸ªé”ä¸€æ—¦åŠ ä¸Šï¼Œå…¶ä»–æƒ³ä¿®æ”¹è¿™äº›è®°å½•çš„äº‹åŠ¡å°±å¾—ä¹–ä¹–æ’é˜Ÿç­‰ç€ã€‚è€Œä¸”ï¼Œè¿™ä¸ªé”ä¸æ˜¯ <code>UPDATE</code> è¯­å¥æ‰§è¡Œå®Œå°±ç«‹é©¬é‡Šæ”¾çš„ï¼Œå®ƒä¼šä¸€ç›´ç­‰åˆ°æ•´ä¸ªäº‹åŠ¡ç»“æŸï¼ˆæ¯”å¦‚ <code>COMMIT</code> æˆ– <code>ROLLBACK</code>ï¼‰æ‰ä¼šè¢«æ”¾å¼€ã€‚</p>
<p>å…³é”®ç‚¹æ¥äº†ï¼š<strong>InnoDB åŠ é”çš„åŸºæœ¬å•ä½æ˜¯ <code>next-key</code> é”ï¼Œè€Œä¸”è¿™ä¸ªé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œè€Œä¸æ˜¯ç›´æ¥åŠ åœ¨æ•°æ®è¡Œä¸Šçš„ã€‚</strong></p>
<ul>
<li>
<p><strong>å¦‚æœä½ çš„ <code>UPDATE</code> è¯­å¥ <code>WHERE</code> æ¡ä»¶ç”¨çš„æ˜¯å”¯ä¸€ç´¢å¼•ï¼ˆæ¯”å¦‚ä¸»é”®ï¼‰ï¼Œå¹¶ä¸”æ˜¯ç­‰å€¼æŸ¥è¯¢</strong>ï¼šé‚£å¤ªæ£’äº†ï¼<code>next-key</code> é”ä¼šâ€œé™çº§â€æˆè®°å½•é”ï¼Œåªé”ä½ç²¾å‡†åŒ¹é…çš„é‚£ä¸€è¡Œæ•°æ®ã€‚å…¶ä»–äº‹åŠ¡è¯¥å¹²å˜›å¹²å˜›ï¼Œäº’ä¸å½±å“ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¼  <code>users</code> è¡¨ï¼Œ<code>id</code> æ˜¯ä¸»é”®ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/update%E6%B2%A1%E5%8A%A0%E7%B4%A2%E5%BC%95%E4%BC%9A%E9%94%81%E5%85%A8%E8%A1%A8/1747386813184.png" alt="1747386813184"></p>
<p>ç°åœ¨æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/update%E6%B2%A1%E5%8A%A0%E7%B4%A2%E5%BC%95%E4%BC%9A%E9%94%81%E5%85%A8%E8%A1%A8/1747386818980.png" alt="1747386818980"></p>
<p>äº‹åŠ¡ A çš„ <code>UPDATE</code> è¯­å¥å› ä¸ºç”¨äº†ä¸»é”® <code>id</code> è¿›è¡Œç­‰å€¼æŸ¥è¯¢ï¼Œæ‰€ä»¥åªé”ä½äº† <code>id = 1</code> è¿™ä¸€è¡Œã€‚äº‹åŠ¡ B æƒ³æ›´æ–° <code>id = 2</code> çš„æ•°æ®ï¼Œå®Œå…¨æ²¡é—®é¢˜ï¼Œä¸ä¼šè¢«é˜»å¡ã€‚</p>
</li>
<li>
<p><strong>ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ <code>UPDATE</code> è¯­å¥ <code>WHERE</code> æ¡ä»¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæˆ–è€…ç´¢å¼•å¤±æ•ˆäº†</strong>ï¼šç¾éš¾å°±è¦é™ä¸´äº†ï¼InnoDB æ‰¾ä¸åˆ°åˆé€‚çš„ç´¢å¼•ï¼Œå°±åªèƒ½è¿›è¡Œå…¨è¡¨æ‰«æã€‚åœ¨å…¨è¡¨æ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šå¯¹è¡¨é‡Œçš„æ¯ä¸€æ¡è®°å½•ï¼ˆä»¥åŠå®ƒä»¬ä¹‹é—´çš„é—´éš™ï¼‰éƒ½åŠ ä¸Š <code>next-key</code> é”ã€‚è¿™å°±ç›¸å½“äºæŠŠæ•´å¼ è¡¨éƒ½ç»™é”æ­»äº†ï¼</p>
<p>å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/update%E6%B2%A1%E5%8A%A0%E7%B4%A2%E5%BC%95%E4%BC%9A%E9%94%81%E5%85%A8%E8%A1%A8/1747386826920.png" alt="1747386826920"></p>
<p>è¿™æ¬¡äº‹åŠ¡ B çš„ <code>UPDATE</code> è¯­å¥å°±è¢«å¡ä½äº†ï¼ŒåŠ¨å¼¹ä¸å¾—ã€‚</p>
<p>ä¸ºå•¥å‘¢ï¼Ÿå› ä¸ºäº‹åŠ¡ A çš„ <code>UPDATE</code> è¯­å¥ <code>WHERE</code> æ¡ä»¶ <code>name = 'xiaolin'</code> ä¸­çš„ <code>name</code> å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼ˆæˆ–è€…ç´¢å¼•æ²¡è¢«ä¼˜åŒ–å™¨é€‰ä¸­ï¼‰ï¼Œå¯¼è‡´äº†å…¨è¡¨æ‰«æã€‚åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼ŒInnoDB ç»™è¡¨é‡Œçš„æ‰€æœ‰è®°å½•ï¼ˆæ¯”å¦‚ 4 æ¡è®°å½•ï¼‰å’Œå®ƒä»¬ä¹‹é—´çš„æ‰€æœ‰é—´éš™ï¼ˆæ¯”å¦‚ 5 ä¸ªé—´éš™ï¼‰éƒ½åŠ ä¸Šäº† <code>next-key</code> é”ã€‚ç»“æœå°±æ˜¯ï¼Œæ•´å¼ è¡¨éƒ½è¢«é”å®šäº†ï¼Œå…¶ä»–äº‹åŠ¡æƒ³å¯¹è¿™å¼ è¡¨åšä»»ä½•å†™æ“ä½œï¼ˆ<code>INSERT</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>ï¼‰éƒ½ä¼šè¢«é˜»å¡ã€‚</p>
<p><img src="/2025/05/16/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/update%E6%B2%A1%E5%8A%A0%E7%B4%A2%E5%BC%95%E4%BC%9A%E9%94%81%E5%85%A8%E8%A1%A8/1747386839204.png" alt="1747386839204"></p>
<p>å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœè¿™å¼ è¡¨çš„æ•°æ®é‡å·¨å¤§ï¼ˆæ¯”å¦‚å‡ ç™¾ä¸‡ã€å‡ åƒä¸‡è¡Œï¼‰ï¼Œè¿™ä¸ªå…¨è¡¨é”ä¸€æ—¦åŠ ä¸Šï¼Œå¯èƒ½ä¼šæŒç»­å¾ˆé•¿æ—¶é—´ï¼Œç›´åˆ°äº‹åŠ¡ A ç»“æŸã€‚åœ¨è¿™æœŸé—´ï¼Œé™¤äº†åªè¯»çš„ <code>SELECT ... FROM ...</code> æŸ¥è¯¢ï¼Œå…¶ä»–æ‰€æœ‰å¯¹è¿™å¼ è¡¨çš„æ“ä½œéƒ½ä¼šè¢«é˜»å¡ã€‚ä¸šåŠ¡è‡ªç„¶ä¹Ÿå°±è·Ÿç€åœæ‘†ï¼Œç„¶åä½ å°±è¦å‡†å¤‡å¥½æ¥å—è€æ¿çš„â€œçµé­‚æ‹·é—®â€äº†ã€‚</p>
</li>
</ul>
<p>é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯åªè¦ <code>UPDATE</code> è¯­å¥çš„ <code>WHERE</code> æ¡ä»¶å¸¦ä¸Šç´¢å¼•ï¼Œå°±ä¸€å®šèƒ½é¿å…å…¨è¡¨é”å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸ä¸€å®šï¼</strong></p>
<p><strong>æœ€å…³é”®çš„è¿˜æ˜¯è¦çœ‹ MySQL çš„ä¼˜åŒ–å™¨æœ€ç»ˆé€‰æ‹©äº†ä»€ä¹ˆæ‰§è¡Œè®¡åˆ’ã€‚å¦‚æœä¼˜åŒ–å™¨è§‰å¾—èµ°ç´¢å¼•çš„æˆæœ¬æ¯”å…¨è¡¨æ‰«æè¿˜é«˜ï¼ˆæ¯”å¦‚è¡¨æ•°æ®é‡å¾ˆå°ï¼Œæˆ–è€…ç´¢å¼•é€‰æ‹©æ€§ä¸é«˜ï¼‰ï¼Œå®ƒè¿˜æ˜¯å¯èƒ½ä¼šé€‰æ‹©å…¨è¡¨æ‰«æã€‚ä¸€æ—¦èµ°äº†å…¨è¡¨æ‰«æï¼Œé‚£å…¨è¡¨è®°å½•åŠ é”çš„å‘½è¿å°±éš¾ä»¥é¿å…äº†ã€‚</strong></p>
<div class="note info flat"><p>å¾ˆå¤šç½‘ä¸Šçš„æ–‡ç« ä¼šè¯´ <code>UPDATE</code> æ²¡åŠ ç´¢å¼•ä¼šå¯¼è‡´â€œè¡¨é”â€ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸ªè¯´æ³•ä¸å®Œå…¨å‡†ç¡®ã€‚</p>
<p>InnoDB çš„æºç é‡Œï¼ŒåŠ é”çš„åŸºæœ¬å•ä½æ˜¯ç´¢å¼•é¡¹ï¼ˆ<code>index entry</code>ï¼‰ã€‚å½“ <code>UPDATE</code> å› ä¸ºæ²¡æœ‰æœ‰æ•ˆç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«ææ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯æŠŠè¡¨é‡Œæ‰€æœ‰è®°å½•å¯¹åº”çš„ç´¢å¼•é¡¹éƒ½åŠ ä¸Šäº†é”ã€‚ä»æ•ˆæœä¸Šçœ‹ï¼Œè¿™ç¡®å®å’Œé”ä½äº†æ•´å¼ è¡¨å·®ä¸å¤šï¼Œæ‰€ä»¥å¤§å®¶ä¹ æƒ¯æ€§åœ°ç§°ä¹‹ä¸ºâ€œè¡¨é”â€ã€‚ä½†ç†è§£å…¶æœ¬è´¨æ˜¯è¡Œé”ï¼ˆå‡†ç¡®åœ°è¯´æ˜¯ <code>next-key</code> é”ï¼‰çš„ç´¯åŠ ï¼Œæœ‰åŠ©äºæˆ‘ä»¬æ›´æ·±å…¥åœ°åˆ†æé—®é¢˜ã€‚</p>
</div>
<h2 id="å¦‚ä½•é¿å…è¿™ç§â€œé£æ¥æ¨ªç¥¸â€ï¼Ÿ">å¦‚ä½•é¿å…è¿™ç§â€œé£æ¥æ¨ªç¥¸â€ï¼Ÿ</h2>
<p>çŸ¥é“äº†åŸå› ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹ç—‡ä¸‹è¯äº†ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é¿å… <code>UPDATE</code> æ²¡åŠ ç´¢å¼•å¯¼è‡´å…¨è¡¨é”çš„å®ç”¨æ–¹æ³•ï¼š</p>
<ol>
<li>
<p><strong>å¼€å¯å®‰å…¨æ›´æ–°æ¨¡å¼ (<code>sql_safe_updates</code>)</strong></p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ MySQL çš„ <code>sql_safe_updates</code> å‚æ•°è®¾ç½®ä¸º <code>1</code>ã€‚è¿™æ ·ä¸€æ¥ï¼ŒMySQL å°±ä¼šå˜å¾—â€œæ•æ„Ÿâ€èµ·æ¥ã€‚</p>
<blockquote>
<p>å®˜æ–¹è§£é‡Šæ˜¯è¿™ä¹ˆè¯´çš„ï¼š<br>
If set to 1, MySQL aborts UPDATE or DELETE statements that do not use a key in the WHERE clause or a LIMIT clause. (Specifically, UPDATE statements must have a WHERE clause that uses a key or a LIMIT clause, or both. DELETE statements must have both.) This makes it possible to catch UPDATE or DELETE statements where keys are not used properly and that would probably change or delete a large number of rows. The default value is 0.</p>
</blockquote>
<p>ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼Œå½“ <code>sql_safe_updates</code> è®¾ç½®ä¸º <code>1</code> æ—¶ï¼š</p>
<ul>
<li><code>UPDATE</code> è¯­å¥å¿…é¡»æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶æ‰èƒ½æˆåŠŸæ‰§è¡Œï¼š
<ul>
<li><code>WHERE</code> æ¡ä»¶ä¸­å¿…é¡»åŒ…å«ç´¢å¼•åˆ—ã€‚</li>
<li>ä½¿ç”¨äº† <code>LIMIT</code> å­å¥ã€‚</li>
<li>åŒæ—¶ä½¿ç”¨äº† <code>WHERE</code> å’Œ <code>LIMIT</code>ï¼ˆæ­¤æ—¶ <code>WHERE</code> æ¡ä»¶ä¸­å¯ä»¥æ²¡æœ‰ç´¢å¼•åˆ—ï¼Œä½†ä¸æ¨èï¼‰ã€‚</li>
</ul>
</li>
<li><code>DELETE</code> è¯­å¥åˆ™æ›´ä¸¥æ ¼ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³ï¼š
<ul>
<li><code>WHERE</code> æ¡ä»¶ä¸­åŒ…å«ç´¢å¼•åˆ—ã€‚</li>
<li>å¹¶ä¸”ä½¿ç”¨äº† <code>LIMIT</code> å­å¥ã€‚</li>
</ul>
</li>
</ul>
<p>å¼€å¯è¿™ä¸ªå‚æ•°ï¼Œå°±åƒç»™ä½ çš„æ•°æ®åº“ä¸Šäº†ä¸€é“ä¿é™©ï¼Œèƒ½æœ‰æ•ˆé˜»æ­¢é‚£äº›å¯èƒ½å› ä¸ºå¿˜åŠ ç´¢å¼•æˆ–ç´¢å¼•ä½¿ç”¨ä¸å½“è€Œå¯¼è‡´å¤§èŒƒå›´æ•°æ®ä¿®æ”¹æˆ–åˆ é™¤çš„å±é™©æ“ä½œã€‚</p>
</li>
<li>
<p><strong>å¼ºåˆ¶ä½¿ç”¨ç´¢å¼• (<code>FORCE INDEX</code>)</strong></p>
<p>å³ä½¿ä½ çš„ <code>WHERE</code> æ¡ä»¶é‡ŒåŒ…å«äº†ç´¢å¼•åˆ—ï¼Œä½†å¦‚æœ MySQL ä¼˜åŒ–å™¨â€œè‡ªä½œèªæ˜â€åœ°é€‰æ‹©äº†å…¨è¡¨æ‰«æï¼Œä½ è¿˜æ˜¯æœ‰åŠæ³•â€œçº æ­£â€å®ƒçš„ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <code>FORCE INDEX([index_name])</code> è¯­æ³•æ¥æ˜ç¡®å‘Šè¯‰ä¼˜åŒ–å™¨ï¼šâ€œå˜¿ï¼Œè€å…„ï¼Œå¬æˆ‘çš„ï¼Œå°±ç”¨è¿™ä¸ªåå« <code>[index_name]</code> çš„ç´¢å¼•ï¼â€ è¿™æ ·å°±èƒ½å¼ºåˆ¶æŸ¥è¯¢èµ°æŒ‡å®šçš„ç´¢å¼•ï¼Œä»è€Œé¿å…å› ä¼˜åŒ–å™¨é€‰æ‹©å¤±è¯¯å¯¼è‡´çš„å…¨è¡¨æ‰«æå’Œæ½œåœ¨çš„å…¨è¡¨é”é£é™©ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>UPDATE my_table FORCE INDEX(idx_name) SET column1 = 'new_value' WHERE name = 'some_value';</code></p>
</li>
<li>
<p><strong>ä¸Šçº¿å‰å……åˆ†æµ‹è¯•å’Œ <code>EXPLAIN</code></strong></p>
<p>å¯¹äºæ‰€æœ‰é‡è¦çš„ <code>UPDATE</code> å’Œ <code>DELETE</code> è¯­å¥ï¼Œåœ¨ä¸Šçº¿å‰åŠ¡å¿…åœ¨æµ‹è¯•ç¯å¢ƒè¿›è¡Œå……åˆ†æµ‹è¯•ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¦ä½¿ç”¨ <code>EXPLAIN</code> å‘½ä»¤åˆ†æè¿™äº›è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œç¡®ä¿å®ƒä»¬ç¡®å®èµ°äº†é¢„æœŸçš„ç´¢å¼•ï¼Œå¹¶ä¸”æ‰«æçš„è¡Œæ•°åœ¨åˆç†èŒƒå›´å†…ã€‚</p>
<p>å¦‚æœ <code>EXPLAIN</code> ç»“æœæ˜¾ç¤º <code>type</code> æ˜¯ <code>ALL</code>ï¼ˆå…¨è¡¨æ‰«æï¼‰ï¼Œæˆ–è€… <code>rows</code> æ•°é‡å¼‚å¸¸å¤§ï¼Œé‚£å°±è¦é«˜åº¦è­¦æƒ•äº†ï¼Œèµ¶ç´§æ£€æŸ¥ç´¢å¼•å’ŒæŸ¥è¯¢æ¡ä»¶ã€‚</p>
</li>
</ol>
<h2 id="æ€»ç»“ï¼šå°å¿ƒé©¶å¾—ä¸‡å¹´èˆ¹">æ€»ç»“ï¼šå°å¿ƒé©¶å¾—ä¸‡å¹´èˆ¹</h2>
<p>åˆ«å°çœ‹ä¸€æ¡å°å°çš„ <code>UPDATE</code> è¯­å¥ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®ƒçœŸæœ‰å¯èƒ½å˜æˆå‹å®éª†é©¼çš„æœ€åä¸€æ ¹ç¨»è‰ï¼Œå¯¼è‡´ä¸šåŠ¡åœæ»ç”šè‡³ç³»ç»Ÿå´©æºƒã€‚</p>
<p>ä¸ºäº†é¿å…æˆä¸ºé‚£ä¸ªâ€œèƒŒé”…ä¾ â€ï¼Œè¯·ç‰¢è®°ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>æ‰§è¡Œ <code>UPDATE</code> æˆ– <code>DELETE</code> è¯­å¥æ—¶ï¼Œ<strong>åŠ¡å¿…ç¡®ä¿ <code>WHERE</code> æ¡ä»¶ä¸­ä½¿ç”¨äº†åˆé€‚çš„ç´¢å¼•åˆ—</strong>ã€‚</li>
<li>åœ¨æµ‹è¯•ç¯å¢ƒï¼Œ<strong>ä½¿ç”¨ <code>EXPLAIN</code> ä»”ç»†æ£€æŸ¥è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</strong>ï¼Œç¡®è®¤å®ƒçœŸçš„èµ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æã€‚</li>
<li>è€ƒè™‘<strong>å¼€å¯ MySQL çš„ <code>sql_safe_updates</code> å‚æ•°</strong>ï¼Œä½œä¸ºä¸€é“é¢å¤–çš„å®‰å…¨é˜²çº¿ã€‚</li>
<li>å¦‚æœå‘ç°å³ä½¿ <code>WHERE</code> æ¡ä»¶å¸¦äº†ç´¢å¼•ï¼Œä¼˜åŒ–å™¨ä¾ç„¶â€œå›ºæ‰§â€åœ°é€‰æ‹©å…¨è¡¨æ‰«æï¼Œåˆ«çŠ¹è±«ï¼Œæœæ–­ä½¿ç”¨ <code>FORCE INDEX([index_name])</code> æ¥â€œæŒ‡å¼•â€å®ƒèµ°ä¸Šæ­£é€”ã€‚</li>
</ul>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ é¿å¼€è¿™ä¸ªå¸¸è§çš„â€œå‘â€ã€‚ä¸‹æ¬¡æ“ä½œæ•°æ®åº“æ—¶ï¼Œä¸€å®šè¦å¤šåŠ å°å¿ƒï¼Œåˆ«å†å› ä¸ºä¸€æ¡ <code>UPDATE</code> è¯­å¥è€Œè¢«è€æ¿è¯·å»â€œå–èŒ¶â€å•¦ï¼</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>é”</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>MySQL</tag>
        <tag>ç´¢å¼•</tag>
        <tag>é”</tag>
        <tag>äº‹æ•…åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 322 - é›¶é’±å…‘æ¢</title>
    <url>/2025/05/16/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-322-%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>coins</code> ï¼Œè¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼›ä»¥åŠä¸€ä¸ªæ•´æ•° <code>amount</code> ï¼Œè¡¨ç¤ºæ€»é‡‘é¢ã€‚</p>
<p>è®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„ <strong>æœ€å°‘çš„ç¡¬å¸ä¸ªæ•°</strong> ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› <code>-1</code> ã€‚</p>
<p>ä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šcoins = [1, 2, 5], amount = 11</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼š11 = 5 + 5 + 1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šcoins = [2], amount = 3</span><br><span class="line">è¾“å‡ºï¼š-1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šcoins = [1], amount = 0</span><br><span class="line">è¾“å‡ºï¼š0</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>1 &lt;= coins.length &lt;= 12</li>
<li>1 &lt;= coins[i] &lt;= 2^31 - 1</li>
<li>0 &lt;= amount &lt;= 10^4</li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘çš„åˆå§‹è§£æ³•æ˜¯å°è¯•ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œä½†å®ç°æ–¹å¼æœ‰è¯¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">coinChange</span><span class="params">(coins []<span class="type">int</span>, amount <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	dp := <span class="built_in">make</span>([]<span class="type">int</span>, amount+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= amount; i++ &#123;</span><br><span class="line">		dp[i] = math.MaxInt32</span><br><span class="line">	&#125;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, coin := <span class="keyword">range</span> coins &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt;= amount; j++ &#123;</span><br><span class="line">			<span class="keyword">for</span> k := <span class="number">0</span>; k*coin &lt;= j; k++ &#123;</span><br><span class="line">				dp[j] = min(dp[j], dp[j-k*coin]+<span class="number">1</span>) <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šè¿™é‡Œåº”è¯¥æ˜¯ +k</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> dp[amount] == math.MaxInt32 &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dp[amount]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>è¿™ä¸ªè§£æ³•å­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹é”™è¯¯</strong>ï¼šåœ¨ä½¿ç”¨ k ä¸ªå½“å‰é¢å€¼çš„ç¡¬å¸æ—¶ï¼Œåº”è¯¥æ˜¯ <code>dp[j-k*coin]+k</code>ï¼Œè€Œä¸æ˜¯ <code>dp[j-k*coin]+1</code>ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† k ä¸ªç¡¬å¸ï¼Œæ‰€ä»¥åº”è¯¥åŠ ä¸Š kã€‚</p>
</li>
<li>
<p><strong>ä¸å¿…è¦çš„ä¸‰é‡å¾ªç¯</strong>ï¼šå³ä½¿ä¿®æ­£äº†çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œè¿™ç§å®ç°æ–¹å¼ä¹Ÿæœ‰ä¸¥é‡çš„æ•ˆç‡é—®é¢˜ã€‚ä¸‰é‡å¾ªç¯å¯¼è‡´æ—¶é—´å¤æ‚åº¦é«˜è¾¾ O(amount^2 * n)ï¼Œå…¶ä¸­ n æ˜¯ç¡¬å¸æ•°é‡ã€‚æœ€å†…å±‚å¾ªç¯ï¼ˆæšä¸¾ä½¿ç”¨ç¡¬å¸çš„ä¸ªæ•°ï¼‰æ˜¯ä¸å¿…è¦çš„ã€‚</p>
</li>
<li>
<p><strong>ç†è§£å®Œå…¨èƒŒåŒ…é—®é¢˜çš„æœ¬è´¨</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„å®Œå…¨èƒŒåŒ…é—®é¢˜ï¼Œæ¯ç§ç‰©å“ï¼ˆç¡¬å¸ï¼‰å¯ä»¥é‡å¤é€‰æ‹©ï¼Œç›®æ ‡æ˜¯ä½¿ç”¨æœ€å°‘çš„ç‰©å“è¾¾åˆ°ç‰¹å®šå®¹é‡ï¼ˆé‡‘é¢ï¼‰ã€‚å¯¹äºå®Œå…¨èƒŒåŒ…é—®é¢˜ï¼Œæœ‰æ›´é«˜æ•ˆçš„è§£æ³•ã€‚</p>
</li>
</ol>
<h2 id="æ­£ç¡®è§£æ³•ä¸€ï¼šæ ‡å‡†åŠ¨æ€è§„åˆ’ï¼ˆè‡ªåº•å‘ä¸Šï¼‰">æ­£ç¡®è§£æ³•ä¸€ï¼šæ ‡å‡†åŠ¨æ€è§„åˆ’ï¼ˆè‡ªåº•å‘ä¸Šï¼‰</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">coinChange</span><span class="params">(coins []<span class="type">int</span>, amount <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	dp := <span class="built_in">make</span>([]<span class="type">int</span>, amount+<span class="number">1</span>) <span class="comment">// dp[i] è¡¨ç¤ºå‡‘æˆé‡‘é¢iæ‰€éœ€çš„æœ€å°‘ç¡¬å¸æ•°</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–dpæ•°ç»„</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= amount; i++ &#123;</span><br><span class="line">		dp[i] = math.MaxInt32 <span class="comment">// åˆå§‹åŒ–ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°</span></span><br><span class="line">	&#125;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span> <span class="comment">// å‡‘æˆé‡‘é¢0éœ€è¦0ä¸ªç¡¬å¸</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¯¹äºæ¯ç§ç¡¬å¸</span></span><br><span class="line">	<span class="keyword">for</span> _, coin := <span class="keyword">range</span> coins &#123;</span><br><span class="line">		<span class="comment">// ä»coiné¢å€¼å¼€å§‹éå†ï¼Œç¡®ä¿å¯ä»¥ä½¿ç”¨å½“å‰ç¡¬å¸</span></span><br><span class="line">		<span class="keyword">for</span> j := coin; j &lt;= amount; j++ &#123;</span><br><span class="line">			<span class="comment">// çŠ¶æ€è½¬ç§»ï¼šä¸ä½¿ç”¨å½“å‰ç¡¬å¸ vs ä½¿ç”¨å½“å‰ç¡¬å¸</span></span><br><span class="line">			dp[j] = min(dp[j], dp[j-coin]+<span class="number">1</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœdp[amount]ä»ç„¶æ˜¯åˆå§‹å€¼ï¼Œè¯´æ˜æ— æ³•å‡‘æˆamount</span></span><br><span class="line">	<span class="keyword">if</span> dp[amount] == math.MaxInt32 &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dp[amount]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> a &lt; b &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è§£æ³•ä¸€åˆ†æ">è§£æ³•ä¸€åˆ†æ</h3>
<p>è¿™æ˜¯å®Œå…¨èƒŒåŒ…é—®é¢˜çš„æ ‡å‡†è§£æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(amount * n)ï¼Œå…¶ä¸­ n æ˜¯ç¡¬å¸æ•°é‡ã€‚</p>
<p><strong>çŠ¶æ€å®šä¹‰</strong>ï¼š</p>
<ul>
<li><code>dp[i]</code> è¡¨ç¤ºå‡‘æˆé‡‘é¢ i æ‰€éœ€çš„æœ€å°‘ç¡¬å¸æ•°</li>
</ul>
<p><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</strong>ï¼š</p>
<ul>
<li><code>dp[i] = min(dp[i], dp[i-coin]+1)</code>ï¼Œå…¶ä¸­ i â‰¥ coin</li>
</ul>
<p><strong>è§£é¢˜æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆå§‹åŒ– dp æ•°ç»„ï¼Œé™¤äº† dp[0] = 0 å¤–ï¼Œå…¶ä»–ä½ç½®è®¾ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼ˆè¡¨ç¤ºæš‚æ—¶æ— æ³•è¾¾åˆ°ï¼‰</li>
<li>å¯¹æ¯ç§ç¡¬å¸ï¼Œéå†ä»è¯¥é¢å€¼åˆ° amount çš„æ‰€æœ‰é‡‘é¢</li>
<li>å¯¹äºé‡‘é¢ jï¼Œè€ƒè™‘ä½¿ç”¨å½“å‰ç¡¬å¸åçš„æœ€å°‘ç¡¬å¸æ•°ï¼šå½“å‰çŠ¶æ€ dp[j] ä¸ dp[j-coin]+1 å–è¾ƒå°å€¼</li>
<li>æœ€åï¼Œå¦‚æœ dp[amount] ä»ä¸ºåˆå§‹å¤§å€¼ï¼Œè¿”å› -1ï¼›å¦åˆ™è¿”å› dp[amount]</li>
</ol>
<h2 id="æ­£ç¡®è§£æ³•äºŒï¼šè®°å¿†åŒ–æœç´¢ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰">æ­£ç¡®è§£æ³•äºŒï¼šè®°å¿†åŒ–æœç´¢ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">coinChange</span><span class="params">(coins []<span class="type">int</span>, amount <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// åˆ›å»ºè®°å¿†åŒ–æ•°ç»„ï¼Œåˆå§‹å€¼ä¸º -1ï¼Œè¡¨ç¤ºçŠ¶æ€å°šæœªè®¡ç®—</span></span><br><span class="line">	memo := <span class="built_in">make</span>([]<span class="type">int</span>, amount+<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> memo &#123;</span><br><span class="line">		memo[i] = <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line">	memo[<span class="number">0</span>] = <span class="number">0</span> <span class="comment">// é‡‘é¢ä¸º0æ—¶éœ€è¦0ä¸ªç¡¬å¸</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// è‡ªé¡¶å‘ä¸‹çš„é€’å½’å‡½æ•°</span></span><br><span class="line">	<span class="keyword">var</span> dp <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">int</span></span><br><span class="line">	dp = <span class="function"><span class="keyword">func</span><span class="params">(remaining <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">		<span class="comment">// å‰©ä½™é‡‘é¢ä¸ºè´Ÿï¼Œæ— æ³•å‡‘æˆ</span></span><br><span class="line">		<span class="keyword">if</span> remaining &lt; <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å·²ç»è®¡ç®—è¿‡çš„çŠ¶æ€ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">		<span class="keyword">if</span> memo[remaining] != <span class="number">-1</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> memo[remaining]</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		minCoins := math.MaxInt32</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å°è¯•ä½¿ç”¨æ¯ç§ç¡¬å¸</span></span><br><span class="line">		<span class="keyword">for</span> _, coin := <span class="keyword">range</span> coins &#123;</span><br><span class="line">			<span class="comment">// é€’å½’è®¡ç®—ä½¿ç”¨å½“å‰ç¡¬å¸åæ‰€éœ€çš„æœ€å°‘ç¡¬å¸æ•°</span></span><br><span class="line">			subProblem := dp(remaining - coin)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// å¦‚æœå­é—®é¢˜æœ‰è§£ï¼Œå¹¶ä¸”æ¯”å½“å‰æœ€å°å€¼æ›´å°ï¼Œæ›´æ–°æœ€å°å€¼</span></span><br><span class="line">			<span class="keyword">if</span> subProblem &gt;= <span class="number">0</span> &amp;&amp; subProblem &lt; minCoins &#123;</span><br><span class="line">				minCoins = subProblem + <span class="number">1</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆè§£ï¼Œè®¾ç½®ä¸º-1</span></span><br><span class="line">		<span class="keyword">if</span> minCoins == math.MaxInt32 &#123;</span><br><span class="line">			memo[remaining] = <span class="number">-1</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			memo[remaining] = minCoins</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> memo[remaining]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dp(amount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è§£æ³•äºŒåˆ†æ">è§£æ³•äºŒåˆ†æ</h3>
<p>è¿™ç§æ–¹æ³•ä½¿ç”¨è®°å¿†åŒ–æœç´¢ï¼ˆè‡ªé¡¶å‘ä¸‹çš„åŠ¨æ€è§„åˆ’ï¼‰æ¥è§£å†³é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦åŒæ ·ä¸º O(amount * n)ã€‚</p>
<p><strong>é€’å½’å‡½æ•°å®šä¹‰</strong>ï¼š</p>
<ul>
<li><code>dp(remaining)</code> è¿”å›å‡‘æˆé‡‘é¢ remaining æ‰€éœ€çš„æœ€å°‘ç¡¬å¸æ•°</li>
</ul>
<p><strong>é€’å½’è½¬ç§»å…³ç³»</strong>ï¼š</p>
<ul>
<li><code>dp(remaining) = min(dp(remaining - coin) + 1) for coin in coins</code>ï¼Œå‰ææ˜¯ remaining â‰¥ coin</li>
</ul>
<p><strong>è§£é¢˜æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºè®°å¿†åŒ–æ•°ç»„ï¼Œåˆå§‹å€¼ä¸º -1ï¼Œè¡¨ç¤ºçŠ¶æ€å°šæœªè®¡ç®—</li>
<li>å®šä¹‰é€’å½’å‡½æ•°ï¼Œå¯¹äºæ¯ä¸ªé‡‘é¢ï¼Œå°è¯•ä½¿ç”¨æ¯ç§ç¡¬å¸</li>
<li>å¯¹äºæ¯ç§ç¡¬å¸ï¼Œè®¡ç®—ä½¿ç”¨åå‰©ä½™é‡‘é¢æ‰€éœ€çš„æœ€å°‘ç¡¬å¸æ•°</li>
<li>å–æ‰€æœ‰å¯èƒ½ä¸­çš„æœ€å°å€¼</li>
<li>ä½¿ç”¨è®°å¿†åŒ–æ•°ç»„é¿å…é‡å¤è®¡ç®—</li>
</ol>
<h2 id="ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒä¸æ€è€ƒ">ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒä¸æ€è€ƒ</h2>
<h3 id="æ–¹æ³•å¯¹æ¯”è¡¨">æ–¹æ³•å¯¹æ¯”è¡¨</h3>
<table>
<thead>
<tr>
<th>å¯¹æ¯”ç»´åº¦</th>
<th>è§£æ³•ä¸€ï¼šè‡ªåº•å‘ä¸Š DP</th>
<th>è§£æ³•äºŒï¼šè‡ªé¡¶å‘ä¸‹è®°å¿†åŒ–æœç´¢</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®ç°æ–¹å¼</td>
<td>è¿­ä»£</td>
<td>é€’å½’</td>
</tr>
<tr>
<td>æ€è€ƒé¡ºåº</td>
<td>ä»å°é—®é¢˜æ„å»ºå¤§é—®é¢˜</td>
<td>ä»å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜</td>
</tr>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(amount * n)</td>
<td>O(amount * n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(amount)</td>
<td>O(amount) + é€’å½’æ ˆç©ºé—´</td>
</tr>
<tr>
<td>å®é™…æ•ˆç‡</td>
<td>é€šå¸¸æ›´å¿«ï¼ˆæ— é€’å½’å¼€é”€ï¼‰</td>
<td>å¯èƒ½ç¨æ…¢ï¼ˆæœ‰é€’å½’è°ƒç”¨å¼€é”€ï¼‰</td>
</tr>
<tr>
<td>ä»£ç ç®€æ´åº¦</td>
<td>è¾ƒä¸ºç®€æ´</td>
<td>è¾ƒä¸ºç›´è§‚ï¼Œç¬¦åˆæ€è€ƒè¿‡ç¨‹</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>çŠ¶æ€è½¬ç§»æ¸…æ™°çš„é—®é¢˜</td>
<td>é€’å½’æ€è·¯æ›´å®¹æ˜“ç†è§£çš„é—®é¢˜</td>
</tr>
<tr>
<td>æ˜“ç†è§£æ€§</td>
<td>å¯¹åˆå­¦è€…å¯èƒ½è¾ƒéš¾ç†è§£</td>
<td>æ›´ç¬¦åˆç›´è§‰çš„æ€è€ƒæ–¹å¼</td>
</tr>
<tr>
<td>è°ƒè¯•éš¾åº¦</td>
<td>ç›¸å¯¹å®¹æ˜“è¿½è¸ªçŠ¶æ€</td>
<td>é€’å½’è°ƒç”¨æ ˆå¯èƒ½è¾ƒéš¾è¿½è¸ª</td>
</tr>
</tbody>
</table>
<h3 id="è¯¦ç»†æ¯”è¾ƒ">è¯¦ç»†æ¯”è¾ƒ</h3>
<ol>
<li>
<p><strong>è‡ªåº•å‘ä¸Š vs è‡ªé¡¶å‘ä¸‹</strong>ï¼š</p>
<ul>
<li>è‡ªåº•å‘ä¸Šçš„æ–¹æ³•ï¼ˆè§£æ³•ä¸€ï¼‰ä»å°é—®é¢˜å¼€å§‹è§£å†³ï¼Œé€æ­¥æ„å»ºå¤§é—®é¢˜çš„è§£</li>
<li>è‡ªé¡¶å‘ä¸‹çš„æ–¹æ³•ï¼ˆè§£æ³•äºŒï¼‰ä»å¤§é—®é¢˜å¼€å§‹ï¼Œåˆ†è§£æˆå°é—®é¢˜ï¼Œå¹¶ä½¿ç”¨è®°å¿†åŒ–é¿å…é‡å¤è®¡ç®—</li>
<li>ä¸¤ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ç›¸åŒï¼Œä½†å®é™…è¿è¡Œæ•ˆç‡å¯èƒ½å› å…·ä½“é—®é¢˜è€Œå¼‚</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>ä¸¤ç§æ–¹æ³•çš„ç©ºé—´å¤æ‚åº¦å‡ä¸º O(amount)ï¼Œç”¨äºå­˜å‚¨ dp æ•°ç»„æˆ–è®°å¿†åŒ–æ•°ç»„</li>
<li>è‡ªé¡¶å‘ä¸‹æ–¹æ³•æœ‰é¢å¤–çš„é€’å½’è°ƒç”¨æ ˆå¼€é”€ï¼Œæœ€åæƒ…å†µä¸º O(amount)</li>
</ul>
</li>
<li>
<p><strong>é”™è¯¯åŸå› æ·±å…¥æ€è€ƒ</strong>ï¼š</p>
<ul>
<li>æˆ‘çš„é”™è¯¯ä»£ç è¯•å›¾é€šè¿‡ä¸‰é‡å¾ªç¯æ¥æšä¸¾æ‰€æœ‰å¯èƒ½æ€§ï¼Œä½†è¿™ç§æ–¹æ³•æ•ˆç‡ä½ä¸‹ä¸”æ›´å®¹æ˜“å‡ºé”™</li>
<li>æ ‡å‡†çš„å®Œå…¨èƒŒåŒ…é—®é¢˜è§£æ³•é€šè¿‡å·§å¦™çš„åŠ¨æ€è§„åˆ’è½¬ç§»å…³ç³»ï¼Œé¿å…äº†æ˜¾å¼æšä¸¾çš„éœ€è¦</li>
<li>åœ¨åŠ¨æ€è§„åˆ’ä¸­ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„æ­£ç¡®è®¾è®¡æ˜¯å…³é”®ï¼Œéœ€è¦æ·±å…¥ç†è§£é—®é¢˜çš„æœ¬è´¨</li>
</ul>
</li>
</ol>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>é€šè¿‡è¿™ä¸ªé”™é¢˜ï¼Œæˆ‘å­¦åˆ°äº†ï¼š</p>
<ol>
<li>å¯¹äºå®Œå…¨èƒŒåŒ…é—®é¢˜ï¼Œæ ‡å‡†çš„è§£æ³•æ˜¯ä¸¤å±‚å¾ªç¯ï¼Œå¤–å±‚éå†ç‰©å“ï¼Œå†…å±‚æ­£åºéå†é‡‘é¢</li>
<li>åŠ¨æ€è§„åˆ’é—®é¢˜ä¸­ï¼ŒçŠ¶æ€å®šä¹‰å’Œè½¬ç§»æ–¹ç¨‹çš„æ­£ç¡®æ€§è‡³å…³é‡è¦</li>
<li>ä¼˜åŒ–ç®—æ³•æ—¶ï¼Œä¸ä»…è¦è€ƒè™‘æ­£ç¡®æ€§ï¼Œè¿˜è¦è€ƒè™‘æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦</li>
<li>è®°å¿†åŒ–æœç´¢æ˜¯è§£å†³åŠ¨æ€è§„åˆ’é—®é¢˜çš„å¦ä¸€ç§æ€è·¯ï¼Œæœ‰æ—¶æ›´ç›´è§‚</li>
<li>åœ¨è§£å†³é—®é¢˜æ—¶ï¼Œç†è§£é—®é¢˜æœ¬è´¨æ¯”æ­»è®°ç¡¬èƒŒç®—æ³•æ¨¡æ¿æ›´é‡è¦</li>
</ol>
<p>è¿™ä¸ªé¢˜ç›®æ˜¯åŠ¨æ€è§„åˆ’ä¸­çš„ç»å…¸é—®é¢˜ï¼Œç†è§£äº†å®ƒçš„è§£æ³•ï¼Œå¯ä»¥å¸®åŠ©è§£å†³è®¸å¤šç±»ä¼¼çš„å®Œå…¨èƒŒåŒ…é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>èƒŒåŒ…é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 763 - åˆ’åˆ†å­—æ¯åŒºé—´ï¼ˆPartition Labelsï¼‰</title>
    <url>/2025/05/16/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-763-%E5%88%92%E5%88%86%E5%AD%97%E6%AF%8D%E5%8C%BA%E9%97%B4/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œè¦æ±‚å°†è¿™ä¸ªå­—ç¬¦ä¸²åˆ’åˆ†ä¸ºå°½å¯èƒ½å¤šçš„ç‰‡æ®µï¼ŒåŒä¸€å­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­ã€‚è¿”å›ä¸€ä¸ªè¡¨ç¤ºæ¯ä¸ªå­—ç¬¦ä¸²ç‰‡æ®µçš„é•¿åº¦çš„åˆ—è¡¨ã€‚</p>
<h3 id="ç¤ºä¾‹-1">ç¤ºä¾‹ 1:</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;ababcbacadefegdehijhklij&quot;</span><br><span class="line">è¾“å‡ºï¼š[9,7,8]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">åˆ’åˆ†ç»“æœä¸º &quot;ababcbaca&quot;, &quot;defegde&quot;, &quot;hijhklij&quot;ã€‚</span><br><span class="line">æ¯ä¸ªå­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­ã€‚</span><br><span class="line">åƒ &quot;ababcbacadefegde&quot;, &quot;hijhklij&quot; çš„åˆ’åˆ†æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºåˆ’åˆ†çš„ç‰‡æ®µæ•°è¾ƒå°‘ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹ 2:</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;eccbbbbdec&quot;</span><br><span class="line">è¾“å‡ºï¼š[10]</span><br><span class="line">è§£é‡Šï¼šæ•´ä¸ªå­—ç¬¦ä¸²åªèƒ½æ„æˆä¸€ä¸ªç‰‡æ®µã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶:</h3>
<ul>
<li>1 &lt;= s.length &lt;= 500</li>
<li>s ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜ç›®çš„å…³é”®æ˜¯ç†è§£&quot;åŒä¸€å­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­&quot;çš„çº¦æŸæ¡ä»¶ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªç‰‡æ®µåŒ…å«äº†æŸä¸ªå­—æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²ä¸­æ‰€æœ‰ç›¸åŒçš„å­—æ¯éƒ½å¿…é¡»åŒ…å«åœ¨è¿™ä¸ªç‰‡æ®µä¸­ã€‚</p>
<p>åŸºäºè¿™ä¸ªè¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è´ªå¿ƒç®—æ³•ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ¯ä¸ªå­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­æœ€åå‡ºç°çš„ä½ç½®</li>
<li>ç„¶åï¼Œæˆ‘ä»¬ä»å¤´éå†å­—ç¬¦ä¸²ï¼Œå¯¹äºæ¯ä¸ªå­—ç¬¦ï¼Œå…¶æœ€åå‡ºç°çš„ä½ç½®å°±æ˜¯å½“å‰ç‰‡æ®µçš„æ½œåœ¨ç»“æŸä½ç½®</li>
<li>éšç€éå†è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¸æ–­æ›´æ–°å½“å‰ç‰‡æ®µçš„ç»“æŸä½ç½®ï¼ˆå–æœ€è¿œçš„é‚£ä¸ªï¼‰</li>
<li>å½“æˆ‘ä»¬éå†åˆ°å½“å‰ç‰‡æ®µçš„ç»“æŸä½ç½®æ—¶ï¼Œå°±æ‰¾åˆ°äº†ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ç‰‡æ®µ</li>
</ol>
<p>è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šè¦è®©åŒä¸€å­—æ¯éƒ½åœ¨ä¸€ä¸ªç‰‡æ®µä¸­ï¼Œé‚£ä¹ˆç‰‡æ®µçš„ç»“æŸä½ç½®å¿…é¡»è‡³å°‘å»¶ä¼¸åˆ°è¿™ä¸ªå­—æ¯æœ€åå‡ºç°çš„ä½ç½®ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">partitionLabels</span><span class="params">(s <span class="type">string</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// è®°å½•æ¯ä¸ªå­—æ¯æœ€åå‡ºç°çš„ä½ç½®</span></span><br><span class="line">	lastPosition := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">26</span>)</span><br><span class="line">	<span class="keyword">for</span> i, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">		lastPosition[char-<span class="string">&#x27;a&#x27;</span>] = i</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> result []<span class="type">int</span></span><br><span class="line">	start, end := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// éå†å­—ç¬¦ä¸²ï¼Œä¸æ–­æ›´æ–°å½“å‰åŒºé—´çš„ç»“æŸä½ç½®</span></span><br><span class="line">	<span class="keyword">for</span> i, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">		<span class="comment">// æ›´æ–°å½“å‰åŒºé—´çš„ç»“æŸä½ç½®ï¼ˆå–æœ€è¿œçš„ä½ç½®ï¼‰</span></span><br><span class="line">		charLastPos := lastPosition[char-<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">		<span class="keyword">if</span> charLastPos &gt; end &#123;</span><br><span class="line">			end = charLastPos</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœå½“å‰ä½ç½®è¾¾åˆ°äº†åŒºé—´çš„ç»“æŸä½ç½®ï¼Œè¯´æ˜æ‰¾åˆ°äº†ä¸€ä¸ªåˆ†åŒº</span></span><br><span class="line">		<span class="keyword">if</span> i == end &#123;</span><br><span class="line">			<span class="comment">// æ·»åŠ åŒºé—´é•¿åº¦</span></span><br><span class="line">			result = <span class="built_in">append</span>(result, end-start+<span class="number">1</span>)</span><br><span class="line">			<span class="comment">// æ›´æ–°ä¸‹ä¸€ä¸ªåŒºé—´çš„å¼€å§‹ä½ç½®</span></span><br><span class="line">			start = end + <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>ä»£ç å®ç°å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p>
<h3 id="1-é¢„å¤„ç†ï¼šè®°å½•æ¯ä¸ªå­—æ¯æœ€åå‡ºç°çš„ä½ç½®">1. é¢„å¤„ç†ï¼šè®°å½•æ¯ä¸ªå­—æ¯æœ€åå‡ºç°çš„ä½ç½®</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 26 çš„æ•°ç»„ï¼ˆå‡è®¾å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯ï¼‰ï¼Œç”¨äºè®°å½•æ¯ä¸ªå­—æ¯åœ¨å­—ç¬¦ä¸²ä¸­æœ€åå‡ºç°çš„ä½ç½®ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">lastPosition := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">26</span>)</span><br><span class="line"><span class="keyword">for</span> i, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">    lastPosition[char-<span class="string">&#x27;a&#x27;</span>] = i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-è´ªå¿ƒåˆ’åˆ†ï¼šæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç‰‡æ®µ">2. è´ªå¿ƒåˆ’åˆ†ï¼šæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç‰‡æ®µ</h3>
<p>ç„¶åï¼Œæˆ‘ä»¬å†æ¬¡éå†å­—ç¬¦ä¸²ï¼Œç»´æŠ¤å½“å‰ç‰‡æ®µçš„å¼€å§‹ä½ç½® <code>start</code> å’Œç»“æŸä½ç½® <code>end</code>ã€‚</p>
<p>å¯¹äºæ¯ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬æŸ¥çœ‹å®ƒæœ€åå‡ºç°çš„ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªä½ç½®æ¯”å½“å‰çš„ <code>end</code> æ›´è¿œï¼Œå°±éœ€è¦æ›´æ–° <code>end</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">charLastPos := lastPosition[char-<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="keyword">if</span> charLastPos &gt; end &#123;</span><br><span class="line">    end = charLastPos</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬éå†åˆ°ä½ç½® <code>i</code> ç­‰äºå½“å‰ç»´æŠ¤çš„ <code>end</code> æ—¶ï¼Œæ„å‘³ç€ä» <code>start</code> åˆ° <code>end</code> çš„è¿™ä¸ªç‰‡æ®µæ»¡è¶³æ¡ä»¶ï¼ˆæ‰€æœ‰å­—æ¯éƒ½åªå‡ºç°åœ¨è¿™ä¸ªç‰‡æ®µä¸­ï¼‰ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªç‰‡æ®µçš„é•¿åº¦æ·»åŠ åˆ°ç»“æœä¸­ï¼Œå¹¶æ›´æ–°ä¸‹ä¸€ä¸ªç‰‡æ®µçš„å¼€å§‹ä½ç½®ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> i == end &#123;</span><br><span class="line">    result = <span class="built_in">append</span>(result, end-start+<span class="number">1</span>)</span><br><span class="line">    start = end + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è´ªå¿ƒç®—æ³•</th>
<th>å…¶ä»–å¯èƒ½çš„æ–¹æ³•ï¼ˆå¦‚åˆ†æ²»ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(nÂ²) æˆ–æ›´é«˜</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1) (åªéœ€å›ºå®šå¤§å°æ•°ç»„)</td>
<td>å¯èƒ½éœ€è¦æ›´å¤šç©ºé—´</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç®€å•ç›´è§‚ï¼Œæ•ˆç‡é«˜</td>
<td>é€‚åº”æ€§å¯èƒ½æ›´å¼º</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>é’ˆå¯¹ç‰¹å®šé—®é¢˜</td>
<td>å®ç°å¤æ‚ï¼Œæ•ˆç‡è¾ƒä½</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œå…¶ä¸­ n æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚æˆ‘ä»¬éœ€è¦ä¸¤æ¬¡éå†å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€æ¬¡è®°å½•æ¯ä¸ªå­—æ¯æœ€åå‡ºç°çš„ä½ç½®ï¼Œç¬¬äºŒæ¬¡è¿›è¡Œåˆ†åŒºã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„æ¥è®°å½•å­—æ¯çš„æœ€åå‡ºç°ä½ç½®ï¼ˆæœ€å¤š 26 ä¸ªå­—æ¯ï¼‰ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>è´ªå¿ƒç®—æ³•æ€æƒ³</strong>ï¼šè¿™é“é¢˜æ˜¯è´ªå¿ƒç®—æ³•çš„å…¸å‹åº”ç”¨ï¼Œé€šè¿‡æ¯æ¬¡é€‰æ‹©å±€éƒ¨æœ€ä¼˜è§£ï¼ˆå°½å¯èƒ½å°çš„æ»¡è¶³æ¡ä»¶çš„ç‰‡æ®µï¼‰ï¼Œæœ€ç»ˆè¾¾åˆ°å…¨å±€æœ€ä¼˜ï¼ˆæœ€å¤šçš„ç‰‡æ®µæ•°é‡ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é¢„å¤„ç†æŠ€å·§</strong>ï¼šæå‰è®°å½•æ¯ä¸ªå­—æ¯æœ€åå‡ºç°çš„ä½ç½®ï¼Œé¿å…äº†é‡å¤æŸ¥æ‰¾ï¼Œæé«˜äº†ç®—æ³•æ•ˆç‡ã€‚</p>
</li>
<li>
<p><strong>åŒæŒ‡é’ˆ</strong>ï¼šåˆ©ç”¨ <code>start</code> å’Œ <code>end</code> ä¸¤ä¸ªæŒ‡é’ˆæ¥ç»´æŠ¤å½“å‰ç‰‡æ®µçš„èŒƒå›´ï¼Œæ˜¯ä¸€ç§å¸¸è§ä¸”æœ‰æ•ˆçš„æŠ€å·§ã€‚</p>
</li>
<li>
<p><strong>é—®é¢˜è½¬åŒ–</strong>ï¼šå°†&quot;åŒä¸€å­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­&quot;è½¬åŒ–ä¸º&quot;æ‰¾åˆ°ä¸€ä¸ªæœ€å°çš„åŒ…å«æ‰€æœ‰å‡ºç°å­—æ¯çš„åŒºé—´&quot;ï¼Œæ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®ã€‚</p>
</li>
</ol>
<p>è¿™é“é¢˜ç›®ä½“ç°äº†è´ªå¿ƒç®—æ³•çš„ç²¾é«“ï¼šé€šè¿‡æ¯æ¬¡åšå‡ºå±€éƒ¨æœ€ä¼˜çš„é€‰æ‹©ï¼Œæœ€ç»ˆå¾—åˆ°å…¨å±€æœ€ä¼˜è§£ã€‚ç†è§£è¿™ç§æ€æƒ³å¯¹è§£å†³å…¶ä»–ç±»ä¼¼çš„åŒºé—´åˆ’åˆ†é—®é¢˜ä¹Ÿæœ‰å¾ˆå¤§å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>è´ªå¿ƒ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>è´ªå¿ƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 45 - è·³è·ƒæ¸¸æˆ II (Jump Game II)</title>
    <url>/2025/05/15/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-45-%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F-II/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„ 0 ç´¢å¼•æ•´æ•°æ•°ç»„ numsã€‚åˆå§‹ä½ç½®ä¸º nums[0]ã€‚</p>
<p>æ¯ä¸ªå…ƒç´  nums[i] è¡¨ç¤ºä»ç´¢å¼• i å‘åè·³è½¬çš„æœ€å¤§é•¿åº¦ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ åœ¨ nums[i] å¤„ï¼Œä½ å¯ä»¥è·³è½¬åˆ°ä»»æ„ nums[i + j] å¤„:</p>
<ul>
<li>0 &lt;= j &lt;= nums[i]</li>
<li>i + j &lt; n</li>
</ul>
<p>è¿”å›åˆ°è¾¾ nums[n - 1] çš„æœ€å°è·³è·ƒæ¬¡æ•°ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [2,3,1,1,4]</span><br><span class="line">è¾“å‡º: 2</span><br><span class="line">è§£é‡Š: è·³åˆ°æœ€åä¸€ä¸ªä½ç½®çš„æœ€å°è·³è·ƒæ•°æ˜¯ 2ã€‚</span><br><span class="line">     ä»ä¸‹æ ‡ä¸º 0 è·³åˆ°ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼Œè·³ 1 æ­¥ï¼Œç„¶åè·³ 3 æ­¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [2,3,0,1,4]</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>1 &lt;= nums.length &lt;= 10^4</li>
<li>0 &lt;= nums[i] &lt;= 1000</li>
<li>é¢˜ç›®ä¿è¯å¯ä»¥åˆ°è¾¾ nums[n-1]</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜è¦æ±‚è®¡ç®—åˆ°è¾¾æ•°ç»„æœ€åä½ç½®çš„æœ€å°è·³è·ƒæ¬¡æ•°ã€‚æœ‰å¤šç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»ä¸‰ç§ä¸»è¦çš„è§£æ³•ï¼šè´ªå¿ƒç®—æ³•ã€åŠ¨æ€è§„åˆ’å’Œ BFSã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šè´ªå¿ƒç®—æ³•ï¼ˆæœ€ä¼˜è§£ï¼‰">æ–¹æ³•ä¸€ï¼šè´ªå¿ƒç®—æ³•ï¼ˆæœ€ä¼˜è§£ï¼‰</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåœ¨æ¯ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬éƒ½è´ªå¿ƒåœ°é€‰æ‹©èƒ½è·³å¾—æœ€è¿œçš„ä½ç½®ï¼Œå°†è·³è·ƒè¿‡ç¨‹åˆ’åˆ†ä¸ºå¤šä¸ªåŒºé—´ã€‚</p>
<p>å…·ä½“æ€è·¯ï¼š</p>
<ol>
<li>ç»´æŠ¤å½“å‰èƒ½å¤Ÿåˆ°è¾¾çš„æœ€è¿œä½ç½® <code>maxReach</code></li>
<li>ç»´æŠ¤å½“å‰è·³è·ƒåŒºé—´çš„è¾¹ç•Œ <code>end</code></li>
<li>å½“åˆ°è¾¾å½“å‰åŒºé—´è¾¹ç•Œæ—¶ï¼Œæ›´æ–°è¾¹ç•Œå¹¶å¢åŠ è·³è·ƒæ­¥æ•°</li>
</ol>
<p>è¿™ä¸ªè´ªå¿ƒç­–ç•¥ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºåœ¨æ¯ä¸ªåŒºé—´å†…ï¼Œæˆ‘ä»¬æ€»æ˜¯é€‰æ‹©èƒ½ä½¿ä¸‹ä¸€æ­¥è·³å¾—æœ€è¿œçš„ä½ç½®ï¼Œè¿™æ ·å¯ä»¥æœ€å°åŒ–è·³è·ƒæ¬¡æ•°ã€‚</p>
<h3 id="æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’">æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨æ•°ç»„ dp[i] è¡¨ç¤ºåˆ°è¾¾ä½ç½® i çš„æœ€å°è·³è·ƒæ¬¡æ•°ã€‚</p>
<p>å…·ä½“æ€è·¯ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ dpï¼Œåˆå§‹å€¼è®¾ä¸º infinityï¼ˆè¡¨ç¤ºæ— æ³•åˆ°è¾¾ï¼‰</li>
<li>è®¾ç½® dp[0] = 0ï¼ˆèµ·å§‹ä½ç½®ä¸éœ€è¦è·³è·ƒï¼‰</li>
<li>å¯¹äºæ¯ä¸ªä½ç½® iï¼Œå°è¯•æ›´æ–° dp[i+1] åˆ° dp[i+nums[i]]</li>
</ol>
<h3 id="æ–¹æ³•ä¸‰ï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰">æ–¹æ³•ä¸‰ï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°†æ•°ç»„è§†ä¸ºä¸€ä¸ªå›¾ï¼Œæ¯æ¬¡å¯ä»¥ä»å½“å‰ä½ç½®è·³åˆ°å¯è¾¾çš„èŒƒå›´å†…çš„ä»»æ„ä½ç½®ã€‚</p>
<p>å…·ä½“æ€è·¯ï¼š</p>
<ol>
<li>ä½¿ç”¨é˜Ÿåˆ—å­˜å‚¨å½“å‰å±‚çº§ï¼ˆç›¸åŒè·³è·ƒæ¬¡æ•°ï¼‰èƒ½åˆ°è¾¾çš„ä½ç½®</li>
<li>æ¯å±‚ä»£è¡¨ä¸€æ¬¡è·³è·ƒï¼Œç›´åˆ°æ‰¾åˆ°æœ€åä¸€ä¸ªä½ç½®</li>
<li>å±‚æ•°å³ä¸ºæœ€å°è·³è·ƒæ¬¡æ•°</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="è´ªå¿ƒç®—æ³•å®ç°">è´ªå¿ƒç®—æ³•å®ç°</h3>
<p>è´ªå¿ƒç®—æ³•ç»´æŠ¤ä¸‰ä¸ªå…³é”®å˜é‡ï¼š</p>
<ul>
<li><code>steps</code>ï¼šè®°å½•è·³è·ƒæ¬¡æ•°</li>
<li><code>end</code>ï¼šå½“å‰è·³è·ƒèƒ½åˆ°è¾¾çš„è¾¹ç•Œ</li>
<li><code>maxReach</code>ï¼šä¸‹ä¸€æ­¥èƒ½å¤Ÿåˆ°è¾¾çš„æœ€è¿œä½ç½®</li>
</ul>
<p>ç®—æ³•çš„å…³é”®åœ¨äºåŒºé—´çš„åˆ’åˆ†ï¼š</p>
<ol>
<li>æˆ‘ä»¬å°†é—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªåŒºé—´</li>
<li>åœ¨å½“å‰åŒºé—´ [i, end] å†…ï¼Œè®¡ç®—èƒ½å¤Ÿåˆ°è¾¾çš„æœ€è¿œä½ç½® maxReach</li>
<li>å½“éå†åˆ°å½“å‰åŒºé—´çš„è¾¹ç•Œ end æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“å¿…é¡»è¿›è¡Œä¸€æ¬¡è·³è·ƒ</li>
<li>æ­¤æ—¶ï¼Œå°† end æ›´æ–°ä¸º maxReachï¼Œè¡¨ç¤ºæ–°çš„åŒºé—´è¾¹ç•Œ</li>
<li>steps è‡ªå¢ï¼Œè¡¨ç¤ºè¿›è¡Œäº†ä¸€æ¬¡è·³è·ƒ</li>
</ol>
<p><strong>æ³¨æ„ç‚¹</strong>ï¼šå¾ªç¯æ¡ä»¶æ˜¯ <code>i &lt; len(nums)-1</code> è€Œä¸æ˜¯ <code>i &lt; len(nums)</code>ï¼Œè¿™æ˜¯å› ä¸ºï¼š</p>
<ol>
<li>æˆ‘ä»¬åªéœ€è¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ï¼Œè€Œä¸éœ€è¦ä»æœ€åä¸€ä¸ªä½ç½®å†è·³</li>
<li>å½“åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®æ—¶ï¼Œä¸éœ€è¦å†è®¡ç®—å¯ä»¥è·³åˆ°çš„æœ€è¿œè·ç¦»</li>
</ol>
<h3 id="å…³é”®ä»£ç è§£æ">å…³é”®ä»£ç è§£æ</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">jump</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	steps := <span class="number">0</span>  <span class="comment">// è·³è·ƒæ¬¡æ•°</span></span><br><span class="line">	end := <span class="number">0</span>    <span class="comment">// å½“å‰åŒºé—´çš„ç»ˆç‚¹</span></span><br><span class="line">	maxReach := <span class="number">0</span>  <span class="comment">// å½“å‰èƒ½åˆ°è¾¾çš„æœ€è¿œä½ç½®</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums)<span class="number">-1</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// æ›´æ–°æœ€è¿œå¯è¾¾ä½ç½®</span></span><br><span class="line">		<span class="keyword">if</span> i+nums[i] &gt; maxReach &#123;</span><br><span class="line">			maxReach = i + nums[i]</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// åˆ°è¾¾å½“å‰åŒºé—´çš„ç»ˆç‚¹ï¼Œå¿…é¡»è·³è·ƒä¸€æ¬¡</span></span><br><span class="line">		<span class="keyword">if</span> i == end &#123;</span><br><span class="line">			steps++   <span class="comment">// å¢åŠ è·³è·ƒæ¬¡æ•°</span></span><br><span class="line">			end = maxReach  <span class="comment">// æ›´æ–°åŒºé—´ç»ˆç‚¹ä¸ºèƒ½åˆ°è¾¾çš„æœ€è¿œä½ç½®</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> steps</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæµç¨‹åˆ†æï¼šä»¥ <code>[2,3,1,1,4]</code> ä¸ºä¾‹</p>
<ol>
<li>åˆå§‹çŠ¶æ€ï¼šsteps=0, end=0, maxReach=0</li>
<li>i=0: nums[0]=2ï¼Œæ›´æ–° maxReach=0+2=2ï¼Œi==endï¼Œæ‰€ä»¥ steps=1ï¼Œend=2</li>
<li>i=1: nums[1]=3ï¼Œæ›´æ–° maxReach=1+3=4ï¼Œi!=endï¼Œæ‰€ä»¥ steps ä¸å˜</li>
<li>i=2: nums[2]=1ï¼ŒmaxReach å·²ç»æ˜¯ 4ï¼Œä¸æ›´æ–°ï¼Œi==endï¼Œæ‰€ä»¥ steps=2ï¼Œend=4</li>
<li>i=3: nums[3]=1ï¼ŒmaxReach å·²ç»æ˜¯ 4ï¼Œä¸æ›´æ–°ï¼Œi!=endï¼Œæ‰€ä»¥ steps ä¸å˜</li>
<li>å¾ªç¯ç»“æŸï¼Œè¿”å› steps=2</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šè´ªå¿ƒç®—æ³•">æ–¹æ³•ä¸€ï¼šè´ªå¿ƒç®—æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">jump</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	steps := <span class="number">0</span></span><br><span class="line">	end := <span class="number">0</span></span><br><span class="line">	maxReach := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums)<span class="number">-1</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> i+nums[i] &gt; maxReach &#123;</span><br><span class="line">			maxReach = i + nums[i]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> i == end &#123;</span><br><span class="line">			steps++</span><br><span class="line">			end = maxReach</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> steps</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’-2">æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">jumpDP</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line">	dp := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–dpæ•°ç»„ï¼Œè®¾ç½®ä¸ºæœ€å¤§å€¼</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">		dp[i] = n <span class="comment">// ä½¿ç”¨nä½œä¸º&quot;æ— ç©·å¤§&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	dp[<span class="number">0</span>] = <span class="number">0</span> <span class="comment">// èµ·å§‹ä½ç½®ä¸éœ€è¦è·³è·ƒ</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// åŠ¨æ€è§„åˆ’å¡«è¡¨</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		<span class="comment">// ä»ä½ç½®ièƒ½è·³åˆ°çš„æ‰€æœ‰ä½ç½®</span></span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= nums[i] &amp;&amp; i+j &lt; n; j++ &#123;</span><br><span class="line">			dp[i+j] = min(dp[i+j], dp[i]+<span class="number">1</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dp[n<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> a &lt; b &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰-2">æ–¹æ³•ä¸‰ï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">jumpBFS</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å·²è®¿é—®çš„ä½ç½®</span></span><br><span class="line">	visited := <span class="built_in">make</span>([]<span class="type">bool</span>, n)</span><br><span class="line">	visited[<span class="number">0</span>] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// é˜Ÿåˆ—è®°å½•å½“å‰å±‚çº§çš„ä½ç½®</span></span><br><span class="line">	queue := []<span class="type">int</span>&#123;<span class="number">0</span>&#125;</span><br><span class="line">	steps := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		size := <span class="built_in">len</span>(queue)</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; size; i++ &#123;</span><br><span class="line">			curr := queue[<span class="number">0</span>]</span><br><span class="line">			queue = queue[<span class="number">1</span>:] <span class="comment">// å‡ºé˜Ÿ</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">// ä»å½“å‰ä½ç½®èƒ½è·³åˆ°çš„æ‰€æœ‰ä½ç½®</span></span><br><span class="line">			<span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= nums[curr] &amp;&amp; curr+j &lt; n; j++ &#123;</span><br><span class="line">				next := curr + j</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å¦‚æœåˆ°è¾¾ç»ˆç‚¹ï¼Œç›´æ¥è¿”å›æ­¥æ•°+1</span></span><br><span class="line">				<span class="keyword">if</span> next == n<span class="number">-1</span> &#123;</span><br><span class="line">					<span class="keyword">return</span> steps + <span class="number">1</span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å¦‚æœè¯¥ä½ç½®æœªè®¿é—®è¿‡ï¼ŒåŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">				<span class="keyword">if</span> !visited[next] &#123;</span><br><span class="line">					visited[next] = <span class="literal">true</span></span><br><span class="line">					queue = <span class="built_in">append</span>(queue, next)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		steps++ <span class="comment">// å¢åŠ å±‚çº§</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span> <span class="comment">// ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œå› ä¸ºé¢˜ç›®ä¿è¯å¯ä»¥åˆ°è¾¾</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è´ªå¿ƒç®—æ³•</th>
<th>åŠ¨æ€è§„åˆ’</th>
<th>BFS</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(nÂ²)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>æœ€é«˜æ•ˆï¼Œç©ºé—´å ç”¨å°</td>
<td>æ€è·¯æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£</td>
<td>é€‚ç”¨äºæœ€çŸ­è·¯å¾„é—®é¢˜</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å®ç°æŠ€å·§æ€§è¾ƒé«˜</td>
<td>æ—¶é—´å¤æ‚åº¦è¾ƒé«˜</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>éœ€è¦æœ€ä¼˜æ€§èƒ½</td>
<td>éœ€è¦æ±‚è§£æ›´å¤æ‚çš„å˜ç§</td>
<td>å›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="è´ªå¿ƒç®—æ³•">è´ªå¿ƒç®—æ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œåªéœ€è¦éå†æ•°ç»„ä¸€æ¬¡</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)ï¼Œåªä½¿ç”¨äº†å‡ ä¸ªå˜é‡ï¼Œæ²¡æœ‰é¢å¤–çš„æ•°æ®ç»“æ„</li>
</ul>
<h3 id="åŠ¨æ€è§„åˆ’">åŠ¨æ€è§„åˆ’</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(nÂ²)ï¼Œæœ€åæƒ…å†µä¸‹ï¼Œå¯¹äºæ¯ä¸ªä½ç½® iï¼Œæˆ‘ä»¬éœ€è¦å°è¯• nums[i] ç§è·³è·ƒæ–¹å¼</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œéœ€è¦ä¸€ä¸ªé•¿åº¦ä¸º n çš„ dp æ•°ç»„</li>
</ul>
<h3 id="BFS">BFS</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œæ¯ä¸ªä½ç½®æœ€å¤šå…¥é˜Ÿä¸€æ¬¡</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œéœ€è¦é˜Ÿåˆ—å’Œè®¿é—®æ ‡è®°æ•°ç»„</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>è´ªå¿ƒç®—æ³•çš„å·§å¦™åº”ç”¨</strong>ï¼š</p>
<ul>
<li>åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œè´ªå¿ƒç®—æ³•ä¸æ˜¯ç›´æ¥é€‰æ‹©èƒ½è·³å¾—æœ€è¿œçš„ä½ç½®ï¼Œè€Œæ˜¯åœ¨èƒ½è·³åˆ°çš„èŒƒå›´å†…é€‰æ‹©èƒ½ä½¿ä¸‹ä¸€æ­¥è·³å¾—æœ€è¿œçš„ä½ç½®</li>
<li>ä½¿ç”¨åŒºé—´åˆ’åˆ†çš„æ€æƒ³æ¥ä¼˜åŒ–è§£æ³•</li>
</ul>
</li>
<li>
<p><strong>è¾¹ç•Œå¤„ç†çš„é‡è¦æ€§</strong>ï¼š</p>
<ul>
<li>å¾ªç¯æ¡ä»¶ <code>i &lt; len(nums)-1</code> è€Œä¸æ˜¯ <code>i &lt; len(nums)</code>ï¼Œé¿å…äº†ä¸å¿…è¦çš„è®¡ç®—</li>
<li>è¿™ä¸ªç»†èŠ‚å¾ˆå®¹æ˜“è¢«å¿½ç•¥ï¼Œä½†å¯¹æ­£ç¡®æ€§è‡³å…³é‡è¦</li>
</ul>
</li>
<li>
<p><strong>ç®—æ³•é€‰æ‹©çš„æƒè¡¡</strong>ï¼š</p>
<ul>
<li>è´ªå¿ƒç®—æ³•åœ¨è¿™ä¸ªé—®é¢˜ä¸Šæ•ˆç‡æœ€é«˜ï¼Œä½†å®ç°è¾ƒä¸ºæŠ€å·§æ€§</li>
<li>åŠ¨æ€è§„åˆ’æ€è·¯æ¸…æ™°ä½†æ•ˆç‡è¾ƒä½</li>
<li>BFS é€‚ç”¨äºæ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œä½†éœ€è¦é¢å¤–ç©ºé—´</li>
</ul>
</li>
<li>
<p><strong>å˜é‡å‘½åçš„å«ä¹‰</strong>ï¼š</p>
<ul>
<li><code>end</code> è¡¨ç¤ºå½“å‰è·³è·ƒåŒºé—´çš„è¾¹ç•Œï¼Œæ˜¯ä¸€ä¸ªå…³é”®çš„æ¦‚å¿µ</li>
<li><code>maxReach</code> è®°å½•å½“å‰èƒ½åˆ°è¾¾çš„æœ€è¿œä½ç½®</li>
<li>æ¸…æ™°çš„å˜é‡å‘½åä½¿ç®—æ³•æ›´æ˜“ç†è§£</li>
</ul>
</li>
</ol>
<h2 id="ç›¸å…³é¢˜ç›®">ç›¸å…³é¢˜ç›®</h2>
<ul>
<li>LeetCode 55: è·³è·ƒæ¸¸æˆï¼ˆåˆ¤æ–­æ˜¯å¦èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ï¼‰</li>
<li>LeetCode 1306: è·³è·ƒæ¸¸æˆ IIIï¼ˆèƒ½å¦åˆ°è¾¾å€¼ä¸º 0 çš„å…ƒç´ ï¼‰</li>
<li>LeetCode 1340: è·³è·ƒæ¸¸æˆ Vï¼ˆä»æ›´é«˜çš„æŸ±å­å‘ä¸¤è¾¹è·³è·ƒï¼‰</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>å¹¿åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>è´ªå¿ƒç®—æ³•</tag>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis BitMapåŠå…¶ä»–é«˜çº§æ•°æ®ç±»å‹è¯¦è§£</title>
    <url>/2025/05/14/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Other/</url>
    <content><![CDATA[<h2 id="BitMap">BitMap</h2>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>Bitmapï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ª<strong>è¶…çº§è¿·ä½ çš„å°æœ¬æœ¬</strong>ï¼Œè¿™ä¸ªæœ¬æœ¬ä¸Šåªè®°å½•ä¸¤ç§çŠ¶æ€ï¼šè¦ä¹ˆæ˜¯&quot;âˆš&quot;ï¼ˆè¡¨ç¤º 1ï¼‰ï¼Œè¦ä¹ˆæ˜¯&quot;Ã—&quot;ï¼ˆè¡¨ç¤º 0ï¼‰ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª&quot;é¡µç &quot;ï¼ˆä¹Ÿå°±æ˜¯åç§»é‡ offsetï¼‰å°±èƒ½å¿«é€Ÿæ‰¾åˆ°å¯¹åº”ä½ç½®çš„çŠ¶æ€æ˜¯&quot;âˆš&quot;è¿˜æ˜¯&quot;Ã—&quot;ã€‚</p>
<p>è¿™ç§å°æœ¬æœ¬æœ€å¤§çš„å¥½å¤„å°±æ˜¯<strong>è¶…çº§èŠ‚çœç©ºé—´</strong>ã€‚å› ä¸ºè®¡ç®—æœºé‡Œæœ€å°çš„ä¿¡æ¯å•ä½å°±æ˜¯ bitï¼ˆæ¯”ç‰¹ï¼‰ï¼Œä¸€ä¸ª bit å°±èƒ½è¡¨ç¤ºä¸€ä¸ª&quot;âˆš&quot;æˆ–ä¸€ä¸ª&quot;Ã—&quot;ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æœ‰å¾ˆå¤šå¾ˆå¤šåªéœ€è¦è®°å½•ä¸¤ç§çŠ¶æ€çš„äº‹æƒ…æ—¶ï¼ˆæ¯”å¦‚ç”¨æˆ·ä»Šå¤©ç­¾åˆ°äº†æ²¡ï¼ŸæŸä¸ªåŠŸèƒ½æ‰“å¼€äº†æ²¡ï¼Ÿï¼‰ï¼Œç”¨ Bitmap å°±ç‰¹åˆ«åˆé€‚ï¼Œèƒ½çœä¸‹å¥½å¤šåœ°æ–¹ã€‚æˆ‘ä»¬æŠŠè¿™ç§åªéœ€è¦è®°å½•ä¸¤ç§çŠ¶æ€çš„åœºæ™¯ï¼Œå«åš&quot;<strong>äºŒå€¼ç»Ÿè®¡</strong>&quot;ã€‚</p>
<p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/redis/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/bitmap.png" alt></p>
<h3 id="å†…éƒ¨å®ç°">å†…éƒ¨å®ç°</h3>
<p>ä½ å¯èƒ½ä¼šå¥½å¥‡è¿™ä¸ª Bitmap å°æœ¬æœ¬åœ¨ Redis é‡Œæ˜¯æ€ä¹ˆå­˜æ”¾çš„ã€‚å…¶å®ï¼Œå®ƒå·§å¦™åœ°åˆ©ç”¨äº† Redis ä¸­æˆ‘ä»¬å·²ç»è®¤è¯†çš„ <code>String</code> ç±»å‹ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ <code>String</code> ç±»å‹åœ¨ Redis å†…éƒ¨å…¶å®æ˜¯ä»¥ä¸€ä¸²äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0å’Œ1ï¼‰çš„å½¢å¼å­˜å‚¨çš„ã€‚Bitmap å°±å€Ÿç”¨äº†è¿™ä¸€ç‚¹ï¼ŒæŠŠ <code>String</code> é‡Œçš„æ¯ä¸€ä¸ª bit ä½éƒ½å½“æˆå°æœ¬æœ¬ä¸Šçš„ä¸€é¡µï¼Œç”¨æ¥è®°å½•ä¸€ä¸ª&quot;âˆš&quot;æˆ–&quot;Ã—&quot;ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºï¼š<strong>Bitmap å°±æ˜¯ä¸€ä¸ªç”± bit ç»„æˆçš„å¤§æ•°ç»„ï¼Œè€Œè¿™ä¸ªå¤§æ•°ç»„è¢«è—åœ¨äº† String ç±»å‹é‡Œé¢</strong>ã€‚</p>
<h3 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h3>
<p>bitmap åŸºæœ¬æ“ä½œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å€¼ï¼Œå…¶ä¸­valueåªèƒ½æ˜¯ 0 å’Œ 1</span></span><br><span class="line">SETBIT key offset value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å€¼</span></span><br><span class="line">GETBIT key offset</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–æŒ‡å®šèŒƒå›´å†…å€¼ä¸º 1 çš„ä¸ªæ•°</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">start å’Œ end ä»¥å­—èŠ‚ä¸ºå•ä½</span></span><br><span class="line">BITCOUNT key start end</span><br></pre></td></tr></table></figure>
<p>bitmap è¿ç®—æ“ä½œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BitMapé—´çš„è¿ç®—</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">operations ä½ç§»æ“ä½œç¬¦ï¼Œæšä¸¾å€¼</span></span><br><span class="line">  AND ä¸è¿ç®— &amp;</span><br><span class="line">  OR æˆ–è¿ç®— |</span><br><span class="line">  XOR å¼‚æˆ– ^</span><br><span class="line">  NOT å–å ~</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">result è®¡ç®—çš„ç»“æœï¼Œä¼šå­˜å‚¨åœ¨è¯¥keyä¸­</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">key1 â€¦ keyn å‚ä¸è¿ç®—çš„keyï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œç©ºæ ¼åˆ†å‰²ï¼Œnotè¿ç®—åªèƒ½ä¸€ä¸ªkey</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å½“ BITOP å¤„ç†ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²æ—¶ï¼Œè¾ƒçŸ­çš„é‚£ä¸ªå­—ç¬¦ä¸²æ‰€ç¼ºå°‘çš„éƒ¨åˆ†ä¼šè¢«çœ‹ä½œ 0ã€‚è¿”å›å€¼æ˜¯ä¿å­˜åˆ° destkey çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚byteä¸ºå•ä½ï¼‰ï¼Œå’Œè¾“å…¥ key ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²é•¿åº¦ç›¸ç­‰ã€‚</span></span><br><span class="line">BITOP [operations] [result] [key1] [keynâ€¦]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›æŒ‡å®škeyä¸­ç¬¬ä¸€æ¬¡å‡ºç°æŒ‡å®švalue(0/1)çš„ä½ç½®</span></span><br><span class="line">BITPOS [key] [value]</span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3>
<p>Bitmap ç±»å‹éå¸¸é€‚åˆäºŒå€¼çŠ¶æ€ç»Ÿè®¡çš„åœºæ™¯ï¼Œè¿™é‡Œçš„äºŒå€¼çŠ¶æ€å°±æ˜¯æŒ‡é›†åˆå…ƒç´ çš„å–å€¼å°±åªæœ‰ 0 å’Œ 1 ä¸¤ç§ï¼Œåœ¨è®°å½•æµ·é‡æ•°æ®æ—¶ï¼ŒBitmap èƒ½å¤Ÿæœ‰æ•ˆåœ°èŠ‚çœå†…å­˜ç©ºé—´ã€‚</p>
<h4 id="ç­¾åˆ°ç»Ÿè®¡">ç­¾åˆ°ç»Ÿè®¡</h4>
<p>åœ¨ç­¾åˆ°æ‰“å¡çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬åªç”¨è®°å½•ç­¾åˆ°ï¼ˆ1ï¼‰æˆ–æœªç­¾åˆ°ï¼ˆ0ï¼‰ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯éå¸¸å…¸å‹çš„äºŒå€¼çŠ¶æ€ã€‚</p>
<p>ç­¾åˆ°ç»Ÿè®¡æ—¶ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€å¤©çš„ç­¾åˆ°ç”¨ 1 ä¸ª bit ä½å°±èƒ½è¡¨ç¤ºï¼Œä¸€ä¸ªæœˆï¼ˆå‡è®¾æ˜¯ 31 å¤©ï¼‰çš„ç­¾åˆ°æƒ…å†µç”¨ 31 ä¸ª bit ä½å°±å¯ä»¥ï¼Œè€Œä¸€å¹´çš„ç­¾åˆ°ä¹Ÿåªéœ€è¦ç”¨ 365 ä¸ª bit ä½ï¼Œæ ¹æœ¬ä¸ç”¨å¤ªå¤æ‚çš„é›†åˆç±»å‹ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬è¦ç»Ÿè®¡ ID 100 çš„ç”¨æˆ·åœ¨ 2022 å¹´ 6 æœˆä»½çš„ç­¾åˆ°æƒ…å†µï¼Œå°±å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œæ“ä½œã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè®°å½•è¯¥ç”¨æˆ· 6 æœˆ 3 å·å·²ç­¾åˆ°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SETBIT uid:sign:100:202206 2 1</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼Œæ£€æŸ¥è¯¥ç”¨æˆ· 6 æœˆ 3 æ—¥æ˜¯å¦ç­¾åˆ°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GETBIT uid:sign:100:202206 2</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼Œç»Ÿè®¡è¯¥ç”¨æˆ·åœ¨ 6 æœˆä»½çš„ç­¾åˆ°æ¬¡æ•°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">BITCOUNT uid:sign:100:202206</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¯¥ç”¨æˆ·åœ¨ 6 æœˆä»½çš„ç­¾åˆ°æƒ…å†µäº†ã€‚</p>
<blockquote>
<p>å¦‚ä½•ç»Ÿè®¡è¿™ä¸ªæœˆé¦–æ¬¡æ‰“å¡æ—¶é—´å‘¢ï¼Ÿ</p>
</blockquote>
<p>Redis æä¾›äº† <code>BITPOS key bitValue [start] [end]</code>æŒ‡ä»¤ï¼Œè¿”å›æ•°æ®è¡¨ç¤º Bitmap ä¸­ç¬¬ä¸€ä¸ªå€¼ä¸º <code>bitValue</code> çš„ offset ä½ç½®ã€‚</p>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘½ä»¤å°†æ£€æµ‹æ•´ä¸ªä½å›¾ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¯é€‰çš„ <code>start</code> å‚æ•°å’Œ <code>end</code> å‚æ•°æŒ‡å®šè¦æ£€æµ‹çš„èŒƒå›´ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œè¿™æ¡å‘½ä»¤æ¥è·å– userID = 100 åœ¨ 2022 å¹´ 6 æœˆä»½<strong>é¦–æ¬¡æ‰“å¡</strong>æ—¥æœŸï¼š</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">BITPOS</span> uid:sign:<span class="number">100</span>:<span class="number">202206</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸º offset ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿”å›çš„ value + 1ã€‚</p>
<h4 id="åˆ¤æ–­ç”¨æˆ·ç™»å½•æ€">åˆ¤æ–­ç”¨æˆ·ç™»å½•æ€</h4>
<p>Bitmap æä¾›äº† <code>GETBITã€SETBIT</code> æ“ä½œï¼Œé€šè¿‡ä¸€ä¸ªåç§»å€¼ offset å¯¹ bit æ•°ç»„çš„ offset ä½ç½®çš„ bit ä½è¿›è¡Œè¯»å†™æ“ä½œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ offset ä» 0 å¼€å§‹ã€‚</p>
<p>åªéœ€è¦ä¸€ä¸ª key = login_status è¡¨ç¤ºå­˜å‚¨ç”¨æˆ·ç™»å½•çŠ¶æ€é›†åˆæ•°æ®ï¼Œå°†ç”¨æˆ· ID ä½œä¸º offsetï¼Œåœ¨çº¿å°±è®¾ç½®ä¸º 1ï¼Œä¸‹çº¿è®¾ç½® 0ã€‚é€šè¿‡ <code>GETBIT</code>åˆ¤æ–­å¯¹åº”çš„ç”¨æˆ·æ˜¯å¦åœ¨çº¿ã€‚50000 ä¸‡ ç”¨æˆ·åªéœ€è¦ 6 MB çš„ç©ºé—´ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬è¦åˆ¤æ–­ ID = 10086 çš„ç”¨æˆ·çš„ç™»å½•æƒ…å†µï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œè¡¨ç¤ºç”¨æˆ·å·²ç™»å½•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SETBIT login_status 10086 1</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼Œæ£€æŸ¥è¯¥ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œè¿”å›å€¼ 1 è¡¨ç¤ºå·²ç™»å½•ã€‚</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">GETBIT</span> login_status <span class="number">10086</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼Œç™»å‡ºï¼Œå°† offset å¯¹åº”çš„ value è®¾ç½®æˆ 0ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SETBIT login_status 10086 0</span><br></pre></td></tr></table></figure>
<h4 id="è¿ç»­ç­¾åˆ°ç”¨æˆ·æ€»æ•°">è¿ç»­ç­¾åˆ°ç”¨æˆ·æ€»æ•°</h4>
<p>å¦‚ä½•ç»Ÿè®¡è¿ç»­ 7 å¤©éƒ½ç­¾åˆ°çš„ç”¨æˆ·æ€»æ•°ï¼Ÿè¿™é‡Œæˆ‘ä»¬å¯ä»¥å·§å¦™åœ°ä½¿ç”¨ Bitmap å’Œä½è¿ç®—æ¥å®ç°ã€‚</p>
<p><strong>åŸºæœ¬æ€è·¯</strong>ï¼š</p>
<ol>
<li>
<p>ä¸ºæ¯å¤©åˆ›å»ºä¸€ä¸ª Bitmapï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>Bitmap çš„ key æ˜¯æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š<code>sign:20250508</code>ï¼‰</li>
<li>ç”¨æˆ· ID ä½œä¸º offset ä½ç½®</li>
<li>ç”¨æˆ·ç­¾åˆ°åˆ™å°†å¯¹åº”ä½ç½®è®¾ä¸º 1ï¼Œæœªç­¾åˆ°åˆ™ä¸º 0</li>
</ul>
</li>
<li>
<p>å½“æˆ‘ä»¬éœ€è¦ç»Ÿè®¡è¿ç»­ 7 å¤©éƒ½ç­¾åˆ°çš„ç”¨æˆ·æ—¶ï¼š</p>
<ul>
<li>å¯¹è¿™ 7 å¤©çš„ Bitmap æ‰§è¡Œ&quot;æŒ‰ä½ä¸&quot;ï¼ˆANDï¼‰æ“ä½œ</li>
<li>ç»“æœä¸­ï¼Œåªæœ‰ 7 å¤©éƒ½ç­¾åˆ°ï¼ˆå³ 7 ä¸ª Bitmap å¯¹åº”ä½ç½®éƒ½æ˜¯ 1ï¼‰çš„ç”¨æˆ·ï¼Œåœ¨æœ€ç»ˆç»“æœä¸­æ‰ä¼šæ˜¯ 1</li>
</ul>
</li>
<li>
<p>ç»Ÿè®¡ç»“æœ Bitmap ä¸­å€¼ä¸º 1 çš„ä½æ•°ï¼Œå°±å¾—åˆ°äº†è¿ç»­ç­¾åˆ° 7 å¤©çš„ç”¨æˆ·æ€»æ•°</p>
</li>
</ol>
<p>Redis æä¾›äº† <code>BITOP</code>å‘½ä»¤æ¥å®ç°è¿™ç§ä½æ“ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BITOP operation destkey key [key ...]</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>operation</code>å¯ä»¥æ˜¯ <code>AND</code>ï¼ˆä¸ï¼‰ã€<code>OR</code>ï¼ˆæˆ–ï¼‰ã€<code>XOR</code>ï¼ˆå¼‚æˆ–ï¼‰ã€<code>NOT</code>ï¼ˆéï¼‰</li>
<li><code>destkey</code>æ˜¯å­˜å‚¨ç»“æœçš„é”®å</li>
<li>åé¢è·Ÿç€å‚ä¸è¿ç®—çš„é”®ååˆ—è¡¨</li>
</ul>
<p>å½“ä½¿ç”¨ <code>AND</code>æ“ä½œæ—¶ï¼Œåªæœ‰åœ¨æ‰€æœ‰è¾“å…¥ Bitmap çš„ç›¸åŒä½ç½®éƒ½ä¸º 1 æ—¶ï¼Œç»“æœæ‰ä¸º 1ï¼Œè¿™æ­£å¥½ç¬¦åˆæˆ‘ä»¬&quot;è¿ç»­ç­¾åˆ°&quot;çš„é€»è¾‘ã€‚</p>
<p><strong>å®ä¾‹è¯´æ˜</strong>ï¼š</p>
<p>å‡è®¾è¦ç»Ÿè®¡æœ€è¿‘ 3 å¤©ï¼ˆ5 æœˆ 12 æ—¥ã€13 æ—¥å’Œ 14 æ—¥ï¼‰è¿ç»­ç­¾åˆ°çš„ç”¨æˆ·æ•°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰§è¡ŒANDä½æ“ä½œï¼Œå°†ç»“æœå­˜å…¥destmap</span></span><br><span class="line">BITOP AND destmap sign:20250512 sign:20250513 sign:20250514</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç»Ÿè®¡ç»“æœä¸­ä½å€¼ä¸º1çš„æ•°é‡ï¼ˆå³è¿ç»­ç­¾åˆ°ç”¨æˆ·æ•°ï¼‰</span></span><br><span class="line">BITCOUNT destmap</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œ<code>BITCOUNT destmap</code>è¿”å›çš„ç»“æœå°±æ˜¯è¿ç»­ 3 å¤©éƒ½ç­¾åˆ°çš„ç”¨æˆ·æ€»æ•°ã€‚</p>
<p><strong>å†…å­˜å ç”¨åˆ†æ</strong>ï¼š</p>
<ul>
<li>å³ä½¿ç”¨æˆ·æ•°é‡è¾¾åˆ° 1 äº¿ï¼Œä¸€ä¸ª Bitmap çš„å†…å­˜å ç”¨ä¹Ÿåªæœ‰çº¦ 12 MB<br>
(è®¡ç®—æ–¹å¼ï¼š10^8 ä½ Ã· 8 ä½/å­—èŠ‚ Ã· 1024 å­—èŠ‚/KB Ã· 1024KB/MB â‰ˆ 12 MB)</li>
<li>å­˜å‚¨ 7 å¤©çš„ç­¾åˆ°æ•°æ®çº¦éœ€ 84 MB å†…å­˜</li>
</ul>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li>ä¸º Bitmap è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œè‡ªåŠ¨æ¸…ç†å†å²ç­¾åˆ°æ•°æ®</li>
<li>å¯¹äºå¤§å‹åº”ç”¨ï¼Œå¯ä»¥æŒ‰æœˆæˆ–æŒ‰å‘¨è®¾è®¡é”®åï¼Œä¾¿äºç®¡ç†å’Œæ¸…ç†</li>
<li>å¯ç»“åˆ Redis çš„è®¡åˆ’ä»»åŠ¡ï¼Œå®šæœŸåˆå¹¶è®¡ç®—è¿ç»­ç­¾åˆ°çš„ç»Ÿè®¡ç»“æœ</li>
</ul>
<h2 id="HyperLogLog">HyperLogLog</h2>
<h3 id="ä»‹ç»-2">ä»‹ç»</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æƒ³çŸ¥é“ä¸€ä¸ªè¶…çº§å¤§çš„ç½‘ç«™ï¼Œæ¯”å¦‚å¾®åšæˆ–è€…çŸ¥ä¹ï¼Œä¸€å¤©æœ‰å¤šå°‘<strong>ä¸åŒçš„äºº</strong>è®¿é—®äº†å®ƒã€‚ç›´æ¥å»æ•°çš„è¯ï¼Œå¦‚æœæ¯ä¸ªäººéƒ½è®°å½•ä¸‹æ¥ï¼Œé‚£å¾—ç”¨æ‰å¤šå°‘å­˜å‚¨ç©ºé—´å•Šï¼</p>
<p>Redis çš„ HyperLogLog å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„&quot;ç¥å™¨&quot;ã€‚å®ƒæ˜¯ä¸€ç§ä¸“é—¨ç”¨æ¥åš&quot;<strong>å»é‡è®¡æ•°</strong>&quot;ï¼ˆä¸“ä¸šç‚¹å«ã€Œç»Ÿè®¡åŸºæ•°ã€ï¼‰çš„å·¥å…·ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¸®ä½ ä¼°ç®—å‡ºä¸€å¤§å †æ•°æ®é‡Œï¼Œåˆ°åº•æœ‰å¤šå°‘ä¸ªä¸é‡å¤çš„å…ƒç´ ã€‚</p>
<p>æœ€å‰å®³çš„æ˜¯ï¼ŒHyperLogLog <strong>è¶…çº§èŠ‚çœå†…å­˜</strong>ï¼ä¸ç®¡ä½ è¦ç»Ÿè®¡çš„æ•°æ®æœ‰å¤šå°‘ï¼ˆå‡ ç™¾ä¸‡ã€å‡ äº¿ç”šè‡³æ›´å¤šï¼‰ï¼Œå®ƒåŸºæœ¬ä¸Šéƒ½åªç”¨å›ºå®šçš„ã€éå¸¸éå¸¸å°çš„å†…å­˜ï¼ˆåœ¨ Redis é‡Œå¤§çº¦æ˜¯ 12KBï¼‰ã€‚å°±èƒ½ç»™ä½ ä¸€ä¸ªå…«ä¹ä¸ç¦»åçš„ä¼°è®¡å€¼ã€‚å½“ç„¶ï¼Œå®ƒä¹Ÿä¸æ˜¯ç™¾åˆ†ç™¾ç²¾ç¡®çš„ï¼Œä¼šæœ‰ä¸€ç‚¹ç‚¹å°è¯¯å·®ï¼ˆæ ‡å‡†é”™è¯¯ç‡å¤§çº¦æ˜¯ 0.81%ï¼‰ï¼Œä½†å¯¹äºå¾ˆå¤šåœºæ™¯æ¥è¯´ï¼Œè¿™ç‚¹è¯¯å·®å®Œå…¨å¯ä»¥æ¥å—ã€‚</p>
<p><strong>ä¸¾ä¸ªä¾‹å­è®©ä½ æ„Ÿå—ä¸‹å®ƒæœ‰å¤šçœå†…å­˜</strong>ï¼š</p>
<p>å¦‚æœæˆ‘ä»¬ä¸ç”¨ HyperLogLogï¼Œè€Œæ˜¯ç”¨ä¼ ç»Ÿæ–¹æ³•ï¼ˆæ¯”å¦‚ Java é‡Œçš„ <code>long</code> ç±»å‹æ•°å­—ï¼‰æ¥è®°å½•æ¯ä¸€ä¸ªç‹¬ç«‹è®¿å®¢çš„ IDã€‚å‡è®¾æœ‰å‡ ç™¾äº¿ä¸ªè®¿å®¢ï¼Œæ¯ä¸ªè®¿å®¢ ID éƒ½éœ€è¦å ç”¨ä¸€å®šçš„å­˜å‚¨ç©ºé—´ï¼ˆæ¯”å¦‚ 8 ä¸ªå­—èŠ‚ï¼‰ã€‚é‚£æ€»å…±éœ€è¦çš„å†…å­˜å°±ä¼šæ˜¯ä¸€ä¸ªå¤©æ–‡æ•°å­—ï¼Œå¯èƒ½æ¯”ä½ ç”µè„‘çš„ç¡¬ç›˜è¿˜è¦å¤§å¾—å¤šï¼è€Œ HyperLogLog åªéœ€è¦å¤§çº¦ 12KB å°±èƒ½æå®šè¿™ä¸ªä¼°ç®—ä»»åŠ¡ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Ÿ</p>
<p>æ‰€ä»¥ï¼Œç®€å•æ¥è¯´ï¼Œå½“ä½ éœ€è¦<strong>å¤§æ¦‚çŸ¥é“æœ‰å¤šå°‘ä¸é‡å¤çš„ä¸œè¥¿ï¼Œè€Œä¸”è¿™äº›ä¸œè¥¿æ•°é‡å·¨å¤§ï¼Œåˆä¸æƒ³å¤ªå å†…å­˜</strong>æ—¶ï¼ŒHyperLogLog å°±æ˜¯ä½ çš„å¥½å¸®æ‰‹ã€‚</p>
<h3 id="å†…éƒ¨å®ç°-2">å†…éƒ¨å®ç°</h3>
<p>HyperLogLog çš„å®ç°æ¶‰åŠåˆ°å¾ˆå¤šæ•°å­¦é—®é¢˜ï¼Œå¤ªè´¹è„‘å­äº†ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ææ‡‚ï¼Œå¦‚æœä½ æƒ³äº†è§£ä¸€ä¸‹ï¼Œè¯¾ä¸‹å¯ä»¥çœ‹çœ‹è¿™ä¸ªï¼š<a href="https://en.wikipedia.org/wiki/HyperLogLog">HyperLogLog</a>ã€‚</p>
<h3 id="å¸¸è§å‘½ä»¤">å¸¸è§å‘½ä»¤</h3>
<p>HyperLogLog å‘½ä»¤å¾ˆå°‘ï¼Œå°±ä¸‰ä¸ªã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­</span></span><br><span class="line">PFADD key element [element ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›ç»™å®š HyperLogLog çš„åŸºæ•°ä¼°ç®—å€¼ã€‚</span></span><br><span class="line">PFCOUNT key [key ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†å¤šä¸ª HyperLogLog åˆå¹¶ä¸ºä¸€ä¸ª HyperLogLog</span></span><br><span class="line">PFMERGE destkey sourcekey [sourcekey ...]</span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨åœºæ™¯-2">åº”ç”¨åœºæ™¯</h3>
<h4 id="ç™¾ä¸‡çº§ç½‘é¡µ-UA-User-Agent-è®¡æ•°">ç™¾ä¸‡çº§ç½‘é¡µ UA (User Agent) è®¡æ•°</h4>
<p>Redis HyperLogLog ä¼˜åŠ¿åœ¨äºåªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªå…ƒç´ çš„åŸºæ•°ï¼Œå’Œå…ƒç´ è¶Šå¤šå°±è¶Šè€—è´¹å†…å­˜çš„ Set å’Œ Hash ç±»å‹ç›¸æ¯”ï¼ŒHyperLogLog å°±éå¸¸èŠ‚çœç©ºé—´ã€‚</p>
<p>æ‰€ä»¥ï¼Œéå¸¸é€‚åˆç»Ÿè®¡ç™¾ä¸‡çº§ä»¥ä¸Šçš„ç½‘é¡µ UA çš„åœºæ™¯ã€‚</p>
<p>åœ¨ç»Ÿè®¡ UA æ—¶ï¼Œä½ å¯ä»¥ç”¨ PFADD å‘½ä»¤ï¼ˆç”¨äºå‘ HyperLogLog ä¸­æ·»åŠ æ–°å…ƒç´ ï¼‰æŠŠè®¿é—®é¡µé¢çš„æ¯ä¸ªç”¨æˆ·éƒ½æ·»åŠ åˆ° HyperLogLog ä¸­ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PFADD page1:ua user1 user2 user3 user4 user5</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç”¨ PFCOUNT å‘½ä»¤ç›´æ¥è·å¾— page1 çš„ UA å€¼äº†ï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨å°±æ˜¯è¿”å› HyperLogLog çš„ç»Ÿè®¡ç»“æœã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PFCOUNT page1:ua</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ï¼Œæœ‰ä¸€ç‚¹éœ€è¦ä½ æ³¨æ„ä¸€ä¸‹ï¼ŒHyperLogLog çš„ç»Ÿè®¡è§„åˆ™æ˜¯åŸºäºæ¦‚ç‡å®Œæˆçš„ï¼Œæ‰€ä»¥å®ƒç»™å‡ºçš„ç»Ÿè®¡ç»“æœæ˜¯æœ‰ä¸€å®šè¯¯å·®çš„ï¼Œæ ‡å‡†è¯¯ç®—ç‡æ˜¯ 0.81%ã€‚</p>
<p>è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œä½ ä½¿ç”¨ HyperLogLog ç»Ÿè®¡çš„ UA æ˜¯ 100 ä¸‡ï¼Œä½†å®é™…çš„ UA å¯èƒ½æ˜¯ 101 ä¸‡ã€‚è™½ç„¶è¯¯å·®ç‡ä¸ç®—å¤§ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ç²¾ç¡®ç»Ÿè®¡ç»“æœçš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯ç»§ç»­ç”¨ Set æˆ– Hash ç±»å‹ã€‚</p>
<h2 id="GEO">GEO</h2>
<p>Redis GEO æ˜¯ Redis 3.2 ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä¸“é—¨ç”¨æ¥å¸®ä½ <strong>å­˜å‚¨å’ŒæŸ¥è¯¢åœ°ç†ä½ç½®ä¿¡æ¯</strong>ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬å¹³æ—¶ç”¨çš„åœ°å›¾è½¯ä»¶ï¼Œæ¯”å¦‚ä½ è¦æ‰¾&quot;æˆ‘é™„è¿‘çš„é¤é¦†&quot;ï¼Œæˆ–è€…æ‰“è½¦è½¯ä»¶å¸®ä½ åŒ¹é…æœ€è¿‘çš„å¸æœºï¼Œè¿™äº›éƒ½ç¦»ä¸å¼€åœ°ç†ä½ç½®æœåŠ¡ï¼ˆæˆ‘ä»¬å¸¸è¯´çš„ LBS - Location-Based Serviceï¼‰ã€‚GEO ç±»å‹å°±æ˜¯ä¸ºäº†æ–¹ä¾¿å®ç°è¿™ç±»åŠŸèƒ½è€Œç”Ÿçš„ã€‚å®ƒå¯ä»¥å¸®ä½ å­˜å‚¨å¾ˆå¤šåœ°ç‚¹ï¼ˆæ¯”å¦‚é¤é¦†ã€è½¦è¾†ã€ç”¨æˆ·ï¼‰çš„ç»åº¦å’Œçº¬åº¦ï¼Œå¹¶ä¸”èƒ½å¿«é€Ÿæ‰¾å‡ºæŸä¸ªåœ°ç‚¹é™„è¿‘çš„å…¶ä»–åœ°ç‚¹ã€‚</p>
<h3 id="å†…éƒ¨å®ç°-3">å†…éƒ¨å®ç°</h3>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼ŒRedis æ˜¯æ€ä¹ˆåšåˆ°è¿™ä¹ˆç¥å¥‡çš„åœ°ç†ä½ç½®å­˜å‚¨å’ŒæŸ¥è¯¢çš„å‘¢ï¼Ÿå®ƒæ˜¯ä¸æ˜¯åˆå‘æ˜äº†ä¸€ç§å…¨æ–°çš„ã€å¤æ‚çš„æ•°æ®ç»“æ„ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼šå¹¶æ²¡æœ‰ï¼GEO ç±»å‹éå¸¸èªæ˜ï¼Œå®ƒ<strong>å·§å¦™åœ°å€Ÿç”¨äº†æˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„ <code>Sorted Set</code>ï¼ˆæœ‰åºé›†åˆï¼‰</strong>.</p>
<p>å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼š</p>
<ol>
<li><strong>GeoHash ç¼–ç </strong>ï¼šé¦–å…ˆï¼Œå¯¹äºæ¯ä¸€ä¸ªåœ°ç†ä½ç½®ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰ï¼ŒGEO ä¼šç”¨ä¸€ç§å«åš â€œGeoHashâ€ çš„æ–¹æ³•ï¼ŒæŠŠè¿™ä¸ªäºŒç»´çš„ç»çº¬åº¦ä¿¡æ¯è½¬æ¢æˆä¸€ä¸ª<strong>ä¸€ç»´çš„æ•°å­—</strong>ï¼ˆä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆç»™åœ°å›¾ä¸Šçš„æ¯ä¸ªå°åŒºåŸŸç¼–äº†ä¸€ä¸ªå·ï¼‰ã€‚è¿™ä¸ªæ•°å­—å°±ä»£è¡¨äº†è¿™ä¸ªä½ç½®æ‰€åœ¨çš„åŒºåŸŸã€‚</li>
<li><strong>å­˜å…¥ Sorted Set</strong>ï¼šç„¶åï¼ŒGEO æŠŠè¿™ä¸ªè½¬æ¢åçš„ä¸€ç»´æ•°å­—ä½œä¸º <code>Sorted Set</code> ä¸­æ¯ä¸ªå…ƒç´ çš„&quot;åˆ†æ•°&quot;ï¼ˆscoreï¼‰ï¼Œè€Œåœ°ç‚¹æœ¬èº«çš„åå­—ï¼ˆæ¯”å¦‚é¤é¦†åã€è½¦è¾†IDï¼‰å°±æ˜¯å…ƒç´ çš„å€¼ã€‚</li>
</ol>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„åœ°ç†ä½ç½®ä¿¡æ¯å°±è¢«è½¬æ¢æˆäº† <code>Sorted Set</code> é‡Œå¸¦ç€åˆ†æ•°çš„å…ƒç´ ã€‚å› ä¸º <code>Sorted Set</code> æœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼Œè€Œä¸”æ”¯æŒæŒ‰ç…§åˆ†æ•°èŒƒå›´æ¥æŸ¥æ‰¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±èƒ½å¾ˆæ–¹ä¾¿åœ°åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥æ‰¾åˆ°æŸä¸ªåˆ†æ•°ï¼ˆä¹Ÿå°±æ˜¯æŸä¸ªåœ°ç†åŒºåŸŸï¼‰é™„è¿‘çš„å…¶ä»–å…ƒç´ äº†ï¼Œä»è€Œå®ç°&quot;æœç´¢é™„è¿‘&quot;çš„åŠŸèƒ½ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œ<strong>GEO å°±æ˜¯ç”¨ GeoHash æŠŠåœ°å›¾ä¸Šçš„ç‚¹&quot;æ‹æ‰&quot;æˆä¸€ç»´çš„æ•°å­—ï¼Œç„¶åç”¨ Sorted Set æ¥ç®¡ç†è¿™äº›æ•°å­—ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„åœ°ç†ä½ç½®æŸ¥è¯¢</strong>ã€‚</p>
<h3 id="å¸¸ç”¨å‘½ä»¤-2">å¸¸ç”¨å‘½ä»¤</h3>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­˜å‚¨æŒ‡å®šçš„åœ°ç†ç©ºé—´ä½ç½®ï¼Œå¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªç»åº¦(longitude)ã€çº¬åº¦(latitude)ã€ä½ç½®åç§°(member)æ·»åŠ åˆ°æŒ‡å®šçš„ key ä¸­ã€‚</span></span><br><span class="line">GEOADD key longitude latitude member [longitude latitude member ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»ç»™å®šçš„ key é‡Œè¿”å›æ‰€æœ‰æŒ‡å®šåç§°(member)çš„ä½ç½®ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰ï¼Œä¸å­˜åœ¨çš„è¿”å› nilã€‚</span></span><br><span class="line">GEOPOS key member [member ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›ä¸¤ä¸ªç»™å®šä½ç½®ä¹‹é—´çš„è·ç¦»ã€‚</span></span><br><span class="line">GEODIST key member1 member2 [m|km|ft|mi]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®ç”¨æˆ·ç»™å®šçš„ç»çº¬åº¦åæ ‡æ¥è·å–æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ä½ç½®é›†åˆã€‚</span></span><br><span class="line">GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]</span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨åœºæ™¯-3">åº”ç”¨åœºæ™¯</h3>
<h4 id="æ»´æ»´å«è½¦">æ»´æ»´å«è½¦</h4>
<p>è¿™é‡Œä»¥æ»´æ»´å«è½¦çš„åœºæ™¯ä¸ºä¾‹ï¼Œä»‹ç»ä¸‹å…·ä½“å¦‚ä½•ä½¿ç”¨ GEO å‘½ä»¤ï¼šGEOADD å’Œ GEORADIUS è¿™ä¸¤ä¸ªå‘½ä»¤ã€‚</p>
<p>å‡è®¾è½¦è¾† ID æ˜¯ 33ï¼Œç»çº¬åº¦ä½ç½®æ˜¯ï¼ˆ116.034579ï¼Œ39.030452ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª GEO é›†åˆä¿å­˜æ‰€æœ‰è½¦è¾†çš„ç»çº¬åº¦ï¼Œé›†åˆ key æ˜¯ cars:locationsã€‚</p>
<p>æ‰§è¡Œä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥æŠŠ ID å·ä¸º 33 çš„è½¦è¾†çš„å½“å‰ç»çº¬åº¦ä½ç½®å­˜å…¥ GEO é›†åˆä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GEOADD cars:locations 116.034579 39.030452 33</span><br></pre></td></tr></table></figure>
<p>å½“ç”¨æˆ·æƒ³è¦å¯»æ‰¾è‡ªå·±é™„è¿‘çš„ç½‘çº¦è½¦æ—¶ï¼ŒLBS åº”ç”¨å°±å¯ä»¥ä½¿ç”¨ GEORADIUS å‘½ä»¤ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒLBS åº”ç”¨æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ—¶ï¼ŒRedis ä¼šæ ¹æ®è¾“å…¥çš„ç”¨æˆ·çš„ç»çº¬åº¦ä¿¡æ¯ï¼ˆ116.054579ï¼Œ39.030452ï¼‰ï¼ŒæŸ¥æ‰¾ä»¥è¿™ä¸ªç»çº¬åº¦ä¸ºä¸­å¿ƒçš„ 5 å…¬é‡Œå†…çš„è½¦è¾†ä¿¡æ¯ï¼Œå¹¶è¿”å›ç»™ LBS åº”ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10</span><br></pre></td></tr></table></figure>
<h2 id="Stream">Stream</h2>
<h3 id="ä»‹ç»-3">ä»‹ç»</h3>
<p>Redis Stream æ˜¯ Redis 5.0 ç‰ˆæœ¬ä¸“é—¨ä¸º&quot;<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>&quot;é‡èº«æ‰“é€ çš„ä¸€ç§æ–°æ•°æ®ç±»å‹ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—å‘¢ï¼Ÿ</strong></p>
<p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ª<strong>æ™ºèƒ½çš„å…¬å‘Šæ¿æˆ–è€…ä»»åŠ¡æ¸…å•</strong>ã€‚æœ‰äººï¼ˆç”Ÿäº§è€…ï¼‰å¾€ä¸Šé¢è´´æ¡å­ï¼ˆå‘å¸ƒæ¶ˆæ¯ï¼‰ï¼Œå¦å¤–ä¸€äº›äººï¼ˆæ¶ˆè´¹è€…ï¼‰åˆ™ä»å…¬å‘Šæ¿ä¸Šå–æ¡å­å»å¤„ç†ï¼ˆæ¶ˆè´¹æ¶ˆæ¯ï¼‰ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ Streamï¼Ÿ</strong></p>
<p>åœ¨ Stream å‡ºç°ä¹‹å‰ï¼Œå¤§å®¶ä¹Ÿå°è¯•ç”¨ Redis çš„å…¶ä»–åŠŸèƒ½ï¼ˆæ¯”å¦‚ <code>List</code> æˆ–è€…å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰æ¥æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†å®ƒä»¬éƒ½æœ‰ä¸€äº›å¤©ç”Ÿçš„&quot;å°æ¯›ç—…&quot;ï¼š</p>
<ul>
<li><strong>å‘å¸ƒè®¢é˜…æ¨¡å¼</strong>ï¼šè¿™ç§æ¨¡å¼åƒä¸ª&quot;å¹¿æ’­&quot;ï¼Œæ¶ˆæ¯å‘å‡ºå»äº†å°±æ²¡äº†ï¼Œ<strong>ä¸èƒ½ä¿å­˜</strong>ã€‚å¦‚æœæŸä¸ªæ¶ˆè´¹è€…å½“æ—¶ä¸åœ¨çº¿ï¼Œå®ƒå°±é”™è¿‡äº†è¿™äº›æ¶ˆæ¯ï¼Œä¹‹åä¹Ÿæ‰¾ä¸å›æ¥ã€‚</li>
<li><strong><code>List</code> ç±»å‹</strong>ï¼šç”¨ <code>List</code> æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯å€’æ˜¯èƒ½å­˜ä¸‹æ¥ã€‚ä½†æ˜¯ï¼Œä¸€æ¡æ¶ˆæ¯è¢«ä¸€ä¸ªæ¶ˆè´¹è€…å–èµ°åï¼Œåˆ«çš„æ¶ˆè´¹è€…å°±çœ‹ä¸åˆ°äº†ï¼ˆ<strong>ä¸èƒ½é‡å¤æ¶ˆè´¹</strong>ï¼‰ã€‚è€Œä¸”ï¼Œè°å…ˆå‘æ¶ˆæ¯è°åå‘æ¶ˆæ¯ï¼Œè¿™ä¸ªé¡ºåºçš„ç®¡ç†ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œç”Ÿäº§è€…éœ€è¦è‡ªå·±æƒ³åŠæ³•ç»™æ¯æ¡æ¶ˆæ¯ç¼–ä¸ªå·ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒStream æ¨ªç©ºå‡ºä¸–ï¼å®ƒå°±åƒä¸€ä¸ª<strong>è¶…çº§å¢å¼ºç‰ˆçš„æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œæ‹¥æœ‰å¾ˆå¤šé«˜çº§åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼šæ¶ˆæ¯ä¼šè¢«ç¨³ç¨³åœ°å­˜èµ·æ¥ï¼Œä¸ç”¨æ‹…å¿ƒä¸¢äº†ã€‚</li>
<li><strong>è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ID</strong>ï¼šæ¯æ¡æ¶ˆæ¯éƒ½ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–å·ï¼Œç®¡ç†èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚</li>
<li><strong>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆACKï¼‰</strong>ï¼šæ¶ˆè´¹è€…æ‹¿åˆ°æ¶ˆæ¯å¤„ç†å®Œåï¼Œå¯ä»¥å‘Šè¯‰ Stream â€œæˆ‘æå®šäº†ï¼â€ï¼Œè¿™æ · Stream æ‰çŸ¥é“è¿™æ¡æ¶ˆæ¯è¢«æˆåŠŸå¤„ç†äº†ã€‚</li>
<li><strong>æ¶ˆè´¹ç»„æ¨¡å¼</strong>ï¼šè¿™æ˜¯ Stream çš„ä¸€å¤§äº®ç‚¹ï¼å…è®¸å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆä¸€ä¸ª&quot;å°ç»„&quot;ï¼Œå…±åŒæ¥å¤„ç†æ¶ˆæ¯ã€‚ä¸€ä¸ªå°ç»„é‡Œçš„æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªæˆå‘˜é¢†èµ°ï¼Œé¿å…äº†é‡å¤åŠ³åŠ¨ã€‚è€Œä¸”ï¼Œä¸åŒçš„å°ç»„å¯ä»¥ç‹¬ç«‹æ¶ˆè´¹åŒæ ·çš„æ¶ˆæ¯ï¼Œäº’ä¸å½±å“ã€‚</li>
</ul>
<p>æœ‰äº†è¿™äº›ç‰¹æ€§ï¼Œç”¨ Stream æ¥åšæ¶ˆæ¯é˜Ÿåˆ—å°±å˜å¾—éå¸¸<strong>ç¨³å®šå’Œå¯é </strong>äº†ã€‚</p>
<h3 id="å¸¸è§å‘½ä»¤-2">å¸¸è§å‘½ä»¤</h3>
<p>Stream æ¶ˆæ¯é˜Ÿåˆ—æ“ä½œå‘½ä»¤ï¼š</p>
<ul>
<li>XADDï¼šæ’å…¥æ¶ˆæ¯ï¼Œä¿è¯æœ‰åºï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€ IDï¼›</li>
<li>XLENï¼šæŸ¥è¯¢æ¶ˆæ¯é•¿åº¦ï¼›</li>
<li>XREADï¼šç”¨äºè¯»å–æ¶ˆæ¯ï¼Œå¯ä»¥æŒ‰ ID è¯»å–æ•°æ®ï¼›</li>
<li>XDELï¼šæ ¹æ®æ¶ˆæ¯ ID åˆ é™¤æ¶ˆæ¯ï¼›</li>
<li>DELï¼šåˆ é™¤æ•´ä¸ª Streamï¼›</li>
<li>XRANGEï¼šè¯»å–åŒºé—´æ¶ˆæ¯</li>
<li>XREADGROUPï¼šæŒ‰æ¶ˆè´¹ç»„å½¢å¼è¯»å–æ¶ˆæ¯ï¼›</li>
<li>XPENDING å’Œ XACKï¼š
<ul>
<li>XPENDING å‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥è¯¢æ¯ä¸ªæ¶ˆè´¹ç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…ã€Œå·²è¯»å–ã€ä½†å°šæœªç¡®è®¤ã€çš„æ¶ˆæ¯ï¼›</li>
<li>XACK å‘½ä»¤ç”¨äºå‘æ¶ˆæ¯é˜Ÿåˆ—ç¡®è®¤æ¶ˆæ¯å¤„ç†å·²å®Œæˆï¼›</li>
</ul>
</li>
</ul>
<h3 id="åº”ç”¨åœºæ™¯-4">åº”ç”¨åœºæ™¯</h3>
<h4 id="æ¶ˆæ¯é˜Ÿåˆ—">æ¶ˆæ¯é˜Ÿåˆ—</h4>
<p>ç”Ÿäº§è€…ï¼ˆå‘æ¶ˆæ¯çš„äººï¼‰ç”¨ <code>XADD</code> å‘½ä»¤æŠŠä¸€æ¡æ¶ˆæ¯æ”¾è¿›é˜Ÿåˆ—ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œçš„ * å·è¡¨ç¤ºè®© Redis è‡ªåŠ¨ç»™è¿™æ¡æ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ ID</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„æ€æ˜¯ï¼šå¾€ä¸€ä¸ªå«åš mymq çš„æ¶ˆæ¯é˜Ÿåˆ—é‡Œï¼Œæ”¾ä¸€æ¡å†…å®¹æ˜¯ name=xiaolin çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XADD mymq * name xiaolin</span></span><br><span class="line">&quot;1654254953808-0&quot; # è¿™æ˜¯ Redis è¿”å›çš„æ¶ˆæ¯ ID</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè¿”å›çš„ ID å¾ˆç‰¹åˆ«ï¼Œå®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†ï¼ˆä¾‹å¦‚ <code>1654254953808</code>ï¼‰ï¼šæ˜¯æ¶ˆæ¯è¢«å­˜å…¥æ—¶ï¼ŒæœåŠ¡å™¨çš„æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰ã€‚</li>
<li>ç¬¬äºŒéƒ¨åˆ†ï¼ˆä¾‹å¦‚ <code>0</code>ï¼‰ï¼šè¡¨ç¤ºåœ¨åŒä¸€æ¯«ç§’å†…ï¼Œè¿™æ¡æ¶ˆæ¯æ˜¯ç¬¬å‡ æ¡ï¼ˆä»0å¼€å§‹æ•°ï¼‰ã€‚</li>
</ul>
<p>æ¶ˆè´¹è€…ï¼ˆå¤„ç†æ¶ˆæ¯çš„äººï¼‰ç”¨ <code>XREAD</code> å‘½ä»¤æ¥è¯»æ¶ˆæ¯ã€‚ä½ å¯ä»¥å‘Šè¯‰å®ƒä»å“ªä¸ª ID å¼€å§‹è¯»ï¼Œå®ƒå°±ä¼šæŠŠé‚£ä¸ª ID ä¹‹åçš„æ–°æ¶ˆæ¯éƒ½ç»™ä½ ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œæ¶ˆè´¹è€…åªéœ€è¦è®°ä½ä¸Šæ¬¡è¯»åˆ°å“ªé‡Œï¼Œä¸‹æ¬¡å°±èƒ½æ¥ç€è¯»ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä» ID å·ä¸º 1654254953807-0 çš„æ¶ˆæ¯ä¹‹åå¼€å§‹è¯»å–ï¼Œè¿”å›æ‰€æœ‰æ›´æ–°çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XREAD STREAMS mymq 1654254953807-0</span></span><br><span class="line">1) 1) &quot;mymq&quot;</span><br><span class="line">   2) 1) 1) &quot;1654254953808-0&quot; # æ¶ˆæ¯ID</span><br><span class="line">         2) 1) &quot;name&quot;      # æ¶ˆæ¯å†…å®¹</span><br><span class="line">            2) &quot;xiaolin&quot;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¸Œæœ›<strong>æ²¡æœ‰æ–°æ¶ˆæ¯æ—¶ï¼Œè®© <code>XREAD</code> å‘½ä»¤å…ˆåˆ«æ€¥ç€è¿”å›ï¼Œè€Œæ˜¯ç­‰ä¸€ä¼šå„¿</strong>ï¼ˆæ¯”å¦‚ç­‰å‡ ç§’é’Ÿï¼‰ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ–°æ¶ˆæ¯è¿›æ¥ï¼Œå¯ä»¥åŠ ä¸Š <code>BLOCK</code> å‚æ•°ã€‚è¿™å°±åƒä½ å»çª—å£åŠäº‹ï¼Œå¦‚æœæš‚æ—¶æ²¡äººï¼Œä½ ä¼šç­‰ä¸€ä¸‹è€Œä¸æ˜¯ç«‹åˆ»ç¦»å¼€ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘½ä»¤æœ€åçš„<span class="string">&quot;$&quot;</span>ç¬¦å·è¡¨ç¤ºæˆ‘æƒ³è¯»å–æœ€æ–°çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BLOCK 10000 è¡¨ç¤ºå¦‚æœæ²¡æœ‰æ–°æ¶ˆæ¯ï¼Œå°±é˜»å¡ç­‰å¾…10000æ¯«ç§’ï¼ˆ10ç§’ï¼‰</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XREAD BLOCK 10000 STREAMS mymq $</span></span><br><span class="line">(nil) # 10ç§’å†…æ²¡æœ‰æ–°æ¶ˆæ¯ï¼Œå°±è¿”å›ç©º</span><br><span class="line">(10.00s)</span><br></pre></td></tr></table></figure>
<p>ç”¨ <code>XADD</code> å‘æ¶ˆæ¯ï¼Œç”¨ <code>XREAD</code> æ”¶æ¶ˆæ¯ï¼Œè¿™æ ·æœ€åŸºæœ¬çš„æ¶ˆæ¯é˜Ÿåˆ—å°±æ­èµ·æ¥äº†ã€‚æµç¨‹å°±åƒä¸‹é¢è¿™å¼ å›¾ï¼š</p>
<p><img src="/2025/05/14/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Other/1747324335058.png" alt="1747324335058"></p>
<blockquote>
<p>å‰é¢è¿™äº›åŸºæœ¬æ“ä½œï¼Œç”¨ <code>List</code> å…¶å®ä¹Ÿèƒ½å‹‰å¼ºåšåˆ°ã€‚Stream çœŸæ­£çš„å‰å®³ä¹‹å¤„åœ¨äºå®ƒçš„&quot;æ¶ˆè´¹ç»„&quot;åŠŸèƒ½ã€‚</p>
</blockquote>
<p>Stream å¯ä»¥ç”¨ <strong><code>XGROUP CREATE</code> åˆ›å»ºæ¶ˆè´¹ç»„</strong>ã€‚åˆ›å»ºäº†æ¶ˆè´¹ç»„ä¹‹åï¼Œå°±å¯ä»¥ç”¨ <code>XREADGROUP</code> å‘½ä»¤è®©ç»„é‡Œçš„æ¶ˆè´¹è€…æ¥è¯»æ¶ˆæ¯äº†ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåå« <code>group1</code> çš„æ¶ˆè´¹ç»„ï¼Œè®©å®ƒä»æ¶ˆæ¯é˜Ÿåˆ— <code>mymq</code> çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼ˆç”¨ <code>0-0</code> è¡¨ç¤ºï¼‰å¼€å§‹è¯»ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªåä¸º group1 çš„æ¶ˆè´¹ç»„ï¼Œ0-0 è¡¨ç¤ºä»ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹è¯»å–ã€‚</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XGROUP CREATE mymq group1 0-0</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒæ ·ï¼Œå†åˆ›å»ºä¸€ä¸ª group2</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XGROUP CREATE mymq group2 0-0</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œ<code>group1</code> é‡Œçš„ä¸€ä¸ªæ¶ˆè´¹è€… <code>consumer1</code> å¯ä»¥è¿™æ ·æ¥è¯»æ¶ˆæ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘½ä»¤æœ€åçš„å‚æ•°<span class="string">&quot;&gt;&quot;</span>ï¼Œè¡¨ç¤ºæˆ‘æƒ³ä»ç¬¬ä¸€æ¡<span class="string">&quot;è¿˜æ²¡æœ‰è¢«ç»„é‡Œå…¶ä»–æ¶ˆè´¹è€…æ‹¿èµ°&quot;</span>çš„æ¶ˆæ¯å¼€å§‹è¯»ã€‚</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XREADGROUP GROUP group1 consumer1 STREAMS mymq &gt;</span></span><br><span class="line">1) 1) &quot;mymq&quot;</span><br><span class="line">   2) 1) 1) &quot;1654254953808-0&quot;</span><br><span class="line">         2) 1) &quot;name&quot;</span><br><span class="line">            2) &quot;xiaolin&quot;</span><br></pre></td></tr></table></figure>
<p><strong>é‡ç‚¹æ¥äº†ï¼šåŒä¸€ä¸ªæ¶ˆè´¹ç»„é‡Œçš„æ¶ˆæ¯ï¼Œä¸€æ—¦è¢«ä¸€ä¸ªæ¶ˆè´¹è€…å–èµ°äº†ï¼Œç»„é‡Œçš„å…¶ä»–æ¶ˆè´¹è€…å°±æ‹¿ä¸åˆ°äº†ã€‚</strong> è¿™ç¡®ä¿äº†åŒä¸€æ¡æ¶ˆæ¯ä¸ä¼šè¢«åŒä¸€ä¸ªå°ç»„çš„äººé‡å¤å¤„ç†ã€‚</p>
<p>æ¯”å¦‚ï¼Œ<code>consumer1</code> åˆšè¯»äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚æœå®ƒå†ç”¨åŒæ ·çš„å‘½ä»¤å»è¯»ï¼Œå°±ä¼šå‘ç°æ²¡æ–°æ¶ˆæ¯äº†ï¼ˆé™¤éé˜Ÿåˆ—é‡Œåˆæ¥äº†åˆ«çš„æœªè¢«è¯»å–çš„æ¶ˆæ¯ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XREADGROUP GROUP group1 consumer1 STREAMS mymq &gt;</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œ<strong>ä¸åŒæ¶ˆè´¹ç»„ä¹‹é—´æ˜¯ç‹¬ç«‹çš„</strong>ã€‚å¦‚æœå®ƒä»¬éƒ½è®¾ç½®äº†ä»åŒä¸€ä¸ªåœ°æ–¹å¼€å§‹è¯»æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½å¯ä»¥è¯»åˆ°ç›¸åŒçš„æ¶ˆæ¯ã€‚</p>
<p>æ¯”å¦‚ï¼Œåˆšæ‰ <code>group1</code> çš„ <code>consumer1</code> è¯»äº† <code>1654254953808-0</code> è¿™æ¡æ¶ˆæ¯ã€‚ç°åœ¨æˆ‘ä»¬è®© <code>group2</code> é‡Œçš„ <code>consumer1</code> (æ³¨æ„ï¼Œè¿™æ˜¯å¦ä¸€ä¸ªç»„çš„åŒåæ¶ˆè´¹è€…ï¼Œæˆ–è€…ä¸åŒåçš„æ¶ˆè´¹è€…éƒ½è¡Œ) å»è¯»ï¼Œå®ƒä¹Ÿèƒ½è¯»åˆ°è¿™æ¡æ¶ˆæ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XREADGROUP GROUP group2 consumer1 STREAMS mymq &gt;</span></span><br><span class="line">1) 1) &quot;mymq&quot;</span><br><span class="line">   2) 1) 1) &quot;1654254953808-0&quot;</span><br><span class="line">         2) 1) &quot;name&quot;</span><br><span class="line">            2) &quot;xiaolin&quot;</span><br></pre></td></tr></table></figure>
<p>æ¶ˆè´¹ç»„çš„ä¸»è¦ç›®çš„å°±æ˜¯è®©ç»„é‡Œçš„å¤šä¸ªæ¶ˆè´¹è€…<strong>åˆ†å·¥åˆä½œï¼Œå…±åŒå¤„ç†æ¶ˆæ¯</strong>ï¼Œæé«˜æ•ˆç‡ã€‚é€šå¸¸æˆ‘ä»¬ä¼šè®©æ¯ä¸ªæ¶ˆè´¹è€…é¢†ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®© <code>group2</code> é‡Œçš„ä¸‰ä¸ªæ¶ˆè´¹è€… <code>consumer1</code>ã€<code>consumer2</code>ã€<code>consumer3</code> å„è‡ªå»é¢†ä¸€æ¡æ¶ˆæ¯æ¥å¤„ç†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®© group2 çš„ consumer1 é¢†ä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XREADGROUP GROUP group2 consumer1 COUNT 1 STREAMS mymq &gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">... (consumer1 é¢†åˆ°çš„æ¶ˆæ¯)</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®© group2 çš„ consumer2 é¢†ä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XREADGROUP GROUP group2 consumer2 COUNT 1 STREAMS mymq &gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">... (consumer2 é¢†åˆ°çš„æ¶ˆæ¯)</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®© group2 çš„ consumer3 é¢†ä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XREADGROUP GROUP group2 consumer3 COUNT 1 STREAMS mymq &gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">... (consumer3 é¢†åˆ°çš„æ¶ˆæ¯)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå¦‚æœä¸€ä¸ªæ¶ˆè´¹è€…é¢†äº†æ¡æ¶ˆæ¯ï¼Œä½†å®ƒè‡ªå·±å¤„ç†çš„æ—¶å€™å‡ºé”™äº†ï¼ˆæ¯”å¦‚ç¨‹åºå´©äº†ï¼‰ï¼Œé‚£è¿™æ¡æ¶ˆæ¯ä¸å°±ä¸¢äº†å—ï¼ŸStream æ˜¯æ€ä¹ˆä¿è¯æ¶ˆæ¯è¢«å¯é å¤„ç†çš„å‘¢ï¼Ÿ</p>
</blockquote>
<p>è¿™å°±æ˜¯ Stream çš„<strong>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong>å’Œ <strong>Pending Listï¼ˆå¾…å¤„ç†åˆ—è¡¨ï¼‰</strong> çš„ä½œç”¨äº†ã€‚</p>
<p>å½“ä¸€ä¸ªæ¶ˆè´¹è€…é€šè¿‡ <code>XREADGROUP</code> æ‹¿åˆ°æ¶ˆæ¯åï¼ŒStream ä¼šé»˜é»˜åœ°æŠŠè¿™äº›&quot;å·²è¢«è®¤é¢†ä½†è¿˜æ²¡è¯´å¤„ç†å®Œ&quot;çš„æ¶ˆæ¯è®°å½•åœ¨ä¸€ä¸ªå†…éƒ¨çš„&quot;<strong>å¾…å¤„ç†åˆ—è¡¨</strong>&quot;ï¼ˆPending Listï¼‰é‡Œã€‚åªæœ‰å½“æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯ï¼Œå¹¶ä¸”æ˜ç¡®åœ°ç”¨ <code>XACK</code> å‘½ä»¤å‘Šè¯‰ Stream &quot;è¿™æ¡æ¶ˆæ¯æˆ‘å¤„ç†å¥½äº†ï¼&quot;ä¹‹åï¼ŒStream æ‰ä¼šè®¤ä¸ºè¿™æ¡æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹äº†ï¼Œç„¶åä» Pending List é‡Œç§»é™¤å®ƒã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹å°±åƒè¿™æ ·ï¼š</p>
<p><img src="/2025/05/14/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Other/1747324344772.png" alt="1747324344772"></p>
<p>å¦‚æœæ¶ˆè´¹è€…æ‹¿äº†æ¶ˆæ¯ä½†ä¸€ç›´æ²¡å‘ <code>XACK</code>ï¼ˆæ¯”å¦‚å› ä¸ºå®ƒè‡ªå·±å‡ºæ•…éšœäº†ï¼‰ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å°±ä¼šä¸€ç›´å¾…åœ¨ Pending List é‡Œã€‚å½“è¿™ä¸ªæ¶ˆè´¹è€…æ¢å¤åï¼ˆæˆ–è€…å…¶ä»–å¤‡ç”¨æ¶ˆè´¹è€…ä»‹å…¥æ—¶ï¼‰ï¼Œå¯ä»¥ç”¨ <code>XPENDING</code> å‘½ä»¤æ¥æŸ¥çœ‹å“ªäº›æ¶ˆæ¯æ˜¯&quot;ä¹‹å‰é¢†äº†ä½†è¿˜æ²¡ç¡®è®¤å¤„ç†å®Œçš„&quot;ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹ <code>group2</code> é‡Œï¼Œæ‰€æœ‰æ¶ˆè´¹è€…åŠ èµ·æ¥æ€»å…±æœ‰å¤šå°‘æ¡&quot;å¾…å¤„ç†&quot;çš„æ¶ˆæ¯ï¼Œä»¥åŠè¿™äº›æ¶ˆæ¯çš„ ID èŒƒå›´ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; XPENDING mymq group2</span><br><span class="line">1) (integer) 3 # æ€»å…±æœ‰3æ¡å¾…å¤„ç†æ¶ˆæ¯</span><br><span class="line">2) &quot;1654254953808-0&quot;  # è¿™äº›å¾…å¤„ç†æ¶ˆæ¯ä¸­ï¼ŒIDæœ€å°çš„é‚£ä¸ª</span><br><span class="line">3) &quot;1654256271337-0&quot;  # è¿™äº›å¾…å¤„ç†æ¶ˆæ¯ä¸­ï¼ŒIDæœ€å¤§çš„é‚£ä¸ª</span><br><span class="line">4) 1) 1) &quot;consumer1&quot;   # consumer1 æœ‰å‡ æ¡å¾…å¤„ç†çš„</span><br><span class="line">      1) &quot;1&quot;</span><br><span class="line">   1) 1) &quot;consumer2&quot;   # consumer2 æœ‰å‡ æ¡å¾…å¤„ç†çš„</span><br><span class="line">      1) &quot;1&quot;</span><br><span class="line">   2) 1) &quot;consumer3&quot;   # consumer3 æœ‰å‡ æ¡å¾…å¤„ç†çš„</span><br><span class="line">      1) &quot;1&quot;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³çœ‹æŸä¸ªæ¶ˆè´¹è€…ï¼ˆæ¯”å¦‚ <code>consumer2</code>ï¼‰å…·ä½“æœ‰å“ªäº›å¾…å¤„ç†çš„æ¶ˆæ¯ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ group2 é‡Œçš„ consumer2 æœ‰å“ªäº›å¾…å¤„ç†çš„æ¶ˆæ¯ï¼ˆæœ€å¤šçœ‹10æ¡ï¼Œä»æœ€æ—©çš„å¼€å§‹ï¼‰</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XPENDING mymq group2 - + 10 consumer2</span></span><br><span class="line">1) 1) &quot;1654256265584-0&quot;   # æ¶ˆæ¯ID</span><br><span class="line">   2) &quot;consumer2&quot;       # å“ªä¸ªæ¶ˆè´¹è€…é¢†çš„</span><br><span class="line">   3) (integer) 410700  # è¿™æ¡æ¶ˆæ¯è¢«è®¤é¢†åï¼Œç©ºé—²äº†å¤šä¹…ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line">   4) (integer) 1         # è¿™æ¡æ¶ˆæ¯è¢«ä¼ é€’äº†å‡ æ¬¡ï¼ˆå¦‚æœå‘ç”Ÿè¿‡é‡æ–°è®¤é¢†ï¼‰</span><br></pre></td></tr></table></figure>
<p>ä¸€æ—¦ <code>consumer2</code> æŠŠæ¶ˆæ¯ <code>1654256265584-0</code> å¤„ç†å®Œäº†ï¼Œå®ƒå°±åº”è¯¥ç”¨ <code>XACK</code> å‘½ä»¤å‘Šè¯‰ Streamï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XACK mymq group2 1654256265584-0</span></span><br><span class="line">(integer) 1 # è¡¨ç¤ºæˆåŠŸç¡®è®¤äº†1æ¡æ¶ˆæ¯</span><br></pre></td></tr></table></figure>
<p>ä¹‹åå†ç”¨ <code>XPENDING</code> å»æŸ¥ <code>consumer2</code>ï¼Œå°±ä¼šå‘ç°å®ƒæ²¡æœ‰å¾…å¤„ç†çš„æ¶ˆæ¯äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">XPENDING mymq group2 - + 10 consumer2</span></span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œå…³äº Stream å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„å…³é”®ç‚¹å°ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li><strong>ä¿è¯æ¶ˆæ¯é¡ºåº</strong>ï¼šç”¨ <code>XADD</code> æ·»åŠ ï¼ŒID æœ¬èº«å°±å¸¦æœ‰æ—¶é—´æˆ³å’Œåºå·ã€‚</li>
<li><strong>å¯ä»¥é˜»å¡ç­‰å¾…æ–°æ¶ˆæ¯</strong>ï¼š<code>XREAD</code> æˆ– <code>XREADGROUP</code> åŠ ä¸Š <code>BLOCK</code> å‚æ•°ã€‚</li>
<li><strong>é¿å…é‡å¤æ¶ˆæ¯</strong>ï¼š<code>XADD</code> è‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€ IDã€‚</li>
<li><strong>ä¿è¯æ¶ˆæ¯å¯é æ€§</strong>ï¼šé€šè¿‡æ¶ˆè´¹ç»„ã€Pending List å’Œ <code>XACK</code> ç¡®è®¤æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯è‡³å°‘è¢«æˆåŠŸå¤„ç†ä¸€æ¬¡ã€‚</li>
<li><strong>æ”¯æŒæ¶ˆè´¹ç»„ååŒå·¥ä½œ</strong>ï¼šå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥ä¸€èµ·å¹²æ´»ï¼Œæé«˜æ•ˆç‡ã€‚</li>
</ul>
<blockquote>
<p>Redis Stream è¿™ä¹ˆå‰å®³ï¼Œé‚£å®ƒå’Œé‚£äº›ä¸“ä¸šçš„&quot;æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶&quot;ï¼ˆæ¯”å¦‚ Kafkaã€RabbitMQï¼‰æ¯”èµ·æ¥æ€ä¹ˆæ ·å‘¢ï¼Ÿ</p>
</blockquote>
<p>ä¸€ä¸ªä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€šå¸¸è¦é‡ç‚¹è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><strong>æ¶ˆæ¯ä¸èƒ½ä¸¢</strong>ã€‚</li>
<li><strong>æ¶ˆæ¯èƒ½å¤§é‡å †ç§¯</strong>ï¼ˆæ¯”å¦‚ç”Ÿäº§è€…å‘å¾—å¾ˆå¿«ï¼Œæ¶ˆè´¹è€…å¤„ç†å¾—æ…¢ï¼Œæ¶ˆæ¯ä¸èƒ½å› ä¸ºå †å¤ªå¤šè€Œä¸¢äº†ï¼‰ã€‚</li>
</ol>
<p><em>1ã€Redis Stream çš„æ¶ˆæ¯ä¼šä¸¢å¤±å—ï¼Ÿ</em></p>
<p>ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹åŒ…æ‹¬ä¸‰ä¸ªç¯èŠ‚ï¼š<strong>ç”Ÿäº§è€…å‘æ¶ˆæ¯ -&gt; æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶å­˜æ¶ˆæ¯ -&gt; æ¶ˆè´¹è€…æ”¶æ¶ˆæ¯</strong>ã€‚</p>
<p><img src="/2025/05/14/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Other/1747324361948.png" alt="1747324361948"></p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ Redis Stream åœ¨è¿™ä¸‰ä¸ªç¯èŠ‚çš„è¡¨ç°ï¼š</p>
<ul>
<li><strong>ç”Ÿäº§è€…å‘æ¶ˆæ¯ä¼šä¸ä¼šä¸¢ï¼Ÿ</strong> è¿™ä¸ªä¸»è¦çœ‹ç”Ÿäº§è€…ç¨‹åºå†™å¾—å¥½ä¸å¥½ã€‚å¦‚æœç”Ÿäº§è€…å‘å®Œæ¶ˆæ¯åï¼Œèƒ½æ­£ç¡®æ£€æŸ¥ Stream è¿”å›çš„ç¡®è®¤ï¼ˆè¡¨ç¤º Stream å·²ç»æ”¶åˆ°ï¼‰ï¼Œå¹¶ä¸”åœ¨å‡ºé”™æ—¶èƒ½é‡æ–°å‘é€ï¼Œé‚£ä¹ˆè¿™ä¸ªç¯èŠ‚ä¸€èˆ¬ä¸ä¼šä¸¢æ¶ˆæ¯ã€‚</li>
<li><strong>æ¶ˆè´¹è€…æ”¶æ¶ˆæ¯ä¼šä¸ä¼šä¸¢ï¼Ÿ</strong> ä¸€èˆ¬ä¹Ÿä¸ä¼šã€‚å› ä¸º Stream æœ‰ Pending List å’Œ <code>XACK</code> ç¡®è®¤æœºåˆ¶ã€‚æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯æ‰å‘ç¡®è®¤ï¼Œå¦‚æœä¸­é€”æŒ‚äº†ï¼Œæ¶ˆæ¯è¿˜åœ¨ Pending List é‡Œï¼Œé‡å¯åå¯ä»¥ç»§ç»­å¤„ç†ã€‚</li>
<li><strong>æ¶ˆæ¯åœ¨ Streamï¼ˆä¹Ÿå°±æ˜¯ Redis è‡ªå·±ä½œä¸ºä¸­é—´ä»¶ï¼‰é‡Œä¼šä¸ä¼šä¸¢ï¼Ÿ</strong> <strong>è¿™ä¸ªæ˜¯æœ‰å¯èƒ½çš„ï¼</strong> ä¸»è¦åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼š
<ul>
<li>å¦‚æœ Redis çš„æŒä¹…åŒ–ç­–ç•¥ï¼ˆæ¯”å¦‚ AOFï¼‰é…ç½®æˆæ¯ç§’å†™ä¸€æ¬¡ç¡¬ç›˜ï¼Œé‚£ä¹ˆåœ¨ä¸¤æ¬¡å†™ç›˜é—´éš”å†…å¦‚æœ Redis çªç„¶æŒ‚äº†ï¼Œè¿™ä¸€ç§’å†…æ”¶åˆ°çš„æ¶ˆæ¯å°±å¯èƒ½ä¸¢äº†ã€‚</li>
<li>å¦‚æœ Redis åšäº†ä¸»ä»å¤åˆ¶ï¼Œä½†å¤åˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œé‚£ä¹ˆåœ¨ä¸»èŠ‚ç‚¹æŒ‚äº†ã€ä»èŠ‚ç‚¹è¿˜æ²¡åŒæ­¥å®Œæ•°æ®çš„æ—¶å€™åˆ‡æ¢ï¼Œä¹Ÿå¯èƒ½ä¸¢ä¸€éƒ¨åˆ†æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<strong>åœ¨&quot;ä¸­é—´ä»¶&quot;è¿™ä¸ªç¯èŠ‚ï¼ŒRedis Stream æœ¬èº«å¹¶ä¸èƒ½åƒä¸“ä¸šæ¶ˆæ¯é˜Ÿåˆ—é‚£æ ·åšåˆ°ç»å¯¹ä¸ä¸¢æ¶ˆæ¯</strong>ã€‚ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaï¼‰é€šå¸¸ä¼šæŠŠæ¶ˆæ¯å†™åˆ°é›†ç¾¤é‡Œçš„å¤šä¸ªèŠ‚ç‚¹ï¼ˆå¤šä¸ªå‰¯æœ¬ï¼‰ï¼Œä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ä¹Ÿä¸å½±å“æ•°æ®ã€‚</p>
<p><em>2ã€Redis Stream æ¶ˆæ¯èƒ½å¤§é‡å †ç§¯å—ï¼Ÿ</em></p>
<p>Redis çš„æ•°æ®ä¸»è¦æ˜¯å­˜åœ¨å†…å­˜é‡Œçš„ã€‚å¦‚æœæ¶ˆæ¯äº§ç”Ÿå¾—éå¸¸å¿«ï¼Œæ¶ˆè´¹å´å¾ˆæ…¢ï¼Œå¯¼è‡´å¤§é‡æ¶ˆæ¯å †ç§¯åœ¨ Stream é‡Œï¼Œå°±ä¼šä¸æ–­æ¶ˆè€— Redis çš„å†…å­˜ã€‚å¦‚æœå†…å­˜è€—å°½ï¼ŒRedis å°±å¯èƒ½å´©æºƒï¼ˆOOMï¼‰ã€‚</p>
<p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒStream å…è®¸ä½ è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚è¶…è¿‡è¿™ä¸ªé•¿åº¦åï¼Œè€çš„æ¶ˆæ¯å°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œåªä¿ç•™æœ€æ–°çš„æ¶ˆæ¯ã€‚è¿™æ ·è™½ç„¶èƒ½é˜²æ­¢å†…å­˜çˆ†ç‚¸ï¼Œä½†ä¹Ÿæ„å‘³ç€<strong>åœ¨æ¶ˆæ¯ä¸¥é‡å †ç§¯æ—¶ï¼ŒStream å¯èƒ½ä¼šä¸»åŠ¨ä¸¢å¼ƒè€æ¶ˆæ¯</strong>ã€‚</p>
<p>è€Œä¸“ä¸šçš„ Kafkaã€RabbitMQ é€šå¸¸æŠŠæ¶ˆæ¯å­˜åœ¨ç£ç›˜ä¸Šï¼Œç£ç›˜ç©ºé—´ä¸€èˆ¬æ¯”å†…å­˜å¤§å¾—å¤šï¼Œæ‰€ä»¥å®ƒä»¬æ›´èƒ½æŠ—ä½å¤§é‡çš„æ¶ˆæ¯å †ç§¯ã€‚</p>
<p>å› æ­¤ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œç”¨ Redis Stream åšæ¶ˆæ¯é˜Ÿåˆ—æ—¶è¦æ³¨æ„ï¼š</p>
<ul>
<li><strong>Redis è‡ªèº«çš„åŸå› ï¼ˆæŒä¹…åŒ–ã€ä¸»ä»åˆ‡æ¢ï¼‰å¯èƒ½å¯¼è‡´å°‘é‡æ•°æ®ä¸¢å¤±ã€‚</strong></li>
<li><strong>æ¶ˆæ¯å¤§é‡å †ç§¯æ—¶ï¼Œå†…å­˜å¯èƒ½æˆä¸ºç“¶é¢ˆï¼Œå¹¶å¯èƒ½å¯¼è‡´è€æ¶ˆæ¯è¢«ä¸¢å¼ƒã€‚</strong></li>
</ul>
<p>é‚£ä¹ˆï¼Œåˆ°åº•èƒ½ä¸èƒ½ç”¨ Redis Stream åšæ¶ˆæ¯é˜Ÿåˆ—å‘¢ï¼Ÿå…³é”®çœ‹ä½ çš„ä¸šåŠ¡åœºæ™¯ï¼š</p>
<ul>
<li>å¦‚æœä½ çš„ä¸šåŠ¡<strong>å¯¹å¶å°”ä¸¢å¤±å‡ æ¡æ¶ˆæ¯ä¸é‚£ä¹ˆæ•æ„Ÿ</strong>ï¼Œå¹¶ä¸”<strong>æ¶ˆæ¯ç§¯å‹çš„é£é™©ä¸é«˜</strong>ï¼Œé‚£ä¹ˆç”¨ Redis Stream æ˜¯ä¸ªç®€å•æ–¹ä¾¿çš„é€‰æ‹©ã€‚</li>
<li>ä½†å¦‚æœä½ çš„ä¸šåŠ¡è¦æ±‚<strong>æ¶ˆæ¯ç»å¯¹ä¸èƒ½ä¸¢</strong>ï¼Œæˆ–è€…<strong>å¯èƒ½äº§ç”Ÿæµ·é‡æ¶ˆæ¯å¹¶é•¿æ—¶é—´å †ç§¯</strong>ï¼Œé‚£è¿˜æ˜¯é€‰æ‹© Kafkaã€RabbitMQ è¿™ç±»æ›´ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶æ›´ç¨³å¦¥ã€‚</li>
</ul>
<blockquote>
<p>è¡¥å……ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ Redis çš„&quot;å‘å¸ƒ/è®¢é˜…&quot;æœºåˆ¶åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</p>
</blockquote>
<p>è™½ç„¶å‘å¸ƒ/è®¢é˜…å¬èµ·æ¥ä¹Ÿåƒæ¶ˆæ¯ä¼ é€’ï¼Œä½†å®ƒæœ‰å‡ ä¸ªç¡¬ä¼¤ï¼Œä¸é€‚åˆåšæ­£ç»çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<ol>
<li><strong>ä¸å­˜æ¶ˆæ¯</strong>ï¼šå‘å¸ƒ/è®¢é˜…æ˜¯çº¯ç²¹çš„&quot;é˜…åå³ç„š&quot;ï¼Œæ¶ˆæ¯å‘å‡ºå»å°±æ²¡äº†ï¼ŒRedis ä¸ä¼šä¸ºå®ƒåšæŒä¹…åŒ–ï¼ˆå†™ RDB æˆ– AOFï¼‰ã€‚Redis é‡å¯åï¼Œå•¥éƒ½æ²¡äº†ã€‚</li>
<li><strong>ç¦»çº¿æ¶ˆè´¹è€…æ”¶ä¸åˆ°</strong>ï¼šå¦‚æœä¸€ä¸ªè®¢é˜…è€…å½“æ—¶ä¸åœ¨çº¿ï¼Œå®ƒå°±æ°¸è¿œé”™è¿‡äº†é‚£äº›æ¶ˆæ¯ï¼Œä¹‹åä¹Ÿè¡¥ä¸å›æ¥ã€‚</li>
<li><strong>æ¶ˆè´¹è€…æ…¢äº†ä¼šè¢«è¸¢æ‰</strong>ï¼šå¦‚æœç”Ÿäº§è€…å‘å¤ªå¿«ï¼ŒæŸä¸ªæ¶ˆè´¹è€…å¤„ç†ä¸è¿‡æ¥ï¼Œå¯¼è‡´å®ƒé‚£è¾¹çš„æ¶ˆæ¯ç¼“å†²åŒºæ»¡äº†ï¼ˆé»˜è®¤è¶…è¿‡32MBï¼Œæˆ–è€…60ç§’å†…æŒç»­å ç€8MBä»¥ä¸Šï¼‰ï¼ŒRedis ä¼šæŠŠè¿™ä¸ª&quot;æ‹–åè…¿&quot;çš„æ¶ˆè´¹è€…ç›´æ¥è¸¢ä¸‹çº¿ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼Œå‘å¸ƒ/è®¢é˜…æœºåˆ¶æ›´é€‚åˆåšä¸€äº›<strong>å³æ—¶æ€§çš„é€šçŸ¥</strong>ï¼Œæ¯”å¦‚ Redis å“¨å…µé›†ç¾¤å†…éƒ¨çš„é€šä¿¡ï¼Œè€Œä¸æ˜¯éœ€è¦å¯é ä¼ é€’å’Œå­˜å‚¨çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Redis å¸¸è§çš„äº”ç§æ•°æ®ç±»å‹ï¼š<strong>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼ŒHashï¼ˆå“ˆå¸Œï¼‰ï¼ŒListï¼ˆåˆ—è¡¨ï¼‰ï¼ŒSetï¼ˆé›†åˆï¼‰åŠ Zset(sorted setï¼šæœ‰åºé›†åˆ)</strong>ã€‚</p>
<p>è¿™äº”ç§æ•°æ®ç±»å‹éƒ½ç”±å¤šç§æ•°æ®ç»“æ„å®ç°çš„ï¼Œä¸»è¦æ˜¯å‡ºäºæ—¶é—´å’Œç©ºé—´çš„è€ƒè™‘ï¼Œå½“æ•°æ®é‡å°çš„æ—¶å€™ä½¿ç”¨æ›´ç®€å•çš„æ•°æ®ç»“æ„ï¼Œæœ‰åˆ©äºèŠ‚çœå†…å­˜ï¼Œæé«˜æ€§èƒ½ã€‚</p>
<p>è¿™äº”ç§æ•°æ®ç±»å‹ä¸åº•å±‚æ•°æ®ç»“æ„å¯¹åº”å…³ç³»å›¾å¦‚ä¸‹ï¼Œå·¦è¾¹æ˜¯ Redis 3.0 ç‰ˆæœ¬çš„ï¼Œä¹Ÿå°±æ˜¯ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹è¿™æœ¬ä¹¦è®²è§£çš„ç‰ˆæœ¬ï¼Œç°åœ¨çœ‹è¿˜æ˜¯æœ‰ç‚¹è¿‡æ—¶äº†ï¼Œå³è¾¹æ˜¯ç°åœ¨ Github æœ€æ–°çš„ Redis ä»£ç çš„ã€‚</p>
<p><img src="/2025/05/14/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Other/1747324379560.png" alt="1747324379560"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒRedis æ•°æ®ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„éšç€ç‰ˆæœ¬çš„æ›´æ–°ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>åœ¨ Redis 3.0 ç‰ˆæœ¬ä¸­ List å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„ç”±ã€ŒåŒå‘é“¾è¡¨ã€æˆ–ã€Œå‹ç¼©è¡¨åˆ—è¡¨ã€å®ç°ï¼Œä½†æ˜¯åœ¨ 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”± quicklist å®ç°çš„ï¼›</li>
<li>åœ¨æœ€æ–°çš„ Redis ä»£ç ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†ã€‚</li>
</ul>
<p>Redis äº”ç§æ•°æ®ç±»å‹çš„åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>String ç±»å‹çš„åº”ç”¨åœºæ™¯ï¼šç¼“å­˜å¯¹è±¡ã€å¸¸è§„è®¡æ•°ã€åˆ†å¸ƒå¼é”ã€å…±äº« session ä¿¡æ¯ç­‰ã€‚</li>
<li>List ç±»å‹çš„åº”ç”¨åœºæ™¯ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š1. ç”Ÿäº§è€…éœ€è¦è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDï¼›2. ä¸èƒ½ä»¥æ¶ˆè´¹ç»„å½¢å¼æ¶ˆè´¹æ•°æ®ï¼‰ç­‰ã€‚</li>
<li>Hash ç±»å‹ï¼šç¼“å­˜å¯¹è±¡ã€è´­ç‰©è½¦ç­‰ã€‚</li>
<li>Set ç±»å‹ï¼šèšåˆè®¡ç®—ï¼ˆå¹¶é›†ã€äº¤é›†ã€å·®é›†ï¼‰åœºæ™¯ï¼Œæ¯”å¦‚ç‚¹èµã€å…±åŒå…³æ³¨ã€æŠ½å¥–æ´»åŠ¨ç­‰ã€‚</li>
<li>Zset ç±»å‹ï¼šæ’åºåœºæ™¯ï¼Œæ¯”å¦‚æ’è¡Œæ¦œã€ç”µè¯å’Œå§“åæ’åºç­‰ã€‚</li>
</ul>
<p>Redis åç»­ç‰ˆæœ¬åˆæ”¯æŒå››ç§æ•°æ®ç±»å‹ï¼Œå®ƒä»¬çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>BitMapï¼ˆ2.2 ç‰ˆæ–°å¢ï¼‰ï¼šäºŒå€¼çŠ¶æ€ç»Ÿè®¡çš„åœºæ™¯ï¼Œæ¯”å¦‚ç­¾åˆ°ã€åˆ¤æ–­ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è¿ç»­ç­¾åˆ°ç”¨æˆ·æ€»æ•°ç­‰ï¼›</li>
<li>HyperLogLogï¼ˆ2.8 ç‰ˆæ–°å¢ï¼‰ï¼šæµ·é‡æ•°æ®åŸºæ•°ç»Ÿè®¡çš„åœºæ™¯ï¼Œæ¯”å¦‚ç™¾ä¸‡çº§ç½‘é¡µ UV è®¡æ•°ç­‰ï¼›</li>
<li>GEOï¼ˆ3.2 ç‰ˆæ–°å¢ï¼‰ï¼šå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯çš„åœºæ™¯ï¼Œæ¯”å¦‚æ»´æ»´å«è½¦ï¼›</li>
<li>Streamï¼ˆ5.0 ç‰ˆæ–°å¢ï¼‰ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç›¸æ¯”äºåŸºäº List ç±»å‹å®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ‰è¿™ä¸¤ä¸ªç‰¹æœ‰çš„ç‰¹æ€§ï¼šè‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€æ¶ˆæ¯ IDï¼Œæ”¯æŒä»¥æ¶ˆè´¹ç»„å½¢å¼æ¶ˆè´¹æ•°æ®ã€‚</li>
</ul>
<p>é’ˆå¯¹ Redis æ˜¯å¦é€‚åˆåšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå…³é”®çœ‹ä½ çš„ä¸šåŠ¡åœºæ™¯ï¼š</p>
<ul>
<li>å¦‚æœä½ çš„ä¸šåŠ¡åœºæ™¯è¶³å¤Ÿç®€å•ï¼Œå¯¹äºæ•°æ®ä¸¢å¤±ä¸æ•æ„Ÿï¼Œè€Œä¸”æ¶ˆæ¯ç§¯å‹æ¦‚ç‡æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼ŒæŠŠ Redis å½“ä½œé˜Ÿåˆ—æ˜¯å®Œå…¨å¯ä»¥çš„ã€‚</li>
<li>å¦‚æœä½ çš„ä¸šåŠ¡æœ‰æµ·é‡æ¶ˆæ¯ï¼Œæ¶ˆæ¯ç§¯å‹çš„æ¦‚ç‡æ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”ä¸èƒ½æ¥å—æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆè¿˜æ˜¯ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶å§ã€‚</li>
</ul>
<hr>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li>ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹</li>
<li><a href="https://www.cnblogs.com/hunternet/p/12742390.html">https://www.cnblogs.com/hunternet/p/12742390.html</a></li>
<li><a href="https://www.cnblogs.com/qdhxhz/p/15669348.html">https://www.cnblogs.com/qdhxhz/p/15669348.html</a></li>
<li><a href="https://www.cnblogs.com/bbgs-xc/p/14376109.html">https://www.cnblogs.com/bbgs-xc/p/14376109.html</a></li>
<li><a href="http://kaito-kidd.com/2021/04/19/can-redis-be-used-as-a-queue/">http://kaito-kidd.com/2021/04/19/can-redis-be-used-as-a-queue/</a></li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>åŸºç¡€çŸ¥è¯†</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>æ•°æ®ç±»å‹</tag>
        <tag>Bitmap</tag>
        <tag>HyperLogLog</tag>
        <tag>GEO</tag>
        <tag>Stream</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 295 - æ•°æ®æµçš„ä¸­ä½æ•°ï¼ˆFind Median from Data Streamï¼‰</title>
    <url>/2025/05/14/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-295-%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ä¸­ä½æ•°æ˜¯æœ‰åºæ•´æ•°åˆ—è¡¨ä¸­çš„ä¸­é—´å€¼ã€‚å¦‚æœåˆ—è¡¨çš„å¤§å°æ˜¯å¶æ•°ï¼Œåˆ™æ²¡æœ‰ä¸­é—´å€¼ï¼Œä¸­ä½æ•°æ˜¯ä¸¤ä¸ªä¸­é—´å€¼çš„å¹³å‡å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>arr = [2,3,4] çš„ä¸­ä½æ•°æ˜¯ 3</li>
<li>arr = [2,3] çš„ä¸­ä½æ•°æ˜¯ (2 + 3) / 2 = 2.5</li>
</ul>
<p>è®¾è®¡ä¸€ä¸ªæ”¯æŒä»¥ä¸‹ä¸¤ç§æ“ä½œçš„æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li><code>void addNum(int num)</code> - å°†æ•´æ•° num æ·»åŠ åˆ°æ•°æ®ç»“æ„ä¸­</li>
<li><code>double findMedian()</code> - è¿”å›æ‰€æœ‰å…ƒç´ çš„ä¸­ä½æ•°</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;MedianFinder&quot;, &quot;addNum&quot;, &quot;addNum&quot;, &quot;findMedian&quot;, &quot;addNum&quot;, &quot;findMedian&quot;]</span><br><span class="line">[[], [1], [2], [], [3], []]</span><br><span class="line">è¾“å‡ºï¼š[null, null, null, 1.5, null, 2.0]</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">MedianFinder medianFinder = new MedianFinder();</span><br><span class="line">medianFinder.addNum(1);    // arr = [1]</span><br><span class="line">medianFinder.addNum(2);    // arr = [1, 2]</span><br><span class="line">medianFinder.findMedian(); // è¿”å› 1.5 ((1 + 2) / 2)</span><br><span class="line">medianFinder.addNum(3);    // arr = [1, 2, 3]</span><br><span class="line">medianFinder.findMedian(); // è¿”å› 2.0</span><br></pre></td></tr></table></figure>
<p>çº¦æŸæ¡ä»¶ï¼š</p>
<ul>
<li>-10^5 &lt;= num &lt;= 10^5</li>
<li>åœ¨è°ƒç”¨ findMedian ä¹‹å‰ï¼Œæ•°æ®ç»“æ„ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ </li>
<li>æœ€å¤š 5 * 10^4 æ¬¡è°ƒç”¨ addNum å’Œ findMedian</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<h3 id="åˆ†æé—®é¢˜">åˆ†æé—®é¢˜</h3>
<p>è¿™ä¸ªé—®é¢˜è¦æ±‚æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿåœ¨æ•°æ®æµä¸­å¿«é€Ÿè·å–ä¸­ä½æ•°ã€‚å…³é”®æŒ‘æˆ˜åœ¨äºï¼š</p>
<ol>
<li>æ•°æ®æ˜¯è¿ç»­æ·»åŠ çš„ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ç»™å‡º</li>
<li>æ¯æ¬¡æ·»åŠ åå¯èƒ½éœ€è¦é‡æ–°è®¡ç®—ä¸­ä½æ•°</li>
<li>éœ€è¦é«˜æ•ˆå¤„ç†å¤§é‡çš„æ·»åŠ æ“ä½œå’ŒæŸ¥æ‰¾æ“ä½œ</li>
</ol>
<p>å¯¹äºä¸­ä½æ•°çš„æŸ¥æ‰¾ï¼Œå¦‚æœæˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªæœ‰åºçš„æ•°ç»„ï¼Œé‚£ä¹ˆä¸­ä½æ•°çš„ä½ç½®æ˜¯ç¡®å®šçš„ã€‚ä½†æ¯æ¬¡æ’å…¥æ–°å…ƒç´ æ—¶ï¼Œä¸ºäº†ä¿æŒæœ‰åºï¼Œæˆ‘ä»¬éœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦è¿›è¡Œæ’å…¥ï¼Œè¿™åœ¨æ•°æ®é‡å¤§æ—¶æ•ˆç‡å¾ˆä½ã€‚</p>
<h3 id="æ ¸å¿ƒæ€æƒ³ï¼šåŒå †æ³•">æ ¸å¿ƒæ€æƒ³ï¼šåŒå †æ³•</h3>
<p><strong>å…³é”®æ´è§</strong>ï¼šæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå·¦åŠéƒ¨åˆ†ç”¨æœ€å¤§å †ç»´æŠ¤ï¼Œå³åŠéƒ¨åˆ†ç”¨æœ€å°å †ç»´æŠ¤ã€‚</p>
<p>è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>å·¦è¾¹æœ€å¤§å †çš„å †é¡¶æ˜¯å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼</li>
<li>å³è¾¹æœ€å°å †çš„å †é¡¶æ˜¯å³åŠéƒ¨åˆ†çš„æœ€å°å€¼</li>
<li>å½“ä¸¤ä¸ªå †å¹³è¡¡æ—¶ï¼Œè¿™ä¸¤ä¸ªå€¼å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ä¸­é—´å€¼</li>
</ul>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<ol>
<li>å¦‚æœå…ƒç´ æ€»æ•°æ˜¯å¥‡æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è®©å·¦è¾¹çš„æœ€å¤§å †å¤šä¸€ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶æœ€å¤§å †çš„å †é¡¶å°±æ˜¯ä¸­ä½æ•°</li>
<li>å¦‚æœå…ƒç´ æ€»æ•°æ˜¯å¶æ•°ï¼Œä¸­ä½æ•°æ˜¯æœ€å¤§å †å †é¡¶å’Œæœ€å°å †å †é¡¶çš„å¹³å‡å€¼</li>
</ol>
<h3 id="ç®—æ³•æµç¨‹">ç®—æ³•æµç¨‹</h3>
<ol>
<li>åˆ›å»ºä¸¤ä¸ªå †ï¼šæœ€å¤§å † <code>maxHeap</code> å’Œæœ€å°å † <code>minHeap</code></li>
<li><code>maxHeap</code> å­˜å‚¨è¾ƒå°çš„ä¸€åŠæ•°å­—ï¼Œ<code>minHeap</code> å­˜å‚¨è¾ƒå¤§çš„ä¸€åŠæ•°å­—</li>
<li>ç¡®ä¿ä¸¤ä¸ªå †å¤§å°å¹³è¡¡ï¼šä¸¤å †å¤§å°è¦ä¹ˆç›¸ç­‰ï¼Œè¦ä¹ˆ <code>maxHeap</code> æ¯” <code>minHeap</code> å¤šä¸€ä¸ªå…ƒç´ </li>
<li>æ¯æ¬¡æ·»åŠ å…ƒç´ æ—¶ï¼Œé€šè¿‡äº¤æ¢å †é¡¶å…ƒç´ æ¥ç»´æŠ¤ä¸¤ä¸ªå †çš„æ•°æ®å¹³è¡¡</li>
</ol>
<p>æ·»åŠ å…ƒç´ çš„å…·ä½“æ­¥éª¤ï¼š</p>
<ol>
<li>å¦‚æœä¸¤ä¸ªå †éƒ½ä¸ºç©ºï¼Œç›´æ¥å°†å…ƒç´ æ·»åŠ åˆ° <code>maxHeap</code></li>
<li>å¦åˆ™ï¼Œæ ¹æ®ä¸¤ä¸ªå †çš„å¤§å°å…³ç³»é€‰æ‹©åˆé€‚çš„å †è¿›è¡Œå…ƒç´ æ·»åŠ </li>
<li>æ·»åŠ æ—¶ï¼Œå…ˆå¼¹å‡ºä¸€ä¸ªå †çš„é¡¶éƒ¨å…ƒç´ ï¼Œä¸æ–°å…ƒç´ æ¯”è¾ƒï¼Œè¾ƒå¤§çš„è¿›å…¥ <code>minHeap</code>ï¼Œè¾ƒå°çš„è¿›å…¥ <code>maxHeap</code></li>
<li>è¿™æ ·ç¡®ä¿äº† <code>maxHeap</code> ä¸­æ‰€æœ‰å…ƒç´ éƒ½å°äºç­‰äº <code>minHeap</code> ä¸­çš„æ‰€æœ‰å…ƒç´ </li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>Go è¯­è¨€çš„æ ‡å‡†åº“ <code>container/heap</code> æä¾›äº†å †çš„æ¥å£ï¼Œä½†éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ç‰¹å®šçš„æ–¹æ³•ã€‚</p>
<h3 id="å®ç°å †æ¥å£">å®ç°å †æ¥å£</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæœ€å¤§å †å’Œæœ€å°å †åˆ†åˆ«å®ç° <code>heap.Interface</code> æ¥å£ï¼š</p>
<ol>
<li>æœ€å°å †å®ç°ï¼š</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> minHeap []<span class="type">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h minHeap)</span></span> Len() <span class="type">int</span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(h) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h minHeap)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> h[i] &lt; h[j] &#125;  <span class="comment">// æœ€å°å †ï¼šçˆ¶èŠ‚ç‚¹å°äºå­èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h minHeap)</span></span> Swap(i, j <span class="type">int</span>)      &#123; h[i], h[j] = h[j], h[i] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *minHeap)</span></span> Push(x any) &#123;</span><br><span class="line">    *h = <span class="built_in">append</span>(*h, x.(<span class="type">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *minHeap)</span></span> Pop() any &#123;</span><br><span class="line">    old := *h</span><br><span class="line">    n := <span class="built_in">len</span>(old)</span><br><span class="line">    x := old[n<span class="number">-1</span>]</span><br><span class="line">    *h = old[:n<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æœ€å¤§å †å®ç°ï¼š</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> maxHeap []<span class="type">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h maxHeap)</span></span> Len() <span class="type">int</span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(h) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h maxHeap)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> h[i] &gt; h[j] &#125;  <span class="comment">// æœ€å¤§å †ï¼šçˆ¶èŠ‚ç‚¹å¤§äºå­èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h maxHeap)</span></span> Swap(i, j <span class="type">int</span>)      &#123; h[i], h[j] = h[j], h[i] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *maxHeap)</span></span> Push(x any) &#123;</span><br><span class="line">    *h = <span class="built_in">append</span>(*h, x.(<span class="type">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *maxHeap)</span></span> Pop() any &#123;</span><br><span class="line">    old := *h</span><br><span class="line">    n := <span class="built_in">len</span>(old)</span><br><span class="line">    x := old[n<span class="number">-1</span>]</span><br><span class="line">    *h = old[:n<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…³é”®å®ç°ç»†èŠ‚">å…³é”®å®ç°ç»†èŠ‚</h3>
<p>åœ¨ <code>AddNum</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ä¸¤ä¸ªå †çš„å¹³è¡¡å¹¶ä¸”æ•°æ®åˆ†å¸ƒæ­£ç¡®ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mf *MedianFinder)</span></span> AddNum(num <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="comment">// ç‰¹æ®Šå¤„ç†ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(mf.maxh) == <span class="number">0</span> &amp;&amp; <span class="built_in">len</span>(mf.minh) == <span class="number">0</span> &#123;</span><br><span class="line">        heap.Push(&amp;mf.maxh, num)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯”è¾ƒä¸¤ä¸ªå †çš„å¤§å°ï¼Œè°ƒæ•´å…ƒç´ åˆ†å¸ƒ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(mf.maxh) &lt;= <span class="built_in">len</span>(mf.minh) &#123;</span><br><span class="line">        <span class="comment">// ä»æœ€å°å †å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä¸æ–°å…ƒç´ æ¯”è¾ƒ</span></span><br><span class="line">        num2 := heap.Pop(&amp;mf.minh).(<span class="type">int</span>)</span><br><span class="line">        <span class="comment">// è¾ƒå¤§çš„è¿›å…¥æœ€å°å †</span></span><br><span class="line">        heap.Push(&amp;mf.minh, max(num, num2))</span><br><span class="line">        <span class="comment">// è¾ƒå°çš„è¿›å…¥æœ€å¤§å †</span></span><br><span class="line">        heap.Push(&amp;mf.maxh, min(num2, num))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä»æœ€å¤§å †å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä¸æ–°å…ƒç´ æ¯”è¾ƒ</span></span><br><span class="line">        num2 := heap.Pop(&amp;mf.maxh).(<span class="type">int</span>)</span><br><span class="line">        <span class="comment">// è¾ƒå¤§çš„è¿›å…¥æœ€å°å †</span></span><br><span class="line">        heap.Push(&amp;mf.minh, max(num, num2))</span><br><span class="line">        <span class="comment">// è¾ƒå°çš„è¿›å…¥æœ€å¤§å †</span></span><br><span class="line">        heap.Push(&amp;mf.maxh, min(num2, num))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>FindMedian</code> æ–¹æ³•ä¸­ï¼Œæ ¹æ®ä¸¤ä¸ªå †çš„å¤§å°å…³ç³»å¿«é€Ÿè®¡ç®—ä¸­ä½æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mf *MedianFinder)</span></span> FindMedian() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(mf.maxh) != <span class="built_in">len</span>(mf.minh) &#123;</span><br><span class="line">        <span class="comment">// å¥‡æ•°æƒ…å†µï¼šæœ€å¤§å †çš„å †é¡¶å°±æ˜¯ä¸­ä½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">float64</span>(mf.maxh[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¶æ•°æƒ…å†µï¼šä¸¤ä¸ªå †é¡¶çš„å¹³å‡å€¼</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">float64</span>(mf.maxh[<span class="number">0</span>] + mf.minh[<span class="number">0</span>]) / <span class="number">2.0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>å®Œæ•´çš„ Go è¯­è¨€å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;container/heap&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MedianFinder <span class="keyword">struct</span> &#123;</span><br><span class="line">    minh minHeap  <span class="comment">// å­˜å‚¨è¾ƒå¤§çš„ä¸€åŠæ•°å­—</span></span><br><span class="line">    maxh maxHeap  <span class="comment">// å­˜å‚¨è¾ƒå°çš„ä¸€åŠæ•°å­—</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span></span> MedianFinder &#123;</span><br><span class="line">    <span class="keyword">return</span> MedianFinder&#123;</span><br><span class="line">        minh: minHeap&#123;&#125;,</span><br><span class="line">        maxh: maxHeap&#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mf *MedianFinder)</span></span> AddNum(num <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(mf.maxh) == <span class="number">0</span> &amp;&amp; <span class="built_in">len</span>(mf.minh) == <span class="number">0</span> &#123;</span><br><span class="line">        heap.Push(&amp;mf.maxh, num)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(mf.maxh) &lt;= <span class="built_in">len</span>(mf.minh) &#123;</span><br><span class="line">        num2 := heap.Pop(&amp;mf.minh).(<span class="type">int</span>)</span><br><span class="line">        heap.Push(&amp;mf.minh, max(num, num2))</span><br><span class="line">        heap.Push(&amp;mf.maxh, min(num2, num))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        num2 := heap.Pop(&amp;mf.maxh).(<span class="type">int</span>)</span><br><span class="line">        heap.Push(&amp;mf.minh, max(num, num2))</span><br><span class="line">        heap.Push(&amp;mf.maxh, min(num2, num))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mf *MedianFinder)</span></span> FindMedian() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(mf.maxh) != <span class="built_in">len</span>(mf.minh) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">float64</span>(mf.maxh[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">float64</span>(mf.maxh[<span class="number">0</span>] + mf.minh[<span class="number">0</span>]) / <span class="number">2.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æœ€å°å †</span></span><br><span class="line"><span class="keyword">type</span> minHeap []<span class="type">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h minHeap)</span></span> Len() <span class="type">int</span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(h) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h minHeap)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> h[i] &lt; h[j] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h minHeap)</span></span> Swap(i, j <span class="type">int</span>)      &#123; h[i], h[j] = h[j], h[i] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *minHeap)</span></span> Push(x any) &#123;</span><br><span class="line">    *h = <span class="built_in">append</span>(*h, x.(<span class="type">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *minHeap)</span></span> Pop() any &#123;</span><br><span class="line">    old := *h</span><br><span class="line">    n := <span class="built_in">len</span>(old)</span><br><span class="line">    x := old[n<span class="number">-1</span>]</span><br><span class="line">    *h = old[:n<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æœ€å¤§å †</span></span><br><span class="line"><span class="keyword">type</span> maxHeap []<span class="type">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h maxHeap)</span></span> Len() <span class="type">int</span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(h) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h maxHeap)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> h[i] &gt; h[j] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h maxHeap)</span></span> Swap(i, j <span class="type">int</span>)      &#123; h[i], h[j] = h[j], h[i] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *maxHeap)</span></span> Push(x any) &#123;</span><br><span class="line">    *h = <span class="built_in">append</span>(*h, x.(<span class="type">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *maxHeap)</span></span> Pop() any &#123;</span><br><span class="line">    old := *h</span><br><span class="line">    n := <span class="built_in">len</span>(old)</span><br><span class="line">    x := old[n<span class="number">-1</span>]</span><br><span class="line">    *h = old[:n<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<ul>
<li>
<p><code>AddNum</code> æ“ä½œï¼šO(log n)</p>
<ul>
<li>å †çš„æ’å…¥å’Œåˆ é™¤æ“ä½œéƒ½æ˜¯ O(log n)ï¼Œå…¶ä¸­ n æ˜¯å †çš„å¤§å°</li>
<li>æ¯æ¬¡ AddNum è¿›è¡Œäº†å›ºå®šæ¬¡æ•°ï¼ˆå¸¸æ•°æ¬¡ï¼‰çš„å †æ“ä½œ</li>
</ul>
</li>
<li>
<p><code>FindMedian</code> æ“ä½œï¼šO(1)</p>
<ul>
<li>ç›´æ¥è¿”å›å †é¡¶æˆ–ä¸¤ä¸ªå †é¡¶çš„å¹³å‡å€¼ï¼Œæ˜¯å¸¸æ•°æ—¶é—´æ“ä½œ</li>
</ul>
</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<ul>
<li>O(n)ï¼Œå…¶ä¸­ n æ˜¯æ·»åŠ åˆ°æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ æ•°é‡
<ul>
<li>æ‰€æœ‰å…ƒç´ éƒ½å­˜å‚¨åœ¨ä¸¤ä¸ªå †ä¸­</li>
</ul>
</li>
</ul>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>åŒå †æ³•</th>
<th>æ’åºæ•°ç»„æ³•</th>
<th>AVL æ ‘/çº¢é»‘æ ‘æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ·»åŠ å…ƒç´ æ—¶é—´å¤æ‚åº¦</td>
<td>O(log n)</td>
<td>O(n)</td>
<td>O(log n)</td>
</tr>
<tr>
<td>æŸ¥æ‰¾ä¸­ä½æ•°æ—¶é—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(1)</td>
<td>O(log n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>å®ç°å¤æ‚åº¦</td>
<td>ä¸­ç­‰</td>
<td>ç®€å•</td>
<td>å¤æ‚</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>é«˜é¢‘æ·»åŠ å’ŒæŸ¥è¯¢</td>
<td>é«˜é¢‘æŸ¥è¯¢ï¼Œä½é¢‘æ·»åŠ </td>
<td>æ•°æ®é‡å¤§ä¸”æ³¢åŠ¨å¤§</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>æ•°æ®ç»“æ„çš„é€‰æ‹©è‡³å…³é‡è¦</strong>ï¼šä½¿ç”¨ä¸¤ä¸ªå †èƒ½è®©æˆ‘ä»¬é«˜æ•ˆåœ°è·å–ä¸­ä½æ•°</li>
<li><strong>æ•°æ®å¹³è¡¡çš„ç»´æŠ¤</strong>ï¼šç¡®ä¿ä¸¤ä¸ªå †çš„å¤§å°å·®ä¸è¶…è¿‡ 1ï¼Œæ˜¯ç®—æ³•æ­£ç¡®æ€§çš„å…³é”®</li>
<li><strong>å…ƒç´ äº¤æ¢çš„æŠ€å·§</strong>ï¼šé€šè¿‡æ¯”è¾ƒæ–°å…ƒç´ å’Œå †é¡¶å…ƒç´ æ¥ä¿è¯æ•°æ®åˆ†å¸ƒæ­£ç¡®</li>
<li><strong>æ•°æ®æµç®—æ³•è®¾è®¡</strong>ï¼šå¤„ç†æ•°æ®æµé—®é¢˜æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ— æ³•ä¸€æ¬¡å¤„ç†æ‰€æœ‰æ•°æ®ï¼Œéœ€è¦èƒ½å¤ŸåŠ¨æ€è°ƒæ•´çš„æ•°æ®ç»“æ„</li>
<li><strong>å †çš„æ¥å£å®ç°</strong>ï¼šGo è¯­è¨€ <code>container/heap</code> åŒ…æä¾›äº†çµæ´»çš„å †æ¥å£ï¼Œé€šè¿‡å®ç°æ¥å£å¯ä»¥å¿«é€Ÿæ„å»ºè‡ªå®šä¹‰å †</li>
</ol>
<p>è¿™é“é¢˜ç›®æ˜¯å †å’Œä¼˜å…ˆé˜Ÿåˆ—åœ¨å®é™…é—®é¢˜ä¸­çš„ä¸€ä¸ªå…¸å‹åº”ç”¨ï¼Œä¹Ÿå±•ç¤ºäº†å¦‚ä½•åœ¨ä¸æ’åºæ•´ä¸ªæ•°ç»„çš„æƒ…å†µä¸‹é«˜æ•ˆåœ°ç»´æŠ¤æ•°æ®çš„ä¸­ä½æ•°ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å †</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Hard</tag>
        <tag>å †</tag>
        <tag>ä¼˜å…ˆé˜Ÿåˆ—</tag>
        <tag>æ•°æ®ç»“æ„è®¾è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 215 - æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´  (è¶…æ—¶åˆ†æä¸ä¼˜åŒ–)</title>
    <url>/2025/05/13/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-215-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E7%AC%ACK%E4%B8%AA%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0-%E8%B6%85%E6%97%B6%E5%88%86%E6%9E%90%E4%B8%8E%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šæ•´æ•°æ•°ç»„ <code>nums</code> å’Œæ•´æ•° <code>k</code>ï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ <code>k</code> ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ <code>k</code> ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ <code>k</code> ä¸ªä¸åŒçš„å…ƒç´ ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [3,2,1,5,6,4] å’Œ k = 2</span><br><span class="line">è¾“å‡º: 5</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [3,2,3,1,2,4,5,5,6] å’Œ k = 4</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶:</strong></p>
<ul>
<li><code>1 &lt;= k &lt;= nums.length &lt;= 10^5</code></li>
<li><code>-10^4 &lt;= nums[i] &lt;= 10^4</code></li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘æœ€åˆä½¿ç”¨å¿«é€Ÿé€‰æ‹©ï¼ˆQuick Selectï¼‰ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹é‡åˆ°äº†è¶…æ—¶é—®é¢˜ã€‚</p>
<h3 id="æœ€åˆçš„é”™è¯¯ä»£ç ">æœ€åˆçš„é”™è¯¯ä»£ç </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findKthLargest</span><span class="params">(nums []<span class="type">int</span>, k <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  n := <span class="built_in">len</span>(nums)</span><br><span class="line">  <span class="keyword">if</span> n == <span class="number">0</span> || k &gt; n &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  left, right := <span class="number">0</span>, n<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> left &lt; right &#123;</span><br><span class="line">    pivot := left + rand.Intn(right-left+<span class="number">1</span>)</span><br><span class="line">    nums[left], nums[pivot] = nums[pivot], nums[left]</span><br><span class="line">    tmpLeft, tmpRight := left, right</span><br><span class="line">    tmp := nums[left]</span><br><span class="line">    <span class="keyword">for</span> tmpLeft &lt; tmpRight &#123;</span><br><span class="line">      <span class="keyword">for</span> tmpLeft &lt; tmpRight &amp;&amp; nums[tmpRight] &lt; tmp &#123;</span><br><span class="line">        tmpRight--</span><br><span class="line">      &#125;</span><br><span class="line">      nums[tmpLeft] = nums[tmpRight]</span><br><span class="line"></span><br><span class="line">      <span class="comment">// é”™è¯¯çš„åˆ†åŒºæ¡ä»¶</span></span><br><span class="line">      <span class="keyword">for</span> tmpLeft &lt; tmpRight &amp;&amp; nums[tmpLeft] &gt; tmp &#123;</span><br><span class="line">        tmpLeft++</span><br><span class="line">      &#125;</span><br><span class="line">      nums[tmpRight] = nums[tmpLeft]</span><br><span class="line">    &#125;</span><br><span class="line">    nums[tmpLeft] = tmp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> tmpLeft == k<span class="number">-1</span> &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> tmpLeft &lt; k<span class="number">-1</span> &#123;</span><br><span class="line">      left = tmpLeft + <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      right = tmpLeft - <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> nums[k<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<ul>
<li><strong>åˆ†åŒºåˆ¤æ–­ä¸ä¸¥è°¨</strong>ï¼šé”™è¯¯ä»£ç ä¸­å·¦ä¾§åˆ†åŒºä½¿ç”¨ <code>for tmpLeft &lt; tmpRight &amp;&amp; nums[tmpLeft] &gt; tmp</code>ï¼Œè·³è¿‡äº†ç­‰äºåŸºå‡†å€¼çš„å…ƒç´ ï¼Œå¯¼è‡´åˆ†åŒºä¸å‡è¡¡ï¼Œåœ¨å­˜åœ¨å¤§é‡é‡å¤æˆ–æç«¯åˆ†å¸ƒæ—¶ï¼Œé€€åŒ–ä¸º O(nÂ²) è€—æ—¶ã€‚</li>
<li><strong>éšæœºæ¢è½´æœªå……åˆ†åˆ©ç”¨</strong>ï¼šåœ¨é‡å¤å…ƒç´ è¾ƒå¤šæˆ–è¿‘ä¼¼æœ‰åºçš„æ•°ç»„ä¸Šï¼Œæœªèƒ½æœ‰æ•ˆæ‰“ä¹±æ•°æ®é¡ºåºï¼Œåˆ†åŒºæ•ˆç‡ä½ä¸‹ã€‚</li>
</ul>
<p>é€šè¿‡å°†å·¦ä¾§åˆ†åŒºæ¡ä»¶ä¿®æ”¹ä¸º <code>nums[tmpLeft] &gt;= tmp</code>ã€åœ¨è¾¾åˆ°ç›®æ ‡ä½ç½®ååŠæ—¶é€€å‡ºå¾ªç¯ï¼Œå¹¶ç»“åˆåˆç†çš„éšæœºæ¢è½´æŠ½å–ï¼Œå¯ä¿è¯å¹³å‡ O(n) æ€§èƒ½ã€‚</p>
<h2 id="æ­£ç¡®è§£æ³•">æ­£ç¡®è§£æ³•</h2>
<p>å¿«é€Ÿé€‰æ‹©ï¼ˆQuick Selectï¼‰ç®—æ³•æ˜¯è§£å†³&quot;ç¬¬ k å¤§/å°å…ƒç´ &quot;é—®é¢˜çš„ç»å…¸æ–¹æ³•ï¼Œå®ƒæ˜¯å¿«é€Ÿæ’åºçš„å˜ç§ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œè¿œä¼˜äºå®Œå…¨æ’åºçš„ O(n log n)ã€‚</p>
<h3 id="è§£é¢˜åŸç†">è§£é¢˜åŸç†</h3>
<h4 id="å¿«é€Ÿé€‰æ‹©çš„æœ¬è´¨åŸç†">å¿«é€Ÿé€‰æ‹©çš„æœ¬è´¨åŸç†</h4>
<p>å¿«é€Ÿé€‰æ‹©ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³éå¸¸ç›´æ¥ï¼š<strong>æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“æ•´ä¸ªæ•°ç»„çš„æ’åºæƒ…å†µï¼Œåªéœ€è¦ç¡®å®šç¬¬ k å¤§å…ƒç´ åœ¨å“ªé‡Œ</strong>ã€‚è¿™å°±åƒåœ¨ä¸€ç¾¤äººä¸­æ‰¾åˆ°èº«é«˜æ’ç¬¬ k é«˜çš„äººï¼Œæˆ‘ä»¬ä¸éœ€è¦æŠŠæ‰€æœ‰äººæŒ‰èº«é«˜æ’å¥½é˜Ÿï¼Œåªéœ€è¦æ‰¾åˆ°é‚£ä¸ªç‰¹å®šä½ç½®çš„äººã€‚</p>
<p>æƒ³è±¡ä½ æ‰‹é‡Œæœ‰ä¸€å †æ‰‘å…‹ç‰Œï¼Œè¦æ‰¾åˆ°å¤§å°æ’ç¬¬ k çš„ç‰Œï¼š</p>
<ol>
<li>ä½ éšæœºæŠ½ä¸€å¼ ç‰Œä½œä¸º&quot;å‚è€ƒç‰Œ&quot;</li>
<li>æŠŠæ¯”å‚è€ƒç‰Œå¤§çš„æ”¾å·¦è¾¹ï¼Œæ¯”å‚è€ƒç‰Œå°çš„æ”¾å³è¾¹</li>
<li>çœ‹çœ‹å‚è€ƒç‰Œç°åœ¨æ˜¯ç¬¬å‡ ä½ï¼š
<ul>
<li>å¦‚æœæ­£å¥½æ˜¯ç¬¬ k ä½ï¼Œæ­å–œä½ æ‰¾åˆ°äº†ç­”æ¡ˆï¼</li>
<li>å¦‚æœå‚è€ƒç‰Œæ’åœ¨ç¬¬ j ä½ä¸” j&lt;kï¼Œè¯´æ˜ç›®æ ‡åœ¨å³è¾¹é‚£å †ç‰Œé‡Œ</li>
<li>å¦‚æœ j&gt;kï¼Œè¯´æ˜ç›®æ ‡åœ¨å·¦è¾¹é‚£å †ç‰Œé‡Œ</li>
</ul>
</li>
<li>åªåœ¨å¯èƒ½åŒ…å«ç›®æ ‡çš„é‚£ä¸€å †ç‰Œä¸­é‡å¤ä¸Šè¿°è¿‡ç¨‹</li>
</ol>
<p><strong>è¿™ç§&quot;æ’é™¤æ³•&quot;çš„ç²¾å¦™ä¹‹å¤„</strong>åœ¨äºï¼šæ¯æ¬¡æ“ä½œåï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šä¸€ä¸ªå…ƒç´ çš„æœ€ç»ˆä½ç½®ï¼Œå¹¶æ’é™¤æ‰ä¸€å¤§åŠä¸å¯èƒ½åŒ…å«ç­”æ¡ˆçš„å…ƒç´ ã€‚æˆ‘ä»¬ä¸æ–­ç¼©å°æœç´¢èŒƒå›´ï¼Œç›´åˆ°æ‰¾åˆ°ç­”æ¡ˆã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆä¼šè¶…æ—¶ï¼Ÿé‡å¤å…ƒç´ çš„é™·é˜±">ä¸ºä»€ä¹ˆä¼šè¶…æ—¶ï¼Ÿé‡å¤å…ƒç´ çš„é™·é˜±</h4>
<p>åœ¨æœ‰å¤§é‡é‡å¤å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ&quot;ç­‰äºå‚è€ƒç‰Œ&quot;çš„ç‰Œå…¨éƒ½æ”¾åœ¨ä¸€è¾¹ï¼ˆæ¯”å¦‚éƒ½æ”¾åœ¨å¤§äºå‚è€ƒç‰Œçš„ä¸€ç»„ï¼‰ï¼Œä¼šå¯¼è‡´åˆ†åŒºæåº¦ä¸å¹³è¡¡ã€‚æœ€åæƒ…å†µä¸‹ï¼Œæ¯æ¬¡åªèƒ½æ’é™¤ä¸€ä¸ªå…ƒç´ ï¼Œç®—æ³•å°±é€€åŒ–ä¸º O(nÂ²)ã€‚</p>
<p>è¿™å°±åƒåœ¨æ‰¾ç¬¬ k é«˜çš„äººæ—¶ï¼Œå¦‚æœæœ‰å¾ˆå¤šäººèº«é«˜ç›¸åŒï¼Œè€Œæˆ‘ä»¬å°†æ‰€æœ‰ç›¸åŒèº«é«˜çš„äººéƒ½æ”¾åœ¨åŒä¸€ç»„ï¼Œå¯èƒ½å¯¼è‡´æ¯æ¬¡åªèƒ½æ’é™¤å¾ˆå°‘çš„äººï¼Œæ•ˆç‡å¤§å¤§é™ä½ã€‚</p>
<h4 id="éšæœºé€‰æ‹©çš„å¨åŠ›">éšæœºé€‰æ‹©çš„å¨åŠ›</h4>
<p>éšæœºé€‰æ‹©å‚è€ƒå…ƒç´ æ˜¯å¦ä¸€ä¸ªå…³é”®ç‚¹ã€‚å¦‚æœæ€»æ˜¯é€‰ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºå‚è€ƒï¼Œé‡åˆ°å·²æ’åºæˆ–ç‰¹æ®Šæ„é€ çš„æ•°ç»„æ—¶ä¼šé™·å…¥æœ€åæƒ…å†µã€‚éšæœºé€‰æ‹©å°±åƒæ˜¯åœ¨æ‰‘å…‹ç‰Œä¸­é—­çœ¼éšæœºæŠ½ä¸€å¼ ä½œä¸ºå‚è€ƒï¼Œè¿™æ ·ä¸ç®¡ç‰Œæ˜¯å¦æœ‰åºï¼Œéƒ½èƒ½ä»¥è¾ƒé«˜æ¦‚ç‡è·å¾—å¹³è¡¡çš„åˆ†åŒºã€‚</p>
<p><strong>éšæœºåŒ–ä½¿ç®—æ³•å…·æœ‰&quot;æ¦‚ç‡æ„ä¹‰ä¸Šçš„ç¨³å¥æ€§&quot;</strong>â€”ç®—æ³•çš„æœŸæœ›è¿è¡Œæ—¶é—´æ˜¯ O(n)ï¼Œå³ä½¿åœ¨æœ€åæ•°æ®åˆ†å¸ƒä¸‹ä¹Ÿå¾ˆéš¾è§¦å‘æœ€åæƒ…å†µã€‚</p>
<h4 id="æ—¶ç©ºå¤æ‚åº¦è§£æ">æ—¶ç©ºå¤æ‚åº¦è§£æ</h4>
<p>ä»æ•°å­¦è§’åº¦çœ‹ï¼Œå¿«é€Ÿé€‰æ‹©çš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œè¿™æ˜¯å› ä¸ºï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡åˆ†åŒºéœ€è¦æ¯”è¾ƒ n ä¸ªå…ƒç´ </li>
<li>ç¬¬äºŒæ¬¡å¤§çº¦éœ€è¦æ¯”è¾ƒ n/2 ä¸ªå…ƒç´ </li>
<li>ç¬¬ä¸‰æ¬¡çº¦ n/4 ä¸ªå…ƒç´ </li>
<li>ä»¥æ­¤ç±»æ¨â€¦</li>
</ul>
<p>æœ€ç»ˆå¾—åˆ°ï¼šn + n/2 + n/4 + â€¦ â‰ˆ 2nï¼Œæ‰€ä»¥å¤æ‚åº¦æ˜¯ O(n)ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¦‚æœç”¨æ’åºç®—æ³•ï¼Œå¿…é¡»æŠŠæ‰€æœ‰å…ƒç´ éƒ½æ’å¥½åºï¼Œè‡³å°‘éœ€è¦ O(n log n)çš„æ—¶é—´å¤æ‚åº¦ã€‚å¿«é€Ÿé€‰æ‹©å·§å¦™åœ°é¿å¼€äº†&quot;å®Œå…¨æ’åº&quot;è¿™ä¸€æ˜‚è´µæ“ä½œï¼Œç›´æ¥å®šä½åˆ°æˆ‘ä»¬å…³å¿ƒçš„é‚£ä¸ªä½ç½®ã€‚</p>
<h3 id="ä»£ç å®ç°ä¸è®²è§£">ä»£ç å®ç°ä¸è®²è§£</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findKthLargest</span><span class="params">(nums []<span class="type">int</span>, k <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  n := <span class="built_in">len</span>(nums)</span><br><span class="line">  <span class="keyword">if</span> n == <span class="number">0</span> || k &gt; n &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>  <span class="comment">// è¾¹ç•Œæ£€æŸ¥ï¼Œç¡®ä¿kæœ‰æ•ˆ</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  left, right := <span class="number">0</span>, n<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> left &lt; right &#123;</span><br><span class="line">    <span class="comment">// éšæœºé€‰æ‹©åŸºå‡†å€¼ï¼Œé¿å…æœ€åæƒ…å†µ</span></span><br><span class="line">    pivot := left + rand.Intn(right-left+<span class="number">1</span>)</span><br><span class="line">    nums[left], nums[pivot] = nums[pivot], nums[left]  <span class="comment">// å°†åŸºå‡†å€¼äº¤æ¢åˆ°å·¦ä¾§</span></span><br><span class="line"></span><br><span class="line">    tmpLeft, tmpRight := left, right</span><br><span class="line">    tmp := nums[left]  <span class="comment">// ä¿å­˜åŸºå‡†å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿«é€Ÿæ’åºçš„åˆ†åŒºè¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> tmpLeft &lt; tmpRight &#123;</span><br><span class="line">      <span class="comment">// ä»å³å‘å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºåŸºå‡†å€¼çš„å…ƒç´ </span></span><br><span class="line">      <span class="keyword">for</span> tmpLeft &lt; tmpRight &amp;&amp; nums[tmpRight] &lt; tmp &#123;</span><br><span class="line">        tmpRight--</span><br><span class="line">      &#125;</span><br><span class="line">      nums[tmpLeft] = nums[tmpRight]  <span class="comment">// å°†è¯¥å…ƒç´ æ”¾åˆ°å·¦ä¾§</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¿®æ­£åˆ†åŒºæ¡ä»¶ï¼šåŒ…å«ç­‰äºåŸºå‡†å€¼çš„å…ƒç´ ï¼Œé¿å…å€¾æ–œåˆ†åŒº</span></span><br><span class="line">      <span class="comment">// åœ¨å­˜åœ¨å¤§é‡é‡å¤å…ƒç´ æ—¶ï¼Œè¿™ä¸ªä¿®æ­£è‡³å…³é‡è¦</span></span><br><span class="line">      <span class="keyword">for</span> tmpLeft &lt; tmpRight &amp;&amp; nums[tmpLeft] &gt;= tmp &#123;</span><br><span class="line">        tmpLeft++</span><br><span class="line">      &#125;</span><br><span class="line">      nums[tmpRight] = nums[tmpLeft]  <span class="comment">// å°†è¯¥å…ƒç´ æ”¾åˆ°å³ä¾§</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†åŸºå‡†å€¼æ”¾åˆ°æœ€ç»ˆä½ç½®</span></span><br><span class="line">    nums[tmpLeft] = tmp</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®åŸºå‡†å€¼ä½ç½®è°ƒæ•´æœç´¢åŒºé—´</span></span><br><span class="line">    <span class="keyword">if</span> tmpLeft == k<span class="number">-1</span> &#123;</span><br><span class="line">      <span class="keyword">break</span>  <span class="comment">// è¾¾åˆ°ç›®æ ‡ä½ç½®ååŠæ—¶é€€å‡ºï¼Œæ‰¾åˆ°ç¬¬kå¤§å…ƒç´ </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> tmpLeft &lt; k<span class="number">-1</span> &#123;</span><br><span class="line">      left = tmpLeft + <span class="number">1</span>  <span class="comment">// åœ¨å³ä¾§åŒºé—´ç»§ç»­å¯»æ‰¾</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      right = tmpLeft - <span class="number">1</span>  <span class="comment">// åœ¨å·¦ä¾§åŒºé—´ç»§ç»­å¯»æ‰¾</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ­¤æ—¶ç¬¬kå¤§çš„å…ƒç´ å·²ç»ä½äºæ­£ç¡®çš„ä½ç½®</span></span><br><span class="line">  <span class="keyword">return</span> nums[k<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æä¸ä¼˜åŒ–æ€»ç»“">å¤æ‚åº¦åˆ†æä¸ä¼˜åŒ–æ€»ç»“</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<ul>
<li><strong>å¹³å‡æƒ…å†µ</strong>ï¼šO(n)
<ul>
<li>æ¯æ¬¡åˆ†åŒºæ“ä½œèƒ½å¤Ÿæ’é™¤çº¦ä¸€åŠçš„å…ƒç´ </li>
<li>æ€»ä½“é€’å½’æ·±åº¦ä¸º O(log n)ï¼Œæ¯å±‚å¤„ç† O(n)ä¸ªå…ƒç´ </li>
<li>æ•°å­¦è¡¨è¾¾ï¼šT(n) = T(n/2) + O(n) = O(n)</li>
</ul>
</li>
<li><strong>æœ€åæƒ…å†µ</strong>ï¼šO(nÂ²)
<ul>
<li>å¦‚æœæ¯æ¬¡é€‰æ‹©çš„åŸºå‡†å€¼éƒ½æ˜¯æœ€å¤§æˆ–æœ€å°å…ƒç´ </li>
<li>ä½†éšæœºé€‰æ‹©åŸºå‡†å€¼ä½¿æœ€åæƒ…å†µçš„æ¦‚ç‡å˜å¾—æä½</li>
</ul>
</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<ul>
<li><strong>O(1)</strong> - åŸåœ°æ“ä½œï¼Œåªä½¿ç”¨å¸¸æ•°é¢å¤–ç©ºé—´</li>
<li>æ²¡æœ‰ä½¿ç”¨é€’å½’ï¼Œé¿å…äº†é€’å½’æ ˆçš„ç©ºé—´æ¶ˆè€—</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ¨¡æ‹Ÿ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>æ•°ç»„</tag>
        <tag>å¿«é€Ÿé€‰æ‹©</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 347 - å‰ K ä¸ªé«˜é¢‘å…ƒç´  (Top K Frequent Elements)</title>
    <url>/2025/05/13/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-347-%E5%89%8DK%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªéç©ºçš„æ•´æ•°æ•°ç»„ï¼Œè¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<p>è¾“å…¥: nums = <code>[1,1,1,2,2,3]</code>, k = 2<br>
è¾“å‡º: <code>[1,2]</code></p>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<p>è¾“å…¥: nums = <code>[1]</code>, k = 1<br>
è¾“å‡º: <code>[1]</code></p>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>ä½ å¯ä»¥å‡è®¾ç»™å®šçš„ k æ€»æ˜¯åˆç†çš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„ä¸­ä¸ç›¸åŒçš„å…ƒç´ çš„ä¸ªæ•°ã€‚</li>
<li>ä½ çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¿…é¡»ä¼˜äº O(<em>n</em> log <em>n</em>) , <em>n</em> æ˜¯æ•°ç»„çš„å¤§å°ã€‚</li>
<li>é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆå”¯ä¸€ï¼Œæ¢å¥è¯è¯´ï¼Œæ•°ç»„ä¸­å‰ k ä¸ªé«˜é¢‘å…ƒç´ çš„é›†åˆæ˜¯å”¯ä¸€çš„ã€‚</li>
<li>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ€è·¯åˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<ol>
<li><strong>ç»Ÿè®¡é¢‘ç‡</strong>ï¼šéå†æ•´ä¸ªæ•°ç»„ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨ï¼ˆåœ¨ Go ä¸­æ˜¯ <code>map</code>ï¼‰æ¥ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°çš„é¢‘ç‡ã€‚</li>
<li><strong>æ‰¾å‡ºå‰ K ä¸ªé«˜é¢‘å…ƒç´ </strong>ï¼šåˆ©ç”¨å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰è¿™ç§æ•°æ®ç»“æ„ï¼Œæ¥é«˜æ•ˆåœ°æ‰¾å‡ºé¢‘ç‡æœ€é«˜çš„å‰ K ä¸ªå…ƒç´ ã€‚</li>
</ol>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ <code>freqMap</code>ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªæ•°å­—åŠå…¶å‡ºç°çš„é¢‘ç‡ã€‚</li>
<li>éå†è¾“å…¥æ•°ç»„ <code>nums</code>ï¼Œå¯¹äºæ¯ä¸ªæ•°å­—ï¼š
<ul>
<li>å¦‚æœæ•°å­—å·²å­˜åœ¨äº <code>freqMap</code> ä¸­ï¼Œåˆ™å°†å…¶é¢‘ç‡åŠ  1ã€‚</li>
<li>å¦‚æœæ•°å­—ä¸å­˜åœ¨äº <code>freqMap</code> ä¸­ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ° <code>freqMap</code> å¹¶è®¾ç½®é¢‘ç‡ä¸º 1ã€‚</li>
</ul>
</li>
<li>åˆ›å»ºä¸€ä¸ªå°é¡¶å †ï¼ˆmin-heapï¼‰ã€‚å †ä¸­å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåŒ…å«æ•°å­—å’Œå…¶é¢‘ç‡çš„ç»“æ„ä½“æˆ–æ•°ç»„ã€‚å †çš„å¤§å°ç»´æŒåœ¨ Kã€‚</li>
<li>éå† <code>freqMap</code> ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹ï¼ˆæ•°å­—å’Œé¢‘ç‡ï¼‰ï¼š
<ul>
<li>å¦‚æœå †çš„å¤§å°å°äº Kï¼Œç›´æ¥å°†å½“å‰å…ƒç´ ï¼ˆæ•°å­—å’Œé¢‘ç‡ï¼‰åŠ å…¥å †ä¸­ã€‚</li>
<li>å¦‚æœå †çš„å¤§å°ç­‰äº Kï¼Œæ¯”è¾ƒå½“å‰å…ƒç´ çš„é¢‘ç‡ä¸å †é¡¶å…ƒç´ çš„é¢‘ç‡ï¼š
<ul>
<li>å¦‚æœå½“å‰å…ƒç´ çš„é¢‘ç‡å¤§äºå †é¡¶å…ƒç´ çš„é¢‘ç‡ï¼Œåˆ™å°†å †é¡¶å…ƒç´ ç§»é™¤ï¼Œå¹¶å°†å½“å‰å…ƒç´ åŠ å…¥å †ä¸­ã€‚è¿™æ ·å¯ä»¥ä¿è¯å †ä¸­å§‹ç»ˆå­˜å‚¨çš„æ˜¯å½“å‰å·²éå†å…ƒç´ ä¸­é¢‘ç‡æœ€é«˜çš„ K ä¸ªã€‚</li>
</ul>
</li>
</ul>
</li>
<li>éå†ç»“æŸåï¼Œå †ä¸­çš„ K ä¸ªå…ƒç´ å³ä¸ºé¢‘ç‡æœ€é«˜çš„å‰ K ä¸ªå…ƒç´ ã€‚å°†è¿™äº›å…ƒç´ çš„æ•°å­—éƒ¨åˆ†æå–å‡ºæ¥å³å¯ã€‚</li>
</ol>
<h2 id="Go-ä¸­-container-heap-çš„ä½¿ç”¨æ–¹æ³•">Go ä¸­ <code>container/heap</code> çš„ä½¿ç”¨æ–¹æ³•</h2>
<p>Go è¯­è¨€æ ‡å‡†åº“ <code>container/heap</code> æä¾›äº†ä¸€ä¸ªå®ç°å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰çš„æ¥å£ã€‚è¦ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œå¹¶ä¸ºè¯¥ç±»å‹å®ç° <code>heap.Interface</code> æ¥å£ï¼Œè¯¥æ¥å£åŒ…å«ä»¥ä¸‹äº”ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>Len() int</code>ï¼šè¿”å›é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚</li>
<li><code>Less(i, j int) bool</code>ï¼šæ¯”è¾ƒç´¢å¼•ä¸º <code>i</code> å’Œ <code>j</code> çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœ <code>heap[i]</code> åº”è¯¥æ’åœ¨ <code>heap[j]</code> å‰é¢ï¼Œåˆ™è¿”å› <code>true</code>ã€‚å¯¹äºå°é¡¶å †ï¼Œå¦‚æœ <code>heap[i] &lt; heap[j]</code> åˆ™è¿”å› <code>true</code>ï¼›å¯¹äºå¤§é¡¶å †ï¼Œå¦‚æœ <code>heap[i] &gt; heap[j]</code> åˆ™è¿”å› <code>true</code>ã€‚</li>
<li><code>Swap(i, j int)</code>ï¼šäº¤æ¢ç´¢å¼•ä¸º <code>i</code> å’Œ <code>j</code> çš„ä¸¤ä¸ªå…ƒç´ ã€‚</li>
<li><code>Push(x interface&#123;&#125;)</code>ï¼šå‘å †ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´  <code>x</code>ã€‚æ³¨æ„ <code>x</code> çš„ç±»å‹æ˜¯ <code>interface&#123;&#125;</code>ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šå°†å…¶æ–­è¨€ä¸ºæˆ‘ä»¬å®šä¹‰çš„å…ƒç´ ç±»å‹ã€‚è¿™ä¸ªæ–¹æ³•é€šå¸¸æ˜¯è¿½åŠ å…ƒç´ åˆ°å†…éƒ¨çš„ slice æœ«å°¾ã€‚</li>
<li><code>Pop() interface&#123;&#125;</code>ï¼šç§»é™¤å¹¶è¿”å›å †é¡¶å…ƒç´ ï¼ˆå¯¹äºå°é¡¶å †æ˜¯æœ€å°å…ƒç´ ï¼Œå¯¹äºå¤§é¡¶å †æ˜¯æœ€å¤§å…ƒç´ ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•é€šå¸¸æ˜¯ç§»é™¤å†…éƒ¨ slice çš„æœ«å°¾å…ƒç´ ã€‚</li>
</ul>
<h3 id="é’ˆå¯¹æœ¬é¢˜çš„å †å®ç°">é’ˆå¯¹æœ¬é¢˜çš„å †å®ç°</h3>
<p>ä¸ºäº†è§£å†³â€œå‰ K ä¸ªé«˜é¢‘å…ƒç´ â€çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>å°é¡¶å †</strong>ï¼Œå †ä¸­å…ƒç´ çš„æ¯”è¾ƒåŸºå‡†æ˜¯å®ƒä»¬çš„<strong>é¢‘ç‡</strong>ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;container/heap&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å †ä¸­å…ƒç´ çš„ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> FreqElement <span class="keyword">struct</span> &#123;</span><br><span class="line">	Val   <span class="type">int</span> <span class="comment">// å…ƒç´ å€¼</span></span><br><span class="line">	Count <span class="type">int</span> <span class="comment">// å…ƒç´ å‡ºç°çš„é¢‘ç‡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œå®ƒå®ç°äº† heap.Interface æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> MinHeap []FreqElement</span><br><span class="line"></span><br><span class="line"><span class="comment">// Len è¿”å›å †ä¸­å…ƒç´ çš„æ•°é‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h MinHeap)</span></span> Len() <span class="type">int</span> &#123; <span class="keyword">return</span> <span class="built_in">len</span>(h) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Less æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„é¢‘ç‡ï¼Œç”¨äºæ„å»ºå°é¡¶å †</span></span><br><span class="line"><span class="comment">// å¦‚æœ h[i] çš„é¢‘ç‡å°äº h[j] çš„é¢‘ç‡ï¼Œåˆ™ h[i] åº”è¯¥æ’åœ¨ h[j] å‰é¢</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h MinHeap)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> h[i].Count &lt; h[j].Count &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swap äº¤æ¢å †ä¸­ä¸¤ä¸ªå…ƒç´ çš„ä½ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h MinHeap)</span></span> Swap(i, j <span class="type">int</span>) &#123; h[i], h[j] = h[j], h[i] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Push å‘å †ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šPush æ–¹æ³•çš„å‚æ•°æ˜¯ interface&#123;&#125;ï¼Œéœ€è¦ç±»å‹æ–­è¨€</span></span><br><span class="line"><span class="comment">// heap.Push ä¼šè°ƒç”¨è¿™ä¸ª Push æ–¹æ³•ï¼Œå¹¶å°†å…ƒç´ è¿½åŠ åˆ° slice çš„æœ«å°¾</span></span><br><span class="line"><span class="comment">// ç„¶åé€šè¿‡ up è°ƒæ•´å †ç»“æ„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MinHeap)</span></span> Push(x <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	*h = <span class="built_in">append</span>(*h, x.(FreqElement))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pop ä»å †ä¸­ç§»é™¤å¹¶è¿”å›æœ€å°é¢‘ç‡çš„å…ƒç´ ï¼ˆå †é¡¶å…ƒç´ ï¼‰</span></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šPop æ–¹æ³•è¿”å›çš„æ˜¯ interface&#123;&#125;ï¼Œéœ€è¦ç±»å‹æ–­è¨€</span></span><br><span class="line"><span class="comment">// heap.Pop ä¼šå…ˆå°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œç„¶åç§»é™¤æœ«å°¾å…ƒç´ </span></span><br><span class="line"><span class="comment">// å†é€šè¿‡ down è°ƒæ•´å †ç»“æ„ï¼Œæœ€åè¿”å›ç§»é™¤çš„å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MinHeap)</span></span> Pop() <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">	old := *h</span><br><span class="line">	n := <span class="built_in">len</span>(old)</span><br><span class="line">	x := old[n<span class="number">-1</span>]</span><br><span class="line">	*h = old[<span class="number">0</span> : n<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> leetcode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;container/heap&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FreqElement å®šä¹‰å †ä¸­å…ƒç´ çš„ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> FreqElement <span class="keyword">struct</span> &#123;</span><br><span class="line">	Val   <span class="type">int</span> <span class="comment">// å…ƒç´ å€¼</span></span><br><span class="line">	Count <span class="type">int</span> <span class="comment">// å…ƒç´ å‡ºç°çš„é¢‘ç‡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MinHeap å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œå®ƒå®ç°äº† heap.Interface æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> MinHeap []FreqElement</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h MinHeap)</span></span> Len() <span class="type">int</span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(h) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h MinHeap)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> h[i].Count &lt; h[j].Count &#125; <span class="comment">// å°é¡¶å †ï¼ŒæŒ‰é¢‘ç‡æ¯”è¾ƒ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h MinHeap)</span></span> Swap(i, j <span class="type">int</span>)      &#123; h[i], h[j] = h[j], h[i] &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MinHeap)</span></span> Push(x <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	*h = <span class="built_in">append</span>(*h, x.(FreqElement))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *MinHeap)</span></span> Pop() <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">	old := *h</span><br><span class="line">	n := <span class="built_in">len</span>(old)</span><br><span class="line">	x := old[n<span class="number">-1</span>]</span><br><span class="line">	*h = old[<span class="number">0</span> : n<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">topKFrequent</span><span class="params">(nums []<span class="type">int</span>, k <span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// 1. ç»Ÿè®¡å…ƒç´ é¢‘ç‡</span></span><br><span class="line">	freqMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>)</span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		freqMap[num]++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. æ„å»ºå°é¡¶å †</span></span><br><span class="line">	h := &amp;MinHeap&#123;&#125;</span><br><span class="line">	heap.Init(h) <span class="comment">// åˆå§‹åŒ–å †</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. éå†é¢‘ç‡æ˜ å°„ï¼Œç»´æŠ¤å¤§å°ä¸º k çš„å°é¡¶å †</span></span><br><span class="line">	<span class="keyword">for</span> val, count := <span class="keyword">range</span> freqMap &#123;</span><br><span class="line">		<span class="keyword">if</span> h.Len() &lt; k &#123;</span><br><span class="line">			heap.Push(h, FreqElement&#123;Val: val, Count: count&#125;)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// å¦‚æœå½“å‰å…ƒç´ çš„é¢‘ç‡å¤§äºå †é¡¶å…ƒç´ çš„é¢‘ç‡ï¼ˆå †é¡¶æ˜¯å½“å‰kä¸ªå…ƒç´ ä¸­é¢‘ç‡æœ€å°çš„ï¼‰</span></span><br><span class="line">			<span class="comment">// åˆ™å¼¹å‡ºå †é¡¶ï¼Œå¹¶å°†å½“å‰å…ƒç´ å‹å…¥å †</span></span><br><span class="line">			<span class="keyword">if</span> count &gt; (*h)[<span class="number">0</span>].Count &#123; <span class="comment">// (*h)[0] æ˜¯å †é¡¶å…ƒç´ </span></span><br><span class="line">				heap.Pop(h)</span><br><span class="line">				heap.Push(h, FreqElement&#123;Val: val, Count: count&#125;)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. æå–ç»“æœ</span></span><br><span class="line">	result := <span class="built_in">make</span>([]<span class="type">int</span>, k)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k; i++ &#123;</span><br><span class="line">		<span class="comment">// Popå‡ºæ¥çš„æ˜¯é¢‘ç‡æœ€å°çš„ï¼Œä½†å› ä¸ºæˆ‘ä»¬ç»´æŠ¤çš„æ˜¯å¤§å°ä¸ºkçš„å †ï¼Œ</span></span><br><span class="line">		<span class="comment">// å¹¶ä¸”ä¸æ–­ç”¨æ›´é«˜é¢‘ç‡çš„å…ƒç´ æ›¿æ¢ä½é¢‘ç‡çš„ï¼Œæ‰€ä»¥æœ€åå †é‡Œå‰©ä¸‹çš„å°±æ˜¯å‰kä¸ªé«˜é¢‘å…ƒç´ ã€‚</span></span><br><span class="line">		<span class="comment">// é¢˜ç›®å¯¹é¡ºåºæ²¡æœ‰è¦æ±‚ï¼Œæ‰€ä»¥ç›´æ¥Popå³å¯ã€‚</span></span><br><span class="line">		<span class="comment">// å¦‚æœéœ€è¦æŒ‰é¢‘ç‡ä»é«˜åˆ°ä½è¾“å‡ºï¼Œåˆ™éœ€è¦å…ˆå°†æ‰€æœ‰å…ƒç´ å‹å…¥å¤§é¡¶å †ï¼Œç„¶åPop kæ¬¡ã€‚</span></span><br><span class="line">		<span class="comment">// æˆ–è€…ï¼Œå°†å°é¡¶å †çš„å…ƒç´ å–å‡ºååè½¬ã€‚</span></span><br><span class="line">		<span class="comment">// è¿™é‡Œæˆ‘ä»¬ç›´æ¥æŒ‰Popçš„é¡ºåºï¼ˆé¢‘ç‡ä»å°åˆ°å¤§ï¼Œä½†éƒ½æ˜¯å‰kä¸ªé«˜é¢‘çš„ï¼‰æ”¾å…¥ç»“æœæ•°ç»„ï¼Œç„¶ååè½¬ã€‚</span></span><br><span class="line">		<span class="comment">// æˆ–è€…ï¼Œæ›´ç®€å•åœ°ï¼Œå› ä¸ºé¢˜ç›®ä¸è¦æ±‚é¡ºåºï¼Œå¯ä»¥ç›´æ¥ä»å †ä¸­å–å‡ºã€‚</span></span><br><span class="line">		result[i] = heap.Pop(h).(FreqElement).Val</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// å¦‚æœéœ€è¦æŒ‰é¢‘ç‡ä»é«˜åˆ°ä½è¾“å‡ºï¼Œå¯ä»¥å¯¹resultè¿›è¡Œä¸€æ¬¡åè½¬</span></span><br><span class="line">    <span class="comment">// for i, j := 0, len(result)-1; i &lt; j; i, j = i+1, j-1 &#123;</span></span><br><span class="line">	<span class="comment">// 	result[i], result[j] = result[j], result[i]</span></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å“ˆå¸Œè¡¨ + æ’åº</th>
<th>å“ˆå¸Œè¡¨ + å°é¡¶å † (æœ¬è§£æ³•)</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(N + M log M)ï¼Œå…¶ä¸­ N æ˜¯æ•°ç»„é•¿åº¦ï¼ŒM æ˜¯ä¸åŒå…ƒç´ çš„ä¸ªæ•°</td>
<td>O(N + M log K)ï¼Œå…¶ä¸­ N æ˜¯æ•°ç»„é•¿åº¦ï¼ŒM æ˜¯ä¸åŒå…ƒç´ çš„ä¸ªæ•°ï¼ŒK æ˜¯è¦æ‰¾çš„å…ƒç´ ä¸ªæ•°</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(M)</td>
<td>O(M + K)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç›¸å¯¹ç®€å•</td>
<td>æ—¶é—´å¤æ‚åº¦æ›´ä¼˜ï¼Œç‰¹åˆ«æ˜¯å½“ M è¿œå¤§äº K æ—¶</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å½“ä¸åŒå…ƒç´ å¾ˆå¤šæ—¶ï¼Œæ’åºå¼€é”€å¤§</td>
<td>å®ç°ç•¥å¤æ‚ï¼Œéœ€è¦è‡ªå®šä¹‰å †ç»“æ„</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>å“ˆå¸Œè¡¨ + æ’åº</strong>ï¼šå…ˆç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡é¢‘ç‡ (O(N))ï¼Œç„¶åå°†å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ï¼ˆå€¼å’Œé¢‘ç‡ï¼‰å­˜å…¥ä¸€ä¸ªåˆ—è¡¨å¹¶æŒ‰é¢‘ç‡æ’åº (O(M log M))ï¼Œæœ€åå–å‰ K ä¸ªã€‚</li>
<li><strong>å“ˆå¸Œè¡¨ + å°é¡¶å †</strong>ï¼šå…ˆç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡é¢‘ç‡ (O(N))ï¼Œç„¶åéå†å“ˆå¸Œè¡¨ä¸­çš„ M ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ è¿›è¡Œå †æ“ä½œ (Push/Pop)ï¼Œå †æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(log K)ã€‚æ‰€ä»¥è¿™éƒ¨åˆ†æ˜¯ O(M log K)ã€‚</li>
</ul>
<p>ç”±äºé¢˜ç›®è¦æ±‚æ—¶é—´å¤æ‚åº¦ä¼˜äº O(<em>n</em> log <em>n</em>)ï¼Œå½“ M æ¥è¿‘ N æ—¶ï¼ŒO(N + M log M) çº¦ç­‰äº O(N log N)ï¼Œå¯èƒ½ä¸æ»¡è¶³è¦æ±‚ã€‚è€Œ O(N + M log K) é€šå¸¸ä¼šæ›´å¥½ã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š
<ul>
<li>ç»Ÿè®¡é¢‘ç‡ï¼šO(N)ï¼Œå…¶ä¸­ N æ˜¯æ•°ç»„ <code>nums</code> çš„é•¿åº¦ã€‚</li>
<li>æ„å»ºå’Œç»´æŠ¤å †ï¼šæˆ‘ä»¬éå† <code>freqMap</code>ï¼Œå…¶å¤§å°æœ€å¤šä¸º N (å½“æ‰€æœ‰å…ƒç´ éƒ½ä¸åŒæ—¶ï¼Œè®°ä¸º Mï¼ŒM &lt;= N)ã€‚å¯¹äº <code>freqMap</code> ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸€æ¬¡å †æ“ä½œï¼ˆ<code>Push</code> æˆ– <code>Pop</code> å <code>Push</code>ï¼‰ã€‚å †çš„å¤§å°æœ€å¤šä¸º Kã€‚å› æ­¤ï¼Œå †æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(log K)ã€‚æ€»å…±æ˜¯ O(M log K)ã€‚</li>
<li>æ‰€ä»¥ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N + M log K)ã€‚</li>
</ul>
</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š
<ul>
<li>å“ˆå¸Œè¡¨ <code>freqMap</code>ï¼šæœ€åæƒ…å†µä¸‹å­˜å‚¨ M ä¸ªä¸åŒå…ƒç´ ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(M)ã€‚</li>
<li>å † <code>h</code>ï¼šå­˜å‚¨ K ä¸ªå…ƒç´ ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(K)ã€‚</li>
<li>æ‰€ä»¥ï¼Œæ€»çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(M + K)ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li>ç†è§£å“ˆå¸Œè¡¨åœ¨ç»Ÿè®¡é¢‘ç‡é—®é¢˜ä¸­çš„é«˜æ•ˆåº”ç”¨ã€‚</li>
<li>æŒæ¡ Go è¯­è¨€ä¸­ <code>container/heap</code> åŒ…çš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬å¦‚ä½•å®šä¹‰è‡ªå®šä¹‰ç±»å‹å¹¶å®ç° <code>heap.Interface</code> æ¥å£ã€‚</li>
<li>å­¦ä¼šä½¿ç”¨å°é¡¶å †æ¥è§£å†³â€œå‰ K å¤§/é«˜â€è¿™ç±»é—®é¢˜ï¼Œé€šè¿‡ç»´æŠ¤ä¸€ä¸ªå›ºå®šå¤§å°çš„å †ï¼Œä¸æ–­å°†æ›´ä¼˜çš„å…ƒç´ æ›¿æ¢å †é¡¶å…ƒç´ ã€‚</li>
<li>å¯¹äºéœ€è¦è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œ<code>container/heap</code> æä¾›äº†çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å †</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>å †</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 84 - æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢</title>
    <url>/2025/05/13/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-84-%E6%9F%B1%E7%8A%B6%E5%9B%BE%E4%B8%AD%E6%9C%80%E5%A4%A7%E7%9A%84%E7%9F%A9%E5%BD%A2/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®š n ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1 ã€‚</p>
<p>æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚</p>
<p><img src="/2025/05/13/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-84-%E6%9F%B1%E7%8A%B6%E5%9B%BE%E4%B8%AD%E6%9C%80%E5%A4%A7%E7%9A%84%E7%9F%A9%E5%BD%A2/1747066251581.png" alt="1747066251581"></p>
<p>ç¤ºä¾‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šheights = [2,1,5,6,2,3]</span><br><span class="line">è¾“å‡ºï¼š10</span><br><span class="line">è§£é‡Šï¼šæœ€å¤§çš„çŸ©å½¢æ˜¯ä»ç¬¬ä¸‰ä¸ªæŸ±å­å¼€å§‹ï¼Œåˆ°ç¬¬å››ä¸ªæŸ±å­ç»“æŸï¼Œé«˜åº¦ä¸º 5ï¼Œå®½åº¦ä¸º 2ï¼Œé¢ç§¯ä¸º 10</span><br></pre></td></tr></table></figure>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™æš—è—ç„æœºã€‚æˆ‘ä»¬éœ€è¦åœ¨æŸ±çŠ¶å›¾ä¸­æ‰¾å‡ºé¢ç§¯æœ€å¤§çš„çŸ©å½¢ã€‚ç›´è§‚ä¸Šçœ‹ï¼Œè¿™ä¸ªçŸ©å½¢å¿…é¡»ä»¥æŸä¸ªæŸ±å­çš„é«˜åº¦ä¸ºé«˜ï¼Œç„¶åå‘ä¸¤è¾¹å°½å¯èƒ½å»¶ä¼¸ã€‚</p>
<p>æƒ³è±¡ä½ åœ¨ä¸€æ’é«˜çŸ®ä¸ä¸€çš„æ¥¼æˆ¿ä¸­å¯»æ‰¾èƒ½æ”¾ç½®ä¸€ä¸ªæœ€å¤§é•¿æ–¹å½¢å¹¿å‘Šç‰Œçš„ä½ç½®ï¼Œä½ éœ€è¦è€ƒè™‘ï¼š</p>
<ol>
<li>æ¯ä¸ªæ¥¼çš„é«˜åº¦ï¼ˆå†³å®šäº†å¹¿å‘Šç‰Œçš„é«˜åº¦ï¼‰</li>
<li>èƒ½åœ¨å¤šå°‘ä¸ªç›¸é‚»æ¥¼ä¸Šæ”¾ï¼ˆå†³å®šäº†å¹¿å‘Šç‰Œçš„å®½åº¦ï¼‰</li>
</ol>
<p>æˆ‘ä»¬å°†ä»‹ç»ä¸‰ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šä»æœ€ç›´è§‚ä½†æ•ˆç‡è¾ƒä½çš„æš´åŠ›æ³•ï¼Œåˆ°é«˜æ•ˆç²¾å·§çš„å•è°ƒæ ˆè§£æ³•ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šæš´åŠ›æ³•-æœ€ç›´è§‚çš„è§£æ³•">æ–¹æ³•ä¸€ï¼šæš´åŠ›æ³• - æœ€ç›´è§‚çš„è§£æ³•</h3>
<p>æš´åŠ›æ³•å°±åƒæ˜¯æˆ‘ä»¬ä¸€ä¸ªä¸ªå°è¯•æ‰€æœ‰å¯èƒ½çš„çŸ©å½¢ï¼Œå°±åƒå°å­©å­ä¸€æ ·æŒ¨ä¸ªè¯•ä¸€è¯•ã€‚</p>
<p>æ€è·¯éå¸¸ç›´ç™½ï¼š</p>
<ol>
<li>æˆ‘ä»¬å…ˆé€‰å®šä¸€ä¸ªæŸ±å­ï¼ŒæŠŠå®ƒçš„é«˜åº¦ä½œä¸ºçŸ©å½¢çš„é«˜</li>
<li>ç„¶ååƒæ©¡çš®ç­‹ä¸€æ ·ï¼Œå°½å¯èƒ½åœ°å‘å·¦å³ä¸¤è¾¹æ‹‰ä¼¸ï¼Œç›´åˆ°ç¢°åˆ°æ¯”è¿™ä¸ªæŸ±å­çŸ®çš„ä¸ºæ­¢</li>
<li>è®¡ç®—æ­¤æ—¶çš„é¢ç§¯ï¼Œè®°å½•ä¸‹æœ€å¤§å€¼</li>
</ol>
<p>æ¯”å¦‚å¯¹äºæŸ±å­é«˜åº¦ <code>[2,1,5,6,2,3]</code>ï¼š</p>
<ul>
<li>å¦‚æœé€‰æ‹©é«˜åº¦ 5 çš„æŸ±å­ï¼Œæˆ‘ä»¬ä¸èƒ½å‘å·¦æ‹‰ä¼¸ï¼ˆå› ä¸ºå·¦è¾¹çš„ 1 æ¯” 5 çŸ®ï¼‰ï¼Œä½†å¯ä»¥å‘å³æ‹‰ä¼¸ä¸€æ ¼ï¼ˆå› ä¸ºå³è¾¹çš„ 6 æ¯” 5 é«˜ï¼‰</li>
<li>æ­¤æ—¶å¾—åˆ°çš„çŸ©å½¢å®½åº¦æ˜¯ 2ï¼Œé«˜åº¦æ˜¯ 5ï¼Œé¢ç§¯ä¸º 10</li>
</ul>
<p>è¿™æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•ï¼Œä¹Ÿæœ€ç¬¦åˆæˆ‘ä»¬çš„ç›´è§‰æ€ç»´ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">largestRectangleArea</span><span class="params">(heights []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(heights)</span><br><span class="line">    maxArea := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        height := heights[i]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å·¦æ‰©å±•</span></span><br><span class="line">        left := i</span><br><span class="line">        <span class="keyword">for</span> left &gt; <span class="number">0</span> &amp;&amp; heights[left<span class="number">-1</span>] &gt;= height &#123;</span><br><span class="line">            left--</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å³æ‰©å±•</span></span><br><span class="line">        right := i</span><br><span class="line">        <span class="keyword">for</span> right &lt; n<span class="number">-1</span> &amp;&amp; heights[right+<span class="number">1</span>] &gt;= height &#123;</span><br><span class="line">            right++</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—é¢ç§¯</span></span><br><span class="line">        width := right - left + <span class="number">1</span></span><br><span class="line">        area := height * width</span><br><span class="line">        maxArea = max(maxArea, area)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> maxArea</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¶é—´å¤æ‚åº¦ï¼š$O(nÂ²)$ï¼Œå…¶ä¸­ n æ˜¯è¾“å…¥æ•°ç»„çš„é•¿åº¦ã€‚<br>
ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚</p>
<p>è¿™ç§æ–¹æ³•åœ¨ LeetCode ä¸Šä¼šè¶…æ—¶ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ›´é«˜æ•ˆçš„ç®—æ³•ã€‚</p>
<h3 id="æ–¹æ³•äºŒï¼šåˆ†æ²»æ³•-å·§å¦™åœ°åˆ†å‰²é—®é¢˜">æ–¹æ³•äºŒï¼šåˆ†æ²»æ³• - å·§å¦™åœ°åˆ†å‰²é—®é¢˜</h3>
<p>åˆ†æ²»æ³•çš„æ€æƒ³å°±åƒ&quot;å…µåˆ†ä¸¤è·¯&quot;æˆ˜æœ¯ï¼š</p>
<ol>
<li>é¦–å…ˆæ‰¾åˆ°æ•´ä¸ªæŸ±çŠ¶å›¾ä¸­<strong>æœ€çŸ®çš„é‚£ä¸ªæŸ±å­</strong>ï¼ˆå°±åƒæ‰¾åˆ°ä¸€ä¸ªå†›äº‹åˆ†ç•Œçº¿ï¼‰</li>
<li>ç”¨è¿™ä¸ªæœ€çŸ®æŸ±å­çš„é«˜åº¦ä¹˜ä»¥æ•´ä¸ªå›¾çš„å®½åº¦ï¼Œå¾—åˆ°ä¸€ä¸ªå¯èƒ½çš„é¢ç§¯</li>
<li>ç„¶åå°†é—®é¢˜åˆ†æˆä¸¤åŠï¼šæœ€çŸ®æŸ±å­å·¦è¾¹çš„éƒ¨åˆ†å’Œå³è¾¹çš„éƒ¨åˆ†</li>
<li>åˆ†åˆ«åœ¨è¿™ä¸¤éƒ¨åˆ†ä¸­ç»§ç»­å¯»æ‰¾æœ€å¤§é¢ç§¯</li>
<li>æœ€åä»è¿™ä¸‰ä¸ªé¢ç§¯ï¼ˆæ¨ªè·¨æ•´ä¸ªåŒºåŸŸçš„ã€åªåœ¨å·¦åŠéƒ¨åˆ†çš„ã€åªåœ¨å³åŠéƒ¨åˆ†çš„ï¼‰ä¸­å–æœ€å¤§å€¼</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„å¦™å¤„åœ¨äºï¼šå¯¹äºæ¨ªè·¨çš„çŸ©å½¢ï¼Œé«˜åº¦å—é™äºæœ€çŸ®çš„æŸ±å­ï¼›å¯¹äºä¸åŒ…å«æœ€çŸ®æŸ±å­çš„çŸ©å½¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­åŒºåŸŸä¸­é‡å¤æ­¤è¿‡ç¨‹ã€‚</p>
<p>çœ‹ä¸€ä¸ªç”ŸåŠ¨ä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬æœ‰æŸ±å­ <code>[3,1,4,2]</code>ï¼š</p>
<ul>
<li>æœ€çŸ®çš„æŸ±å­æ˜¯ç¬¬äºŒä¸ªï¼Œé«˜åº¦ä¸º 1</li>
<li>ç”¨å®ƒè®¡ç®—ä¸€ä¸ªé¢ç§¯ï¼š1Ã—4 = 4</li>
<li>åˆ†å‰²æˆå·¦åŠéƒ¨åˆ† <code>[3]</code> å’Œå³åŠéƒ¨åˆ† <code>[4,2]</code></li>
<li>åœ¨å·¦åŠéƒ¨åˆ†ä¸­ï¼Œæœ€å¤§é¢ç§¯æ˜¯ 3Ã—1 = 3</li>
<li>åœ¨å³åŠéƒ¨åˆ†ä¸­ï¼Œæœ€å¤§é¢ç§¯æ˜¯ 2Ã—2 = 4</li>
<li>æœ€ç»ˆçš„æœ€å¤§é¢ç§¯æ˜¯ 4</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">largestRectangleArea</span><span class="params">(heights []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> calculateArea(heights, <span class="number">0</span>, <span class="built_in">len</span>(heights)<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculateArea</span><span class="params">(heights []<span class="type">int</span>, start, end <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> start &gt; end &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> start == end &#123;</span><br><span class="line">        <span class="keyword">return</span> heights[start]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¾åˆ°æœ€å°é«˜åº¦çš„ç´¢å¼•</span></span><br><span class="line">    minIdx := start</span><br><span class="line">    <span class="keyword">for</span> i := start; i &lt;= end; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> heights[i] &lt; heights[minIdx] &#123;</span><br><span class="line">            minIdx = i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ä¸‰ç§å¯èƒ½çš„æƒ…å†µä¸‹çš„æœ€å¤§é¢ç§¯</span></span><br><span class="line">    useMin := heights[minIdx] * (end - start + <span class="number">1</span>)</span><br><span class="line">    leftArea := calculateArea(heights, start, minIdx<span class="number">-1</span>)</span><br><span class="line">    rightArea := calculateArea(heights, minIdx+<span class="number">1</span>, end)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> max(useMin, max(leftArea, rightArea))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¶é—´å¤æ‚åº¦ï¼šå¹³å‡æƒ…å†µä¸‹ä¸º $O(n \log n)$ï¼Œæœ€åæƒ…å†µä¸‹ä¸º $O(nÂ²)$ã€‚<br>
ç©ºé—´å¤æ‚åº¦ï¼š$O(\log n)$ï¼Œé€’å½’è°ƒç”¨æ ˆçš„ç©ºé—´ã€‚</p>
<h3 id="æ–¹æ³•ä¸‰ï¼šå•è°ƒæ ˆï¼ˆæœ€ä¼˜è§£ï¼‰-èªæ˜çš„ä¸€è¶Ÿæ‰«ææ³•">æ–¹æ³•ä¸‰ï¼šå•è°ƒæ ˆï¼ˆæœ€ä¼˜è§£ï¼‰- èªæ˜çš„ä¸€è¶Ÿæ‰«ææ³•</h3>
<p>å•è°ƒæ ˆå°±åƒæ˜¯ä¸€ä¸ªèªæ˜çš„&quot;ä¾¦å¯Ÿå…µ&quot;ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æ‰¾å‡ºæ¯ä¸ªæŸ±å­çš„&quot;å·¦å³é‚»å±…&quot;ï¼ˆå·¦å³ä¸¤è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒçŸ®çš„æŸ±å­ï¼‰ã€‚</p>
<h4 id="å•è°ƒæ ˆçš„åŸç†é€šä¿—è§£é‡Š">å•è°ƒæ ˆçš„åŸç†é€šä¿—è§£é‡Š</h4>
<p>æƒ³è±¡ä½ ç«™åœ¨å¹³åŸä¸Šçœ‹ä¸€æ’é«˜ä½ä¸åŒçš„æ¥¼æˆ¿ï¼Œä½†ä½ åªèƒ½çœ‹åˆ°é‚£äº›æ²¡è¢«å‰é¢æ›´é«˜æ¥¼æˆ¿æŒ¡ä½çš„æ¥¼ï¼š</p>
<ol>
<li>æˆ‘ä»¬ä»å·¦åˆ°å³èµ°ï¼Œç”¨ä¸€ä¸ªæ ˆè®°å½•&quot;èƒ½çœ‹åˆ°çš„æ¥¼æˆ¿&quot;</li>
<li>å½“é‡åˆ°ä¸€ä¸ªæ¯”æ ˆé¡¶æ›´çŸ®çš„æ¥¼æ—¶ï¼Œæ„å‘³ç€æ ˆé¡¶æ¥¼çš„&quot;å³è¾¹ç•Œ&quot;å·²ç»ç¡®å®š</li>
<li>æ­¤æ—¶ï¼Œæˆ‘ä»¬è®¡ç®—ä»¥æ ˆé¡¶æ¥¼é«˜ä¸ºé«˜çš„çŸ©å½¢é¢ç§¯ï¼Œç„¶åå°†å®ƒä»æ ˆä¸­ç§»é™¤</li>
<li>é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ ˆé¡¶æ¥¼ä¸å†æ¯”å½“å‰æ¥¼é«˜</li>
<li>æœ€åï¼Œæˆ‘ä»¬æŠŠå½“å‰æ¥¼ä¹ŸåŠ å…¥åˆ°æ ˆä¸­</li>
</ol>
<p><strong>å…³é”®æ´è§</strong>ï¼šé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯¹äºæ¯ä¸ªæŸ±å­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ‰¾åˆ°ï¼š</p>
<ul>
<li>å®ƒå·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒçŸ®çš„æŸ±å­ï¼ˆæ ˆä¸­å®ƒä¸‹é¢çš„å…ƒç´ ï¼‰</li>
<li>å®ƒå³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒçŸ®çš„æŸ±å­ï¼ˆå¯¼è‡´å®ƒè¢«å¼¹å‡ºæ ˆçš„å…ƒç´ ï¼‰</li>
</ul>
<p>æœ‰äº†è¿™ä¸¤ä¸ªè¾¹ç•Œï¼Œæˆ‘ä»¬å°±èƒ½è®¡ç®—ä»¥è¿™ä¸ªæŸ±å­é«˜åº¦ä¸ºé«˜çš„æœ€å¤§çŸ©å½¢é¢ç§¯ã€‚</p>
<p>è¿™ç§æ–¹æ³•åªéœ€è¦éå†æ•°ç»„ä¸€æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ $O(n)$ï¼Œæ˜¯æœ€é«˜æ•ˆçš„è§£æ³•ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">largestRectangleArea</span><span class="params">(heights []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    stack := []<span class="type">int</span>&#123;<span class="number">-1</span>&#125;  <span class="comment">// è¾…åŠ©æ ˆï¼Œåˆå§‹æ”¾å…¥-1ä½œä¸ºè¾¹ç•Œ</span></span><br><span class="line">    maxArea := <span class="number">0</span></span><br><span class="line">    n := <span class="built_in">len</span>(heights)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ¯ä¸ªæŸ±å­</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> heights &#123;</span><br><span class="line">        <span class="comment">// å½“æ ˆé¡¶å…ƒç´ å¯¹åº”çš„æŸ±å­é«˜åº¦å¤§äºå½“å‰æŸ±å­é«˜åº¦æ—¶</span></span><br><span class="line">        <span class="keyword">for</span> stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] != <span class="number">-1</span> &amp;&amp; heights[i] &lt; heights[stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]] &#123;</span><br><span class="line">            <span class="comment">// å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œè®¡ç®—ä»¥è¯¥æŸ±å­é«˜åº¦ä¸ºé«˜çš„çŸ©å½¢é¢ç§¯</span></span><br><span class="line">            height := heights[stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]]</span><br><span class="line">            stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¡ç®—å®½åº¦ï¼šå½“å‰ä½ç½® - æ–°æ ˆé¡¶ä½ç½® - 1</span></span><br><span class="line">            width := i - stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›´æ–°æœ€å¤§é¢ç§¯</span></span><br><span class="line">            maxArea = max(maxArea, height * width)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†å½“å‰æŸ±å­çš„ç´¢å¼•å…¥æ ˆ</span></span><br><span class="line">        stack = <span class="built_in">append</span>(stack, i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†æ ˆä¸­å‰©ä½™çš„æŸ±å­</span></span><br><span class="line">    <span class="keyword">for</span> stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] != <span class="number">-1</span> &#123;</span><br><span class="line">        height := heights[stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]]</span><br><span class="line">        stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">        width := n - stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] - <span class="number">1</span></span><br><span class="line">        maxArea = max(maxArea, height * width)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> maxArea</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œæ¯ä¸ªå…ƒç´ æœ€å¤šè¢«å…¥æ ˆå‡ºæ ˆå„ä¸€æ¬¡ã€‚<br>
ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œæ ˆçš„ç©ºé—´ã€‚</p>
<h2 id="ä»£ç é”™è¯¯åˆ†æ-æˆ‘çŠ¯çš„é”™è¯¯">ä»£ç é”™è¯¯åˆ†æ - æˆ‘çŠ¯çš„é”™è¯¯</h2>
<p>åœ¨æœ€åˆçš„å®ç°ä¸­ï¼Œæˆ‘çŠ¯äº†ä¸€ä¸ªéå¸¸å¸¸è§ä½†å¾ˆå®¹æ˜“è¢«å¿½è§†çš„é”™è¯¯ï¼š<strong>æ²¡æœ‰å¤„ç†æ ˆä¸­å‰©ä½™çš„å…ƒç´ </strong>ã€‚è¿™å°±åƒæ˜¯ä¹¦å†™ä¸€ç¯‡æ–‡ç« æ—¶å¿˜è®°äº†å†™ç»“å°¾ï¼Œæ•…äº‹æˆ›ç„¶è€Œæ­¢ï¼Œæ˜¾å¾—ä¸å®Œæ•´ã€‚</p>
<h3 id="âŒ-é”™è¯¯çš„ä»£ç ">âŒ é”™è¯¯çš„ä»£ç </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">largestRectangleArea</span><span class="params">(heights []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    stack := []<span class="type">int</span>&#123;<span class="number">-1</span>&#125;</span><br><span class="line">    maxArea := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> heights &#123;</span><br><span class="line">        <span class="keyword">for</span> stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] != <span class="number">-1</span> &amp;&amp; heights[i] &lt; heights[stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]] &#123;</span><br><span class="line">            mid := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">            stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">            left := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">            maxArea = max(maxArea, heights[mid]*(i-left<span class="number">-1</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        stack = <span class="built_in">append</span>(stack, i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> maxArea  <span class="comment">// âŒ é”™è¯¯ï¼šæ²¡æœ‰å¤„ç†æ ˆä¸­å‰©ä½™çš„å…ƒç´ ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› -é€šä¿—è§£é‡Š">é”™è¯¯åŸå›  - é€šä¿—è§£é‡Š</h3>
<p>æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªæ‘„å½±å¸ˆï¼Œè¦ä¸ºä¸€æ’ç«™ç€çš„äººæ‹ç…§ã€‚ä½ çš„è§„åˆ™æ˜¯ï¼š</p>
<ol>
<li>ä»å·¦åˆ°å³çœ‹ï¼Œå½“çœ‹åˆ°ä¸€ä¸ªæ¯”å‰é¢çŸ®çš„äººæ—¶ï¼Œå°±ç»™å‰é¢çš„äººæ‹ç…§</li>
<li>æ‹ç…§æ—¶éœ€è¦ç¡®å®šè¿™ä¸ªäººçš„&quot;å·¦å³è¾¹ç•Œ&quot;ï¼ˆå·¦å³ä¸¤è¾¹ç¬¬ä¸€ä¸ªæ¯”ä»–çŸ®çš„äººï¼‰</li>
</ol>
<p><strong>é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Ÿ</strong> å½“ä½ èµ°å®Œæ•´æ’äººåï¼Œè¿˜æœ‰äº›äººæ²¡æ‹ç…§ï¼è¿™äº›äººå³è¾¹æ²¡æœ‰æ¯”ä»–ä»¬çŸ®çš„äººäº†ï¼Œä½†ä»–ä»¬ä»ç„¶éœ€è¦è¢«æ‹ç…§ã€‚</p>
<p>åœ¨æˆ‘çš„åŸå§‹ä»£ç ä¸­ï¼Œè¿™äº›&quot;å‰©ä¸‹çš„äºº&quot;ï¼ˆæ ˆä¸­å‰©ä½™çš„å…ƒç´ ï¼‰è¢«å®Œå…¨å¿½ç•¥äº†ï¼Œå®ƒä»¬ä»£è¡¨çš„æ½œåœ¨æœ€å¤§çŸ©å½¢æ²¡æœ‰è¢«è®¡ç®—ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºè¾“å…¥ <code>[2,1,5,6,2,3]</code>ï¼Œéå†ç»“æŸåæ ˆä¸­è¿˜ä¼šå‰©ä½™ï¼š</p>
<ul>
<li>ç´¢å¼• <code>-1</code>ï¼ˆå“¨å…µå€¼ï¼Œä¸æ˜¯å®é™…æŸ±å­ï¼‰</li>
<li>ç´¢å¼• <code>1</code>ï¼ˆé«˜åº¦ä¸º 1 çš„æŸ±å­ï¼‰</li>
<li>ç´¢å¼• <code>4</code>ï¼ˆé«˜åº¦ä¸º 2 çš„æŸ±å­ï¼‰</li>
<li>ç´¢å¼• <code>5</code>ï¼ˆé«˜åº¦ä¸º 3 çš„æŸ±å­ï¼‰</li>
</ul>
<p>è¿™ä¸‰ä¸ªå®é™…æŸ±å­<strong>å¯èƒ½å½¢æˆçš„çŸ©å½¢éƒ½æ²¡æœ‰è¢«è€ƒè™‘</strong>ï¼</p>
<h3 id="âœ…-ä¿®æ­£çš„è§£æ³•">âœ… ä¿®æ­£çš„è§£æ³•</h3>
<p>æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œéå†ç»“æŸåï¼Œè¿˜éœ€è¦&quot;æ¸…ç©ºæ ˆ&quot;ï¼Œå¤„ç†æ‰€æœ‰å‰©ä½™çš„å…ƒç´ ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤„ç†æ ˆä¸­å‰©ä½™çš„æŸ±å­</span></span><br><span class="line"><span class="keyword">for</span> stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] != <span class="number">-1</span> &#123;</span><br><span class="line">    mid := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">    stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">    left := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">// è¿™äº›æŸ±å­çš„å³è¾¹ç•Œå°±æ˜¯æ•°ç»„çš„æœ«å°¾</span></span><br><span class="line">    maxArea = max(maxArea, heights[mid]*(n-left<span class="number">-1</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç å°±åƒæ˜¯ç¡®ä¿ç»™æ‰€æœ‰äººéƒ½æ‹äº†ç…§ï¼Œä¸è½ä¸‹ä»»ä½•ä¸€ä¸ªã€‚å¯¹äºè¿™äº›å‰©ä¸‹çš„æŸ±å­ï¼Œå®ƒä»¬çš„å³è¾¹ç•Œå°±æ˜¯æ•´ä¸ªæ•°ç»„çš„æœ«å°¾ï¼ˆå› ä¸ºå³è¾¹æ²¡æœ‰æ›´çŸ®çš„æŸ±å­äº†ï¼‰ã€‚</p>
<h2 id="å•è°ƒæ ˆè§£æ³•å›¾è§£-ä¸€æ­¥ä¸€æ­¥çœ‹æ‡‚">å•è°ƒæ ˆè§£æ³•å›¾è§£ - ä¸€æ­¥ä¸€æ­¥çœ‹æ‡‚</h2>
<p>ä¸ºäº†è®©å•è°ƒæ ˆçš„å·¥ä½œåŸç†æ›´åŠ å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬æ¥é€šè¿‡ä¸€ä¸ªå›¾è§£ç¤ºä¾‹ï¼Œå°±åƒè®²æ•…äº‹ä¸€æ ·å±•ç¤ºè§£é¢˜è¿‡ç¨‹ã€‚ä»¥ <code>[2,1,5,6,2,3]</code> ä¸ºä¾‹ï¼š</p>
<h3 id="å›¾è§£æµç¨‹">å›¾è§£æµç¨‹</h3>
<p><img src="/2025/05/13/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-84-%E6%9F%B1%E7%8A%B6%E5%9B%BE%E4%B8%AD%E6%9C%80%E5%A4%A7%E7%9A%84%E7%9F%A9%E5%BD%A2/1747067025071.png" alt="1747067025071"></p>
<ol>
<li>
<p><strong>åˆå§‹å‡†å¤‡</strong>ï¼š</p>
<ul>
<li>æ ˆ = [-1] ï¼ˆ-1 æ˜¯ä¸€ä¸ªå“¨å…µå€¼ï¼Œè¡¨ç¤ºè¾¹ç•Œï¼‰</li>
<li>maxArea = 0</li>
</ul>
</li>
<li>
<p><strong>å¤„ç†ç¬¬ 1 ä¸ªæŸ±å­ï¼ˆé«˜åº¦=2ï¼‰</strong>ï¼š</p>
<ul>
<li>å› ä¸ºæ ˆä¸ºç©ºï¼Œç›´æ¥å…¥æ ˆ</li>
<li>æ ˆ = [-1, 0] ï¼ˆ0 æ˜¯æŸ±å­çš„ç´¢å¼•ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å¤„ç†ç¬¬ 2 ä¸ªæŸ±å­ï¼ˆé«˜åº¦=1ï¼‰</strong>ï¼š</p>
<ul>
<li>å‘ç° 1 &lt; 2ï¼Œä¹Ÿå°±æ˜¯å½“å‰æŸ±å­æ¯”æ ˆé¡¶æŸ±å­çŸ®</li>
<li>è¿™æ„å‘³ç€æˆ‘ä»¬æ‰¾åˆ°äº†æ ˆé¡¶æŸ±å­çš„å³è¾¹ç•Œï¼</li>
<li>å¼¹å‡ºæ ˆé¡¶ç´¢å¼• 0ï¼Œè®¡ç®—é¢ç§¯ï¼š2 Ã— (1-(-1)-1) = 2</li>
<li>æŠŠå½“å‰æŸ±å­å…¥æ ˆï¼Œæ ˆ = [-1, 1]</li>
</ul>
</li>
<li>
<p><strong>å¤„ç†ç¬¬ 3 ä¸ªæŸ±å­ï¼ˆé«˜åº¦=5ï¼‰</strong>ï¼š</p>
<ul>
<li>5 &gt; 1ï¼Œå½“å‰æŸ±å­æ¯”æ ˆé¡¶é«˜</li>
<li>ç›´æ¥å…¥æ ˆï¼Œæ ˆ = [-1, 1, 2]</li>
</ul>
</li>
<li>
<p><strong>å¤„ç†ç¬¬ 4 ä¸ªæŸ±å­ï¼ˆé«˜åº¦=6ï¼‰</strong>ï¼š</p>
<ul>
<li>6 &gt; 5ï¼Œå½“å‰æŸ±å­æ¯”æ ˆé¡¶é«˜</li>
<li>ç›´æ¥å…¥æ ˆï¼Œæ ˆ = [-1, 1, 2, 3]</li>
</ul>
</li>
<li>
<p><strong>å¤„ç†ç¬¬ 5 ä¸ªæŸ±å­ï¼ˆé«˜åº¦=2ï¼‰</strong>ï¼š</p>
<ul>
<li>2 &lt; 6ï¼Œå½“å‰æŸ±å­æ¯”æ ˆé¡¶çŸ®</li>
<li>å¼¹å‡ºæ ˆé¡¶ç´¢å¼• 3ï¼Œè®¡ç®—é¢ç§¯ï¼š6 Ã— (4-2-1) = 6</li>
<li>2 &lt; 5ï¼Œç»§ç»­å¼¹å‡ºæ ˆé¡¶ç´¢å¼• 2ï¼Œè®¡ç®—é¢ç§¯ï¼š5 Ã— (4-1-1) = 10 â† ç›®å‰æœ€å¤§</li>
<li>2 &gt; 1ï¼Œåœæ­¢å¼¹å‡º</li>
<li>æŠŠå½“å‰æŸ±å­å…¥æ ˆï¼Œæ ˆ = [-1, 1, 4]</li>
</ul>
</li>
<li>
<p><strong>å¤„ç†ç¬¬ 6 ä¸ªæŸ±å­ï¼ˆé«˜åº¦=3ï¼‰</strong>ï¼š</p>
<ul>
<li>3 &gt; 2ï¼Œå½“å‰æŸ±å­æ¯”æ ˆé¡¶é«˜</li>
<li>ç›´æ¥å…¥æ ˆï¼Œæ ˆ = [-1, 1, 4, 5]</li>
</ul>
</li>
<li>
<p><strong>å¤„ç†å‰©ä½™æ ˆä¸­å…ƒç´ </strong>ï¼ˆè¿™ä¸€æ­¥æ˜¯æˆ‘ä¹‹å‰å¿½ç•¥çš„ï¼‰ï¼š</p>
<ul>
<li>å¼¹å‡ºç´¢å¼• 5ï¼Œè®¡ç®—é¢ç§¯ï¼š3 Ã— (6-4-1) = 3</li>
<li>å¼¹å‡ºç´¢å¼• 4ï¼Œè®¡ç®—é¢ç§¯ï¼š2 Ã— (6-1-1) = 8</li>
<li>å¼¹å‡ºç´¢å¼• 1ï¼Œè®¡ç®—é¢ç§¯ï¼š1 Ã— (6-(-1)-1) = 6</li>
</ul>
</li>
</ol>
<p>ç»è¿‡å®Œæ•´è®¡ç®—ï¼Œæœ€å¤§é¢ç§¯æ˜¯ <strong>10</strong>ï¼Œå¯¹åº”çš„æ˜¯é«˜åº¦ä¸º 5ï¼Œå®½åº¦ä¸º 2 çš„çŸ©å½¢ï¼ˆä»ç´¢å¼• 2 åˆ°ç´¢å¼• 3ï¼‰ã€‚</p>
<h3 id="å…³é”®ç†è§£ç‚¹">å…³é”®ç†è§£ç‚¹</h3>
<p>å•è°ƒæ ˆçš„å·§å¦™ä¹‹å¤„åœ¨äºï¼š</p>
<ul>
<li>å…¥æ ˆï¼šå½“å‰æŸ±å­æ¯”æ ˆé¡¶é«˜ï¼Œè¡¨ç¤º&quot;è¿˜ä¸çŸ¥é“å³è¾¹ç•Œåœ¨å“ª&quot;</li>
<li>å‡ºæ ˆï¼šå½“å‰æŸ±å­æ¯”æ ˆé¡¶çŸ®ï¼Œè¡¨ç¤º&quot;æ‰¾åˆ°äº†æ ˆé¡¶æŸ±å­çš„å³è¾¹ç•Œ&quot;</li>
<li>å‰©ä½™å¤„ç†ï¼šéå†ç»“æŸåæ ˆä¸­å‰©ä½™çš„æŸ±å­ï¼Œå®ƒä»¬çš„å³è¾¹ç•Œæ˜¯æ•°ç»„çš„æœ«å°¾</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯åœ¨å¤„ç†ä¸€æ’äººçš„è§†çº¿é—®é¢˜ï¼Œæ¯ä¸ªäººåªèƒ½çœ‹åˆ°å³è¾¹ç¬¬ä¸€ä¸ªæ¯”è‡ªå·±çŸ®çš„äººï¼Œå•è°ƒæ ˆå¸®æˆ‘ä»¬åœ¨ O(n)æ—¶é—´å†…æ‰¾åˆ°äº†æ‰€æœ‰è¿™æ ·çš„å…³ç³»ã€‚</p>
<h2 id="æ€»ç»“ä¸åæ€">æ€»ç»“ä¸åæ€</h2>
<h3 id="ä¸‰ç§æ–¹æ³•çš„å¯¹æ¯”">ä¸‰ç§æ–¹æ³•çš„å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>æš´åŠ›æ³•</td>
<td>æœ€ç›´è§‚æ˜“æ‡‚</td>
<td>æ•ˆç‡ä½</td>
<td>$O(nÂ²)$</td>
<td>æ•°æ®é‡å°ï¼Œé¢è¯•åˆæ­¥æ€è·¯</td>
</tr>
<tr>
<td>åˆ†æ²»æ³•</td>
<td>æ€è·¯ä¼˜é›…</td>
<td>å®ç°å¤æ‚</td>
<td>$O(n \log n)$ï¼Œæœ€å $O(nÂ²)$</td>
<td>å¤„ç†é€’å½’é—®é¢˜ï¼Œåˆ†è€Œæ²»ä¹‹</td>
</tr>
<tr>
<td>å•è°ƒæ ˆ</td>
<td>æ•ˆç‡æœ€é«˜ï¼Œä¸€æ¬¡éå†</td>
<td>éœ€ç†è§£æ ˆåŸç†</td>
<td>$O(n)$</td>
<td>å¤§æ•°æ®é‡ï¼Œæœ€ä¼˜è§£æ³•</td>
</tr>
</tbody>
</table>
<h3 id="æˆ‘çš„é”™è¯¯ä¸æ•™è®­">æˆ‘çš„é”™è¯¯ä¸æ•™è®­</h3>
<p>è¿™é“é¢˜æˆ‘çŠ¯çš„é”™è¯¯ï¼ˆå¿˜è®°å¤„ç†æ ˆä¸­å‰©ä½™å…ƒç´ ï¼‰å…¶å®éå¸¸å¸¸è§ï¼Œä½†å®ƒç»™æˆ‘ä»¬ä¸¤ä¸ªé‡è¦å¯ç¤ºï¼š</p>
<ol>
<li>
<p><strong>ç®—æ³•çš„å®Œæ•´æ€§å¾ˆé‡è¦</strong>ï¼šä¸è¦åªå…³æ³¨ä¸»å¾ªç¯ï¼Œè¿˜è¦è€ƒè™‘å¾ªç¯ç»“æŸåçš„&quot;æ”¶å°¾å·¥ä½œ&quot;ã€‚å°±åƒå†™æ•…äº‹ä¸èƒ½å¿˜è®°ç»“å°¾ä¸€æ ·ã€‚</p>
</li>
<li>
<p><strong>ç‰¹æ®Šæƒ…å†µçš„å¤„ç†</strong>ï¼šåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œç‰¹æ®Šæƒ…å†µæ˜¯&quot;é‚£äº›å³è¾¹æ²¡æœ‰æ›´çŸ®æŸ±å­çš„å…ƒç´ &quot;ï¼Œå®ƒä»¬ä¹Ÿéœ€è¦è¢«æ­£ç¡®å¤„ç†ã€‚</p>
</li>
</ol>
<h3 id="å•è°ƒæ ˆçš„åº”ç”¨åœºæ™¯">å•è°ƒæ ˆçš„åº”ç”¨åœºæ™¯</h3>
<p>å•è°ƒæ ˆä¸ä»…ä»…ç”¨äºè¿™é“é¢˜ï¼Œå®ƒæ˜¯è§£å†³&quot;ä¸‹ä¸€ä¸ªæ›´å¤§/æ›´å°å…ƒç´ &quot;ç±»é—®é¢˜çš„åˆ©å™¨ã€‚å…¶åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>å¯»æ‰¾æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ </li>
<li>å¯»æ‰¾æ¸©åº¦å‡é«˜éœ€è¦ç­‰å¾…çš„å¤©æ•°ï¼ˆLeetCode 739ï¼‰</li>
<li>è®¡ç®—çŸ©å½¢é¢ç§¯ç±»é—®é¢˜</li>
</ul>
<p><strong>è®°ä½</strong>ï¼šå•è°ƒæ ˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯ç»´æŒæ ˆå†…å…ƒç´ çš„å•è°ƒæ€§ï¼ˆé€’å¢æˆ–é€’å‡ï¼‰ï¼Œè¿™æ ·å¯ä»¥åœ¨ $O(n)$æ—¶é—´å†…æ‰¾åˆ°æ¯ä¸ªå…ƒç´ å·¦å³ä¸¤ä¾§ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§/å°çš„å…ƒç´ ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ˆ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Hard</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>æ•°ç»„</tag>
        <tag>å•è°ƒæ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 739 - æ¯æ—¥æ¸©åº¦ (Daily Temperatures)</title>
    <url>/2025/05/12/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-739-%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>temperatures</code>ï¼Œè¡¨ç¤ºæ¯å¤©çš„æ¸©åº¦ã€‚ä½ éœ€è¦è¿”å›ä¸€ä¸ªæ•°ç»„ <code>answer</code>ï¼Œå…¶ä¸­ <code>answer[i]</code> æ˜¯æŒ‡å¯¹äºç¬¬ <code>i</code> å¤©ï¼Œä¸‹ä¸€ä¸ªæ›´é«˜æ¸©åº¦å‡ºç°åœ¨å‡ å¤©åã€‚å¦‚æœæ°”æ¸©åœ¨è¿™ä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ <code>0</code> æ¥ä»£æ›¿ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>è¾“å…¥: <code>temperatures = [73,74,75,71,69,72,76,73]</code><br>
è¾“å‡º: <code>[1,1,4,2,1,1,0,0]</code></p>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= temperatures.length &lt;= 10^5</code></li>
<li><code>30 &lt;= temperatures[i] &lt;= 100</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜è¦æ±‚æˆ‘ä»¬æ‰¾åˆ°æ¯å¤©ä¹‹åç¬¬ä¸€ä¸ªæ¯”å®ƒæ¸©åº¦é«˜çš„æ—¥å­ï¼Œå¹¶è®¡ç®—ç›¸å·®çš„å¤©æ•°ã€‚</p>
<h3 id="æš´åŠ›è§£æ³•ï¼ˆæœ´ç´ æƒ³æ³•ï¼‰">æš´åŠ›è§£æ³•ï¼ˆæœ´ç´ æƒ³æ³•ï¼‰</h3>
<p>æœ€ç›´æ¥çš„æƒ³æ³•æ˜¯ï¼Œå¯¹äºæ¯ä¸€å¤© <code>i</code>ï¼Œæˆ‘ä»¬éƒ½å‘åéå†ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¸©åº¦æ¯” <code>temperatures[i]</code> é«˜çš„æ—¥å­ <code>j</code>ï¼Œé‚£ä¹ˆ <code>answer[i] = j - i</code>ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ <code>answer[i] = 0</code>ã€‚è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N^2)ï¼Œåœ¨ N è¾¾åˆ° 10^5 æ—¶ï¼Œä¼šè¶…æ—¶ã€‚</p>
<h3 id="å•è°ƒæ ˆè§£æ³•">å•è°ƒæ ˆè§£æ³•</h3>
<p>ä¸ºäº†ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œå•è°ƒæ ˆã€ã€‚å•è°ƒæ ˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ˆï¼Œå®ƒåœ¨ä»»ä½•æ—¶å€™æ ˆå†…å…ƒç´ éƒ½ä¿æŒå•è°ƒé€’å¢æˆ–å•è°ƒé€’å‡çš„æ€§è´¨ã€‚å¯¹äºè¿™é“é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°æ¯ä¸ªå…ƒç´ çš„ã€Œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€ï¼Œè¿™æ­£æ˜¯å•è°ƒæ ˆçš„ç»å…¸åº”ç”¨åœºæ™¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ª<strong>å•è°ƒé€’å‡æ ˆ</strong>ï¼Œæ ˆä¸­å­˜å‚¨çš„æ˜¯æ¸©åº¦å€¼çš„<strong>ç´¢å¼•</strong>ã€‚ä¸ºä»€ä¹ˆæ˜¯å•è°ƒé€’å‡å‘¢ï¼Ÿ</p>
<ul>
<li>å½“æˆ‘ä»¬éå†åˆ°å½“å¤©çš„æ¸©åº¦ <code>temperatures[i]</code> æ—¶ï¼š
<ul>
<li>å¦‚æœæ ˆä¸ºç©ºï¼Œæˆ–è€…å½“å‰æ¸©åº¦å°äºç­‰äºæ ˆé¡¶ç´¢å¼•å¯¹åº”çš„æ¸©åº¦ï¼Œè¯´æ˜å½“å‰æ¸©åº¦æ²¡æœ‰æ‰“ç ´æ ˆçš„å•è°ƒé€’å‡æ€§ï¼ˆæˆ–è€…è¯´ï¼Œå¯¹äºæ ˆé¡¶å…ƒç´ è€Œè¨€ï¼Œå½“å‰æ¸©åº¦è¿˜ä¸æ˜¯å®ƒå³è¾¹ç¬¬ä¸€ä¸ªæ›´é«˜çš„æ¸©åº¦ï¼‰ï¼Œç›´æ¥å°†å½“å‰æ¸©åº¦çš„ç´¢å¼• <code>i</code> å…¥æ ˆã€‚</li>
<li>å¦‚æœå½“å‰æ¸©åº¦ <code>temperatures[i]</code> <strong>å¤§äº</strong>æ ˆé¡¶ç´¢å¼• <code>topIdx</code> å¯¹åº”çš„æ¸©åº¦ <code>temperatures[topIdx]</code>ï¼Œè¿™è¯´æ˜æˆ‘ä»¬æ‰¾åˆ°äº† <code>temperatures[topIdx]</code> å³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ å°±æ˜¯ <code>temperatures[i]</code>ã€‚æ­¤æ—¶ï¼Œæ ˆé¡¶å…ƒç´  <code>topIdx</code> çš„ç­‰å¾…å¤©æ•°å°±æ˜¯ <code>i - topIdx</code>ã€‚æˆ‘ä»¬å°† <code>topIdx</code> å‡ºæ ˆï¼Œå¹¶è®°å½•ç»“æœã€‚ç„¶åç»§ç»­æ¯”è¾ƒæ–°çš„æ ˆé¡¶å…ƒç´ å’Œå½“å‰æ¸©åº¦ <code>temperatures[i]</code>ï¼Œç›´åˆ°æ ˆä¸ºç©ºæˆ–è€…å½“å‰æ¸©åº¦ä¸å†å¤§äºæ ˆé¡¶æ¸©åº¦ã€‚å¤„ç†å®Œæ¯•åï¼Œå°†å½“å‰æ¸©åº¦çš„ç´¢å¼• <code>i</code> å…¥æ ˆï¼Œä»¥ç»´æŒåç»­çš„åˆ¤æ–­ã€‚</li>
</ul>
</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¯ä¸ªå…ƒç´ çš„ç´¢å¼•æœ€å¤šå…¥æ ˆä¸€æ¬¡ã€å‡ºæ ˆä¸€æ¬¡ï¼Œæ‰€ä»¥æ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N)ã€‚</p>
<h2 id="ä»£ç å®ç°-Go">ä»£ç å®ç° (Go)</h2>
<p>è¿™æ˜¯ä½ æä¾›çš„ Go è¯­è¨€è§£æ³•ï¼Œå®ƒæ­£ç¡®åœ°ä½¿ç”¨äº†å•è°ƒæ ˆï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=739 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [739] æ¯æ—¥æ¸©åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dailyTemperatures</span><span class="params">(temperatures []<span class="type">int</span>)</span></span> (res []<span class="type">int</span>) &#123;</span><br><span class="line">	stack := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>) <span class="comment">// å­˜å‚¨ç´¢å¼•çš„å•è°ƒé€’å‡æ ˆ</span></span><br><span class="line">	res = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(temperatures)) <span class="comment">// ç»“æœæ•°ç»„ï¼Œé»˜è®¤å€¼ä¸º0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> temperatures &#123;</span><br><span class="line">		<span class="comment">// ã€å¾…ä¼˜åŒ–éƒ¨åˆ†ã€‘</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(stack) == <span class="number">0</span> &#123;</span><br><span class="line">			stack = <span class="built_in">append</span>(stack, i)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å½“æ ˆä¸ä¸ºç©ºï¼Œä¸”å½“å‰æ¸©åº¦å¤§äºæ ˆé¡¶ç´¢å¼•å¯¹åº”çš„æ¸©åº¦æ—¶</span></span><br><span class="line">		<span class="keyword">for</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &amp;&amp; temperatures[stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]] &lt; temperatures[i] &#123;</span><br><span class="line">			top := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] <span class="comment">// å–å‡ºæ ˆé¡¶ç´¢å¼•</span></span><br><span class="line">			stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>] <span class="comment">// å¼¹å‡ºæ ˆé¡¶</span></span><br><span class="line"></span><br><span class="line">			res[top] = i - top <span class="comment">// è®¡ç®—ç­‰å¾…å¤©æ•°</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		stack = <span class="built_in">append</span>(stack, i) <span class="comment">// å½“å‰ç´¢å¼•å…¥æ ˆ</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç ä¼˜åŒ–">ä»£ç ä¼˜åŒ–</h2>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šé¢ä»£ç ä¸­æ ‡è®°çš„ã€å¾…ä¼˜åŒ–éƒ¨åˆ†ã€‘ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(stack) == <span class="number">0</span> &#123;</span><br><span class="line">    stack = <span class="built_in">append</span>(stack, i)</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç çš„æ„å›¾æ˜¯ï¼šå¦‚æœæ ˆä¸ºç©ºï¼Œå°±ç›´æ¥æŠŠå½“å‰ç´¢å¼• <code>i</code> åŠ è¿›å»ï¼Œç„¶åè·³è¿‡åç»­çš„ <code>for</code> å¾ªç¯ï¼Œå¼€å§‹ä¸‹ä¸€æ¬¡è¿­ä»£ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆå¯ä»¥ä¼˜åŒ–å‘¢ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬åˆ†æä¸€ä¸‹åç»­çš„é€»è¾‘ï¼š</p>
<ol>
<li><code>for len(stack) &gt; 0 &amp;&amp; temperatures[stack[len(stack)-1]] &lt; temperatures[i]</code>ï¼šè¿™ä¸ªå¾ªç¯å¤„ç†çš„æ˜¯å½“æ ˆ<strong>ä¸ä¸ºç©º</strong>ä¸”å½“å‰æ¸©åº¦<strong>å¤§äº</strong>æ ˆé¡¶æ¸©åº¦çš„æƒ…å†µã€‚å¦‚æœæ ˆä¸ºç©ºï¼Œ<code>len(stack) &gt; 0</code> è¿™ä¸ªæ¡ä»¶è‡ªç„¶ä¸æ»¡è¶³ï¼Œå¾ªç¯ä½“ä¸ä¼šæ‰§è¡Œã€‚</li>
<li><code>stack = append(stack, i)</code>ï¼šåœ¨ <code>for</code> å¾ªç¯ä¹‹åï¼Œæ— è®ºä¹‹å‰æ ˆæ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€… <code>for</code> å¾ªç¯æ˜¯å¦æ‰§è¡Œï¼Œå½“å‰ç´¢å¼• <code>i</code> éƒ½ä¼šè¢«åŠ å…¥æ ˆä¸­ã€‚</li>
</ol>
<p>è€ƒè™‘å¦‚æœæˆ‘ä»¬å°†ã€å¾…ä¼˜åŒ–éƒ¨åˆ†ã€‘å»æ‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> temperatures &#123;</span><br><span class="line">    <span class="comment">// ã€å¾…ä¼˜åŒ–éƒ¨åˆ†ã€‘è¢«ç§»é™¤</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“æ ˆä¸ä¸ºç©ºï¼Œä¸”å½“å‰æ¸©åº¦å¤§äºæ ˆé¡¶ç´¢å¼•å¯¹åº”çš„æ¸©åº¦æ—¶</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &amp;&amp; temperatures[stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]] &lt; temperatures[i] &#123;</span><br><span class="line">        top := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">        stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">        res[top] = i - top</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stack = <span class="built_in">append</span>(stack, i) <span class="comment">// å½“å‰ç´¢å¼•å…¥æ ˆ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œå¦‚æœéå†åˆ° <code>i</code> æ—¶æ ˆæ˜¯ç©ºçš„ï¼š</p>
<ul>
<li>å†…éƒ¨çš„ <code>for</code> å¾ªç¯å› ä¸º <code>len(stack) &gt; 0</code> ä¸æ»¡è¶³ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œã€‚</li>
<li>ç„¶åï¼Œ<code>stack = append(stack, i)</code> ä¼šå°† <code>i</code> åŠ å…¥åˆ°ç©ºæ ˆä¸­ã€‚</li>
</ul>
<p>è¿™ä¸åŸå§‹ä»£ç ä¸­ã€å¾…ä¼˜åŒ–éƒ¨åˆ†ã€‘çš„è¡Œä¸ºç»“æœæ˜¯ä¸€è‡´çš„ï¼åŸå§‹ä»£ç ä¸­ï¼Œå¦‚æœæ ˆä¸ºç©ºï¼Œä¼šæ‰§è¡Œ <code>stack = append(stack, i)</code> ç„¶å <code>continue</code>ã€‚ä¼˜åŒ–åï¼Œå¦‚æœæ ˆä¸ºç©ºï¼Œå†…éƒ¨ <code>for</code> å¾ªç¯ä¸æ‰§è¡Œï¼Œç„¶å <code>stack = append(stack, i)</code> æ‰§è¡Œã€‚ä¸¤è€…æœ€ç»ˆéƒ½ä½¿å¾— <code>i</code> è¢«åŠ å…¥æ ˆä¸­ï¼Œä¸”æ²¡æœ‰é”™è¯¯åœ°æ‰§è¡Œå†…éƒ¨ <code>for</code> å¾ªç¯çš„é€»è¾‘ã€‚</p>
<p>å› æ­¤ï¼Œé‚£æ®µæ˜¾å¼çš„ç©ºæ ˆæ£€æŸ¥å’Œ <code>continue</code> è¯­å¥å…¶å®æ˜¯<strong>ä¸å¿…è¦</strong>çš„ã€‚ç§»é™¤å®ƒå¯ä»¥è®©ä»£ç æ›´ç®€æ´ï¼Œå› ä¸ºåç»­çš„é€»è¾‘å·²ç»éšå¼åœ°æ­£ç¡®å¤„ç†äº†æ ˆä¸ºç©ºçš„æƒ…å†µã€‚</p>
<h2 id="ä¼˜åŒ–åçš„ä»£ç å®ç°-Go">ä¼˜åŒ–åçš„ä»£ç å®ç° (Go)</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dailyTemperatures</span><span class="params">(temperatures []<span class="type">int</span>)</span></span> (res []<span class="type">int</span>) &#123;</span><br><span class="line">	stack := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">	res = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(temperatures))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> temperatures &#123;</span><br><span class="line">		<span class="comment">// ä¼˜åŒ–ï¼šç§»é™¤äº†æ˜¾å¼çš„ç©ºæ ˆæ£€æŸ¥</span></span><br><span class="line">		<span class="comment">// if len(stack) == 0 &#123;</span></span><br><span class="line">		<span class="comment">//  stack = append(stack, i)</span></span><br><span class="line">		<span class="comment">//  continue</span></span><br><span class="line">		<span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &amp;&amp; temperatures[stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]] &lt; temperatures[i] &#123;</span><br><span class="line">			top := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">			stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">			res[top] = i - top</span><br><span class="line">		&#125;</span><br><span class="line">		stack = <span class="built_in">append</span>(stack, i)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä¼˜åŒ–åçš„ä»£ç åŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œä½†æ›´åŠ ç²¾ç‚¼ã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(N)ï¼Œå…¶ä¸­ N æ˜¯ <code>temperatures</code> æ•°ç»„çš„é•¿åº¦ã€‚æ¯ä¸ªå…ƒç´ çš„ç´¢å¼•æœ€å¤šè¢«å‹å…¥å’Œå¼¹å‡ºæ ˆä¸€æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(N)ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æ¸©åº¦æŒç»­é€’å‡ <code>[70,60,50,40]</code>ï¼‰ï¼Œæ ˆä¸­ä¼šå­˜å‚¨æ‰€æœ‰å…ƒç´ çš„ç´¢å¼•ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li>å•è°ƒæ ˆæ˜¯è§£å†³â€œä¸‹ä¸€ä¸ªæ›´å¤§/æ›´å°å…ƒç´ â€é—®é¢˜çš„æœ‰æ•ˆå·¥å…·ã€‚</li>
<li>åœ¨ç¼–å†™å¾ªç¯å’Œæ¡ä»¶åˆ¤æ–­æ—¶ï¼Œä»”ç»†æ€è€ƒè¾¹ç•Œæ¡ä»¶å’Œå·²æœ‰é€»è¾‘çš„è¦†ç›–èŒƒå›´ï¼Œæœ‰æ—¶å¯ä»¥å‘ç°å†—ä½™ä»£ç ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚</li>
<li>å¯¹äºè¿™é“é¢˜ï¼Œç»´æŠ¤ä¸€ä¸ªå­˜å‚¨ç´¢å¼•çš„å•è°ƒé€’å‡æ ˆæ˜¯æ ¸å¿ƒã€‚</li>
</ul>
<p>å¸Œæœ›è¿™ç¯‡é¢˜è§£èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£è¿™é“é¢˜ç›®å’Œå•è°ƒæ ˆçš„åº”ç”¨ï¼</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ˆ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>æ ˆ</tag>
        <tag>å•è°ƒæ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 394 - å­—ç¬¦ä¸²è§£ç  (String Decode)</title>
    <url>/2025/05/11/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-394-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E7%A0%81/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªç»è¿‡ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å®ƒè§£ç åçš„å­—ç¬¦ä¸²ã€‚</p>
<p>ç¼–ç è§„åˆ™ä¸ºï¼š<code>k[encoded_string]</code>ï¼Œè¡¨ç¤ºå…¶ä¸­æ–¹æ‹¬å·å†…éƒ¨çš„ <code>encoded_string</code> æ­£å¥½é‡å¤ <code>k</code> æ¬¡ã€‚æ³¨æ„ <code>k</code> ä¿è¯ä¸ºæ­£æ•´æ•°ã€‚</p>
<p>ä½ å¯ä»¥è®¤ä¸ºè¾“å…¥å­—ç¬¦ä¸²æ€»æ˜¯æœ‰æ•ˆçš„ï¼›è¾“å…¥å­—ç¬¦ä¸²ä¸­æ²¡æœ‰é¢å¤–çš„ç©ºæ ¼ï¼Œä¸”è¾“å…¥çš„æ–¹æ‹¬å·æ€»æ˜¯ç¬¦åˆæ ¼å¼è¦æ±‚çš„ã€‚</p>
<p>æ­¤å¤–ï¼Œä½ å¯ä»¥è®¤ä¸ºåŸå§‹æ•°æ®ä¸åŒ…å«æ•°å­—ï¼Œæ‰€æœ‰çš„æ•°å­—åªè¡¨ç¤ºé‡å¤çš„æ¬¡æ•° <code>k</code> ï¼Œä¾‹å¦‚ä¸ä¼šå‡ºç°åƒ <code>3a</code> æˆ– <code>2[4]</code> çš„è¾“å…¥ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;3[a]2[bc]&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;aaabcbc&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;3[a2[c]]&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;accaccacc&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;2[abc]3[cd]ef&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;abcabccdcdcdef&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 4ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;abc3[cd]xyz&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;abccdcdcdxyz&quot;</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= s.length &lt;= 30</code></li>
<li><code>s</code> ç”±å°å†™è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œæ–¹æ‹¬å· <code>'[]'</code> ç»„æˆ</li>
<li><code>s</code> ä¿è¯æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è¾“å…¥ã€‚</li>
<li><code>s</code> ä¸­æ‰€æœ‰æ•´æ•°çš„å–å€¼èŒƒå›´ä¸º <code>[1, 300]</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„ç‰¹ç‚¹æ˜¯å­˜åœ¨åµŒå¥—çš„æ‹¬å·å’Œé‡å¤æ¬¡æ•°ï¼Œè¿™ç§å…·æœ‰é€’å½’ç»“æ„æˆ–è€…éœ€è¦å¤„ç†åµŒå¥—å…³ç³»çš„é—®é¢˜ï¼Œé€šå¸¸å¯ä»¥è€ƒè™‘ä½¿ç”¨æ ˆæ¥è§£å†³ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸¤ä¸ªæ ˆï¼š</p>
<ol>
<li><code>numStack</code>ï¼šç”¨äºå­˜å‚¨é‡å¤æ¬¡æ•° <code>k</code>ã€‚</li>
<li><code>strStack</code>ï¼šç”¨äºå­˜å‚¨å¾…è§£ç çš„å­—ç¬¦ä¸²ç‰‡æ®µã€‚</li>
</ol>
<p>éå†è¾“å…¥çš„å­—ç¬¦ä¸² <code>s</code>ï¼Œæ ¹æ®é‡åˆ°çš„ä¸åŒå­—ç¬¦è¿›è¡Œç›¸åº”çš„æ“ä½œï¼š</p>
<ul>
<li><strong>é‡åˆ°æ•°å­—</strong>ï¼š
<ul>
<li>è§£æå‡ºå®Œæ•´çš„æ•°å­—ï¼ˆå¯èƒ½ä¸æ­¢ä¸€ä½ï¼‰ã€‚</li>
<li>å°†è§£æå¾—åˆ°çš„æ•°å­—å‹å…¥ <code>numStack</code>ã€‚</li>
</ul>
</li>
<li><strong>é‡åˆ°å­—æ¯</strong>ï¼š
<ul>
<li>è§£æå‡ºè¿ç»­çš„å­—æ¯ä¸²ã€‚</li>
<li>å°†è¿™ä¸ªå­—æ¯ä¸²å‹å…¥ <code>strStack</code>ã€‚</li>
</ul>
</li>
<li><strong>é‡åˆ° <code>[</code></strong>ï¼š
<ul>
<li>è¿™æ˜¯ä¸€ä¸ªæ–°çš„è§£ç å•å…ƒçš„å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªç‰¹æ®Šæ ‡è®°ï¼ˆä¾‹å¦‚ <code>[</code> æœ¬èº«ï¼‰å‹å…¥ <code>strStack</code>ï¼Œç”¨äºåç»­è¯†åˆ«è§£ç å•å…ƒçš„è¾¹ç•Œã€‚</li>
</ul>
</li>
<li><strong>é‡åˆ° <code>]</code></strong>ï¼š
<ul>
<li>è¿™æ˜¯å½“å‰è§£ç å•å…ƒçš„ç»“æŸã€‚æˆ‘ä»¬éœ€è¦ä» <code>strStack</code> ä¸­å¼¹å‡ºå­—ç¬¦ä¸²ï¼Œç›´åˆ°é‡åˆ° <code>[</code>ã€‚è¿™äº›å¼¹å‡ºçš„å­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥å°±æ˜¯å½“å‰ <code>encoded_string</code>ã€‚</li>
<li>ä» <code>numStack</code> ä¸­å¼¹å‡ºä¸€ä¸ªæ•°å­—ï¼Œè¿™æ˜¯å½“å‰ <code>encoded_string</code> éœ€è¦é‡å¤çš„æ¬¡æ•° <code>k</code>ã€‚</li>
<li>å°† <code>encoded_string</code> é‡å¤ <code>k</code> æ¬¡å¾—åˆ°è§£ç åçš„å­ä¸²ã€‚</li>
<li>å°†è¿™ä¸ªè§£ç åçš„å­ä¸²å‹å› <code>strStack</code>ã€‚</li>
</ul>
</li>
</ul>
<p>éå†å®Œæˆåï¼Œ<code>strStack</code> ä¸­å‰©ä¸‹çš„æ‰€æœ‰å­—ç¬¦ä¸²æŒ‰é¡ºåºæ‹¼æ¥èµ·æ¥å°±æ˜¯æœ€ç»ˆçš„è§£ç ç»“æœã€‚</p>
<h2 id="ä»£ç å®ç°-ä¼˜åŒ–å‰">ä»£ç å®ç° (ä¼˜åŒ–å‰)</h2>
<p>è¿™æ˜¯ä½ æä¾›çš„åŸå§‹ Go ä»£ç ï¼š</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=394 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [394] å­—ç¬¦ä¸²è§£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decodeString</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> s == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  numStack := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">  strStack := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="keyword">range</span> s &#123;</span><br><span class="line">    c := s[i]</span><br><span class="line">    <span class="comment">// fmt.Println(c) // è°ƒè¯•è¯­å¥</span></span><br><span class="line">    <span class="keyword">if</span> isNum(c) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> i &gt;= <span class="number">1</span> &amp;&amp; isNum(s[i<span class="number">-1</span>]) &#123;</span><br><span class="line">        top := <span class="built_in">len</span>(numStack) - <span class="number">1</span></span><br><span class="line">        numStack[top] = numStack[top]*<span class="number">10</span> + <span class="type">int</span>(c-<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        numStack = <span class="built_in">append</span>(numStack, <span class="type">int</span>(c-<span class="string">&#x27;0&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> c == <span class="string">&#x27;]&#x27;</span> &#123;</span><br><span class="line">      str := <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="keyword">for</span> strStack[<span class="built_in">len</span>(strStack)<span class="number">-1</span>] != <span class="string">&quot;[&quot;</span> &#123;</span><br><span class="line">        str = strStack[<span class="built_in">len</span>(strStack)<span class="number">-1</span>] + str</span><br><span class="line">        strStack = strStack[:<span class="built_in">len</span>(strStack)<span class="number">-1</span>]</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      strStack = strStack[:<span class="built_in">len</span>(strStack)<span class="number">-1</span>] <span class="comment">// å¼¹å‡º &#x27;[&#x27;</span></span><br><span class="line">      topNum := numStack[<span class="built_in">len</span>(numStack)<span class="number">-1</span>]</span><br><span class="line">      numStack = numStack[:<span class="built_in">len</span>(numStack)<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">      str = strings.Repeat(str, topNum)</span><br><span class="line">      strStack = <span class="built_in">append</span>(strStack, str)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> c == <span class="string">&#x27;[&#x27;</span> &#123;</span><br><span class="line">      strStack = <span class="built_in">append</span>(strStack, <span class="type">string</span>(c))</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å­—æ¯</span></span><br><span class="line">    <span class="keyword">if</span> i &gt;= <span class="number">1</span> &amp;&amp; isChar(s[i<span class="number">-1</span>]) &amp;&amp; <span class="built_in">len</span>(strStack) &gt; <span class="number">0</span> &amp;&amp; strStack[<span class="built_in">len</span>(strStack)<span class="number">-1</span>] != <span class="string">&quot;[&quot;</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœå‰ä¸€ä¸ªä¹Ÿæ˜¯å­—ç¬¦ï¼Œå¹¶ä¸”æ ˆé¡¶ä¸æ˜¯&#x27;[&#x27;ï¼Œåˆ™è¿½åŠ åˆ°æ ˆé¡¶å­—ç¬¦ä¸²</span></span><br><span class="line">      strStack[<span class="built_in">len</span>(strStack)<span class="number">-1</span>] = strStack[<span class="built_in">len</span>(strStack)<span class="number">-1</span>] + <span class="type">string</span>(c)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¦åˆ™ï¼Œä½œä¸ºæ–°çš„å­—ç¬¦ä¸²å…¥æ ˆ</span></span><br><span class="line">      strStack = <span class="built_in">append</span>(strStack, <span class="type">string</span>(c))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  res := <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(strStack); i++ &#123;</span><br><span class="line">    res += strStack[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isNum</span><span class="params">(c <span class="type">byte</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> c &lt;= <span class="string">&#x27;9&#x27;</span> &amp;&amp; c &gt;= <span class="string">&#x27;0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isChar</span><span class="params">(c <span class="type">byte</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (c &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç åˆ†æä¸å¯ä¼˜åŒ–ç‚¹">ä»£ç åˆ†æä¸å¯ä¼˜åŒ–ç‚¹</h2>
<p>åŸå§‹ä»£ç çš„æ€è·¯æ˜¯æ­£ç¡®çš„ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªæ ˆæ¥åˆ†åˆ«å­˜å‚¨æ•°å­—å’Œå­—ç¬¦ä¸²ã€‚ä½†åœ¨å¤„ç†è¿ç»­æ•°å­—å’Œè¿ç»­å­—æ¯æ—¶ï¼Œé€»è¾‘ç¨å¾®æœ‰äº›å¤æ‚ï¼š</p>
<ol>
<li><strong>è¿ç»­æ•°å­—å¤„ç†</strong>ï¼šé€šè¿‡ <code>if i &gt;= 1 &amp;&amp; isNum(s[i-1])</code> æ¥åˆ¤æ–­æ˜¯å¦æ˜¯å¤šä½æ•°çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åæ›´æ–°æ ˆé¡¶æ•°å­—ã€‚</li>
<li><strong>è¿ç»­å­—æ¯å¤„ç†</strong>ï¼šé€šè¿‡ <code>if i &gt;= 1 &amp;&amp; isChar(s[i-1]) &amp;&amp; len(strStack) &gt; 0 &amp;&amp; strStack[len(strStack)-1] != &quot;[&quot;</code> æ¥åˆ¤æ–­æ˜¯å¦è¿½åŠ åˆ°æ ˆé¡¶çš„å­—ç¬¦ä¸²ã€‚è¿™ç§æ–¹å¼ä½¿å¾—æ ˆ <code>strStack</code> ä¸­å­˜å‚¨çš„å…ƒç´ ç±»å‹ä¸ç»Ÿä¸€ï¼Œæœ‰æ—¶æ˜¯å•ä¸ªå­—ç¬¦ï¼Œæœ‰æ—¶æ˜¯ <code>[</code>ï¼Œæœ‰æ—¶æ˜¯å·²ç»æ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²ã€‚è¿™å¢åŠ äº†å¤„ç†çš„å¤æ‚åº¦ã€‚</li>
<li><strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong>ï¼šåœ¨é‡åˆ° <code>]</code> æ—¶ï¼Œä» <code>strStack</code> å¼¹å‡ºå­—ç¬¦ä¸²å¹¶è¿›è¡Œåå‘æ‹¼æ¥ (<code>str = strStack[len(strStack)-1] + str</code>)ï¼Œæ•ˆç‡è¾ƒä½ã€‚</li>
<li><strong>æ ˆå…ƒç´ ç»Ÿä¸€æ€§</strong>ï¼š<code>strStack</code> ä¸­æ··åˆäº†å•ä¸ªå­—ç¬¦ã€<code>[</code> æ ‡è®°å’Œè§£ç åçš„å­—ç¬¦ä¸²ç‰‡æ®µã€‚å¦‚æœèƒ½è®©æ ˆä¸­å…ƒç´ ç±»å‹æ›´ç»Ÿä¸€ï¼Œæˆ–è€…å¤„ç†é€»è¾‘æ›´æ¸…æ™°ï¼Œä¼šæ›´å¥½ã€‚</li>
</ol>
<p><strong>ä¼˜åŒ–æ€è·¯ï¼š</strong></p>
<ul>
<li><strong>ç®€åŒ–è§£æ</strong>ï¼šæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€ä¸ªæŒ‡é’ˆ <code>ptr</code> æ¥éå†å­—ç¬¦ä¸² <code>s</code>ã€‚</li>
<li><strong>æ•°å­—è§£æ</strong>ï¼šå½“é‡åˆ°æ•°å­—æ—¶ï¼Œè¿ç»­è¯»å–æ‰€æœ‰æ•°å­—ä½ï¼Œç»„æˆä¸€ä¸ªå®Œæ•´çš„æ•°å­—ã€‚</li>
<li><strong>å­—æ¯è§£æ</strong>ï¼šå½“é‡åˆ°å­—æ¯æ—¶ï¼Œè¿ç»­è¯»å–æ‰€æœ‰å­—æ¯ï¼Œç»„æˆä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²ã€‚</li>
<li><strong>æ ˆå†…å…ƒç´ </strong>ï¼š<code>strStack</code> å¯ä»¥è®¾è®¡ä¸ºåªå­˜å‚¨è§£ç è¿‡ç¨‹ä¸­çš„å­—ç¬¦ä¸²ç‰‡æ®µã€‚å½“é‡åˆ° <code>[</code> æ—¶ï¼Œå¯ä»¥å°†å½“å‰æ•°å­—å’Œ <code>[</code> ä¹‹å‰ç´¯ç§¯çš„å­—ç¬¦ä¸²ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¸€èµ·å…¥æ ˆã€‚</li>
<li><strong>æ›´é€šç”¨çš„æ ˆå¤„ç†</strong>ï¼šå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªæ ˆæ¥åŒæ—¶å­˜å‚¨æ•°å­—å’Œå­—ç¬¦ä¸²ï¼Œæˆ–è€…ä½¿ç”¨æ›´ç»“æ„åŒ–çš„æ–¹å¼ã€‚ä¸€ä¸ªå¸¸è§çš„ä¼˜åŒ–æ˜¯ï¼Œå½“é‡åˆ° <code>[</code> æ—¶ï¼Œå°†å½“å‰çš„æ•°å­—å’Œ <code>[</code> å‰çš„å­—ç¬¦ä¸²ç»“æœå…¥æ ˆï¼›é‡åˆ° <code>]</code> æ—¶ï¼Œå‡ºæ ˆå¾—åˆ°æ•°å­—å’Œä¹‹å‰çš„å­—ç¬¦ä¸²ï¼Œç„¶åè¿›è¡Œæ‹¼æ¥ã€‚</li>
</ul>
<h2 id="ä¼˜åŒ–åçš„ä»£ç å®ç°">ä¼˜åŒ–åçš„ä»£ç å®ç°</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¼˜åŒ–åçš„ Go ç‰ˆæœ¬ã€‚è¿™ä¸ªç‰ˆæœ¬å°è¯•ç®€åŒ–è§£æé€»è¾‘ï¼Œå¹¶ä½¿æ ˆçš„æ“ä½œæ›´æ¸…æ™°ã€‚</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decodeStringOptimized</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    numStack := []<span class="type">int</span>&#123;&#125;      <span class="comment">// å­˜å‚¨é‡å¤æ¬¡æ•°</span></span><br><span class="line">    strStack := []<span class="type">string</span>&#123;&#125;   <span class="comment">// å­˜å‚¨é‡åˆ°&#x27;[&#x27;å‰çš„å­—ç¬¦ä¸²ç»“æœ</span></span><br><span class="line">    currentNum := <span class="number">0</span></span><br><span class="line">    currentStr := strings.Builder&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">        <span class="keyword">if</span> char &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; char &lt;= <span class="string">&#x27;9&#x27;</span> &#123;</span><br><span class="line">            currentNum = currentNum*<span class="number">10</span> + <span class="type">int</span>(char-<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> char == <span class="string">&#x27;[&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// å°†å½“å‰çš„æ•°å­—å’Œå­—ç¬¦ä¸²å…¥æ ˆ</span></span><br><span class="line">            numStack = <span class="built_in">append</span>(numStack, currentNum)</span><br><span class="line">            strStack = <span class="built_in">append</span>(strStack, currentStr.String())</span><br><span class="line">            <span class="comment">// é‡ç½®å½“å‰æ•°å­—å’Œå­—ç¬¦ä¸²</span></span><br><span class="line">            currentNum = <span class="number">0</span></span><br><span class="line">            currentStr.Reset()</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> char == <span class="string">&#x27;]&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// å¼¹å‡ºæ ˆé¡¶çš„æ•°å­—å’Œå­—ç¬¦ä¸²</span></span><br><span class="line">            repeatTimes := numStack[<span class="built_in">len</span>(numStack)<span class="number">-1</span>]</span><br><span class="line">            numStack = numStack[:<span class="built_in">len</span>(numStack)<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">            prevStr := strStack[<span class="built_in">len</span>(strStack)<span class="number">-1</span>]</span><br><span class="line">            strStack = strStack[:<span class="built_in">len</span>(strStack)<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ„å»ºé‡å¤åçš„å­—ç¬¦ä¸²</span></span><br><span class="line">            decodedPart := strings.Repeat(currentStr.String(), repeatTimes)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›´æ–° currentStr ä¸º prevStr + decodedPart</span></span><br><span class="line">            currentStr.Reset()</span><br><span class="line">            currentStr.WriteString(prevStr)</span><br><span class="line">            currentStr.WriteString(decodedPart)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// å­—æ¯</span></span><br><span class="line">            currentStr.WriteRune(char)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> currentStr.String()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾…åŠ©å‡½æ•° (å¦‚æœéœ€è¦åœ¨ main åŒ…å¤–ä½¿ç”¨ï¼Œåˆ™ä¸éœ€è¦)</span></span><br><span class="line"><span class="comment">// func isNum(c byte) bool &#123;</span></span><br><span class="line"><span class="comment">//  return c &lt;= &#x27;9&#x27; &amp;&amp; c &gt;= &#x27;0&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// func isChar(c byte) bool &#123;</span></span><br><span class="line"><span class="comment">//  return (c &gt;= &#x27;a&#x27; &amp;&amp; c &lt;= &#x27;z&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜åŒ–ç‚¹è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong><code>strings.Builder</code></strong>ï¼šä½¿ç”¨ <code>strings.Builder</code> è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæ¯”ç›´æ¥ä½¿ç”¨ <code>+</code> æ›´é«˜æ•ˆã€‚</li>
<li><strong>æ ˆçš„èŒè´£æ›´æ¸…æ™°</strong>ï¼š
<ul>
<li><code>numStack</code> åªå­˜å‚¨ <code>[</code> å¯¹åº”çš„é‡å¤æ¬¡æ•°ã€‚</li>
<li><code>strStack</code> åªå­˜å‚¨é‡åˆ° <code>[</code> æ—¶ï¼Œå®ƒå‰é¢çš„é‚£éƒ¨åˆ†å·²ç»è§£ç ï¼ˆæˆ–æœ¬èº«å°±æ˜¯ï¼‰çš„å­—ç¬¦ä¸²ã€‚</li>
</ul>
</li>
<li><strong>å˜é‡ä½œç”¨</strong>ï¼š
<ul>
<li><code>currentNum</code>ï¼šç”¨äºç´¯ç§¯å½“å‰é‡åˆ°çš„æ•°å­—ï¼Œå½¢æˆå®Œæ•´çš„é‡å¤æ¬¡æ•°ã€‚</li>
<li><code>currentStr</code>ï¼šç”¨äºç´¯ç§¯å½“å‰è§£ç å•å…ƒå†…çš„å­—ç¬¦ä¸²ï¼ˆåœ¨ <code>[</code> å’Œ <code>]</code> ä¹‹é—´ï¼Œæˆ–è€…åœ¨æœ€å¤–å±‚ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>é€»è¾‘æµç¨‹</strong>ï¼š
<ul>
<li><strong>æ•°å­—</strong>ï¼šç´¯åŠ åˆ° <code>currentNum</code>ã€‚</li>
<li><strong><code>[</code></strong>ï¼šå°† <code>currentNum</code> å’Œ <code>currentStr</code>ï¼ˆ<code>[</code>ä¹‹å‰çš„éƒ¨åˆ†ï¼‰å…¥æ ˆï¼Œç„¶åé‡ç½® <code>currentNum</code> å’Œ <code>currentStr</code> ä»¥å¼€å§‹å¤„ç†æ‹¬å·å†…çš„æ–°å†…å®¹ã€‚</li>
<li><strong><code>]</code></strong>ï¼š
<ul>
<li>ä» <code>numStack</code> å¼¹å‡ºé‡å¤æ¬¡æ•° <code>repeatTimes</code>ã€‚</li>
<li>ä» <code>strStack</code> å¼¹å‡º <code>[</code> ä¹‹å‰çš„é‚£éƒ¨åˆ†å­—ç¬¦ä¸² <code>prevStr</code>ã€‚</li>
<li><code>currentStr</code> æ­¤æ—¶æ˜¯ <code>]</code> å’Œä¸ä¹‹é…å¯¹çš„ <code>[</code> ä¹‹é—´çš„å†…å®¹è§£ç ç»“æœï¼ˆå¦‚æœå†…éƒ¨è¿˜æœ‰åµŒå¥—ï¼Œä¹Ÿå·²å¤„ç†å®Œï¼‰ã€‚</li>
<li>å°† <code>currentStr</code> é‡å¤ <code>repeatTimes</code> æ¬¡ï¼Œç„¶åä¸ <code>prevStr</code> æ‹¼æ¥ï¼Œå½¢æˆæ–°çš„ <code>currentStr</code>ã€‚</li>
</ul>
</li>
<li><strong>å­—æ¯</strong>ï¼šè¿½åŠ åˆ° <code>currentStr</code>ã€‚</li>
</ul>
</li>
</ol>
<p>æœ€ç»ˆï¼Œéå†ç»“æŸåï¼Œ<code>currentStr</code> ä¸­å°±æ˜¯å®Œå…¨è§£ç åçš„å­—ç¬¦ä¸²ã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p>å‡è®¾ <code>N</code> æ˜¯è¾“å…¥å­—ç¬¦ä¸² <code>s</code> çš„é•¿åº¦ã€‚</p>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>æˆ‘ä»¬éå†å­—ç¬¦ä¸² <code>s</code> ä¸€æ¬¡ã€‚</li>
<li>æ ˆæ“ä½œï¼ˆå…¥æ ˆã€å‡ºæ ˆï¼‰çš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚</li>
<li>å­—ç¬¦ä¸²çš„é‡å¤æ“ä½œ <code>strings.Repeat(str, k)</code> çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(len(str) * k)ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œè§£ç åçš„å­—ç¬¦ä¸²é•¿åº¦å¯èƒ½éå¸¸å¤§ã€‚ä¾‹å¦‚ <code>100[a100[b]]</code>ã€‚</li>
<li>å¦‚æœæœ€ç»ˆè§£ç åçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º <code>L</code>ï¼Œé‚£ä¹ˆæ€»çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥è®¤ä¸ºæ˜¯ O(L)ã€‚å› ä¸ºæ¯ä¸ªå­—ç¬¦æœ€ç»ˆéƒ½ä¼šè¢«æ„å»ºå‡ºæ¥ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ<code>L</code> å¯èƒ½è¿œå¤§äº <code>N</code>ã€‚å¦‚æœä»…è€ƒè™‘éå†å’Œæ ˆæ“ä½œï¼Œä¸è€ƒè™‘å­—ç¬¦ä¸²ç”Ÿæˆï¼Œåˆ™æ˜¯ O(N)ã€‚ä½†å®é™…ç“¶é¢ˆåœ¨äºå­—ç¬¦ä¸²ç”Ÿæˆã€‚</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>æ ˆ <code>numStack</code> å’Œ <code>strStack</code> çš„æ·±åº¦å–å†³äºåµŒå¥—çš„å±‚æ•°ã€‚æœ€åæƒ…å†µä¸‹ï¼ŒåµŒå¥—å±‚æ•°å¯ä»¥æ˜¯ O(N)ï¼ˆä¾‹å¦‚ <code>[[[...]]]</code>ï¼‰ã€‚</li>
<li><code>strStack</code> ä¸­å­˜å‚¨çš„å­—ç¬¦ä¸²ç‰‡æ®µçš„æ€»é•¿åº¦ä¹Ÿå¯èƒ½å¾ˆå¤§ã€‚</li>
<li><code>currentStr</code> (strings.Builder) å­˜å‚¨ä¸­é—´ç»“æœã€‚</li>
<li>ç»¼åˆæ¥çœ‹ï¼Œç©ºé—´å¤æ‚åº¦ä¹Ÿä¸è§£ç åå­—ç¬¦ä¸²çš„ä¸­é—´ç‰‡æ®µé•¿åº¦å’ŒåµŒå¥—æ·±åº¦æœ‰å…³ï¼Œæœ€åæƒ…å†µä¸‹å¯èƒ½æ˜¯ O(L) æˆ– O(N)ï¼ˆå–å†³äºå“ªä¸ªæ˜¯ä¸»å¯¼å› ç´ ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>æ ˆçš„åº”ç”¨</strong>ï¼šå¯¹äºå¤„ç†å…·æœ‰åµŒå¥—ç»“æ„æˆ–éœ€è¦â€œåè¿›å…ˆå‡ºâ€é€»è¾‘çš„é—®é¢˜ï¼ˆå¦‚æ‹¬å·åŒ¹é…ã€è¡¨è¾¾å¼æ±‚å€¼ã€å­—ç¬¦ä¸²è§£ç ï¼‰ï¼Œæ ˆæ˜¯éå¸¸æœ‰æ•ˆçš„æ•°æ®ç»“æ„ã€‚</li>
<li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œæ¸…æ™°åœ°ç®¡ç†å½“å‰çŠ¶æ€ï¼ˆå¦‚å½“å‰æ•°å­— <code>currentNum</code>ã€å½“å‰æ„å»ºçš„å­—ç¬¦ä¸² <code>currentStr</code>ï¼‰è‡³å…³é‡è¦ã€‚</li>
<li><strong>å­—ç¬¦ä¸²æ„å»ºæ•ˆç‡</strong>ï¼šåœ¨ Go ä¸­ï¼Œé¢‘ç¹è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥æ—¶ï¼Œä½¿ç”¨ <code>strings.Builder</code> é€šå¸¸æ¯”ç›´æ¥ç”¨ <code>+</code> æˆ– <code>fmt.Sprintf</code> æ›´é«˜æ•ˆï¼Œå› ä¸ºå®ƒé¿å…äº†æ¯æ¬¡æ‹¼æ¥éƒ½åˆ›å»ºæ–°å­—ç¬¦ä¸²å¯¹è±¡çš„å¼€é”€ã€‚</li>
<li><strong>é—®é¢˜åˆ†è§£</strong>ï¼šå°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºå¯¹ä¸åŒç±»å‹å­—ç¬¦ï¼ˆæ•°å­—ã€<code>[</code>ã€<code>]</code>ã€å­—æ¯ï¼‰çš„ç‹¬ç«‹å¤„ç†é€»è¾‘ï¼Œå¯ä»¥ä½¿ä»£ç æ›´æ¨¡å—åŒ–ã€æ›´æ˜“äºç†è§£å’Œè°ƒè¯•ã€‚</li>
<li><strong>æ ˆå†…å…ƒç´ è®¾è®¡</strong>ï¼šç²¾å¿ƒè®¾è®¡æ ˆä¸­å­˜å‚¨çš„å†…å®¹ï¼Œå¯ä»¥ç®€åŒ–å‡ºæ ˆå’Œå…¥æ ˆæ—¶çš„å¤„ç†é€»è¾‘ã€‚åœ¨ä¼˜åŒ–åçš„ç‰ˆæœ¬ä¸­ï¼Œ<code>strStack</code> å­˜å‚¨çš„æ˜¯ <code>[</code> ç¬¦å·å‡ºç°ä¹‹å‰çš„ç´¯ç§¯å­—ç¬¦ä¸²ï¼Œè¿™ä½¿å¾— <code>]</code> å‡ºæ ˆé€»è¾‘æ›´ç›´æ¥ã€‚</li>
</ol>
<p>è¿™é“é¢˜æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»ƒä¹ ï¼Œå¯ä»¥å¸®åŠ©ç†è§£æ ˆåœ¨å­—ç¬¦ä¸²å¤„ç†ä¸­çš„åº”ç”¨ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ä¼˜åŒ–æ•°æ®ç»“æ„å’Œç®—æ³•æµç¨‹æ¥æé«˜ä»£ç çš„æ¸…æ™°åº¦å’Œæ•ˆç‡ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ˆ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 155 - æœ€å°æ ˆ (Min Stack)</title>
    <url>/2025/05/11/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-155-%E6%9C%80%E5%B0%8F%E6%A0%88/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>è®¾è®¡ä¸€ä¸ªæ”¯æŒ <code>push</code> ï¼Œ<code>pop</code> ï¼Œ<code>top</code> æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚</p>
<p>å®ç° <code>MinStack</code> ç±»:</p>
<ul>
<li><code>MinStack()</code> åˆå§‹åŒ–å †æ ˆå¯¹è±¡ã€‚</li>
<li><code>void push(int val)</code> å°†å…ƒç´  val æ¨å…¥å †æ ˆã€‚</li>
<li><code>void pop()</code> åˆ é™¤å †æ ˆé¡¶éƒ¨çš„å…ƒç´ ã€‚</li>
<li><code>int top()</code> è·å–å †æ ˆé¡¶éƒ¨çš„å…ƒç´ ã€‚</li>
<li><code>int getMin()</code> è·å–å †æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;MinStack&quot;,&quot;push&quot;,&quot;push&quot;,&quot;push&quot;,&quot;getMin&quot;,&quot;pop&quot;,&quot;top&quot;,&quot;getMin&quot;]</span><br><span class="line">[[],[-2],[0],[-3],[],[],[],[]]</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">[null,null,null,null,-3,null,0,-2]</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">MinStack minStack = new MinStack();</span><br><span class="line">minStack.push(-2);</span><br><span class="line">minStack.push(0);</span><br><span class="line">minStack.push(-3);</span><br><span class="line">minStack.getMin();   --&gt; è¿”å› -3.</span><br><span class="line">minStack.pop();</span><br><span class="line">minStack.top();      --&gt; è¿”å› 0.</span><br><span class="line">minStack.getMin();   --&gt; è¿”å› -2.</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶:</strong></p>
<ul>
<li><code>-2^31 &lt;= val &lt;= 2^31 - 1</code></li>
<li><code>pop</code>ã€<code>top</code> å’Œ <code>getMin</code> æ“ä½œæ€»æ˜¯åœ¨ <strong>éç©ºæ ˆ</strong> ä¸Šè°ƒç”¨</li>
<li><code>push</code>, <code>pop</code>, <code>top</code>, and <code>getMin</code>æœ€å¤šè¢«è°ƒç”¨ <code>3 * 10^4</code> æ¬¡</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒè¦æ±‚æ˜¯åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æ ˆä¸­çš„æœ€å°å…ƒç´ ï¼ŒåŒæ—¶è¦æ”¯æŒå¸¸è§„çš„æ ˆæ“ä½œï¼ˆpush, pop, topï¼‰ã€‚</p>
<p>ä¸€ä¸ªå¸¸è§çš„è§£æ³•æ˜¯ä½¿ç”¨ <strong>è¾…åŠ©æ ˆ</strong>ã€‚æˆ‘ä»¬ç»´æŠ¤ä¸¤ä¸ªæ ˆï¼š</p>
<ol>
<li><code>stack</code>: æ™®é€šçš„æ•°æ®æ ˆï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰æ¨å…¥çš„å…ƒç´ ã€‚</li>
<li><code>minStack</code>: è¾…åŠ©æ ˆï¼Œç”¨äºå­˜å‚¨å½“å‰ <code>stack</code> ä¸­å¯¹åº”çŠ¶æ€ä¸‹çš„æœ€å°å€¼ã€‚</li>
</ol>
<p><strong>å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</strong></p>
<ul>
<li>
<p><strong><code>push(val)</code></strong>:</p>
<ul>
<li>å°† <code>val</code> æ­£å¸¸æ¨å…¥ <code>stack</code>ã€‚</li>
<li>å¯¹äº <code>minStack</code>ï¼š
<ul>
<li>å¦‚æœ <code>minStack</code> ä¸ºç©ºï¼Œåˆ™å°† <code>val</code> æ¨å…¥ <code>minStack</code>ã€‚</li>
<li>å¦åˆ™ï¼Œæ¯”è¾ƒ <code>val</code> å’Œ <code>minStack</code> çš„æ ˆé¡¶å…ƒç´  <code>currentMin</code>ã€‚å°† <code>min(val, currentMin)</code> æ¨å…¥ <code>minStack</code>ã€‚è¿™æ · <code>minStack</code> çš„æ ˆé¡¶å§‹ç»ˆæ˜¯å½“å‰ <code>stack</code> ä¸­çš„æœ€å°å€¼ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>pop()</code></strong>:</p>
<ul>
<li>åŒæ—¶ä» <code>stack</code> å’Œ <code>minStack</code> ä¸­å¼¹å‡ºæ ˆé¡¶å…ƒç´ ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>top()</code></strong>:</p>
<ul>
<li>è¿”å› <code>stack</code> çš„æ ˆé¡¶å…ƒç´ ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getMin()</code></strong>:</p>
<ul>
<li>è¿”å› <code>minStack</code> çš„æ ˆé¡¶å…ƒç´ ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ç§æ–¹æ³•å¯ä»¥ä¿è¯æ‰€æœ‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// filepath: /Users/adrianwang/.leetcode/155.æœ€å°æ ˆ.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="keyword">type</span> MinStack <span class="keyword">struct</span> &#123;</span><br><span class="line">	stack    []<span class="type">int</span></span><br><span class="line">	minStack []<span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span></span> MinStack &#123;</span><br><span class="line">	<span class="keyword">return</span> MinStack&#123;</span><br><span class="line">		stack:    <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>),</span><br><span class="line">		minStack: <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span></span> Push(val <span class="type">int</span>) &#123;</span><br><span class="line">	this.stack = <span class="built_in">append</span>(this.stack, val)</span><br><span class="line">	<span class="keyword">var</span> minVal <span class="type">int</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(this.minStack) == <span class="number">0</span> &#123;</span><br><span class="line">		minVal = val</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		minVal = this.minStack[<span class="built_in">len</span>(this.minStack)<span class="number">-1</span>]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Go è¯­è¨€æ²¡æœ‰å†…ç½®çš„ min å‡½æ•°ï¼Œéœ€è¦è‡ªå·±å®ç°æˆ–è€…ç›´æ¥æ¯”è¾ƒ</span></span><br><span class="line">	<span class="keyword">if</span> val &lt; minVal &#123;</span><br><span class="line">		this.minStack = <span class="built_in">append</span>(this.minStack, val)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		this.minStack = <span class="built_in">append</span>(this.minStack, minVal)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span></span> Pop() &#123;</span><br><span class="line">	this.minStack = this.minStack[:<span class="built_in">len</span>(this.minStack)<span class="number">-1</span>]</span><br><span class="line">	this.stack = this.stack[:<span class="built_in">len</span>(this.stack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span></span> Top() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.stack[<span class="built_in">len</span>(this.stack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span></span> GetMin() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this.minStack[<span class="built_in">len</span>(this.minStack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MinStack object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * obj := Constructor();</span></span><br><span class="line"><span class="comment"> * obj.Push(val);</span></span><br><span class="line"><span class="comment"> * obj.Pop();</span></span><br><span class="line"><span class="comment"> * param_3 := obj.Top();</span></span><br><span class="line"><span class="comment"> * param_4 := obj.GetMin();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// @lc code=end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾…åŠ©å‡½æ•° min (Goè¯­è¨€æ ‡å‡†åº“æ²¡æœ‰ï¼Œéœ€è¦è‡ªè¡Œå®ç°)</span></span><br><span class="line"><span class="comment">// func min(a, b int) int &#123;</span></span><br><span class="line"><span class="comment">// 	if a &lt; b &#123;</span></span><br><span class="line"><span class="comment">// 		return a</span></span><br><span class="line"><span class="comment">// 	&#125;</span></span><br><span class="line"><span class="comment">// 	return b</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„:</strong> ä¸Šè¿° Go ä»£ç ä¸­çš„ <code>Push</code> æ–¹æ³•æœ‰ä¸€ä¸ªå°è°ƒæ•´ï¼Œå› ä¸º Go æ ‡å‡†åº“ä¸­æ²¡æœ‰ç›´æ¥çš„ <code>min</code> å‡½æ•°ã€‚åœ¨å®é™… LeetCode æäº¤æ—¶ï¼Œå¦‚æœ <code>min</code> å‡½æ•°æœªæä¾›ï¼Œä½ éœ€è¦è‡ªå·±å®ç°ä¸€ä¸ªï¼Œæˆ–è€…åƒä»£ç ä¸­é‚£æ ·ç›´æ¥è¿›è¡Œæ¯”è¾ƒã€‚åœ¨æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œ<code>min(val, minVal)</code> è¿™ä¸€è¡Œä¼šæŠ¥é”™ï¼Œæˆ‘å·²ç»å°†å…¶ä¿®æ”¹ä¸ºç›´æ¥æ¯”è¾ƒã€‚</p>
<h3 id="ç©ºé—´ä¼˜åŒ–æ€è·¯">ç©ºé—´ä¼˜åŒ–æ€è·¯</h3>
<p>ä¸Šè¿°è¾…åŠ©æ ˆçš„æ–¹æ³•è™½ç„¶ç®€å•ï¼Œä½† <code>minStack</code> çš„å¤§å°å§‹ç»ˆä¸ <code>stack</code> ç›¸åŒã€‚æˆ‘ä»¬å¯ä»¥å¯¹ <code>minStack</code> çš„ä½¿ç”¨è¿›è¡Œä¼˜åŒ–ï¼Œä½¿å…¶ä»…åœ¨å¿…è¦æ—¶å­˜å‚¨å…ƒç´ ï¼Œä»è€Œå¯èƒ½èŠ‚çœç©ºé—´ã€‚</p>
<p><strong>ä¼˜åŒ–é€»è¾‘ï¼š</strong></p>
<ul>
<li>
<p><strong><code>Push(val)</code></strong>:</p>
<ul>
<li>å…ƒç´  <code>val</code> æ­£å¸¸æ¨å…¥ <code>stack</code>ã€‚</li>
<li>å¯¹äº <code>minStack</code>ï¼š
<ul>
<li>å¦‚æœ <code>minStack</code> ä¸ºç©ºï¼Œæˆ–è€… <code>val</code> å°äºæˆ–ç­‰äº <code>minStack</code> çš„æ ˆé¡¶å…ƒç´ ï¼Œåˆ™å°† <code>val</code> æ¨å…¥ <code>minStack</code>ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>&lt;=</code> æ˜¯ä¸ºäº†æ­£ç¡®å¤„ç†æ ˆä¸­å­˜åœ¨å¤šä¸ªç›¸åŒæœ€å°å€¼çš„æƒ…å†µã€‚</li>
<li>å¦åˆ™ (<code>val</code> å¤§äº <code>minStack</code> çš„æ ˆé¡¶å…ƒç´ )ï¼Œ<code>minStack</code> ä¸åšä»»ä½•æ“ä½œï¼Œå› ä¸ºå½“å‰çš„æœ€å°å€¼ä»ç„¶æœ‰æ•ˆã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>Pop()</code></strong>:</p>
<ul>
<li>ä» <code>stack</code> å¼¹å‡ºæ ˆé¡¶å…ƒç´  <code>poppedVal</code>ã€‚</li>
<li>æ£€æŸ¥ <code>poppedVal</code> æ˜¯å¦ç­‰äº <code>minStack</code> çš„æ ˆé¡¶å…ƒç´ ã€‚
<ul>
<li>å¦‚æœç›¸ç­‰ï¼Œè¯´æ˜è¢«å¼¹å‡ºçš„å…ƒç´ æ˜¯ï¼ˆæˆ–ä¹‹ä¸€æ˜¯ï¼‰å½“å‰çš„æœ€å°å€¼ï¼Œå› æ­¤ä¹Ÿéœ€è¦ä» <code>minStack</code> å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œä»¥æ›´æ–°æœ€å°å€¼è®°å½•ã€‚</li>
<li>å¦‚æœä¸ç›¸ç­‰ï¼Œ<code>minStack</code> ä¸åšä»»ä½•æ“ä½œã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>Top()</code> å’Œ <code>GetMin()</code></strong>:</p>
<ul>
<li><code>Top()</code> é€»è¾‘ä¸å˜ï¼Œè¿”å› <code>stack</code> çš„æ ˆé¡¶ã€‚</li>
<li><code>GetMin()</code> é€»è¾‘ä¸å˜ï¼Œè¿”å› <code>minStack</code> çš„æ ˆé¡¶ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä¼˜åŒ–åçš„ä»£ç å®ç°ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Push (ç©ºé—´ä¼˜åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span></span> Push(val <span class="type">int</span>) &#123;</span><br><span class="line">    this.stack = <span class="built_in">append</span>(this.stack, val)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(this.minStack) == <span class="number">0</span> || val &lt;= this.minStack[<span class="built_in">len</span>(this.minStack)<span class="number">-1</span>] &#123;</span><br><span class="line">        this.minStack = <span class="built_in">append</span>(this.minStack, val)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pop (ç©ºé—´ä¼˜åŒ–ç‰ˆ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span></span> Pop() &#123;</span><br><span class="line">    <span class="comment">// å‡è®¾æ ˆéç©º (æ ¹æ®é¢˜ç›®çº¦æŸ)</span></span><br><span class="line">    poppedVal := this.stack[<span class="built_in">len</span>(this.stack)<span class="number">-1</span>]</span><br><span class="line">    this.stack = this.stack[:<span class="built_in">len</span>(this.stack)<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(this.minStack) &gt; <span class="number">0</span> &amp;&amp; poppedVal == this.minStack[<span class="built_in">len</span>(this.minStack)<span class="number">-1</span>] &#123;</span><br><span class="line">        this.minStack = this.minStack[:<span class="built_in">len</span>(this.minStack)<span class="number">-1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong> <code>Constructor</code>, <code>Top</code>, <code>GetMin</code> æ–¹æ³•ä¸åŸç‰ˆç›¸åŒã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è¾…åŠ©æ ˆæ³• (åŒæ­¥æ ˆ)</th>
<th>è¾…åŠ©æ ˆæ³• (ç©ºé—´ä¼˜åŒ–)</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>Push: O(1), Pop: O(1), Top: O(1), GetMin: O(1)</td>
<td>Push: O(1), Pop: O(1), Top: O(1), GetMin: O(1)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n) - è¾…åŠ©æ ˆä¸æ•°æ®æ ˆç­‰é•¿</td>
<td>O(n) - æœ€åæƒ…å†µ O(n) (å¦‚å•è°ƒé€’å‡åºåˆ—), å¹³å‡æƒ…å†µå¯èƒ½ä¼˜äºåŒæ­¥æ ˆ (å¦‚å•è°ƒé€’å¢åºåˆ—)</td>
</tr>
<tr>
<td><code>Push</code> å®ç°</td>
<td>æ€»æ˜¯å‘<code>minStack</code>æ¨å…¥å½“å‰æ¯”è¾ƒåçš„æœ€å°å€¼</td>
<td>ä»…å½“æ–°å…ƒç´  <code>&lt;= minStack</code>æ ˆé¡¶æ—¶æ¨å…¥</td>
</tr>
<tr>
<td><code>Pop</code> å®ç°</td>
<td>æ€»æ˜¯ä»<code>minStack</code>åŒæ­¥å¼¹å‡º</td>
<td>ä»…å½“å¼¹å‡ºå…ƒç´  <code>== minStack</code>æ ˆé¡¶æ—¶ä»<code>minStack</code>å¼¹å‡º</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°éå¸¸ç®€å•ï¼Œ<code>Pop</code>é€»è¾‘ç›´æ¥</td>
<td>åœ¨æŸäº›æ•°æ®æ¨¡å¼ä¸‹å¯èƒ½èŠ‚çœç©ºé—´</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td><code>minStack</code>ç©ºé—´å ç”¨ç›¸å¯¹å›ºå®š</td>
<td><code>Pop</code>é€»è¾‘ç¨å¤æ‚ï¼Œç©ºé—´èŠ‚çœæ•ˆæœä¾èµ–è¾“å…¥æ•°æ®åºåˆ—</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜… (å› å…¶ç®€æ´æ€§å’Œç¨³å®šæ€§)</td>
<td>â˜…â˜…â˜…â˜…â˜† (é€‚ç”¨äºå¯¹ç©ºé—´æœ‰æè‡´è¦æ±‚çš„åœºæ™¯ï¼Œæˆ–ä½œä¸ºç†è§£æ ˆè®¾è®¡çš„è¿›é˜¶)</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p>å¯¹äºä¸Šè¿°ä¸¤ç§è¾…åŠ©æ ˆå®ç°æ–¹æ³•ï¼š</p>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>:</p>
<ul>
<li><code>push()</code>: O(1)ã€‚</li>
<li><code>pop()</code>: O(1)ã€‚</li>
<li><code>top()</code>: O(1)ã€‚</li>
<li><code>getMin()</code>: O(1)ã€‚<br>
æ‰€æœ‰æ“ä½œå‡ä¸ºå¸¸æ•°æ—¶é—´ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(n)ï¼Œå…¶ä¸­ n æ˜¯æ ˆä¸­å…ƒç´ çš„æ•°é‡ã€‚</p>
<ul>
<li>å¯¹äºåŒæ­¥æ ˆæ–¹æ³•ï¼Œ<code>minStack</code> çš„å¤§å°ä¸ <code>stack</code> å§‹ç»ˆç›¸åŒã€‚</li>
<li>å¯¹äºç©ºé—´ä¼˜åŒ–æ–¹æ³•ï¼Œ<code>minStack</code> çš„å¤§å°åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ï¼Œè¾“å…¥åºåˆ—å•è°ƒé€’å‡ï¼‰ä¹Ÿæ˜¯ O(n)ï¼Œä½†å¹³å‡æƒ…å†µä¸‹å¯èƒ½å°äº O(n)ï¼ˆä¾‹å¦‚ï¼Œè¾“å…¥åºåˆ—å•è°ƒé€’å¢æ—¶ï¼Œ<code>minStack</code> åªå­˜ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li><strong>è¾…åŠ©æ•°æ®ç»“æ„</strong>: è§£å†³è¿™ç±»éœ€è¦åœ¨ç‰¹å®šçº¦æŸä¸‹ï¼ˆå¦‚å¸¸æ•°æ—¶é—´ï¼‰è·å–é¢å¤–ä¿¡æ¯çš„é—®é¢˜æ—¶ï¼Œè¾…åŠ©æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„æ€è·¯ã€‚</li>
<li><strong>åŒæ­¥æ“ä½œ</strong>: è¾…åŠ©æ ˆ <code>minStack</code> çš„æ“ä½œå¿…é¡»ä¸ä¸»æ•°æ®æ ˆ <code>stack</code> çš„æ“ä½œåŒæ­¥ï¼Œä»¥ç¡®ä¿ <code>minStack</code> æ ˆé¡¶å§‹ç»ˆå¯¹åº” <code>stack</code> å½“å‰çŠ¶æ€çš„æœ€å°å€¼ã€‚</li>
<li><strong>ç©ºé—´æ¢æ—¶é—´</strong>: è¾…åŠ©æ ˆçš„ä½¿ç”¨æ˜¯ä»¥é¢å¤–çš„ç©ºé—´å¼€é”€ä¸ºä»£ä»·ï¼Œæ¥æ¢å– <code>getMin</code> æ“ä½œçš„å¸¸æ•°æ—¶é—´å¤æ‚åº¦ã€‚</li>
<li><strong>ç©ºé—´ä¼˜åŒ–</strong>: åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œé€šè¿‡ä¼˜åŒ–è¾…åŠ©æ ˆçš„ä½¿ç”¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥å‡å°‘ç©ºé—´å ç”¨ã€‚</li>
</ul>
<p>è¿™é“é¢˜æ˜¯æ ˆç›¸å…³é—®é¢˜ä¸­çš„ç»å…¸é¢˜ç›®ï¼Œç†è§£è¾…åŠ©æ ˆçš„æ€æƒ³ä»¥åŠç©ºé—´ä¼˜åŒ–çš„ç­–ç•¥å¯¹äºè§£å†³ç±»ä¼¼é—®é¢˜å¾ˆæœ‰å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ˆ</category>
      </categories>
      <tags>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>æ ˆ</tag>
        <tag>è®¾è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL æ˜¯æ€ä¹ˆåŠ é”çš„ï¼Ÿâ€”â€” æ·±å…¥è§£æMySQLé”æœºåˆ¶</title>
    <url>/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/</url>
    <content><![CDATA[<h1>MySQL æ˜¯æ€ä¹ˆåŠ é”çš„ï¼Ÿ</h1>
<h2 id="ä»€ä¹ˆ-SQL-è¯­å¥ä¼šåŠ è¡Œçº§é”ï¼Ÿ">ä»€ä¹ˆ SQL è¯­å¥ä¼šåŠ è¡Œçº§é”ï¼Ÿ</h2>
<p>InnoDB å­˜å‚¨å¼•æ“æ”¯æŒè¡Œçº§é”ï¼Œè€Œ MyISAM å­˜å‚¨å¼•æ“åˆ™ä¸æ”¯æŒã€‚å› æ­¤ï¼Œåç»­å†…å®¹å‡åŸºäº InnoDB å¼•æ“è¿›è¡Œè®¨è®ºã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æ¢è®¨ MySQL å¦‚ä½•æ·»åŠ è¡Œçº§é”æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¨è®º InnoDB å¼•æ“æ˜¯å¦‚ä½•å®ç°è¡Œçº§é”çš„ã€‚</p>
<p>æ™®é€šçš„ <code>select</code> è¯­å¥é€šå¸¸ä¸ä¼šå¯¹è®°å½•åŠ é”ï¼Œå› ä¸ºå®ƒå±äº&quot;å¿«ç…§è¯»&quot;ï¼ˆSnapshot Readï¼‰ï¼Œæ˜¯é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æœºåˆ¶å®ç°çš„ï¼Œç›®çš„æ˜¯æä¾›ä¸€è‡´æ€§çš„éé˜»å¡è¯»ã€‚</p>
<p>å¦‚æœå¸Œæœ›åœ¨æŸ¥è¯¢æ—¶å¯¹è®°å½•æ–½åŠ è¡Œçº§é”ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼Œè¿™ç±»ä¼šåŠ é”çš„æŸ¥è¯¢è¢«ç§°ä¸º&quot;é”å®šè¯»&quot;ï¼ˆLocking Readï¼‰ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é” (Så‹é”)</span><br><span class="line"><span class="keyword">select</span> ... lock <span class="keyword">in</span> share mode;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> å¯¹è¯»å–çš„è®°å½•åŠ ç‹¬å é” (Xå‹é”)</span><br><span class="line"><span class="keyword">select</span> ... <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°è¿™ä¸¤æ¡è¯­å¥å¿…é¡»åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œ<strong>å› ä¸ºé”çš„ç”Ÿå‘½å‘¨æœŸä¸äº‹åŠ¡ç»‘å®šï¼Œäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œæ‰€æœ‰é”ä¾¿ä¼šé‡Šæ”¾</strong>ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨è¿™äº›è¯­å¥æ—¶ï¼ŒåŠ¡å¿…å…ˆé€šè¿‡ <code>begin</code> æˆ– <code>start transaction</code> å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚</p>
<p><strong>é™¤äº†ä¸Šè¿°çš„é”å®šè¯»è¯­å¥ä¼šæ·»åŠ è¡Œçº§é”ä¹‹å¤–ï¼Œ<code>update</code> å’Œ <code>delete</code> æ“ä½œåŒæ ·ä¼šæ·»åŠ è¡Œçº§é”ï¼Œå¹¶ä¸”å®ƒä»¬æ·»åŠ çš„éƒ½æ˜¯ç‹¬å é” (X å‹é”)</strong>ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> å¯¹æ“ä½œçš„è®°å½•åŠ ç‹¬å é” (Xå‹é”)</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">table</span> .... <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> å¯¹æ“ä½œçš„è®°å½•åŠ ç‹¬å é” (Xå‹é”)</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>å…±äº«é”ï¼ˆS é”ï¼‰çš„ç‰¹æ€§æ˜¯&quot;è¯»è¯»å…±äº«ï¼Œè¯»å†™äº’æ–¥&quot;ï¼Œå³å¤šä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒä¸€è®°å½•çš„ S é”è¿›è¡Œè¯»å–ï¼Œä½†ä»»ä½•æŒæœ‰ S é”çš„äº‹åŠ¡éƒ½ä¸èƒ½å†™å…¥ï¼Œä»»ä½•å°è¯•å†™å…¥çš„äº‹åŠ¡ä¹Ÿä¸èƒ½è·å– S é”ã€‚</p>
<p>ç‹¬å é”ï¼ˆX é”ï¼‰çš„ç‰¹æ€§æ˜¯&quot;å†™å†™äº’æ–¥ï¼Œè¯»å†™äº’æ–¥&quot;ï¼Œå³ä¸€æ—¦ä¸€ä¸ªäº‹åŠ¡æŒæœ‰äº†è®°å½•çš„ X é”ï¼Œå…¶ä»–ä»»ä½•äº‹åŠ¡éƒ½ä¸èƒ½å†å¯¹è¯¥è®°å½•æ–½åŠ  S é”æˆ– X é”ã€‚</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970217982.png" alt="1746970217982"></p>
<h2 id="è¡Œçº§é”æœ‰å“ªäº›ç§ç±»ï¼Ÿ">è¡Œçº§é”æœ‰å“ªäº›ç§ç±»ï¼Ÿ</h2>
<p>åœ¨ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¡Œçº§é”çš„ç§ç±»ä¹Ÿæœ‰æ‰€ä¸åŒã€‚</p>
<p>åœ¨&quot;è¯»å·²æäº¤&quot;ï¼ˆRead Committedï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¡Œçº§é”ä¸»è¦è¡¨ç°ä¸ºè®°å½•é”ï¼ˆRecord Lockï¼‰ï¼Œå³ä»…ä»…é”å®šæŸä¸€æ¡è®°å½•ã€‚</p>
<p>åœ¨&quot;å¯é‡å¤è¯»&quot;ï¼ˆRepeatable Readï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸ºäº†é¿å…&quot;å¹»è¯»&quot;ï¼ˆPhantom Readï¼‰é—®é¢˜ï¼Œé™¤äº†è®°å½•é”ä¹‹å¤–ï¼Œè¿˜å¼•å…¥äº†é—´éš™é”ï¼ˆGap Lockï¼‰ã€‚å› æ­¤ï¼Œåœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¡Œçº§é”ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç±»ï¼š</p>
<ul>
<li><strong>Record Lock (è®°å½•é”)</strong>ï¼šä»…ä»…é”å®šä¸€æ¡è®°å½•ã€‚</li>
<li><strong>Gap Lock (é—´éš™é”)</strong>ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚</li>
<li><strong>Next-Key Lock (ä¸´é”®é”)</strong>ï¼šRecord Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«è¯¦ç»†ä»‹ç»è¿™ä¸‰ç§è¡Œçº§é”ã€‚</p>
<h3 id="Record-Lock">Record Lock</h3>
<p>Record Lockï¼Œå³è®°å½•é”ï¼Œç”¨äºé”å®šå•æ¡è®°å½•ã€‚è®°å½•é”åˆ†ä¸º S å‹è®°å½•é”å’Œ X å‹è®°å½•é”ï¼š</p>
<ul>
<li>å½“ä¸€ä¸ªäº‹åŠ¡ä¸ºæŸæ¡è®°å½•æ·»åŠ äº† S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä»ç„¶å¯ä»¥ç»§ç»­ä¸ºè¯¥è®°å½•æ·»åŠ  S å‹è®°å½•é”ï¼ˆS é”ä¹‹é—´å…¼å®¹ï¼‰ï¼Œä½†ä¸èƒ½æ·»åŠ  X å‹è®°å½•é”ï¼ˆS é”ä¸ X é”äº’æ–¥ï¼‰ã€‚</li>
<li>å½“ä¸€ä¸ªäº‹åŠ¡ä¸ºæŸæ¡è®°å½•æ·»åŠ äº† X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸èƒ½ä¸ºè¯¥è®°å½•æ·»åŠ  S å‹è®°å½•é”ï¼ˆS é”ä¸ X é”äº’æ–¥ï¼‰ï¼Œä¹Ÿä¸èƒ½æ·»åŠ  X å‹è®°å½•é”ï¼ˆX é”ä¹‹é—´ä¹Ÿäº’æ–¥ï¼‰ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_test <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>
<p>è¯¥äº‹åŠ¡ä¼šä¸ºè¡¨ä¸­ä¸»é”® <code>id = 1</code> çš„è®°å½•æ·»åŠ ä¸€ä¸ª X å‹çš„è®°å½•é”ã€‚æ­¤æ—¶ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡å°è¯•å¯¹è¿™æ¡è®°å½•è¿›è¡Œåˆ é™¤æˆ–æ›´æ–°æ“ä½œï¼Œè¿™äº›æ“ä½œå°†ä¼šè¢«é˜»å¡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡å°è¯•æ’å…¥ä¸€æ¡ <code>id = 1</code> çš„æ–°è®°å½•ï¼Œè¯¥æ“ä½œä¸ä¼šè¢«è¿™ä¸ªè®°å½•é”é˜»å¡ï¼Œä½†ä¼šå› ä¸ºä¸»é”®çš„å”¯ä¸€æ€§çº¦æŸè€ŒæŠ¥é”™ã€‚</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970230632.png" alt="1746970230632"></p>
<p>å½“äº‹åŠ¡æ‰§è¡Œ <code>commit</code> åï¼Œå…¶åœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ‰€æœ‰é”éƒ½å°†è¢«é‡Šæ”¾ã€‚</p>
<h3 id="Gap-Lock">Gap Lock</h3>
<p>Gap Lockï¼Œå³é—´éš™é”ï¼Œä»…å­˜åœ¨äºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸­ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³è¯¥éš”ç¦»çº§åˆ«ä¸‹çš„å¹»è¯»é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè‹¥è¡¨ä¸­å­˜åœ¨ä¸€ä¸ªè¦†ç›– <code>id</code> èŒƒå›´ <code>(3, 5)</code> çš„é—´éš™é”ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å°†æ— æ³•æ’å…¥ <code>id = 4</code> è¿™æ¡è®°å½•ï¼Œä»è€Œæœ‰æ•ˆåœ°é˜²æ­¢äº†å¹»è¯»ç°è±¡çš„å‘ç”Ÿã€‚</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970239002.png" alt="1746970239002"></p>
<p>é—´éš™é”è™½ç„¶ä¹ŸåŒºåˆ† X å‹å’Œ S å‹ï¼Œä½†å®é™…ä¸Šå®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰åŠŸèƒ½ä¸Šçš„å·®å¼‚ã€‚<strong>é—´éš™é”ä¹‹é—´æ˜¯ç›¸äº’å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™èŒƒå›´çš„é—´éš™é”ï¼Œå®ƒä»¬ä¹‹é—´ä¸å­˜åœ¨äº’æ–¥å…³ç³»ã€‚è¿™æ˜¯å› ä¸ºé—´éš™é”çš„æ ¸å¿ƒç›®æ ‡æ˜¯é˜»æ­¢æ–°çš„è®°å½•æ’å…¥åˆ°é—´éš™ä¸­ï¼Œä»¥é˜²æ­¢å¹»è¯»ã€‚</strong></p>
<h3 id="Next-Key-Lock">Next-Key Lock</h3>
<p>Next-Key Lockï¼Œå³ä¸´é”®é”ï¼Œæ˜¯ Record Lock å’Œ Gap Lock çš„ç»“åˆä½“ã€‚å®ƒé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”åŒæ—¶é”å®šèŒƒå›´å³è¾¹ç•Œä¸Šçš„é‚£æ¡è®°å½•æœ¬èº«ã€‚é€šå¸¸æˆ‘ä»¬è¯´çš„ Next-Key Lock çš„åŒºé—´æ˜¯ä¸€ä¸ªå·¦å¼€å³é—­çš„åŒºé—´ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè‹¥è¡¨ä¸­å­˜åœ¨ä¸€ä¸ªè¦†ç›– <code>id</code> èŒƒå›´ <code>(3, 5]</code> çš„ next-key lockï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡æ—¢ä¸èƒ½æ’å…¥ <code>id = 4</code> çš„è®°å½•ï¼ˆè¢« Gap éƒ¨åˆ†è¦†ç›–ï¼‰ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹æˆ–åˆ é™¤ <code>id = 5</code> è¿™æ¡è®°å½•ï¼ˆè¢« Record éƒ¨åˆ†è¦†ç›–ï¼‰ã€‚</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970246308.png" alt="1746970246308"></p>
<p>å› æ­¤ï¼Œnext-key lock æ—¢èƒ½ä¿æŠ¤ç›®æ ‡è®°å½•ä¸è¢«ä¿®æ”¹æˆ–åˆ é™¤ï¼Œåˆèƒ½é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¢«ä¿æŠ¤è®°å½•ä¹‹å‰çš„é—´éš™ä¸­æ’å…¥æ–°è®°å½•ã€‚</p>
<p><strong>ç”±äº next-key lock åŒ…å«äº†è®°å½•é”å’Œé—´éš™é”ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è·å–äº† X å‹çš„ next-key lockï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡è¯•å›¾è·å–ç›¸åŒèŒƒå›´çš„ X å‹ next-key lock æ—¶å°†ä¼šè¢«é˜»å¡ã€‚</strong></p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡æŒæœ‰äº†èŒƒå›´ä¸º <code>(1, 10]</code> çš„ X å‹ next-key lockï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡åœ¨å°è¯•è·å–ç›¸åŒèŒƒå›´çš„ X å‹ next-key lock æ—¶å°±ä¼šå‘ç”Ÿé˜»å¡ã€‚</p>
<p>è™½ç„¶è¦†ç›–ç›¸åŒèŒƒå›´çš„é—´éš™é”æ˜¯ç›¸äº’å…¼å®¹çš„ï¼Œä½†å¯¹äº next-key lock ä¸­çš„è®°å½•é”éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä»éœ€è€ƒè™‘ X å‹ä¸ S å‹é”ä¹‹é—´çš„å…¼å®¹å…³ç³»ï¼šX å‹çš„è®°å½•é”ä¸ X å‹çš„è®°å½•é”æ˜¯å†²çªçš„ï¼ŒX å‹è®°å½•é”ä¸ S å‹è®°å½•é”ä¹Ÿæ˜¯å†²çªçš„ã€‚</p>
<h2 id="MySQL-æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ">MySQL æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ</h2>
<p>è¡Œçº§é”çš„åŠ é”è§„åˆ™ç›¸å½“å¤æ‚ï¼Œä¸åŒçš„æŸ¥è¯¢åœºæ™¯ä¸‹ï¼Œå…¶åŠ é”å½¢å¼ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚</p>
<p><strong>MySQL åŠ é”çš„å¯¹è±¡æ˜¯ç´¢å¼•ï¼Œè€ŒåŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lock</strong>ã€‚next-key lock ç”±è®°å½•é”å’Œé—´éš™é”ç»„åˆè€Œæˆï¼Œå…¶é”å®šèŒƒå›´é€šå¸¸æ˜¯ä¸€ä¸ª<strong>å‰å¼€åé—­</strong>çš„åŒºé—´ï¼ˆä¾‹å¦‚ <code>(a, b]</code>ï¼‰ã€‚ç›¸å¯¹åœ°ï¼Œå•çº¯çš„é—´éš™é”é”å®šçš„æ˜¯ä¸€ä¸ª<strong>å‰å¼€åå¼€</strong>çš„åŒºé—´ï¼ˆä¾‹å¦‚ <code>(a, b)</code>ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œnext-key lock å¯èƒ½ä¼š&quot;é€€åŒ–&quot;ä¸ºè®°å½•é”æˆ–é—´éš™é”ã€‚æ€»ç»“å…¶é€€åŒ–åŸåˆ™å°±æ˜¯ï¼š<strong>åœ¨ä»…é€šè¿‡è®°å½•é”æˆ–é—´éš™é”å°±èƒ½æœ‰æ•ˆé¿å…å¹»è¯»é—®é¢˜çš„åœºæ™¯ä¸‹ï¼Œnext-key lock å°±ä¼šè¿›è¡Œç›¸åº”çš„é€€åŒ–ã€‚</strong></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹è¡¨ç»“æ„è¿›è¡Œå®éªŒè¯´æ˜ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">  KEY `index_age` (`age`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>id</code> æ˜¯ä¸»é”®ç´¢å¼•ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œ<code>age</code> æ˜¯æ™®é€šç´¢å¼•ï¼ˆéå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œ<code>name</code> æ˜¯ä¸€ä¸ªæ²¡æœ‰ç´¢å¼•çš„æ™®é€šåˆ—ã€‚</p>
<p>è¡¨ä¸­çš„åˆå§‹è®°å½•å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>è·¯é£</td>
<td>19</td>
</tr>
<tr>
<td>5</td>
<td>ç´¢éš†</td>
<td>21</td>
</tr>
<tr>
<td>10</td>
<td>å±±æ²»</td>
<td>22</td>
</tr>
<tr>
<td>15</td>
<td>ä¹Œç´¢æ™®</td>
<td>20</td>
</tr>
<tr>
<td>20</td>
<td>é¦™å…‹æ–¯</td>
<td>39</td>
</tr>
</tbody>
</table>
<p>æœ¬æ¬¡å®éªŒç¯å¢ƒçš„ <strong>MySQL ç‰ˆæœ¬ä¸º 8.0.26ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºã€Œå¯é‡å¤è¯»ã€</strong>ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œä¸åŒ MySQL ç‰ˆæœ¬çš„åŠ é”è§„åˆ™å¯èƒ½å­˜åœ¨ç»†å¾®å·®å¼‚ï¼Œä½†æ€»ä½“é€»è¾‘æ˜¯ç›¸ä¼¼çš„ã€‚</p>
<h3 id="å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢">å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</h3>
<p>å½“ä½¿ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œæ ¹æ®æŸ¥è¯¢çš„è®°å½•æ˜¯å¦å­˜åœ¨ï¼ŒåŠ é”è§„åˆ™æœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li>å½“æŸ¥è¯¢çš„è®°å½• <strong>ã€Œå­˜åœ¨ã€</strong> æ—¶ï¼Œåœ¨ç´¢å¼•æ ‘ä¸Šå®šä½åˆ°è¯¥è®°å½•åï¼Œæ–½åŠ åœ¨è¯¥è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key lock ä¼š<strong>é€€åŒ–ä¸ºã€Œè®°å½•é”ã€</strong>ã€‚</li>
<li>å½“æŸ¥è¯¢çš„è®°å½• <strong>ã€Œä¸å­˜åœ¨ã€</strong> æ—¶ï¼Œåœ¨ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ°ç¬¬ä¸€æ¡å¤§äºè¯¥æŸ¥è¯¢è®°å½•å€¼çš„è®°å½•åï¼Œæ–½åŠ åœ¨è¯¥è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key lock ä¼š<strong>é€€åŒ–ä¸ºã€Œé—´éš™é”ã€</strong>ï¼Œè¯¥é—´éš™é”è¦†ç›–çš„èŒƒå›´æ˜¯æŸ¥ä¸åˆ°çš„é‚£æ¡è®°å½•åˆ°è¿™æ¡å¤§äºå®ƒçš„è®°å½•ä¹‹é—´çš„é—´éš™ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥é€šè¿‡ä¸¤ä¸ªæ¡ˆä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>
<h4 id="1ã€è®°å½•å­˜åœ¨çš„æƒ…å†µ">1ã€è®°å½•å­˜åœ¨çš„æƒ…å†µ</h4>
<p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹ç­‰å€¼æŸ¥è¯¢è¯­å¥ï¼Œä¸”æŸ¥è¯¢çš„è®°å½• <code>id = 1</code> <strong>å­˜åœ¨</strong>äºè¡¨ä¸­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> è·¯é£   <span class="operator">|</span>  <span class="number">19</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œäº‹åŠ¡ A ä¼šä¸º <code>id = 1</code> çš„è¿™æ¡è®°å½•æ·»åŠ ä¸€ä¸ª <strong>X å‹çš„è®°å½•é”</strong>ã€‚</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970299852.png" alt="1746970299852"></p>
<p>è‹¥æ­¤æ—¶æœ‰å…¶ä»–äº‹åŠ¡å°è¯•å¯¹ <code>id = 1</code> çš„è®°å½•è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œï¼Œè¿™äº›æ“ä½œéƒ½å°†è¢«é˜»å¡ã€‚è¿™æ˜¯å› ä¸ºæ›´æ–°æˆ–åˆ é™¤æ“ä½œä¹Ÿä¼šå°è¯•å¯¹è¯¥è®°å½•æ·»åŠ  X å‹çš„è®°å½•é”ï¼Œè€Œ X é”ä¸ X é”ä¹‹é—´æ˜¯äº’æ–¥çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970306340.png" alt="1746970306340"></p>
<p>ç”±äºäº‹åŠ¡ A å¯¹ <code>id = 1</code> çš„è®°å½•æŒæœ‰äº† X å‹è®°å½•é”ï¼Œäº‹åŠ¡ B ä¿®æ”¹ <code>id=1</code> è®°å½•çš„æ“ä½œå’Œäº‹åŠ¡ C åˆ é™¤ <code>id=1</code> è®°å½•çš„æ“ä½œéƒ½ä¼šè¢«é˜»å¡ã€‚</p>
<blockquote>
<p>æœ‰ä»€ä¹ˆå‘½ä»¤å¯ä»¥åˆ†æåŠ äº†ä»€ä¹ˆé”ï¼Ÿ</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ <code>select * from performance_schema.data_locks\G;</code> è¿™æ¡è¯­å¥ï¼Œæ¥æŸ¥çœ‹å½“å‰äº‹åŠ¡åœ¨æ‰§è¡Œ SQL è¿‡ç¨‹ä¸­å…·ä½“æ·»åŠ äº†å“ªäº›é”ã€‚</p>
<p>ä»¥ä¸Šè¿°äº‹åŠ¡ A ä¸ºä¾‹ï¼Œåˆ†æå…¶åŠ é”æƒ…å†µï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970318268.png" alt="1746970318268"></p>
<p>ä»ä¸Šå›¾çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡ A å…±æ·»åŠ äº†ä¸¤ç§é”ï¼š</p>
<ul>
<li><strong>è¡¨é” (Table Lock)</strong>ï¼šç±»å‹ä¸º <code>IX</code> (Intent Exclusiveï¼Œæ„å‘æ’ä»–é”)ã€‚è¿™æ˜¯ InnoDB åœ¨å¯¹è¡ŒåŠ é”å‰ï¼Œä¸ºäº†åè°ƒè¡¨çº§é”å’Œè¡Œçº§é”çš„å…³ç³»è€Œè‡ªåŠ¨åŠ çš„è¡¨çº§é”ã€‚</li>
<li><strong>è¡Œé” (Row Lock)</strong>ï¼š<code>LOCK_TYPE</code> æ˜¾ç¤ºä¸º <code>RECORD</code>ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¡Œçº§é”ã€‚</li>
</ul>
<p>æˆ‘ä»¬é‡ç‚¹å…³æ³¨è¡Œçº§é”ã€‚é€šè¿‡ <code>LOCK_MODE</code> å­—æ®µå¯ä»¥è¿›ä¸€æ­¥åŒºåˆ†æ˜¯ next-key é”ã€é—´éš™é”è¿˜æ˜¯è®°å½•é”ï¼š</p>
<ul>
<li>å¦‚æœ <code>LOCK_MODE</code> ä¸º <code>X</code>ï¼Œé€šå¸¸è¡¨ç¤º next-key é”ã€‚</li>
<li>å¦‚æœ <code>LOCK_MODE</code> ä¸º <code>X, REC_NOT_GAP</code>ï¼Œæ˜ç¡®è¡¨ç¤ºæ˜¯è®°å½•é”ã€‚</li>
<li>å¦‚æœ <code>LOCK_MODE</code> ä¸º <code>X, GAP</code>ï¼Œæ˜ç¡®è¡¨ç¤ºæ˜¯é—´éš™é”ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<strong>äº‹åŠ¡ A åœ¨ <code>id = 1</code> è¿™æ¡è®°å½•çš„ä¸»é”®ç´¢å¼•ä¸Šæ·»åŠ çš„æ˜¯ X å‹è®°å½•é”</strong>ï¼Œé”å®šçš„å°±æ˜¯ <code>id = 1</code> è¿™ä¸€è¡Œæ•°æ®ã€‚è¿™ä½¿å¾—å…¶ä»–äº‹åŠ¡æ— æ³•å¯¹è¯¥è®°å½•è¿›è¡Œæ›´æ–°å’Œåˆ é™¤ã€‚</p>
<p>ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œ<strong>åŠ é”æ˜¯é’ˆå¯¹ç´¢å¼•è¿›è¡Œçš„</strong>ã€‚ç”±äºæ­¤æŸ¥è¯¢è¯­å¥é€šè¿‡èšç°‡ç´¢å¼•ï¼ˆå³ä¸»é”®ç´¢å¼•ï¼‰è¿›è¡Œæ‰«æï¼Œå› æ­¤é”æ˜¯æ–½åŠ åœ¨ä¸»é”®ç´¢å¼•ä¸Šçš„ã€‚å¯¹ç›¸åº”è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹æ·»åŠ è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡å°±ä¸èƒ½æ›´æ–°æˆ–åˆ é™¤è¿™æ¡è®°å½•äº†ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢ä¸”è®°å½•å­˜åœ¨çš„åœºæ™¯ä¸‹ï¼Œnext-key lock ä¼šé€€åŒ–æˆè®°å½•é”ï¼Ÿ</p>
</blockquote>
<p>æ ¸å¿ƒåŸå› åœ¨äºï¼Œåœ¨è¿™ç§ç‰¹å®šåœºæ™¯ä¸‹ï¼Œ<strong>ä»…ä¾é è®°å½•é”å°±è¶³ä»¥é¿å…å¹»è¯»é—®é¢˜</strong>ã€‚</p>
<p>å¹»è¯»çš„å®šä¹‰æ˜¯ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå‰åä¸¤æ¬¡æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢ï¼Œç»“æœé›†å´ä¸ä¸€è‡´ï¼ˆä¾‹å¦‚ï¼Œå¤šå‡ºæˆ–å°‘äº†ä¸€äº›è¡Œï¼‰ã€‚è¦é¿å…å¹»è¯»ï¼Œå°±éœ€è¦é˜²æ­¢åœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´ï¼Œç»“æœé›†ä¸­çš„æŸæ¡è®°å½•è¢«å…¶ä»–äº‹åŠ¡åˆ é™¤ï¼Œæˆ–è€…æœ‰å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ–°çš„ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•ã€‚</p>
<ul>
<li><strong>é˜²æ­¢æ–°è®°å½•æ’å…¥</strong>ï¼šç”±äºä¸»é”®å…·æœ‰å”¯ä¸€æ€§çº¦æŸï¼Œä»»ä½•å…¶ä»–äº‹åŠ¡å°è¯•æ’å…¥ä¸€æ¡ <code>id = 1</code> çš„æ–°è®°å½•æ—¶ï¼Œéƒ½ä¼šå› ä¸ºä¸»é”®å†²çªè€Œå¤±è´¥ã€‚è¿™å°±ä¿è¯äº†äº‹åŠ¡ A åœ¨å¤šæ¬¡æŸ¥è¯¢ <code>id = 1</code> çš„è®°å½•æ—¶ï¼Œä¸ä¼šå‡­ç©ºå¤šå‡ºä¸€æ¡ <code>id = 1</code> çš„è®°å½•ã€‚</li>
<li><strong>é˜²æ­¢è®°å½•è¢«åˆ é™¤/ä¿®æ”¹</strong>ï¼šç”±äºäº‹åŠ¡ A å¯¹ <code>id = 1</code> çš„è®°å½•æ·»åŠ äº†è®°å½•é”ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•åˆ é™¤æˆ–ä¿®æ”¹è¿™æ¡è®°å½•ã€‚è¿™å°±ä¿è¯äº†äº‹åŠ¡ A åœ¨å¤šæ¬¡æŸ¥è¯¢ <code>id = 1</code> çš„è®°å½•æ—¶ï¼Œè¯¥è®°å½•ä¸ä¼šæ¶ˆå¤±æˆ–è¢«æ”¹å˜ã€‚</li>
</ul>
<p>ç»¼ä¸Šï¼Œä¸€ä¸ªè®°å½•é”å·²ç»èƒ½ç¡®ä¿æŸ¥è¯¢ <code>id=1</code> çš„ç»“æœä¸€è‡´æ€§ï¼Œå› æ­¤ next-key lock é€€åŒ–ä¸ºæ›´è½»é‡çº§çš„è®°å½•é”æ˜¯åˆç†çš„ä¼˜åŒ–ã€‚</p>
<h4 id="2ã€è®°å½•ä¸å­˜åœ¨çš„æƒ…å†µ">2ã€è®°å½•ä¸å­˜åœ¨çš„æƒ…å†µ</h4>
<p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹ç­‰å€¼æŸ¥è¯¢è¯­å¥ï¼Œä½†æŸ¥è¯¢çš„è®°å½• <code>id = 2</code> <strong>ä¸å­˜åœ¨</strong>äºè¡¨ä¸­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> æŸ¥çœ‹åŠ é”æƒ…å†µï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970329203.png" alt="1746970329203"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¡Œé”çš„ <code>LOCK_MODE</code> ä¸º <code>X, GAP</code>ï¼Œè¡¨ç¤ºæ·»åŠ äº† X å‹çš„é—´éš™é”ã€‚</p>
<p>å…·ä½“åˆ†æï¼š<br>
MySQL åœ¨ä¸»é”®ç´¢å¼•ä¸ŠæŸ¥æ‰¾ <code>id = 2</code> çš„è®°å½•ã€‚ç”±äº <code>id = 2</code> ä¸å­˜åœ¨ï¼Œå®ƒä¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äº 2 çš„è®°å½•ï¼Œå³ <code>id = 5</code>ã€‚ç„¶åï¼Œåœ¨ <code>id = 5</code> è¿™æ¡è®°å½•å¯¹åº”çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ ä¸€ä¸ªé—´éš™é”ã€‚è¿™ä¸ªé—´éš™é”è¦†ç›–çš„èŒƒå›´æ˜¯è¡¨ä¸­ <code>id = 5</code> ä¹‹å‰çš„è®°å½• <code>id = 1</code> åˆ° <code>id = 5</code> ä¹‹é—´çš„é—´éš™ï¼Œå³ <code>(1, 5)</code>ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>äº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ä¸Šæ·»åŠ äº†ä¸€ä¸ªè¦†ç›–èŒƒå›´ <code>(1, 5)</code> çš„ X å‹é—´éš™é”ã€‚</strong></p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970337602.png" alt="1746970337602"></p>
<p>è¿™ä¸ªé—´éš™é”æ„å‘³ç€ï¼Œå…¶ä»–äº‹åŠ¡å°†æ— æ³•æ’å…¥ <code>id</code> å€¼ä¸º 2ã€3ã€4 çš„æ–°è®°å½•ï¼Œå› ä¸ºè¿™äº›å€¼éƒ½è½åœ¨äº† <code>(1, 5)</code> è¿™ä¸ªé—´éš™å†…ã€‚</p>
<p>æ³¨æ„ï¼šå¦‚æœå…¶ä»–äº‹åŠ¡å°è¯•æ’å…¥ <code>id = 1</code> æˆ– <code>id = 5</code> çš„è®°å½•ï¼Œå®ƒä»¬ä¸ä¼šè¢«è¿™ä¸ªé—´éš™é”é˜»å¡ï¼Œè€Œæ˜¯ä¼šå› ä¸ºä¸»é”®å†²çªï¼ˆè¡¨ä¸­å·²å­˜åœ¨è¿™äº›è®°å½•ï¼‰è€ŒæŠ¥é”™ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970344320.png" alt="1746970344320"></p>
<p>ç”±äºäº‹åŠ¡ A æŒæœ‰èŒƒå›´ä¸º <code>(1, 5)</code> çš„ X å‹é—´éš™é”ï¼Œäº‹åŠ¡ B å°è¯•æ’å…¥ <code>id = 3</code> çš„è®°å½•æ—¶ï¼Œå…¶æ“ä½œä¼šè¢«é˜»å¡ã€‚</p>
<blockquote>
<p>è¿™ä¸ªé—´éš™é”çš„èŒƒå›´ <code>(1, 5)</code> æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ</p>
</blockquote>
<p>æ ¹æ® <code>performance_schema.data_locks</code> çš„è¾“å‡ºï¼Œå¦‚æœ <code>LOCK_MODE</code> æ˜¯ next-key é”æˆ–é—´éš™é”ï¼Œ<code>LOCK_DATA</code> å­—æ®µé€šå¸¸è¡¨ç¤ºé”èŒƒå›´çš„&quot;å³è¾¹ç•Œ&quot;ã€‚åœ¨æ­¤æ¬¡äº‹åŠ¡ A çš„ä¾‹å­ä¸­ï¼Œ<code>LOCK_DATA</code> æ˜¯ 5ã€‚<br>
ç„¶åï¼Œé”èŒƒå›´çš„&quot;å·¦è¾¹ç•Œ&quot;æ˜¯è¡¨ä¸­ <code>id</code> ä¸º 5 çš„è®°å½•çš„å‰ä¸€æ¡è®°å½•çš„ <code>id</code> å€¼ï¼Œå³ 1ã€‚<br>
å› æ­¤ï¼Œé—´éš™é”çš„èŒƒå›´ç¡®å®šä¸º <code>(1, 5)</code>ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢ä¸”è®°å½•ã€Œä¸å­˜åœ¨ã€çš„åœºæ™¯ä¸‹ï¼Œnext-key lock ä¼šé€€åŒ–æˆã€Œé—´éš™é”ã€ï¼Ÿ</p>
</blockquote>
<p>åŸå› åŒæ ·æ˜¯ä¸ºäº†åœ¨é¿å…å¹»è¯»çš„å‰æä¸‹ï¼Œä½¿ç”¨å°½å¯èƒ½å°çš„é”èŒƒå›´ã€‚</p>
<ul>
<li><strong>ä¸ºä»€ä¹ˆä¸æ˜¯ next-key lockï¼Ÿ</strong> å¦‚æœå¯¹ <code>id = 5</code> çš„ç´¢å¼•é¡¹åŠ  next-key lock <code>(1, 5]</code>ï¼Œè¿™æ„å‘³ç€å…¶ä»–äº‹åŠ¡æ— æ³•åˆ é™¤æˆ–ä¿®æ”¹ <code>id = 5</code> è¿™æ¡è®°å½•ã€‚ä½†æˆ‘ä»¬æŸ¥è¯¢çš„æ˜¯ <code>id = 2</code>ï¼Œåªè¦ä¿è¯å‰åä¸¤æ¬¡æŸ¥è¯¢ <code>id = 2</code> çš„ç»“æœé›†ç›¸åŒï¼ˆå³æ²¡æœ‰æ–°çš„ <code>id = 2</code> æ’å…¥ï¼‰ï¼Œå°±èƒ½é¿å…å¹»è¯»ã€‚<code>id = 5</code> æ˜¯å¦è¢«åˆ é™¤å¯¹æŸ¥è¯¢ <code>id = 2</code> çš„ç»“æœæ²¡æœ‰å½±å“ã€‚å› æ­¤ï¼Œæ²¡æœ‰å¿…è¦é”å®š <code>id = 5</code> æœ¬èº«ï¼Œä¸€ä¸ªè¦†ç›– <code>(1, 5)</code> çš„é—´éš™é”è¶³ä»¥é˜»æ­¢ <code>id = 2, 3, 4</code> çš„æ’å…¥ã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆä¸æ˜¯è®°å½•é”ï¼Ÿ</strong> é”æ˜¯æ–½åŠ åœ¨ç´¢å¼•é¡¹ä¸Šçš„ã€‚ç”±äºæŸ¥è¯¢çš„è®°å½• <code>id = 2</code> æœ¬èº«å¹¶ä¸å­˜åœ¨äºç´¢å¼•ä¸­ï¼Œè‡ªç„¶æ— æ³•å¯¹ä¸€ä¸ªä¸å­˜åœ¨çš„è®°å½•æ–½åŠ è®°å½•é”ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œé€€åŒ–ä¸ºé—´éš™é” <code>(1, 5)</code> æ˜¯æœ€åˆé€‚çš„é€‰æ‹©ã€‚</p>
<h3 id="å”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢">å”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢</h3>
<p>å”¯ä¸€ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢ä¸ç­‰å€¼æŸ¥è¯¢çš„åŠ é”è§„åˆ™æœ‰æ‰€ä¸åŒã€‚</p>
<p>å½“ä½¿ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œ<strong>MySQL ä¼šå¯¹æ‰«æåˆ°çš„æ¯ä¸€ä¸ªç´¢å¼•é¡¹ï¼ˆæ»¡è¶³æ¡ä»¶çš„è®°å½•ä»¥åŠæ‰«æè¿‡ç¨‹ä¸­é‡åˆ°çš„ç”¨äºç•Œå®šèŒƒå›´çš„è®°å½•ï¼‰å°è¯•æ·»åŠ  next-key é”ã€‚ç„¶åï¼Œæ ¹æ®å…·ä½“æƒ…å†µï¼Œè¿™äº› next-key é”å¯èƒ½ä¼šé€€åŒ–æˆè®°å½•é”æˆ–é—´éš™é”</strong>ï¼š</p>
<ul>
<li>æƒ…å†µä¸€ï¼šå¯¹äº <strong>ã€Œå¤§äºç­‰äº (&gt;=)ã€</strong> çš„èŒƒå›´æŸ¥è¯¢ï¼Œç”±äºå…¶ä¸­åŒ…å«äº†ç­‰å€¼æŸ¥è¯¢çš„æ¡ä»¶ï¼Œå¦‚æœç­‰å€¼éƒ¨åˆ†ï¼ˆä¾‹å¦‚ <code>id = X</code> in <code>id &gt;= X</code>ï¼‰çš„è®°å½•<strong>å­˜åœ¨</strong>äºè¡¨ä¸­ï¼Œé‚£ä¹ˆæ–½åŠ åœ¨è¯¥è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆè®°å½•é”</strong>ã€‚å¯¹äºèŒƒå›´è¦†ç›–çš„å…¶ä»–è®°å½•ï¼Œåˆ™ä»å¯èƒ½æ˜¯ next-key é”ã€‚</li>
<li>æƒ…å†µäºŒï¼šå¯¹äº <strong>ã€Œå°äº (&lt;) æˆ–å°äºç­‰äº (&lt;=)ã€</strong> çš„èŒƒå›´æŸ¥è¯¢ï¼Œå¤„ç†æ–¹å¼å–å†³äºæ¡ä»¶å€¼çš„è®°å½•æ˜¯å¦å­˜åœ¨äºè¡¨ä¸­ï¼š
<ul>
<li>å½“æ¡ä»¶å€¼çš„è®°å½•<strong>ä¸å­˜åœ¨</strong>äºè¡¨ä¸­æ—¶ï¼ˆä¾‹å¦‚ <code>id &lt; 6</code> æˆ– <code>id &lt;= 6</code>ï¼Œè€Œè¡¨ä¸­æ²¡æœ‰ <code>id = 6</code> çš„è®°å½•ï¼‰ï¼Œæ— è®ºæ˜¯ã€Œå°äºã€è¿˜æ˜¯ã€Œå°äºç­‰äºã€çš„æŸ¥è¯¢ï¼Œå½“æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³èŒƒå›´æ¡ä»¶ï¼ˆå³å¤§äºæˆ–ç­‰äºæ¡ä»¶å€¼ï¼‰çš„è®°å½•æ—¶ï¼ˆä½œä¸ºèŒƒå›´çš„ç»ˆæ­¢ç‚¹ï¼‰ï¼Œæ–½åŠ åœ¨è¯¥ç»ˆæ­¢è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ã€‚å…¶ä»–è¢«æ‰«æåˆ°çš„æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå…¶ç´¢å¼•é¡¹ä¸Šé€šå¸¸åŠ çš„æ˜¯ next-key é”ã€‚</li>
<li>å½“æ¡ä»¶å€¼çš„è®°å½•<strong>å­˜åœ¨</strong>äºè¡¨ä¸­æ—¶ï¼ˆä¾‹å¦‚ <code>id &lt; 5</code> æˆ– <code>id &lt;= 5</code>ï¼Œä¸”è¡¨ä¸­æœ‰ <code>id = 5</code> çš„è®°å½•ï¼‰ï¼š
<ul>
<li>å¦‚æœæ˜¯ã€Œå°äº (&lt;)ã€æ¡ä»¶çš„èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ <code>id &lt; 5</code>ï¼‰ï¼Œå½“æ‰«æåˆ°æ¡ä»¶å€¼çš„è®°å½•ï¼ˆå³ <code>id = 5</code>ï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ <code>id &lt; 5</code> çš„è®°å½•ï¼‰æ—¶ï¼Œæ–½åŠ åœ¨è¯¥è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ã€‚å…¶ä»–è¢«æ‰«æåˆ°çš„æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå…¶ç´¢å¼•é¡¹ä¸Šé€šå¸¸åŠ çš„æ˜¯ next-key é”ã€‚</li>
<li>å¦‚æœæ˜¯ã€Œå°äºç­‰äº (&lt;=)ã€æ¡ä»¶çš„èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ <code>id &lt;= 5</code>ï¼‰ï¼Œå½“æ‰«æåˆ°æ¡ä»¶å€¼çš„è®°å½•ï¼ˆå³ <code>id = 5</code>ï¼Œå®ƒæ˜¯æ»¡è¶³æ¡ä»¶çš„æœ€åä¸€æ¡è®°å½•ï¼‰æ—¶ï¼Œæ–½åŠ åœ¨è¯¥è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key é”é€šå¸¸<strong>ä¸ä¼šé€€åŒ–</strong>ã€‚å…¶ä»–è¢«æ‰«æåˆ°çš„æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå…¶ç´¢å¼•é¡¹ä¸Šé€šå¸¸åŠ çš„ä¹Ÿæ˜¯ next-key é”ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡å‡ ä¸ªå®éªŒæ¥éªŒè¯ä¸Šè¿°ç»“è®ºã€‚</p>
<h4 id="1ã€é’ˆå¯¹ã€Œå¤§äºæˆ–è€…å¤§äºç­‰äºã€çš„èŒƒå›´æŸ¥è¯¢">1ã€é’ˆå¯¹ã€Œå¤§äºæˆ–è€…å¤§äºç­‰äºã€çš„èŒƒå›´æŸ¥è¯¢</h4>
<blockquote>
<p>å®éªŒä¸€ï¼šé’ˆå¯¹ã€Œå¤§äº (&gt;)ã€çš„èŒƒå›´æŸ¥è¯¢ã€‚</p>
</blockquote>
<p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹èŒƒå›´æŸ¥è¯¢è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">15</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> é¦™å…‹æ–¯    <span class="operator">|</span>  <span class="number">39</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ A çš„åŠ é”è¿‡ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰«æåˆ°çš„ç¬¬ä¸€æ¡æ»¡è¶³ <code>id &gt; 15</code> çš„è®°å½•æ˜¯ <code>id = 20</code>ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªä¸¥æ ¼å¤§äºçš„æŸ¥è¯¢ï¼Œä¸æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œå› æ­¤åœ¨ <code>id = 20</code> è¿™æ¡è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ çš„æ˜¯ä¸€ä¸ª next-key é”ï¼Œå…¶è¦†ç›–èŒƒå›´æ˜¯ <code>(15, 20]</code>ï¼ˆå·¦è¾¹ç•Œæ˜¯è¡¨ä¸­ <code>id=20</code> ä¹‹å‰çš„è®°å½• <code>id=15</code>ï¼‰ã€‚</li>
<li>ç”±äºæ˜¯èŒƒå›´æŸ¥è¯¢ï¼ŒMySQL ä¼šç»§ç»­å‘åæ‰«æï¼Œä»¥ç¡®å®šèŒƒå›´çš„ä¸Šé™ã€‚å³ä½¿ <code>id = 20</code> æ˜¯è¡¨ä¸­çš„æœ€åä¸€æ¡ç”¨æˆ·è®°å½•ï¼ŒInnoDB å†…éƒ¨è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„&quot;supremum pseudo-record&quot;æ¥æ ‡è¯†ç´¢å¼•çš„æœ«å°¾ã€‚å½“æ‰«æåˆ°è¿™ä¸ª supremum è®°å½•æ—¶ï¼Œä¼šä¸ºå®ƒæ·»åŠ ä¸€ä¸ª next-key é”ï¼Œè¦†ç›–èŒƒå›´æ˜¯ <code>(20, +âˆ]</code>ã€‚</li>
<li>æ‰«æç»“æŸã€‚</li>
</ol>
<p>å› æ­¤ï¼Œäº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ä¸Šæ·»åŠ äº†ä¸¤ä¸ª X å‹çš„ next-key é”ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970353980.png" alt="1746970353980"></p>
<ul>
<li>åœ¨ <code>id = 20</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(15, 20]</code> çš„ next-key é”ã€‚è¿™æ„å‘³ç€å…¶ä»–äº‹åŠ¡æ—¢æ— æ³•æ›´æ–°æˆ–åˆ é™¤ <code>id = 20</code> çš„è®°å½•ï¼Œä¹Ÿæ— æ³•æ’å…¥ <code>id</code> å€¼ä¸º 16ã€17ã€18ã€19 çš„æ–°è®°å½•ã€‚</li>
<li>åœ¨ supremum pseudo-record çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(20, +âˆ]</code> çš„ next-key é”ã€‚è¿™æ„å‘³ç€å…¶ä»–äº‹åŠ¡æ— æ³•æ’å…¥ <code>id</code> å€¼å¤§äº 20 çš„æ–°è®°å½•ã€‚</li>
</ul>
<p>é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> ç¡®è®¤åŠ é”æƒ…å†µï¼ˆä»…æˆªå–è¡Œçº§é”éƒ¨åˆ†ï¼‰ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970365637.png" alt="1746970365637"></p>
<p>ä»ä¸Šå›¾åˆ†æï¼Œ<code>LOCK_MODE</code> å‡ä¸º <code>X</code>ï¼Œè¡¨ç¤º next-key é”ã€‚</p>
<ul>
<li><code>LOCK_DATA: 20</code> å¯¹åº” <code>(15, 20]</code> çš„ next-key é”ã€‚</li>
<li><code>LOCK_DATA: supremum pseudo-record</code> å¯¹åº” <code>(20, +âˆ]</code> çš„ next-key é”ã€‚<br>
è¿™ä¸æˆ‘ä»¬çš„åˆ†æä¸€è‡´ã€‚</li>
</ul>
<blockquote>
<p>å®éªŒäºŒï¼šé’ˆå¯¹ã€Œå¤§äºç­‰äº (&gt;=)ã€çš„èŒƒå›´æŸ¥è¯¢ã€‚</p>
</blockquote>
<p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹èŒƒå›´æŸ¥è¯¢è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">&gt;=</span> <span class="number">15</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span> ä¹Œç´¢æ™®    <span class="operator">|</span>  <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> é¦™å…‹æ–¯    <span class="operator">|</span>  <span class="number">39</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ A çš„åŠ é”è¿‡ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li>é¦–å…ˆå¤„ç† <code>id = 15</code> çš„éƒ¨åˆ†ï¼ˆç­‰å€¼æ¡ä»¶ï¼‰ã€‚ç”±äºè®°å½• <code>id = 15</code> å­˜åœ¨ï¼Œæ–½åŠ åœ¨è¯¥è®°å½•ä¸»é”®ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–ä¸ºè®°å½•é”</strong>ï¼Œä»…é”å®š <code>id = 15</code> è¿™ä¸€è¡Œã€‚</li>
<li>ç»§ç»­èŒƒå›´æŸ¥æ‰¾ï¼Œæ‰«æåˆ°ä¸‹ä¸€æ¡è®°å½• <code>id = 20</code>ã€‚åœ¨ <code>id = 20</code> çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ  next-key é”ï¼ŒèŒƒå›´æ˜¯ <code>(15, 20]</code>ã€‚</li>
<li>ç»§ç»­å‘åæ‰«æåˆ° supremum pseudo-recordï¼Œä¸ºå…¶æ·»åŠ  next-key é”ï¼ŒèŒƒå›´æ˜¯ <code>(20, +âˆ]</code>ã€‚</li>
<li>æ‰«æç»“æŸã€‚</li>
</ol>
<p>äº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ä¸Šæ·»åŠ äº†ä¸‰ä¸ª X å‹çš„é”ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970396194.png" alt="1746970396194"></p>
<ul>
<li>åœ¨ <code>id = 15</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†è®°å½•é”ï¼Œé”å®š <code>id = 15</code>ã€‚</li>
<li>åœ¨ <code>id = 20</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(15, 20]</code> çš„ next-key é”ã€‚</li>
<li>åœ¨ supremum pseudo-record çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(20, +âˆ]</code> çš„ next-key é”ã€‚</li>
</ul>
<p>é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> ç¡®è®¤åŠ é”æƒ…å†µï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970403063.png" alt="1746970403063"></p>
<p>åˆ†æä¸Šå›¾ï¼š</p>
<ul>
<li><code>LOCK_DATA: 15</code>, <code>LOCK_MODE: X, REC_NOT_GAP</code> è¡¨ç¤ºå¯¹ <code>id = 15</code> åŠ äº†è®°å½•é”ã€‚</li>
<li><code>LOCK_DATA: 20</code>, <code>LOCK_MODE: X</code> è¡¨ç¤ºå¯¹ <code>id = 20</code> åŠ äº† <code>(15, 20]</code> çš„ next-key é”ã€‚</li>
<li><code>LOCK_DATA: supremum pseudo-record</code>, <code>LOCK_MODE: X</code> è¡¨ç¤ºåŠ äº† <code>(20, +âˆ]</code> çš„ next-key é”ã€‚<br>
è¿™ä¸æˆ‘ä»¬çš„åˆ†æä¸€è‡´ï¼Œå¹¶éªŒè¯äº†ï¼šåœ¨ã€Œå¤§äºç­‰äºã€æ¡ä»¶çš„å”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢ä¸­ï¼Œè‹¥æ¡ä»¶å€¼çš„è®°å½•å­˜åœ¨ï¼Œå…¶ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼šé€€åŒ–ä¸ºè®°å½•é”ã€‚</li>
</ul>
<h4 id="2ã€é’ˆå¯¹ã€Œå°äºæˆ–è€…å°äºç­‰äºã€çš„èŒƒå›´æŸ¥è¯¢">2ã€é’ˆå¯¹ã€Œå°äºæˆ–è€…å°äºç­‰äºã€çš„èŒƒå›´æŸ¥è¯¢</h4>
<blockquote>
<p>å®éªŒä¸€ï¼šé’ˆå¯¹ã€Œå°äº (&lt;)ã€çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸”æŸ¥è¯¢æ¡ä»¶å€¼çš„è®°å½•ã€Œä¸å­˜åœ¨ã€äºè¡¨ä¸­ã€‚</p>
</blockquote>
<p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹èŒƒå›´æŸ¥è¯¢è¯­å¥ï¼Œæ³¨æ„æ¡ä»¶å€¼ <code>id = 6</code> çš„è®°å½•å¹¶<strong>ä¸å­˜åœ¨</strong>äºè¡¨ä¸­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">&lt;</span> <span class="number">6</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> è·¯é£   <span class="operator">|</span>  <span class="number">19</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> ç´¢éš†   <span class="operator">|</span>  <span class="number">21</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)  <span class="comment">-- è¿”å›çš„è®°å½•æ˜¯ id=1 å’Œ id=5</span></span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ A çš„åŠ é”è¿‡ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰«æåˆ°çš„ç¬¬ä¸€æ¡æ»¡è¶³ <code>id &lt; 6</code> çš„è®°å½•æ˜¯ <code>id = 1</code>ã€‚åœ¨å…¶ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ  next-key é”ï¼ŒèŒƒå›´æ˜¯ <code>(-âˆ, 1]</code> (è¿™é‡Œçš„ <code>-âˆ</code> è¡¨ç¤ºç´¢å¼•çš„èµ·å§‹)ã€‚</li>
<li>ç»§ç»­èŒƒå›´æŸ¥æ‰¾ï¼Œæ‰«æåˆ°ä¸‹ä¸€æ¡æ»¡è¶³ <code>id &lt; 6</code> çš„è®°å½•æ˜¯ <code>id = 5</code>ã€‚åœ¨å…¶ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ  next-key é”ï¼ŒèŒƒå›´æ˜¯ <code>(1, 5]</code>ã€‚</li>
<li>ç»§ç»­æ‰«æï¼Œä¸‹ä¸€æ¡è®°å½•æ˜¯ <code>id = 10</code>ã€‚è¿™æ¡è®°å½•ä¸æ»¡è¶³ <code>id &lt; 6</code> çš„æ¡ä»¶ï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå› æ­¤ä½œä¸ºæ‰«æçš„ç»ˆæ­¢ç‚¹ã€‚æ–½åŠ åœ¨ <code>id = 10</code> è¿™æ¡è®°å½•ä¸»é”®ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ï¼Œè¦†ç›–çš„èŒƒå›´æ˜¯ <code>(5, 10)</code>ã€‚</li>
<li>ç”±äºæ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œæ‰«æåœæ­¢ã€‚</li>
</ol>
<p>äº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ä¸Šæ·»åŠ äº†ä¸‰ä¸ª X å‹çš„é”ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970412678.png" alt="1746970412678"></p>
<ul>
<li>åœ¨ <code>id = 1</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(-âˆ, 1]</code> çš„ next-key é”ã€‚</li>
<li>åœ¨ <code>id = 5</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(1, 5]</code> çš„ next-key é”ã€‚</li>
<li>åœ¨ <code>id = 10</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(5, 10)</code> çš„é—´éš™é”ã€‚è¿™ä¸ªé—´éš™é”ä¼šé˜»æ­¢æ’å…¥ <code>id</code> å€¼ä¸º 6, 7, 8, 9 çš„æ–°è®°å½•ã€‚</li>
</ul>
<p>é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> ç¡®è®¤åŠ é”æƒ…å†µï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970432932.png" alt="1746970432932"></p>
<p>åˆ†æä¸Šå›¾ï¼š</p>
<ul>
<li><code>LOCK_DATA: 1</code>, <code>LOCK_MODE: X</code> å¯¹åº” <code>(-âˆ, 1]</code> çš„ next-key é”ã€‚</li>
<li><code>LOCK_DATA: 5</code>, <code>LOCK_MODE: X</code> å¯¹åº” <code>(1, 5]</code> çš„ next-key é”ã€‚</li>
<li><code>LOCK_DATA: 10</code>, <code>LOCK_MODE: X, GAP</code> å¯¹åº” <code>(5, 10)</code> çš„é—´éš™é”ã€‚<br>
è¿™ä¸æˆ‘ä»¬çš„åˆ†æä¸€è‡´ã€‚</li>
</ul>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ­¤å®éªŒä¸­çš„æŸ¥è¯¢æ¡ä»¶æ”¹ä¸º <code>id &lt;= 6</code>ï¼ˆè€Œ <code>id=6</code> ä»ç„¶ä¸å­˜åœ¨ï¼‰ï¼Œå…¶åŠ é”è¡Œä¸ºä¸ <code>id &lt; 6</code> çš„æƒ…å†µæ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºæ‰«æçš„ç»ˆæ­¢ç‚¹ä¾ç„¶æ˜¯ <code>id=10</code>ï¼Œå¹¶ä¸”åœ¨å…¶ä¸ŠåŠ é—´éš™é” <code>(5,10)</code>ã€‚</p>
<p>å› æ­¤ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼š<strong>é’ˆå¯¹ã€Œå°äºæˆ–å°äºç­‰äºã€çš„å”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢ï¼Œè‹¥æ¡ä»¶å€¼çš„è®°å½•ä¸å­˜åœ¨äºè¡¨ä¸­ï¼Œå½“æ‰«æåˆ°ç»ˆæ­¢èŒƒå›´æŸ¥è¯¢çš„è®°å½•ï¼ˆå³ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼‰æ—¶ï¼Œæ–½åŠ åœ¨è¯¥è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼šé€€åŒ–æˆé—´éš™é”ã€‚å…¶ä»–è¢«æ‰«æåˆ°çš„æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå…¶ç´¢å¼•é¡¹ä¸ŠåŠ çš„æ˜¯ next-key é”ã€‚</strong></p>
<blockquote>
<p>å®éªŒäºŒï¼šé’ˆå¯¹ã€Œå°äºç­‰äº (&lt;=)ã€çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸”æŸ¥è¯¢æ¡ä»¶å€¼çš„è®°å½•ã€Œå­˜åœ¨ã€äºè¡¨ä¸­ã€‚</p>
</blockquote>
<p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹èŒƒå›´æŸ¥è¯¢è¯­å¥ï¼Œæ³¨æ„æ¡ä»¶å€¼ <code>id = 5</code> çš„è®°å½•<strong>å­˜åœ¨</strong>äºè¡¨ä¸­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> è·¯é£   <span class="operator">|</span>  <span class="number">19</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> ç´¢éš†   <span class="operator">|</span>  <span class="number">21</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ A çš„åŠ é”è¿‡ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰«æåˆ°çš„ç¬¬ä¸€æ¡è®°å½•æ˜¯ <code>id = 1</code>ã€‚åœ¨å…¶ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ  next-key é”ï¼ŒèŒƒå›´ä¸º <code>(-âˆ, 1]</code>ã€‚</li>
<li>ç»§ç»­èŒƒå›´æŸ¥æ‰¾ï¼Œæ‰«æåˆ°ä¸‹ä¸€æ¡è®°å½•æ˜¯ <code>id = 5</code>ã€‚è¿™æ¡è®°å½•æ»¡è¶³ <code>id &lt;= 5</code>ï¼Œå¹¶ä¸”æ˜¯æ¡ä»¶å€¼çš„è®°å½•ã€‚åœ¨å…¶ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ  next-key é”ï¼ŒèŒƒå›´ä¸º <code>(1, 5]</code>ã€‚ç”±äºè¿™æ˜¯æ»¡è¶³æ¡ä»¶çš„æœ€åä¸€æ¡è®°å½•ï¼ˆæ ¹æ®ä¸»é”®å”¯ä¸€æ€§ï¼‰ï¼Œæ‰«æåœ¨æ­¤åŸºæœ¬ç»“æŸã€‚</li>
<li>æ‰«æåœæ­¢ã€‚</li>
</ol>
<p>äº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ä¸Šæ·»åŠ äº†ä¸¤ä¸ª X å‹çš„ next-key é”ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970447328.png" alt="1746970447328"></p>
<ul>
<li>åœ¨ <code>id = 1</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(-âˆ, 1]</code> çš„ next-key é”ã€‚</li>
<li>åœ¨ <code>id = 5</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(1, 5]</code> çš„ next-key é”ã€‚</li>
</ul>
<p>é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> ç¡®è®¤åŠ é”æƒ…å†µï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970454035.png" alt="1746970454035"></p>
<p>åˆ†æä¸Šå›¾ï¼Œä¸¤ä¸ªé”çš„ <code>LOCK_MODE</code> å‡ä¸º <code>X</code>ï¼Œä¸æˆ‘ä»¬çš„åˆ†æä¸€è‡´ã€‚è¿™é‡Œ <code>id = 5</code> ä¸Šçš„ next-key é”æ²¡æœ‰é€€åŒ–ã€‚</p>
<blockquote>
<p>å®éªŒä¸‰ï¼šé’ˆå¯¹ã€Œå°äº (&lt;)ã€çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸”æŸ¥è¯¢æ¡ä»¶å€¼çš„è®°å½•ã€Œå­˜åœ¨ã€äºè¡¨ä¸­ã€‚</p>
</blockquote>
<p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼Œæ¡ä»¶å€¼ <code>id = 5</code> çš„è®°å½•<strong>å­˜åœ¨</strong>äºè¡¨ä¸­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">&lt;</span> <span class="number">5</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> è·¯é£   <span class="operator">|</span>  <span class="number">19</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ A çš„åŠ é”è¿‡ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰«æåˆ°çš„ç¬¬ä¸€æ¡æ»¡è¶³ <code>id &lt; 5</code> çš„è®°å½•æ˜¯ <code>id = 1</code>ã€‚åœ¨å…¶ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ  next-key é”ï¼ŒèŒƒå›´ä¸º <code>(-âˆ, 1]</code>ã€‚</li>
<li>ç»§ç»­èŒƒå›´æŸ¥æ‰¾ï¼Œæ‰«æåˆ°ä¸‹ä¸€æ¡è®°å½•æ˜¯ <code>id = 5</code>ã€‚è¿™æ¡è®°å½•æ˜¯ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ <code>id &lt; 5</code> æ¡ä»¶çš„è®°å½•ï¼ˆå³å®ƒç­‰äºæ¡ä»¶å€¼ï¼‰ã€‚æ–½åŠ åœ¨è¯¥è®°å½•ä¸»é”®ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–ä¸ºé—´éš™é”</strong>ï¼Œé”èŒƒå›´æ˜¯ <code>(1, 5)</code>ã€‚</li>
<li>ç”±äºæ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œæ‰«æåœæ­¢ã€‚</li>
</ol>
<p>äº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ä¸Šæ·»åŠ äº†ä¸¤ç§ X å‹é”ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970462543.png" alt="1746970462543"></p>
<ul>
<li>åœ¨ <code>id = 1</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(-âˆ, 1]</code> çš„ next-key é”ã€‚</li>
<li>åœ¨ <code>id = 5</code> è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº†èŒƒå›´ä¸º <code>(1, 5)</code> çš„é—´éš™é”ã€‚è¿™ä¸ªé—´éš™é”ä¼šé˜»æ­¢æ’å…¥ <code>id</code> å€¼ä¸º 2, 3, 4 çš„æ–°è®°å½•ã€‚</li>
</ul>
<p>é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> ç¡®è®¤åŠ é”æƒ…å†µï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970468825.png" alt="1746970468825"></p>
<p>åˆ†æä¸Šå›¾ï¼š</p>
<ul>
<li><code>LOCK_DATA: 1</code>, <code>LOCK_MODE: X</code> å¯¹åº” <code>(-âˆ, 1]</code> çš„ next-key é”ã€‚</li>
<li><code>LOCK_DATA: 5</code>, <code>LOCK_MODE: X, GAP</code> å¯¹åº” <code>(1, 5)</code> çš„é—´éš™é”ã€‚<br>
è¿™ä¸æˆ‘ä»¬çš„åˆ†æä¸€è‡´ã€‚</li>
</ul>
<p>ç»¼åˆè¿™ä¸‰ä¸ªå®éªŒï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºã€Œå°äºæˆ–å°äºç­‰äºã€çš„å”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢çš„é€€åŒ–è§„åˆ™ï¼š</p>
<ul>
<li>å½“æ¡ä»¶å€¼çš„è®°å½•<strong>ä¸å­˜åœ¨</strong>äºè¡¨ä¸­æ—¶ï¼šæ— è®ºæ˜¯ã€Œå°äºã€è¿˜æ˜¯ã€Œå°äºç­‰äºã€æŸ¥è¯¢ï¼Œæ‰«æåˆ°ç»ˆæ­¢èŒƒå›´çš„è®°å½•ï¼ˆç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼‰æ—¶ï¼Œå…¶ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ã€‚</li>
<li>å½“æ¡ä»¶å€¼çš„è®°å½•<strong>å­˜åœ¨</strong>äºè¡¨ä¸­æ—¶ï¼š
<ul>
<li>å¦‚æœæ˜¯ã€Œå°äº (&lt;)ã€æŸ¥è¯¢ï¼Œæ‰«æåˆ°ç»ˆæ­¢èŒƒå›´çš„è®°å½•ï¼ˆå³æ¡ä»¶å€¼æœ¬èº«ï¼‰æ—¶ï¼Œå…¶ç´¢å¼•é¡¹ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ã€‚</li>
<li>å¦‚æœæ˜¯ã€Œå°äºç­‰äº (&lt;=)ã€æŸ¥è¯¢ï¼Œæ‰«æåˆ°ç»ˆæ­¢èŒƒå›´çš„è®°å½•ï¼ˆå³æ¡ä»¶å€¼æœ¬èº«ï¼Œä¹Ÿæ˜¯æ»¡è¶³æ¡ä»¶çš„æœ€åä¸€æ¡è®°å½•ï¼‰æ—¶ï¼Œå…¶ç´¢å¼•é¡¹ä¸Šçš„ next-key é”<strong>é€šå¸¸ä¸ä¼šé€€åŒ–</strong>ã€‚</li>
</ul>
</li>
</ul>
<p>å…¶ä»–è¢«æ‰«æåˆ°çš„ã€æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼Œå…¶ç´¢å¼•é¡¹ä¸Šé€šå¸¸æ–½åŠ çš„æ˜¯ next-key é”ã€‚</p>
<h3 id="éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢">éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</h3>
<p>å½“ä½¿ç”¨éå”¯ä¸€ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œæƒ…å†µæ›´ä¸ºå¤æ‚ï¼Œå› ä¸ºè¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹ä¸¤ä¸ªç´¢å¼•çš„åŠ é”æ“ä½œï¼š<strong>ä¸€ä¸ªæ˜¯äºŒçº§ç´¢å¼•æœ¬èº«ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„äºŒçº§ç´¢å¼•æ¡ç›®å¯¹åº”çš„ä¸»é”®ç´¢å¼•</strong>ã€‚å¯¹ä¸»é”®ç´¢å¼•åŠ é”æ—¶ï¼Œé€šå¸¸åªé’ˆå¯¹é‚£äº›æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•çš„ä¸»é”®ã€‚</p>
<p>é’ˆå¯¹éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢ï¼Œæ ¹æ®æŸ¥è¯¢çš„è®°å½•æ˜¯å¦å­˜åœ¨ï¼ŒåŠ é”è§„åˆ™ä¹Ÿæœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li>å½“æŸ¥è¯¢çš„è®°å½•**ã€Œå­˜åœ¨ã€**æ—¶ï¼šç”±äºæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªç´¢å¼•å€¼ç›¸åŒçš„è®°å½•ã€‚æŸ¥è¯¢è¿‡ç¨‹ä¼šæ‰«æäºŒçº§ç´¢å¼•ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•æ‰åœæ­¢ã€‚
<ul>
<li><strong>åœ¨äºŒçº§ç´¢å¼•ä¸Š</strong>ï¼šå¯¹äºæ‰«æåˆ°çš„ã€æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œä¼šæ·»åŠ  <strong>next-key é”</strong>ã€‚å¯¹äºæ‰«æè¿‡ç¨‹ä¸­é‡åˆ°çš„ç¬¬ä¸€ä¸ªä¸ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œå…¶ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ã€‚</li>
<li><strong>åœ¨ä¸»é”®ç´¢å¼•ä¸Š</strong>ï¼šå¯¹äºé‚£äº›é€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°çš„ã€ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼Œä¼šåœ¨å®ƒä»¬å¯¹åº”çš„ä¸»é”®ç´¢å¼•é¡¹ä¸Šæ·»åŠ <strong>è®°å½•é”</strong>ã€‚</li>
</ul>
</li>
<li>å½“æŸ¥è¯¢çš„è®°å½•**ã€Œä¸å­˜åœ¨ã€**æ—¶ï¼š
<ul>
<li><strong>åœ¨äºŒçº§ç´¢å¼•ä¸Š</strong>ï¼šæ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„ï¼ˆå³å¤§äºæŸ¥è¯¢å€¼çš„ï¼‰äºŒçº§ç´¢å¼•è®°å½•ï¼Œå…¶ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ã€‚</li>
<li><strong>åœ¨ä¸»é”®ç´¢å¼•ä¸Š</strong>ï¼šç”±äºæ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ä¸»é”®ç´¢å¼•åŠ é”ã€‚</li>
</ul>
</li>
</ul>
<p>æ¥ä¸‹æ¥é€šè¿‡ä¸¤ä¸ªå®éªŒè¿›è¡Œè¯´æ˜ã€‚</p>
<h4 id="1ã€è®°å½•ä¸å­˜åœ¨çš„æƒ…å†µ">1ã€è®°å½•ä¸å­˜åœ¨çš„æƒ…å†µ</h4>
<blockquote>
<p>å®éªŒä¸€ï¼šé’ˆå¯¹éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„å€¼ä¸å­˜åœ¨çš„æƒ…å†µã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆåˆ†æéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œè®°å½•ä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¿™ç›¸å¯¹ç®€å•ä¸€äº›ã€‚<br>
å‡è®¾äº‹åŠ¡ A å¯¹éå”¯ä¸€ç´¢å¼• <code>age</code> è¿›è¡Œç­‰å€¼æŸ¥è¯¢ï¼Œä¸”è¡¨ä¸­ä¸å­˜åœ¨ <code>age = 25</code> çš„è®°å½•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">25</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ A çš„åŠ é”è¿‡ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨äºŒçº§ç´¢å¼• <code>index_age</code> ä¸ŠæŸ¥æ‰¾ <code>age = 25</code>ã€‚ç”±äºä¸å­˜åœ¨ï¼Œä¼šå®šä½åˆ°ç¬¬ä¸€ä¸ªå¤§äº 25 çš„ <code>age</code> å€¼ï¼Œå³ <code>age = 39</code>ï¼ˆå¯¹åº”è®°å½• <code>id=20, name='é¦™å…‹æ–¯', age=39</code>ï¼‰ã€‚</li>
<li>æ–½åŠ åœ¨ <code>age = 39</code> è¿™æ¡äºŒçº§ç´¢å¼•è®°å½•ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ã€‚è¿™ä¸ªé—´éš™é”çš„èŒƒå›´æ˜¯ <code>(22, 39)</code>ï¼Œå…¶ä¸­ 22 æ˜¯ <code>age=39</code> ä¹‹å‰çš„ä¸€ä¸ª <code>age</code> å€¼ï¼ˆæ¥è‡ª <code>id=10, name='å±±æ²»', age=22</code>ï¼‰ã€‚</li>
<li>æŸ¥è¯¢ç»“æŸã€‚</li>
</ul>
<p>å› æ­¤ï¼Œäº‹åŠ¡ A åœ¨ <code>age = 39</code> (å…·ä½“æ˜¯ <code>id=20, age=39</code> è¿™æ¡è®°å½•) çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šï¼Œæ·»åŠ äº†ä¸€ä¸ª X å‹çš„é—´éš™é”ï¼ŒèŒƒå›´æ˜¯ <code>(22, 39)</code>ã€‚è¿™ä¸ªé”æ„å‘³ç€å…¶ä»–äº‹åŠ¡æ— æ³•æ’å…¥ <code>age</code> å€¼ä¸º 23ã€24ã€25ã€â€¦ã€38 çš„æ–°è®°å½•ã€‚<br>
ï¼ˆå…³äºæ’å…¥ <code>age = 22</code> æˆ– <code>age = 39</code> çš„æƒ…å†µï¼Œä¼šæ›´å¤æ‚ï¼Œç¨åè®¨è®ºã€‚ï¼‰</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970488972.png" alt="1746970488972"></p>
<p>é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> ç¡®è®¤åŠ é”æƒ…å†µï¼ˆä»…æˆªå–è¡Œçº§é”éƒ¨åˆ†ï¼‰ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970495945.png" alt="1746970495945"></p>
<p>ä»ä¸Šå›¾åˆ†æï¼Œ<code>INDEX_NAME: index_age</code>ï¼Œ<code>LOCK_MODE: X, GAP</code>ï¼Œ<code>LOCK_DATA</code> æ˜¾ç¤º <code>39, 20</code>ã€‚<br>
è¿™è¡¨æ˜åœ¨äºŒçº§ç´¢å¼• <code>index_age</code> ä¸Šï¼Œé’ˆå¯¹ <code>age = 39</code> (å…¶ä¸»é”® <code>id = 20</code>) çš„ç´¢å¼•é¡¹ï¼Œæ–½åŠ äº†ä¸€ä¸ªé—´éš™é”ã€‚å…¶ <code>age</code> å€¼çš„èŒƒå›´æ˜¯ <code>(22, 39)</code>ã€‚</p>
<p>æ­¤æ—¶ï¼Œè‹¥å…¶ä»–äº‹åŠ¡å°è¯•æ’å…¥ <code>age</code> å€¼ä¸º 23 åˆ° 38 ä¹‹é—´çš„æ–°è®°å½•ï¼Œè¿™äº›æ’å…¥æ“ä½œéƒ½ä¼šè¢«é˜»å¡ã€‚<br>
ä½†å¯¹äºæ’å…¥ <code>age = 22</code> æˆ– <code>age = 39</code> çš„è®°å½•ï¼Œæƒ…å†µä¼šæ›´å¤æ‚ï¼Œå–å†³äºæ’å…¥è®°å½•çš„ä¸»é”®å€¼ã€‚</p>
<blockquote>
<p>å½“ä¸€ä¸ªäº‹åŠ¡æŒæœ‰äºŒçº§ç´¢å¼•çš„é—´éš™é” <code>(22, 39)</code> (åŸºäº age å€¼) æ—¶ï¼Œå…¶ä»–äº‹åŠ¡æ’å…¥ <code>age = 22</code> æˆ– <code>age = 39</code> çš„è®°å½•èƒ½å¦æˆåŠŸï¼Ÿ</p>
</blockquote>
<p>è¦ç†è§£è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆè¦çŸ¥é“ï¼š<strong>æ’å…¥æ“ä½œåœ¨å°è¯•æ’å…¥ä¸€æ¡æ–°è®°å½•å‰ï¼Œä¼šå…ˆåœ¨ B+æ ‘ï¼ˆæ­¤å¤„æŒ‡äºŒçº§ç´¢å¼•æ ‘ï¼‰ä¸­å®šä½å…¶æ’å…¥ä½ç½®ã€‚å¦‚æœè¯¥æ’å…¥ä½ç½®çš„&quot;ä¸‹ä¸€æ¡&quot;è®°å½•çš„ç´¢å¼•é¡¹ä¸Šå­˜åœ¨é—´éš™é”ï¼ˆæˆ– next-key é”çš„é—´éš™éƒ¨åˆ†ï¼‰è¦†ç›–äº†è¿™ä¸ªæ’å…¥ç‚¹ï¼Œåˆ™æ’å…¥ä¼šè¢«é˜»å¡ã€‚</strong></p>
<p>äºŒçº§ç´¢å¼•æ ‘çš„è®°å½•æ˜¯å…ˆæŒ‰äºŒçº§ç´¢å¼•å€¼ï¼ˆ<code>age</code>ï¼‰æ’åºï¼Œå¦‚æœäºŒçº§ç´¢å¼•å€¼ç›¸åŒï¼Œåˆ™å†æŒ‰ä¸»é”®å€¼ï¼ˆ<code>id</code>ï¼‰æ’åºã€‚</p>
<p>åŸºäºå‰é¢çš„å®éªŒï¼Œäº‹åŠ¡ A åœ¨ <code>(id=20, age=39)</code> è¿™æ¡è®°å½•çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº† <code>age</code> èŒƒå›´ä¸º <code>(22, 39)</code> çš„é—´éš™é”ã€‚</p>
<ul>
<li>
<p><strong>å°è¯•æ’å…¥ <code>age = 22</code> çš„è®°å½•</strong>ï¼š</p>
<ul>
<li>è‹¥å…¶ä»–äº‹åŠ¡æ’å…¥ <code>(id=3, age=22)</code>ï¼šåœ¨äºŒçº§ç´¢å¼•æ ‘ä¸­ï¼Œè¿™æ¡è®°å½•ä¼šæ’åœ¨ <code>(id=10, age=22)</code> ä¹‹å‰ã€‚å…¶æ’å…¥ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•æ˜¯ <code>(id=10, age=22)</code>ã€‚ç”±äº <code>(id=10, age=22)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šæ²¡æœ‰è¢«äº‹åŠ¡ A çš„é—´éš™é”è¦†ç›–ï¼ˆäº‹åŠ¡ A çš„é—´éš™é”ä¸ <code>age=22</code> çš„è®°å½•ä¸ç›´æ¥ç›¸å…³ï¼‰ï¼Œ<strong>æ­¤æ’å…¥é€šå¸¸å¯ä»¥æˆåŠŸ</strong>ï¼ˆå‡è®¾æ²¡æœ‰å…¶ä»–é”ï¼‰ã€‚</li>
<li>è‹¥å…¶ä»–äº‹åŠ¡æ’å…¥ <code>(id=12, age=22)</code>ï¼šåœ¨äºŒçº§ç´¢å¼•æ ‘ä¸­ï¼Œè¿™æ¡è®°å½•ä¼šæ’åœ¨ <code>(id=10, age=22)</code> ä¹‹åï¼Œä½†åœ¨ <code>(id=20, age=39)</code> ä¹‹å‰ã€‚å…¶æ’å…¥ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•æ˜¯ <code>(id=20, age=39)</code>ã€‚ç”±äº <code>(id=20, age=39)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šæ­£å¥½æœ‰äº‹åŠ¡ A æ–½åŠ çš„é—´éš™é” <code>(22, 39)</code>ï¼Œ<strong>æ­¤æ’å…¥ä¼šè¢«é˜»å¡</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å°è¯•æ’å…¥ <code>age = 39</code> çš„è®°å½•</strong>ï¼š</p>
<ul>
<li>è‹¥å…¶ä»–äº‹åŠ¡æ’å…¥ <code>(id=3, age=39)</code>ï¼šåœ¨äºŒçº§ç´¢å¼•æ ‘ä¸­ï¼Œè¿™æ¡è®°å½•ä¼šæ’åœ¨ <code>(id=20, age=39)</code> ä¹‹å‰ã€‚å…¶æ’å…¥ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•æ˜¯ <code>(id=20, age=39)</code>ã€‚ç”±äº <code>(id=20, age=39)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šæœ‰é—´éš™é”ï¼Œ<strong>æ­¤æ’å…¥ä¼šè¢«é˜»å¡</strong>ã€‚</li>
<li>è‹¥å…¶ä»–äº‹åŠ¡æ’å…¥ <code>(id=21, age=39)</code>ï¼šåœ¨äºŒçº§ç´¢å¼•æ ‘ä¸­ï¼Œè¿™æ¡è®°å½•ä¼šæ’åœ¨ <code>(id=20, age=39)</code> ä¹‹åã€‚å…¶æ’å…¥ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•å¯èƒ½æ˜¯ supremum pseudo-recordï¼ˆå¦‚æœ <code>id=21, age=39</code> æ˜¯æœ€å¤§çš„ï¼‰ã€‚å¦‚æœä¸‹ä¸€æ¡è®°å½•æ²¡æœ‰è¢«é—´éš™é”è¦†ç›–ï¼Œ<strong>æ­¤æ’å…¥å¯ä»¥æˆåŠŸ</strong>ã€‚</li>
</ul>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<strong>å½“ä¸€ä¸ªäº‹åŠ¡æŒæœ‰äºŒçº§ç´¢å¼•çš„é—´éš™é” (å¦‚ <code>age</code> èŒƒå›´ <code>(22, 39)</code>) æ—¶ï¼Œèƒ½å¦æˆåŠŸæ’å…¥è¾¹ç•Œå€¼ (<code>age=22</code> æˆ– <code>age=39</code>) çš„æ–°è®°å½•ï¼Œå…³é”®åœ¨äºæ–°è®°å½•çš„ä¸»é”®å€¼å¦‚ä½•å†³å®šå…¶åœ¨äºŒçº§ç´¢å¼•ä¸­çš„ç²¾ç¡®ä½ç½®ï¼Œä»¥åŠè¯¥ç²¾ç¡®ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•æ˜¯å¦è¢«é—´éš™é”è¦†ç›–ã€‚</strong></p>
<p>ç°åœ¨å›å¤´çœ‹ <code>performance_schema.data_locks</code> çš„è¾“å‡ºï¼š<code>LOCK_DATA: 39, 20</code><br>
<img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970514906.png" alt="1746970514906"></p>
<ul>
<li><code>LOCK_DATA</code> çš„ç¬¬ä¸€ä¸ªå€¼ <code>39</code> ä»£è¡¨ <code>age</code> å€¼ï¼Œå®ƒæ˜¯é—´éš™é”æˆ– next-key é”èŒƒå›´çš„å³è¾¹ç•Œï¼ˆå¯¹äºäºŒçº§ç´¢å¼•ï¼‰ã€‚</li>
<li><code>LOCK_DATA</code> çš„ç¬¬äºŒä¸ªå€¼ <code>20</code> ä»£è¡¨ä¸ <code>age=39</code> å…³è”çš„è®°å½•çš„ <code>id</code> å€¼ã€‚</li>
</ul>
<p>è¿™ä¸ª <code>LOCK_DATA: 39, 20</code> ç»“åˆ <code>LOCK_MODE: X, GAP</code> æ›´å‡†ç¡®åœ°è§£é‡Šäº†ï¼šäº‹åŠ¡ A åœ¨ <code>(id=20, age=39)</code> è¿™æ¡è®°å½•çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šï¼Œæ–½åŠ äº† <code>age</code> å€¼èŒƒå›´ä¸º <code>(22, 39)</code> çš„ X å‹é—´éš™é”ã€‚å¹¶ä¸”ï¼Œ<strong>è¿™ä¸ª <code>id=20</code> æš—ç¤ºäº†ï¼šå¦‚æœå…¶ä»–äº‹åŠ¡å°è¯•æ’å…¥ <code>age = 39</code> çš„æ–°è®°å½•ï¼Œé‚£ä¹ˆå½“æ–°è®°å½•çš„ <code>id</code> å€¼å°äº <code>20</code> æ—¶ï¼Œæ’å…¥ä¼šè¢«é˜»å¡ï¼›å¦‚æœæ–°è®°å½•çš„ <code>id</code> å€¼å¤§äºæˆ–ç­‰äº <code>20</code>ï¼Œåˆ™å¯èƒ½æˆåŠŸï¼ˆå–å†³äºå…¶ç²¾ç¡®çš„ä¸‹ä¸€æ¡è®°å½•æ˜¯å¦æœ‰é”ï¼‰ã€‚</strong></p>
<p>å¯¹äºæ’å…¥ <code>age = 22</code> çš„æƒ…å†µï¼Œ<code>performance_schema.data_locks</code> çš„è¾“å‡ºæœ¬èº«ä¸èƒ½ç›´æ¥åˆ†æå‡ºå“ªäº› <code>id</code> å€¼å¯ä»¥æ’å…¥ã€‚è¿™éœ€è¦æˆ‘ä»¬è‡ªå·±æ ¹æ®äºŒçº§ç´¢å¼•çš„ B+æ ‘ç»“æ„ï¼Œç¡®å®šæ’å…¥ä½ç½®ï¼Œç„¶ååˆ¤æ–­å…¶ä¸‹ä¸€æ¡è®°å½•æ˜¯å¦æœ‰é—´éš™é”ã€‚</p>
<h4 id="2ã€è®°å½•å­˜åœ¨çš„æƒ…å†µ">2ã€è®°å½•å­˜åœ¨çš„æƒ…å†µ</h4>
<blockquote>
<p>å®éªŒäºŒï¼šé’ˆå¯¹éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„å€¼å­˜åœ¨çš„æƒ…å†µã€‚</p>
</blockquote>
<p>å‡è®¾äº‹åŠ¡ A å¯¹éå”¯ä¸€ç´¢å¼• <code>age</code> è¿›è¡Œç­‰å€¼æŸ¥è¯¢ï¼Œä¸”è¡¨ä¸­å­˜åœ¨ <code>age = 22</code> çš„è®°å½•ï¼ˆå³ <code>id=10, name='å±±æ²»', age=22</code>ï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">22</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name   <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> å±±æ²»   <span class="operator">|</span>  <span class="number">22</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+-----+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ A çš„åŠ é”è¿‡ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>äºŒçº§ç´¢å¼• <code>index_age</code> ä¸Šçš„æ“ä½œ</strong>ï¼š
<ul>
<li>ç”±äºæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œå³ä½¿æ‰¾åˆ° <code>age = 22</code> çš„è®°å½•ï¼Œä»éœ€ç»§ç»­æ‰«æä»¥æŸ¥æ‰¾å…¶ä»–å¯èƒ½çš„ <code>age = 22</code> çš„è®°å½•ï¼ˆæŒ‰ä¸»é”® <code>id</code> æ’åºï¼‰ã€‚</li>
<li>æ‰«æåˆ° <code>(id=10, age=22)</code>ã€‚è¿™æ˜¯æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚åœ¨å…¶äºŒçº§ç´¢å¼•é¡¹ä¸Šæ·»åŠ  <strong>next-key é”</strong>ã€‚è¯¥é”çš„èŒƒå›´ï¼Œæ ¹æ®å‰ä¸€ä¸ª <code>age</code> å€¼ 21 (æ¥è‡ª <code>id=5, age=21</code>)ï¼Œåº”è¯¥æ˜¯ <code>(21, 22]</code> (åŸºäº age å€¼ï¼Œå¹¶åŒ…å« <code>id=10</code>)ã€‚</li>
<li>ç»§ç»­æ‰«æï¼Œä¸‹ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•æ˜¯ <code>(id=20, age=39)</code>ã€‚è¿™æ¡è®°å½•ä¸ç¬¦åˆ <code>age = 22</code> çš„æ¡ä»¶ï¼Œæ˜¯ç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚å› æ­¤ï¼Œæ–½åŠ åœ¨ <code>(id=20, age=39)</code> è¿™æ¡äºŒçº§ç´¢å¼•è®°å½•ä¸Šçš„ next-key é”ä¼š<strong>é€€åŒ–æˆé—´éš™é”</strong>ï¼Œ<code>age</code> èŒƒå›´æ˜¯ <code>(22, 39)</code>ã€‚</li>
</ul>
</li>
<li><strong>ä¸»é”®ç´¢å¼•ä¸Šçš„æ“ä½œ</strong>ï¼š
<ul>
<li>å¯¹äºé€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°çš„ã€ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½• <code>(id=10, age=22)</code>ï¼Œä¼šåœ¨å…¶å¯¹åº”çš„ä¸»é”®ç´¢å¼•é¡¹ï¼ˆå³ <code>id = 10</code>ï¼‰ä¸Šæ·»åŠ  <strong>X å‹è®°å½•é”</strong>ã€‚</li>
</ul>
</li>
<li>æ‰«æç»“æŸã€‚</li>
</ol>
<p>æ€»ç»“äº‹åŠ¡ A æ·»åŠ çš„ X å‹é”ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970528363.png" alt="1746970528363"></p>
<ul>
<li><strong>ä¸»é”®ç´¢å¼• (<code>PRIMARY</code>)</strong>ï¼š
<ul>
<li>åœ¨ <code>id = 10</code> çš„è®°å½•ä¸Šï¼Œæ·»åŠ äº†è®°å½•é”ã€‚</li>
</ul>
</li>
<li><strong>äºŒçº§ç´¢å¼• (<code>index_age</code>)</strong>ï¼š
<ul>
<li>åœ¨ <code>(id=10, age=22)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šï¼Œæ·»åŠ äº† <code>age</code> èŒƒå›´ä¸º <code>(21, 22]</code> çš„ next-key é”ã€‚</li>
<li>åœ¨ <code>(id=20, age=39)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šï¼Œæ·»åŠ äº† <code>age</code> èŒƒå›´ä¸º <code>(22, 39)</code> çš„é—´éš™é”ã€‚</li>
</ul>
</li>
</ul>
<p>é€šè¿‡ <code>select * from performance_schema.data_locks\G;</code> ç¡®è®¤åŠ é”æƒ…å†µï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970534738.png" alt="1746970534738"></p>
<p>åˆ†æä¸Šå›¾ï¼š</p>
<ul>
<li>
<p><strong>äºŒçº§ç´¢å¼• (<code>INDEX_NAME: index_age</code>)</strong>ï¼š</p>
<ul>
<li><code>LOCK_DATA: 22, 10</code>, <code>LOCK_MODE: X</code>ï¼šå¯¹åº” <code>(id=10, age=22)</code> ä¸Šçš„ next-key é”ï¼Œ<code>age</code> èŒƒå›´ <code>(21, 22]</code>ã€‚
<ul>
<li>è¿™æ„å‘³ç€å…¶ä»–äº‹åŠ¡ä¸èƒ½è½»æ˜“æ›´æ–°æˆ–åˆ é™¤ <code>age=22</code> ä¸” <code>id=10</code> çš„è®°å½•ã€‚</li>
<li>å¯¹äºæ’å…¥æ–°çš„ <code>age=21</code> æˆ– <code>age=22</code> çš„è®°å½•ï¼š
<ul>
<li>æ’å…¥ <code>age=21</code>ï¼šè‹¥æ–°è®°å½• <code>id &lt; 5</code> (<code>(id=5,age=21)</code>æ˜¯è¡¨ä¸­å·²å­˜åœ¨çš„ age=21 çš„è®°å½•)ï¼Œå¯èƒ½æˆåŠŸã€‚è‹¥æ–°è®°å½• <code>id &gt; 5</code>ï¼Œå…¶ä¸‹ä¸€æ¡å¯èƒ½æ˜¯ <code>(id=10,age=22)</code> (è¢« next-key é”è¦†ç›–) æˆ– <code>(id=20,age=39)</code> (è¢«é—´éš™é”è¦†ç›–)ï¼Œå¯¼è‡´é˜»å¡ã€‚</li>
<li>æ’å…¥ <code>age=22</code>ï¼šä» <code>LOCK_DATA: 22, 10</code> å¯çŸ¥ï¼Œè‹¥æ–°è®°å½• <code>id &lt; 10</code>ï¼Œä¼šè¢«æ­¤ next-key é”é˜»å¡ã€‚è‹¥æ–°è®°å½• <code>id &gt; 10</code>ï¼Œå…¶ä¸‹ä¸€æ¡å¯èƒ½æ˜¯ <code>(id=20,age=39)</code> (è¢«é—´éš™é”è¦†ç›–)ï¼Œä¹Ÿä¼šè¢«é˜»å¡ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><code>LOCK_DATA: 39, 20</code>, <code>LOCK_MODE: X, GAP</code>ï¼šå¯¹åº” <code>(id=20, age=39)</code> ä¸Šçš„é—´éš™é”ï¼Œ<code>age</code> èŒƒå›´ <code>(22, 39)</code>ã€‚
<ul>
<li>è¿™æ„å‘³ç€å…¶ä»–äº‹åŠ¡æ— æ³•æ’å…¥ <code>age</code> å€¼ä¸º 23 åˆ° 38 çš„è®°å½•ã€‚</li>
<li>å¯¹äºæ’å…¥æ–°çš„ <code>age=22</code> æˆ– <code>age=39</code> çš„è®°å½•ï¼š
<ul>
<li>æ’å…¥ <code>age=22</code>ï¼šè‹¥æ–°è®°å½• <code>id &lt; 10</code>ï¼Œä¼šè¢«å‰ä¸€ä¸ª next-key é”é˜»å¡ã€‚è‹¥æ–°è®°å½• <code>id &gt; 10</code>ï¼Œå…¶ä¸‹ä¸€æ¡å¯èƒ½æ˜¯ <code>(id=20,age=39)</code> (è¢«æ­¤é—´éš™é”è¦†ç›–)ï¼Œä¹Ÿä¼šè¢«é˜»å¡ã€‚å› æ­¤ï¼Œå®é™…ä¸Šå¾ˆéš¾æ’å…¥æ–°çš„ <code>age=22</code> è®°å½•ã€‚</li>
<li>æ’å…¥ <code>age=39</code>ï¼šä» <code>LOCK_DATA: 39, 20</code> å¯çŸ¥ï¼Œè‹¥æ–°è®°å½• <code>id &lt; 20</code>ï¼Œä¼šè¢«æ­¤é—´éš™é”é˜»å¡ã€‚è‹¥ <code>id &gt;= 20</code>ï¼Œå¯èƒ½æˆåŠŸã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>ä¸»é”®ç´¢å¼• (<code>INDEX_NAME: PRIMARY</code>)</strong>ï¼š</p>
<ul>
<li><code>LOCK_DATA: 10</code>, <code>LOCK_MODE: X, REC_NOT_GAP</code>ï¼šå¯¹ <code>id = 10</code> æ·»åŠ äº†è®°å½•é”ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªå®éªŒæ¡ˆä¾‹ä¸­ï¼Œéœ€è¦åœ¨äºŒçº§ç´¢å¼•ä¸Šæ·»åŠ  <code>age</code> èŒƒå›´ <code>(22, 39)</code> çš„é—´éš™é”ï¼Ÿ</p>
</blockquote>
<p>æ ¸å¿ƒåŸå› ä»ç„¶æ˜¯ä¸ºäº†<strong>é¿å…å¹»è¯»ç°è±¡</strong>ã€‚</p>
<p>è€ƒè™‘æŸ¥è¯¢è¯­å¥ <code>select * from user where age = 22 for update;</code></p>
<p>å¦‚æœäº‹åŠ¡ A åœ¨äºŒçº§ç´¢å¼•ä¸Šåªå¯¹ <code>(id=10, age=22)</code> æ·»åŠ  <code>age</code> èŒƒå›´ <code>(21, 22]</code> çš„ next-key é”ï¼Œè€Œä¸æ·»åŠ åç»­çš„ <code>(22, 39)</code> é—´éš™é”ï¼Œé‚£ä¹ˆå¹»è¯»æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œ<code>age</code> èŒƒå›´ <code>(21, 22]</code> çš„ next-key é”ï¼ˆä½œç”¨äº <code>(id=10, age=22)</code>ï¼‰å¹¶ä¸èƒ½å®Œå…¨é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æ–°çš„ <code>age = 22</code> çš„è®°å½•ã€‚ä¾‹å¦‚ï¼Œå…¶ä»–äº‹åŠ¡ç†è®ºä¸Šå¯ä»¥å°è¯•æ’å…¥ <code>(id=12, age=22)</code>ã€‚å¦‚æœè¿™ä¸ªæ’å…¥æˆåŠŸäº†ï¼Œé‚£ä¹ˆäº‹åŠ¡ A å†æ¬¡æ‰§è¡Œ <code>select * from user where age = 22 for update;</code> æ—¶ï¼Œå°±ä¼šå‘ç°å¤šäº†ä¸€æ¡è®°å½•ï¼Œäº§ç”Ÿäº†å¹»è¯»ã€‚</p>
<p><strong>å½“åœ¨ <code>(id=20, age=39)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šæ·»åŠ äº† <code>age</code> èŒƒå›´ <code>(22, 39)</code> çš„é—´éš™é”åï¼Œå…¶ä»–äº‹åŠ¡å°è¯•æ’å…¥ <code>(id=12, age=22)</code> æ—¶ï¼Œå…¶åœ¨äºŒçº§ç´¢å¼•æ ‘ä¸Šçš„æ’å…¥ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•å°†æ˜¯ <code>(id=20, age=39)</code>ã€‚ç”±äºè¯¥è®°å½•çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šæœ‰è¿™ä¸ªé—´éš™é”ï¼Œæ’å…¥æ“ä½œå°±ä¼šè¢«é˜»å¡ã€‚è¿™æ ·å°±æœ‰æ•ˆåœ°é¿å…äº†å¹»è¯»ã€‚</strong></p>
<p>å› æ­¤ï¼Œè¿™ä¸ªé¢å¤–çš„é—´éš™é”æ˜¯é˜²æ­¢åœ¨ <code>age=22</code> æ¡ä»¶ä¸‹å‡ºç°å¹»è¯»çš„å…³é”®ã€‚</p>
<h3 id="éå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢">éå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢</h3>
<p>éå”¯ä¸€ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢ä¸ä¸»é”®ç´¢å¼•ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰çš„èŒƒå›´æŸ¥è¯¢åœ¨åŠ é”è¡Œä¸ºä¸Šæœ‰ä¸€ä¸ªæ˜¾è‘—åŒºåˆ«ï¼š<strong>å¯¹äºéå”¯ä¸€ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢ï¼Œå…¶åœ¨äºŒçº§ç´¢å¼•ä¸Šæ·»åŠ çš„ next-key lock é€šå¸¸ä¸ä¼šå‘ç”Ÿé€€åŒ–ä¸ºçº¯é—´éš™é”æˆ–çº¯è®°å½•é”çš„æƒ…å†µã€‚</strong> ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰«æåˆ°çš„äºŒçº§ç´¢å¼•è®°å½•é€šå¸¸éƒ½ä¼šè¢«æ–½åŠ  next-key é”ã€‚</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸ªä¾‹å­ï¼Œäº‹åŠ¡ A æ‰§è¡Œä»¥ä¸‹èŒƒå›´æŸ¥è¯¢è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> age <span class="operator">&gt;=</span> <span class="number">22</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> age <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> å±±æ²»      <span class="operator">|</span>  <span class="number">22</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span> é¦™å…‹æ–¯    <span class="operator">|</span>  <span class="number">39</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-----+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ A çš„åŠ é”è¿‡ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>äºŒçº§ç´¢å¼• <code>index_age</code> ä¸Šçš„æ“ä½œ</strong>ï¼š
<ul>
<li>æ‰«æåˆ°çš„ç¬¬ä¸€æ¡æ»¡è¶³ <code>age &gt;= 22</code> çš„äºŒçº§ç´¢å¼•è®°å½•æ˜¯ <code>(id=10, age=22)</code>ã€‚è™½ç„¶èŒƒå›´æŸ¥è¯¢åŒ…å«äº†ç­‰å€¼æ¡ä»¶ (<code>age = 22</code>)ï¼Œä½†å› ä¸ºè¿™æ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥é€šå¸¸ä¸ä¼šå‘ç”Ÿåƒå”¯ä¸€ç´¢å¼•é‚£æ ·çš„é”é€€åŒ–ã€‚å› æ­¤ï¼Œåœ¨ <code>(id=10, age=22)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šæ·»åŠ  <strong>next-key é”</strong>ï¼Œ<code>age</code> èŒƒå›´æ˜¯ <code>(21, 22]</code>ã€‚</li>
<li>ç»§ç»­èŒƒå›´æ‰«æï¼Œä¸‹ä¸€æ¡æ»¡è¶³æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•æ˜¯ <code>(id=20, age=39)</code>ã€‚åœ¨å…¶äºŒçº§ç´¢å¼•é¡¹ä¸Šæ·»åŠ  <strong>next-key é”</strong>ï¼Œ<code>age</code> èŒƒå›´æ˜¯ <code>(22, 39]</code>ã€‚</li>
<li>ç»§ç»­å‘åæ‰«æåˆ°äºŒçº§ç´¢å¼•çš„ supremum pseudo-recordï¼Œä¸ºå…¶æ·»åŠ  <strong>next-key é”</strong>ï¼Œ<code>age</code> èŒƒå›´æ˜¯ <code>(39, +âˆ]</code>ã€‚</li>
</ul>
</li>
<li><strong>ä¸»é”®ç´¢å¼•ä¸Šçš„æ“ä½œ</strong>ï¼š
<ul>
<li>å¯¹äºé€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°çš„ã€ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½• <code>(id=10, age=22)</code>ï¼Œåœ¨å…¶ä¸»é”®ç´¢å¼•é¡¹ (<code>id=10</code>) ä¸Šæ·»åŠ  <strong>X å‹è®°å½•é”</strong>ã€‚</li>
<li>å¯¹äºè®°å½• <code>(id=20, age=39)</code>ï¼Œåœ¨å…¶ä¸»é”®ç´¢å¼•é¡¹ (<code>id=20</code>) ä¸Šæ·»åŠ  <strong>X å‹è®°å½•é”</strong>ã€‚</li>
</ul>
</li>
<li>æ‰«æç»“æŸã€‚</li>
</ol>
<p>æ€»ç»“äº‹åŠ¡ A æ·»åŠ çš„ X å‹é”ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970548753.png" alt="1746970548753"></p>
<ul>
<li><strong>ä¸»é”®ç´¢å¼• (<code>id</code> åˆ—)</strong>ï¼š
<ul>
<li>åœ¨ <code>id = 10</code> çš„è®°å½•ä¸Šï¼Œæ·»åŠ è®°å½•é”ã€‚</li>
<li>åœ¨ <code>id = 20</code> çš„è®°å½•ä¸Šï¼Œæ·»åŠ è®°å½•é”ã€‚</li>
</ul>
</li>
<li><strong>äºŒçº§ç´¢å¼• (<code>age</code> åˆ—)</strong>ï¼š
<ul>
<li>åœ¨ <code>(id=10, age=22)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šï¼Œæ·»åŠ äº† <code>age</code> èŒƒå›´ <code>(21, 22]</code> çš„ next-key é”ã€‚</li>
<li>åœ¨ <code>(id=20, age=39)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šï¼Œæ·»åŠ äº† <code>age</code> èŒƒå›´ <code>(22, 39]</code> çš„ next-key é”ã€‚</li>
<li>åœ¨äºŒçº§ç´¢å¼•çš„ supremum pseudo-record ä¸Šï¼Œæ·»åŠ äº† <code>age</code> èŒƒå›´ <code>(39, +âˆ]</code> çš„ next-key é”ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™äº›é”å…±åŒç¡®ä¿äº†åœ¨ <code>age &gt;= 22</code> çš„èŒƒå›´å†…ä¸ä¼šå‡ºç°å¹»è¯»ï¼Œå¹¶ä¸”ç¬¦åˆæ¡ä»¶çš„è®°å½•ä¸èƒ½è¢«å¹¶å‘ä¿®æ”¹ã€‚</p>
<blockquote>
<p>åœ¨ <code>age &gt;= 22</code> çš„èŒƒå›´æŸ¥è¯¢ä¸­ï¼Œ<code>age = 22</code> çš„è®°å½•å­˜åœ¨ä¸”å±äºç­‰å€¼éƒ¨åˆ†ï¼Œä¸ºä»€ä¹ˆä¸åƒå”¯ä¸€ç´¢å¼•é‚£æ ·ï¼Œå°†åœ¨ <code>(id=10, age=22)</code> çš„äºŒçº§ç´¢å¼•é¡¹ä¸Šçš„ next-key é”é€€åŒ–ä¸ºè®°å½•é”ï¼Ÿ</p>
</blockquote>
<p>è¿™æ˜¯å› ä¸º <code>age</code> å­—æ®µæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œä¸å…·æœ‰å”¯ä¸€æ€§ã€‚å¦‚æœä»…å¯¹ <code>(id=10, age=22)</code> çš„äºŒçº§ç´¢å¼•é¡¹æ–½åŠ è®°å½•é”ï¼ˆè®°å½•é”ä¸»è¦é˜²æ­¢åˆ é™¤/ä¿®æ”¹ï¼Œå¯¹é˜²æ­¢åœ¨&quot;æ—è¾¹&quot;æ’å…¥ç›¸åŒ <code>age</code> å€¼ä½†ä¸åŒ <code>id</code> çš„è®°å½•æ•ˆæœæœ‰é™ï¼‰ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡ä»ç„¶å¯èƒ½æ’å…¥ä¸€æ¡æ–°çš„ <code>age = 22</code> çš„è®°å½•ï¼ˆä¾‹å¦‚ <code>(id=12, age=22)</code>ï¼‰ã€‚å¦‚æœè¿™æ ·çš„æ’å…¥æˆåŠŸï¼Œäº‹åŠ¡ A å†æ¬¡æ‰§è¡ŒæŸ¥è¯¢æ—¶å°±ä¼šçœ‹åˆ°ä¸åŒçš„ç»“æœé›†ï¼Œä»è€Œå‘ç”Ÿå¹»è¯»ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨éå”¯ä¸€ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢ä¸­ï¼Œä¿æŒ next-key é”ï¼ˆå®ƒåŒ…å«äº†é—´éš™é”çš„åŠŸèƒ½ï¼‰å¯¹äºé˜²æ­¢å¹»è¯»è‡³å…³é‡è¦ã€‚</p>
<h3 id="æ²¡æœ‰åŠ ç´¢å¼•çš„æŸ¥è¯¢">æ²¡æœ‰åŠ ç´¢å¼•çš„æŸ¥è¯¢</h3>
<p>å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥éƒ½åˆ©ç”¨äº†ç´¢å¼•è¿›è¡Œæ‰«æå’Œå®šä½è®°å½•ï¼Œç„¶åå¯¹æ‰«æåˆ°çš„ç´¢å¼•é¡¹è¿›è¡ŒåŠ é”ã€‚</p>
<p><strong>å¦‚æœé”å®šè¯»æŸ¥è¯¢è¯­å¥ï¼ˆ<code>SELECT ... FOR UPDATE</code> æˆ– <code>SELECT ... LOCK IN SHARE MODE</code>ï¼‰çš„ <code>WHERE</code> æ¡ä»¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•åˆ—ï¼Œæˆ–è€…æŸ¥è¯¢ä¼˜åŒ–å™¨æœªèƒ½é€‰æ‹©ä½¿ç”¨ç´¢å¼•ï¼Œå¯¼è‡´æ‰§è¡Œå…¨è¡¨æ‰«æï¼Œé‚£ä¹ˆæƒ…å†µä¼šå˜å¾—éå¸¸ä¸¥é‡ï¼šInnoDB ä¼šå¯¹è¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•ï¼ˆå‡†ç¡®åœ°è¯´æ˜¯æ¯ä¸€ä¸ªèšç°‡ç´¢å¼•è®°å½•ï¼‰éƒ½æ–½åŠ  next-key é”ã€‚è¿™å®é™…ä¸Šç›¸å½“äºé”å®šäº†æ•´å¼ è¡¨ã€‚</strong></p>
<p>æ­¤æ—¶ï¼Œä»»ä½•å…¶ä»–äº‹åŠ¡å°è¯•å¯¹è¯¥è¡¨è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œï¼ˆå³ä½¿æ˜¯é’ˆå¯¹æœªè¢«æŸ¥è¯¢æ¡ä»¶ç›´æ¥å‘½ä¸­çš„è¡Œï¼‰éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æŒæœ‰å…¨è¡¨é”çš„äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>
<p>ä¸ä»…æ˜¯é”å®šè¯»æŸ¥è¯¢è¯­å¥ï¼Œ<code>UPDATE</code> å’Œ <code>DELETE</code> è¯­å¥å¦‚æœå…¶ <code>WHERE</code> æ¡ä»¶æ²¡æœ‰æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•ï¼ŒåŒæ ·ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå¹¶å¯¹æ¯ä¸€æ¡è®°å½•çš„èšç°‡ç´¢å¼•é¡¹æ·»åŠ  next-key é”ï¼Œä»è€Œé”ä½å…¨è¡¨ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>åœ¨çº¿ä¸Šç¯å¢ƒä¸­æ‰§è¡Œ <code>UPDATE</code>ã€<code>DELETE</code>ã€<code>SELECT ... FOR UPDATE</code> ç­‰å…·æœ‰åŠ é”æ€§è´¨çš„è¯­å¥æ—¶ï¼ŒåŠ¡å¿…æ£€æŸ¥è¿™äº›è¯­å¥æ˜¯å¦èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨ç´¢å¼•ã€‚å¦‚æœå‘ç”Ÿå…¨è¡¨æ‰«æï¼Œå…¶å¯¹å¹¶å‘æ€§èƒ½çš„å½±å“å°†æ˜¯ç¾éš¾æ€§çš„ã€‚</strong></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ¬¡æˆ‘ä»¬ä»¥ <strong>MySQL 8.0.26</strong> ç‰ˆæœ¬ï¼Œåœ¨<strong>å¯é‡å¤è¯»</strong>éš”ç¦»çº§åˆ«ä¸‹ï¼Œé€šè¿‡ä¸€ç³»åˆ—å®éªŒï¼Œè¯¦ç»†æ¢è®¨äº†å”¯ä¸€ç´¢å¼•å’Œéå”¯ä¸€ç´¢å¼•åœ¨ä¸åŒæŸ¥è¯¢åœºæ™¯ä¸‹çš„è¡Œçº§é”åŠ é”è§„åˆ™ã€‚</p>
<p>æ ¸å¿ƒçš„åŠ é”è§„åˆ™å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š</p>
<p><strong>å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</strong>ï¼š</p>
<ul>
<li>å½“æŸ¥è¯¢çš„è®°å½•**ã€Œå­˜åœ¨ã€<strong>æ—¶ï¼Œæ–½åŠ åœ¨è¯¥è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key lock ä¼š</strong>é€€åŒ–ä¸ºã€Œè®°å½•é”ã€**ã€‚</li>
<li>å½“æŸ¥è¯¢çš„è®°å½•**ã€Œä¸å­˜åœ¨ã€<strong>æ—¶ï¼Œä¼šæ‰¾åˆ°ç´¢å¼•ä¸­ç¬¬ä¸€æ¡å¤§äºæŸ¥è¯¢å€¼çš„è®°å½•ï¼Œå¹¶æ–½åŠ åœ¨è¯¥è®°å½•ç´¢å¼•é¡¹ä¸Šçš„ next-key lock ä¼š</strong>é€€åŒ–ä¸ºã€Œé—´éš™é”ã€**ï¼Œè¦†ç›–æŸ¥è¯¢å€¼ä¸è¯¥è¾ƒå¤§å€¼ä¹‹é—´çš„é—´éš™ã€‚</li>
</ul>
<p><strong>éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</strong>ï¼š</p>
<ul>
<li>å½“æŸ¥è¯¢çš„è®°å½•**ã€Œå­˜åœ¨ã€**æ—¶ï¼š
<ul>
<li><strong>äºŒçº§ç´¢å¼•</strong>ï¼šå¯¹æ‰«æåˆ°çš„æ»¡è¶³æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•åŠ  <strong>next-key é”</strong>ï¼›å¯¹ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œå…¶ next-key é”<strong>é€€åŒ–ä¸ºé—´éš™é”</strong>ã€‚</li>
<li><strong>ä¸»é”®ç´¢å¼•</strong>ï¼šå¯¹ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹åŠ <strong>è®°å½•é”</strong>ã€‚</li>
</ul>
</li>
<li>å½“æŸ¥è¯¢çš„è®°å½•**ã€Œä¸å­˜åœ¨ã€**æ—¶ï¼š
<ul>
<li><strong>äºŒçº§ç´¢å¼•</strong>ï¼šæ‰«æåˆ°ç¬¬ä¸€æ¡ä¸ç¬¦åˆæ¡ä»¶ï¼ˆå¤§äºæŸ¥è¯¢å€¼ï¼‰çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œå…¶ next-key é”<strong>é€€åŒ–ä¸ºé—´éš™é”</strong>ã€‚</li>
<li><strong>ä¸»é”®ç´¢å¼•</strong>ï¼šä¸åŠ é”ã€‚</li>
</ul>
</li>
</ul>
<p><strong>èŒƒå›´æŸ¥è¯¢çš„å·®å¼‚</strong>ï¼š</p>
<ul>
<li><strong>å”¯ä¸€ç´¢å¼•</strong>çš„èŒƒå›´æŸ¥è¯¢ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆå¦‚ç­‰å€¼éƒ¨åˆ†ã€æ‰«æè¾¹ç•Œç­‰ï¼‰ï¼Œnext-key lock å¯èƒ½ä¼šé€€åŒ–ä¸ºé—´éš™é”æˆ–è®°å½•é”ã€‚</li>
<li><strong>éå”¯ä¸€ç´¢å¼•</strong>çš„èŒƒå›´æŸ¥è¯¢ï¼Œå…¶åœ¨äºŒçº§ç´¢å¼•ä¸Šæ·»åŠ çš„ next-key lock é€šå¸¸<strong>ä¸ä¼šé€€åŒ–</strong>ï¼Œä»¥æ›´å…¨é¢åœ°é˜²æ­¢å¹»è¯»ã€‚</li>
</ul>
<p>ç†è§£ MySQL ä¸ºä½•å¦‚æ­¤è®¾è®¡åŠ é”æœºåˆ¶çš„å…³é”®åœ¨äºä»<strong>é¿å…å¹»è¯»</strong>çš„è§’åº¦å»åˆ†æã€‚å¯é‡å¤è¯»éš”ç¦»çº§åˆ«è¦æ±‚é˜²æ­¢å¹»è¯»ï¼Œè€Œè¿™äº›å¤æ‚çš„åŠ é”è§„åˆ™ï¼ˆç‰¹åˆ«æ˜¯ next-key é”å’Œé—´éš™é”çš„è¿ç”¨ï¼‰æ­£æ˜¯ä¸ºäº†åœ¨ä¿è¯å¹¶å‘æ€§çš„åŒæ—¶å®ç°è¿™ä¸€ç›®æ ‡ã€‚</p>
<p>æœ€åï¼Œå†æ¬¡å¼ºè°ƒä¸€ä»¶è‡³å…³é‡è¦çš„äº‹æƒ…ï¼šåœ¨çº¿ä¸Šæ‰§è¡Œ <code>UPDATE</code>ã€<code>DELETE</code>ã€<code>SELECT ... FOR UPDATE</code> ç­‰å…·æœ‰åŠ é”æ€§è´¨çš„è¯­å¥æ—¶ï¼Œ<strong>åŠ¡å¿…æ£€æŸ¥å…¶æ‰§è¡Œè®¡åˆ’ï¼Œç¡®ä¿å®ƒä»¬èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨ç´¢å¼•ã€‚å¦‚æœå‘ç”Ÿå…¨è¡¨æ‰«æï¼Œå°†ä¼šå¯¹æ¯ä¸€ä¸ªç´¢å¼•è®°å½•æ–½åŠ  next-key é”ï¼Œç›¸å½“äºé”ä½æ•´ä¸ªè¡¨ï¼Œè¿™å¯¹ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›æ˜¯æä¸ºä¸åˆ©çš„ã€‚</strong></p>
<p>æœ€åé™„ä¸Šã€Œ@ä¸€åªå°é“­ã€åŒå­¦æ€»ç»“çš„æµç¨‹å›¾ï¼Œä»¥ä¾›å‚è€ƒã€‚</p>
<p>å”¯ä¸€ç´¢å¼•åŠ é”çš„æµç¨‹å›¾ï¼ˆ<strong>è¯·æ³¨æ„ï¼šæ­¤æµç¨‹å›¾ä¸»è¦é’ˆå¯¹ã€Œä¸»é”®ç´¢å¼•ã€ã€‚å¦‚æœæ˜¯äºŒçº§å”¯ä¸€ç´¢å¼•ï¼Œé™¤äº†å›¾ä¸­æ‰€ç¤ºçš„å¯¹äºŒçº§ç´¢å¼•çš„åŠ é”è§„åˆ™å¤–ï¼Œè¿˜ä¼šå¯¹æŸ¥è¯¢åˆ°çš„è®°å½•çš„ä¸»é”®ç´¢å¼•é¡¹é¢å¤–æ·»åŠ ã€Œè®°å½•é”ã€ã€‚æ­¤æµç¨‹å›¾æœªæ˜ç¡®æç¤ºè¿™ä¸€ç‚¹ï¼Œç‰¹æ­¤æ–‡å­—è¡¥å……è¯´æ˜</strong>ï¼‰ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970564337.png" alt="1746970564337"></p>
<p>éå”¯ä¸€ç´¢å¼•åŠ é”çš„æµç¨‹å›¾ï¼š</p>
<p><img src="/2025/05/11/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/MySQL%E6%98%AF%E6%80%8E%E4%B9%88%E5%8A%A0%E9%94%81%E7%9A%84/1746970653139.png" alt="1746970653139"></p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>é”</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>é”æœºåˆ¶</tag>
        <tag>è¡Œçº§é”</tag>
        <tag>è¡¨çº§é”</tag>
        <tag>next-keyé”</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 4.å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•° - æ·±å…¥ç†è§£äºŒåˆ†æ€æƒ³</title>
    <url>/2025/05/11/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-4-%E5%AF%BB%E6%89%BE%E4%B8%A4%E4%B8%AA%E6%AD%A3%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/</url>
    <content><![CDATA[<h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2>
<p>ç»™å®šä¸¤ä¸ªå¤§å°åˆ†åˆ«ä¸º <code>m</code> å’Œ <code>n</code> çš„æ­£åºï¼ˆä»å°åˆ°å¤§ï¼‰æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code>ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›è¿™ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ <strong>ä¸­ä½æ•°</strong>ã€‚</p>
<p>è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º <code>O(log (m+n))</code>ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums1 = [1,3], nums2 = [2]</span><br><span class="line">è¾“å‡ºï¼š2.00000</span><br><span class="line">è§£é‡Šï¼šåˆå¹¶æ•°ç»„ = [1,2,3]ï¼Œä¸­ä½æ•° 2</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šnums1 = [1,2], nums2 = [3,4]</span><br><span class="line">è¾“å‡ºï¼š2.50000</span><br><span class="line">è§£é‡Šï¼šåˆå¹¶æ•°ç»„ = [1,2,3,4]ï¼Œä¸­ä½æ•° (2 + 3) / 2 = 2.5</span><br></pre></td></tr></table></figure>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜ä¹çœ‹ä¹‹ä¸‹ï¼Œä¼¼ä¹å¯ä»¥é€šè¿‡åˆå¹¶ä¸¤ä¸ªæ•°ç»„åæ‰¾å‡ºä¸­ä½æ•°æ¥è§£å†³ï¼Œä½†è¿™æ ·åšçš„æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(m+n)</code>ï¼Œè€Œé¢˜ç›®è¦æ±‚ <code>O(log(m+n))</code>ã€‚ä¸€çœ‹åˆ°å¯¹æ•°çº§çš„æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬åº”è¯¥æƒ³åˆ°äºŒåˆ†æŸ¥æ‰¾ã€‚</p>
<h3 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3>
<p>æœ¬é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å°†ä¸¤ä¸ªæ•°ç»„è¿›è¡Œè™šæ‹Ÿåˆ‡åˆ†</strong>ï¼Œä½¿å¾—ï¼š</p>
<ol>
<li>å·¦åŠéƒ¨åˆ†çš„å…ƒç´ ä¸ªæ•°ç­‰äºå³åŠéƒ¨åˆ†ï¼ˆæˆ–è€…å¤šä¸€ä¸ªï¼Œå½“æ€»æ•°ä¸ºå¥‡æ•°æ—¶ï¼‰</li>
<li>å·¦åŠéƒ¨åˆ†çš„æ‰€æœ‰å…ƒç´ éƒ½å°äºæˆ–ç­‰äºå³åŠéƒ¨åˆ†çš„æ‰€æœ‰å…ƒç´ </li>
</ol>
<p>æ‰¾åˆ°è¿™æ ·çš„åˆ‡åˆ†åï¼Œä¸­ä½æ•°å°±å¯ä»¥è½»æ¾è®¡ç®—å‡ºæ¥äº†ã€‚</p>
<p>å‡è®¾æœ‰ä¸¤ä¸ªæ•°ç»„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nums1: [a1, a2, a3, a4, a5]</span><br><span class="line">nums2: [b1, b2, b3, b4, b5, b6, b7]</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨è¿™ä¸¤ä¸ªæ•°ç»„ä¸­æ‰¾å‡ºä¸€ä¸ªåˆ‡åˆ†ä½ç½®ï¼Œå°†æ‰€æœ‰å…ƒç´ åˆ†ä¸ºæ•°é‡ç›¸ç­‰ï¼ˆæˆ–å·¦ä¾§å¤šä¸€ä¸ªï¼‰çš„ä¸¤éƒ¨åˆ†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å·¦åŠéƒ¨åˆ†ï¼š[a1, a2, a3 | b1, b2, b3, b4]</span><br><span class="line">å³åŠéƒ¨åˆ†ï¼š[a4, a5 | b5, b6, b7]</span><br></pre></td></tr></table></figure>
<p>å½“å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼å°äºæˆ–ç­‰äºå³åŠéƒ¨åˆ†çš„æœ€å°å€¼æ—¶ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†æ­£ç¡®çš„åˆ‡åˆ†ä½ç½®ã€‚ä¸­ä½æ•°å¯ä»¥æ ¹æ®æ€»å…ƒç´ ä¸ªæ•°çš„å¥‡å¶æ€§è®¡ç®—ï¼š</p>
<ul>
<li>å…ƒç´ æ€»æ•°ä¸ºå¥‡æ•°ï¼šä¸­ä½æ•° = å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼</li>
<li>å…ƒç´ æ€»æ•°ä¸ºå¶æ•°ï¼šä¸­ä½æ•° = (å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼ + å³åŠéƒ¨åˆ†çš„æœ€å°å€¼) / 2</li>
</ul>
<h3 id="å®ç°çš„å…³é”®ç‚¹è§£æ">å®ç°çš„å…³é”®ç‚¹è§£æ</h3>
<h4 id="1-åˆ‡åˆ†ç‚¹çš„å«ä¹‰">1. åˆ‡åˆ†ç‚¹çš„å«ä¹‰</h4>
<p>é‡è¦çš„æ˜¯ï¼Œ<strong>midè¡¨ç¤ºçš„æ˜¯å…ƒç´ é—´çš„åˆ‡åˆ†ä½ç½®</strong>ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p>
<p>å¯¹äºæ•°ç»„ <code>[1, 3, 5, 7, 9]</code>ï¼š</p>
<ul>
<li>mid=0 è¡¨ç¤ºåœ¨1ä¹‹å‰åˆ‡åˆ†ï¼š<code>[] | [1, 3, 5, 7, 9]</code></li>
<li>mid=3 è¡¨ç¤ºåœ¨7ä¹‹å‰åˆ‡åˆ†ï¼š<code>[1, 3, 5] | [7, 9]</code></li>
<li>mid=5 è¡¨ç¤ºåœ¨æ‰€æœ‰å…ƒç´ ä¹‹ååˆ‡åˆ†ï¼š<code>[1, 3, 5, 7, 9] | []</code></li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆrightåˆå§‹åŒ–ä¸ºlen1è€Œä¸æ˜¯len1-1ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è€ƒè™‘å°†æ‰€æœ‰å…ƒç´ éƒ½æ”¾åœ¨å·¦åŠéƒ¨åˆ†çš„æƒ…å†µã€‚</p>
<h4 id="2-ä¸ºä»€ä¹ˆä½¿ç”¨-left-right-è€Œä¸æ˜¯-left-rightï¼Ÿ">2. ä¸ºä»€ä¹ˆä½¿ç”¨ <code>left &lt;= right</code> è€Œä¸æ˜¯ <code>left &lt; right</code>ï¼Ÿ</h4>
<p>åœ¨è¿™ä¸ªäºŒåˆ†æŸ¥æ‰¾ä¸­ï¼Œä½¿ç”¨ <code>left &lt;= right</code> æ˜¯å¿…è¦çš„ã€‚å½“æœç´¢åŒºé—´æ”¶ç¼©åˆ°åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼ˆå³ <code>left == right</code>ï¼‰ï¼Œè¿™ä¸ªå…ƒç´ å¯èƒ½å°±æ˜¯æ­£ç¡®çš„åˆ‡åˆ†ç‚¹ã€‚å¦‚æœä½¿ç”¨ <code>left &lt; right</code>ï¼Œå¾ªç¯ä¼šæå‰é€€å‡ºï¼Œå¯èƒ½ä¼šé”™è¿‡æ­£ç¡®è§£ã€‚</p>
<p>ç‰¹åˆ«æ˜¯å½“nums1åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå¦‚æœä½¿ç”¨ <code>left &lt; right</code>ï¼Œç®—æ³•å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†è¿™ç§æƒ…å†µã€‚</p>
<h4 id="3-ä¸ºä»€ä¹ˆåªæ£€æŸ¥-mid1-len1-å’Œ-mid1-0ï¼Œä¸æ£€æŸ¥-mid2-çš„è¾¹ç•Œï¼Ÿ">3. ä¸ºä»€ä¹ˆåªæ£€æŸ¥ mid1 &lt; len1 å’Œ mid1 &gt; 0ï¼Œä¸æ£€æŸ¥ mid2 çš„è¾¹ç•Œï¼Ÿ</h4>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼ç®—æ³•ä¸­æˆ‘ä»¬æ£€æŸ¥äº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> mid1 &lt; len1 &amp;&amp; nums1[mid1] &lt; nums2[mid2<span class="number">-1</span>] &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> mid1 &gt; <span class="number">0</span> &amp;&amp; nums1[mid1<span class="number">-1</span>] &gt; nums2[mid2] &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸éœ€è¦æ£€æŸ¥mid2çš„è¾¹ç•Œï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>mid2çš„è®¡ç®—ä¿è¯äº†æŸäº›è¾¹ç•Œæ¡ä»¶</strong>ï¼šmid2 = halfLen - mid1ï¼Œå…¶ä¸­halfLen = (len1+len2+1)/2</p>
</li>
<li>
<p><strong>mid2çš„èŒƒå›´æ˜¯æœ‰ä¿è¯çš„</strong>ï¼š</p>
<ul>
<li>å½“mid1å¢å¤§æ—¶ï¼Œmid2å‡å°ï¼Œåä¹‹äº¦ç„¶</li>
<li>æˆ‘ä»¬çŸ¥é“ 0 &lt;= mid1 &lt;= len1ï¼Œå› æ­¤ (halfLen-len1) &lt;= mid2 &lt;= halfLen</li>
</ul>
</li>
<li>
<p><strong>ç®—æ³•ä¿è¯äº†mid2çš„åˆç†æ€§</strong>ï¼š</p>
<ul>
<li>æˆ‘ä»¬æ€»æ˜¯å¯¹è¾ƒçŸ­çš„æ•°ç»„è¿›è¡ŒäºŒåˆ†ï¼ˆé€šè¿‡äº¤æ¢nums1å’Œnums2ç¡®ä¿len1 &lt;= len2ï¼‰</li>
<li>è¿™ç¡®ä¿äº†halfLen-len1 &gt;= 0ï¼Œå³mid2 &gt;= 0</li>
<li>åŒæ ·ï¼Œç”±äºhalfLen &lt;= (len1+len2+1)/2 &lt;= (len2+len2+1)/2ï¼Œå¯ä»¥æ¨å¯¼å‡ºmid2 &lt;= len2</li>
</ul>
</li>
</ol>
<p>å› æ­¤ï¼Œå¯¹mid1è¿›è¡Œè¾¹ç•Œæ£€æŸ¥å·²ç»è¶³å¤Ÿï¼Œä¸éœ€è¦æ˜¾å¼æ£€æŸ¥mid2çš„è¾¹ç•Œã€‚è¿™æ˜¯ç®—æ³•è®¾è®¡çš„å·§å¦™ä¹‹å¤„ã€‚</p>
<h4 id="4-ä¸ºä»€ä¹ˆhalfLengthè®¡ç®—è¦åŠ 1ï¼Ÿ">4. ä¸ºä»€ä¹ˆhalfLengthè®¡ç®—è¦åŠ 1ï¼Ÿ</h4>
<p>åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°halfLengthçš„è®¡ç®—ä½¿ç”¨äº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">halfLength := (len1+len2+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>  <span class="comment">// å·¦åŠéƒ¨åˆ†åº”è¯¥åŒ…å«çš„å…ƒç´ ä¸ªæ•°</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>+1</code>éå¸¸å…³é”®ï¼Œå®ƒç¡®ä¿äº†åœ¨å¥‡æ•°é•¿åº¦çš„æƒ…å†µä¸‹ï¼Œå·¦åŠéƒ¨åˆ†ä¼šå¤šåŒ…å«ä¸€ä¸ªå…ƒç´ ã€‚è®©æˆ‘ä»¬åˆ†æä¸åŒæƒ…å†µï¼š</p>
<p><strong>æƒ…å†µ1ï¼šæ€»é•¿åº¦ä¸ºå¶æ•°</strong><br>
å‡è®¾<code>len1 + len2 = 8</code></p>
<ul>
<li>ä½¿ç”¨<code>(8) &gt;&gt; 1 = 4</code>ï¼Œå·¦è¾¹å’Œå³è¾¹å„4ä¸ªå…ƒç´ </li>
<li>ä½¿ç”¨<code>(8 + 1) &gt;&gt; 1 = 4</code>ï¼Œç»“æœç›¸åŒï¼Œå·¦å³å„4ä¸ªå…ƒç´ </li>
</ul>
<p><strong>æƒ…å†µ2ï¼šæ€»é•¿åº¦ä¸ºå¥‡æ•°</strong><br>
å‡è®¾<code>len1 + len2 = 7</code></p>
<ul>
<li>ä½¿ç”¨<code>(7) &gt;&gt; 1 = 3</code>ï¼Œå·¦è¾¹3ä¸ªå…ƒç´ ï¼Œå³è¾¹4ä¸ªå…ƒç´ </li>
<li>ä½¿ç”¨<code>(7 + 1) &gt;&gt; 1 = 4</code>ï¼Œå·¦è¾¹4ä¸ªå…ƒç´ ï¼Œå³è¾¹3ä¸ªå…ƒç´ </li>
</ul>
<p>åœ¨å¤„ç†ä¸­ä½æ•°æ—¶ï¼Œæˆ‘ä»¬çš„ä»£ç é€»è¾‘æ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä¸¤ä¸ªæ•°ç»„çš„æ€»é•¿åº¦ä¸ºå¥‡æ•°ï¼Œä¸­ä½æ•°å°±æ˜¯å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">if</span> (len1+len2)%<span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">float64</span>(maxLeft)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€»é•¿åº¦ä¸ºå¶æ•°æ—¶ï¼Œä¸­ä½æ•°æ˜¯å·¦åŠéƒ¨åˆ†æœ€å¤§å€¼å’Œå³åŠéƒ¨åˆ†æœ€å°å€¼çš„å¹³å‡å€¼</span></span><br><span class="line"><span class="keyword">return</span> <span class="type">float64</span>(maxLeft + minRight) / <span class="number">2.0</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ç®—æ³•è®¾è®¡å‡è®¾ï¼š</p>
<ul>
<li>å¥‡æ•°é•¿åº¦æ—¶ï¼Œä¸­ä½æ•°æ˜¯å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼</li>
<li>å¶æ•°é•¿åº¦æ—¶ï¼Œéœ€è¦è®¡ç®—å·¦åŠéƒ¨åˆ†æœ€å¤§å€¼å’Œå³åŠéƒ¨åˆ†æœ€å°å€¼çš„å¹³å‡å€¼</li>
</ul>
<p>ä¸ºäº†ä½¿è¿™ä¸ªé€»è¾‘æ­£ç¡®å·¥ä½œï¼Œåœ¨å¥‡æ•°é•¿åº¦æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ä¸­ä½æ•°åœ¨å·¦åŠéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ€»é•¿åº¦7çš„æ•°ç»„ï¼Œä¸­ä½æ•°æ˜¯ç¬¬4ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å·¦åŠéƒ¨åˆ†å¿…é¡»åŒ…å«4ä¸ªå…ƒç´ ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>(len1+len2+1)&gt;&gt;1</code>è€Œä¸æ˜¯<code>(len1+len2)&gt;&gt;1</code>çš„åŸå› ï¼šåŠ ä¸Šè¿™ä¸ª<code>+1</code>ç¡®ä¿äº†åœ¨å¥‡æ•°é•¿åº¦æƒ…å†µä¸‹ï¼Œå·¦åŠéƒ¨åˆ†ä¼šå¤šåŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œä»è€ŒåŒ…å«äº†ä¸­ä½æ•°ï¼Œä½¿å¾—ç®—æ³•çš„åˆ¤æ–­é€»è¾‘èƒ½å¤Ÿæ­£ç¡®å·¥ä½œã€‚</p>
<h2 id="å®Œæ•´ä»£ç å®ç°">å®Œæ•´ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°</span></span><br><span class="line"><span class="comment"> * @param nums1 ç¬¬ä¸€ä¸ªæœ‰åºæ•°ç»„</span></span><br><span class="line"><span class="comment"> * @param nums2 ç¬¬äºŒä¸ªæœ‰åºæ•°ç»„</span></span><br><span class="line"><span class="comment"> * @return ä¸¤ä¸ªæ•°ç»„åˆå¹¶åçš„ä¸­ä½æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findMedianSortedArrays</span><span class="params">(nums1 []<span class="type">int</span>, nums2 []<span class="type">int</span>)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–ä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">    len1, len2 := <span class="built_in">len</span>(nums1), <span class="built_in">len</span>(nums2)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¼˜åŒ–ï¼šå§‹ç»ˆå¯¹è¾ƒçŸ­çš„æ•°ç»„è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå‡å°‘æœç´¢ç©ºé—´</span></span><br><span class="line">    <span class="comment">// å¦‚æœ nums1 æ¯” nums2 é•¿ï¼Œåˆ™äº¤æ¢ä¸¤ä¸ªæ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> len1 &gt; len2 &#123;</span><br><span class="line">        <span class="keyword">return</span> findMedianSortedArrays(nums2, nums1)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// äºŒåˆ†æŸ¥æ‰¾çš„è¾¹ç•Œ</span></span><br><span class="line">    left := <span class="number">0</span>                   <span class="comment">// äºŒåˆ†æŸ¥æ‰¾çš„å·¦è¾¹ç•Œï¼Œè¡¨ç¤ºnums1å¯èƒ½çš„æœ€å°åˆ‡åˆ†ç‚¹</span></span><br><span class="line">    right := len1               <span class="comment">// äºŒåˆ†æŸ¥æ‰¾çš„å³è¾¹ç•Œï¼Œè¡¨ç¤ºnums1å¯èƒ½çš„æœ€å¤§åˆ‡åˆ†ç‚¹</span></span><br><span class="line">    halfLen := (len1+len2+<span class="number">1</span>)/<span class="number">2</span>  <span class="comment">// å·¦åŠéƒ¨åˆ†åº”è¯¥åŒ…å«çš„å…ƒç´ ä¸ªæ•°ï¼ˆåŒ…æ‹¬å¥‡æ•°æƒ…å†µï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨nums1ä¸Šè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯»æ‰¾åˆé€‚çš„åˆ‡åˆ†ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—å½“å‰nums1çš„åˆ‡åˆ†ç‚¹ï¼ˆå°†å‰mid1ä¸ªå…ƒç´ æ”¾å…¥å·¦åŠéƒ¨åˆ†ï¼‰</span></span><br><span class="line">        mid1 := (left + right) &gt;&gt; <span class="number">1</span>  <span class="comment">// ä½¿ç”¨ä½è¿ç®—æé«˜æ•ˆç‡ï¼Œç­‰ä»·äº (left + right) / 2</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ¹æ®mid1è®¡ç®—nums2çš„åˆ‡åˆ†ç‚¹ï¼Œç¡®ä¿å·¦åŠéƒ¨åˆ†æ€»å…±æœ‰halfLenä¸ªå…ƒç´ </span></span><br><span class="line">        mid2 := halfLen - mid1</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ç§æƒ…å†µï¼šnums1çš„åˆ‡åˆ†ç‚¹å¤ªå°ï¼Œå·¦åŠéƒ¨åˆ†éœ€è¦æ›´å¤šå…ƒç´ </span></span><br><span class="line">        <span class="comment">// æ£€æŸ¥ï¼šå¦‚æœmid1å…ƒç´ å°äºnums2çš„mid2-1å…ƒç´ ï¼Œè¯´æ˜mid1éœ€è¦å³ç§»</span></span><br><span class="line">        <span class="keyword">if</span> mid1 &lt; len1 &amp;&amp; nums1[mid1] &lt; nums2[mid2<span class="number">-1</span>] &#123;</span><br><span class="line">            <span class="comment">// mid1å¤ªå°ï¼Œéœ€è¦å¢åŠ ï¼Œå‘å³ç§»åŠ¨leftæŒ‡é’ˆ</span></span><br><span class="line">            left = mid1 + <span class="number">1</span></span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// ç¬¬äºŒç§æƒ…å†µï¼šnums1çš„åˆ‡åˆ†ç‚¹å¤ªå¤§ï¼Œå·¦åŠéƒ¨åˆ†éœ€è¦å‡å°‘å…ƒç´ </span></span><br><span class="line">        <span class="comment">// æ£€æŸ¥ï¼šå¦‚æœmid1-1å…ƒç´ å¤§äºnums2çš„mid2å…ƒç´ ï¼Œè¯´æ˜mid1éœ€è¦å·¦ç§»</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> mid1 &gt; <span class="number">0</span> &amp;&amp; nums1[mid1<span class="number">-1</span>] &gt; nums2[mid2] &#123;</span><br><span class="line">            <span class="comment">// mid1å¤ªå¤§ï¼Œéœ€è¦å‡å°‘ï¼Œå‘å·¦ç§»åŠ¨rightæŒ‡é’ˆ</span></span><br><span class="line">            right = mid1 - <span class="number">1</span></span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// æ‰¾åˆ°äº†åˆé€‚çš„åˆ‡åˆ†ç‚¹ï¼šå·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼å°äºç­‰äºå³åŠéƒ¨åˆ†çš„æœ€å°å€¼</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è®¡ç®—å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">var</span> maxLeft <span class="type">int</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µï¼šå½“mid1=0æ—¶ï¼Œnums1çš„å·¦åŠéƒ¨åˆ†ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> mid1 == <span class="number">0</span> &#123;</span><br><span class="line">                maxLeft = nums2[mid2<span class="number">-1</span>]  <span class="comment">// å·¦åŠéƒ¨åˆ†æœ€å¤§å€¼æ¥è‡ªnums2</span></span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µï¼šå½“mid2=0æ—¶ï¼Œnums2çš„å·¦åŠéƒ¨åˆ†ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> mid2 == <span class="number">0</span> &#123;</span><br><span class="line">                maxLeft = nums1[mid1<span class="number">-1</span>]  <span class="comment">// å·¦åŠéƒ¨åˆ†æœ€å¤§å€¼æ¥è‡ªnums1</span></span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// ä¸€èˆ¬æƒ…å†µï¼šå–nums1å’Œnums2å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                maxLeft = max(nums1[mid1<span class="number">-1</span>], nums2[mid2<span class="number">-1</span>])</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœä¸¤ä¸ªæ•°ç»„çš„æ€»é•¿åº¦ä¸ºå¥‡æ•°ï¼Œç›´æ¥è¿”å›å·¦åŠéƒ¨åˆ†çš„æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (len1+len2) % <span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="type">float64</span>(maxLeft)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®¡ç®—å³åŠéƒ¨åˆ†çš„æœ€å°å€¼ï¼ˆå¶æ•°æƒ…å†µä¸‹éœ€è¦ï¼‰</span></span><br><span class="line">            <span class="keyword">var</span> minRight <span class="type">int</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µï¼šå½“mid1=len1æ—¶ï¼Œnums1çš„å³åŠéƒ¨åˆ†ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> mid1 == len1 &#123;</span><br><span class="line">                minRight = nums2[mid2]  <span class="comment">// å³åŠéƒ¨åˆ†æœ€å°å€¼æ¥è‡ªnums2</span></span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µï¼šå½“mid2=len2æ—¶ï¼Œnums2çš„å³åŠéƒ¨åˆ†ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> mid2 == len2 &#123;</span><br><span class="line">                minRight = nums1[mid1]  <span class="comment">// å³åŠéƒ¨åˆ†æœ€å°å€¼æ¥è‡ªnums1</span></span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// ä¸€èˆ¬æƒ…å†µï¼šå–nums1å’Œnums2å³åŠéƒ¨åˆ†çš„æœ€å°å€¼</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                minRight = min(nums1[mid1], nums2[mid2])</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ€»é•¿åº¦ä¸ºå¶æ•°æ—¶ï¼Œä¸­ä½æ•°æ˜¯å·¦åŠéƒ¨åˆ†æœ€å¤§å€¼å’Œå³åŠéƒ¨åˆ†æœ€å°å€¼çš„å¹³å‡å€¼</span></span><br><span class="line">            <span class="keyword">return</span> <span class="type">float64</span>(maxLeft + minRight) / <span class="number">2.0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç†è®ºä¸Šä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œæ·»åŠ è¿”å›å€¼ä»¥æ»¡è¶³ç¼–è¯‘è¦æ±‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ä¸¤ä¸ªæ•´æ•°ä¸­çš„è¾ƒå¤§å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ä¸¤ä¸ªæ•´æ•°ä¸­çš„è¾ƒå°å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &lt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å®ä¾‹åˆ†æ">å®ä¾‹åˆ†æ</h2>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥è¯´æ˜ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p>å‡è®¾ nums1 = [1, 3, 5]ï¼Œnums2 = [2, 4, 6]</p>
<ol>
<li>
<p>åˆå§‹åŒ–ï¼šlen1=3, len2=3, halfLen=(3+3+1)/2=3, left=0, right=3</p>
</li>
<li>
<p>ç¬¬ä¸€æ¬¡è¿­ä»£ï¼š</p>
<ul>
<li>mid1 = (0+3)/2 = 1ï¼Œè¡¨ç¤ºåœ¨nums1ä¸­[1] | [3,5]åˆ‡åˆ†</li>
<li>mid2 = 3-1 = 2ï¼Œè¡¨ç¤ºåœ¨nums2ä¸­[2,4] | [6]åˆ‡åˆ†</li>
<li>æ£€æŸ¥ï¼šnums1[mid1-1]=1 &lt;= nums2[mid2]=6 ä¸” nums2[mid2-1]=4 &gt; nums1[mid1]=3</li>
<li>éœ€è¦å¢åŠ mid1ï¼Œæ‰€ä»¥left = mid1+1 = 2</li>
</ul>
</li>
<li>
<p>ç¬¬äºŒæ¬¡è¿­ä»£ï¼š</p>
<ul>
<li>mid1 = (2+3)/2 = 2ï¼Œè¡¨ç¤ºåœ¨nums1ä¸­[1,3] | [5]åˆ‡åˆ†</li>
<li>mid2 = 3-2 = 1ï¼Œè¡¨ç¤ºåœ¨nums2ä¸­[2] | [4,6]åˆ‡åˆ†</li>
<li>æ£€æŸ¥ï¼šnums1[mid1-1]=3 &lt;= nums2[mid2]=4 ä¸” nums2[mid2-1]=2 &lt;= nums1[mid1]=5</li>
<li>æ‰¾åˆ°äº†åˆé€‚çš„åˆ‡åˆ†ç‚¹ï¼</li>
<li>å·¦åŠéƒ¨åˆ†ï¼š[1, 3, 2]ï¼Œæœ€å¤§å€¼æ˜¯3</li>
<li>å³åŠéƒ¨åˆ†ï¼š[5, 4, 6]ï¼Œæœ€å°å€¼æ˜¯4</li>
<li>æ€»å…ƒç´ ä¸ªæ•°ä¸ºå¶æ•°ï¼Œæ‰€ä»¥ä¸­ä½æ•° = (3+4)/2 = 3.5</li>
</ul>
</li>
</ol>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(log(min(m,n)))ï¼Œå…¶ä¸­må’Œnåˆ†åˆ«æ˜¯ä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦ã€‚æˆ‘ä»¬å¯¹è¾ƒçŸ­çš„æ•°ç»„è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œåªä½¿ç”¨äº†å¸¸æ•°é¢å¤–ç©ºé—´ã€‚</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒåœ¨äºç†è§£å¦‚ä½•åœ¨ä¸¤ä¸ªæœ‰åºæ•°ç»„ä¸­æ‰¾åˆ°åˆé€‚çš„åˆ‡åˆ†ç‚¹ï¼Œä½¿å¾—ï¼š</p>
<ol>
<li>å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†çš„å…ƒç´ ä¸ªæ•°å¤§è‡´ç›¸ç­‰</li>
<li>å·¦åŠéƒ¨åˆ†çš„æ‰€æœ‰å…ƒç´ å°äºç­‰äºå³åŠéƒ¨åˆ†çš„æ‰€æœ‰å…ƒç´ </li>
</ol>
<p>å…³é”®ç‚¹è§£æï¼š</p>
<ul>
<li>midè¡¨ç¤ºå…ƒç´ é—´çš„åˆ‡åˆ†ä½ç½®ï¼Œè€Œä¸æ˜¯å…ƒç´ æœ¬èº«</li>
<li>ä½¿ç”¨<code>left &lt;= right</code>ç¡®ä¿èƒ½æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„åˆ‡åˆ†ç‚¹</li>
<li>rightåˆå§‹åŒ–ä¸ºlen1ä»¥è€ƒè™‘æ‰€æœ‰å¯èƒ½çš„åˆ‡åˆ†æƒ…å†µ</li>
<li>åªéœ€æ£€æŸ¥mid1çš„è¾¹ç•Œæ¡ä»¶ï¼Œå› ä¸ºç®—æ³•è®¾è®¡å·²ç»ä¿è¯äº†mid2çš„åˆç†æ€§</li>
</ul>
<p>ç†è§£äº†è¿™äº›å…³é”®ç‚¹ï¼Œè¿™é“Hardéš¾åº¦çš„é¢˜ç›®å°±å˜å¾—æ¸…æ™°æ˜“æ‡‚äº†ã€‚äºŒåˆ†æŸ¥æ‰¾çš„åº”ç”¨è¿œä¸æ­¢æ˜¯åœ¨å•ä¸€æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œå®ƒè¿˜å¯ä»¥ç”¨æ¥è§£å†³æ›´å¤æ‚çš„é—®é¢˜ï¼Œæ¯”å¦‚æ­¤é¢˜ä¸­çš„ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°æŸ¥æ‰¾ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ¨¡æ‹Ÿ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Hard</tag>
        <tag>æ•°ç»„</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç±»å‹ï¼šZset (æœ‰åºé›†åˆ) æ·±åº¦è§£æä¸å®æˆ˜</title>
    <url>/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Zset/</url>
    <content><![CDATA[<h2 id="Zset">Zset</h2>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ éœ€è¦ä¸€ä¸ªèƒ½è‡ªåŠ¨æ’åºçš„åˆ—è¡¨ï¼Œæ¯”å¦‚å®æ—¶æ›´æ–°çš„ç§¯åˆ†æ’è¡Œæ¦œã€æŒ‰æ—¶é—´å…ˆåæ’åˆ—çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œæˆ–è€…ä»»ä½•éœ€è¦æ ¹æ®æŸä¸ª&quot;åˆ†æ•°&quot;æ¥å†³å®šé¡ºåºçš„åœºæ™¯ã€‚Redis çš„ Zset (Sorted Setï¼Œæœ‰åºé›†åˆ) å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„ï¼å®ƒå’Œæ™®é€šçš„ Set ä¸€æ ·ï¼Œä¿è¯äº†å…ƒç´ çš„å”¯ä¸€æ€§ï¼Œä½†æ›´å¼ºå¤§çš„æ˜¯ï¼ŒZset ä¸ºæ¯ä¸ªå…ƒç´ å…³è”äº†ä¸€ä¸ª&quot;åˆ†æ•°&quot;(score)ï¼Œå¹¶èƒ½æ ¹æ®è¿™ä¸ªåˆ†æ•°è‡ªåŠ¨å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</p>
<p>æœ‰åºé›†åˆä¿ç•™äº†é›†åˆä¸èƒ½æœ‰é‡å¤æˆå‘˜çš„ç‰¹æ€§ï¼ˆåˆ†å€¼å¯ä»¥é‡å¤ï¼‰ï¼Œä½†ä¸åŒçš„æ˜¯ï¼Œæœ‰åºé›†åˆä¸­çš„å…ƒç´ å¯ä»¥æ’åºã€‚</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Zset/1746890268561.png" alt="1746890268561"></p>
<h3 id="å†…éƒ¨å®ç°">å†…éƒ¨å®ç°</h3>
<p>Zset å¦‚ä½•åšåˆ°æ—¢èƒ½å­˜å‚¨å”¯ä¸€å…ƒç´ åˆèƒ½æ’åºå‘¢ï¼ŸRedis åœ¨åº•å±‚ä½¿ç”¨äº†ä¸¤ç§ç²¾å·§çš„æ•°æ®ç»“æ„ï¼š<strong>è·³è¡¨ (Skip List)</strong> å’Œ <strong>åˆ—è¡¨æ‰“åŒ… (Listpack)</strong>ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼š</p>
<ul>
<li>å½“ä½ çš„ Zset å…ƒç´ ä¸å¤šï¼ˆé»˜è®¤å°äº128ä¸ªï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼ä¹Ÿä¸å¤§ï¼ˆé»˜è®¤å°äº64å­—èŠ‚ï¼‰æ—¶ï¼ŒRedis ä¼šä¼˜å…ˆä½¿ç”¨ <strong>listpack</strong>ã€‚å®ƒæ˜¯ä¸€ç§æ›´ç´§å‡‘çš„å­˜å‚¨æ–¹å¼ï¼Œéå¸¸èŠ‚çœå†…å­˜ã€‚</li>
<li>è€Œå½“ Zset å…ƒç´ å¢å¤šï¼Œæˆ–è€…å…ƒç´ å€¼è¾ƒå¤§ï¼Œä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶æ—¶ï¼ŒRedis åˆ™ä¼šåˆ‡æ¢åˆ° <strong>è·³è¡¨</strong>ã€‚è·³è¡¨æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„åŠ¨æ€æ’åºæ•°æ®ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿè¿›è¡Œæ·»åŠ ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œï¼Œå…¶å¹³å‡æ—¶é—´å¤æ‚åº¦æ¥è¿‘ O(logN)ã€‚</li>
</ul>
<p>ä½ æ— éœ€å…³å¿ƒ Redis ä½•æ—¶ä»¥åŠå¦‚ä½•åˆ‡æ¢ï¼Œå®ƒä¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„æ–¹å¼ã€‚</p>
<p>(å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Redis 7.0 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯å‹ç¼©åˆ—è¡¨è€Œé listpackï¼Œä½†æ ¸å¿ƒæ€æƒ³æ˜¯ç±»ä¼¼çš„â€”â€”åœ¨å°æ•°æ®é‡æ—¶é‡‡ç”¨å†…å­˜ä¼˜åŒ–ç»“æ„ã€‚<strong>è‡ª Redis 7.0 èµ·ï¼Œå‹ç¼©åˆ—è¡¨å·²è¢« listpack å®Œå…¨å–ä»£ã€‚</strong>)</p>
<h3 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h3>
<p>ç†è§£ Zset çš„å¸¸ç”¨å‘½ä»¤æ˜¯é«˜æ•ˆä½¿ç”¨å®ƒçš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ ¸å¿ƒæ“ä½œï¼Œåˆ†ä¸ºå‡ ç±»ä»¥ä¾¿ç†è§£ï¼š</p>
<h4 id="æ·»åŠ ä¸ä¿®æ”¹">æ·»åŠ ä¸ä¿®æ”¹</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZADD key score member [[score member]...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šå‘åä¸º key çš„æœ‰åºé›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  (member)ï¼Œå¹¶ä¸ºæ¯ä¸ªå…ƒç´ æŒ‡å®šä¸€ä¸ªåˆ†æ•° (score)ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœå…ƒç´ å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶åˆ†æ•°ï¼›å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ æ–°å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›æˆåŠŸæ·»åŠ çš„æ–°å…ƒç´ æ•°é‡ï¼ˆä¸åŒ…æ‹¬ä»…æ›´æ–°åˆ†æ•°çš„å…ƒç´ ï¼‰ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZADD myzset 10 <span class="string">&quot;apple&quot;</span> 20 <span class="string">&quot;banana&quot;</span></span></span><br><span class="line">ZADD key score member [[score member]...]   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZINCRBY key increment member</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šä¸ºåä¸º key çš„æœ‰åºé›†åˆä¸­æŒ‡å®šå…ƒç´  member çš„åˆ†æ•°å¢åŠ  incrementã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœ member ä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ å®ƒï¼Œå…¶åˆå§‹åˆ†æ•°ä¸º incrementã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">increment å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œè¡¨ç¤ºå‡åˆ†ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZINCRBY myzset 5 <span class="string">&quot;apple&quot;</span> (apple çš„åˆ†æ•°å˜ä¸º 15)</span></span><br><span class="line">ZINCRBY key increment member </span><br></pre></td></tr></table></figure>
<h4 id="åˆ é™¤ä¸æŸ¥è¯¢æ•°é‡">åˆ é™¤ä¸æŸ¥è¯¢æ•°é‡</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZREM key member [member...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šä»åä¸º key çš„æœ‰åºé›†åˆä¸­åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„å…ƒç´  memberã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZREM myzset <span class="string">&quot;apple&quot;</span></span></span><br><span class="line">ZREM key member [member...]               </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZCARD key</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè·å–åä¸º key çš„æœ‰åºé›†åˆä¸­çš„å…ƒç´ æ€»æ•° (Cardinality)ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZCARD myzset</span></span><br><span class="line">ZCARD key </span><br></pre></td></tr></table></figure>
<h4 id="è·å–åˆ†æ•°ä¸æ’åºï¼ˆæŒ‰åˆ†æ•°ï¼‰">è·å–åˆ†æ•°ä¸æ’åºï¼ˆæŒ‰åˆ†æ•°ï¼‰</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZSCORE key member</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè¿”å›åä¸º key çš„æœ‰åºé›†åˆä¸­æŒ‡å®šå…ƒç´  member çš„åˆ†æ•°ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœ member ä¸å­˜åœ¨æˆ– key ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› nilã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZSCORE myzset <span class="string">&quot;banana&quot;</span></span></span><br><span class="line">ZSCORE key member</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZRANGE key start stop [WITHSCORES]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šæŒ‰åˆ†æ•°ä»å°åˆ°å¤§çš„é¡ºåºï¼ˆå‡åºï¼‰ï¼Œè¿”å›åä¸º key çš„æœ‰åºé›†åˆä¸­æŒ‡å®šæ’åèŒƒå›´å†…çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">start å’Œ stop éƒ½æ˜¯ä» 0 å¼€å§‹çš„ä¸‹æ ‡ï¼Œå¯ä»¥æ˜¯è´Ÿæ•°ï¼ˆ-1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æ¨ï¼‰ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">WITHSCORES é€‰é¡¹ä¼šåŒæ—¶è¿”å›å…ƒç´ çš„åˆ†æ•°ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZRANGE myzset 0 -1 WITHSCORES (è·å–æ‰€æœ‰å…ƒç´ åŠå…¶åˆ†æ•°)</span></span><br><span class="line">ZRANGE key start stop [WITHSCORES]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZREVRANGE key start stop [WITHSCORES]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šæŒ‰åˆ†æ•°ä»å¤§åˆ°å°çš„é¡ºåºï¼ˆé™åºï¼‰ï¼Œè¿”å›åä¸º key çš„æœ‰åºé›†åˆä¸­æŒ‡å®šæ’åèŒƒå›´å†…çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‚æ•°å«ä¹‰ä¸ ZRANGE ç±»ä¼¼ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZREVRANGE myzset 0 2 WITHSCORES (è·å–åˆ†æ•°æœ€é«˜çš„3ä¸ªå…ƒç´ åŠå…¶åˆ†æ•°)</span></span><br><span class="line">ZREVRANGE key start stop [WITHSCORES]</span><br></pre></td></tr></table></figure>
<h4 id="èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åˆ†æ•°æˆ–å­—å…¸åºï¼‰">èŒƒå›´æŸ¥è¯¢ï¼ˆæŒ‰åˆ†æ•°æˆ–å­—å…¸åºï¼‰</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè¿”å›åä¸º key çš„æœ‰åºé›†åˆä¸­ï¼Œæ‰€æœ‰åˆ†æ•°åœ¨ min å’Œ max ä¹‹é—´ï¼ˆåŒ…æ‹¬ min å’Œ maxï¼‰çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…ƒç´ æŒ‰åˆ†æ•°ä»å°åˆ°å¤§æ’åºã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">min å’Œ max å¯ä»¥æ˜¯ -inf (è´Ÿæ— ç©·) å’Œ +inf (æ­£æ— ç©·)ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ ( å‰ç¼€è¡¨ç¤ºä¸åŒ…å«è¾¹ç•Œå€¼ï¼Œä¾‹å¦‚ (100 è¡¨ç¤ºå¤§äº100ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">LIMIT ç”¨äºåˆ†é¡µï¼Œoffset æ˜¯èµ·å§‹ä½ç½®ï¼Œcount æ˜¯æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZRANGEBYSCORE myzset 10 (30 WITHSCORES LIMIT 0 5 (è·å–åˆ†æ•°å¤§äº10å°äºç­‰äº30çš„å‰5ä¸ªå…ƒç´ )</span></span><br><span class="line">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZRANGEBYLEX key min max [LIMIT offset count]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šå½“æœ‰åºé›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„åˆ†æ•°éƒ½ç›¸åŒæ—¶ï¼Œæ­¤å‘½ä»¤æŒ‰å…ƒç´ çš„å­—å…¸åºï¼ˆlexicographical orderï¼‰è¿”å›æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">**é‡è¦å‰æï¼šä½¿ç”¨ ZRANGEBYLEX æ—¶ï¼Œç›®æ ‡ Zset ä¸­çš„æ‰€æœ‰å…ƒç´ åˆ†æ•° *å¿…é¡»* ç›¸åŒï¼Œå¦åˆ™ç»“æœå¯èƒ½ä¸ç¬¦åˆé¢„æœŸï¼**</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">min å’Œ max æ˜¯å­—å…¸åºèŒƒå›´ã€‚ä½¿ç”¨ - å’Œ + è¡¨ç¤ºè´Ÿæ— ç©·å’Œæ­£æ— ç©·çš„å­—å…¸åºè¾¹ç•Œã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ [ è¡¨ç¤ºåŒ…å«è¾¹ç•Œï¼Œä½¿ç”¨ ( è¡¨ç¤ºä¸åŒ…å«è¾¹ç•Œã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZRANGEBYLEX myzset <span class="string">&quot;[apple&quot;</span> <span class="string">&quot;(banana&quot;</span> (è·å–å­—å…¸åºåœ¨ apple (å«) å’Œ banana (ä¸å«) ä¹‹é—´çš„å…ƒç´ )</span></span><br><span class="line">ZRANGEBYLEX key min max [LIMIT offset count]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZREVRANGEBYLEX key max min [LIMIT offset count]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šä¸ ZRANGEBYLEX ç±»ä¼¼ï¼Œä½†æŒ‰å­—å…¸é€†åºæ’åˆ—ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">**é‡è¦å‰æï¼šä½¿ç”¨ ZREVRANGEBYLEX æ—¶ï¼Œç›®æ ‡ Zset ä¸­çš„æ‰€æœ‰å…ƒç´ åˆ†æ•° *å¿…é¡»* ç›¸åŒï¼Œå¦åˆ™ç»“æœå¯èƒ½ä¸ç¬¦åˆé¢„æœŸï¼**</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZREVRANGEBYLEX myzset <span class="string">&quot;+ &quot;</span> <span class="string">&quot;[banana&quot;</span> (è·å–å­—å…¸åºä»æœ€å¤§åˆ° banana (å«) çš„å…ƒç´ )</span></span><br><span class="line">ZREVRANGEBYLEX key max min [LIMIT offset count]</span><br></pre></td></tr></table></figure>
<h4 id="é›†åˆè¿ç®—">é›†åˆè¿ç®—</h4>
<p>Zset ä¹Ÿæ”¯æŒå¹¶é›†å’Œäº¤é›†è¿ç®—ï¼Œä½†ä¸ Set ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥æŒ‡å®šå¦‚ä½•å¤„ç†é‡å¤å…ƒç´ çš„åˆ†æ•°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZUNIONSTORE destkey numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE SUM|MIN|MAX]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè®¡ç®—ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†åˆ (key) çš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨æ–°çš„æœ‰åºé›†åˆ destkey ä¸­ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">numkeys æŒ‡å®šè¾“å…¥ key çš„æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">WEIGHTS (å¯é€‰)ï¼šä¸ºæ¯ä¸ªè¾“å…¥é›†åˆæŒ‡å®šä¸€ä¸ªä¹˜æ³•å› å­ï¼Œå…ƒç´ çš„åŸå§‹åˆ†æ•°åœ¨å‚ä¸è¿ç®—å‰ä¼šä¹˜ä»¥è¿™ä¸ªå› å­ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">AGGREGATE (å¯é€‰)ï¼šæŒ‡å®šå¦‚ä½•å¤„ç†å¹¶é›†ä¸­ç›¸åŒå…ƒç´ çš„åˆ†æ•°ï¼Œé»˜è®¤ä¸º SUM (ç›¸åŠ )ï¼Œä¹Ÿå¯ä»¥æ˜¯ MIN (å–æœ€å°å€¼) æˆ– MAX (å–æœ€å¤§å€¼)ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šZUNIONSTORE outkey 2 zset1 zset2 WEIGHTS 1 2 AGGREGATE MAX</span></span><br><span class="line">ZUNIONSTORE destkey numkeys key [key...] </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZINTERSTORE destkey numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE SUM|MIN|MAX]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè®¡ç®—ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†åˆ (key) çš„äº¤é›†ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨æ–°çš„æœ‰åºé›†åˆ destkey ä¸­ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‚æ•°å«ä¹‰ä¸ ZUNIONSTORE ç±»ä¼¼ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ³¨æ„ï¼šZset æ²¡æœ‰ç›´æ¥çš„å·®é›†è¿ç®—å‘½ä»¤ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥é€šè¿‡ä»£ç é€»è¾‘ç»“åˆ ZREM å®ç°ã€‚</span></span><br><span class="line">ZINTERSTORE destkey numkeys key [key...] </span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3>
<p>Zset ç±»å‹ï¼ˆSorted Setï¼Œæœ‰åºé›†åˆï¼‰å¯ä»¥æ ¹æ®å…ƒç´ çš„æƒé‡æ¥æ’åºï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥å†³å®šæ¯ä¸ªå…ƒç´ çš„æƒé‡å€¼ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…ƒç´ æ’å…¥ Sorted Set çš„æ—¶é—´ç¡®å®šæƒé‡å€¼ï¼Œå…ˆæ’å…¥çš„å…ƒç´ æƒé‡å°ï¼Œåæ’å…¥çš„å…ƒç´ æƒé‡å¤§ã€‚</p>
<p>åœ¨é¢å¯¹éœ€è¦å±•ç¤ºæœ€æ–°åˆ—è¡¨ã€æ’è¡Œæ¦œç­‰åœºæ™¯æ—¶ï¼Œå¦‚æœæ•°æ®æ›´æ–°é¢‘ç¹æˆ–è€…éœ€è¦åˆ†é¡µæ˜¾ç¤ºï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Sorted Setã€‚</p>
<h4 id="æ’è¡Œæ¦œ">æ’è¡Œæ¦œ</h4>
<p>æœ‰åºé›†åˆæœ€ç»å…¸çš„åº”ç”¨éæ’è¡Œæ¦œè«å±äº†ï¼æ— è®ºæ˜¯çƒ­é—¨æ–‡ç« æ¦œã€æ¸¸æˆç©å®¶ç§¯åˆ†æ¦œã€å•†å“é”€é‡æ¦œï¼Œè¿˜æ˜¯å®æ—¶æ›´æ–°çš„åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼ŒZset éƒ½èƒ½è½»æ¾åº”å¯¹ã€‚</p>
<p>æˆ‘ä»¬ä»¥åšæ–‡ç‚¹èµæ’åä¸ºä¾‹ï¼Œå‡è®¾ç”¨æˆ·&quot;å°æ—&quot;å‘è¡¨äº†äº”ç¯‡åšæ–‡ï¼Œå®ƒä»¬çš„èµæ•°ï¼ˆscoreï¼‰å’Œæ–‡ç« IDï¼ˆmemberï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:1 æ–‡ç« è·å¾—äº†200ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 200 arcticle:1</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:2 æ–‡ç« è·å¾—äº†40ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 40 arcticle:2</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:3 æ–‡ç« è·å¾—äº†100ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 100 arcticle:3</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:4 æ–‡ç« è·å¾—äº†50ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 50 arcticle:4</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:5 æ–‡ç« è·å¾—äº†150ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 150 arcticle:5</span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ–‡ç«  <code>arcticle:4</code> æ–°å¢äº†ä¸€ä¸ªèµï¼Œå¯ä»¥ä½¿ç”¨ <code>ZINCRBY</code> å‘½ä»¤è½»æ¾æ›´æ–°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZINCRBY user:xiaolin:ranking 1 arcticle:4</span></span><br><span class="line">&quot;51&quot; # è¿”å›æ–°çš„åˆ†æ•°</span><br></pre></td></tr></table></figure>
<p>æƒ³æŸ¥çœ‹æŸç¯‡æ–‡ç« ï¼ˆæ¯”å¦‚ <code>arcticle:4</code>ï¼‰çš„å½“å‰èµæ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>ZSCORE</code> å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZSCORE user:xiaolin:ranking arcticle:4</span></span><br><span class="line">&quot;51&quot;</span><br></pre></td></tr></table></figure>
<p>è·å–å°æ—æ–‡ç« ä¸­èµæ•°æœ€é«˜çš„ 3 ç¯‡æ–‡ç« ï¼ˆé™åºæ’åï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>ZREVRANGE</code> å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">WITHSCORES è¡¨ç¤ºåŒæ—¶æ˜¾ç¤ºåˆ†æ•°</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZREVRANGE user:xiaolin:ranking 0 2 WITHSCORES</span></span><br><span class="line">1) &quot;arcticle:1&quot;</span><br><span class="line">2) &quot;200&quot;</span><br><span class="line">3) &quot;arcticle:5&quot;</span><br><span class="line">4) &quot;150&quot;</span><br><span class="line">5) &quot;arcticle:3&quot;</span><br><span class="line">6) &quot;100&quot;</span><br></pre></td></tr></table></figure>
<p>è·å–å°æ—æ–‡ç« ä¸­èµæ•°åœ¨ 100 åˆ° 200 ä¹‹é—´çš„æ–‡ç« ï¼ˆå‡åºæ’åˆ—ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>ZRANGEBYSCORE</code> å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZRANGEBYSCORE user:xiaolin:ranking 100 200 WITHSCORES</span></span><br><span class="line">1) &quot;arcticle:3&quot;</span><br><span class="line">2) &quot;100&quot;</span><br><span class="line">3) &quot;arcticle:5&quot;</span><br><span class="line">4) &quot;150&quot;</span><br><span class="line">5) &quot;arcticle:1&quot;</span><br><span class="line">6) &quot;200&quot;</span><br></pre></td></tr></table></figure>
<h4 id="ç”µè¯ã€å§“åæ’åº-æŒ‰å­—å…¸åº">ç”µè¯ã€å§“åæ’åº (æŒ‰å­—å…¸åº)</h4>
<p>é™¤äº†æŒ‰æ•°å€¼åˆ†æ•°æ’åºï¼ŒZset è¿˜èƒ½åœ¨æ‰€æœ‰å…ƒç´ åˆ†æ•°éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§å…ƒç´ çš„å­—å…¸é¡ºåºï¼ˆæ¯”å¦‚å­—æ¯é¡ºåºã€æ•°å­—é¡ºåºï¼‰è¿›è¡Œæ’åºå’ŒèŒƒå›´æŸ¥æ‰¾ã€‚è¿™å°±è¦ç”¨åˆ° <code>ZRANGEBYLEX</code> (æ­£åº) æˆ– <code>ZREVRANGEBYLEX</code> (é€†åº) è¿™æ ·çš„å‘½ä»¤äº†ã€‚</p>
<p><strong>é‡è¦å‰æï¼šä½¿ç”¨ <code>ZRANGEBYLEX</code> æˆ– <code>ZREVRANGEBYLEX</code> æ—¶ï¼Œç›®æ ‡ Zset ä¸­çš„æ‰€æœ‰å…ƒç´ åˆ†æ•° <em>å¿…é¡»</em> ç›¸åŒï¼Œå¦åˆ™ç»“æœå¯èƒ½ä¸ç¬¦åˆé¢„æœŸï¼</strong> é€šå¸¸æˆ‘ä»¬ä¼šå°†è¿™äº›å…ƒç´ çš„åˆ†æ•°ç»Ÿä¸€è®¾ç½®ä¸º <code>0</code>ã€‚</p>
<p><em>1ã€ç”µè¯æ’åº</em></p>
<p>æˆ‘ä»¬å¯ä»¥å°†ç”µè¯å·ç ä½œä¸º member å­˜å…¥ Zsetï¼Œå¹¶å°†å®ƒä»¬çš„åˆ†æ•°éƒ½è®¾ä¸º 0ï¼Œç„¶åæ ¹æ®éœ€è¦æ¥è·å–å·æ®µï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD phone 0 13100111100 0 13110114300 0 13132110901</span> </span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD phone 0 13200111100 0 13210414300 0 13252110901</span> </span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD phone 0 13300111100 0 13310414300 0 13352110901</span> </span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure>
<p>è·å–æ‰€æœ‰å·ç ï¼ˆæŒ‰å­—å…¸åºå‡åºï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&#x27;-&#x27;</span> å’Œ <span class="string">&#x27;+&#x27;</span> è¡¨ç¤ºæ— ç©·å°çš„å­—å…¸åºå’Œæ— ç©·å¤§çš„å­—å…¸åº</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZRANGEBYLEX phone - +</span></span><br><span class="line">1) &quot;13100111100&quot;</span><br><span class="line">2) &quot;13110114300&quot;</span><br><span class="line">3) &quot;13132110901&quot;</span><br><span class="line">4) &quot;13200111100&quot;</span><br><span class="line">5) &quot;13210414300&quot;</span><br><span class="line">6) &quot;13252110901&quot;</span><br><span class="line">7) &quot;13300111100&quot;</span><br><span class="line">8) &quot;13310414300&quot;</span><br><span class="line">9) &quot;13352110901&quot;</span><br></pre></td></tr></table></figure>
<p>è·å– 132 å·æ®µçš„å·ç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&#x27;[132&#x27;</span> è¡¨ç¤ºå¤§äºç­‰äº <span class="string">&#x27;132&#x27;</span> çš„å­—å…¸åº</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&#x27;(133&#x27;</span> è¡¨ç¤ºå°äº <span class="string">&#x27;133&#x27;</span> çš„å­—å…¸åº</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZRANGEBYLEX phone [132 (133</span></span><br><span class="line">1) &quot;13200111100&quot;</span><br><span class="line">2) &quot;13210414300&quot;</span><br><span class="line">3) &quot;13252110901&quot;</span><br></pre></td></tr></table></figure>
<p>è·å– 132ã€133 å·æ®µçš„å·ç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZRANGEBYLEX phone [132 (134</span></span><br><span class="line">1) &quot;13200111100&quot;</span><br><span class="line">2) &quot;13210414300&quot;</span><br><span class="line">3) &quot;13252110901&quot;</span><br><span class="line">4) &quot;13300111100&quot;</span><br><span class="line">5) &quot;13310414300&quot;</span><br><span class="line">6) &quot;13352110901&quot;</span><br></pre></td></tr></table></figure>
<p><em>2ã€å§“åæ’åº</em></p>
<p>åŒæ ·ï¼Œå°†å§“åä½œä¸º member å­˜å…¥ Zsetï¼Œåˆ†æ•°ç»Ÿä¸€è®¾ä¸º 0ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">zadd names 0 Toumas 0 Jake 0 Bluetuo 0 Gaodeng 0 Aimini 0 Aidehua</span> </span><br><span class="line">(integer) 6</span><br></pre></td></tr></table></figure>
<p>è·å–æ‰€æœ‰äººçš„åå­—ï¼ˆæŒ‰å­—å…¸åºå‡åºï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZRANGEBYLEX names - +</span></span><br><span class="line">1) &quot;Aidehua&quot;</span><br><span class="line">2) &quot;Aimini&quot;</span><br><span class="line">3) &quot;Bluetuo&quot;</span><br><span class="line">4) &quot;Gaodeng&quot;</span><br><span class="line">5) &quot;Jake&quot;</span><br><span class="line">6) &quot;Toumas&quot;</span><br></pre></td></tr></table></figure>
<p>è·å–åå­—ä¸­å¤§å†™å­—æ¯ A å¼€å¤´çš„æ‰€æœ‰äººï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&#x27;[A&#x27;</span> è¡¨ç¤ºä»¥ A å¼€å¤´ï¼ˆåŒ…å«Aï¼‰</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&#x27;(B&#x27;</span> è¡¨ç¤ºå°äº B ï¼ˆä¸åŒ…å«Bï¼‰</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZRANGEBYLEX names [A (B</span></span><br><span class="line">1) &quot;Aidehua&quot;</span><br><span class="line">2) &quot;Aimini&quot;</span><br></pre></td></tr></table></figure>
<p>è·å–åå­—ä¸­å¤§å†™å­—æ¯ C åˆ° Z çš„æ‰€æœ‰äººï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&#x27;[C&#x27;</span> è¡¨ç¤ºä»¥ C å¼€å¤´ï¼ˆåŒ…å«Cï¼‰</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&#x27;[Z&#x27;</span> è¡¨ç¤ºä»¥ Z å¼€å¤´ï¼Œç”±äº ZRANGEBYLEX æ˜¯å‰ç¼€åŒ¹é…ï¼Œä¸ºäº†åŒ…å«æ‰€æœ‰ä»¥Zå¼€å¤´çš„ï¼Œå¯ä»¥ç”¨ <span class="string">&#x27;[Zz&#x27;</span> æˆ–è€…æ›´é€šç”¨çš„æ–¹å¼ç¡®ä¿èƒ½å–åˆ°ä»¥Zç»“å°¾çš„ï¼Œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½†è¿™é‡Œå¦‚æœåªæ˜¯æƒ³å–åˆ°Zå¼€å¤´çš„ï¼Œå¯ä»¥è€ƒè™‘ç”¨ä¸€ä¸ªæ¯”Zå¤§çš„å­—ç¬¦çš„ä¸Šç•Œï¼Œæˆ–è€…åˆ†æ®µæŸ¥è¯¢ã€‚æ›´ç®€å•çš„æ˜¯ç¡®ä¿æœ€åä¸€ä¸ªå­—æ¯æ˜¯Zçš„æœ€å¤§å¯èƒ½å€¼ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€ä¸ªæ›´ç²¾ç¡®çš„åšæ³•æ˜¯å¦‚æœæƒ³åŒ…å«æ‰€æœ‰Zå¼€å¤´çš„ï¼Œå¯ä»¥ç”¨ [Z (Za (å‡è®¾æ²¡æœ‰Zaå¼€å¤´çš„)ï¼Œä½†è¿™å–å†³äºå…·ä½“åœºæ™¯ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡ŒåŸç¤ºä¾‹çš„ [Z æ„å›¾æ˜¯Cåˆ°Zï¼Œä½†å…¶åŒ¹é…è¡Œä¸ºæ˜¯<span class="string">&quot;ä»¥Cå¼€å¤´&quot;</span>åˆ°<span class="string">&quot;ä»¥Zå¼€å¤´&quot;</span>ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœè¦åŒ…å«æ‰€æœ‰ä»¥ Z ç»“å°¾çš„ï¼Œåˆ™éœ€è¦æ›´å¤æ‚çš„æ¨¡å¼æˆ–å¤šæ¬¡æŸ¥è¯¢ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œä¿æŒåŸæ„ï¼Œè·å–å­—æ¯ C åˆ° Z å¼€å¤´çš„åå­—</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZRANGEBYLEX names [C [Zz</span></span><br><span class="line">1) &quot;Gaodeng&quot;</span><br><span class="line">2) &quot;Jake&quot;</span><br><span class="line">3) &quot;Toumas&quot;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æ€»ç»“æ¥è¯´ï¼ŒRedis Zset (æœ‰åºé›†åˆ) ä»¥å…¶ç‹¬ç‰¹çš„&quot;å…ƒç´ å”¯ä¸€ã€è‡ªå¸¦æ’åº&quot;ç‰¹æ€§ï¼Œåœ¨éœ€è¦åŠ¨æ€æ’åºã€èŒƒå›´æŸ¥æ‰¾ä»¥åŠæ„å»ºå„ç±»æ’è¡Œæ¦œçš„åœºæ™¯ä¸­å±•ç°å‡ºå¼ºå¤§çš„å¨åŠ›ã€‚é€šè¿‡çµæ´»è¿ç”¨ <code>ZADD</code>, <code>ZRANGE</code>, <code>ZREVRANGE</code>, <code>ZRANGEBYSCORE</code> ç­‰å‘½ä»¤ï¼Œä½ å¯ä»¥é«˜æ•ˆåœ°å¤„ç†å„ç§æœ‰åºæ•°æ®éœ€æ±‚ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç±»å‹</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>æ•°æ®ç±»å‹</tag>
        <tag>Zset</tag>
        <tag>Sorted Set</tag>
        <tag>æœ‰åºé›†åˆ</tag>
        <tag>æ’è¡Œæ¦œ</tag>
        <tag>è·³è¡¨</tag>
        <tag>å‹ç¼©åˆ—è¡¨</tag>
        <tag>listpack</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç±»å‹ï¼šSet é›†åˆè¯¦è§£ä¸å¦™ç”¨</title>
    <url>/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Set/</url>
    <content><![CDATA[<h2 id="Set">Set</h2>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨ç»„ç»‡ä¸€åœºçƒ­é—¨æ´»åŠ¨ï¼Œéœ€è¦ç»Ÿè®¡æ‰€æœ‰æŠ¥åç”¨æˆ·çš„IDï¼Œå¹¶ç¡®ä¿æ¯ä¸ªç”¨æˆ·IDåªè®°å½•ä¸€æ¬¡ï¼Œä¸èƒ½é‡å¤ã€‚æˆ–è€…ï¼Œä½ æƒ³çŸ¥é“ä¸¤ä¸ªä¸åŒå…´è¶£å°ç»„æœ‰å“ªäº›å…±åŒçš„æˆå‘˜ã€‚è¿™æ—¶ï¼ŒRedis çš„ Set æ•°æ®ç»“æ„å°±èƒ½å¤§æ˜¾èº«èº«æ‰‹äº†ï¼Set æ˜¯ä¸€ä¸ªæ— åºä¸”å”¯ä¸€çš„é”®å€¼é›†åˆï¼Œå°±åƒæ•°å­¦ä¸­çš„é›†åˆæ¦‚å¿µä¸€æ ·ï¼Œéå¸¸é€‚åˆå¤„ç†è¿™ç±»å»é‡å’Œå…³ç³»è¿ç®—çš„åœºæ™¯ã€‚</p>
<p>ä¸€ä¸ªé›†åˆæœ€å¤šå¯ä»¥å­˜å‚¨ <code>2^32-1</code> ä¸ªå…ƒç´ ã€‚æ¦‚å¿µå’Œæ•°å­¦ä¸­ä¸ªçš„é›†åˆåŸºæœ¬ç±»ä¼¼ï¼Œå¯ä»¥äº¤é›†ï¼Œå¹¶é›†ï¼Œå·®é›†ç­‰ç­‰ï¼Œæ‰€ä»¥ Set ç±»å‹é™¤äº†æ”¯æŒé›†åˆå†…çš„å¢åˆ æ”¹æŸ¥ï¼ŒåŒæ—¶è¿˜æ”¯æŒå¤šä¸ªé›†åˆå–äº¤é›†ã€å¹¶é›†ã€å·®é›†ã€‚</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Set/1746889590085.png" alt="1746889590085"></p>
<p>Set ç±»å‹å’Œ List ç±»å‹çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>List å¯ä»¥å­˜å‚¨é‡å¤å…ƒç´ ï¼ŒSet åªèƒ½å­˜å‚¨éé‡å¤å…ƒç´ ï¼ˆæ ¸å¿ƒç‰¹æ€§ï¼ï¼‰ã€‚</li>
<li>List æ˜¯æŒ‰ç…§å…ƒç´ çš„å…ˆåé¡ºåºå­˜å‚¨å…ƒç´ çš„ï¼Œè€Œ Set åˆ™æ˜¯æ— åºæ–¹å¼å­˜å‚¨å…ƒç´ çš„ï¼ˆæ’å…¥é¡ºåºä¸é‡è¦ï¼‰ã€‚</li>
</ul>
<h3 id="å†…éƒ¨å®ç°">å†…éƒ¨å®ç°</h3>
<p>Set çœ‹ä¼¼ç®€å•ï¼Œä½† Redis åœ¨èƒŒåä¸ºå®ƒåšäº†ç²¾å¿ƒè®¾è®¡ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœä½ çš„ Set é‡Œå­˜æ”¾çš„éƒ½æ˜¯æ•´æ•°ï¼Œå¹¶ä¸”æ•°é‡ä¸å¤šï¼ˆé»˜è®¤512ä¸ªä»¥å†…ï¼Œè¿™ä¸ªå€¼å¯ä»¥é€šè¿‡ <code>set-maxintset-entries</code> é…ç½®è°ƒæ•´ï¼‰ï¼ŒRedis ä¼šé€‰æ‹©ä¸€ç§å«åš<strong>æ•´æ•°é›†åˆ (intset)</strong> çš„å†…å­˜ä¼˜åŒ–æ–¹å¼æ¥å­˜å‚¨å®ƒä»¬ï¼Œè¿™æ ·æ›´èŠ‚çœç©ºé—´ã€‚</p>
<p>å¦‚æœ Set é‡Œçš„å…ƒç´ ä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼ˆæ¯”å¦‚åŒ…å«å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ•°é‡è¶…è¿‡äº†é™åˆ¶ï¼‰ï¼ŒRedis å°±ä¼šä½¿ç”¨æ›´é€šç”¨çš„<strong>å“ˆå¸Œè¡¨ (hashtable)</strong> æ¥å­˜å‚¨ã€‚ä½ ä¸éœ€è¦å…³å¿ƒå…·ä½“ç”¨å“ªç§ï¼ŒRedis ä¼šè‡ªåŠ¨å¸®ä½ æå®šï¼Œç¡®ä¿é«˜æ•ˆè¿è¡Œã€‚</p>
<h3 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h3>
<p>æŒæ¡ Set çš„å¸¸ç”¨å‘½ä»¤ï¼Œæ˜¯å‘æŒ¥å…¶å¨åŠ›çš„å…³é”®ã€‚ä¸‹é¢æ˜¯ä¸€äº›æ ¸å¿ƒæ“ä½œï¼š</p>
<h4 id="åŸºç¡€æ“ä½œ">åŸºç¡€æ“ä½œ</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SADD key member [member ...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šå‘åä¸º key çš„é›†åˆé‡Œæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ª memberã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœ member å·²ç»å­˜åœ¨ï¼Œå°±å¿½ç•¥å®ƒï¼Œç¡®ä¿å”¯ä¸€æ€§ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœ key è¿™ä¸ªé›†åˆä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSADD myset <span class="string">&quot;hello&quot;</span> <span class="string">&quot;world&quot;</span></span></span><br><span class="line">SADD key member [member ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SREM key member [member ...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šä»åä¸º key çš„é›†åˆä¸­åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„ memberã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSREM myset <span class="string">&quot;world&quot;</span></span></span><br><span class="line">SREM key member [member ...] </span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥è¯¢ä¸åˆ¤æ–­">æŸ¥è¯¢ä¸åˆ¤æ–­</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SMEMBERS key</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè·å–åä¸º key çš„é›†åˆä¸­æ‰€æœ‰å…ƒç´ ã€‚æ³¨æ„ï¼Œå› ä¸º Set æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥å…ƒç´ çš„é¡ºåºæ˜¯éšæœºçš„ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSMEMBERS myset</span></span><br><span class="line">SMEMBERS key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SCARD key</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè·å–åä¸º key çš„é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ï¼ˆCardinalityï¼‰ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSCARD myset</span></span><br><span class="line">SCARD key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SISMEMBER key member</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šåˆ¤æ–­ member å…ƒç´ æ˜¯å¦å­˜åœ¨äºåä¸º key çš„é›†åˆä¸­ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­˜åœ¨è¿”å› 1ï¼Œä¸å­˜åœ¨æˆ–è€… key æœ¬èº«ä¸å­˜åœ¨åˆ™è¿”å› 0ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSISMEMBER myset <span class="string">&quot;hello&quot;</span></span></span><br><span class="line">SISMEMBER key member</span><br></pre></td></tr></table></figure>
<h4 id="éšæœºæ“ä½œ">éšæœºæ“ä½œ</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SRANDMEMBER key [count]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šä»åä¸º key çš„é›†åˆä¸­éšæœºé€‰å‡º count ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœ count æ˜¯æ­£æ•°ï¼Œè¿”å›çš„å…ƒç´ ä¸ä¼šé‡å¤ï¼›å¦‚æœ count æ˜¯è´Ÿæ•°ï¼Œåˆ™å¯èƒ½è¿”å›é‡å¤å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡è¦ï¼šè¿™ä¸ªæ“ä½œåªæ˜¯<span class="string">&quot;æŸ¥çœ‹&quot;</span>ï¼Œå¹¶ä¸ä¼šä»é›†åˆä¸­åˆ é™¤å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼ˆä¸é‡å¤ï¼‰ï¼šSRANDMEMBER myset 2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼ˆå¯èƒ½é‡å¤ï¼‰ï¼šSRANDMEMBER myset -3</span></span><br><span class="line">SRANDMEMBER key [count]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SPOP key [count]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šä»åä¸º key çš„é›†åˆä¸­éšæœºç§»é™¤å¹¶è¿”å› count ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸ªæ“ä½œæ˜¯<span class="string">&quot;å–å‡ºå¹¶åˆ é™¤&quot;</span>ï¼Œä¼šä¿®æ”¹é›†åˆå†…å®¹ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSPOP myset 1</span></span><br><span class="line">SPOP key [count]</span><br></pre></td></tr></table></figure>
<h4 id="é›†åˆè¿ç®—-å¹¶é›†ã€äº¤é›†ã€å·®é›†">é›†åˆè¿ç®— (å¹¶é›†ã€äº¤é›†ã€å·®é›†)</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SINTER key [key ...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè®¡ç®—æ‰€æœ‰ç»™å®š key é›†åˆçš„äº¤é›†ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¾‹å¦‚ï¼Œæ‰¾å‡ºåŒæ—¶å­˜åœ¨äº set1 å’Œ set2 ä¸­çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSINTER set1 set2</span></span><br><span class="line">SINTER key [key ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SINTERSTORE destination key [key ...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè®¡ç®—æ‰€æœ‰ç»™å®š key é›†åˆçš„äº¤é›†ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°åä¸º destination çš„æ–°é›†åˆä¸­ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSINTERSTORE resultset set1 set2</span></span><br><span class="line">SINTERSTORE destination key [key ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SUNION key [key ...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè®¡ç®—æ‰€æœ‰ç»™å®š key é›†åˆçš„å¹¶é›†ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¾‹å¦‚ï¼Œåˆå¹¶ set1 å’Œ set2 ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆé‡å¤çš„åªä¿ç•™ä¸€ä¸ªï¼‰ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSUNION set1 set2</span></span><br><span class="line">SUNION key [key ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SUNIONSTORE destination key [key ...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè®¡ç®—æ‰€æœ‰ç»™å®š key é›†åˆçš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°åä¸º destination çš„æ–°é›†åˆä¸­ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSUNIONSTORE resultset set1 set2</span></span><br><span class="line">SUNIONSTORE destination key [key ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SDIFF key [key ...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè®¡ç®—ç¬¬ä¸€ä¸ª key é›†åˆä¸åç»­æ‰€æœ‰ key é›†åˆçš„å·®é›†ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¾‹å¦‚ï¼Œæ‰¾å‡ºå­˜åœ¨äº set1 ä¸­ï¼Œä½†ä¸å­˜åœ¨äº set2 å’Œ set3 ä¸­çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSDIFF set1 set2 set3</span></span><br><span class="line">SDIFF key [key ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SDIFFSTORE destination key [key ...]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£é‡Šï¼šè®¡ç®—ç¬¬ä¸€ä¸ª key é›†åˆä¸åç»­æ‰€æœ‰ key é›†åˆçš„å·®é›†ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°åä¸º destination çš„æ–°é›†åˆä¸­ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ï¼šSDIFFSTORE resultset set1 set2</span></span><br><span class="line">SDIFFSTORE destination key [key ...]</span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3>
<p>é›†åˆçš„å‡ å¤§ç‰¹æ€§â€”â€”æ— åºã€å”¯ä¸€ã€æ”¯æŒå¹¶äº¤å·®è¿ç®—â€”â€”ä½¿å¾—å®ƒåœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½éå¸¸æœ‰ç”¨ã€‚</p>
<p>å› æ­¤ Set ç±»å‹æ¯”è¾ƒé€‚åˆç”¨æ¥æ•°æ®å»é‡å’Œä¿éšœæ•°æ®çš„å”¯ä¸€æ€§ï¼Œè¿˜å¯ä»¥ç”¨æ¥ç»Ÿè®¡å¤šä¸ªé›†åˆçš„äº¤é›†ã€å·®é›†å’Œå¹¶é›†ç­‰ã€‚å½“æˆ‘ä»¬å­˜å‚¨çš„æ•°æ®æ˜¯æ— åºå¹¶ä¸”éœ€è¦å»é‡çš„æƒ…å†µä¸‹ï¼Œæ¯”è¾ƒé€‚åˆä½¿ç”¨é›†åˆç±»å‹è¿›è¡Œå­˜å‚¨ã€‚</p>
<p>ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸ªå°æé†’ï¼šå½“ä½ çš„ Set é‡Œæœ‰æˆåƒä¸Šä¸‡ç”šè‡³æ•°ç™¾ä¸‡ä¸ªå…ƒç´ æ—¶ï¼Œç›´æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€å¹¶é›†æˆ–å·®é›†å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œç”šè‡³å¯èƒ½è®© Redis çŸ­æš‚&quot;å¡é¡¿&quot;ä¸€ä¸‹ã€‚å¦‚æœä½ çš„æ•°æ®é‡éå¸¸å¤§ï¼Œå¯ä»¥è€ƒè™‘åœ¨ä»æ•°æ®åº“ï¼ˆå¦‚æœè®¾ç½®äº†ä¸»ä»å¤åˆ¶ï¼‰ä¸Šè¿›è¡Œè¿™äº›è¿ç®—ï¼Œæˆ–è€…æŠŠæ•°æ®å–åˆ°ä½ çš„åº”ç”¨ç¨‹åºé‡Œå†è®¡ç®—ï¼Œé¿å…ç»™ä¸»æ•°æ®åº“å¸¦æ¥å‹åŠ›ã€‚</p>
<h4 id="åˆ©ç”¨-Set-å…ƒç´ çš„å”¯ä¸€æ€§ï¼Œè½»æ¾å®ç°-ä¸€äººä¸€èµ-ï¼š">åˆ©ç”¨ Set å…ƒç´ çš„å”¯ä¸€æ€§ï¼Œè½»æ¾å®ç°&quot;ä¸€äººä¸€èµ&quot;ï¼š</h4>
<p>Set ç±»å‹å¯ä»¥ä¿è¯ä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹ä¸€ä¸ªèµã€‚å‡è®¾æˆ‘ä»¬ç”¨æ–‡ç«  ID ä½œä¸º keyï¼Œç‚¹èµç”¨æˆ·çš„ ID ä½œä¸º valueã€‚</p>
<p><code>uid:1</code> ã€<code>uid:2</code>ã€<code>uid:3</code> ä¸‰ä¸ªç”¨æˆ·åˆ†åˆ«å¯¹ <code>article:1</code> è¿™ç¯‡æ–‡ç« ç‚¹èµäº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:1 ç”¨æˆ·å¯¹æ–‡ç«  article:1 ç‚¹èµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD article:1 uid:1</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:2 ç”¨æˆ·å¯¹æ–‡ç«  article:1 ç‚¹èµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD article:1 uid:2</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:3 ç”¨æˆ·å¯¹æ–‡ç«  article:1 ç‚¹èµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD article:1 uid:3</span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ <code>uid:1</code> ç”¨æˆ·æƒ³å–æ¶ˆç‚¹èµï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SREM article:1 uid:1</span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<p>æƒ³çœ‹çœ‹ <code>article:1</code> è¿™ç¯‡æ–‡ç« éƒ½æœ‰è°ç‚¹èµäº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SMEMBERS article:1</span></span><br><span class="line">1) &quot;uid:3&quot;</span><br><span class="line">2) &quot;uid:2&quot;</span><br></pre></td></tr></table></figure>
<p>æƒ³çŸ¥é“ <code>article:1</code> è¿™ç¯‡æ–‡ç« æœ‰å¤šå°‘ä¸ªèµï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SCARD article:1</span></span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>
<p>åˆ¤æ–­ç”¨æˆ· <code>uid:1</code> æ˜¯å¦å¯¹æ–‡ç«  <code>article:1</code> ç‚¹è¿‡èµï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SISMEMBER article:1 uid:1</span></span><br><span class="line">(integer) 0  # è¿”å› 0 è¯´æ˜æ²¡ç‚¹èµï¼Œè¿”å› 1 åˆ™è¯´æ˜ç‚¹èµäº†</span><br></pre></td></tr></table></figure>
<h4 id="åˆ©ç”¨-Set-çš„äº¤é›†è¿ç®—ï¼Œå‘ç°-æˆ‘ä»¬å…±åŒçš„çˆ±å¥½-ï¼š">åˆ©ç”¨ Set çš„äº¤é›†è¿ç®—ï¼Œå‘ç°&quot;æˆ‘ä»¬å…±åŒçš„çˆ±å¥½&quot;ï¼š</h4>
<p>Set ç±»å‹æ”¯æŒäº¤é›†è¿ç®—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥è®¡ç®—å…±åŒå…³æ³¨çš„å¥½å‹ã€å…±åŒå–œæ¬¢çš„å•†å“ã€å…±åŒè®¢é˜…çš„å…¬ä¼—å·ç­‰ã€‚</p>
<p>å‡è®¾ key æ˜¯ç”¨æˆ· IDï¼Œvalue åˆ™æ˜¯è¯¥ç”¨æˆ·å…³æ³¨çš„å…¬ä¼—å· IDã€‚</p>
<p>ç”¨æˆ· <code>uid:1</code> å…³æ³¨äº†å…¬ä¼—å· <code>id:5, id:6, id:7, id:8, id:9</code>ã€‚<br>
ç”¨æˆ· <code>uid:2</code> å…³æ³¨äº†å…¬ä¼—å· <code>id:7, id:8, id:9, id:10, id:11</code>ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:1 ç”¨æˆ·å…³æ³¨å…¬ä¼—å·</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD uid:1 5 6 7 8 9</span></span><br><span class="line">(integer) 5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:2  ç”¨æˆ·å…³æ³¨å…¬ä¼—å·</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD uid:2 7 8 9 10 11</span></span><br><span class="line">(integer) 5</span><br></pre></td></tr></table></figure>
<p>æƒ³çŸ¥é“ <code>uid:1</code> å’Œ <code>uid:2</code> å…±åŒå…³æ³¨äº†å“ªäº›å…¬ä¼—å·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å…±åŒå…³æ³¨</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SINTER uid:1 uid:2</span></span><br><span class="line">1) &quot;7&quot;</span><br><span class="line">2) &quot;8&quot;</span><br><span class="line">3) &quot;9&quot;</span><br></pre></td></tr></table></figure>
<p>æƒ³ç»™ <code>uid:2</code> æ¨èä¸€äº› <code>uid:1</code> å…³æ³¨è¿‡ä½† <code>uid:2</code> è¿˜æ²¡å…³æ³¨çš„å…¬ä¼—å·ï¼ˆå·®é›†è¿ç®—ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SDIFF uid:1 uid:2</span></span><br><span class="line">1) &quot;5&quot;</span><br><span class="line">2) &quot;6&quot;</span><br></pre></td></tr></table></figure>
<p>éªŒè¯æŸä¸ªå…¬ä¼—å·ï¼ˆæ¯”å¦‚ <code>id:5</code>ï¼‰æ˜¯å¦åŒæ—¶è¢« <code>uid:1</code> æˆ– <code>uid:2</code> å…³æ³¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SISMEMBER uid:1 5</span></span><br><span class="line">(integer) 1 # è¿”å›1ï¼Œè¯´æ˜ uid:1 å…³æ³¨äº†</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SISMEMBER uid:2 5</span></span><br><span class="line">(integer) 0 # è¿”å›0ï¼Œè¯´æ˜ uid:2 æ²¡å…³æ³¨</span><br></pre></td></tr></table></figure>
<h4 id="åˆ©ç”¨-Set-çš„å»é‡å’Œéšæœºå¼¹å‡ºç‰¹æ€§ï¼Œæ‰“é€ å…¬å¹³çš„-æŠ½å¥–æ± -ï¼š">åˆ©ç”¨ Set çš„å»é‡å’Œéšæœºå¼¹å‡ºç‰¹æ€§ï¼Œæ‰“é€ å…¬å¹³çš„&quot;æŠ½å¥–æ± &quot;ï¼š</h4>
<p>åœ¨æŠ½å¥–æ´»åŠ¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨æ‰€æœ‰å‚ä¸æŠ½å¥–çš„ç”¨æˆ·ï¼Œå¹¶ç¡®ä¿æ¯ä¸ªç”¨æˆ·åªè¢«è®°å½•ä¸€æ¬¡ã€‚Set çš„å»é‡åŠŸèƒ½å®Œç¾å¥‘åˆè¿™ä¸ªéœ€æ±‚ã€‚å½“å¼€å¥–æ—¶ï¼Œæˆ‘ä»¬åˆéœ€è¦ä»å‚ä¸è€…ä¸­éšæœºæŠ½å–å¹¸è¿å„¿ã€‚</p>
<p>å‡è®¾ key ä¸ºæŠ½å¥–æ´»åŠ¨å <code>lucky_draw_event</code>ï¼Œvalue ä¸ºå‚ä¸æŠ½å¥–çš„å‘˜å·¥å§“åã€‚å…ˆæŠŠæ‰€æœ‰å‘˜å·¥éƒ½åŠ å…¥æŠ½å¥–æ± ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD lucky_draw_event Tom Jerry John Sean Marry Lindy Sary Mark</span></span><br><span class="line">(integer) 8 # å‡è®¾æœ‰8åå‘˜å·¥å‚ä¸</span><br></pre></td></tr></table></figure>
<p><strong>å¦‚æœå…è®¸é‡å¤ä¸­å¥–ï¼ˆæ¯”å¦‚é˜³å…‰æ™®ç…§å¥–ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥æ˜¯å€™é€‰äººï¼ŒæŠ½å¤šæ¬¡ï¼‰</strong>ï¼š<br>
å¯ä»¥ä½¿ç”¨ <code>SRANDMEMBER</code> å‘½ä»¤ï¼Œå®ƒåªæ˜¯éšæœº&quot;çœ‹ä¸€çœ‹&quot;æœ‰å“ªäº›äººï¼Œå¹¶ä¸ä¼šæŠŠäººä»æŠ½å¥–æ± é‡Œæ‹¿èµ°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éšæœºæŠ½å– 1 ä¸ªä¸€ç­‰å¥–å€™é€‰äººï¼ˆä¸ä»æ± ä¸­ç§»é™¤ï¼‰ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SRANDMEMBER lucky_draw_event 1</span></span><br><span class="line">1) &quot;Tom&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éšæœºæŠ½å– 2 ä¸ªäºŒç­‰å¥–å€™é€‰äººï¼ˆä¸ä»æ± ä¸­ç§»é™¤ï¼‰ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SRANDMEMBER lucky_draw_event 2</span></span><br><span class="line">1) &quot;Mark&quot;</span><br><span class="line">2) &quot;Jerry&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éšæœºæŠ½å– 3 ä¸ªä¸‰ç­‰å¥–å€™é€‰äººï¼ˆä¸ä»æ± ä¸­ç§»é™¤ï¼‰ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SRANDMEMBER lucky_draw_event 3</span></span><br><span class="line">1) &quot;Sary&quot;</span><br><span class="line">2) &quot;Tom&quot;</span><br><span class="line">3) &quot;Jerry&quot;</span><br></pre></td></tr></table></figure>
<p><strong>å¦‚æœä¸å…è®¸é‡å¤ä¸­å¥–ï¼ˆæ¯”å¦‚ä¸€ã€äºŒã€ä¸‰ç­‰å¥–ï¼Œä¸­è¿‡å°±ä¸èƒ½å†ä¸­äº†ï¼‰</strong>ï¼š<br>
å¯ä»¥ä½¿ç”¨ <code>SPOP</code> å‘½ä»¤ï¼Œå®ƒä¼šéšæœº&quot;æ‹¿èµ°&quot;ä¸€ä¸ªæˆ–å¤šä¸ªä¸­å¥–è€…ï¼Œç¡®ä¿ä»–ä»¬ä¸ä¼šå†æ¬¡ä¸­å¥–ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å–ä¸€ç­‰å¥–1åï¼ˆä»æ± ä¸­ç§»é™¤ï¼‰ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SPOP lucky_draw_event 1</span></span><br><span class="line">1) &quot;Sary&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ­¤æ—¶ Sary å·²ç»ä¸åœ¨æŠ½å¥–æ± é‡Œäº†</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å–äºŒç­‰å¥–2åï¼ˆä»æ± ä¸­ç§»é™¤ï¼‰ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SPOP lucky_draw_event 2</span></span><br><span class="line">1) &quot;Jerry&quot;</span><br><span class="line">2) &quot;Mark&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Jerry å’Œ Mark ä¹Ÿè¢«ç§»é™¤äº†</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å–ä¸‰ç­‰å¥–3åï¼ˆä»æ± ä¸­ç§»é™¤ï¼‰ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SPOP lucky_draw_event 3</span></span><br><span class="line">1) &quot;John&quot;</span><br><span class="line">2) &quot;Sean&quot;</span><br><span class="line">3) &quot;Lindy&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¥–é¡¹æŠ½å–å®Œæ¯•ï¼</span></span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æ€»è€Œè¨€ä¹‹ï¼ŒRedis çš„ Set ç±»å‹å‡­å€Ÿå…¶æ— åºã€å”¯ä¸€ä»¥åŠä¸°å¯Œçš„é›†åˆè¿ç®—èƒ½åŠ›ï¼Œåœ¨éœ€è¦æ•°æ®å»é‡ã€å…³ç³»æŸ¥æ‰¾ã€ä»¥åŠä¸€äº›ç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚ç‚¹èµã€å…±åŒå…³æ³¨ã€æŠ½å¥–ï¼‰ä¸‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªç®€æ´é«˜æ•ˆçš„é€‰æ‹©ã€‚ç†è§£äº†å®ƒçš„ç‰¹æ€§å’Œé€‚ç”¨åœºæ™¯ï¼Œä½ å°±èƒ½åœ¨å¼€å‘ä¸­æ›´å¥½åœ°åˆ©ç”¨å®ƒæ¥è§£å†³å®é™…é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç±»å‹</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>æ•°æ®ç±»å‹</tag>
        <tag>Set</tag>
        <tag>é›†åˆ</tag>
        <tag>å»é‡</tag>
        <tag>æŠ½å¥–</tag>
        <tag>ç‚¹èµ</tag>
        <tag>å…±åŒå…³æ³¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç±»å‹ï¼šHashè¯¦è§£</title>
    <url>/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Hash/</url>
    <content><![CDATA[<h2 id="ä¸€ã€Hash-ç±»å‹ç®€ä»‹">ä¸€ã€Hash ç±»å‹ç®€ä»‹</h2>
<p>Redis ä¸­çš„ Hash ç±»å‹æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆkey-value pairï¼‰é›†åˆï¼Œå…¶ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒçš„å€¼ï¼ˆvalueï¼‰æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆï¼Œå½¢å¼å¦‚ï¼š<code>value=[&#123;field1, value1&#125;, &#123;field2, value2&#125;, ..., &#123;fieldN, valueN&#125;]</code>ã€‚è¿™ç§ç»“æ„ä½¿å¾— Hash ç±»å‹éå¸¸é€‚åˆç”¨æ¥å­˜å‚¨å¯¹è±¡åŠå…¶å±æ€§ã€‚</p>
<p>ä¸ç›´æ¥å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²åå­˜å…¥ String ç±»å‹ç›¸æ¯”ï¼ŒHash ç±»å‹å…è®¸å¯¹å¯¹è±¡ä¸­çš„å•ä¸ªå­—æ®µè¿›è¡Œç‹¬ç«‹çš„è¯»å†™æ“ä½œï¼Œè€Œæ— éœ€è¯»å–å’Œååºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡ï¼Œè¿™åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥æä¾›æ›´é«˜çš„æ•ˆç‡å’Œçµæ´»æ€§ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº† Hash ä¸ String å¯¹è±¡åœ¨å­˜å‚¨å¯¹è±¡æ—¶çš„æ¦‚å¿µæ€§åŒºåˆ«ï¼š</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Hash/1746889180207.png" alt="Redis Hash vs String å­˜å‚¨å¯¹è±¡"><br>
<em>å›¾1: Redis Hash ä¸ String å­˜å‚¨å¯¹è±¡å¯¹æ¯”</em></p>
<h2 id="äºŒã€å†…éƒ¨å®ç°">äºŒã€å†…éƒ¨å®ç°</h2>
<p>Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ä¸»è¦ä¾èµ–äºä¸¤ç§å®ç°æ–¹å¼ï¼š<strong>å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰/ listpack</strong> å’Œ <strong>å“ˆå¸Œè¡¨ï¼ˆhashtableï¼‰</strong>ã€‚Redis ä¼šæ ¹æ®å­˜å‚¨çš„æ•°æ®è§„æ¨¡åŠ¨æ€é€‰æ‹©ï¼š</p>
<ol>
<li>
<p><strong>å‹ç¼©åˆ—è¡¨ (ziplist) / listpack</strong>:</p>
<ul>
<li>å½“å“ˆå¸Œå¯¹è±¡ä¸­åŒ…å«çš„é”®å€¼å¯¹æ•°é‡è¾ƒå°‘ï¼Œå¹¶ä¸”æ‰€æœ‰é”®ï¼ˆfieldï¼‰å’Œå€¼ï¼ˆvalueï¼‰çš„å­—ç¬¦ä¸²é•¿åº¦éƒ½è¾ƒçŸ­æ—¶ï¼ŒRedis ä¼šé‡‡ç”¨å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æ¥å­˜å‚¨ Hashã€‚</li>
<li>å…·ä½“é˜ˆå€¼ç”±ä»¥ä¸‹ä¸¤ä¸ªé…ç½®å‚æ•°å†³å®šï¼š
<ul>
<li><code>hash-max-ziplist-entries</code>ï¼šå“ˆå¸Œå¯¹è±¡åŒ…å«çš„é”®å€¼å¯¹æ•°é‡ä¸Šé™ï¼ˆé»˜è®¤å€¼ä¸º <code>512</code>ï¼‰ã€‚</li>
<li><code>hash-max-ziplist-value</code>ï¼šå“ˆå¸Œå¯¹è±¡ä¸­æ¯ä¸ªå€¼ï¼ˆvalueï¼‰çš„å­—èŠ‚é•¿åº¦ä¸Šé™ï¼ˆé»˜è®¤å€¼ä¸º <code>64</code> å­—èŠ‚ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>é‡è¦æ¼”è¿›</strong>ï¼šåœ¨ Redis 7.0 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œ<code>ziplist</code> å·²è¢«æ›´ä¼˜åŒ–çš„ <code>listpack</code> æ•°æ®ç»“æ„æ‰€å–ä»£ã€‚<code>listpack</code> è§£å†³äº† <code>ziplist</code> åœ¨æ›´æ–°æ“ä½œæ—¶å¯èƒ½å¼•å‘è¿é”æ›´æ–°ï¼ˆcascade updateï¼‰çš„é—®é¢˜ï¼Œæé«˜äº†æ€§èƒ½å’Œç©ºé—´æ•ˆç‡ã€‚å› æ­¤ï¼Œåœ¨ç°ä»£ Redis ç‰ˆæœ¬ä¸­ï¼Œå½“æ»¡è¶³ä¸Šè¿°æ¡ä»¶æ—¶ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯ <code>listpack</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å“ˆå¸Œè¡¨ (hashtable)</strong>:</p>
<ul>
<li>å¦‚æœå“ˆå¸Œå¯¹è±¡ä¸­çš„é”®å€¼å¯¹æ•°é‡è¶…è¿‡ <code>hash-max-ziplist-entries</code>ï¼Œæˆ–è€…ä»»ä¸€é”®æˆ–å€¼çš„é•¿åº¦è¶…è¿‡ <code>hash-max-ziplist-value</code>ï¼ŒRedis åˆ™ä¼šè‡ªåŠ¨å°†åº•å±‚æ•°æ®ç»“æ„è½¬æ¢ä¸ºå“ˆå¸Œè¡¨ï¼ˆä¹Ÿç§°ä¸ºå­—å…¸ï¼Œdictï¼‰ã€‚</li>
<li>å“ˆå¸Œè¡¨é€šè¿‡é“¾å¼å“ˆå¸Œè§£å†³å†²çªï¼Œå¹¶åœ¨è´Ÿè½½å› å­è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶è¿›è¡ŒåŠ¨æ€æ‰©å®¹ï¼ˆrehashï¼‰ï¼Œä»¥ä¿è¯æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ul>
</li>
</ol>
<p>è¿™ç§åŠ¨æ€åˆ‡æ¢åº•å±‚æ•°æ®ç»“æ„çš„è®¾è®¡ï¼Œæ—¨åœ¨å¹³è¡¡å†…å­˜ä½¿ç”¨å’Œæ“ä½œæ•ˆç‡ã€‚å¯¹äºå°å‹ Hash å¯¹è±¡ï¼Œ<code>listpack</code>ï¼ˆæˆ–æ—©æœŸçš„ <code>ziplist</code>ï¼‰èƒ½æœ‰æ•ˆèŠ‚çœå†…å­˜ï¼›è€Œå¯¹äºå¤§å‹ Hash å¯¹è±¡ï¼Œå“ˆå¸Œè¡¨åˆ™èƒ½æä¾›æ›´é«˜æ•ˆçš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</p>
<h2 id="ä¸‰ã€å¸¸ç”¨å‘½ä»¤">ä¸‰ã€å¸¸ç”¨å‘½ä»¤</h2>
<p>ä»¥ä¸‹æ˜¯ Redis Hash ç±»å‹çš„ä¸€äº›å¸¸ç”¨æ“ä½œå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å•ä¸ª field çš„å€¼</span></span><br><span class="line">HSET key field value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å•ä¸ª field çš„å€¼</span></span><br><span class="line">HGET key field</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€æ¬¡æ€§è®¾ç½®å¤šä¸ª field çš„å€¼</span></span><br><span class="line">HMSET key field1 value1 [field2 value2 ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€æ¬¡æ€§è·å–å¤šä¸ª field çš„å€¼</span></span><br><span class="line">HMGET key field1 [field2 value2 ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª field</span></span><br><span class="line">HDEL key field1 [field2 ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å“ˆå¸Œè¡¨ä¸­ field çš„æ•°é‡</span></span><br><span class="line">HLEN key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„ field å’Œ value</span></span><br><span class="line">HGETALL key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„ field</span></span><br><span class="line">HKEYS key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„ value</span></span><br><span class="line">HVALS key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ¤æ–­å“ˆå¸Œè¡¨ä¸­æŒ‡å®š field æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">HEXISTS key field</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸ºå“ˆå¸Œè¡¨ key ä¸­æŒ‡å®š field çš„æ•´æ•°å€¼åŠ ä¸Šå¢é‡ increment</span></span><br><span class="line">HINCRBY key field increment</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸ºå“ˆå¸Œè¡¨ key ä¸­æŒ‡å®š field çš„æµ®ç‚¹æ•°å€¼åŠ ä¸Šå¢é‡ increment</span></span><br><span class="line">HINCRBYFLOAT key field increment</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å“ˆå¸Œè¡¨ä¸­æŒ‡å®š field çš„å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">HSTRLEN key field</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„äº‹é¡¹</strong>:</p>
<ul>
<li><code>HMSET</code> åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ Redis ä¸­å·²è¢« <code>HSET</code> å–ä»£ï¼ˆ<code>HSET</code> ç°åœ¨å¯ä»¥ä¸€æ¬¡è®¾ç½®å¤šä¸ªå­—æ®µï¼‰ã€‚ä½†ä¸ºäº†å…¼å®¹æ€§ï¼Œ<code>HMSET</code> ä»ç„¶å¯ç”¨ã€‚</li>
<li><code>HGETALL</code> å‘½ä»¤åœ¨å“ˆå¸Œå¯¹è±¡å¾ˆå¤§æ—¶å¯èƒ½ä¼šé˜»å¡ Redis æœåŠ¡å™¨ï¼Œå› ä¸ºå®ƒéœ€è¦éå†æ•´ä¸ªå“ˆå¸Œè¡¨ã€‚å¯¹äºå¤§å‹å“ˆå¸Œï¼Œåº”è°¨æ…ä½¿ç”¨ï¼Œæˆ–è€ƒè™‘ä½¿ç”¨ <code>HSCAN</code> å‘½ä»¤è¿›è¡Œåˆ†æ‰¹è¿­ä»£ã€‚</li>
</ul>
<h2 id="å››ã€åº”ç”¨åœºæ™¯">å››ã€åº”ç”¨åœºæ™¯</h2>
<p>Hash ç±»å‹å› å…¶ç»“æ„ç‰¹æ€§ï¼Œåœ¨å¤šç§åœºæ™¯ä¸‹éƒ½æœ‰å¹¿æ³›åº”ç”¨ã€‚</p>
<h3 id="1-ç¼“å­˜å¯¹è±¡ä¿¡æ¯">1. ç¼“å­˜å¯¹è±¡ä¿¡æ¯</h3>
<p>Hash ç±»å‹çš„ <code>(key, field, value)</code> ç»“æ„ä¸ç¨‹åºä¸­å¯¹è±¡çš„ <code>(å¯¹è±¡æ ‡è¯†, å±æ€§å, å±æ€§å€¼)</code> ç»“æ„å¤©ç„¶å¯¹åº”ï¼Œå› æ­¤éå¸¸é€‚åˆç”¨æ¥ç¼“å­˜å¯¹è±¡ä¿¡æ¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·ä¿¡æ¯å¯¹è±¡åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­çš„ç»“æ„å¯èƒ½å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Hash/1746889227698.png" alt="ç”¨æˆ·ä¿¡æ¯è¡¨ç»“æ„"><br>
<em>å›¾2: ç”¨æˆ·ä¿¡æ¯è¡¨ç»“æ„ç¤ºä¾‹</em></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Hash ç±»å‹æ¥å­˜å‚¨è¿™äº›ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­˜å‚¨ç”¨æˆ·IDä¸º1çš„ä¿¡æ¯</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">HSET user:1 name <span class="string">&quot;Tom&quot;</span> age 25 email <span class="string">&quot;tom@example.com&quot;</span></span></span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­˜å‚¨ç”¨æˆ·IDä¸º2çš„ä¿¡æ¯</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">HSET user:2 name <span class="string">&quot;Jerry&quot;</span> age 22 city <span class="string">&quot;New York&quot;</span></span></span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ç”¨æˆ·IDä¸º1çš„æ‰€æœ‰ä¿¡æ¯</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">HGETALL user:1</span></span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">2) &quot;Tom&quot;</span><br><span class="line">3) &quot;age&quot;</span><br><span class="line">4) &quot;25&quot;</span><br><span class="line">5) &quot;email&quot;</span><br><span class="line">6) &quot;tom@example.com&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ç”¨æˆ·IDä¸º2çš„å§“åå’ŒåŸå¸‚</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">HMGET user:2 name city</span></span><br><span class="line">1) &quot;Jerry&quot;</span><br><span class="line">2) &quot;New York&quot;</span><br></pre></td></tr></table></figure>
<p>Redis Hash å­˜å‚¨å…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Hash/1746889237339.png" alt="Redis Hash å­˜å‚¨å¯¹è±¡ç»“æ„"><br>
<em>å›¾3: Redis Hash å­˜å‚¨å¯¹è±¡ç»“æ„ç¤ºä¾‹</em></p>
<p><strong>ä¸ String + JSON å¯¹æ¯”</strong>:</p>
<p>è™½ç„¶å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²åå­˜å‚¨åœ¨ String ç±»å‹ä¸­ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ç¼“å­˜å¯¹è±¡çš„æ–¹å¼ï¼Œä½† Hash ç±»å‹åœ¨ä»¥ä¸‹æ–¹é¢å…·æœ‰ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>éƒ¨åˆ†æ›´æ–°</strong>: å¦‚æœåªéœ€è¦ä¿®æ”¹å¯¹è±¡çš„æŸä¸ªå±æ€§ï¼Œä½¿ç”¨ Hash å¯ä»¥ç›´æ¥é€šè¿‡ <code>HSET</code> æ›´æ–°è¯¥å­—æ®µï¼Œè€Œæ— éœ€è¯»å–ã€ååºåˆ—åŒ–ã€ä¿®æ”¹å†åºåˆ—åŒ–ã€å†™å›æ•´ä¸ª JSON å¯¹è±¡ã€‚</li>
<li><strong>å­—æ®µçº§åŸå­æ“ä½œ</strong>: Hash æä¾›äº†å¦‚ <code>HINCRBY</code> è¿™æ ·çš„åŸå­æ“ä½œï¼Œå¯ä»¥ç›´æ¥å¯¹å¯¹è±¡å±æ€§è¿›è¡ŒåŸå­å¢å‡ã€‚</li>
<li><strong>å¯è¯»æ€§</strong>: ç›´æ¥å­˜å‚¨å­—æ®µåå’Œå€¼ï¼Œåœ¨ Redis å®¢æˆ·ç«¯ä¸­æŸ¥çœ‹æ•°æ®æ—¶å¯èƒ½æ›´ç›´è§‚ã€‚</li>
</ul>
<p><strong>é€‰æ‹©ç­–ç•¥</strong>:</p>
<ul>
<li>å¯¹äºéœ€è¦é¢‘ç¹æ›´æ–°å¯¹è±¡éƒ¨åˆ†å±æ€§ï¼Œæˆ–è€…éœ€è¦å¯¹å±æ€§è¿›è¡ŒåŸå­æ“ä½œçš„åœºæ™¯ï¼ŒHash ç±»å‹æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li>
<li>å¦‚æœå¯¹è±¡å±æ€§ä¸å¸¸å˜åŠ¨ï¼Œæˆ–è€…æ€»æ˜¯éœ€è¦æ•´ä½“è¯»å†™å¯¹è±¡ï¼ŒString + JSON çš„æ–¹å¼å¯èƒ½æ›´ç®€å•ï¼Œåºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¼€é”€åœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ¥å—ã€‚</li>
<li>ä¸€ç§æ··åˆç­–ç•¥æ˜¯ï¼šå°†å¯¹è±¡çš„ä¸»è¦ã€ä¸å¸¸å˜åŠ¨çš„å±æ€§ç”¨ String + JSON å­˜å‚¨ï¼Œè€Œå°†é¢‘ç¹å˜åŠ¨æˆ–éœ€è¦åŸå­æ“ä½œçš„å±æ€§ï¼ˆå¦‚è®¡æ•°å™¨ï¼‰å•ç‹¬ç”¨ Hash å­˜å‚¨ï¼Œæˆ–è€…å­˜å‚¨åœ¨åŒä¸€ä¸ª Hash çš„ä¸åŒå­—æ®µä¸­ã€‚</li>
</ul>
<h3 id="2-è´­ç‰©è½¦å®ç°">2. è´­ç‰©è½¦å®ç°</h3>
<p>è´­ç‰©è½¦åŠŸèƒ½æ˜¯ Hash ç±»å‹çš„å¦ä¸€ä¸ªç»å…¸åº”ç”¨åœºæ™¯ã€‚æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ· ID ä½œä¸º keyï¼Œå•†å“ ID ä½œä¸º fieldï¼Œå•†å“æ•°é‡ä½œä¸º valueã€‚</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/Hash/1746889245275.png" alt="è´­ç‰©è½¦ä½¿ç”¨ Hash å­˜å‚¨"><br>
<em>å›¾4: è´­ç‰©è½¦ä½¿ç”¨ Hash å­˜å‚¨ç¤ºä¾‹</em></p>
<p>è´­ç‰©è½¦ç›¸å…³æ“ä½œå‘½ä»¤ç¤ºä¾‹ï¼š</p>
<ul>
<li><strong>æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦/å¢åŠ å•†å“æ•°é‡</strong>:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœå•†å“å·²å­˜åœ¨ï¼Œåˆ™æ•°é‡åŠ 1ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ å•†å“ï¼Œæ•°é‡ä¸º1</span></span><br><span class="line">HINCRBY cart:user123 product:1001 1</span><br></pre></td></tr></table></figure>
</li>
<li><strong>å‡å°‘å•†å“æ•°é‡</strong>:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ•°é‡å‡1ã€‚å¦‚æœå‡åˆ°0æˆ–ä»¥ä¸‹ï¼Œå¯èƒ½éœ€è¦åç»­é€»è¾‘HDELåˆ é™¤è¯¥å•†å“</span></span><br><span class="line">HINCRBY cart:user123 product:1001 -1</span><br></pre></td></tr></table></figure>
</li>
<li><strong>ç›´æ¥è®¾ç½®å•†å“æ•°é‡</strong>:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">HSET cart:user123 product:1002 5</span><br></pre></td></tr></table></figure>
</li>
<li><strong>è·å–è´­ç‰©è½¦ä¸­å•†å“æ€»æ•°ï¼ˆç§ç±»æ•°ï¼‰</strong>:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">HLEN cart:user123</span><br></pre></td></tr></table></figure>
</li>
<li><strong>åˆ é™¤è´­ç‰©è½¦ä¸­æŒ‡å®šå•†å“</strong>:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">HDEL cart:user123 product:1001</span><br></pre></td></tr></table></figure>
</li>
<li><strong>è·å–è´­ç‰©è½¦ä¸­æ‰€æœ‰å•†å“åŠå…¶æ•°é‡</strong>:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">HGETALL cart:user123</span><br></pre></td></tr></table></figure>
</li>
<li><strong>æ¸…ç©ºè´­ç‰©è½¦</strong>:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DEL cart:user123</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>æ³¨æ„</strong>:<br>
è¿™ç§æ–¹å¼åªåœ¨ Redis ä¸­å­˜å‚¨äº†å•†å“ ID å’Œæ•°é‡ã€‚åœ¨å‘ç”¨æˆ·å±•ç¤ºè´­ç‰©è½¦æ—¶ï¼Œé€šå¸¸è¿˜éœ€è¦æ ¹æ®å•†å“ ID ä»æ•°æ®åº“æˆ–å…¶ä»–æœåŠ¡æŸ¥è¯¢å•†å“çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚åç§°ã€ä»·æ ¼ã€å›¾ç‰‡ç­‰ï¼‰ã€‚</p>
<h2 id="äº”ã€æ€»ç»“">äº”ã€æ€»ç»“</h2>
<p>Redis çš„ Hash ç±»å‹æä¾›äº†ä¸€ç§é«˜æ•ˆå­˜å‚¨å’Œæ“ä½œç»“æ„åŒ–æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆè¡¨ç¤ºå¯¹è±¡ã€‚å…¶åº•å±‚çš„ <code>listpack</code> (æˆ– <code>ziplist</code>) å’Œå“ˆå¸Œè¡¨åŠ¨æ€è½¬æ¢æœºåˆ¶ï¼Œä½¿å…¶åœ¨ä¸åŒæ•°æ®è§„æ¨¡ä¸‹éƒ½èƒ½ä¿æŒè¾ƒå¥½çš„æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ã€‚ç†è§£å…¶å†…éƒ¨å®ç°å’Œå¸¸ç”¨å‘½ä»¤ï¼Œæœ‰åŠ©äºåœ¨å®é™…åº”ç”¨ä¸­æ›´å¥½åœ°åˆ©ç”¨ Hash ç±»å‹è§£å†³é—®é¢˜ï¼Œå¦‚å¯¹è±¡ç¼“å­˜ã€è´­ç‰©è½¦ç®¡ç†ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç±»å‹</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>Redis</tag>
        <tag>ç¼“å­˜</tag>
        <tag>Hash</tag>
        <tag>æ•°æ®ç±»å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 169 - å¤šæ•°å…ƒç´ ï¼ˆMajority Elementï¼‰</title>
    <url>/2025/05/10/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-169-%E5%A4%9A%E6%95%B0%E5%85%83%E7%B4%A0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ numsï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[3,2,3]</span><br><span class="line">è¾“å‡ºï¼š3</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[2,2,1,1,1,2,2]</span><br><span class="line">è¾“å‡ºï¼š2</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>n == nums.length</code></li>
<li><code>1 &lt;= n &lt;= 5 * 10^4</code></li>
<li><code>-10^9 &lt;= nums[i] &lt;= 10^9</code></li>
<li>é¢˜ç›®æ•°æ®ä¿è¯ <code>nums</code> ä¸­å­˜åœ¨å¤šæ•°å…ƒç´ </li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>é’ˆå¯¹å¤šæ•°å…ƒç´ é—®é¢˜ï¼Œæˆ‘ä»¬æœ‰å¤šç§è§£å†³æ–¹æ¡ˆã€‚ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å››ç§å¸¸ç”¨çš„è§£æ³•ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œæ‰¾å‡ºå‡ºç°æ¬¡æ•°å¤§äº n/2 çš„å…ƒç´ ã€‚</p>
<p>è¿™æ˜¯ä¸€ç§ç›´è§‚çš„è§£æ³•ï¼Œé€šè¿‡ä¸¤æ¬¡éå†å®ç°ï¼š</p>
<ol>
<li>ç¬¬ä¸€æ¬¡éå†ï¼šç»Ÿè®¡æ¯ä¸ªå…ƒç´ çš„å‡ºç°æ¬¡æ•°</li>
<li>ç¬¬äºŒæ¬¡éå†ï¼šæ‰¾å‡ºå‡ºç°æ¬¡æ•°å¤§äº n/2 çš„å…ƒç´ </li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šæ’åºæ³•">æ–¹æ³•äºŒï¼šæ’åºæ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå¦‚æœå°†æ•°ç»„æ’åºï¼Œç”±äºå¤šæ•°å…ƒç´ å‡ºç°æ¬¡æ•°å¤§äº n/2ï¼Œæ‰€ä»¥æ’åºåä¸­é—´ä½ç½®çš„å…ƒç´ ä¸€å®šæ˜¯å¤šæ•°å…ƒç´ ã€‚</p>
<p>è¿™æ˜¯ä¸€ç§ç®€å•ä½†æ•ˆç‡ä¸é«˜çš„è§£æ³•ï¼š</p>
<ol>
<li>å¯¹æ•°ç»„è¿›è¡Œæ’åº</li>
<li>è¿”å›ä¸­é—´ä½ç½®çš„å…ƒç´ ï¼ˆä¸‹æ ‡ä¸º n/2ï¼‰</li>
</ol>
<h3 id="æ–¹æ³•ä¸‰ï¼šåˆ†æ²»æ³•">æ–¹æ³•ä¸‰ï¼šåˆ†æ²»æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°†æ•°ç»„åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ‰¾å‡ºå·¦å³ä¸¤éƒ¨åˆ†çš„å¤šæ•°å…ƒç´ ï¼Œç„¶åç¡®å®šæ•´ä¸ªæ•°ç»„çš„å¤šæ•°å…ƒç´ ã€‚</p>
<p>åˆ†æ²»æ³•çš„å…·ä½“æ­¥éª¤ï¼š</p>
<ol>
<li>å°†æ•°ç»„åˆ†æˆå·¦å³ä¸¤éƒ¨åˆ†</li>
<li>é€’å½’åœ°æ‰¾å‡ºå·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†çš„å¤šæ•°å…ƒç´ </li>
<li>æ¯”è¾ƒè¿™ä¸¤ä¸ªå¤šæ•°å…ƒç´ åœ¨æ•´ä¸ªæ•°ç»„ä¸­çš„å‡ºç°æ¬¡æ•°ï¼Œè¿”å›å‡ºç°æ¬¡æ•°è¾ƒå¤šçš„é‚£ä¸ª</li>
</ol>
<h3 id="æ–¹æ³•å››ï¼šæ‘©å°”æŠ•ç¥¨æ³•">æ–¹æ³•å››ï¼šæ‘©å°”æŠ•ç¥¨æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåˆ©ç”¨&quot;ä¸åŒå…ƒç´ ç›¸äº’æŠµæ¶ˆ&quot;çš„æ€æƒ³ï¼Œæ‰¾å‡ºæœ€ç»ˆç•™ä¸‹çš„å…ƒç´ ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹æœ‰ä¸¤æ”¯å†›é˜Ÿåœ¨æ‰“ä»—ï¼š</p>
<ul>
<li>çº¢å†›ï¼ˆä»£è¡¨å¤šæ•°å…ƒç´ ï¼‰</li>
<li>è“å†›ï¼ˆä»£è¡¨æ‰€æœ‰å…¶ä»–å…ƒç´ ï¼‰</li>
</ul>
<p>ç”±äºå¤šæ•°å…ƒç´ å‡ºç°æ¬¡æ•°è¶…è¿‡æ€»æ•°çš„ä¸€åŠï¼Œæ‰€ä»¥çº¢å†›äººæ•°å¿…ç„¶å¤šäºè“å†›ã€‚å³ä½¿çº¢è“åŒæ–¹ä¸€å¯¹ä¸€å®æ€ï¼ˆç›¸äº’æŠµæ¶ˆï¼‰ï¼Œæœ€åæˆ˜åœºä¸Šå‰©ä¸‹çš„ä¸€å®šæ˜¯çº¢å†›ï¼</p>
<p>è¿™å°±æ˜¯æ‘©å°”æŠ•ç¥¨ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼š<strong>ä¸åŒçš„æ•°å­—ç›¸äº’æŠµæ¶ˆï¼Œæœ€åå‰©ä¸‹çš„ä¸€å®šæ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªæ•°å­—</strong>ã€‚</p>
<h4 id="ç®—æ³•æ­¥éª¤ï¼ˆè¶…ç®€å•ç‰ˆï¼‰">ç®—æ³•æ­¥éª¤ï¼ˆè¶…ç®€å•ç‰ˆï¼‰</h4>
<ol>
<li>æ‰¾ä¸€ä¸ª&quot;å€™é€‰äºº&quot;ï¼Œå…ˆè®¤ä¸ºç¬¬ä¸€ä¸ªæ•°å­—æ˜¯å€™é€‰äºº</li>
<li>å¼€å§‹è®¡æ•°ï¼šé‡åˆ°å’Œå€™é€‰äººä¸€æ ·çš„æ•°å­—å°±+1ï¼Œé‡åˆ°ä¸ä¸€æ ·çš„å°±-1</li>
<li>å¦‚æœè®¡æ•°å˜æˆ0äº†ï¼Œå°±æ¢ä¸€ä¸ªå€™é€‰äººï¼ˆé€‰å½“å‰é‡åˆ°çš„é‚£ä¸ªæ•°å­—ï¼‰</li>
<li>ç»§ç»­ä¸Šé¢çš„è¿‡ç¨‹ç›´åˆ°ç»“æŸ</li>
<li>æœ€åçš„å€™é€‰äººå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å¤šæ•°å…ƒç´ </li>
</ol>
<h2 id="å®ç°ç»†èŠ‚ä¸ä»£ç ">å®ç°ç»†èŠ‚ä¸ä»£ç </h2>
<h3 id="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•-2">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">majorityElement</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå“ˆå¸Œè¡¨ï¼Œç”¨äºç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    countMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        countMap[num]++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¾å‡ºå‡ºç°æ¬¡æ•°å¤§äº n/2 çš„å…ƒç´ </span></span><br><span class="line">    threshold := <span class="built_in">len</span>(nums) / <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> num, count := <span class="keyword">range</span> countMap &#123;</span><br><span class="line">        <span class="keyword">if</span> count &gt; threshold &#123;</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å› ä¸ºé¢˜ç›®ä¿è¯æœ‰å¤šæ•°å…ƒç´ ï¼Œæ‰€ä»¥ä¸ä¼šèµ°åˆ°è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹æ¼”ç¤º</strong>ï¼šä»¥ <code>[2,2,1,1,1,2,2]</code> ä¸ºä¾‹</p>
<ol>
<li>åˆå§‹åŒ– <code>countMap = &#123;&#125;</code></li>
<li>éå†æ•°ç»„å¹¶ç»Ÿè®¡ï¼š
<ul>
<li>é‡åˆ° 2ï¼š<code>countMap[2] = 1</code></li>
<li>é‡åˆ° 2ï¼š<code>countMap[2] = 2</code></li>
<li>é‡åˆ° 1ï¼š<code>countMap[1] = 1</code></li>
<li>é‡åˆ° 1ï¼š<code>countMap[1] = 2</code></li>
<li>é‡åˆ° 1ï¼š<code>countMap[1] = 3</code></li>
<li>é‡åˆ° 2ï¼š<code>countMap[2] = 3</code></li>
<li>é‡åˆ° 2ï¼š<code>countMap[2] = 4</code></li>
</ul>
</li>
<li>æœ€ç»ˆ <code>countMap = &#123;1: 3, 2: 4&#125;</code>ï¼Œé˜ˆå€¼ <code>threshold = 7/2 = 3</code></li>
<li>æ£€æŸ¥ <code>countMap</code> ä¸­å…ƒç´ ï¼Œå‘ç° 2 çš„å‡ºç°æ¬¡æ•°ä¸º 4ï¼Œå¤§äºé˜ˆå€¼ 3</li>
<li>è¿”å› 2 ä½œä¸ºå¤šæ•°å…ƒç´ </li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šæ’åºæ³•-2">æ–¹æ³•äºŒï¼šæ’åºæ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;sort&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">majorityElement</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹æ•°ç»„è¿›è¡Œæ’åº</span></span><br><span class="line">    sort.Ints(nums)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›ä¸­é—´ä½ç½®çš„å…ƒç´ </span></span><br><span class="line">    <span class="comment">// ç”±äºå¤šæ•°å…ƒç´ å‡ºç°æ¬¡æ•°å¤§äº n/2ï¼Œæ’åºåä¸­é—´ä½ç½®ä¸€å®šæ˜¯å¤šæ•°å…ƒç´ </span></span><br><span class="line">    <span class="keyword">return</span> nums[<span class="built_in">len</span>(nums)/<span class="number">2</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹æ¼”ç¤º</strong>ï¼šä»¥ <code>[2,2,1,1,1,2,2]</code> ä¸ºä¾‹</p>
<ol>
<li>æ’åºåæ•°ç»„å˜ä¸º <code>[1,1,1,2,2,2,2]</code></li>
<li>ä¸­é—´ä½ç½®æ˜¯ <code>7/2 = 3</code>ï¼Œå¯¹åº”çš„å…ƒç´ æ˜¯ <code>nums[3] = 2</code></li>
<li>è¿”å› 2 ä½œä¸ºå¤šæ•°å…ƒç´ </li>
</ol>
<h3 id="æ–¹æ³•ä¸‰ï¼šåˆ†æ²»æ³•-2">æ–¹æ³•ä¸‰ï¼šåˆ†æ²»æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">majorityElement</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> majorityElementRec(nums, <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">majorityElementRec</span><span class="params">(nums []<span class="type">int</span>, lo, hi <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// åŸºæœ¬æƒ…å†µï¼šåªæœ‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> lo == hi &#123;</span><br><span class="line">        <span class="keyword">return</span> nums[lo]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†æ•°ç»„åˆ†æˆä¸¤åŠ</span></span><br><span class="line">    mid := lo + (hi - lo)/<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†åˆ«æ‰¾å‡ºå·¦å³ä¸¤éƒ¨åˆ†çš„å¤šæ•°å…ƒç´ </span></span><br><span class="line">    left := majorityElementRec(nums, lo, mid)</span><br><span class="line">    right := majorityElementRec(nums, mid+<span class="number">1</span>, hi)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœå·¦å³ä¸¤éƒ¨åˆ†çš„å¤šæ•°å…ƒç´ ç›¸åŒï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> left == right &#123;</span><br><span class="line">        <span class="keyword">return</span> left</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡ç®—å·¦å³ä¸¤éƒ¨åˆ†å¤šæ•°å…ƒç´ åœ¨æ•´ä¸ªåŒºé—´å†…çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    leftCount := countInRange(nums, left, lo, hi)</span><br><span class="line">    rightCount := countInRange(nums, right, lo, hi)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›å‡ºç°æ¬¡æ•°è¾ƒå¤šçš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> leftCount &gt; rightCount &#123;</span><br><span class="line">        <span class="keyword">return</span> left</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countInRange</span><span class="params">(nums []<span class="type">int</span>, num, lo, hi <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := lo; i &lt;= hi; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> nums[i] == num &#123;</span><br><span class="line">            count++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹æ¼”ç¤º</strong>ï¼šå¯¹äºå¤æ‚çš„åˆ†æ²»ç®—æ³•ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ <code>[2,2,1,1,1,2,2]</code> å±•ç¤ºéƒ¨åˆ†æ­¥éª¤ï¼š</p>
<ol>
<li>å°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<code>[2,2,1]</code> å’Œ <code>[1,1,2,2]</code></li>
<li>é€’å½’åœ°å¤„ç†å·¦åŠéƒ¨åˆ†ï¼šè¿›ä¸€æ­¥åˆ†ä¸º <code>[2]</code> å’Œ <code>[2,1]</code>ï¼Œæœ€ç»ˆå¾—åˆ°å·¦åŠéƒ¨åˆ†çš„å¤šæ•°å…ƒç´  2</li>
<li>é€’å½’åœ°å¤„ç†å³åŠéƒ¨åˆ†ï¼šè¿›ä¸€æ­¥åˆ†ä¸º <code>[1,1]</code> å’Œ <code>[2,2]</code>ï¼Œæœ€ç»ˆå¾—åˆ°å³åŠéƒ¨åˆ†çš„å¤šæ•°å…ƒç´ æ²¡æœ‰ï¼ˆå› ä¸º 1 å’Œ 2 çš„å‡ºç°æ¬¡æ•°ç›¸åŒï¼‰</li>
<li>æ¯”è¾ƒå·¦å³ä¸¤éƒ¨åˆ†çš„å¤šæ•°å…ƒç´ åœ¨æ•´ä¸ªæ•°ç»„ä¸­çš„å‡ºç°æ¬¡æ•°ï¼š2 å‡ºç°äº† 4 æ¬¡ï¼Œ1 å‡ºç°äº† 3 æ¬¡</li>
<li>è¿”å› 2 ä½œä¸ºæ•´ä¸ªæ•°ç»„çš„å¤šæ•°å…ƒç´ </li>
</ol>
<h3 id="æ–¹æ³•å››ï¼šæ‘©å°”æŠ•ç¥¨æ³•-2">æ–¹æ³•å››ï¼šæ‘©å°”æŠ•ç¥¨æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">majorityElement</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// é€‰ç¬¬ä¸€ä¸ªæ•°å­—ä½œä¸ºå€™é€‰äºº</span></span><br><span class="line">    candidate := nums[<span class="number">0</span>]</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å€™é€‰äººçš„åˆå§‹ç¥¨æ•°ä¸º1</span></span><br><span class="line">    count := <span class="number">1</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä»ç¬¬äºŒä¸ªæ•°å­—å¼€å§‹ç»Ÿè®¡</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰ç¥¨æ•°ä¸º0ï¼Œæ¢æ–°å€™é€‰äºº</span></span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">0</span> &#123;</span><br><span class="line">            candidate = nums[i]</span><br><span class="line">            count = <span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> nums[i] == candidate &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœé‡åˆ°å’Œå€™é€‰äººä¸€æ ·çš„æ•°å­—ï¼Œç¥¨æ•°+1</span></span><br><span class="line">            count++</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœé‡åˆ°å’Œå€™é€‰äººä¸ä¸€æ ·çš„æ•°å­—ï¼Œç¥¨æ•°-1</span></span><br><span class="line">            count--</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æœ€åå‰©ä¸‹çš„å€™é€‰äººå°±æ˜¯å¤šæ•°å…ƒç´ </span></span><br><span class="line">    <span class="keyword">return</span> candidate</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹æ¼”ç¤º</strong>ï¼šè®©æˆ‘ä»¬ç”¨æ•°ç»„ <code>[2,2,1,1,1,2,2]</code> æ¥ä¸€æ­¥æ­¥çœ‹çœ‹ä¸Šé¢çš„ç®—æ³•æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼š</p>
<ol>
<li>åˆå§‹çŠ¶æ€ï¼š
<ul>
<li>å€™é€‰äºº = 2ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰</li>
<li>ç¥¨æ•° = 1</li>
</ul>
</li>
<li>éå†ç¬¬2ä¸ªå…ƒç´ ï¼ˆä¹Ÿæ˜¯2ï¼‰ï¼š
<ul>
<li>å‘ç°å’Œå€™é€‰äººç›¸åŒ</li>
<li>ç¥¨æ•° +1 = 2</li>
</ul>
</li>
<li>éå†ç¬¬3ä¸ªå…ƒç´ ï¼ˆæ˜¯1ï¼‰ï¼š
<ul>
<li>å‘ç°å’Œå€™é€‰äººä¸åŒ</li>
<li>ç¥¨æ•° -1 = 1</li>
</ul>
</li>
<li>éå†ç¬¬4ä¸ªå…ƒç´ ï¼ˆæ˜¯1ï¼‰ï¼š
<ul>
<li>å‘ç°å’Œå€™é€‰äººä¸åŒ</li>
<li>ç¥¨æ•° -1 = 0</li>
</ul>
</li>
<li>éå†ç¬¬5ä¸ªå…ƒç´ ï¼ˆæ˜¯1ï¼‰ï¼š
<ul>
<li>ç¥¨æ•°ä¸º0ï¼Œæ‰€ä»¥æ¢æ–°å€™é€‰äºº</li>
<li>å€™é€‰äºº = 1</li>
<li>ç¥¨æ•° = 1</li>
</ul>
</li>
<li>éå†ç¬¬6ä¸ªå…ƒç´ ï¼ˆæ˜¯2ï¼‰ï¼š
<ul>
<li>å‘ç°å’Œå€™é€‰äººä¸åŒ</li>
<li>ç¥¨æ•° -1 = 0</li>
</ul>
</li>
<li>éå†ç¬¬7ä¸ªå…ƒç´ ï¼ˆæ˜¯2ï¼‰ï¼š
<ul>
<li>ç¥¨æ•°ä¸º0ï¼Œæ‰€ä»¥æ¢æ–°å€™é€‰äºº</li>
<li>å€™é€‰äºº = 2</li>
<li>ç¥¨æ•° = 1</li>
</ul>
</li>
<li>éå†ç»“æŸï¼Œæœ€ç»ˆå€™é€‰äººæ˜¯2ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¦çš„ç­”æ¡ˆï¼</li>
</ol>
<p>ç”¨è¡¨æ ¼è¡¨ç¤ºæ›´æ¸…æ™°ï¼š</p>
<table>
<thead>
<tr>
<th>å½“å‰ä½ç½®</th>
<th>å½“å‰æ•°å­—</th>
<th>å€™é€‰äºº</th>
<th>ç¥¨æ•°</th>
<th>æ“ä½œè¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¼€å§‹</td>
<td>-</td>
<td>2</td>
<td>1</td>
<td>åˆå§‹çŠ¶æ€ï¼Œé€‰ç¬¬ä¸€ä¸ªæ•°ä¸ºå€™é€‰äºº</td>
</tr>
<tr>
<td>ä½ç½®1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>é‡åˆ°ç›¸åŒæ•°å­—ï¼Œç¥¨æ•°+1</td>
</tr>
<tr>
<td>ä½ç½®2</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>é‡åˆ°ä¸åŒæ•°å­—ï¼Œç¥¨æ•°-1</td>
</tr>
<tr>
<td>ä½ç½®3</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>é‡åˆ°ä¸åŒæ•°å­—ï¼Œç¥¨æ•°-1</td>
</tr>
<tr>
<td>ä½ç½®4</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>ç¥¨æ•°å˜ä¸º0ï¼Œæ¢æ–°å€™é€‰äºº</td>
</tr>
<tr>
<td>ä½ç½®5</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>é‡åˆ°ä¸åŒæ•°å­—ï¼Œç¥¨æ•°-1</td>
</tr>
<tr>
<td>ä½ç½®6</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>ç¥¨æ•°å˜ä¸º0ï¼Œæ¢æ–°å€™é€‰äºº</td>
</tr>
</tbody>
</table>
<p><strong>ä¸ºä»€ä¹ˆè¿™ä¸ªç®—æ³•æœ‰æ•ˆï¼Ÿ</strong></p>
<p>å› ä¸ºå¤šæ•°å…ƒç´ å‡ºç°æ¬¡æ•°è¶…è¿‡äº†æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œæ‰€ä»¥å³ä½¿å®ƒå’Œå…¶ä»–æ‰€æœ‰å…ƒç´ ä¸€ä¸€&quot;å¯¹æŠ—&quot;ï¼ˆç›¸äº’æŠµæ¶ˆï¼‰ï¼Œæœ€åå‰©ä¸‹çš„ä¹Ÿå¿…å®šæ˜¯å®ƒã€‚</p>
<p>å°±åƒä¸¤æ”¯å†›é˜Ÿæ‰“ä»—ï¼š</p>
<ul>
<li>çº¢å†›ï¼ˆå¤šæ•°å…ƒç´ ï¼‰æœ‰100äºº</li>
<li>è“å†›ï¼ˆå…¶ä»–æ‰€æœ‰å…ƒç´ ï¼‰åˆèµ·æ¥æœ€å¤šåªæœ‰99äºº</li>
<li>å³ä½¿çº¢è“åŒæ–¹ä¸€å¯¹ä¸€å®æ€ï¼Œæœ€ç»ˆä¹Ÿä¼šå‰©ä¸‹è‡³å°‘1ä¸ªçº¢å†›</li>
</ul>
<p>æ— è®ºå¦‚ä½•å˜æ¢å€™é€‰äººï¼Œæœ€ç»ˆç•™ä¸‹çš„ä¸€å®šæ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªå…ƒç´ ã€‚è¿™å°±æ˜¯æ‘©å°”æŠ•ç¥¨ç®—æ³•çš„å·§å¦™ä¹‹å¤„ï¼</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å“ˆå¸Œè¡¨è®¡æ•°æ³•</th>
<th>æ’åºæ³•</th>
<th>åˆ†æ²»æ³•</th>
<th>æ‘©å°”æŠ•ç¥¨æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n log n)</td>
<td>O(n log n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(1) æˆ– O(n)</td>
<td>O(log n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç›´è§‚æ˜“æ‡‚</td>
<td>å®ç°ç®€å•</td>
<td>å¯ä»¥æ‰©å±•åˆ°å…¶ä»–é—®é¢˜</td>
<td>æœ€é«˜æ•ˆ</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
<td>é€Ÿåº¦è¾ƒæ…¢</td>
<td>å®ç°å¤æ‚</td>
<td>ä¸ç›´è§‚</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="å“ˆå¸Œè¡¨è®¡æ•°æ³•">å“ˆå¸Œè¡¨è®¡æ•°æ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œéœ€è¦éå†æ•°ç»„ä¸¤æ¬¡</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œæœ€åæƒ…å†µä¸‹å“ˆå¸Œè¡¨éœ€è¦å­˜å‚¨ $n/2+1$ ä¸ªä¸åŒçš„å…ƒç´ </li>
</ul>
<h3 id="æ’åºæ³•">æ’åºæ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n \log n)$ï¼Œä¸»è¦æ˜¯æ’åºçš„æ—¶é—´å¤æ‚åº¦</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$ æˆ– $O(n)$ï¼Œå–å†³äºä½¿ç”¨çš„æ’åºç®—æ³•ï¼ˆåŸåœ°æ’åºæˆ–éåŸåœ°æ’åºï¼‰</li>
</ul>
<h3 id="åˆ†æ²»æ³•">åˆ†æ²»æ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n \log n)$<br>
é€’å½’æ ‘çš„æ·±åº¦ä¸º $\log n$ï¼Œæ¯å±‚çš„æ€»æ“ä½œæ¬¡æ•°ä¸º $O(n)$ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(n \log n)$</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(\log n)$ï¼Œé€’å½’è°ƒç”¨æ ˆçš„æ·±åº¦</li>
</ul>
<h3 id="æ‘©å°”æŠ•ç¥¨æ³•">æ‘©å°”æŠ•ç¥¨æ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œåªéœ€è¦éå†æ•°ç»„ä¸€æ¬¡</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(1)$ï¼Œåªä½¿ç”¨äº†å¸¸æ•°ä¸ªå˜é‡</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>å¤šè§’åº¦è§£å†³é—®é¢˜</strong>ï¼šåŒä¸€ä¸ªé—®é¢˜å¯ä»¥æœ‰å¤šç§è§£æ³•ï¼Œæ¯ç§è§£æ³•éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹</p>
</li>
<li>
<p><strong>ç®—æ³•æ•ˆç‡çš„æƒè¡¡</strong>ï¼š</p>
<ul>
<li>å“ˆå¸Œè¡¨æ–¹æ³•ç›´è§‚ä½†éœ€è¦é¢å¤–ç©ºé—´</li>
<li>æ’åºæ–¹æ³•ç®€å•ä½†æ•ˆç‡ä¸é«˜</li>
<li>åˆ†æ²»æ³•æ€æƒ³ä¼˜é›…ä½†å®ç°å¤æ‚</li>
<li>æ‘©å°”æŠ•ç¥¨æ³•é«˜æ•ˆä½†ä¸å¤Ÿç›´è§‚</li>
</ul>
</li>
<li>
<p><strong>æ‘©å°”æŠ•ç¥¨ç®—æ³•çš„å·§å¦™ä¹‹å¤„</strong>ï¼š</p>
<ul>
<li>åˆ©ç”¨&quot;ä¸åŒå…ƒç´ ç›¸äº’æŠµæ¶ˆ&quot;çš„æ€æƒ³è§£å†³é—®é¢˜</li>
<li>ä¸éœ€è¦é¢å¤–ç©ºé—´ï¼Œä¸€æ¬¡éå†å³å¯å¾—åˆ°ç»“æœ</li>
<li>æ˜¯è§£å†³&quot;å¤šæ•°å…ƒç´ &quot;é—®é¢˜çš„æœ€ä½³ç®—æ³•</li>
</ul>
</li>
<li>
<p><strong>é—®é¢˜çš„æ‰©å±•æ€è€ƒ</strong>ï¼š</p>
<ul>
<li>å¦‚æœä¸ä¿è¯å­˜åœ¨å¤šæ•°å…ƒç´ ï¼Œéœ€è¦å¢åŠ éªŒè¯æ­¥éª¤</li>
<li>å¯ä»¥æ‰©å±•åˆ°å¯»æ‰¾å‡ºç°æ¬¡æ•°å¤§äº n/3 çš„å…ƒç´ ï¼ˆLeetCode 229ï¼‰</li>
<li>å¯ä»¥ç”¨äºè§£å†³å…¶ä»–è®¡æ•°ç›¸å…³çš„é—®é¢˜</li>
</ul>
</li>
</ol>
<h2 id="ç›¸å…³é¢˜ç›®">ç›¸å…³é¢˜ç›®</h2>
<ul>
<li>LeetCode 229: æ±‚ä¼—æ•° IIï¼ˆæ‰¾å‡ºæ‰€æœ‰å‡ºç°æ¬¡æ•°è¶…è¿‡ n/3 çš„å…ƒç´ ï¼‰</li>
<li>LeetCode 1150: æ£€æŸ¥ä¸€ä¸ªæ•°æ˜¯å¦åœ¨æ•°ç»„ä¸­å ç»å¤§å¤šæ•°</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>åˆ†æ²»</tag>
        <tag>å“ˆå¸Œè¡¨</tag>
        <tag>æ•°ç»„</tag>
        <tag>æ‘©å°”æŠ•ç¥¨</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 136 - åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼ˆSingle Numberï¼‰</title>
    <url>/2025/05/10/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-136-%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ª<strong>éç©º</strong>æ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ ã€‚</p>
<p><strong>è¯´æ˜</strong>ï¼šä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ</p>
<h3 id="ç¤ºä¾‹-1ï¼š">ç¤ºä¾‹ 1ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [2,2,1]</span><br><span class="line">è¾“å‡º: 1</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2ï¼š">ç¤ºä¾‹ 2ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [4,1,2,1,2]</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶ï¼š">çº¦æŸæ¡ä»¶ï¼š</h3>
<ul>
<li>1 &lt;= nums.length &lt;= 3 * 10^4</li>
<li>-3 * 10^4 &lt;= nums[i] &lt;= 3 * 10^4</li>
<li>é™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜å¯ä»¥æœ‰å¤šç§è§£æ³•ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸‰ç§ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œä»ç®€å•åˆ°é«˜çº§ï¼Œæœ€åé‡ç‚¹è®²è§£ä½¿ç”¨å¼‚æˆ–è¿ç®—çš„è§£æ³•ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åæ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‚</p>
<h4 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</h4>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ <code>map</code>ï¼Œç”¨äºå­˜å‚¨æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°</li>
<li>éå†æ•°ç»„ï¼Œå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œè®¡æ•°</li>
<li>å†æ¬¡éå†å“ˆå¸Œè¡¨ï¼Œæ‰¾å‡ºå‡ºç°æ¬¡æ•°ä¸º 1 çš„å…ƒç´ </li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šæ’åºæ³•">æ–¹æ³•äºŒï¼šæ’åºæ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå…ˆå¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œç„¶åæ¯”è¾ƒç›¸é‚»å…ƒç´ ï¼Œæ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‚</p>
<h4 id="å®ç°æ­¥éª¤-2">å®ç°æ­¥éª¤</h4>
<ol>
<li>å¯¹æ•°ç»„è¿›è¡Œæ’åº</li>
<li>ä»å¤´åˆ°å°¾éå†æ’åºåçš„æ•°ç»„</li>
<li>ç”±äºé™¤äº†ä¸€ä¸ªå…ƒç´ å¤–ï¼Œå…¶ä»–å…ƒç´ éƒ½å‡ºç°ä¸¤æ¬¡ï¼Œæ‰€ä»¥ç›¸åŒçš„å…ƒç´ å¿…ç„¶ç›¸é‚»</li>
<li>æ¯”è¾ƒç›¸é‚»å…ƒç´ ï¼Œæ‰¾å‡ºä¸æˆå¯¹çš„å…ƒç´ </li>
</ol>
<h3 id="æ–¹æ³•ä¸‰ï¼šå¼‚æˆ–è¿ç®—æ³•ï¼ˆæœ€ä¼˜è§£ï¼‰">æ–¹æ³•ä¸‰ï¼šå¼‚æˆ–è¿ç®—æ³•ï¼ˆæœ€ä¼˜è§£ï¼‰</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåˆ©ç”¨å¼‚æˆ–è¿ç®—çš„ç‰¹æ€§ï¼Œå¯¹æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ ã€‚</p>
<p><strong>å¼‚æˆ–è¿ç®—çš„å…³é”®ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>ä»»ä½•æ•°å­—ä¸ 0 å¼‚æˆ–ç­‰äºå®ƒè‡ªå·±ï¼š<code>a âŠ• 0 = a</code></li>
<li>ä»»ä½•æ•°å­—ä¸è‡ªå·±å¼‚æˆ–ç­‰äº 0ï¼š<code>a âŠ• a = 0</code></li>
<li>å¼‚æˆ–è¿ç®—æ»¡è¶³äº¤æ¢å¾‹å’Œç»“åˆå¾‹ï¼š<code>a âŠ• b = b âŠ• a</code> å’Œ <code>(a âŠ• b) âŠ• c = a âŠ• (b âŠ• c)</code></li>
</ul>
<h4 id="å®ç°æ­¥éª¤-3">å®ç°æ­¥éª¤</h4>
<ol>
<li>åˆå§‹åŒ–ç»“æœå˜é‡ <code>res = 0</code></li>
<li>éå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†å…¶ä¸ <code>res</code> è¿›è¡Œå¼‚æˆ–è¿ç®—</li>
<li>æœ€ç»ˆ <code>res</code> çš„å€¼å°±æ˜¯åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ </li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è§£é‡Šè¿™ä¸‰ç§æ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<h3 id="å“ˆå¸Œè¡¨è®¡æ•°æ³•è¯¦è§£">å“ˆå¸Œè¡¨è®¡æ•°æ³•è¯¦è§£</h3>
<p>è¿™æ˜¯æœ€ç›´è§‚çš„è§£æ³•ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥è®°å½•æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼š</p>
<ol>
<li>éå†æ•°ç»„ï¼Œå°†æ¯ä¸ªå…ƒç´ ä½œä¸ºé”®ï¼Œå‡ºç°æ¬¡æ•°ä½œä¸ºå€¼å­˜å…¥å“ˆå¸Œè¡¨</li>
<li>å†æ¬¡éå†å“ˆå¸Œè¡¨ï¼Œæ‰¾åˆ°å€¼ä¸º 1 çš„é”®ï¼Œå³ä¸ºç­”æ¡ˆ</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ç›´è§‚æ˜“æ‡‚ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚ç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–çš„ O(n) ç©ºé—´å¤æ‚åº¦ï¼Œä¸æ»¡è¶³é¢˜ç›®è¦æ±‚çš„&quot;ä¸ä½¿ç”¨é¢å¤–ç©ºé—´&quot;ã€‚</p>
<h3 id="æ’åºæ³•è¯¦è§£">æ’åºæ³•è¯¦è§£</h3>
<p>æ’åºåï¼Œç›¸åŒçš„å…ƒç´ ä¼šç›¸é‚»ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼š</p>
<ol>
<li>å¯¹æ•°ç»„è¿›è¡Œæ’åº</li>
<li>ä»å¤´åˆ°å°¾éå†æ’åºåçš„æ•°ç»„ï¼Œæ¯æ¬¡è·³è¿‡ä¸¤ä¸ªå…ƒç´ </li>
<li>å¦‚æœç›¸é‚»å…ƒç´ ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ </li>
</ol>
<p>ä½†è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n log n)ï¼Œä¸æ»¡è¶³è¦æ±‚çš„çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚</p>
<h3 id="å¼‚æˆ–è¿ç®—æ³•è¯¦è§£ï¼ˆé‡ç‚¹ï¼‰">å¼‚æˆ–è¿ç®—æ³•è¯¦è§£ï¼ˆé‡ç‚¹ï¼‰</h3>
<p><strong>ä¸ºä»€ä¹ˆå¼‚æˆ–è¿ç®—å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</strong></p>
<p>è®©æˆ‘ä»¬å…ˆç®€å•ä»‹ç»å¼‚æˆ–è¿ç®—ï¼š</p>
<p>å¼‚æˆ–è¿ç®—ï¼ˆXORï¼‰æ˜¯ä¸€ç§ä½è¿ç®—ï¼Œç”¨ç¬¦å· <code>âŠ•</code> æˆ– <code>^</code> è¡¨ç¤ºã€‚å®ƒæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼šå½“ä¸¤ä¸ªç›¸åŒçš„æ•°è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œç»“æœä¸º 0ï¼›è€Œä»»ä½•æ•°ä¸ 0 å¼‚æˆ–ï¼Œç»“æœä»ä¸ºå®ƒæœ¬èº«ã€‚</p>
<p>ç”¨çœŸå€¼è¡¨è¡¨ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>A âŠ• B</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼šå¯ä»¥æŠŠå¼‚æˆ–è¿ç®—æƒ³è±¡æˆ&quot;å¼€å…³&quot;ï¼Œæ¯æ¬¡æ“ä½œä¼šæ”¹å˜å¼€å…³çŠ¶æ€ã€‚å¦‚æœå¼€å…³åˆå§‹ä¸ºå…³é—­ï¼ˆ0ï¼‰ï¼Œç¬¬ä¸€æ¬¡æŒ‰ä¸‹ä¼šæ‰“å¼€ï¼ˆ1ï¼‰ï¼Œç¬¬äºŒæ¬¡å†æŒ‰åˆ™ä¼šå…³é—­ï¼ˆ0ï¼‰ã€‚è¿™å°±åƒå¼‚æˆ–çš„ç‰¹æ€§ï¼šä»»ä½•æ•°å­—å‡ºç°å¶æ•°æ¬¡ä¼šæŠµæ¶ˆä¸º 0ã€‚</p>
<p><strong>é‡è¦ç‰¹æ€§æ€»ç»“</strong>ï¼š</p>
<ol>
<li><code>a âŠ• 0 = a</code>ï¼šä»»ä½•æ•°ä¸ 0 å¼‚æˆ–ä»ä¸ºå®ƒæœ¬èº«</li>
<li><code>a âŠ• a = 0</code>ï¼šä»»ä½•æ•°ä¸è‡ªèº«å¼‚æˆ–ç­‰äº 0</li>
<li><code>a âŠ• b âŠ• a = b</code>ï¼šç”±ä¸Šé¢ä¸¤æ¡æ¨å¯¼å‡ºçš„æ€§è´¨</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆè¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨å¼‚æˆ–è§£å†³ï¼Ÿ</strong></p>
<p>åœ¨æˆ‘ä»¬çš„é—®é¢˜ä¸­ï¼š</p>
<ul>
<li>æ•°ç»„ä¸­æœ‰ä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å…ƒç´ éƒ½å‡ºç°ä¸¤æ¬¡</li>
<li>å°†æ‰€æœ‰å…ƒç´ è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå‡ºç°ä¸¤æ¬¡çš„å…ƒç´ ä¼šäº’ç›¸æŠµæ¶ˆï¼ˆç»“æœä¸º 0ï¼‰</li>
<li>0 ä¸åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ å¼‚æˆ–ï¼Œç»“æœå°±æ˜¯è¯¥å…ƒç´ </li>
</ul>
<p><strong>å›¾è§£è¿‡ç¨‹</strong>ï¼š</p>
<p>ä»¥è¾“å…¥ <code>[4,1,2,1,2]</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>åˆå§‹ <code>res = 0</code></li>
<li><code>res = 0 âŠ• 4 = 4</code></li>
<li><code>res = 4 âŠ• 1 = 5</code></li>
<li><code>res = 5 âŠ• 2 = 7</code></li>
<li><code>res = 7 âŠ• 1 = 6</code> (å› ä¸º <code>1</code> å‡ºç°ä¸¤æ¬¡ï¼Œæ‰€ä»¥ <code>1 âŠ• 1 = 0</code>ï¼Œè¿™ä¸€æ­¥ç›¸å½“äº <code>7 âŠ• 0 = 7</code>ï¼‰</li>
<li><code>res = 6 âŠ• 2 = 4</code> (å› ä¸º <code>2</code> å‡ºç°ä¸¤æ¬¡ï¼Œæ‰€ä»¥ <code>2 âŠ• 2 = 0</code>ï¼Œè¿™ä¸€æ­¥ç›¸å½“äº <code>6 âŠ• 0 = 6</code>ï¼‰</li>
</ol>
<p>æœ€ç»ˆ <code>res = 4</code>ï¼Œè¿™å°±æ˜¯åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ ã€‚</p>
<p><strong>å¦ä¸€ç§ç†è§£æ–¹å¼</strong>ï¼š</p>
<p>å°†ä¸Šé¢çš„æ­¥éª¤é‡æ–°ç»„ç»‡ï¼Œåˆ©ç”¨å¼‚æˆ–çš„äº¤æ¢å¾‹å’Œç»“åˆå¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">res = 0 âŠ• 4 âŠ• 1 âŠ• 2 âŠ• 1 âŠ• 2</span><br><span class="line">    = 0 âŠ• 4 âŠ• (1 âŠ• 1) âŠ• (2 âŠ• 2)</span><br><span class="line">    = 0 âŠ• 4 âŠ• 0 âŠ• 0</span><br><span class="line">    = 4</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ›´ç›´è§‚åœ°çœ‹å‡ºï¼Œç›¸åŒçš„å…ƒç´ é€šè¿‡å¼‚æˆ–è¿ç®—ä¼šæŠµæ¶ˆä¸º 0ï¼Œæœ€ç»ˆåªç•™ä¸‹å‡ºç°ä¸€æ¬¡çš„å…ƒç´ ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>ä¸‹é¢æ˜¯ä¸‰ç§è§£æ³•çš„ Go è¯­è¨€å®ç°ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•-2">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">singleNumber</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå“ˆå¸Œè¡¨</span></span><br><span class="line">    countMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        countMap[num]++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> num, count := <span class="keyword">range</span> countMap &#123;</span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> <span class="comment">// è¿™è¡Œç†è®ºä¸Šä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºé¢˜ç›®ä¿è¯æœ‰ä¸€ä¸ªå…ƒç´ ä»…å‡ºç°ä¸€æ¬¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šæ’åºæ³•-2">æ–¹æ³•äºŒï¼šæ’åºæ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">singleNumber</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹æ•°ç»„è¿›è¡Œæ’åº</span></span><br><span class="line">    sort.Ints(nums)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼šå¦‚æœæ•°ç»„é•¿åº¦ä¸º1ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†ç¬¬ä¸€ä¸ªå…ƒç´ å¯èƒ½æ˜¯å•ä¸ªçš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> nums[<span class="number">0</span>] != nums[<span class="number">1</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†ä¸­é—´å…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums)<span class="number">-1</span>; i += <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> nums[i] != nums[i+<span class="number">1</span>] &amp;&amp; i+<span class="number">1</span> &lt; <span class="built_in">len</span>(nums) &#123;</span><br><span class="line">            <span class="keyword">return</span> nums[i+<span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> nums[i] != nums[i<span class="number">-1</span>] &#123;</span><br><span class="line">            <span class="keyword">return</span> nums[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æœ€åä¸€ä¸ªå…ƒç´ å¯èƒ½æ˜¯å•ä¸ªçš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">return</span> nums[<span class="built_in">len</span>(nums)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šå¼‚æˆ–è¿ç®—æ³•ï¼ˆæœ€ä¼˜è§£ï¼‰-2">æ–¹æ³•ä¸‰ï¼šå¼‚æˆ–è¿ç®—æ³•ï¼ˆæœ€ä¼˜è§£ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">singleNumber</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    res := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        res ^= num</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å°±æ˜¯é¢˜ç›®ä¸­å±•ç¤ºçš„è§£æ³•ï¼Œç®€æ´è€Œé«˜æ•ˆã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•</th>
<th>æ–¹æ³•äºŒï¼šæ’åºæ³•</th>
<th>æ–¹æ³•ä¸‰ï¼šå¼‚æˆ–è¿ç®—æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n log n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(1) æˆ– O(log n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç›´è§‚æ˜“æ‡‚</td>
<td>æ€è·¯ç®€å•</td>
<td>æœ€ä¼˜è§£ï¼Œç¬¦åˆé¢˜ç›®æ‰€æœ‰è¦æ±‚</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
<td>æ—¶é—´å¤æ‚åº¦è¾ƒé«˜</td>
<td>éœ€è¦ç†è§£å¼‚æˆ–è¿ç®—åŸç†</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>é€šç”¨åœºæ™¯ï¼Œå…ƒç´ å‡ºç°ä»»æ„æ¬¡</td>
<td>é€šç”¨åœºæ™¯ï¼Œå…ƒç´ å‡ºç°ä»»æ„æ¬¡</td>
<td>ç‰¹å®šåœºæ™¯ï¼Œå…ƒç´ å‡ºç°å¶æ•°æ¬¡</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•-3">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨è®¡æ•°æ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œéœ€è¦éå†æ•°ç»„ä¸€æ¬¡ï¼Œç„¶åéå†å“ˆå¸Œè¡¨ä¸€æ¬¡</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œéœ€è¦é¢å¤–çš„å“ˆå¸Œè¡¨å­˜å‚¨æ¯ä¸ªå…ƒç´ çš„å‡ºç°æ¬¡æ•°</li>
</ul>
<h3 id="æ–¹æ³•äºŒï¼šæ’åºæ³•-3">æ–¹æ³•äºŒï¼šæ’åºæ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log n)ï¼Œæ’åºçš„æ—¶é—´å¤æ‚åº¦</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1) æˆ– O(log n)ï¼Œå–å†³äºæ’åºç®—æ³•çš„å®ç°</li>
</ul>
<h3 id="æ–¹æ³•ä¸‰ï¼šå¼‚æˆ–è¿ç®—æ³•">æ–¹æ³•ä¸‰ï¼šå¼‚æˆ–è¿ç®—æ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œåªéœ€è¦éå†æ•°ç»„ä¸€æ¬¡</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)ï¼Œåªéœ€è¦ä¸€ä¸ªå˜é‡å­˜å‚¨ç»“æœ</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>å¼‚æˆ–è¿ç®—çš„ç‹¬ç‰¹ä½œç”¨</strong>ï¼šå¼‚æˆ–è¿ç®—åœ¨å¤„ç†&quot;å‡ºç°å¶æ•°æ¬¡&quot;çš„å…ƒç´ æ—¶å…·æœ‰ç‰¹æ®Šä¼˜åŠ¿ï¼Œå¯ä»¥å®ç°&quot;è‡ªåŠ¨æŠµæ¶ˆ&quot;çš„æ•ˆæœã€‚</p>
</li>
<li>
<p><strong>é™åˆ¶æ¡ä»¶çš„é‡è¦æ€§</strong>ï¼šè¿™ç§è§£æ³•ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºé¢˜ç›®ä¿è¯äº†é™¤äº†ä¸€ä¸ªå…ƒç´ å¤–ï¼Œå…¶ä»–å…ƒç´ éƒ½å‡ºç°<strong>ä¸¤æ¬¡</strong>ï¼ˆå¶æ•°æ¬¡ï¼‰ã€‚å¦‚æœå…ƒç´ å‡ºç°<strong>å¥‡æ•°æ¬¡</strong>ï¼Œå¼‚æˆ–è¿ç®—å°±ä¸é€‚ç”¨äº†ã€‚</p>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–</strong>ï¼šæœ‰æ—¶å€™ï¼Œåˆ©ç”¨é—®é¢˜çš„ç‰¹æ®Šæ€§è´¨å¯ä»¥å¤§å¹…é™ä½ç©ºé—´å¤æ‚åº¦ï¼Œå¼‚æˆ–è¿ç®—æ³•å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚</p>
</li>
<li>
<p><strong>ä½è¿ç®—çš„å¼ºå¤§</strong>ï¼šä½è¿ç®—é€šå¸¸å¯ä»¥å¸¦æ¥æ›´é«˜æ•ˆçš„è§£æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†æ•°å­—ç›¸å…³é—®é¢˜æ—¶ã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯çš„æ‹“å±•</strong>ï¼šå¼‚æˆ–è¿ç®—æ³•ä¸ä»…é€‚ç”¨äºå…ƒç´ å‡ºç°ä¸¤æ¬¡çš„æƒ…å†µï¼Œåªè¦å…¶ä»–å…ƒç´ éƒ½å‡ºç°<strong>å¶æ•°æ¬¡</strong>ï¼Œè¿™ç§æ–¹æ³•éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p>
</li>
<li>
<p><strong>ç‰¹æ®Šæƒ…å†µçš„å¤„ç†</strong>ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•åªèƒ½æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„å…ƒç´ ã€‚å¦‚æœæœ‰å¤šä¸ªå…ƒç´ å‡ºç°å¥‡æ•°æ¬¡ï¼Œå°±éœ€è¦å…¶ä»–æ–¹æ³•ã€‚</p>
</li>
</ol>
<p><strong>æ€»ç»“</strong>ï¼šå¼‚æˆ–è¿ç®—æ³•æä¾›äº†ä¸€ç§å·§å¦™çš„æ–¹å¼æ¥è§£å†³&quot;åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—&quot;é—®é¢˜ï¼Œå®ƒåˆ©ç”¨ä½æ“ä½œçš„ç‰¹æ€§ï¼Œå®ç°äº†çº¿æ€§æ—¶é—´å¤æ‚åº¦å’Œå¸¸æ•°ç©ºé—´å¤æ‚åº¦ï¼Œæ˜¯ä¸€ç§éå¸¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>ä½è¿ç®—</category>
      </categories>
      <tags>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>å“ˆå¸Œ</tag>
        <tag>æ•°ç»„</tag>
        <tag>ä½è¿ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title>RedisçŸ¥è¯†ç‚¹: Liståˆ—è¡¨</title>
    <url>/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/List/</url>
    <content><![CDATA[<h2 id="List">List</h2>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>List åˆ—è¡¨æ˜¯ Redis ä¸­çš„åŸºç¡€æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œ<strong>æŒ‰ç…§æ’å…¥é¡ºåºæ’åº</strong>ã€‚List çš„ç‰¹ç‚¹æ˜¯æ”¯æŒåŒå‘æ“ä½œï¼Œå¯ä»¥ä»å¤´éƒ¨ï¼ˆå·¦ä¾§ï¼‰æˆ–å°¾éƒ¨ï¼ˆå³ä¾§ï¼‰å‘åˆ—è¡¨æ·»åŠ æˆ–ç§»é™¤å…ƒç´ ã€‚</p>
<p>åˆ—è¡¨çš„æœ€å¤§é•¿åº¦ä¸º $2^{32} - 1$ï¼ˆå³ 4,294,967,295ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªåˆ—è¡¨æœ€å¤šå¯ä»¥å­˜å‚¨è¶…è¿‡ <strong>40 äº¿</strong>ä¸ªå…ƒç´ ï¼Œè¶³ä»¥æ»¡è¶³ç»å¤§å¤šæ•°åº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚</p>
<p>List ç±»å‹å…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹æ€§ï¼š</p>
<ul>
<li>æœ‰åºæ€§ï¼šå…ƒç´ æŒ‰ç…§æ’å…¥é¡ºåºæ’åˆ—</li>
<li>å¯é‡å¤æ€§ï¼šåŒä¸€ä¸ªå…ƒç´ å¯ä»¥å¤šæ¬¡å‡ºç°åœ¨åˆ—è¡¨ä¸­</li>
<li>åŒå‘æ“ä½œï¼šæ”¯æŒä»ä¸¤ç«¯è¿›è¡Œæ’å…¥å’Œå¼¹å‡ºæ“ä½œ</li>
<li>é˜»å¡æ“ä½œï¼šæ”¯æŒé˜»å¡å¼çš„å¼¹å‡ºæ“ä½œï¼Œé€‚åˆå®ç°é˜Ÿåˆ—</li>
</ul>
<h3 id="å†…éƒ¨å®ç°">å†…éƒ¨å®ç°</h3>
<p>List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ç»å†äº†å¤šæ¬¡æ¼”è¿›ï¼š</p>
<ul>
<li>
<p>åœ¨ Redis 3.2 ç‰ˆæœ¬ä¹‹å‰ï¼ŒList ç”±<strong>åŒå‘é“¾è¡¨æˆ–å‹ç¼©åˆ—è¡¨</strong>å®ç°ï¼š</p>
<ul>
<li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>list-max-ziplist-entries</code> é…ç½®ï¼‰ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº <code>64</code> å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>list-max-ziplist-value</code> é…ç½®ï¼‰ï¼ŒRedis ä¼šä½¿ç”¨**å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰**ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li>
<li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨**åŒå‘é“¾è¡¨ï¼ˆlinkedlistï¼‰**ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li>
</ul>
</li>
<li>
<p><strong>åœ¨ Redis 3.2 ç‰ˆæœ¬åŠä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„ç»Ÿä¸€ç”± quicklist å®ç°</strong>ï¼Œæ›¿ä»£äº†ä¹‹å‰çš„åŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨ã€‚</p>
</li>
</ul>
<p><strong>quicklist</strong> æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œä½†å®ƒçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ã€‚è¿™ç§è®¾è®¡ç»“åˆäº†åŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨çš„ä¼˜ç‚¹ï¼šæ—¢ä¿ç•™äº†é“¾è¡¨çš„çµæ´»æ€§ï¼ˆä¾¿äºåœ¨ä¸¤ç«¯è¿›è¡Œæ“ä½œï¼‰ï¼Œåˆåˆ©ç”¨äº†å‹ç¼©åˆ—è¡¨çš„ç©ºé—´æ•ˆç‡ä¼˜åŠ¿ã€‚é€šè¿‡å°†å¤šä¸ªå…ƒç´ å­˜å‚¨åœ¨ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ä¸­ï¼Œquicklist å‡å°‘äº†é“¾è¡¨èŠ‚ç‚¹çš„æ•°é‡å’Œå†…å­˜ç¢ç‰‡ã€‚</p>
<h3 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h3>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/List/1746872332385.png" alt="1746872332385"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼valueæ’å…¥åˆ°keyåˆ—è¡¨çš„è¡¨å¤´(æœ€å·¦è¾¹)ï¼Œæœ€åçš„å€¼åœ¨æœ€å‰é¢</span></span><br><span class="line">LPUSH key value [value ...] </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼valueæ’å…¥åˆ°keyåˆ—è¡¨çš„è¡¨å°¾(æœ€å³è¾¹)</span></span><br><span class="line">RPUSH key value [value ...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»é™¤å¹¶è¿”å›keyåˆ—è¡¨çš„å¤´å…ƒç´ </span></span><br><span class="line">LPOP key   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»é™¤å¹¶è¿”å›keyåˆ—è¡¨çš„å°¾å…ƒç´ </span></span><br><span class="line">RPOP key </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›åˆ—è¡¨keyä¸­æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼ŒåŒºé—´ä»¥åç§»é‡startå’ŒstopæŒ‡å®šï¼Œä»0å¼€å§‹</span></span><br><span class="line">LRANGE key start stop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»keyåˆ—è¡¨è¡¨å¤´å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰å°±é˜»å¡<span class="built_in">timeout</span>ç§’ï¼Œå¦‚æœ<span class="built_in">timeout</span>=0åˆ™ä¸€ç›´é˜»å¡</span></span><br><span class="line">BLPOP key [key ...] timeout</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»keyåˆ—è¡¨è¡¨å°¾å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰å°±é˜»å¡<span class="built_in">timeout</span>ç§’ï¼Œå¦‚æœ<span class="built_in">timeout</span>=0åˆ™ä¸€ç›´é˜»å¡</span></span><br><span class="line">BRPOP key [key ...] timeout</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›åˆ—è¡¨çš„é•¿åº¦</span></span><br><span class="line">LLEN key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´ </span></span><br><span class="line">LINDEX key index</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨åˆ—è¡¨çš„å…ƒç´ å‰æˆ–è€…åæ’å…¥å…ƒç´ </span></span><br><span class="line">LINSERT key BEFORE|AFTER pivot value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†åˆ—è¡¨ <span class="built_in">source</span> ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ å¼¹å‡ºå¹¶è¿”å›ï¼Œç„¶åå°†è¯¥å…ƒç´ æ’å…¥åˆ°åˆ—è¡¨ destination çš„å¤´éƒ¨</span></span><br><span class="line">RPOPLPUSH source destination</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RPOPLPUSHçš„é˜»å¡ç‰ˆæœ¬</span></span><br><span class="line">BRPOPLPUSH source destination timeout</span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3>
<h4 id="æ¶ˆæ¯é˜Ÿåˆ—">æ¶ˆæ¯é˜Ÿåˆ—</h4>
<p>æ¶ˆæ¯é˜Ÿåˆ—åœ¨å­˜å–æ¶ˆæ¯æ—¶ï¼Œå¿…é¡»è¦æ»¡è¶³ä¸‰ä¸ªéœ€æ±‚ï¼Œåˆ†åˆ«æ˜¯<strong>æ¶ˆæ¯ä¿åºã€å¤„ç†é‡å¤çš„æ¶ˆæ¯å’Œä¿è¯æ¶ˆæ¯å¯é æ€§</strong>ã€‚</p>
<p>Redis çš„ List å’Œ Stream ä¸¤ç§æ•°æ®ç±»å‹ï¼Œéƒ½å¯ä»¥æ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„è¿™ä¸‰ä¸ªéœ€æ±‚ã€‚æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹åŸºäº List çš„æ¶ˆæ¯é˜Ÿåˆ—å®ç°æ–¹æ³•ã€‚</p>
<p><em>1ã€å¦‚ä½•æ»¡è¶³æ¶ˆæ¯ä¿åºéœ€æ±‚ï¼Ÿ</em></p>
<p>List æœ¬èº«å°±æ˜¯æŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºå¯¹æ•°æ®è¿›è¡Œå­˜å–çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½¿ç”¨ List ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¿å­˜æ¶ˆæ¯çš„è¯ï¼Œå°±å·²ç»èƒ½æ»¡è¶³æ¶ˆæ¯ä¿åºçš„éœ€æ±‚äº†ã€‚</p>
<p>List å¯ä»¥ä½¿ç”¨ LPUSH + RPOPï¼ˆæˆ–è€…åè¿‡æ¥ï¼ŒRPUSH+LPOPï¼‰å‘½ä»¤å®ç°æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/List/1746872357038.png" alt="1746872357038"></p>
<ul>
<li>ç”Ÿäº§è€…ä½¿ç”¨ <code>LPUSH key value[value...]</code> å°†æ¶ˆæ¯æ’å…¥åˆ°é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œå¦‚æœ key ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„é˜Ÿåˆ—å†æ’å…¥æ¶ˆæ¯ã€‚</li>
<li>æ¶ˆè´¹è€…ä½¿ç”¨ <code>RPOP key</code> ä¾æ¬¡è¯»å–é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå…ˆè¿›å…ˆå‡ºã€‚</li>
</ul>
<p>ä¸è¿‡ï¼Œåœ¨æ¶ˆè´¹è€…è¯»å–æ•°æ®æ—¶ï¼Œæœ‰ä¸€ä¸ªæ½œåœ¨çš„æ€§èƒ½é£é™©ç‚¹ã€‚</p>
<p>åœ¨ç”Ÿäº§è€…å¾€ List ä¸­å†™å…¥æ•°æ®æ—¶ï¼ŒList å¹¶ä¸ä¼šä¸»åŠ¨åœ°é€šçŸ¥æ¶ˆè´¹è€…æœ‰æ–°æ¶ˆæ¯å†™å…¥ï¼Œå¦‚æœæ¶ˆè´¹è€…æƒ³è¦åŠæ—¶å¤„ç†æ¶ˆæ¯ï¼Œå°±éœ€è¦åœ¨ç¨‹åºä¸­ä¸åœåœ°è°ƒç”¨ <code>RPOP</code> å‘½ä»¤ï¼ˆæ¯”å¦‚ä½¿ç”¨ä¸€ä¸ª while(1) å¾ªç¯ï¼‰ã€‚å¦‚æœæœ‰æ–°æ¶ˆæ¯å†™å…¥ï¼ŒRPOP å‘½ä»¤å°±ä¼šè¿”å›ç»“æœï¼Œå¦åˆ™ï¼ŒRPOP å‘½ä»¤è¿”å›ç©ºå€¼ï¼Œå†ç»§ç»­å¾ªç¯ã€‚</p>
<p>æ‰€ä»¥ï¼Œå³ä½¿æ²¡æœ‰æ–°æ¶ˆæ¯å†™å…¥ Listï¼Œæ¶ˆè´¹è€…ä¹Ÿè¦ä¸åœåœ°è°ƒç”¨ RPOP å‘½ä»¤ï¼Œè¿™å°±ä¼šå¯¼è‡´æ¶ˆè´¹è€…ç¨‹åºçš„ CPU ä¸€ç›´æ¶ˆè€—åœ¨æ‰§è¡Œ RPOP å‘½ä»¤ä¸Šï¼Œå¸¦æ¥ä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis æä¾›äº† BRPOP å‘½ä»¤ã€‚<strong>BRPOP å‘½ä»¤ä¹Ÿç§°ä¸ºé˜»å¡å¼è¯»å–ï¼Œå®¢æˆ·ç«¯åœ¨æ²¡æœ‰è¯»åˆ°é˜Ÿåˆ—æ•°æ®æ—¶ï¼Œè‡ªåŠ¨é˜»å¡ï¼Œç›´åˆ°æœ‰æ–°çš„æ•°æ®å†™å…¥é˜Ÿåˆ—ï¼Œå†å¼€å§‹è¯»å–æ–°æ•°æ®</strong>ã€‚å’Œæ¶ˆè´¹è€…ç¨‹åºè‡ªå·±ä¸åœåœ°è°ƒç”¨ RPOP å‘½ä»¤ç›¸æ¯”ï¼Œè¿™ç§æ–¹å¼èƒ½èŠ‚çœ CPU å¼€é”€ã€‚</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/List/1746872365846.png" alt="1746872365846"></p>
<p><em>2ã€å¦‚ä½•å¤„ç†é‡å¤çš„æ¶ˆæ¯ï¼Ÿ</em></p>
<p>æ¶ˆè´¹è€…è¦å®ç°é‡å¤æ¶ˆæ¯çš„åˆ¤æ–­ï¼Œéœ€è¦ 2 ä¸ªæ–¹é¢çš„è¦æ±‚ï¼š</p>
<ul>
<li>æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå…¨å±€çš„ IDã€‚</li>
<li>æ¶ˆè´¹è€…è¦è®°å½•å·²ç»å¤„ç†è¿‡çš„æ¶ˆæ¯çš„ IDã€‚å½“æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…ç¨‹åºå°±å¯ä»¥å¯¹æ¯”æ”¶åˆ°çš„æ¶ˆæ¯ ID å’Œè®°å½•çš„å·²å¤„ç†è¿‡çš„æ¶ˆæ¯ IDï¼Œæ¥åˆ¤æ–­å½“å‰æ”¶åˆ°çš„æ¶ˆæ¯æœ‰æ²¡æœ‰ç»è¿‡å¤„ç†ã€‚å¦‚æœå·²ç»å¤„ç†è¿‡ï¼Œé‚£ä¹ˆï¼Œæ¶ˆè´¹è€…ç¨‹åºå°±ä¸å†è¿›è¡Œå¤„ç†äº†ã€‚</li>
</ul>
<p>ä½†æ˜¯ <strong>List å¹¶ä¸ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯ç”Ÿæˆ ID å·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªè¡Œä¸ºæ¯ä¸ªæ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ ID</strong>ï¼Œç”Ÿæˆä¹‹åï¼Œæˆ‘ä»¬åœ¨ç”¨ LPUSH å‘½ä»¤æŠŠæ¶ˆæ¯æ’å…¥ List æ—¶ï¼Œéœ€è¦åœ¨æ¶ˆæ¯ä¸­åŒ…å«è¿™ä¸ªå…¨å±€å”¯ä¸€ IDã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±æŠŠä¸€æ¡å…¨å±€ ID ä¸º 111000102ã€åº“å­˜é‡ä¸º 99 çš„æ¶ˆæ¯æ’å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">LPUSH mq <span class="string">&quot;111000102:stock:99&quot;</span></span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<p><em>3ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§ï¼Ÿ</em></p>
<p>å½“æ¶ˆè´¹è€…ç¨‹åºä» List ä¸­è¯»å–ä¸€æ¡æ¶ˆæ¯åï¼ŒList å°±ä¸ä¼šå†ç•™å­˜è¿™æ¡æ¶ˆæ¯äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ¶ˆè´¹è€…ç¨‹åºåœ¨å¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹å‡ºç°äº†æ•…éšœæˆ–å®•æœºï¼Œå°±ä¼šå¯¼è‡´æ¶ˆæ¯æ²¡æœ‰å¤„ç†å®Œæˆï¼Œé‚£ä¹ˆï¼Œæ¶ˆè´¹è€…ç¨‹åºå†æ¬¡å¯åŠ¨åï¼Œå°±æ²¡æ³•å†æ¬¡ä» List ä¸­è¯»å–æ¶ˆæ¯äº†ã€‚</p>
<p>ä¸ºäº†ç•™å­˜æ¶ˆæ¯ï¼ŒList ç±»å‹æä¾›äº† <code>BRPOPLPUSH</code> å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤çš„<strong>ä½œç”¨æ˜¯è®©æ¶ˆè´¹è€…ç¨‹åºä»ä¸€ä¸ª List ä¸­è¯»å–æ¶ˆæ¯ï¼ŒåŒæ—¶ï¼ŒRedis ä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯å†æ’å…¥åˆ°å¦ä¸€ä¸ª Listï¼ˆå¯ä»¥å«ä½œå¤‡ä»½ Listï¼‰ç•™å­˜</strong>ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæ¶ˆè´¹è€…ç¨‹åºè¯»äº†æ¶ˆæ¯ä½†æ²¡èƒ½æ­£å¸¸å¤„ç†ï¼Œç­‰å®ƒé‡å¯åï¼Œå°±å¯ä»¥ä»å¤‡ä»½ List ä¸­é‡æ–°è¯»å–æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†äº†ã€‚</p>
<p>å¥½äº†ï¼Œåˆ°è¿™é‡Œå¯ä»¥çŸ¥é“åŸºäº List ç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰å¤§éœ€æ±‚ï¼ˆæ¶ˆæ¯ä¿åºã€å¤„ç†é‡å¤çš„æ¶ˆæ¯å’Œä¿è¯æ¶ˆæ¯å¯é æ€§ï¼‰ã€‚</p>
<ul>
<li>æ¶ˆæ¯ä¿åºï¼šä½¿ç”¨ LPUSH + RPOPï¼›</li>
<li>é˜»å¡è¯»å–ï¼šä½¿ç”¨ BRPOPï¼›</li>
<li>é‡å¤æ¶ˆæ¯å¤„ç†ï¼šç”Ÿäº§è€…è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDï¼›</li>
<li>æ¶ˆæ¯çš„å¯é æ€§ï¼šä½¿ç”¨ BRPOPLPUSH</li>
</ul>
<blockquote>
<p>List ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ</p>
</blockquote>
<p><strong>List ä¸æ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯</strong>ï¼Œå› ä¸ºä¸€æ—¦æ¶ˆè´¹è€…æ‹‰å–ä¸€æ¡æ¶ˆæ¯åï¼Œè¿™æ¡æ¶ˆæ¯å°±ä» List ä¸­åˆ é™¤äº†ï¼Œæ— æ³•è¢«å…¶å®ƒæ¶ˆè´¹è€…å†æ¬¡æ¶ˆè´¹ã€‚</p>
<p>è¦å®ç°ä¸€æ¡æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œé‚£ä¹ˆå°±è¦å°†å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œä½¿å¾—å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯ï¼Œä½†æ˜¯ <strong>List ç±»å‹å¹¶ä¸æ”¯æŒæ¶ˆè´¹ç»„çš„å®ç°</strong>ã€‚</p>
<p>è¿™å°±è¦è¯´èµ· Redis ä» 5.0 ç‰ˆæœ¬å¼€å§‹æä¾›çš„ Stream æ•°æ®ç±»å‹äº†ï¼ŒStream åŒæ ·èƒ½å¤Ÿæ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰å¤§éœ€æ±‚ï¼Œè€Œä¸”å®ƒè¿˜æ”¯æŒã€Œæ¶ˆè´¹ç»„ã€å½¢å¼çš„æ¶ˆæ¯è¯»å–ã€‚</p>
<h4 id="ä»»åŠ¡é˜Ÿåˆ—">ä»»åŠ¡é˜Ÿåˆ—</h4>
<p>é™¤äº†ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒList è¿˜å¯ä»¥ç”¨ä½œä»»åŠ¡é˜Ÿåˆ—ã€‚ä»»åŠ¡é˜Ÿåˆ—ä¸æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä»£è¡¨ä¸€ä¸ªéœ€è¦å¤„ç†çš„ä»»åŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€æ¡æ¶ˆæ¯ã€‚</p>
<p>ä»»åŠ¡é˜Ÿåˆ—çš„åŸºæœ¬å®ç°æ–¹å¼ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”Ÿäº§è€…æ·»åŠ ä»»åŠ¡</span></span><br><span class="line">LPUSH tasks &quot;task_id:1001:param1:value1:param2:value2&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¶ˆè´¹è€…è·å–ä»»åŠ¡</span></span><br><span class="line">BRPOP tasks 0</span><br></pre></td></tr></table></figure>
<h4 id="æœ€è¿‘æ›´æ–°åˆ—è¡¨">æœ€è¿‘æ›´æ–°åˆ—è¡¨</h4>
<p>List çš„æœ‰åºç‰¹æ€§ä½¿å…¶é€‚åˆå­˜å‚¨æœ€è¿‘æ›´æ–°çš„å†…å®¹åˆ—è¡¨ï¼Œä¾‹å¦‚ç¤¾äº¤åª’ä½“ä¸­çš„æœ€æ–°åŠ¨æ€ã€åšå®¢çš„æœ€æ–°æ–‡ç« ç­‰ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ æ–°æ–‡ç« åˆ°æœ€æ–°æ–‡ç« åˆ—è¡¨</span></span><br><span class="line">LPUSH latest_articles &quot;article:1001&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿æŒåˆ—è¡¨ä¸è¶…è¿‡æŒ‡å®šé•¿åº¦</span></span><br><span class="line">LTRIM latest_articles 0 99  # åªä¿ç•™æœ€æ–°çš„100ç¯‡æ–‡ç« </span><br></pre></td></tr></table></figure>
<h4 id="åˆ†é¡µæ•°æ®ç¼“å­˜">åˆ†é¡µæ•°æ®ç¼“å­˜</h4>
<p>List å¯ä»¥ç”¨äºå­˜å‚¨åˆ†é¡µæ•°æ®ï¼Œåˆ©ç”¨ LRANGE å‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°åˆ†é¡µæŸ¥è¯¢ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­˜å‚¨åˆ†é¡µæ•°æ®</span></span><br><span class="line">RPUSH page_data:user:1001 &quot;item1&quot; &quot;item2&quot; &quot;item3&quot; ... &quot;item100&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ç¬¬ä¸€é¡µæ•°æ®ï¼ˆå‡è®¾æ¯é¡µ10æ¡ï¼‰</span></span><br><span class="line">LRANGE page_data:user:1001 0 9</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ç¬¬äºŒé¡µæ•°æ®</span></span><br><span class="line">LRANGE page_data:user:1001 10 19</span><br></pre></td></tr></table></figure>
<h3 id="æ€§èƒ½è€ƒé‡">æ€§èƒ½è€ƒé‡</h3>
<p>List æ•°æ®ç±»å‹çš„æ€§èƒ½ç‰¹ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>LPUSH/RPUSHï¼šO(1)ï¼Œåœ¨åˆ—è¡¨å¤´éƒ¨/å°¾éƒ¨æ·»åŠ å…ƒç´ æ˜¯å¸¸æ•°æ—¶é—´å¤æ‚åº¦</li>
<li>LPOP/RPOPï¼šO(1)ï¼Œä»åˆ—è¡¨å¤´éƒ¨/å°¾éƒ¨ç§»é™¤å…ƒç´ ä¹Ÿæ˜¯å¸¸æ•°æ—¶é—´å¤æ‚åº¦</li>
<li>LRANGEï¼šO(N)ï¼ŒNæ˜¯è¿”å›çš„å…ƒç´ æ•°é‡</li>
<li>LINDEXï¼šO(N)ï¼ŒNæ˜¯ç´¢å¼•çš„ä½ç½®ï¼Œè¾ƒå¤§çš„ç´¢å¼•å€¼å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™</li>
<li>LINSERTï¼šO(N)ï¼ŒNæ˜¯æŸ¥æ‰¾æ’å…¥ä½ç½®å‰éœ€è¦éå†çš„å…ƒç´ æ•°é‡</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜å ç”¨</strong>ï¼š</p>
<ul>
<li>quicklist çš„è®¾è®¡å¹³è¡¡äº†å†…å­˜æ•ˆç‡å’Œè®¿é—®é€Ÿåº¦</li>
<li>æ¯ä¸ªèŠ‚ç‚¹åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œå‡å°‘äº†å†…å­˜ç¢ç‰‡</li>
<li>å¯é€šè¿‡ <code>list-max-ziplist-size</code> å’Œ <code>list-compress-depth</code> é…ç½®å‚æ•°è°ƒæ•´å†…å­˜å ç”¨</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong>ï¼š</p>
<ul>
<li>é¿å…åœ¨å¤§å‹åˆ—è¡¨ä¸­é—´æ’å…¥æˆ–åˆ é™¤å…ƒç´ </li>
<li>å°½é‡åœ¨åˆ—è¡¨ä¸¤ç«¯æ“ä½œï¼Œåˆ©ç”¨O(1)çš„æ—¶é—´å¤æ‚åº¦</li>
<li>ä½¿ç”¨ LTRIM å‘½ä»¤å®šæœŸæ¸…ç†åˆ—è¡¨ï¼Œä¿æŒåˆç†çš„é•¿åº¦</li>
<li>å¯¹äºé˜»å¡æ“ä½œï¼Œè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…æ— é™æœŸé˜»å¡</li>
</ul>
</li>
</ol>
<h3 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h3>
<ol>
<li>
<p><strong>å¤§å°æ§åˆ¶</strong></p>
<ul>
<li>ä½¿ç”¨ LTRIM å‘½ä»¤é™åˆ¶åˆ—è¡¨å¤§å°ï¼Œé˜²æ­¢æ— é™å¢é•¿</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">LPUSH latest_logs &quot;new log entry&quot;</span><br><span class="line">LTRIM latest_logs 0 999  # åªä¿ç•™æœ€æ–°çš„1000æ¡æ—¥å¿—</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>æ‰¹é‡æ“ä½œ</strong></p>
<ul>
<li>ä½¿ç”¨å¤šå€¼å‚æ•°å½¢å¼çš„å‘½ä»¤è¿›è¡Œæ‰¹é‡æ“ä½œï¼Œå‡å°‘ç½‘ç»œå¾€è¿”</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼˜äºå¤šæ¬¡è°ƒç”¨LPUSH</span></span><br><span class="line">LPUSH mylist value1 value2 value3 value4 value5</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>äº‹åŠ¡ä½¿ç”¨</strong></p>
<ul>
<li>å½“éœ€è¦åŸå­æ€§åœ°æ‰§è¡Œå¤šä¸ªåˆ—è¡¨æ“ä½œæ—¶ï¼Œä½¿ç”¨äº‹åŠ¡</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MULTI</span><br><span class="line">LPUSH source_list &quot;item&quot;</span><br><span class="line">LPOP dest_list</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>è¶…æ—¶å¤„ç†</strong></p>
<ul>
<li>ä½¿ç”¨é˜»å¡æ“ä½œæ—¶ï¼Œæ·»åŠ åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…å®¢æˆ·ç«¯æ°¸ä¹…é˜»å¡</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æœ€å¤šé˜»å¡5ç§’</span></span><br><span class="line">BRPOP task_queue 5</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>ç›‘æ§æŒ‡æ ‡</strong></p>
<ul>
<li>å®šæœŸç›‘æ§åˆ—è¡¨é•¿åº¦ï¼Œé¿å…è¿‡åº¦å¢é•¿</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">LLEN mylist  # ç›‘æ§åˆ—è¡¨é•¿åº¦</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="ç›¸å…³ç‰¹æ€§">ç›¸å…³ç‰¹æ€§</h3>
<ol>
<li>
<p><strong>ä¸å…¶ä»–æ•°æ®ç±»å‹çš„å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>List</th>
<th>Stream</th>
<th>Pub/Sub</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¶ˆæ¯æŒä¹…åŒ–</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>æ¶ˆè´¹ç»„</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>æ¶ˆæ¯ID</td>
<td>éœ€è‡ªè¡Œå®ç°</td>
<td>å†…ç½®æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>é˜»å¡æ“ä½œ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>å¤©ç„¶å¹¿æ’­</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>ç®€å•é˜Ÿåˆ—</td>
<td>å¤æ‚æ¶ˆæ¯ç³»ç»Ÿ</td>
<td>å®æ—¶é€šçŸ¥</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>ä¸ Stream çš„åä½œ</strong></p>
<ul>
<li>å¯¹äºç®€å•åº”ç”¨å¯ä»¥ä½¿ç”¨ List</li>
<li>éœ€è¦æ¶ˆè´¹ç»„æˆ–æ¶ˆæ¯æŒä¹…åŒ–ç­‰é«˜çº§ç‰¹æ€§æ—¶ï¼Œæ¨èä½¿ç”¨ Stream</li>
<li>å¯ä»¥å°† List ä½œä¸ºå¿«é€Ÿç¼“å†²åŒºï¼Œå†å®šæœŸæ‰¹é‡å†™å…¥ Stream</li>
</ul>
</li>
<li>
<p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong></p>
<ul>
<li>å½“éœ€è¦æ›´å¼ºå¤§çš„æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿå¦‚ RabbitMQã€Kafka ç­‰</li>
<li>å¯¹äºç®€å•çš„é˜Ÿåˆ—éœ€æ±‚ï¼ŒList æä¾›äº†è½»é‡çº§çš„è§£å†³æ–¹æ¡ˆ</li>
</ul>
</li>
</ol>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://redis.io/docs/data-types/lists/">Rediså®˜æ–¹æ–‡æ¡£ - Lists</a></li>
<li><a href="https://redis.io/commands/?group=list">Rediså‘½ä»¤å‚è€ƒ - Listå‘½ä»¤</a></li>
<li><a href="http://zhangtielei.com/posts/blog-redis-quicklist.html">Rediså†…éƒ¨æ•°æ®ç»“æ„è¯¦è§£ä¹‹quicklist</a></li>
<li><a href="https://redisbook.readthedocs.io/en/latest/index.html">Rediså®æˆ˜</a></li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç±»å‹</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>Redis</tag>
        <tag>æ•°æ®ç±»å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis å­—ç¬¦ä¸²ï¼ˆStringï¼‰æ•°æ®ç±»å‹è¯¦è§£</title>
    <url>/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/String/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰æ˜¯ Redis ä¸­æœ€åŸºæœ¬ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ Redis ä¸­é»˜è®¤æä¾›çš„ä¸”ä¸éœ€è¦ç‰¹æ®Šç¼–ç çš„æ•°æ®ç»“æ„ã€‚String ç±»å‹åœ¨ Redis ä¸­ä¸ä»…å¯ä»¥å­˜å‚¨æ™®é€šæ–‡æœ¬ï¼Œè¿˜å¯ä»¥å­˜å‚¨åºåˆ—åŒ–åçš„å¯¹è±¡ã€äºŒè¿›åˆ¶æ•°æ®ã€JSON ç”šè‡³æ˜¯ç®€å•çš„æ•´æ•°è®¡æ•°å™¨ã€‚å…¶åœ¨ç¼“å­˜ã€åˆ†å¸ƒå¼é”ã€è®¡æ•°å™¨ç­‰åœºæ™¯ä¸­æœ‰å¹¿æ³›åº”ç”¨ã€‚</p>
<h2 id="String-åŸºæœ¬ç‰¹æ€§">String åŸºæœ¬ç‰¹æ€§</h2>
<p>String æ˜¯æœ€åŸºæœ¬çš„ key-value ç»“æ„ï¼Œkey æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œvalue æ˜¯å…·ä½“çš„å€¼ï¼Œvalue å…¶å®ä¸ä»…æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°å­—ï¼ˆæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰ï¼Œvalue æœ€å¤šå¯ä»¥å®¹çº³çš„æ•°æ®é•¿åº¦æ˜¯ <code>512M</code>ã€‚</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/String/1745926990333.png" alt="1745926990333"></p>
<h2 id="å†…éƒ¨å®ç°">å†…éƒ¨å®ç°</h2>
<p>String ç±»å‹çš„åº•å±‚çš„æ•°æ®ç»“æ„å®ç°ä¸»è¦æ˜¯ int å’Œ SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ã€‚</p>
<h3 id="SDSï¼ˆSimple-Dynamic-Stringï¼‰">SDSï¼ˆSimple Dynamic Stringï¼‰</h3>
<p>SDS å’Œæˆ‘ä»¬è®¤è¯†çš„ C å­—ç¬¦ä¸²ä¸å¤ªä¸€æ ·ï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ C è¯­è¨€çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå› ä¸º SDS ç›¸æ¯”äº C çš„åŸç”Ÿå­—ç¬¦ä¸²æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>SDS ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œè¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®</strong>ã€‚å› ä¸º <code>SDS</code> ä½¿ç”¨ <code>len</code> å±æ€§çš„å€¼è€Œä¸æ˜¯ç©ºå­—ç¬¦æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸï¼Œå¹¶ä¸” SDS çš„æ‰€æœ‰ API éƒ½ä¼šä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† SDS å­˜æ”¾åœ¨ <code>buf[]</code> æ•°ç»„é‡Œçš„æ•°æ®ã€‚æ‰€ä»¥ SDS ä¸å…‰èƒ½å­˜æ”¾æ–‡æœ¬æ•°æ®ï¼Œè€Œä¸”èƒ½ä¿å­˜å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€å‹ç¼©æ–‡ä»¶è¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</li>
<li><strong>SDS è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)</strong>ã€‚å› ä¸º C è¯­è¨€çš„å­—ç¬¦ä¸²å¹¶ä¸è®°å½•è‡ªèº«é•¿åº¦ï¼Œæ‰€ä»¥è·å–é•¿åº¦çš„å¤æ‚åº¦ä¸º O(n)ï¼›è€Œ SDS ç»“æ„é‡Œç”¨ <code>len</code> å±æ€§è®°å½•äº†å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸º <code>O(1)</code>ã€‚</li>
<li><strong>Redis çš„ SDS API æ˜¯å®‰å…¨çš„ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²ä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡º</strong>ã€‚å› ä¸º SDS åœ¨æ‹¼æ¥å­—ç¬¦ä¸²ä¹‹å‰ä¼šæ£€æŸ¥ SDS ç©ºé—´æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</li>
<li><strong>SDS ä½¿ç”¨é¢„åˆ†é…ç©ºé—´å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ç­–ç•¥ï¼Œå‡å°‘å†…å­˜é‡åˆ†é…æ¬¡æ•°</strong>ã€‚å½“ SDS éœ€è¦å¢é•¿æ—¶ï¼Œä¼šåˆ†é…é¢å¤–çš„ç©ºé—´ï¼›å½“ SDS ç¼©çŸ­æ—¶ï¼Œå¹¶ä¸ç«‹å³é‡Šæ”¾å¤šä½™ç©ºé—´ï¼Œè€Œæ˜¯è®°å½•èµ·æ¥ä»¥å¤‡åç”¨ã€‚</li>
</ul>
<p>SDS çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sdshdr</span> &#123;</span></span><br><span class="line">    <span class="comment">// è®°å½•bufæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡</span></span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="comment">// è®°å½•bufæ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡</span></span><br><span class="line">    <span class="type">int</span> <span class="built_in">free</span>;</span><br><span class="line">    <span class="comment">// å­—èŠ‚æ•°ç»„ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ç¼–ç æ–¹å¼">ç¼–ç æ–¹å¼</h3>
<p>å­—ç¬¦ä¸²å¯¹è±¡çš„å†…éƒ¨ç¼–ç ï¼ˆencodingï¼‰æœ‰ 3 ç§ï¼š<strong>intã€raw å’Œ embstr</strong>ã€‚</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/String/1746798279486.png" alt="1746798279486"></p>
<p>å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„æ˜¯æ•´æ•°å€¼ï¼Œå¹¶ä¸”è¿™ä¸ªæ•´æ•°å€¼å¯ä»¥ç”¨ <code>long</code>ç±»å‹æ¥è¡¨ç¤ºï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²å¯¹è±¡ä¼šå°†æ•´æ•°å€¼ä¿å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡ç»“æ„çš„ <code>ptr</code>å±æ€§é‡Œé¢ï¼ˆå°† <code>void*</code>è½¬æ¢æˆ longï¼‰ï¼Œå¹¶å°†å­—ç¬¦ä¸²å¯¹è±¡çš„ç¼–ç è®¾ç½®ä¸º <code>int</code>ã€‚</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/String/1746798287894.png" alt="1746798287894"></p>
<p>å¦‚æœå­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦å°äºç­‰äº 32 å­—èŠ‚ï¼ˆredis 2.+ç‰ˆæœ¬ï¼‰ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²å¯¹è±¡å°†ä½¿ç”¨ä¸€ä¸ªç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰æ¥ä¿å­˜è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å¯¹è±¡çš„ç¼–ç è®¾ç½®ä¸º <code>embstr</code>ï¼Œ <code>embstr</code>ç¼–ç æ˜¯ä¸“é—¨ç”¨äºä¿å­˜çŸ­å­—ç¬¦ä¸²çš„ä¸€ç§ä¼˜åŒ–ç¼–ç æ–¹å¼ï¼š</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/String/1746798295537.png" alt="1746798295537"></p>
<p>å¦‚æœå­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦å¤§äº 32 å­—èŠ‚ï¼ˆredis 2.+ç‰ˆæœ¬ï¼‰ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²å¯¹è±¡å°†ä½¿ç”¨ä¸€ä¸ªç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰æ¥ä¿å­˜è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å¯¹è±¡çš„ç¼–ç è®¾ç½®ä¸º <code>raw</code>ï¼š</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/String/1746798302983.png" alt="1746798302983"></p>
<p>æ³¨æ„ï¼Œembstr ç¼–ç å’Œ raw ç¼–ç çš„è¾¹ç•Œåœ¨ redis ä¸åŒç‰ˆæœ¬ä¸­æ˜¯ä¸ä¸€æ ·çš„ï¼š</p>
<ul>
<li>redis 2.+ æ˜¯ 32 å­—èŠ‚</li>
<li>redis 3.0-4.0 æ˜¯ 39 å­—èŠ‚</li>
<li>redis 5.0 æ˜¯ 44 å­—èŠ‚</li>
<li>redis 6.0+ ä¿æŒ 44 å­—èŠ‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ° <code>embstr</code>å’Œ <code>raw</code>ç¼–ç éƒ½ä¼šä½¿ç”¨ <code>SDS</code>æ¥ä¿å­˜å€¼ï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äº <code>embstr</code>ä¼šé€šè¿‡ä¸€æ¬¡å†…å­˜åˆ†é…å‡½æ•°æ¥åˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´æ¥ä¿å­˜ <code>redisObject</code>å’Œ <code>SDS</code>ï¼Œè€Œ <code>raw</code>ç¼–ç ä¼šé€šè¿‡è°ƒç”¨ä¸¤æ¬¡å†…å­˜åˆ†é…å‡½æ•°æ¥åˆ†åˆ«åˆ†é…ä¸¤å—ç©ºé—´æ¥ä¿å­˜ <code>redisObject</code>å’Œ <code>SDS</code>ã€‚Redis è¿™æ ·åšä¼šæœ‰å¾ˆå¤šå¥½å¤„ï¼š</p>
<ul>
<li><code>embstr</code>ç¼–ç å°†åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æ‰€éœ€çš„å†…å­˜åˆ†é…æ¬¡æ•°ä» <code>raw</code> ç¼–ç çš„ä¸¤æ¬¡é™ä½ä¸ºä¸€æ¬¡ï¼›</li>
<li>é‡Šæ”¾ <code>embstr</code>ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡åŒæ ·åªéœ€è¦è°ƒç”¨ä¸€æ¬¡å†…å­˜é‡Šæ”¾å‡½æ•°ï¼›</li>
<li>å› ä¸º <code>embstr</code>ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡çš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨ä¸€å—è¿ç»­çš„å†…å­˜é‡Œé¢å¯ä»¥æ›´å¥½çš„åˆ©ç”¨ CPU ç¼“å­˜æå‡æ€§èƒ½ã€‚</li>
</ul>
<p>ä½†æ˜¯ embstr ä¹Ÿæœ‰ç¼ºç‚¹çš„ï¼š</p>
<ul>
<li>å¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦å¢åŠ éœ€è¦é‡æ–°åˆ†é…å†…å­˜æ—¶ï¼Œæ•´ä¸ª redisObject å’Œ sds éƒ½éœ€è¦é‡æ–°åˆ†é…ç©ºé—´ï¼Œæ‰€ä»¥<strong>embstr ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡å®é™…ä¸Šæ˜¯åªè¯»çš„</strong>ï¼Œredis æ²¡æœ‰ä¸º embstr ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡ç¼–å†™ä»»ä½•ç›¸åº”çš„ä¿®æ”¹ç¨‹åºã€‚å½“æˆ‘ä»¬å¯¹ embstr ç¼–ç çš„å­—ç¬¦ä¸²å¯¹è±¡æ‰§è¡Œä»»ä½•ä¿®æ”¹å‘½ä»¤ï¼ˆä¾‹å¦‚ appendï¼‰æ—¶ï¼Œç¨‹åºä¼šå…ˆå°†å¯¹è±¡çš„ç¼–ç ä» embstr è½¬æ¢æˆ rawï¼Œç„¶åå†æ‰§è¡Œä¿®æ”¹å‘½ä»¤ã€‚</li>
</ul>
<h2 id="å¸¸ç”¨æŒ‡ä»¤">å¸¸ç”¨æŒ‡ä»¤</h2>
<h3 id="åŸºæœ¬æ“ä½œæŒ‡ä»¤">åŸºæœ¬æ“ä½œæŒ‡ä»¤</h3>
<p>æ™®é€šå­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½® key-value ç±»å‹çš„å€¼</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SET name lin</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ® key è·å¾—å¯¹åº”çš„ value</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">GET name</span></span><br><span class="line">&quot;lin&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ¤æ–­æŸä¸ª key æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">EXISTS name</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å› key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">STRLEN name</span></span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤æŸä¸ª key å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">DEL name</span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<h3 id="æ‰¹é‡æ“ä½œæŒ‡ä»¤">æ‰¹é‡æ“ä½œæŒ‡ä»¤</h3>
<p>æ‰¹é‡è®¾ç½®å’Œè·å–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰¹é‡è®¾ç½® key-value ç±»å‹çš„å€¼</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">MSET key1 value1 key2 value2</span> </span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰¹é‡è·å–å¤šä¸ª key å¯¹åº”çš„ value</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">MGET key1 key2</span> </span><br><span class="line">1) &quot;value1&quot;</span><br><span class="line">2) &quot;value2&quot;</span><br></pre></td></tr></table></figure>
<h3 id="è®¡æ•°å™¨æŒ‡ä»¤">è®¡æ•°å™¨æŒ‡ä»¤</h3>
<p>è®¡æ•°å™¨ï¼ˆå­—ç¬¦ä¸²çš„å†…å®¹ä¸ºæ•´æ•°çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½® key-value ç±»å‹çš„å€¼</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SET number 0</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">INCR number</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†keyä¸­å­˜å‚¨çš„æ•°å­—å€¼åŠ  10</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">INCRBY number 10</span></span><br><span class="line">(integer) 11</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">DECR number</span></span><br><span class="line">(integer) 10</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†keyä¸­å­˜å‚¨çš„æ•°å­—å€¼é”® 10</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">DECRBY number 10</span></span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>
<h3 id="è¿‡æœŸè®¾ç½®æŒ‡ä»¤">è¿‡æœŸè®¾ç½®æŒ‡ä»¤</h3>
<p>è¿‡æœŸï¼ˆé»˜è®¤ä¸ºæ°¸ä¸è¿‡æœŸï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½® key åœ¨ 60 ç§’åè¿‡æœŸï¼ˆè¯¥æ–¹æ³•æ˜¯é’ˆå¯¹å·²ç»å­˜åœ¨çš„keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰</span></span><br><span class="line">&gt; EXPIRE name  60 </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®è¿˜æœ‰å¤šä¹…è¿‡æœŸ</span></span><br><span class="line">&gt; TTL name </span><br><span class="line">(<span class="built_in">integer</span>) 51</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½® key-value ç±»å‹çš„å€¼ï¼Œå¹¶è®¾ç½®è¯¥keyçš„è¿‡æœŸæ—¶é—´ä¸º 60 ç§’</span></span><br><span class="line">&gt; SET key value EX 60</span><br><span class="line">OK</span><br><span class="line">&gt; SETEX key 60 value</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h3 id="æ¡ä»¶æ“ä½œæŒ‡ä»¤">æ¡ä»¶æ“ä½œæŒ‡ä»¤</h3>
<p>ä¸å­˜åœ¨å°±æ’å…¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸å­˜åœ¨å°±æ’å…¥ï¼ˆnot existsï¼‰</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SETNX key value</span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<h2 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h2>
<h3 id="ç¼“å­˜å¯¹è±¡">ç¼“å­˜å¯¹è±¡</h3>
<p>ä½¿ç”¨ String æ¥ç¼“å­˜å¯¹è±¡æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p><strong>JSONåºåˆ—åŒ–æ–¹å¼</strong>ï¼šç›´æ¥ç¼“å­˜æ•´ä¸ªå¯¹è±¡çš„ JSONï¼Œå‘½ä»¤ä¾‹å­ï¼š <code>SET user:1 '&#123;&quot;name&quot;:&quot;xiaolin&quot;, &quot;age&quot;:18&#125;'</code>ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç®€å•ç›´è§‚ï¼Œé€‚åˆå¤„ç†å¤æ‚å¯¹è±¡</li>
<li>ç¼ºç‚¹ï¼šæ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦å–å‡ºæ•´ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹åå†é‡æ–°å­˜å…¥</li>
</ul>
</li>
<li>
<p><strong>å­—æ®µæ‹†åˆ†æ–¹å¼</strong>ï¼šé‡‡ç”¨å°† key è¿›è¡Œåˆ†ç¦»ä¸º user:ID:å±æ€§ï¼Œé‡‡ç”¨ MSET å­˜å‚¨ï¼Œç”¨ MGET è·å–å„å±æ€§å€¼ï¼Œå‘½ä»¤ä¾‹å­ï¼š <code>MSET user:1:name xiaolin user:1:age 18 user:2:name xiaomei user:2:age 20</code>ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå¯ä»¥å•ç‹¬ä¿®æ”¹æŸä¸ªå±æ€§ï¼Œä¸éœ€è¦è·å–æ•´ä¸ªå¯¹è±¡</li>
<li>ç¼ºç‚¹ï¼šæ“ä½œç›¸å¯¹ç¹çï¼Œé€‚åˆç®€å•å¯¹è±¡</li>
</ul>
</li>
</ul>
<h3 id="å¸¸è§„è®¡æ•°">å¸¸è§„è®¡æ•°</h3>
<p>å› ä¸º Redis å¤„ç†å‘½ä»¤æ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥æ‰§è¡Œå‘½ä»¤çš„è¿‡ç¨‹æ˜¯åŸå­çš„ã€‚å› æ­¤ String æ•°æ®ç±»å‹é€‚åˆè®¡æ•°åœºæ™¯ï¼Œæ¯”å¦‚è®¡ç®—è®¿é—®æ¬¡æ•°ã€ç‚¹èµã€è½¬å‘ã€åº“å­˜æ•°é‡ç­‰ç­‰ã€‚</p>
<p>æ¯”å¦‚è®¡ç®—æ–‡ç« çš„é˜…è¯»é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆå§‹åŒ–æ–‡ç« çš„é˜…è¯»é‡</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SET article:readcount:1001 0</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é˜…è¯»é‡+1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">INCR article:readcount:1001</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é˜…è¯»é‡+1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">INCR article:readcount:1001</span></span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é˜…è¯»é‡+1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">INCR article:readcount:1001</span></span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å¯¹åº”æ–‡ç« çš„é˜…è¯»é‡</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">GET article:readcount:1001</span></span><br><span class="line">&quot;3&quot;</span><br></pre></td></tr></table></figure>
<p>å®é™…åº”ç”¨ä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Redis çš„ String ç±»å‹å®ç°é™æµã€ç‚¹èµç»Ÿè®¡ã€UV/PVç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚</p>
<h3 id="åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</h3>
<p>SET å‘½ä»¤æœ‰ä¸ª NX å‚æ•°å¯ä»¥å®ç°ã€Œkey ä¸å­˜åœ¨æ‰æ’å…¥ã€ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°åˆ†å¸ƒå¼é”ï¼š</p>
<ul>
<li>å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æ˜¾ç¤ºæ’å…¥æˆåŠŸï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”æˆåŠŸï¼›</li>
<li>å¦‚æœ key å­˜åœ¨ï¼Œåˆ™ä¼šæ˜¾ç¤ºæ’å…¥å¤±è´¥ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”å¤±è´¥ã€‚</li>
</ul>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œè¿˜ä¼šå¯¹åˆ†å¸ƒå¼é”åŠ ä¸Šè¿‡æœŸæ—¶é—´ï¼Œåˆ†å¸ƒå¼é”çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SET lock_key unique_value NX PX 10000</span><br></pre></td></tr></table></figure>
<ul>
<li>lock_key å°±æ˜¯ key é”®ï¼›</li>
<li>unique_value æ˜¯å®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€çš„æ ‡è¯†ï¼›</li>
<li>NX ä»£è¡¨åªåœ¨ lock_key ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹ lock_key è¿›è¡Œè®¾ç½®æ“ä½œï¼›</li>
<li>PX 10000 è¡¨ç¤ºè®¾ç½® lock_key çš„è¿‡æœŸæ—¶é—´ä¸º 10sï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸è€Œæ— æ³•é‡Šæ”¾é”ã€‚</li>
</ul>
<p>è€Œè§£é”çš„è¿‡ç¨‹å°±æ˜¯å°† lock_key é”®åˆ é™¤ï¼Œä½†ä¸èƒ½ä¹±åˆ ï¼Œè¦ä¿è¯æ‰§è¡Œæ“ä½œçš„å®¢æˆ·ç«¯å°±æ˜¯åŠ é”çš„å®¢æˆ·ç«¯ã€‚æ‰€ä»¥ï¼Œè§£é”çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å…ˆåˆ¤æ–­é”çš„ unique_value æ˜¯å¦ä¸ºåŠ é”å®¢æˆ·ç«¯ï¼Œæ˜¯çš„è¯ï¼Œæ‰å°† lock_key é”®åˆ é™¤ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè§£é”æ˜¯æœ‰ä¸¤ä¸ªæ“ä½œï¼Œè¿™æ—¶å°±éœ€è¦ Lua è„šæœ¬æ¥ä¿è¯è§£é”çš„åŸå­æ€§ï¼Œå› ä¸º Redis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œå¯ä»¥ä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œï¼Œä¿è¯äº†é”é‡Šæ”¾æ“ä½œçš„åŸå­æ€§ã€‚</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">// é‡Šæ”¾é”æ—¶ï¼Œå…ˆæ¯”è¾ƒ unique_value æ˜¯å¦ç›¸ç­‰ï¼Œé¿å…é”çš„è¯¯é‡Šæ”¾</span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œå°±é€šè¿‡ä½¿ç”¨ SET å‘½ä»¤å’Œ Lua è„šæœ¬åœ¨ Redis å•èŠ‚ç‚¹ä¸Šå®Œæˆäº†åˆ†å¸ƒå¼é”çš„åŠ é”å’Œè§£é”ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°çš„ç®€å•å®ç°åœ¨Redisé›†ç¾¤ç¯å¢ƒä¸‹å¯èƒ½å­˜åœ¨é—®é¢˜ï¼ŒRediså®˜æ–¹æ¨èä½¿ç”¨Redlockç®—æ³•æ¥å®ç°æ›´å¯é çš„åˆ†å¸ƒå¼é”ã€‚</p>
<h3 id="å…±äº«-Session-ä¿¡æ¯">å…±äº« Session ä¿¡æ¯</h3>
<p>é€šå¸¸æˆ‘ä»¬åœ¨å¼€å‘åå°ç®¡ç†ç³»ç»Ÿæ—¶ï¼Œä¼šä½¿ç”¨ Session æ¥ä¿å­˜ç”¨æˆ·çš„ä¼šè¯ (ç™»å½•) çŠ¶æ€ï¼Œè¿™äº› Session ä¿¡æ¯ä¼šè¢«ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼Œä½†è¿™åªé€‚ç”¨äºå•ç³»ç»Ÿåº”ç”¨ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ­¤æ¨¡å¼å°†ä¸å†é€‚ç”¨ã€‚</p>
<p>ä¾‹å¦‚ç”¨æˆ·ä¸€çš„ Session ä¿¡æ¯è¢«å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸€ï¼Œä½†ç¬¬äºŒæ¬¡è®¿é—®æ—¶ç”¨æˆ·ä¸€è¢«åˆ†é…åˆ°æœåŠ¡å™¨äºŒï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡å™¨å¹¶æ²¡æœ‰ç”¨æˆ·ä¸€çš„ Session ä¿¡æ¯ï¼Œå°±ä¼šå‡ºç°éœ€è¦é‡å¤ç™»å½•çš„é—®é¢˜ï¼Œé—®é¢˜åœ¨äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¯æ¬¡ä¼šæŠŠè¯·æ±‚éšæœºåˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚</p>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿå•ç‹¬å­˜å‚¨ Session æµç¨‹å›¾ï¼š</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/String/1746798315817.png" alt="1746798315817"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© Redis å¯¹è¿™äº› Session ä¿¡æ¯è¿›è¡Œç»Ÿä¸€çš„å­˜å‚¨å’Œç®¡ç†ï¼Œè¿™æ ·æ— è®ºè¯·æ±‚å‘é€åˆ°é‚£å°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨éƒ½ä¼šå»åŒä¸€ä¸ª Redis è·å–ç›¸å…³çš„ Session ä¿¡æ¯ï¼Œè¿™æ ·å°±è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ Session å­˜å‚¨çš„é—®é¢˜ã€‚</p>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿä½¿ç”¨åŒä¸€ä¸ª Redis å­˜å‚¨ Session æµç¨‹å›¾ï¼š</p>
<p><img src="/2025/05/10/%E5%85%AB%E8%82%A1%E6%96%87/REDIS/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/String/1746798322167.png" alt="1746798322167"></p>
<h3 id="é™æµå™¨å®ç°">é™æµå™¨å®ç°</h3>
<p>ä½¿ç”¨Redis Stringç±»å‹å¯ä»¥å®ç°ç®€å•çš„é™æµåŠŸèƒ½ï¼Œæ¯”å¦‚é™åˆ¶APIåœ¨ä¸€å®šæ—¶é—´å†…çš„è°ƒç”¨æ¬¡æ•°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å½“å‰è®¡æ•°å¹¶é€’å¢</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">INCR req:<span class="built_in">limit</span>:api1</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼‰</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">TTL req:<span class="built_in">limit</span>:api1</span></span><br><span class="line">(integer) -1</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">EXPIRE req:<span class="built_in">limit</span>:api1 60</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">GET req:<span class="built_in">limit</span>:api1</span></span><br><span class="line">&quot;1&quot;</span><br></pre></td></tr></table></figure>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥ç»“åˆ INCR å’Œ EXPIRE å‘½ä»¤æ¥å®ç°æ›´å¤æ‚çš„æ»‘åŠ¨çª—å£é™æµç®—æ³•ã€‚</p>
<h2 id="æ€§èƒ½è€ƒé‡">æ€§èƒ½è€ƒé‡</h2>
<p>Redis Stringç±»å‹åœ¨ä¸åŒåœºæ™¯ä¸‹æœ‰ä¸åŒçš„æ€§èƒ½è¡¨ç°ï¼š</p>
<ol>
<li>
<p><strong>æ•°æ®å¤§å°</strong>ï¼š</p>
<ul>
<li>å¯¹äºå°äº44å­—èŠ‚(Redis 6.0+)çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨embstrç¼–ç ï¼Œå†…å­˜åˆ†é…åªéœ€ä¸€æ¬¡ï¼Œæ•ˆç‡æ›´é«˜</li>
<li>å¯¹äºå¤§å­—ç¬¦ä¸²ï¼Œä½¿ç”¨rawç¼–ç ï¼Œéœ€è¦ä¸¤æ¬¡å†…å­˜åˆ†é…</li>
<li>è¶…å¤§å­—ç¬¦ä¸²ï¼ˆæ¥è¿‘512MBï¼‰å¯èƒ½å¯¼è‡´å†…å­˜ç¢ç‰‡å’Œæ€§èƒ½ä¸‹é™</li>
</ul>
</li>
<li>
<p><strong>æ“ä½œç±»å‹</strong>ï¼š</p>
<ul>
<li>è¯»æ“ä½œï¼ˆGETï¼‰æ€§èƒ½æé«˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)</li>
<li>å†™æ“ä½œï¼ˆSETï¼‰å¯¹äºembstrç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¦‚éœ€ä¿®æ”¹ä¼šå…ˆè½¬æ¢ä¸ºrawç¼–ç ï¼Œå¢åŠ äº†å¼€é”€</li>
<li>æ‰¹é‡æ“ä½œï¼ˆMGET/MSETï¼‰æ¯”å¤šæ¬¡å•ç‹¬æ“ä½œæ›´é«˜æ•ˆï¼Œå‡å°‘äº†ç½‘ç»œå¾€è¿”æ—¶é—´</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜ä½¿ç”¨</strong>ï¼š</p>
<ul>
<li>Stringç±»å‹ç›¸æ¯”å…¶ä»–å¤æ‚æ•°æ®ç»“æ„æ›´èŠ‚çœå†…å­˜</li>
<li>æ•´æ•°å€¼ä½¿ç”¨intç¼–ç æ—¶å†…å­˜å ç”¨æœ€å°</li>
<li>é¢„åˆ†é…ç­–ç•¥å¯èƒ½å¯¼è‡´ä¸€å®šçš„å†…å­˜æµªè´¹</li>
</ul>
</li>
</ol>
<h2 id="å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<ol>
<li>
<p><strong>å¤§keyé—®é¢˜</strong>ï¼š</p>
<ul>
<li>é—®é¢˜ï¼šå­˜å‚¨è¿‡å¤§çš„å­—ç¬¦ä¸²ä¼šå¯¼è‡´Redisæ€§èƒ½ä¸‹é™ï¼Œå°¤å…¶åœ¨åˆ é™¤å¤§keyæ—¶</li>
<li>è§£å†³ï¼šå°†å¤§å¯¹è±¡åˆ†ç‰‡å­˜å‚¨ï¼Œæˆ–ä½¿ç”¨Hashç±»å‹æ›¿ä»£</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜å ç”¨è¿‡å¤§</strong>ï¼š</p>
<ul>
<li>é—®é¢˜ï¼šStringé¢„åˆ†é…ç­–ç•¥å¯èƒ½å¯¼è‡´å†…å­˜æµªè´¹</li>
<li>è§£å†³ï¼šé€‚å½“è®¾ç½®maxmemoryå’Œåˆç†çš„è¿‡æœŸç­–ç•¥</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘ä¿®æ”¹é—®é¢˜</strong>ï¼š</p>
<ul>
<li>é—®é¢˜ï¼šå¤šå®¢æˆ·ç«¯åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªkeyå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li>
<li>è§£å†³ï¼šä½¿ç”¨WATCH/MULTI/EXECäº‹åŠ¡æˆ–Luaè„šæœ¬ç¡®ä¿åŸå­æ€§æ“ä½œ</li>
</ul>
</li>
<li>
<p><strong>è¿‡æœŸæ—¶é—´è®¾ç½®</strong>ï¼š</p>
<ul>
<li>é—®é¢˜ï¼šå¿˜è®°è®¾ç½®è¿‡æœŸæ—¶é—´å¯¼è‡´å†…å­˜æŒç»­å¢é•¿</li>
<li>è§£å†³ï¼šä¸ºæ‰€æœ‰ç¼“å­˜keyè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œæˆ–ä½¿ç”¨LRUç­–ç•¥</li>
</ul>
</li>
</ol>
<h2 id="ä¸å…¶ä»–æ•°æ®ç±»å‹çš„å¯¹æ¯”">ä¸å…¶ä»–æ•°æ®ç±»å‹çš„å¯¹æ¯”</h2>
<p>ä¸Redisçš„å…¶ä»–æ•°æ®ç±»å‹ç›¸æ¯”ï¼ŒStringç±»å‹æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>vs Hash</strong>ï¼š</p>
<ul>
<li>Stringï¼šé€‚åˆå­˜å‚¨å•ä¸ªå€¼æˆ–åºåˆ—åŒ–å¯¹è±¡ï¼Œæ“ä½œç®€å•</li>
<li>Hashï¼šé€‚åˆå­˜å‚¨æœ‰å¤šä¸ªå­—æ®µçš„å¯¹è±¡ï¼Œå¯å•ç‹¬æ“ä½œæŸä¸ªå­—æ®µï¼ŒèŠ‚çœå†…å­˜</li>
</ul>
</li>
<li>
<p><strong>vs List</strong>ï¼š</p>
<ul>
<li>Stringï¼šä¸æ”¯æŒå¤æ‚çš„é˜Ÿåˆ—æ“ä½œ</li>
<li>Listï¼šé€‚åˆå®ç°é˜Ÿåˆ—ã€æ ˆç­‰æ•°æ®ç»“æ„</li>
</ul>
</li>
<li>
<p><strong>vs Set/Sorted Set</strong>ï¼š</p>
<ul>
<li>Stringï¼šä¸æ”¯æŒé›†åˆæ“ä½œ</li>
<li>Set/Sorted Setï¼šé€‚åˆéœ€è¦å»é‡ã€æ’åºã€äº¤é›†ç­‰é›†åˆæ“ä½œçš„åœºæ™¯</li>
</ul>
</li>
</ol>
<p>é€‰æ‹©ä½¿ç”¨Stringè¿˜æ˜¯å…¶ä»–æ•°æ®ç±»å‹ï¼Œåº”æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚æ¥å†³å®šã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>Redis</category>
        <category>æ•°æ®ç±»å‹</category>
      </categories>
      <tags>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>Redis</tag>
        <tag>æ•°æ®ç±»å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 153 - å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼</title>
    <url>/2025/05/10/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-153-%E5%AF%BB%E6%89%BE%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå…ƒç´ å€¼<strong>äº’ä¸ç›¸åŒ</strong>çš„æ•°ç»„ <code>nums</code>ï¼Œå®ƒåŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åˆ—çš„æ•°ç»„ï¼Œå¹¶æŒ‰ç…§ä¸‹é¢çš„æƒ…å½¢è¿›è¡Œäº†å¤šæ¬¡æ—‹è½¬ï¼š</p>
<p><strong>æ—‹è½¬æ“ä½œ</strong>ï¼šå°†æ•°ç»„æœ€å‰é¢çš„å…ƒç´ å–å‡ºå¹¶æ”¾åˆ°æ•°ç»„çš„æœ«å°¾ã€‚ä¾‹å¦‚ï¼ŒåŸæ•°ç»„ <code>[0,1,2,4,5,6,7]</code> æ—‹è½¬ä¸€æ¬¡åå˜æˆ <code>[1,2,4,5,6,7,0]</code>ã€‚</p>
<p>è‹¥æ—‹è½¬ 4 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° <code>[4,5,6,7,0,1,2]</code>ï¼Œè‹¥æ—‹è½¬ 7 æ¬¡ï¼ˆå³æ•°ç»„é•¿åº¦ï¼‰ï¼Œåˆ™å¯ä»¥å¾—åˆ°åŸæ•°ç»„ <code>[0,1,2,4,5,6,7]</code>ã€‚</p>
<p>è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ•°ç»„ä¸­çš„<strong>æœ€å°å…ƒç´ </strong>ã€‚</p>
<p><strong>è¦æ±‚</strong>ï¼šå¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º <code>O(log n)</code> çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [3,4,5,1,2]</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">è§£é‡Šï¼šåŸæ•°ç»„ä¸º [1,2,3,4,5] ï¼Œæ—‹è½¬ 3 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [4,5,6,7,0,1,2]</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼šåŸæ•°ç»„ä¸º [0,1,2,4,5,6,7] ï¼Œæ—‹è½¬ 4 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [11,13,15,17]</span><br><span class="line">è¾“å‡ºï¼š11</span><br><span class="line">è§£é‡Šï¼šåŸæ•°ç»„ä¸º [11,13,15,17] ï¼Œæ—‹è½¬ 4 æ¬¡ï¼ˆæ•´ä¸ªé•¿åº¦ï¼‰å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li><code>n == nums.length</code></li>
<li><code>1 &lt;= n &lt;= 5000</code></li>
<li><code>-5000 &lt;= nums[i] &lt;= 5000</code></li>
<li><code>nums</code> ä¸­çš„æ‰€æœ‰æ•´æ•°<strong>äº’ä¸ç›¸åŒ</strong></li>
<li><code>nums</code> åŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åºçš„æ•°ç»„ï¼Œå¹¶è¿›è¡Œäº† <code>1</code> è‡³ <code>n</code> æ¬¡æ—‹è½¬</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>å¯¹äºè¿™é“é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç†è§£æ—‹è½¬æ’åºæ•°ç»„çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>å¦‚æœæ•°ç»„è¿›è¡Œäº†æ—‹è½¬ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«åˆ†æˆä¸¤ä¸ªå‡åºå­æ•°ç»„</li>
<li>æœ€å°å€¼æ˜¯ç¬¬äºŒä¸ªå­æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li>
<li>å¦‚æœæ•°ç»„æ—‹è½¬äº†<code>n</code>æ¬¡ï¼ˆç›¸å½“äºæ²¡æ—‹è½¬ï¼‰ï¼Œåˆ™ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯æœ€å°å€¼</li>
</ul>
<p>ç”±äºé¢˜ç›®è¦æ±‚<code>O(log n)</code>çš„æ—¶é—´å¤æ‚åº¦ï¼Œ<strong>äºŒåˆ†æŸ¥æ‰¾</strong>æ˜¯æœ€è‡ªç„¶çš„é€‰æ‹©ã€‚</p>
<h3 id="è§£æ³•ä¸€ï¼šä¼ ç»ŸäºŒåˆ†æŸ¥æ‰¾">è§£æ³•ä¸€ï¼šä¼ ç»ŸäºŒåˆ†æŸ¥æ‰¾</h3>
<h4 id="æ ¸å¿ƒæ€è·¯">æ ¸å¿ƒæ€è·¯</h4>
<p>ä¼ ç»ŸäºŒåˆ†æŸ¥æ‰¾çš„å…³é”®æ˜¯ç¡®å®šæœ€å°å€¼åœ¨å“ªä¸ªåŒºé—´ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¯”è¾ƒä¸­é—´å…ƒç´ å’Œå³è¾¹ç•Œå…ƒç´ æ¥åˆ¤æ–­ï¼š</p>
<ul>
<li>å¦‚æœ <code>nums[mid] &lt; nums[right]</code>ï¼šè¯´æ˜ <code>[mid, right]</code> è¿™ä¸€æ®µæ˜¯æœ‰åºçš„ï¼Œæœ€å°å€¼åœ¨ <code>mid</code> æˆ–å…¶å·¦ä¾§</li>
<li>å¦‚æœ <code>nums[mid] &gt; nums[right]</code>ï¼šè¯´æ˜æœ€å°å€¼åœ¨ <code>mid</code> å³ä¾§</li>
</ul>
<h4 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h4>
<ol>
<li>åˆå§‹åŒ–å·¦å³è¾¹ç•Œ <code>left = 0, right = n-1</code></li>
<li>å½“ <code>left &lt; right</code> æ—¶æ‰§è¡Œå¾ªç¯</li>
<li>è®¡ç®—ä¸­é—´ä½ç½® <code>mid = (left + right) / 2</code></li>
<li>æ¯”è¾ƒ <code>nums[mid]</code> å’Œ <code>nums[right]</code>
<ul>
<li>å¦‚æœ <code>nums[mid] &lt; nums[right]</code>ï¼šæ›´æ–° <code>right = mid</code></li>
<li>å¦‚æœ <code>nums[mid] &gt; nums[right]</code>ï¼šæ›´æ–° <code>left = mid + 1</code></li>
</ul>
</li>
<li>å¾ªç¯ç»“æŸåï¼Œ<code>left</code> æŒ‡å‘çš„å°±æ˜¯æœ€å°å€¼çš„ä½ç½®</li>
</ol>
<h4 id="ä»£ç å®ç°">ä»£ç å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findMin</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line">	left, right := <span class="number">0</span>, n<span class="number">-1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> left &lt; right &#123;</span><br><span class="line">		mid := (left + right) &gt;&gt; <span class="number">1</span> <span class="comment">// ç­‰ä»·äº mid := (left + right) / 2</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> nums[mid] &lt; nums[right] &#123;</span><br><span class="line">			right = mid</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			left = mid + <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> nums[left]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‰§è¡Œè¿‡ç¨‹æ¨¡æ‹Ÿ">æ‰§è¡Œè¿‡ç¨‹æ¨¡æ‹Ÿ</h4>
<p>ä»¥ <code>nums = [4,5,6,7,0,1,2]</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>åˆå§‹ï¼š<code>left = 0, right = 6</code></li>
<li>ç¬¬ä¸€æ¬¡è¿­ä»£ï¼š
<ul>
<li><code>mid = 3</code>, <code>nums[mid] = 7</code>, <code>nums[right] = 2</code></li>
<li><code>7 &gt; 2</code>ï¼Œæ‰€ä»¥ <code>left = mid + 1 = 4</code></li>
</ul>
</li>
<li>ç¬¬äºŒæ¬¡è¿­ä»£ï¼š
<ul>
<li><code>left = 4, right = 6</code></li>
<li><code>mid = 5</code>, <code>nums[mid] = 1</code>, <code>nums[right] = 2</code></li>
<li><code>1 &lt; 2</code>ï¼Œæ‰€ä»¥ <code>right = mid = 5</code></li>
</ul>
</li>
<li>ç¬¬ä¸‰æ¬¡è¿­ä»£ï¼š
<ul>
<li><code>left = 4, right = 5</code></li>
<li><code>mid = 4</code>, <code>nums[mid] = 0</code>, <code>nums[right] = 1</code></li>
<li><code>0 &lt; 1</code>ï¼Œæ‰€ä»¥ <code>right = mid = 4</code></li>
</ul>
</li>
<li>æ­¤æ—¶ <code>left = right = 4</code>ï¼Œå¾ªç¯ç»“æŸï¼Œè¿”å› <code>nums[4] = 0</code>ï¼Œè¿™æ˜¯æ­£ç¡®çš„æœ€å°å€¼</li>
</ol>
<h3 id="è§£æ³•äºŒï¼šä½¿ç”¨-Go-çš„-sort-Search">è§£æ³•äºŒï¼šä½¿ç”¨ Go çš„ sort.Search</h3>
<h4 id="Go-çš„-sort-Search-å‡½æ•°å®ç°åŸç†">Go çš„ sort.Search å‡½æ•°å®ç°åŸç†</h4>
<p><code>sort.Search</code> æ˜¯ Go æ ‡å‡†åº“ä¸­çš„äºŒåˆ†æŸ¥æ‰¾å®ç°ï¼Œå®ƒå¯»æ‰¾æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æœ€å°ç´¢å¼•ã€‚å…¶å®ç°åŸç†å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Search</span><span class="params">(n <span class="type">int</span>, f <span class="keyword">func</span>(<span class="type">int</span>)</span></span> <span class="type">bool</span>) <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰æœç´¢åŒºé—´ [0, n)</span></span><br><span class="line">    lo, hi := <span class="number">0</span>, n</span><br><span class="line">    <span class="comment">// å½“æœç´¢åŒºé—´ä¸ä¸ºç©ºæ—¶ç»§ç»­</span></span><br><span class="line">    <span class="keyword">for</span> lo &lt; hi &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—ä¸­é—´ç‚¹</span></span><br><span class="line">        mid := lo + (hi-lo)/<span class="number">2</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œè¯´æ˜ç»“æœåœ¨å·¦åŠéƒ¨åˆ† [lo, mid]</span></span><br><span class="line">        <span class="keyword">if</span> f(mid) &#123;</span><br><span class="line">            hi = mid</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦åˆ™ç»“æœåœ¨å³åŠéƒ¨åˆ† (mid, hi)</span></span><br><span class="line">            lo = mid + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// lo æ˜¯ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç­‰äº n</span></span><br><span class="line">    <span class="keyword">return</span> lo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sort.Search</code> å‡½æ•°æœ‰ä¸¤ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼š</p>
<ol>
<li>å®ƒè¿”å›ç¬¬ä¸€ä¸ªä½¿å¾—æ¡ä»¶å‡½æ•° <code>f(i)</code> è¿”å› <code>true</code> çš„ç´¢å¼• <code>i</code></li>
<li>å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½ä¸æ»¡è¶³æ¡ä»¶ï¼Œå®ƒä¼šè¿”å› <code>n</code>ï¼ˆæœç´¢èŒƒå›´çš„ä¸Šé™ï¼‰</li>
</ol>
<h4 id="æ ¸å¿ƒæ€è·¯-2">æ ¸å¿ƒæ€è·¯</h4>
<p>åœ¨æ—‹è½¬æ’åºæ•°ç»„ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å¯»æ‰¾ç¬¬ä¸€ä¸ªå°äº <code>nums[0]</code> çš„å…ƒç´ ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>å¦‚æœæ•°ç»„ç»è¿‡æ—‹è½¬ï¼Œè¿™ä¸ªå…ƒç´ å°±æ˜¯æœ€å°å€¼</li>
<li>å¦‚æœæ‰¾ä¸åˆ°è¿™æ ·çš„å…ƒç´ ï¼ˆå³ <code>sort.Search</code> è¿”å›æ•°ç»„é•¿åº¦ï¼‰ï¼Œè¯´æ˜æ•°ç»„æ²¡æœ‰æ—‹è½¬æˆ–æ—‹è½¬äº†æ•´ä¸ªé•¿åº¦ï¼Œæ­¤æ—¶ <code>nums[0]</code> å°±æ˜¯æœ€å°å€¼</li>
</ul>
<h4 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findMin</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	index := sort.Search(<span class="built_in">len</span>(nums), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> nums[i] &lt; nums[<span class="number">0</span>]</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> index &gt;= <span class="built_in">len</span>(nums) &#123;</span><br><span class="line">		<span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> nums[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‰§è¡Œè¿‡ç¨‹æ¨¡æ‹Ÿ-2">æ‰§è¡Œè¿‡ç¨‹æ¨¡æ‹Ÿ</h4>
<p>ä»¥ <code>nums = [4,5,6,7,0,1,2]</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>æˆ‘ä»¬å¯»æ‰¾ç¬¬ä¸€ä¸ªå°äº <code>nums[0] = 4</code> çš„å…ƒç´ </li>
<li>åˆå§‹ï¼š<code>lo = 0, hi = 7</code></li>
<li>ç¬¬ä¸€æ¬¡è¿­ä»£ï¼š
<ul>
<li><code>mid = 3</code>, <code>nums[mid] = 7</code></li>
<li><code>7 &lt; 4</code> ? å¦ï¼Œæ‰€ä»¥ <code>lo = mid + 1 = 4</code></li>
</ul>
</li>
<li>ç¬¬äºŒæ¬¡è¿­ä»£ï¼š
<ul>
<li><code>lo = 4, hi = 7</code></li>
<li><code>mid = 5</code>, <code>nums[mid] = 1</code></li>
<li><code>1 &lt; 4</code> ? æ˜¯ï¼Œæ‰€ä»¥ <code>hi = mid = 5</code></li>
</ul>
</li>
<li>ç¬¬ä¸‰æ¬¡è¿­ä»£ï¼š
<ul>
<li><code>lo = 4, hi = 5</code></li>
<li><code>mid = 4</code>, <code>nums[mid] = 0</code></li>
<li><code>0 &lt; 4</code> ? æ˜¯ï¼Œæ‰€ä»¥ <code>hi = mid = 4</code></li>
</ul>
</li>
<li>æ­¤æ—¶ <code>lo = hi = 4</code>ï¼Œå¾ªç¯ç»“æŸï¼Œè¿”å› <code>lo = 4</code></li>
<li>å› ä¸º <code>index = 4 &lt; len(nums) = 7</code>ï¼Œæ‰€ä»¥è¿”å› <code>nums[4] = 0</code>ï¼Œè¿™æ˜¯æ­£ç¡®çš„æœ€å°å€¼</li>
</ol>
<p>å¯¹äº <code>nums = [11,13,15,17]</code>ï¼ˆæ²¡æœ‰æ—‹è½¬ï¼‰ï¼š</p>
<ol>
<li>æˆ‘ä»¬å¯»æ‰¾ç¬¬ä¸€ä¸ªå°äº <code>nums[0] = 11</code> çš„å…ƒç´ </li>
<li>ç»è¿‡äºŒåˆ†æŸ¥æ‰¾ï¼Œå‘ç°æ²¡æœ‰å…ƒç´ å°äº 11</li>
<li><code>sort.Search</code> è¿”å› <code>index = 4</code>ï¼ˆæ•°ç»„é•¿åº¦ï¼‰</li>
<li>å› ä¸º <code>index &gt;= len(nums)</code>ï¼Œæ‰€ä»¥è¿”å› <code>nums[0] = 11</code>ï¼Œè¿™æ˜¯æ­£ç¡®çš„æœ€å°å€¼</li>
</ol>
<h2 id="è¾¹ç•Œæƒ…å†µåˆ†æ">è¾¹ç•Œæƒ…å†µåˆ†æ</h2>
<h3 id="è§£æ³•ä¸€çš„è¾¹ç•Œå¤„ç†">è§£æ³•ä¸€çš„è¾¹ç•Œå¤„ç†</h3>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è§£æ³•ä¸€ä¸­æ¯”è¾ƒä¸­é—´å€¼å’Œå³è¾¹ç•Œå€¼ï¼Œè€Œä¸æ˜¯å·¦è¾¹ç•Œå€¼ï¼Ÿè¿™æ˜¯å› ä¸ºï¼š</p>
<ol>
<li>
<p>å¦‚æœæ¯”è¾ƒä¸­é—´å€¼å’Œå·¦è¾¹ç•Œå€¼ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ— æ³•ç¡®å®šæœ€å°å€¼åœ¨å“ªä¸€ä¾§</p>
<ul>
<li>ä¾‹å¦‚ï¼Œåœ¨ <code>[3,4,5,1,2]</code> ä¸­
<ul>
<li><code>nums[mid=2] = 5</code>, <code>nums[left=0] = 3</code>ï¼Œ<code>5 &gt; 3</code>ï¼Œä½†æœ€å°å€¼åœ¨å³ä¾§</li>
</ul>
</li>
<li>ä¾‹å¦‚ï¼Œåœ¨ <code>[5,1,2,3,4]</code> ä¸­
<ul>
<li><code>nums[mid=2] = 2</code>, <code>nums[left=0] = 5</code>ï¼Œ<code>2 &lt; 5</code>ï¼Œä½†æœ€å°å€¼åœ¨å·¦ä¾§</li>
</ul>
</li>
</ul>
</li>
<li>
<p>è€Œæ¯”è¾ƒä¸­é—´å€¼å’Œå³è¾¹ç•Œå€¼å¯ä»¥æ˜ç¡®åˆ¤æ–­ï¼š</p>
<ul>
<li>å¦‚æœ <code>nums[mid] &lt; nums[right]</code>ï¼š<code>[mid, right]</code> æ˜¯æœ‰åºçš„ï¼Œæœ€å°å€¼åœ¨ <code>mid</code> æˆ–å…¶å·¦ä¾§</li>
<li>å¦‚æœ <code>nums[mid] &gt; nums[right]</code>ï¼šæœ€å°å€¼ä¸€å®šåœ¨ <code>mid</code> å³ä¾§</li>
</ul>
</li>
</ol>
<p>ç»ˆæ­¢æ¡ä»¶ <code>left == right</code> ç¡®ä¿äº†æˆ‘ä»¬èƒ½å¤Ÿæ‰¾åˆ°æœ€å°å€¼çš„ç¡®åˆ‡ä½ç½®ã€‚</p>
<h4 id="äºŒåˆ†æŸ¥æ‰¾è¾¹ç•Œæ¡ä»¶çš„ç²¾ç¡®é€‰æ‹©">äºŒåˆ†æŸ¥æ‰¾è¾¹ç•Œæ¡ä»¶çš„ç²¾ç¡®é€‰æ‹©</h4>
<p>åœ¨è¿™é“é¢˜çš„äºŒåˆ†æŸ¥æ‰¾å®ç°ä¸­ï¼Œè¾¹ç•Œæ¡ä»¶çš„é€‰æ‹©å°¤ä¸ºå…³é”®ï¼š</p>
<ol>
<li>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ <code>left &lt; right</code> è€Œä¸æ˜¯ <code>left &lt;= right</code>ï¼Ÿ</strong></p>
<ul>
<li>ä½¿ç”¨ <code>left &lt; right</code> æ„å‘³ç€å½“ <code>left == right</code> æ—¶å¾ªç¯ç»ˆæ­¢</li>
<li>æ­¤æ—¶æœç´¢åŒºé—´ç¼©å°åˆ°åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ å°±æ˜¯æœ€å°å€¼</li>
<li>å¦‚æœä½¿ç”¨ <code>left &lt;= right</code>ï¼Œå½“ <code>left == right</code> æ—¶ï¼Œ<code>mid</code> ä¹Ÿç­‰äº <code>left</code> å’Œ <code>right</code></li>
<li>å¦‚æœè¿›å…¥ <code>right = mid</code> çš„åˆ†æ”¯ï¼Œæœç´¢åŒºé—´ä¸ä¼šç¼©å°ï¼Œå¯¼è‡´æ­»å¾ªç¯</li>
</ul>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ <code>right = mid</code> è€Œä¸æ˜¯ <code>right = mid - 1</code>ï¼Ÿ</strong></p>
<ul>
<li>å½“ <code>nums[mid] &lt; nums[right]</code> æ—¶ï¼Œè¯´æ˜ <code>[mid, right]</code> è¿™ä¸€æ®µæ˜¯æœ‰åºçš„</li>
<li>æ­¤æ—¶æœ€å°å€¼å¯èƒ½æ˜¯ <code>mid</code>ï¼ˆå¦‚æœ <code>mid</code> åˆšå¥½æ˜¯æœ€å°å€¼çš„ä½ç½®ï¼‰</li>
<li>å¦‚æœä½¿ç”¨ <code>right = mid - 1</code>ï¼Œå½“ <code>mid</code> æ˜¯æœ€å°å€¼æ—¶ï¼Œæˆ‘ä»¬ä¼šé”™è¿‡å®ƒ</li>
<li>ä¾‹å¦‚ï¼šåœ¨ <code>[4,5,1,2,3]</code> ä¸­ï¼Œå½“ <code>left=0, right=4, mid=2</code> æ—¶ï¼Œ<code>nums[mid]=1 &lt; nums[right]=3</code></li>
<li>å¦‚æœä½¿ç”¨ <code>right = mid - 1</code>ï¼Œä¼šæŠŠæœç´¢èŒƒå›´ç¼©å°åˆ° <code>[0,1]</code>ï¼Œä»è€Œé”™è¿‡æœ€å°å€¼ <code>1</code></li>
</ul>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ <code>left = mid + 1</code> è€Œä¸æ˜¯ <code>left = mid</code>ï¼Ÿ</strong></p>
<ul>
<li>å½“ <code>nums[mid] &gt;= nums[right]</code> æ—¶ï¼Œè¯´æ˜ <code>mid</code> ä¸å¯èƒ½æ˜¯æœ€å°å€¼</li>
<li>æœ€å°å€¼ä¸€å®šåœ¨ <code>mid</code> çš„å³ä¾§ï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ <code>left = mid + 1</code></li>
<li>å¦‚æœä½¿ç”¨ <code>left = mid</code>ï¼Œå½“ <code>left</code> å’Œ <code>right</code> ç›¸é‚»æ—¶ï¼ˆä¾‹å¦‚ <code>left=4, right=5</code>ï¼‰ï¼Œ</li>
<li>è®¡ç®—å¾—åˆ° <code>mid=4</code>ï¼Œå¦‚æœè¿›å…¥ <code>left = mid</code> åˆ†æ”¯ï¼Œ<code>left</code> ä»ç„¶æ˜¯ <code>4</code>ï¼Œæœç´¢åŒºé—´ä¸å˜</li>
<li>è¿™ä¼šå¯¼è‡´ç®—æ³•é™·å…¥æ­»å¾ªç¯</li>
</ul>
</li>
</ol>
<p>è¿™äº›è¾¹ç•Œæ¡ä»¶çš„ç²¾ç¡®é€‰æ‹©ï¼Œç¡®ä¿äº†ç®—æ³•æ—¢èƒ½æ­£ç¡®æ‰¾åˆ°æœ€å°å€¼ï¼Œåˆèƒ½é«˜æ•ˆåœ°æ”¶æ•›è€Œä¸ä¼šé™·å…¥æ­»å¾ªç¯ã€‚</p>
<h3 id="è§£æ³•äºŒçš„è¾¹ç•Œå¤„ç†">è§£æ³•äºŒçš„è¾¹ç•Œå¤„ç†</h3>
<p>è§£æ³•äºŒçš„è¾¹ç•Œå¤„ç†ä½“ç°åœ¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> index &gt;= <span class="built_in">len</span>(nums) &#123;</span><br><span class="line">	<span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªåˆ¤æ–­æ˜¯ä¸ºäº†å¤„ç†æ•°ç»„æ²¡æœ‰æ—‹è½¬æˆ–æ—‹è½¬äº†æ•´ä¸ªé•¿åº¦ï¼ˆç­‰ä»·äºæ²¡æ—‹è½¬ï¼‰çš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å…ƒç´ å°äº <code>nums[0]</code>ï¼Œ<code>sort.Search</code> ä¼šè¿”å›æ•°ç»„é•¿åº¦ <code>n</code>ï¼Œæ­¤æ—¶ <code>nums[0]</code> å°±æ˜¯æœ€å°å€¼ã€‚</p>
<h4 id="sort-Search-å‡½æ•°çš„è¾¹ç•Œè®¾è®¡">sort.Search å‡½æ•°çš„è¾¹ç•Œè®¾è®¡</h4>
<p>Go è¯­è¨€çš„ <code>sort.Search</code> å‡½æ•°æœ‰å…¶ç‹¬ç‰¹çš„è¾¹ç•Œå¤„ç†æœºåˆ¶ï¼š</p>
<ol>
<li>
<p><strong>æœç´¢åŒºé—´æ˜¯åŠå¼€åŒºé—´ <code>[0, n)</code></strong></p>
<ul>
<li>æ³¨æ„å³è¾¹ç•Œæ˜¯ <code>n</code> è€Œä¸æ˜¯ <code>n-1</code></li>
<li>è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œå½“æ‰€æœ‰å…ƒç´ éƒ½ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œè¿”å›å€¼ä¸º <code>n</code></li>
<li>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥ <code>index &gt;= len(nums)</code> æ¥æ•è·è¿™ç§æƒ…å†µ</li>
</ul>
</li>
<li>
<p><strong>å†…éƒ¨å¾ªç¯ä½¿ç”¨ <code>lo &lt; hi</code></strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// sort.Search çš„ç®€åŒ–å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Search</span><span class="params">(n <span class="type">int</span>, f <span class="keyword">func</span>(<span class="type">int</span>)</span></span> <span class="type">bool</span>) <span class="type">int</span> &#123;</span><br><span class="line">    lo, hi := <span class="number">0</span>, n</span><br><span class="line">    <span class="keyword">for</span> lo &lt; hi &#123;</span><br><span class="line">        mid := lo + (hi-lo)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> f(mid) &#123;</span><br><span class="line">            hi = mid</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lo = mid + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å½“ <code>lo == hi</code> æ—¶é€€å‡ºå¾ªç¯ï¼Œç¡®ä¿æœç´¢ä¼šæ”¶æ•›åˆ°ä¸€ä¸ªç¡®å®šçš„ä½ç½®</li>
<li><code>lo</code> æœ€ç»ˆæŒ‡å‘ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œæˆ–è€…æŒ‡å‘ <code>n</code>ï¼ˆå¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è¾¹ç•Œæ›´æ–°è§„åˆ™</strong></p>
<ul>
<li>å¦‚æœ <code>f(mid)</code> ä¸º <code>true</code>ï¼Œåˆ™ <code>hi = mid</code>ï¼ˆä¸æ˜¯ <code>mid-1</code>ï¼‰</li>
<li>è¿™ç¡®ä¿äº†æ‰¾åˆ°çš„æ˜¯ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ </li>
<li>å¦‚æœ <code>f(mid)</code> ä¸º <code>false</code>ï¼Œåˆ™ <code>lo = mid + 1</code>ï¼ˆä¸æ˜¯ <code>mid</code>ï¼‰</li>
<li>è¿™ç¡®ä¿äº†å¾ªç¯ä¼šç»ˆæ­¢ï¼Œé¿å…æ­»å¾ªç¯</li>
</ul>
</li>
</ol>
<p>å¯¹äºæˆ‘ä»¬çš„é—®é¢˜ï¼Œæ¡ä»¶å‡½æ•°æ˜¯ <code>nums[i] &lt; nums[0]</code>ï¼Œè¡¨ç¤ºä»æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äº <code>nums[0]</code> çš„å…ƒç´ ã€‚è¿™ç§è¾¹ç•Œè®¾è®¡ä½¿å¾— <code>sort.Search</code> éå¸¸é€‚åˆæŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³æŸæ¡ä»¶çš„å…ƒç´ ï¼Œåœ¨æ—‹è½¬æ’åºæ•°ç»„ä¸­æ‰¾æœ€å°å€¼çš„åœºæ™¯ä¸‹å°¤ä¸ºä¼˜é›…ã€‚</p>
<p>å¯¹äºè¾¹ç¼˜æƒ…å†µï¼Œå¦‚æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼š</p>
<ul>
<li>è§£æ³•ä¸€ï¼š<code>left = 0, right = 0</code>ï¼Œå¾ªç¯ä¸ä¼šæ‰§è¡Œï¼Œç›´æ¥è¿”å› <code>nums[0]</code></li>
<li>è§£æ³•äºŒï¼šæ²¡æœ‰å…ƒç´ å°äº <code>nums[0]</code>ï¼Œ<code>sort.Search</code> è¿”å› <code>1</code>ï¼Œæ‰§è¡Œ <code>if index &gt;= len(nums)</code>ï¼Œè¿”å› <code>nums[0]</code></li>
</ul>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p>ä¸¤ç§è§£æ³•çš„å¤æ‚åº¦åˆ†æï¼š</p>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šä¸¤ç§è§£æ³•éƒ½æ˜¯ $O(\log n)$ï¼Œå› ä¸ºå®ƒä»¬éƒ½ä½¿ç”¨äº†äºŒåˆ†æŸ¥æ‰¾ï¼Œæ¯æ¬¡å°†æœç´¢ç©ºé—´å‡åŠ</p>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šä¸¤ç§è§£æ³•éƒ½æ˜¯ $O(1)$ï¼Œåªä½¿ç”¨äº†å¸¸æ•°é¢å¤–ç©ºé—´</p>
<h2 id="è§£æ³•æ¯”è¾ƒ">è§£æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è§£æ³•ä¸€ï¼ˆä¼ ç»ŸäºŒåˆ†ï¼‰</th>
<th>è§£æ³•äºŒï¼ˆsort.Searchï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(\log n)$</td>
<td>$O(\log n)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(1)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>æ›´åŠ ç›´è§‚ï¼Œä¸ä¾èµ–åº“å‡½æ•°</td>
<td>ä»£ç æ›´ç®€æ´ï¼Œåˆ©ç”¨äº†Goè¯­è¨€ç‰¹æ€§</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦æ‰‹åŠ¨å®ç°äºŒåˆ†æŸ¥æ‰¾</td>
<td>éœ€è¦ç†è§£sort.Searchå‡½æ•°çš„ç‰¹æ€§</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>å„ç§è¯­è¨€ç¯å¢ƒ</td>
<td>Goè¯­è¨€ç¯å¢ƒ</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>äºŒåˆ†æŸ¥æ‰¾çš„æ¯”è¾ƒç­–ç•¥å¾ˆé‡è¦</strong>ï¼šåœ¨æ—‹è½¬æ’åºæ•°ç»„ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„æ¯”è¾ƒç­–ç•¥ï¼ˆä¸å·¦è¾¹ç•Œæˆ–å³è¾¹ç•Œæ¯”è¾ƒï¼‰ä¼šç›´æ¥å½±å“ç®—æ³•çš„æ­£ç¡®æ€§</li>
<li><strong>åˆ©ç”¨è¯­è¨€ç‰¹æ€§å¯ä»¥ç®€åŒ–ä»£ç </strong>ï¼šGoè¯­è¨€çš„ <code>sort.Search</code> å‡½æ•°æä¾›äº†ä¸€ç§ç®€æ´çš„äºŒåˆ†æŸ¥æ‰¾å®ç°æ–¹å¼</li>
<li><strong>ç†è§£é—®é¢˜ç»“æ„æ˜¯å…³é”®</strong>ï¼šç†è§£æ—‹è½¬æ’åºæ•°ç»„çš„ç»“æ„ç‰¹ç‚¹ï¼ˆä¸¤ä¸ªæœ‰åºå­æ•°ç»„ï¼‰æœ‰åŠ©äºè®¾è®¡é«˜æ•ˆç®—æ³•</li>
<li><strong>è¾¹ç•Œæƒ…å†µçš„å¤„ç†è‡³å…³é‡è¦</strong>ï¼šç‰¹åˆ«æ³¨æ„æ•°ç»„æœªæ—‹è½¬æˆ–åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æƒ…å†µ</li>
</ol>
<p>è¿™é“é¢˜å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾é«˜æ•ˆè§£å†³æ—‹è½¬æ’åºæ•°ç»„é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•çµæ´»è¿ç”¨è¯­è¨€ç‰¹æ€§ç®€åŒ–ä»£ç å®ç°ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>äºŒåˆ†æŸ¥æ‰¾</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>æ•°ç»„</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLé”æœºåˆ¶è¯¦è§£ï¼šä»åŸç†åˆ°å®è·µ</title>
    <url>/2025/05/08/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-08-MySQL%E9%94%81%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1>MySQL é”æœºåˆ¶æ¦‚è¿°</h1>
<p>é”æ˜¯æ•°æ®åº“ç³»ç»Ÿå®ç°å¹¶å‘æ§åˆ¶çš„æ ¸å¿ƒæœºåˆ¶ï¼ŒMySQL é€šè¿‡å„ç§ç±»å‹çš„é”ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚ç†è§£ MySQL çš„é”æœºåˆ¶å¯¹äºå¼€å‘é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„æ•°æ®åº“åº”ç”¨è‡³å…³é‡è¦ã€‚</p>
<p>åœ¨ MySQL é‡Œï¼Œæ ¹æ®åŠ é”çš„èŒƒå›´ï¼Œå¯ä»¥åˆ†ä¸º<strong>å…¨å±€é”ã€è¡¨çº§é”å’Œè¡Œé”</strong>ä¸‰ç±»ã€‚è¿™ä¸‰ç±»é”çš„ç²’åº¦é€æ¸å˜ç»†ï¼ŒåŠ é”èŒƒå›´é€æ¸å˜å°ï¼Œå¹¶å‘æ€§èƒ½ä¹Ÿé€æ¸æå‡ã€‚</p>
<h2 id="å…¨å±€é”">å…¨å±€é”</h2>
<p><strong>å…¨å±€é”æ˜¯ MySQL ä¸­ç²’åº¦æœ€å¤§çš„é”ï¼Œå®ƒä¼šé”å®šæ•´ä¸ªæ•°æ®åº“å®ä¾‹çš„æ‰€æœ‰è¡¨ï¼Œä½¿æ•´ä¸ªæ•°æ®åº“å¤„äºåªè¯»çŠ¶æ€ã€‚</strong></p>
<h3 id="å…¨å±€é”çš„ä½¿ç”¨æ–¹æ³•">å…¨å±€é”çš„ä½¿ç”¨æ–¹æ³•</h3>
<p>è¦ä½¿ç”¨å…¨å±€é”ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">FLUSH TABLES <span class="keyword">WITH</span> READ LOCK</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œåï¼Œ<strong>æ•´ä¸ªæ•°æ®åº“å°±å¤„äºåªè¯»çŠ¶æ€</strong>ï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œéƒ½ä¼šè¢«é˜»å¡ï¼š</p>
<ul>
<li>å¯¹æ•°æ®çš„å¢åˆ æ”¹æ“ä½œï¼Œæ¯”å¦‚ INSERTã€DELETEã€UPDATE ç­‰è¯­å¥</li>
<li>å¯¹è¡¨ç»“æ„çš„æ›´æ”¹æ“ä½œï¼Œæ¯”å¦‚ ALTER TABLEã€DROP TABLE ç­‰è¯­å¥</li>
</ul>
<h3 id="å…¨å±€é”çš„é‡Šæ”¾æ–¹æ³•">å…¨å±€é”çš„é‡Šæ”¾æ–¹æ³•</h3>
<p>å¦‚æœè¦é‡Šæ”¾å…¨å±€é”ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">UNLOCK TABLES</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œå½“ä¼šè¯æ–­å¼€æ—¶ï¼Œå…¨å±€é”ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</p>
<h3 id="å…¨å±€é”çš„åº”ç”¨åœºæ™¯">å…¨å±€é”çš„åº”ç”¨åœºæ™¯</h3>
<p><strong>å…¨å±€é”ä¸»è¦åº”ç”¨äºå…¨åº“é€»è¾‘å¤‡ä»½</strong>ï¼Œè¿™æ ·åœ¨å¤‡ä»½æ•°æ®åº“æœŸé—´ï¼Œä¸ä¼šå› ä¸ºæ•°æ®æˆ–è¡¨ç»“æ„çš„æ›´æ–°ï¼Œè€Œå¯¼è‡´å¤‡ä»½æ–‡ä»¶æ•°æ®ä¸å®é™…ä¸ä¸€è‡´ã€‚</p>
<h4 id="ä¸ä½¿ç”¨å…¨å±€é”å¯èƒ½å¸¦æ¥çš„é—®é¢˜">ä¸ä½¿ç”¨å…¨å±€é”å¯èƒ½å¸¦æ¥çš„é—®é¢˜</h4>
<p>å‡è®¾åœ¨å…¨åº“é€»è¾‘å¤‡ä»½æœŸé—´ä¸åŠ å…¨å±€é”ï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼š</p>
<ol>
<li>å…ˆå¤‡ä»½äº†ç”¨æˆ·è¡¨çš„æ•°æ®</li>
<li>ç„¶åæœ‰ç”¨æˆ·å‘èµ·äº†è´­ä¹°å•†å“çš„æ“ä½œ</li>
<li>æ¥ç€å†å¤‡ä»½å•†å“è¡¨çš„æ•°æ®</li>
</ol>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤‡ä»½ç»“æœä¼šå‡ºç°ï¼šç”¨æˆ·è¡¨ä¸­è¯¥ç”¨æˆ·çš„ä½™é¢å¹¶æ²¡æœ‰æ‰£é™¤ï¼Œè€Œå•†å“è¡¨ä¸­è¯¥å•†å“çš„åº“å­˜å´è¢«å‡å°‘äº†ã€‚å¦‚æœç”¨è¿™ä¸ªå¤‡ä»½æ–‡ä»¶æ¢å¤æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´ç”¨æˆ·æ²¡èŠ±é’±å°±å¾—åˆ°äº†å•†å“ã€‚</p>
<h3 id="å…¨å±€é”çš„ç¼ºç‚¹">å…¨å±€é”çš„ç¼ºç‚¹</h3>
<p><strong>åŠ ä¸Šå…¨å±€é”ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®åº“éƒ½æ˜¯åªè¯»çŠ¶æ€</strong>ï¼Œè¿™ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>å¦‚æœæ•°æ®åº“æœ‰å¤§é‡æ•°æ®ï¼Œå¤‡ä»½ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´</li>
<li>åœ¨å¤‡ä»½æœŸé—´ï¼Œä¸šåŠ¡åªèƒ½è¯»æ•°æ®è€Œä¸èƒ½æ›´æ–°æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´ä¸šåŠ¡åœæ»</li>
</ul>
<h3 id="å…¨å±€é”çš„æ›¿ä»£æ–¹æ¡ˆ">å…¨å±€é”çš„æ›¿ä»£æ–¹æ¡ˆ</h3>
<p>å¯¹äºæ”¯æŒ<strong>å¯é‡å¤è¯»éš”ç¦»çº§åˆ«</strong>çš„å­˜å‚¨å¼•æ“ï¼ˆå¦‚ InnoDBï¼‰ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š</p>
<p>åœ¨å¤‡ä»½å‰å…ˆå¼€å¯äº‹åŠ¡ï¼Œåˆ©ç”¨ MVCC æœºåˆ¶ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡æ›´æ–°äº†è¡¨çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“å¤‡ä»½æ•°æ®æ—¶çš„ Read Viewã€‚</p>
<p>ä½¿ç”¨ mysqldump å·¥å…·æ—¶ï¼Œå¯ä»¥åŠ ä¸Š <code>--single-transaction</code>å‚æ•°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqldump --single-transaction -uroot -p database &gt; backup.sql</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•åªé€‚ç”¨äºæ”¯æŒ&quot;å¯é‡å¤è¯»éš”ç¦»çº§åˆ«&quot;çš„å­˜å‚¨å¼•æ“ã€‚å¯¹äº MyISAM è¿™ç§ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œä»éœ€ä½¿ç”¨å…¨å±€é”æ–¹å¼å¤‡ä»½ã€‚</p>
<h2 id="è¡¨çº§é”">è¡¨çº§é”</h2>
<p>**è¡¨çº§é”æ˜¯ MySQL ä¸­ç²’åº¦ä¸­ç­‰çš„é”ï¼Œå®ƒé”å®šæ•´å¼ è¡¨ï¼Œè€Œä¸æ˜¯è¡¨ä¸­çš„æŸä¸€è¡Œæˆ–æŸäº›è¡Œã€‚**MySQL ä¸­çš„è¡¨çº§é”ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>è¡¨é”ï¼ˆTable Lockï¼‰</li>
<li>å…ƒæ•°æ®é”ï¼ˆMDLï¼ŒMetadata Lockï¼‰</li>
<li>æ„å‘é”ï¼ˆIntention Lockï¼‰</li>
<li>AUTO-INC é”ï¼ˆè‡ªå¢é”ï¼‰</li>
</ul>
<h3 id="è¡¨é”">è¡¨é”</h3>
<p><strong>è¡¨é”æ˜¯æœ€åŸºæœ¬çš„é”ç­–ç•¥ï¼Œé”å®šæ•´å¼ è¡¨ï¼Œåˆ†ä¸ºè¯»é”ï¼ˆå…±äº«é”ï¼‰å’Œå†™é”ï¼ˆç‹¬å é”ï¼‰ã€‚</strong></p>
<h4 id="è¡¨é”çš„ä½¿ç”¨æ–¹æ³•">è¡¨é”çš„ä½¿ç”¨æ–¹æ³•</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¡¨çº§å…±äº«é”ï¼ˆè¯»é”ï¼‰</span></span><br><span class="line">LOCK TABLES t_student READ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¡¨çº§ç‹¬å é”ï¼ˆå†™é”ï¼‰</span></span><br><span class="line">LOCK TABLES t_student WRITE;</span><br></pre></td></tr></table></figure>
<h4 id="è¡¨é”çš„ç‰¹ç‚¹">è¡¨é”çš„ç‰¹ç‚¹</h4>
<ul>
<li>è¡¨é”ä¼šé™åˆ¶<strong>å…¶ä»–çº¿ç¨‹</strong>çš„è¯»å†™æ“ä½œï¼Œä¹Ÿä¼šé™åˆ¶<strong>å½“å‰çº¿ç¨‹</strong>æ¥ä¸‹æ¥çš„è¯»å†™æ“ä½œ</li>
<li>å¦‚æœå½“å‰çº¿ç¨‹å¯¹è¡¨åŠ äº†å…±äº«é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹åç»­ä¹Ÿæ— æ³•å¯¹è¯¥è¡¨è¿›è¡Œå†™æ“ä½œ</li>
<li>è¡¨é”ç²’åº¦è¾ƒå¤§ï¼Œä¼šå½±å“å¹¶å‘æ€§èƒ½</li>
</ul>
<h4 id="é‡Šæ”¾è¡¨é”çš„æ–¹æ³•">é‡Šæ”¾è¡¨é”çš„æ–¹æ³•</h4>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">UNLOCK TABLES</span><br></pre></td></tr></table></figure>
<p>å½“ä¼šè¯é€€å‡ºåï¼Œä¹Ÿä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰è¡¨é”ã€‚</p>
<h3 id="å…ƒæ•°æ®é”ï¼ˆMDLï¼‰">å…ƒæ•°æ®é”ï¼ˆMDLï¼‰</h3>
<p>**å…ƒæ•°æ®é”æ˜¯ MySQL 5.5 ç‰ˆæœ¬å¼•å…¥çš„è¡¨çº§é”ï¼Œç”¨äºä¿æŠ¤è¡¨çš„ç»“æ„ï¼ˆå…ƒæ•°æ®ï¼‰ã€‚**å®ƒåœ¨å¯¹è¡¨æ‰§è¡Œæ“ä½œæ—¶è‡ªåŠ¨åŠ é”ï¼Œæ— éœ€æ˜¾å¼è°ƒç”¨ã€‚</p>
<h4 id="MDL-é”çš„ç±»å‹">MDL é”çš„ç±»å‹</h4>
<ul>
<li><strong>MDL è¯»é”</strong>ï¼šå¯¹è¡¨è¿›è¡Œ CRUD æ“ä½œæ—¶è‡ªåŠ¨åŠ ä¸Š</li>
<li><strong>MDL å†™é”</strong>ï¼šå¯¹è¡¨ç»“æ„è¿›è¡Œå˜æ›´æ“ä½œæ—¶è‡ªåŠ¨åŠ ä¸Š</li>
</ul>
<h4 id="MDL-é”çš„ä½œç”¨">MDL é”çš„ä½œç”¨</h4>
<p>MDL çš„ä¸»è¦ç›®çš„æ˜¯<strong>é˜²æ­¢åœ¨è¡¨ç»“æ„å˜æ›´æ—¶ï¼Œæœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨å¯¹è¡¨è¿›è¡Œ CRUD æ“ä½œ</strong>ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<ul>
<li>å½“æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œ SELECT è¯­å¥ï¼ˆMDL è¯»é”ï¼‰æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹è¦å˜æ›´è¡¨ç»“æ„ï¼ˆç”³è¯· MDL å†™é”ï¼‰ä¼šè¢«é˜»å¡</li>
<li>å½“æœ‰çº¿ç¨‹åœ¨å˜æ›´è¡¨ç»“æ„ï¼ˆMDL å†™é”ï¼‰æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹æ‰§è¡Œ CRUD æ“ä½œï¼ˆç”³è¯· MDL è¯»é”ï¼‰ä¼šè¢«é˜»å¡</li>
</ul>
<h4 id="MDL-é”çš„é‡Šæ”¾æ—¶æœº">MDL é”çš„é‡Šæ”¾æ—¶æœº</h4>
<p><strong>MDL é”åœ¨äº‹åŠ¡æäº¤åæ‰ä¼šé‡Šæ”¾</strong>ï¼Œè¿™æ„å‘³ç€äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼ŒMDL æ˜¯ä¸€ç›´æŒæœ‰çš„ã€‚</p>
<h4 id="MDL-é”å¯èƒ½å¼•å‘çš„é—®é¢˜">MDL é”å¯èƒ½å¼•å‘çš„é—®é¢˜</h4>
<p>å¦‚æœæ•°æ®åº“æœ‰é•¿æ—¶é—´æœªæäº¤çš„äº‹åŠ¡ï¼ˆé•¿äº‹åŠ¡ï¼‰ï¼Œè€Œæ­¤æ—¶æœ‰è¡¨ç»“æ„å˜æ›´æ“ä½œï¼Œå¯èƒ½ä¼šå¼•å‘è¿é”é˜»å¡ï¼š</p>
<ol>
<li>çº¿ç¨‹ A å¼€å¯äº‹åŠ¡æ‰§è¡Œ SELECTï¼Œè·å– MDL è¯»é”</li>
<li>çº¿ç¨‹ B ä¹Ÿæ‰§è¡Œ SELECTï¼Œä¹Ÿè·å– MDL è¯»é”ï¼ˆè¯»è¯»ä¸å†²çªï¼‰</li>
<li>çº¿ç¨‹ C è¦ä¿®æ”¹è¡¨ç»“æ„ï¼Œç”³è¯· MDL å†™é”ï¼Œè¢«é˜»å¡ï¼ˆè¯»å†™å†²çªï¼‰</li>
<li>ä¹‹åå…¶ä»–çº¿ç¨‹æ‰§è¡Œ SELECT è¯­å¥ï¼Œå› ä¸º MDL å†™é”è¯·æ±‚æ’é˜Ÿåœ¨å‰ï¼Œæ–°çš„ MDL è¯»é”è¯·æ±‚ä¹Ÿä¼šè¢«é˜»å¡</li>
</ol>
<p>è¿™æ˜¯å› ä¸ºç”³è¯· MDL é”çš„æ“ä½œä¼šå½¢æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œ<strong>å†™é”è·å–ä¼˜å…ˆçº§é«˜äºè¯»é”</strong>ï¼Œä¸€æ—¦å‡ºç° MDL å†™é”ç­‰å¾…ï¼Œä¼šé˜»å¡åç»­è¯¥è¡¨çš„æ‰€æœ‰æ“ä½œã€‚</p>
<h3 id="æ„å‘é”">æ„å‘é”</h3>
<p><strong>æ„å‘é”æ˜¯ InnoDB å­˜å‚¨å¼•æ“åœ¨è¡¨çº§åˆ«ä¸Šå¼•å…¥çš„ä¸€ç§é”ï¼Œç”¨äºè¡¨ç¤ºäº‹åŠ¡ç¨ååœ¨è¡¨ä¸­çš„è®°å½•ä¸ŠåŠ é”çš„æ„å‘ã€‚</strong></p>
<h4 id="æ„å‘é”çš„åˆ†ç±»">æ„å‘é”çš„åˆ†ç±»</h4>
<ul>
<li><strong>æ„å‘å…±äº«é”ï¼ˆISï¼‰</strong>ï¼šè¡¨ç¤ºäº‹åŠ¡æ„å›¾åœ¨è¡¨ä¸­çš„æŸäº›è®°å½•ä¸ŠåŠ å…±äº«é”</li>
<li><strong>æ„å‘ç‹¬å é”ï¼ˆIXï¼‰</strong>ï¼šè¡¨ç¤ºäº‹åŠ¡æ„å›¾åœ¨è¡¨ä¸­çš„æŸäº›è®°å½•ä¸ŠåŠ ç‹¬å é”</li>
</ul>
<h4 id="æ„å‘é”çš„ä½œç”¨æœºåˆ¶">æ„å‘é”çš„ä½œç”¨æœºåˆ¶</h4>
<ul>
<li>åœ¨å¯¹è®°å½•åŠ å…±äº«é”å‰ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸Šæ„å‘å…±äº«é”</li>
<li>åœ¨å¯¹è®°å½•åŠ ç‹¬å é”å‰ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸Šæ„å‘ç‹¬å é”</li>
</ul>
<p>æ™®é€šçš„ SELECT ä¸ä¼šåŠ è¡Œçº§é”ï¼Œè€Œæ˜¯åˆ©ç”¨ MVCC å®ç°ä¸€è‡´æ€§è¯»ã€‚ä½†ä»¥ä¸‹è¯­å¥ä¼šåŠ é”ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å…ˆåœ¨è¡¨ä¸ŠåŠ æ„å‘å…±äº«é”ï¼Œç„¶åå¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”</span></span><br><span class="line"><span class="keyword">SELECT</span> ... LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å…ˆåœ¨è¡¨ä¸ŠåŠ æ„å‘ç‹¬å é”ï¼Œç„¶åå¯¹è¯»å–çš„è®°å½•åŠ ç‹¬å é”</span></span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>
<h4 id="æ„å‘é”çš„å…¼å®¹æ€§">æ„å‘é”çš„å…¼å®¹æ€§</h4>
<p><strong>æ„å‘é”ä¹‹é—´ä¸ä¼šå†²çªï¼Œåªä¼šä¸è¡¨é”ï¼ˆå…±äº«è¡¨é”å’Œç‹¬å è¡¨é”ï¼‰å†²çªã€‚</strong></p>
<p>æ„å‘é”çš„ä¸»è¦ç›®çš„æ˜¯<strong>ä¸ºäº†å¿«é€Ÿåˆ¤æ–­è¡¨é‡Œæ˜¯å¦æœ‰è®°å½•è¢«åŠ é”</strong>ï¼Œæé«˜åŠ è¡¨é”æ—¶çš„æ•ˆç‡ã€‚å¦‚æœæ²¡æœ‰æ„å‘é”ï¼ŒåŠ ç‹¬å è¡¨é”æ—¶éœ€è¦éå†è¡¨ä¸­æ‰€æœ‰è®°å½•ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è®°å½•è¢«åŠ é”ï¼Œæ•ˆç‡å¾ˆä½ã€‚</p>
<h3 id="AUTO-INC-é”">AUTO-INC é”</h3>
<p><strong>AUTO-INC é”æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¡¨çº§é”ï¼Œä¸“é—¨ç”¨äºå¤„ç†è‡ªå¢ä¸»é”®çš„åˆ†é…ã€‚</strong></p>
<h4 id="AUTO-INC-é”çš„å·¥ä½œæœºåˆ¶">AUTO-INC é”çš„å·¥ä½œæœºåˆ¶</h4>
<p>å½“è¡¨çš„ä¸»é”®è®¾ç½®äº† AUTO_INCREMENT å±æ€§åï¼Œæ’å…¥æ•°æ®æ—¶å¦‚æœä¸æŒ‡å®šä¸»é”®å€¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªé€’å¢çš„å€¼ã€‚</p>
<p>åœ¨æ’å…¥æ•°æ®æ—¶ï¼ŒMySQL ä¼šå…ˆè·å– AUTO-INC é”ï¼Œç„¶åä¸º AUTO_INCREMENT å­—æ®µèµ‹å€¼ï¼Œ<strong>ä¹‹åç«‹å³é‡Šæ”¾é”ï¼ˆä¸éœ€è¦ç­‰åˆ°äº‹åŠ¡æäº¤ï¼‰</strong>ã€‚</p>
<h4 id="AUTO-INC-é”çš„æ€§èƒ½é—®é¢˜åŠä¼˜åŒ–">AUTO-INC é”çš„æ€§èƒ½é—®é¢˜åŠä¼˜åŒ–</h4>
<p>AUTO-INC é”åœ¨å¤§é‡æ•°æ®æ’å…¥æ“ä½œæ—¶ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºå…¶ä»–æ’å…¥æ“ä½œéœ€è¦ç­‰å¾…é”é‡Šæ”¾ã€‚</p>
<p>ä» MySQL 5.1.22 ç‰ˆæœ¬å¼€å§‹ï¼ŒInnoDB å¼•å…¥äº†<strong>è½»é‡çº§é”</strong>æ¥ä¼˜åŒ–è‡ªå¢é”æœºåˆ¶ï¼š</p>
<ul>
<li>è½»é‡çº§é”åœ¨è·å–è‡ªå¢å€¼åç«‹å³é‡Šæ”¾ï¼Œä¸ç­‰å¾…æ•´ä¸ªæ’å…¥è¯­å¥å®Œæˆ</li>
</ul>
<h4 id="AUTO-INC-é”çš„æ§åˆ¶å‚æ•°">AUTO-INC é”çš„æ§åˆ¶å‚æ•°</h4>
<p>InnoDB æä¾›äº† <code>innodb_autoinc_lock_mode</code>å‚æ•°æ¥æ§åˆ¶è‡ªå¢é”è¡Œä¸ºï¼š</p>
<ul>
<li><code>innodb_autoinc_lock_mode = 0</code>ï¼šä½¿ç”¨ä¼ ç»Ÿçš„ AUTO-INC é”ï¼Œè¯­å¥æ‰§è¡Œå®Œæ‰é‡Šæ”¾</li>
<li><code>innodb_autoinc_lock_mode = 2</code>ï¼šä½¿ç”¨è½»é‡çº§é”ï¼Œè·å–è‡ªå¢å€¼åç«‹å³é‡Šæ”¾</li>
<li><code>innodb_autoinc_lock_mode = 1</code>ï¼šæ··åˆæ¨¡å¼
<ul>
<li>æ™®é€š INSERT è¯­å¥ä½¿ç”¨è½»é‡çº§é”</li>
<li>æ‰¹é‡æ’å…¥è¯­å¥ï¼ˆå¦‚ INSERTâ€¦SELECTï¼‰ä½¿ç”¨ AUTO-INC é”</li>
</ul>
</li>
</ul>
<h4 id="è‡ªå¢é”ä¸ä¸»ä»å¤åˆ¶çš„æ³¨æ„äº‹é¡¹">è‡ªå¢é”ä¸ä¸»ä»å¤åˆ¶çš„æ³¨æ„äº‹é¡¹</h4>
<p>å½“ <code>innodb_autoinc_lock_mode = 2</code>å¹¶ä¸” <code>binlog_format = statement</code>æ—¶ï¼Œåœ¨ä¸»ä»å¤åˆ¶åœºæ™¯ä¸­å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<h5 id="ä¸»ä»ä¸ä¸€è‡´çš„æ¡ˆä¾‹">ä¸»ä»ä¸ä¸€è‡´çš„æ¡ˆä¾‹</h5>
<p>å½“ä¸¤ä¸ªä¼šè¯å¹¶å‘æ’å…¥æ•°æ®æ—¶ï¼š</p>
<ol>
<li>Session B å…ˆæ’å…¥äº†è®°å½•(1,1,1)ã€(2,2,2)</li>
<li>ç„¶å Session A æ’å…¥è®°å½•(3,5,5)</li>
<li>ä¹‹å Session B ç»§ç»­æ’å…¥è®°å½•(4,3,3)ã€(5,4,4)</li>
</ol>
<p>è¿™å¯¼è‡´ Session B è·å¾—çš„è‡ªå¢ ID ä¸è¿ç»­(1,2,4,5)ï¼Œè€Œä¸­é—´çš„ 3 è¢« Session A è·å–ã€‚</p>
<p>ä¸»åº“å‘ç”Ÿè¿™ç§å¹¶å‘æ’å…¥æ—¶ï¼Œå¦‚æœ binlog æ ¼å¼ä¸º statementï¼Œä¸»ä»åº“æ‰§è¡Œé¡ºåºä¸åŒï¼Œä¼šå¯¼è‡´ä»åº“ä¸Šç”Ÿæˆçš„æ•°æ®ä¸ä¸»åº“ä¸ä¸€è‡´ã€‚</p>
<p>æ­£ç¡®é…ç½®ï¼šå½“ <code>innodb_autoinc_lock_mode = 2</code>æ—¶ï¼Œåº”ä½¿ç”¨ <code>binlog_format = row</code>ï¼Œè¿™æ ·ä»åº“ä¼šä½¿ç”¨ä¸ä¸»åº“ç›¸åŒçš„è‡ªå¢å€¼ã€‚</p>
<h2 id="è¡Œçº§é”">è¡Œçº§é”</h2>
<p>**è¡Œçº§é”æ˜¯ MySQL ä¸­ç²’åº¦æœ€ç»†çš„é”ï¼Œå®ƒåªé”å®šç‰¹å®šçš„è¡Œï¼Œè€Œä¸æ˜¯æ•´å¼ è¡¨ï¼Œè¿™å¤§å¤§æé«˜äº†å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚**è¡Œçº§é”åªåœ¨å­˜å‚¨å¼•æ“å±‚å®ç°ï¼ŒInnoDB æ”¯æŒè¡Œçº§é”ï¼Œè€Œ MyISAM ä¸æ”¯æŒã€‚</p>
<h3 id="è¡Œçº§é”çš„ä½¿ç”¨æ–¹æ³•">è¡Œçº§é”çš„ä½¿ç”¨æ–¹æ³•</h3>
<p>æ™®é€šçš„ SELECT è¯­å¥ä¸ä¼šå¯¹è®°å½•åŠ é”ã€‚å¦‚æœéœ€è¦åœ¨æŸ¥è¯¢æ—¶åŠ é”ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”ï¼ˆSé”ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> ... LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯¹è¯»å–çš„è®°å½•åŠ ç‹¬å é”ï¼ˆXé”ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤æ¡è¯­å¥å¿…é¡»åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ï¼Œå› ä¸º<strong>äº‹åŠ¡æäº¤åé”ä¼šè‡ªåŠ¨é‡Šæ”¾</strong>ã€‚ä½¿ç”¨æ—¶éœ€è¦åŠ ä¸Š BEGINã€START TRANSACTION æˆ–è®¾ç½® autocommit=0ã€‚</p>
<h3 id="è¡Œçº§é”çš„å…¼å®¹æ€§">è¡Œçº§é”çš„å…¼å®¹æ€§</h3>
<p>è¡Œçº§é”æœ‰å…±äº«é”ï¼ˆS é”ï¼‰å’Œç‹¬å é”ï¼ˆX é”ï¼‰ä¹‹åˆ†ï¼Œå®ƒä»¬çš„å…¼å®¹å…³ç³»å¦‚ä¸‹ï¼š</p>
<ul>
<li>S é”ä¸ S é”å…¼å®¹ï¼ˆè¯»è¯»å…±äº«ï¼‰</li>
<li>S é”ä¸ X é”ä¸å…¼å®¹ï¼ˆè¯»å†™äº’æ–¥ï¼‰</li>
<li>X é”ä¸ X é”ä¸å…¼å®¹ï¼ˆå†™å†™äº’æ–¥ï¼‰</li>
</ul>
<p><img src="/2025/05/08/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-08-MySQL%E9%94%81%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/1746795271430.png" alt="1746795271430"></p>
<h3 id="è¡Œçº§é”çš„ç±»å‹">è¡Œçº§é”çš„ç±»å‹</h3>
<p>InnoDB å®ç°äº†ä»¥ä¸‹å‡ ç§è¡Œçº§é”ï¼š</p>
<ul>
<li><strong>Record Lockï¼ˆè®°å½•é”ï¼‰</strong>ï¼šé”å®šå•ä¸ªè¡Œè®°å½•</li>
<li><strong>Gap Lockï¼ˆé—´éš™é”ï¼‰</strong>ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…å«è®°å½•æœ¬èº«</li>
<li><strong>Next-Key Lockï¼ˆä¸´é”®é”ï¼‰</strong>ï¼šRecord Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«</li>
<li><strong>æ’å…¥æ„å‘é”</strong>ï¼šä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œè¡¨ç¤ºæ’å…¥æ„å‘</li>
</ul>
<h4 id="Record-Lockï¼ˆè®°å½•é”ï¼‰">Record Lockï¼ˆè®°å½•é”ï¼‰</h4>
<p><strong>è®°å½•é”æ˜¯æœ€åŸºæœ¬çš„è¡Œé”ï¼Œå®ƒé”å®šçš„æ˜¯ç´¢å¼•è®°å½•ï¼Œè€Œéè®°å½•æ‰€åœ¨çš„ç‰©ç†é¡µã€‚</strong></p>
<p>è®°å½•é”åˆ†ä¸º S å‹è®°å½•é”å’Œ X å‹è®°å½•é”ï¼š</p>
<ul>
<li>å½“äº‹åŠ¡å¯¹è®°å½•åŠ äº† S å‹è®°å½•é”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥ç»§ç»­åŠ  S é”ï¼Œä½†ä¸èƒ½åŠ  X é”</li>
<li>å½“äº‹åŠ¡å¯¹è®°å½•åŠ äº† X å‹è®°å½•é”ï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸èƒ½åŠ  S é”ï¼Œä¹Ÿä¸èƒ½åŠ  X é”</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_test <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ¡è¯­å¥ä¼šå¯¹ä¸»é”® id=1 çš„è®°å½•åŠ ä¸Š X å‹è®°å½•é”ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹è¯¥è®°å½•ã€‚</p>
<p><img src="/2025/05/08/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-08-MySQL%E9%94%81%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/1746795281298.png" alt="1746795281298"></p>
<h4 id="Gap-Lockï¼ˆé—´éš™é”ï¼‰">Gap Lockï¼ˆé—´éš™é”ï¼‰</h4>
<p><strong>é—´éš™é”é”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš”ä¸­æ’å…¥æ•°æ®ï¼Œä»è€Œé¿å…å¹»è¯»é—®é¢˜ã€‚</strong></p>
<p>é—´éš™é”åªåœ¨<strong>å¯é‡å¤è¯»éš”ç¦»çº§åˆ«</strong>ä¸‹å­˜åœ¨ï¼Œç›®çš„æ˜¯è§£å†³å¹»è¯»é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸º(3,5)çš„é—´éš™é”ï¼Œå…¶ä»–äº‹åŠ¡å°±æ— æ³•æ’å…¥ id=4 çš„è®°å½•ï¼Œæœ‰æ•ˆé˜²æ­¢äº†å¹»è¯»ã€‚</p>
<p><img src="/2025/05/08/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-08-MySQL%E9%94%81%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/1746795287877.png" alt="1746795287877"></p>
<p><strong>é—´éš™é”çš„ç‰¹æ®Šæ€§</strong>ï¼šè™½ç„¶æœ‰ S å‹å’Œ X å‹ä¹‹åˆ†ï¼Œä½†é—´éš™é”ä¹‹é—´æ˜¯ç›¸äº’å…¼å®¹çš„ã€‚ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™èŒƒå›´çš„é—´éš™é”ï¼Œå› ä¸ºé—´éš™é”çš„ç›®çš„åªæ˜¯é˜²æ­¢æ’å…¥æ“ä½œã€‚</p>
<h4 id="Next-Key-Lockï¼ˆä¸´é”®é”ï¼‰">Next-Key Lockï¼ˆä¸´é”®é”ï¼‰</h4>
<p><strong>Next-Key Lock æ˜¯ Record Lock å’Œ Gap Lock çš„ç»„åˆï¼Œæ—¢é”å®šä¸€ä¸ªèŒƒå›´ï¼Œåˆé”å®šè®°å½•æœ¬èº«ã€‚</strong></p>
<p>ä¾‹å¦‚ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸º(3,5]çš„ Next-Key Lockï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸èƒ½æ’å…¥ id=4 çš„è®°å½•ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹ id=5 çš„è®°å½•ã€‚</p>
<p><img src="/2025/05/08/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-08-MySQL%E9%94%81%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/1746795296158.png" alt="1746795296158"></p>
<p>Next-Key Lock æ—¢èƒ½ä¿æŠ¤è®°å½•ï¼Œåˆèƒ½é˜»æ­¢åœ¨è®°å½•å‰çš„é—´éš™ä¸­æ’å…¥æ–°è®°å½•ï¼Œæ˜¯ InnoDB é»˜è®¤çš„è¡Œé”ç®—æ³•ã€‚</p>
<p><strong>Next-Key Lock çš„å†²çªè§„åˆ™</strong>ï¼šç”±äºåŒ…å«äº†è®°å½•é”ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è·å–äº† X å‹ Next-Key Lockï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•è·å–ç›¸åŒèŒƒå›´çš„ X å‹ Next-Key Lockã€‚</p>
<h4 id="æ’å…¥æ„å‘é”">æ’å…¥æ„å‘é”</h4>
<p><strong>æ’å…¥æ„å‘é”æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œè¡¨ç¤ºäº‹åŠ¡æƒ³è¦åœ¨æŸä¸ªåŒºé—´æ’å…¥è®°å½•çš„æ„å‘ã€‚</strong></p>
<p>å½“ä¸€ä¸ªäº‹åŠ¡è¦æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œéœ€è¦æ£€æŸ¥æ’å…¥ä½ç½®æ˜¯å¦è¢«å…¶ä»–äº‹åŠ¡åŠ äº†é—´éš™é”ï¼š</p>
<ul>
<li>å¦‚æœæœ‰é—´éš™é”ï¼Œæ’å…¥æ“ä½œä¼šè¢«é˜»å¡</li>
<li>æ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼ŒçŠ¶æ€ä¸ºç­‰å¾…ï¼Œç›´åˆ°é—´éš™é”é‡Šæ”¾</li>
</ul>
<p>ä¾‹å¦‚ï¼Œäº‹åŠ¡ A å·²ç»å¯¹è¡¨åŠ äº†(3,5)é—´éš™é”ï¼š</p>
<p><img src="/2025/05/08/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E9%94%81/2025-05-08-MySQL%E9%94%81%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/1746795304573.png" alt="1746795304573"></p>
<p>å½“äº‹åŠ¡ B å°è¯•æ’å…¥ id=4 çš„è®°å½•æ—¶ï¼Œä¼šè¢«é˜»å¡å¹¶ç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç›´åˆ°äº‹åŠ¡ A æäº¤ã€‚</p>
<p><strong>æ’å…¥æ„å‘é”ä¸é—´éš™é”çš„å…³ç³»</strong>ï¼š</p>
<ul>
<li>æ’å…¥æ„å‘é”æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œä½†é”ä½çš„æ˜¯ä¸€ä¸ªç‚¹è€ŒéåŒºé—´</li>
<li>æ’å…¥æ„å‘é”ä¸é—´éš™é”ä¸å…¼å®¹ï¼šåŒä¸€æ—¶é—´å†…ï¼Œä¸èƒ½ä¸€ä¸ªäº‹åŠ¡æŒæœ‰é—´éš™é”ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æŒæœ‰è¯¥é—´éš™å†…çš„æ’å…¥æ„å‘é”</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>é”</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>å¹¶å‘æ§åˆ¶</tag>
        <tag>é”æœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 33 - æœç´¢æ—‹è½¬æ’åºæ•°ç»„é”™è¯¯åˆ†æ</title>
    <url>/2025/05/08/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-33-%E6%90%9C%E7%B4%A2%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84-%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p><a href="https://leetcode.cn/problems/search-in-rotated-sorted-array/">æœç´¢æ—‹è½¬æ’åºæ•°ç»„</a> æ˜¯ä¸€ä¸ªç»å…¸çš„äºŒåˆ†æŸ¥æ‰¾å˜ç§é—®é¢˜ï¼š</p>
<p>æ•´æ•°æ•°ç»„ <code>nums</code> æŒ‰å‡åºæ’åˆ—ï¼Œæ•°ç»„ä¸­çš„å€¼ <strong>äº’ä¸ç›¸åŒ</strong> ã€‚</p>
<p>åœ¨ä¼ é€’ç»™å‡½æ•°ä¹‹å‰ï¼Œ<code>nums</code> åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªä¸‹æ ‡ <code>k</code> ä¸Šè¿›è¡Œäº†æ—‹è½¬ï¼Œä½¿æ•°ç»„å˜ä¸º <code>[nums[k], nums[k+1], ..., nums[n-1], nums[0], nums[1], ..., nums[k-1]]</code>ï¼ˆä¸‹æ ‡ <strong>ä» 0 å¼€å§‹</strong> è®¡æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼Œ <code>[0,1,2,4,5,6,7]</code> åœ¨ä¸‹æ ‡ <code>3</code> å¤„ç»æ—‹è½¬åå¯èƒ½å˜ä¸º <code>[4,5,6,7,0,1,2]</code> ã€‚</p>
<p>ç»™ä½  <strong>æ—‹è½¬å</strong> çš„æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>target</code> ï¼Œå¦‚æœ <code>nums</code> ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ <code>target</code> ï¼Œåˆ™è¿”å›å®ƒçš„ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› <code>-1</code> ã€‚</p>
<p>ä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º <code>O(log n)</code> çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [4,5,6,7,0,1,2], target = 0</span><br><span class="line">è¾“å‡ºï¼š4</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [4,5,6,7,0,1,2], target = 3</span><br><span class="line">è¾“å‡ºï¼š-1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1], target = 0</span><br><span class="line">è¾“å‡ºï¼š-1</span><br></pre></td></tr></table></figure>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘åˆå§‹çš„è§£æ³•æ€è·¯æ˜¯ï¼š</p>
<ol>
<li>å…ˆæ‰¾åˆ°æ—‹è½¬ç‚¹ï¼ˆæ•°ç»„ä¸­å€¼çªç„¶ä¸‹é™çš„ä½ç½®ï¼‰</li>
<li>æ ¹æ®æ—‹è½¬ç‚¹å°†æ•°ç»„åˆ†æˆä¸¤éƒ¨åˆ†</li>
<li>ç¡®å®š target åœ¨å“ªä¸ªéƒ¨åˆ†ï¼Œç„¶ååœ¨ç›¸åº”éƒ¨åˆ†ä¸­ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</li>
</ol>
<p>ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">search</span><span class="params">(nums []<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// æ‰¾åˆ°æ—‹è½¬ç‚¹</span></span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	rotateIdx := sort.Search(n, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> nums[i] &gt; nums[i+<span class="number">1</span>]  <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šå¯èƒ½å¯¼è‡´æ•°ç»„è¶Šç•Œ</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> rotateIdx == n<span class="number">-1</span> &#123;</span><br><span class="line">		rotateIdx = <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> rotateIdx == <span class="number">-1</span> || target &lt; nums[<span class="number">0</span>] &#123;</span><br><span class="line">		idx := sort.SearchInts(nums[rotateIdx+<span class="number">1</span>:], target)</span><br><span class="line">		<span class="keyword">if</span> idx+rotateIdx+<span class="number">1</span> &lt; n &amp;&amp; nums[idx+rotateIdx+<span class="number">1</span>] == target &#123;</span><br><span class="line">			<span class="keyword">return</span> idx + rotateIdx + <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		idx := sort.SearchInts(nums[:rotateIdx+<span class="number">1</span>], target)</span><br><span class="line">		<span class="keyword">if</span> idx &lt; rotateIdx+<span class="number">1</span> &amp;&amp; nums[idx] == target &#123;</span><br><span class="line">			<span class="keyword">return</span> idx</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>è¿™ä¸ªè§£æ³•å­˜åœ¨å‡ ä¸ªä¸¥é‡é—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>æ•°ç»„è¶Šç•Œé£é™©</strong>ï¼šåœ¨ä½¿ç”¨ <code>sort.Search</code> æŸ¥æ‰¾æ—‹è½¬ç‚¹æ—¶ï¼Œå›è°ƒå‡½æ•° <code>return nums[i] &gt; nums[i+1]</code> å¯èƒ½å¯¼è‡´æ•°ç»„è¶Šç•Œã€‚å½“ <code>i = n-1</code> æ—¶ï¼Œ<code>nums[i+1]</code> ä¼šè®¿é—®è¶…å‡ºæ•°ç»„èŒƒå›´çš„å…ƒç´ ã€‚</p>
</li>
<li>
<p><strong>æ ‡å‡†äºŒåˆ†æœç´¢ä¸é€‚åˆæŸ¥æ‰¾æ—‹è½¬ç‚¹</strong>ï¼š</p>
<ul>
<li><code>sort.Search</code> å‡è®¾æ•°ç»„æ»¡è¶³æŸç§å•è°ƒæ€§ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªä½¿è°“è¯å‡½æ•°ä¸ºtrueçš„ç´¢å¼•</li>
<li>ä½†åœ¨æ—‹è½¬æ•°ç»„ä¸­ï¼Œ<strong>è°“è¯å‡½æ•° <code>nums[i] &gt; nums[i+1]</code> ä¸å…·æœ‰é¢„æœŸçš„å•è°ƒæ€§</strong></li>
<li>å¯¹äºå®Œå…¨æœ‰åºçš„æ•°ç»„ï¼ˆå¦‚ <code>[1,2,3,4]</code>ï¼‰ï¼Œä¸å­˜åœ¨ <code>nums[i] &gt; nums[i+1]</code> çš„æƒ…å†µï¼Œæ­¤æ—¶ <code>sort.Search</code> ä¼šè¿”å› <code>n</code>ï¼Œè¶…å‡ºæ•°ç»„æœ‰æ•ˆèŒƒå›´</li>
</ul>
</li>
<li>
<p><strong>æ—‹è½¬ç‚¹æŸ¥æ‰¾é€»è¾‘ä¸å®Œå–„</strong>ï¼š</p>
<ul>
<li>ä»£ç é€šè¿‡æ£€æŸ¥ <code>rotateIdx == n-1</code> è¯•å›¾è§£å†³å®Œå…¨æœ‰åºçš„æƒ…å†µï¼Œä½†è¿™ä¸ªä¿®å¤ä¸å½»åº•ä¸”å®¹æ˜“è¯¯åˆ¤</li>
<li>å½“æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ä¹Ÿå¯èƒ½å‡ºç°é—®é¢˜</li>
</ul>
</li>
<li>
<p><strong>å¤æ‚ä¸”ä¸ç›´è§‚</strong>ï¼šè¿™ç§&quot;å…ˆæ‰¾æ—‹è½¬ç‚¹å†æœç´¢&quot;çš„ä¸¤æ­¥æ³•ä½¿ä»£ç å˜å¾—å¤æ‚ï¼Œä¸”å®¹æ˜“å‡ºé”™</p>
</li>
</ol>
<h2 id="æ­£ç¡®æŸ¥æ‰¾æ—‹è½¬ç‚¹çš„æ–¹æ³•">æ­£ç¡®æŸ¥æ‰¾æ—‹è½¬ç‚¹çš„æ–¹æ³•</h2>
<p>å¦‚æœç¡®å®éœ€è¦å…ˆæ‰¾åˆ°æ—‹è½¬ç‚¹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ›´å¯é çš„æ–¹æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findRotateIndex</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    left, right := <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœæ•°ç»„å®Œå…¨æœ‰åºï¼ˆæœªæ—‹è½¬ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> nums[left] &lt;= nums[right] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> <span class="comment">// æˆ–è¿”å›-1ï¼Œè¡¨ç¤ºæ— æ—‹è½¬</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// äºŒåˆ†æŸ¥æ‰¾æ—‹è½¬ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> left &lt; right &#123;</span><br><span class="line">        mid := left + (right-left)/<span class="number">2</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> nums[mid] &gt; nums[right] &#123;</span><br><span class="line">            <span class="comment">// æ—‹è½¬ç‚¹åœ¨å³åŠéƒ¨åˆ†</span></span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ—‹è½¬ç‚¹åœ¨å·¦åŠéƒ¨åˆ†æˆ–å°±æ˜¯mid</span></span><br><span class="line">            right = mid</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> left <span class="comment">// æ­¤æ—¶leftå°±æ˜¯æ—‹è½¬ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæŸ¥æ‰¾æ—‹è½¬ç‚¹çš„ç®—æ³•åŸºäºä»¥ä¸‹è§‚å¯Ÿï¼š</p>
<ul>
<li>å¦‚æœ <code>nums[mid] &gt; nums[right]</code>ï¼Œè¯´æ˜æ—‹è½¬ç‚¹åœ¨ <code>mid</code> ä¹‹å</li>
<li>å¦åˆ™ï¼Œæ—‹è½¬ç‚¹åœ¨ <code>mid</code> æˆ–ä¹‹å‰</li>
</ul>
<p>ä¸ <code>sort.Search</code> ä¸åŒï¼Œè¿™ä¸ªç®—æ³•æ˜ç¡®åˆ©ç”¨äº†æ—‹è½¬æ•°ç»„çš„ç‰¹æ€§ï¼Œä¸ä¾èµ–äºç´¢å¼•è®¿é—®çš„å•è°ƒæ€§ï¼Œä¹Ÿä¸ä¼šæœ‰æ•°ç»„è¶Šç•Œé—®é¢˜ã€‚</p>
<h2 id="æœ€ä¼˜è§£æ³•ï¼šä¸€æ­¥åˆ°ä½">æœ€ä¼˜è§£æ³•ï¼šä¸€æ­¥åˆ°ä½</h2>
<p>ä¸€ä¸ªæ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ©ç”¨æ—‹è½¬æ’åºæ•°ç»„çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼š<strong>å°†æ•°ç»„ä¸€åˆ†ä¸ºäºŒï¼Œè‡³å°‘æœ‰ä¸€åŠæ˜¯æœ‰åºçš„</strong>ã€‚æˆ‘ä»¬å¯ä»¥åœ¨äºŒåˆ†æŸ¥æ‰¾çš„åŒæ—¶ç¡®å®šç›®æ ‡å€¼çš„ä½ç½®ï¼Œæ— éœ€å…ˆæ‰¾åˆ°æ—‹è½¬ç‚¹ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">search</span><span class="params">(nums []<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	left, right := <span class="number">0</span>, n<span class="number">-1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">		mid := left + (right-left)/<span class="number">2</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> nums[mid] == target &#123;</span><br><span class="line">			<span class="keyword">return</span> mid</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// åˆ¤æ–­å“ªä¸€éƒ¨åˆ†æ˜¯æœ‰åºçš„</span></span><br><span class="line">		<span class="keyword">if</span> nums[left] &lt;= nums[mid] &#123; <span class="comment">// å·¦åŠéƒ¨åˆ†æœ‰åº</span></span><br><span class="line">			<span class="keyword">if</span> nums[left] &lt;= target &amp;&amp; target &lt; nums[mid] &#123;</span><br><span class="line">				<span class="comment">// targetåœ¨å·¦åŠéƒ¨åˆ†</span></span><br><span class="line">				right = mid - <span class="number">1</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// targetåœ¨å³åŠéƒ¨åˆ†</span></span><br><span class="line">				left = mid + <span class="number">1</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; <span class="comment">// å³åŠéƒ¨åˆ†æœ‰åº</span></span><br><span class="line">			<span class="keyword">if</span> nums[mid] &lt; target &amp;&amp; target &lt;= nums[right] &#123;</span><br><span class="line">				<span class="comment">// targetåœ¨å³åŠéƒ¨åˆ†</span></span><br><span class="line">				left = mid + <span class="number">1</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// targetåœ¨å·¦åŠéƒ¨åˆ†</span></span><br><span class="line">				right = mid - <span class="number">1</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ">ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ</h3>
<p>è¿™ä¸ªè§£æ³•åŸºäºä»¥ä¸‹è§‚å¯Ÿï¼š</p>
<ol>
<li>
<p>åœ¨æ—‹è½¬æ’åºæ•°ç»„ä¸­ï¼Œæ— è®ºå¦‚ä½•åˆ‡åˆ†ï¼Œæ€»æœ‰ä¸€éƒ¨åˆ†æ˜¯æœ‰åºçš„</p>
<ul>
<li>å¦‚æœ <code>nums[left] &lt;= nums[mid]</code>ï¼Œåˆ™å·¦åŠéƒ¨åˆ†æœ‰åº</li>
<li>å¦åˆ™ï¼Œå³åŠéƒ¨åˆ†æœ‰åº</li>
</ul>
</li>
<li>
<p>çŸ¥é“å“ªéƒ¨åˆ†æœ‰åºåï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåˆ¤æ–­ target æ˜¯å¦åœ¨æœ‰åºéƒ¨åˆ†èŒƒå›´å†…ï¼š</p>
<ul>
<li>å¦‚æœ target åœ¨æœ‰åºéƒ¨åˆ†èŒƒå›´å†…ï¼Œæˆ‘ä»¬åªéœ€åœ¨è¯¥éƒ¨åˆ†ç»§ç»­æœç´¢</li>
<li>å¦åˆ™ï¼Œtarget å¿…ç„¶åœ¨å¦ä¸€éƒ¨åˆ†ä¸­</li>
</ul>
</li>
<li>
<p>æ¯æ¬¡è¿­ä»£éƒ½ä¼šå°†æœç´¢èŒƒå›´ç¼©å°ä¸€åŠï¼Œä¿æŒäº†äºŒåˆ†æŸ¥æ‰¾çš„ O(log n) å¤æ‚åº¦</p>
</li>
</ol>
<p>è¿™ç§æ–¹æ³•ç›´æ¥åœ¨äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹ä¸­ç¡®å®šç›®æ ‡ä½ç½®ï¼Œæ— éœ€å…ˆæ‰¾åˆ°æ—‹è½¬ç‚¹ï¼Œä»£ç æ›´ç®€æ´ï¼Œé”™è¯¯é£é™©æ›´å°ï¼Œä»æ ¹æœ¬ä¸Šé¿å…äº†é”™è¯¯åœ°åº”ç”¨æ ‡å‡†äºŒåˆ†æŸ¥æ‰¾æ¥å¯»æ‰¾æ—‹è½¬ç‚¹ã€‚</p>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>ä»è¿™ä¸ªé”™è¯¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å­¦åˆ°å‡ ä¸ªé‡è¦çš„ç®—æ³•è®¾è®¡åŸåˆ™ï¼š</p>
<ol>
<li>
<p><strong>è°¨æ…ä½¿ç”¨æ ‡å‡†åº“å‡½æ•°</strong>ï¼š</p>
<ul>
<li>åƒ <code>sort.Search</code> è¿™æ ·çš„æ ‡å‡†åº“å‡½æ•°æœ‰ç‰¹å®šçš„åº”ç”¨åœºæ™¯å’Œå‡è®¾æ¡ä»¶</li>
<li>åœ¨ä½¿ç”¨å‰ï¼Œç¡®ä¿ä½ çš„é—®é¢˜ç¡®å®ç¬¦åˆè¿™äº›æ¡ä»¶</li>
</ul>
</li>
<li>
<p><strong>é˜²æ­¢æ•°ç»„è¶Šç•Œ</strong>ï¼šåœ¨ç¼–å†™æ¶‰åŠæ•°ç»„ç´¢å¼•çš„ä»£ç æ—¶ï¼Œå§‹ç»ˆè¦è€ƒè™‘è¾¹ç•Œæ¡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨ <code>i+1</code> æˆ– <code>i-1</code> ç­‰æ“ä½œæ—¶</p>
</li>
<li>
<p><strong>ç®€åŒ–é—®é¢˜</strong>ï¼šæœ‰æ—¶å€™ï¼Œçœ‹ä¼¼éœ€è¦ä¸¤æ­¥çš„æ“ä½œï¼ˆå…ˆæ‰¾æ—‹è½¬ç‚¹ï¼Œå†æŸ¥æ‰¾ç›®æ ‡ï¼‰å¯ä»¥é€šè¿‡å·§å¦™çš„ç®—æ³•è®¾è®¡åˆå¹¶ä¸ºä¸€æ­¥ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€æ›´å¯é </p>
</li>
<li>
<p><strong>åˆ©ç”¨é—®é¢˜ç‰¹æ€§</strong>ï¼šæ—‹è½¬æ’åºæ•°ç»„çš„å…³é”®ç‰¹æ€§æ˜¯&quot;éƒ¨åˆ†æœ‰åº&quot;ï¼Œç›´æ¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§æ¯”è¯•å›¾æ¢å¤å®Œå…¨æœ‰åºæ›´é«˜æ•ˆ</p>
</li>
<li>
<p><strong>äºŒåˆ†æŸ¥æ‰¾çš„å˜ç§</strong>ï¼šæ ‡å‡†äºŒåˆ†æŸ¥æ‰¾å¯ä»¥æ ¹æ®å…·ä½“é—®é¢˜è¿›è¡Œè°ƒæ•´ï¼Œå…³é”®æ˜¯æ¯æ¬¡éƒ½å°†æœç´¢ç©ºé—´å‡åŠï¼ŒåŒæ—¶ä¿æŒç›®æ ‡å€¼åœ¨æœç´¢ç©ºé—´å†…</p>
</li>
</ol>
<p>è¿™ä¸ªé—®é¢˜æé†’æˆ‘ä»¬ï¼Œåœ¨å®ç°ç®—æ³•æ—¶ï¼Œå…ˆæ€è€ƒé—®é¢˜çš„æœ¬è´¨ç‰¹æ€§ï¼Œå¾€å¾€èƒ½æ‰¾åˆ°æ›´ç®€æ´ä¼˜é›…çš„è§£æ³•ï¼Œè€Œä¸æ˜¯æœºæ¢°åœ°å¥—ç”¨æ ‡å‡†ç®—æ³•æ¨¡æ¿ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>äºŒåˆ†æŸ¥æ‰¾</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 74 - æœç´¢äºŒç»´çŸ©é˜µ - é”™è¯¯åˆ†æ</title>
    <url>/2025/05/08/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-74-%E6%90%9C%E7%B4%A2%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5-%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p><a href="https://leetcode.cn/problems/search-a-2d-matrix/">LeetCode 74 - æœç´¢äºŒç»´çŸ©é˜µ</a>æ˜¯ä¸€ä¸ªä¸­ç­‰éš¾åº¦çš„äºŒåˆ†æŸ¥æ‰¾é—®é¢˜ã€‚</p>
<p>é¢˜ç›®è¦æ±‚åœ¨ä¸€ä¸ªæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„ m Ã— n çŸ©é˜µä¸­ï¼Œé«˜æ•ˆåœ°æŸ¥æ‰¾ç›®æ ‡å€¼ targetï¼š</p>
<ol>
<li>æ¯è¡Œä¸­çš„æ•´æ•°ä»å·¦åˆ°å³æŒ‰éä¸¥æ ¼é€’å¢é¡ºåºæ’åˆ—</li>
<li>æ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•´æ•°å¤§äºå‰ä¸€è¡Œçš„æœ€åä¸€ä¸ªæ•´æ•°</li>
</ol>
<p>éœ€è¦åˆ¤æ–­ target æ˜¯å¦åœ¨çŸ©é˜µä¸­å­˜åœ¨ï¼Œå­˜åœ¨è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<p><img src="/2025/05/08/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-74-%E6%90%9C%E7%B4%A2%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5-%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/1746685273722.png" alt="1746685273722"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix = [[1,3,5,7],[10,11,16,20],[23,30,34,60]], target = 3</span><br><span class="line">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<p><img src="/2025/05/08/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-74-%E6%90%9C%E7%B4%A2%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5-%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/1746685282110.png" alt="1746685282110"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix = [[1,3,5,7],[10,11,16,20],[23,30,34,60]], target = 13</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>$m = matrix.length$</li>
<li>$n = matrix[i].length$</li>
<li>$1 \leq m, n \leq 100$</li>
<li>$-10^4 \leq matrix[i][j], target \leq 10^4$</li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘å°è¯•äº†å‡ ç§è§£æ³•ï¼Œä½†å…¶ä¸­ä¸‰ä¸ªè§£æ³•éƒ½å­˜åœ¨é”™è¯¯ã€‚ä¸‹é¢æ˜¯å¯¹è¿™äº›é”™è¯¯è§£æ³•çš„è¯¦ç»†åˆ†æã€‚</p>
<h3 id="é”™è¯¯è§£æ³•-1ï¼šé”™è¯¯çš„è¾¹ç•Œæ£€æŸ¥">é”™è¯¯è§£æ³• 1ï¼šé”™è¯¯çš„è¾¹ç•Œæ£€æŸ¥</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrix</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	n, m := <span class="built_in">len</span>(matrix), <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">	row := sort.Search(n, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> matrix[i][m<span class="number">-1</span>] &gt;= target</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šä½¿ç”¨åˆ—æ•°(m)è€Œéè¡Œæ•°(n)è¿›è¡Œè¾¹ç•Œæ£€æŸ¥</span></span><br><span class="line">	<span class="keyword">if</span> row &gt;= m &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	col := sort.SearchInts(matrix[row], target)</span><br><span class="line">	<span class="keyword">return</span> matrix[row][col] == target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯åŸå› åˆ†æï¼š</strong></p>
<p>è¿™ä¸ªè§£æ³•ä¸­çš„ä¸»è¦é”™è¯¯åœ¨äºè¾¹ç•Œæ£€æŸ¥ä½¿ç”¨äº†åˆ—æ•°è€Œä¸æ˜¯è¡Œæ•°ã€‚åœ¨æ£€æŸ¥äºŒåˆ†æŸ¥æ‰¾è¿”å›çš„è¡Œç´¢å¼•æ˜¯å¦è¶Šç•Œæ—¶ï¼Œåº”è¯¥ä¸çŸ©é˜µçš„è¡Œæ•° <code>n</code> è¿›è¡Œæ¯”è¾ƒï¼Œè€Œä¸æ˜¯åˆ—æ•° <code>m</code>ã€‚</p>
<p>å½“ <code>row &gt;= n</code> æ—¶ï¼Œè¡¨ç¤ºæ‰¾ä¸åˆ°è¡Œæ»¡è¶³æ¡ä»¶ï¼ˆæ‰€æœ‰è¡Œçš„æœ€åä¸€ä¸ªå…ƒç´ éƒ½å°äº targetï¼‰ï¼Œæ­¤æ—¶åº”è¯¥è¿”å› falseã€‚</p>
<p>ä½†æ˜¯åœ¨é”™è¯¯ä»£ç ä¸­ï¼Œä½¿ç”¨äº† <code>if row &gt;= m</code>ï¼Œè¿™ä¼šå¯¼è‡´åœ¨ç‰¹å®šæƒ…å†µä¸‹å‡ºç°é—®é¢˜ï¼š</p>
<ul>
<li>å½“è¡Œæ•°å¤§äºåˆ—æ•°æ—¶ï¼ˆn &gt; mï¼‰ï¼Œå¦‚æœ n &gt; row &gt;= mï¼Œä¼šé”™è¯¯åœ°è¿”å› false</li>
<li>å½“è¡Œæ•°å°äºåˆ—æ•°æ—¶ï¼ˆn &lt; mï¼‰ï¼Œå¦‚æœ row &gt;= n ä½† row &lt; mï¼Œä¼šç»§ç»­æ‰§è¡Œå¯¼è‡´æ•°ç»„ç´¢å¼•è¶Šç•Œ</li>
</ul>
<p>è¿™ä¸ªé”™è¯¯çš„ä¸¥é‡æ€§å–å†³äºçŸ©é˜µçš„å½¢çŠ¶ï¼Œä½†åœ¨æœ€åæƒ…å†µä¸‹ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>
<h3 id="é”™è¯¯è§£æ³•-2ï¼šé”™è¯¯çš„æœç´¢ç­–ç•¥å’Œç¼ºå°‘è¾¹ç•Œæ£€æŸ¥">é”™è¯¯è§£æ³• 2ï¼šé”™è¯¯çš„æœç´¢ç­–ç•¥å’Œç¼ºå°‘è¾¹ç•Œæ£€æŸ¥</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrix</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šé”™è¯¯çš„è¡Œé€‰æ‹©ç­–ç•¥</span></span><br><span class="line">	row := sort.Search(<span class="built_in">len</span>(matrix), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> matrix[i][<span class="number">0</span>] &gt;= target</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šç¼ºå°‘è¾¹ç•Œæ£€æŸ¥</span></span><br><span class="line">	col := sort.SearchInts(matrix[row], target)</span><br><span class="line">	<span class="keyword">return</span> matrix[row][col] == target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯åŸå› åˆ†æï¼š</strong></p>
<p>è¿™ä¸ªè§£æ³•å­˜åœ¨ä¸¤ä¸ªä¸¥é‡é—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>é”™è¯¯çš„æœç´¢ç­–ç•¥</strong>ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªé¦–å…ƒç´ å¤§äºç­‰äº target çš„è¡Œï¼Œè¿™ä¸é—®é¢˜çš„æœ€ä¼˜è§£æ³•ä¸ç¬¦ã€‚ç”±äºçŸ©é˜µçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬åº”è¯¥æ‰¾åˆ°æœ€åä¸€ä¸ªæœ€å¤§å…ƒç´ å°äºç­‰äº target çš„è¡Œï¼ˆå³ç¬¬ä¸€ä¸ªæœ€å¤§å…ƒç´ å¤§äº target çš„è¡Œçš„å‰ä¸€è¡Œï¼‰ï¼Œæˆ–è€…æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœ€å¤§å…ƒç´ å¤§äºç­‰äº target çš„è¡Œã€‚</p>
</li>
<li>
<p><strong>ç¼ºå°‘è¾¹ç•Œæ£€æŸ¥</strong>ï¼šæ²¡æœ‰æ£€æŸ¥ <code>row</code> æ˜¯å¦è¶Šç•Œã€‚å¦‚æœ target å¤§äºçŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œ<code>sort.Search</code> å¯èƒ½è¿”å›ç­‰äº <code>len(matrix)</code> çš„å€¼ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ªç´¢å¼•ä¼šå¯¼è‡´ <code>matrix[row]</code> æ•°ç»„è¶Šç•Œè®¿é—®ã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªé”™è¯¯è§£æ³•åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šå¤±è´¥ï¼š</p>
<ul>
<li>å½“ target å¤§äºçŸ©é˜µä¸­æ‰€æœ‰å…ƒç´ æ—¶ï¼ˆè¿”å› <code>row = len(matrix)</code>ï¼‰</li>
<li>å½“ target å°äºçŸ©é˜µä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼ˆå¯èƒ½æ‰¾é”™è¡Œï¼‰</li>
</ul>
<h3 id="é”™è¯¯è§£æ³•-3ï¼šå¯¹æœç´¢ç»“æœå¤„ç†ä¸å½“">é”™è¯¯è§£æ³• 3ï¼šå¯¹æœç´¢ç»“æœå¤„ç†ä¸å½“</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrix</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	n, m := <span class="built_in">len</span>(matrix), <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">	<span class="comment">// âŒ é”™è¯¯ç‚¹1ï¼šä½¿ç”¨äº† &gt; è€Œä¸æ˜¯ &gt;= ä½œä¸ºæ¯”è¾ƒæ¡ä»¶</span></span><br><span class="line">	row := sort.Search(n, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> matrix[i][m<span class="number">-1</span>] &gt; target</span><br><span class="line">	&#125;) - <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// âŒ é”™è¯¯ç‚¹2ï¼šè°ƒè¯•ä»£ç é—ç•™åœ¨ç”Ÿäº§ä»£ç ä¸­</span></span><br><span class="line">	log.Println(row)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// âŒ é”™è¯¯ç‚¹3ï¼šæ²¡æœ‰æ£€æŸ¥ row æ˜¯å¦æœ‰æ•ˆï¼ˆå¯èƒ½ä¸ºè´Ÿæ•°ï¼‰</span></span><br><span class="line">	col := sort.SearchInts(matrix[row], target)</span><br><span class="line">	<span class="keyword">return</span> matrix[row][col] == target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯åŸå› åˆ†æï¼š</strong></p>
<p>è¿™ä¸ªè§£æ³•å­˜åœ¨ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>æ¯”è¾ƒæ¡ä»¶ä¸å½“</strong>ï¼šä½¿ç”¨äº† <code>matrix[i][m-1] &gt; target</code> è€Œä¸æ˜¯ <code>matrix[i][m-1] &gt;= target</code>ã€‚å½“æˆ‘ä»¬å¯»æ‰¾ç¬¬ä¸€ä¸ªæœ€å¤§å…ƒç´ å¤§äºç­‰äº target çš„è¡Œæ—¶ï¼Œè¿™å¯èƒ½å¯¼è‡´æ‰¾é”™è¡Œï¼Œç‰¹åˆ«æ˜¯å½“ target æ°å¥½ç­‰äºæŸè¡Œçš„æœ€åä¸€ä¸ªå…ƒç´ æ—¶ã€‚</p>
</li>
<li>
<p><strong>æœªå¤„ç†è¾¹ç•Œæƒ…å†µ</strong>ï¼šç›´æ¥å¯¹ <code>sort.Search</code> çš„ç»“æœå‡ 1ï¼Œä½†æ²¡æœ‰æ£€æŸ¥æ˜¯å¦ä¼šå¯¼è‡´ <code>row</code> å˜ä¸ºè´Ÿæ•°ã€‚å¦‚æœ target å°äºçŸ©é˜µä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ<code>sort.Search</code> ä¼šè¿”å› 0ï¼Œå‡ 1 åå˜æˆ -1ï¼Œè¿™ä¼šå¯¼è‡´ç´¢å¼•è¶Šç•Œã€‚</p>
</li>
<li>
<p><strong>è°ƒè¯•ä»£ç </strong>ï¼šä¿ç•™äº† <code>log.Println(row)</code> è°ƒè¯•è¯­å¥ï¼Œè¿™åœ¨ç”Ÿäº§ä»£ç ä¸­æ˜¯ä¸é€‚å½“çš„ã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªé”™è¯¯è§£æ³•åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šå¯¼è‡´é”™è¯¯æˆ–ç¨‹åºå´©æºƒï¼š</p>
<ul>
<li>å½“ target å°äºçŸ©é˜µä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä¼šå¯¼è‡´ row = -1ï¼Œå¼•èµ·æ•°ç»„è¶Šç•Œ</li>
<li>å½“ target ç­‰äºæŸè¡Œçš„æœ€åä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå¯èƒ½ä¼šæ‰¾é”™è¡Œ</li>
</ul>
<h2 id="æ­£ç¡®è§£æ³•">æ­£ç¡®è§£æ³•</h2>
<p>ç»è¿‡åˆ†æï¼Œæˆ‘æ”¹è¿›çš„è§£æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrix</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	n, m := <span class="built_in">len</span>(matrix), <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæœ€åå…ƒç´ å¤§äºç­‰äºtargetçš„è¡Œ</span></span><br><span class="line">	row := sort.Search(n, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> matrix[i][m<span class="number">-1</span>] &gt;= target</span><br><span class="line">	&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// è¡Œç´¢å¼•è¶Šç•Œï¼Œè¡¨ç¤ºæ‰€æœ‰è¡Œçš„æœ€åå…ƒç´ éƒ½å°äºtarget</span></span><br><span class="line">	<span class="keyword">if</span> row &gt;= n &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// åœ¨æ‰¾åˆ°çš„è¡Œä¸­äºŒåˆ†æŸ¥æ‰¾target</span></span><br><span class="line">	col := sort.SearchInts(matrix[row], target)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ç¡®ä¿åˆ—ç´¢å¼•åœ¨èŒƒå›´å†…å¹¶ä¸”å…ƒç´ ç­‰äºtarget</span></span><br><span class="line">	<span class="keyword">return</span> col &lt; m &amp;&amp; matrix[row][col] == target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ">ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ</h3>
<ol>
<li>
<p><strong>æ­£ç¡®çš„æœç´¢ç­–ç•¥</strong>ï¼šä½¿ç”¨ <code>matrix[i][m-1] &gt;= target</code> ä½œä¸ºæ¡ä»¶ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæœ€å¤§å…ƒç´ å¤§äºç­‰äº target çš„è¡Œã€‚æ ¹æ®çŸ©é˜µæ€§è´¨ï¼Œå¦‚æœ target å­˜åœ¨ï¼Œå®ƒä¸€å®šåœ¨è¿™ä¸€è¡Œã€‚</p>
</li>
<li>
<p><strong>å®Œæ•´çš„è¾¹ç•Œæ£€æŸ¥</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>row &gt;= n</code>ï¼Œç¡®ä¿æ‰¾åˆ°çš„è¡Œç´¢å¼•åœ¨çŸ©é˜µèŒƒå›´å†…</li>
<li>éšå¼æ£€æŸ¥ <code>col &lt; m</code>ï¼Œç¡®ä¿æ‰¾åˆ°çš„åˆ—ç´¢å¼•åœ¨è¡ŒèŒƒå›´å†…ï¼ˆè™½ç„¶åœ¨è¿™é“é¢˜ä¸­ç”±äº <code>sort.SearchInts</code> çš„ç‰¹æ€§ï¼Œè¿™ä¸ªæ£€æŸ¥å¯ä»¥çœç•¥ï¼Œä½†ä¿ç•™å®ƒæ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ­£ç¡®çš„è¿”å›æ¡ä»¶</strong>ï¼šå½“ä¸”ä»…å½“ <code>matrix[row][col] == target</code> æ—¶è¿”å› trueï¼Œç¡®ä¿æ‰¾åˆ°çš„ä½ç½®ç¡®å®åŒ…å«ç›®æ ‡å€¼ã€‚</p>
</li>
</ol>
<h2 id="å…³äº-Go-ä¸­çš„-sort-Search-å’Œ-sort-SearchInts">å…³äº Go ä¸­çš„ sort.Search å’Œ sort.SearchInts</h2>
<p>è¿™äº›é”™è¯¯çš„æ ¹æºä¹‹ä¸€æ˜¯å¯¹ Go æ ‡å‡†åº“ä¸­äºŒåˆ†æŸ¥æ‰¾å‡½æ•°çš„è¯¯ç”¨æˆ–è¯¯è§£ï¼š</p>
<ol>
<li>
<p><strong>sort.Search(n, f)</strong> è¿”å› <code>[0,n)</code> èŒƒå›´å†…ç¬¬ä¸€ä¸ªä½¿ <code>f(i)=true</code> çš„ç´¢å¼• iã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼Œè¿”å› nã€‚</p>
</li>
<li>
<p><strong>sort.SearchInts(a, x)</strong> è¿”å›æœ‰åºåˆ‡ç‰‡ a ä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äº x çš„å…ƒç´ çš„ç´¢å¼•ã€‚å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½å°äº xï¼Œåˆ™è¿”å› <code>len(a)</code>ã€‚</p>
</li>
</ol>
<p>ä½¿ç”¨è¿™äº›å‡½æ•°æ—¶çš„å…³é”®æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li><strong>èŒƒå›´æ£€æŸ¥</strong>ï¼šå¿…é¡»æ£€æŸ¥ <code>sort.Search</code> å’Œ <code>sort.SearchInts</code> çš„è¿”å›å€¼æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…</li>
<li><strong>è¾¹ç•Œæ¡ä»¶</strong>ï¼šç†è§£å½“ç›®æ ‡ä¸åœ¨æ•°ç»„ä¸­æ—¶çš„è¡Œä¸º</li>
<li><strong>è°ƒæ•´ç´¢å¼•</strong>ï¼šæœ‰äº›æƒ…å†µä¸‹éœ€è¦è°ƒæ•´è¿”å›çš„ç´¢å¼•ï¼ˆå¦‚å‡1ï¼‰ï¼Œä½†å¿…é¡»å°å¿ƒå¤„ç†å¯èƒ½çš„è´Ÿå€¼</li>
</ul>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>ä»è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæˆ‘å­¦åˆ°äº†å‡ ä¸ªå…³é”®æ•™è®­ï¼š</p>
<ol>
<li>
<p><strong>å§‹ç»ˆæ£€æŸ¥è¾¹ç•Œæ¡ä»¶</strong>ï¼šåœ¨ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æˆ–ä»»ä½•ç´¢å¼•ç›¸å…³æ“ä½œæ—¶ï¼Œå¿…é¡»ç¡®ä¿ç´¢å¼•åœ¨æœ‰æ•ˆèŒƒå›´å†…ã€‚</p>
</li>
<li>
<p><strong>ç†è§£åº“å‡½æ•°è¡Œä¸º</strong>ï¼šæ·±å…¥ç†è§£æ ‡å‡†åº“å‡½æ•°çš„è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯å®ƒä»¬åœ¨è¾¹ç¼˜æƒ…å†µä¸‹çš„è¿”å›å€¼ã€‚</p>
</li>
<li>
<p><strong>é€‰æ‹©æ­£ç¡®çš„æœç´¢ç­–ç•¥</strong>ï¼šæ ¹æ®é—®é¢˜ç‰¹æ€§é€‰æ‹©æœ€åˆé€‚çš„æœç´¢æ–¹æ³•ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œç†è§£çŸ©é˜µçš„æ’åºç‰¹æ€§æ˜¯æ‰¾åˆ°é«˜æ•ˆè§£æ³•çš„å…³é”®ã€‚</p>
</li>
<li>
<p><strong>è°ƒæ•´ç´¢å¼•æ—¶è¦è°¨æ…</strong>ï¼šå½“éœ€è¦å¯¹æœç´¢ç»“æœè¿›è¡Œè°ƒæ•´ï¼ˆå¦‚å‡1ï¼‰æ—¶ï¼Œå¿…é¡»è€ƒè™‘è¿™å¯èƒ½å¯¼è‡´çš„è¾¹ç•Œé—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>ç§»é™¤è°ƒè¯•ä»£ç </strong>ï¼šåœ¨æäº¤æœ€ç»ˆè§£å†³æ–¹æ¡ˆå‰ï¼Œç¡®ä¿ç§»é™¤æ‰€æœ‰è°ƒè¯•è¯­å¥ã€‚</p>
</li>
</ol>
<p>è¿™äº›è€ƒè™‘ç‚¹ä¸ä»…é€‚ç”¨äºè¿™ä¸ªç‰¹å®šé—®é¢˜ï¼Œä¹Ÿé€‚ç”¨äºæ‰€æœ‰æ¶‰åŠç´¢å¼•æ“ä½œå’ŒäºŒåˆ†æŸ¥æ‰¾çš„ç®—æ³•é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>äºŒåˆ†æŸ¥æ‰¾</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
        <tag>çŸ©é˜µ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 35 - æœç´¢æ’å…¥ä½ç½®ä¸Goè¯­è¨€äºŒåˆ†æœç´¢å…¨è§£æ</title>
    <url>/2025/05/08/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-35-%E6%90%9C%E7%B4%A2%E6%8F%92%E5%85%A5%E4%BD%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚</p>
<p>è¯·å¿…é¡»ä½¿ç”¨æ—¶é—´å¤æ‚åº¦ä¸º $O(log n)$ çš„ç®—æ³•ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [1,3,5,6], target = 5</span><br><span class="line">è¾“å‡º: 2</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [1,3,5,6], target = 2</span><br><span class="line">è¾“å‡º: 1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [1,3,5,6], target = 7</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure>
<p><strong>æç¤º:</strong></p>
<ul>
<li>$1 &lt;= nums.length &lt;= 10^4$</li>
<li>$-10^4 &lt;= nums[i] &lt;= 10^4$</li>
<li>nums ä¸º <strong>æ— é‡å¤å…ƒç´ </strong> çš„ <strong>å‡åº</strong> æ’åˆ—æ•°ç»„</li>
<li>$-10^4 &lt;= target &lt;= 10^4$</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜è¦æ±‚æˆ‘ä»¬åœ¨æ’åºæ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼çš„ä½ç½®ï¼Œå¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›å®ƒåº”è¯¥è¢«æ’å…¥çš„ä½ç½®ã€‚ç”±äºé¢˜ç›®è¦æ±‚ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(log n)ï¼Œå¾ˆæ˜æ˜¾éœ€è¦ä½¿ç”¨äºŒåˆ†æœç´¢ã€‚</p>
<p>å¯¹äºæ­¤ç±»é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°<strong>ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç›®æ ‡å€¼</strong>çš„å…ƒç´ ç´¢å¼•ï¼Œè¿™æ­£æ˜¯äºŒåˆ†æœç´¢çš„ä¸€ä¸ªå¸¸è§åº”ç”¨åœºæ™¯ã€‚</p>
<h3 id="äºŒåˆ†æœç´¢åŸºæœ¬åŸç†">äºŒåˆ†æœç´¢åŸºæœ¬åŸç†</h3>
<p>äºŒåˆ†æœç´¢çš„åŸºæœ¬æ€æƒ³æ˜¯å°†æŸ¥æ‰¾èŒƒå›´é€æ­¥ç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å…ƒç´ æˆ–ç¡®å®šç›®æ ‡å…ƒç´ ä¸å­˜åœ¨ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>è®¾ç½®å·¦è¾¹ç•Œ <code>left = 0</code> å’Œå³è¾¹ç•Œ <code>right = n - 1</code></li>
<li>å½“ <code>left &lt;= right</code> æ—¶ï¼Œè®¡ç®—ä¸­é—´ä½ç½® <code>mid = left + (right - left) / 2</code></li>
<li>å¦‚æœ <code>nums[mid] == target</code>ï¼Œè¿”å› <code>mid</code></li>
<li>å¦‚æœ <code>nums[mid] &lt; target</code>ï¼Œè¯´æ˜ç›®æ ‡åœ¨å³åŠéƒ¨åˆ†ï¼Œè®¾ç½® <code>left = mid + 1</code></li>
<li>å¦‚æœ <code>nums[mid] &gt; target</code>ï¼Œè¯´æ˜ç›®æ ‡åœ¨å·¦åŠéƒ¨åˆ†ï¼Œè®¾ç½® <code>right = mid - 1</code></li>
<li>å¦‚æœå¾ªç¯ç»“æŸåä»æœªæ‰¾åˆ°ç›®æ ‡ï¼Œé‚£ä¹ˆ <code>left</code> å°±æ˜¯ç›®æ ‡å€¼åº”è¯¥æ’å…¥çš„ä½ç½®</li>
</ol>
<h2 id="Goè¯­è¨€ä¸­çš„äºŒåˆ†æœç´¢">Goè¯­è¨€ä¸­çš„äºŒåˆ†æœç´¢</h2>
<p>Goè¯­è¨€æ ‡å‡†åº“ä¸­çš„ <code>sort</code> åŒ…æä¾›äº†ä¸€ç³»åˆ—çš„äºŒåˆ†æœç´¢å‡½æ•°ï¼Œéå¸¸é€‚åˆç”¨æ¥è§£å†³æ­¤ç±»é—®é¢˜ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è¯¦ç»†ä»‹ç»è¿™äº›å‡½æ•°ã€‚</p>
<h3 id="1-sort-Search-é€šç”¨äºŒåˆ†æœç´¢å‡½æ•°">1. sort.Search - é€šç”¨äºŒåˆ†æœç´¢å‡½æ•°</h3>
<p><code>sort.Search</code> æ˜¯Goè¯­è¨€äºŒåˆ†æœç´¢çš„æ ¸å¿ƒå‡½æ•°ï¼Œå…¶ä»–å‡ ä¸ªæœç´¢å‡½æ•°éƒ½æ˜¯åŸºäºå®ƒå®ç°çš„ã€‚å…¶å‡½æ•°ç­¾åä¸ºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Search</span><span class="params">(n <span class="type">int</span>, f <span class="keyword">func</span>(<span class="type">int</span>)</span></span> <span class="type">bool</span>) <span class="type">int</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°åœ¨<code>[0, n)</code>èŒƒå›´å†…æœç´¢ï¼Œè¿”å›ä½¿å‡½æ•° <code>f(i)</code> é¦–æ¬¡è¿”å› <code>true</code> çš„æœ€å°ç´¢å¼• <code>i</code>ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼Œåˆ™è¿”å› <code>n</code>ã€‚</p>
<p><strong>é‡è¦ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>å‡½æ•° <code>f</code> å¿…é¡»æ»¡è¶³å¯¹äºæŸä¸ªç´¢å¼• <code>k</code>ï¼Œå½“ <code>i &lt; k</code> æ—¶ï¼Œ<code>f(i) = false</code>ï¼›å½“ <code>i &gt;= k</code> æ—¶ï¼Œ<code>f(i) = true</code></li>
<li>å¦‚æœå¯¹äºæ‰€æœ‰çš„ <code>i</code> éƒ½æœ‰ <code>f(i) = false</code>ï¼Œåˆ™è¿”å› <code>n</code></li>
<li>å¦‚æœå¯¹äºæ‰€æœ‰çš„ <code>i</code> éƒ½æœ‰ <code>f(i) = true</code>ï¼Œåˆ™è¿”å› <code>0</code></li>
</ul>
<p>è¿™ä¸ªå‡½æ•°éå¸¸çµæ´»ï¼Œå¯ä»¥ç”¨æ¥å®ç°å„ç§äºŒåˆ†æœç´¢å˜ä½“ã€‚</p>
<h3 id="2-sort-SearchInts-æ•´æ•°åˆ‡ç‰‡æœç´¢">2. sort.SearchInts - æ•´æ•°åˆ‡ç‰‡æœç´¢</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SearchInts</span><span class="params">(a []<span class="type">int</span>, x <span class="type">int</span>)</span></span> <span class="type">int</span></span><br></pre></td></tr></table></figure>
<p><code>SearchInts</code> åœ¨å·²æ’åºçš„æ•´æ•°åˆ‡ç‰‡ <code>a</code> ä¸­æœç´¢ <code>x</code>ï¼Œè¿”å› <code>x</code> åº”è¯¥æ’å…¥çš„ä½ç½®ï¼ˆå³ç¬¬ä¸€ä¸ªå¤§äºç­‰äº <code>x</code> çš„å…ƒç´ çš„ä½ç½®ï¼‰ã€‚å¦‚æœ <code>a</code> ä¸­æ‰€æœ‰å…ƒç´ éƒ½å°äº <code>x</code>ï¼Œåˆ™è¿”å› <code>len(a)</code>ã€‚</p>
<h3 id="3-sort-SearchFloat64s-æµ®ç‚¹æ•°åˆ‡ç‰‡æœç´¢">3. sort.SearchFloat64s - æµ®ç‚¹æ•°åˆ‡ç‰‡æœç´¢</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SearchFloat64s</span><span class="params">(a []<span class="type">float64</span>, x <span class="type">float64</span>)</span></span> <span class="type">int</span></span><br></pre></td></tr></table></figure>
<p><code>SearchFloat64s</code> åœ¨å·²æ’åºçš„æµ®ç‚¹æ•°åˆ‡ç‰‡ <code>a</code> ä¸­æœç´¢ <code>x</code>ï¼Œç”¨æ³•ä¸ <code>SearchInts</code> ç±»ä¼¼ã€‚</p>
<h3 id="4-sort-SearchStrings-å­—ç¬¦ä¸²åˆ‡ç‰‡æœç´¢">4. sort.SearchStrings - å­—ç¬¦ä¸²åˆ‡ç‰‡æœç´¢</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SearchStrings</span><span class="params">(a []<span class="type">string</span>, x <span class="type">string</span>)</span></span> <span class="type">int</span></span><br></pre></td></tr></table></figure>
<p><code>SearchStrings</code> åœ¨å·²æ’åºçš„å­—ç¬¦ä¸²åˆ‡ç‰‡ <code>a</code> ä¸­æœç´¢ <code>x</code>ï¼Œç”¨æ³•ä¸ <code>SearchInts</code> ç±»ä¼¼ã€‚</p>
<h3 id="5-è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°æœç´¢">5. è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°æœç´¢</h3>
<p>å¯¹äºå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç»“åˆ <code>sort.Search</code> å’Œè‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°æ¥å®ç°äºŒåˆ†æœç´¢ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šä½¿ç”¨-sort-Search">æ–¹æ³•ä¸€ï¼šä½¿ç”¨ sort.Search</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchInsert</span><span class="params">(nums []<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    <span class="keyword">return</span> sort.Search(n, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nums[i] &gt;= target</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå®ç°éå¸¸ç®€æ´ï¼Œä½¿ç”¨ <code>sort.Search</code> å‡½æ•°æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äº <code>target</code> çš„å…ƒç´ ç´¢å¼•ã€‚åˆ¤æ–­å‡½æ•° <code>func(i int) bool &#123; return nums[i] &gt;= target &#125;</code> ç”¨äºç¡®å®šç´¢å¼• <code>i</code> å¤„çš„å…ƒç´ æ˜¯å¦å¤§äºç­‰äºç›®æ ‡å€¼ã€‚</p>
<h3 id="æ–¹æ³•äºŒï¼šæ‰‹å†™äºŒåˆ†æœç´¢">æ–¹æ³•äºŒï¼šæ‰‹å†™äºŒåˆ†æœç´¢</h3>
<p>è™½ç„¶Goæ ‡å‡†åº“çš„<code>sort.Search</code>éå¸¸å¼ºå¤§ä¸”ç®€æ´ï¼Œä½†åœ¨é¢è¯•æˆ–éœ€è¦é«˜åº¦è‡ªå®šä¹‰çš„åœºæ™¯ä¸­ï¼Œæ‰‹å†™äºŒåˆ†æœç´¢ä»ç„¶æ˜¯ä¸€é¡¹å¿…å¤‡æŠ€èƒ½ã€‚</p>
<p>ä¸‹é¢æ˜¯é’ˆå¯¹æœ¬é¢˜&quot;æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ &quot;çš„ç»å…¸å®ç°ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchInsert</span><span class="params">(nums []<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line">	left, right := <span class="number">0</span>, n<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¾ªç¯ç»ˆæ­¢æ¡ä»¶ left &gt; right</span></span><br><span class="line">	<span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">		<span class="comment">// mid := left + (right-left)&gt;&gt;1 å¯é˜²æ­¢left+rightæº¢å‡º</span></span><br><span class="line">		mid := (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// å¦‚æœ mid çš„å€¼å¤§äºç­‰äº targetï¼Œè¯´æ˜ç›®æ ‡åœ¨å·¦åŠéƒ¨åˆ†æˆ–å°±æ˜¯ mid</span></span><br><span class="line">		<span class="comment">// æˆ‘ä»¬ä¸èƒ½æ’é™¤ midï¼Œæ‰€ä»¥å°è¯•åœ¨ [left, mid-1] ä¸­ç»§ç»­å¯»æ‰¾æ›´é å‰çš„æ’å…¥ç‚¹</span></span><br><span class="line">		<span class="keyword">if</span> nums[mid] &gt;= target &#123;</span><br><span class="line">			right = mid - <span class="number">1</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// å¦‚æœ mid çš„å€¼å°äº targetï¼Œè¯´æ˜ç›®æ ‡å¿…å®šåœ¨å³åŠéƒ¨åˆ†</span></span><br><span class="line">			<span class="comment">// mid ä»¥åŠå…¶å·¦è¾¹çš„å…ƒç´ éƒ½å¯ä»¥è¢«æ’é™¤ï¼Œæ‰€ä»¥ä» [mid+1, right] ç»§ç»­å¯»æ‰¾</span></span><br><span class="line">			left = mid + <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¾ªç¯ç»“æŸåï¼Œleft å°±æ˜¯ç›®æ ‡å€¼åº”è¯¥æ’å…¥çš„ä½ç½®</span></span><br><span class="line">	<span class="keyword">return</span> left</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå®ç°æ˜¯ç»å…¸çš„äºŒåˆ†æœç´¢ç®—æ³•ã€‚å½“å¾ªç¯ç»“æŸæ—¶ï¼Œ<code>left</code> å°±æ˜¯ç›®æ ‡å€¼åº”è¯¥æ’å…¥çš„ä½ç½®ã€‚</p>
<h3 id="æ‰‹å†™äºŒåˆ†æœç´¢æ·±åº¦è§£æ">æ‰‹å†™äºŒåˆ†æœç´¢æ·±åº¦è§£æ</h3>
<p>ä¸Šé¢çš„ä»£ç è™½ç„¶ç®€æ´ï¼Œä½†åŒ…å«äº†å¾ˆå¤šäºŒåˆ†æœç´¢çš„ç»†èŠ‚ã€‚ä¸ºäº†å½»åº•ç†è§£å®ƒï¼Œæˆ‘ä»¬æ¥æ‹†è§£ä¸€ä¸‹ï¼š</p>
<h4 id="1-æ ¸å¿ƒé—®é¢˜è½¬åŒ–">1. æ ¸å¿ƒé—®é¢˜è½¬åŒ–</h4>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æŠŠåŸé—®é¢˜&quot;å¦‚æœæ‰¾åˆ°å°±è¿”å›ç´¢å¼•ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›æ’å…¥ä½ç½®&quot;è½¬åŒ–ä¸ºä¸€ä¸ªæ›´æ¸…æ™°çš„æ•°å­¦è¡¨è¿°ï¼š<strong>åœ¨æœ‰åºæ•°ç»„ä¸­ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº <code>target</code> çš„å…ƒç´ çš„ç´¢å¼•</strong>ã€‚</p>
<p>ä¸ä¿¡å¯ä»¥è¯•è¯•ï¼š</p>
<ul>
<li>å¯¹äº <code>[1,3,5,6]</code> å’Œ <code>target = 5</code>ï¼Œç¬¬ä¸€ä¸ªå¤§äºç­‰äº5çš„å…ƒç´ æ˜¯5ï¼Œç´¢å¼•ä¸º2ã€‚</li>
<li>å¯¹äº <code>[1,3,5,6]</code> å’Œ <code>target = 2</code>ï¼Œç¬¬ä¸€ä¸ªå¤§äºç­‰äº2çš„å…ƒç´ æ˜¯3ï¼Œç´¢å¼•ä¸º1ã€‚</li>
<li>å¯¹äº <code>[1,3,5,6]</code> å’Œ <code>target = 7</code>ï¼Œæ•°ç»„ä¸­æ²¡æœ‰å¤§äºç­‰äº7çš„å…ƒç´ ï¼Œä½†å¦‚æœæ’å…¥ï¼Œå®ƒåº”è¯¥åœ¨æ‰€æœ‰å…ƒç´ ä¹‹åï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•4çš„ä½ç½®ã€‚</li>
</ul>
<h4 id="2-å®šä¹‰ä¸ç»´æŠ¤æœç´¢åŒºé—´-left-right">2. å®šä¹‰ä¸ç»´æŠ¤æœç´¢åŒºé—´ <code>[left, right]</code></h4>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šæˆ‘ä»¬é‡‡ç”¨é—­åŒºé—´ <code>[left, right]</code> æ¥å®šä¹‰æœç´¢èŒƒå›´ã€‚è¿™æ„å‘³ç€åœ¨æ¯ä¸€è½®å¾ªç¯å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬éƒ½å‡è®¾è¦æ‰¾çš„ç­”æ¡ˆä½äº <code>nums[left]</code> åˆ° <code>nums[right]</code>ï¼ˆåŒ…å«è¾¹ç•Œï¼‰ä¹‹é—´ã€‚</li>
<li><strong>åˆå§‹åŒ–</strong>ï¼š<code>left = 0</code>, <code>right = len(nums) - 1</code>ï¼Œåˆå§‹æœç´¢åŒºé—´è¦†ç›–æ•´ä¸ªæ•°ç»„ã€‚</li>
<li><strong>å¾ªç¯æ¡ä»¶</strong>ï¼š<code>left &lt;= right</code>ã€‚åªè¦åŒºé—´æœ‰æ•ˆï¼ˆ<code>left</code> ä¸å¤§äº <code>right</code>ï¼‰ï¼Œæœç´¢å°±ç»§ç»­ã€‚å½“ <code>left == right</code> æ—¶ï¼ŒåŒºé—´è¿˜æœ‰ä¸€ä¸ªå…ƒç´  <code>nums[left]</code>ï¼Œä¹Ÿéœ€è¦è¢«æ£€æŸ¥ã€‚å½“ <code>left</code> æœ€ç»ˆè¶Šè¿‡ <code>right</code>ï¼ˆå³ <code>left = right + 1</code>ï¼‰ï¼Œå¾ªç¯ç»ˆæ­¢ï¼Œè¯´æ˜æœç´¢åŒºé—´ä¸ºç©ºã€‚</li>
</ul>
<h4 id="3-åŒºé—´æ”¶ç¼©çš„ç²¾é«“">3. åŒºé—´æ”¶ç¼©çš„ç²¾é«“</h4>
<p>è¿™æ˜¯äºŒåˆ†æŸ¥æ‰¾æœ€æ ¸å¿ƒçš„é€»è¾‘ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ¯ä¸€æ­¥éƒ½å®‰å…¨åœ°æ’é™¤æ‰ä¸€åŠçš„å…ƒç´ ã€‚</p>
<ul>
<li><code>mid := (left + right) &gt;&gt; 1</code>: è®¡ç®—ä¸­é—´ç‚¹ã€‚</li>
<li><code>if nums[mid] &gt;= target</code>:
<ul>
<li><strong>å«ä¹‰</strong>ï¼š<code>nums[mid]</code> è¿™ä¸ªå…ƒç´ <strong>æœ‰å¯èƒ½æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç­”æ¡ˆ</strong>ï¼ˆæ¯”å¦‚å®ƒå°±æ˜¯ç¬¬ä¸€ä¸ªå¤§äºç­‰äº<code>target</code>çš„å…ƒç´ ï¼‰ï¼Œæˆ–è€…çœŸæ­£çš„ç­”æ¡ˆåœ¨å®ƒçš„<strong>å·¦è¾¹</strong>ã€‚</li>
<li><strong>æ“ä½œ</strong>ï¼šæˆ‘ä»¬ä¸èƒ½æ’é™¤ <code>mid</code>ï¼Œä½†å¯ä»¥è‚¯å®šåœ°è¯´ï¼Œ<code>mid</code> å³è¾¹çš„æ‰€æœ‰å…ƒç´ éƒ½<strong>ä¸æ˜¯</strong>æˆ‘ä»¬è¦æ‰¾çš„&quot;ç¬¬ä¸€ä¸ª&quot;å¤§äºç­‰äº<code>target</code>çš„å…ƒç´ ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æœç´¢èŒƒå›´æ”¶ç¼©åˆ°å·¦åŠéƒ¨åˆ†ï¼Œå³ <code>right = mid - 1</code>ã€‚æˆ‘ä»¬æœŸå¾…åœ¨ <code>[left, mid - 1]</code> è¿™ä¸ªæ–°åŒºé—´é‡Œæ‰¾åˆ°ä¸€ä¸ªæ›´é å‰çš„ã€ç¬¦åˆæ¡ä»¶çš„ä½ç½®ã€‚</li>
</ul>
</li>
<li><code>else</code>: (<code>nums[mid] &lt; target</code>)
<ul>
<li><strong>å«ä¹‰</strong>ï¼š<code>nums[mid]</code> æ¯” <code>target</code> è¿˜å°ï¼Œé‚£ä¹ˆ <code>mid</code> ä»¥åŠ <code>mid</code> å·¦è¾¹çš„æ‰€æœ‰å…ƒç´ <strong>éƒ½ä¸å¯èƒ½æ˜¯</strong>æˆ‘ä»¬è¦æ‰¾çš„ç­”æ¡ˆã€‚</li>
<li><strong>æ“ä½œ</strong>ï¼šæˆ‘ä»¬å¿…é¡»å»å³è¾¹å¯»æ‰¾ã€‚å°†æœç´¢èŒƒå›´æ”¶ç¼©åˆ°å³åŠéƒ¨åˆ†ï¼Œå³ <code>left = mid + 1</code>ã€‚</li>
</ul>
</li>
</ul>
<h4 id="4-æ·±åº¦å‰–æï¼šä¸ºä»€ä¹ˆæœ€åè¿”å›-leftï¼Ÿ">4. æ·±åº¦å‰–æï¼šä¸ºä»€ä¹ˆæœ€åè¿”å› <code>left</code>ï¼Ÿ</h4>
<p>ä½ é—®åˆ°äº†æœ€å…³é”®çš„é—®é¢˜ã€‚è¦å½»åº•æƒ³æ˜ç™½ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªç¼–ç¨‹ä¸­è¯æ˜ç®—æ³•æ­£ç¡®æ€§çš„å¼ºå¤§æ€æƒ³ï¼š<strong>å¾ªç¯ä¸å˜é‡ (Loop Invariant)</strong>ã€‚</p>
<p>å¾ªç¯ä¸å˜é‡æ˜¯ä¸€ä¸ªåœ¨å¾ªç¯å¼€å§‹å‰ä¸ºçœŸï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£åä¾ç„¶ä¿æŒä¸ºçœŸçš„æ€§è´¨ã€‚å¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ä¸å˜é‡ï¼Œå¹¶è¯æ˜å®ƒåœ¨å¾ªç¯ç»“æŸåèƒ½å¼•å¯¼æˆ‘ä»¬å¾—åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œé‚£ä¹ˆç®—æ³•çš„æ­£ç¡®æ€§å°±å¾—åˆ°äº†ä¿è¯ã€‚</p>
<p>å¯¹äºæˆ‘ä»¬çš„äºŒåˆ†æœç´¢ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è¿™æ ·ä¸€ç»„ä¸å˜é‡ï¼š</p>
<blockquote>
<p>åœ¨ <code>for left &lt;= right</code> å¾ªç¯çš„<strong>æ¯ä¸€æ¬¡è¿­ä»£å¼€å§‹å‰</strong>ï¼Œ<code>left</code> å’Œ <code>right</code> æŒ‡é’ˆéƒ½æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li><code>left</code> æŒ‡é’ˆå·¦ä¾§çš„æ‰€æœ‰å…ƒç´ ï¼ˆå³ <code>nums[0...left-1]</code>ï¼‰éƒ½ <strong>ä¸¥æ ¼å°äº</strong> <code>target</code>ã€‚</li>
<li><code>right</code> æŒ‡é’ˆå³ä¾§çš„æ‰€æœ‰å…ƒç´ ï¼ˆå³ <code>nums[right+1...n-1]</code>ï¼‰éƒ½ <strong>å¤§äºç­‰äº</strong> <code>target</code>ã€‚</li>
</ol>
</blockquote>
<p>æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªä¸å˜é‡æ˜¯å¦æˆç«‹ï¼š</p>
<ul>
<li>
<p><strong>åˆå§‹åŒ–</strong>:</p>
<ul>
<li>å¾ªç¯å¼€å§‹å‰ï¼Œ<code>left = 0</code>, <code>right = n-1</code>ã€‚</li>
<li><code>nums[0...-1]</code> æ˜¯ä¸€ä¸ªç©ºåŒºé—´ï¼Œæ‰€ä»¥&quot;æ‰€æœ‰å…ƒç´ éƒ½å°äº <code>target</code>&quot;çš„è¯´æ³•å¤©ç„¶æˆç«‹ã€‚</li>
<li><code>nums[n...n-1]</code> ä¹Ÿæ˜¯ä¸€ä¸ªç©ºåŒºé—´ï¼Œæ‰€ä»¥&quot;æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äº <code>target</code>&quot;ä¹Ÿå¤©ç„¶æˆç«‹ã€‚</li>
<li><strong>ç»“è®º</strong>ï¼šä¸å˜é‡åœ¨å¾ªç¯å¼€å§‹å‰æ˜¯æˆç«‹çš„ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¿æŒ (Maintenance)</strong>:</p>
<ul>
<li>å‡è®¾åœ¨æŸä¸€æ¬¡å¾ªç¯å¼€å§‹æ—¶ï¼Œä¸å˜é‡æ˜¯æˆç«‹çš„ã€‚æˆ‘ä»¬æ¥åˆ†æå¾ªç¯ä½“å†…éƒ¨çš„ä¸¤ç§æƒ…å†µï¼š
<ol>
<li><strong>å½“ <code>nums[mid] &lt; target</code> æ—¶</strong>:
<ul>
<li>è¿™æ„å‘³ç€ <code>nums[mid]</code> ä»¥åŠå®ƒå·¦è¾¹çš„æ‰€æœ‰å…ƒç´ éƒ½å°äº <code>target</code>ã€‚</li>
<li>æˆ‘ä»¬æ‰§è¡Œ <code>left = mid + 1</code>ã€‚</li>
<li>åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯å¼€å§‹æ—¶ï¼Œæ–°çš„ <code>left</code> æŒ‡é’ˆæ˜¯ <code>mid + 1</code>ã€‚<code>left</code> å·¦è¾¹çš„åŒºé—´å˜æˆäº† <code>nums[0...mid]</code>ï¼Œè¿™ä¸ªåŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ ç¡®å®éƒ½å°äº <code>target</code>ã€‚<code>right</code> æŒ‡é’ˆæ²¡å˜ï¼Œæ‰€ä»¥ä¸å˜é‡çš„ç¬¬äºŒéƒ¨åˆ†ä¾ç„¶æˆç«‹ã€‚</li>
<li><strong>ç»“è®º</strong>ï¼šä¸å˜é‡å¾—ä»¥ä¿æŒã€‚</li>
</ul>
</li>
<li><strong>å½“ <code>nums[mid] &gt;= target</code> æ—¶</strong>:
<ul>
<li>è¿™æ„å‘³ç€ <code>nums[mid]</code> ä»¥åŠå®ƒå³è¾¹çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äº <code>target</code>ã€‚</li>
<li>æˆ‘ä»¬æ‰§è¡Œ <code>right = mid - 1</code>ã€‚</li>
<li>åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯å¼€å§‹æ—¶ï¼Œæ–°çš„ <code>right</code> æŒ‡é’ˆæ˜¯ <code>mid - 1</code>ã€‚<code>right</code> å³è¾¹çš„åŒºé—´å˜æˆäº† <code>nums[mid...n-1]</code>ï¼Œè¿™ä¸ªåŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ ç¡®å®éƒ½å¤§äºç­‰äº <code>target</code>ã€‚<code>left</code> æŒ‡é’ˆæ²¡å˜ï¼Œæ‰€ä»¥ä¸å˜é‡çš„ç¬¬ä¸€éƒ¨åˆ†ä¾ç„¶æˆç«‹ã€‚</li>
<li><strong>ç»“è®º</strong>ï¼šä¸å˜é‡å¾—ä»¥ä¿æŒã€‚</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>ç»ˆæ­¢ (Termination)</strong>:</p>
<ul>
<li>å¾ªç¯åœ¨ <code>left &gt; right</code> æ—¶ç»ˆæ­¢ã€‚æ­¤æ—¶ï¼Œ<code>left = right + 1</code>ã€‚</li>
<li>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ä¸å˜é‡åœ¨è¿™ä¸€åˆ»å‘Šè¯‰äº†æˆ‘ä»¬ä»€ä¹ˆï¼š
<ol>
<li><code>left</code> å·¦ä¾§çš„å…ƒç´  <code>nums[0...left-1]</code> éƒ½ <code>&lt; target</code>ã€‚</li>
<li><code>right</code> å³ä¾§çš„å…ƒç´  <code>nums[right+1...n-1]</code> éƒ½ <code>&gt;= target</code>ã€‚</li>
</ol>
</li>
<li>å› ä¸º <code>left = right + 1</code>ï¼Œæ‰€ä»¥ç¬¬äºŒæ¡å¯ä»¥æ”¹å†™ä¸ºï¼š<code>nums[left...n-1]</code> éƒ½ <code>&gt;= target</code>ã€‚</li>
<li>æŠŠä¸¤æ¡åˆåœ¨ä¸€èµ·çœ‹ï¼š
<ul>
<li><code>nums[left-1]</code> (å¦‚æœå­˜åœ¨) æ˜¯æœ€åä¸€ä¸ª <code>&lt; target</code> çš„å…ƒç´ ã€‚</li>
<li><code>nums[left]</code> (å¦‚æœå­˜åœ¨) æ˜¯ç¬¬ä¸€ä¸ª <code>&gt;= target</code> çš„å…ƒç´ ã€‚</li>
</ul>
</li>
<li>å› æ­¤ï¼Œ<code>left</code> æ­£æ˜¯é‚£ä¸ªåˆ†å‰²ç‚¹ï¼Œå®ƒæŒ‡å‘çš„ä½ç½®å°±æ˜¯ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº <code>target</code> çš„å…ƒç´ åº”è¯¥åœ¨çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è‹¦è‹¦å¯»æ‰¾çš„<strong>æ’å…¥ä½ç½®</strong>ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ä¸ªé€»è¾‘å¯èƒ½åˆçœ‹æœ‰ç‚¹ç»•ï¼Œä½†å®ƒæ˜¯ç†è§£äºŒåˆ†æœç´¢æ‰€æœ‰å˜ä½“çš„åŸºçŸ³ã€‚é€šè¿‡ç»´æŠ¤è¿™ä¸ªæ¸…æ™°çš„&quot;&lt; target&quot;å’Œ&quot;&gt;= target&quot;çš„åŒºé—´è¾¹ç•Œï¼Œæˆ‘ä»¬æœ€ç»ˆå°±èƒ½ç²¾ç¡®åœ°é”å®šç›®æ ‡ä½ç½®ã€‚</p>
<h2 id="äºŒåˆ†æœç´¢çš„å¸¸è§å˜ä½“åŠåº”ç”¨åœºæ™¯">äºŒåˆ†æœç´¢çš„å¸¸è§å˜ä½“åŠåº”ç”¨åœºæ™¯</h2>
<p>äºŒåˆ†æœç´¢æœ‰å¤šç§å˜ä½“ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š</p>
<h3 id="1-æŸ¥æ‰¾å€¼æ˜¯å¦å­˜åœ¨">1. æŸ¥æ‰¾å€¼æ˜¯å¦å­˜åœ¨</h3>
<p>è¿™æ˜¯æœ€åŸºæœ¬çš„äºŒåˆ†æœç´¢ï¼Œç”¨äºç¡®å®šä¸€ä¸ªå€¼æ˜¯å¦åœ¨æœ‰åºæ•°ç»„ä¸­ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">binarySearch</span><span class="params">(nums []<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    left, right := <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">        mid := left + (right-left)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> nums[mid] == target &#123;</span><br><span class="line">            <span class="keyword">return</span> mid <span class="comment">// æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œè¿”å›ç´¢å¼•</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> nums[mid] &lt; target &#123;</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid - <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span> <span class="comment">// ç›®æ ‡å€¼ä¸å­˜åœ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨Goä¸­å¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">idx := sort.SearchInts(nums, target)</span><br><span class="line"><span class="keyword">if</span> idx &lt; <span class="built_in">len</span>(nums) &amp;&amp; nums[idx] == target &#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ç›®æ ‡å€¼</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ç›®æ ‡å€¼ä¸å­˜åœ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ ï¼ˆæœ¬é¢˜ï¼‰">2. æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ ï¼ˆæœ¬é¢˜ï¼‰</h3>
<p>æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ ï¼Œæ˜¯ <code>sort.Search</code> å’Œ <code>sort.SearchInts</code> çš„é»˜è®¤è¡Œä¸ºã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨sort.Search</span></span><br><span class="line">idx := sort.Search(<span class="built_in">len</span>(nums), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> nums[i] &gt;= target</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨sort.SearchInts</span></span><br><span class="line">idx := sort.SearchInts(nums, target)</span><br></pre></td></tr></table></figure>
<h3 id="3-æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç›®æ ‡å€¼çš„å…ƒç´ ">3. æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç›®æ ‡å€¼çš„å…ƒç´ </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">idx := sort.Search(<span class="built_in">len</span>(nums), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> nums[i] &gt; target</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="4-æŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ ">4. æŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">idx := sort.Search(<span class="built_in">len</span>(nums), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> nums[i] &gt; target</span><br><span class="line">&#125;) - <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> idx &gt;= <span class="number">0</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°äº†æœ€åä¸€ä¸ªå°äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ </span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰å°äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-æŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç›®æ ‡å€¼çš„å…ƒç´ ">5. æŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç›®æ ‡å€¼çš„å…ƒç´ </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">idx := sort.Search(<span class="built_in">len</span>(nums), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> nums[i] &gt;= target</span><br><span class="line">&#125;) - <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> idx &gt;= <span class="number">0</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°äº†æœ€åä¸€ä¸ªå°äºç›®æ ‡å€¼çš„å…ƒç´ </span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰å°äºç›®æ ‡å€¼çš„å…ƒç´ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</h2>
<p>äºŒåˆ†æœç´¢åœ¨å®é™…ç¼–ç¨‹ä¸­æœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼š</p>
<h3 id="1-æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœç´¢ï¼ˆLeetCode-33ï¼‰">1. æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœç´¢ï¼ˆLeetCode 33ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">search</span><span class="params">(nums []<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    left, right := <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">        mid := left + (right-left)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> nums[mid] == target &#123;</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> nums[left] &lt;= nums[mid] &#123;</span><br><span class="line">            <span class="comment">// å·¦åŠéƒ¨åˆ†æœ‰åº</span></span><br><span class="line">            <span class="keyword">if</span> nums[left] &lt;= target &amp;&amp; target &lt; nums[mid] &#123;</span><br><span class="line">                right = mid - <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å³åŠéƒ¨åˆ†æœ‰åº</span></span><br><span class="line">            <span class="keyword">if</span> nums[mid] &lt; target &amp;&amp; target &lt;= nums[right] &#123;</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right = mid - <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-äºŒåˆ†æŸ¥æ‰¾ç­”æ¡ˆï¼ˆäºŒåˆ†ç­”æ¡ˆï¼‰">2. äºŒåˆ†æŸ¥æ‰¾ç­”æ¡ˆï¼ˆäºŒåˆ†ç­”æ¡ˆï¼‰</h3>
<p>ä¾‹å¦‚ï¼Œæ±‚å¹³æ–¹æ ¹ï¼ˆLeetCode 69ï¼‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mySqrt</span><span class="params">(x <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x &lt;= <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    left, right := <span class="number">1</span>, x/<span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">        mid := left + (right-left)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> mid &lt;= x/mid &amp;&amp; (mid+<span class="number">1</span>) &gt; x/(mid+<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> mid &gt; x/mid &#123;</span><br><span class="line">            right = mid - <span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> left</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-æŸ¥æ‰¾å³°å€¼å…ƒç´ ï¼ˆLeetCode-162ï¼‰">3. æŸ¥æ‰¾å³°å€¼å…ƒç´ ï¼ˆLeetCode 162ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findPeakElement</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    left, right := <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> left &lt; right &#123;</span><br><span class="line">        mid := left + (right-left)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> nums[mid] &gt; nums[mid+<span class="number">1</span>] &#123;</span><br><span class="line">            right = mid</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> left</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-åœ¨2DçŸ©é˜µä¸­äºŒåˆ†æŸ¥æ‰¾ï¼ˆLeetCode-240ï¼‰">4. åœ¨2DçŸ©é˜µä¸­äºŒåˆ†æŸ¥æ‰¾ï¼ˆLeetCode 240ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrix</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(matrix) == <span class="number">0</span> || <span class="built_in">len</span>(matrix[<span class="number">0</span>]) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    rows, cols := <span class="built_in">len</span>(matrix), <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">    row, col := <span class="number">0</span>, cols<span class="number">-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> row &lt; rows &amp;&amp; col &gt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> matrix[row][col] == target &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> matrix[row][col] &gt; target &#123;</span><br><span class="line">            col--</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            row++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ³¨æ„äº‹é¡¹å’Œå¸¸è§é”™è¯¯">æ³¨æ„äº‹é¡¹å’Œå¸¸è§é”™è¯¯</h2>
<p>ä½¿ç”¨äºŒåˆ†æœç´¢æ—¶ï¼Œæœ‰å‡ ä¸ªå¸¸è§çš„æ³¨æ„äº‹é¡¹å’Œæ½œåœ¨é”™è¯¯ï¼š</p>
<ol>
<li>
<p><strong>æ•´æ•°æº¢å‡º</strong>ï¼šè®¡ç®—ä¸­é—´ç´¢å¼•æ—¶ï¼Œåº”ä½¿ç”¨ <code>mid := left + (right-left)/2</code> è€Œä¸æ˜¯ <code>mid := (left+right)/2</code>ï¼Œåè€…åœ¨å¤§æ•°æ®èŒƒå›´æ—¶å¯èƒ½å¯¼è‡´æ•´æ•°æº¢å‡ºã€‚</p>
</li>
<li>
<p><strong>å¾ªç¯æ¡ä»¶</strong>ï¼šæ ¹æ®éœ€è¦é€‰æ‹© <code>left &lt;= right</code> æˆ– <code>left &lt; right</code>ã€‚å‰è€…åœ¨å¾ªç¯ç»“æŸæ—¶æœ‰ <code>left = right + 1</code>ï¼Œåè€…åœ¨å¾ªç¯ç»“æŸæ—¶æœ‰ <code>left = right</code>ã€‚</p>
</li>
<li>
<p><strong>è¾¹ç•Œæ›´æ–°</strong>ï¼šæ ¹æ®ä¸åŒçš„æœç´¢éœ€æ±‚ï¼Œè¾¹ç•Œæ›´æ–°æ–¹å¼ä¹Ÿä¸åŒã€‚ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ æ—¶ï¼Œå¯èƒ½éœ€è¦ <code>right = mid</code>ï¼Œè€Œä¸æ˜¯ <code>right = mid - 1</code>ã€‚</p>
</li>
<li>
<p><strong>åˆ¤æ–­å‡½æ•°è®¾è®¡</strong>ï¼šä½¿ç”¨ <code>sort.Search</code> æ—¶ï¼Œåˆ¤æ–­å‡½æ•°å¿…é¡»æ»¡è¶³å•è°ƒæ€§ã€‚</p>
</li>
<li>
<p><strong>è¿”å›å€¼å¤„ç†</strong>ï¼šå½“ä½¿ç”¨ <code>sort.Search</code> æˆ– <code>sort.SearchInts</code> ç­‰å‡½æ•°æ—¶ï¼Œéœ€è¦æ£€æŸ¥è¿”å›çš„ç´¢å¼•æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…ã€‚</p>
</li>
</ol>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p>å¯¹äºäºŒåˆ†æœç´¢ï¼š</p>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼š$O(\log n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚æ¯æ¬¡æ“ä½œéƒ½ä¼šå°†æœç´¢èŒƒå›´ç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠã€‚</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ï¼Œåªä½¿ç”¨äº†å¸¸æ•°é¢å¤–ç©ºé—´ã€‚</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>äºŒåˆ†æœç´¢æ˜¯ä¸€ç§å¼ºå¤§çš„ç®—æ³•æŠ€æœ¯ï¼ŒGoè¯­è¨€çš„æ ‡å‡†åº“æä¾›äº†å¤šç§ä¾¿æ·çš„äºŒåˆ†æœç´¢å‡½æ•°ã€‚é€šè¿‡æœ¬æ–‡çš„ç¤ºä¾‹å’Œè§£æï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†LeetCode 35é¢˜ï¼Œè¿˜æ·±å…¥å­¦ä¹ äº†Goè¯­è¨€ä¸­äºŒåˆ†æœç´¢çš„å„ç§å˜ä½“å’Œåº”ç”¨åœºæ™¯ã€‚</p>
<p><strong>å…³é”®æ”¶è·ï¼š</strong></p>
<ol>
<li>æŒæ¡ <code>sort.Search</code> åŠå…¶å˜ä½“å‡½æ•°çš„ç”¨æ³•å’Œç‰¹æ€§</li>
<li>äº†è§£äº”ç§å¸¸è§çš„äºŒåˆ†æœç´¢å˜ä½“åŠå…¶é€‚ç”¨åœºæ™¯</li>
<li>å­¦ä¼šå¤„ç†äºŒåˆ†æœç´¢ä¸­çš„è¾¹ç•Œæ¡ä»¶å’Œå¸¸è§é”™è¯¯</li>
<li>æŒæ¡åœ¨å®é™…ç¼–ç¨‹ä¸­åº”ç”¨äºŒåˆ†æœç´¢çš„æŠ€å·§</li>
</ol>
<p>è®°ä½ï¼ŒäºŒåˆ†æœç´¢ä¸ä»…é™äºåœ¨æ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œè¿˜å¯ä»¥ç”¨äºå„ç§éœ€è¦åœ¨æœ‰åºç©ºé—´ä¸­é«˜æ•ˆæŸ¥æ‰¾çš„åœºæ™¯ï¼Œå¦‚äºŒåˆ†ç­”æ¡ˆã€æŸ¥æ‰¾è¾¹ç•Œç­‰ã€‚çµæ´»è¿ç”¨è¿™ç§ç®—æ³•æŠ€æœ¯ï¼Œå°†å¤§å¤§æé«˜æˆ‘ä»¬è§£å†³é—®é¢˜çš„æ•ˆç‡ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>äºŒåˆ†æŸ¥æ‰¾</category>
      </categories>
      <tags>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Go</tag>
        <tag>æ•°ç»„</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL: å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å®Œå…¨è§£å†³å¹»è¯»äº†å—ï¼Ÿ</title>
    <url>/2025/05/07/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-07-MySQL-%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E%E5%B9%BB%E8%AF%BB/</url>
    <content><![CDATA[<h1>MySQL å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨è§£å†³å¹»è¯»äº†å—ï¼Ÿ</h1>
<blockquote>
<p><strong>æ ¸å¿ƒç»“è®ºï¼š</strong> MySQL çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»ï¼Œä½†å¹¶æ²¡æœ‰å®Œå…¨è§£å†³ã€‚</p>
</blockquote>
<h2 id="ç›®å½•">ç›®å½•</h2>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%BB%E8%AF%BB">1. ä»€ä¹ˆæ˜¯å¹»è¯»ï¼Ÿ</a></li>
<li><a href="#mysql-%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E5%B9%BB%E8%AF%BB">2. MySQL å¦‚ä½•é¿å…å¹»è¯»</a>
<ul>
<li><a href="#%E5%BF%AB%E7%85%A7%E8%AF%BB%E6%98%AF%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E5%B9%BB%E8%AF%BB%E7%9A%84">2.1 å¿«ç…§è¯»çš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#%E5%BD%93%E5%89%8D%E8%AF%BB%E6%98%AF%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E5%B9%BB%E8%AF%BB%E7%9A%84">2.2 å½“å‰è¯»çš„è§£å†³æ–¹æ¡ˆ</a></li>
</ul>
</li>
<li><a href="#%E5%B9%BB%E8%AF%BB%E8%A2%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E5%86%B3%E4%BA%86%E5%90%97">3. å¹»è¯»æ˜¯å¦è¢«å®Œå…¨è§£å†³</a>
<ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%91%E7%94%9F%E5%B9%BB%E8%AF%BB%E7%8E%B0%E8%B1%A1%E7%9A%84%E5%9C%BA%E6%99%AF">3.1 å¹»è¯»åœºæ™¯ä¸€ï¼šæ›´æ–°åå¯è§</a></li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%91%E7%94%9F%E5%B9%BB%E8%AF%BB%E7%8E%B0%E8%B1%A1%E7%9A%84%E5%9C%BA%E6%99%AF">3.2 å¹»è¯»åœºæ™¯äºŒï¼šæ··ç”¨è¯»å–æ–¹å¼</a></li>
</ul>
</li>
<li><a href="#%E9%81%BF%E5%85%8D%E5%B9%BB%E8%AF%BB%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">4. é¿å…å¹»è¯»çš„æœ€ä½³å®è·µ</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">5. æ€»ç»“ä¸å…³é”®ç‚¹</a></li>
</ul>
<p>æˆ‘åœ¨<a href="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">ä¸Šä¸€ç¯‡æ–‡ç« </a>æåˆ°ï¼ŒMySQL InnoDB å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«è™½ç„¶æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†å®ƒåªæ˜¯å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»ç°è±¡ï¼ˆå¹¶ä¸æ˜¯å®Œå…¨è§£å†³ï¼‰ã€‚InnoDB æä¾›äº†ä¸¤ç§ä¸åŒçš„æœºåˆ¶æ¥è§£å†³å¹»è¯»ï¼š</p>
<blockquote>
<p><strong>é˜²æ­¢å¹»è¯»çš„ä¸¤ç§æœºåˆ¶ï¼š</strong></p>
<ul>
<li>é’ˆå¯¹<strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€š select è¯­å¥ï¼‰ï¼šä½¿ç”¨ <strong>MVCC</strong> æœºåˆ¶ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®å§‹ç»ˆä¸äº‹åŠ¡å¯åŠ¨æ—¶ä¸€è‡´</li>
<li>é’ˆå¯¹<strong>å½“å‰è¯»</strong>ï¼ˆselect â€¦ for update ç­‰è¯­å¥ï¼‰ï¼šä½¿ç”¨ <strong>next-key lock</strong>ï¼ˆè®°å½•é”+é—´éš™é”ï¼‰ï¼Œé˜»å¡å…¶ä»–äº‹åŠ¡åœ¨é”èŒƒå›´å†…çš„æ’å…¥æ“ä½œ</li>
</ul>
</blockquote>
<p>è¿™ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆè™½ç„¶èƒ½å¤„ç†å¤§å¤šæ•°åœºæ™¯ï¼Œä½†ä»æœ‰ç‰¹æ®Šæƒ…å†µä¼šå‡ºç°å¹»è¯»ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æè¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯å¹»è¯»ï¼Ÿ">ä»€ä¹ˆæ˜¯å¹»è¯»ï¼Ÿ</h2>
<p><strong>å¹»è¯»å®šä¹‰</strong>ï¼šå½“åŒä¸€äº‹åŠ¡å†…ï¼Œç›¸åŒçš„æŸ¥è¯¢åœ¨ä¸åŒæ—¶é—´ç‚¹è¿”å›ä¸åŒçš„ç»“æœé›†æ—¶äº§ç”Ÿçš„ç°è±¡ã€‚</p>
<blockquote>
<p><strong>MySQL å®˜æ–¹æ–‡æ¡£è§£é‡Šï¼š</strong><br>
â€œ<em>The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a â€œphantomâ€ row.</em>â€</p>
<p>ç¿»è¯‘ï¼šå½“åŒä¸€ä¸ªæŸ¥è¯¢åœ¨ä¸åŒçš„æ—¶é—´äº§ç”Ÿä¸åŒçš„ç»“æœé›†æ—¶ï¼Œäº‹åŠ¡ä¸­å°±ä¼šå‡ºç°æ‰€è°“çš„å¹»è±¡é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ SELECT æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œä½†ç¬¬äºŒæ¬¡è¿”å›äº†ç¬¬ä¸€æ¬¡æ²¡æœ‰è¿”å›çš„è¡Œï¼Œåˆ™è¯¥è¡Œæ˜¯&quot;å¹»åƒ&quot;è¡Œã€‚</p>
</blockquote>
<h3 id="å¹»è¯»çš„ç®€å•åˆ¤æ–­æ ‡å‡†">å¹»è¯»çš„ç®€å•åˆ¤æ–­æ ‡å‡†</h3>
<p>å¦‚æœä¸€ä¸ªäº‹åŠ¡åœ¨ T1 å’Œ T2 ä¸¤ä¸ªæ—¶åˆ»æ‰§è¡Œå®Œå…¨ç›¸åŒçš„æŸ¥è¯¢ï¼Œç»“æœä¸åŒå°±æ˜¯å¹»è¯»ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾åœ¨T1å’ŒT2æ—¶åˆ»åˆ†åˆ«æ‰§è¡Œç›¸åŒæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_test <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
<p>å¹»è¯»çš„è¡¨ç°å½¢å¼ï¼š</p>
<ul>
<li>T1 æ—¶åˆ»æŸ¥è¯¢æœ‰ 5 æ¡è®°å½•ï¼ŒT2 æ—¶åˆ»å˜æˆäº† 6 æ¡è®°å½• âŸ¹ å¹»è¯»ï¼ˆå¤šäº†&quot;å¹»å½±è¡Œ&quot;ï¼‰</li>
<li>T1 æ—¶åˆ»æŸ¥è¯¢æœ‰ 5 æ¡è®°å½•ï¼ŒT2 æ—¶åˆ»å˜æˆäº† 4 æ¡è®°å½• âŸ¹ ä¹Ÿæ˜¯å¹»è¯»ï¼ˆå°‘äº†è®°å½•ï¼‰</li>
</ul>
<h3 id="å¹»è¯»ä¸ä¸å¯é‡å¤è¯»çš„åŒºåˆ«">å¹»è¯»ä¸ä¸å¯é‡å¤è¯»çš„åŒºåˆ«</h3>
<table>
<thead>
<tr>
<th>é—®é¢˜ç±»å‹</th>
<th>å…³æ³¨ç‚¹</th>
<th>å…¸å‹åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸å¯é‡å¤è¯»</td>
<td>åŒä¸€è¡Œæ•°æ®è¢«ä¿®æ”¹</td>
<td>ä¸¤æ¬¡è¯»å–åŒä¸€è¡Œï¼Œæ•°æ®å†…å®¹ä¸åŒ</td>
</tr>
<tr>
<td>å¹»è¯»</td>
<td>ç»“æœé›†è¡Œæ•°å˜åŒ–</td>
<td>ä¸¤æ¬¡ç›¸åŒèŒƒå›´æŸ¥è¯¢ï¼Œè¿”å›çš„è¡Œæ•°ä¸åŒ</td>
</tr>
</tbody>
</table>
<h2 id="MySQL-å¦‚ä½•é¿å…å¹»è¯»">MySQL å¦‚ä½•é¿å…å¹»è¯»</h2>
<h3 id="å¿«ç…§è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ">å¿«ç…§è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ</h3>
<p><strong>å¿«ç…§è¯»åŸç†ï¼š</strong> InnoDB é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å®ç°å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ã€‚</p>
<p>ğŸ” <strong>MVCC å·¥ä½œæµç¨‹å›¾ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">äº‹åŠ¡å¼€å§‹(begin) â¡ï¸ ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶åˆ›å»º Read View â¡ï¸ åç»­æŸ¥è¯¢å¤ç”¨åŒä¸€ Read View â¡ï¸ æ•°æ®ä¸€è‡´æ€§</span><br></pre></td></tr></table></figure>
<p>å…³é”®æœºåˆ¶ï¼š</p>
<ol>
<li>äº‹åŠ¡<strong>å¯åŠ¨åæ‰§è¡Œç¬¬ä¸€ä¸ªæŸ¥è¯¢è¯­å¥</strong>æ—¶åˆ›å»ºä¸€ä¸ª Read View</li>
<li>åç»­æ‰€æœ‰æŸ¥è¯¢<strong>å¤ç”¨è¿™ä¸ª Read View</strong></li>
<li>é€šè¿‡ Read View åœ¨ undo log ç‰ˆæœ¬é“¾ä¸­æ‰¾åˆ°<strong>äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®ç‰ˆæœ¬</strong></li>
<li>å³ä½¿å…¶ä»–äº‹åŠ¡æ’å…¥æ–°æ•°æ®å¹¶æäº¤ï¼Œå½“å‰äº‹åŠ¡ä¹Ÿ<strong>çœ‹ä¸åˆ°è¿™äº›æ–°æ•°æ®</strong></li>
</ol>
<h4 id="å®éªŒæ¼”ç¤º">å®éªŒæ¼”ç¤º</h4>
<p>è¡¨ t_stu æ•°æ®ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>å°æ—</td>
<td>50</td>
</tr>
<tr>
<td>2</td>
<td>å°æ˜</td>
<td>60</td>
</tr>
<tr>
<td>3</td>
<td>å°çº¢</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>å°è“</td>
<td>80</td>
</tr>
</tbody>
</table>
<p>äº‹åŠ¡æ‰§è¡Œé¡ºåºï¼š</p>
<p><img src="/2025/05/07/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-07-MySQL-%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E%E5%B9%BB%E8%AF%BB/1746620825818.png" alt="1746620825818"></p>
<blockquote>
<p><strong>å¿«ç…§è¯»ç»“è®ºï¼š</strong> å³ä½¿äº‹åŠ¡ B ä¸­é€”æ’å…¥äº†æ–°è®°å½•å¹¶æäº¤ï¼Œäº‹åŠ¡ A çš„ä¸¤æ¬¡æŸ¥è¯¢ç»“æœä»ç„¶ä¸€è‡´ï¼ˆéƒ½æ˜¯ 3 æ¡ï¼‰ï¼ŒæˆåŠŸé¿å…äº†å¹»è¯»ã€‚è¿™æ˜¯å› ä¸ºäº‹åŠ¡ A åœ¨ T2 æ—¶åˆ»åˆ›å»ºçš„ Read View ä¼šä¸€ç›´æ²¿ç”¨ï¼Œçœ‹ä¸åˆ° T2 ä¹‹åå…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹ã€‚</p>
</blockquote>
<h3 id="å½“å‰è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ">å½“å‰è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ</h3>
<p><strong>å½“å‰è¯»çš„ç‰¹ç‚¹</strong>ï¼šæ€»æ˜¯è¯»å–æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¸èµ° MVCCã€‚</p>
<p>å±äºå½“å‰è¯»çš„æ“ä½œï¼š</p>
<ul>
<li><code>SELECT ... FOR UPDATE</code>ï¼ˆåŠ æ’ä»–é”ï¼‰</li>
<li><code>SELECT ... LOCK IN SHARE MODE</code>ï¼ˆåŠ å…±äº«é”ï¼‰</li>
<li><code>UPDATE</code>ï¼ˆå…ˆè¯»åå†™ï¼Œè¯»çš„æ˜¯å½“å‰å€¼ï¼‰</li>
<li><code>INSERT</code></li>
<li><code>DELETE</code></li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆå½“å‰è¯»å¿…é¡»è¯»å–æœ€æ–°æ•°æ®ï¼Ÿ</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä½ è¦ <code>UPDATE</code> ä¸€æ¡è®°å½•ï¼Œä½†å¦ä¸€ä¸ªäº‹åŠ¡å·²ç» <code>DELETE</code> äº†è¿™æ¡è®°å½•å¹¶æäº¤ï¼Œå¦‚æœä½ è¯»çš„æ˜¯æ—§ç‰ˆæœ¬æ•°æ®ï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®å†²çªã€‚æ‰€ä»¥å½“å‰è¯»å¿…é¡»è¯»å–æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ã€‚</p>
<h4 id="å½“å‰è¯»ä¸ºä»€ä¹ˆéœ€è¦é¢å¤–æœºåˆ¶æ¥é¿å…å¹»è¯»">å½“å‰è¯»ä¸ºä»€ä¹ˆéœ€è¦é¢å¤–æœºåˆ¶æ¥é¿å…å¹»è¯»</h4>
<p>å½“å‰è¯»æ¯æ¬¡éƒ½è¯»æœ€æ–°æ•°æ®ï¼Œä¸åƒå¿«ç…§è¯»é‚£æ ·æœ‰ Read View ä¿æŠ¤ã€‚å¦‚æœæ²¡æœ‰é¢å¤–çš„é”æœºåˆ¶ï¼Œå°±ä¼šå‡ºç°ä¸‹å›¾çš„é—®é¢˜ï¼š</p>
<p><img src="/2025/05/07/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-07-MySQL-%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E%E5%B9%BB%E8%AF%BB/1746620834159.png" alt="1746620834159"></p>
<p>äº‹åŠ¡ A ä¸¤æ¬¡æ‰§è¡Œç›¸åŒçš„ <code>SELECT ... FOR UPDATE</code>ï¼Œç¬¬ä¸€æ¬¡è¿”å› 3 æ¡ï¼Œç¬¬äºŒæ¬¡è¿”å› 4 æ¡ï¼ˆå› ä¸ºäº‹åŠ¡ B ä¸­é€”æ’å…¥äº†æ–°è®°å½•ï¼‰ï¼Œè¿™å°±æ˜¯å¹»è¯»ã€‚</p>
<p>æ‰€ä»¥ InnoDB éœ€è¦ç”¨é”æ¥é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æ•°æ®ã€‚</p>
<h4 id="InnoDB-çš„è§£å†³æ–¹æ¡ˆï¼šé—´éš™é”">InnoDB çš„è§£å†³æ–¹æ¡ˆï¼šé—´éš™é”</h4>
<p>ä¸ºè§£å†³å½“å‰è¯»çš„å¹»è¯»é—®é¢˜ï¼ŒInnoDB å¼•å…¥äº†**é—´éš™é”ï¼ˆGap Lockï¼‰**å’Œ <strong>next-key lock</strong>ï¼š</p>
<ul>
<li><strong>è®°å½•é”ï¼ˆRecord Lockï¼‰</strong>ï¼šé”ä½å•æ¡è®°å½•</li>
<li><strong>é—´éš™é”ï¼ˆGap Lockï¼‰</strong>ï¼šé”ä½è®°å½•ä¹‹é—´çš„&quot;é—´éš™&quot;ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨é—´éš™ä¸­æ’å…¥æ•°æ®</li>
<li><strong>next-key lock</strong>ï¼šè®°å½•é” + é—´éš™é”çš„ç»„åˆï¼Œé”ä½è®°å½•æœ¬èº«åŠå…¶å‰é¢çš„é—´éš™</li>
</ul>
<p><img src="/2025/05/07/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-07-MySQL-%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E%E5%B9%BB%E8%AF%BB/1746620841733.png" alt="1746620841733"></p>
<p><strong>next-key lock å·¥ä½œåŸç†ï¼š</strong></p>
<p><img src="/2025/05/07/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-07-MySQL-%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E%E5%B9%BB%E8%AF%BB/1746620850469.png" alt="1746620850469"></p>
<p>ä»¥ <code>SELECT * FROM t_stu WHERE id &gt; 2 FOR UPDATE</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>äº‹åŠ¡ A æ‰§è¡Œè¯¥è¯­å¥æ—¶ï¼Œä¼šåŠ ä¸Š next-key lockï¼Œé”å®šèŒƒå›´ä¸º <code>(2, +âˆ]</code></li>
<li>äº‹åŠ¡ B å°è¯•æ’å…¥ id=5 çš„è®°å½•æ—¶ï¼Œå‘ç°è¯¥åŒºé—´è¢«é”å®š</li>
<li>äº‹åŠ¡ B ç”Ÿæˆä¸€ä¸ª<strong>æ’å…¥æ„å‘é”</strong>ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€</li>
<li>ç›´åˆ°äº‹åŠ¡ A æäº¤é‡Šæ”¾é”ï¼Œäº‹åŠ¡ B æ‰èƒ½æˆåŠŸæ’å…¥</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- äº‹åŠ¡ A æ‰§è¡Œå½“å‰è¯»ï¼Œé”å®š id &gt; 2 çš„èŒƒå›´</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_stu <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ­¤æ—¶äº‹åŠ¡ B å°è¯•æ’å…¥ä¼šè¢«é˜»å¡</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> t_stu <span class="keyword">VALUES</span>(<span class="number">5</span>, <span class="string">&#x27;å°ç¾&#x27;</span>, <span class="number">90</span>);  <span class="comment">-- é˜»å¡ç­‰å¾…</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>é—´éš™é”æ€»ç»“:</strong> é€šè¿‡é”å®šå¯èƒ½æ’å…¥è®°å½•çš„é—´éš™ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨é”èŒƒå›´å†…æ’å…¥æ•°æ®ï¼Œä»è€Œé¿å…å½“å‰è¯»çš„å¹»è¯»é—®é¢˜ã€‚</p>
</blockquote>
<h2 id="å¹»è¯»è¢«å®Œå…¨è§£å†³äº†å—ï¼Ÿ">å¹»è¯»è¢«å®Œå…¨è§£å†³äº†å—ï¼Ÿ</h2>
<div style="background-color: #f8f9fa; padding: 10px; border-left: 4px solid #e7505a; margin: 15px 0;">
<strong>ç»“è®ºï¼š</strong> å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»ï¼Œä½†ä»æœ‰ç‰¹æ®Šåœºæ™¯ä¼šå‘ç”Ÿå¹»è¯»ã€‚
</div>
<p>ä¸‹é¢ä»‹ç»ä¸¤ä¸ªåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ä»ç„¶ä¼šå‘ç”Ÿå¹»è¯»çš„åœºæ™¯ã€‚</p>
<h3 id="ç¬¬ä¸€ä¸ªå‘ç”Ÿå¹»è¯»ç°è±¡çš„åœºæ™¯">ç¬¬ä¸€ä¸ªå‘ç”Ÿå¹»è¯»ç°è±¡çš„åœºæ™¯</h3>
<p><strong>åœºæ™¯æè¿°ï¼š</strong> äº‹åŠ¡ A å…ˆç”¨å¿«ç…§è¯»æŸ¥è¯¢ä¸åˆ°æŸæ¡è®°å½•ï¼Œç„¶åå¯¹è¯¥è®°å½•æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œæ›´æ–°åå†æŸ¥è¯¢å°±èƒ½çœ‹åˆ°è¿™æ¡è®°å½•äº†ã€‚</p>
<p>å®éªŒè¡¨æ•°æ®ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>å°æ—</td>
<td>50</td>
</tr>
<tr>
<td>2</td>
<td>å°æ˜</td>
<td>60</td>
</tr>
<tr>
<td>3</td>
<td>å°çº¢</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>å°è“</td>
<td>80</td>
</tr>
</tbody>
</table>
<p><strong>æ­¥éª¤ 1ï¼š</strong> äº‹åŠ¡ A æŸ¥è¯¢ä¸å­˜åœ¨çš„è®°å½•ï¼ˆå¿«ç…§è¯»ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ A</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_stu <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶äº‹åŠ¡ A åˆ›å»ºäº† Read Viewï¼Œid=5 çš„è®°å½•ä¸å­˜åœ¨ã€‚</p>
<p><strong>æ­¥éª¤ 2ï¼š</strong> äº‹åŠ¡ B æ’å…¥è¯¥è®°å½•å¹¶æäº¤</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ B</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert into</span> t_stu <span class="keyword">values</span>(<span class="number">5</span>, <span class="string">&#x27;å°ç¾&#x27;</span>, <span class="number">18</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ B æ’å…¥äº† id=5 çš„è®°å½•å¹¶æäº¤ï¼Œæ­¤æ—¶æ•°æ®åº“ä¸­å·²ç»æœ‰è¿™æ¡è®°å½•äº†ã€‚</p>
<p><strong>æ­¥éª¤ 3ï¼š</strong> äº‹åŠ¡ A æ›´æ–°å¹¶æŸ¥è¯¢è¯¥è®°å½•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ A</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">update</span> t_stu <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;å°æ—coding&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_stu <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name         <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> å°æ—coding   <span class="operator">|</span>   <span class="number">18</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------------+------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p><strong>ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼</strong> äº‹åŠ¡ A æ˜æ˜ä¹‹å‰æŸ¥è¯¢ id=5 æ˜¯ç©ºçš„ï¼Œä½†æ›´æ–°æ“ä½œå´æˆåŠŸäº†ï¼Œè€Œä¸”æ›´æ–°åå†æŸ¥è¯¢å°±èƒ½çœ‹åˆ°è¿™æ¡è®°å½•äº†ã€‚</p>
<p><strong>æ—¶åºå›¾ï¼š</strong></p>
<p><img src="/2025/05/07/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-07-MySQL-%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E%E5%B9%BB%E8%AF%BB/1746620883100.png" alt="1746620883100"></p>
<blockquote>
<p><strong>å¹»è¯»åŸå› åˆ†æï¼š</strong></p>
<ol>
<li>äº‹åŠ¡ A åœ¨ T2 æ—¶åˆ»æ‰§è¡Œå¿«ç…§è¯»ï¼Œåˆ›å»º Read Viewï¼Œæ­¤æ—¶ id=5 ä¸å­˜åœ¨</li>
<li>äº‹åŠ¡ B åœ¨ T4 æ’å…¥ id=5 çš„è®°å½•å¹¶æäº¤</li>
<li>äº‹åŠ¡ A åœ¨ T6 æ‰§è¡Œ <code>UPDATE</code>ï¼Œè¿™æ˜¯<strong>å½“å‰è¯»</strong>ï¼Œä¼šè¯»å–æœ€æ–°æ•°æ®ï¼Œæ‰€ä»¥èƒ½æ›´æ–°æˆåŠŸ</li>
<li><strong>å…³é”®ç‚¹</strong>ï¼šUPDATE æ“ä½œä¼šå°†è¯¥è®°å½•çš„ <code>trx_id</code>ï¼ˆäº‹åŠ¡IDï¼‰æ”¹æˆäº‹åŠ¡ A çš„ ID</li>
<li>äº‹åŠ¡ A åœ¨ T7 å†æ¬¡æŸ¥è¯¢æ—¶ï¼Œå‘ç°è¯¥è®°å½•çš„ <code>trx_id</code> å°±æ˜¯è‡ªå·±ï¼Œæ‰€ä»¥èƒ½çœ‹åˆ°è¿™æ¡è®°å½•</li>
</ol>
<p>è¿™å°±å¯¼è‡´äº†äº‹åŠ¡ A å‰åä¸¤æ¬¡æŸ¥è¯¢ id=5 çš„ç»“æœä¸ä¸€è‡´ï¼Œå‘ç”Ÿäº†å¹»è¯»ã€‚</p>
</blockquote>
<h3 id="ç¬¬äºŒä¸ªå‘ç”Ÿå¹»è¯»ç°è±¡çš„åœºæ™¯">ç¬¬äºŒä¸ªå‘ç”Ÿå¹»è¯»ç°è±¡çš„åœºæ™¯</h3>
<p><strong>åœºæ™¯æè¿°ï¼š</strong> åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå…ˆæ‰§è¡Œå¿«ç…§è¯»ï¼Œå†æ‰§è¡Œå½“å‰è¯»ï¼Œç”±äºä¸¤ç§è¯»å–æ–¹å¼çš„æœºåˆ¶ä¸åŒï¼Œä¼šå¯¼è‡´å¹»è¯»ã€‚</p>
<p><strong>è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<table>
<thead>
<tr>
<th>æ—¶åˆ»</th>
<th>äº‹åŠ¡ A</th>
<th>äº‹åŠ¡ B</th>
</tr>
</thead>
<tbody>
<tr>
<td>T1</td>
<td><code>BEGIN;</code></td>
<td></td>
</tr>
<tr>
<td>T2</td>
<td><code>SELECT * FROM t_stu WHERE id &gt; 2;</code> (3æ¡ï¼Œå¿«ç…§è¯»)</td>
<td></td>
</tr>
<tr>
<td>T3</td>
<td></td>
<td><code>BEGIN;</code></td>
</tr>
<tr>
<td>T4</td>
<td></td>
<td><code>INSERT INTO t_stu VALUES(5, 'å°ç¾', 90);</code></td>
</tr>
<tr>
<td>T5</td>
<td></td>
<td><code>COMMIT;</code></td>
</tr>
<tr>
<td>T6</td>
<td><code>SELECT * FROM t_stu WHERE id &gt; 2 FOR UPDATE;</code> (4æ¡ï¼Œå½“å‰è¯»!)</td>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ A</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># T2: å¿«ç…§è¯»ï¼Œè¿”å› <span class="number">3</span> æ¡è®°å½•</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_stu <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> å°çº¢ <span class="operator">|</span>    <span class="number">70</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> å°è“ <span class="operator">|</span>    <span class="number">80</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># æ­¤æ—¶äº‹åŠ¡ B æ’å…¥ id<span class="operator">=</span><span class="number">5</span> çš„è®°å½•å¹¶æäº¤...</span><br><span class="line"></span><br><span class="line"># T6: å½“å‰è¯»ï¼Œè¿”å› <span class="number">4</span> æ¡è®°å½•ï¼</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_stu <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> å°çº¢ <span class="operator">|</span>    <span class="number">70</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> å°è“ <span class="operator">|</span>    <span class="number">80</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> å°ç¾ <span class="operator">|</span>    <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>å¹»è¯»åŸå› åˆ†æï¼š</strong></p>
<ul>
<li><strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€š SELECTï¼‰ï¼šä½¿ç”¨ MVCC æœºåˆ¶ï¼Œè¯»å–çš„æ˜¯ Read View åˆ›å»ºæ—¶çš„æ•°æ®ç‰ˆæœ¬</li>
<li><strong>å½“å‰è¯»</strong>ï¼ˆSELECT â€¦ FOR UPDATEï¼‰ï¼šç›´æ¥è¯»å–æœ€æ–°çš„æ•°æ®ç‰ˆæœ¬</li>
</ul>
<p>ç”±äºä¸¤ç§è¯»å–æ–¹å¼çš„æ•°æ®æ¥æºä¸åŒï¼Œåœ¨åŒä¸€äº‹åŠ¡ä¸­æ··ç”¨å°±ä¼šå‡ºç°ç»“æœä¸ä¸€è‡´çš„æƒ…å†µï¼Œå³å¹»è¯»ã€‚</p>
</blockquote>
<p><strong>å¦‚ä½•é¿å…è¿™ç§æƒ…å†µï¼Ÿ</strong></p>
<p>å¦‚æœéœ€è¦åœ¨äº‹åŠ¡ä¸­ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œåº”è¯¥åœ¨äº‹åŠ¡å¼€å§‹å<strong>ç«‹å³ä½¿ç”¨å½“å‰è¯»</strong>æ¥é”å®šæ•°æ®èŒƒå›´ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡ A <span class="operator">-</span> æ­£ç¡®åšæ³•</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">begin</span>;</span><br><span class="line"># ä¸€å¼€å§‹å°±ç”¨å½“å‰è¯»é”å®šèŒƒå›´</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_stu <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"># æ­¤æ—¶äº‹åŠ¡ B çš„æ’å…¥ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡ A æäº¤</span><br></pre></td></tr></table></figure>
<h2 id="é¿å…å¹»è¯»çš„æœ€ä½³å®è·µ">é¿å…å¹»è¯»çš„æœ€ä½³å®è·µ</h2>
<div style="background-color: #f0f8ff; padding: 10px; border-left: 4px solid #4285f4; margin: 15px 0;">
<strong>æ ¸å¿ƒåŸåˆ™ï¼š</strong> åœ¨äº‹åŠ¡å¼€å§‹åï¼Œç«‹å³æ‰§è¡Œå½“å‰è¯»æ“ä½œï¼Œé”å®šç›¸å…³è®°å½•èŒƒå›´ã€‚
</div>
<h3 id="å…·ä½“å»ºè®®">å…·ä½“å»ºè®®</h3>
<p><strong>1. å°½æ—©ä½¿ç”¨ <code>SELECT ... FOR UPDATE</code> é”å®šæ•°æ®èŒƒå›´</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="comment">-- äº‹åŠ¡å¼€å§‹åç«‹å³ç”¨å½“å‰è¯»é”å®šèŒƒå›´</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_stu <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- åç»­æ“ä½œ...</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å…¶ä»–äº‹åŠ¡åœ¨è¯¥èŒƒå›´å†…çš„æ’å…¥æ“ä½œä¼šè¢«é˜»å¡ï¼Œä»æ ¹æœ¬ä¸Šé¿å…å¹»è¯»ã€‚</p>
<p><strong>2. é¿å…åœ¨åŒä¸€äº‹åŠ¡ä¸­æ··ç”¨å¿«ç…§è¯»å’Œå½“å‰è¯»</strong></p>
<p>å¦‚æœä¸šåŠ¡é€»è¾‘éœ€è¦å¤šæ¬¡æŸ¥è¯¢ï¼Œè¦ä¹ˆå…¨éƒ¨ä½¿ç”¨å¿«ç…§è¯»ï¼Œè¦ä¹ˆå…¨éƒ¨ä½¿ç”¨å½“å‰è¯»ï¼Œä¸è¦æ··ç”¨ã€‚</p>
<p><strong>3. ä¿æŒäº‹åŠ¡ç®€çŸ­</strong></p>
<p>é•¿äº‹åŠ¡ä¼šé•¿æ—¶é—´æŒæœ‰é”ï¼Œå½±å“å¹¶å‘æ€§èƒ½ã€‚å°½é‡ç¼©çŸ­äº‹åŠ¡æ‰§è¡Œæ—¶é—´ã€‚</p>
<p><strong>4. æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«</strong></p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èéš”ç¦»çº§åˆ«</th>
<th>åŸå› </th>
</tr>
</thead>
<tbody>
<tr>
<td>éœ€è¦ä¸¥æ ¼é¿å…å¹»è¯»</td>
<td>å¯é‡å¤è¯» + å½“å‰è¯»</td>
<td>åˆ©ç”¨ next-key lock é”å®šèŒƒå›´</td>
</tr>
<tr>
<td>å¯¹å¹»è¯»ä¸æ•æ„Ÿï¼Œè¿½æ±‚é«˜å¹¶å‘</td>
<td>è¯»å·²æäº¤</td>
<td>å‡å°‘é”å†²çªï¼Œæé«˜å¹¶å‘æ€§</td>
</tr>
<tr>
<td>é‡‘èç­‰å¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯</td>
<td>ä¸²è¡ŒåŒ–</td>
<td>æœ€é«˜éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨é¿å…å¹¶å‘é—®é¢˜</td>
</tr>
</tbody>
</table>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<h3 id="å¹»è¯»é—®é¢˜çš„è§£å†³æ–¹æ¡ˆå¯¹æ¯”">å¹»è¯»é—®é¢˜çš„è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æŸ¥è¯¢ç±»å‹</th>
<th>è§£å†³æœºåˆ¶</th>
<th>æ˜¯å¦å®Œå…¨è§£å†³</th>
<th>é™åˆ¶æ¡ä»¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¿«ç…§è¯»</td>
<td>MVCC æœºåˆ¶</td>
<td>å¦</td>
<td>æ›´æ–°æ“ä½œä¼šä½¿æ–°è®°å½•åœ¨äº‹åŠ¡å†…å¯è§</td>
</tr>
<tr>
<td>å½“å‰è¯»</td>
<td>next-key é”</td>
<td>å¦</td>
<td>éœ€è¦åœ¨äº‹åŠ¡å¼€å§‹æ—¶å°±æ‰§è¡Œå½“å‰è¯»ï¼Œæ‰èƒ½é”å®šèŒƒå›´</td>
</tr>
</tbody>
</table>
<h3 id="å…³é”®è¦ç‚¹">å…³é”®è¦ç‚¹</h3>
<p><strong>1. MySQL InnoDB çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«é‡‡ç”¨ä¸¤ç§æœºåˆ¶é¿å…å¹»è¯»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>è¯»å–æ–¹å¼</th>
<th>æœºåˆ¶</th>
<th>åŸç†</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¿«ç…§è¯»</td>
<td>MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</td>
<td>å¤ç”¨ Read Viewï¼Œå§‹ç»ˆè¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®</td>
</tr>
<tr>
<td>å½“å‰è¯»</td>
<td>next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰</td>
<td>é”å®šè®°å½•å’Œé—´éš™ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥</td>
</tr>
</tbody>
</table>
<p><strong>2. å¹»è¯»ä»å¯èƒ½åœ¨ä»¥ä¸‹åœºæ™¯å‡ºç°ï¼š</strong></p>
<ul>
<li><strong>åœºæ™¯ä¸€</strong>ï¼šäº‹åŠ¡ A å…ˆå¿«ç…§è¯»æŸ¥ä¸åˆ°è®°å½•ï¼Œç„¶åå¯¹è¯¥è®°å½•æ‰§è¡Œ UPDATE/DELETEï¼Œå†æŸ¥è¯¢å°±èƒ½çœ‹åˆ°äº†</li>
<li><strong>åœºæ™¯äºŒ</strong>ï¼šåŒä¸€äº‹åŠ¡å†…å…ˆç”¨å¿«ç…§è¯»ï¼Œå†ç”¨å½“å‰è¯»ï¼Œä¸¤æ¬¡ç»“æœä¸ä¸€è‡´</li>
</ul>
<p><strong>3. é¿å…å¹»è¯»çš„æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li>å°½é‡åœ¨äº‹åŠ¡å¼€å§‹å<strong>ç«‹å³ä½¿ç”¨ <code>SELECT ... FOR UPDATE</code></strong> é”å®šç›¸å…³è®°å½•èŒƒå›´</li>
<li><strong>ä¸è¦æ··ç”¨</strong>å¿«ç…§è¯»å’Œå½“å‰è¯»</li>
<li>ä¿æŒäº‹åŠ¡ç®€çŸ­ï¼Œå‡å°‘é”å†²çª</li>
<li>æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«</li>
</ul>
<div style="background-color: #fef9e6; padding: 10px; border-left: 4px solid #f1c40f; margin: 15px 0;">
<strong>è®°ä½ï¼š</strong> MySQL çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å¹¶éå®Œå…¨è§£å†³äº†å¹»è¯»ï¼Œè€Œæ˜¯åœ¨å¤§å¤šæ•°å¸¸è§åœºæ™¯ä¸‹é¿å…äº†å¹»è¯»ã€‚äº†è§£å…¶å·¥ä½œåŸç†å’Œè¾¹ç•Œæƒ…å†µï¼Œæ‰èƒ½è®¾è®¡å‡ºæ›´å¯é çš„æ•°æ®åº“åº”ç”¨ã€‚
</div>
<h3 id="é¢è¯•å›ç­”è¦ç‚¹">é¢è¯•å›ç­”è¦ç‚¹</h3>
<p>å¦‚æœé¢è¯•å®˜é—®&quot;MySQL å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å®Œå…¨è§£å†³å¹»è¯»äº†å—ï¼Ÿ&quot;ï¼Œå¯ä»¥è¿™æ ·å›ç­”ï¼š</p>
<blockquote>
<p>æ²¡æœ‰å®Œå…¨è§£å†³ã€‚MySQL çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«é€šè¿‡ä¸¤ç§æœºåˆ¶æ¥é¿å…å¹»è¯»ï¼š</p>
<ol>
<li>
<p><strong>å¿«ç…§è¯»</strong>ä½¿ç”¨ MVCC æœºåˆ¶ï¼Œäº‹åŠ¡å¯åŠ¨ååˆ›å»º Read Viewï¼Œåç»­æŸ¥è¯¢å¤ç”¨è¿™ä¸ª Read Viewï¼Œæ‰€ä»¥çœ‹ä¸åˆ°å…¶ä»–äº‹åŠ¡æ–°æ’å…¥çš„æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>å½“å‰è¯»</strong>ä½¿ç”¨ next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰ï¼Œé”å®šæŸ¥è¯¢èŒƒå›´ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥èŒƒå›´å†…æ’å…¥æ•°æ®ã€‚</p>
</li>
</ol>
<p>ä½†æ˜¯æœ‰ä¸¤ç§ç‰¹æ®Šæƒ…å†µä»ä¼šå‘ç”Ÿå¹»è¯»ï¼š</p>
<ol>
<li>
<p>äº‹åŠ¡ A å…ˆç”¨å¿«ç…§è¯»æŸ¥ä¸åˆ°æŸæ¡è®°å½•ï¼Œç„¶åå¯¹è¯¥è®°å½•æ‰§è¡Œ UPDATEï¼Œç”±äº UPDATE æ˜¯å½“å‰è¯»ä¼šè¯»åˆ°æœ€æ–°æ•°æ®ï¼Œæ›´æ–°æˆåŠŸåè¯¥è®°å½•çš„äº‹åŠ¡ ID å˜æˆäº‹åŠ¡ A çš„ IDï¼Œå†æ¬¡æŸ¥è¯¢å°±èƒ½çœ‹åˆ°è¿™æ¡è®°å½•äº†ã€‚</p>
</li>
<li>
<p>åŒä¸€äº‹åŠ¡ä¸­æ··ç”¨å¿«ç…§è¯»å’Œå½“å‰è¯»ï¼Œç”±äºä¸¤ç§è¯»å–æ–¹å¼çš„æ•°æ®æ¥æºä¸åŒï¼Œä¼šå¯¼è‡´ç»“æœä¸ä¸€è‡´ã€‚</p>
</li>
</ol>
<p>è¦å®Œå…¨é¿å…å¹»è¯»ï¼Œåº”è¯¥åœ¨äº‹åŠ¡å¼€å§‹åç«‹å³ä½¿ç”¨ <code>SELECT ... FOR UPDATE</code> é”å®šæ•°æ®èŒƒå›´ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>äº‹åŠ¡</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>MySQL</tag>
        <tag>äº‹åŠ¡éš”ç¦»çº§åˆ«</tag>
        <tag>å¹»è¯»</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 52 - Nçš‡å IIï¼ˆN-Queens IIï¼‰</title>
    <url>/2025/05/07/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-52-N%E7%9A%87%E5%90%8E-II/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>Nçš‡å II æ˜¯ <a href="/2025/05/07/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-51-N%E7%9A%87%E5%90%8E/">Nçš‡åé—®é¢˜</a> çš„å»¶ä¼¸ã€‚ä¸åŒçš„æ˜¯ï¼Œè¿™é“é¢˜åªéœ€è¦è¿”å›ä¸åŒè§£å†³æ–¹æ¡ˆçš„<strong>æ•°é‡</strong>ï¼Œè€Œä¸éœ€è¦è¿”å›å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä¸Nçš‡åé—®é¢˜ç›¸åŒï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>çš‡åå¯ä»¥æ”»å‡»ä¸ä¹‹å¤„åœ¨åŒä¸€è¡Œæˆ–åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šçš„æ£‹å­</li>
<li>éœ€è¦å°†Nä¸ªçš‡åæ”¾ç½®åœ¨NÃ—Nçš„æ£‹ç›˜ä¸Šï¼Œä½¿çš‡åå½¼æ­¤ä¸èƒ½ç›¸äº’æ”»å‡»</li>
<li>ç»™ä½ ä¸€ä¸ªæ•´æ•°Nï¼Œè¿”å›æ‰€æœ‰ä¸åŒè§£å†³æ–¹æ¡ˆçš„æ•°é‡</li>
</ul>
<h3 id="ç¤ºä¾‹-1">ç¤ºä¾‹ 1</h3>
<p><strong>è¾“å…¥</strong>ï¼šn = 4<br>
<strong>è¾“å‡º</strong>ï¼š2</p>
<p><strong>è§£é‡Š</strong>ï¼šå¦‚åŒNçš‡åé—®é¢˜æ‰€ç¤ºï¼Œ4çš‡åé—®é¢˜å…±æœ‰ä¸¤ç§è§£æ³•ã€‚</p>
<h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹ 2</h3>
<p><strong>è¾“å…¥</strong>ï¼šn = 1<br>
<strong>è¾“å‡º</strong>ï¼š1</p>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>1 &lt;= n &lt;= 9</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜ä¸<a href="/2025/05/07/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-51-N%E7%9A%87%E5%90%8E/">Nçš‡åé—®é¢˜</a>çš„æ ¸å¿ƒç®—æ³•ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºï¼š</p>
<ol>
<li>ä¸éœ€è¦è®°å½•æ£‹ç›˜çš„å…·ä½“æ‘†æ”¾æ–¹å¼</li>
<li>åªéœ€è¦è®¡ç®—è§£çš„æ•°é‡</li>
<li>å¯ä»¥æ›´è¿›ä¸€æ­¥ä½¿ç”¨ä½è¿ç®—ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦</li>
</ol>
<h3 id="åŸºç¡€è§£æ³•">åŸºç¡€è§£æ³•</h3>
<p>åŸºç¡€è§£æ³•ä¸Nçš‡åé—®é¢˜ç±»ä¼¼ï¼Œä½¿ç”¨å›æº¯ç®—æ³•ï¼š</p>
<ol>
<li>ä½¿ç”¨ä¸‰ä¸ªå¸ƒå°”æ•°ç»„è®°å½•è¡Œã€ä¸»å¯¹è§’çº¿ã€å‰¯å¯¹è§’çº¿çš„å ç”¨æƒ…å†µ</li>
<li>æŒ‰åˆ—é€’å½’ï¼Œå¯¹äºæ¯ä¸€åˆ—å°è¯•åœ¨å„è¡Œæ”¾ç½®çš‡å</li>
<li>å½“æˆåŠŸæ”¾ç½®Nä¸ªçš‡åæ—¶ï¼Œè§£çš„è®¡æ•°å™¨åŠ 1</li>
<li>å›æº¯è¿‡ç¨‹ä¸­æ’¤é”€å¯¹è¡Œå’Œå¯¹è§’çº¿çš„æ ‡è®°</li>
</ol>
<p>æ­¤å¤„æˆ‘ä»¬ç›´æ¥è·³è¿‡å…·ä½“çš„æ£‹ç›˜è¡¨ç¤ºï¼Œä»…ä½¿ç”¨è®¡æ•°å™¨è®°å½•è§£çš„æ•°é‡ã€‚</p>
<h3 id="ä½è¿ç®—ä¼˜åŒ–">ä½è¿ç®—ä¼˜åŒ–</h3>
<p><strong>æ ¸å¿ƒæ´è§</strong>ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•´æ•°çš„äºŒè¿›åˆ¶ä½ä»£æ›¿å¸ƒå°”æ•°ç»„ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦ã€‚</p>
<p>åœ¨ä½è¿ç®—è§£æ³•ä¸­ï¼š</p>
<ol>
<li>ä½¿ç”¨ä¸€ä¸ªæ•´æ•°çš„äºŒè¿›åˆ¶ä½è¡¨ç¤ºæ¯ä¸€è¡Œæ˜¯å¦å·²æ”¾ç½®çš‡å</li>
<li>åŒæ ·ä½¿ç”¨æ•´æ•°è¡¨ç¤ºä¸»å¯¹è§’çº¿å’Œå‰¯å¯¹è§’çº¿çš„å ç”¨æƒ…å†µ</li>
<li>é€šè¿‡ä½æ“ä½œé«˜æ•ˆåœ°æ£€æŸ¥ä½ç½®å¯ç”¨æ€§å’Œæ›´æ–°çŠ¶æ€</li>
</ol>
<p>ä½è¿ç®—çš„å…³é”®æ“ä½œï¼š</p>
<ul>
<li>æ£€æŸ¥ä½ç½®å¯ç”¨æ€§ï¼š<code>(~(rows | diags1 | diags2)) &amp; (1 &lt;&lt; i)</code></li>
<li>æ ‡è®°å ç”¨ï¼š<code>rows |= (1 &lt;&lt; i)</code></li>
<li>æ’¤é”€æ ‡è®°ï¼š<code>rows &amp;= ~(1 &lt;&lt; i)</code></li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ ‡å‡†å›æº¯å®ç°">æ ‡å‡†å›æº¯å®ç°</h3>
<p>ä¸Nçš‡åé—®é¢˜ç›¸æ¯”ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ„å»ºæ£‹ç›˜ï¼Œåªéœ€è®¡æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">totalNQueens</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// æ ‡è®°æ•°ç»„ï¼Œè®°å½•å·²å ç”¨çš„è¡Œå’Œå¯¹è§’çº¿</span></span><br><span class="line">    rowUsed := <span class="built_in">make</span>([]<span class="type">bool</span>, n)          <span class="comment">// æ ‡è®°è¡Œæ˜¯å¦å·²è¢«å ç”¨</span></span><br><span class="line">    mainDiagUsed := <span class="built_in">make</span>([]<span class="type">bool</span>, <span class="number">2</span>*n)   <span class="comment">// æ ‡è®°ä¸»å¯¹è§’çº¿æ˜¯å¦å·²è¢«å ç”¨</span></span><br><span class="line">    subDiagUsed := <span class="built_in">make</span>([]<span class="type">bool</span>, <span class="number">2</span>*n)    <span class="comment">// æ ‡è®°å‰¯å¯¹è§’çº¿æ˜¯å¦å·²è¢«å ç”¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£çš„è®¡æ•°å™¨</span></span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// DFSå‡½æ•°ï¼Œcolè¡¨ç¤ºå½“å‰å¤„ç†çš„åˆ—</span></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(col <span class="type">int</span>)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(col <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰€æœ‰åˆ—éƒ½å·²å¤„ç†ï¼Œæ‰¾åˆ°ä¸€ä¸ªè§£</span></span><br><span class="line">        <span class="keyword">if</span> col == n &#123;</span><br><span class="line">            count++</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°è¯•åœ¨å½“å‰åˆ—çš„æ¯ä¸€è¡Œæ”¾ç½®çš‡å</span></span><br><span class="line">        <span class="keyword">for</span> row := <span class="number">0</span>; row &lt; n; row++ &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥ä½ç½®(row, col)æ˜¯å¦å®‰å…¨</span></span><br><span class="line">            <span class="keyword">if</span> rowUsed[row] || mainDiagUsed[row+col] || subDiagUsed[n+row-col] &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ ‡è®°å ç”¨</span></span><br><span class="line">            rowUsed[row] = <span class="literal">true</span></span><br><span class="line">            mainDiagUsed[row+col] = <span class="literal">true</span></span><br><span class="line">            subDiagUsed[n+row-col] = <span class="literal">true</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// é€’å½’å¤„ç†ä¸‹ä¸€åˆ—</span></span><br><span class="line">            dfs(col + <span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å›æº¯ï¼šæ’¤é”€æ ‡è®°</span></span><br><span class="line">            rowUsed[row] = <span class="literal">false</span></span><br><span class="line">            mainDiagUsed[row+col] = <span class="literal">false</span></span><br><span class="line">            subDiagUsed[n+row-col] = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»ç¬¬0åˆ—å¼€å§‹DFS</span></span><br><span class="line">    dfs(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä½è¿ç®—ä¼˜åŒ–å®ç°">ä½è¿ç®—ä¼˜åŒ–å®ç°</h3>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä½è¿ç®—æ¥ä¼˜åŒ–è§£æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">totalNQueens</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// è§£çš„è®¡æ•°å™¨</span></span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä½è¿ç®—å®ç°çš„DFS</span></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(col, rows, diags1, diags2 <span class="type">int</span>)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(col, rows, diags1, diags2 <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// å®Œæˆäº†Nåˆ—çš„æ”¾ç½®ï¼Œæ‰¾åˆ°ä¸€ä¸ªè§£</span></span><br><span class="line">        <span class="keyword">if</span> col == n &#123;</span><br><span class="line">            count++</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—å½“å‰åˆ—æ‰€æœ‰å¯æ”¾ç½®çš‡åçš„ä½ç½®</span></span><br><span class="line">        <span class="comment">// ~(rows | diags1 | diags2) è¡¨ç¤ºæ‰€æœ‰å¯ç”¨çš„ä½ç½®ï¼ˆå€¼ä¸º1çš„ä½ï¼‰</span></span><br><span class="line">        <span class="comment">// &amp; ((1 &lt;&lt; n) - 1) ç¡®ä¿åªè€ƒè™‘æ£‹ç›˜èŒƒå›´å†…çš„ä½ï¼ˆnä½ï¼‰</span></span><br><span class="line">        availablePositions := ^(rows | diags1 | diags2) &amp; ((<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€ä¸€å°è¯•å¯æ”¾ç½®çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">for</span> availablePositions &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–æœ€ä½ä½çš„1ï¼ˆè¡¨ç¤ºä¸€ä¸ªå¯æ”¾ç½®çš„ä½ç½®ï¼‰</span></span><br><span class="line">            position := availablePositions &amp; -availablePositions</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å°†è¿™ä¸ªä½ä»å¯ç”¨ä½ç½®ä¸­ç§»é™¤</span></span><br><span class="line">            availablePositions ^= position</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// é€’å½’å¤„ç†ä¸‹ä¸€åˆ—</span></span><br><span class="line">            <span class="comment">// rows | position: æ›´æ–°å·²å ç”¨çš„è¡Œ</span></span><br><span class="line">            <span class="comment">// (diags1 | position) &lt;&lt; 1: æ›´æ–°ä¸»å¯¹è§’çº¿ï¼Œå·¦ç§»æ¨¡æ‹Ÿå¯¹è§’çº¿ç§»åŠ¨</span></span><br><span class="line">            <span class="comment">// (diags2 | position) &gt;&gt; 1: æ›´æ–°å‰¯å¯¹è§’çº¿ï¼Œå³ç§»æ¨¡æ‹Ÿå¯¹è§’çº¿ç§»åŠ¨</span></span><br><span class="line">            dfs(col+<span class="number">1</span>, rows|position, (diags1|position)&lt;&lt;<span class="number">1</span>, (diags2|position)&gt;&gt;<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä¸éœ€è¦æ˜¾å¼å›æº¯ï¼Œå› ä¸ºæˆ‘ä»¬ä¼ é€’çš„æ˜¯å€¼è€Œä¸æ˜¯å¼•ç”¨</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»ç¬¬0åˆ—å¼€å§‹ï¼Œåˆå§‹æ—¶æ‰€æœ‰è¡Œå’Œå¯¹è§’çº¿éƒ½æœªè¢«å ç”¨ï¼ˆéƒ½æ˜¯0ï¼‰</span></span><br><span class="line">    dfs(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä½è¿ç®—è§£æ³•è¯¦è§£">ä½è¿ç®—è§£æ³•è¯¦è§£</h2>
<p>ä½è¿ç®—å¯èƒ½ä¸é‚£ä¹ˆç›´è§‚ï¼Œè®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šå…¶å·¥ä½œåŸç†ï¼š</p>
<h3 id="çŠ¶æ€è¡¨ç¤º">çŠ¶æ€è¡¨ç¤º</h3>
<p>åœ¨ä½è¿ç®—è§£æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•°çš„äºŒè¿›åˆ¶ä½æ¥è¡¨ç¤ºå„è¡Œå’Œå¯¹è§’çº¿çš„å ç”¨æƒ…å†µï¼š</p>
<ol>
<li><strong>rows</strong>ï¼šç¬¬iä½è¡¨ç¤ºç¬¬iè¡Œæ˜¯å¦å·²æ”¾ç½®çš‡å</li>
<li><strong>diags1</strong>ï¼šè¡¨ç¤ºä¸»å¯¹è§’çº¿ï¼ˆå·¦ä¸Šè‡³å³ä¸‹ï¼‰çš„å ç”¨æƒ…å†µ</li>
<li><strong>diags2</strong>ï¼šè¡¨ç¤ºå‰¯å¯¹è§’çº¿ï¼ˆå³ä¸Šè‡³å·¦ä¸‹ï¼‰çš„å ç”¨æƒ…å†µ</li>
</ol>
<h3 id="ä½æ“ä½œè§£é‡Š">ä½æ“ä½œè§£é‡Š</h3>
<ol>
<li>
<p><strong>æ£€æŸ¥å¯ç”¨ä½ç½®</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">availablePositions := ^(rows | diags1 | diags2) &amp; ((<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>rows | diags1 | diags2</code>ï¼šåˆå¹¶æ‰€æœ‰è¢«å ç”¨çš„ä½</li>
<li><code>^</code>ï¼šæŒ‰ä½å–åï¼Œå°†0å˜ä¸º1ï¼Œ1å˜ä¸º0ï¼Œè¿™æ ·1å°±è¡¨ç¤ºå¯ç”¨ä½ç½®</li>
<li><code>&amp; ((1 &lt;&lt; n) - 1)</code>ï¼šä¿ç•™ä½nä½ï¼Œå…¶ä»–ä½ç½®ä¸º0ï¼ˆå› ä¸ºæ£‹ç›˜å¤§å°ä¸ºnï¼‰</li>
</ul>
</li>
<li>
<p><strong>è·å–ä¸€ä¸ªå¯æ”¾ç½®ä½ç½®</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">position := availablePositions &amp; -availablePositions</span><br></pre></td></tr></table></figure>
<ul>
<li><code>availablePositions &amp; -availablePositions</code>ï¼šè·å–æœ€ä½ä½çš„1ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨æŠ€å·§</li>
<li>ä¾‹å¦‚ï¼Œå¦‚æœ <code>availablePositions = 1010</code>ï¼Œåˆ™ <code>-availablePositions = 0110</code>ï¼ˆäºŒè¿›åˆ¶è¡¥ç ï¼‰ï¼Œ<code>availablePositions &amp; -availablePositions = 0010</code></li>
</ul>
</li>
<li>
<p><strong>ç§»é™¤å·²ä½¿ç”¨çš„ä½ç½®</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">availablePositions ^= position</span><br></pre></td></tr></table></figure>
<ul>
<li><code>^=</code>ï¼šæŒ‰ä½å¼‚æˆ–ï¼Œå°†å·²ç”¨ä½ç½®ä»å¯ç”¨ä½ç½®ä¸­ç§»é™¤</li>
</ul>
</li>
<li>
<p><strong>æ›´æ–°çŠ¶æ€å¹¶é€’å½’</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dfs(col+<span class="number">1</span>, rows|position, (diags1|position)&lt;&lt;<span class="number">1</span>, (diags2|position)&gt;&gt;<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>rows|position</code>ï¼šæ ‡è®°è¡Œä¸ºå·²ä½¿ç”¨</li>
<li><code>(diags1|position)&lt;&lt;1</code>ï¼šæ›´æ–°å¹¶å·¦ç§»ä¸»å¯¹è§’çº¿å ç”¨çŠ¶æ€</li>
<li><code>(diags2|position)&gt;&gt;1</code>ï¼šæ›´æ–°å¹¶å³ç§»å‰¯å¯¹è§’çº¿å ç”¨çŠ¶æ€</li>
</ul>
</li>
</ol>
<h3 id="ä½è¿ç®—ç¤ºä¾‹">ä½è¿ç®—ç¤ºä¾‹</h3>
<p>ä»¥æ£‹ç›˜å¤§å°n=4ä¸ºä¾‹ï¼Œæ˜¾ç¤ºç¬¬ä¸€æ­¥çš„æ“ä½œï¼š</p>
<ol>
<li>
<p>åˆå§‹çŠ¶æ€ï¼š</p>
<ul>
<li>rows = 0000ï¼ˆæ‰€æœ‰è¡Œæœªå ç”¨ï¼‰</li>
<li>diags1 = 0000ï¼ˆæ‰€æœ‰ä¸»å¯¹è§’çº¿æœªå ç”¨ï¼‰</li>
<li>diags2 = 0000ï¼ˆæ‰€æœ‰å‰¯å¯¹è§’çº¿æœªå ç”¨ï¼‰</li>
</ul>
</li>
<li>
<p>æ£€æŸ¥ç¬¬0åˆ—å¯æ”¾ç½®ä½ç½®ï¼š</p>
<ul>
<li>æ‰€æœ‰è¡Œéƒ½å¯ç”¨ï¼ŒavailablePositions = 1111</li>
</ul>
</li>
<li>
<p>å°è¯•åœ¨ç¬¬0è¡Œç¬¬0åˆ—æ”¾ç½®çš‡åï¼š</p>
<ul>
<li>position = 0001ï¼ˆç¬¬0è¡Œï¼‰</li>
<li>æ›´æ–°çŠ¶æ€ï¼š
<ul>
<li>rows = 0001</li>
<li>diags1 = 0010ï¼ˆå·¦ç§»ï¼‰</li>
<li>diags2 = 0000ï¼ˆå³ç§»ï¼Œæœ€ä½ä½ä¸¢å¤±ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li>
<p>æ£€æŸ¥ç¬¬1åˆ—å¯æ”¾ç½®ä½ç½®ï¼š</p>
<ul>
<li>rows | diags1 | diags2 = 0011</li>
<li>å¯ç”¨ä½ç½® = ~0011 &amp; 1111 = 1100ï¼ˆç¬¬2è¡Œå’Œç¬¬3è¡Œï¼‰</li>
</ul>
</li>
</ol>
<p>ä¾æ­¤ç±»æ¨ï¼Œå›æº¯è¿‡ç¨‹ä¼šå°è¯•æ‰€æœ‰å¯èƒ½çš„æ”¾ç½®æ–¹å¼ã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p>ä¸¤ç§å®ç°çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ $O(N!)$ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>ç¬¬ä¸€åˆ—æœ‰Nä¸ªä½ç½®å¯é€‰</li>
<li>ç¬¬äºŒåˆ—æœ€å¤šæœ‰N-1ä¸ªä½ç½®å¯é€‰</li>
<li>ç¬¬ä¸‰åˆ—æœ€å¤šæœ‰N-2ä¸ªä½ç½®å¯é€‰</li>
<li>ä»¥æ­¤ç±»æ¨</li>
</ul>
<p>å®é™…ä¸Šï¼Œç”±äºå‰ªæçš„å­˜åœ¨ï¼Œå®é™…è¿è¡Œæ—¶é—´ä¼šå°äº $O(N!)$ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<ol>
<li>
<p><strong>æ ‡å‡†å›æº¯è§£æ³•</strong>ï¼š</p>
<ul>
<li>ç©ºé—´å¤æ‚åº¦ä¸º $O(N)$ï¼Œä¸»è¦æ˜¯ä¸‰ä¸ªæ ‡è®°æ•°ç»„å’Œé€’å½’è°ƒç”¨æ ˆ</li>
</ul>
</li>
<li>
<p><strong>ä½è¿ç®—è§£æ³•</strong>ï¼š</p>
<ul>
<li>ç©ºé—´å¤æ‚åº¦ä¸º $O(1)$ï¼Œå› ä¸ºæˆ‘ä»¬åªä½¿ç”¨å›ºå®šçš„å‡ ä¸ªæ•´æ•°æ¥è¡¨ç¤ºçŠ¶æ€</li>
<li>è¿™æ˜¯ä½è¿ç®—è§£æ³•çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€</li>
</ul>
</li>
</ol>
<p><strong>æ³¨æ„</strong>ï¼šä½è¿ç®—è§£æ³•çš„ç©ºé—´ä¼˜åŠ¿åœ¨Nå¾ˆå¤§æ—¶æ›´åŠ æ˜æ˜¾ã€‚ä½†å½“N &gt; 32ï¼ˆæˆ–åœ¨64ä½ç³»ç»Ÿä¸ŠN &gt; 64ï¼‰æ—¶ï¼Œå•ä¸ªæ•´æ•°çš„ä½æ•°ä¸è¶³ä»¥è¡¨ç¤ºæ‰€æœ‰çŠ¶æ€ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å¤§æ•´æ•°åº“æˆ–å…¶ä»–æ–¹æ³•ã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ ‡å‡†å›æº¯è§£æ³•</th>
<th>ä½è¿ç®—è§£æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(N!)</td>
<td>O(N!)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(N)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç›´è§‚æ˜“æ‡‚</td>
<td>ç©ºé—´æ•ˆç‡é«˜ï¼Œå¸¸æ•°æ“ä½œæ›´å¿«</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>ç©ºé—´æ¶ˆè€—è¾ƒå¤§</td>
<td>å¯è¯»æ€§è¾ƒå·®ï¼Œä»…é€‚ç”¨äºNâ‰¤32æˆ–64</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>æ•™å­¦æ¼”ç¤ºã€ä»£ç å¯è¯»æ€§è¦æ±‚é«˜</td>
<td>ç©ºé—´å—é™ã€è¿½æ±‚æè‡´æ€§èƒ½</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>å›æº¯ä¸ä½è¿ç®—ç»“åˆ</strong>ï¼šNçš‡åé—®é¢˜å±•ç¤ºäº†å¦‚ä½•å°†ä½è¿ç®—ä¸å›æº¯ç®—æ³•ç»“åˆï¼Œä¼˜åŒ–ç©ºé—´å¤æ‚åº¦ã€‚</p>
</li>
<li>
<p><strong>ä½è¿ç®—æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨å•ä¸ªæ•´æ•°çš„äºŒè¿›åˆ¶ä½è¡¨ç¤ºå¤šä¸ªå¸ƒå°”å€¼</li>
<li>ä½¿ç”¨ <code>x &amp; -x</code> è·å–æœ€ä½ä½çš„1</li>
<li>ä½¿ç”¨ä½ç§»æ“ä½œæ¨¡æ‹Ÿæ•°æ®ç»“æ„çš„å˜åŒ–</li>
</ul>
</li>
<li>
<p><strong>ç®—æ³•ä¼˜åŒ–æ€è·¯</strong>ï¼šæœ‰æ—¶ä¸éœ€è¦è®°å½•å…·ä½“è§£çš„å†…å®¹ï¼Œåªéœ€è®°å½•è§£çš„æ•°é‡ï¼Œå¯ä»¥å¤§å¹…ç®€åŒ–ä»£ç å’Œä¼˜åŒ–æ€§èƒ½ã€‚</p>
</li>
<li>
<p><strong>ä¸¤ç±»é—®é¢˜çš„å…³è”</strong>ï¼šNçš‡åIå’ŒNçš‡åIIå±•ç¤ºäº†ä¸¤ç§å¸¸è§çš„é—®é¢˜å˜ä½“â€”â€”â€œæ±‚æ‰€æœ‰è§£&quot;å’Œ&quot;æ±‚è§£çš„æ•°é‡â€ï¼Œå®ƒä»¬é€šå¸¸å¯ä»¥ç”¨ç›¸åŒçš„æ ¸å¿ƒç®—æ³•è§£å†³ï¼Œä½†åè€…å¾€å¾€æœ‰é¢å¤–çš„ä¼˜åŒ–ç©ºé—´ã€‚</p>
</li>
</ol>
<p>ä½è¿ç®—è§£æ³•è™½ç„¶åœ¨è¿™ä¸ªé—®é¢˜ä¸­èƒ½å¸¦æ¥ç©ºé—´æ•ˆç‡çš„æå‡ï¼Œä½†ä¹Ÿå¢åŠ äº†ä»£ç å¤æ‚åº¦å’Œç†è§£éš¾åº¦ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µï¼ˆå¦‚Nçš„å¤§å°ã€æ€§èƒ½è¦æ±‚ã€ä»£ç å¯ç»´æŠ¤æ€§ç­‰ï¼‰é€‰æ‹©åˆé€‚çš„å®ç°æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›æº¯</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Hard</tag>
        <tag>å›æº¯</tag>
        <tag>ä½è¿ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 51 - Nçš‡åï¼ˆN-Queensï¼‰</title>
    <url>/2025/05/07/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-51-N%E7%9A%87%E5%90%8E/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>Nçš‡åé—®é¢˜æ˜¯ä¸€ä¸ªç»å…¸çš„å›æº¯ç®—æ³•åº”ç”¨ã€‚æ ¹æ®å›½é™…è±¡æ£‹è§„åˆ™ï¼Œçš‡åå¯ä»¥æ”»å‡»ä¸ä¹‹å¤„åœ¨åŒä¸€è¡Œã€åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šçš„æ£‹å­ã€‚Nçš‡åé—®é¢˜è¦æ±‚åœ¨NÃ—Nçš„æ£‹ç›˜ä¸Šæ”¾ç½®Nä¸ªçš‡åï¼Œä½¿å¾—çš‡åä¹‹é—´äº’ä¸æ”»å‡»ã€‚</p>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°Nï¼Œè¦æ±‚è¿”å›æ‰€æœ‰ä¸åŒçš„Nçš‡åé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚æ¯ä¸ªè§£å†³æ–¹æ¡ˆåŒ…å«ä¸€ä¸ªä¸åŒçš„Nçš‡åé—®é¢˜çš„æ£‹å­æ”¾ç½®æ–¹æ¡ˆï¼Œå…¶ä¸­â€™Qâ€™è¡¨ç¤ºçš‡åï¼Œ'.'è¡¨ç¤ºç©ºä½ã€‚</p>
<h3 id="ç¤ºä¾‹-1">ç¤ºä¾‹ 1</h3>
<p><strong>è¾“å…¥</strong>ï¼šn = 4<br>
<strong>è¾“å‡º</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line"> [&quot;.Q..&quot;,  // è§£æ³•1</span><br><span class="line">  &quot;...Q&quot;,</span><br><span class="line">  &quot;Q...&quot;,</span><br><span class="line">  &quot;..Q.&quot;],</span><br><span class="line"> </span><br><span class="line"> [&quot;..Q.&quot;,  // è§£æ³•2</span><br><span class="line">  &quot;Q...&quot;,</span><br><span class="line">  &quot;...Q&quot;,</span><br><span class="line">  &quot;.Q..&quot;]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>è§£é‡Š</strong>ï¼š4çš‡åé—®é¢˜å­˜åœ¨ä¸¤ä¸ªä¸åŒè§£æ³•ã€‚</p>
<p><img src="/2025/05/07/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-51-N%E7%9A%87%E5%90%8E/1746609894177.png" alt="1746609894177"></p>
<h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹ 2</h3>
<p><strong>è¾“å…¥</strong>ï¼šn = 1<br>
<strong>è¾“å‡º</strong>ï¼š[[â€œQâ€]]</p>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>1 &lt;= n &lt;= 9</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>Nçš‡åé—®é¢˜æ˜¯å›æº¯ç®—æ³•çš„ç»å…¸åº”ç”¨ã€‚æˆ‘ä»¬éœ€è¦å°è¯•åœ¨æ¯ä¸€åˆ—æ”¾ç½®ä¸€ä¸ªçš‡åï¼ŒåŒæ—¶ä¿è¯å®ƒä¸ä¼šæ”»å‡»åˆ°å…¶ä»–å·²æ”¾ç½®çš„çš‡åã€‚</p>
<h3 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3>
<p><strong>æ ¸å¿ƒæ´è§</strong>ï¼šè¦å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªä½ç½®æ˜¯å¦å¯ä»¥æ”¾ç½®çš‡åï¼Œæˆ‘ä»¬éœ€è¦é«˜æ•ˆæ£€æµ‹è¯¥ä½ç½®æ˜¯å¦å¤„äºå·²æœ‰çš‡åçš„æ”»å‡»èŒƒå›´å†…ã€‚</p>
<p>çš‡åçš„æ”»å‡»è·¯å¾„æœ‰ä¸‰ç§ï¼š</p>
<ol>
<li>åŒä¸€è¡Œ</li>
<li>åŒä¸€åˆ—</li>
<li>åŒä¸€æ–œçº¿ï¼ˆåŒ…æ‹¬ä¸»å¯¹è§’çº¿å’Œå‰¯å¯¹è§’çº¿ï¼‰</li>
</ol>
<p>ä¸ºäº†é«˜æ•ˆæ£€æµ‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªå¸ƒå°”æ•°ç»„æ¥æ ‡è®°å·²ç»è¢«å ç”¨çš„è¡Œå’Œä¸¤ç§å¯¹è§’çº¿ï¼š</p>
<ul>
<li><code>rowUsed[n]</code>ï¼šè®°å½•æ¯ä¸€è¡Œæ˜¯å¦å·²æ”¾ç½®çš‡å</li>
<li><code>mainDiagUsed[2*n-1]</code>ï¼šè®°å½•ä¸»å¯¹è§’çº¿ï¼ˆå·¦ä¸Šåˆ°å³ä¸‹ï¼‰æ˜¯å¦å·²æ”¾ç½®çš‡å</li>
<li><code>subDiagUsed[2*n-1]</code>ï¼šè®°å½•å‰¯å¯¹è§’çº¿ï¼ˆå³ä¸Šåˆ°å·¦ä¸‹ï¼‰æ˜¯å¦å·²æ”¾ç½®çš‡å</li>
</ul>
<h3 id="å¯¹è§’çº¿çš„æ•°å­¦ç‰¹æ€§">å¯¹è§’çº¿çš„æ•°å­¦ç‰¹æ€§</h3>
<p>å¯¹è§’çº¿çš„æ£€æµ‹æ˜¯æœ¬é¢˜çš„å…³é”®ã€‚å¯¹äºæ£‹ç›˜ä¸Šçš„ä»»æ„ä¸€ç‚¹(i, j)ï¼š</p>
<ol>
<li>ä¸»å¯¹è§’çº¿ï¼ˆå·¦ä¸Šè‡³å³ä¸‹ï¼‰ï¼šåŒä¸€ä¸»å¯¹è§’çº¿ä¸Šçš„æ‰€æœ‰ç‚¹æ»¡è¶³ <strong>i+j å€¼ç›¸åŒ</strong><br>
ä¾‹å¦‚ï¼š(0,0), (1,1), (2,2) éƒ½åœ¨åŒä¸€ä¸»å¯¹è§’çº¿ä¸Šï¼Œå®ƒä»¬çš„ i+j éƒ½ç­‰äº0+0=1+1=2+2=â€¦</li>
<li>å‰¯å¯¹è§’çº¿ï¼ˆå³ä¸Šè‡³å·¦ä¸‹ï¼‰ï¼šåŒä¸€å‰¯å¯¹è§’çº¿ä¸Šçš„æ‰€æœ‰ç‚¹æ»¡è¶³ <strong>i-j å€¼ç›¸åŒ</strong><br>
ä¾‹å¦‚ï¼š(0,2), (1,1), (2,0) éƒ½åœ¨åŒä¸€å‰¯å¯¹è§’çº¿ä¸Šï¼Œå®ƒä»¬çš„ i-j éƒ½ç­‰äº0-2=1-1=2-0=â€¦</li>
</ol>
<p>ä½†æ˜¯ç”±äºæ•°ç»„ç´¢å¼•ä¸èƒ½ä¸ºè´Ÿï¼Œå¯¹äºå‰¯å¯¹è§’çº¿ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ <code>i-j+n-1</code> æˆ– <code>i-j+n</code> æ¥ç¡®ä¿ç´¢å¼•ä¸ºéè´Ÿå€¼ã€‚</p>
<h3 id="å›æº¯è¿‡ç¨‹">å›æº¯è¿‡ç¨‹</h3>
<p>å›æº¯ç®—æ³•çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>æŒ‰åˆ—é€’å½’ï¼Œå¯¹äºæ¯ä¸€åˆ—ï¼Œå°è¯•åœ¨å„è¡Œæ”¾ç½®çš‡å</li>
<li>æ”¾ç½®å‰æ£€æŸ¥å½“å‰ä½ç½®æ˜¯å¦å®‰å…¨ï¼ˆè¡Œã€ä¸»å¯¹è§’çº¿ã€å‰¯å¯¹è§’çº¿éƒ½æœªè¢«å ç”¨ï¼‰</li>
<li>å¦‚æœå®‰å…¨ï¼Œåˆ™æ”¾ç½®çš‡åï¼Œå¹¶é€’å½’å¤„ç†ä¸‹ä¸€åˆ—</li>
<li>é€’å½’è¿”å›åï¼Œå›æº¯ï¼ˆæ’¤é”€æ”¾ç½®çš„çš‡åï¼‰ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªä½ç½®</li>
<li>å½“æˆåŠŸæ”¾ç½®äº†Nä¸ªçš‡åï¼ˆå³å¤„ç†å®Œæ‰€æœ‰åˆ—ï¼‰ï¼Œè®°å½•å½“å‰è§£</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>æˆ‘ä»¬ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢(DFS)å®ç°å›æº¯ç®—æ³•ã€‚å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>åˆ›å»ºè§£å†³æ–¹æ¡ˆé›†å’Œæ£‹ç›˜è¡¨ç¤ºï¼š</p>
<ul>
<li>ä½¿ç”¨äºŒç»´å­—èŠ‚æ•°ç»„è¡¨ç¤ºæ£‹ç›˜ï¼Œåˆå§‹åŒ–ä¸ºå…¨â€™.â€™</li>
<li>ä½¿ç”¨ä¸‰ä¸ªå¸ƒå°”æ•°ç»„è·Ÿè¸ªå·²å ç”¨çš„è¡Œå’Œå¯¹è§’çº¿</li>
</ul>
</li>
<li>
<p>å®šä¹‰DFSå‡½æ•°ï¼ŒæŒ‰åˆ—é€’å½’ï¼š</p>
<ul>
<li>å¦‚æœå½“å‰åˆ—ç­‰äºnï¼Œè¯´æ˜æ‰¾åˆ°ä¸€ä¸ªè§£ï¼Œå°†å½“å‰æ£‹ç›˜çŠ¶æ€æ·»åŠ åˆ°ç»“æœä¸­</li>
<li>å¦åˆ™ï¼Œå°è¯•åœ¨å½“å‰åˆ—çš„æ¯ä¸€è¡Œæ”¾ç½®çš‡å</li>
<li>æ£€æŸ¥ä½ç½®(row, col)æ˜¯å¦å®‰å…¨ï¼ˆè¡Œã€ä¸»å¯¹è§’çº¿ã€å‰¯å¯¹è§’çº¿éƒ½æœªè¢«å ç”¨ï¼‰</li>
<li>å¦‚æœå®‰å…¨ï¼Œæ ‡è®°å ç”¨ï¼Œæ”¾ç½®çš‡åï¼Œé€’å½’ä¸‹ä¸€åˆ—</li>
<li>é€’å½’è¿”å›åï¼Œæ’¤é”€æ ‡è®°ï¼Œç§»é™¤çš‡åï¼ˆå›æº¯ï¼‰</li>
</ul>
</li>
</ol>
<h3 id="å®ä¾‹æ¼”ç¤º">å®ä¾‹æ¼”ç¤º</h3>
<p>ä»¥n=4ä¸ºä¾‹ï¼Œå±•ç¤ºéƒ¨åˆ†æœç´¢è¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹çŠ¶æ€ï¼šæ£‹ç›˜ä¸ºç©º</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">å°è¯•ç¬¬0åˆ—ç¬¬0è¡Œ(0,0)ï¼š</span><br><span class="line">Q...  âœ“ å¯ä»¥æ”¾ç½®</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">å°è¯•ç¬¬1åˆ—ç¬¬0è¡Œ(0,1)ï¼š</span><br><span class="line">QQ..  âœ— åŒä¸€è¡Œæ”»å‡»ï¼Œè·³è¿‡</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">å°è¯•ç¬¬1åˆ—ç¬¬1è¡Œ(1,1)ï¼š</span><br><span class="line">Q...  âœ— å¯¹è§’çº¿æ”»å‡»ï¼Œè·³è¿‡</span><br><span class="line">.Q..</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">å°è¯•ç¬¬1åˆ—ç¬¬2è¡Œ(2,1)ï¼š</span><br><span class="line">Q...  âœ“ å¯ä»¥æ”¾ç½®</span><br><span class="line">..Q.</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">...ä¾æ­¤ç±»æ¨</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>ä¸‹é¢æ˜¯å®Œæ•´ä¸”æ˜“äºç†è§£çš„Goè¯­è¨€å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">solveNQueens</span><span class="params">(n <span class="type">int</span>)</span></span> [][]<span class="type">string</span> &#123;</span><br><span class="line">    <span class="comment">// ç»“æœé›†</span></span><br><span class="line">    <span class="keyword">var</span> result [][]<span class="type">string</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ ‡è®°æ•°ç»„ï¼Œè®°å½•å·²å ç”¨çš„è¡Œå’Œå¯¹è§’çº¿</span></span><br><span class="line">    rowUsed := <span class="built_in">make</span>([]<span class="type">bool</span>, n)          <span class="comment">// æ ‡è®°è¡Œæ˜¯å¦å·²è¢«å ç”¨</span></span><br><span class="line">    mainDiagUsed := <span class="built_in">make</span>([]<span class="type">bool</span>, <span class="number">2</span>*n)   <span class="comment">// æ ‡è®°ä¸»å¯¹è§’çº¿(i+j)æ˜¯å¦å·²è¢«å ç”¨</span></span><br><span class="line">    subDiagUsed := <span class="built_in">make</span>([]<span class="type">bool</span>, <span class="number">2</span>*n)    <span class="comment">// æ ‡è®°å‰¯å¯¹è§’çº¿(n+i-j)æ˜¯å¦å·²è¢«å ç”¨</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ£‹ç›˜ï¼Œæ‰€æœ‰ä½ç½®éƒ½æ˜¯&#x27;.&#x27;</span></span><br><span class="line">    board := <span class="built_in">make</span>([][]<span class="type">byte</span>, n)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> board &#123;</span><br><span class="line">        board[i] = <span class="built_in">make</span>([]<span class="type">byte</span>, n)</span><br><span class="line">        <span class="keyword">for</span> j := <span class="keyword">range</span> board[i] &#123;</span><br><span class="line">            board[i][j] = <span class="string">&#x27;.&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// DFSå‡½æ•°ï¼Œcolè¡¨ç¤ºå½“å‰å¤„ç†çš„åˆ—</span></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(col <span class="type">int</span>)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(col <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰€æœ‰åˆ—éƒ½å·²å¤„ç†ï¼Œåˆ™æ‰¾åˆ°ä¸€ä¸ªè§£</span></span><br><span class="line">        <span class="keyword">if</span> col == n &#123;</span><br><span class="line">            <span class="comment">// å°†å½“å‰æ£‹ç›˜çŠ¶æ€è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¹¶æ·»åŠ åˆ°ç»“æœä¸­</span></span><br><span class="line">            solution := <span class="built_in">make</span>([]<span class="type">string</span>, n)</span><br><span class="line">            <span class="keyword">for</span> i := <span class="keyword">range</span> solution &#123;</span><br><span class="line">                solution[i] = <span class="type">string</span>(board[i])</span><br><span class="line">            &#125;</span><br><span class="line">            result = <span class="built_in">append</span>(result, solution)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å°è¯•åœ¨å½“å‰åˆ—çš„æ¯ä¸€è¡Œæ”¾ç½®çš‡å</span></span><br><span class="line">        <span class="keyword">for</span> row := <span class="number">0</span>; row &lt; n; row++ &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥ä½ç½®(row, col)æ˜¯å¦å®‰å…¨</span></span><br><span class="line">            <span class="comment">// å¦‚æœè¡Œã€ä¸»å¯¹è§’çº¿æˆ–å‰¯å¯¹è§’çº¿å·²è¢«å ç”¨ï¼Œåˆ™è·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> rowUsed[row] || mainDiagUsed[row+col] || subDiagUsed[n+row-col] &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">// æ ‡è®°å ç”¨</span></span><br><span class="line">            rowUsed[row] = <span class="literal">true</span></span><br><span class="line">            mainDiagUsed[row+col] = <span class="literal">true</span></span><br><span class="line">            subDiagUsed[n+row-col] = <span class="literal">true</span></span><br><span class="line">          </span><br><span class="line">            <span class="comment">// æ”¾ç½®çš‡å</span></span><br><span class="line">            board[row][col] = <span class="string">&#x27;Q&#x27;</span></span><br><span class="line">          </span><br><span class="line">            <span class="comment">// é€’å½’å¤„ç†ä¸‹ä¸€åˆ—</span></span><br><span class="line">            dfs(col + <span class="number">1</span>)</span><br><span class="line">          </span><br><span class="line">            <span class="comment">// å›æº¯ï¼šæ’¤é”€æ ‡è®°å’Œçš‡åæ”¾ç½®</span></span><br><span class="line">            board[row][col] = <span class="string">&#x27;.&#x27;</span></span><br><span class="line">            rowUsed[row] = <span class="literal">false</span></span><br><span class="line">            mainDiagUsed[row+col] = <span class="literal">false</span></span><br><span class="line">            subDiagUsed[n+row-col] = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä»ç¬¬0åˆ—å¼€å§‹DFS</span></span><br><span class="line">    dfs(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p>æ—¶é—´å¤æ‚åº¦ä¸º $O(N!)$ï¼Œå…¶ä¸­Næ˜¯æ£‹ç›˜çš„å¤§å°ã€‚è¿™æ˜¯å› ä¸ºï¼š</p>
<ul>
<li>ç¬¬ä¸€åˆ—æœ‰Nä¸ªä½ç½®å¯é€‰</li>
<li>ç¬¬äºŒåˆ—æœ€å¤šæœ‰N-1ä¸ªä½ç½®å¯é€‰</li>
<li>ç¬¬ä¸‰åˆ—æœ€å¤šæœ‰N-2ä¸ªä½ç½®å¯é€‰</li>
<li>ä»¥æ­¤ç±»æ¨</li>
</ul>
<p>å®é™…ä¸Šï¼Œç”±äºå‰ªæçš„å­˜åœ¨ï¼Œå®é™…è¿è¡Œæ—¶é—´ä¼šè¿œå°äº $O(N!)$ï¼Œä½†ç†è®ºä¸Šæœ€åæƒ…å†µä»ä¸º $O(N!)$ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<p>ç©ºé—´å¤æ‚åº¦ä¸º $O(N)$ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸‰ä¸ªæ ‡è®°æ•°ç»„ï¼š$O(N) + O(2N) + O(2N) = O(5N) = O(N)$</li>
<li>æ£‹ç›˜è¡¨ç¤ºï¼š$O(N^2)$</li>
<li>é€’å½’è°ƒç”¨æ ˆï¼š$O(N)$</li>
</ul>
<p>ç”±äºNçš„å–å€¼èŒƒå›´è¾ƒå°(1â‰¤Nâ‰¤9)ï¼Œ$O(N^2)$ å®é™…ä¸Šä¹Ÿå¯ä»¥è§†ä¸º $O(N)$ã€‚</p>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>å›æº¯ç®—æ³•çš„åº”ç”¨</strong>ï¼šNçš‡åé—®é¢˜å±•ç¤ºäº†å›æº¯ç®—æ³•åœ¨ç»„åˆä¼˜åŒ–é—®é¢˜ä¸­çš„åº”ç”¨ï¼Œé€šè¿‡å°è¯•-éªŒè¯-å›æº¯çš„æ–¹å¼æœç´¢è§£ç©ºé—´ã€‚</li>
<li><strong>é«˜æ•ˆçš„çº¦æŸæ£€æŸ¥</strong>ï¼šä½¿ç”¨ä¸‰ä¸ªå¸ƒå°”æ•°ç»„è®°å½•å·²å ç”¨çš„è¡Œå’Œå¯¹è§’çº¿ï¼Œå¯ä»¥åœ¨ $O(1)$ æ—¶é—´å†…åˆ¤æ–­ä½ç½®æ˜¯å¦å®‰å…¨ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éå†æ•´ä¸ªæ£‹ç›˜ã€‚</li>
<li><strong>æ•°å­¦ç‰¹æ€§çš„åˆ©ç”¨</strong>ï¼šå¯¹è§’çº¿çš„æ•°å­¦ç‰¹æ€§ï¼ˆi+jå’Œi-jçš„ä¸å˜æ€§ï¼‰ä½¿æˆ‘ä»¬èƒ½å¤Ÿé«˜æ•ˆåœ°æ£€æµ‹å¯¹è§’çº¿çº¦æŸï¼Œè¿™æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®ã€‚</li>
<li><strong>é€’å½’ä¸çŠ¶æ€æ¢å¤</strong>ï¼šå›æº¯ç®—æ³•çš„ç²¾é«“åœ¨äº&quot;çŠ¶æ€æ¢å¤&quot;ï¼Œå³å°è¯•ä¸€ä¸ªé€‰æ‹©åï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™æ’¤é”€è¿™ä¸ªé€‰æ‹©ï¼Œæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œç»§ç»­å°è¯•å…¶ä»–é€‰æ‹©ã€‚</li>
</ol>
<p>Nçš‡åé—®é¢˜æ˜¯ç»„åˆä¼˜åŒ–ä¸­çš„NPéš¾é—®é¢˜ï¼Œæ²¡æœ‰å¤šé¡¹å¼æ—¶é—´çš„è§£æ³•ã€‚å¯¹äºå¤§è§„æ¨¡çš„é—®é¢˜(Nå¾ˆå¤§)ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨å¯å‘å¼ç®—æ³•æˆ–è¿‘ä¼¼ç®—æ³•æ¥è§£å†³ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›æº¯</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Hard</tag>
        <tag>å›æº¯</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 22 - æ‹¬å·ç”Ÿæˆï¼ˆGenerate Parenthesesï¼‰</title>
    <url>/2025/05/06/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-22-%E6%8B%AC%E5%8F%B7%E7%94%9F%E6%88%90/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸”<strong>æœ‰æ•ˆçš„</strong>æ‹¬å·ç»„åˆã€‚</p>
<h3 id="ç¤ºä¾‹ï¼š">ç¤ºä¾‹ï¼š</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 3</span><br><span class="line">è¾“å‡ºï¼š[&quot;((()))&quot;,&quot;(()())&quot;,&quot;(())()&quot;,&quot;()(())&quot;,&quot;()()()&quot;]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 1</span><br><span class="line">è¾“å‡ºï¼š[&quot;()&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="æç¤ºï¼š">æç¤ºï¼š</h3>
<ul>
<li>1 &lt;= n &lt;= 8</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜ç›®è¦æ±‚æˆ‘ä»¬ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„æœ‰æ•ˆæ‹¬å·ç»„åˆï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>å›æº¯ï¼ˆæ·±åº¦ä¼˜å…ˆæœç´¢ï¼‰é—®é¢˜</strong>ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>çš„æ–¹å¼è§£å†³ã€‚ä¸‹é¢æˆ‘å°†è¯¦ç»†ä»‹ç»è¿™ä¸¤ç§æ–¹æ³•ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šå›æº¯ç®—æ³•ï¼ˆDFSï¼‰">æ–¹æ³•ä¸€ï¼šå›æº¯ç®—æ³•ï¼ˆDFSï¼‰</h3>
<p>å›æº¯ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡<strong>é€’å½’</strong>çš„æ–¹å¼ï¼Œé€æ­¥æ„å»ºè§£å†³æ–¹æ¡ˆï¼Œå¹¶åœ¨ä¸æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹è¿›è¡Œå›æº¯ã€‚</p>
<p>å¯¹äºæ‹¬å·ç”Ÿæˆé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ€è·¯è§£å†³ï¼š</p>
<ol>
<li>ç»´æŠ¤ä¸¤ä¸ªå˜é‡ <code>left</code> å’Œ <code>right</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºå·²ç»æ”¾ç½®çš„å·¦æ‹¬å·å’Œå³æ‹¬å·çš„æ•°é‡</li>
<li>å¯¹äºæ¯ä¸ªä½ç½®ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼šæ”¾ç½®å·¦æ‹¬å·æˆ–æ”¾ç½®å³æ‹¬å·</li>
<li><strong>æ”¾ç½®å·¦æ‹¬å·çš„æ¡ä»¶</strong>ï¼šå½“å‰å·²æ”¾ç½®çš„å·¦æ‹¬å·æ•°é‡å°äº n</li>
<li><strong>æ”¾ç½®å³æ‹¬å·çš„æ¡ä»¶</strong>ï¼šå½“å‰å·²æ”¾ç½®çš„å³æ‹¬å·æ•°é‡å°äºå·¦æ‹¬å·æ•°é‡</li>
<li>å½“å·¦æ‹¬å·å’Œå³æ‹¬å·çš„æ•°é‡éƒ½ç­‰äº n æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„æ‹¬å·ç»„åˆ</li>
</ol>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ DFS éå†æ‰€æœ‰å¯èƒ½çš„ç»„åˆï¼Œå¹¶åªä¿ç•™æœ‰æ•ˆçš„ç»„åˆã€‚</p>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼ˆn=2ï¼‰æ¥è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹çŠ¶æ€ï¼š&quot;&quot;ï¼Œleft=0ï¼Œright=0</span><br><span class="line">    é€‰æ‹©å·¦æ‹¬å·ï¼š&quot;(&quot;ï¼Œleft=1ï¼Œright=0</span><br><span class="line">        é€‰æ‹©å·¦æ‹¬å·ï¼š&quot;((&quot;ï¼Œleft=2ï¼Œright=0</span><br><span class="line">            é€‰æ‹©å³æ‹¬å·ï¼š&quot;(()&quot;ï¼Œleft=2ï¼Œright=1</span><br><span class="line">                é€‰æ‹©å³æ‹¬å·ï¼š&quot;(())&quot;ï¼Œleft=2ï¼Œright=2ï¼Œå¾—åˆ°ä¸€ä¸ªæœ‰æ•ˆç»„åˆ</span><br><span class="line">        é€‰æ‹©å³æ‹¬å·ï¼š&quot;()&quot;ï¼Œleft=1ï¼Œright=1</span><br><span class="line">            é€‰æ‹©å·¦æ‹¬å·ï¼š&quot;()(&quot;ï¼Œleft=2ï¼Œright=1</span><br><span class="line">                é€‰æ‹©å³æ‹¬å·ï¼š&quot;()()&quot;ï¼Œleft=2ï¼Œright=2ï¼Œå¾—åˆ°ä¸€ä¸ªæœ‰æ•ˆç»„åˆ</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’">æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’</h3>
<p>åŠ¨æ€è§„åˆ’çš„æ€è·¯æ˜¯åŸºäºå·²çŸ¥çš„ç»“æœæ¨å¯¼å‡ºæœªçŸ¥çš„ç»“æœã€‚å¯¹äºæ‹¬å·ç”Ÿæˆé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ€è€ƒï¼š</p>
<p>è®¾ <code>dp[i]</code> è¡¨ç¤º i å¯¹æ‹¬å·çš„æ‰€æœ‰æœ‰æ•ˆç»„åˆï¼Œé‚£ä¹ˆå¯¹äº <code>dp[n]</code>ï¼Œæˆ‘ä»¬å¯ä»¥æšä¸¾å·¦æ‹¬å·çš„ä½ç½®ï¼Œç„¶åå°†é—®é¢˜åˆ†è§£ä¸ºå·²çŸ¥çš„å­é—®é¢˜ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼æ¥ç”Ÿæˆ <code>dp[n]</code>ï¼š</p>
<p>$$<br>
dp[n] = \sum_{i=0}^{n-1} (dp[i]) + dp[n-1-i]<br>
$$</p>
<p>å…¶ä¸­ i è¡¨ç¤ºå·¦æ‹¬å·å†…éƒ¨åŒ…å«çš„æ‹¬å·å¯¹æ•°ï¼Œn-1-i è¡¨ç¤ºå³æ‹¬å·åé¢çš„æ‹¬å·å¯¹æ•°ã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šå›æº¯ç®—æ³•ï¼ˆDFSï¼‰å®ç°">æ–¹æ³•ä¸€ï¼šå›æº¯ç®—æ³•ï¼ˆDFSï¼‰å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateParenthesis</span><span class="params">(n <span class="type">int</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">    result := []<span class="type">string</span>&#123;&#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ•°ç»„æ¥å­˜å‚¨å½“å‰æ„å»ºçš„æ‹¬å·å­—ç¬¦ä¸²</span></span><br><span class="line">    tmpArray := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">2</span>*n)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å®šä¹‰ DFS å‡½æ•°</span></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(index, left, right <span class="type">int</span>)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(index, left, right <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// å½“æˆ‘ä»¬æ”¾æ»¡äº†æ‰€æœ‰æ‹¬å·æ—¶ï¼Œæ·»åŠ åˆ°ç»“æœé›†</span></span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">2</span>*n &#123;</span><br><span class="line">            result = <span class="built_in">append</span>(result, <span class="type">string</span>(tmpArray))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¦‚æœå·¦æ‹¬å·æ•°é‡å°äº nï¼Œå¯ä»¥æ”¾ç½®å·¦æ‹¬å·</span></span><br><span class="line">        <span class="keyword">if</span> left &lt; n &#123;</span><br><span class="line">            tmpArray[index] = <span class="string">&#x27;(&#x27;</span></span><br><span class="line">            dfs(index+<span class="number">1</span>, left+<span class="number">1</span>, right)</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¦‚æœå³æ‹¬å·æ•°é‡å°äºå·¦æ‹¬å·æ•°é‡ï¼Œå¯ä»¥æ”¾ç½®å³æ‹¬å·</span></span><br><span class="line">        <span class="keyword">if</span> right &lt; left &#123;</span><br><span class="line">            tmpArray[index] = <span class="string">&#x27;)&#x27;</span></span><br><span class="line">            dfs(index+<span class="number">1</span>, left, right+<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä»ç¬¬ä¸€ä¸ªä½ç½®ã€é›¶ä¸ªå·¦å³æ‹¬å·å¼€å§‹ DFS</span></span><br><span class="line">    dfs(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’å®ç°">æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateParenthesis</span><span class="params">(n <span class="type">int</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> []<span class="type">string</span>&#123;<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// dp[i] è¡¨ç¤º i å¯¹æ‹¬å·çš„æ‰€æœ‰æœ‰æ•ˆç»„åˆ</span></span><br><span class="line">    dp := <span class="built_in">make</span>([][]<span class="type">string</span>, n+<span class="number">1</span>)</span><br><span class="line">    dp[<span class="number">0</span>] = []<span class="type">string</span>&#123;<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;</span><br><span class="line">        dp[i] = []<span class="type">string</span>&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; i; j++ &#123;</span><br><span class="line">            <span class="comment">// æšä¸¾å·¦æ‹¬å·å†…éƒ¨çš„æ‹¬å·å¯¹æ•° j</span></span><br><span class="line">            <span class="keyword">for</span> _, left := <span class="keyword">range</span> dp[j] &#123;</span><br><span class="line">                <span class="keyword">for</span> _, right := <span class="keyword">range</span> dp[i<span class="number">-1</span>-j] &#123;</span><br><span class="line">                    <span class="comment">// å°† &quot;(&quot; + dp[j] + &quot;)&quot; + dp[i-1-j] æ·»åŠ åˆ° dp[i]</span></span><br><span class="line">                    dp[i] = <span class="built_in">append</span>(dp[i], <span class="string">&quot;(&quot;</span> + left + <span class="string">&quot;)&quot;</span> + right)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> dp[n]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ‰§è¡Œç¤ºä¾‹">æ‰§è¡Œç¤ºä¾‹</h2>
<p>è®©æˆ‘ä»¬ä»¥ n=3 ä¸ºä¾‹ï¼Œè¿½è¸ªæ–¹æ³•ä¸€ï¼ˆå›æº¯ç®—æ³•ï¼‰çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>åˆå§‹çŠ¶æ€ï¼štmpArray = [_, _, _, _, _, _], index=0, left=0, right=0</li>
<li>æ”¾ç½®å·¦æ‹¬å·ï¼štmpArray = [(, _, _, _, _, _], index=1, left=1, right=0</li>
<li>ç»§ç»­æ”¾ç½®å·¦æ‹¬å·ï¼štmpArray = [(, (, _, _, _, _], index=2, left=2, right=0</li>
<li>ç»§ç»­æ”¾ç½®å·¦æ‹¬å·ï¼štmpArray = [(, (, (, _, _, _], index=3, left=3, right=0</li>
<li>æ”¾ç½®å³æ‹¬å·ï¼štmpArray = [(, (, (, ), _, _], index=4, left=3, right=1</li>
<li>ç»§ç»­æ”¾ç½®å³æ‹¬å·ï¼štmpArray = [(, (, (, ), ), _], index=5, left=3, right=2</li>
<li>ç»§ç»­æ”¾ç½®å³æ‹¬å·ï¼štmpArray = [(, (, (, ), ), )], index=6, left=3, right=3ï¼Œæ·»åŠ åˆ°ç»“æœé›†ï¼šâ€œ((()))â€</li>
<li>å›æº¯åˆ°æ­¥éª¤ 5ï¼Œå°è¯•æ”¾ç½®å¦ä¸€ä¸ªå³æ‹¬å·â€¦</li>
</ol>
<p>é€šè¿‡æ·±åº¦ä¼˜å…ˆéå†æ‰€æœ‰å¯èƒ½çš„æƒ…å†µï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°æ‰€æœ‰æœ‰æ•ˆçš„æ‹¬å·ç»„åˆã€‚</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å›æº¯ç®—æ³•ï¼ˆDFSï¼‰</th>
<th>åŠ¨æ€è§„åˆ’</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(\frac{4^n}{\sqrt(n)})$</td>
<td>$O(\frac{4^n}{n^{3/2}})$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>$O(\frac{4^n}{n^{3/2}})$</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç›´è§‚ï¼Œæ˜“äºç†è§£</td>
<td>é¿å…é‡å¤è®¡ç®—</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å¯èƒ½æœ‰é‡å¤è®¡ç®—</td>
<td>éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="å›æº¯ç®—æ³•ï¼ˆDFSï¼‰">å›æº¯ç®—æ³•ï¼ˆDFSï¼‰</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(\frac{4^n}{\sqrt{n}})$ï¼Œè¿™æ˜¯ç¬¬ n ä¸ªå¡ç‰¹å…°æ•°çš„è¿‘ä¼¼å€¼ï¼Œè¡¨ç¤ºé•¿åº¦ä¸º 2n çš„åˆæ³•æ‹¬å·åºåˆ—çš„æ•°é‡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œé€’å½’çš„æ·±åº¦æœ€å¤šä¸º 2nï¼Œè€Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé•¿åº¦ä¸º 2n çš„æ•°ç»„æ¥å­˜å‚¨å½“å‰æ„å»ºçš„æ‹¬å·å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h3 id="åŠ¨æ€è§„åˆ’">åŠ¨æ€è§„åˆ’</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(\frac{4^n}{n^{3/2}})$ï¼ŒåŒæ ·æ˜¯å¡ç‰¹å…°æ•°çš„è¿‘ä¼¼å€¼ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(\frac{4^n}{n^{3/2}})$ï¼Œéœ€è¦å­˜å‚¨æ‰€æœ‰ä¸­é—´ç»“æœã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>å›æº¯ç®—æ³•</strong>æ˜¯è§£å†³ç”Ÿæˆæ‰€æœ‰å¯èƒ½ç»„åˆé—®é¢˜çš„æœ‰åŠ›å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆæœ‰æ˜ç¡®çº¦æŸæ¡ä»¶çš„é—®é¢˜ã€‚</li>
<li>åœ¨å¤„ç†æ‹¬å·é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®°ä½ä¸€ä¸ªæ ¸å¿ƒè§„åˆ™ï¼š<strong>å³æ‹¬å·æ•°é‡ä¸èƒ½è¶…è¿‡å·¦æ‹¬å·æ•°é‡</strong>ã€‚</li>
<li><strong>åŠ¨æ€è§„åˆ’</strong>å¯ä»¥é€šè¿‡åˆ†è§£é—®é¢˜å¹¶å¤ç”¨å­é—®é¢˜çš„è§£æ¥è§£å†³å¤æ‚é—®é¢˜ã€‚</li>
<li>è¿™ä¸ªé—®é¢˜æ˜¯<strong>å¡ç‰¹å…°æ•°</strong>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ä¸ªåº”ç”¨å®ä¾‹ï¼Œå¡ç‰¹å…°æ•°æè¿°äº†è®¸å¤šç»„åˆé—®é¢˜ä¸­çš„è®¡æ•°ã€‚</li>
</ol>
<p>ç›¸å…³é—®é¢˜ï¼š</p>
<ul>
<li>LeetCode 20: æœ‰æ•ˆçš„æ‹¬å·</li>
<li>LeetCode 32: æœ€é•¿æœ‰æ•ˆæ‹¬å·</li>
<li>LeetCode 301: åˆ é™¤æ— æ•ˆçš„æ‹¬å·</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>å›æº¯</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°åŸç†</title>
    <url>/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1>MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°åŸç†</h1>
<h2 id="ç›®å½•">ç›®å½•</h2>
<ul>
<li><a href="#%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF">é—®é¢˜èƒŒæ™¯</a></li>
<li><a href="#%E4%BA%8B%E5%8A%A1%E6%9C%89%E5%93%AA%E4%BA%9B%E7%89%B9%E6%80%A7">äº‹åŠ¡çš„ç‰¹æ€§(ACID)</a></li>
<li><a href="#%E5%B9%B6%E8%A1%8C%E4%BA%8B%E5%8A%A1%E4%BC%9A%E5%BC%95%E5%8F%91%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98">å¹¶å‘äº‹åŠ¡çš„é—®é¢˜</a></li>
<li><a href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E6%9C%89%E5%93%AA%E4%BA%9B">äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</a></li>
<li><a href="#read-view-%E5%9C%A8-mvcc-%E9%87%8C%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84">MVCCä¸Read Viewå·¥ä½œåŸç†</a></li>
<li><a href="#%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84">å¯é‡å¤è¯»çš„å®ç°æœºåˆ¶</a></li>
<li><a href="#%E8%AF%BB%E6%8F%90%E4%BA%A4%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84">è¯»æäº¤çš„å®ç°æœºåˆ¶</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ul>
<h2 id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</h2>
<p>æƒ³è±¡ä¸€ä¸ªç®€å•çš„è½¬è´¦åœºæ™¯ï¼šAçš„é’±åŒ…æœ‰100å…ƒï¼ŒBçš„é’±åŒ…æœ‰0å…ƒã€‚Aç»™Bè½¬è´¦100å…ƒåï¼Œæœ€ç»ˆç»“æœåº”è¯¥æ˜¯Aä½™é¢ä¸º0å…ƒï¼ŒBä½™é¢ä¸º100å…ƒã€‚</p>
<p>ä½†å®é™…ä¸Šï¼Œè½¬è´¦åœ¨ç¨‹åºä¸­ä¼šæ¶‰åŠå¤šä¸ªæ“ä½œæ­¥éª¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. è¯»å–Açš„è´¦æˆ·ä½™é¢</span><br><span class="line">2. ä»Açš„ä½™é¢ä¸­å‡å»è½¬è´¦é‡‘é¢</span><br><span class="line">3. æ›´æ–°Açš„ä½™é¢åˆ°æ•°æ®åº“</span><br><span class="line">---</span><br><span class="line">4. è¯»å–Bçš„è´¦æˆ·ä½™é¢</span><br><span class="line">5. ç»™Bçš„ä½™é¢å¢åŠ è½¬è´¦é‡‘é¢</span><br><span class="line">6. æ›´æ–°Bçš„ä½™é¢åˆ°æ•°æ®åº“</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåœ¨æ‰§è¡Œç¬¬3æ­¥ä¹‹åç³»ç»Ÿçªç„¶å´©æºƒï¼Œå°±ä¼šå‡ºç°Aè´¦æˆ·å·²å‡å»100å…ƒï¼Œä½†Bè´¦æˆ·æ²¡æœ‰å¢åŠ ç›¸åº”é‡‘é¢çš„æƒ…å†µ â€”â€” <strong>é’±å‡­ç©ºæ¶ˆå¤±äº†ï¼</strong></p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ•°æ®åº“æä¾›äº†ã€Œ<strong>äº‹åŠ¡ï¼ˆTransactionï¼‰</strong>ã€æœºåˆ¶ï¼Œä¿è¯ä¸€ç³»åˆ—æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šåˆ°åˆå§‹çŠ¶æ€ï¼Œä¸ä¼šå‡ºç°ä¸­é—´çŠ¶æ€ã€‚</p>
<h2 id="äº‹åŠ¡æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ">äº‹åŠ¡æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ</h2>
<p>äº‹åŠ¡ç”±æ•°æ®åº“å¼•æ“å®ç°ï¼ŒMySQLçš„InnoDBå¼•æ“æ”¯æŒäº‹åŠ¡ï¼Œè€ŒMyISAMå¼•æ“ä¸æ”¯æŒã€‚äº‹åŠ¡å¿…é¡»éµå®ˆå››ä¸ªåŸºæœ¬ç‰¹æ€§ï¼ˆACIDï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>ä¸“ä¸šæœ¯è¯­</th>
<th>é€šä¿—è§£é‡Š</th>
<th>ç”Ÿæ´»ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åŸå­æ€§</strong></td>
<td>Atomicity</td>
<td>äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆ</td>
<td>è´­ç‰©æ—¶ï¼Œè¦ä¹ˆæˆåŠŸä»˜æ¬¾å¹¶è·å¾—å•†å“ï¼Œè¦ä¹ˆäº¤æ˜“å–æ¶ˆï¼Œä¸ä¼šå‡ºç°ä»˜äº†é’±æ²¡æ”¶åˆ°å•†å“çš„æƒ…å†µ</td>
</tr>
<tr>
<td><strong>ä¸€è‡´æ€§</strong></td>
<td>Consistency</td>
<td>äº‹åŠ¡å‰åï¼Œæ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€</td>
<td>è½¬è´¦åï¼Œæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼ŒAå’ŒBçš„æ€»é‡‘é¢åº”ä¿æŒä¸å˜ï¼Œä¸ä¼šå‡­ç©ºå¢åŠ æˆ–å‡å°‘</td>
</tr>
<tr>
<td><strong>éš”ç¦»æ€§</strong></td>
<td>Isolation</td>
<td>å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œå½¼æ­¤ä¹‹é—´ä¸ä¼šäº’ç›¸å¹²æ‰°</td>
<td>å¤šäººåŒæ—¶åœ¨ç½‘ä¸Šå•†åŸè´­ç‰©ï¼Œæ¯ä¸ªäººçš„è´­ç‰©è¿‡ç¨‹ä¸ä¼šäº’ç›¸å½±å“</td>
</tr>
<tr>
<td><strong>æŒä¹…æ€§</strong></td>
<td>Durability</td>
<td>äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„</td>
<td>é“¶è¡Œè½¬è´¦æˆåŠŸåï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒï¼Œé‡å¯åä½ çš„è½¬è´¦è®°å½•ä¾ç„¶å­˜åœ¨</td>
</tr>
</tbody>
</table>
<p>InnoDBå¼•æ“é€šè¿‡ä¸åŒçš„æŠ€æœ¯ä¿è¯è¿™å››ä¸ªç‰¹æ€§ï¼š</p>
<ul>
<li><strong>æŒä¹…æ€§</strong>ï¼šé€šè¿‡ redo logï¼ˆé‡åšæ—¥å¿—ï¼‰å®ç°</li>
<li><strong>åŸå­æ€§</strong>ï¼šé€šè¿‡ undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰å®ç°</li>
<li><strong>éš”ç¦»æ€§</strong>ï¼šé€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æˆ–é”æœºåˆ¶å®ç°</li>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šé€šè¿‡æŒä¹…æ€§ + åŸå­æ€§ + éš”ç¦»æ€§å…±åŒä¿è¯</li>
</ul>
<p>æœ¬æ–‡å°†<strong>é‡ç‚¹ä»‹ç»äº‹åŠ¡çš„éš”ç¦»æ€§</strong>ï¼Œè¿™ä¹Ÿæ˜¯é¢è¯•ä¸­æœ€å¸¸è¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹ã€‚</p>
<h2 id="å¹¶è¡Œäº‹åŠ¡ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ï¼Ÿ">å¹¶è¡Œäº‹åŠ¡ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>MySQLæœåŠ¡å™¨å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥ï¼Œå› æ­¤ä¼šåŒæ—¶å¤„ç†å¤šä¸ªäº‹åŠ¡ã€‚åœ¨æ²¡æœ‰é€‚å½“éš”ç¦»æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°ä¸‰ç§ä¸»è¦å¹¶å‘é—®é¢˜ï¼š</p>
<h3 id="ä¸‰ç§å¹¶å‘é—®é¢˜å¯¹æ¯”">ä¸‰ç§å¹¶å‘é—®é¢˜å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>é—®é¢˜ç±»å‹</th>
<th>å®šä¹‰</th>
<th>å‘ç”Ÿæ¡ä»¶</th>
<th>ä¸¥é‡ç¨‹åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è„è¯»</strong></td>
<td>è¯»åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®</td>
<td>äº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®ï¼Œä¹‹åäº‹åŠ¡Bå›æ»š</td>
<td>æœ€ä¸¥é‡</td>
</tr>
<tr>
<td><strong>ä¸å¯é‡å¤è¯»</strong></td>
<td>åŒä¸€äº‹åŠ¡å†…ï¼Œå‰åè¯»å–åŒä¸€æ•°æ®å¾—åˆ°ä¸åŒç»“æœ</td>
<td>äº‹åŠ¡Aå…ˆè¯»å–æ•°æ®ï¼Œäº‹åŠ¡Bä¿®æ”¹å¹¶æäº¤è¯¥æ•°æ®ï¼Œäº‹åŠ¡Aå†æ¬¡è¯»å–å¾—åˆ°ä¸åŒç»“æœ</td>
<td>ä¸­ç­‰</td>
</tr>
<tr>
<td><strong>å¹»è¯»</strong></td>
<td>åŒä¸€äº‹åŠ¡å†…ï¼Œç”¨ç›¸åŒæ¡ä»¶æŸ¥è¯¢å¾—åˆ°ä¸åŒæ•°é‡çš„è®°å½•</td>
<td>äº‹åŠ¡AæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œäº‹åŠ¡Bæ’å…¥/åˆ é™¤ç¬¦åˆè¯¥æ¡ä»¶çš„è®°å½•å¹¶æäº¤ï¼Œäº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢å¾—åˆ°ä¸åŒæ•°é‡çš„è®°å½•</td>
<td>è¾ƒè½»</td>
</tr>
</tbody>
</table>
<p>ä¸‹é¢é€šè¿‡å›¾ç¤ºæ¥ç†è§£è¿™äº›é—®é¢˜ï¼š</p>
<h4 id="è„è¯»ç¤ºä¾‹">è„è¯»ç¤ºä¾‹</h4>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746514159574.png" alt="è„è¯»"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œäº‹åŠ¡Bè¯»å–åˆ°äº‹åŠ¡Aä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®ã€‚å¦‚æœäº‹åŠ¡Aä¹‹åå›æ»šï¼Œåˆ™äº‹åŠ¡Bè¯»å–åˆ°çš„æ•°æ®å°±æ˜¯&quot;è„&quot;çš„ã€‚</p>
<h4 id="ä¸å¯é‡å¤è¯»ç¤ºä¾‹">ä¸å¯é‡å¤è¯»ç¤ºä¾‹</h4>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746514175561.png" alt="ä¸å¯é‡å¤è¯»"></p>
<p>äº‹åŠ¡Aä¸¤æ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œä½†å› ä¸ºä¸­é—´äº‹åŠ¡Bå¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ï¼Œå¯¼è‡´å‰åè¯»å–ç»“æœä¸ä¸€è‡´ã€‚</p>
<h4 id="å¹»è¯»ç¤ºä¾‹">å¹»è¯»ç¤ºä¾‹</h4>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746514184290.png" alt="å¹»è¯»"></p>
<p>äº‹åŠ¡Aä¸¤æ¬¡æŸ¥è¯¢åŒä¸€æ¡ä»¶çš„è®°å½•æ•°é‡ï¼Œä½†å› ä¸ºä¸­é—´äº‹åŠ¡Bæ’å…¥äº†æ–°è®°å½•å¹¶æäº¤ï¼Œå¯¼è‡´ç¬¬äºŒæ¬¡æŸ¥è¯¢ç»“æœé›†å˜å¤šï¼Œå°±åƒå‡ºç°äº†&quot;å¹»è§‰&quot;ä¸€æ ·ã€‚</p>
<h2 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ">äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ</h2>
<p>SQLæ ‡å‡†å®šä¹‰äº†å››ç§éš”ç¦»çº§åˆ«ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œèƒ½è§£å†³çš„å¹¶å‘é—®é¢˜è¶Šå¤šï¼Œä½†æ€§èƒ½å¼€é”€ä¹Ÿè¶Šå¤§ï¼š</p>
<h3 id="å››ç§éš”ç¦»çº§åˆ«å¯¹æ¯”">å››ç§éš”ç¦»çº§åˆ«å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>è„è¯»</th>
<th>ä¸å¯é‡å¤è¯»</th>
<th>å¹»è¯»</th>
<th>æ€§èƒ½å½±å“</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è¯»æœªæäº¤</strong><br>(Read Uncommitted)</td>
<td>å¯èƒ½å‘ç”Ÿ</td>
<td>å¯èƒ½å‘ç”Ÿ</td>
<td>å¯èƒ½å‘ç”Ÿ</td>
<td>å½±å“æœ€å°</td>
</tr>
<tr>
<td><strong>è¯»æäº¤</strong><br>(Read Committed)</td>
<td>ä¸ä¼šå‘ç”Ÿ</td>
<td>å¯èƒ½å‘ç”Ÿ</td>
<td>å¯èƒ½å‘ç”Ÿ</td>
<td>å½±å“è¾ƒå°</td>
</tr>
<tr>
<td><strong>å¯é‡å¤è¯»</strong><br>(Repeatable Read)</td>
<td>ä¸ä¼šå‘ç”Ÿ</td>
<td>ä¸ä¼šå‘ç”Ÿ</td>
<td>å¯èƒ½å‘ç”Ÿ<br><em>(MySQL InnoDBåŸºæœ¬é¿å…)</em></td>
<td>å½±å“ä¸­ç­‰</td>
</tr>
<tr>
<td><strong>ä¸²è¡ŒåŒ–</strong><br>(Serializable)</td>
<td>ä¸ä¼šå‘ç”Ÿ</td>
<td>ä¸ä¼šå‘ç”Ÿ</td>
<td>ä¸ä¼šå‘ç”Ÿ</td>
<td>å½±å“æœ€å¤§</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šMySQL InnoDBçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œå¹¶ä¸”å®ƒå¯¹å¹»è¯»é—®é¢˜æœ‰ç‰¹æ®Šå¤„ç†ã€‚</p>
</blockquote>
<p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥çœ‹ä¸åŒéš”ç¦»çº§åˆ«ä¸‹çš„è¡Œä¸ºå·®å¼‚ï¼š</p>
<p>å‡è®¾æœ‰ä¸€å¼ è´¦æˆ·è¡¨ï¼Œé‡Œé¢æœ‰ä¸€æ¡è®°å½•æ˜¾ç¤ºå°æ—çš„ä½™é¢ä¸º100ä¸‡ã€‚ç°åœ¨æœ‰ä¸¤ä¸ªå¹¶å‘äº‹åŠ¡ï¼š</p>
<ul>
<li>äº‹åŠ¡Aè´Ÿè´£æŸ¥è¯¢å°æ—çš„ä½™é¢</li>
<li>äº‹åŠ¡Bå°†å°æ—çš„ä½™é¢ä»100ä¸‡ä¿®æ”¹ä¸º200ä¸‡</li>
</ul>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746515349988.png" alt="ä¸åŒéš”ç¦»çº§åˆ«ä¸‹çš„è¡Œä¸º"></p>
<p>åœ¨ä¸åŒéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aåœ¨ä¸‰ä¸ªæ—¶é—´ç‚¹æŸ¥è¯¢åˆ°çš„ç»“æœä¼šæœ‰æ‰€ä¸åŒï¼š</p>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>æŸ¥è¯¢V1ç»“æœ<br>(äº‹åŠ¡Bä¿®æ”¹åæœªæäº¤)</th>
<th>æŸ¥è¯¢V2ç»“æœ<br>(äº‹åŠ¡Bæäº¤åï¼Œäº‹åŠ¡Aæäº¤å‰)</th>
<th>æŸ¥è¯¢V3ç»“æœ<br>(äº‹åŠ¡Aæäº¤å)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è¯»æœªæäº¤</strong></td>
<td>200ä¸‡</td>
<td>200ä¸‡</td>
<td>200ä¸‡</td>
</tr>
<tr>
<td><strong>è¯»æäº¤</strong></td>
<td>100ä¸‡</td>
<td>200ä¸‡</td>
<td>200ä¸‡</td>
</tr>
<tr>
<td><strong>å¯é‡å¤è¯»</strong></td>
<td>100ä¸‡</td>
<td>100ä¸‡</td>
<td>200ä¸‡<br><em>(äº‹åŠ¡Aæäº¤åé‡æ–°æŸ¥è¯¢æ‰èƒ½çœ‹åˆ°200ä¸‡)</em></td>
</tr>
<tr>
<td><strong>ä¸²è¡ŒåŒ–</strong></td>
<td>100ä¸‡</td>
<td>100ä¸‡<br><em>(äº‹åŠ¡Bçš„ä¿®æ”¹ä¼šè¢«é˜»å¡ç›´åˆ°äº‹åŠ¡Aæäº¤)</em></td>
<td>200ä¸‡<br><em>(äº‹åŠ¡Aæäº¤åäº‹åŠ¡Bæ‰èƒ½æ‰§è¡Œ)</em></td>
</tr>
</tbody>
</table>
<h3 id="éš”ç¦»çº§åˆ«çš„å®ç°åŸç†">éš”ç¦»çº§åˆ«çš„å®ç°åŸç†</h3>
<p>ä¸åŒéš”ç¦»çº§åˆ«çš„å®ç°æœºåˆ¶ï¼š</p>
<ul>
<li><strong>è¯»æœªæäº¤</strong>ï¼šç›´æ¥è¯»å–æœ€æ–°æ•°æ®ï¼Œä¸åšä»»ä½•æ£€æŸ¥</li>
<li><strong>è¯»æäº¤</strong>ï¼šä½¿ç”¨Read Viewæœºåˆ¶ï¼Œ<strong>æ¯æ¬¡SELECTéƒ½åˆ›å»ºæ–°çš„Read View</strong></li>
<li><strong>å¯é‡å¤è¯»</strong>ï¼šä½¿ç”¨Read Viewæœºåˆ¶ï¼Œ<strong>äº‹åŠ¡å¼€å§‹æ—¶åˆ›å»ºRead Viewå¹¶åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´ä½¿ç”¨</strong></li>
<li><strong>ä¸²è¡ŒåŒ–</strong>ï¼šä½¿ç”¨é”æœºåˆ¶ï¼Œè¯»å†™æ“ä½œéƒ½ä¼šåŠ é”</li>
</ul>
<p>MySQL InnoDBé’ˆå¯¹å¹»è¯»é—®é¢˜çš„ç‰¹æ®Šå¤„ç†ï¼š</p>
<ul>
<li>å¯¹äº<strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€šSELECTè¯­å¥ï¼‰ï¼šé€šè¿‡MVCCæœºåˆ¶è§£å†³å¹»è¯»</li>
<li>å¯¹äº<strong>å½“å‰è¯»</strong>ï¼ˆSELECT FOR UPDATEç­‰è¯­å¥ï¼‰ï¼šé€šè¿‡next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰è§£å†³å¹»è¯»</li>
</ul>
<blockquote>
<p><strong>åè¯è§£é‡Š</strong>ï¼š</p>
<ul>
<li><strong>å¿«ç…§è¯»</strong>ï¼šè¯»å–æ•°æ®çš„å†å²ç‰ˆæœ¬ï¼ˆå¿«ç…§ï¼‰ï¼Œä¸ä¼šåŠ é”ï¼Œä¾‹å¦‚æ™®é€šçš„SELECTè¯­å¥</li>
<li><strong>å½“å‰è¯»</strong>ï¼šè¯»å–æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¼šåŠ é”ï¼Œä¾‹å¦‚SELECT FOR UPDATEã€UPDATEã€DELETEç­‰è¯­å¥</li>
</ul>
</blockquote>
<h2 id="Read-View-åœ¨-MVCC-é‡Œå¦‚ä½•å·¥ä½œçš„ï¼Ÿ">Read View åœ¨ MVCC é‡Œå¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p>MVCCï¼ˆMulti-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æ˜¯MySQLå®ç°äº‹åŠ¡éš”ç¦»çš„å…³é”®æŠ€æœ¯ï¼ŒRead Viewæ˜¯MVCCçš„æ ¸å¿ƒæ¦‚å¿µã€‚</p>
<h3 id="Read-Viewçš„ç»“æ„">Read Viewçš„ç»“æ„</h3>
<p>Read Viewæ˜¯äº‹åŠ¡åœ¨è®¿é—®æ•°æ®æ—¶åˆ›å»ºçš„ä¸€ä¸ª&quot;å¿«ç…§&quot;ï¼ŒåŒ…å«å››ä¸ªå…³é”®å­—æ®µï¼š</p>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746534208808.png" alt="Read Viewç»“æ„"></p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>m_ids</strong></td>
<td>åˆ›å»ºRead Viewæ—¶ï¼Œæ´»è·ƒäº‹åŠ¡çš„IDåˆ—è¡¨</td>
<td>åˆ¤æ–­è®°å½•ç‰ˆæœ¬å¯¹å½“å‰äº‹åŠ¡æ˜¯å¦å¯è§</td>
</tr>
<tr>
<td><strong>min_trx_id</strong></td>
<td>m_idsä¸­æœ€å°çš„äº‹åŠ¡ID</td>
<td>å¿«é€Ÿåˆ¤æ–­è®°å½•æ˜¯å¦å¯¹å½“å‰äº‹åŠ¡å¯è§</td>
</tr>
<tr>
<td><strong>max_trx_id</strong></td>
<td>ä¸‹ä¸€ä¸ªå°†è¢«åˆ†é…çš„äº‹åŠ¡ID</td>
<td>åˆ¤æ–­è®°å½•æ˜¯å¦ç”±æœªæ¥äº‹åŠ¡åˆ›å»º</td>
</tr>
<tr>
<td><strong>creator_trx_id</strong></td>
<td>åˆ›å»ºRead Viewçš„äº‹åŠ¡ID</td>
<td>ç¡®ä¿äº‹åŠ¡èƒ½çœ‹åˆ°è‡ªå·±çš„ä¿®æ”¹</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>æ´»è·ƒäº‹åŠ¡</strong>æŒ‡çš„æ˜¯å·²ç»å¼€å§‹ä½†è¿˜æœªæäº¤çš„äº‹åŠ¡</p>
</blockquote>
<h3 id="è®°å½•çš„éšè—åˆ—">è®°å½•çš„éšè—åˆ—</h3>
<p>InnoDBå­˜å‚¨å¼•æ“çš„è¡¨è®°å½•ä¸­ï¼Œé™¤äº†æˆ‘ä»¬å®šä¹‰çš„åˆ—å¤–ï¼Œè¿˜åŒ…å«ä¸¤ä¸ªéšè—åˆ—ï¼š</p>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746534222507.png" alt="è®°å½•çš„éšè—åˆ—"></p>
<table>
<thead>
<tr>
<th>éšè—åˆ—</th>
<th>å«ä¹‰</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>trx_id</strong></td>
<td>æœ€åä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ID</td>
<td>ç”¨äºåˆ¤æ–­è®°å½•ç‰ˆæœ¬å¯¹äº‹åŠ¡æ˜¯å¦å¯è§</td>
</tr>
<tr>
<td><strong>roll_pointer</strong></td>
<td>æŒ‡å‘è®°å½•ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æŒ‡é’ˆ</td>
<td>ç”¨äºæ„å»ºç‰ˆæœ¬é“¾ï¼Œå®ç°å›æ»š</td>
</tr>
</tbody>
</table>
<h3 id="ç‰ˆæœ¬å¯è§æ€§åˆ¤æ–­æµç¨‹">ç‰ˆæœ¬å¯è§æ€§åˆ¤æ–­æµç¨‹</h3>
<p>å½“äº‹åŠ¡é€šè¿‡Read Viewè®¿é—®è®°å½•æ—¶ï¼Œä¼šæŒ‰ä»¥ä¸‹æµç¨‹åˆ¤æ–­è®°å½•ç‰ˆæœ¬çš„å¯è§æ€§ï¼š</p>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746534236041.png" alt="ç‰ˆæœ¬å¯è§æ€§åˆ¤æ–­"></p>
<p>åˆ¤æ–­æµç¨‹å¯ç®€åŒ–ä¸ºï¼š</p>
<ol>
<li>å¦‚æœè®°å½•çš„trx_idç­‰äºcreator_trx_idï¼Œè¯´æ˜æ˜¯å½“å‰äº‹åŠ¡è‡ªå·±ä¿®æ”¹çš„è®°å½•ï¼Œ<strong>å¯è§</strong></li>
<li>å¦‚æœè®°å½•çš„trx_id &lt; min_trx_idï¼Œè¯´æ˜ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡åœ¨åˆ›å»ºRead Viewå‰å·²æäº¤ï¼Œ<strong>å¯è§</strong></li>
<li>å¦‚æœè®°å½•çš„trx_id &gt;= max_trx_idï¼Œè¯´æ˜ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡åœ¨åˆ›å»ºRead Viewåæ‰å¼€å§‹ï¼Œ<strong>ä¸å¯è§</strong></li>
<li>å¦‚æœmin_trx_id &lt;= è®°å½•çš„trx_id &lt; max_trx_idï¼Œéœ€è¿›ä¸€æ­¥åˆ¤æ–­ï¼š
<ul>
<li>å¦‚æœtrx_idåœ¨m_idsåˆ—è¡¨ä¸­ï¼Œè¯´æ˜ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡è¿˜æœªæäº¤ï¼Œ<strong>ä¸å¯è§</strong></li>
<li>å¦‚æœtrx_idä¸åœ¨m_idsåˆ—è¡¨ä¸­ï¼Œè¯´æ˜ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡å·²æäº¤ï¼Œ<strong>å¯è§</strong></li>
</ul>
</li>
<li>å¦‚æœå½“å‰ç‰ˆæœ¬ä¸å¯è§ï¼Œä¼šæ²¿ç€ç‰ˆæœ¬é“¾æ‰¾æ›´æ—©çš„ç‰ˆæœ¬ï¼Œé‡å¤ä»¥ä¸Šåˆ¤æ–­</li>
</ol>
<p>è¿™ç§é€šè¿‡<strong>ç‰ˆæœ¬é“¾</strong>æ§åˆ¶å¹¶å‘è®¿é—®çš„æœºåˆ¶å°±æ˜¯MVCCçš„æ ¸å¿ƒã€‚</p>
<h2 id="å¯é‡å¤è¯»æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ">å¯é‡å¤è¯»æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p><strong>å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„ç‰¹ç‚¹</strong>ï¼šäº‹åŠ¡åœ¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªRead Viewï¼Œæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½ä½¿ç”¨è¿™ä¸ªRead Viewï¼Œç¡®ä¿äº‹åŠ¡çœ‹åˆ°çš„æ•°æ®æ˜¯äº‹åŠ¡å¯åŠ¨æ—¶çš„å¿«ç…§ã€‚</p>
<h3 id="å®é™…æ¡ˆä¾‹åˆ†æ">å®é™…æ¡ˆä¾‹åˆ†æ</h3>
<p>å‡è®¾æœ‰ä¸¤ä¸ªäº‹åŠ¡Aå’ŒBï¼Œäº‹åŠ¡Açš„IDä¸º51ï¼Œäº‹åŠ¡Bçš„IDä¸º52ï¼š</p>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746534249252.png" alt="å¯é‡å¤è¯»çš„Read View"></p>
<p>äº‹åŠ¡æ‰§è¡Œé¡ºåºï¼š</p>
<ol>
<li>äº‹åŠ¡Bè¯»å–å°æ—ä½™é¢ï¼Œå¾—åˆ°100ä¸‡</li>
<li>äº‹åŠ¡Aä¿®æ”¹å°æ—ä½™é¢ä¸º200ä¸‡ï¼ˆæœªæäº¤ï¼‰</li>
<li>äº‹åŠ¡Bå†æ¬¡è¯»å–å°æ—ä½™é¢ï¼Œä¾ç„¶æ˜¯100ä¸‡</li>
<li>äº‹åŠ¡Aæäº¤äº‹åŠ¡</li>
<li>äº‹åŠ¡Bç¬¬ä¸‰æ¬¡è¯»å–å°æ—ä½™é¢ï¼Œä¾ç„¶æ˜¯100ä¸‡</li>
</ol>
<h4 id="ä¸ºä»€ä¹ˆäº‹åŠ¡Bä¸€ç›´è¯»åˆ°çš„éƒ½æ˜¯100ä¸‡ï¼Ÿ">ä¸ºä»€ä¹ˆäº‹åŠ¡Bä¸€ç›´è¯»åˆ°çš„éƒ½æ˜¯100ä¸‡ï¼Ÿ</h4>
<p>äº‹åŠ¡Båœ¨å¯åŠ¨æ—¶åˆ›å»ºäº†Read Viewï¼š</p>
<ul>
<li>m_ids = [51, 52] ï¼ˆæ´»è·ƒäº‹åŠ¡åˆ—è¡¨ï¼‰</li>
<li>min_trx_id = 51</li>
<li>max_trx_id = 53</li>
<li>creator_trx_id = 52</li>
</ul>
<p>å½“äº‹åŠ¡Aä¿®æ”¹è®°å½•åï¼Œç‰ˆæœ¬é“¾å˜ä¸ºï¼š</p>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746534261267.png" alt="ç‰ˆæœ¬é“¾ç¤ºæ„å›¾"></p>
<p>å½“äº‹åŠ¡Bè¯»å–è®°å½•æ—¶ï¼š</p>
<ol>
<li>å‘ç°æœ€æ–°ç‰ˆæœ¬trx_id=51ï¼Œåœ¨m_idsåˆ—è¡¨ä¸­</li>
<li>åˆ¤æ–­æ­¤ç‰ˆæœ¬<strong>ä¸å¯è§</strong></li>
<li>æ²¿ç€ç‰ˆæœ¬é“¾æ‰¾åˆ°æ—§ç‰ˆæœ¬ï¼Œtrx_id=50</li>
<li>50 &lt; min_trx_id(51)ï¼Œåˆ¤æ–­æ­¤ç‰ˆæœ¬<strong>å¯è§</strong></li>
<li>è¿”å›ä½™é¢100ä¸‡</li>
</ol>
<p>å³ä½¿äº‹åŠ¡Aæäº¤åï¼Œå› ä¸ºäº‹åŠ¡Bä»ç„¶ä½¿ç”¨å¯åŠ¨æ—¶çš„Read Viewï¼Œæ‰€ä»¥ç»§ç»­è¯»åˆ°çš„è¿˜æ˜¯æ—§ç‰ˆæœ¬çš„æ•°æ®ã€‚</p>
<p>è¿™å°±æ˜¯<strong>å¯é‡å¤è¯»</strong>çš„æ ¸å¿ƒæœºåˆ¶ï¼š<strong>åŒä¸€äº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ä¼šå¾—åˆ°ç›¸åŒç»“æœ</strong>ã€‚</p>
<h2 id="è¯»æäº¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ">è¯»æäº¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p><strong>è¯»æäº¤éš”ç¦»çº§åˆ«çš„ç‰¹ç‚¹</strong>ï¼šæ¯æ¬¡SELECTéƒ½ä¼šåˆ›å»ºæ–°çš„Read Viewï¼Œå› æ­¤èƒ½å¤Ÿè¯»åˆ°å…¶ä»–å·²æäº¤äº‹åŠ¡çš„æœ€æ–°ä¿®æ”¹ã€‚</p>
<h3 id="ä¸å¯é‡å¤è¯»çš„å¯¹æ¯”">ä¸å¯é‡å¤è¯»çš„å¯¹æ¯”</h3>
<p>æˆ‘ä»¬è¿˜æ˜¯ç”¨å‰é¢çš„ä¾‹å­æ¥å¯¹æ¯”ï¼š</p>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746534277270.png" alt="è¯»æäº¤çš„Read Viewå˜åŒ–"></p>
<p>äº‹åŠ¡æ‰§è¡Œé¡ºåºï¼š</p>
<ol>
<li>äº‹åŠ¡Bç¬¬ä¸€æ¬¡è¯»å–ï¼ˆåˆ›å»ºRead View 1ï¼‰ï¼Œè¯»åˆ°ä½™é¢100ä¸‡</li>
<li>äº‹åŠ¡Aä¿®æ”¹ä½™é¢ä¸º200ä¸‡ï¼ˆæœªæäº¤ï¼‰</li>
<li>äº‹åŠ¡Bç¬¬äºŒæ¬¡è¯»å–ï¼ˆåˆ›å»ºRead View 2ï¼‰ï¼Œè¯»åˆ°ä½™é¢100ä¸‡</li>
<li>äº‹åŠ¡Aæäº¤äº‹åŠ¡</li>
<li>äº‹åŠ¡Bç¬¬ä¸‰æ¬¡è¯»å–ï¼ˆåˆ›å»ºRead View 3ï¼‰ï¼Œè¯»åˆ°ä½™é¢200ä¸‡</li>
</ol>
<h4 id="æ ¸å¿ƒåŒºåˆ«">æ ¸å¿ƒåŒºåˆ«</h4>
<p>äº‹åŠ¡Bæ¯æ¬¡è¯»å–éƒ½åˆ›å»ºæ–°çš„Read Viewï¼š</p>
<ul>
<li>Read View 1å’Œ2ï¼šå› ä¸ºäº‹åŠ¡Aæœªæäº¤ï¼Œæ´»è·ƒäº‹åŠ¡åˆ—è¡¨åŒ…å«äº‹åŠ¡Aï¼Œæ‰€ä»¥è¯»ä¸åˆ°äº‹åŠ¡Açš„ä¿®æ”¹</li>
<li>Read View 3ï¼šäº‹åŠ¡Aå·²æäº¤ï¼Œæ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­ä¸åŒ…å«äº‹åŠ¡Aï¼Œæ‰€ä»¥èƒ½è¯»åˆ°äº‹åŠ¡Açš„ä¿®æ”¹</li>
</ul>
<p><img src="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/1746534287457.png" alt="è¯»æäº¤æœ€ç»ˆçš„Read View"></p>
<p>è¿™å°±æ˜¯<strong>è¯»æäº¤</strong>çš„æ ¸å¿ƒæœºåˆ¶ï¼š<strong>æ€»æ˜¯èƒ½è¯»åˆ°å…¶ä»–å·²æäº¤äº‹åŠ¡çš„æœ€æ–°ä¿®æ”¹</strong>ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<h3 id="éš”ç¦»çº§åˆ«ä¸å®ç°æœºåˆ¶">éš”ç¦»çº§åˆ«ä¸å®ç°æœºåˆ¶</h3>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>Read Viewåˆ›å»ºæ—¶æœº</th>
<th>èƒ½è§£å†³çš„é—®é¢˜</th>
<th>å®ç°æœºåˆ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è¯»æœªæäº¤</strong></td>
<td>ä¸ä½¿ç”¨Read View</td>
<td>æ— </td>
<td>ç›´æ¥è¯»å–æœ€æ–°æ•°æ®</td>
</tr>
<tr>
<td><strong>è¯»æäº¤</strong></td>
<td>æ¯æ¬¡SELECTæ—¶åˆ›å»º</td>
<td>è„è¯»</td>
<td>MVCCï¼ˆRead Viewï¼‰</td>
</tr>
<tr>
<td><strong>å¯é‡å¤è¯»</strong></td>
<td>äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»º</td>
<td>è„è¯»ã€ä¸å¯é‡å¤è¯»</td>
<td>MVCCï¼ˆRead Viewï¼‰</td>
</tr>
<tr>
<td><strong>ä¸²è¡ŒåŒ–</strong></td>
<td>ä¸ä½¿ç”¨Read View</td>
<td>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</td>
<td>åŠ é”ï¼ˆè¯»å†™é”ï¼‰</td>
</tr>
</tbody>
</table>
<h3 id="MySQL-InnoDBå¯¹å¹»è¯»çš„å¤„ç†">MySQL InnoDBå¯¹å¹»è¯»çš„å¤„ç†</h3>
<p>MySQL InnoDBåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹é€šè¿‡ä¸¤ç§æ–¹å¼å¤„ç†å¹»è¯»é—®é¢˜ï¼š</p>
<ol>
<li><strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€šSELECTï¼‰ï¼šä½¿ç”¨MVCCæœºåˆ¶ï¼Œäº‹åŠ¡åªèƒ½çœ‹åˆ°äº‹åŠ¡å¼€å§‹å‰çš„æ•°æ®çŠ¶æ€</li>
<li><strong>å½“å‰è¯»</strong>ï¼ˆSELECT FOR UPDATEç­‰ï¼‰ï¼šä½¿ç”¨next-key locké”æœºåˆ¶ï¼ˆè®°å½•é”+é—´éš™é”ï¼‰é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨æŸ¥è¯¢èŒƒå›´å†…æ’å…¥æ•°æ®</li>
</ol>
<h3 id="æ ¸å¿ƒæŠ€æœ¯æ€»ç»“">æ ¸å¿ƒæŠ€æœ¯æ€»ç»“</h3>
<ol>
<li><strong>MVCC</strong>ï¼šé€šè¿‡è®°å½•çš„ç‰ˆæœ¬é“¾å’ŒRead Viewå®ç°äº‹åŠ¡éš”ç¦»</li>
<li><strong>Read View</strong>ï¼šå†³å®šäº‹åŠ¡å¯ä»¥çœ‹åˆ°å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®</li>
<li><strong>éšè—åˆ—</strong>ï¼štrx_idå’Œroll_pointeræ„å»ºäº†ç‰ˆæœ¬é“¾çš„åŸºç¡€</li>
<li><strong>éš”ç¦»çº§åˆ«å·®å¼‚</strong>ï¼šä¸»è¦ä½“ç°åœ¨åˆ›å»ºRead Viewçš„æ—¶æœºä¸åŒ</li>
</ol>
<p>ç†è§£äº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°åŸç†ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨å¼€å‘ä¸­é€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«ï¼Œå¹³è¡¡æ•°æ®ä¸€è‡´æ€§å’Œç³»ç»Ÿæ€§èƒ½ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>äº‹åŠ¡</category>
      </categories>
      <tags>
        <tag>é¢è¯•é¢˜</tag>
        <tag>MySQL</tag>
        <tag>äº‹åŠ¡éš”ç¦»çº§åˆ«</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>å¹¶å‘æ§åˆ¶</tag>
        <tag>MVCC</tag>
        <tag>é”æœºåˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 78 - å­é›†ï¼ˆSubsetsï¼‰</title>
    <url>/2025/05/06/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-78-%E5%AD%90%E9%9B%86/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œæ•°ç»„ä¸­çš„å…ƒç´  <strong>äº’ä¸ç›¸åŒ</strong>ã€‚è¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚</p>
<p>è§£é›† <strong>ä¸èƒ½</strong> åŒ…å«é‡å¤çš„å­é›†ã€‚ä½ å¯ä»¥æŒ‰ <strong>ä»»æ„é¡ºåº</strong> è¿”å›è§£é›†ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼š">ç¤ºä¾‹ 1ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,2,3]</span><br><span class="line">è¾“å‡ºï¼š[[],[1],[2],[1,2],[3],[1,3],[2,3],[1,2,3]]</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2ï¼š">ç¤ºä¾‹ 2ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [0]</span><br><span class="line">è¾“å‡ºï¼š[[],[0]]</span><br></pre></td></tr></table></figure>
<h3 id="æç¤ºï¼š">æç¤ºï¼š</h3>
<ul>
<li><code>1 &lt;= nums.length &lt;= 10</code></li>
<li><code>-10 &lt;= nums[i] &lt;= 10</code></li>
<li><code>nums</code> ä¸­çš„æ‰€æœ‰å…ƒç´  <strong>äº’ä¸ç›¸åŒ</strong></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>å­é›†é—®é¢˜æ˜¯ç»„åˆé—®é¢˜çš„å…¸å‹æ¡ˆä¾‹ï¼Œå¯¹äºä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œå…¶å­é›†çš„æ•°é‡ä¸º 2^nã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•æ¥ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å­é›†ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šåŸºäºä½è¿ç®—çš„è¿­ä»£æ³•">æ–¹æ³•ä¸€ï¼šåŸºäºä½è¿ç®—çš„è¿­ä»£æ³•</h3>
<p>è¿™ä¸ªæ–¹æ³•åŸºäºä¸€ä¸ªé‡è¦è§‚å¯Ÿï¼šå¯¹äºé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œå¯ä»¥ç”¨ä¸€ä¸ª n ä½äºŒè¿›åˆ¶æ•°è¡¨ç¤ºæŸä¸ªå­é›†ï¼Œå…¶ä¸­ç¬¬ i ä½ä¸º 1 è¡¨ç¤ºé€‰æ‹©ç¬¬ i ä¸ªå…ƒç´ ï¼Œä¸º 0 è¡¨ç¤ºä¸é€‰æ‹©ã€‚</p>
<p><strong>å…³é”®æ´è§</strong>ï¼šä» 0 åˆ° 2^n-1 çš„æ¯ä¸ªäºŒè¿›åˆ¶æ•°éƒ½å”¯ä¸€å¯¹åº”ä¸€ä¸ªå­é›†ã€‚</p>
<h4 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</h4>
<ol>
<li>è®¡ç®—å­é›†çš„æ€»æ•°ï¼š2^nã€‚</li>
<li>éå†ä» 0 åˆ° 2^n-1 çš„æ¯ä¸ªæ•°å­—ï¼Œå°†å…¶è§†ä¸ºäºŒè¿›åˆ¶æ©ç ã€‚</li>
<li>å¯¹äºæ¯ä¸ªæ©ç ï¼Œæ£€æŸ¥å“ªäº›ä½ä¸º 1ï¼Œé€‰æ‹©å¯¹åº”ä½ç½®çš„å…ƒç´ åŠ å…¥åˆ°å½“å‰å­é›†ä¸­ã€‚</li>
<li>å°†æ„å»ºå¥½çš„å­é›†æ·»åŠ åˆ°ç»“æœä¸­ã€‚</li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šåŸºäºå›æº¯çš„DFSé€’å½’æ³•">æ–¹æ³•äºŒï¼šåŸºäºå›æº¯çš„DFSé€’å½’æ³•</h3>
<p>å›æº¯æ³•æ˜¯ä¸€ç§é€šè¿‡æ¢ç´¢æ‰€æœ‰å¯èƒ½æƒ…å†µæ¥æ‰¾åˆ°æ‰€æœ‰è§£çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é€’å½’åœ°è€ƒè™‘é€‰æ‹©æˆ–ä¸é€‰æ‹©å½“å‰å…ƒç´ æ¥æ„å»ºæ‰€æœ‰å­é›†ã€‚</p>
<p><strong>å…³é”®æ´è§</strong>ï¼šå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹© - é€‰æ‹©å®ƒæˆ–ä¸é€‰æ‹©å®ƒã€‚</p>
<h4 id="å®ç°æ­¥éª¤-2">å®ç°æ­¥éª¤</h4>
<ol>
<li>ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ (DFS) é€’å½’éå†æ‰€æœ‰å¯èƒ½çš„é€‰æ‹©ã€‚</li>
<li>éå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¯¹äºå½“å‰å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š
<ul>
<li>é€‰æ‹©å®ƒï¼Œç„¶åé€’å½’å¤„ç†å‰©ä½™å…ƒç´ </li>
<li>ä¸é€‰æ‹©å®ƒï¼Œé€’å½’å¤„ç†å‰©ä½™å…ƒç´ </li>
</ul>
</li>
<li>å½“æˆ‘ä»¬è€ƒè™‘å®Œæ‰€æœ‰å…ƒç´ åï¼Œå°†å½“å‰æ„å»ºçš„å­é›†æ·»åŠ åˆ°ç»“æœä¸­ã€‚</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>ä¸‹é¢æ˜¯ä¸¤ç§æ–¹æ³•çš„è¯¦ç»†ä»£ç å®ç°ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šåŸºäºä½è¿ç®—çš„è¿­ä»£æ³•-2">æ–¹æ³•ä¸€ï¼šåŸºäºä½è¿ç®—çš„è¿­ä»£æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subsets</span><span class="params">(nums []<span class="type">int</span>)</span></span> (res [][]<span class="type">int</span>) &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    <span class="comment">// éå†ä»0åˆ°2^n-1çš„æ‰€æœ‰æ•°å­—</span></span><br><span class="line">    <span class="keyword">for</span> mask := <span class="number">0</span>; mask &lt; <span class="number">1</span>&lt;&lt;n; mask++ &#123;</span><br><span class="line">        tmp := []<span class="type">int</span>&#123;&#125;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥maskçš„æ¯ä¸€ä½æ˜¯å¦ä¸º1</span></span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœç¬¬iä½ä¸º1ï¼Œåˆ™é€‰æ‹©nums[i]</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1</span>&lt;&lt;i)&amp;mask != <span class="number">0</span> &#123;</span><br><span class="line">                tmp = <span class="built_in">append</span>(tmp, nums[i])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res = <span class="built_in">append</span>(res, tmp)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šåŸºäºå›æº¯çš„DFSé€’å½’æ³•-2">æ–¹æ³•äºŒï¼šåŸºäºå›æº¯çš„DFSé€’å½’æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subsets</span><span class="params">(nums []<span class="type">int</span>)</span></span> (res [][]<span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(fromIndex, length <span class="type">int</span>)</span></span></span><br><span class="line">    <span class="comment">// ä¸´æ—¶æ•°ç»„ï¼Œç”¨äºå­˜å‚¨å½“å‰æ„å»ºçš„å­é›†</span></span><br><span class="line">    tmpArray := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(nums))</span><br><span class="line"></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(fromIndex, length <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ç¡®ä¿ç´¢å¼•ä¸è¶Šç•Œ</span></span><br><span class="line">        <span class="keyword">if</span> fromIndex &gt; <span class="built_in">len</span>(nums) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†å½“å‰å­é›†æ·»åŠ åˆ°ç»“æœä¸­</span></span><br><span class="line">        tmp := <span class="built_in">make</span>([]<span class="type">int</span>, length)</span><br><span class="line">        <span class="built_in">copy</span>(tmp, tmpArray)</span><br><span class="line">        res = <span class="built_in">append</span>(res, tmp)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»fromIndexå¼€å§‹éå†ï¼Œé¿å…é‡å¤</span></span><br><span class="line">        <span class="keyword">for</span> i := fromIndex; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">            tmpArray[length] = nums[i]  <span class="comment">// é€‰æ‹©å½“å‰å…ƒç´ </span></span><br><span class="line">            dfs(i+<span class="number">1</span>, length+<span class="number">1</span>)         <span class="comment">// é€’å½’å¤„ç†ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dfs(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ‰§è¡Œç¤ºä¾‹">æ–¹æ³•æ‰§è¡Œç¤ºä¾‹</h2>
<p>ä»¥è¾“å…¥ <code>nums = [1,2,3]</code> ä¸ºä¾‹ï¼š</p>
<h3 id="æ–¹æ³•ä¸€åˆ†æ">æ–¹æ³•ä¸€åˆ†æ</h3>
<ul>
<li>mask = 0 (000)ï¼šé€‰æ‹© [] â†’ ç©ºé›†</li>
<li>mask = 1 (001)ï¼šé€‰æ‹© [1]</li>
<li>mask = 2 (010)ï¼šé€‰æ‹© [2]</li>
<li>mask = 3 (011)ï¼šé€‰æ‹© [1,2]</li>
<li>mask = 4 (100)ï¼šé€‰æ‹© [3]</li>
<li>mask = 5 (101)ï¼šé€‰æ‹© [1,3]</li>
<li>mask = 6 (110)ï¼šé€‰æ‹© [2,3]</li>
<li>mask = 7 (111)ï¼šé€‰æ‹© [1,2,3]</li>
</ul>
<h3 id="æ–¹æ³•äºŒåˆ†æ">æ–¹æ³•äºŒåˆ†æ</h3>
<p>å›æº¯æ³•çš„æ‰§è¡Œè½¨è¿¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆå§‹çŠ¶æ€ï¼š<code>[]</code></li>
<li>é€‰æ‹© 1ï¼š<code>[1]</code> â†’ é€’å½’ä¸‹å»
<ul>
<li>é€‰æ‹© 2ï¼š<code>[1,2]</code> â†’ é€’å½’ä¸‹å»
<ul>
<li>é€‰æ‹© 3ï¼š<code>[1,2,3]</code> â†’ é€’å½’ç»“æŸï¼Œæ·»åŠ å­é›†</li>
</ul>
</li>
<li>é€‰æ‹© 3ï¼š<code>[1,3]</code> â†’ é€’å½’ç»“æŸï¼Œæ·»åŠ å­é›†</li>
</ul>
</li>
<li>é€‰æ‹© 2ï¼š<code>[2]</code> â†’ é€’å½’ä¸‹å»
<ul>
<li>é€‰æ‹© 3ï¼š<code>[2,3]</code> â†’ é€’å½’ç»“æŸï¼Œæ·»åŠ å­é›†</li>
</ul>
</li>
<li>é€‰æ‹© 3ï¼š<code>[3]</code> â†’ é€’å½’ç»“æŸï¼Œæ·»åŠ å­é›†</li>
</ol>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>ä½è¿ç®—è¿­ä»£æ³•</th>
<th>å›æº¯DFSé€’å½’æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n * 2^n)</td>
<td>O(n * 2^n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç®€æ´ï¼Œç›´è§‚</td>
<td>æ›´çµæ´»ï¼Œé€‚ç”¨äºå…¶ä»–ç»„åˆé—®é¢˜</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>åŸºäºä½è¿ç®—ï¼Œä¸æ˜“æ‰©å±•</td>
<td>é€’å½’å¼€é”€å¯èƒ½è¾ƒå¤§</td>
</tr>
<tr>
<td>ä»£ç å¤æ‚åº¦</td>
<td>è¾ƒä½</td>
<td>ä¸­ç­‰</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p>å¯¹äºä¸¤ç§æ–¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n * 2^n)ï¼š</p>
<ul>
<li>æ–¹æ³•ä¸€ï¼šæˆ‘ä»¬éœ€è¦ç”Ÿæˆ 2^n ä¸ªå­é›†ï¼Œæ¯ä¸ªå­é›†éœ€è¦ O(n) çš„æ—¶é—´æ¥æ£€æŸ¥æ¯ä½å¹¶æ„å»ºã€‚</li>
<li>æ–¹æ³•äºŒï¼šæ€»å…±æœ‰ 2^n ä¸ªå­é›†ï¼Œæ¯ä¸ªå­é›†éœ€è¦ O(n) çš„æ—¶é—´æ¥æ„å»ºã€‚</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<p>ä¸¤ç§æ–¹æ³•çš„ç©ºé—´å¤æ‚åº¦éƒ½ä¸º O(n)ï¼Œä¸è€ƒè™‘è¾“å‡ºç»“æœçš„ç©ºé—´ï¼š</p>
<ul>
<li>æ–¹æ³•ä¸€ï¼šä¸´æ—¶æ•°ç»„ tmp çš„ç©ºé—´ä¸º O(n)ã€‚</li>
<li>æ–¹æ³•äºŒï¼šé€’å½’æ ˆçš„æ·±åº¦æœ€å¤šä¸º O(n)ï¼Œä¸´æ—¶æ•°ç»„ tmpArray çš„ç©ºé—´ä¸º O(n)ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>ç»„åˆé—®é¢˜çš„ä½è¿ç®—æŠ€å·§</strong>ï¼šä½¿ç”¨äºŒè¿›åˆ¶ä½è¡¨ç¤ºé€‰æ‹©çŠ¶æ€æ˜¯è§£å†³ç»„åˆé—®é¢˜çš„æœ‰æ•ˆæŠ€å·§ã€‚</li>
<li><strong>å›æº¯æ³•çš„åº”ç”¨</strong>ï¼šå›æº¯æ³•æ˜¯è§£å†³ç»„åˆã€æ’åˆ—é—®é¢˜çš„é€šç”¨æ–¹æ³•ã€‚</li>
<li><strong>æ•°ç»„å¤åˆ¶çš„æ³¨æ„äº‹é¡¹</strong>ï¼šåœ¨æ„å»ºç»“æœæ—¶ï¼Œéœ€è¦åˆ›å»ºæ–°çš„æ•°ç»„å‰¯æœ¬è€Œä¸æ˜¯ç›´æ¥æ·»åŠ å¼•ç”¨ã€‚</li>
</ol>
<h2 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h2>
<ul>
<li>LeetCode 90: å­é›† IIï¼ˆåŒ…å«é‡å¤å…ƒç´ çš„å­é›†é—®é¢˜ï¼‰</li>
<li>LeetCode 46: å…¨æ’åˆ—</li>
<li>LeetCode 77: ç»„åˆ</li>
</ul>
<p>é€šè¿‡æœ¬é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æŒæ¡ä¸¤ç§ä¸åŒçš„æ€è·¯æ¥è§£å†³å­é›†ç”Ÿæˆé—®é¢˜ï¼Œå¹¶å°†è¿™äº›æ€è·¯åº”ç”¨åˆ°å…¶ä»–ç±»ä¼¼çš„ç»„åˆå’Œæ’åˆ—é—®é¢˜ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›æº¯</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>å›æº¯</tag>
        <tag>æ•°ç»„</tag>
        <tag>ä½è¿ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 790 - å¤šç±³è¯ºå’Œæ‰˜ç±³è¯ºå¹³é“º</title>
    <url>/2025/05/06/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-790-%E5%A4%9A%E7%B1%B3%E8%AF%BA%E5%92%8C%E6%89%98%E7%B1%B3%E8%AF%BA%E5%B9%B3%E9%93%BA/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>æœ‰ä¸¤ç§å½¢çŠ¶çš„ç“·ç –ï¼šä¸€ç§æ˜¯ 2 x 1 çš„å¤šç±³è¯ºå½¢ï¼Œå¦ä¸€ç§æ˜¯å½¢å¦‚ â€œLâ€ çš„æ‰˜ç±³è¯ºå½¢ã€‚ä¸¤ç§å½¢çŠ¶éƒ½å¯ä»¥æ—‹è½¬ã€‚</p>
<p><img src="/2025/05/06/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-790-%E5%A4%9A%E7%B1%B3%E8%AF%BA%E5%92%8C%E6%89%98%E7%B1%B3%E8%AF%BA%E5%B9%B3%E9%93%BA/1746505479685.png" alt="1746505479685"></p>
<p>ç»™å®šæ•´æ•° n ï¼Œè¿”å›å¯ä»¥å¹³é“º 2 x n çš„é¢æ¿çš„æ–¹æ³•çš„æ•°é‡ã€‚è¿”å›å¯¹ 109 + 7 å–æ¨¡ çš„å€¼ã€‚</p>
<p>å¹³é“ºæŒ‡çš„æ˜¯æ¯ä¸ªæ­£æ–¹å½¢éƒ½å¿…é¡»æœ‰ç“·ç –è¦†ç›–ã€‚ä¸¤ä¸ªå¹³é“ºä¸åŒï¼Œå½“ä¸”ä»…å½“é¢æ¿ä¸Šæœ‰å››ä¸ªæ–¹å‘ä¸Šçš„ç›¸é‚»å•å…ƒä¸­çš„ä¸¤ä¸ªï¼Œä½¿å¾—æ°å¥½æœ‰ä¸€ä¸ªå¹³é“ºæœ‰ä¸€ä¸ªç“·ç –å æ®ä¸¤ä¸ªæ­£æ–¹å½¢ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n = 3</span><br><span class="line">è¾“å‡º: 5</span><br><span class="line">è§£é‡Š: äº”ç§ä¸åŒçš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºã€‚</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯äº”ç§å¹³é“ºæ–¹å¼çš„ç¤ºæ„å›¾ï¼š</p>
<p><img src="/2025/05/06/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-790-%E5%A4%9A%E7%B1%B3%E8%AF%BA%E5%92%8C%E6%89%98%E7%B1%B3%E8%AF%BA%E5%B9%B3%E9%93%BA/1746505493673.png" alt="1746505493673"></p>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: n = 1</span><br><span class="line">è¾“å‡º: 1</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>1 &lt;= n &lt;= 1000</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜ç›®æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>åŠ¨æ€è§„åˆ’</strong>é—®é¢˜ï¼Œå…³é”®åœ¨äºå¦‚ä½•å®šä¹‰çŠ¶æ€å’Œè½¬ç§»æ–¹ç¨‹ã€‚</p>
<p>é¦–å…ˆè€ƒè™‘æˆ‘ä»¬è¦é“ºçš„æ˜¯ä¸€ä¸ª 2 x n çš„é¢æ¿ï¼Œæ¯ä¸€åˆ—çš„çŠ¶æ€å¯ä»¥æœ‰å››ç§æƒ…å†µï¼š</p>
<ol>
<li>çŠ¶æ€ 0ï¼šå½“å‰åˆ—æ²¡æœ‰è¢«è¦†ç›–</li>
<li>çŠ¶æ€ 1ï¼šå½“å‰åˆ—çš„ä¸Šæ–¹æ ¼å­è¢«è¦†ç›–ï¼Œä¸‹æ–¹æ ¼å­æœªè¢«è¦†ç›–</li>
<li>çŠ¶æ€ 2ï¼šå½“å‰åˆ—çš„ä¸‹æ–¹æ ¼å­è¢«è¦†ç›–ï¼Œä¸Šæ–¹æ ¼å­æœªè¢«è¦†ç›–</li>
<li>çŠ¶æ€ 3ï¼šå½“å‰åˆ—çš„ä¸¤ä¸ªæ ¼å­éƒ½è¢«è¦†ç›–</li>
</ol>
<p>å¯¹äºçŠ¶æ€ 1 å’Œ 2ï¼Œæ„å‘³ç€æœ‰ä¸€ä¸ª L å½¢çŠ¶çš„ç“·ç –çš„ä¸€éƒ¨åˆ†ä»å‰ä¸€åˆ—å»¶ä¼¸åˆ°å½“å‰åˆ—ä¸­çš„ä¸€ä¸ªæ ¼å­ã€‚</p>
<p>å®šä¹‰ dp[i][j] è¡¨ç¤ºé“ºåˆ°ç¬¬ i åˆ—ï¼Œå½“å‰åˆ—çš„çŠ¶æ€ä¸º j çš„æ–¹æ¡ˆæ•°é‡ã€‚</p>
<h3 id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h3>
<p>è§‚å¯Ÿä¸åŒçŠ¶æ€ä¹‹é—´çš„è½¬ç§»å¯ä»¥å¾—åˆ°ï¼š</p>
<ol>
<li>$dp[i][0]$ï¼ˆå½“å‰åˆ—éƒ½æ²¡æœ‰è¢«è¦†ç›–ï¼‰åªèƒ½ä» $dp[i-1][3]$ è½¬ç§»è€Œæ¥ï¼Œå› ä¸ºå‰ä¸€åˆ—å¿…é¡»å®Œå…¨è¦†ç›–æ‰èƒ½å¯¼è‡´å½“å‰åˆ—éƒ½æ²¡æœ‰è¦†ç›–ã€‚</li>
<li>$dp[i][1]$ï¼ˆå½“å‰åˆ—ä¸Šæ–¹è¢«è¦†ç›–ï¼‰å¯ä»¥ä» $dp[i-1][0]$ å’Œ $dp[i-1][2]$ è½¬ç§»è€Œæ¥ã€‚</li>
<li>$dp[i][2]$ï¼ˆå½“å‰åˆ—ä¸‹æ–¹è¢«è¦†ç›–ï¼‰å¯ä»¥ä» $dp[i-1][0]$ å’Œ $dp[i-1][1]$ è½¬ç§»è€Œæ¥ã€‚</li>
<li>$dp[i][3]$ï¼ˆå½“å‰åˆ—éƒ½è¢«è¦†ç›–ï¼‰å¯ä»¥ä»æ‰€æœ‰å››ç§çŠ¶æ€ $dp[i-1][0]$ã€$dp[i-1][1]$ã€$dp[i-1][2]$ å’Œ $dp[i-1][3]$ è½¬ç§»è€Œæ¥ã€‚</li>
</ol>
<p>è½¬ç§»æ–¹ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>$dp[i][0] = dp[i-1][3]$</li>
<li>$dp[i][1] = dp[i-1][0] + dp[i-1][2]$</li>
<li>$dp[i][2] = dp[i-1][0] + dp[i-1][1]$</li>
<li>$dp[i][3] = dp[i-1][0] + dp[i-1][1] + dp[i-1][2] + dp[i-1][3]$</li>
</ul>
<h3 id="åˆå§‹çŠ¶æ€è®¾ç½®">åˆå§‹çŠ¶æ€è®¾ç½®</h3>
<p>å¯¹äº $i = 0$ çš„æƒ…å†µï¼ˆå³ä¸€ä¸ª&quot;è™šæ‹Ÿ&quot;çš„å‰å¯¼åˆ—ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®åˆé€‚çš„åˆå§‹å€¼ï¼š</p>
<ul>
<li>$dp[0][0] = 0$</li>
<li>$dp[0][1] = 0$</li>
<li>$dp[0][2] = 0$</li>
<li>$dp[0][3] = 1$ï¼ˆè¡¨ç¤ºå‰å¯¼åˆ—å·²å®Œå…¨è¦†ç›–ï¼Œè¿™æ˜¯å”¯ä¸€æœ‰æ•ˆçš„å¼€å§‹çŠ¶æ€ï¼‰</li>
</ul>
<p>æœ€ç»ˆï¼Œ$dp[n][3]$ å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç­”æ¡ˆï¼Œè¡¨ç¤ºé“ºåˆ°ç¬¬ $n$ åˆ—ä¸”å…¨éƒ¨è¦†ç›–çš„æ–¹æ¡ˆæ•°ã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>åœ¨å®ç°ä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œéœ€è¦å¯¹ $10^9 + 7$ å–æ¨¡</li>
<li>æˆ‘ä»¬éœ€è¦ç‰¹åˆ«å¤„ç† $n &lt; 3$ çš„è¾¹ç•Œæƒ…å†µ</li>
<li>åŠ¨æ€è§„åˆ’æ•°ç»„éœ€è¦åˆå§‹åŒ–ä¸º $(n+1) \times 4$ çš„å¤§å°</li>
</ol>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼ˆ$n = 3$ï¼‰æ¥è¯´æ˜ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p>åˆå§‹çŠ¶æ€ï¼š$dp[0][3] = 1$ï¼Œå…¶ä»–åˆå§‹å€¼å‡ä¸º $0$</p>
<p>ç¬¬ä¸€åˆ—ï¼ˆ$i = 1$ï¼‰ï¼š</p>
<ul>
<li>$dp[1][0] = dp[0][3] = 1$</li>
<li>$dp[1][1] = dp[0][0] + dp[0][2] = 0$</li>
<li>$dp[1][2] = dp[0][0] + dp[0][1] = 0$</li>
<li>$dp[1][3] = dp[0][0] + dp[0][1] + dp[0][2] + dp[0][3] = 1$</li>
</ul>
<p>ç¬¬äºŒåˆ—ï¼ˆ$i = 2$ï¼‰ï¼š</p>
<ul>
<li>$dp[2][0] = dp[1][3] = 1$</li>
<li>$dp[2][1] = dp[1][0] + dp[1][2] = 1$</li>
<li>$dp[2][2] = dp[1][0] + dp[1][1] = 1$</li>
<li>$dp[2][3] = dp[1][0] + dp[1][1] + dp[1][2] + dp[1][3] = 3$</li>
</ul>
<p>ç¬¬ä¸‰åˆ—ï¼ˆ$i = 3$ï¼‰ï¼š</p>
<ul>
<li>$dp[3][0] = dp[2][3] = 3$</li>
<li>$dp[3][1] = dp[2][0] + dp[2][2] = 2$</li>
<li>$dp[3][2] = dp[2][0] + dp[2][1] = 2$</li>
<li>$dp[3][3] = dp[2][0] + dp[2][1] + dp[2][2] + dp[2][3] = 5$</li>
</ul>
<p>å› æ­¤ï¼Œå¯¹äº $n = 3$ï¼Œç­”æ¡ˆæ˜¯ $dp[3][3] = 5$ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mod = <span class="number">1e9</span> + <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numTilings</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// ç¡®ä¿æ•°ç»„å¤§å°è¶³å¤Ÿï¼Œè‡³å°‘ä¸º4</span></span><br><span class="line">    total := n + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> total &lt; <span class="number">4</span> &#123;</span><br><span class="line">        total = <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºdpæ•°ç»„</span></span><br><span class="line">    dp := <span class="built_in">make</span>([][]<span class="type">int</span>, total)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; total; i++ &#123;</span><br><span class="line">        dp[i] = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">4</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®åˆå§‹çŠ¶æ€</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">2</span>] = <span class="number">0</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">3</span>] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çŠ¶æ€è½¬ç§»</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = dp[i<span class="number">-1</span>][<span class="number">3</span>]</span><br><span class="line">        dp[i][<span class="number">1</span>] = (dp[i<span class="number">-1</span>][<span class="number">0</span>] + dp[i<span class="number">-1</span>][<span class="number">2</span>]) % mod</span><br><span class="line">        dp[i][<span class="number">2</span>] = (dp[i<span class="number">-1</span>][<span class="number">0</span>] + dp[i<span class="number">-1</span>][<span class="number">1</span>]) % mod</span><br><span class="line">        dp[i][<span class="number">3</span>] = (dp[i<span class="number">-1</span>][<span class="number">0</span>] + dp[i<span class="number">-1</span>][<span class="number">1</span>] + dp[i<span class="number">-1</span>][<span class="number">2</span>] + dp[i<span class="number">-1</span>][<span class="number">3</span>]) % mod</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n][<span class="number">3</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="çŸ©é˜µå¿«é€Ÿå¹‚è§£æ³•">çŸ©é˜µå¿«é€Ÿå¹‚è§£æ³•</h2>
<p>ä»”ç»†è§‚å¯ŸçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ªçº¿æ€§é€’æ¨å…³ç³»ã€‚å½“æˆ‘ä»¬é¢å¯¹è¿™ç±»é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨çŸ©é˜µå¿«é€Ÿå¹‚æ¥ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ã€‚</p>
<h3 id="æ¨å¯¼è½¬ç§»çŸ©é˜µ">æ¨å¯¼è½¬ç§»çŸ©é˜µ</h3>
<p>æ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p>
<ul>
<li>$dp[i][0] = dp[i-1][3]$</li>
<li>$dp[i][1] = dp[i-1][0] + dp[i-1][2]$</li>
<li>$dp[i][2] = dp[i-1][0] + dp[i-1][1]$</li>
<li>$dp[i][3] = dp[i-1][0] + dp[i-1][1] + dp[i-1][2] + dp[i-1][3]$</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥å†™æˆçŸ©é˜µå½¢å¼ï¼š</p>
<p>$$<br>
\begin{pmatrix}<br>
dp[i][0] \<br>
dp[i][1] \<br>
dp[i][2] \<br>
dp[i][3]<br>
\end{pmatrix} =<br>
\begin{pmatrix}<br>
0 &amp; 0 &amp; 0 &amp; 1 \<br>
1 &amp; 0 &amp; 1 &amp; 0 \<br>
1 &amp; 1 &amp; 0 &amp; 0 \<br>
1 &amp; 1 &amp; 1 &amp; 1<br>
\end{pmatrix} \times<br>
\begin{pmatrix}<br>
dp[i-1][0] \<br>
dp[i-1][1] \<br>
dp[i-1][2] \<br>
dp[i-1][3]<br>
\end{pmatrix}<br>
$$</p>
<p>è®¾ä¸Šè¿°çŸ©é˜µä¸º $M$ï¼Œåˆ™æœ‰ï¼š</p>
<p>$$<br>
\begin{pmatrix}<br>
dp[n][0] \<br>
dp[n][1] \<br>
dp[n][2] \<br>
dp[n][3]<br>
\end{pmatrix} =<br>
\begin{pmatrix}<br>
0 &amp; 0 &amp; 0 &amp; 1 \<br>
1 &amp; 0 &amp; 1 &amp; 0 \<br>
1 &amp; 1 &amp; 0 &amp; 0 \<br>
1 &amp; 1 &amp; 1 &amp; 1<br>
\end{pmatrix}^n \times<br>
\begin{pmatrix}<br>
dp[0][0] \<br>
dp[0][1] \<br>
dp[0][2] \<br>
dp[0][3]<br>
\end{pmatrix} =<br>
M^n \times<br>
\begin{pmatrix}<br>
0 \<br>
0 \<br>
0 \<br>
1<br>
\end{pmatrix}<br>
$$</p>
<h3 id="ä½¿ç”¨çŸ©é˜µå¿«é€Ÿå¹‚è§£é¢˜">ä½¿ç”¨çŸ©é˜µå¿«é€Ÿå¹‚è§£é¢˜</h3>
<p>çŸ©é˜µå¿«é€Ÿå¹‚çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°† $M^n$ çš„è®¡ç®—æ—¶é—´ä» $O(n)$ é™ä½åˆ° $O(\log n)$ï¼Œç±»ä¼¼äºæ•´æ•°çš„å¿«é€Ÿå¹‚ç®—æ³•ã€‚è®¡ç®— $M^n$ çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆå§‹åŒ–ç»“æœçŸ©é˜µ $R$ ä¸ºå•ä½çŸ©é˜µ $I$</li>
<li>å½“ $n &gt; 0$ æ—¶ï¼š
<ul>
<li>å¦‚æœ $n$ æ˜¯å¥‡æ•°ï¼Œ$R = R \times M$</li>
<li>$M = M \times M$</li>
<li>$n = \lfloor n/2 \rfloor$</li>
</ul>
</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numTilings</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> mod = <span class="number">1e9</span> + <span class="number">7</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®šä¹‰è½¬ç§»çŸ©é˜µ</span></span><br><span class="line">    m := [][]<span class="type">int</span>&#123;</span><br><span class="line">        &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡ç®—M^(n-1)</span></span><br><span class="line">    res := matrixPow(m, n<span class="number">-1</span>, mod)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹çŠ¶æ€ä¸º[0,0,0,1]ï¼Œç»è¿‡çŸ©é˜µä¹˜æ³•åç¬¬4ä¸ªå…ƒç´ å³ä¸ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="comment">// ç”±äºæˆ‘ä»¬éœ€è¦è®¡ç®—çš„æ˜¯dp[n][3]ï¼Œå¯¹åº”åˆå§‹çŠ¶æ€ä¹˜ä»¥çŸ©é˜µM^nåçš„ç¬¬4è¡Œ</span></span><br><span class="line">    <span class="keyword">return</span> (res[<span class="number">3</span>][<span class="number">0</span>]*<span class="number">0</span> + res[<span class="number">3</span>][<span class="number">1</span>]*<span class="number">0</span> + res[<span class="number">3</span>][<span class="number">2</span>]*<span class="number">0</span> + res[<span class="number">3</span>][<span class="number">3</span>]*<span class="number">1</span>) % mod</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŸ©é˜µå¿«é€Ÿå¹‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">matrixPow</span><span class="params">(a [][]<span class="type">int</span>, n <span class="type">int</span>, mod <span class="type">int</span>)</span></span> [][]<span class="type">int</span> &#123;</span><br><span class="line">    size := <span class="built_in">len</span>(a)</span><br><span class="line">    res := <span class="built_in">make</span>([][]<span class="type">int</span>, size)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; size; i++ &#123;</span><br><span class="line">        res[i] = <span class="built_in">make</span>([]<span class="type">int</span>, size)</span><br><span class="line">        res[i][i] = <span class="number">1</span> <span class="comment">// åˆå§‹åŒ–ä¸ºå•ä½çŸ©é˜µ</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¿«é€Ÿå¹‚è®¡ç®—</span></span><br><span class="line">    <span class="keyword">for</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> n&amp;<span class="number">1</span> == <span class="number">1</span> &#123;</span><br><span class="line">            res = matrixMultiply(res, a, mod)</span><br><span class="line">        &#125;</span><br><span class="line">        a = matrixMultiply(a, a, mod)</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŸ©é˜µä¹˜æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">matrixMultiply</span><span class="params">(a, b [][]<span class="type">int</span>, mod <span class="type">int</span>)</span></span> [][]<span class="type">int</span> &#123;</span><br><span class="line">    size := <span class="built_in">len</span>(a)</span><br><span class="line">    result := <span class="built_in">make</span>([][]<span class="type">int</span>, size)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; size; i++ &#123;</span><br><span class="line">        result[i] = <span class="built_in">make</span>([]<span class="type">int</span>, size)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; size; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; size; j++ &#123;</span><br><span class="line">            <span class="keyword">for</span> k := <span class="number">0</span>; k &lt; size; k++ &#123;</span><br><span class="line">                result[i][j] = (result[i][j] + a[i][k]*b[k][j]) % mod</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>åŠ¨æ€è§„åˆ’æ–¹æ³•</th>
<th>çŸ©é˜µå¿«é€Ÿå¹‚æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>$O(\log n)$</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>$O(n)$ æˆ– $O(1)$ï¼ˆä¼˜åŒ–åï¼‰</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç®€å•ï¼Œæ€è·¯æ¸…æ™°</td>
<td>å¤„ç†å¤§æ•°æ®æ—¶æ•ˆç‡æé«˜</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å¯¹äº $n$ å¾ˆå¤§æ—¶æ•ˆç‡ä½</td>
<td>å®ç°å¤æ‚ï¼Œéœ€è¦çŸ©é˜µæ“ä½œç›¸å…³çŸ¥è¯†</td>
</tr>
<tr>
<td>é€‚ç”¨æƒ…æ™¯</td>
<td>$n$ è¾ƒå°æˆ–éœ€è¦ä¸­é—´çŠ¶æ€</td>
<td>$n$ éå¸¸å¤§ä¸”åªéœ€è¦æœ€ç»ˆç»“æœ</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h3 id="æ—¶é—´å¤æ‚åº¦åˆ†æ">æ—¶é—´å¤æ‚åº¦åˆ†æ</h3>
<ol>
<li><strong>åŠ¨æ€è§„åˆ’æ–¹æ³•</strong>ï¼šæ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä»1åˆ°néå†ä¸€æ¬¡ã€‚</li>
<li><strong>çŸ©é˜µå¿«é€Ÿå¹‚æ–¹æ³•</strong>ï¼šæ—¶é—´å¤æ‚åº¦ä¸º $O(\log n)$ï¼Œç”±äºçŸ©é˜µå¿«é€Ÿå¹‚çš„æ€§è´¨ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œçº¦ $\log n$ æ¬¡çŸ©é˜µä¹˜æ³•æ“ä½œã€‚</li>
</ol>
<p>å½“ $n$ éå¸¸å¤§æ—¶ï¼ˆæ¯”å¦‚ $n=10^9$ï¼‰ï¼ŒåŠ¨æ€è§„åˆ’æ–¹æ³•ä¼šè¶…æ—¶ï¼Œè€ŒçŸ©é˜µå¿«é€Ÿå¹‚æ–¹æ³•ä»ç„¶å¯ä»¥é«˜æ•ˆè®¡ç®—ç»“æœã€‚</p>
<h3 id="ç©ºé—´ä¼˜åŒ–">ç©ºé—´ä¼˜åŒ–</h3>
<p>å¯¹äºåŠ¨æ€è§„åˆ’æ–¹æ³•ï¼Œç”±äºæ¯ä¸€æ­¥åªä¾èµ–å‰ä¸€æ­¥çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ä¸ºO(1)ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numTilingsOptimized</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> mod = <span class="number">1e9</span> + <span class="number">7</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªä¿å­˜å‰ä¸€åˆ—çš„çŠ¶æ€</span></span><br><span class="line">    dp := [<span class="number">4</span>]<span class="type">int</span>&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;</span><br><span class="line">        newDp := [<span class="number">4</span>]<span class="type">int</span>&#123;&#125;</span><br><span class="line">        newDp[<span class="number">0</span>] = dp[<span class="number">3</span>]</span><br><span class="line">        newDp[<span class="number">1</span>] = (dp[<span class="number">0</span>] + dp[<span class="number">2</span>]) % mod</span><br><span class="line">        newDp[<span class="number">2</span>] = (dp[<span class="number">0</span>] + dp[<span class="number">1</span>]) % mod</span><br><span class="line">        newDp[<span class="number">3</span>] = (dp[<span class="number">0</span>] + dp[<span class="number">1</span>] + dp[<span class="number">2</span>] + dp[<span class="number">3</span>]) % mod</span><br><span class="line">        dp = newDp</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">3</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯ç»™å®šçš„æ•´æ•°ã€‚æˆ‘ä»¬åªéœ€è¦éå†ä¸€æ¬¡ä» 1 åˆ° $n$ çš„æ‰€æœ‰åˆ—ï¼Œå¯¹æ¯ä¸€åˆ—è¿›è¡Œå¸¸æ•°æ—¶é—´çš„æ“ä½œã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n)$ï¼Œéœ€è¦ä¸€ä¸ª $(n+1) \times 4$ çš„äºŒç»´æ•°ç»„æ¥å­˜å‚¨åŠ¨æ€è§„åˆ’çš„çŠ¶æ€ã€‚</li>
</ul>
<h2 id="ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦">ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦</h2>
<p>æ³¨æ„åˆ°æ¯ä¸€åˆ—çš„çŠ¶æ€åªä¸å‰ä¸€åˆ—çš„çŠ¶æ€æœ‰å…³ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ»šåŠ¨æ•°ç»„ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦è‡³ $O(1)$ã€‚è¿™é‡Œä¸ºäº†ä»£ç æ¸…æ™°ï¼Œä¿ç•™äº†åŸå§‹å®ç°ã€‚</p>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>çŠ¶æ€è¡¨ç¤ºçš„é‡è¦æ€§</strong>ï¼šè¿™é“é¢˜çš„å…³é”®åœ¨äºå¦‚ä½•è¡¨ç¤ºæ¯ä¸€åˆ—çš„çŠ¶æ€ï¼Œä½¿å¾—çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ¸…æ™°æ˜äº†ã€‚</li>
<li><strong>åŠ¨æ€è§„åˆ’çŠ¶æ€å®šä¹‰</strong>ï¼šæœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å››ç§çŠ¶æ€æ¥æè¿°æ¯ä¸€åˆ—çš„è¦†ç›–æƒ…å†µï¼Œè¿™æ˜¯è§£å†³æ­¤ç±»ç»„åˆè®¡æ•°é—®é¢˜çš„å…¸å‹æ–¹æ³•ã€‚</li>
<li><strong>åˆå§‹çŠ¶æ€çš„è®¾ç½®</strong>ï¼šå¯¹äºåŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œæ­£ç¡®è®¾ç½®åˆå§‹çŠ¶æ€å¯¹äºå¾—åˆ°æ­£ç¡®ç»“æœè‡³å…³é‡è¦ã€‚</li>
<li><strong>å–æ¨¡è¿ç®—</strong>ï¼šå¯¹äºå¯èƒ½äº§ç”Ÿå¤§æ•°çš„é—®é¢˜ï¼Œéœ€è¦åœ¨æ¯ä¸€æ­¥éƒ½è¿›è¡Œå–æ¨¡æ“ä½œï¼Œè€Œä¸æ˜¯åªåœ¨æœ€åå–æ¨¡ã€‚</li>
<li><strong>çº¿æ€§é€’æ¨å…³ç³»è¯†åˆ«</strong>ï¼šå½“å‘ç°çŠ¶æ€è½¬ç§»å­˜åœ¨çº¿æ€§é€’æ¨å…³ç³»æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–ã€‚</li>
<li><strong>ç®—æ³•é€‰æ‹©çš„æƒè¡¡</strong>ï¼šæ ¹æ®é—®é¢˜è§„æ¨¡å’Œéœ€æ±‚ï¼Œåœ¨åŠ¨æ€è§„åˆ’ä¸çŸ©é˜µå¿«é€Ÿå¹‚ä¹‹é—´åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚</li>
</ol>
<h2 id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜</h2>
<ul>
<li>LeetCode 70: çˆ¬æ¥¼æ¢¯ (ç±»ä¼¼çš„åŠ¨æ€è§„åˆ’é—®é¢˜)</li>
<li>LeetCode 62: ä¸åŒè·¯å¾„ (ç½‘æ ¼ç±»åŠ¨æ€è§„åˆ’)</li>
<li>LeetCode 91: è§£ç æ–¹æ³• (çŠ¶æ€è½¬ç§»é—®é¢˜)</li>
<li>LeetCode 509: æ–æ³¢é‚£å¥‘æ•° (å¯ç”¨çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–)</li>
<li>LeetCode 1220: ç»Ÿè®¡å…ƒéŸ³å­—æ¯åºåˆ—çš„æ•°ç›® (çŸ©é˜µå¿«é€Ÿå¹‚åº”ç”¨)</li>
</ul>
<p>é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ åˆ°å¦‚ä½•ä½¿ç”¨åŠ¨æ€è§„åˆ’è§£å†³å¤æ‚çš„ç»„åˆè®¡æ•°é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é‚£äº›æ¶‰åŠåˆ°å¤šç§å¯èƒ½çŠ¶æ€çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿäº†è§£åˆ°å½“çŠ¶æ€è½¬ç§»å‘ˆçº¿æ€§é€’æ¨å…³ç³»æ—¶ï¼ŒçŸ©é˜µå¿«é€Ÿå¹‚æ˜¯ä¸€ç§å¼ºå¤§çš„ä¼˜åŒ–å·¥å…·ï¼Œèƒ½å¤Ÿå°†æ—¶é—´å¤æ‚åº¦ä» $O(n)$ é™ä½åˆ° $O(\log n)$ï¼Œè¿™åœ¨å¤„ç†å¤§è§„æ¨¡è¾“å…¥æ—¶å°¤ä¸ºé‡è¦ã€‚</p>
<h2 id="çŸ©é˜µå¿«é€Ÿå¹‚è§£æ³•çš„æ•°å­¦è¯æ˜">çŸ©é˜µå¿«é€Ÿå¹‚è§£æ³•çš„æ•°å­¦è¯æ˜</h2>
<p>çŸ©é˜µå¿«é€Ÿå¹‚çš„æ­£ç¡®æ€§åŸºäºçŸ©é˜µä¹˜æ³•çš„ç»“åˆå¾‹ï¼š$(A \times B) \times C = A \times (B \times C)$ã€‚</p>
<p>å¯¹äºè®¡ç®— $M^n$ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶åˆ†è§£çš„æ€æƒ³ï¼š<br>
$n = b_k 2^k + b_{k-1} 2^{k-1} + \ldots + b_1 2^1 + b_0 2^0$ï¼Œå…¶ä¸­ $b_i \in {0, 1}$</p>
<p>åˆ™ $M^n = M^{b_k 2^k} \times M^{b_{k-1} 2^{k-1}} \times \ldots \times M^{b_1 2^1} \times M^{b_0 2^0}$</p>
<p>ä¾‹å¦‚ï¼Œ$M^{11} = M^8 \times M^2 \times M^1$ï¼Œå› ä¸º $11 = 1011_2 = 2^3 + 2^1 + 2^0$</p>
<p>é€šè¿‡é¢„è®¡ç®— $M^1, M^2, M^4, M^8, \ldots, M^{2^k}$ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ $O(\log n)$ çš„æ—¶é—´å†…è®¡ç®— $M^n$ã€‚</p>
<p>è€Œè®¡ç®— $M^{2^i}$ ä¹Ÿéå¸¸ç®€å•ï¼š$M^{2^i} = M^{2^{i-1}} \times M^{2^{i-1}}$</p>
<p>è¿™ç§ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Function MatrixPow(M, n):</span><br><span class="line">    R = I  // å•ä½çŸ©é˜µ</span><br><span class="line">    while n &gt; 0:</span><br><span class="line">        if n is odd:</span><br><span class="line">            R = R Ã— M</span><br><span class="line">        M = M Ã— M</span><br><span class="line">        n = n / 2</span><br><span class="line">    return R</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°† $O(n)$ æ¬¡çŸ©é˜µä¹˜æ³•ä¼˜åŒ–è‡³ $O(\log n)$ æ¬¡ï¼Œæå¤§æé«˜äº†ç®—æ³•æ•ˆç‡ã€‚</p>
<h3 id="çŸ©é˜µå¿«é€Ÿå¹‚çš„å®é™…åº”ç”¨">çŸ©é˜µå¿«é€Ÿå¹‚çš„å®é™…åº”ç”¨</h3>
<p>çŸ©é˜µå¿«é€Ÿå¹‚åœ¨è®¡ç®—çº¿æ€§é€’æ¨å…³ç³»æ—¶éå¸¸æœ‰ç”¨ã€‚é™¤äº†æœ¬é¢˜ä¹‹å¤–ï¼Œå®ƒè¿˜å¯ä»¥åº”ç”¨äºï¼š</p>
<ol>
<li>æ–æ³¢é‚£å¥‘æ•°åˆ—è®¡ç®—ï¼š$F_n = F_{n-1} + F_{n-2}$</li>
<li>è®¡ç®—ä¸€èˆ¬å½¢å¼çš„çº¿æ€§é€’æ¨å…³ç³»ï¼š$x_n = a_1 x_{n-1} + a_2 x_{n-2} + \ldots + a_k x_{n-k}$</li>
<li>æŸäº›å›¾è®ºé—®é¢˜ï¼Œå¦‚è®¡ç®—ä»é¡¶ç‚¹ $i$ åˆ°é¡¶ç‚¹ $j$ é•¿åº¦ä¸º $k$ çš„è·¯å¾„æ•°é‡</li>
</ol>
<p>åœ¨è¿™äº›åº”ç”¨ä¸­ï¼ŒçŸ©é˜µå¿«é€Ÿå¹‚éƒ½å¯ä»¥å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä» $O(n)$ ä¼˜åŒ–è‡³ $O(\log n)$ï¼Œç‰¹åˆ«æ˜¯å½“ $n$ å¾ˆå¤§æ—¶ï¼Œè¿™ç§ä¼˜åŒ–ä¼šå¸¦æ¥å·¨å¤§çš„æ€§èƒ½æå‡ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>âŒé”™é¢˜é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 131 - åˆ†å‰²å›æ–‡ä¸²ï¼ˆPalindrome Partitioningï¼‰</title>
    <url>/2025/05/06/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-131-%E5%88%86%E5%89%B2%E5%9B%9E%E6%96%87%E4%B8%B2/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œè¯·ä½ å°† <code>s</code> åˆ†å‰²æˆä¸€äº›å­ä¸²ï¼Œä½¿æ¯ä¸ªå­ä¸²éƒ½æ˜¯<strong>å›æ–‡ä¸²</strong>ã€‚è¿”å› <code>s</code> æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚</p>
<p><strong>å›æ–‡ä¸²</strong>æ˜¯æ­£ç€è¯»å’Œåç€è¯»éƒ½ä¸€æ ·çš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼š">ç¤ºä¾‹ 1ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;aab&quot;</span><br><span class="line">è¾“å‡ºï¼š[[&quot;a&quot;,&quot;a&quot;,&quot;b&quot;],[&quot;aa&quot;,&quot;b&quot;]]</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2ï¼š">ç¤ºä¾‹ 2ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;a&quot;</span><br><span class="line">è¾“å‡ºï¼š[[&quot;a&quot;]]</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶ï¼š">çº¦æŸæ¡ä»¶ï¼š</h3>
<ul>
<li>1 &lt;= s.length &lt;= 16</li>
<li>s ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„æ ¸å¿ƒæ€è·¯æ˜¯ä½¿ç”¨<strong>å›æº¯ç®—æ³•</strong>æ¥æšä¸¾æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦åˆ¤æ–­æ¯ä¸ªå­ä¸²æ˜¯å¦ä¸ºå›æ–‡ä¸²ã€‚ä¸ºäº†é«˜æ•ˆåˆ¤æ–­å­ä¸²æ˜¯å¦ä¸ºå›æ–‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§ä¼˜åŒ–æ–¹æ³•ï¼š</p>
<ol>
<li><strong>é¢„å¤„ç†æ³•</strong>ï¼šæå‰è®¡ç®—å‡ºæ‰€æœ‰å­ä¸²æ˜¯å¦ä¸ºå›æ–‡ï¼Œä½¿ç”¨åŠ¨æ€è§„åˆ’è‡ªåº•å‘ä¸Šå¡«è¡¨</li>
<li><strong>è®°å¿†åŒ–æœç´¢æ³•</strong>ï¼šä½¿ç”¨è‡ªé¡¶å‘ä¸‹çš„è®°å¿†åŒ–æœç´¢ï¼ŒæŒ‰éœ€è®¡ç®—å­ä¸²æ˜¯å¦ä¸ºå›æ–‡</li>
</ol>
<p>ä¸¤ç§æ–¹æ³•éƒ½ç»“åˆå›æº¯ç®—æ³•æ¥æšä¸¾æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚ä¸‹é¢åˆ†åˆ«è¯¦ç»†ä»‹ç»è¿™ä¸¤ç§è§£æ³•ã€‚</p>
<h2 id="æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’é¢„å¤„ç†-å›æº¯">æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’é¢„å¤„ç† + å›æº¯</h2>
<h3 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h3>
<p>è¿™ä¸ªæ–¹æ³•åˆ†ä¸ºä¸¤ä¸ªä¸»è¦æ­¥éª¤ï¼š</p>
<ol>
<li>
<p><strong>é¢„å¤„ç†å›æ–‡åˆ¤æ–­</strong>ï¼šä½¿ç”¨åŠ¨æ€è§„åˆ’é¢„å…ˆè®¡ç®—å‡ºå­—ç¬¦ä¸² <code>s</code> çš„æ‰€æœ‰å­ä¸²æ˜¯å¦ä¸ºå›æ–‡</p>
<ul>
<li>å®šä¹‰ <code>isPalindrome[i][j]</code> è¡¨ç¤º <code>s[i:j+1]</code> æ˜¯å¦ä¸ºå›æ–‡ä¸²</li>
<li>å•ä¸ªå­—ç¬¦ä¸€å®šæ˜¯å›æ–‡ï¼š<code>isPalindrome[i][i] = true</code></li>
<li>å¯¹äºé•¿åº¦å¤§äº1çš„å­ä¸² <code>s[i:j+1]</code>ï¼Œå½“ä¸”ä»…å½“ <code>s[i] == s[j]</code> ä¸” <code>s[i+1:j]</code> ä¸ºå›æ–‡ä¸²æ—¶ï¼Œè¯¥å­ä¸²æ‰æ˜¯å›æ–‡</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨å›æº¯ç”Ÿæˆæ‰€æœ‰åˆ†å‰²æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>ä»å­—ç¬¦ä¸²èµ·å§‹ä½ç½®å¼€å§‹ï¼Œå°è¯•ä¸åŒçš„åˆ†å‰²ç‚¹</li>
<li>å½“æ‰¾åˆ°ä¸€ä¸ªå›æ–‡å­ä¸²æ—¶ï¼Œå°†å…¶åŠ å…¥å½“å‰è·¯å¾„ï¼Œç„¶åç»§ç»­å¤„ç†å‰©ä½™éƒ¨åˆ†</li>
<li>å½“å¤„ç†åˆ°å­—ç¬¦ä¸²æœ«å°¾æ—¶ï¼Œå°†å½“å‰è·¯å¾„åŠ å…¥ç»“æœé›†</li>
<li>å›æº¯æ—¶ç§»é™¤æœ€åæ·»åŠ çš„å­ä¸²ï¼Œå°è¯•å…¶ä»–å¯èƒ½çš„åˆ†å‰²ç‚¹</li>
</ul>
</li>
</ol>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">partition</span><span class="params">(s <span class="type">string</span>)</span></span> [][]<span class="type">string</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(s)</span><br><span class="line">    <span class="comment">// isPalindrome[i][j] è¡¨ç¤º s[i:j+1] æ˜¯å¦ä¸ºå›æ–‡ä¸²</span></span><br><span class="line">    isPalindrome := <span class="built_in">make</span>([][]<span class="type">bool</span>, n)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> isPalindrome &#123;</span><br><span class="line">        isPalindrome[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, n)</span><br><span class="line">        <span class="comment">// å•ä¸ªå­—ç¬¦ä¸€å®šæ˜¯å›æ–‡</span></span><br><span class="line">        isPalindrome[i][i] = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é¢„å¤„ç†æ‰€æœ‰å­ä¸²æ˜¯å¦ä¸ºå›æ–‡</span></span><br><span class="line">    <span class="comment">// ä»ä¸‹å¾€ä¸Šã€ä»å·¦å¾€å³å¡«å……ï¼Œç¡®ä¿è®¡ç®— isPalindrome[i][j] æ—¶ï¼ŒisPalindrome[i+1][j-1] å·²ç»è®¡ç®—å¥½</span></span><br><span class="line">    <span class="keyword">for</span> i := n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        <span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; n; j++ &#123;</span><br><span class="line">            <span class="comment">// å½“å‰å­ä¸²æ˜¯å›æ–‡çš„æ¡ä»¶ï¼šä¸¤ç«¯å­—ç¬¦ç›¸åŒä¸”ä¸­é—´éƒ¨åˆ†æ˜¯å›æ–‡ï¼ˆæˆ–é•¿åº¦ä¸º2ï¼‰</span></span><br><span class="line">            isPalindrome[i][j] = (s[i] == s[j]) &amp;&amp; (j - i &lt;= <span class="number">2</span> || isPalindrome[i+<span class="number">1</span>][j<span class="number">-1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> result [][]<span class="type">string</span></span><br><span class="line">    <span class="keyword">var</span> path []<span class="type">string</span> <span class="comment">// å½“å‰è·¯å¾„</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// DFSå›æº¯æœç´¢æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆ</span></span><br><span class="line">    <span class="keyword">var</span> backtrack <span class="function"><span class="keyword">func</span><span class="params">(start <span class="type">int</span>)</span></span></span><br><span class="line">    backtrack = <span class="function"><span class="keyword">func</span><span class="params">(start <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// åˆ°è¾¾å­—ç¬¦ä¸²æœ«å°¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆæ–¹æ¡ˆ</span></span><br><span class="line">        <span class="keyword">if</span> start == n &#123;</span><br><span class="line">            <span class="comment">// æ‹·è´å½“å‰è·¯å¾„å¹¶åŠ å…¥ç»“æœé›†</span></span><br><span class="line">            pathCopy := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="built_in">len</span>(path))</span><br><span class="line">            <span class="built_in">copy</span>(pathCopy, path)</span><br><span class="line">            result = <span class="built_in">append</span>(result, pathCopy)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°è¯•ä»startå¼€å§‹çš„æ¯ä¸ªå¯èƒ½çš„å›æ–‡å­ä¸²</span></span><br><span class="line">        <span class="keyword">for</span> end := start; end &lt; n; end++ &#123;</span><br><span class="line">            <span class="comment">// åªæœ‰å½“å‰å­ä¸²æ˜¯å›æ–‡æ—¶ï¼Œæ‰ç»§ç»­é€’å½’</span></span><br><span class="line">            <span class="keyword">if</span> isPalindrome[start][end] &#123;</span><br><span class="line">                <span class="comment">// å°†å½“å‰å›æ–‡å­ä¸²åŠ å…¥è·¯å¾„</span></span><br><span class="line">                path = <span class="built_in">append</span>(path, s[start:end+<span class="number">1</span>])</span><br><span class="line">                <span class="comment">// é€’å½’å¤„ç†å‰©ä½™å­ä¸²</span></span><br><span class="line">                backtrack(end + <span class="number">1</span>)</span><br><span class="line">                <span class="comment">// å›æº¯ï¼Œç§»é™¤æœ€ååŠ å…¥çš„å­ä¸²</span></span><br><span class="line">                path = path[:<span class="built_in">len</span>(path)<span class="number">-1</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    backtrack(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•äºŒï¼šè®°å¿†åŒ–æœç´¢-å›æº¯">æ–¹æ³•äºŒï¼šè®°å¿†åŒ–æœç´¢ + å›æº¯</h2>
<h3 id="å®ç°ç»†èŠ‚-2">å®ç°ç»†èŠ‚</h3>
<p>è¿™ä¸ªæ–¹æ³•åŒæ ·åˆ†ä¸ºä¸¤ä¸ªä¸»è¦æ­¥éª¤ï¼Œä½†ä½¿ç”¨è‡ªé¡¶å‘ä¸‹çš„è®°å¿†åŒ–æœç´¢æ¥åˆ¤æ–­å›æ–‡ï¼š</p>
<ol>
<li>
<p><strong>è®°å¿†åŒ–æœç´¢åˆ¤æ–­å›æ–‡</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>memo[i][j]</code> è®°å½• <code>s[i:j+1]</code> æ˜¯å¦ä¸ºå›æ–‡çš„ç»“æœ</li>
<li>0 è¡¨ç¤ºæœªè®¡ç®—ï¼Œ1 è¡¨ç¤ºæ˜¯å›æ–‡ï¼Œ-1 è¡¨ç¤ºä¸æ˜¯å›æ–‡</li>
<li>è‡ªé¡¶å‘ä¸‹åœ°åˆ¤æ–­å­ä¸²æ˜¯å¦ä¸ºå›æ–‡ï¼Œå¹¶å°†ç»“æœç¼“å­˜èµ·æ¥é¿å…é‡å¤è®¡ç®—</li>
</ul>
</li>
<li>
<p><strong>å›æº¯ç”Ÿæˆæ‰€æœ‰åˆ†å‰²æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>å›æº¯éƒ¨åˆ†ä¸æ–¹æ³•ä¸€ç›¸åŒï¼Œåªæ˜¯å›æ–‡åˆ¤æ–­ä½¿ç”¨è®°å¿†åŒ–æœç´¢çš„æ–¹å¼</li>
</ul>
</li>
</ol>
<h3 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">partition</span><span class="params">(s <span class="type">string</span>)</span></span> [][]<span class="type">string</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(s)</span><br><span class="line">    <span class="comment">// memo[i][j] è¡¨ç¤º s[i:j+1] æ˜¯å¦ä¸ºå›æ–‡ä¸²çš„è®°å¿†åŒ–</span></span><br><span class="line">    <span class="comment">// 0:æœªè®¡ç®— 1:æ˜¯å›æ–‡ -1:ä¸æ˜¯å›æ–‡</span></span><br><span class="line">    memo := <span class="built_in">make</span>([][]<span class="type">int8</span>, n)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> memo &#123;</span><br><span class="line">        memo[i] = <span class="built_in">make</span>([]<span class="type">int8</span>, n)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­å­ä¸² s[i:j+1] æ˜¯å¦ä¸ºå›æ–‡</span></span><br><span class="line">    <span class="keyword">var</span> isPalindrome <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">int8</span></span><br><span class="line">    isPalindrome = <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">int8</span> &#123;</span><br><span class="line">        <span class="comment">// å•ä¸ªå­—ç¬¦æˆ–ç©ºä¸²æ˜¯å›æ–‡</span></span><br><span class="line">        <span class="keyword">if</span> i &gt;= j &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœå·²ç»è®¡ç®—è¿‡ï¼Œç›´æ¥è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> memo[i][j] != <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> memo[i][j]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é»˜è®¤ä¸æ˜¯å›æ–‡</span></span><br><span class="line">        memo[i][j] = <span class="number">-1</span></span><br><span class="line">        <span class="comment">// å¦‚æœä¸¤ç«¯å­—ç¬¦ç›¸åŒï¼Œä¸”ä¸­é—´éƒ¨åˆ†æ˜¯å›æ–‡ï¼Œåˆ™æ•´ä½“æ˜¯å›æ–‡</span></span><br><span class="line">        <span class="keyword">if</span> s[i] == s[j] &amp;&amp; isPalindrome(i+<span class="number">1</span>, j<span class="number">-1</span>) &gt; <span class="number">0</span> &#123;</span><br><span class="line">            memo[i][j] = <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> memo[i][j]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> result [][]<span class="type">string</span></span><br><span class="line">    <span class="keyword">var</span> path []<span class="type">string</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// DFSå›æº¯æœç´¢æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆ</span></span><br><span class="line">    <span class="keyword">var</span> backtrack <span class="function"><span class="keyword">func</span><span class="params">(start <span class="type">int</span>)</span></span></span><br><span class="line">    backtrack = <span class="function"><span class="keyword">func</span><span class="params">(start <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// åˆ°è¾¾å­—ç¬¦ä¸²æœ«å°¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆæ–¹æ¡ˆ</span></span><br><span class="line">        <span class="keyword">if</span> start == n &#123;</span><br><span class="line">            <span class="comment">// æ‹·è´å½“å‰è·¯å¾„å¹¶åŠ å…¥ç»“æœé›†</span></span><br><span class="line">            pathCopy := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="built_in">len</span>(path))</span><br><span class="line">            <span class="built_in">copy</span>(pathCopy, path)</span><br><span class="line">            result = <span class="built_in">append</span>(result, pathCopy)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°è¯•ä»startå¼€å§‹çš„æ¯ä¸ªå¯èƒ½çš„å›æ–‡å­ä¸²</span></span><br><span class="line">        <span class="keyword">for</span> end := start; end &lt; n; end++ &#123;</span><br><span class="line">            <span class="comment">// åªæœ‰å½“å‰å­ä¸²æ˜¯å›æ–‡æ—¶ï¼Œæ‰ç»§ç»­é€’å½’</span></span><br><span class="line">            <span class="keyword">if</span> isPalindrome(start, end) &gt; <span class="number">0</span> &#123;</span><br><span class="line">                <span class="comment">// å°†å½“å‰å›æ–‡å­ä¸²åŠ å…¥è·¯å¾„</span></span><br><span class="line">                path = <span class="built_in">append</span>(path, s[start:end+<span class="number">1</span>])</span><br><span class="line">                <span class="comment">// é€’å½’å¤„ç†å‰©ä½™å­ä¸²</span></span><br><span class="line">                backtrack(end + <span class="number">1</span>)</span><br><span class="line">                <span class="comment">// å›æº¯ï¼Œç§»é™¤æœ€ååŠ å…¥çš„å­ä¸²</span></span><br><span class="line">                path = path[:<span class="built_in">len</span>(path)<span class="number">-1</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    backtrack(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ–¹æ³•ä¸€ï¼šé¢„å¤„ç†DP+å›æº¯</th>
<th>æ–¹æ³•äºŒï¼šè®°å¿†åŒ–æœç´¢+å›æº¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(nÂ²) + O(nÂ·2^n)</td>
<td>O(nÂ²) + O(nÂ·2^n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(nÂ²)</td>
<td>O(nÂ²)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>é¢„å¤„ç†æ‰€æœ‰å­ä¸²ï¼Œåˆ¤æ–­å›æ–‡æ›´å¿«</td>
<td>æŒ‰éœ€è®¡ç®—ï¼Œå¯èƒ½ä¸éœ€è¦åˆ¤æ–­æ‰€æœ‰å­ä¸²</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦é¢„å…ˆè®¡ç®—æ‰€æœ‰å­ä¸²</td>
<td>é€’å½’è°ƒç”¨æœ‰é¢å¤–å¼€é”€</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>å­—ç¬¦ä¸²é•¿åº¦è¾ƒçŸ­ï¼Œéœ€è¦åˆ¤æ–­å¤§é‡å­ä¸²</td>
<td>å­—ç¬¦ä¸²é•¿åº¦è¾ƒé•¿ï¼Œå›æ–‡å­ä¸²è¾ƒå°‘</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p>ä¸¤ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦å¦‚ä¸‹ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šé¢„å¤„ç†DP-å›æº¯">æ–¹æ³•ä¸€ï¼šé¢„å¤„ç†DP+å›æº¯</h3>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n^2 + n \cdot 2^n)$</p>
<ul>
<li>é¢„å¤„ç†åˆ¤æ–­æ‰€æœ‰å­ä¸²æ˜¯å¦ä¸ºå›æ–‡éœ€è¦ $O(n^2)$ çš„æ—¶é—´</li>
<li>å›æº¯ç”Ÿæˆæ‰€æœ‰åˆ†å‰²æ–¹æ¡ˆçš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n \cdot 2^n)$ï¼Œå› ä¸ºå¯¹äºé•¿åº¦ä¸º n çš„å­—ç¬¦ä¸²ï¼Œå…±æœ‰ $2^{n-1}$ ç§å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆï¼Œæ¯ç§æ–¹æ¡ˆéœ€è¦ $O(n)$ çš„æ—¶é—´æ¥æ„å»ºç»“æœ</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n^2)$</p>
<ul>
<li>å­˜å‚¨æ‰€æœ‰å­ä¸²çš„å›æ–‡æ€§è´¨éœ€è¦ $O(n^2)$ çš„ç©ºé—´</li>
<li>é€’å½’è°ƒç”¨æ ˆæ·±åº¦å’Œå½“å‰è·¯å¾„æœ€å¤šéœ€è¦ $O(n)$ çš„ç©ºé—´</li>
</ul>
</li>
</ul>
<h3 id="æ–¹æ³•äºŒï¼šè®°å¿†åŒ–æœç´¢-å›æº¯-2">æ–¹æ³•äºŒï¼šè®°å¿†åŒ–æœç´¢+å›æº¯</h3>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n^2 + n \cdot 2^n)$</p>
<ul>
<li>è®°å¿†åŒ–æœç´¢æœ€å¤šéœ€è¦åˆ¤æ–­ $O(n^2)$ ä¸ªå­ä¸²</li>
<li>å›æº¯éƒ¨åˆ†çš„æ—¶é—´å¤æ‚åº¦ä¸æ–¹æ³•ä¸€ç›¸åŒï¼Œä¸º $O(n \cdot 2^n)$</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(n^2)$</p>
<ul>
<li>å­˜å‚¨è®°å¿†åŒ–æœç´¢ç»“æœéœ€è¦ $O(n^2)$ çš„ç©ºé—´</li>
<li>é€’å½’è°ƒç”¨æ ˆæ·±åº¦å’Œå½“å‰è·¯å¾„æœ€å¤šéœ€è¦ $O(n)$ çš„ç©ºé—´</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>å›æ–‡ä¸²åˆ¤æ–­çš„ä¼˜åŒ–</strong>ï¼šé€šè¿‡åŠ¨æ€è§„åˆ’æˆ–è®°å¿†åŒ–æœç´¢ï¼Œæˆ‘ä»¬å¯ä»¥é«˜æ•ˆåˆ¤æ–­å­ä¸²æ˜¯å¦ä¸ºå›æ–‡ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</p>
</li>
<li>
<p><strong>å›æº¯ç®—æ³•çš„åº”ç”¨</strong>ï¼šé€šè¿‡å›æº¯ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç³»ç»Ÿåœ°æšä¸¾æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªç»å…¸çš„ç»„åˆé—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>ä¸¤ç§ç­–ç•¥æ¯”è¾ƒ</strong>ï¼š</p>
<ul>
<li>åŠ¨æ€è§„åˆ’ï¼ˆè‡ªåº•å‘ä¸Šï¼‰ï¼šé¢„å…ˆè®¡ç®—æ‰€æœ‰ç»“æœï¼Œé€‚ç”¨äºéœ€è¦å¤§é‡æŸ¥è¯¢çš„åœºæ™¯</li>
<li>è®°å¿†åŒ–æœç´¢ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰ï¼šæŒ‰éœ€è®¡ç®—ï¼Œé€‚ç”¨äºåªéœ€è®¡ç®—éƒ¨åˆ†ç»“æœçš„åœºæ™¯</li>
</ul>
</li>
<li>
<p><strong>é€’å½’ä¸è¿­ä»£çš„é€‰æ‹©</strong>ï¼š</p>
<ul>
<li>åœ¨å­—ç¬¦ä¸²é•¿åº¦è¾ƒçŸ­ï¼ˆå¦‚æœ¬é¢˜é™åˆ¶ä¸º 16ï¼‰çš„æƒ…å†µä¸‹ï¼Œä¸¤ç§æ–¹æ³•çš„æ€§èƒ½å·®å¼‚ä¸å¤§</li>
<li>å¯¹äºæ›´å¤§è§„æ¨¡çš„é—®é¢˜ï¼Œé¢„å¤„ç†æ–¹æ³•å¯èƒ½æ›´æœ‰æ•ˆï¼Œå› ä¸ºé¿å…äº†é€’å½’è°ƒç”¨çš„å¼€é”€</li>
</ul>
</li>
<li>
<p><strong>Goè¯­è¨€æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨é—­åŒ…å®ç°å±€éƒ¨é€’å½’å‡½æ•°</li>
<li>é€šè¿‡åˆ‡ç‰‡æ“ä½œå®ç°å›æº¯è¿‡ç¨‹ä¸­çš„è·¯å¾„ç®¡ç†</li>
<li>æ·±æ‹·è´ç»“æœé¿å…å¼•ç”¨åŒä¸€ä¸ªåˆ‡ç‰‡</li>
</ul>
</li>
</ol>
<p>ç›¸å…³é—®é¢˜ï¼š</p>
<ul>
<li>LeetCode 132: åˆ†å‰²å›æ–‡ä¸² II</li>
<li>LeetCode 647: å›æ–‡å­ä¸²</li>
<li>LeetCode 5: æœ€é•¿å›æ–‡å­ä¸²</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>å›æº¯</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLå…«è‚¡: COUNT(*)ä¸COUNT(1)çš„åŒºåˆ«ä¸æ€§èƒ½å¯¹æ¯”</title>
    <url>/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/</url>
    <content><![CDATA[<h1>COUNT(*) å’Œ COUNT(1) æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªä¸ªæ€§èƒ½æœ€å¥½ï¼Ÿ</h1>
<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>åœ¨MySQLæ€§èƒ½ä¼˜åŒ–é¢è¯•ä¸­ï¼Œç»å¸¸ä¼šè¢«é—®åˆ°ï¼šâ€œ<code>COUNT(*)</code>å’Œ<code>COUNT(1)</code>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿâ€</p>
<p>è¿™ä¸ªé—®é¢˜çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™æš—è—ç„æœºã€‚å¾ˆå¤šäººï¼ˆåŒ…æ‹¬æˆ‘æ›¾ç»ï¼‰éƒ½è®¤ä¸º<code>COUNT(*)</code>æ•ˆç‡è¾ƒå·®ï¼Œå› ä¸ºå®ƒä¼šè¯»å–æ‰€æœ‰å­—æ®µï¼Œå°±åƒ<code>SELECT * FROM table</code>ä¸€æ ·ã€‚ç½‘ä¸Šä¹Ÿæœ‰è®¸å¤šæ–‡ç« æŒè¿™ç§è§‚ç‚¹ã€‚</p>
<p>ä½†å½“æˆ‘æ·±å…¥ç ”ç©¶åï¼Œå‘ç°äº‹å®å¹¶éå¦‚æ­¤ï¼æœ¬æ–‡å°†æ­å¼€è¿™ä¸ªå¸¸è§MySQLå…«è‚¡æ–‡çš„çœŸç›¸ã€‚</p>
<h2 id="ç»“è®ºå…ˆè¡Œ">ç»“è®ºå…ˆè¡Œ</h2>
<p>å…ˆç»™å‡ºæ˜ç¡®ç»“è®ºï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ï¼š</p>
<blockquote>
<p><strong>æ€§èƒ½æ’åº</strong>: COUNT(*) = COUNT(1) &gt; COUNT(ä¸»é”®å­—æ®µ) &gt; COUNT(æ™®é€šå­—æ®µ)</p>
</blockquote>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æåŸç†ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„ç»“è®ºã€‚</p>
<h2 id="COUNTå‡½æ•°åŸºç¡€çŸ¥è¯†">COUNTå‡½æ•°åŸºç¡€çŸ¥è¯†</h2>
<h3 id="COUNT-æ˜¯ä»€ä¹ˆï¼Ÿ">COUNT() æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>COUNT()æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯ï¼š<strong>ç»Ÿè®¡ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•ä¸­ï¼Œå‡½æ•°å‚æ•°ä¸ä¸ºNULLçš„è®°å½•æ•°é‡</strong>ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°çš„å‚æ•°å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>å­—æ®µå</li>
<li>å¸¸é‡è¡¨è¾¾å¼ï¼ˆå¦‚æ•°å­—1ï¼‰</li>
<li>ç‰¹æ®Šç¬¦å·ï¼ˆå¦‚*ï¼‰</li>
</ul>
<h3 id="ä¸åŒCOUNTç”¨æ³•çš„å«ä¹‰">ä¸åŒCOUNTç”¨æ³•çš„å«ä¹‰</h3>
<table>
<thead>
<tr>
<th>ç”¨æ³•</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>COUNT(å­—æ®µå)</td>
<td>ç»Ÿè®¡è¯¥å­—æ®µä¸ä¸ºNULLçš„è®°å½•æ•°</td>
</tr>
<tr>
<td>COUNT(1)</td>
<td>ç»Ÿè®¡è¡¨ä¸­çš„è®°å½•æ•°ï¼ˆ1æ°¸è¿œä¸ä¸ºNULLï¼‰</td>
</tr>
<tr>
<td>COUNT(*)</td>
<td>ç»Ÿè®¡è¡¨ä¸­çš„è®°å½•æ•°ï¼ˆMySQLç‰¹æ®Šä¼˜åŒ–ï¼‰</td>
</tr>
</tbody>
</table>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ç»Ÿè®¡t_orderè¡¨ä¸­nameå­—æ®µä¸ä¸ºNULLçš„è®°å½•æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(name) <span class="keyword">FROM</span> t_order;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç»Ÿè®¡t_orderè¡¨ä¸­çš„æ€»è®°å½•æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> t_order;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> t_order;</span><br></pre></td></tr></table></figure>
<h2 id="COUNTä¸åŒç”¨æ³•çš„æ‰§è¡ŒåŸç†">COUNTä¸åŒç”¨æ³•çš„æ‰§è¡ŒåŸç†</h2>
<p>ä¸ºäº†ç†è§£æ€§èƒ½å·®å¼‚ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸åŒCOUNTç”¨æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ä»¥ä¸‹åˆ†æåŸºäºInnoDBå­˜å‚¨å¼•æ“ã€‚</p>
<h3 id="æ‰§è¡Œè¿‡ç¨‹æ¦‚è¿°">æ‰§è¡Œè¿‡ç¨‹æ¦‚è¿°</h3>
<p>å½“æ‰§è¡ŒCOUNTå‡½æ•°æ—¶ï¼ŒMySQLæœåŠ¡å™¨å±‚ä¼šï¼š</p>
<ol>
<li>ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å˜é‡count</li>
<li>ä»å­˜å‚¨å¼•æ“è¯»å–è®°å½•</li>
<li>åˆ¤æ–­COUNTå‡½æ•°å‚æ•°æ˜¯å¦ä¸ºNULL</li>
<li>å¦‚æœä¸ä¸ºNULLï¼Œcountå˜é‡+1</li>
<li>è¯»å®Œæ‰€æœ‰è®°å½•åï¼Œè¿”å›countå€¼</li>
</ol>
<p>å…³é”®å·®å¼‚åœ¨äºï¼š<strong>MySQLä»å“ªé‡Œè¯»å–è®°å½•</strong>ä»¥åŠ<strong>æ˜¯å¦éœ€è¦è¯»å–å­—æ®µå€¼</strong>ã€‚</p>
<h3 id="COUNT-ä¸»é”®å­—æ®µ-çš„æ‰§è¡Œè¿‡ç¨‹">COUNT(ä¸»é”®å­—æ®µ)çš„æ‰§è¡Œè¿‡ç¨‹</h3>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746455045381.png" alt="COUNT(id)æ‰§è¡Œè¿‡ç¨‹"></p>
<p>æ‰§è¡Œ<code>SELECT COUNT(id) FROM t_order</code>ï¼ˆidä¸ºä¸»é”®ï¼‰æ—¶ï¼š</p>
<ol>
<li>
<p><strong>å¦‚æœåªæœ‰ä¸»é”®ç´¢å¼•</strong>ï¼š</p>
<ul>
<li>InnoDBéå†èšç°‡ç´¢å¼•</li>
<li>è¯»å–æ¯æ¡è®°å½•çš„idå€¼</li>
<li>åˆ¤æ–­idæ˜¯å¦ä¸ºNULLï¼ˆé€šå¸¸ä¸»é”®ä¸å…è®¸NULLï¼‰</li>
<li>å¦‚æœä¸ä¸ºNULLï¼Œè®¡æ•°+1</li>
</ul>
</li>
<li>
<p><strong>å¦‚æœæœ‰äºŒçº§ç´¢å¼•</strong>ï¼š</p>
<ul>
<li>InnoDBä¼šé€‰æ‹©æœ€å°çš„äºŒçº§ç´¢å¼•è¿›è¡Œéå†</li>
<li>å› ä¸ºäºŒçº§ç´¢å¼•é€šå¸¸æ¯”èšç°‡ç´¢å¼•å°ï¼ŒI/Oæˆæœ¬æ›´ä½</li>
</ul>
</li>
</ol>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746455063103.png" alt="ä½¿ç”¨äºŒçº§ç´¢å¼•"></p>
<h3 id="COUNT-1-çš„æ‰§è¡Œè¿‡ç¨‹">COUNT(1)çš„æ‰§è¡Œè¿‡ç¨‹</h3>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746455092896.png" alt="COUNT(1)æ‰§è¡Œè¿‡ç¨‹"></p>
<p>æ‰§è¡Œ<code>SELECT COUNT(1) FROM t_order</code>æ—¶ï¼š</p>
<ol>
<li>
<p><strong>é€‰æ‹©ç´¢å¼•</strong>ï¼š</p>
<ul>
<li>åŒæ ·ä¼šä¼˜å…ˆé€‰æ‹©æœ€å°çš„ç´¢å¼•è¿›è¡Œéå†</li>
</ul>
</li>
<li>
<p><strong>å…³é”®å·®å¼‚</strong>ï¼š</p>
<ul>
<li><strong>ä¸éœ€è¦è¯»å–è®°å½•ä¸­çš„ä»»ä½•å­—æ®µå€¼</strong></li>
<li>å¸¸é‡1æ°¸è¿œä¸ä¸ºNULLï¼Œç›´æ¥è®¡æ•°+1</li>
</ul>
</li>
</ol>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<code>COUNT(1)</code>æ¯”<code>COUNT(ä¸»é”®å­—æ®µ)</code>å¿«ä¸€ç‚¹ - å°‘äº†è¯»å–å’Œåˆ¤æ–­å­—æ®µå€¼çš„æ­¥éª¤ã€‚</p>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746455233210.png" alt="COUNT(1)ä½¿ç”¨äºŒçº§ç´¢å¼•"></p>
<h3 id="COUNT-çš„æ‰§è¡Œè¿‡ç¨‹">COUNT(*)çš„æ‰§è¡Œè¿‡ç¨‹</h3>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746455281065.png" alt="COUNT(*)æ‰§è¡Œè¿‡ç¨‹"></p>
<p>è®¸å¤šäººè¯¯è§£çš„åœ°æ–¹æ¥äº†ï¼š<code>COUNT(*)</code>å¹¶ä¸ä¼šè¯»å–æ‰€æœ‰å­—æ®µï¼</p>
<p><strong>äº‹å®</strong>ï¼šMySQLå¯¹<code>COUNT(*)</code>åšäº†ç‰¹æ®Šä¼˜åŒ–ï¼Œå°†å…¶è§†ä¸º<code>COUNT(0)</code>å¤„ç†ã€‚</p>
<p>ä»MySQL 5.7å®˜æ–¹æ‰‹å†Œï¼š</p>
<blockquote>
<p><em>InnoDB handles SELECT COUNT(*) and SELECT COUNT(1) operations in the same way. There is no performance difference.</em></p>
<p><em>ç¿»è¯‘ï¼šInnoDBä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†SELECT COUNT(*)å’ŒSELECT COUNT(1)æ“ä½œï¼Œæ²¡æœ‰æ€§èƒ½å·®å¼‚ã€‚</em></p>
</blockquote>
<p>æ‰€ä»¥ï¼Œ<code>COUNT(*)</code>å’Œ<code>COUNT(1)</code>çš„æ‰§è¡Œè¿‡ç¨‹åŸºæœ¬ç›¸åŒï¼Œæ€§èƒ½ä¹Ÿå‡ ä¹ä¸€æ ·ã€‚</p>
<h3 id="COUNT-æ™®é€šå­—æ®µ-çš„æ‰§è¡Œè¿‡ç¨‹">COUNT(æ™®é€šå­—æ®µ)çš„æ‰§è¡Œè¿‡ç¨‹</h3>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746455424755.png" alt="COUNT(name)æ‰§è¡Œè¿‡ç¨‹"></p>
<p>æ‰§è¡Œ<code>SELECT COUNT(name) FROM t_order</code>ï¼ˆnameæ˜¯æ™®é€šéç´¢å¼•å­—æ®µï¼‰æ—¶ï¼š</p>
<ol>
<li>éœ€è¦éå†è¡¨è®°å½•</li>
<li><strong>å¿…é¡»è¯»å–nameå­—æ®µçš„å€¼</strong></li>
<li>åˆ¤æ–­nameæ˜¯å¦ä¸ºNULL</li>
<li>å¦‚æœä¸ä¸ºNULLï¼Œè®¡æ•°+1</li>
</ol>
<p>è¿™é€šå¸¸éœ€è¦å…¨è¡¨æ‰«æï¼Œæ•ˆç‡æœ€ä½ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆInnoDBå¿…é¡»éå†è¡¨æ¥è®¡æ•°ï¼Ÿ">ä¸ºä»€ä¹ˆInnoDBå¿…é¡»éå†è¡¨æ¥è®¡æ•°ï¼Ÿ</h2>
<p>ä½ å¯èƒ½ä¼šé—®ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºå­˜å‚¨å¼•æ“çš„è®¾è®¡å·®å¼‚ï¼š</p>
<h3 id="MyISAM-vs-InnoDB">MyISAM vs InnoDB</h3>
<ol>
<li>
<p><strong>MyISAMå¼•æ“</strong>ï¼š</p>
<ul>
<li>ç»´æŠ¤è¡¨çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬row_countå€¼</li>
<li>æ‰§è¡Œ<code>COUNT(*)</code>åªéœ€O(1)å¤æ‚åº¦</li>
<li>ç›´æ¥è¿”å›row_countå€¼</li>
</ul>
</li>
<li>
<p><strong>InnoDBå¼•æ“</strong>ï¼š</p>
<ul>
<li>æ”¯æŒäº‹åŠ¡å’ŒMVCC(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)</li>
<li>åŒä¸€æ—¶åˆ»çš„å¤šä¸ªäº‹åŠ¡å¯èƒ½çœ‹åˆ°ä¸åŒçš„è¡Œæ•°</li>
<li>æ— æ³•ç»´æŠ¤å•ä¸€çš„row_countå˜é‡</li>
</ul>
</li>
</ol>
<h3 id="MVCCå¯¼è‡´çš„è®¡æ•°å·®å¼‚">MVCCå¯¼è‡´çš„è®¡æ•°å·®å¼‚</h3>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746455436512.png" alt="äº‹åŠ¡å¯¼è‡´çš„COUNTå·®å¼‚"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ï¼š</p>
<ul>
<li>ä¼šè¯Aå¼€å¯äº‹åŠ¡ï¼Œä¸¤æ¬¡æŸ¥è¯¢éƒ½æ˜¯100æ¡è®°å½•</li>
<li>ä¼šè¯Bæ’å…¥ä¸€æ¡è®°å½•åè¿›è¡ŒæŸ¥è¯¢ï¼Œå¾—åˆ°çš„æ˜¯101æ¡è®°å½•</li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆInnoDBå¿…é¡»éå†è¡¨æ¥è®¡æ•° - æ¯ä¸ªäº‹åŠ¡å¯èƒ½çœ‹åˆ°ä¸åŒçš„ç»“æœã€‚</p>
<h2 id="å¦‚ä½•ä¼˜åŒ–å¤§è¡¨çš„COUNTæ“ä½œï¼Ÿ">å¦‚ä½•ä¼˜åŒ–å¤§è¡¨çš„COUNTæ“ä½œï¼Ÿ</h2>
<p>å¯¹å¤§è¡¨æ‰§è¡ŒCOUNTæ“ä½œä¼šå¾ˆæ…¢ã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746456443887.png" alt="å¤§è¡¨COUNTè€—æ—¶"></p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸€å¼ æœ‰1200ä¸‡è®°å½•çš„è¡¨ï¼Œå³ä½¿æœ‰äºŒçº§ç´¢å¼•ï¼Œ<code>COUNT(*)</code>ä»éœ€è¿‘5ç§’ï¼</p>
<h3 id="ä¼˜åŒ–æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¿‘ä¼¼å€¼">ä¼˜åŒ–æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¿‘ä¼¼å€¼</h3>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746456461290.png" alt="æœç´¢å¼•æ“çš„è¿‘ä¼¼è®¡æ•°"></p>
<p>å¦‚æœä¸šåŠ¡å…è®¸è¿‘ä¼¼å€¼ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<ul>
<li><code>SHOW TABLE STATUS</code> å‘½ä»¤</li>
<li><code>EXPLAIN</code> å‘½ä»¤</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹è¡¨çŠ¶æ€ï¼Œè·å–è¡Œæ•°ä¼°è®¡å€¼</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;t_order&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨EXPLAINè·å–è¡Œæ•°ä¼°è®¡å€¼</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_order;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/05/05/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/2025-05-05-count-vs-count1/1746456489201.png" alt="EXPLAINä¼°ç®—è¡Œæ•°"></p>
<p>è¿™äº›å‘½ä»¤éå¸¸å¿«ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šçœŸæ­£æ‰«æè¡¨ï¼Œè€Œæ˜¯åŸºäºç»Ÿè®¡ä¿¡æ¯ä¼°ç®—ã€‚</p>
<h3 id="ä¼˜åŒ–æ–¹æ¡ˆäºŒï¼šå•ç‹¬çš„è®¡æ•°è¡¨">ä¼˜åŒ–æ–¹æ¡ˆäºŒï¼šå•ç‹¬çš„è®¡æ•°è¡¨</h3>
<p>å¦‚æœéœ€è¦ç²¾ç¡®è®¡æ•°ï¼Œå¯ä»¥ï¼š</p>
<ol>
<li>åˆ›å»ºä¸“é—¨çš„è®¡æ•°è¡¨</li>
<li>åœ¨æ•°æ®è¡¨çš„å¢åˆ æ“ä½œä¸­åŒæ­¥æ›´æ–°è®¡æ•°è¡¨</li>
<li>æŸ¥è¯¢æ—¶ç›´æ¥ä»è®¡æ•°è¡¨è·å–æ•°å€¼</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºè®¡æ•°è¡¨</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> t_counts (</span><br><span class="line">    table_name <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    row_count <span class="type">BIGINT</span> UNSIGNED</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆå§‹åŒ–è®¡æ•°</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> t_counts <span class="keyword">VALUES</span> (<span class="string">&#x27;t_order&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨æ’å…¥t_orderæ—¶æ›´æ–°è®¡æ•°</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT INTO</span> t_order <span class="keyword">VALUES</span> (...);</span><br><span class="line"><span class="keyword">UPDATE</span> t_counts <span class="keyword">SET</span> row_count <span class="operator">=</span> row_count <span class="operator">+</span> <span class="number">1</span> <span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;t_order&#x27;</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœ¨åˆ é™¤t_orderæ—¶æ›´æ–°è®¡æ•°</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> t_order <span class="keyword">WHERE</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> t_counts <span class="keyword">SET</span> row_count <span class="operator">=</span> row_count <span class="operator">-</span> <span class="number">1</span> <span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;t_order&#x27;</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼éœ€è¦åœ¨åº”ç”¨å±‚ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼Œä½†æŸ¥è¯¢æ•ˆç‡æé«˜ã€‚</p>
<h2 id="æœ€ä½³å®è·µæ€»ç»“">æœ€ä½³å®è·µæ€»ç»“</h2>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èåšæ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>éœ€è¦ç»Ÿè®¡è¡¨æ€»è¡Œæ•°</td>
<td>ä¼˜å…ˆä½¿ç”¨<code>COUNT(*)</code>æˆ–<code>COUNT(1)</code>ï¼ŒäºŒè€…æ€§èƒ½ç›¸å½“</td>
</tr>
<tr>
<td>éœ€è¦ç»Ÿè®¡æŸå­—æ®µéNULLå€¼</td>
<td>å¯¹è¯¥å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œç„¶åä½¿ç”¨<code>COUNT(å­—æ®µå)</code></td>
</tr>
<tr>
<td>å¤§è¡¨ç»Ÿè®¡ä¸”å…è®¸è¿‘ä¼¼å€¼</td>
<td>ä½¿ç”¨<code>SHOW TABLE STATUS</code>æˆ–<code>EXPLAIN</code></td>
</tr>
<tr>
<td>å¤§è¡¨éœ€è¦ç²¾ç¡®ç»Ÿè®¡ä¸”é¢‘ç¹æŸ¥è¯¢</td>
<td>ä½¿ç”¨å•ç‹¬çš„è®¡æ•°è¡¨ç»´æŠ¤è¡Œæ•°</td>
</tr>
<tr>
<td>æœ‰äºŒçº§ç´¢å¼•çš„è¡¨</td>
<td>MySQLä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨é€‰æ‹©æœ€å°çš„ç´¢å¼•</td>
</tr>
</tbody>
</table>
<h2 id="ç»“è®º">ç»“è®º</h2>
<ol>
<li><strong><code>COUNT(*)</code>å’Œ<code>COUNT(1)</code>æ€§èƒ½åŸºæœ¬ç›¸åŒ</strong>ï¼Œéƒ½ç»è¿‡äº†MySQLçš„ä¼˜åŒ–</li>
<li>éƒ½ä¼˜äº<code>COUNT(ä¸»é”®å­—æ®µ)</code>ï¼Œå› ä¸ºä¸éœ€è¦å–å€¼æ¯”è¾ƒ</li>
<li><code>COUNT(æ™®é€šå­—æ®µ)</code>æ•ˆç‡æœ€ä½ï¼Œé™¤éä½ åªæƒ³ç»Ÿè®¡è¯¥å­—æ®µéNULLçš„è®°å½•</li>
<li>å¤§è¡¨ç»Ÿè®¡æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨è¿‘ä¼¼å€¼æˆ–ä¸“é—¨çš„è®¡æ•°è¡¨</li>
<li>é’ˆå¯¹ç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„è®¡æ•°æ–¹å¼æ‰æ˜¯ç‹é“</li>
</ol>
<p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ å½»åº•ç†è§£è¿™ä¸ªå¸¸è§çš„MySQLé¢è¯•é¢˜ï¼Œåœ¨å®é™…å·¥ä½œä¸­åšå‡ºæ­£ç¡®çš„é€‰æ‹©ï¼</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>ç´¢å¼•</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>ç´¢å¼•</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 46 - å…¨æ’åˆ—ï¼ˆPermutationsï¼‰é”™è¯¯åˆ†æ</title>
    <url>/2025/05/05/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-46-%E5%85%A8%E6%8E%92%E5%88%97-%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p><a href="https://leetcode.cn/problems/permutations/">å…¨æ’åˆ—</a>æ˜¯ä¸€ä¸ªç»å…¸çš„å›æº¯ç®—æ³•é—®é¢˜ï¼š</p>
<p>ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ <code>nums</code>ï¼Œè¿”å›å…¶æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—ã€‚ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,2,3]</span><br><span class="line">è¾“å‡ºï¼š[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [0,1]</span><br><span class="line">è¾“å‡ºï¼š[[0,1],[1,0]]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1]</span><br><span class="line">è¾“å‡ºï¼š[[1]]</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>1 &lt;= nums.length &lt;= 6</li>
<li>-10 &lt;= nums[i] &lt;= 10</li>
<li>nums ä¸­çš„æ‰€æœ‰æ•´æ•°äº’ä¸ç›¸åŒ</li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘çš„åˆå§‹è§£æ³•ä½¿ç”¨äº†ç»å…¸çš„å›æº¯ç®—æ³•ï¼Œä½†åœ¨å®ç°è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„é”™è¯¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">permute</span><span class="params">(nums []<span class="type">int</span>)</span></span> (res [][]<span class="type">int</span>) &#123;</span><br><span class="line">    flag := <span class="built_in">make</span>([]<span class="type">bool</span>, <span class="built_in">len</span>(nums))</span><br><span class="line">    tmpArray := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(nums))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(index <span class="type">int</span>)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(index <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> index &gt;= <span class="built_in">len</span>(nums) &#123;</span><br><span class="line">            <span class="keyword">var</span> tmp []<span class="type">int</span>  <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šåˆ‡ç‰‡å£°æ˜ä½†æœªåˆ†é…å†…å­˜</span></span><br><span class="line">            <span class="built_in">copy</span>(tmp, tmpArray)  <span class="comment">// âŒ å¤åˆ¶æ“ä½œæ— æ•ˆï¼Œå› ä¸ºtmpé•¿åº¦ä¸º0</span></span><br><span class="line">            res = <span class="built_in">append</span>(res, tmp)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">            <span class="keyword">if</span> !flag[i] &#123;</span><br><span class="line">                flag[i] = <span class="literal">true</span></span><br><span class="line">                tmpArray[index] = nums[i]</span><br><span class="line">                dfs(index + <span class="number">1</span>)</span><br><span class="line">                flag[i] = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dfs(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè§£æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå‘ç°ç»“æœä¸ºç©ºï¼Œå› ä¸ºæˆ‘åœ¨å¤åˆ¶åˆ‡ç‰‡æ—¶çŠ¯äº†ä¸€ä¸ªå¸¸è§é”™è¯¯ã€‚</p>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>é”™è¯¯å‘ç”Ÿåœ¨å®Œæˆæ’åˆ—æ„å»ºåæ·»åŠ ç»“æœåˆ° <code>res</code> çš„ä»£ç éƒ¨åˆ†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> tmp []<span class="type">int</span></span><br><span class="line"><span class="built_in">copy</span>(tmp, tmpArray)</span><br><span class="line">res = <span class="built_in">append</span>(res, tmp)</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯åŸå› ï¼š</strong></p>
<ol>
<li><code>var tmp []int</code> å£°æ˜äº†ä¸€ä¸ªç©ºåˆ‡ç‰‡ï¼Œå…¶é•¿åº¦å’Œå®¹é‡éƒ½ä¸º 0</li>
<li>Goè¯­è¨€çš„ <code>copy()</code> å‡½æ•°åªä¼šå¤åˆ¶ç›®æ ‡åˆ‡ç‰‡èƒ½å¤Ÿå®¹çº³çš„å…ƒç´ æ•°é‡</li>
<li>ç”±äº <code>tmp</code> çš„é•¿åº¦ä¸º 0ï¼Œæ‰€ä»¥ <code>copy(tmp, tmpArray)</code> å®é™…ä¸Šæ²¡æœ‰å¤åˆ¶ä»»ä½•å…ƒç´ </li>
<li>ç»“æœæ˜¯æ¯æ¬¡éƒ½å°†ä¸€ä¸ªç©ºåˆ‡ç‰‡è¿½åŠ åˆ° <code>res</code> ä¸­</li>
</ol>
<p>è¿™æ˜¯ Go è¯­è¨€ä¸­å¤„ç†åˆ‡ç‰‡æ—¶çš„ä¸€ä¸ªå¸¸è§é™·é˜±ã€‚åœ¨ Go ä¸­ï¼Œåˆ‡ç‰‡æ˜¯å¯¹åº•å±‚æ•°ç»„çš„å¼•ç”¨ï¼Œä¸æ˜¯ç‹¬ç«‹çš„æ•°æ®ç»“æ„ã€‚<code>copy()</code> å‡½æ•°éœ€è¦ç›®æ ‡åˆ‡ç‰‡æœ‰è¶³å¤Ÿçš„é•¿åº¦æ‰èƒ½å¤åˆ¶å…ƒç´ ã€‚</p>
<h2 id="æ­£ç¡®è§£æ³•">æ­£ç¡®è§£æ³•</h2>
<p>ç»è¿‡åˆ†æï¼Œä¿®å¤åçš„è§£æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">permute</span><span class="params">(nums []<span class="type">int</span>)</span></span> (res [][]<span class="type">int</span>) &#123;</span><br><span class="line">    flag := <span class="built_in">make</span>([]<span class="type">bool</span>, <span class="built_in">len</span>(nums))</span><br><span class="line">    tmpArray := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(nums))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(index <span class="type">int</span>)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(index <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> index &gt;= <span class="built_in">len</span>(nums) &#123;</span><br><span class="line">            tmp := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(nums))  <span class="comment">// âœ… æ­£ç¡®ï¼šä¸ºæ–°åˆ‡ç‰‡åˆ†é…è¶³å¤Ÿçš„ç©ºé—´</span></span><br><span class="line">            <span class="built_in">copy</span>(tmp, tmpArray)  <span class="comment">// ç°åœ¨å¤åˆ¶æ“ä½œä¼šæ­£ç¡®è¿›è¡Œ</span></span><br><span class="line">            res = <span class="built_in">append</span>(res, tmp)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">            <span class="keyword">if</span> !flag[i] &#123;</span><br><span class="line">                flag[i] = <span class="literal">true</span></span><br><span class="line">                tmpArray[index] = nums[i]</span><br><span class="line">                dfs(index + <span class="number">1</span>)</span><br><span class="line">                flag[i] = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dfs(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ">ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ</h3>
<p>ä¿®å¤æ–¹æ³•å¾ˆç®€å•ï¼šä½¿ç”¨ <code>make()</code> å‡½æ•°ä¸º <code>tmp</code> åˆ‡ç‰‡åˆ†é…é€‚å½“çš„é•¿åº¦ï¼Œç¡®ä¿å®ƒæœ‰è¶³å¤Ÿçš„å®¹é‡æ¥æ¥æ”¶å¤åˆ¶çš„å…ƒç´ ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">tmp := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(nums))  <span class="comment">// åˆ†é…æ­£ç¡®é•¿åº¦çš„å†…å­˜</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œ<code>copy(tmp, tmpArray)</code> å‡½æ•°å°±èƒ½æ­£ç¡®å¤åˆ¶æ‰€æœ‰å…ƒç´ ï¼Œè€Œä¸æ˜¯åˆ›å»ºç©ºç»“æœã€‚</p>
<h3 id="å¦ä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆ">å¦ä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆ</h3>
<p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨åˆ‡ç‰‡çš„è¿½åŠ æ“ä½œæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ‡ç‰‡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">tmp := <span class="built_in">append</span>([]<span class="type">int</span>&#123;&#125;, tmpArray...)  <span class="comment">// é€šè¿‡è¿½åŠ åˆ›å»ºæ–°åˆ‡ç‰‡</span></span><br></pre></td></tr></table></figure>
<p>æˆ–è€…æ›´ç®€æ´çš„æ–¹æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">tmp := <span class="built_in">append</span>(<span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="built_in">len</span>(nums)), tmpArray...)</span><br></pre></td></tr></table></figure>
<p>è¿™äº›æ–¹æ³•åŒæ ·å¯ä»¥åˆ›å»º <code>tmpArray</code> çš„æ·±æ‹·è´ï¼Œé¿å…å¼•ç”¨åŒä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚</p>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>ä»è¿™ä¸ªé”™è¯¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å­¦åˆ°å‡ ä¸ªå…³äº Go è¯­è¨€åˆ‡ç‰‡æ“ä½œçš„é‡è¦çŸ¥è¯†ç‚¹ï¼š</p>
<ol>
<li><strong>åˆ‡ç‰‡æ·±æ‹·è´éœ€è¦æ³¨æ„å†…å­˜åˆ†é…</strong>ï¼šåœ¨ Go ä¸­è¿›è¡Œåˆ‡ç‰‡å¤åˆ¶æ—¶ï¼Œå¿…é¡»ç¡®ä¿ç›®æ ‡åˆ‡ç‰‡æœ‰è¶³å¤Ÿçš„é•¿åº¦</li>
<li><strong><code>copy()</code> å‡½æ•°çš„è¡Œä¸º</strong>ï¼š<code>copy()</code> åªä¼šå¤åˆ¶ç›®æ ‡åˆ‡ç‰‡èƒ½å®¹çº³çš„å…ƒç´ æ•°é‡ï¼Œä¸ä¼šè‡ªåŠ¨æ‰©å±•ç›®æ ‡åˆ‡ç‰‡</li>
<li><strong>å˜é‡å£°æ˜ä¸å†…å­˜åˆ†é…çš„åŒºåˆ«</strong>ï¼š<code>var tmp []int</code> åªæ˜¯å£°æ˜äº†å˜é‡ï¼Œæ²¡æœ‰åˆ†é…å†…å­˜ï¼›è€Œ <code>make([]int, len)</code> ä¼šåˆ†é…æŒ‡å®šé•¿åº¦çš„å†…å­˜</li>
<li><strong>å›æº¯ç®—æ³•ä¸­çš„çŠ¶æ€å¤åˆ¶</strong>ï¼šåœ¨å›æº¯ç®—æ³•ä¸­ï¼Œå°†ä¸´æ—¶çŠ¶æ€åŠ å…¥ç»“æœé›†æ—¶ï¼Œå¿…é¡»åˆ›å»ºæ·±æ‹·è´ï¼Œå¦åˆ™åç»­çš„ä¿®æ”¹ä¼šå½±å“å·²å­˜å‚¨çš„ç»“æœ</li>
</ol>
<p>è¿™ä¸ªé”™è¯¯æé†’æˆ‘ä»¬åœ¨ Go è¯­è¨€ç¼–ç¨‹ä¸­è¦ç‰¹åˆ«æ³¨æ„åˆ‡ç‰‡çš„å†…å­˜ç®¡ç†å’Œå¤åˆ¶æ“ä½œï¼Œé¿å…å› å¼•ç”¨å…±äº«å¯¼è‡´çš„æ„å¤–è¡Œä¸ºã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›æº¯</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>å›æº¯</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 208 - å®ç° Trie (å‰ç¼€æ ‘)</title>
    <url>/2025/05/05/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-208-%E5%AE%9E%E7%8E%B0-Trie-%E5%89%8D%E7%BC%80%E6%A0%91/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>Trieï¼ˆå‘éŸ³ç±»ä¼¼ â€œtryâ€ï¼‰æˆ–è€…è¯´å‰ç¼€æ ‘ï¼Œæ˜¯ä¸€ç§æ ‘å½¢æ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆåœ°å­˜å‚¨å’Œæ£€ç´¢å­—ç¬¦ä¸²æ•°æ®é›†ä¸­çš„é”®ã€‚è¿™ä¸€æ•°æ®ç»“æ„æœ‰ç›¸å½“å¤šçš„åº”ç”¨æƒ…æ™¯ï¼Œä¾‹å¦‚è‡ªåŠ¨è¡¥å…¨å’Œæ‹¼å†™æ£€æŸ¥ã€‚</p>
<p>è¯·ä½ å®ç° Trie ç±»ï¼š</p>
<ul>
<li><code>Trie()</code> åˆå§‹åŒ–å‰ç¼€æ ‘å¯¹è±¡ã€‚</li>
<li><code>void insert(String word)</code> å‘å‰ç¼€æ ‘ä¸­æ’å…¥å­—ç¬¦ä¸² <code>word</code>ã€‚</li>
<li><code>boolean search(String word)</code> å¦‚æœå­—ç¬¦ä¸² <code>word</code> åœ¨å‰ç¼€æ ‘ä¸­ï¼Œè¿”å› <code>true</code>ï¼ˆå³ï¼Œåœ¨æ£€ç´¢ä¹‹å‰å·²ç»æ’å…¥ï¼‰ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</li>
<li><code>boolean startsWith(String prefix)</code> å¦‚æœä¹‹å‰å·²ç»æ’å…¥çš„å­—ç¬¦ä¸² <code>word</code> çš„å‰ç¼€ä¹‹ä¸€ä¸º <code>prefix</code>ï¼Œè¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;Trie&quot;, &quot;insert&quot;, &quot;search&quot;, &quot;search&quot;, &quot;startsWith&quot;, &quot;insert&quot;, &quot;search&quot;]</span><br><span class="line">[[], [&quot;apple&quot;], [&quot;apple&quot;], [&quot;app&quot;], [&quot;app&quot;], [&quot;app&quot;], [&quot;app&quot;]]</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">[null, null, true, false, true, null, true]</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">Trie trie = new Trie();</span><br><span class="line">trie.insert(&quot;apple&quot;);</span><br><span class="line">trie.search(&quot;apple&quot;);     // è¿”å› True</span><br><span class="line">trie.search(&quot;app&quot;);       // è¿”å› False</span><br><span class="line">trie.startsWith(&quot;app&quot;);   // è¿”å› True</span><br><span class="line">trie.insert(&quot;app&quot;);</span><br><span class="line">trie.search(&quot;app&quot;);       // è¿”å› True</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li><code>1 &lt;= word.length, prefix.length &lt;= 2000</code></li>
<li><code>word</code> å’Œ <code>prefix</code> ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li>
<li><code>insert</code>ã€<code>search</code> å’Œ <code>startsWith</code> è°ƒç”¨æ¬¡æ•°æ€»è®¡ä¸è¶…è¿‡ <code>3 * 10^4</code> æ¬¡</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>å®ç°ä¸€ä¸ª Trie å‰ç¼€æ ‘éœ€è¦æˆ‘ä»¬ç†è§£å…¶æ ¸å¿ƒæ•°æ®ç»“æ„å’Œæ“ä½œåŸç†ã€‚Trie æ ‘æ˜¯ä¸€ç§å¤šå‰æ ‘ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªå­—ç¬¦ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€èŠ‚ç‚¹çš„è·¯å¾„ä¸Šç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œå°±æ˜¯è¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="å…³é”®æ¦‚å¿µ">å…³é”®æ¦‚å¿µ</h3>
<ul>
<li><strong>èŠ‚ç‚¹ç»“æ„</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹åŒ…å«å¤šä¸ªå­èŠ‚ç‚¹ï¼ˆå¯¹åº”ä¸åŒå­—ç¬¦ï¼‰å’Œä¸€ä¸ªæ ‡å¿—ä½ï¼ˆæ ‡è®°æ˜¯å¦æ˜¯å•è¯ç»“å°¾ï¼‰</li>
<li><strong>è·¯å¾„è¡¨ç¤º</strong>ï¼šä»æ ¹åˆ°ä»»æ„èŠ‚ç‚¹çš„è·¯å¾„å¯¹åº”ä¸€ä¸ªå‰ç¼€</li>
<li><strong>æŸ¥æ‰¾æ•ˆç‡</strong>ï¼šæŸ¥æ‰¾ã€æ’å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(m)ï¼Œå…¶ä¸­ m æ˜¯å­—ç¬¦ä¸²é•¿åº¦</li>
</ul>
<h3 id="åŸºæœ¬å®ç°æ€è·¯">åŸºæœ¬å®ç°æ€è·¯</h3>
<ol>
<li>åˆ›å»ºä¸€ä¸ª Trie ç±»ï¼Œç»´æŠ¤ä¸€ä¸ªæ ¹èŠ‚ç‚¹</li>
<li>å®šä¹‰èŠ‚ç‚¹ç»“æ„ï¼ŒåŒ…å«å­èŠ‚ç‚¹æ˜ å°„å’Œå•è¯ç»“æŸæ ‡è®°</li>
<li>å®ç°æ’å…¥ã€æŸ¥æ‰¾ã€å‰ç¼€åŒ¹é…ä¸‰ä¸ªæ ¸å¿ƒæ“ä½œ</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="åˆå§‹å®ç°åŠå…¶é—®é¢˜">åˆå§‹å®ç°åŠå…¶é—®é¢˜</h3>
<p>æœ€åˆçš„å®ç°ä½¿ç”¨äº†ä¸€ä¸ªé•¿åº¦ä¸º 255 çš„æ•°ç»„æ¥è¡¨ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å¯èƒ½å­èŠ‚ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> TrieNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    children []*TrieNode <span class="comment">// é•¿åº¦ä¸º 255 çš„æ•°ç»„</span></span><br><span class="line">    flag     <span class="type">bool</span>        <span class="comment">// æ ‡è®°å•è¯ç»“æŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong>ç©ºé—´æµªè´¹</strong>ï¼šå¯¹äºåªåŒ…å«å°å†™å­—æ¯çš„é¢˜ç›®ï¼Œåˆ†é… 255 ä¸ªæŒ‡é’ˆï¼ˆè¦†ç›–æ•´ä¸ª ASCII èŒƒå›´ï¼‰æ˜¯æå¤§çš„æµªè´¹</li>
<li><strong>ç¼“å­˜æ•ˆç‡ä½</strong>ï¼šè¾ƒå¤§çš„èŠ‚ç‚¹ç»“æ„ä¼šå¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡é™ä½</li>
<li><strong>å†…å­˜åˆ†é…å¼€é”€</strong>ï¼šæ¯ä¸ªæ–°èŠ‚ç‚¹éƒ½éœ€è¦åˆ†é…å¤§é‡å†…å­˜ï¼Œå¢åŠ  GC å‹åŠ›</li>
</ul>
<h3 id="ä¼˜åŒ–æ–¹æ¡ˆ">ä¼˜åŒ–æ–¹æ¡ˆ</h3>
<p><strong>æ–¹æ¡ˆ1ï¼šå‡å°å­èŠ‚ç‚¹æ•°ç»„å¤§å°</strong></p>
<p>ç”±äºé¢˜ç›®æ˜ç¡®å­—ç¬¦ä¸²ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆï¼Œå¯ä»¥å°†æ•°ç»„å¤§å°ä» 255 å‡å°‘åˆ° 26ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> TrieNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    children [<span class="number">26</span>]*TrieNode <span class="comment">// åªé’ˆå¯¹å°å†™å­—æ¯ a-z</span></span><br><span class="line">    isEnd    <span class="type">bool</span>          <span class="comment">// æ ‡è®°å•è¯ç»“æŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ¡ˆ2ï¼šä½¿ç”¨å“ˆå¸Œè¡¨ä»£æ›¿å›ºå®šæ•°ç»„</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> TrieNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    children <span class="keyword">map</span>[<span class="type">rune</span>]*TrieNode <span class="comment">// ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨å­èŠ‚ç‚¹</span></span><br><span class="line">    isEnd    <span class="type">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ¡ˆæ¯”è¾ƒ</strong>ï¼š</p>
<ul>
<li>å¯¹äºæœ¬é¢˜ï¼ˆå­—ç¬¦é›†å°ä¸”ç¡®å®šï¼‰ï¼Œå›ºå®šå¤§å°çš„æ•°ç»„æ›´ä¼˜</li>
<li>å½“å­—ç¬¦é›†è¾ƒå¤§æˆ–ä¸ç¡®å®šæ—¶ï¼Œå“ˆå¸Œè¡¨æ–¹æ¡ˆæ›´çµæ´»</li>
</ul>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="ä¼˜åŒ–åçš„-Trie-å®ç°">ä¼˜åŒ–åçš„ Trie å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Trie <span class="keyword">struct</span> &#123;</span><br><span class="line">    root *TrieNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TrieNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    children [<span class="number">26</span>]*TrieNode <span class="comment">// åªé’ˆå¯¹å°å†™å­—æ¯ a-z</span></span><br><span class="line">    isEnd    <span class="type">bool</span>          <span class="comment">// æ ‡è®°å•è¯ç»“æŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span></span> Trie &#123;</span><br><span class="line">    <span class="keyword">return</span> Trie&#123;</span><br><span class="line">        root: &amp;TrieNode&#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Trie)</span></span> Insert(word <span class="type">string</span>) &#123;</span><br><span class="line">    node := this.root</span><br><span class="line">    <span class="keyword">for</span> _, ch := <span class="keyword">range</span> word &#123;</span><br><span class="line">        index := ch - <span class="string">&#x27;a&#x27;</span> <span class="comment">// å°†å­—ç¬¦æ˜ å°„åˆ°0-25çš„ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">if</span> node.children[index] == <span class="literal">nil</span> &#123;</span><br><span class="line">            node.children[index] = &amp;TrieNode&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        node = node.children[index]</span><br><span class="line">    &#125;</span><br><span class="line">    node.isEnd = <span class="literal">true</span> <span class="comment">// æ ‡è®°å•è¯ç»“æŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Trie)</span></span> Search(word <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    node := this.searchPrefix(word)</span><br><span class="line">    <span class="keyword">return</span> node != <span class="literal">nil</span> &amp;&amp; node.isEnd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Trie)</span></span> StartsWith(prefix <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.searchPrefix(prefix) != <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æå–å…¬å…±æŸ¥æ‰¾é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Trie)</span></span> searchPrefix(prefix <span class="type">string</span>) *TrieNode &#123;</span><br><span class="line">    node := this.root</span><br><span class="line">    <span class="keyword">for</span> _, ch := <span class="keyword">range</span> prefix &#123;</span><br><span class="line">        index := ch - <span class="string">&#x27;a&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> node.children[index] == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        node = node.children[index]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œç¤ºä¾‹">æ‰§è¡Œç¤ºä¾‹</h3>
<p>ä»¥ <code>insert(&quot;apple&quot;)</code> ä¸ºä¾‹ï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹</li>
<li>å¤„ç† â€˜aâ€™ï¼šè®¡ç®—ç´¢å¼•(0)ï¼Œåˆ›å»ºå¯¹åº”å­èŠ‚ç‚¹</li>
<li>å¤„ç† â€˜pâ€™ï¼šè®¡ç®—ç´¢å¼•(15)ï¼Œåˆ›å»ºå¯¹åº”å­èŠ‚ç‚¹</li>
<li>å¤„ç† â€˜pâ€™ï¼šä½¿ç”¨å·²å­˜åœ¨çš„ç´¢å¼•15å­èŠ‚ç‚¹</li>
<li>å¤„ç† â€˜lâ€™ï¼šè®¡ç®—ç´¢å¼•(11)ï¼Œåˆ›å»ºå¯¹åº”å­èŠ‚ç‚¹</li>
<li>å¤„ç† â€˜eâ€™ï¼šè®¡ç®—ç´¢å¼•(4)ï¼Œåˆ›å»ºå¯¹åº”å­èŠ‚ç‚¹</li>
<li>æ ‡è®° â€˜eâ€™ èŠ‚ç‚¹çš„ isEnd ä¸º trueï¼Œè¡¨ç¤º â€œappleâ€ æ˜¯ä¸€ä¸ªå®Œæ•´å•è¯</li>
</ol>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>åŸå§‹å®ç°</th>
<th>ä¼˜åŒ–å®ç°</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(m)</td>
<td>O(m)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(255*n)</td>
<td>O(26*n)</td>
</tr>
<tr>
<td>å†…å­˜ä½¿ç”¨</td>
<td>è¾ƒé«˜</td>
<td>é™ä½çº¦90%</td>
</tr>
<tr>
<td>ç¼“å­˜æ•ˆç‡</td>
<td>è¾ƒä½</td>
<td>è¾ƒé«˜</td>
</tr>
<tr>
<td>å®ç°å¤æ‚åº¦</td>
<td>ç®€å•</td>
<td>ç®€å•</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<ul>
<li><strong>æ’å…¥æ“ä½œ</strong>ï¼šO(m)ï¼Œå…¶ä¸­ m æ˜¯å•è¯é•¿åº¦</li>
<li><strong>æŸ¥æ‰¾æ“ä½œ</strong>ï¼šO(m)</li>
<li><strong>å‰ç¼€åŒ¹é…</strong>ï¼šO(m)</li>
</ul>
<p>ä¸Šè¿°æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯çº¿æ€§çš„ï¼Œä¸å•è¯é•¿åº¦æˆæ­£æ¯”ï¼Œè¿™æ˜¯æœ€ä¼˜çš„ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<ul>
<li><strong>åŸå§‹å®ç°</strong>ï¼šO(255*n)ï¼Œå…¶ä¸­ n æ˜¯æ‰€æœ‰æ’å…¥å•è¯çš„å­—ç¬¦æ€»æ•°</li>
<li><strong>ä¼˜åŒ–å®ç°</strong>ï¼šO(26*n)ï¼Œå‡å°‘äº†çº¦ 90% çš„ç©ºé—´ä½¿ç”¨</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>ç©ºé—´ä¼˜åŒ–å¾ˆé‡è¦</strong>ï¼šåœ¨å¤„ç†å¤§é‡æ•°æ®çš„æ ‘ç»“æ„æ—¶ï¼ŒèŠ‚ç‚¹è®¾è®¡å¯¹æ•´ä½“æ€§èƒ½å½±å“å·¨å¤§</li>
<li><strong>é’ˆå¯¹çº¦æŸä¼˜åŒ–</strong>ï¼šæ ¹æ®é¢˜ç›®çº¦æŸï¼ˆå¦‚å­—ç¬¦é›†é™åˆ¶ï¼‰æœ‰é’ˆå¯¹æ€§åœ°ä¼˜åŒ–æ•°æ®ç»“æ„</li>
<li><strong>æå–å…¬å…±é€»è¾‘</strong>ï¼šå°†é‡å¤çš„æœç´¢é€»è¾‘æå–ä¸ºå•ç‹¬æ–¹æ³•ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§</li>
<li><strong>å¸¸é‡çº§ä¼˜åŒ–</strong>ï¼šè™½ç„¶å¤æ‚åº¦çº§åˆ«ç›¸åŒï¼Œä½†å¸¸æ•°çº§ä¼˜åŒ–ï¼ˆå¦‚ä»255å‡å°‘åˆ°26ï¼‰åœ¨å®é™…æ‰§è¡Œä¸­èƒ½å¸¦æ¥æ˜¾è‘—æå‡</li>
</ol>
<h2 id="Trieçš„å¸¸è§åº”ç”¨">Trieçš„å¸¸è§åº”ç”¨</h2>
<ul>
<li><strong>è‡ªåŠ¨è¡¥å…¨</strong>ï¼šæœç´¢å¼•æ“ã€è¾“å…¥æ³•çš„å•è¯è¡¥å…¨åŠŸèƒ½</li>
<li><strong>æ‹¼å†™æ£€æŸ¥</strong>ï¼šæ£€æŸ¥å•è¯æ‹¼å†™æ˜¯å¦æ­£ç¡®</li>
<li><strong>å­—ç¬¦ä¸²åŒ¹é…</strong>ï¼šåœ¨å¤§é‡å­—ç¬¦ä¸²ä¸­å¿«é€ŸæŸ¥æ‰¾</li>
<li><strong>è·¯ç”±åŒ¹é…</strong>ï¼šWebæœåŠ¡å™¨çš„URLè·¯ç”±</li>
</ul>
<p>Trieæ ‘è™½ç„¶å®ç°ç®€å•ï¼Œä½†åœ¨å¤„ç†å­—ç¬¦ä¸²å‰ç¼€æŸ¥è¯¢æ–¹é¢æœ‰ç€æ— å¯æ¯”æ‹Ÿçš„ä¼˜åŠ¿ï¼Œæ˜¯ä¸€ç§éå¸¸å®ç”¨çš„æ•°æ®ç»“æ„ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å­—ç¬¦ä¸²</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>æ ‘</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>Trie</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£å¹‚ç­‰æ€§åŸç†åŠåº”ç”¨</title>
    <url>/2025/05/05/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%B9%82%E7%AD%89%E6%80%A7/2025-05-05-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%B9%82%E7%AD%89%E6%80%A7%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„æ—¥ç›Šæ™®åŠçš„ä»Šå¤©ï¼Œç³»ç»Ÿçš„å¯é æ€§ã€ä¸€è‡´æ€§å’Œå®¹é”™æ€§å˜å¾—å°¤ä¸ºé‡è¦ã€‚åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼Œ**å¹‚ç­‰æ€§(Idempotence)**ä½œä¸ºä¸€ç§æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼Œåœ¨ç¡®ä¿ç³»ç»Ÿå¯é æ€§æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚</p>
<p>æ— è®ºæ˜¯è®¾è®¡RESTful APIã€æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†ç³»ç»Ÿã€è¿˜æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼Œå¹‚ç­‰æ€§éƒ½æ˜¯æ„å»ºå¥å£®ç³»ç»Ÿçš„å…³é”®ç‰¹æ€§ã€‚æœ¬æ–‡å°†ç³»ç»Ÿåœ°ä»‹ç»å¹‚ç­‰æ€§æ¦‚å¿µï¼Œå¹¶é€šè¿‡å®é™…æ¡ˆä¾‹åˆ†æå…¶åœ¨å„ç§åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µã€‚</p>
<h2 id="å¹‚ç­‰æ€§çš„åŸºæœ¬æ¦‚å¿µ">å¹‚ç­‰æ€§çš„åŸºæœ¬æ¦‚å¿µ</h2>
<h3 id="å®šä¹‰ä¸èµ·æº">å®šä¹‰ä¸èµ·æº</h3>
<p>å¹‚ç­‰æ€§æœ€åˆæºè‡ªæ•°å­¦é¢†åŸŸï¼Œæè¿°äº†ä¸€ç§ç‰¹æ®Šçš„è¿ç®—æ€§è´¨ï¼šå¯¹äºæ“ä½œ $f$ï¼Œå¦‚æœæ»¡è¶³ $f(f(x)) = f(x)$ï¼Œåˆ™ç§° $f$ æ˜¯å¹‚ç­‰çš„ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ— è®ºå¯¹æŸä¸ªå…ƒç´ åº”ç”¨ä¸€æ¬¡æ“ä½œè¿˜æ˜¯å¤šæ¬¡æ“ä½œï¼Œç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚</p>
<p>åœ¨è®¡ç®—æœºç§‘å­¦å’Œç³»ç»Ÿè®¾è®¡ä¸­ï¼Œå¹‚ç­‰æ€§è¢«æ‰©å±•ä¸ºï¼š<strong>å¯¹ç³»ç»Ÿè¿›è¡Œä¸€æ¬¡æ“ä½œä¸å¤šæ¬¡é‡å¤åŒæ ·çš„æ“ä½œï¼Œäº§ç”Ÿçš„ç³»ç»ŸçŠ¶æ€å˜åŒ–æ˜¯ä¸€è‡´çš„</strong>ã€‚</p>
<h3 id="å¹‚ç­‰æ€§çš„æ ¸å¿ƒç‰¹å¾">å¹‚ç­‰æ€§çš„æ ¸å¿ƒç‰¹å¾</h3>
<ol>
<li><strong>ç»“æœä¸€è‡´æ€§</strong>ï¼šå¤šæ¬¡æ‰§è¡ŒåŒä¸€æ“ä½œï¼Œæœ€ç»ˆç³»ç»ŸçŠ¶æ€ç›¸åŒ</li>
<li><strong>å‰¯ä½œç”¨å¯æ§</strong>ï¼šé‡å¤æ“ä½œä¸ä¼šäº§ç”Ÿæ„å¤–çš„å‰¯ä½œç”¨</li>
<li><strong>çŠ¶æ€æ”¶æ•›</strong>ï¼šæ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œç³»ç»Ÿæœ€ç»ˆä¼šæ”¶æ•›åˆ°åŒä¸€çŠ¶æ€</li>
<li><strong>æ“ä½œå¯é‡è¯•</strong>ï¼šå¤±è´¥åå¯ä»¥å®‰å…¨åœ°è¿›è¡Œé‡è¯•</li>
</ol>
<h3 id="å¹‚ç­‰ä¸éå¹‚ç­‰æ“ä½œå¯¹æ¯”">å¹‚ç­‰ä¸éå¹‚ç­‰æ“ä½œå¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>å¹‚ç­‰æ“ä½œ</th>
<th>éå¹‚ç­‰æ“ä½œ</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¯»å–èµ„æº (GET)</td>
<td>åˆ›å»ºæ–°èµ„æº (POST)</td>
</tr>
<tr>
<td>è®¾ç½®èµ„æºä¸ºç‰¹å®šçŠ¶æ€</td>
<td>é€’å¢è®¡æ•°å™¨</td>
</tr>
<tr>
<td>åˆ é™¤ç‰¹å®šèµ„æº</td>
<td>å‘åˆ—è¡¨è¿½åŠ å…ƒç´ </td>
</tr>
<tr>
<td>æ ¹æ®æ¡ä»¶æ›´æ–°èµ„æº</td>
<td>æ— æ¡ä»¶è¿½åŠ æ•°æ®</td>
</tr>
</tbody>
</table>
<h2 id="ä¸ºä»€ä¹ˆå¹‚ç­‰æ€§å¦‚æ­¤é‡è¦ï¼Ÿ">ä¸ºä»€ä¹ˆå¹‚ç­‰æ€§å¦‚æ­¤é‡è¦ï¼Ÿ</h2>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œå¹‚ç­‰æ€§è§£å†³äº†è®¸å¤šå…³é”®æŒ‘æˆ˜ï¼š</p>
<h3 id="1-åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸ç¡®å®šæ€§">1. åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸ç¡®å®šæ€§</h3>
<p>åˆ†å¸ƒå¼ç¯å¢ƒä¸­å­˜åœ¨è¯¸å¤šä¸ç¡®å®šå› ç´ ï¼šç½‘ç»œå»¶è¿Ÿã€åˆ†åŒºã€èŠ‚ç‚¹æ•…éšœç­‰ã€‚è¿™äº›å› ç´ å¯èƒ½å¯¼è‡´ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯è¶…æ—¶åè¿›è¡Œé‡è¯•ï¼Œä½†åŸæ“ä½œå®é™…å·²æˆåŠŸ</li>
<li>æ¶ˆæ¯é‡å¤æŠ•é€’åˆ°æ¶ˆè´¹è€…</li>
<li>æœåŠ¡ä¹‹é—´çš„é€šä¿¡å¤±è´¥ï¼Œéœ€è¦é‡æ–°å‘é€è¯·æ±‚</li>
</ul>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¹‚ç­‰æ“ä½œç¡®ä¿ç³»ç»Ÿä¸ä¼šå› ä¸ºé‡å¤å¤„ç†è€Œè¿›å…¥ä¸ä¸€è‡´çŠ¶æ€ã€‚</p>
<h3 id="2-æå‡ç³»ç»Ÿå¯é æ€§">2. æå‡ç³»ç»Ÿå¯é æ€§</h3>
<ul>
<li><strong>ç®€åŒ–é”™è¯¯æ¢å¤</strong>ï¼šç³»ç»Ÿå¯ä»¥ç®€å•åœ°é‡è¯•å¤±è´¥çš„å¹‚ç­‰æ“ä½œï¼Œè€Œæ— éœ€å¤æ‚çš„è¡¥å¿é€»è¾‘</li>
<li><strong>å¢å¼ºå®¹é”™èƒ½åŠ›</strong>ï¼šå³ä½¿æŸäº›æ“ä½œé‡å¤æ‰§è¡Œï¼Œç³»ç»Ÿä¹Ÿèƒ½ä¿æŒä¸€è‡´çŠ¶æ€</li>
<li><strong>å‡å°‘æ•°æ®ä¸ä¸€è‡´é£é™©</strong>ï¼šé˜²æ­¢å› é‡è¯•å¯¼è‡´çš„æ•°æ®å¼‚å¸¸ï¼ˆå¦‚é‡å¤æ‰£æ¬¾ã€å¤šæ¬¡ä¸‹å•ï¼‰</li>
</ul>
<h3 id="3-æ”¹å–„ç”¨æˆ·ä½“éªŒ">3. æ”¹å–„ç”¨æˆ·ä½“éªŒ</h3>
<ul>
<li>é˜²æ­¢ç”¨æˆ·å› ç½‘ç»œé—®é¢˜å¯¼è‡´çš„&quot;åŒé‡æäº¤&quot;</li>
<li>å…è®¸ç”¨æˆ·å®‰å…¨åœ°åˆ·æ–°é¡µé¢æˆ–é‡è¯•æ“ä½œ</li>
<li>æä¾›æ›´å¯é¢„æµ‹å’Œä¸€è‡´çš„ç³»ç»Ÿè¡Œä¸º</li>
</ul>
<h2 id="HTTPæ–¹æ³•çš„å¹‚ç­‰æ€§åˆ†æ">HTTPæ–¹æ³•çš„å¹‚ç­‰æ€§åˆ†æ</h2>
<p>åœ¨RESTful APIè®¾è®¡ä¸­ï¼ŒHTTPæ–¹æ³•çš„å¹‚ç­‰æ€§æ˜¯ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡è€ƒé‡ï¼š</p>
<pre class="mermaid">graph TD
    A[HTTPæ–¹æ³•] --&gt; B{æ˜¯å¦å¹‚ç­‰?}
    B --&gt;|å¹‚ç­‰| C[GET]
    B --&gt;|å¹‚ç­‰| D[PUT]
    B --&gt;|å¹‚ç­‰| E[DELETE]
    B --&gt;|å¹‚ç­‰| F[HEAD]
    B --&gt;|å¹‚ç­‰| G[OPTIONS]
    B --&gt;|éå¹‚ç­‰| H[POST]
    B --&gt;|é€šå¸¸éå¹‚ç­‰| I[PATCH]</pre>
<h3 id="å¹‚ç­‰çš„HTTPæ–¹æ³•">å¹‚ç­‰çš„HTTPæ–¹æ³•</h3>
<table>
<thead>
<tr>
<th>HTTPæ–¹æ³•</th>
<th>å¹‚ç­‰æ€§</th>
<th>å®‰å…¨æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>âœ…</td>
<td>âœ…</td>
<td>åªæ£€ç´¢èµ„æºï¼Œä¸ä¿®æ”¹æœåŠ¡å™¨çŠ¶æ€</td>
</tr>
<tr>
<td>HEAD</td>
<td>âœ…</td>
<td>âœ…</td>
<td>ä¸GETç±»ä¼¼ï¼Œä½†åªè¿”å›å¤´ä¿¡æ¯</td>
</tr>
<tr>
<td>OPTIONS</td>
<td>âœ…</td>
<td>âœ…</td>
<td>è·å–èµ„æºæ”¯æŒçš„æ–¹æ³•ï¼Œä¸ä¿®æ”¹çŠ¶æ€</td>
</tr>
<tr>
<td>PUT</td>
<td>âœ…</td>
<td>âŒ</td>
<td>æ›¿æ¢ç›®æ ‡èµ„æºï¼Œé‡å¤æ“ä½œç»“æœç›¸åŒ</td>
</tr>
<tr>
<td>DELETE</td>
<td>âœ…</td>
<td>âŒ</td>
<td>åˆ é™¤èµ„æºï¼Œå¤šæ¬¡åˆ é™¤æ•ˆæœç›¸åŒ</td>
</tr>
</tbody>
</table>
<h3 id="éå¹‚ç­‰çš„HTTPæ–¹æ³•">éå¹‚ç­‰çš„HTTPæ–¹æ³•</h3>
<table>
<thead>
<tr>
<th>HTTPæ–¹æ³•</th>
<th>å¹‚ç­‰æ€§</th>
<th>å®‰å…¨æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>âŒ</td>
<td>âŒ</td>
<td>é€šå¸¸ç”¨äºåˆ›å»ºèµ„æºï¼Œå¤šæ¬¡è°ƒç”¨å¯èƒ½åˆ›å»ºå¤šä¸ªèµ„æº</td>
</tr>
<tr>
<td>PATCH</td>
<td>âŒ/âœ…</td>
<td>âŒ</td>
<td>éƒ¨åˆ†æ›´æ–°èµ„æºï¼Œæ ¹æ®å®ç°å¯èƒ½æ˜¯å¹‚ç­‰çš„</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ³¨æ„: è¿™é‡Œçš„&quot;å®‰å…¨æ€§&quot;æŒ‡çš„æ˜¯æ–¹æ³•æ˜¯å¦ä¼šä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œè€Œéå®‰å…¨é˜²æŠ¤æªæ–½ã€‚</p>
</blockquote>
<h2 id="APIè®¾è®¡ä¸­çš„å¹‚ç­‰æ€§å®ç°">APIè®¾è®¡ä¸­çš„å¹‚ç­‰æ€§å®ç°</h2>
<p>åœ¨APIè®¾è®¡ä¸­å®ç°å¹‚ç­‰æ€§æœ‰å¤šç§ç­–ç•¥ï¼Œä»¥ä¸‹æ˜¯ä¸‰ç§æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼š</p>
<h3 id="1-ä½¿ç”¨å¹‚ç­‰é”®-Idempotency-Keys">1. ä½¿ç”¨å¹‚ç­‰é”® (Idempotency Keys)</h3>
<p>ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦ï¼ŒæœåŠ¡å™¨è®°å½•å’Œæ£€æŸ¥è¿™äº›æ ‡è¯†ç¬¦ä»¥é˜²æ­¢é‡å¤å¤„ç†ï¼š</p>
<pre class="mermaid">sequenceDiagram
    participant å®¢æˆ·ç«¯
    participant æœåŠ¡å™¨
    participant æ•°æ®åº“
    
    å®¢æˆ·ç«¯-&gt;&gt;æœåŠ¡å™¨: POST /orders {idempotency-key: &quot;abc123&quot;, ...}
    æœåŠ¡å™¨-&gt;&gt;æ•°æ®åº“: æ£€æŸ¥key &quot;abc123&quot; æ˜¯å¦å·²å¤„ç†
    æ•°æ®åº“--&gt;&gt;æœåŠ¡å™¨: æœªå¤„ç†
    æœåŠ¡å™¨-&gt;&gt;æ•°æ®åº“: åˆ›å»ºè®¢å•å¹¶å­˜å‚¨ key &quot;abc123&quot;
    æ•°æ®åº“--&gt;&gt;æœåŠ¡å™¨: æˆåŠŸ
    æœåŠ¡å™¨--&gt;&gt;å®¢æˆ·ç«¯: 201 Created
    
    Note over å®¢æˆ·ç«¯,æœåŠ¡å™¨: ç½‘ç»œé—®é¢˜å¯¼è‡´å®¢æˆ·ç«¯è¶…æ—¶
    
    å®¢æˆ·ç«¯-&gt;&gt;æœåŠ¡å™¨: é‡è¯•ç›¸åŒè¯·æ±‚ {idempotency-key: &quot;abc123&quot;, ...}
    æœåŠ¡å™¨-&gt;&gt;æ•°æ®åº“: æ£€æŸ¥key &quot;abc123&quot; æ˜¯å¦å·²å¤„ç†
    æ•°æ®åº“--&gt;&gt;æœåŠ¡å™¨: å·²å¤„ç†
    æœåŠ¡å™¨--&gt;&gt;å®¢æˆ·ç«¯: è¿”å›ä¹‹å‰çš„å“åº”ç»“æœ</pre>
<p><strong>å…³é”®å®ç°ç‚¹</strong>ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ç”Ÿæˆå…¨å±€å”¯ä¸€çš„å¹‚ç­‰é”®ï¼ˆå¦‚UUIDï¼‰</li>
<li>æœåŠ¡å™¨å­˜å‚¨å·²å¤„ç†çš„å¹‚ç­‰é”®åŠå…¶å“åº”</li>
<li>å¯¹äºåŒ…å«ç›¸åŒå¹‚ç­‰é”®çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å­˜å‚¨çš„å“åº”</li>
<li>è®¾ç½®å¹‚ç­‰é”®çš„è¿‡æœŸç­–ç•¥ï¼ˆTTLï¼‰</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡å™¨ç«¯ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">const</span> processedRequests = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processOrder</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> idempotencyKey = req.<span class="property">headers</span>[<span class="string">&#x27;idempotency-key&#x27;</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!idempotencyKey) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Missing idempotency key&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ˜¯å¦å·²å¤„ç†è¿‡è¯¥è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">if</span> (processedRequests.<span class="title function_">has</span>(idempotencyKey)) &#123;</span><br><span class="line">    <span class="keyword">const</span> previousResponse = processedRequests.<span class="title function_">get</span>(idempotencyKey);</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(previousResponse.<span class="property">status</span>).<span class="title function_">send</span>(previousResponse.<span class="property">data</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¤„ç†æ–°è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºè®¢å•é€»è¾‘...</span></span><br><span class="line">    <span class="keyword">const</span> order = <span class="title function_">createOrder</span>(req.<span class="property">body</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜å“åº”ä»¥å¤‡åç»­é‡è¯•</span></span><br><span class="line">    processedRequests.<span class="title function_">set</span>(idempotencyKey, &#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">201</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123; <span class="attr">orderId</span>: order.<span class="property">id</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">send</span>(&#123; <span class="attr">orderId</span>: order.<span class="property">id</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†é”™è¯¯...</span></span><br><span class="line">    processedRequests.<span class="title function_">set</span>(idempotencyKey, &#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">500</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123; <span class="attr">error</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(&#123; <span class="attr">error</span>: error.<span class="property">message</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-æ¡ä»¶è¯·æ±‚ä¸ä¹è§‚é”">2. æ¡ä»¶è¯·æ±‚ä¸ä¹è§‚é”</h3>
<p>ä½¿ç”¨HTTPæ¡ä»¶è¯·æ±‚å¤´å’Œèµ„æºç‰ˆæœ¬æ§åˆ¶æ¥ç¡®ä¿å¹‚ç­‰æ›´æ–°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯ä»£ç ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateUser</span>(<span class="params">userId, userData</span>) &#123;</span><br><span class="line">  <span class="comment">// å…ˆè·å–å½“å‰èµ„æºçŠ¶æ€å’ŒETag</span></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/users/<span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">const</span> etag = response.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&#x27;ETag&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä½¿ç”¨If-Matchå¤´è¿›è¡Œæ¡ä»¶æ›´æ–°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">fetch</span>(<span class="string">`/users/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;If-Match&#x27;</span>: etag</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(userData)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>é˜²æ­¢å¹¶å‘æ›´æ–°å¯¼è‡´çš„æ•°æ®è¦†ç›–</li>
<li>ç¬¦åˆHTTPæ ‡å‡†ï¼Œä¸éœ€è¦é¢å¤–çš„å­˜å‚¨æœºåˆ¶</li>
<li>å®¢æˆ·ç«¯å¯ä»¥æ£€æµ‹åˆ°èµ„æºå·²è¢«ä¿®æ”¹å¹¶ä½œå‡ºç›¸åº”å¤„ç†</li>
</ul>
<h3 id="3-ä½¿ç”¨ä¸šåŠ¡è‡ªç„¶é”®">3. ä½¿ç”¨ä¸šåŠ¡è‡ªç„¶é”®</h3>
<p>åˆ©ç”¨ä¸šåŠ¡é¢†åŸŸçš„è‡ªç„¶å”¯ä¸€æ ‡è¯†ç¬¦æ¥ç¡®ä¿å¹‚ç­‰æ€§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ä¸šåŠ¡è‡ªç„¶é”®ä½œä¸ºèµ„æºæ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="comment">// POST /users</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;email&quot;</span>: <span class="string">&quot;user@example.com&quot;</span>,  <span class="comment">// ç”¨ä½œè‡ªç„¶é”®</span></span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">  <span class="string">&quot;role&quot;</span>: <span class="string">&quot;admin&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœåŠ¡å™¨ç«¯ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createUser</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; email, name, role &#125; = req.<span class="property">body</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">const</span> existingUser = <span class="title function_">findUserByEmail</span>(email);</span><br><span class="line">  <span class="keyword">if</span> (existingUser) &#123;</span><br><span class="line">    <span class="comment">// ç”¨æˆ·å·²å­˜åœ¨ï¼Œè¿”å›ç°æœ‰ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(existingUser);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºæ–°ç”¨æˆ·</span></span><br><span class="line">  <span class="keyword">const</span> newUser = <span class="title function_">createNewUser</span>(email, name, role);</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">send</span>(newUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·æ³¨å†Œï¼ˆé‚®ç®±ä½œä¸ºè‡ªç„¶é”®ï¼‰</li>
<li>äº§å“ç›®å½•ï¼ˆäº§å“ç¼–ç ä½œä¸ºè‡ªç„¶é”®ï¼‰</li>
<li>é…ç½®é¡¹ï¼ˆé…ç½®é”®ä½œä¸ºè‡ªç„¶é”®ï¼‰</li>
</ul>
<h2 id="åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¹‚ç­‰æ€§">åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¹‚ç­‰æ€§</h2>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¹‚ç­‰æ€§æ˜¯ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œæ•°æ®ä¸€è‡´æ€§çš„å…³é”®æœºåˆ¶ã€‚</p>
<h3 id="æ¶ˆæ¯é˜Ÿåˆ—ä¸äº‹ä»¶å¤„ç†">æ¶ˆæ¯é˜Ÿåˆ—ä¸äº‹ä»¶å¤„ç†</h3>
<p>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ˆå¦‚Kafkaã€RabbitMQï¼‰é€šå¸¸ä¼šåœ¨ç½‘ç»œæ•…éšœåé‡è¯•æ¶ˆæ¯æŠ•é€’ï¼Œè€Œæ¶ˆè´¹è€…å¿…é¡»å‡†å¤‡å¥½å¤„ç†é‡å¤æ¶ˆæ¯ï¼š</p>
<pre class="mermaid">flowchart LR
    A[ç”Ÿäº§è€…] --&gt;|å‘é€æ¶ˆæ¯| B[æ¶ˆæ¯é˜Ÿåˆ—]
    B --&gt;|æŠ•é€’æ¶ˆæ¯| C[æ¶ˆè´¹è€…]
    C --&gt;|å¤„ç†æ¶ˆæ¯| D{æ˜¯å¦å¹‚ç­‰å¤„ç†?}
    D --&gt;|æ˜¯| E[å®‰å…¨é‡å¤å¤„ç†]
    D --&gt;|å¦| F[å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´]</pre>
<p><strong>éå¹‚ç­‰ä¸å¹‚ç­‰æ¶ˆè´¹è€…å¯¹æ¯”</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éå¹‚ç­‰æ¶ˆè´¹è€…ç¤ºä¾‹ï¼ˆæœ‰é—®é¢˜ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processPayment</span><span class="params">(PaymentMessage message)</span> &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥å¤„ç†ä»˜æ¬¾ - é‡å¤å¤„ç†ä¼šå¯¼è‡´å¤šæ¬¡ä»˜æ¬¾</span></span><br><span class="line">    paymentService.deductAmount(message.getAccountId(), message.getAmount());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹‚ç­‰æ¶ˆè´¹è€…ç¤ºä¾‹ï¼ˆå®‰å…¨ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processPayment</span><span class="params">(PaymentMessage message)</span> &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ”¯ä»˜IDæ˜¯å¦å·²å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (paymentRepository.existsById(message.getPaymentId())) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Payment &#123;&#125; already processed, skipping&quot;</span>, message.getPaymentId());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†ä»˜æ¬¾å¹¶è®°å½•å·²å¤„ç†çš„æ”¯ä»˜ID</span></span><br><span class="line">    paymentService.deductAmount(message.getAccountId(), message.getAmount());</span><br><span class="line">    paymentRepository.saveProcessedId(message.getPaymentId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å®ç°æ¶ˆæ¯é˜Ÿåˆ—å¹‚ç­‰æ€§çš„ç­–ç•¥">å®ç°æ¶ˆæ¯é˜Ÿåˆ—å¹‚ç­‰æ€§çš„ç­–ç•¥</h3>
<ol>
<li><strong>å”¯ä¸€æ¶ˆæ¯ID</strong>ï¼šä¸ºæ¯æ¡æ¶ˆæ¯åˆ†é…å…¨å±€å”¯ä¸€ID</li>
<li><strong>æ¶ˆæ¯å»é‡è¡¨</strong>ï¼šåœ¨æ¶ˆè´¹è€…ç«¯ç»´æŠ¤å·²å¤„ç†æ¶ˆæ¯IDçš„è®°å½•</li>
<li><strong>ä¸šåŠ¡çŠ¶æ€æ£€æŸ¥</strong>ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€åˆ¤æ–­æ˜¯å¦å·²å¤„ç†</li>
<li><strong>å¹‚ç­‰æ€§çª—å£æœŸ</strong>ï¼šä»…åœ¨ç‰¹å®šæ—¶é—´çª—å£å†…è¿›è¡Œå»é‡å¤„ç†</li>
</ol>
<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„å¹‚ç­‰æ€§">åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„å¹‚ç­‰æ€§</h3>
<p>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œå¹‚ç­‰æ“ä½œå¯ä»¥æå¤§ç®€åŒ–è¡¥å¿é€»è¾‘å’Œæ•…éšœæ¢å¤ï¼š</p>
<pre class="mermaid">sequenceDiagram
    participant æœåŠ¡A
    participant æœåŠ¡B
    participant æœåŠ¡C
    
    Note over æœåŠ¡A,æœåŠ¡C: åˆ†å¸ƒå¼äº‹åŠ¡å¼€å§‹
    
    æœåŠ¡A-&gt;&gt;æœåŠ¡B: æ“ä½œ1 (å¹‚ç­‰)
    æœåŠ¡B--&gt;&gt;æœåŠ¡A: æˆåŠŸ
    æœåŠ¡A-&gt;&gt;æœåŠ¡C: æ“ä½œ2 (å¹‚ç­‰)
    
    Note over æœåŠ¡C: æœåŠ¡Cå¤±è´¥
    æœåŠ¡C--&gt;&gt;æœåŠ¡A: å¤±è´¥
    
    Note over æœåŠ¡A,æœåŠ¡C: é‡è¯•æ•´ä¸ªäº‹åŠ¡
    
    æœåŠ¡A-&gt;&gt;æœåŠ¡B: æ“ä½œ1 (å¹‚ç­‰é‡è¯•)
    æœåŠ¡B--&gt;&gt;æœåŠ¡A: æˆåŠŸ (æ— å‰¯ä½œç”¨)
    æœåŠ¡A-&gt;&gt;æœåŠ¡C: æ“ä½œ2 (å¹‚ç­‰é‡è¯•)
    æœåŠ¡C--&gt;&gt;æœåŠ¡A: æˆåŠŸ
    
    Note over æœåŠ¡A,æœåŠ¡C: äº‹åŠ¡å®Œæˆ</pre>
<h3 id="å¾®æœåŠ¡æ¶æ„ä¸­çš„å¹‚ç­‰æ€§ä¼ æ’­">å¾®æœåŠ¡æ¶æ„ä¸­çš„å¹‚ç­‰æ€§ä¼ æ’­</h3>
<p>åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾ä¸­ï¼Œå¹‚ç­‰æ€§åº”å½“ä»æœ€å¤–å±‚APIä¸€ç›´ä¼ æ’­åˆ°æ‰€æœ‰ä¸‹æ¸¸æœåŠ¡ï¼š</p>
<ol>
<li><strong>å¹‚ç­‰é”®ä¼ æ’­</strong>ï¼šä¸Šæ¸¸æœåŠ¡ç”Ÿæˆçš„å¹‚ç­‰é”®é€šè¿‡è¯·æ±‚å¤´æˆ–æ¶ˆæ¯å±æ€§ä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡</li>
<li><strong>å…¨é“¾è·¯è·Ÿè¸ª</strong>ï¼šä½¿ç”¨åˆ†å¸ƒå¼è¿½è¸ªå·¥å…·ï¼ˆå¦‚Jaegerã€Zipkinï¼‰æ¥è·Ÿè¸ªè¯·æ±‚åœ¨æœåŠ¡é—´çš„æµè½¬</li>
<li><strong>ä¸€è‡´æ€§å“ˆå¸Œ</strong>ï¼šç¡®ä¿ç›¸åŒè¯·æ±‚å§‹ç»ˆè·¯ç”±åˆ°ç›¸åŒæœåŠ¡å®ä¾‹</li>
</ol>
<h2 id="åŸºç¡€è®¾æ–½ä¸­çš„å¹‚ç­‰æ€§">åŸºç¡€è®¾æ–½ä¸­çš„å¹‚ç­‰æ€§</h2>
<h3 id="Infrastructure-as-Code-IaC">Infrastructure as Code (IaC)</h3>
<p>ç°ä»£åŸºç¡€è®¾æ–½å·¥å…·å¦‚Terraformã€Ansibleé€šè¿‡å£°æ˜å¼é…ç½®å®ç°å¹‚ç­‰æ€§æ“ä½œï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Ansibleå¹‚ç­‰ä»»åŠ¡ç¤ºä¾‹</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ç¡®ä¿Nginxå·²å®‰è£…</span></span><br><span class="line">  <span class="attr">apt:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ç¡®ä¿NginxæœåŠ¡è¿è¡Œ</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<p>Terraformç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¹‚ç­‰çš„Terraformé…ç½®</span><br><span class="line">resource &quot;aws_s3_bucket&quot; &quot;example_bucket&quot; &#123;</span><br><span class="line">  bucket = &quot;example-bucket&quot;</span><br><span class="line">  acl    = &quot;private&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;aws_iam_user&quot; &quot;example_user&quot; &#123;</span><br><span class="line">  name = &quot;example-user&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å®¹å™¨ç¼–æ’ä¸Kubernetes">å®¹å™¨ç¼–æ’ä¸Kubernetes</h3>
<p>Kubernetesä»¥å£°æ˜å¼APIä¸ºç‰¹è‰²ï¼Œä½¿åŸºç¡€è®¾æ–½å˜æ›´å…·æœ‰å¹‚ç­‰æ€§ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Kuberneteså¹‚ç­‰èµ„æºå®šä¹‰</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.14.2</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<h2 id="å¹‚ç­‰æ€§å®ç°çš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ">å¹‚ç­‰æ€§å®ç°çš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 id="å¸¸è§æŒ‘æˆ˜">å¸¸è§æŒ‘æˆ˜</h3>
<ol>
<li><strong>å¹¶å‘å¤„ç†</strong>: å¤šä¸ªè¯·æ±‚åŒæ—¶åˆ°è¾¾æ—¶å¦‚ä½•ç¡®ä¿å¹‚ç­‰æ€§</li>
<li><strong>å¹‚ç­‰é”®å­˜å‚¨</strong>: å¦‚ä½•é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥è¯¢å¹‚ç­‰é”®</li>
<li><strong>è·¨æœåŠ¡å¹‚ç­‰</strong>: å¦‚ä½•åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ä¼ æ’­å¹‚ç­‰æ€§</li>
<li><strong>é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ</strong>: å¦‚ä½•å¤„ç†é•¿æ—¶é—´è¿è¡Œæ“ä½œçš„å¹‚ç­‰æ€§</li>
<li><strong>å¹‚ç­‰ä¸ä¸šåŠ¡è§„åˆ™å†²çª</strong>: æŸäº›ä¸šåŠ¡åœºæ™¯å¯èƒ½æœ¬è´¨ä¸Šä¸æ˜¯å¹‚ç­‰çš„</li>
</ol>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<h4 id="1-å¹¶å‘é—®é¢˜">1. å¹¶å‘é—®é¢˜</h4>
<p>å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘é€å¹‚ç­‰è¯·æ±‚æ—¶ï¼Œå¯èƒ½å¯¼è‡´ç«æ€æ¡ä»¶ï¼š</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li><strong>åˆ†å¸ƒå¼é”</strong>: ä½¿ç”¨Redisã€ZooKeeperå®ç°åˆ†å¸ƒå¼é”</li>
<li><strong>ä¹è§‚é”</strong>: ä½¿ç”¨ç‰ˆæœ¬å·æˆ–æ¡ä»¶æ›´æ–°é˜²æ­¢å¹¶å‘å†²çª</li>
<li><strong>å”¯ä¸€çº¦æŸ</strong>: åœ¨æ•°æ®åº“å±‚ä½¿ç”¨å”¯ä¸€çº¦æŸç¡®ä¿å¹‚ç­‰</li>
<li><strong>äº‹åŠ¡éš”ç¦»</strong>: é€‰æ‹©é€‚å½“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆå¦‚SERIALIZABLEï¼‰</li>
</ul>
<h4 id="2-å¹‚ç­‰é”®ç®¡ç†">2. å¹‚ç­‰é”®ç®¡ç†</h4>
<p>å¹‚ç­‰é”®çš„ç”Ÿæˆã€å­˜å‚¨å’Œè¿‡æœŸç­–ç•¥éœ€è¦ä»”ç»†è®¾è®¡ï¼š</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li><strong>å®¢æˆ·ç«¯ç”Ÿæˆ</strong>: åœ¨å®¢æˆ·ç«¯ç”ŸæˆUUIDä½œä¸ºå¹‚ç­‰é”®</li>
<li><strong>TTLæœºåˆ¶</strong>: å®ç°å¹‚ç­‰é”®çš„è‡ªåŠ¨è¿‡æœŸæœºåˆ¶</li>
<li><strong>åˆ†åŒºå­˜å‚¨</strong>: æ ¹æ®æ—¶é—´æˆ–ä¸šåŠ¡ç»´åº¦åˆ†åŒºå­˜å‚¨å¹‚ç­‰é”®</li>
<li><strong>å¼‚æ­¥æ¸…ç†</strong>: å®šæœŸæ¸…ç†è¿‡æœŸçš„å¹‚ç­‰é”®è®°å½•</li>
</ul>
<h4 id="3-ç³»ç»Ÿè¾¹ç•Œä¸å¹‚ç­‰æ€§ä¼ æ’­">3. ç³»ç»Ÿè¾¹ç•Œä¸å¹‚ç­‰æ€§ä¼ æ’­</h4>
<p>åœ¨å¤æ‚ç³»ç»Ÿä¸­ç»´æŒç«¯åˆ°ç«¯çš„å¹‚ç­‰æ€§ï¼š</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li><strong>è¯·æ±‚ä¸Šä¸‹æ–‡</strong>: åœ¨æ•´ä¸ªè°ƒç”¨é“¾ä¸­ä¼ é€’è¯·æ±‚ä¸Šä¸‹æ–‡ï¼ˆåŒ…å«å¹‚ç­‰é”®ï¼‰</li>
<li><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>: ä½¿ç”¨TCCæˆ–Sagaæ¨¡å¼ç¡®ä¿åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§</li>
<li><strong>è¡¥å¿é€»è¾‘</strong>: ä¸ºéå¹‚ç­‰æ“ä½œè®¾è®¡è¡¥å¿é€»è¾‘</li>
<li><strong>å¼‚æ­¥ç¡®è®¤</strong>: ä½¿ç”¨ç¡®è®¤/å›æ‰§æœºåˆ¶é˜²æ­¢é‡å¤å¤„ç†</li>
</ul>
<h2 id="å®é™…åº”ç”¨æ¡ˆä¾‹">å®é™…åº”ç”¨æ¡ˆä¾‹</h2>
<h3 id="æ¡ˆä¾‹1ï¼šæ”¯ä»˜ç³»ç»Ÿçš„å¹‚ç­‰æ€§">æ¡ˆä¾‹1ï¼šæ”¯ä»˜ç³»ç»Ÿçš„å¹‚ç­‰æ€§</h3>
<p>æ”¯ä»˜å¤„ç†æ˜¯å¹‚ç­‰æ€§çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼ŒåŒä¸€ç¬”æ”¯ä»˜ä¸èƒ½é‡å¤æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> PaymentResponse <span class="title function_">processPayment</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ”¯ä»˜IDçš„è®°å½•</span></span><br><span class="line">    <span class="keyword">if</span> (paymentRepository.existsByPaymentId(request.getPaymentId())) &#123;</span><br><span class="line">        <span class="comment">// è¿”å›å·²å­˜åœ¨çš„æ”¯ä»˜ç»“æœ</span></span><br><span class="line">        <span class="type">Payment</span> <span class="variable">existingPayment</span> <span class="operator">=</span> paymentRepository.findByPaymentId(request.getPaymentId());</span><br><span class="line">        <span class="keyword">return</span> mapToResponse(existingPayment);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ–°æ”¯ä»˜</span></span><br><span class="line">    <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>();</span><br><span class="line">    payment.setPaymentId(request.getPaymentId());</span><br><span class="line">    payment.setAmount(request.getAmount());</span><br><span class="line">    payment.setStatus(PaymentStatus.PROCESSING);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜åˆå§‹çŠ¶æ€</span></span><br><span class="line">    paymentRepository.save(payment);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨æ”¯ä»˜ç½‘å…³</span></span><br><span class="line">        <span class="type">PaymentGatewayResponse</span> <span class="variable">gatewayResponse</span> <span class="operator">=</span> paymentGateway.processPayment(</span><br><span class="line">            request.getPaymentMethod(),</span><br><span class="line">            request.getAmount()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ›´æ–°æ”¯ä»˜çŠ¶æ€</span></span><br><span class="line">        payment.setStatus(gatewayResponse.isSuccessful() ? </span><br><span class="line">                          PaymentStatus.COMPLETED : PaymentStatus.FAILED);</span><br><span class="line">        payment.setTransactionId(gatewayResponse.getTransactionId());</span><br><span class="line">        paymentRepository.save(payment);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> mapToResponse(payment);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// æ›´æ–°æ”¯ä»˜çŠ¶æ€ä¸ºå¤±è´¥</span></span><br><span class="line">        payment.setStatus(PaymentStatus.FAILED);</span><br><span class="line">        payment.setFailureReason(e.getMessage());</span><br><span class="line">        paymentRepository.save(payment);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PaymentException</span>(<span class="string">&quot;Payment processing failed&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ¡ˆä¾‹2ï¼šåº“å­˜ç®¡ç†ç³»ç»Ÿ">æ¡ˆä¾‹2ï¼šåº“å­˜ç®¡ç†ç³»ç»Ÿ</h3>
<p>ç”µå­å•†åŠ¡ç³»ç»Ÿä¸­çš„åº“å­˜ç®¡ç†å¿…é¡»ç¡®ä¿ä¸ä¼šå¤šæ¬¡æ‰£å‡åŒä¸€è®¢å•çš„åº“å­˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrderInventory</span><span class="params">(OrderInventoryRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥è®¢å•IDæ˜¯å¦å·²å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (inventoryTransactionRepository.existsByOrderId(request.getOrderId())) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order &#123;&#125; inventory already processed&quot;</span>, request.getOrderId());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†åº“å­˜</span></span><br><span class="line">    <span class="keyword">for</span> (OrderItem item : request.getItems()) &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productRepository.findById(item.getProductId())</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ProductNotFoundException</span>(item.getProductId()));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥åº“å­˜</span></span><br><span class="line">        <span class="keyword">if</span> (product.getAvailableStock() &lt; item.getQuantity()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientStockException</span>(product.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‡å°‘åº“å­˜</span></span><br><span class="line">        product.setAvailableStock(product.getAvailableStock() - item.getQuantity());</span><br><span class="line">        productRepository.save(product);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•åº“å­˜äº¤æ˜“</span></span><br><span class="line">        <span class="type">InventoryTransaction</span> <span class="variable">transaction</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InventoryTransaction</span>();</span><br><span class="line">        transaction.setOrderId(request.getOrderId());</span><br><span class="line">        transaction.setProductId(product.getId());</span><br><span class="line">        transaction.setQuantity(item.getQuantity());</span><br><span class="line">        transaction.setType(TransactionType.DEDUCT);</span><br><span class="line">        transaction.setTimestamp(LocalDateTime.now());</span><br><span class="line">        inventoryTransactionRepository.save(transaction);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¹‚ç­‰æ€§è®¾è®¡æœ€ä½³å®è·µ">å¹‚ç­‰æ€§è®¾è®¡æœ€ä½³å®è·µ</h2>
<h3 id="ç³»ç»Ÿè®¾è®¡é˜¶æ®µ">ç³»ç»Ÿè®¾è®¡é˜¶æ®µ</h3>
<ol>
<li><strong>æ˜ç¡®å¹‚ç­‰æ€§éœ€æ±‚</strong>ï¼šåœ¨è®¾è®¡é˜¶æ®µè¯†åˆ«å“ªäº›æ“ä½œéœ€è¦å¹‚ç­‰æ€§</li>
<li><strong>é€‰æ‹©åˆé€‚çš„å¹‚ç­‰ç­–ç•¥</strong>ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©æœ€é€‚åˆçš„å¹‚ç­‰å®ç°æ–¹å¼</li>
<li><strong>ç»Ÿä¸€å¹‚ç­‰æœºåˆ¶</strong>ï¼šåœ¨æ•´ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨ç»Ÿä¸€çš„å¹‚ç­‰æ€§å¤„ç†æ¡†æ¶</li>
<li><strong>è€ƒè™‘æ€§èƒ½å½±å“</strong>ï¼šè¯„ä¼°å¹‚ç­‰æ€§å®ç°å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“</li>
<li><strong>è®¾è®¡å¼‚å¸¸å¤„ç†</strong>ï¼šåˆç†å¤„ç†å¹‚ç­‰æ€§æ£€æŸ¥è¿‡ç¨‹ä¸­çš„å¼‚å¸¸æƒ…å†µ</li>
</ol>
<h3 id="APIè®¾è®¡">APIè®¾è®¡</h3>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨å¹‚ç­‰HTTPæ–¹æ³•</strong>ï¼šå°½å¯èƒ½ä½¿ç”¨GETã€PUTã€DELETEç­‰å¹‚ç­‰æ–¹æ³•</li>
<li><strong>æ–‡æ¡£åŒ–å¹‚ç­‰æ€§è¡Œä¸º</strong>ï¼šåœ¨APIæ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜æ¯ä¸ªæ¥å£çš„å¹‚ç­‰æ€§ç‰¹æ€§</li>
<li><strong>æ ‡å‡†åŒ–å¹‚ç­‰é”®å¤„ç†</strong>ï¼šå®šä¹‰æ¸…æ™°çš„å¹‚ç­‰é”®æ ¼å¼å’Œå¤„ç†è§„èŒƒ</li>
<li><strong>å®ç°è¯·æ±‚å»é‡</strong>ï¼šä¸ºéå¹‚ç­‰æ¥å£å®ç°è¯·æ±‚å»é‡æœºåˆ¶</li>
<li><strong>é‡è¯•ç­–ç•¥</strong>ï¼šä¸ºå®¢æˆ·ç«¯æä¾›æ˜ç¡®çš„é‡è¯•æŒ‡å¯¼</li>
</ol>
<h3 id="å®ç°ä¸æµ‹è¯•">å®ç°ä¸æµ‹è¯•</h3>
<ol>
<li><strong>ç¼–å†™å¹‚ç­‰æ€§æµ‹è¯•</strong>ï¼šä¸“é—¨æµ‹è¯•ç³»ç»Ÿåœ¨é‡å¤æ“ä½œä¸‹çš„è¡Œä¸º</li>
<li><strong>æ¨¡æ‹Ÿç½‘ç»œæ•…éšœ</strong>ï¼šæµ‹è¯•åœ¨å„ç§ç½‘ç»œæ•…éšœåœºæ™¯ä¸‹çš„ç³»ç»Ÿè¡Œä¸º</li>
<li><strong>å‹åŠ›æµ‹è¯•</strong>ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æµ‹è¯•å¹‚ç­‰æ€§æœºåˆ¶çš„æœ‰æ•ˆæ€§</li>
<li><strong>å®¡è®¡ä¸ç›‘æ§</strong>ï¼šè®°å½•å’Œç›‘æ§å¹‚ç­‰æ€§ç›¸å…³çš„äº‹ä»¶å’ŒæŒ‡æ ‡</li>
<li><strong>å®šæœŸå®¡æŸ¥</strong>ï¼šå®šæœŸå®¡æŸ¥å¹‚ç­‰æœºåˆ¶çš„æœ‰æ•ˆæ€§å’Œæ€§èƒ½</li>
</ol>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å¹‚ç­‰æ€§æ˜¯ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­ç¡®ä¿å¯é æ€§å’Œä¸€è‡´æ€§çš„æ ¸å¿ƒåŸåˆ™ã€‚é€šè¿‡åœ¨APIè®¾è®¡ã€æ¶ˆæ¯å¤„ç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ç­‰å„ä¸ªå±‚é¢å®ç°å¹‚ç­‰æ€§ï¼Œç³»ç»Ÿå¯ä»¥æ›´å¥½åœ°åº”å¯¹ç½‘ç»œä¸ç¨³å®šæ€§ã€æœåŠ¡æ•…éšœå’Œå¹¶å‘æ“ä½œç­‰æŒ‘æˆ˜ã€‚</p>
<p>å…³é”®æ”¶ç›ŠåŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>æé«˜ç³»ç»Ÿå¯é æ€§</strong>ï¼šå³ä½¿åœ¨ç½‘ç»œä¸ç¨³å®šæˆ–æœåŠ¡æ•…éšœçš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¹Ÿèƒ½ä¿æŒæ•°æ®ä¸€è‡´æ€§</li>
<li><strong>ç®€åŒ–é”™è¯¯å¤„ç†</strong>ï¼šå®¢æˆ·ç«¯å¯ä»¥å®‰å…¨åœ°è¿›è¡Œé‡è¯•ï¼Œè€Œæ— éœ€æ‹…å¿ƒå‰¯ä½œç”¨</li>
<li><strong>æ”¹å–„ç”¨æˆ·ä½“éªŒ</strong>ï¼šé˜²æ­¢å› ç½‘ç»œé—®é¢˜æˆ–ç”¨æˆ·é‡å¤æ“ä½œå¯¼è‡´çš„æ•°æ®é”™è¯¯</li>
<li><strong>æ”¯æŒè‡ªåŠ¨åŒ–</strong>ï¼šä½¿è‡ªåŠ¨åŒ–è„šæœ¬å’Œå·¥å…·èƒ½å¤Ÿå®‰å…¨åœ°é‡å¤æ‰§è¡Œ</li>
<li><strong>é™ä½è¿ç»´å¤æ‚åº¦</strong>ï¼šç®€åŒ–æ•…éšœæ¢å¤å’Œç³»ç»Ÿç»´æŠ¤æµç¨‹</li>
</ol>
<p>å¹‚ç­‰æ€§ä¸ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯æ¦‚å¿µï¼Œæ›´æ˜¯ä¸€ç§ç³»ç»Ÿè®¾è®¡å“²å­¦ã€‚åœ¨è®¾è®¡æ–°ç³»ç»Ÿæˆ–æ”¹è¿›ç°æœ‰ç³»ç»Ÿæ—¶ï¼Œå°†å¹‚ç­‰æ€§ä½œä¸ºæ ¸å¿ƒè®¾è®¡åŸåˆ™ä¹‹ä¸€ï¼Œå¯ä»¥å¤§å¹…æé«˜ç³»ç»Ÿçš„å¥å£®æ€§å’Œå¯é æ€§ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://medium.com/cache-me-out/understanding-idempotency-68a50a837fc1">Understanding Idempotency</a></li>
<li><a href="https://hackernoon.com/the-idempotence-principle-in-software-architecture">The Idempotence Principle in Software Architecture</a></li>
<li><a href="https://restfulapi.net/idempotent-rest-apis/">REST API Design: Idempotent Operations</a></li>
<li><a href="https://www.confluent.io/blog/idempotent-kafka-consumers/">Idempotency Patterns in Event-Driven Systems</a></li>
<li><a href="https://tools.ietf.org/html/rfc7231#section-4.2.2">HTTP Semantics: Idempotent Methods</a></li>
</ul>
]]></content>
      <categories>
        <category>ç³»ç»Ÿè®¾è®¡</category>
      </categories>
      <tags>
        <tag>æ¶æ„è®¾è®¡</tag>
        <tag>APIè®¾è®¡</tag>
        <tag>åˆ†å¸ƒå¼ç³»ç»Ÿ</tag>
        <tag>å¹‚ç­‰æ€§</tag>
        <tag>RESTful API</tag>
        <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
        <tag>æœ€ä½³å®è·µ</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸­ä½¿ç”¨&#39;Like&#39;ä¸€å®šä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆå—ï¼Ÿ</title>
    <url>/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8Like%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%90%97/</url>
    <content><![CDATA[<h1>MySQL ä¸­ä½¿ç”¨ Like ä¸€å®šä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆå—ï¼Ÿ</h1>
<p>åœ¨ MySQL æ€§èƒ½ä¼˜åŒ–çš„è®¨è®ºä¸­ï¼Œå¸¸æœ‰ä¸€ç§è¯´æ³•è®¤ä¸º&quot;ä½¿ç”¨ Like ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ&quot;ã€‚æœ¬æ–‡å°†é€šè¿‡å®é™…æ¡ˆä¾‹åˆ†æï¼Œæ¢ç©¶è¿™ä¸€è¯´æ³•æ˜¯å¦æ°¸è¿œæˆç«‹ï¼Œä»¥åŠå½±å“ç´¢å¼•ä½¿ç”¨çš„çœŸæ­£å› ç´ ã€‚</p>
<h2 id="é—®é¢˜å¼•å…¥">é—®é¢˜å¼•å…¥</h2>
<p>æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªä¸åŒç»“æ„çš„æ•°æ®è¡¨æ¥æ¢ç©¶ Like æŸ¥è¯¢ä¸ç´¢å¼•çš„å…³ç³»ï¼š</p>
<ul>
<li><strong>è¡¨ç»“æ„ä¸€</strong>ï¼šåŒ…å«å¤šä¸ªå­—æ®µï¼Œå…¶ä¸­ <code>id</code>æ˜¯è‡ªå¢ä¸»é”®ç´¢å¼•ï¼Œ<code>name</code>æ˜¯äºŒçº§ç´¢å¼•ï¼Œå…¶ä»–ä¸ºéç´¢å¼•å­—æ®µã€‚</li>
<li><strong>è¡¨ç»“æ„äºŒ</strong>ï¼šä»…åŒ…å«ä¸¤ä¸ªå­—æ®µï¼Œ<code>id</code>æ˜¯è‡ªå¢ä¸»é”®ç´¢å¼•ï¼Œ<code>name</code>æ˜¯äºŒçº§ç´¢å¼•ã€‚</li>
</ul>
<p>å¯¹äºè¿™ä¸¤å¼ è¡¨ï¼Œæˆ‘ä»¬å°†åˆ†åˆ«æµ‹è¯•ä»¥ä¸‹å››ç§æ¨¡ç³ŠæŸ¥è¯¢è¯­å¥ï¼š</p>
<ol>
<li><code>select * from s where name like &quot;xxx&quot;</code>ï¼ˆç²¾ç¡®åŒ¹é…ï¼Œç­‰åŒäºç­‰å€¼æŸ¥è¯¢ï¼‰</li>
<li><code>select * from s where name like &quot;xxx%&quot;</code>ï¼ˆå³æ¨¡ç³ŠåŒ¹é…ï¼‰</li>
<li><code>select * from s where name like &quot;%xxx&quot;</code>ï¼ˆå·¦æ¨¡ç³ŠåŒ¹é…ï¼‰</li>
<li><code>select * from s where name like &quot;%xxx%&quot;</code>ï¼ˆå…¨æ¨¡ç³ŠåŒ¹é…ï¼‰</li>
</ol>
<p>é€šè¿‡åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹å‡ºå“ªäº›æƒ…å†µä¼šåˆ©ç”¨ç´¢å¼•ï¼Œå“ªäº›æƒ…å†µä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p>
<h2 id="è¡¨ç»“æ„ä¸€çš„æ‰§è¡Œåˆ†æ">è¡¨ç»“æ„ä¸€çš„æ‰§è¡Œåˆ†æ</h2>
<p>è¡¨ç»“æ„ä¸€åŒ…å«å¤šä¸ªå­—æ®µï¼Œå…¶ä¸­åªæœ‰ <code>id</code>å’Œ <code>name</code>æ˜¯ç´¢å¼•å­—æ®µï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8Like%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%90%97/1746413509580.png" alt="è¡¨ç»“æ„ä¸€"></p>
<p>æ‰§è¡Œå››æ¡æ¨¡ç³ŠæŸ¥è¯¢åï¼Œç»“æœæ˜¾ç¤ºï¼š</p>
<ol>
<li><code>name like &quot;xxx&quot;</code>ï¼š<strong>èµ°ç´¢å¼•</strong>ï¼ˆå®é™…æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼‰</li>
<li><code>name like &quot;xxx%&quot;</code>ï¼š<strong>èµ°ç´¢å¼•</strong>ï¼ˆèŒƒå›´æŸ¥è¯¢ï¼Œtype=rangeï¼‰</li>
</ol>
<p>ä¸‹å›¾æ˜¯ç¬¬äºŒæ¡æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† <code>index_name</code>ç´¢å¼•ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8Like%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%90%97/1746413531031.png" alt="å³æ¨¡ç³ŠåŒ¹é…æ‰§è¡Œè®¡åˆ’"></p>
<ol start="3">
<li><code>name like &quot;%xxx&quot;</code>ï¼š<strong>ç´¢å¼•å¤±æ•ˆ</strong>ï¼ˆå…¨è¡¨æ‰«æï¼Œtype=ALLï¼‰</li>
<li><code>name like &quot;%xxx%&quot;</code>ï¼š<strong>ç´¢å¼•å¤±æ•ˆ</strong>ï¼ˆå…¨è¡¨æ‰«æï¼Œtype=ALLï¼‰</li>
</ol>
<p>ä¸‹å›¾æ˜¯ç¬¬ä¸‰æ¡æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¯ä»¥çœ‹åˆ°è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8Like%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%90%97/1746413547558.png" alt="å·¦æ¨¡ç³ŠåŒ¹é…æ‰§è¡Œè®¡åˆ’"></p>
<p><strong>ç»“è®º</strong>ï¼šåœ¨åŒ…å«éç´¢å¼•å­—æ®µçš„è¡¨ä¸­ï¼Œå·¦æ¨¡ç³Šå’Œå…¨æ¨¡ç³ŠæŸ¥è¯¢ç¡®å®ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè¿›è€Œè§¦å‘å…¨è¡¨æ‰«æã€‚</p>
<h2 id="è¡¨ç»“æ„äºŒçš„æ‰§è¡Œåˆ†æ">è¡¨ç»“æ„äºŒçš„æ‰§è¡Œåˆ†æ</h2>
<p>è¡¨ç»“æ„äºŒåªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œéƒ½æ˜¯ç´¢å¼•å­—æ®µï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8Like%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%90%97/1746413572653.png" alt="è¡¨ç»“æ„äºŒ"></p>
<p>æ‰§è¡Œç›¸åŒçš„å››æ¡æŸ¥è¯¢ï¼Œç»“æœå´æœ‰æ‰€ä¸åŒï¼š</p>
<ol>
<li><code>name like &quot;xxx&quot;</code>ï¼š<strong>èµ°ç´¢å¼•</strong>ï¼ˆç­‰å€¼æŸ¥è¯¢ï¼‰</li>
<li><code>name like &quot;xxx%&quot;</code>ï¼š<strong>èµ°ç´¢å¼•</strong>ï¼ˆèŒƒå›´æŸ¥è¯¢ï¼Œtype=rangeï¼‰</li>
</ol>
<p>ä¸‹å›¾æ˜¯ç¬¬äºŒæ¡æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Œä¸ä»…ä½¿ç”¨äº†ç´¢å¼•ï¼Œè¿˜åˆ©ç”¨äº†è¦†ç›–ç´¢å¼•ä¼˜åŒ–ï¼ˆUsing indexï¼‰ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8Like%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%90%97/1746413589599.png" alt="è¡¨äºŒå³æ¨¡ç³ŠåŒ¹é…æ‰§è¡Œè®¡åˆ’"></p>
<ol start="3">
<li><code>name like &quot;%xxx&quot;</code>ï¼š<strong>èµ°ç´¢å¼•</strong>ï¼ˆç´¢å¼•å…¨æ‰«æï¼Œtype=indexï¼‰</li>
<li><code>name like &quot;%xxx%&quot;</code>ï¼š<strong>èµ°ç´¢å¼•</strong>ï¼ˆç´¢å¼•å…¨æ‰«æï¼Œtype=indexï¼‰</li>
</ol>
<p>è¿™æ˜¯æœ€å‡ºäººæ„æ–™çš„ç»“æœï¼å·¦æ¨¡ç³Šå’Œå…¨æ¨¡ç³ŠæŸ¥è¯¢ç«Ÿç„¶ä¹Ÿèµ°äº†ç´¢å¼•ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8Like%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%90%97/1746413603153.png" alt="è¡¨äºŒå·¦æ¨¡ç³ŠåŒ¹é…æ‰§è¡Œè®¡åˆ’"></p>
<h2 id="æ·±å…¥åˆ†æè¡¨ç»“æ„äºŒçš„ç‰¹æ®Šæƒ…å†µ">æ·±å…¥åˆ†æè¡¨ç»“æ„äºŒçš„ç‰¹æ®Šæƒ…å†µ</h2>
<p>ä¸ºä»€ä¹ˆè¡¨ç»“æ„äºŒä¸­çš„å·¦æ¨¡ç³ŠæŸ¥è¯¢æ²¡æœ‰å¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Ÿè¿™æ¶‰åŠåˆ°å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p>
<h3 id="1-è¦†ç›–ç´¢å¼•çš„ä½œç”¨">1. è¦†ç›–ç´¢å¼•çš„ä½œç”¨</h3>
<p>åœ¨è¡¨ç»“æ„äºŒä¸­ï¼Œç”±äºè¡¨åªæœ‰ <code>id</code>å’Œ <code>name</code>ä¸¤ä¸ªå­—æ®µï¼Œè€Œè¿™ä¸¤ä¸ªå­—æ®µéƒ½åŒ…å«åœ¨äºŒçº§ç´¢å¼•ä¸­ï¼ˆäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«&quot;ç´¢å¼•å€¼+ä¸»é”®å€¼&quot;ï¼‰ï¼Œæ‰€ä»¥ <code>select *</code>ç­‰åŒäº <code>select id,name</code>ï¼Œå¯ä»¥ç›´æ¥ä»äºŒçº§ç´¢å¼•è·å–æ‰€æœ‰æ•°æ®ï¼Œæ— éœ€å›è¡¨æ“ä½œã€‚è¿™å°±æ˜¯<strong>è¦†ç›–ç´¢å¼•</strong>çš„åº”ç”¨ã€‚</p>
<h3 id="2-ç´¢å¼•å…¨æ‰«æ-vs-å…¨è¡¨æ‰«æ">2. ç´¢å¼•å…¨æ‰«æ vs å…¨è¡¨æ‰«æ</h3>
<p>è™½ç„¶æ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºä½¿ç”¨äº†ç´¢å¼•ï¼ˆkey=index_nameï¼‰ï¼Œä½† type=index è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª<strong>ç´¢å¼•å…¨æ‰«æ</strong>æ“ä½œï¼Œè€Œéåˆ©ç”¨ç´¢å¼•è¿›è¡Œå¿«é€Ÿå®šä½çš„èŒƒå›´æŸ¥è¯¢ï¼ˆtype=rangeï¼‰ã€‚</p>
<p>ç´¢å¼•å…¨æ‰«ææ˜¯æŒ‡éå†æ•´ä¸ªç´¢å¼•æ ‘ï¼Œè€Œå…¨è¡¨æ‰«ææ˜¯éå†æ•´ä¸ªæ•°æ®è¡¨ã€‚ç”±äºç´¢å¼•æ ‘é€šå¸¸æ¯”æ•°æ®è¡¨å°å¾—å¤šï¼ˆç‰¹åˆ«æ˜¯åœ¨å­—æ®µè¾ƒå¤šçš„è¡¨ä¸­ï¼‰ï¼Œæ‰€ä»¥ MySQL ä¼˜åŒ–å™¨åˆ¤æ–­ç´¢å¼•å…¨æ‰«æçš„æˆæœ¬ä½äºå…¨è¡¨æ‰«æï¼Œå› æ­¤é€‰æ‹©äº†å‰è€…ã€‚</p>
<h3 id="3-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨èšç°‡ç´¢å¼•ï¼Ÿ">3. ä¸ºä»€ä¹ˆä¸ä½¿ç”¨èšç°‡ç´¢å¼•ï¼Ÿ</h3>
<p>MySQL é€‰æ‹©æ‰«æäºŒçº§ç´¢å¼•æ ‘è€Œéèšç°‡ç´¢å¼•æ ‘ï¼Œæ˜¯å› ä¸ºï¼š</p>
<ul>
<li>äºŒçº§ç´¢å¼•åªå­˜å‚¨&quot;ç´¢å¼•åˆ—+ä¸»é”®å€¼&quot;ï¼Œæ•°æ®é‡å°</li>
<li>èšç°‡ç´¢å¼•åŒ…å«æ‰€æœ‰åˆ—æ•°æ®ã€äº‹åŠ¡ IDã€å›æ»šæŒ‡é’ˆç­‰ï¼Œæ•°æ®é‡å¤§</li>
<li>æœ¬æŸ¥è¯¢å¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œä¸éœ€è¦å›è¡¨æ“ä½œ</li>
</ul>
<p>å› æ­¤ï¼Œå°½ç®¡æ— æ³•åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ï¼ˆå› ä¸ºæ˜¯å·¦æ¨¡ç³ŠåŒ¹é…ï¼‰ï¼Œä½†å…¨æ‰«æäºŒçº§ç´¢å¼•æ ‘ä»ç„¶æ¯”å…¨è¡¨æ‰«æé«˜æ•ˆã€‚</p>
<h3 id="4-ä¸ºä»€ä¹ˆè¡¨ç»“æ„ä¸€ä¸­ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Ÿ">4. ä¸ºä»€ä¹ˆè¡¨ç»“æ„ä¸€ä¸­ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Ÿ</h3>
<p>å½“è¡¨ä¸­å­˜åœ¨éç´¢å¼•å­—æ®µä¸”æŸ¥è¯¢éœ€è¦è¿™äº›å­—æ®µæ—¶ï¼Œå³ä½¿ä½¿ç”¨äºŒçº§ç´¢å¼•å®šä½æ•°æ®ï¼Œä¹Ÿå¿…é¡»å›è¡¨åˆ°èšç°‡ç´¢å¼•è·å–å®Œæ•´è®°å½•ã€‚å¯¹äºå·¦æ¨¡ç³ŠåŒ¹é…ï¼Œæ— æ³•åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§å¿«é€Ÿå®šä½ï¼Œå¿…é¡»éå†æ•´ä¸ªç´¢å¼•æ ‘å¹¶é¢‘ç¹å›è¡¨ï¼Œè¿™æ¯”ç›´æ¥å…¨è¡¨æ‰«æçš„æˆæœ¬è¿˜é«˜ï¼Œå› æ­¤ä¼˜åŒ–å™¨é€‰æ‹©äº†å…¨è¡¨æ‰«æã€‚</p>
<h2 id="ç»“è®ºä¸å®ç”¨å»ºè®®">ç»“è®ºä¸å®ç”¨å»ºè®®</h2>
<p>é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p>
<ol>
<li>
<p><strong>Like æŸ¥è¯¢å¹¶éä¸€å®šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</strong>ï¼Œå…³é”®åœ¨äºæ¨¡ç³ŠåŒ¹é…çš„ä½ç½®å’Œè¡¨çš„ç»“æ„ï¼š</p>
<ul>
<li>ç²¾ç¡®åŒ¹é…å’Œå³æ¨¡ç³ŠåŒ¹é…ï¼ˆ<code>like 'xxx%'</code>ï¼‰é€šå¸¸èƒ½é«˜æ•ˆåˆ©ç”¨ç´¢å¼•</li>
<li>å·¦æ¨¡ç³Šå’Œå…¨æ¨¡ç³ŠåŒ¹é…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ä¹Ÿå¯èƒ½ä½¿ç”¨ç´¢å¼•ï¼ˆç´¢å¼•å…¨æ‰«æï¼‰</li>
</ul>
</li>
<li>
<p><strong>å†³å®šæ˜¯å¦ä½¿ç”¨ç´¢å¼•çš„å…³é”®å› ç´ </strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢æ˜¯å¦èƒ½åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ï¼ˆå‰ç¼€åŒ¹é…å¯ä»¥ï¼Œåç¼€åŒ¹é…ä¸è¡Œï¼‰</li>
<li>æ˜¯å¦ç¬¦åˆè¦†ç›–ç´¢å¼•çš„æ¡ä»¶ï¼ˆæŸ¥è¯¢å­—æ®µæ˜¯å¦éƒ½åœ¨ç´¢å¼•ä¸­ï¼‰</li>
<li>ä¼˜åŒ–å™¨å¯¹æˆæœ¬çš„è¯„ä¼°ï¼ˆç´¢å¼•æ‰«æ vs å…¨è¡¨æ‰«æï¼‰</li>
</ul>
</li>
<li>
<p><strong>å®ç”¨ä¼˜åŒ–å»ºè®®</strong>ï¼š</p>
<ul>
<li>å°½å¯èƒ½ä½¿ç”¨å³æ¨¡ç³Šè€Œéå·¦æ¨¡ç³ŠæŸ¥è¯¢</li>
<li>å¯¹äºå¿…é¡»ä½¿ç”¨å·¦æ¨¡ç³Šçš„åœºæ™¯ï¼Œè€ƒè™‘å»ºç«‹åˆé€‚çš„è¦†ç›–ç´¢å¼•</li>
<li>åœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¨æ–‡ç´¢å¼•æˆ–å…¶ä»–ä¸“é—¨çš„æœç´¢æŠ€æœ¯</li>
</ul>
</li>
</ol>
<p>è¡¥å……ä¸€ç‚¹ï¼šè¿™ä¸ªè§„å¾‹åŒæ ·é€‚ç”¨äºè”åˆç´¢å¼•ã€‚å³ä½¿æ²¡æœ‰éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œåœ¨æ‰€æœ‰æŸ¥è¯¢å­—æ®µéƒ½æ˜¯ç´¢å¼•å­—æ®µçš„æƒ…å†µä¸‹ï¼ŒMySQL ä¹Ÿå¯èƒ½é€‰æ‹©ç´¢å¼•å…¨æ‰«æè€Œéå…¨è¡¨æ‰«æï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8Like%E4%B8%80%E5%AE%9A%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%90%97/1746413628199.png" alt="è”åˆç´¢å¼•ç¤ºä¾‹"></p>
<p>ç†è§£è¿™äº›ç»†èŠ‚ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨å®é™…å·¥ä½œä¸­æ›´å‡†ç¡®åœ°é¢„ä¼°æŸ¥è¯¢æ€§èƒ½ï¼Œå¹¶åšå‡ºæ›´åˆç†çš„ç´¢å¼•è®¾è®¡å†³ç­–ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>ç´¢å¼•</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>ç´¢å¼•</tag>
        <tag>ç´¢å¼•å¤±æ•ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLç´¢å¼•å¤±æ•ˆçš„å¸¸è§æƒ…å†µè¯¦è§£</title>
    <url>/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/</url>
    <content><![CDATA[<p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸é€šè¿‡å»ºç«‹ç´¢å¼•æ¥æé«˜ SQL æŸ¥è¯¢é€Ÿåº¦ã€‚ä½†ç´¢å¼•å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæœ‰äº›æƒ…å†µä¸‹å³ä½¿å»ºç«‹äº†ç´¢å¼•ï¼ŒæŸ¥è¯¢è¿˜æ˜¯ä¼šå˜æˆå…¨è¡¨æ‰«æï¼Œå¯¼è‡´æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚</p>
<p>æœ¬æ–‡å°†ç”¨ç®€å•æ˜“æ‡‚çš„æ–¹å¼ä»‹ç»ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="ç´¢å¼•æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ">ç´¢å¼•æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ</h2>
<p>å…ˆæ¥ç®€å•äº†è§£ä¸€ä¸‹ MySQL çš„ç´¢å¼•å­˜å‚¨ç»“æ„ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬ç†è§£ä¸ºä»€ä¹ˆæŸäº›æ“ä½œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p>
<p>MySQL é»˜è®¤ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“ï¼Œå®ƒé‡‡ç”¨ B+æ ‘ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚å…³äºä¸ºä»€ä¹ˆé€‰æ‹© B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/">ä¸ºä»€ä¹ˆ MySQL å–œæ¬¢ B+æ ‘ï¼Ÿ</a></p>
<p>InnoDB å’Œ MyISAM å¼•æ“åœ¨ç´¢å¼•å®ç°ä¸Šæœ‰ä¸ªå…³é”®åŒºåˆ«ï¼š</p>
<ul>
<li>InnoDBï¼šB+æ ‘ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ç›´æ¥å­˜æ”¾æ•°æ®æœ¬èº«</li>
<li>MyISAMï¼šB+æ ‘ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åªå­˜æ”¾æ•°æ®çš„ç‰©ç†åœ°å€</li>
</ul>
<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ç”¨æˆ·è¡¨æ¥è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>address</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>å¼ æŸ</td>
<td>26</td>
<td>åŒ—äº¬å¸‚æµ·æ·€åŒº</td>
</tr>
<tr>
<td>2</td>
<td>æ—æŸ</td>
<td>18</td>
<td>æ·±åœ³å¸‚å—å±±åŒº</td>
</tr>
<tr>
<td>3</td>
<td>é™ˆæŸ</td>
<td>30</td>
<td>å¹¿å·å¸‚æµ·ç åŒº</td>
</tr>
<tr>
<td>4</td>
<td>å‘¨æŸ</td>
<td>34</td>
<td>æ·±åœ³å¸‚å—å±±åŒº</td>
</tr>
<tr>
<td>5</td>
<td>æ›¾æŸ</td>
<td>25</td>
<td>ä¸Šæµ·å¸‚æ¾æ±ŸåŒº</td>
</tr>
<tr>
<td>6</td>
<td>é»„æŸ</td>
<td>28</td>
<td>æ·±åœ³å¸‚å®å®‰åŒº</td>
</tr>
<tr>
<td>7</td>
<td>è°¢æŸ</td>
<td>38</td>
<td>åŒ—äº¬å¸‚æµ·æ·€åŒº</td>
</tr>
<tr>
<td>8</td>
<td>é’ŸæŸ</td>
<td>23</td>
<td>å¹¿å·å¸‚æµ·ç åŒº</td>
</tr>
<tr>
<td>9</td>
<td>å´æŸ</td>
<td>28</td>
<td>ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº</td>
</tr>
</tbody>
</table>
<p>MyISAM å¼•æ“çš„ç´¢å¼•ç»“æ„ï¼ˆå¶å­èŠ‚ç‚¹å­˜æ”¾æ•°æ®åœ°å€ï¼‰ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355645568.png" alt="1746355645568"></p>
<p>InnoDB å¼•æ“çš„ä¸»é”®ç´¢å¼•ç»“æ„ï¼ˆå¶å­èŠ‚ç‚¹ç›´æ¥å­˜æ”¾æ•°æ®ï¼‰ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355653892.png" alt="1746355653892"></p>
<p>InnoDB æœ‰ä¸¤ç§ç´¢å¼•ç±»å‹ï¼š</p>
<ol>
<li><strong>èšç°‡ç´¢å¼•</strong>ï¼šä¸Šå›¾æ‰€ç¤ºçš„ä¸»é”®ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜æ”¾å®Œæ•´æ•°æ®</li>
<li><strong>äºŒçº§ç´¢å¼•</strong>ï¼šæ™®é€šå­—æ®µåˆ›å»ºçš„ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹åªå­˜æ”¾ä¸»é”®å€¼</li>
</ol>
<p>å¦‚æœåœ¨ name å­—æ®µä¸Šåˆ›å»ºç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355703954.png" alt="1746355703954"></p>
<p>äº†è§£è¿™äº›ç»“æ„åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æŸ¥è¯¢æ—¶æ˜¯å¦‚ä½•ä½¿ç”¨ç´¢å¼•çš„ï¼š</p>
<h3 id="ä¸»é”®æŸ¥è¯¢">ä¸»é”®æŸ¥è¯¢</h3>
<p>å½“ä½¿ç”¨ä¸»é”®æŸ¥è¯¢æ—¶ï¼Œç›´æ¥é€šè¿‡èšç°‡ç´¢å¼•æ‰¾åˆ°æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- idæ˜¯ä¸»é”®</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h3 id="æ™®é€šç´¢å¼•æŸ¥è¯¢ï¼ˆéœ€è¦å›è¡¨ï¼‰">æ™®é€šç´¢å¼•æŸ¥è¯¢ï¼ˆéœ€è¦å›è¡¨ï¼‰</h3>
<p>å½“ä½¿ç”¨æ™®é€šç´¢å¼•æŸ¥è¯¢å®Œæ•´æ•°æ®æ—¶ï¼Œéœ€è¦ä¸¤æ­¥ï¼š</p>
<ol>
<li>å…ˆåœ¨äºŒçº§ç´¢å¼•ä¸­æ‰¾åˆ°ä¸»é”®å€¼</li>
<li>å†é€šè¿‡ä¸»é”®å€¼åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´æ•°æ®</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹å«åš<strong>å›è¡¨</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- nameæ˜¯æ™®é€šç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> name <span class="operator">=</span> &quot;æ—æŸ&quot;;</span><br></pre></td></tr></table></figure>
<h3 id="è¦†ç›–ç´¢å¼•æŸ¥è¯¢ï¼ˆä¸éœ€è¦å›è¡¨ï¼‰">è¦†ç›–ç´¢å¼•æŸ¥è¯¢ï¼ˆä¸éœ€è¦å›è¡¨ï¼‰</h3>
<p>å¦‚æœåªæŸ¥è¯¢ç´¢å¼•ä¸­å·²æœ‰çš„æ•°æ®ï¼Œå°±ä¸éœ€è¦å›è¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åªæŸ¥è¯¢idï¼Œè€Œidå·²åœ¨nameç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> name <span class="operator">=</span> &quot;æ—æŸ&quot;;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ•°æ®éƒ½èƒ½åœ¨ç´¢å¼•ä¸­æ‰¾åˆ°ï¼Œç§°ä¸º<strong>è¦†ç›–ç´¢å¼•</strong>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹çœ‹å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ä»¥ä¸‹ç¤ºä¾‹åŸºäº MySQL 8.0.26 æµ‹è¯•ã€‚</p>
<h2 id="ä¸€ã€æ¨¡ç³ŠæŸ¥è¯¢çš„å·¦å³åŒ¹é…å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">ä¸€ã€æ¨¡ç³ŠæŸ¥è¯¢çš„å·¦å³åŒ¹é…å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h2>
<p>ä½¿ç”¨ <code>LIKE</code>è¿›è¡Œå·¦æ¨¡ç³Šï¼ˆ<code>%xx</code>ï¼‰æˆ–è€…å·¦å³æ¨¡ç³Šï¼ˆ<code>%xx%</code>ï¼‰æŸ¥è¯¢æ—¶ï¼Œç´¢å¼•ä¼šå¤±æ•ˆã€‚</p>
<p>ä¾‹å¦‚ï¼ŒæŸ¥è¯¢ name ä»¥&quot;æ—&quot;ç»“å°¾çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- nameæ˜¯ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%æ—&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè®¡åˆ’æ˜¾ç¤º <code>type=ALL</code>ï¼Œè¡¨ç¤ºè¿›è¡Œäº†å…¨è¡¨æ‰«æï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355795323.png" alt="1746355795323"></p>
<p>ä½†å¦‚æœæ˜¯æŸ¥è¯¢ name ä»¥&quot;æ—&quot;å¼€å¤´çš„ç”¨æˆ·ï¼Œç´¢å¼•ä¾ç„¶æœ‰æ•ˆï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;æ—%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè®¡åˆ’æ˜¾ç¤º <code>type=range</code>ï¼Œä½¿ç”¨äº†ç´¢å¼•ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355807374.png" alt="1746355807374"></p>
<p><strong>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</strong></p>
<p>å› ä¸º B+æ ‘ç´¢å¼•æ˜¯æŒ‰ç…§å€¼çš„é¡ºåºæ’åˆ—çš„ï¼Œåªèƒ½é«˜æ•ˆåœ°è¿›è¡Œå‰ç¼€åŒ¹é…ã€‚å½“ä½¿ç”¨ <code>%æ—</code>è¿™æ ·çš„åç¼€åŒ¹é…æ—¶ï¼Œç³»ç»Ÿæ— æ³•ç¡®å®šä»å“ªä¸ªç´¢å¼•å€¼å¼€å§‹æŸ¥æ‰¾ï¼Œåªèƒ½éå†æ•´ä¸ªè¡¨ã€‚</p>
<p>ä»¥ä¸‹å›¾ä¸­çš„äºŒçº§ç´¢å¼•ä¸ºä¾‹ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1748185291563.png" alt="1748185291563"></p>
<p>æŸ¥è¯¢ <code>name LIKE 'æ—%'</code>æ—¶ï¼Œç³»ç»Ÿå¯ä»¥ç›´æ¥å®šä½åˆ°æ—å¼€å¤´çš„è®°å½•å¹¶å‘åéå†ï¼›è€ŒæŸ¥è¯¢ <code>name LIKE '%æ—'</code>æ—¶ï¼Œç³»ç»Ÿä¸çŸ¥é“ä»å“ªå¼€å§‹æ‰¾ï¼Œåªèƒ½å…¨è¡¨æ‰«æã€‚</p>
<h2 id="äºŒã€åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">äºŒã€åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h2>
<p>å½“åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°æ—¶ï¼Œç´¢å¼•ä¼šå¤±æ•ˆã€‚</p>
<p>ä¾‹å¦‚ï¼ŒæŸ¥è¯¢ name é•¿åº¦ä¸º 6 çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- nameæ˜¯ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> LENGTH(name) <span class="operator">=</span> <span class="number">6</span>;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºè¿›è¡Œäº†å…¨è¡¨æ‰«æï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355829062.png" alt="1746355829062"></p>
<p><strong>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</strong></p>
<p>å› ä¸ºç´¢å¼•ä¸­å­˜å‚¨çš„æ˜¯åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯å‡½æ•°è®¡ç®—åçš„å€¼ã€‚ç³»ç»Ÿéœ€è¦å…ˆå–å‡ºæ¯æ¡è®°å½•ï¼Œè®¡ç®—å‡½æ•°ç»“æœï¼Œå†è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š<br>
ä» MySQL 8.0 å¼€å§‹ï¼Œå¯ä»¥åˆ›å»ºå‡½æ•°ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> t_user <span class="keyword">ADD</span> KEY idx_name_length ((LENGTH(name)));</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±èƒ½åœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨ç´¢å¼•ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355864137.png" alt="1746355864137"></p>
<h2 id="ä¸‰ã€åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¡¨è¾¾å¼è®¡ç®—å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">ä¸‰ã€åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¡¨è¾¾å¼è®¡ç®—å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h2>
<p>å’Œä½¿ç”¨å‡½æ•°ç±»ä¼¼ï¼Œåœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¡¨è¾¾å¼è®¡ç®—ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">+</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355872950.png" alt="1746355872950"></p>
<p>ä½†å¦‚æœæ”¹æˆä¸‹é¢è¿™æ ·ï¼Œå°±å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span> <span class="operator">-</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355879246.png" alt="1746355879246"></p>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šå°†è¿ç®—å°½é‡æ”¾åœ¨ç­‰å·å³è¾¹ï¼ˆå¸¸é‡ä¾§ï¼‰ï¼Œä¸è¦å¯¹ç´¢å¼•åˆ—åšè¿ç®—ã€‚</p>
<h2 id="å››ã€ç´¢å¼•åˆ—å‘ç”Ÿéšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">å››ã€ç´¢å¼•åˆ—å‘ç”Ÿéšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h2>
<p>å½“ç´¢å¼•åˆ—æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè€ŒæŸ¥è¯¢æ¡ä»¶ä½¿ç”¨æ•°å­—æ—¶ï¼Œä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p>
<p>ä¾‹å¦‚ï¼Œphone æ˜¯ varchar ç±»å‹çš„ç´¢å¼•åˆ—ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="number">1300000001</span>;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºå…¨è¡¨æ‰«æï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355897755.png" alt="1746355897755"></p>
<p>ä½†æœ‰è¶£çš„æ˜¯ï¼Œå½“ç´¢å¼•åˆ—æ˜¯æ•°å­—ç±»å‹ï¼Œè€ŒæŸ¥è¯¢æ¡ä»¶ä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œç´¢å¼•ä¾ç„¶æœ‰æ•ˆï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- idæ˜¯æ•´å‹</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355906989.png" alt="1746355906989"></p>
<p><strong>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</strong></p>
<p>è¿™ä¸ MySQL çš„ç±»å‹è½¬æ¢è§„åˆ™æœ‰å…³ã€‚å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•æµ‹è¯•äº†è§£ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &quot;10&quot; <span class="operator">&gt;</span> <span class="number">9</span>;</span><br></pre></td></tr></table></figure>
<p>ç»“æœæ˜¯ 1ï¼Œè¯´æ˜ MySQL å°†å­—ç¬¦ä¸²è½¬æˆäº†æ•°å­—å†æ¯”è¾ƒã€‚</p>
<p>æ‰€ä»¥åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="number">1300000001</span>;</span><br></pre></td></tr></table></figure>
<p>ç­‰ä»·äºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="built_in">CAST</span>(phone <span class="keyword">AS</span> signed <span class="type">int</span>) <span class="operator">=</span> <span class="number">1300000001</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™å®é™…ä¸Šå¯¹ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°ï¼Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p>
<p>è€Œç¬¬äºŒä¸ªä¾‹å­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">=</span> &quot;1&quot;;</span><br></pre></td></tr></table></figure>
<p>ç­‰ä»·äºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="built_in">CAST</span>(&quot;1&quot; <span class="keyword">AS</span> signed <span class="type">int</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯å¯¹å¸¸é‡è¿›è¡Œè½¬æ¢ï¼Œä¸å½±å“ç´¢å¼•ä½¿ç”¨ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šç¡®ä¿æŸ¥è¯¢æ¡ä»¶çš„æ•°æ®ç±»å‹ä¸ç´¢å¼•åˆ—ä¸€è‡´ã€‚</p>
<h2 id="äº”ã€è”åˆç´¢å¼•æœªéµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">äº”ã€è”åˆç´¢å¼•æœªéµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h2>
<p>è”åˆç´¢å¼•å¿…é¡»éµå¾ª&quot;æœ€å·¦åŒ¹é…åŸåˆ™&quot;æ‰èƒ½æœ‰æ•ˆä½¿ç”¨ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªè”åˆç´¢å¼•(a, b, c)ï¼Œä»¥ä¸‹æŸ¥è¯¢å¯ä»¥ä½¿ç”¨è¯¥ç´¢å¼•ï¼š</p>
<ul>
<li>WHERE a = 1</li>
<li>WHERE a = 1 AND b = 2</li>
<li>WHERE a = 1 AND b = 2 AND c = 3</li>
</ul>
<p>ä½†ä»¥ä¸‹æŸ¥è¯¢æ— æ³•åˆ©ç”¨ç´¢å¼•ï¼š</p>
<ul>
<li>WHERE b = 2</li>
<li>WHERE c = 3</li>
<li>WHERE b = 2 AND c = 3</li>
</ul>
<p>æœ‰ä¸ªç‰¹æ®Šæƒ…å†µï¼š<code>WHERE a = 1 AND c = 3</code>ï¼ˆè·³è¿‡ bï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>MySQL 5.5 ç‰ˆæœ¬ï¼šåªæœ‰ a èƒ½èµ°ç´¢å¼•ï¼Œæ‰¾åˆ°è®°å½•åå›è¡¨æ¯”å¯¹ c</li>
<li>MySQL 5.6 åŠæ›´é«˜ç‰ˆæœ¬ï¼šå¼•å…¥äº†&quot;ç´¢å¼•ä¸‹æ¨&quot;åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ç´¢å¼•ä¸­ç›´æ¥è¿‡æ»¤ c æ¡ä»¶ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> c <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè®¡åˆ’ä¸­æ˜¾ç¤º <code>Using index condition</code>è¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355930186.png" alt="1746355930186"></p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦æœ€å·¦åŒ¹é…ï¼Ÿ</strong></p>
<p>å› ä¸ºè”åˆç´¢å¼•çš„æ’åºæ–¹å¼æ˜¯å…ˆæŒ‰ç¬¬ä¸€åˆ—æ’åºï¼Œç¬¬ä¸€åˆ—ç›¸åŒæ—¶å†æŒ‰ç¬¬äºŒåˆ—æ’åºï¼Œä¾æ­¤ç±»æ¨ã€‚å¦‚æœæ²¡æœ‰ç¬¬ä¸€åˆ—çš„æ¡ä»¶ï¼Œç³»ç»Ÿå°±æ— æ³•åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ã€‚</p>
<h2 id="å…­ã€OR-æ¡ä»¶å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">å…­ã€OR æ¡ä»¶å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h2>
<p>å½“ WHERE å­å¥ä¸­ä½¿ç”¨ OR è¿æ¥çš„æ¡ä»¶åˆ—ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸æ˜¯ç´¢å¼•åˆ—æ—¶ï¼Œæ•´ä¸ªæŸ¥è¯¢ä¼šå˜æˆå…¨è¡¨æ‰«æã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- idæ˜¯ç´¢å¼•ï¼Œageä¸æ˜¯ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">18</span>;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºå…¨è¡¨æ‰«æï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355938391.png" alt="1746355938391"></p>
<p><strong>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</strong></p>
<p>å› ä¸º OR è¡¨ç¤ºæ»¡è¶³ä»»ä¸€æ¡ä»¶å³å¯ï¼Œå¦‚æœæœ‰æ¡ä»¶ä¸èƒ½èµ°ç´¢å¼•ï¼Œä¸ºç¡®ä¿ç»“æœå®Œæ•´ï¼Œç³»ç»Ÿä¼šé€‰æ‹©å…¨è¡¨æ‰«æã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šä¸ºæ‰€æœ‰ OR æ¡ä»¶åˆ—åˆ›å»ºç´¢å¼•ã€‚ä¾‹å¦‚ç»™ age ä¹Ÿåˆ›å»ºç´¢å¼•ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88/1746355946123.png" alt="1746355946123"></p>
<p>æ‰§è¡Œè®¡åˆ’ä¸­æ˜¾ç¤º <code>type=index_merge</code>ï¼Œè¡¨ç¤ºç³»ç»Ÿåˆ†åˆ«æ‰«æäº† id å’Œ age çš„ç´¢å¼•ï¼Œç„¶ååˆå¹¶ç»“æœï¼Œé¿å…äº†å…¨è¡¨æ‰«æã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æˆ‘ä»¬ä»‹ç»äº† 6 ç§ä¼šå¯¼è‡´ MySQL ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼š</p>
<ol>
<li><strong>æ¨¡ç³ŠæŸ¥è¯¢çš„å·¦å³åŒ¹é…</strong>ï¼š<code>LIKE '%xx'</code>æˆ– <code>LIKE '%xx%'</code>ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè€Œ <code>LIKE 'xx%'</code>å¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚</li>
<li><strong>åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°</strong>ï¼šå¦‚ <code>LENGTH(name)</code>ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ MySQL 8.0 çš„å‡½æ•°ç´¢å¼•ã€‚</li>
<li><strong>åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¡¨è¾¾å¼è®¡ç®—</strong>ï¼šå¦‚ <code>id + 1 = 10</code>ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œåº”æ”¹ä¸º <code>id = 10 - 1</code>ã€‚</li>
<li><strong>éšå¼ç±»å‹è½¬æ¢</strong>ï¼šå½“å­—ç¬¦ä¸²ç´¢å¼•åˆ—ä¸æ•°å­—æ¯”è¾ƒæ—¶ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼›ä½†æ•°å­—ç´¢å¼•åˆ—ä¸å­—ç¬¦ä¸²æ¯”è¾ƒä¸ä¼šæœ‰é—®é¢˜ã€‚</li>
<li><strong>è”åˆç´¢å¼•æœªéµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™</strong>ï¼šå¦‚(a,b,c)ç´¢å¼•ï¼ŒæŸ¥è¯¢å¿…é¡»åŒ…å« a åˆ—æ‰èƒ½ä½¿ç”¨ç´¢å¼•ã€‚</li>
<li><strong>OR æ¡ä»¶ä¸­æœ‰éç´¢å¼•åˆ—</strong>ï¼šéœ€è¦ç¡®ä¿ OR ä¸¤ä¾§çš„æ¡ä»¶éƒ½æœ‰ç´¢å¼•ï¼Œå¦åˆ™ä¼šèµ°å…¨è¡¨æ‰«æã€‚</li>
</ol>
<p>ç†è§£è¿™äº›æƒ…å†µæœ‰åŠ©äºæˆ‘ä»¬ä¼˜åŒ– SQL æŸ¥è¯¢ï¼Œé¿å…ç´¢å¼•å¤±æ•ˆå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>ç´¢å¼•</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“ä¼˜åŒ–</tag>
        <tag>ç´¢å¼•</tag>
        <tag>ç´¢å¼•å¤±æ•ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLå•è¡¨å»ºè®®æ•°æ®é‡</title>
    <url>/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/</url>
    <content><![CDATA[<p>æˆ‘ä»¬ç»å¸¸å¬è¯´ï¼Œå•è¡¨æ•°æ®é‡ä¸è¦è¶…è¿‡ 2000Wï¼Œå¦åˆ™æ€§èƒ½ä¼šä¸‹é™ã€‚è¿™ä¸ª&quot;2000W&quot;çš„å»ºè®®å€¼æ˜¯å¦çœŸçš„å¯é ï¼Ÿå®ƒçš„ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿæœ¬æ–‡å°†é€šè¿‡åˆ†æ MySQL çš„å­˜å‚¨ç»“æ„ã€B+æ ‘ç´¢å¼•ç‰¹æ€§ï¼Œä»¥åŠå®é™…æµ‹è¯•æ¥æ¢è®¨è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="å®éªŒ"><strong>å®éªŒ</strong></h2>
<p>å…ˆå»ºç«‹ä¸€ä¸ªå®éªŒè¡¨:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> person(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span> comment <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">    person_id tinyint <span class="keyword">not null</span> comment <span class="string">&#x27;ç”¨æˆ· id&#x27;</span>,</span><br><span class="line">    person_name <span class="type">VARCHAR</span>(<span class="number">200</span>) comment <span class="string">&#x27;ç”¨æˆ·åç§°&#x27;</span>,</span><br><span class="line">    gmt_create datetime comment <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">    gmt_modified datetime comment <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;äººå‘˜ä¿¡æ¯è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>æ’å…¥ä¸€æ¡æ•°æ®</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert into</span> person <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">1</span>,<span class="string">&#x27;user_1&#x27;</span>, NOW(), now());</span><br></pre></td></tr></table></figure>
<h3 id="å¤§æ•°æ®é‡æµ‹è¯•æ•°æ®ç”Ÿæˆæ–¹æ³•">å¤§æ•°æ®é‡æµ‹è¯•æ•°æ®ç”Ÿæˆæ–¹æ³•</h3>
<p>ä¸ºäº†æµ‹è¯•å•è¡¨åœ¨ä¸åŒæ•°æ®é‡ä¸‹çš„æ€§èƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡æµ‹è¯•æ•°æ®ã€‚ä¸‹é¢ä»‹ç»ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç”Ÿæˆæ–¹æ³•ï¼š</p>
<h4 id="æ­¥éª¤-1ï¼šåˆå§‹åŒ–è®¡æ•°å™¨å˜é‡">æ­¥éª¤ 1ï¼šåˆå§‹åŒ–è®¡æ•°å™¨å˜é‡</h4>
<p>é¦–å…ˆï¼Œè®¾ç½®ä¸€ä¸ª MySQL ç”¨æˆ·å˜é‡ <code>@i</code>ä½œä¸ºæ•°æ®ç”Ÿæˆçš„è®¡æ•°å™¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¿™æ¡è¯­å¥åˆ›å»ºä¸€ä¸ªåä¸ºrownumçš„åˆ—ï¼Œå…¶å€¼ä¸º@i+1ï¼ŒåŒæ—¶è®¾ç½®@içš„åˆå§‹å€¼ä¸º100</span></span><br><span class="line"><span class="keyword">select</span> (<span class="variable">@i</span>:<span class="operator">=</span><span class="variable">@i</span><span class="operator">+</span><span class="number">1</span>) <span class="keyword">as</span> rownum, person_name <span class="keyword">from</span> person, (<span class="keyword">select</span> <span class="variable">@i</span>:<span class="operator">=</span><span class="number">100</span>) <span class="keyword">as</span> init;</span><br><span class="line"><span class="comment">-- é‡ç½®@içš„å€¼ä¸º1ï¼Œå‡†å¤‡å¼€å§‹ç”Ÿæˆæ•°æ®</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@i</span><span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>MySQL ç”¨æˆ·å˜é‡</strong>ï¼šä»¥ <code>@</code>å¼€å¤´çš„å˜é‡æ˜¯ MySQL çš„ç”¨æˆ·å®šä¹‰å˜é‡ï¼Œå¯ä»¥åœ¨ä¼šè¯ä¸­ä¿å­˜å€¼å¹¶åœ¨å¤šä¸ª SQL è¯­å¥ä¹‹é—´ä¼ é€’ã€‚</p>
</blockquote>
<h4 id="æ­¥éª¤-2ï¼šä½¿ç”¨é€’å½’æ’å…¥æ³•ç”Ÿæˆå¤§é‡æ•°æ®">æ­¥éª¤ 2ï¼šä½¿ç”¨é€’å½’æ’å…¥æ³•ç”Ÿæˆå¤§é‡æ•°æ®</h4>
<p>ä¸‹é¢è¿™æ¡ SQL è¯­å¥æ˜¯å…³é”®ï¼Œå®ƒåˆ©ç”¨è¡¨ä¸­ç°æœ‰çš„æ•°æ®æ¥ç”Ÿæˆæ›´å¤šæ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert into</span> person(id, person_id, person_name, gmt_create, gmt_modified)</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@i</span>:<span class="operator">=</span><span class="variable">@i</span><span class="operator">+</span><span class="number">1</span>,                  <span class="comment">-- ä¸ºæ¯è¡Œç”Ÿæˆå”¯ä¸€IDï¼ŒåŒæ—¶@içš„å€¼å¢åŠ 1</span></span><br><span class="line">       <span class="keyword">left</span>(rand()<span class="operator">*</span><span class="number">10</span>,<span class="number">10</span>) <span class="keyword">as</span> person_id,        <span class="comment">-- ç”Ÿæˆéšæœºçš„person_id</span></span><br><span class="line">       concat(<span class="string">&#x27;user_&#x27;</span>,<span class="variable">@i</span><span class="operator">%</span><span class="number">2048</span>),               <span class="comment">-- ç”Ÿæˆç”¨æˆ·åï¼Œå¾ªç¯ä½¿ç”¨2048ä¸ªä¸åŒåç§°</span></span><br><span class="line">       date_add(gmt_create,<span class="type">interval</span> <span class="operator">+</span> <span class="variable">@i</span><span class="operator">*</span><span class="built_in">cast</span>(rand()<span class="operator">*</span><span class="number">100</span> <span class="keyword">as</span> signed) <span class="keyword">SECOND</span>),  <span class="comment">-- ç”Ÿæˆé€’å¢çš„åˆ›å»ºæ—¶é—´</span></span><br><span class="line">       date_add(date_add(gmt_modified,<span class="type">interval</span> <span class="operator">+</span><span class="variable">@i</span><span class="operator">*</span><span class="built_in">cast</span>(rand()<span class="operator">*</span><span class="number">100</span> <span class="keyword">as</span> signed) <span class="keyword">SECOND</span>), <span class="type">interval</span> <span class="operator">+</span> <span class="built_in">cast</span>(rand()<span class="operator">*</span><span class="number">1000000</span> <span class="keyword">as</span> signed) <span class="keyword">SECOND</span>)  <span class="comment">-- ç”Ÿæˆä¿®æ”¹æ—¶é—´</span></span><br><span class="line"><span class="keyword">from</span> person;  <span class="comment">-- ä»personè¡¨ä¸­é€‰æ‹©æ•°æ®ï¼Œæ¯æ¬¡æ‰§è¡Œä¼šä½¿è¡¨ä¸­æ•°æ®é‡ç¿»å€</span></span><br></pre></td></tr></table></figure>
<p><strong>æ•°æ®é‡å¢é•¿è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ¯æ‰§è¡Œä¸€æ¬¡ä¸Šè¿° SQLï¼Œè¡¨ä¸­çš„æ•°æ®é‡å°±ä¼šç¿»å€</li>
<li>æ‰§è¡Œ 20 æ¬¡åï¼Œæ•°æ®é‡çº¦ä¸º 2^20â‰ˆ1,048,576ï¼ˆçº¦ 100 ä¸‡ï¼‰æ¡</li>
<li>æ‰§è¡Œ 23 æ¬¡åï¼Œæ•°æ®é‡çº¦ä¸º 2^23â‰ˆ8,388,608ï¼ˆçº¦ 800 ä¸‡ï¼‰æ¡</li>
<li>ä¾æ­¤ç±»æ¨ï¼Œå¯ä»¥ç”Ÿæˆä»»æ„æ•°é‡çš„æµ‹è¯•æ•°æ®</li>
</ul>
<p><strong>å°æŠ€å·§</strong>ï¼šå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½ç¿»å€å¢åŠ æ•°æ®ï¼Œå¯ä»¥åœ¨ SQL è¯­å¥æœ«å°¾æ·»åŠ  WHERE æ¡ä»¶ï¼Œä¾‹å¦‚ <code>WHERE id &gt; æŸä¸ªå€¼</code>æ¥æ§åˆ¶æ–°å¢çš„æ•°æ®é‡ã€‚</p>
<h4 id="æ­¥éª¤-3ï¼šå¤„ç†å¯èƒ½å‡ºç°çš„å†…å­˜é—®é¢˜">æ­¥éª¤ 3ï¼šå¤„ç†å¯èƒ½å‡ºç°çš„å†…å­˜é—®é¢˜</h4>
<p>å½“æ•°æ®é‡è¾¾åˆ°è¾ƒå¤§è§„æ¨¡ï¼ˆçº¦ 800 ä¸‡æˆ– 1000 ä¸‡ï¼‰æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">The total number of locks exceeds the lock table size</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯åŸå› </strong>ï¼šè¿™æ˜¯å› ä¸º MySQL çš„ä¸´æ—¶è¡¨ç©ºé—´å’Œç¼“å†²æ± ç©ºé—´ä¸è¶³å¯¼è‡´çš„ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå¢åŠ ç›¸å…³å†…å­˜å‚æ•°çš„è®¾ç½®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¢åŠ ä¸´æ—¶è¡¨å¤§å°åˆ°512MB</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> tmp_table_size <span class="operator">=</span> <span class="number">512</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>;</span><br><span class="line"><span class="comment">-- å¢åŠ InnoDBç¼“å†²æ± å¤§å°åˆ°1GB</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> innodb_buffer_pool_size <span class="operator">=</span> <span class="number">1</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æç¤º</strong>ï¼šè¿™äº›å‚æ•°éœ€è¦æ ¹æ®æ‚¨çš„æœåŠ¡å™¨å†…å­˜æƒ…å†µè¿›è¡Œé€‚å½“è°ƒæ•´ï¼Œä¸è¦è®¾ç½®å¾—è¿‡å¤§ä»¥å…å½±å“ç³»ç»Ÿç¨³å®šæ€§ã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥çœ‹çœ‹æµ‹è¯•ç»“æœï¼š</p>
<p>ä¸‹å›¾å±•ç¤ºäº†åœ¨ MySQL 8.0 ç‰ˆæœ¬ä¸Šè¿›è¡Œçš„æ€§èƒ½æµ‹è¯•ç»“æœã€‚æµ‹è¯•ç¯å¢ƒä¸ºä¸ªäººç”µè„‘ï¼ŒåŒæ—¶è¿è¡Œæœ‰ IDEã€æµè§ˆå™¨ç­‰åº”ç”¨ç¨‹åºï¼Œå› æ­¤è¿™äº›æ•°æ®ä»…ä¾›å‚è€ƒï¼Œä¸ä»£è¡¨ç”Ÿäº§ç¯å¢ƒçš„å®é™…æ€§èƒ½ã€‚</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746350930968.png" alt="1746350930968"></p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746350943788.png" alt="1746350943788"></p>
<p>ä»æµ‹è¯•æ•°æ®å¯ä»¥çœ‹å‡ºï¼Œå½“è¡¨ä¸­æ•°æ®é‡è¾¾åˆ° 2000 ä¸‡è¡Œåï¼ŒæŸ¥è¯¢å“åº”æ—¶é—´å‡ºç°æ˜æ˜¾ä¸Šå‡ã€‚è¿™ä¸è¡Œä¸šä¸­æµä¼ çš„&quot;å•è¡¨ä¸è¶…è¿‡ 2000 ä¸‡è¡Œ&quot;çš„å»ºè®®ç›¸ç¬¦ã€‚ä½†è¿™æ˜¯å¦æ˜¯ä¸€æ¡æ™®é€‚çš„è§„åˆ™ï¼Ÿ</p>
<h2 id="æ¢ç©¶-2000-ä¸‡è¡Œå»ºè®®å€¼çš„æ¥æº"><strong>æ¢ç©¶ 2000 ä¸‡è¡Œå»ºè®®å€¼çš„æ¥æº</strong></h2>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ†ææ•°æ®åº“å•è¡¨è¡Œæ•°çš„ç†è®ºä¸Šé™ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> person(</span><br><span class="line">    id <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span> comment <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">    person_id tinyint <span class="keyword">not null</span> comment <span class="string">&#x27;ç”¨æˆ· id&#x27;</span>,</span><br><span class="line">    person_name <span class="type">VARCHAR</span>(<span class="number">200</span>) comment <span class="string">&#x27;ç”¨æˆ·åç§°&#x27;</span>,</span><br><span class="line">    gmt_create datetime comment <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">    gmt_modified datetime comment <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;äººå‘˜ä¿¡æ¯è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ä»å»ºè¡¨è¯­å¥å¯ä»¥çœ‹å‡ºï¼Œid ä½œä¸ºä¸»é”®å…·æœ‰å”¯ä¸€æ€§çº¦æŸï¼Œä¸»é”®ç±»å‹å†³å®šäº†è¡¨çš„ç†è®ºå®¹é‡ä¸Šé™ï¼š</p>
<ul>
<li>è‹¥ä¸»é”®ä¸º <code>int</code>ç±»å‹ï¼ˆ32 ä½ï¼‰ï¼Œåˆ™æœ€å¤§æ”¯æŒ 2^32-1ï¼ˆçº¦ 21.4 äº¿ï¼‰è¡Œæ•°æ®</li>
<li>è‹¥ä¸»é”®ä¸º <code>bigint</code>ç±»å‹ï¼ˆ64 ä½ï¼‰ï¼Œåˆ™æœ€å¤§æ”¯æŒ 2^63-1ï¼ˆçº¦ 9.22Ã—10^18ï¼‰è¡Œæ•°æ®ï¼Œè¿™ä¸ªæ•°å€¼æå…¶åºå¤§ï¼Œåœ¨å®é™…åº”ç”¨ä¸­å¾ˆéš¾è¾¾åˆ°è¿™ä¸€é™åˆ¶</li>
</ul>
<p>æœ‰ç ”ç©¶è¡¨æ˜ï¼Œå¦‚æœä½¿ç”¨æ— ç¬¦å· bigint ä½œä¸ºè‡ªå¢ä¸»é”®ï¼Œå…¶æœ€å¤§å€¼ä¸º 18,446,744,073,709,551,615ã€‚æŒ‰ç…§æ¯ç§’å†™å…¥ä¸€æ¡è®°å½•çš„é€Ÿåº¦ï¼Œç†è®ºä¸Šéœ€è¦çº¦ 5800 äº¿å¹´æ‰èƒ½ç”¨å°½è¿™ä¸ªé™åˆ¶ï¼Œè¿œè¶…å®‡å®™çš„é¢„è®¡å¯¿å‘½ã€‚</p>
<table>
<thead>
<tr>
<th>ä¸€ç§’å¢åŠ çš„è®°å½•æ•°</th>
<th>å¤§çº¦å¤šå°‘å¹´ç”¨å®Œ</th>
</tr>
</thead>
<tbody>
<tr>
<td>1/1 ç§’</td>
<td>584942417355 å¹´</td>
</tr>
<tr>
<td>1w/ç§’</td>
<td>58494241 å¹´</td>
</tr>
<tr>
<td>100w/ç§’</td>
<td>584942 å¹´</td>
</tr>
<tr>
<td>1 äº¿/ç§’</td>
<td>5849 å¹´</td>
</tr>
</tbody>
</table>
<h2 id="è¡¨ç©ºé—´"><strong>è¡¨ç©ºé—´</strong></h2>
<p>ä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹ç´¢å¼•çš„ç»“æ„ï¼Œæˆ‘ä»¬ä¸‹é¢è®²å†…å®¹éƒ½æ˜¯åŸºäº Innodb å¼•æ“çš„ï¼Œå¤§å®¶éƒ½çŸ¥é“ Innodb çš„ç´¢å¼•å†…éƒ¨ç”¨çš„æ˜¯ B+ æ ‘ã€‚</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746351373593.png" alt="1746351373593"></p>
<p>è¿™å¼ è¡¨æ•°æ®ï¼Œåœ¨ç¡¬ç›˜ä¸Šå­˜å‚¨ä¹Ÿæ˜¯ç±»ä¼¼å¦‚æ­¤çš„ï¼Œå®ƒå®é™…æ˜¯æ”¾åœ¨ä¸€ä¸ªå« person.ibdï¼ˆinnodb dataï¼‰çš„æ–‡ä»¶ä¸­ï¼Œä¹Ÿå«åšè¡¨ç©ºé—´ï¼›è™½ç„¶æ•°æ®è¡¨ä¸­ï¼Œä»–ä»¬çœ‹èµ·æ¥æ˜¯ä¸€æ¡è¿ç€ä¸€æ¡ï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨æ–‡ä»¶ä¸­å®ƒè¢«åˆ†æˆå¾ˆå¤šå°ä»½çš„æ•°æ®é¡µï¼Œè€Œä¸”æ¯ä¸€ä»½éƒ½æ˜¯ 16Kã€‚</p>
<p>å¤§æ¦‚å°±åƒä¸‹é¢è¿™æ ·ï¼Œå½“ç„¶è¿™åªæ˜¯æˆ‘ä»¬æŠ½è±¡å‡ºæ¥çš„ï¼Œåœ¨è¡¨ç©ºé—´ä¸­è¿˜æœ‰æ®µã€åŒºã€ç»„ç­‰å¾ˆå¤šæ¦‚å¿µï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è·³å‡ºæ¥çœ‹ã€‚</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746351388668.png" alt="1746351388668"></p>
<h2 id="é¡µçš„æ•°æ®ç»“æ„"><strong>é¡µçš„æ•°æ®ç»“æ„</strong></h2>
<p>å®é™…é¡µçš„å†…éƒ¨ç»“æ„åƒæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746351399761.png" alt="1746351399761"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ª InnoDB æ•°æ®é¡µçš„å­˜å‚¨ç©ºé—´å¤§è‡´è¢«åˆ’åˆ†æˆäº† 7 ä¸ªéƒ¨åˆ†ï¼Œæœ‰çš„éƒ¨åˆ†å ç”¨çš„å­—èŠ‚æ•°æ˜¯ç¡®å®šçš„ï¼Œæœ‰çš„éƒ¨åˆ†å ç”¨çš„å­—èŠ‚æ•°æ˜¯ä¸ç¡®å®šçš„ã€‚</p>
<p>åœ¨é¡µçš„ 7 ä¸ªç»„æˆéƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è‡ªå·±å­˜å‚¨çš„è®°å½•ä¼šæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„è¡Œæ ¼å¼å­˜å‚¨åˆ° <code>User Records</code> éƒ¨åˆ†ã€‚</p>
<p>ä½†æ˜¯åœ¨ä¸€å¼€å§‹ç”Ÿæˆé¡µçš„æ—¶å€™ï¼Œå…¶å®å¹¶æ²¡æœ‰ User Records è¿™ä¸ªéƒ¨åˆ†ï¼Œæ¯å½“æˆ‘ä»¬æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä» Free Space éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å°šæœªä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ä¸­ç”³è¯·ä¸€ä¸ªè®°å½•å¤§å°çš„ç©ºé—´åˆ’åˆ†åˆ° User Records éƒ¨åˆ†ã€‚</p>
<p>å½“ Free Space éƒ¨åˆ†çš„ç©ºé—´å…¨éƒ¨è¢« User Records éƒ¨åˆ†æ›¿ä»£æ‰ä¹‹åï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªé¡µä½¿ç”¨å®Œäº†ï¼Œå¦‚æœè¿˜æœ‰æ–°çš„è®°å½•æ’å…¥çš„è¯ï¼Œå°±éœ€è¦å»ç”³è¯·æ–°çš„é¡µäº†ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹çš„å›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746351415703.png" alt="1746351415703"></p>
<p>åˆšåˆšä¸Šé¢è¯´åˆ°äº†æ•°æ®çš„æ–°å¢çš„è¿‡ç¨‹ã€‚</p>
<p>é‚£ä¸‹é¢å°±æ¥è¯´è¯´ï¼Œæ•°æ®çš„æŸ¥æ‰¾è¿‡ç¨‹ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾ä¸€æ¡è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¡¨ç©ºé—´ä¸­çš„æ¯ä¸€é¡µéƒ½åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå¯¹è®°å½•æŒ¨ä¸ªåˆ¤æ–­æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p>åœ¨æ•°æ®é‡å°çš„æ—¶å€™ï¼Œæ²¡å•¥é—®é¢˜ï¼Œå†…å­˜ä¹Ÿå¯ä»¥æ’‘ã€‚ä½†æ˜¯ç°å®å°±æ˜¯è¿™ä¹ˆæ®‹é…·ï¼Œä¸ä¼šç»™ä½ è¿™ä¸ªå±€é¢ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™é—®é¢˜ï¼ŒMySQL ä¸­å°±æœ‰äº†ç´¢å¼•çš„æ¦‚å¿µï¼Œå¤§å®¶éƒ½çŸ¥é“ç´¢å¼•èƒ½å¤ŸåŠ å¿«æ•°æ®çš„æŸ¥è¯¢ï¼Œé‚£åˆ°åº•æ˜¯æ€ä¹ˆä¸ªå›äº‹å‘¢ï¼Ÿä¸‹é¢æˆ‘å°±æ¥çœ‹çœ‹ã€‚</p>
<h2 id="ç´¢å¼•çš„æ•°æ®ç»“æ„"><strong>ç´¢å¼•çš„æ•°æ®ç»“æ„</strong></h2>
<p>åœ¨ MySQL ä¸­ç´¢å¼•çš„æ•°æ®ç»“æ„å’Œåˆšåˆšæè¿°çš„é¡µå‡ ä¹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œè€Œä¸”å¤§å°ä¹Ÿæ˜¯ 16K,ã€‚</p>
<p>ä½†æ˜¯åœ¨ç´¢å¼•é¡µä¸­è®°å½•çš„æ˜¯é¡µ (æ•°æ®é¡µï¼Œç´¢å¼•é¡µ) çš„æœ€å°ä¸»é”® id å’Œé¡µå·ï¼Œä»¥åŠåœ¨ç´¢å¼•é¡µä¸­å¢åŠ äº†å±‚çº§çš„ä¿¡æ¯ï¼Œä» 0 å¼€å§‹å¾€ä¸Šç®—ï¼Œæ‰€ä»¥é¡µä¸é¡µä¹‹é—´å°±å½¢æˆäº†å±‚çº§ç»“æ„å…³ç³»ã€‚</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746351427532.png" alt="1746351427532"></p>
<p>è¿™ç§ç»“æ„å®é™…ä¸Šå‘ˆç°äº†æ ‘çŠ¶ç»“æ„çš„ç‰¹å¾ï¼Œç±»ä¼¼äºå±‚æ¬¡åŒ–çš„ç´¢å¼•ç»„ç»‡ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ç®€å•å±•ç¤ºäº†ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œ2 å±‚ç»“æ„ï¼Œä½†éšç€æ•°æ®å¢åŠ ï¼Œç»“æ„å¯èƒ½æ‰©å±•è‡³ 3 å±‚ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ B+ æ ‘ï¼Œæœ€ä¸‹é¢é‚£ä¸€å±‚çš„ page level =0, ä¹Ÿå°±æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå…¶ä½™éƒ½æ˜¯éå¶å­èŠ‚ç‚¹ã€‚</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746351436733.png" alt="1746351436733"></p>
<p>ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸ªéå¶å­èŠ‚ç‚¹ï¼ˆç´¢å¼•é¡µï¼‰ï¼Œåœ¨éå¶å­èŠ‚ç‚¹çš„å†…å®¹åŒºä¸­åŒ…å«ä¸»é”® ID å€¼å’Œå¯¹åº”çš„é¡µå·æŒ‡é’ˆä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š</p>
<ul>
<li>idï¼šå¯¹åº”é¡µä¸­è®°å½•çš„æœ€å°è®°å½• id å€¼ï¼›</li>
<li>é¡µå·ï¼šæŒ‡å‘å¯¹åº”é¡µçš„æŒ‡é’ˆï¼›</li>
</ul>
<p>è€Œæ•°æ®é¡µä¸æ­¤å‡ ä¹å¤§åŒå°å¼‚ï¼ŒåŒºåˆ«åœ¨äºæ•°æ®é¡µè®°å½•çš„æ˜¯çœŸå®çš„è¡Œæ•°æ®è€Œä¸æ˜¯é¡µåœ°å€ï¼Œè€Œä¸” id çš„ä¹Ÿæ˜¯é¡ºåºçš„ã€‚</p>
<h2 id="å•è¡¨å»ºè®®å€¼"><strong>å•è¡¨å»ºè®®å€¼</strong></h2>
<p>ä¸‹é¢æˆ‘ä»¬å°±ä»¥ 3 å±‚ï¼Œ2 åˆ†å‰ï¼ˆå®é™…ä¸­æ˜¯ M åˆ†å‰ï¼‰çš„å›¾ä¾‹æ¥è¯´æ˜ä¸€ä¸‹æŸ¥æ‰¾ä¸€ä¸ªè¡Œæ•°æ®çš„è¿‡ç¨‹ã€‚</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746351449311.png" alt="1746351449311"></p>
<p>æ¯”å¦‚è¯´æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾ä¸€ä¸ª id=6 çš„è¡Œæ•°æ®ï¼š</p>
<ul>
<li>å› ä¸ºåœ¨éå¶å­èŠ‚ç‚¹ä¸­å­˜æ”¾çš„æ˜¯é¡µå·å’Œè¯¥é¡µæœ€å°çš„ idï¼Œæ‰€ä»¥æˆ‘ä»¬ä»é¡¶å±‚å¼€å§‹å¯¹æ¯”ï¼Œé¦–å…ˆçœ‹é¡µå· 10 ä¸­çš„ç›®å½•ï¼Œæœ‰ [id=1, é¡µå· = 20],[id=5, é¡µå· = 30], è¯´æ˜å·¦ä¾§èŠ‚ç‚¹æœ€å° id ä¸º 1ï¼Œå³ä¾§èŠ‚ç‚¹æœ€å° id æ˜¯ 5ã€‚6&gt;5, é‚£æŒ‰ç…§äºŒåˆ†æ³•æŸ¥æ‰¾çš„è§„åˆ™ï¼Œè‚¯å®šå°±å¾€å³ä¾§èŠ‚ç‚¹ç»§ç»­æŸ¥æ‰¾ï¼›</li>
<li>æ‰¾åˆ°é¡µå· 30 çš„èŠ‚ç‚¹åï¼Œå‘ç°è¿™ä¸ªèŠ‚ç‚¹è¿˜æœ‰å­èŠ‚ç‚¹ï¼ˆéå¶å­èŠ‚ç‚¹ï¼‰ï¼Œé‚£å°±ç»§ç»­æ¯”å¯¹ï¼ŒåŒç†ï¼Œ6&gt;5 &amp;&amp; 6&lt;7, æ‰€ä»¥æ‰¾åˆ°äº†é¡µå· 60ï¼›</li>
<li>æ‰¾åˆ°é¡µå· 60 ä¹‹åï¼Œå‘ç°æ­¤èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰ï¼Œäºæ˜¯å°†æ­¤é¡µæ•°æ®åŠ è½½è‡³å†…å­˜è¿›è¡Œä¸€ä¸€å¯¹æ¯”ï¼Œç»“æœæ‰¾åˆ°äº† id=6 çš„æ•°æ®è¡Œã€‚</li>
</ul>
<p>ä»ä¸Šè¿°çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œæˆ‘ä»¬ä¸ºäº†æŸ¥æ‰¾ id=6 çš„æ•°æ®ï¼Œæ€»å…±æŸ¥è¯¢äº†ä¸‰ä¸ªé¡µï¼Œå¦‚æœä¸‰ä¸ªé¡µéƒ½åœ¨ç£ç›˜ä¸­ï¼ˆæœªæå‰åŠ è½½è‡³å†…å­˜ï¼‰ï¼Œé‚£ä¹ˆæœ€å¤šéœ€è¦ç»å†ä¸‰æ¬¡çš„ç£ç›˜ IOã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›¾ä¸­çš„é¡µå·åªæ˜¯ä¸ªç¤ºä¾‹ï¼Œå®é™…æƒ…å†µä¸‹å¹¶ä¸æ˜¯è¿ç»­çš„ï¼Œåœ¨ç£ç›˜ä¸­å­˜å‚¨ä¹Ÿä¸ä¸€å®šæ˜¯é¡ºåºçš„ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§æ¦‚å·²ç»äº†è§£äº†è¡¨çš„æ•°æ®æ˜¯æ€ä¹ˆä¸ªç»“æ„äº†ï¼Œä¹Ÿå¤§æ¦‚çŸ¥é“æŸ¥è¯¢æ•°æ®æ˜¯ä¸ªæ€ä¹ˆçš„è¿‡ç¨‹äº†ï¼Œè¿™æ ·æˆ‘ä»¬ä¹Ÿå°±èƒ½å¤§æ¦‚ä¼°ç®—è¿™æ ·çš„ç»“æ„èƒ½å­˜æ”¾å¤šå°‘æ•°æ®äº†ã€‚</p>
<p>ä»ä¸Šé¢çš„å›¾è§£æˆ‘ä»¬çŸ¥é“ B+ æ•°çš„å¶å­èŠ‚ç‚¹æ‰æ˜¯å­˜åœ¨æ•°æ®çš„ï¼Œè€Œéå¶å­èŠ‚ç‚¹æ˜¯ç”¨æ¥å­˜æ”¾ç´¢å¼•æ•°æ®çš„ã€‚</p>
<p>æ‰€ä»¥ï¼ŒåŒæ ·ä¸€ä¸ª 16K çš„é¡µï¼Œéå¶å­èŠ‚ç‚¹é‡Œçš„æ¯æ¡æ•°æ®éƒ½æŒ‡å‘æ–°çš„é¡µï¼Œè€Œæ–°çš„é¡µæœ‰ä¸¤ç§å¯èƒ½</p>
<ul>
<li>å¦‚æœæ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé‡Œé¢å°±æ˜¯ä¸€è¡Œè¡Œçš„æ•°æ®</li>
<li>å¦‚æœæ˜¯éå¶å­èŠ‚ç‚¹çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šç»§ç»­æŒ‡å‘æ–°çš„é¡µ</li>
</ul>
<p>å‡è®¾</p>
<ul>
<li>éå¶å­èŠ‚ç‚¹å†…æŒ‡å‘å…¶ä»–é¡µçš„æ•°é‡ä¸º x</li>
<li>å¶å­èŠ‚ç‚¹å†…èƒ½å®¹çº³çš„æ•°æ®è¡Œæ•°ä¸º y</li>
<li>B+ æ•°çš„å±‚æ•°ä¸º z</li>
</ul>
<p>å¦‚ä¸‹å›¾ä¸­æ‰€ç¤ºï¼Œ<strong>æ€»è®°å½•æ•° = $x^{z-1} \times y$ï¼Œå³æ€»æ•°ç­‰äº $x$ çš„ $z-1$ æ¬¡æ–¹ä¸ $y$ çš„ä¹˜ç§¯</strong>ã€‚</p>
<p><img src="/2025/05/04/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/MYSQL%E5%8D%95%E8%A1%A8%E5%BB%BA%E8%AE%AE%E6%95%B0%E6%8D%AE%E9%87%8F/1746351464769.png" alt="1746351464769"></p>
<blockquote>
<p>X =ï¼Ÿ</p>
</blockquote>
<p>åœ¨æ–‡ç« çš„å¼€å¤´å·²ç»ä»‹ç»äº†é¡µçš„ç»“æ„ï¼Œç´¢å¼•ä¹Ÿä¹Ÿä¸ä¾‹å¤–ï¼Œéƒ½ä¼šæœ‰ File Header (38 byte)ã€Page Header (56 Byte)ã€Infimum + Supermumï¼ˆ26 byteï¼‰ã€File Trailerï¼ˆ8byteï¼‰, å†åŠ ä¸Šé¡µç›®å½•ï¼Œå¤§æ¦‚ 1k å·¦å³ã€‚</p>
<p>æˆ‘ä»¬å°±å½“åšå®ƒå°±æ˜¯ 1K, é‚£æ•´ä¸ªé¡µçš„å¤§å°æ˜¯ 16K, å‰©ä¸‹ 15k ç”¨äºå­˜æ•°æ®ï¼Œåœ¨ç´¢å¼•é¡µä¸­ä¸»è¦è®°å½•çš„æ˜¯ä¸»é”®ä¸é¡µå·ï¼Œä¸»é”®æˆ‘ä»¬å‡è®¾æ˜¯ Bigint (8 byte), è€Œé¡µå·ä¹Ÿæ˜¯å›ºå®šçš„ï¼ˆ4Byteï¼‰, é‚£ä¹ˆç´¢å¼•é¡µä¸­çš„ä¸€æ¡æ•°æ®ä¹Ÿå°±æ˜¯ 12byteã€‚</p>
<p>æ‰€ä»¥ x=15*1024/12â‰ˆ1280 è¡Œã€‚</p>
<blockquote>
<p>Y=ï¼Ÿ</p>
</blockquote>
<p>å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹çš„ç»“æ„æ˜¯ä¸€æ ·çš„ï¼ŒåŒç†ï¼Œèƒ½æ”¾æ•°æ®çš„ç©ºé—´ä¹Ÿæ˜¯ 15kã€‚</p>
<p>ä½†æ˜¯å¶å­èŠ‚ç‚¹ä¸­å­˜æ”¾çš„æ˜¯çœŸæ­£çš„è¡Œæ•°æ®ï¼Œè¿™ä¸ªå½±å“çš„å› ç´ å°±ä¼šå¤šå¾ˆå¤šï¼Œæ¯”å¦‚ï¼Œå­—æ®µçš„ç±»å‹ï¼Œå­—æ®µçš„æ•°é‡ã€‚æ¯è¡Œæ•°æ®å ç”¨ç©ºé—´è¶Šå¤§ï¼Œé¡µä¸­æ‰€æ”¾çš„è¡Œæ•°é‡å°±ä¼šè¶Šå°‘ã€‚</p>
<p>è¿™è¾¹æˆ‘ä»¬æš‚æ—¶æŒ‰ä¸€æ¡è¡Œæ•°æ® 1k æ¥ç®—ï¼Œé‚£ä¸€é¡µå°±èƒ½å­˜ä¸‹ 15 æ¡ï¼ŒY = 15*1024/1000 â‰ˆ15ã€‚</p>
<p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å¼€å§‹æ¨ç®—æ€»å®¹é‡äº†ã€‚</p>
<p>æ ¹æ®ä¸Šè¿°çš„å…¬å¼ï¼Œæ€»è®°å½•æ•° = $x^{z-1} \times y$ï¼Œå·²çŸ¥ $x=1280ï¼Œy=15$ï¼š</p>
<ul>
<li>å‡è®¾ B+ æ ‘æ˜¯ä¸¤å±‚ï¼Œé‚£å°±æ˜¯ z = 2ï¼ŒTotal = ï¼ˆ1280 ^1ï¼‰*15 = 19200</li>
<li>å‡è®¾ B+ æ ‘æ˜¯ä¸‰å±‚ï¼Œé‚£å°±æ˜¯ z = 3ï¼ŒTotal = ï¼ˆ1280 ^2ï¼‰ *15 = 24576000ï¼ˆçº¦ 2.45kwï¼‰</li>
</ul>
<p>è¿™ä¸æ–‡ç« å¼€å¤´æåˆ°çš„ 2000W è¡Œæ•°å»ºè®®å€¼é«˜åº¦å»åˆã€‚å®é™…ä¸Šï¼Œä¸€èˆ¬ B+ æ ‘çš„å±‚çº§æœ€å¤šä¹Ÿå°±æ˜¯ 3 å±‚ã€‚</p>
<p>å¦‚æœå¢åŠ åˆ° 4 å±‚ï¼Œä¸ä»…æŸ¥è¯¢æ—¶å¯èƒ½å¢åŠ ç£ç›˜ IO æ¬¡æ•°ï¼Œè€Œä¸”æ€»è®°å½•æ•°å°†è¾¾åˆ°çº¦ 3 ç™¾å¤šäº¿ï¼Œè¿™åœ¨å¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸­å¹¶ä¸å®ç”¨ã€‚å› æ­¤ï¼Œ3 å±‚ç»“æ„æ˜¯è¾ƒä¸ºåˆç†çš„é€‰æ‹©ã€‚</p>
<p>ç„¶è€Œï¼Œæˆ‘ä»¬çš„åˆ†æè¿˜éœ€è¦ç»§ç»­æ·±å…¥ã€‚</p>
<p>æˆ‘ä»¬åˆšåˆšåœ¨è®¡ç®— Y å€¼æ—¶å‡è®¾æ¯è¡Œæ•°æ®å ç”¨ç©ºé—´ä¸º 1Kã€‚ä½†å¦‚æœå®é™…æ¯è¡Œæ•°æ®å ç”¨ 5Kï¼Œé‚£æ¯ä¸ªæ•°æ®é¡µæœ€å¤šåªèƒ½å®¹çº³ 3 æ¡è®°å½•ã€‚</p>
<p>åŒæ ·æŒ‰ç…§ $z = 3$ è®¡ç®—ï¼Œæ€»è®°å½•æ•° $= ï¼ˆ1280 ^2ï¼‰ \times 3 = 4915200ï¼ˆçº¦ 500wï¼‰$</p>
<p>ç”±æ­¤å¯è§ï¼Œåœ¨ä¿æŒç›¸åŒå±‚çº§ç»“æ„ï¼ˆå³ç›¸ä¼¼æŸ¥è¯¢æ€§èƒ½ï¼‰çš„æƒ…å†µä¸‹ï¼Œè¡Œæ•°æ®å¤§å°çš„ä¸åŒä¼šæ˜¾è‘—å½±å“æœ€å¤§å»ºè®®è®°å½•æ•°ã€‚æ­¤å¤–ï¼Œå½±å“æŸ¥è¯¢æ€§èƒ½çš„è¿˜æœ‰è¯¸å¤šå› ç´ ï¼Œå¦‚æ•°æ®åº“ç‰ˆæœ¬ã€æœåŠ¡å™¨é…ç½®ã€SQL ç¼–å†™è´¨é‡ç­‰ã€‚</p>
<p>MySQL ä¸ºäº†æé«˜æ€§èƒ½ï¼Œä¼šå°†è¡¨çš„ç´¢å¼•è£…è½½åˆ°å†…å­˜ä¸­ã€‚å½“ InnoDB buffer size å……è¶³æ—¶ï¼Œå¯ä»¥å®ç°ç´¢å¼•çš„å…¨å†…å­˜åŠ è½½ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸ä¼šå—åˆ°æ˜æ˜¾å½±å“ã€‚</p>
<p>ç„¶è€Œï¼Œå½“å•è¡¨æ•°æ®é‡è¾¾åˆ°ç‰¹å®šä¸Šé™åï¼Œå†…å­˜å¯èƒ½æ— æ³•å®Œå…¨å®¹çº³ç´¢å¼•ï¼Œå¯¼è‡´åç»­ SQL æŸ¥è¯¢äº§ç”Ÿé¢å¤–çš„ç£ç›˜ IOï¼Œä»è€Œé™ä½æ€§èƒ½ã€‚å› æ­¤ï¼Œæå‡ç¡¬ä»¶é…ç½®ï¼ˆå¦‚å¢åŠ å†…å­˜ï¼‰å¯èƒ½ä¼šæ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<h2 id="æ€»ç»“"><strong>æ€»ç»“</strong></h2>
<ul>
<li>MySQL çš„è¡¨æ•°æ®æ˜¯ä»¥é¡µçš„å½¢å¼å­˜æ”¾çš„ï¼Œé¡µåœ¨ç£ç›˜ä¸­ä¸ä¸€å®šæ˜¯è¿ç»­çš„ã€‚</li>
<li>é¡µçš„ç©ºé—´æ˜¯ 16K, å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½æ˜¯ç”¨æ¥å­˜æ”¾æ•°æ®çš„ï¼Œä¼šæœ‰ä¸€äº›å›ºå®šçš„ä¿¡æ¯ï¼Œå¦‚ï¼Œé¡µå¤´ï¼Œé¡µå°¾ï¼Œé¡µç ï¼Œæ ¡éªŒç ç­‰ç­‰ã€‚</li>
<li>åœ¨ B+ æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹çš„æ•°æ®ç»“æ„æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºï¼Œå¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…çš„è¡Œæ•°æ®ï¼Œè€Œéå¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å’Œé¡µå·ã€‚</li>
<li>ç´¢å¼•ç»“æ„ä¸ä¼šå½±å“å•è¡¨æœ€å¤§è¡Œæ•°ï¼Œ2000W ä¹Ÿåªæ˜¯æ¨èå€¼ï¼Œè¶…è¿‡äº†è¿™ä¸ªå€¼å¯èƒ½ä¼šå¯¼è‡´ B + æ ‘å±‚çº§æ›´é«˜ï¼Œå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>ç´¢å¼•</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>ç´¢å¼•</tag>
        <tag>B+æ ‘</tag>
        <tag>è¡¨ç©ºé—´</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 207 - è¯¾ç¨‹è¡¨ï¼ˆCourse Scheduleï¼‰</title>
    <url>/2025/05/03/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-207-%E8%AF%BE%E7%A8%8B%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ä½ è¿™ä¸ªå­¦æœŸå¿…é¡»é€‰ä¿® <code>numCourses</code> é—¨è¯¾ç¨‹ï¼Œè®°ä¸º <code>0</code> åˆ° <code>numCourses - 1</code>ã€‚</p>
<p>åœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚å…ˆä¿®è¯¾ç¨‹æŒ‰æ•°ç»„ <code>prerequisites</code> ç»™å‡ºï¼Œå…¶ä¸­ <code>prerequisites[i] = [ai, bi]</code>ï¼Œè¡¨ç¤ºå¦‚æœè¦å­¦ä¹ è¯¾ç¨‹ <code>ai</code> åˆ™<strong>å¿…é¡»</strong>å…ˆå­¦ä¹ è¯¾ç¨‹ <code>bi</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå…ˆä¿®è¯¾ç¨‹å¯¹ <code>[0, 1]</code> è¡¨ç¤ºï¼šæƒ³è¦å­¦ä¹ è¯¾ç¨‹ <code>0</code>ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ <code>1</code>ã€‚</p>
<p>è¯·ä½ åˆ¤æ–­æ˜¯å¦å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„å­¦ä¹ ï¼Ÿå¦‚æœå¯ä»¥ï¼Œè¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnumCourses = 2, prerequisites = [[1,0]]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šæ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å®Œæˆè¯¾ç¨‹ 0ã€‚è¿™æ˜¯å¯èƒ½çš„ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnumCourses = 2, prerequisites = [[1,0],[0,1]]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼šæ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ï¼›å¹¶ä¸”å­¦ä¹ è¯¾ç¨‹ 0 ä¹‹å‰ï¼Œä½ è¿˜åº”å…ˆå®Œæˆè¯¾ç¨‹ 1ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li><code>1 &lt;= numCourses &lt;= 2000</code></li>
<li><code>0 &lt;= prerequisites.length &lt;= 5000</code></li>
<li><code>prerequisites[i].length == 2</code></li>
<li><code>0 &lt;= ai, bi &lt; numCourses</code></li>
<li><code>prerequisites[i]</code> ä¸­çš„æ‰€æœ‰è¯¾ç¨‹å¯¹<strong>äº’ä¸ç›¸åŒ</strong></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™ä¸ªé—®é¢˜æœ¬è´¨ä¸Šæ˜¯<strong>åˆ¤æ–­ä¸€ä¸ªæœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯</strong>ã€‚æˆ‘ä»¬å¯ä»¥å°†è¯¾ç¨‹çœ‹ä½œå›¾ä¸­çš„èŠ‚ç‚¹ï¼Œå…ˆä¿®å…³ç³»çœ‹ä½œæœ‰å‘è¾¹ã€‚å¦‚æœå›¾ä¸­å­˜åœ¨ç¯ï¼Œé‚£ä¹ˆå°±æ— æ³•å®Œæˆæ‰€æœ‰è¯¾ç¨‹ï¼ˆå› ä¸ºç¯æ„å‘³ç€å‡ºç°äº†å¾ªç¯ä¾èµ–ï¼‰ã€‚</p>
<p>å¯¹äºè¿™ç±»é—®é¢˜ï¼Œé€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š<strong>æ‹“æ‰‘æ’åºï¼ˆBFSï¼‰</strong> å’Œ <strong>æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰</strong>ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šBFS-æ‹“æ‰‘æ’åº">æ–¹æ³•ä¸€ï¼šBFS æ‹“æ‰‘æ’åº</h3>
<p>æ‹“æ‰‘æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼š</p>
<ol>
<li>è®¡ç®—å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å…¥åº¦ï¼ˆæœ‰å¤šå°‘æ¡è¾¹æŒ‡å‘è¯¥èŠ‚ç‚¹ï¼‰</li>
<li>å°†æ‰€æœ‰å…¥åº¦ä¸º 0 çš„èŠ‚ç‚¹ï¼ˆæ²¡æœ‰å…ˆä¿®è¯¾ç¨‹çš„è¯¾ç¨‹ï¼‰åŠ å…¥é˜Ÿåˆ—</li>
<li>é€ä¸ªå‡ºé˜Ÿï¼Œå°†å‡ºé˜ŸèŠ‚ç‚¹çš„æ‰€æœ‰ç›¸é‚»èŠ‚ç‚¹çš„å…¥åº¦å‡ 1</li>
<li>å¦‚æœç›¸é‚»èŠ‚ç‚¹çš„å…¥åº¦å˜ä¸º 0ï¼Œåˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—</li>
<li>é‡å¤æ­¥éª¤ 3-4ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©º</li>
<li>å¦‚æœæœ€ç»ˆè®¿é—®çš„èŠ‚ç‚¹æ•°ç­‰äºæ€»èŠ‚ç‚¹æ•°ï¼Œåˆ™è¯´æ˜ä¸å­˜åœ¨ç¯ï¼Œå¯ä»¥å®Œæˆæ‰€æœ‰è¯¾ç¨‹</li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šDFS-æ£€æµ‹ç¯">æ–¹æ³•äºŒï¼šDFS æ£€æµ‹ç¯</h3>
<p>DFS æ£€æµ‹ç¯çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼š</p>
<ol>
<li>å¯¹å›¾ä¸­çš„æ¯ä¸ªæœªè®¿é—®è¿‡çš„èŠ‚ç‚¹è¿›è¡Œ DFS</li>
<li>åœ¨ DFS è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¸‰ç§çŠ¶æ€æ ‡è®°èŠ‚ç‚¹ï¼š
<ul>
<li>æœªè®¿é—®ï¼ˆ0ï¼‰</li>
<li>è®¿é—®ä¸­ï¼ˆ1ï¼‰ï¼šå½“å‰ DFS è·¯å¾„ä¸Šçš„èŠ‚ç‚¹</li>
<li>å·²å®Œæˆï¼ˆ2ï¼‰ï¼šèŠ‚ç‚¹åŠå…¶æ‰€æœ‰åä»£éƒ½å·²è¢«è®¿é—®</li>
</ul>
</li>
<li>å¦‚æœ DFS è¿‡ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªã€Œè®¿é—®ä¸­ã€çš„èŠ‚ç‚¹ï¼Œåˆ™è¯´æ˜å­˜åœ¨ç¯</li>
<li>å¦‚æœæ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½è¢«æ ‡è®°ä¸ºã€Œå·²å®Œæˆã€ï¼Œåˆ™è¯´æ˜ä¸å­˜åœ¨ç¯</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="BFS-æ‹“æ‰‘æ’åºå®ç°">BFS æ‹“æ‰‘æ’åºå®ç°</h3>
<p>BFS å®ç°éœ€è¦ç»´æŠ¤ä»¥ä¸‹æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li>é‚»æ¥è¡¨ï¼ˆadjacency listï¼‰ï¼šè¡¨ç¤ºå›¾ç»“æ„</li>
<li>å…¥åº¦æ•°ç»„ï¼šè®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„å…¥åº¦</li>
<li>é˜Ÿåˆ—ï¼šå­˜å‚¨å…¥åº¦ä¸º 0 çš„èŠ‚ç‚¹</li>
</ul>
<p>å…·ä½“æ­¥éª¤ï¼š</p>
<ol>
<li>æ„å»ºé‚»æ¥è¡¨å’Œå…¥åº¦æ•°ç»„</li>
<li>å°†æ‰€æœ‰å…¥åº¦ä¸º 0 çš„èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</li>
<li>BFS å¤„ç†é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ï¼š
<ul>
<li>å‡ºé˜Ÿä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°†å­¦ä¹ çš„è¯¾ç¨‹æ•°åŠ  1</li>
<li>å°†å…¶æ‰€æœ‰ç›¸é‚»èŠ‚ç‚¹çš„å…¥åº¦å‡ 1</li>
<li>å¦‚æœç›¸é‚»èŠ‚ç‚¹çš„å…¥åº¦å˜ä¸º 0ï¼Œåˆ™åŠ å…¥é˜Ÿåˆ—</li>
</ul>
</li>
<li>æ£€æŸ¥å­¦ä¹ çš„è¯¾ç¨‹æ•°æ˜¯å¦ç­‰äºæ€»è¯¾ç¨‹æ•°</li>
</ol>
<h3 id="DFS-æ£€æµ‹ç¯å®ç°">DFS æ£€æµ‹ç¯å®ç°</h3>
<p>DFS å®ç°éœ€è¦ä»¥ä¸‹æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li>é‚»æ¥è¡¨ï¼šè¡¨ç¤ºå›¾ç»“æ„</li>
<li>è®¿é—®çŠ¶æ€æ•°ç»„ï¼šè®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„è®¿é—®çŠ¶æ€</li>
</ul>
<p>å…·ä½“æ­¥éª¤ï¼š</p>
<ol>
<li>æ„å»ºé‚»æ¥è¡¨</li>
<li>å¯¹æ¯ä¸ªæœªè®¿é—®çš„èŠ‚ç‚¹è¿›è¡Œ DFSï¼š
<ul>
<li>å¦‚æœèŠ‚ç‚¹åœ¨å½“å‰è·¯å¾„ä¸Šè¢«è®¿é—®è¿‡ï¼ˆçŠ¶æ€ä¸º 1ï¼‰ï¼Œåˆ™å­˜åœ¨ç¯</li>
<li>å¦‚æœèŠ‚ç‚¹å·²ç»è¢«å®Œå…¨å¤„ç†ï¼ˆçŠ¶æ€ä¸º 2ï¼‰ï¼Œåˆ™è·³è¿‡</li>
<li>å¦åˆ™ï¼Œæ ‡è®°èŠ‚ç‚¹ä¸ºã€Œè®¿é—®ä¸­ã€ï¼ˆçŠ¶æ€ä¸º 1ï¼‰</li>
<li>é€’å½’è®¿é—®æ‰€æœ‰ç›¸é‚»èŠ‚ç‚¹</li>
<li>æ ‡è®°èŠ‚ç‚¹ä¸ºã€Œå·²å®Œæˆã€ï¼ˆçŠ¶æ€ä¸º 2ï¼‰</li>
</ul>
</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šBFS-æ‹“æ‰‘æ’åº-2">æ–¹æ³•ä¸€ï¼šBFS æ‹“æ‰‘æ’åº</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canFinish</span><span class="params">(numCourses <span class="type">int</span>, prerequisites [][]<span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// æ„å»ºé‚»æ¥è¡¨å’Œå…¥åº¦æ•°ç»„</span></span><br><span class="line">    graph := <span class="built_in">make</span>([][]<span class="type">int</span>, numCourses)    <span class="comment">// é‚»æ¥è¡¨ï¼šgraph[i] è¡¨ç¤ºå­¦å®Œè¯¾ç¨‹iåå¯ä»¥å­¦ä¹ çš„è¯¾ç¨‹åˆ—è¡¨</span></span><br><span class="line">    inDegree := <span class="built_in">make</span>([]<span class="type">int</span>, numCourses)   <span class="comment">// å…¥åº¦æ•°ç»„ï¼šinDegree[i] è¡¨ç¤ºå­¦ä¹ è¯¾ç¨‹iå‰éœ€è¦å®Œæˆçš„è¯¾ç¨‹æ•°é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¡«å……é‚»æ¥è¡¨å’Œè®¡ç®—å…¥åº¦</span></span><br><span class="line">    <span class="keyword">for</span> _, prereq := <span class="keyword">range</span> prerequisites &#123;</span><br><span class="line">        course, prerequisite := prereq[<span class="number">0</span>], prereq[<span class="number">1</span>]</span><br><span class="line">        <span class="comment">// æ·»åŠ æœ‰å‘è¾¹ï¼šprerequisite -&gt; course</span></span><br><span class="line">        graph[prerequisite] = <span class="built_in">append</span>(graph[prerequisite], course)</span><br><span class="line">        <span class="comment">// è¯¾ç¨‹courseçš„å…¥åº¦åŠ 1</span></span><br><span class="line">        inDegree[course]++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†æ‰€æœ‰å…¥åº¦ä¸º0çš„è¯¾ç¨‹åŠ å…¥é˜Ÿåˆ—ï¼ˆæ²¡æœ‰å…ˆä¿®è¯¾ç¨‹çš„è¯¾ç¨‹ï¼‰</span></span><br><span class="line">    queue := []<span class="type">int</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numCourses; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> inDegree[i] == <span class="number">0</span> &#123;</span><br><span class="line">            queue = <span class="built_in">append</span>(queue, i)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•å·²å­¦ä¹ çš„è¯¾ç¨‹æ•°é‡</span></span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// BFSæ‹“æ‰‘æ’åº</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// å‡ºé˜Ÿä¸€ä¸ªè¯¾ç¨‹</span></span><br><span class="line">        course := queue[<span class="number">0</span>]</span><br><span class="line">        queue = queue[<span class="number">1</span>:]</span><br><span class="line">        count++ <span class="comment">// å­¦ä¹ è¿™é—¨è¯¾ç¨‹</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°†å…¶æŒ‡å‘çš„è¯¾ç¨‹çš„å…¥åº¦å‡1</span></span><br><span class="line">        <span class="keyword">for</span> _, nextCourse := <span class="keyword">range</span> graph[course] &#123;</span><br><span class="line">            inDegree[nextCourse]--</span><br><span class="line">            <span class="comment">// å¦‚æœå…¥åº¦å˜ä¸º0ï¼ŒåŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">            <span class="keyword">if</span> inDegree[nextCourse] == <span class="number">0</span> &#123;</span><br><span class="line">                queue = <span class="built_in">append</span>(queue, nextCourse)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœå­¦å®Œçš„è¯¾ç¨‹æ•°ç­‰äºæ€»è¯¾ç¨‹æ•°ï¼Œåˆ™å¯ä»¥å®Œæˆæ‰€æœ‰è¯¾ç¨‹</span></span><br><span class="line">    <span class="keyword">return</span> count == numCourses</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šDFS-æ£€æµ‹ç¯-2">æ–¹æ³•äºŒï¼šDFS æ£€æµ‹ç¯</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canFinish</span><span class="params">(numCourses <span class="type">int</span>, prerequisites [][]<span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// æ„å»ºé‚»æ¥è¡¨</span></span><br><span class="line">    graph := <span class="built_in">make</span>([][]<span class="type">int</span>, numCourses)</span><br><span class="line">    <span class="keyword">for</span> _, prereq := <span class="keyword">range</span> prerequisites &#123;</span><br><span class="line">        course, prerequisite := prereq[<span class="number">0</span>], prereq[<span class="number">1</span>]</span><br><span class="line">        graph[prerequisite] = <span class="built_in">append</span>(graph[prerequisite], course)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¿é—®çŠ¶æ€æ•°ç»„ï¼š0=æœªè®¿é—®ï¼Œ1=è®¿é—®ä¸­ï¼ˆå½“å‰è·¯å¾„ä¸Šï¼‰ï¼Œ2=å·²å®Œæˆ</span></span><br><span class="line">    visited := <span class="built_in">make</span>([]<span class="type">int</span>, numCourses)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡ŒDFSï¼Œæ£€æµ‹ç¯</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numCourses; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> visited[i] == <span class="number">0</span> &#123; <span class="comment">// å¦‚æœæœªè®¿é—®</span></span><br><span class="line">            <span class="keyword">if</span> hasCycle(graph, visited, i) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// å­˜åœ¨ç¯ï¼Œæ— æ³•å®Œæˆæ‰€æœ‰è¯¾ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// ä¸å­˜åœ¨ç¯ï¼Œå¯ä»¥å®Œæˆæ‰€æœ‰è¯¾ç¨‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DFSæ£€æµ‹ç¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasCycle</span><span class="params">(graph [][]<span class="type">int</span>, visited []<span class="type">int</span>, course <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœèŠ‚ç‚¹åœ¨å½“å‰è·¯å¾„ä¸Šè¢«è®¿é—®è¿‡ï¼Œè¯´æ˜æœ‰ç¯</span></span><br><span class="line">    <span class="keyword">if</span> visited[course] == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœèŠ‚ç‚¹å·²ç»è¢«å®Œå…¨å¤„ç†ï¼Œæ— éœ€å†æ¬¡æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> visited[course] == <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ‡è®°ä¸ºè®¿é—®ä¸­</span></span><br><span class="line">    visited[course] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€’å½’æ£€æŸ¥æ‰€æœ‰ç›¸é‚»èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> _, nextCourse := <span class="keyword">range</span> graph[course] &#123;</span><br><span class="line">        <span class="keyword">if</span> hasCycle(graph, visited, nextCourse) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// å¦‚æœæ‰¾åˆ°ç¯ï¼Œç«‹å³è¿”å›</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ‡è®°ä¸ºå·²å®Œæˆ</span></span><br><span class="line">    visited[course] = <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// è¯¥è·¯å¾„ä¸Šä¸å­˜åœ¨ç¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>BFSæ‹“æ‰‘æ’åº</th>
<th>DFSæ£€æµ‹ç¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(V+E)</td>
<td>O(V+E)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(V+E)</td>
<td>O(V+E)</td>
</tr>
<tr>
<td>å®ç°éš¾åº¦</td>
<td>ä¸­ç­‰</td>
<td>ä¸­ç­‰</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç›´è§‚ç†è§£å…¥åº¦å’Œä¾èµ–å…³ç³»ï¼Œå®¹æ˜“å¾—åˆ°æ‹“æ‰‘åºåˆ—</td>
<td>é€’å½’å®ç°ç®€æ´ï¼Œå¯ä»¥æ›´å¿«æ£€æµ‹åˆ°ç¯</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦é¢å¤–ç»´æŠ¤å…¥åº¦æ•°ç»„</td>
<td>é€’å½’è°ƒç”¨å¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºï¼ˆä½†åœ¨æ­¤é¢˜çº¦æŸä¸‹ä¸ä¼šï¼‰</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>éœ€è¦æ‹“æ‰‘åºåˆ—ï¼Œæˆ–åˆå­¦è€…ç†è§£å›¾ç®—æ³•</td>
<td>åªéœ€åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¯ï¼Œæˆ–é€’å½’æ€ç»´æ›´é€‚åˆ</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p>ä¸¤ç§æ–¹æ³•çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦éƒ½æ˜¯ï¼š</p>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(V+E)ï¼Œå…¶ä¸­ V æ˜¯èŠ‚ç‚¹æ•°ï¼ˆè¯¾ç¨‹æ•°ï¼‰ï¼ŒE æ˜¯è¾¹æ•°ï¼ˆå…ˆä¿®å…³ç³»æ•°ï¼‰</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(V+E)ï¼Œç”¨äºå­˜å‚¨å›¾ç»“æ„å’Œè¾…åŠ©æ•°ç»„</li>
</ul>
<p>å…·ä½“åˆ†æï¼š</p>
<ul>
<li>BFSï¼šéœ€è¦é‚»æ¥è¡¨ O(V+E)ã€å…¥åº¦æ•°ç»„ O(V) å’Œé˜Ÿåˆ— O(V)</li>
<li>DFSï¼šéœ€è¦é‚»æ¥è¡¨ O(V+E)ã€è®¿é—®çŠ¶æ€æ•°ç»„ O(V) å’Œé€’å½’è°ƒç”¨æ ˆ O(V)</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>å›¾çš„è¡¨ç¤ºæ–¹æ³•</strong>ï¼šä½¿ç”¨é‚»æ¥è¡¨è¡¨ç¤ºå›¾ç»“æ„ï¼Œé€‚åˆç¨€ç–å›¾</li>
<li><strong>æ‹“æ‰‘æ’åºåº”ç”¨</strong>ï¼šæ‹“æ‰‘æ’åºå¯ä»¥è§£å†³ä¾èµ–å…³ç³»é—®é¢˜ï¼Œå¦‚è¯¾ç¨‹å®‰æ’ã€ä»»åŠ¡è°ƒåº¦ç­‰</li>
<li><strong>çŠ¶æ€æ ‡è®°æŠ€å·§</strong>ï¼šåœ¨DFSä¸­ä½¿ç”¨ä¸‰ç§çŠ¶æ€ï¼ˆæœªè®¿é—®ã€è®¿é—®ä¸­ã€å·²å®Œæˆï¼‰å¯ä»¥æœ‰æ•ˆæ£€æµ‹ç¯</li>
<li><strong>é˜Ÿåˆ—çš„åº”ç”¨</strong>ï¼šåœ¨BFSä¸­ä½¿ç”¨é˜Ÿåˆ—ç®¡ç†å…¥åº¦ä¸º0çš„èŠ‚ç‚¹</li>
</ol>
<p><strong>å¸¸è§é™·é˜±</strong>ï¼š</p>
<ul>
<li>æ··æ·†äº†æœ‰å‘è¾¹çš„æ–¹å‘ï¼šæ³¨æ„ <code>[ai, bi]</code> è¡¨ç¤º <code>bi â†’ ai</code>ï¼Œå³å­¦ä¹  <code>ai</code> å‰å¿…é¡»å®Œæˆ <code>bi</code></li>
<li>å¿˜è®°æ£€æŸ¥æœ€ç»ˆè®¿é—®çš„èŠ‚ç‚¹æ•°ï¼šåœ¨BFSä¸­ï¼Œå³ä½¿é˜Ÿåˆ—ä¸ºç©ºï¼Œä¹Ÿè¦æ£€æŸ¥æ˜¯å¦è®¿é—®äº†æ‰€æœ‰èŠ‚ç‚¹</li>
<li>DFSæ£€æµ‹ç¯æ—¶å¿˜è®°æ ‡è®°èŠ‚ç‚¹çŠ¶æ€ï¼šå¿…é¡»æ­£ç¡®æ ‡è®°èŠ‚ç‚¹ä¸º&quot;è®¿é—®ä¸­&quot;å’Œ&quot;å·²å®Œæˆ&quot;</li>
</ul>
<p><strong>ç›¸å…³é—®é¢˜</strong>ï¼š</p>
<ul>
<li>LeetCode 210ï¼šè¯¾ç¨‹è¡¨ IIï¼ˆCourse Schedule IIï¼‰- åœ¨æœ¬é¢˜åŸºç¡€ä¸Šè¾“å‡ºæ‹“æ‰‘æ’åºåºåˆ—</li>
<li>LeetCode 802ï¼šæ‰¾åˆ°æœ€ç»ˆçš„å®‰å…¨çŠ¶æ€ï¼ˆFind Eventual Safe Statesï¼‰- æ‰¾å‡ºä¸åœ¨ä»»ä½•ç¯ä¸­çš„èŠ‚ç‚¹</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>å›¾è®º</category>
      </categories>
      <tags>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>å¹¿åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>å›¾</tag>
        <tag>æ‹“æ‰‘æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 124 - äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œï¼ˆBinary Tree Maximum Path Sumï¼‰</title>
    <url>/2025/05/02/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-124-Binary-Tree-Maximum-Path-Sum/</url>
    <content><![CDATA[<div class="note danger flat"><p><strong>é‡ç‚¹éš¾é¢˜</strong>ï¼šæœ¬é¢˜æ˜¯äºŒå‰æ ‘è·¯å¾„é—®é¢˜ä¸­çš„ç»å…¸éš¾é¢˜ï¼Œéœ€è¦ç†è§£ååºéå†ä¸é€’å½’è¿”trueå›å€¼çš„å·§å¦™è®¾è®¡ã€‚</p>
</div>
<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ª<strong>éç©º</strong>äºŒå‰æ ‘ï¼Œè¿”å›å…¶æœ€å¤§è·¯å¾„å’Œã€‚</p>
<p>æœ¬é¢˜ä¸­ï¼Œè·¯å¾„è¢«å®šä¹‰ä¸ºä¸€æ¡ä»æ ‘ä¸­ä»»æ„èŠ‚ç‚¹å‡ºå‘ï¼Œæ²¿çˆ¶èŠ‚ç‚¹-å­èŠ‚ç‚¹è¿æ¥ï¼Œè¾¾åˆ°ä»»æ„èŠ‚ç‚¹çš„åºåˆ—ã€‚è¯¥è·¯å¾„<strong>è‡³å°‘åŒ…å«ä¸€ä¸ª</strong>èŠ‚ç‚¹ï¼Œä¸”ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[1,2,3]</span><br><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line">è¾“å‡ºï¼š6</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[-10,9,20,null,null,15,7]</span><br><span class="line">   -10</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line">è¾“å‡ºï¼š42</span><br></pre></td></tr></table></figure>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„å…³é”®åœ¨äºç†è§£äºŒå‰æ ‘ä¸­çš„&quot;è·¯å¾„&quot;æ¦‚å¿µã€‚è·¯å¾„å¯ä»¥æ˜¯ï¼š</p>
<ol>
<li>åªåŒ…å«ä¸€ä¸ªèŠ‚ç‚¹</li>
<li>ä»ä¸€ä¸ªèŠ‚ç‚¹å‘ä¸‹åˆ°å…¶å­èŠ‚ç‚¹</li>
<li>ä»å·¦å­æ ‘æŸèŠ‚ç‚¹ï¼Œç»è¿‡çˆ¶èŠ‚ç‚¹ï¼Œå†åˆ°å³å­æ ‘æŸèŠ‚ç‚¹ï¼ˆå½¢æˆ&quot;å€’V&quot;å½¢çŠ¶ï¼‰</li>
</ol>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨ååºéå†ï¼ˆå·¦-å³-æ ¹ï¼‰è‡ªåº•å‘ä¸Šè®¡ç®—è·¯å¾„å’Œï¼Œé’ˆå¯¹æ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸¤ä¸ªå…³é”®å€¼ï¼š</p>
<ul>
<li><strong>å½“å‰èŠ‚ç‚¹çš„è´¡çŒ®å€¼</strong>ï¼šèŠ‚ç‚¹è‡ªèº«å€¼åŠ ä¸Šå·¦å³å­æ ‘ä¸­è¾ƒå¤§çš„è´¡çŒ®å€¼ï¼ˆå¦‚æœå­æ ‘è´¡çŒ®ä¸ºè´Ÿï¼Œåˆ™ä¸é€‰å–ï¼‰</li>
<li><strong>ç»è¿‡å½“å‰èŠ‚ç‚¹çš„æœ€å¤§è·¯å¾„å’Œ</strong>ï¼šèŠ‚ç‚¹å€¼åŠ ä¸Šå·¦å³å­æ ‘çš„è´¡çŒ®å€¼ï¼ˆå¦‚ä¸ºè´Ÿåˆ™è§†ä¸º0ï¼‰</li>
</ul>
<p>å…³é”®åœ¨äºåŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>è´¡çŒ®å€¼ç”¨äºå‘ä¸Šä¼ é€’ç»™çˆ¶èŠ‚ç‚¹ï¼Œåªèƒ½é€‰æ‹©ä¸€æ¡è·¯å¾„ï¼ˆå·¦æˆ–å³ï¼‰</li>
<li>æœ€å¤§è·¯å¾„å’Œç”¨äºæ›´æ–°å…¨å±€æœ€å¤§å€¼ï¼Œå¯ä»¥åŒæ—¶åŒ…å«å·¦å³è·¯å¾„</li>
</ul>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<ol>
<li>å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ <code>maxSum</code> æ¥è®°å½•æœ€å¤§è·¯å¾„å’Œï¼Œåˆå§‹å€¼è®¾ä¸ºæœ€å°æ•´æ•°</li>
<li>å®šä¹‰é€’å½’å‡½æ•° <code>maxGain</code>ï¼Œè®¡ç®—èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼</li>
<li>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œè®¡ç®—å…¶å·¦å³å­æ ‘çš„æœ€å¤§è´¡çŒ®å€¼</li>
<li>å¦‚æœè´¡çŒ®å€¼ä¸ºè´Ÿï¼Œå°†å…¶è®¾ä¸º0ï¼ˆä¸é€‰æ‹©è¿™æ¡è·¯å¾„ï¼‰</li>
<li>è®¡ç®—ç»è¿‡å½“å‰èŠ‚ç‚¹çš„è·¯å¾„å’Œï¼Œå¹¶æ›´æ–°å…¨å±€æœ€å¤§å€¼</li>
<li>è¿”å›å½“å‰èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼ï¼ˆåªèƒ½é€‰å·¦æˆ–å³å­æ ‘ä¸­çš„ä¸€æ¡ï¼‰</li>
</ol>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxPathSum</span><span class="params">(root *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æœ€å¤§å’Œä¸ºæœ€å°æ•´æ•°</span></span><br><span class="line">    maxSum := math.MinInt32</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å®šä¹‰é€’å½’å‡½æ•°è®¡ç®—èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼</span></span><br><span class="line">    <span class="keyword">var</span> maxGain <span class="function"><span class="keyword">func</span><span class="params">(node *TreeNode)</span></span> <span class="type">int</span></span><br><span class="line">  </span><br><span class="line">    maxGain = <span class="function"><span class="keyword">func</span><span class="params">(node *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// é€’å½’è®¡ç®—å·¦å³å­æ ‘çš„æœ€å¤§è´¡çŒ®å€¼</span></span><br><span class="line">        leftVal := maxGain(node.Left)</span><br><span class="line">        rightVal := maxGain(node.Right)</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¦‚æœå­æ ‘è´¡çŒ®ä¸ºè´Ÿï¼Œåˆ™ä¸é€‰å–</span></span><br><span class="line">        <span class="keyword">if</span> leftVal &lt; <span class="number">0</span> &#123;</span><br><span class="line">            leftVal = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span> rightVal &lt; <span class="number">0</span> &#123;</span><br><span class="line">            rightVal = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// è®¡ç®—ç»è¿‡å½“å‰èŠ‚ç‚¹çš„è·¯å¾„å’Œï¼Œå¹¶æ›´æ–°å…¨å±€æœ€å¤§å€¼</span></span><br><span class="line">        priceVal := leftVal + rightVal + node.Val</span><br><span class="line">        <span class="keyword">if</span> priceVal &gt; maxSum &#123;</span><br><span class="line">            maxSum = priceVal</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// è¿”å›èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼ï¼ˆåªèƒ½é€‰å·¦æˆ–å³å­æ ‘ä¸­çš„ä¸€æ¡ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> max(leftVal, rightVal) + node.Val</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    maxGain(root)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> maxSum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(N)ï¼Œå…¶ä¸­ N æ˜¯äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ã€‚æ¯ä¸ªèŠ‚ç‚¹åªè¢«è®¿é—®ä¸€æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(H)ï¼Œå…¶ä¸­ H æ˜¯äºŒå‰æ ‘çš„é«˜åº¦ã€‚ç©ºé—´å¤æ‚åº¦ä¸»è¦å–å†³äºé€’å½’è°ƒç”¨çš„æ ˆç©ºé—´ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>è·¯å¾„å®šä¹‰çš„ç†è§£</strong>ï¼šäºŒå‰æ ‘ä¸­çš„è·¯å¾„ä¸ä¸€å®šè¦ä»æ ¹å¼€å§‹æˆ–ç»“æŸï¼Œä½†å¿…é¡»æ˜¯è¿ç»­çš„ã€‚</li>
<li><strong>ååºéå†åº”ç”¨</strong>ï¼šé€šè¿‡ååºéå†å¯ä»¥è‡ªåº•å‘ä¸Šæ”¶é›†è·¯å¾„ä¿¡æ¯ã€‚</li>
<li><strong>é€’å½’è®¾è®¡å·§å¦™æ€§</strong>ï¼šé€’å½’å‡½æ•°çš„è¿”å›å€¼ï¼ˆèŠ‚ç‚¹è´¡çŒ®å€¼ï¼‰ä¸å‡½æ•°å†…æ›´æ–°çš„å…¨å±€å˜é‡ï¼ˆæœ€å¤§è·¯å¾„å’Œï¼‰åˆ†åˆ«æœåŠ¡äºä¸åŒç›®çš„ã€‚</li>
<li><strong>è·¯å¾„é€‰æ‹©ç­–ç•¥</strong>ï¼šå¯¹äºè´Ÿè´¡çŒ®å€¼çš„å­æ ‘ï¼Œé€‰æ‹©ä¸çº³å…¥è·¯å¾„å¯ä»¥è·å¾—æ›´å¤§çš„è·¯å¾„å’Œã€‚</li>
</ol>
<p>ç›¸å…³é—®é¢˜ï¼š</p>
<ul>
<li>LeetCode 543: äºŒå‰æ ‘çš„ç›´å¾„</li>
<li>LeetCode 687: æœ€é•¿åŒå€¼è·¯å¾„</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>é€’å½’</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Hard</tag>
        <tag>âŒé”™é¢˜é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 236 - äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
    <url>/2025/04/30/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-236-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p>
<p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3 ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line">è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5 ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [1,2], p = 1, q = 2</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [2, 10^5] å†…ã€‚</li>
<li>-10^9 &lt;= Node.val &lt;= 10^9</li>
<li>æ‰€æœ‰ Node.val äº’ä¸ç›¸åŒã€‚</li>
<li>p != q</li>
<li>p å’Œ q å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†é€šè¿‡é€’å½’æ–¹æ³•å¯ä»¥ä¼˜é›…åœ°è§£å†³ã€‚<strong>å…³é”®æ´è§</strong>æ˜¯ï¼šå¦‚æœæˆ‘ä»¬ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹äºä»»æ„èŠ‚ç‚¹ï¼š</p>
<ol>
<li>å¦‚æœå½“å‰èŠ‚ç‚¹å°±æ˜¯ p æˆ– qï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯å®ƒä»¬çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆå¯èƒ½ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„åä»£ï¼‰</li>
<li>å¦‚æœå½“å‰èŠ‚ç‚¹ä¸æ˜¯ p æˆ– qï¼Œæˆ‘ä»¬éœ€è¦åœ¨å·¦å³å­æ ‘ä¸­å¯»æ‰¾ p å’Œ qï¼š
<ul>
<li>å¦‚æœ p å’Œ q åˆ†åˆ«åœ¨å½“å‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘ä¸­ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ</li>
<li>å¦‚æœ p å’Œ q éƒ½åœ¨å·¦å­æ ‘ï¼Œé‚£ä¹ˆæœ€è¿‘å…¬å…±ç¥–å…ˆåœ¨å·¦å­æ ‘ä¸­</li>
<li>å¦‚æœ p å’Œ q éƒ½åœ¨å³å­æ ‘ï¼Œé‚£ä¹ˆæœ€è¿‘å…¬å…±ç¥–å…ˆåœ¨å³å­æ ‘ä¸­</li>
</ul>
</li>
</ol>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡å‡ ç§æ–¹æ³•è§£å†³ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šé€’å½’-ååºéå†">æ–¹æ³•ä¸€ï¼šé€’å½’ - ååºéå†</h3>
<p>é€’å½’æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜æœ€ç›´è§‚çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ååºéå†ï¼ˆå·¦ã€å³ã€æ ¹ï¼‰çš„æ–¹å¼ï¼Œè‡ªåº•å‘ä¸Šåœ°å¯»æ‰¾æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p>
<h4 id="å®ç°æ€è·¯ï¼š">å®ç°æ€è·¯ï¼š</h4>
<ol>
<li>
<p><strong>åŸºæœ¬æƒ…å†µ</strong>ï¼š</p>
<ul>
<li>å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ºç©ºï¼Œè¿”å› nil</li>
<li>å¦‚æœå½“å‰èŠ‚ç‚¹ç­‰äº p æˆ– qï¼Œè¿”å›å½“å‰èŠ‚ç‚¹</li>
</ul>
</li>
<li>
<p><strong>é€’å½’è°ƒç”¨</strong>ï¼š</p>
<ul>
<li>åœ¨å·¦å­æ ‘ä¸­é€’å½’å¯»æ‰¾ p å’Œ q</li>
<li>åœ¨å³å­æ ‘ä¸­é€’å½’å¯»æ‰¾ p å’Œ q</li>
</ul>
</li>
<li>
<p><strong>åˆå¹¶ç»“æœ</strong>ï¼š</p>
<ul>
<li>å¦‚æœå·¦å­æ ‘å’Œå³å­æ ‘çš„é€’å½’è°ƒç”¨éƒ½è¿”å›éç©ºç»“æœï¼Œè¯´æ˜ p å’Œ q åˆ†åˆ«åœ¨å½“å‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘ä¸­ï¼Œå½“å‰èŠ‚ç‚¹å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ</li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªå­æ ‘è¿”å›éç©ºç»“æœï¼Œåˆ™è¯¥ç»“æœå°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ</li>
<li>å¦‚æœä¸¤ä¸ªå­æ ‘éƒ½è¿”å›ç©ºï¼Œåˆ™è¿”å›ç©º</li>
</ul>
</li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨çˆ¶èŠ‚ç‚¹æ˜ å°„">æ–¹æ³•äºŒï¼šä½¿ç”¨çˆ¶èŠ‚ç‚¹æ˜ å°„</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å»ºç«‹æ¯ä¸ªèŠ‚ç‚¹åˆ°å…¶çˆ¶èŠ‚ç‚¹çš„æ˜ å°„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹DFSï¼Œåˆ›å»ºæ¯ä¸ªèŠ‚ç‚¹åˆ°å…¶çˆ¶èŠ‚ç‚¹çš„æ˜ å°„</li>
<li>ä» p å¼€å§‹ï¼Œå‘ä¸Šéå†è‡³æ ¹ï¼Œè®°å½•ç»è¿‡çš„æ‰€æœ‰èŠ‚ç‚¹</li>
<li>ä» q å¼€å§‹ï¼Œå‘ä¸Šéå†è‡³æ ¹ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªåœ¨ p çš„è·¯å¾„ä¸­å‡ºç°çš„èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å³ä¸ºæœ€è¿‘å…¬å…±ç¥–å…ˆ</li>
</ol>
<h3 id="æ–¹æ³•ä¸‰ï¼šè·¯å¾„æ¯”è¾ƒæ³•">æ–¹æ³•ä¸‰ï¼šè·¯å¾„æ¯”è¾ƒæ³•</h3>
<ol>
<li>æ‰¾å‡ºä»æ ¹èŠ‚ç‚¹åˆ° p çš„è·¯å¾„</li>
<li>æ‰¾å‡ºä»æ ¹èŠ‚ç‚¹åˆ° q çš„è·¯å¾„</li>
<li>æ¯”è¾ƒè¿™ä¸¤æ¡è·¯å¾„ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªç›¸åŒçš„èŠ‚ç‚¹ï¼Œå³ä¸ºæœ€è¿‘å…¬å…±ç¥–å…ˆ</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šé€’å½’å®ç°">æ–¹æ³•ä¸€ï¼šé€’å½’å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lowestCommonAncestor</span><span class="params">(root, p, q *TreeNode)</span></span> *TreeNode &#123;</span><br><span class="line">    <span class="comment">// åŸºæœ¬æƒ…å†µï¼šç©ºèŠ‚ç‚¹è¿”å›nil</span></span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯pæˆ–qï¼Œç›´æ¥è¿”å›å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> root.Val == p.Val || root.Val == q.Val &#123;</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨å·¦å³å­æ ‘ä¸­å¯»æ‰¾på’Œq</span></span><br><span class="line">    left := lowestCommonAncestor(root.Left, p, q)</span><br><span class="line">    right := lowestCommonAncestor(root.Right, p, q)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœpå’Œqåˆ†åˆ«åœ¨å·¦å³å­æ ‘ä¸­ï¼Œå½“å‰èŠ‚ç‚¹å°±æ˜¯LCA</span></span><br><span class="line">    <span class="keyword">if</span> left != <span class="literal">nil</span> &amp;&amp; right != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœå·¦å­æ ‘ä¸­æ²¡æœ‰æ‰¾åˆ°pæˆ–qï¼Œåˆ™LCAåœ¨å³å­æ ‘ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> left == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> right</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦åˆ™LCAåœ¨å·¦å­æ ‘ä¸­ï¼ˆæˆ–ä¸¤è€…éƒ½ä¸ºç©ºï¼Œæ­¤æ—¶è¿”å›nilï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> left</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šçˆ¶èŠ‚ç‚¹æ˜ å°„å®ç°">æ–¹æ³•äºŒï¼šçˆ¶èŠ‚ç‚¹æ˜ å°„å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lowestCommonAncestor</span><span class="params">(root, p, q *TreeNode)</span></span> *TreeNode &#123;</span><br><span class="line">    <span class="comment">// å»ºç«‹çˆ¶èŠ‚ç‚¹æ˜ å°„</span></span><br><span class="line">    parentMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]*TreeNode)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// DFSéå†æ ‘ï¼Œå»ºç«‹å­èŠ‚ç‚¹åˆ°çˆ¶èŠ‚ç‚¹çš„æ˜ å°„</span></span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(*TreeNode)</span></span></span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(node *TreeNode)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> node.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">            parentMap[node.Left.Val] = node</span><br><span class="line">            dfs(node.Left)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> node.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">            parentMap[node.Right.Val] = node</span><br><span class="line">            dfs(node.Right)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dfs(root)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ”¶é›†ä»påˆ°æ ¹çš„è·¯å¾„ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">    visited := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">bool</span>)</span><br><span class="line">    <span class="keyword">for</span> node := p; node != <span class="literal">nil</span>; node = parentMap[node.Val] &#123;</span><br><span class="line">        visited[node.Val] = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»qå‘ä¸Šéå†ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå·²è®¿é—®è¿‡çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> node := q; node != <span class="literal">nil</span>; node = parentMap[node.Val] &#123;</span><br><span class="line">        <span class="keyword">if</span> visited[node.Val] &#123;</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span> <span class="comment">// è¿™é‡Œå®é™…ä¸Šä¸ä¼šè¢«æ‰§è¡Œåˆ°ï¼Œå› ä¸ºé¢˜ç›®ä¿è¯på’Œqåœ¨æ ‘ä¸­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šè·¯å¾„æ¯”è¾ƒæ³•-2">æ–¹æ³•ä¸‰ï¼šè·¯å¾„æ¯”è¾ƒæ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lowestCommonAncestor</span><span class="params">(root, p, q *TreeNode)</span></span> *TreeNode &#123;</span><br><span class="line">    <span class="comment">// æ‰¾å‡ºä»æ ¹åˆ°æŒ‡å®šèŠ‚ç‚¹çš„è·¯å¾„</span></span><br><span class="line">    <span class="keyword">var</span> findPath <span class="function"><span class="keyword">func</span><span class="params">(*TreeNode, *TreeNode, []*TreeNode)</span></span> []*TreeNode</span><br><span class="line">    findPath = <span class="function"><span class="keyword">func</span><span class="params">(root, target *TreeNode, path []*TreeNode)</span></span> []*TreeNode &#123;</span><br><span class="line">        <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°†å½“å‰èŠ‚ç‚¹åŠ å…¥è·¯å¾„</span></span><br><span class="line">        path = <span class="built_in">append</span>(path, root)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœæ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¿”å›è·¯å¾„</span></span><br><span class="line">        <span class="keyword">if</span> root.Val == target.Val &#123;</span><br><span class="line">            <span class="keyword">return</span> path</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åœ¨å·¦å­æ ‘ä¸­å¯»æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> left := findPath(root.Left, target, <span class="built_in">append</span>([]*TreeNode&#123;&#125;, path...)); left != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> left</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åœ¨å³å­æ ‘ä¸­å¯»æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> right := findPath(root.Right, target, <span class="built_in">append</span>([]*TreeNode&#123;&#125;, path...)); right != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> right</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–ä»æ ¹åˆ°på’Œqçš„è·¯å¾„</span></span><br><span class="line">    pathP := findPath(root, p, []*TreeNode&#123;&#125;)</span><br><span class="line">    pathQ := findPath(root, q, []*TreeNode&#123;&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¾åˆ°æœ€åä¸€ä¸ªå…¬å…±èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">var</span> lca *TreeNode</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(pathP) &amp;&amp; i &lt; <span class="built_in">len</span>(pathQ); i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> pathP[i].Val == pathQ[i].Val &#123;</span><br><span class="line">            lca = pathP[i]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> lca</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ–¹æ³•ä¸€ï¼šé€’å½’</th>
<th>æ–¹æ³•äºŒï¼šçˆ¶èŠ‚ç‚¹æ˜ å°„</th>
<th>æ–¹æ³•ä¸‰ï¼šè·¯å¾„æ¯”è¾ƒæ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(h)ï¼Œhä¸ºæ ‘é«˜</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ä»£ç ç®€æ´ï¼Œç©ºé—´æ•ˆç‡é«˜</td>
<td>æ€è·¯ç›´è§‚</td>
<td>å®¹æ˜“ç†è§£</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>é€’å½’å¯èƒ½å¯¼è‡´æ ˆæº¢å‡º</td>
<td>éœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨çˆ¶èŠ‚ç‚¹æ˜ å°„</td>
<td>éœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨è·¯å¾„</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šé€’å½’">æ–¹æ³•ä¸€ï¼šé€’å½’</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n)ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è®¿é—®æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(h)ï¼Œå…¶ä¸­ h æ˜¯æ ‘çš„é«˜åº¦ã€‚é€’å½’è°ƒç”¨çš„æ ˆæ·±åº¦ä¸æ ‘çš„é«˜åº¦æˆæ­£æ¯”ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆæ ‘æ˜¯ä¸€æ¡é“¾ï¼‰ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(n)ã€‚</li>
</ul>
<h3 id="æ–¹æ³•äºŒï¼šçˆ¶èŠ‚ç‚¹æ˜ å°„">æ–¹æ³•äºŒï¼šçˆ¶èŠ‚ç‚¹æ˜ å°„</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n)ï¼Œæˆ‘ä»¬éœ€è¦éå†æ•´æ£µæ ‘æ¥æ„å»ºçˆ¶èŠ‚ç‚¹æ˜ å°„ï¼Œç„¶ååœ¨æœ€åæƒ…å†µä¸‹éœ€è¦éå†ä» p å’Œ q åˆ°æ ¹çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(n)ï¼Œéœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨çˆ¶èŠ‚ç‚¹æ˜ å°„å’Œè®¿é—®é›†åˆã€‚</li>
</ul>
<h3 id="æ–¹æ³•ä¸‰ï¼šè·¯å¾„æ¯”è¾ƒæ³•-3">æ–¹æ³•ä¸‰ï¼šè·¯å¾„æ¯”è¾ƒæ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n)ï¼Œéœ€è¦éå†æ ‘æ¥æ‰¾åˆ°ä»æ ¹åˆ° p å’Œ q çš„è·¯å¾„ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(n)ï¼Œéœ€è¦å­˜å‚¨ä»æ ¹åˆ° p å’Œ q çš„è·¯å¾„ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>é€’å½’æ€æƒ³åœ¨æ ‘é—®é¢˜ä¸­çš„åº”ç”¨</strong>ï¼šæ ‘çš„é—®é¢˜é€šå¸¸å¯ä»¥é€šè¿‡é€’å½’ä¼˜é›…åœ°è§£å†³ï¼Œå°¤å…¶æ˜¯è‡ªåº•å‘ä¸Šçš„ååºéå†ã€‚</p>
</li>
<li>
<p><strong>æœ€è¿‘å…¬å…±ç¥–å…ˆçš„ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹åœ¨ä¸åŒçš„å­æ ‘ä¸­ï¼Œå®ƒä»¬çš„LCAå°±æ˜¯å­æ ‘çš„æ ¹èŠ‚ç‚¹</li>
<li>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸€ä¸ªèŠ‚ç‚¹çš„ç¥–å…ˆï¼Œé‚£ä¹ˆè¿™ä¸ªç¥–å…ˆèŠ‚ç‚¹å°±æ˜¯LCA</li>
</ul>
</li>
<li>
<p><strong>è·¯å¾„è¡¨ç¤ºæ³•</strong>ï¼šä»æ ¹åˆ°èŠ‚ç‚¹çš„è·¯å¾„å¯ä»¥å”¯ä¸€ç¡®å®šä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯”è¾ƒä¸¤æ¡è·¯å¾„å¯ä»¥æ‰¾åˆ°åˆ†å‰ç‚¹</p>
</li>
<li>
<p><strong>ç©ºè¿”å›å€¼çš„å¤„ç†</strong>ï¼šåœ¨é€’å½’ä¸­å¤„ç†ç©ºè¿”å›å€¼æ˜¯å¾ˆé‡è¦çš„ï¼Œç¡®ä¿ä»£ç çš„å¥å£®æ€§</p>
</li>
</ol>
<p>è¿™é“é¢˜æ˜¯æ ‘çš„ç»å…¸é—®é¢˜ï¼Œå®ƒä¸ä»…è€ƒå¯Ÿäº†æ ‘çš„éå†æŠ€å·§ï¼Œè¿˜è€ƒå¯Ÿäº†å¯¹é€’å½’çš„ç†è§£å’Œåº”ç”¨ã€‚æ–¹æ³•ä¸€ï¼ˆé€’å½’ï¼‰æ˜¯æœ€ç®€æ´å’Œé«˜æ•ˆçš„è§£æ³•ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­æ¨èä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>é€’å½’</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 437 - è·¯å¾„æ€»å’Œ III (Path Sum III)</title>
    <url>/2025/04/30/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-437-%E8%B7%AF%E5%BE%84%E6%80%BB%E5%92%8C-III/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> å’Œä¸€ä¸ªæ•´æ•° <code>targetSum</code>ï¼Œæ±‚è¯¥äºŒå‰æ ‘é‡ŒèŠ‚ç‚¹å€¼ä¹‹å’Œç­‰äº <code>targetSum</code> çš„<strong>è·¯å¾„</strong>çš„æ•°ç›®ã€‚</p>
<p><strong>è·¯å¾„å®šä¹‰</strong>ï¼šä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯å‘ä¸‹çš„ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹ 1</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      10</span><br><span class="line">     /  \</span><br><span class="line">    5   -3</span><br><span class="line">   / \    \</span><br><span class="line">  3   2   11</span><br><span class="line"> / \   \</span><br><span class="line">3  -2   1</span><br></pre></td></tr></table></figure>
<p><strong>è¾“å…¥</strong>ï¼šroot = [10,5,-3,3,2,null,11,3,-2,null,1], targetSum = 8<br>
<strong>è¾“å‡º</strong>ï¼š3<br>
<strong>è§£é‡Š</strong>ï¼šå’Œä¸º 8 çš„è·¯å¾„æœ‰ 3 æ¡</p>
<ol>
<li>5 -&gt; 3</li>
<li>5 -&gt; 2 -&gt; 1</li>
<li>-3 -&gt; 11</li>
</ol>
<p><strong>ç¤ºä¾‹ 2</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      5</span><br><span class="line">     / \</span><br><span class="line">    4   8</span><br><span class="line">   /   / \</span><br><span class="line">  11  13  4</span><br><span class="line"> /  \    / \</span><br><span class="line">7    2  5   1</span><br></pre></td></tr></table></figure>
<p><strong>è¾“å…¥</strong>ï¼šroot = [5,4,8,11,null,13,4,7,2,null,null,5,1], targetSum = 22<br>
<strong>è¾“å‡º</strong>ï¼š3</p>
<p><strong>æç¤º</strong>ï¼š</p>
<ul>
<li>äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°çš„èŒƒå›´æ˜¯ [0,1000]</li>
<li>-10^9 &lt;= Node.val &lt;= 10^9</li>
<li>-1000 &lt;= targetSum &lt;= 1000</li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘çš„åˆå§‹è§£æ³•æ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pathSum</span><span class="params">(root *TreeNode, targetSum <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    cnt := <span class="number">0</span></span><br><span class="line">    dfsPathSum(root, targetSum, targetSum, &amp;cnt)</span><br><span class="line">    <span class="keyword">return</span> cnt</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsPathSum</span><span class="params">(node *TreeNode, targetSum, totalSum <span class="type">int</span>, cnt *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šåªæ£€æŸ¥å•ä¸ªèŠ‚ç‚¹å€¼ç­‰äºç›®æ ‡å’Œçš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> node.Val == targetSum &#123;</span><br><span class="line">        *cnt++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šæ··åˆäº†ä¸¤ç§ä¸åŒçš„é€’å½’é€»è¾‘ï¼ŒèŒè´£ä¸æ¸…æ™°</span></span><br><span class="line">    dfsPathSum(node.Left, totalSum, totalSum, cnt)      <span class="comment">// å·¦å­èŠ‚ç‚¹ä½œä¸ºæ–°èµ·ç‚¹</span></span><br><span class="line">    dfsPathSum(node.Left, targetSum-node.Val, totalSum, cnt)  <span class="comment">// å·¦å­èŠ‚ç‚¹ä½œä¸ºè·¯å¾„å»¶ç»­</span></span><br><span class="line">    dfsPathSum(node.Right, totalSum, totalSum, cnt)     <span class="comment">// å³å­èŠ‚ç‚¹ä½œä¸ºæ–°èµ·ç‚¹ </span></span><br><span class="line">    dfsPathSum(node.Right, targetSum-node.Val, totalSum, cnt) <span class="comment">// å³å­èŠ‚ç‚¹ä½œä¸ºè·¯å¾„å»¶ç»­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>é€šè¿‡ç¤ºä¾‹ 1 çš„æ ‘ç»“æ„æ¥è¯¦ç»†åˆ†æé”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      10</span><br><span class="line">     /  \</span><br><span class="line">    5   -3</span><br><span class="line">   / \    \</span><br><span class="line">  3   2   11</span><br><span class="line"> / \   \</span><br><span class="line">3  -2   1</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬æŸ¥æ‰¾ç›®æ ‡å’Œä¸º 8 çš„è·¯å¾„æ—¶ï¼Œé¢„æœŸç»“æœæ˜¯ 3 æ¡è·¯å¾„ã€‚ä½†æˆ‘çš„å®ç°å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<h4 id="1-é€’å½’èŒè´£æ··æ·†å¯¼è‡´çš„é‡å¤è®¡ç®—">1. é€’å½’èŒè´£æ··æ·†å¯¼è‡´çš„é‡å¤è®¡ç®—</h4>
<p>ä»æ ¹èŠ‚ç‚¹ 10 å¼€å§‹æ‰§è¡Œ <code>dfsPathSum(root, 8, 8, &amp;cnt)</code>ï¼š</p>
<ul>
<li>æ£€æŸ¥ 10 æ˜¯å¦ç­‰äº 8ï¼šä¸ç­‰äºï¼Œä¸å¢åŠ è®¡æ•°</li>
<li>å¯¹å·¦å­èŠ‚ç‚¹ 5 ç”Ÿæˆ <strong>ä¸¤ä¸ªé€’å½’è°ƒç”¨</strong>ï¼š
<ul>
<li><code>dfsPathSum(5, 8, 8, &amp;cnt)</code> â€”â€” è§† 5 ä¸ºæ–°è·¯å¾„èµ·ç‚¹</li>
<li><code>dfsPathSum(5, 8-10=-2, 8, &amp;cnt)</code> â€”â€” è§† 5 ä¸ºå»¶ç»­ 10 çš„è·¯å¾„</li>
</ul>
</li>
</ul>
<p>è¿™é‡Œé—®é¢˜å°±å‡ºç°äº†ï¼šå½“æˆ‘ä»¬è®¿é—®èŠ‚ç‚¹ 5ï¼Œä¼šåŒæ—¶ä»¥å®ƒä½œä¸º<strong>æ–°èµ·ç‚¹</strong>å’Œ<strong>è·¯å¾„å»¶ç»­ç‚¹</strong>ï¼Œäº§ç”Ÿä¸¤æ¡ä¸åŒå¤„ç†è·¯å¾„ã€‚ä½†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ²¡æœ‰åŒºåˆ†è¿™ä¸¤ç§ä¸åŒçš„èŒè´£ã€‚</p>
<p>ç»§ç»­è¿½è¸ª <code>dfsPathSum(5, 8, 8, &amp;cnt)</code> çš„æ‰§è¡Œï¼š</p>
<ul>
<li>æ£€æŸ¥ 5 æ˜¯å¦ç­‰äº 8ï¼šä¸ç­‰äºï¼Œä¸å¢åŠ è®¡æ•°</li>
<li>åˆç”Ÿæˆ 4 ä¸ªé€’å½’è°ƒç”¨ï¼š
<ol>
<li><code>dfsPathSum(3, 8, 8, &amp;cnt)</code> â€”â€” 3 ä½œä¸ºæ–°èµ·ç‚¹</li>
<li><code>dfsPathSum(3, 8-5=3, 8, &amp;cnt)</code> â€”â€” 3 ä½œä¸º 5 çš„å»¶ç»­</li>
<li><code>dfsPathSum(2, 8, 8, &amp;cnt)</code> â€”â€” 2 ä½œä¸ºæ–°èµ·ç‚¹</li>
<li><code>dfsPathSum(2, 8-5=3, 8, &amp;cnt)</code> â€”â€” 2 ä½œä¸º 5 çš„å»¶ç»­</li>
</ol>
</li>
</ul>
<p>å¯¹äº <code>dfsPathSum(3, 3, 8, &amp;cnt)</code>ï¼š</p>
<ul>
<li>æ£€æŸ¥ 3 æ˜¯å¦ç­‰äº 3ï¼š<strong>ç›¸ç­‰ï¼Œè®¡æ•°åŠ 1</strong>ï¼ˆæ­£ç¡®æ‰¾åˆ° 5-&gt;3 è·¯å¾„ï¼‰</li>
<li>ä½†åŒæ—¶ä¹Ÿä¼šé€’å½’è°ƒç”¨ <code>dfsPathSum(3, 3-3=0, 8, &amp;cnt)</code> å’Œ <code>dfsPathSum(-2, 0-3=-3, 8, &amp;cnt)</code></li>
</ul>
<p>è¿™ç§ä¸åˆ†èŒè´£çš„é€’å½’ä¼šå¯¼è‡´ï¼š</p>
<ol>
<li><strong>æŒ‡æ•°çº§çˆ†ç‚¸çš„é€’å½’è°ƒç”¨</strong>â€”â€”æ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆ 4 ä¸ªæ–°çš„é€’å½’</li>
<li><strong>é‡å¤è®¡ç®—</strong>â€”â€”åŒä¸€è·¯å¾„ä¼šåœ¨ä¸åŒé€’å½’åˆ†æ”¯ä¸­é‡å¤ç»Ÿè®¡</li>
</ol>
<h4 id="2-è·¯å¾„åˆ¤æ–­é€»è¾‘ä¸å®Œæ•´">2. è·¯å¾„åˆ¤æ–­é€»è¾‘ä¸å®Œæ•´</h4>
<p>è€ƒè™‘ <code>dfsPathSum(3, 3, 8, &amp;cnt)</code> è¿™ç§æƒ…å†µï¼š</p>
<ul>
<li>ä»£ç åˆ¤æ–­ <code>node.Val == targetSum</code>ï¼Œæ­¤å¤„ 3 == 3ï¼Œæ‰€ä»¥ cnt++</li>
<li>ä½†è¿™åªè€ƒè™‘äº†èŠ‚ç‚¹å€¼ç­‰äºç›®æ ‡å’Œçš„&quot;å¶å­è·¯å¾„&quot;æƒ…å†µ</li>
<li>æ²¡æœ‰è€ƒè™‘ä» 3 ç‚¹å¼€å§‹ï¼Œå¯èƒ½å‘ä¸‹å»¶ä¼¸çš„å…¶ä»–è·¯å¾„ï¼Œåº”é€’å½’ä¼ é€’ targetSum-node.Val</li>
</ul>
<h4 id="3-é€’å½’ç»ˆæ­¢æ—¶æœºå’ŒçŠ¶æ€æ··ä¹±">3. é€’å½’ç»ˆæ­¢æ—¶æœºå’ŒçŠ¶æ€æ··ä¹±</h4>
<p>åœ¨æˆ‘çš„å®ç°ä¸­ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹éƒ½åˆ›å»º 4 ä¸ªé€’å½’è°ƒç”¨ï¼Œæ²¡æœ‰æ˜ç¡®çš„å±‚æ¬¡å’ŒèŒè´£ï¼Œå¯¼è‡´è®¡ç®—è·¯å¾„æ—¶:</p>
<ul>
<li>ç»Ÿè®¡ç»“æœä¸å‡†ç¡®ï¼ˆå¯èƒ½é‡å¤è®¡æ•°ï¼‰</li>
<li>é€’å½’åˆ†æ”¯æ•°é‡çˆ†ç‚¸å¼å¢é•¿ï¼ˆå¯¹äº n ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œæœ€åæƒ…å†µæ¥è¿‘ 4^n æ¬¡é€’å½’è°ƒç”¨ï¼‰</li>
</ul>
<p><strong>å…·ä½“ç¤ºä¾‹é”™è¯¯</strong>ï¼š<br>
å¯¹äºç¤ºä¾‹ 1ï¼Œç›®æ ‡å’Œä¸º 8ï¼Œæ­£ç¡®ç»“æœåº”è¯¥æ˜¯ 3 æ¡è·¯å¾„ã€‚ä½†ä½¿ç”¨æˆ‘åŸå§‹çš„ä»£ç ï¼Œä¼šäº§ç”Ÿå¤§é‡é‡å¤è®¡ç®—å’Œé”™è¯¯è®¡æ•°ã€‚ä¾‹å¦‚è·¯å¾„ 5-&gt;3 ä¼šè¢«å¤šæ¡ä¸åŒçš„é€’å½’è·¯å¾„é‡å¤å‘ç°å’Œç»Ÿè®¡ã€‚</p>
<h2 id="æ­£ç¡®è§£æ³•">æ­£ç¡®è§£æ³•</h2>
<p>ç»è¿‡åˆ†æï¼Œæˆ‘æ”¹è¿›çš„è§£æ³•æ˜¯ï¼š</p>
<h3 id="æ–¹æ¡ˆä¸€ï¼šåŒé‡é€’å½’å®ç°">æ–¹æ¡ˆä¸€ï¼šåŒé‡é€’å½’å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pathSum</span><span class="params">(root *TreeNode, targetSum <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡ç®—ä»¥å½“å‰èŠ‚ç‚¹ä¸ºèµ·ç‚¹çš„è·¯å¾„æ•°</span></span><br><span class="line">    cnt := dfsPathSum(root, targetSum)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€’å½’å¤„ç†å·¦å³å­æ ‘ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹éƒ½ä½œä¸ºæ½œåœ¨èµ·ç‚¹</span></span><br><span class="line">    cnt += pathSum(root.Left, targetSum)</span><br><span class="line">    cnt += pathSum(root.Right, targetSum)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cnt</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsPathSum</span><span class="params">(node *TreeNode, targetSum <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–è®¡æ•°</span></span><br><span class="line">    cnt := <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹å€¼ç­‰äºç›®æ ‡å’Œï¼Œæ‰¾åˆ°ä¸€æ¡è·¯å¾„</span></span><br><span class="line">    <span class="keyword">if</span> node.Val == targetSum &#123;</span><br><span class="line">        cnt++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€’å½’è®¡ç®—ä»¥å­èŠ‚ç‚¹ä¸ºè·¯å¾„å»¶ç»­çš„æƒ…å†µ</span></span><br><span class="line">    cnt += dfsPathSum(node.Left, targetSum-node.Val)</span><br><span class="line">    cnt += dfsPathSum(node.Right, targetSum-node.Val)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cnt</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ¡ˆäºŒï¼šå‰ç¼€å’Œä¼˜åŒ–å®ç°">æ–¹æ¡ˆäºŒï¼šå‰ç¼€å’Œä¼˜åŒ–å®ç°</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pathSum</span><span class="params">(root *TreeNode, targetSum <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨mapå­˜å‚¨å‰ç¼€å’ŒåŠå…¶å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    prefixSum := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int64</span>]<span class="type">int</span>)</span><br><span class="line">    <span class="comment">// åˆå§‹å‰ç¼€å’Œä¸º0ï¼Œå‡ºç°1æ¬¡ï¼ˆç©ºè·¯å¾„ï¼‰</span></span><br><span class="line">    prefixSum[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨int64é¿å…å¤§æ•°æº¢å‡º</span></span><br><span class="line">    <span class="keyword">return</span> dfsWithPrefixSum(root, <span class="number">0</span>, <span class="type">int64</span>(targetSum), prefixSum)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsWithPrefixSum</span><span class="params">(node *TreeNode, currSum <span class="type">int64</span>, targetSum <span class="type">int64</span>, prefixSum <span class="keyword">map</span>[<span class="type">int64</span>]<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°å½“å‰è·¯å¾„å’Œ</span></span><br><span class="line">    currSum += <span class="type">int64</span>(node.Val)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯»æ‰¾æœ‰å¤šå°‘ä¸ªå‰ç¼€å’Œä¸º currSum-targetSum çš„è·¯å¾„</span></span><br><span class="line">    <span class="comment">// è¿™äº›è·¯å¾„ä¸å½“å‰è·¯å¾„ä¸€èµ·ï¼Œå½¢æˆå’Œä¸ºtargetSumçš„è·¯å¾„</span></span><br><span class="line">    count := prefixSum[currSum-targetSum]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°å‰ç¼€å’Œå‡ºç°æ¬¡æ•°</span></span><br><span class="line">    prefixSum[currSum]++</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€’å½’å¤„ç†å·¦å³å­æ ‘</span></span><br><span class="line">    count += dfsWithPrefixSum(node.Left, currSum, targetSum, prefixSum)</span><br><span class="line">    count += dfsWithPrefixSum(node.Right, currSum, targetSum, prefixSum)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å›æº¯ï¼šç§»é™¤å½“å‰èŠ‚ç‚¹çš„å½±å“ï¼Œé¿å…å½±å“å…¶ä»–åˆ†æ”¯çš„è®¡ç®—</span></span><br><span class="line">    prefixSum[currSum]--</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆè¿™äº›è§£æ³•å¯ä»¥å·¥ä½œ">ä¸ºä»€ä¹ˆè¿™äº›è§£æ³•å¯ä»¥å·¥ä½œ</h3>
<ol>
<li>
<p><strong>åŒé‡é€’å½’è§£æ³•</strong>ï¼š</p>
<ul>
<li>å°†é—®é¢˜åˆ†è§£ä¸ºæ¸…æ™°çš„ä¸¤ä¸ªå­é—®é¢˜ï¼šéå†æ¯ä¸ªèŠ‚ç‚¹ + ç»Ÿè®¡ä»ç‰¹å®šèŠ‚ç‚¹å‡ºå‘çš„è·¯å¾„</li>
<li>æ¯ä¸ªé€’å½’å‡½æ•°åªæœ‰å•ä¸€èŒè´£ï¼Œé¿å…é€»è¾‘æ··æ·†</li>
<li>ä½¿ç”¨è¿”å›å€¼è€ŒéæŒ‡é’ˆå¼•ç”¨ï¼Œä½¿çŠ¶æ€ç®¡ç†æ›´æ¸…æ™°</li>
</ul>
</li>
<li>
<p><strong>å‰ç¼€å’Œè§£æ³•</strong>ï¼š</p>
<ul>
<li>åˆ©ç”¨æ•°å­¦å…³ç³» <code>currentSum - x = targetSum</code>ï¼Œåªéœ€å¯»æ‰¾å‰ç¼€å’Œä¸º <code>x = currentSum - targetSum</code> çš„è·¯å¾„</li>
<li>ä¸€æ¬¡éå†å°±èƒ½ç»Ÿè®¡æ‰€æœ‰è·¯å¾„ï¼Œé¿å…é‡å¤è®¡ç®—</li>
<li>ä½¿ç”¨å›æº¯æŠ€æœ¯ç»´æŠ¤å“ˆå¸Œè¡¨çŠ¶æ€ï¼Œç¡®ä¿æ­£ç¡®ç»Ÿè®¡ä¸åŒåˆ†æ”¯çš„è·¯å¾„</li>
</ul>
</li>
</ol>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>åŒé‡é€’å½’æ³•</th>
<th>å‰ç¼€å’Œæ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(nÂ²)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(h)ï¼Œhä¸ºæ ‘é«˜</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç›´è§‚æ˜“æ‡‚ï¼Œä»£ç ç®€æ´</td>
<td>æ€§èƒ½æ›´ä¼˜ï¼Œåªéœ€ä¸€æ¬¡éå†</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å¯¹å¤§å‹æ ‘æ€§èƒ½è¾ƒå·®</td>
<td>éœ€è¦é¢å¤–å“ˆå¸Œè¡¨ç©ºé—´</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>æ ‘èŠ‚ç‚¹æ•°è¾ƒå°‘</td>
<td>å¤§å‹æ ‘ç»“æ„</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>é€šè¿‡è¿™ä¸ªé”™è¯¯ï¼Œæˆ‘å­¦åˆ°äº†ä»¥ä¸‹é‡è¦ç»éªŒï¼š</p>
<ol>
<li>
<p><strong>é€’å½’è®¾è®¡åŸåˆ™</strong>ï¼š</p>
<ul>
<li>é€’å½’å‡½æ•°åº”å½“åŠŸèƒ½å•ä¸€ï¼ŒèŒè´£æ˜ç¡®</li>
<li>å‚æ•°è®¾è®¡éœ€è¦è€ƒè™‘æ¸…æ™°çš„æ„ä¹‰å’Œä¼ é€’æ–¹å¼</li>
<li>å¤æ‚é—®é¢˜å¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„é€’å½’å‡½æ•°é…åˆè§£å†³</li>
</ul>
</li>
<li>
<p><strong>å¸¸è§é€’å½’é”™è¯¯æ¨¡å¼</strong>ï¼š</p>
<ul>
<li>æ··åˆä¸åŒèŒè´£çš„é€’å½’ä¼šå¯¼è‡´è®¡ç®—è·¯å¾„æ··ä¹±å’Œé‡å¤</li>
<li>é€’å½’çˆ†ç‚¸ï¼šæ¯ä¸ªèŠ‚ç‚¹äº§ç”Ÿè¿‡å¤šé€’å½’è°ƒç”¨ä¼šå¯¼è‡´æ€§èƒ½ç¾éš¾</li>
<li>çŠ¶æ€ç®¡ç†æ··ä¹±ï¼šä½¿ç”¨å…¨å±€å˜é‡æˆ–æŒ‡é’ˆå¼•ç”¨æ—¶éœ€ç‰¹åˆ«å°å¿ƒ</li>
</ul>
</li>
<li>
<p><strong>å‰ç¼€å’ŒæŠ€æœ¯åº”ç”¨</strong>ï¼š</p>
<ul>
<li>å‰ç¼€å’Œä¸ä»…é€‚ç”¨äºæ•°ç»„ï¼Œä¹Ÿé€‚ç”¨äºæ ‘ç»“æ„</li>
<li>ä½¿ç”¨å“ˆå¸Œè¡¨ç»“åˆå‰ç¼€å’Œå¯ä»¥å°†æ—¶é—´å¤æ‚åº¦ä» O(nÂ²) é™è‡³ O(n)</li>
<li>å›æº¯æ€æƒ³åœ¨æ ‘çš„éå†ä¸­çš„é‡è¦åº”ç”¨</li>
</ul>
</li>
<li>
<p><strong>ä»£ç è´¨é‡æå‡</strong>ï¼š</p>
<ul>
<li>æ¸…æ™°çš„å‡½æ•°å‘½åå’Œå‚æ•°è®¾è®¡å¯¹é€’å½’ä»£ç å°¤ä¸ºé‡è¦</li>
<li>ä½¿ç”¨è¿”å›å€¼ä»£æ›¿æŒ‡é’ˆå¼•ç”¨é€šå¸¸èƒ½æé«˜ä»£ç å¯è¯»æ€§</li>
<li>ä½¿ç”¨ <code>int64</code> å¤„ç†å¯èƒ½çš„æ•´æ•°æº¢å‡º</li>
</ul>
</li>
</ol>
<p>è¿™ä¸ªé”™è¯¯ä¹Ÿæé†’æˆ‘åœ¨å¤„ç†æ ‘çš„è·¯å¾„é—®é¢˜æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ä¸åŒè·¯å¾„çš„å®šä¹‰å’Œè®¡æ•°æ–¹å¼ï¼Œä»¥é¿å…é‡å¤æˆ–é—æ¼ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>å“ˆå¸Œ</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>å‰ç¼€å’Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 105 - ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ï¼ˆConstruct Binary Tree from Preorder and Inorder Traversalï¼‰</title>
    <url>/2025/04/30/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-105-%E4%BB%8E%E5%89%8D%E5%BA%8F%E4%B8%8E%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E6%9E%84%E9%80%A0%E4%BA%8C%E5%8F%89%E6%A0%91/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ <code>preorder</code> å’Œ <code>inorder</code>ï¼Œå…¶ä¸­ <code>preorder</code> æ˜¯äºŒå‰æ ‘çš„<strong>å…ˆåºéå†</strong>ï¼Œ<code>inorder</code> æ˜¯åŒä¸€æ£µæ ‘çš„<strong>ä¸­åºéå†</strong>ï¼Œè¯·æ„é€ äºŒå‰æ ‘å¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: preorder = [3,9,20,15,7], inorder = [9,3,15,20,7]</span><br><span class="line">è¾“å‡º: [3,9,20,null,null,15,7]</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„äºŒå‰æ ‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: preorder = [-1], inorder = [-1]</span><br><span class="line">è¾“å‡º: [-1]</span><br></pre></td></tr></table></figure>
<h3 id="æç¤º">æç¤º</h3>
<ul>
<li><code>1 &lt;= preorder.length &lt;= 3000</code></li>
<li><code>inorder.length == preorder.length</code></li>
<li><code>-3000 &lt;= preorder[i], inorder[i] &lt;= 3000</code></li>
<li><code>preorder</code> å’Œ <code>inorder</code> å‡æ— é‡å¤å…ƒç´ </li>
<li><code>inorder</code> å‡å‡ºç°åœ¨ <code>preorder</code></li>
<li><code>preorder</code> ä¿è¯ä¸ºäºŒå‰æ ‘çš„å‰åºéå†åºåˆ—</li>
<li><code>inorder</code> ä¿è¯ä¸ºäºŒå‰æ ‘çš„ä¸­åºéå†åºåˆ—</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜è¦æ±‚æˆ‘ä»¬æ ¹æ®äºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†ç»“æœé‡æ„äºŒå‰æ ‘ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯ç†è§£å‰åºéå†å’Œä¸­åºéå†çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>å‰åºéå†</strong>ï¼šæ ¹èŠ‚ç‚¹ â†’ å·¦å­æ ‘ â†’ å³å­æ ‘</li>
<li><strong>ä¸­åºéå†</strong>ï¼šå·¦å­æ ‘ â†’ æ ¹èŠ‚ç‚¹ â†’ å³å­æ ‘</li>
</ul>
<p><strong>å…³é”®æ´è§</strong>ï¼šå‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ å§‹ç»ˆæ˜¯å½“å‰å­æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚è€Œåœ¨ä¸­åºéå†ä¸­ï¼Œæ ¹èŠ‚ç‚¹å°†æ•°ç»„åˆ†æˆä¸¤éƒ¨åˆ†ï¼šå·¦è¾¹æ˜¯å·¦å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå³è¾¹æ˜¯å³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</p>
<p>ä»¥ç¤ºä¾‹ 1 ä¸ºä¾‹ï¼š</p>
<ul>
<li>å‰åºéå†ï¼š<code>[3, 9, 20, 15, 7]</code> - ç¬¬ä¸€ä¸ªå…ƒç´  <code>3</code> æ˜¯æ ¹èŠ‚ç‚¹</li>
<li>ä¸­åºéå†ï¼š<code>[9, 3, 15, 20, 7]</code> - æ ¹èŠ‚ç‚¹ <code>3</code> å°†æ•°ç»„åˆ†æˆ <code>[9]</code>ï¼ˆå·¦å­æ ‘ï¼‰å’Œ <code>[15, 20, 7]</code>ï¼ˆå³å­æ ‘ï¼‰</li>
</ul>
<p>é€šè¿‡è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€’å½’åœ°æ„å»ºäºŒå‰æ ‘ï¼š</p>
<ol>
<li>ç¡®å®šæ ¹èŠ‚ç‚¹ï¼šå‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li>
<li>åœ¨ä¸­åºéå†ä¸­æ‰¾åˆ°æ ¹èŠ‚ç‚¹çš„ä½ç½®</li>
<li>å°†ä¸­åºéå†åˆ†æˆå·¦å³ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«å¯¹åº”å·¦å³å­æ ‘</li>
<li>ç›¸åº”åœ°åˆ’åˆ†å‰åºéå†ï¼ˆæ ¹æ®å·¦å³å­æ ‘çš„å¤§å°ï¼‰</li>
<li>é€’å½’åœ°æ„å»ºå·¦å³å­æ ‘</li>
</ol>
<h3 id="æ–¹æ³•ä¸€ï¼šé€’å½’-æ•°ç»„åˆ‡ç‰‡">æ–¹æ³•ä¸€ï¼šé€’å½’ + æ•°ç»„åˆ‡ç‰‡</h3>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Go çš„åˆ‡ç‰‡ç‰¹æ€§æ–¹ä¾¿åœ°åˆ’åˆ†æ•°ç»„ï¼Œç„¶åé€’å½’æ„å»ºå­æ ‘ã€‚</p>
<h4 id="æ­¥éª¤è¯¦æƒ…">æ­¥éª¤è¯¦æƒ…</h4>
<ol>
<li>å¦‚æœå‰åºéå†æ•°ç»„ä¸ºç©ºï¼Œè¿”å› <code>nil</code>ï¼ˆé€’å½’ç»ˆæ­¢æ¡ä»¶ï¼‰</li>
<li>å–å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºæ ¹èŠ‚ç‚¹</li>
<li>åœ¨ä¸­åºéå†ä¸­æ‰¾åˆ°æ ¹èŠ‚ç‚¹çš„ä½ç½®</li>
<li>æ ¹æ®æ ¹èŠ‚ç‚¹ä½ç½®ï¼Œå°†ä¸­åºéå†åˆ†ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘</li>
<li>æ ¹æ®å·¦å­æ ‘çš„å¤§å°ï¼Œç¡®å®šå‰åºéå†ä¸­å·¦å­æ ‘å’Œå³å­æ ‘çš„èŒƒå›´</li>
<li>é€’å½’æ„å»ºå·¦å­æ ‘å’Œå³å­æ ‘</li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šé€’å½’-å“ˆå¸Œè¡¨ä¼˜åŒ–">æ–¹æ³•äºŒï¼šé€’å½’ + å“ˆå¸Œè¡¨ä¼˜åŒ–</h3>
<p>æ–¹æ³•ä¸€ä¸­ï¼Œæˆ‘ä»¬æ¯æ¬¡é€’å½’éƒ½è¦åœ¨ä¸­åºéå†ä¸­çº¿æ€§æŸ¥æ‰¾æ ¹èŠ‚ç‚¹çš„ä½ç½®ï¼Œè¿™å¯¼è‡´äº†é¢å¤–çš„æ—¶é—´å¤æ‚åº¦ã€‚ä¸ºäº†ä¼˜åŒ–è¿™ä¸€æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨é¢„å…ˆå­˜å‚¨ä¸­åºéå†ä¸­æ¯ä¸ªå…ƒç´ çš„ä½ç½®ã€‚</p>
<h4 id="æ­¥éª¤è¯¦æƒ…-2">æ­¥éª¤è¯¦æƒ…</h4>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œè®°å½•ä¸­åºéå†ä¸­æ¯ä¸ªå…ƒç´ çš„ç´¢å¼•</li>
<li>å®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œæ¥æ”¶å‰åºå’Œä¸­åºéå†çš„èŒƒå›´ï¼Œä»¥åŠå“ˆå¸Œè¡¨</li>
<li>åœ¨è¾…åŠ©å‡½æ•°ä¸­ï¼š
<ul>
<li>å¦‚æœå½“å‰èŒƒå›´ä¸ºç©ºï¼Œè¿”å› <code>nil</code></li>
<li>å–å‰åºéå†èµ·å§‹ä½ç½®çš„å…ƒç´ ä½œä¸ºæ ¹èŠ‚ç‚¹</li>
<li>ä»å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸­çš„ä½ç½®</li>
<li>è®¡ç®—å·¦å­æ ‘çš„å¤§å°</li>
<li>é€’å½’æ„å»ºå·¦å³å­æ ‘ï¼Œä½¿ç”¨è®¡ç®—å¾—åˆ°çš„èŒƒå›´</li>
</ul>
</li>
<li>è¿”å›æ ¹èŠ‚ç‚¹</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>å¯¹äºæ–¹æ³•ä¸€å’Œæ–¹æ³•äºŒï¼Œä¸»è¦çš„åŒºåˆ«åœ¨äºå¦‚ä½•æ‰¾åˆ°ä¸­åºéå†ä¸­æ ¹èŠ‚ç‚¹çš„ä½ç½®ï¼Œä»¥åŠå¦‚ä½•åˆ’åˆ†æ•°ç»„ã€‚</p>
<p>åœ¨æ–¹æ³•ä¸€ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Go çš„åˆ‡ç‰‡ç‰¹æ€§ç›´æ¥å¯¹æ•°ç»„è¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼Œè¿™ä½¿å¾—ä»£ç ç®€æ´ä½†ä¼šäº§ç”Ÿé¢å¤–çš„å†…å­˜å¼€é”€ã€‚</p>
<p>åœ¨æ–¹æ³•äºŒä¸­ï¼Œæˆ‘ä»¬é¿å…äº†åˆ‡ç‰‡æ“ä½œï¼Œè€Œæ˜¯ä½¿ç”¨ç´¢å¼•æ¥æŒ‡å®šå­æ•°ç»„çš„èŒƒå›´ã€‚åŒæ—¶ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨ä¼˜åŒ–äº†æŸ¥æ‰¾æ“ä½œï¼Œå°†æŸ¥æ‰¾æ ¹èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦ä» O(n) é™ä½åˆ° O(1)ã€‚</p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<h4 id="æ–¹æ³•ä¸€ï¼šé€’å½’-æ•°ç»„åˆ‡ç‰‡-2">æ–¹æ³•ä¸€ï¼šé€’å½’ + æ•°ç»„åˆ‡ç‰‡</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildTree</span><span class="params">(preorder []<span class="type">int</span>, inorder []<span class="type">int</span>)</span></span> *TreeNode &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†ç©ºæ ‘çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(preorder) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ ¹èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">    rootVal := preorder[<span class="number">0</span>]</span><br><span class="line">    root := &amp;TreeNode&#123;Val: rootVal&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ä¸­åºéå†ä¸­æ‰¾åˆ°æ ¹èŠ‚ç‚¹çš„ä½ç½®</span></span><br><span class="line">    rootIndex := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, val := <span class="keyword">range</span> inorder &#123;</span><br><span class="line">        <span class="keyword">if</span> val == rootVal &#123;</span><br><span class="line">            rootIndex = i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€’å½’æ„å»ºå·¦å­æ ‘å’Œå³å­æ ‘</span></span><br><span class="line">    <span class="comment">// å·¦å­æ ‘ï¼šå‰åºéå†ä¸­ [1:rootIndex+1]ï¼Œä¸­åºéå†ä¸­ [:rootIndex]</span></span><br><span class="line">    <span class="comment">// å³å­æ ‘ï¼šå‰åºéå†ä¸­ [rootIndex+1:]ï¼Œä¸­åºéå†ä¸­ [rootIndex+1:]</span></span><br><span class="line">    root.Left = buildTree(preorder[<span class="number">1</span>:rootIndex+<span class="number">1</span>], inorder[:rootIndex])</span><br><span class="line">    root.Right = buildTree(preorder[rootIndex+<span class="number">1</span>:], inorder[rootIndex+<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•äºŒï¼šé€’å½’-å“ˆå¸Œè¡¨ä¼˜åŒ–-2">æ–¹æ³•äºŒï¼šé€’å½’ + å“ˆå¸Œè¡¨ä¼˜åŒ–</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildTree</span><span class="params">(preorder []<span class="type">int</span>, inorder []<span class="type">int</span>)</span></span> *TreeNode &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸­åºéå†çš„å€¼åˆ°ç´¢å¼•çš„æ˜ å°„ï¼ŒåŠ é€ŸæŸ¥æ‰¾</span></span><br><span class="line">    inorderMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>)</span><br><span class="line">    <span class="keyword">for</span> i, val := <span class="keyword">range</span> inorder &#123;</span><br><span class="line">        inorderMap[val] = i</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> buildTreeHelper(preorder, <span class="number">0</span>, <span class="built_in">len</span>(preorder)<span class="number">-1</span>, inorder, <span class="number">0</span>, <span class="built_in">len</span>(inorder)<span class="number">-1</span>, inorderMap)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildTreeHelper</span><span class="params">(preorder []<span class="type">int</span>, preStart, preEnd <span class="type">int</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">                    inorder []<span class="type">int</span>, inStart, inEnd <span class="type">int</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">                    inorderMap <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>)</span></span> *TreeNode &#123;</span><br><span class="line">    <span class="comment">// é€’å½’ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> preStart &gt; preEnd &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    rootVal := preorder[preStart]</span><br><span class="line">    root := &amp;TreeNode&#123;Val: rootVal&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// åœ¨ä¸­åºéå†ä¸­æ‰¾åˆ°æ ¹èŠ‚ç‚¹çš„ä½ç½®</span></span><br><span class="line">    rootIndex := inorderMap[rootVal]</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è®¡ç®—å·¦å­æ ‘çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    leftSize := rootIndex - inStart</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// é€’å½’æ„å»ºå·¦å­æ ‘å’Œå³å­æ ‘</span></span><br><span class="line">    <span class="comment">// å·¦å­æ ‘ï¼š</span></span><br><span class="line">    <span class="comment">// - å‰åºéå†ï¼š[preStart+1 : preStart+leftSize+1)</span></span><br><span class="line">    <span class="comment">// - ä¸­åºéå†ï¼š[inStart : rootIndex)</span></span><br><span class="line">    root.Left = buildTreeHelper(</span><br><span class="line">        preorder, preStart+<span class="number">1</span>, preStart+leftSize, </span><br><span class="line">        inorder, inStart, rootIndex<span class="number">-1</span>, </span><br><span class="line">        inorderMap,</span><br><span class="line">    )</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å³å­æ ‘ï¼š</span></span><br><span class="line">    <span class="comment">// - å‰åºéå†ï¼š[preStart+leftSize+1 : preEnd+1)</span></span><br><span class="line">    <span class="comment">// - ä¸­åºéå†ï¼š[rootIndex+1 : inEnd+1)</span></span><br><span class="line">    root.Right = buildTreeHelper(</span><br><span class="line">        preorder, preStart+leftSize+<span class="number">1</span>, preEnd, </span><br><span class="line">        inorder, rootIndex+<span class="number">1</span>, inEnd, </span><br><span class="line">        inorderMap,</span><br><span class="line">    )</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>ä»¥ç¤ºä¾‹ 1 ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥åˆ†ææ–¹æ³•äºŒçš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ul>
<li>å‰åºéå†ï¼š<code>[3, 9, 20, 15, 7]</code></li>
<li>ä¸­åºéå†ï¼š<code>[9, 3, 15, 20, 7]</code></li>
</ul>
<ol>
<li>åˆ›å»ºå“ˆå¸Œè¡¨ï¼š<code>&#123;9:0, 3:1, 15:2, 20:3, 7:4&#125;</code></li>
<li>è°ƒç”¨ <code>buildTreeHelper</code> å‡½æ•°ï¼ŒèŒƒå›´æ˜¯æ•´ä¸ªæ•°ç»„</li>
<li><code>rootVal = preorder[0] = 3</code></li>
<li><code>rootIndex = inorderMap[3] = 1</code></li>
<li><code>leftSize = 1 - 0 = 1</code>ï¼ˆå·¦å­æ ‘æœ‰ 1 ä¸ªèŠ‚ç‚¹ï¼‰</li>
<li>é€’å½’æ„å»ºå·¦å­æ ‘ï¼š
<ul>
<li>å‰åºèŒƒå›´ï¼š<code>[1, 1]</code>ï¼Œå³ <code>[9]</code></li>
<li>ä¸­åºèŒƒå›´ï¼š<code>[0, 0]</code>ï¼Œå³ <code>[9]</code></li>
<li>è¿”å›ä¸€ä¸ªå€¼ä¸º 9 çš„èŠ‚ç‚¹ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹</li>
</ul>
</li>
<li>é€’å½’æ„å»ºå³å­æ ‘ï¼š
<ul>
<li>å‰åºèŒƒå›´ï¼š<code>[2, 4]</code>ï¼Œå³ <code>[20, 15, 7]</code></li>
<li>ä¸­åºèŒƒå›´ï¼š<code>[2, 4]</code>ï¼Œå³ <code>[15, 20, 7]</code></li>
<li>è¿™åˆæ˜¯ä¸€ä¸ªå­é—®é¢˜ï¼Œä¼šé€’å½’è§£å†³</li>
</ul>
</li>
<li>æœ€ç»ˆè¿”å›æ„å»ºå¥½çš„æ ‘</li>
</ol>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ–¹æ³•ä¸€ï¼šé€’å½’ + æ•°ç»„åˆ‡ç‰‡</th>
<th>æ–¹æ³•äºŒï¼šé€’å½’ + å“ˆå¸Œè¡¨ä¼˜åŒ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(nÂ²)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£</td>
<td>æ›´é«˜æ•ˆï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹æ ‘</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>åœ¨é€’å½’è¿‡ç¨‹ä¸­æŸ¥æ‰¾æ ¹èŠ‚ç‚¹ä½ç½®è¾ƒæ…¢ï¼Œä¸”åˆ‡ç‰‡æ“ä½œä¼šå¢åŠ å†…å­˜å¼€é”€</td>
<td>ä»£ç ç›¸å¯¹å¤æ‚</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šé€’å½’-æ•°ç»„åˆ‡ç‰‡-3">æ–¹æ³•ä¸€ï¼šé€’å½’ + æ•°ç»„åˆ‡ç‰‡</h3>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(nÂ²)</p>
<ul>
<li>æœ€åæƒ…å†µä¸‹ï¼Œæ¯æ¬¡é€’å½’éƒ½éœ€è¦ O(n) æ—¶é—´æ¥æ‰¾åˆ°æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸­çš„ä½ç½®</li>
<li>é€’å½’æ ‘çš„æ·±åº¦ä¸º O(n)</li>
<li>å› æ­¤æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(nÂ²)</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)</p>
<ul>
<li>é€’å½’è°ƒç”¨æ ˆçš„æ·±åº¦ä¸º O(n)</li>
<li>åˆ‡ç‰‡æ“ä½œä¼šåˆ›å»ºæ–°çš„æ•°ç»„ï¼Œå¢åŠ é¢å¤–çš„ç©ºé—´å¼€é”€</li>
</ul>
</li>
</ul>
<h3 id="æ–¹æ³•äºŒï¼šé€’å½’-å“ˆå¸Œè¡¨ä¼˜åŒ–-3">æ–¹æ³•äºŒï¼šé€’å½’ + å“ˆå¸Œè¡¨ä¼˜åŒ–</h3>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)</p>
<ul>
<li>é¢„å¤„ç†å“ˆå¸Œè¡¨éœ€è¦ O(n) æ—¶é—´</li>
<li>æ¯ä¸ªèŠ‚ç‚¹åªè¢«è®¿é—®ä¸€æ¬¡ï¼Œæ„å»ºçš„æ—¶é—´ä¸º O(n)</li>
<li>æŸ¥æ‰¾æ ¹èŠ‚ç‚¹ä½ç½®çš„æ—¶é—´ä» O(n) ä¼˜åŒ–åˆ° O(1)</li>
<li>å› æ­¤æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(n)</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)</p>
<ul>
<li>å“ˆå¸Œè¡¨éœ€è¦ O(n) çš„ç©ºé—´</li>
<li>é€’å½’è°ƒç”¨æ ˆçš„æ·±åº¦ä¸º O(n)</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>å‰åºéå†å’Œä¸­åºéå†çš„ç‰¹æ€§</strong>ï¼šç†è§£è¿™ä¸¤ç§éå†æ–¹å¼çš„ç‰¹ç‚¹æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„åŸºç¡€ã€‚å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ ¹èŠ‚ç‚¹ï¼Œä¸­åºéå†å¯ä»¥åŒºåˆ†å·¦å³å­æ ‘ã€‚</p>
</li>
<li>
<p><strong>é€’å½’æ€æƒ³</strong>ï¼šè¿™é“é¢˜æ˜¯å…¸å‹çš„é€’å½’é—®é¢˜ï¼Œé€šè¿‡ä¸æ–­åœ°å°†å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜æ¥è§£å†³ã€‚</p>
</li>
<li>
<p><strong>ç©ºé—´æ—¶é—´æƒè¡¡</strong>ï¼šæ–¹æ³•äºŒé€šè¿‡ä½¿ç”¨é¢å¤–çš„å“ˆå¸Œè¡¨ç©ºé—´æ¢å–æ—¶é—´æ•ˆç‡ï¼Œè¿™æ˜¯ç®—æ³•ä¼˜åŒ–ä¸­å¸¸è§çš„æ€è·¯ã€‚</p>
</li>
<li>
<p><strong>ç´¢å¼•è®¡ç®—</strong>ï¼šåœ¨æ–¹æ³•äºŒä¸­ï¼Œæ­£ç¡®è®¡ç®—å­æ•°ç»„çš„èŒƒå›´æ˜¯å…³é”®ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ç´¢å¼•è¾¹ç•Œã€‚</p>
</li>
<li>
<p><strong>å¸¸è§é™·é˜±</strong>ï¼š</p>
<ul>
<li>å¿˜è®°è€ƒè™‘ç©ºæ ‘æƒ…å†µ</li>
<li>è®¡ç®—å­æ ‘èŒƒå›´æ—¶çš„ç´¢å¼•é”™è¯¯</li>
<li>æ²¡æœ‰æ­£ç¡®å¤„ç†å·¦å³å­æ ‘çš„åˆ’åˆ†</li>
</ul>
</li>
</ol>
<p>ç›¸å…³é—®é¢˜ï¼š</p>
<ul>
<li>LeetCode 106ï¼šä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘</li>
<li>LeetCode 889ï¼šæ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘</li>
<li>LeetCode 1008ï¼šå‰åºéå†æ„é€ äºŒå‰æœç´¢æ ‘</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>é€’å½’</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>åˆ†æ²»</tag>
        <tag>å“ˆå¸Œ</tag>
        <tag>Medium</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 114 - äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨</title>
    <url>/2025/04/29/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-114-Binary-Tree-Flatten/</url>
    <content><![CDATA[<h2 id="ä¿®è®¢è®°å½•">ä¿®è®¢è®°å½•</h2>
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>ä¿®è®¢æ—¶é—´</th>
<th>ä¿®è®¢å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>v1.0</td>
<td>2025-04-29 20:08:43</td>
<td>åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«é”™è¯¯è§£æ³•åˆ†æå’Œä¿®æ­£è§£æ³•</td>
</tr>
<tr>
<td>v2.0</td>
<td>2025-06-15 13:11:33</td>
<td>æ·»åŠ è¿›ä¸€æ­¥ä¼˜åŒ–ç‰ˆæœ¬ï¼Œå®Œå–„è§£æ³•å¯¹æ¯”å’Œå­¦ä¹ æ€»ç»“</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ äºŒå‰æ ‘çš„æ ¹ç»“ç‚¹ root ï¼Œè¯·ä½ å°†å®ƒå±•å¼€ä¸ºä¸€ä¸ªå•é“¾è¡¨ï¼š</p>
<ul>
<li>å±•å¼€åçš„å•é“¾è¡¨åº”è¯¥åŒæ ·ä½¿ç”¨ TreeNode ï¼Œå…¶ä¸­ right å­æŒ‡é’ˆæŒ‡å‘é“¾è¡¨ä¸­ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œè€Œå·¦å­æŒ‡é’ˆå§‹ç»ˆä¸º null ã€‚</li>
<li>å±•å¼€åçš„å•é“¾è¡¨åº”è¯¥ä¸äºŒå‰æ ‘ å…ˆåºéå† é¡ºåºç›¸åŒã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<p><img src="/2025/04/29/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-114-Binary-Tree-Flatten/1745928682533.png" alt="1745928682533"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [1,2,5,3,4,null,6]</span><br><span class="line">è¾“å‡ºï¼š[1,null,2,null,3,null,4,null,5,null,6]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [0]</span><br><span class="line">è¾“å‡ºï¼š[0]</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>æ ‘ä¸­ç»“ç‚¹æ•°åœ¨èŒƒå›´ [0, 2000] å†…</li>
<li>-100 &lt;= Node.val &lt;= 100</li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘çš„åˆå§‹è§£æ³•æ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¼ å…¥å‚æ•°ä¸ºä¸€é¢—å­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œè¿”å›å€¼ä¸ºå¤„ç†å®Œåè¿™é¢—å­æ ‘çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsFlatten</span><span class="params">(node *TreeNode)</span></span> *TreeNode &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    leftEnd := dfsFlatten(node.Left)</span><br><span class="line">    rightEnd := dfsFlatten(node.Right)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> leftEnd != <span class="literal">nil</span> &#123;</span><br><span class="line">        leftEnd.Right = node.Right</span><br><span class="line">        node.Right = node.Left</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> rightEnd == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> node  <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šå½“å³å­æ ‘ä¸ºç©ºæ—¶ï¼Œåº”è¯¥è¿”å›leftEndè€Œä¸æ˜¯node</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> rightEnd</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè§£æ³•åœ¨æŸäº›æµ‹è¯•ç”¨ä¾‹ä¸­å¤±è´¥äº†ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªé”™è¯¯ï¼š</p>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<ol>
<li>
<p><strong>æ²¡æœ‰è®¾ç½® <code>node.Left = nil</code></strong><br>
é¢˜ç›®æ˜ç¡®è¦æ±‚å±•å¼€åçš„å•é“¾è¡¨<strong>å·¦å­æŒ‡é’ˆå§‹ç»ˆä¸º <code>null</code></strong>ã€‚åœ¨æˆ‘çš„é”™è¯¯ä»£ç ä¸­ï¼Œå½“å¤„ç†å®Œå·¦å­æ ‘åï¼ˆ<code>leftEnd := dfsFlatten(node.Left)</code>ï¼‰ï¼Œå¹¶ä¸” <code>leftEnd != nil</code> æ—¶ï¼Œæˆ‘æ‰§è¡Œäº† <code>node.Right = node.Left</code>ï¼Œå°†åŸæ¥çš„å·¦å­æ ‘æŒ‚è½½åˆ°äº†å³å­æ ‘çš„ä½ç½®ã€‚ä½†æ˜¯ï¼Œæˆ‘<strong>å¿˜è®°äº†å°† <code>node.Left</code> è®¾ç½®ä¸º <code>nil</code></strong>ã€‚è¿™å¯¼è‡´åŸæœ¬çš„å·¦å­æ ‘å¼•ç”¨ä¾ç„¶å­˜åœ¨ï¼Œä¸æ»¡è¶³é¢˜ç›®è¦æ±‚çš„é“¾è¡¨ç»“æ„ã€‚æ­£ç¡®çš„åšæ³•æ˜¯åœ¨ <code>node.Right = node.Left</code> ä¹‹åï¼Œç´§æ¥ç€æ‰§è¡Œ <code>node.Left = nil</code>ï¼Œå½»åº•æ–­å¼€å·¦å­æ ‘çš„è¿æ¥ã€‚</p>
</li>
<li>
<p><strong>ç¼ºå°‘å¯¹å¶å­èŠ‚ç‚¹çš„ç‰¹æ®Šå¤„ç†ï¼ˆä¼˜åŒ–ç¼ºå¤±ï¼‰</strong><br>
è™½ç„¶è¿™ä¸ç®—ä¸€ä¸ªå¯¼è‡´ç»“æœé”™è¯¯çš„ bugï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªé‡è¦çš„<strong>ä¼˜åŒ–ç‚¹</strong>ã€‚å¶å­èŠ‚ç‚¹ï¼ˆ<code>node.Left == nil &amp;&amp; node.Right == nil</code>ï¼‰æ˜¯é€’å½’çš„æœ€å°å•å…ƒï¼Œå®ƒä»¬è‡ªèº«å°±æ˜¯å±•å¼€åçš„é“¾è¡¨çš„æœ«å°¾èŠ‚ç‚¹ã€‚åœ¨é”™è¯¯ä»£ç ä¸­ï¼Œå³ä½¿é‡åˆ°å¶å­èŠ‚ç‚¹ï¼Œä»ç„¶ä¼šç»§ç»­é€’å½’è°ƒç”¨ <code>dfsFlatten(nil)</code> ä¸¤æ¬¡ï¼Œç„¶åæ‰è¿”å›ã€‚æ­£ç¡®çš„è§£æ³•ä¸­å¢åŠ äº† <code>if node.Left == nil &amp;&amp; node.Right == nil &#123; return node &#125;</code> çš„åˆ¤æ–­ï¼Œå¯ä»¥ç›´æ¥è¿”å›å¶å­èŠ‚ç‚¹æœ¬èº«ï¼Œé¿å…äº†ä¸å¿…è¦çš„é€’å½’è°ƒç”¨ï¼Œæé«˜äº†æ•ˆç‡ã€‚</p>
</li>
<li>
<p><strong>è¿”å›å€¼é€»è¾‘é”™è¯¯ (<code>rightEnd == nil</code> çš„æƒ…å†µ)</strong><br>
è¿™æ˜¯æœ€å…³é”®çš„é€»è¾‘é”™è¯¯ã€‚<code>dfsFlatten</code> å‡½æ•°çš„å®šä¹‰æ˜¯ï¼šä¼ å…¥ä¸€ä¸ªå­æ ‘çš„æ ¹èŠ‚ç‚¹ <code>node</code>ï¼Œå°†å…¶åŸåœ°å±•å¼€ä¸ºé“¾è¡¨ï¼Œå¹¶è¿”å›è¿™ä¸ª<strong>å±•å¼€åé“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</strong>ã€‚</p>
<ul>
<li>å½“ <code>rightEnd == nil</code> æ—¶ï¼Œæ„å‘³ç€å½“å‰èŠ‚ç‚¹ <code>node</code> æ²¡æœ‰å³å­æ ‘ï¼ˆæˆ–è€…å³å­æ ‘é€’å½’å±•å¼€åè¿”å› <code>nil</code>ï¼‰ã€‚</li>
<li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ <code>leftEnd != nil</code>ï¼ˆå³å­˜åœ¨å·¦å­æ ‘ä¸”å·²å±•å¼€ï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®å…ˆåºéå†çš„é¡ºåºï¼Œ<code>node</code> ä¹‹ååº”è¯¥è¿æ¥çš„æ˜¯å±•å¼€åçš„å·¦å­æ ‘ã€‚å› æ­¤ï¼Œæ•´ä¸ªä»¥ <code>node</code> ä¸ºæ ¹çš„å±•å¼€é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±åº”è¯¥æ˜¯å…¶å·¦å­æ ‘å±•å¼€åçš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³ <code>leftEnd</code>ã€‚</li>
<li>æˆ‘çš„é”™è¯¯ä»£ç ä¸­è¿”å›äº† <code>node</code>ã€‚è¿™åœ¨åªæœ‰å·¦å­æ ‘çš„æƒ…å†µä¸‹æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º <code>node</code> å¹¶ä¸æ˜¯å±•å¼€åé“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>å¦‚æœ <code>leftEnd == nil</code>ï¼ˆå·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼‰ï¼Œæ­¤æ—¶ <code>node</code> æœ¬èº«å°±æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚çœ‹èµ·æ¥è¿”å› <code>node</code> ä¼¼ä¹æ˜¯å¯¹çš„ã€‚ä½†æ˜¯ï¼Œè¿™ç§æƒ…å†µå…¶å®å·²ç»è¢«ç¬¬ 2 ç‚¹æåˆ°çš„å¶å­èŠ‚ç‚¹åˆ¤æ–­è¦†ç›–äº†ï¼ˆåœ¨æ­£ç¡®è§£æ³•ä¸­ï¼‰ã€‚åœ¨é”™è¯¯è§£æ³•ä¸­ï¼Œç”±äºç¼ºå°‘å¶å­èŠ‚ç‚¹åˆ¤æ–­ï¼Œå³ä½¿å·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼Œä¹Ÿä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œå¹¶é”™è¯¯åœ°è¿”å› <code>node</code>ï¼Œä½†è¿™æ°å¥½åœ¨â€œå¶å­èŠ‚ç‚¹â€è¿™ä¸ªç‰¹å®šåœºæ™¯ä¸‹å¾—åˆ°äº†â€œæ­£ç¡®â€çš„ç»“æœï¼Œæ©ç›–äº†é€»è¾‘æœ¬èº«çš„ç¼ºé™·ã€‚æ­£ç¡®çš„é€»è¾‘åº”è¯¥æ˜¯ï¼Œå½“ <code>rightEnd == nil</code> æ—¶ï¼Œæ— è®º <code>leftEnd</code> æ˜¯å¦ä¸º <code>nil</code>ï¼Œéƒ½åº”è¯¥è¿”å› <code>leftEnd</code>ï¼ˆå› ä¸ºå¦‚æœ <code>leftEnd</code> ä¸º <code>nil</code>ï¼Œè¿”å› <code>nil</code> ä¹Ÿæ˜¯ç¬¦åˆé€»è¾‘çš„ï¼Œè™½ç„¶ä¼šè¢«å¶å­èŠ‚ç‚¹ä¼˜åŒ–è¦†ç›–ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h4 id="ç¤ºä¾‹è¿½è¸ª">ç¤ºä¾‹è¿½è¸ª</h4>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ <code>[1, 2, null, 3, 4]</code> æ¥è¿½è¸ªé”™è¯¯ä»£ç çš„æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    1</span><br><span class="line">   /</span><br><span class="line">  2</span><br><span class="line"> / \</span><br><span class="line">3   4</span><br></pre></td></tr></table></figure>
<p>æœŸæœ›è¾“å‡º: <code>1 -&gt; 2 -&gt; 3 -&gt; 4</code> (æ‰€æœ‰å·¦æŒ‡é’ˆä¸º nil)</p>
<p><strong>é”™è¯¯ä»£ç è¿½è¸ª:</strong></p>
<ol>
<li><code>dfsFlatten(1)</code>
<ul>
<li><code>dfsFlatten(2)</code>
<ul>
<li><code>dfsFlatten(3)</code>: (å¶å­) -&gt; <strong>é”™è¯¯è¿”å› node 3</strong></li>
<li><code>dfsFlatten(4)</code>: (å¶å­) -&gt; <strong>é”™è¯¯è¿”å› node 4</strong></li>
<li>å¤„ç† node 2:
<ul>
<li><code>leftEnd = 3</code>, <code>rightEnd = 4</code></li>
<li><code>3.Right = 2.Right</code> (node 2 åŸå³å­èŠ‚ç‚¹ 4) =&gt; <code>3.Right = 4</code></li>
<li><code>2.Right = 2.Left</code> (node 2 åŸå·¦å­èŠ‚ç‚¹ 3) =&gt; <code>2.Right = 3</code></li>
<li><strong>é—æ¼ <code>2.Left = nil</code></strong></li>
<li>è¿”å› <code>rightEnd</code> (node 4)</li>
</ul>
</li>
</ul>
</li>
<li><code>leftEnd = 4</code> (æ¥è‡ª <code>dfsFlatten(2)</code>)</li>
<li><code>dfsFlatten(nil)</code> (node 1 çš„å³å­èŠ‚ç‚¹) -&gt; è¿”å› <code>nil</code></li>
<li><code>rightEnd = nil</code></li>
<li>å¤„ç† node 1:
<ul>
<li><code>leftEnd = 4</code>, <code>rightEnd = nil</code></li>
<li><code>4.Right = 1.Right</code> (nil) =&gt; <code>4.Right = nil</code></li>
<li><code>1.Right = 1.Left</code> (node 2) =&gt; <code>1.Right = 2</code></li>
<li><strong>é—æ¼ <code>1.Left = nil</code></strong></li>
<li><code>rightEnd == nil</code> -&gt; <strong>é”™è¯¯è¿”å› <code>node</code> (node 1)</strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>æœ€ç»ˆç»“æœ:</strong> å‡½æ•°è¿”å› <code>node 1</code>ï¼Œä½†é“¾è¡¨ç»“æ„æ˜¯é”™è¯¯çš„ï¼š<code>1</code> çš„ <code>Left</code> ä»ç„¶æŒ‡å‘ <code>2</code>ï¼Œ<code>2</code> çš„ <code>Left</code> ä»ç„¶æŒ‡å‘ <code>3</code>ã€‚æ­¤å¤–ï¼Œç”±äºè¿”å›å€¼é”™è¯¯ï¼Œå¦‚æœä¸Šå±‚è¿˜æœ‰è°ƒç”¨ï¼Œä¹Ÿä¼šåŸºäºé”™è¯¯çš„æœ«å°¾èŠ‚ç‚¹ä¿¡æ¯ç»§ç»­æ‹¼æ¥ï¼Œå¯¼è‡´é“¾è¡¨ç»“æ„æ··ä¹±ã€‚</p>
<h2 id="æ­£ç¡®è§£æ³•">æ­£ç¡®è§£æ³•</h2>
<p>ç»è¿‡åˆ†æï¼Œæˆ‘æ”¹è¿›çš„è§£æ³•æ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsFlatten</span><span class="params">(node *TreeNode)</span></span> *TreeNode &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> node.Left == <span class="literal">nil</span> &amp;&amp; node.Right == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    leftEnd := dfsFlatten(node.Left)</span><br><span class="line">    rightEnd := dfsFlatten(node.Right)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> leftEnd != <span class="literal">nil</span> &#123;</span><br><span class="line">        leftEnd.Right = node.Right</span><br><span class="line">        node.Right = node.Left</span><br><span class="line">        node.Left = <span class="literal">nil</span>  <span class="comment">// ç¡®ä¿å·¦æŒ‡é’ˆè®¾ä¸ºnull</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> rightEnd == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> leftEnd  <span class="comment">// å¦‚æœå³å­æ ‘ä¸ºç©ºï¼Œè¿”å›leftEnd</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> rightEnd</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ">ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ</h3>
<ol>
<li>
<p><strong>æ­£ç¡®å¤„ç†å·¦å­æŒ‡é’ˆ</strong>ï¼šå°† <code>node.Left = nil</code> ç¡®ä¿äº†å±•å¼€åçš„é“¾è¡¨å·¦å­æŒ‡é’ˆå§‹ç»ˆä¸ºnullã€‚</p>
</li>
<li>
<p><strong>å¶å­èŠ‚ç‚¹ä¼˜åŒ–</strong>ï¼šæ·»åŠ äº†å¯¹å¶å­èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå¯ä»¥æå‰è¿”å›ï¼Œå‡å°‘ä¸å¿…è¦çš„å¤„ç†ã€‚</p>
</li>
<li>
<p><strong>è¿”å›å€¼é€»è¾‘æ­£ç¡®</strong>ï¼š</p>
<ul>
<li>å½“å³å­æ ‘å­˜åœ¨æ—¶ï¼Œè¿”å›å³å­æ ‘å±•å¼€åçš„æœ«å°¾èŠ‚ç‚¹</li>
<li>å½“å³å­æ ‘ä¸ºç©ºæ—¶ï¼Œè¿”å›å·¦å­æ ‘å±•å¼€åçš„æœ«å°¾èŠ‚ç‚¹</li>
<li>å½“å·¦å³å­æ ‘éƒ½ä¸ºç©ºæ—¶ï¼Œè¿”å›èŠ‚ç‚¹æœ¬èº«</li>
</ul>
</li>
</ol>
<h2 id="è¿›ä¸€æ­¥ä¼˜åŒ–ç‰ˆæœ¬-span-style-color-ff6b6b-font-size-0-8em-v2-0-æ–°å¢-span">è¿›ä¸€æ­¥ä¼˜åŒ–ç‰ˆæœ¬ <span style="color: #ff6b6b; font-size: 0.8em;">[v2.0 æ–°å¢]</span></h2>
<p>åœ¨æ·±å…¥ç†è§£é—®é¢˜åï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€ä¸ªæ›´æ¸…æ™°çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">flatten</span><span class="params">(root *TreeNode)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(root *TreeNode)</span></span> *TreeNode</span><br><span class="line">    dfs = <span class="function"><span class="keyword">func</span><span class="params">(root *TreeNode)</span></span> *TreeNode &#123;</span><br><span class="line">        <span class="comment">// ç©ºèŠ‚ç‚¹æˆ–å¶å­èŠ‚ç‚¹ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> root == <span class="literal">nil</span> || (root.Left == <span class="literal">nil</span> &amp;&amp; root.Right == <span class="literal">nil</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¿å­˜åŸå§‹å³å­æ ‘</span></span><br><span class="line">        tmpRight := root.Right</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…ˆå¤„ç†å·¦å­æ ‘</span></span><br><span class="line">        leftLast := dfs(root.Left)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœå·¦å­æ ‘å­˜åœ¨ï¼Œè¿›è¡Œè¿æ¥æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> leftLast != <span class="literal">nil</span> &#123;</span><br><span class="line">            leftLast.Right = root.Right    <span class="comment">// å·¦å­æ ‘çš„æœ«å°¾è¿æ¥åˆ°åŸå³å­æ ‘</span></span><br><span class="line">            root.Right = root.Left         <span class="comment">// å·¦å­æ ‘ç§»åˆ°å³è¾¹</span></span><br><span class="line">            root.Left = <span class="literal">nil</span>                <span class="comment">// æ¸…ç©ºå·¦å­æ ‘</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœåŸæ¥æ²¡æœ‰å³å­æ ‘ï¼Œè¿”å›å·¦å­æ ‘çš„æœ«å°¾</span></span><br><span class="line">        <span class="keyword">if</span> tmpRight == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> leftLast</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¤„ç†åŸå³å­æ ‘ï¼Œè¿”å›å…¶æœ«å°¾èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> dfs(tmpRight)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    dfs(root)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¼˜åŒ–ç‰ˆæœ¬çš„æ ¸å¿ƒæ€æƒ³">ä¼˜åŒ–ç‰ˆæœ¬çš„æ ¸å¿ƒæ€æƒ³</h3>
<ol>
<li><strong>åˆ†ç¦»å¤„ç†</strong>ï¼šå…ˆå¤„ç†å·¦å­æ ‘ï¼Œå®Œæˆå·¦å­æ ‘çš„è¿æ¥æ“ä½œï¼Œå†å¤„ç†å³å­æ ‘</li>
<li><strong>ä¿å­˜å¼•ç”¨</strong>ï¼šä½¿ç”¨ <code>tmpRight</code> ä¿å­˜åŸå§‹å³å­æ ‘ï¼Œé¿å…åœ¨è¿æ¥è¿‡ç¨‹ä¸­ä¸¢å¤±å¼•ç”¨</li>
<li><strong>æ¸…æ™°çš„é€»è¾‘æµç¨‹</strong>ï¼š
<ul>
<li>å¤„ç†å·¦å­æ ‘å¾—åˆ° <code>leftLast</code></li>
<li>å¦‚æœå·¦å­æ ‘å­˜åœ¨ï¼Œæ‰§è¡Œè¿æ¥æ“ä½œ</li>
<li>æ ¹æ®æ˜¯å¦æœ‰åŸå³å­æ ‘å†³å®šè¿”å›å€¼</li>
</ul>
</li>
</ol>
<h3 id="ä¸ä¹‹å‰è§£æ³•çš„å¯¹æ¯”">ä¸ä¹‹å‰è§£æ³•çš„å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>åˆå§‹é”™è¯¯è§£æ³•</th>
<th>ä¿®æ­£è§£æ³•</th>
<th>ä¼˜åŒ–ç‰ˆæœ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>å·¦å³å­æ ‘å¤„ç†</td>
<td>åŒæ—¶å¤„ç†</td>
<td>åŒæ—¶å¤„ç†</td>
<td>åˆ†ç¦»å¤„ç†</td>
</tr>
<tr>
<td>å³å­æ ‘å¼•ç”¨</td>
<td>ç›´æ¥ä½¿ç”¨</td>
<td>ç›´æ¥ä½¿ç”¨</td>
<td>æå‰ä¿å­˜</td>
</tr>
<tr>
<td>ä»£ç å¯è¯»æ€§</td>
<td>è¾ƒå·®</td>
<td>è‰¯å¥½</td>
<td>æ›´å¥½</td>
</tr>
<tr>
<td>é€»è¾‘æ¸…æ™°åº¦</td>
<td>æ··ä¹±</td>
<td>æ¸…æ™°</td>
<td>éå¸¸æ¸…æ™°</td>
</tr>
</tbody>
</table>
<h3 id="æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹">æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹</h3>
<p>ä»¥æ ‘ <code>[1,2,5,3,4,null,6]</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   5</span><br><span class="line"> / \   \</span><br><span class="line">3   4   6</span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜åŒ–ç‰ˆæœ¬æ‰§è¡Œæµç¨‹ï¼š</strong></p>
<ol>
<li>
<p><code>dfs(1)</code>:</p>
<ul>
<li><code>tmpRight = 5</code></li>
<li><code>leftLast = dfs(2)</code> è¿”å›èŠ‚ç‚¹4</li>
<li>è¿æ¥ï¼š<code>4.Right = 5</code>, <code>1.Right = 2</code>, <code>1.Left = nil</code></li>
<li><code>tmpRight != nil</code>ï¼Œè¿”å› <code>dfs(5)</code> çš„ç»“æœ</li>
</ul>
</li>
<li>
<p><code>dfs(2)</code>:</p>
<ul>
<li><code>tmpRight = null</code></li>
<li><code>leftLast = dfs(3)</code> è¿”å›èŠ‚ç‚¹3</li>
<li>è¿æ¥ï¼š<code>3.Right = null</code>, <code>2.Right = 3</code>, <code>2.Left = nil</code></li>
<li><code>tmpRight == nil</code>ï¼Œè¿”å› <code>leftLast</code> (èŠ‚ç‚¹3)</li>
<li>ä½†è¿˜è¦å¤„ç†å³å­æ ‘4ï¼Œæœ€ç»ˆè¿”å›èŠ‚ç‚¹4</li>
</ul>
</li>
</ol>
<p>è¿™ä¸ªä¼˜åŒ–ç‰ˆæœ¬çš„é€»è¾‘æ›´åŠ ç›´è§‚ï¼Œä»£ç ä¹Ÿæ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚</p>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<ol>
<li>
<p><strong>ç»†èŠ‚å¾ˆé‡è¦</strong>ï¼šåœ¨æ ‘å’Œé“¾è¡¨ç›¸å…³é—®é¢˜ä¸­ï¼ŒæŒ‡é’ˆæ“ä½œçš„ç»†èŠ‚éå¸¸é‡è¦ï¼Œæ¼æ‰ä¸€æ­¥å¯èƒ½å¯¼è‡´æ•´ä¸ªç»“æ„é”™è¯¯ã€‚</p>
</li>
<li>
<p><strong>è¿”å›å€¼çš„å«ä¹‰è¦æ˜ç¡®</strong>ï¼šåœ¨é€’å½’å‡½æ•°ä¸­ï¼Œè¿”å›å€¼çš„å«ä¹‰å¿…é¡»æ¸…æ™°ä¸”ä¸€è‡´ã€‚æˆ‘æœ€åˆæ··æ·†äº†è¿”å›å€¼çš„å«ä¹‰ï¼Œå¯¼è‡´äº†é€»è¾‘é”™è¯¯ã€‚</p>
</li>
<li>
<p><strong>å¤šæ€è€ƒè¾¹ç•Œæƒ…å†µ</strong>ï¼šå¶å­èŠ‚ç‚¹ã€ç©ºèŠ‚ç‚¹ç­‰è¾¹ç•Œæƒ…å†µéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p>
</li>
<li>
<p><strong>å‰åºæ€è€ƒ</strong>ï¼šåœ¨ç¼–å†™é€’å½’å‡½æ•°å‰ï¼Œåº”è¯¥å…ˆæ˜ç¡®å‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„å…·ä½“å«ä¹‰ï¼Œå¹¶ç¡®ä¿æ•´ä¸ªé€’å½’è¿‡ç¨‹ä¸­è¿™ä¸ªå«ä¹‰ä¿æŒä¸€è‡´ã€‚</p>
</li>
<li>
<p><strong>åˆ†ç¦»å¤æ‚é€»è¾‘</strong>ï¼šå½“å¤„ç†é€»è¾‘è¾ƒå¤æ‚æ—¶ï¼Œå¯ä»¥è€ƒè™‘åˆ†ç¦»å¤„ç†ï¼Œå¦‚ä¼˜åŒ–ç‰ˆæœ¬ä¸­å…ˆå¤„ç†å·¦å­æ ‘å†å¤„ç†å³å­æ ‘çš„æ–¹å¼ã€‚</p>
</li>
<li>
<p><strong>ä¿æŠ¤é‡è¦å¼•ç”¨</strong>ï¼šåœ¨è¿›è¡ŒæŒ‡é’ˆæ“ä½œæ—¶ï¼Œè¦æ³¨æ„ä¿æŠ¤å¯èƒ½è¢«ä¿®æ”¹çš„é‡è¦å¼•ç”¨ï¼Œé¿å…åœ¨æ“ä½œè¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ¨¡æ‹Ÿ</category>
      </categories>
      <tags>
        <tag>é€’å½’</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>æ ‘</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 230 - äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ ï¼ˆKth Smallest Element in a BSTï¼‰</title>
    <url>/2025/04/29/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-230-Kth-Smallest-Element-in-BST/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œå’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªç®—æ³•æŸ¥æ‰¾å…¶ä¸­ç¬¬ k å°çš„å…ƒç´ ï¼ˆä» 1 å¼€å§‹è®¡æ•°ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [3,1,4,null,2], k = 1</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [5,3,6,2,4,null,null,1], k = 3</span><br><span class="line">è¾“å‡ºï¼š3</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ä¸º n ã€‚</li>
<li>1 &lt;= k &lt;= n &lt;= 10^4</li>
<li>0 &lt;= Node.val &lt;= 10^4</li>
</ul>
<p><strong>è¿›é˜¶ï¼š</strong> å¦‚æœäºŒå‰æœç´¢æ ‘ç»å¸¸è¢«ä¿®æ”¹ï¼ˆæ’å…¥/åˆ é™¤æ“ä½œï¼‰å¹¶ä¸”ä½ éœ€è¦é¢‘ç¹åœ°æŸ¥æ‰¾ç¬¬ k å°çš„å€¼ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ç®—æ³•ï¼Ÿ</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜è¦æ±‚æˆ‘ä»¬æ‰¾åˆ°äºŒå‰æœç´¢æ ‘ä¸­ç¬¬ k å°çš„å…ƒç´ ï¼Œæœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥è§£å†³ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šä¸­åºéå†ï¼ˆé€’å½’æ³•ï¼‰">æ–¹æ³•ä¸€ï¼šä¸­åºéå†ï¼ˆé€’å½’æ³•ï¼‰</h3>
<p>äºŒå‰æœç´¢æ ‘çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯ï¼š<strong>ä¸­åºéå†çš„ç»“æœæ˜¯æŒ‰ç…§èŠ‚ç‚¹å€¼ä»å°åˆ°å¤§æ’åˆ—çš„</strong>ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸­åºéå†å¾—åˆ°æ ‘ä¸­æ‰€æœ‰å…ƒç´ çš„æœ‰åºåºåˆ—ï¼Œç„¶åå–ç¬¬ k ä¸ªå…ƒç´ å³å¯ã€‚</p>
<p>å…·ä½“æ­¥éª¤ï¼š</p>
<ol>
<li>å¯¹æ ‘è¿›è¡Œä¸­åºéå†ï¼ˆå·¦ â†’ æ ¹ â†’ å³ï¼‰</li>
<li>ä½¿ç”¨è®¡æ•°å™¨è®°å½•å½“å‰è®¿é—®çš„æ˜¯ç¬¬å‡ ä¸ªèŠ‚ç‚¹</li>
<li>å½“è®¡æ•°å™¨ç­‰äº k æ—¶ï¼Œè¿”å›å½“å‰èŠ‚ç‚¹çš„å€¼</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„å…³é”®åœ¨äºç†è§£äºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†æ€§è´¨ï¼Œä»¥åŠå¦‚ä½•åœ¨éå†è¿‡ç¨‹ä¸­åŠæ—¶åœæ­¢ä»¥æé«˜æ•ˆç‡ã€‚</p>
<h3 id="æ–¹æ³•äºŒï¼šä¸­åºéå†ï¼ˆè¿­ä»£æ³•ï¼‰">æ–¹æ³•äºŒï¼šä¸­åºéå†ï¼ˆè¿­ä»£æ³•ï¼‰</h3>
<p>ä¸Šè¿°é€’å½’æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨è¿­ä»£çš„æ–¹å¼å®ç°ï¼Œä½¿ç”¨æ ˆæ¥æ¨¡æ‹Ÿé€’å½’è¿‡ç¨‹ã€‚è¿™ç§æ–¹æ³•åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ›´é«˜æ•ˆï¼Œç‰¹åˆ«æ˜¯å½“ k å¾ˆå°è€Œæ ‘å¾ˆå¤§æ—¶ã€‚</p>
<h3 id="æ–¹æ³•ä¸‰ï¼šè®¡æ•°ä¼˜åŒ–ï¼ˆé’ˆå¯¹è¿›é˜¶é—®é¢˜ï¼‰">æ–¹æ³•ä¸‰ï¼šè®¡æ•°ä¼˜åŒ–ï¼ˆé’ˆå¯¹è¿›é˜¶é—®é¢˜ï¼‰</h3>
<p>å¯¹äºè¿›é˜¶é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•åœ¨é¢‘ç¹ä¿®æ”¹çš„æƒ…å†µä¸‹é«˜æ•ˆæŸ¥æ‰¾ç¬¬ k å°çš„å…ƒç´ ã€‚ä¸€ç§ä¼˜åŒ–æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŠ¤é¢å¤–ä¿¡æ¯ï¼š<strong>ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡</strong>ã€‚è¿™æ ·å¯ä»¥åœ¨ O(log n) çš„æ—¶é—´å¤æ‚åº¦å†…æ‰¾åˆ°ç¬¬ k å°çš„å…ƒç´ ã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šä¸­åºéå†ï¼ˆé€’å½’æ³•ï¼‰-2">æ–¹æ³•ä¸€ï¼šä¸­åºéå†ï¼ˆé€’å½’æ³•ï¼‰</h3>
<p>é€’å½’è§£æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æŒ‰é¡ºåºè®¿é—®èŠ‚ç‚¹å¹¶è®¡æ•°ï¼š</p>
<ol>
<li>å…ˆéå†å·¦å­æ ‘</li>
<li>é€’å¢è®¡æ•°å™¨ï¼Œæ£€æŸ¥æ˜¯å¦è¾¾åˆ° k</li>
<li>å¦‚æœè¾¾åˆ° kï¼Œè¿”å›å½“å‰èŠ‚ç‚¹å€¼</li>
<li>å¦åˆ™ç»§ç»­éå†å³å­æ ‘</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„å®ç°ç®€æ´ï¼Œä¸”èƒ½åœ¨æ‰¾åˆ°ç›®æ ‡åç«‹å³è¿”å›ï¼Œä¸éœ€è¦éå†æ•´æ£µæ ‘ã€‚</p>
<h3 id="æ–¹æ³•äºŒï¼šä¸­åºéå†ï¼ˆè¿­ä»£æ³•ï¼‰-2">æ–¹æ³•äºŒï¼šä¸­åºéå†ï¼ˆè¿­ä»£æ³•ï¼‰</h3>
<p>è¿­ä»£è§£æ³•ä½¿ç”¨æ ˆæ¥æ¨¡æ‹Ÿé€’å½’è¿‡ç¨‹ï¼š</p>
<ol>
<li>ä½¿ç”¨æ ˆè®°å½•éå†è·¯å¾„</li>
<li>ä¸æ–­å°†å·¦å­èŠ‚ç‚¹å…¥æ ˆï¼Œç›´åˆ°æ²¡æœ‰å·¦å­èŠ‚ç‚¹</li>
<li>å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ï¼Œé€’å¢è®¡æ•°å™¨</li>
<li>æ£€æŸ¥è®¡æ•°å™¨æ˜¯å¦ç­‰äº kï¼Œæ˜¯åˆ™è¿”å›å½“å‰èŠ‚ç‚¹å€¼</li>
<li>å¤„ç†å³å­èŠ‚ç‚¹</li>
</ol>
<h3 id="æ–¹æ³•ä¸‰ï¼šèŠ‚ç‚¹è®¡æ•°ä¼˜åŒ–">æ–¹æ³•ä¸‰ï¼šèŠ‚ç‚¹è®¡æ•°ä¼˜åŒ–</h3>
<p>å¯¹äºè¿›é˜¶é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>æ‰©å±•æ ‘èŠ‚ç‚¹ç»“æ„ï¼Œæ·»åŠ  count å­—æ®µè¡¨ç¤ºå·¦å­æ ‘èŠ‚ç‚¹æ•°é‡</li>
<li>æ’å…¥/åˆ é™¤èŠ‚ç‚¹æ—¶æ›´æ–° count å€¼</li>
<li>æŸ¥æ‰¾ç¬¬ k å°å…ƒç´ æ—¶ï¼Œæ ¹æ® count å€¼å†³å®šå‘å·¦è¿˜æ˜¯å‘å³å­æ ‘ç§»åŠ¨</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šä¸­åºéå†ï¼ˆé€’å½’æ³•ï¼‰-3">æ–¹æ³•ä¸€ï¼šä¸­åºéå†ï¼ˆé€’å½’æ³•ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">kthSmallest</span><span class="params">(root *TreeNode, k <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    cnt := <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> dfsKthSmallest(root, k, &amp;cnt)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsKthSmallest</span><span class="params">(node *TreeNode, k <span class="type">int</span>, cnt *<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å…ˆéå†å·¦å­æ ‘</span></span><br><span class="line">    leftRes := dfsKthSmallest(node.Left, k, cnt)</span><br><span class="line">    <span class="keyword">if</span> leftRes != <span class="number">-1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> leftRes</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è®¿é—®å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    *cnt++</span><br><span class="line">    <span class="keyword">if</span> *cnt == k &#123;</span><br><span class="line">        <span class="keyword">return</span> node.Val</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// éå†å³å­æ ‘</span></span><br><span class="line">    <span class="keyword">return</span> dfsKthSmallest(node.Right, k, cnt)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šä¸­åºéå†ï¼ˆè¿­ä»£æ³•ï¼‰-3">æ–¹æ³•äºŒï¼šä¸­åºéå†ï¼ˆè¿­ä»£æ³•ï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">kthSmallest</span><span class="params">(root *TreeNode, k <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    stack := []*TreeNode&#123;&#125;</span><br><span class="line">    curr := root</span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> curr != <span class="literal">nil</span> || <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// å°†æ‰€æœ‰å·¦å­èŠ‚ç‚¹å…¥æ ˆ</span></span><br><span class="line">        <span class="keyword">for</span> curr != <span class="literal">nil</span> &#123;</span><br><span class="line">            stack = <span class="built_in">append</span>(stack, curr)</span><br><span class="line">            curr = curr.Left</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹</span></span><br><span class="line">        curr = stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">        stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// è®¡æ•°</span></span><br><span class="line">        count++</span><br><span class="line">        <span class="keyword">if</span> count == k &#123;</span><br><span class="line">            <span class="keyword">return</span> curr.Val</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¤„ç†å³å­èŠ‚ç‚¹</span></span><br><span class="line">        curr = curr.Right</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šèŠ‚ç‚¹è®¡æ•°ä¼˜åŒ–ï¼ˆè¿›é˜¶é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼‰">æ–¹æ³•ä¸‰ï¼šèŠ‚ç‚¹è®¡æ•°ä¼˜åŒ–ï¼ˆè¿›é˜¶é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼‰</h3>
<p>ä¸ºäº†è§£å†³è¿›é˜¶é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªå¢å¼ºç‰ˆçš„äºŒå‰æœç´¢æ ‘ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¢å¼ºçš„æ ‘èŠ‚ç‚¹ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> EnhancedTreeNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    Val       <span class="type">int</span></span><br><span class="line">    Left      *EnhancedTreeNode</span><br><span class="line">    Right     *EnhancedTreeNode</span><br><span class="line">    LeftCount <span class="type">int</span>  <span class="comment">// å·¦å­æ ‘èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">insert</span><span class="params">(root *EnhancedTreeNode, val <span class="type">int</span>)</span></span> *EnhancedTreeNode &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &amp;EnhancedTreeNode&#123;Val: val&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> val &lt; root.Val &#123;</span><br><span class="line">        root.Left = insert(root.Left, val)</span><br><span class="line">        root.LeftCount++</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        root.Right = insert(root.Right, val)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥æ‰¾ç¬¬kå°çš„å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findKthSmallest</span><span class="params">(root *EnhancedTreeNode, k <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å½“å‰èŠ‚ç‚¹çš„æ’å = å·¦å­æ ‘èŠ‚ç‚¹æ•° + 1</span></span><br><span class="line">    leftSize := root.LeftCount</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> k == leftSize + <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root.Val</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> k &lt;= leftSize &#123;</span><br><span class="line">        <span class="comment">// ç¬¬kå°çš„å…ƒç´ åœ¨å·¦å­æ ‘ä¸­</span></span><br><span class="line">        <span class="keyword">return</span> findKthSmallest(root.Left, k)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ç¬¬kå°çš„å…ƒç´ åœ¨å³å­æ ‘ä¸­ï¼Œéœ€è¦è°ƒæ•´kå€¼</span></span><br><span class="line">        <span class="keyword">return</span> findKthSmallest(root.Right, k - leftSize - <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>ä¸­åºéå†ï¼ˆé€’å½’ï¼‰</th>
<th>ä¸­åºéå†ï¼ˆè¿­ä»£ï¼‰</th>
<th>èŠ‚ç‚¹è®¡æ•°ä¼˜åŒ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(log n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(h)</td>
<td>O(h)</td>
<td>O(h)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç®€å•ç›´è§‚</td>
<td>é¿å…é€’å½’æ ˆæº¢å‡ºé£é™©</td>
<td>é¢‘ç¹æŸ¥è¯¢æ—¶æ•ˆç‡é«˜</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>é€’å½’å±‚æ•°æ·±æ—¶å¯èƒ½æ ˆæº¢å‡º</td>
<td>ä»£ç ç¨å¤æ‚</td>
<td>éœ€è¦ä¿®æ”¹èŠ‚ç‚¹ç»“æ„ï¼Œç»´æŠ¤æˆæœ¬é«˜</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>ä¸€èˆ¬æŸ¥è¯¢åœºæ™¯</td>
<td>æ ‘è¾ƒæ·±æ—¶çš„æŸ¥è¯¢</td>
<td>é¢‘ç¹ä¿®æ”¹å’ŒæŸ¥è¯¢</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…ï¼ˆé’ˆå¯¹è¿›é˜¶é—®é¢˜ï¼‰</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ–¹æ³•ä¸€å’Œæ–¹æ³•äºŒï¼ˆä¸­åºéå†ï¼‰ï¼š">æ–¹æ³•ä¸€å’Œæ–¹æ³•äºŒï¼ˆä¸­åºéå†ï¼‰ï¼š</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œæœ€åæƒ…å†µä¸‹éœ€è¦éå†æ•´æ£µæ ‘ï¼Œä½†å¹³å‡æƒ…å†µä¸‹ä¸º O(h + k)ï¼Œå…¶ä¸­ h æ˜¯æ ‘çš„é«˜åº¦ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(h)ï¼Œh æ˜¯æ ‘çš„é«˜åº¦ï¼Œé€’å½’è°ƒç”¨æ ˆæˆ–è¿­ä»£æ–¹æ³•ä¸­çš„æ ˆç©ºé—´ã€‚</li>
</ul>
<h3 id="æ–¹æ³•ä¸‰ï¼ˆèŠ‚ç‚¹è®¡æ•°ä¼˜åŒ–ï¼‰ï¼š">æ–¹æ³•ä¸‰ï¼ˆèŠ‚ç‚¹è®¡æ•°ä¼˜åŒ–ï¼‰ï¼š</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š
<ul>
<li>æŸ¥è¯¢ï¼šO(log n)ï¼Œæ¯æ¬¡æŸ¥è¯¢åªéœ€è¦éå†ä¸€æ¡ä»æ ¹åˆ°å¶çš„è·¯å¾„ã€‚</li>
<li>æ’å…¥/åˆ é™¤ï¼šO(log n)ï¼ŒåŒæ—¶éœ€è¦æ›´æ–°è·¯å¾„ä¸ŠèŠ‚ç‚¹çš„è®¡æ•°ã€‚</li>
</ul>
</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(h)ï¼Œh æ˜¯æ ‘çš„é«˜åº¦ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>åˆ©ç”¨äºŒå‰æœç´¢æ ‘çš„ç‰¹æ€§</strong>ï¼šä¸­åºéå†äºŒå‰æœç´¢æ ‘å¯ä»¥å¾—åˆ°æœ‰åºåºåˆ—ï¼Œè¿™æ˜¯è§£å†³è®¸å¤šäºŒå‰æœç´¢æ ‘é—®é¢˜çš„å…³é”®ã€‚</li>
<li><strong>æ•°æ®ç»“æ„å¢å¼º</strong>ï¼šé€šè¿‡åœ¨èŠ‚ç‚¹ä¸­å­˜å‚¨é¢å¤–ä¿¡æ¯ï¼ˆå¦‚å­æ ‘èŠ‚ç‚¹æ•°é‡ï¼‰ï¼Œå¯ä»¥æ˜¾è‘—ä¼˜åŒ–ç‰¹å®šæ“ä½œçš„æ€§èƒ½ã€‚è¿™æ˜¯è§£å†³è¿›é˜¶é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ã€‚</li>
<li><strong>æƒè¡¡å–èˆ</strong>ï¼šæ–¹æ³•ä¸‰é€šè¿‡å¢åŠ å­˜å‚¨ç©ºé—´å’Œç»´æŠ¤æˆæœ¬ï¼Œæ¢å–æŸ¥è¯¢æ—¶é—´çš„ä¼˜åŒ–ï¼Œè¿™åœ¨é¢‘ç¹æ“ä½œçš„åœºæ™¯ä¸‹æ˜¯å€¼å¾—çš„ã€‚</li>
<li><strong>é€’å½’ä¸è¿­ä»£</strong>ï¼šåŒä¸€ç®—æ³•æ—¢å¯ä»¥ç”¨é€’å½’å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨è¿­ä»£å®ç°ï¼Œä¸åŒåœºæ™¯ä¸‹å¯èƒ½æœ‰ä¸åŒçš„ä¼˜åŠ¿ã€‚</li>
</ol>
<p>ç›¸å…³é—®é¢˜ï¼š</p>
<ul>
<li>LeetCode 98: éªŒè¯äºŒå‰æœç´¢æ ‘</li>
<li>LeetCode 173: äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨</li>
<li>LeetCode 235: äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>é€’å½’</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>äºŒå‰æœç´¢æ ‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆ MySQL é‡‡ç”¨ B+ æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ</title>
    <url>/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/</url>
    <content><![CDATA[<h1>ä¸ºä»€ä¹ˆ MySQL é‡‡ç”¨ B+ æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ</h1>
<p>è¦è§£é‡Šè¿™ä¸ªé—®é¢˜ï¼Œå…¶å®ä¸å•å•è¦ä»æ•°æ®ç»“æ„çš„è§’åº¦å‡ºå‘ï¼Œè¿˜è¦è€ƒè™‘ç£ç›˜ I/O æ“ä½œæ¬¡æ•°ï¼Œå› ä¸º MySQL çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„å˜›ã€‚</p>
<h2 id="æ€æ ·çš„ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯å¥½çš„ï¼Ÿ">æ€æ ·çš„ç´¢å¼•çš„æ•°æ®ç»“æ„æ˜¯å¥½çš„ï¼Ÿ</h2>
<p>MySQL çš„æ•°æ®æ˜¯æŒä¹…åŒ–çš„ï¼Œæ„å‘³ç€æ•°æ®ï¼ˆç´¢å¼• + è®°å½•ï¼‰æ˜¯ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„ï¼Œå› ä¸ºè¿™æ ·å³ä½¿è®¾å¤‡æ–­ç”µäº†ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>
<p>ç£ç›˜æ˜¯ä¸€ä¸ªæ…¢çš„ç¦»è°±çš„å­˜å‚¨è®¾å¤‡ï¼Œæœ‰å¤šç¦»è°±å‘¢ï¼Ÿ</p>
<p>äººå®¶å†…å­˜çš„è®¿é—®é€Ÿåº¦æ˜¯çº³ç§’çº§åˆ«çš„ï¼Œè€Œç£ç›˜è®¿é—®çš„é€Ÿåº¦æ˜¯æ¯«ç§’çº§åˆ«çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¯»å–åŒæ ·å¤§å°çš„æ•°æ®ï¼Œç£ç›˜ä¸­è¯»å–çš„é€Ÿåº¦æ¯”ä»å†…å­˜ä¸­è¯»å–çš„é€Ÿåº¦è¦æ…¢ä¸Šä¸‡å€ï¼Œç”šè‡³å‡ åä¸‡å€ã€‚</p>
<p>ç£ç›˜è¯»å†™çš„æœ€å°å•ä½æ˜¯<strong>æ‰‡åŒº</strong>ï¼Œæ‰‡åŒºçš„å¤§å°åªæœ‰ <code>512B</code> å¤§å°ï¼Œæ“ä½œç³»ç»Ÿä¸€æ¬¡ä¼šè¯»å†™å¤šä¸ªæ‰‡åŒºï¼Œæ‰€ä»¥<strong>æ“ä½œç³»ç»Ÿçš„æœ€å°è¯»å†™å•ä½æ˜¯å—ï¼ˆBlockï¼‰ã€‚Linux ä¸­çš„å—å¤§å°ä¸º <code>4KB</code></strong>ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡ç£ç›˜ I/O æ“ä½œä¼šç›´æ¥è¯»å†™ 8 ä¸ªæ‰‡åŒºã€‚</p>
<p>ç”±äºæ•°æ®åº“çš„ç´¢å¼•æ˜¯ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„ï¼Œå› æ­¤å½“æˆ‘ä»¬é€šè¿‡ç´¢å¼•æŸ¥æ‰¾æŸè¡Œæ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦å…ˆä»ç£ç›˜è¯»å–ç´¢å¼•åˆ°å†…å­˜ï¼Œå†é€šè¿‡ç´¢å¼•ä»ç£ç›˜ä¸­æ‰¾åˆ°æŸè¡Œæ•°æ®ï¼Œç„¶åè¯»å…¥åˆ°å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿå¤šæ¬¡ç£ç›˜ I/Oï¼Œè€Œç£ç›˜ I/O æ¬¡æ•°è¶Šå¤šï¼Œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¹Ÿå°±è¶Šå¤§ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸Œæœ›ç´¢å¼•çš„æ•°æ®ç»“æ„èƒ½åœ¨å°½å¯èƒ½å°‘çš„ç£ç›˜çš„ I/O æ“ä½œä¸­å®ŒæˆæŸ¥è¯¢å·¥ä½œï¼Œå› ä¸ºç£ç›˜ I/O æ“ä½œè¶Šå°‘ï¼Œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¹Ÿå°±è¶Šå°ã€‚</p>
<p>å¦å¤–ï¼ŒMySQL æ˜¯æ”¯æŒèŒƒå›´æŸ¥æ‰¾çš„ï¼Œæ‰€ä»¥ç´¢å¼•çš„æ•°æ®ç»“æ„ä¸ä»…è¦èƒ½é«˜æ•ˆåœ°æŸ¥è¯¢æŸä¸€ä¸ªè®°å½•ï¼Œè€Œä¸”ä¹Ÿè¦èƒ½é«˜æ•ˆåœ°æ‰§è¡ŒèŒƒå›´æŸ¥æ‰¾ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¦è®¾è®¡ä¸€ä¸ªé€‚åˆ MySQL ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œè‡³å°‘æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>èƒ½åœ¨å°½å¯èƒ½å°‘çš„ç£ç›˜çš„ I/O æ“ä½œä¸­å®ŒæˆæŸ¥è¯¢å·¥ä½œï¼›</li>
<li>è¦èƒ½é«˜æ•ˆåœ°æŸ¥è¯¢æŸä¸€ä¸ªè®°å½•ï¼Œä¹Ÿè¦èƒ½é«˜æ•ˆåœ°æ‰§è¡ŒèŒƒå›´æŸ¥æ‰¾ï¼›</li>
</ul>
<p>åˆ†æå®Œè¦æ±‚åï¼Œæˆ‘ä»¬é’ˆå¯¹æ¯ä¸€ä¸ªæ•°æ®ç»“æ„åˆ†æä¸€ä¸‹ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯äºŒåˆ†æŸ¥æ‰¾ï¼Ÿ">ä»€ä¹ˆæ˜¯äºŒåˆ†æŸ¥æ‰¾ï¼Ÿ</h2>
<p>ç´¢å¼•æ•°æ®æœ€å¥½èƒ½æŒ‰é¡ºåºæ’åˆ—ï¼Œè¿™æ ·å¯ä»¥ä½¿ç”¨ã€ŒäºŒåˆ†æŸ¥æ‰¾æ³•ã€é«˜æ•ˆå®šä½æ•°æ®ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ç°åœ¨ç”¨æ•°ç»„æ¥å­˜å‚¨ç´¢å¼•ï¼Œæ¯”å¦‚ä¸‹é¢æœ‰ä¸€ä¸ªæ’åºçš„æ•°ç»„ï¼Œå¦‚æœè¦ä»ä¸­æ‰¾å‡ºæ•°å­— 3ï¼Œæœ€ç®€å•åŠæ³•å°±æ˜¯ä»å¤´ä¾æ¬¡éå†æŸ¥è¯¢ï¼Œè¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼ŒæŸ¥è¯¢æ•ˆç‡å¹¶ä¸é«˜ã€‚å› ä¸ºè¯¥æ•°ç»„æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œæ¯”å¦‚ä¸‹é¢è¿™å¼ é‡‡ç”¨äºŒåˆ†æ³•çš„æŸ¥è¯¢è¿‡ç¨‹å›¾ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915426331.png" alt="1745915426331"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒäºŒåˆ†æŸ¥æ‰¾æ³•æ¯æ¬¡éƒ½æŠŠæŸ¥è¯¢çš„èŒƒå›´å‡åŠï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦å°±é™åˆ°äº† O(logn)ï¼Œä½†æ˜¯æ¯æ¬¡æŸ¥æ‰¾éƒ½éœ€è¦ä¸æ–­è®¡ç®—ä¸­é—´ä½ç½®ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯äºŒåˆ†æŸ¥æ‰¾æ ‘ï¼Ÿ">ä»€ä¹ˆæ˜¯äºŒåˆ†æŸ¥æ‰¾æ ‘ï¼Ÿ</h2>
<p>ç”¨æ•°ç»„æ¥å®ç°çº¿æ€§æ’åºçš„æ•°æ®è™½ç„¶ç®€å•å¥½ç”¨ï¼Œä½†æ˜¯æ’å…¥æ–°å…ƒç´ çš„æ—¶å€™æ€§èƒ½å¤ªä½ã€‚</p>
<p>å› ä¸ºæ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦å°†è¿™ä¸ªå…ƒç´ ä¹‹åçš„æ‰€æœ‰å…ƒç´ åç§»ä¸€ä½ï¼Œå¦‚æœè¿™ä¸ªæ“ä½œå‘ç”Ÿåœ¨ç£ç›˜ä¸­å‘¢ï¼Ÿè¿™å¿…ç„¶æ˜¯ç¾éš¾æ€§çš„ã€‚å› ä¸ºç£ç›˜çš„é€Ÿåº¦æ¯”å†…å­˜æ…¢å‡ åä¸‡å€ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç”¨ä¸€ç§çº¿æ€§ç»“æ„å°†ç£ç›˜æ’åºã€‚</p>
<p>å…¶æ¬¡ï¼Œæœ‰åºçš„æ•°ç»„åœ¨ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ—¶å€™ï¼Œæ¯æ¬¡æŸ¥æ‰¾éƒ½è¦ä¸æ–­è®¡ç®—ä¸­é—´çš„ä½ç½®ã€‚</p>
<p>é‚£æˆ‘ä»¬èƒ½ä¸èƒ½è®¾è®¡ä¸€ä¸ªéçº¿å½¢ä¸”å¤©ç„¶é€‚åˆäºŒåˆ†æŸ¥æ‰¾çš„æ•°æ®ç»“æ„å‘¢ï¼Ÿ</p>
<p>æœ‰çš„ï¼Œè¯·çœ‹ä¸‹å›¾è¿™ä¸ªç¥å¥‡çš„æ“ä½œï¼Œæ‰¾åˆ°æ‰€æœ‰äºŒåˆ†æŸ¥æ‰¾ä¸­ç”¨åˆ°çš„æ‰€æœ‰ä¸­é—´èŠ‚ç‚¹ï¼ŒæŠŠä»–ä»¬ç”¨æŒ‡é’ˆè¿èµ·æ¥ï¼Œå¹¶å°†æœ€ä¸­é—´çš„èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹ã€‚</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915426331.gif" alt="1745915426331"></p>
<p>æ€ä¹ˆæ ·ï¼Ÿæ˜¯ä¸æ˜¯å˜æˆäº†äºŒå‰æ ‘ï¼Œä¸è¿‡å®ƒä¸æ˜¯æ™®é€šçš„äºŒå‰æ ‘ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>äºŒå‰æŸ¥æ‰¾æ ‘</strong>ã€‚</p>
<p><strong>äºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹ç‚¹æ˜¯ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å°äºè¿™ä¸ªèŠ‚ç‚¹ï¼Œå³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å¤§äºè¿™ä¸ªèŠ‚ç‚¹</strong>ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æŸ¥è¯¢æ•°æ®æ—¶ï¼Œä¸éœ€è¦è®¡ç®—ä¸­é—´èŠ‚ç‚¹çš„ä½ç½®äº†ï¼Œåªéœ€å°†æŸ¥æ‰¾çš„æ•°æ®ä¸èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬æŸ¥æ‰¾ç´¢å¼•å€¼ä¸º key çš„èŠ‚ç‚¹ï¼š</p>
<ol>
<li>å¦‚æœ key å¤§äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™åœ¨å³å­æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼›</li>
<li>å¦‚æœ key å°äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™åœ¨å·¦å­æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼›</li>
<li>å¦‚æœ key ç­‰äºæ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°äº†è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿”å›æ ¹èŠ‚ç‚¹å³å¯ã€‚</li>
</ol>
<p>äºŒå‰æŸ¥æ‰¾æ ‘æŸ¥æ‰¾æŸä¸ªèŠ‚ç‚¹çš„åŠ¨å›¾æ¼”ç¤ºå¦‚ä¸‹ï¼Œæ¯”å¦‚è¦æŸ¥æ‰¾èŠ‚ç‚¹ 3ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915426332.gif" alt></p>
<p>å¦å¤–ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘è§£å†³äº†æ’å…¥æ–°èŠ‚ç‚¹çš„é—®é¢˜ï¼Œå› ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ä¸ªè·³è·ƒç»“æ„ï¼Œä¸å¿…è¿ç»­æ’åˆ—ã€‚è¿™æ ·åœ¨æ’å…¥çš„æ—¶å€™ï¼Œæ–°èŠ‚ç‚¹å¯ä»¥æ”¾åœ¨ä»»ä½•ä½ç½®ï¼Œä¸ä¼šåƒçº¿æ€§ç»“æ„é‚£æ ·æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€æœ‰å…ƒç´ éƒ½éœ€è¦å‘åæ’åˆ—ã€‚</p>
<p>ä¸‹é¢æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘æ’å…¥æŸä¸ªèŠ‚ç‚¹çš„åŠ¨å›¾æ¼”ç¤ºï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915426333.gif" alt></p>
<p>å› æ­¤ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘è§£å†³äº†è¿ç»­ç»“æ„æ’å…¥æ–°å…ƒç´ å¼€é”€å¾ˆå¤§çš„é—®é¢˜ï¼ŒåŒæ—¶åˆä¿æŒç€å¤©ç„¶çš„äºŒåˆ†ç»“æ„ã€‚</p>
<p>é‚£æ˜¯ä¸æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘å°±å¯ä»¥ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„äº†å‘¢ï¼Ÿ</p>
<p>ä¸è¡Œä¸è¡Œï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘å­˜åœ¨ä¸€ä¸ªæç«¯æƒ…å†µï¼Œä¼šå¯¼è‡´å®ƒå˜æˆä¸€ä¸ªç˜¸å­ï¼</p>
<p><strong>å½“æ¯æ¬¡æ’å…¥çš„å…ƒç´ éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æœ€å¤§çš„å…ƒç´ ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘å°±ä¼šé€€åŒ–æˆäº†ä¸€æ¡é“¾è¡¨ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´å¤æ‚åº¦å˜æˆäº† O(n)</strong>ï¼Œå¦‚ä¸‹åŠ¨å›¾æ¼”ç¤ºï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915426334.gif" alt></p>
<p>ç”±äºæ ‘æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„ï¼Œè®¿é—®æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½å¯¹åº”ä¸€æ¬¡ç£ç›˜ I/O æ“ä½œï¼ˆ<em>å‡è®¾ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°ã€Œå°äºã€æ“ä½œç³»ç»Ÿçš„æœ€å°è¯»å†™å•ä½å—çš„å¤§å°</em>ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æ ‘çš„é«˜åº¦å°±ç­‰äºæ¯æ¬¡æŸ¥è¯¢æ•°æ®æ—¶ç£ç›˜ IO æ“ä½œçš„æ¬¡æ•°</strong>ï¼Œæ‰€ä»¥æ ‘çš„é«˜åº¦è¶Šé«˜ï¼Œå°±ä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p>äºŒå‰æŸ¥æ‰¾æ ‘ç”±äºå­˜åœ¨é€€åŒ–æˆé“¾è¡¨çš„å¯èƒ½æ€§ï¼Œä¼šä½¿å¾—æŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä» O(logn) å‡ä¸º O(n)ã€‚</p>
<p>è€Œä¸”ä¼šéšç€æ’å…¥çš„å…ƒç´ è¶Šå¤šï¼Œæ ‘çš„é«˜åº¦ä¹Ÿå˜é«˜ï¼Œæ„å‘³ç€éœ€è¦ç£ç›˜ IO æ“ä½œçš„æ¬¡æ•°å°±è¶Šå¤šï¼Œè¿™æ ·å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸¥é‡ä¸‹é™ï¼Œå†åŠ ä¸Šä¸èƒ½èŒƒå›´æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸é€‚åˆä½œä¸ºæ•°æ®åº“çš„ç´¢å¼•ç»“æ„ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯è‡ªå¹³è¡¡äºŒå‰æ ‘ï¼Ÿ">ä»€ä¹ˆæ˜¯è‡ªå¹³è¡¡äºŒå‰æ ‘ï¼Ÿ</h2>
<p>ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘ä¼šåœ¨æç«¯æƒ…å†µä¸‹é€€åŒ–æˆé“¾è¡¨çš„é—®é¢˜ï¼Œåé¢å°±æœ‰äººæå‡º<strong>å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆAVL æ ‘ï¼‰</strong>ã€‚</p>
<p>ä¸»è¦æ˜¯åœ¨äºŒå‰æŸ¥æ‰¾æ ‘çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›æ¡ä»¶çº¦æŸï¼š<strong>æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å·®ä¸èƒ½è¶…è¿‡ 1</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´èŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘ä»ç„¶ä¸ºå¹³è¡¡äºŒå‰æ ‘ï¼Œè¿™æ ·æŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å°±ä¼šä¸€ç›´ç»´æŒåœ¨ O(logn) ã€‚</p>
<p>ä¸‹å›¾æ˜¯æ¯æ¬¡æ’å…¥çš„å…ƒç´ éƒ½æ˜¯å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æœ€å¤§çš„å…ƒç´ ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¼šç»´æŒè‡ªå¹³è¡¡ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915426335.gif" alt></p>
<p>é™¤äº†å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œè¿˜æœ‰å¾ˆå¤šè‡ªå¹³è¡¡çš„äºŒå‰æ ‘ï¼Œæ¯”å¦‚çº¢é»‘æ ‘ï¼Œå®ƒä¹Ÿæ˜¯é€šè¿‡ä¸€äº›çº¦æŸæ¡ä»¶æ¥è¾¾åˆ°è‡ªå¹³è¡¡ï¼Œä¸è¿‡çº¢é»‘æ ‘çš„çº¦æŸæ¡ä»¶æ¯”è¾ƒå¤æ‚ï¼Œä¸æ˜¯æœ¬ç¯‡çš„é‡ç‚¹é‡ç‚¹ï¼Œå¤§å®¶å¯ä»¥çœ‹ã€Šæ•°æ®ç»“æ„ã€‹ç›¸å…³çš„ä¹¦ç±æ¥äº†è§£çº¢é»‘æ ‘çš„çº¦æŸæ¡ä»¶ã€‚</p>
<p>ä¸‹é¢æ˜¯çº¢é»‘æ ‘æ’å…¥èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œè¿™å·¦æ—‹å³æ—‹çš„æ“ä½œï¼Œå°±æ˜¯ä¸ºäº†è‡ªå¹³è¡¡ã€‚</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915426336.gif" alt></p>
<p><strong>ä¸ç®¡å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘è¿˜æ˜¯çº¢é»‘æ ‘ï¼Œéƒ½ä¼šéšç€æ’å…¥çš„å…ƒç´ å¢å¤šï¼Œè€Œå¯¼è‡´æ ‘çš„é«˜åº¦å˜é«˜ï¼Œè¿™å°±æ„å‘³ç€ç£ç›˜ I/O æ“ä½œæ¬¡æ•°å¤šï¼Œä¼šå½±å“æ•´ä½“æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡</strong>ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸‹é¢è¿™ä¸ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„é«˜åº¦ä¸º 5ï¼Œé‚£ä¹ˆåœ¨è®¿é—®æœ€åº•éƒ¨çš„èŠ‚ç‚¹æ—¶ï¼Œå°±éœ€è¦ç£ç›˜ 5 æ¬¡ I/O æ“ä½œã€‚</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915816175.png" alt="1745915816175"></p>
<p>æ ¹æœ¬åŸå› æ˜¯å› ä¸ºå®ƒä»¬éƒ½æ˜¯äºŒå‰æ ‘ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹åªèƒ½ä¿å­˜ 2 ä¸ªå­èŠ‚ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬æŠŠäºŒå‰æ ‘æ”¹æˆ M å‰æ ‘ï¼ˆM&gt;2ï¼‰å‘¢ï¼Ÿ</p>
<p>æ¯”å¦‚ï¼Œå½“ M=3 æ—¶ï¼Œåœ¨åŒæ ·çš„èŠ‚ç‚¹ä¸ªæ•°æƒ…å†µä¸‹ï¼Œä¸‰å‰æ ‘æ¯”äºŒå‰æ ‘çš„æ ‘é«˜è¦çŸ®ã€‚</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915829974.png" alt="1745915829974"></p>
<p>å› æ­¤ï¼Œ<strong>å½“æ ‘çš„èŠ‚ç‚¹è¶Šå¤šçš„æ—¶å€™ï¼Œå¹¶ä¸”æ ‘çš„åˆ†å‰æ•° M è¶Šå¤§çš„æ—¶å€™ï¼ŒM å‰æ ‘çš„é«˜åº¦ä¼šè¿œå°äºäºŒå‰æ ‘çš„é«˜åº¦</strong>ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-B-æ ‘">ä»€ä¹ˆæ˜¯ B æ ‘</h2>
<p>è‡ªå¹³è¡¡äºŒå‰æ ‘è™½ç„¶èƒ½ä¿æŒæŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦åœ¨ O(logn)ï¼Œä½†æ˜¯å› ä¸ºå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½æœ‰ 2 ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå½“èŠ‚ç‚¹ä¸ªæ•°è¶Šå¤šçš„æ—¶å€™ï¼Œæ ‘çš„é«˜åº¦ä¹Ÿä¼šç›¸åº”å˜é«˜ï¼Œè¿™æ ·å°±ä¼šå¢åŠ ç£ç›˜çš„ I/O æ¬¡æ•°ï¼Œä»è€Œå½±å“æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p>
<p>ä¸ºäº†è§£å†³é™ä½æ ‘çš„é«˜åº¦çš„é—®é¢˜ï¼Œåé¢å°±å‡ºæ¥äº† B æ ‘ï¼Œå®ƒä¸å†é™åˆ¶ä¸€ä¸ªèŠ‚ç‚¹å°±åªèƒ½æœ‰ 2 ä¸ªå­èŠ‚ç‚¹ï¼Œè€Œæ˜¯å…è®¸ M ä¸ªå­èŠ‚ç‚¹ (M&gt;2)ï¼Œä»è€Œé™ä½æ ‘çš„é«˜åº¦ã€‚</p>
<p>B æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå¯ä»¥åŒ…æ‹¬ M ä¸ªå­èŠ‚ç‚¹ï¼ŒM ç§°ä¸º B æ ‘çš„é˜¶ï¼Œæ‰€ä»¥ B æ ‘å°±æ˜¯ä¸€ä¸ªå¤šå‰æ ‘ã€‚</p>
<p>å‡è®¾ M = 3ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€æ£µ 3 é˜¶çš„ B æ ‘ï¼Œç‰¹ç‚¹å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ 2 ä¸ªï¼ˆM-1 ä¸ªï¼‰æ•°æ®å’Œæœ€å¤šæœ‰ 3 ä¸ªï¼ˆM ä¸ªï¼‰å­èŠ‚ç‚¹ï¼Œè¶…è¿‡è¿™äº›è¦æ±‚çš„è¯ï¼Œå°±ä¼šåˆ†è£‚èŠ‚ç‚¹ï¼Œæ¯”å¦‚ä¸‹é¢çš„çš„åŠ¨å›¾ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915839975.gif" alt="1745915839975"></p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€æ£µ 3 é˜¶çš„ B æ ‘çš„æŸ¥è¯¢è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915849976.gif" alt="1745915849976"></p>
<p>å‡è®¾æˆ‘ä»¬åœ¨ä¸Šå›¾ä¸€æ£µ 3 é˜¶çš„ B æ ‘ä¸­è¦æŸ¥æ‰¾çš„ç´¢å¼•å€¼æ˜¯ 9 çš„è®°å½•é‚£ä¹ˆæ­¥éª¤å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>ä¸æ ¹èŠ‚ç‚¹çš„ç´¢å¼• (4ï¼Œ8ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œ9 å¤§äº 8ï¼Œé‚£ä¹ˆå¾€å³è¾¹çš„å­èŠ‚ç‚¹èµ°ï¼›</li>
<li>ç„¶åè¯¥å­èŠ‚ç‚¹çš„ç´¢å¼•ä¸ºï¼ˆ10ï¼Œ12ï¼‰ï¼Œå› ä¸º 9 å°äº 10ï¼Œæ‰€ä»¥ä¼šå¾€è¯¥èŠ‚ç‚¹çš„å·¦è¾¹å­èŠ‚ç‚¹èµ°ï¼›</li>
<li>èµ°åˆ°ç´¢å¼•ä¸º 9 çš„èŠ‚ç‚¹ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†ç´¢å¼•å€¼ 9 çš„èŠ‚ç‚¹ã€‚</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ£µ 3 é˜¶çš„ B æ ‘åœ¨æŸ¥è¯¢å¶å­èŠ‚ç‚¹ä¸­çš„æ•°æ®æ—¶ï¼Œç”±äºæ ‘çš„é«˜åº¦æ˜¯ 3ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿ 3 æ¬¡ç£ç›˜ I/O æ“ä½œã€‚</p>
<p>è€Œå¦‚æœåŒæ ·çš„èŠ‚ç‚¹æ•°é‡åœ¨å¹³è¡¡äºŒå‰æ ‘çš„åœºæ™¯ä¸‹ï¼Œæ ‘çš„é«˜åº¦å°±ä¼šå¾ˆé«˜ï¼Œæ„å‘³ç€ç£ç›˜ I/O æ“ä½œä¼šæ›´å¤šã€‚æ‰€ä»¥ï¼ŒB æ ‘åœ¨æ•°æ®æŸ¥è¯¢ä¸­æ¯”å¹³è¡¡äºŒå‰æ ‘æ•ˆç‡è¦é«˜ã€‚</p>
<p>ä½†æ˜¯ B æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«æ•°æ®ï¼ˆç´¢å¼• + è®°å½•ï¼‰ï¼Œè€Œç”¨æˆ·çš„è®°å½•æ•°æ®çš„å¤§å°å¾ˆæœ‰å¯èƒ½è¿œè¿œè¶…è¿‡äº†ç´¢å¼•æ•°æ®ï¼Œè¿™å°±éœ€è¦èŠ±è´¹æ›´å¤šçš„ç£ç›˜ I/O æ“ä½œæ¬¡æ•°æ¥è¯»åˆ°ã€Œæœ‰ç”¨çš„ç´¢å¼•æ•°æ®ã€ã€‚</p>
<p>è€Œä¸”ï¼Œåœ¨æˆ‘ä»¬æŸ¥è¯¢ä½äºåº•å±‚çš„æŸä¸ªèŠ‚ç‚¹ï¼ˆæ¯”å¦‚ A è®°å½•ï¼‰è¿‡ç¨‹ä¸­ï¼Œã€Œé A è®°å½•èŠ‚ç‚¹ã€é‡Œçš„è®°å½•æ•°æ®ä¼šä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ï¼Œä½†æ˜¯è¿™äº›è®°å½•æ•°æ®æ˜¯æ²¡ç”¨çš„ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³è¯»å–è¿™äº›èŠ‚ç‚¹çš„ç´¢å¼•æ•°æ®æ¥åšæ¯”è¾ƒæŸ¥è¯¢ï¼Œè€Œã€Œé A è®°å½•èŠ‚ç‚¹ã€é‡Œçš„è®°å½•æ•°æ®å¯¹æˆ‘ä»¬æ˜¯æ²¡ç”¨çš„ï¼Œè¿™æ ·ä¸ä»…å¢å¤šç£ç›˜ I/O æ“ä½œæ¬¡æ•°ï¼Œä¹Ÿå ç”¨å†…å­˜èµ„æºã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ B æ ‘æ¥åšèŒƒå›´æŸ¥è¯¢çš„è¯ï¼Œéœ€è¦ä½¿ç”¨ä¸­åºéå†ï¼Œè¿™ä¼šæ¶‰åŠå¤šä¸ªèŠ‚ç‚¹çš„ç£ç›˜ I/O é—®é¢˜ï¼Œä»è€Œå¯¼è‡´æ•´ä½“é€Ÿåº¦ä¸‹é™ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-B-æ ‘ï¼Ÿ">ä»€ä¹ˆæ˜¯ B+ æ ‘ï¼Ÿ</h2>
<p>B+ æ ‘å°±æ˜¯å¯¹ B æ ‘åšäº†ä¸€ä¸ªå‡çº§ï¼ŒMySQL ä¸­ç´¢å¼•çš„æ•°æ®ç»“æ„å°±æ˜¯é‡‡ç”¨äº† B+ æ ‘ï¼ŒB+ æ ‘ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915888730.png" alt="1745915888730"></p>
<p>B+ æ ‘ä¸ B æ ‘å·®å¼‚çš„ç‚¹ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹è¿™å‡ ç‚¹ï¼š</p>
<ul>
<li>å¶å­èŠ‚ç‚¹ï¼ˆæœ€åº•éƒ¨çš„èŠ‚ç‚¹ï¼‰æ‰ä¼šå­˜æ”¾å®é™…æ•°æ®ï¼ˆç´¢å¼• + è®°å½•ï¼‰ï¼Œéå¶å­èŠ‚ç‚¹åªä¼šå­˜æ”¾ç´¢å¼•ï¼›</li>
<li>æ‰€æœ‰ç´¢å¼•éƒ½ä¼šåœ¨å¶å­èŠ‚ç‚¹å‡ºç°ï¼Œå¶å­èŠ‚ç‚¹ä¹‹é—´æ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼›</li>
<li>éå¶å­èŠ‚ç‚¹çš„ç´¢å¼•ä¹Ÿä¼šåŒæ—¶å­˜åœ¨åœ¨å­èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”æ˜¯åœ¨å­èŠ‚ç‚¹ä¸­æ‰€æœ‰ç´¢å¼•çš„æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰ã€‚</li>
<li>éå¶å­èŠ‚ç‚¹ä¸­æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹ï¼Œå°±æœ‰å¤šå°‘ä¸ªç´¢å¼•ï¼›</li>
</ul>
<p>ä¸‹é¢é€šè¿‡ä¸‰ä¸ªæ–¹é¢ï¼Œæ¯”è¾ƒä¸‹ B+ å’Œ B æ ‘çš„æ€§èƒ½åŒºåˆ«ã€‚</p>
<h3 id="1ã€å•ç‚¹æŸ¥è¯¢">1ã€å•ç‚¹æŸ¥è¯¢</h3>
<p>B æ ‘è¿›è¡Œå•ä¸ªç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œæœ€å¿«å¯ä»¥åœ¨ O(1) çš„æ—¶é—´ä»£ä»·å†…å°±æŸ¥åˆ°ï¼Œè€Œä»å¹³å‡æ—¶é—´ä»£ä»·æ¥çœ‹ï¼Œä¼šæ¯” B+ æ ‘ç¨å¿«ä¸€äº›ã€‚</p>
<p>ä½†æ˜¯ B æ ‘çš„æŸ¥è¯¢æ³¢åŠ¨ä¼šæ¯”è¾ƒå¤§ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ—¢å­˜ç´¢å¼•åˆå­˜è®°å½•ï¼Œæ‰€ä»¥æœ‰æ—¶å€™è®¿é—®åˆ°äº†éå¶å­èŠ‚ç‚¹å°±å¯ä»¥æ‰¾åˆ°ç´¢å¼•ï¼Œè€Œæœ‰æ—¶éœ€è¦è®¿é—®åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°ç´¢å¼•ã€‚</p>
<p><strong>B+ æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾å®é™…çš„è®°å½•æ•°æ®ï¼Œä»…å­˜æ”¾ç´¢å¼•ï¼Œå› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œç›¸æ¯”æ—¢å­˜ç´¢å¼•åˆå­˜è®°å½•çš„ B æ ‘ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œå› æ­¤ B+ æ ‘å¯ä»¥æ¯” B æ ‘æ›´ã€ŒçŸ®èƒ–ã€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹çš„ç£ç›˜ I/O æ¬¡æ•°ä¼šæ›´å°‘</strong>ã€‚</p>
<h3 id="2ã€æ’å…¥å’Œåˆ é™¤æ•ˆç‡">2ã€æ’å…¥å’Œåˆ é™¤æ•ˆç‡</h3>
<p>B+ æ ‘æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹ï¼Œè¿™æ ·ä½¿å¾—åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä»å¶å­èŠ‚ç‚¹ä¸­åˆ é™¤ï¼Œç”šè‡³å¯ä»¥ä¸åŠ¨éå¶å­èŠ‚ç‚¹ï¼Œè¿™æ ·åˆ é™¤éå¸¸å¿«ï¼Œ</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªåŠ¨å›¾æ˜¯åˆ é™¤ B+ æ ‘ 0004 èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå› ä¸ºéå¶å­èŠ‚ç‚¹æœ‰ 0004 çš„å†—ä½™èŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨åˆ é™¤çš„æ—¶å€™ï¼Œæ ‘å½¢ç»“æ„å˜åŒ–å¾ˆå°ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915908731.gif" alt="1745915908731"></p>
<blockquote>
<p>æ³¨æ„ï¼Œï¼šB+ æ ‘å¯¹äºéå¶å­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å’Œç´¢å¼•çš„ä¸ªæ•°ï¼Œå®šä¹‰æ–¹å¼å¯èƒ½ä¼šæœ‰ä¸åŒï¼Œæœ‰çš„æ˜¯è¯´éå¶å­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„ä¸ªæ•°ä¸º M é˜¶ï¼Œè€Œç´¢å¼•çš„ä¸ªæ•°ä¸º M-1ï¼ˆè¿™ä¸ªæ˜¯ç»´åŸºç™¾ç§‘é‡Œçš„å®šä¹‰ï¼‰ï¼Œå› æ­¤æˆ‘æœ¬æ–‡å…³äº B+ æ ‘çš„åŠ¨å›¾éƒ½æ˜¯åŸºäºè¿™ä¸ªã€‚ä½†æ˜¯æˆ‘åœ¨å‰é¢ä»‹ç» B+ æ ‘ä¸ B+ æ ‘çš„å·®å¼‚æ—¶ï¼Œè¯´çš„æ˜¯ã€Œéå¶å­èŠ‚ç‚¹ä¸­æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹ï¼Œå°±æœ‰å¤šå°‘ä¸ªç´¢å¼•ã€ï¼Œä¸»è¦æ˜¯ MySQL ç”¨åˆ°çš„ B+ æ ‘å°±æ˜¯è¿™ä¸ªç‰¹æ€§ã€‚</p>
</blockquote>
<p>ä¸‹é¢è¿™ä¸ªåŠ¨å›¾æ˜¯åˆ é™¤ B æ ‘ 0008 èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ‘çš„å¤æ‚å˜åŒ–ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915918732.gif" alt="1745915918732"></p>
<p>ç”šè‡³ï¼ŒB+ æ ‘åœ¨åˆ é™¤æ ¹èŠ‚ç‚¹çš„æ—¶å€™ï¼Œç”±äºå­˜åœ¨å†—ä½™çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿå¤æ‚çš„æ ‘çš„å˜å½¢ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªåŠ¨å›¾æ˜¯åˆ é™¤ B+ æ ‘æ ¹èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915928733.gif" alt="1745915928733"></p>
<p>B æ ‘åˆ™ä¸åŒï¼ŒB æ ‘æ²¡æœ‰å†—ä½™èŠ‚ç‚¹ï¼Œåˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™éå¸¸å¤æ‚ï¼Œæ¯”å¦‚åˆ é™¤æ ¹èŠ‚ç‚¹ä¸­çš„æ•°æ®ï¼Œå¯èƒ½æ¶‰åŠå¤æ‚çš„æ ‘çš„å˜å½¢ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªåŠ¨å›¾æ˜¯åˆ é™¤ B æ ‘æ ¹èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745915938734.gif" alt="1745915938734"></p>
<p>B+ æ ‘çš„æ’å…¥ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæœ‰å†—ä½™èŠ‚ç‚¹ï¼Œæ’å…¥å¯èƒ½å­˜åœ¨èŠ‚ç‚¹çš„åˆ†è£‚ï¼ˆå¦‚æœèŠ‚ç‚¹é¥±å’Œï¼‰ï¼Œä½†æ˜¯æœ€å¤šåªæ¶‰åŠæ ‘çš„ä¸€æ¡è·¯å¾„ã€‚è€Œä¸” B+ æ ‘ä¼šè‡ªåŠ¨å¹³è¡¡ï¼Œä¸éœ€è¦åƒæ›´å¤šå¤æ‚çš„ç®—æ³•ï¼Œç±»ä¼¼çº¢é»‘æ ‘çš„æ—‹è½¬æ“ä½œç­‰ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>B+ æ ‘çš„æ’å…¥å’Œåˆ é™¤æ•ˆç‡æ›´é«˜</strong>ã€‚</p>
<h3 id="3ã€èŒƒå›´æŸ¥è¯¢">3ã€èŒƒå›´æŸ¥è¯¢</h3>
<p>B æ ‘å’Œ B+ æ ‘ç­‰å€¼æŸ¥è¯¢åŸç†åŸºæœ¬ä¸€è‡´ï¼Œå…ˆä»æ ¹èŠ‚ç‚¹æŸ¥æ‰¾ï¼Œç„¶åå¯¹æ¯”ç›®æ ‡æ•°æ®çš„èŒƒå›´ï¼Œæœ€åé€’å½’çš„è¿›å…¥å­èŠ‚ç‚¹æŸ¥æ‰¾ã€‚</p>
<p>å› ä¸º <strong>B+ æ ‘æ‰€æœ‰å¶å­èŠ‚ç‚¹é—´è¿˜æœ‰ä¸€ä¸ªé“¾è¡¨è¿›è¡Œè¿æ¥ï¼Œè¿™ç§è®¾è®¡å¯¹èŒƒå›´æŸ¥æ‰¾éå¸¸æœ‰å¸®åŠ©</strong>ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æƒ³çŸ¥é“ 12 æœˆ 1 æ—¥å’Œ 12 æœˆ 12 æ—¥ä¹‹é—´çš„è®¢å•ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å…ˆæŸ¥æ‰¾åˆ° 12 æœˆ 1 æ—¥æ‰€åœ¨çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨é“¾è¡¨å‘å³éå†ï¼Œç›´åˆ°æ‰¾åˆ° 12 æœˆ 12 æ—¥çš„èŠ‚ç‚¹ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹æŸ¥è¯¢äº†ï¼Œè¿›ä¸€æ­¥èŠ‚çœæŸ¥è¯¢éœ€è¦çš„æ—¶é—´ã€‚</p>
<p>è€Œ B æ ‘æ²¡æœ‰å°†æ‰€æœ‰å¶å­èŠ‚ç‚¹ç”¨é“¾è¡¨ä¸²è”èµ·æ¥çš„ç»“æ„ï¼Œå› æ­¤åªèƒ½é€šè¿‡æ ‘çš„éå†æ¥å®ŒæˆèŒƒå›´æŸ¥è¯¢ï¼Œè¿™ä¼šæ¶‰åŠå¤šä¸ªèŠ‚ç‚¹çš„ç£ç›˜ I/O æ“ä½œï¼ŒèŒƒå›´æŸ¥è¯¢æ•ˆç‡ä¸å¦‚ B+ æ ‘ã€‚</p>
<p>å› æ­¤ï¼Œå­˜åœ¨å¤§é‡èŒƒå›´æ£€ç´¢çš„åœºæ™¯ï¼Œé€‚åˆä½¿ç”¨ B+æ ‘ï¼Œæ¯”å¦‚æ•°æ®åº“ã€‚è€Œå¯¹äºå¤§é‡çš„å•ä¸ªç´¢å¼•æŸ¥è¯¢çš„åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ B æ ‘ï¼Œæ¯”å¦‚ nosql çš„ MongoDBã€‚</p>
<h3 id="MySQL-ä¸­çš„-B-æ ‘">MySQL ä¸­çš„ B+ æ ‘</h3>
<p>MySQL çš„å­˜å‚¨æ–¹å¼æ ¹æ®å­˜å‚¨å¼•æ“çš„ä¸åŒè€Œä¸åŒï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯ Innodb å­˜å‚¨å¼•æ“ï¼Œå®ƒå°±æ˜¯é‡‡ç”¨äº† B+ æ ‘ä½œä¸ºäº†ç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚</p>
<p>ä¸‹å›¾å°±æ˜¯ Innodb é‡Œçš„ B+ æ ‘ï¼š</p>
<p><img src="/2025/04/29/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9B+%E6%A0%91/1745916000852.png" alt="1745916000852"></p>
<p>ä½†æ˜¯ Innodb ä½¿ç”¨çš„ B+ æ ‘æœ‰ä¸€äº›ç‰¹åˆ«çš„ç‚¹ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>B+ æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´æ˜¯ç”¨ã€ŒåŒå‘é“¾è¡¨ã€è¿›è¡Œè¿æ¥ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯æ—¢èƒ½å‘å³éå†ï¼Œä¹Ÿèƒ½å‘å·¦éå†ã€‚</li>
<li>B+ æ ‘ç‚¹èŠ‚ç‚¹å†…å®¹æ˜¯æ•°æ®é¡µï¼Œæ•°æ®é¡µé‡Œå­˜æ”¾äº†ç”¨æˆ·çš„è®°å½•ä»¥åŠå„ç§ä¿¡æ¯ï¼Œæ¯ä¸ªæ•°æ®é¡µé»˜è®¤å¤§å°æ˜¯ 16 KBã€‚</li>
</ul>
<p>Innodb æ ¹æ®ç´¢å¼•ç±»å‹ä¸åŒï¼Œåˆ†ä¸ºèšç°‡å’ŒäºŒçº§ç´¢å¼•ã€‚ä»–ä»¬åŒºåˆ«åœ¨äºï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼Œæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ï¼Œè€ŒäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯å®é™…æ•°æ®ã€‚</p>
<p>å› ä¸ºè¡¨çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹é‡Œï¼Œæ‰€ä»¥ InnoDB å­˜å‚¨å¼•æ“ä¸€å®šä¼šä¸ºè¡¨åˆ›å»ºä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸”ç”±äºæ•°æ®åœ¨ç‰©ç†ä¸Šåªä¼šä¿å­˜ä¸€ä»½ï¼Œæ‰€ä»¥èšç°‡ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€ŒäºŒçº§ç´¢å¼•å¯ä»¥åˆ›å»ºå¤šä¸ªã€‚</p>
<p>æ›´å¤šå…³äº Innodb çš„ B+ æ ‘ï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/">InnoDB çš„æ•°æ®é¡µ</a>ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>MySQL æ˜¯ä¼šå°†æ•°æ®æŒä¹…åŒ–åœ¨ç¡¬ç›˜ï¼Œè€Œå­˜å‚¨åŠŸèƒ½æ˜¯ç”± MySQL å­˜å‚¨å¼•æ“å®ç°çš„ï¼Œæ‰€ä»¥è®¨è®º MySQL ä½¿ç”¨å“ªç§æ•°æ®ç»“æ„ä½œä¸ºç´¢å¼•ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¨è®ºå­˜å‚¨å¼•æ“ä½¿ç”¨å“ªç§æ•°æ®ç»“æ„ä½œä¸ºç´¢å¼•ï¼ŒInnoDB æ˜¯ MySQL é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œå®ƒå°±æ˜¯é‡‡ç”¨äº† B+ æ ‘ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚</p>
<p>è¦è®¾è®¡ä¸€ä¸ª MySQL çš„ç´¢å¼•æ•°æ®ç»“æ„ï¼Œä¸ä»…ä»…è€ƒè™‘æ•°æ®ç»“æ„å¢åˆ æ”¹çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ›´é‡è¦çš„æ˜¯è¦è€ƒè™‘ç£ç›˜ I/0 çš„æ“ä½œæ¬¡æ•°ã€‚å› ä¸ºç´¢å¼•å’Œè®°å½•éƒ½æ˜¯å­˜æ”¾åœ¨ç¡¬ç›˜ï¼Œç¡¬ç›˜æ˜¯ä¸€ä¸ªéå¸¸æ…¢çš„å­˜å‚¨è®¾å¤‡ï¼Œæˆ‘ä»¬åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œæœ€å¥½èƒ½åœ¨å°½å¯èƒ½å°‘çš„ç£ç›˜ I/0 çš„æ“ä½œæ¬¡æ•°å†…å®Œæˆã€‚</p>
<p>äºŒåˆ†æŸ¥æ‰¾æ ‘è™½ç„¶æ˜¯ä¸€ä¸ªå¤©ç„¶çš„äºŒåˆ†ç»“æ„ï¼Œèƒ½å¾ˆå¥½çš„åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾å¿«é€Ÿå®šä½æ•°æ®ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ç§æç«¯çš„æƒ…å†µï¼Œæ¯å½“æ’å…¥çš„å…ƒç´ éƒ½æ˜¯æ ‘å†…æœ€å¤§çš„å…ƒç´ ï¼Œå°±ä¼šå¯¼è‡´äºŒåˆ†æŸ¥æ‰¾æ ‘é€€åŒ–æˆä¸€ä¸ªé“¾è¡¨ï¼Œæ­¤æ—¶æŸ¥è¯¢å¤æ‚åº¦å°±ä¼šä» O(logn) é™ä½ä¸º O(n)ã€‚</p>
<p>ä¸ºäº†è§£å†³äºŒåˆ†æŸ¥æ‰¾æ ‘é€€åŒ–æˆé“¾è¡¨çš„é—®é¢˜ï¼Œå°±å‡ºç°äº†è‡ªå¹³è¡¡äºŒå‰æ ‘ï¼Œä¿è¯äº†æŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å°±ä¼šä¸€ç›´ç»´æŒåœ¨ O(logn) ã€‚ä½†æ˜¯å®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½æœ‰ 2 ä¸ªå­èŠ‚ç‚¹ï¼Œéšç€å…ƒç´ çš„å¢å¤šï¼Œæ ‘çš„é«˜åº¦ä¼šè¶Šæ¥è¶Šé«˜ã€‚</p>
<p>è€Œæ ‘çš„é«˜åº¦å†³å®šäºç£ç›˜ I/O æ“ä½œçš„æ¬¡æ•°ï¼Œå› ä¸ºæ ‘æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„ï¼Œè®¿é—®æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½å¯¹åº”ä¸€æ¬¡ç£ç›˜ I/O æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´æ ‘çš„é«˜åº¦å°±ç­‰äºæ¯æ¬¡æŸ¥è¯¢æ•°æ®æ—¶ç£ç›˜ IO æ“ä½œçš„æ¬¡æ•°ï¼Œæ‰€ä»¥æ ‘çš„é«˜åº¦è¶Šé«˜ï¼Œå°±ä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p>B æ ‘å’Œ B+ éƒ½æ˜¯é€šè¿‡å¤šå‰æ ‘çš„æ–¹å¼ï¼Œä¼šå°†æ ‘çš„é«˜åº¦å˜çŸ®ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ•°æ®ç»“æ„éå¸¸é€‚åˆæ£€ç´¢å­˜äºç£ç›˜ä¸­çš„æ•°æ®ã€‚</p>
<p>ä½†æ˜¯ MySQL é»˜è®¤çš„å­˜å‚¨å¼•æ“ InnoDB é‡‡ç”¨çš„æ˜¯ B+ ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ŒåŸå› æœ‰ï¼š</p>
<ul>
<li>B+ æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾å®é™…çš„è®°å½•æ•°æ®ï¼Œä»…å­˜æ”¾ç´¢å¼•ï¼Œå› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œç›¸æ¯”æ—¢å­˜ç´¢å¼•åˆå­˜è®°å½•çš„ B æ ‘ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œå› æ­¤ B+ æ ‘å¯ä»¥æ¯” B æ ‘æ›´ã€ŒçŸ®èƒ–ã€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹çš„ç£ç›˜ I/O æ¬¡æ•°ä¼šæ›´å°‘ã€‚</li>
<li>B+ æ ‘æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹ï¼ˆæ‰€æœ‰éå¶å­èŠ‚ç‚¹éƒ½æ˜¯å†—ä½™ç´¢å¼•ï¼‰ï¼Œè¿™äº›å†—ä½™ç´¢å¼•è®© B+ æ ‘åœ¨æ’å…¥ã€åˆ é™¤çš„æ•ˆç‡éƒ½æ›´é«˜ï¼Œæ¯”å¦‚åˆ é™¤æ ¹èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸ä¼šåƒ B æ ‘é‚£æ ·ä¼šå‘ç”Ÿå¤æ‚çš„æ ‘çš„å˜åŒ–ï¼›</li>
<li>B+ æ ‘å¶å­èŠ‚ç‚¹ä¹‹é—´ç”¨é“¾è¡¨è¿æ¥äº†èµ·æ¥ï¼Œæœ‰åˆ©äºèŒƒå›´æŸ¥è¯¢ï¼Œè€Œ B æ ‘è¦å®ç°èŒƒå›´æŸ¥è¯¢ï¼Œå› æ­¤åªèƒ½é€šè¿‡æ ‘çš„éå†æ¥å®ŒæˆèŒƒå›´æŸ¥è¯¢ï¼Œè¿™ä¼šæ¶‰åŠå¤šä¸ªèŠ‚ç‚¹çš„ç£ç›˜ I/O æ“ä½œï¼ŒèŒƒå›´æŸ¥è¯¢æ•ˆç‡ä¸å¦‚ B+ æ ‘ã€‚</li>
</ul>
<p>å®Œï¼</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>ç´¢å¼•</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>MySQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>ç´¢å¼•</tag>
        <tag>B+æ ‘</tag>
        <tag>Bæ ‘</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 98 - éªŒè¯äºŒå‰æœç´¢æ ‘ (Validate Binary Search Tree)</title>
    <url>/2025/04/29/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-98-validate-binary-search-tree/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚</p>
<p>æœ‰æ•ˆäºŒå‰æœç´¢æ ‘å®šä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«<strong>å°äº</strong>å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚</li>
<li>èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«<strong>å¤§äº</strong>å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚</li>
<li>æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [2,1,3]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [5,1,4,null,null,3,6]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼šæ ¹èŠ‚ç‚¹çš„å€¼æ˜¯ 5 ï¼Œä½†æ˜¯å³å­èŠ‚ç‚¹çš„å€¼æ˜¯ 4 ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®èŒƒå›´åœ¨ [1, 10^4] å†…</li>
<li>-2^31 &lt;= Node.val &lt;= 2^31 - 1</li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘çš„åˆå§‹è§£æ³•æ˜¯ä½¿ç”¨é€’å½’æ–¹æ³•ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹è®¾å®šä¸Šä¸‹ç•Œæ¥éªŒè¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isValidBST</span><span class="params">(root *TreeNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> helplerIsValidBST(root, math.MinInt64, math.MaxInt64)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helplerIsValidBST</span><span class="params">(node *TreeNode, low, high <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ç‚¹ï¼šä½¿ç”¨äº†é”™è¯¯çš„æ¯”è¾ƒè¿ç®—ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span> node.Val &lt; low || node.Val &gt; high &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> helplerIsValidBST(node.Left, low, node.Val) &amp;&amp; </span><br><span class="line">           helplerIsValidBST(node.Right, node.Val, high)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè§£æ³•åœ¨ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ä¸­å¤±è´¥äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[5,4,6,null,null,3,7]</span><br><span class="line">é¢„æœŸè¾“å‡ºï¼šfalse</span><br><span class="line">å®é™…è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹è¡¨ç¤ºä¸€æ£µäºŒå‰æ ‘ï¼Œå…¶ä¸­æ ¹èŠ‚ç‚¹æ˜¯ 5ï¼Œå·¦å­èŠ‚ç‚¹æ˜¯ 4ï¼Œå³å­èŠ‚ç‚¹æ˜¯ 6ï¼Œè€Œ 6 çš„å·¦å­èŠ‚ç‚¹æ˜¯ 3ï¼Œå³å­èŠ‚ç‚¹æ˜¯ 7ã€‚</p>
<p>æˆ‘çš„é”™è¯¯åœ¨äºæ¡ä»¶åˆ¤æ–­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> node.Val &lt; low || node.Val &gt; high &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªåˆ¤æ–­æ¡ä»¶æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><strong>é”™è¯¯çš„ä¸ç­‰å·æ–¹å‘</strong>ï¼šæ ¹æ®äºŒå‰æœç´¢æ ‘çš„å®šä¹‰ï¼Œå·¦å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹åº”è¯¥<strong>å°äº</strong>å½“å‰èŠ‚ç‚¹ï¼Œå³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹åº”è¯¥<strong>å¤§äº</strong>å½“å‰èŠ‚ç‚¹ã€‚è€Œæˆ‘ä½¿ç”¨çš„æ¡ä»¶æ˜¯æ£€æŸ¥èŠ‚ç‚¹å€¼æ˜¯å¦åœ¨èŒƒå›´ [low, high] ä¹‹å†…ï¼Œè¿™ä¸é¢˜ç›®è¦æ±‚ä¸ç¬¦ã€‚</li>
<li><strong>æ²¡æœ‰å¤„ç†ç›¸ç­‰çš„æƒ…å†µ</strong>ï¼šäºŒå‰æœç´¢æ ‘ä¸å…è®¸å‡ºç°ç›¸ç­‰çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå½“æ£€æŸ¥å³å­æ ‘æ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹å€¼å¿…é¡»ä¸¥æ ¼å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œè€Œæˆ‘çš„åˆ¤æ–­æ¡ä»¶å¹¶æ²¡æœ‰æ’é™¤ç­‰äºçˆ¶èŠ‚ç‚¹å€¼çš„æƒ…å†µã€‚</li>
</ol>
<p>åœ¨æµ‹è¯•ç”¨ä¾‹ [5,4,6,null,null,3,7] ä¸­ï¼ŒèŠ‚ç‚¹ 6 çš„å·¦å­èŠ‚ç‚¹æ˜¯ 3ï¼Œè¿™è¿åäº†äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ï¼ˆ6çš„å·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½åº”è¯¥å¤§äº5ä¸”å°äº6ï¼‰ï¼Œä½†æˆ‘çš„è§£æ³•æ²¡æœ‰æ­£ç¡®è¯†åˆ«è¿™ä¸ªé”™è¯¯ã€‚</p>
<h2 id="æ­£ç¡®è§£æ³•">æ­£ç¡®è§£æ³•</h2>
<p>ç»è¿‡åˆ†æï¼Œæˆ‘æ”¹è¿›çš„è§£æ³•æ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isValidBST</span><span class="params">(root *TreeNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> helplerIsValidBST(root, math.MinInt64, math.MaxInt64)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helplerIsValidBST</span><span class="params">(node *TreeNode, low, high <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// âœ“ ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç¡®ä¿ä¸¥æ ¼å¤§äºå°äºå…³ç³»</span></span><br><span class="line">    <span class="keyword">if</span> node.Val &lt;= low || node.Val &gt;= high &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> helplerIsValidBST(node.Left, low, node.Val) &amp;&amp; </span><br><span class="line">           helplerIsValidBST(node.Right, node.Val, high)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ">ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ</h3>
<p>ä¿®æ­£åçš„ä»£ç ä½¿ç”¨äº†æ­£ç¡®çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> node.Val &lt;= low || node.Val &gt;= high &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ¡ä»¶åˆ¤æ–­çš„å«ä¹‰æ˜¯ï¼š</p>
<ol>
<li><code>node.Val &lt;= low</code> æ£€æŸ¥å½“å‰èŠ‚ç‚¹å€¼æ˜¯å¦å°äºç­‰äºä¸‹ç•Œï¼Œå¦‚æœæ˜¯ï¼Œè¿åäº†BSTæ€§è´¨</li>
<li><code>node.Val &gt;= high</code> æ£€æŸ¥å½“å‰èŠ‚ç‚¹å€¼æ˜¯å¦å¤§äºç­‰äºä¸Šç•Œï¼Œå¦‚æœæ˜¯ï¼ŒåŒæ ·è¿åäº†BSTæ€§è´¨</li>
</ol>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬ç¡®ä¿äº†ï¼š</p>
<ul>
<li>å·¦å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å€¼å¿…é¡»<strong>ä¸¥æ ¼å°äº</strong>å½“å‰èŠ‚ç‚¹å€¼ï¼ˆé€šè¿‡è®¾ç½®ä¸Šç•Œä¸ºå½“å‰èŠ‚ç‚¹å€¼ï¼‰</li>
<li>å³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å€¼å¿…é¡»<strong>ä¸¥æ ¼å¤§äº</strong>å½“å‰èŠ‚ç‚¹å€¼ï¼ˆé€šè¿‡è®¾ç½®ä¸‹ç•Œä¸ºå½“å‰èŠ‚ç‚¹å€¼ï¼‰</li>
<li>æ•´ä¸ªæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å€¼éƒ½å¿…é¡»ä¸¥æ ¼éµå¾ªå®ƒçš„æœ‰æ•ˆèŒƒå›´</li>
</ul>
<p>å¯¹äºæµ‹è¯•ç”¨ä¾‹ [5,4,6,null,null,3,7]ï¼š</p>
<ul>
<li>æ ¹èŠ‚ç‚¹ 5 çš„æœ‰æ•ˆèŒƒå›´æ˜¯ (-âˆ, +âˆ)</li>
<li>èŠ‚ç‚¹ 4 çš„æœ‰æ•ˆèŒƒå›´æ˜¯ (-âˆ, 5)</li>
<li>èŠ‚ç‚¹ 6 çš„æœ‰æ•ˆèŒƒå›´æ˜¯ (5, +âˆ)</li>
<li>èŠ‚ç‚¹ 3 çš„æœ‰æ•ˆèŒƒå›´æ˜¯ (5, 6)ï¼Œä½† 3 &lt; 5ï¼Œæ‰€ä»¥ä¸åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼Œè¿”å› false</li>
</ul>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>é€šè¿‡è¿™ä¸ªé”™è¯¯ï¼Œæˆ‘å­¦åˆ°äº†å‡ ä¸ªé‡è¦çš„æ•™è®­ï¼š</p>
<ol>
<li><strong>ç†è§£é—®é¢˜å®šä¹‰çš„é‡è¦æ€§</strong>ï¼šäºŒå‰æœç´¢æ ‘å®šä¹‰ä¸­çš„&quot;å¤§äº&quot;å’Œ&quot;å°äº&quot;æ˜¯ä¸¥æ ¼çš„ä¸ç­‰å…³ç³»ï¼Œä¸åŒ…å«ç­‰äºçš„æƒ…å†µã€‚</li>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šåœ¨å¤„ç†æ¯”è¾ƒå…³ç³»æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„æ˜¯ä½¿ç”¨ä¸¥æ ¼ä¸ç­‰å¼ï¼ˆ&lt; å’Œ &gt;ï¼‰è¿˜æ˜¯éä¸¥æ ¼ä¸ç­‰å¼ï¼ˆ&lt;= å’Œ &gt;=ï¼‰ã€‚</li>
<li><strong>é€’å½’è¾¹ç•Œçš„è®¾ç½®</strong>ï¼šåœ¨é€’å½’æ£€æŸ¥äºŒå‰æœç´¢æ ‘æ—¶ï¼Œé€šè¿‡åˆé€‚çš„ä¸Šä¸‹ç•Œè®¾ç½®æ˜¯ç¡®ä¿æ­£ç¡®æ€§çš„å…³é”®ã€‚</li>
<li><strong>æµ‹è¯•ç”¨ä¾‹åˆ†æ</strong>ï¼šç‰¹æ®Šç»“æ„çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆå¦‚åŒ…å«ç‰¹å®šè·¯å¾„ä¸Šçš„å€¼ï¼‰å¯ä»¥å¸®åŠ©å‘ç°ç®—æ³•ä¸­çš„ç¼ºé™·ã€‚</li>
</ol>
<p>è¿™ä¸ªé”™è¯¯æé†’æˆ‘åœ¨å®ç°ç®—æ³•æ—¶è¦ä»”ç»†å®¡é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰ç‰¹å®šå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œè¦ç¡®ä¿å®ç°ç¬¦åˆå…¶ç²¾ç¡®å®šä¹‰ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>é€’å½’</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>âŒ LeetCode 543 - äºŒå‰æ ‘çš„ç›´å¾„</title>
    <url>/2025/04/29/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-543-Binary-Tree-Diameter/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œè¿”å›è¯¥æ ‘çš„<strong>ç›´å¾„</strong>ã€‚</p>
<p>äºŒå‰æ ‘çš„<strong>ç›´å¾„</strong>æ˜¯æŒ‡æ ‘ä¸­ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´æœ€é•¿è·¯å¾„çš„<strong>é•¿åº¦</strong>ã€‚è¿™æ¡è·¯å¾„å¯èƒ½ç»è¿‡ä¹Ÿå¯èƒ½ä¸ç»è¿‡æ ¹èŠ‚ç‚¹ rootã€‚</p>
<p>ä¸¤èŠ‚ç‚¹ä¹‹é—´è·¯å¾„çš„<strong>é•¿åº¦</strong>ç”±å®ƒä»¬ä¹‹é—´è¾¹æ•°è¡¨ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \</span><br><span class="line">4   5</span><br></pre></td></tr></table></figure>
<p><strong>è¾“å…¥ï¼š</strong> root = [1,2,3,4,5]<br>
<strong>è¾“å‡ºï¼š</strong> 3<br>
<strong>è§£é‡Šï¼š</strong> ç›´å¾„ä¸º 3ï¼Œå–è·¯å¾„ [4,2,1,3] æˆ– [5,2,1,3] çš„é•¿åº¦ã€‚</p>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  1</span><br><span class="line"> /</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p><strong>è¾“å…¥ï¼š</strong> root = [1,2]<br>
<strong>è¾“å‡ºï¼š</strong> 1</p>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [1, 10^4] å†…</li>
<li>-100 &lt;= Node.val &lt;= 100</li>
</ul>
<h2 id="é”™è¯¯è§£æ³•ä¸åˆ†æ">é”™è¯¯è§£æ³•ä¸åˆ†æ</h2>
<p>æˆ‘æœ€åˆå¯¹è¿™ä¸ªé—®é¢˜çš„ç†è§£æ˜¯è®¡ç®—æ ‘çš„é«˜åº¦ï¼Œè€Œæ²¡æœ‰è€ƒè™‘åˆ°ç›´å¾„çš„ç‰¹æ®Šæ€§è´¨ã€‚æˆ‘çš„åˆå§‹æ€è·¯æ˜¯é€šè¿‡è®¡ç®—æ ‘çš„æœ€å¤§æ·±åº¦æ¥è§£å†³é—®é¢˜ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯æ€è·¯ï¼šä»…è®¡ç®—æ ‘çš„é«˜åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">diameterOfBinaryTree</span><span class="params">(root *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    leftHeight := maxDepth(root.Left)</span><br><span class="line">    rightHeight := maxDepth(root.Right)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> leftHeight + rightHeight <span class="comment">// é”™è¯¯ï¼šæ²¡æœ‰ä¸å½“å‰å·²çŸ¥æœ€å¤§ç›´å¾„åšæ¯”è¾ƒ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxDepth</span><span class="params">(root *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> max(maxDepth(root.Left), maxDepth(root.Right)) + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè§£æ³•åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¤±è´¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  1</span><br><span class="line"> / \</span><br><span class="line">2   3</span><br><span class="line">   / \</span><br><span class="line">  4   5</span><br><span class="line">     / \</span><br><span class="line">    6   7</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åŸå› åˆ†æ">é”™è¯¯åŸå› åˆ†æ</h3>
<p>æˆ‘çš„é”™è¯¯åœ¨äºï¼š</p>
<ol>
<li><strong>æ²¡æœ‰ç†è§£ç›´å¾„çš„å®Œæ•´å®šä¹‰</strong>ï¼šç›´å¾„æ˜¯æ ‘ä¸­ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æœ€é•¿è·¯å¾„ï¼Œè¿™ä¸ä¸€å®šç©¿è¿‡æ ¹èŠ‚ç‚¹ã€‚</li>
<li><strong>åªè®¡ç®—äº†æ ¹èŠ‚ç‚¹çš„æœ€å¤§æ·±åº¦</strong>ï¼šæˆ‘åªè®¡ç®—äº†ä»æ ¹èŠ‚ç‚¹å‡ºå‘çš„å·¦å³å­æ ‘æ·±åº¦å’Œï¼Œä½†æ²¡æœ‰è€ƒè™‘åˆ°ç›´å¾„å¯èƒ½å®Œå…¨å­˜åœ¨äºå·¦å­æ ‘æˆ–å³å­æ ‘ä¸­ã€‚</li>
<li><strong>ç¼ºä¹å…¨å±€è§†è§’</strong>ï¼šæ²¡æœ‰åœ¨é€’å½’è¿‡ç¨‹ä¸­ç»´æŠ¤å…¨å±€çš„æœ€å¤§ç›´å¾„å€¼ï¼Œå¯¼è‡´æ— æ³•æ¯”è¾ƒä¸åŒå­æ ‘ä¸­å¯èƒ½çš„ç›´å¾„ã€‚</li>
</ol>
<p>æœ€å…³é”®çš„é”™è¯¯æ˜¯æ²¡æœ‰è®¤è¯†åˆ°ï¼š<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½æ˜¯ç›´å¾„è·¯å¾„çš„&quot;æ‹ç‚¹&quot;</strong>ï¼Œéœ€è¦æ¯”è¾ƒæ‰€æœ‰å¯èƒ½çš„è·¯å¾„é•¿åº¦æ¥æ‰¾åˆ°æœ€å¤§ç›´å¾„ã€‚</p>
<h2 id="æ­£ç¡®è§£æ³•">æ­£ç¡®è§£æ³•</h2>
<p>ç»è¿‡åˆ†æï¼Œæ”¹è¿›çš„è§£æ³•æ˜¯ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰ï¼Œåœ¨é€’å½’è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„é«˜åº¦çš„åŒæ—¶ï¼Œæ›´æ–°å…¨å±€æœ€å¤§ç›´å¾„å€¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">diameterOfBinaryTree</span><span class="params">(root *TreeNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    res := <span class="number">0</span></span><br><span class="line">    dfsDiameterOfBinaryTree(root, &amp;res)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsDiameterOfBinaryTree</span><span class="params">(node *TreeNode, res *<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// é€’å½’è®¡ç®—å·¦å³å­æ ‘çš„æ·±åº¦</span></span><br><span class="line">    leftDepth := dfsDiameterOfBinaryTree(node.Left, res)</span><br><span class="line">    rightDepth := dfsDiameterOfBinaryTree(node.Right, res)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ›´æ–°å…¨å±€æœ€å¤§ç›´å¾„ï¼ˆå·¦å­æ ‘æ·±åº¦ + å³å­æ ‘æ·±åº¦ï¼‰</span></span><br><span class="line">    *res = max(*res, leftDepth + rightDepth)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è¿”å›å½“å‰èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘çš„æœ€å¤§æ·±åº¦</span></span><br><span class="line">    <span class="keyword">return</span> max(leftDepth, rightDepth) + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ">ä¸ºä»€ä¹ˆè¿™ä¸ªè§£æ³•å¯ä»¥å·¥ä½œ</h3>
<ol>
<li><strong>ä½¿ç”¨DFSè®¡ç®—æ·±åº¦</strong>ï¼šé€šè¿‡æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘æ·±åº¦ã€‚</li>
<li><strong>å…¨å±€å˜é‡è®°å½•æœ€å¤§ç›´å¾„</strong>ï¼šä½¿ç”¨æŒ‡é’ˆ <code>res</code> åœ¨é€’å½’è¿‡ç¨‹ä¸­æŒç»­æ›´æ–°æœ€å¤§ç›´å¾„å€¼ã€‚</li>
<li><strong>æ¯”è¾ƒæ¯ä¸ªå¯èƒ½çš„&quot;æ‹ç‚¹&quot;</strong>ï¼šå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬è®¡ç®—:
<ul>
<li>å½“å‰èŠ‚ç‚¹ä½œä¸º&quot;æ‹ç‚¹&quot;çš„è·¯å¾„é•¿åº¦ = å·¦å­æ ‘æ·±åº¦ + å³å­æ ‘æ·±åº¦</li>
<li>å°†è¿™ä¸ªå€¼ä¸å·²çŸ¥çš„æœ€å¤§ç›´å¾„æ¯”è¾ƒå¹¶æ›´æ–°</li>
</ul>
</li>
</ol>
<p>è¿™ç§æ–¹æ³•èƒ½å¤Ÿè€ƒè™‘åˆ°æ‰€æœ‰å¯èƒ½çš„è·¯å¾„ï¼ŒåŒ…æ‹¬ä¸ç»è¿‡æ ¹èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä»è€Œæ‰¾åˆ°çœŸæ­£çš„æœ€å¤§ç›´å¾„ã€‚</p>
<h2 id="ç®—æ³•å¯è§†åŒ–">ç®—æ³•å¯è§†åŒ–</h2>
<p>è€ƒè™‘ä¸‹é¢çš„äºŒå‰æ ‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \</span><br><span class="line">4   5</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä»æ ¹èŠ‚ç‚¹ 1 å¼€å§‹DFS</li>
<li>è®¡ç®—èŠ‚ç‚¹ 2 çš„æ·±åº¦:
<ul>
<li>èŠ‚ç‚¹ 4 æ·±åº¦ = 1</li>
<li>èŠ‚ç‚¹ 5 æ·±åº¦ = 1</li>
<li>èŠ‚ç‚¹ 2 çš„å·¦å³å­æ ‘æœ€å¤§æ·±åº¦å’Œ = 1 + 1 = 2</li>
<li>æ›´æ–°æœ€å¤§ç›´å¾„ res = 2</li>
</ul>
</li>
<li>è®¡ç®—èŠ‚ç‚¹ 3 çš„æ·±åº¦:
<ul>
<li>èŠ‚ç‚¹ 3 æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œæ·±åº¦ = 1</li>
</ul>
</li>
<li>æ ¹èŠ‚ç‚¹ 1 çš„å·¦å³å­æ ‘æœ€å¤§æ·±åº¦å’Œ = 2 + 1 = 3
<ul>
<li>æ›´æ–°æœ€å¤§ç›´å¾„ res = 3</li>
</ul>
</li>
</ol>
<p>æœ€ç»ˆè¿”å›æœ€å¤§ç›´å¾„ 3ï¼Œå¯¹åº”è·¯å¾„ [4,2,1,3] æˆ– [5,2,1,3]ã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ã€‚æ¯ä¸ªèŠ‚ç‚¹åªè¢«è®¿é—®ä¸€æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(h)ï¼Œå…¶ä¸­ h æ˜¯æ ‘çš„é«˜åº¦ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆæ ‘å‘ˆçº¿æ€§ï¼‰ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(n)ã€‚</li>
</ul>
<h2 id="å­¦ä¹ æ€»ç»“">å­¦ä¹ æ€»ç»“</h2>
<p>é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘å­¦åˆ°äº†ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li><strong>æ ‘çš„ç›´å¾„ç‰¹æ€§</strong>ï¼šæ ‘çš„ç›´å¾„ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ï¼Œå¯èƒ½å­˜åœ¨äºä»»æ„å­æ ‘ä¸­ã€‚</li>
<li><strong>DFSçš„å·§å¦™åº”ç”¨</strong>ï¼šåœ¨è®¡ç®—èŠ‚ç‚¹é«˜åº¦çš„åŒæ—¶ï¼Œå¯ä»¥é¡ºä¾¿è§£å†³å…¶å®ƒé—®é¢˜ã€‚</li>
<li><strong>å…¨å±€å˜é‡åœ¨é€’å½’ä¸­çš„ä½¿ç”¨</strong>ï¼šé€šè¿‡ä¼ é€’æŒ‡é’ˆï¼Œåœ¨é€’å½’è¿‡ç¨‹ä¸­ç»´æŠ¤å…¨å±€çŠ¶æ€ã€‚</li>
<li><strong>é—®é¢˜è½¬åŒ–æ€æƒ³</strong>ï¼šå°†ç›´å¾„é—®é¢˜è½¬åŒ–ä¸º&quot;ä»¥æ¯ä¸ªèŠ‚ç‚¹ä¸ºæ‹ç‚¹çš„æœ€é•¿è·¯å¾„&quot;é—®é¢˜ã€‚</li>
</ol>
<p>è¿™ä¸ªé—®é¢˜æé†’æˆ‘ï¼Œåœ¨è§£å†³æ ‘ç›¸å…³é—®é¢˜æ—¶ï¼Œè¦æ³¨æ„è€ƒè™‘å¯èƒ½çš„è·¯å¾„æ˜¯å¦éœ€è¦ç»è¿‡æ ¹èŠ‚ç‚¹ï¼Œä»¥åŠå¦‚ä½•åœ¨é€’å½’è¿‡ç¨‹ä¸­é«˜æ•ˆåœ°æ”¶é›†å’Œæ›´æ–°å…¨å±€ä¿¡æ¯ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>âŒé”™é¢˜é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>InnoDBçš„æ•°æ®é¡µ</title>
    <url>/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/</url>
    <content><![CDATA[<h2 id="InnoDB-æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿ">InnoDB æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿ</h2>
<p>InnoDB çš„è®°å½•æ˜¯æŒ‰ç…§è¡Œæ¥å­˜å‚¨çš„ï¼Œä½†æ˜¯æ•°æ®åº“çš„è¯»å–å¹¶ä¸ä»¥ã€Œè¡Œã€ä¸ºå•ä½ï¼Œå¦åˆ™ä¸€æ¬¡è¯»å–ï¼ˆä¹Ÿå°±æ˜¯ä¸€æ¬¡ I/O æ“ä½œï¼‰åªèƒ½å¤„ç†ä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡ä¼šéå¸¸ä½ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>InnoDB çš„æ•°æ®æ˜¯æŒ‰ã€Œæ•°æ®é¡µã€ä¸ºå•ä½æ¥è¯»å†™çš„</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦è¯»ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å°†è¿™ä¸ªè®°å½•æœ¬èº«ä»ç£ç›˜è¯»å‡ºæ¥ï¼Œè€Œæ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œå°†å…¶æ•´ä½“è¯»å…¥å†…å­˜ã€‚</p>
<p>æ•°æ®åº“çš„ I/O æ“ä½œçš„æœ€å°å•ä½æ˜¯é¡µï¼Œ<strong>InnoDB æ•°æ®é¡µçš„é»˜è®¤å¤§å°æ˜¯ 16KB</strong>ï¼Œæ„å‘³ç€æ•°æ®åº“æ¯æ¬¡è¯»å†™éƒ½æ˜¯ä»¥ 16KB ä¸ºå•ä½çš„ï¼Œä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å– 16K çš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„ 16K å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚</p>
<p>æ•°æ®é¡µåŒ…æ‹¬ä¸ƒä¸ªéƒ¨åˆ†ï¼Œç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/1745856192760.png" alt="1745856192760"></p>
<p>è¿™ä¸ƒä¸ªéƒ¨åˆ†çš„ä½œç”¨å¦‚ä¸‹è¡¨:</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å¤§å°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>File Headerï¼ˆæ–‡ä»¶å¤´ï¼‰</td>
<td>38 B</td>
<td>å­˜å‚¨é¡µçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚é¡µå·ã€æ ¡éªŒå’Œç­‰</td>
</tr>
<tr>
<td>Page Headerï¼ˆé¡µå¤´ï¼‰</td>
<td>56 B</td>
<td>å­˜å‚¨é¡µçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚è®°å½•æ•°ã€ç©ºé—²ç©ºé—´ç­‰</td>
</tr>
<tr>
<td>Infimum &amp; Supremumï¼ˆæœ€å°/æœ€å¤§è®°å½•ï¼‰</td>
<td>26 B</td>
<td>ä¸¤æ¡è™šæ‹Ÿè®°å½•ï¼Œåˆ†åˆ«ä»£è¡¨é¡µå†…æœ€å°å’Œæœ€å¤§è®°å½•</td>
</tr>
<tr>
<td>User Recordsï¼ˆç”¨æˆ·è®°å½•ï¼‰</td>
<td>ä¸å®š</td>
<td>å®é™…å­˜å‚¨çš„è¡Œè®°å½•å†…å®¹</td>
</tr>
<tr>
<td>Free Spaceï¼ˆç©ºé—²ç©ºé—´ï¼‰</td>
<td>ä¸å®š</td>
<td>å°šæœªè¢«ä½¿ç”¨çš„ç©ºé—´ï¼Œç”¨äºæ’å…¥æ–°è®°å½•</td>
</tr>
<tr>
<td>Page Directoryï¼ˆé¡µç›®å½•ï¼‰</td>
<td>ä¸å®š</td>
<td>å­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼Œä¾¿äºå¿«é€Ÿå®šä½è®°å½•</td>
</tr>
<tr>
<td>File Trailerï¼ˆæ–‡ä»¶å°¾ï¼‰</td>
<td>8 B</td>
<td>ç”¨äºæ ¡éªŒé¡µçš„å®Œæ•´æ€§</td>
</tr>
</tbody>
</table>
<p>åœ¨ File Header ä¸­æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ä¸Šä¸€ä¸ªæ•°æ®é¡µå’Œä¸‹ä¸€ä¸ªæ•°æ®é¡µï¼Œé“¾æ¥èµ·æ¥çš„é¡µç›¸å½“äºä¸€ä¸ªåŒå‘çš„é“¾è¡¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/1745856807064.png" alt="1745856807064"></p>
<p>é‡‡ç”¨é“¾è¡¨çš„ç»“æ„æ˜¯è®©æ•°æ®é¡µä¹‹é—´ä¸éœ€è¦æ˜¯ç‰©ç†ä¸Šçš„è¿ç»­çš„ï¼Œè€Œæ˜¯é€»è¾‘ä¸Šçš„è¿ç»­ã€‚</p>
<hr>
<p>æ•°æ®é¡µçš„ä¸»è¦ä½œç”¨æ˜¯å­˜å‚¨è®°å½•ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åº“çš„æ•°æ®ï¼Œæ‰€ä»¥é‡ç‚¹è¯´ä¸€ä¸‹æ•°æ®é¡µä¸­çš„ User Records æ˜¯æ€ä¹ˆç»„ç»‡æ•°æ®çš„ã€‚</p>
<p><strong>æ•°æ®é¡µä¸­çš„è®°å½•æŒ‰ç…§ã€Œä¸»é”®ã€é¡ºåºç»„æˆå•å‘é“¾è¡¨</strong>ï¼Œå•å‘é“¾è¡¨çš„ç‰¹ç‚¹å°±æ˜¯æ’å…¥ã€åˆ é™¤éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯æ£€ç´¢æ•ˆç‡ä¸é«˜ï¼Œæœ€å·®çš„æƒ…å†µä¸‹éœ€è¦éå†é“¾è¡¨ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹æ‰èƒ½å®Œæˆæ£€ç´¢ã€‚</p>
<p>å› æ­¤ï¼Œæ•°æ®é¡µä¸­æœ‰ä¸€ä¸ª<strong>é¡µç›®å½•</strong>ï¼Œèµ·åˆ°è®°å½•çš„ç´¢å¼•ä½œç”¨ï¼Œå°±åƒæˆ‘ä»¬ä¹¦é‚£æ ·ï¼Œé’ˆå¯¹ä¹¦ä¸­å†…å®¹çš„æ¯ä¸ªç« èŠ‚è®¾ç«‹äº†ä¸€ä¸ªç›®å½•ï¼Œæƒ³çœ‹æŸä¸ªç« èŠ‚çš„æ—¶å€™ï¼Œå¯ä»¥æŸ¥çœ‹ç›®å½•ï¼Œå¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„ç« èŠ‚çš„é¡µæ•°ï¼Œè€Œæ•°æ®é¡µä¸­çš„é¡µç›®å½•å°±æ˜¯ä¸ºäº†èƒ½å¿«é€Ÿæ‰¾åˆ°è®°å½•ã€‚</p>
<p>é¡µç›®å½•ä¸è®°å½•çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/1745856959162.png" alt="1745856959162"></p>
<p>é¡µç›®å½•çš„åˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹:</p>
<ol>
<li>å°†æ‰€æœ‰çš„çºªå½•åˆ’åˆ†ä¸ºå‡ ç»„ï¼Œè¿™äº›è®°å½•åŒ…æ‹¬<strong>æœ€å°è®°å½•</strong>å’Œ<strong>æœ€å¤§è®°å½•</strong>ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬æ ‡è®°ä¸º<strong>å·²åˆ é™¤</strong>çš„è®°å½•</li>
<li>æ¯ä¸ªè®°å½•ç»„çš„æœ€åä¸€æ¡è®°å½•å°±æ˜¯ç»„å†…æœ€å¤§çš„é‚£æ¡è®°å½•ï¼Œå¹¶ä¸”æœ€åä¸€æ¡è®°å½•çš„å¤´ä¿¡æ¯ä¸­ä¼šå­˜å‚¨è¯¥ç»„ä¸€å…±æœ‰å¤šå°‘æ¡è®°å½•ï¼Œä½œä¸º <code>n_owned</code>å­—æ®µï¼ˆä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„ç²‰çº¢è‰²å­—æ®µï¼‰</li>
<li>é¡µç›®å½•çš„ä½œç”¨æ˜¯åŠ å¿«åœ¨æ•°æ®é¡µä¸­æŸ¥æ‰¾è®°å½•çš„é€Ÿåº¦ã€‚å®ƒçš„å®ç°æ–¹å¼æ˜¯ï¼šå°†æ¯ä¸€ç»„çš„æœ€åä¸€æ¡è®°å½•çš„åœ°å€ï¼ˆå‡†ç¡®æ¥è¯´æ˜¯è¯¥è®°å½•åœ¨æ•°æ®é¡µä¸­çš„åç§»é‡ï¼‰ä¿å­˜ä¸‹æ¥ï¼Œè¿™äº›åœ°å€åç§»é‡ä¼šæŒ‰ç…§è®°å½•åœ¨æ•°æ®é¡µä¸­çš„é¡ºåºä¾æ¬¡æ’åˆ—ã€‚æ¯ä¸€ä¸ªåç§»é‡è¢«ç§°ä¸ºä¸€ä¸ªâ€œæ§½â€ï¼ˆslotï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å¯¹åº”ç»„çš„æœ€åä¸€æ¡è®°å½•ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾æŸæ¡è®°å½•æ—¶ï¼Œå¯ä»¥å…ˆé€šè¿‡é¡µç›®å½•å¿«é€Ÿå®šä½åˆ°å¯èƒ½æ‰€åœ¨çš„è®°å½•ç»„ï¼Œç„¶ååœ¨è¯¥ç»„å†…è¿›è¡Œéå†æŸ¥æ‰¾ï¼Œå¤§å¤§å‡å°‘äº†éœ€è¦éå†çš„è®°å½•æ•°é‡ï¼Œæé«˜äº†æŸ¥æ‰¾æ•ˆç‡ã€‚é¡µç›®å½•æœ¬èº«é€šå¸¸å­˜å‚¨åœ¨æ•°æ®é¡µçš„å°¾éƒ¨ï¼Œéšç€ç”¨æˆ·è®°å½•çš„æ’å…¥å’Œåˆ é™¤ï¼Œé¡µç›®å½•ä¸­çš„æ§½æ•°é‡å’Œå†…å®¹ä¹Ÿä¼šåŠ¨æ€å˜åŒ–ã€‚</li>
</ol>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé¡µç›®å½•å°±æ˜¯ç”±å¤šä¸ªæ§½ç»„æˆçš„ï¼Œæ§½ç›¸å½“äºåˆ†ç»„è®°å½•çš„ç´¢å¼•ã€‚ç„¶åï¼Œå› ä¸ºè®°å½•æ˜¯æŒ‰ç…§ã€Œä¸»é”®å€¼ã€ä»å°åˆ°å¤§æ’åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ§½æŸ¥æ‰¾è®°å½•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½è¦æŸ¥è¯¢çš„è®°å½•åœ¨å“ªä¸ªæ§½(å“ªä¸ªè®°å½•åˆ†ç»„),å®šä½åˆ°æ§½åï¼Œå†éå†æ§½å†…çš„æ‰€æœ‰è®°å½•ï¼Œæ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œæ— éœ€ä»æœ€å°çºªå½•å¼€å§‹éå†æ•´ä¸ªé¡µä¸­çš„è®°å½•é“¾è¡¨ã€‚</p>
<p>ä»¥ä¸Šé¢é‚£å¼ å›¾ä¸¾ä¸ªä¾‹å­ï¼Œ5 ä¸ªæ§½çš„ç¼–å·åˆ†åˆ«ä¸º 0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œæˆ‘æƒ³æŸ¥æ‰¾ä¸»é”®ä¸º 11 çš„ç”¨æˆ·è®°å½•ï¼š</p>
<ul>
<li>å…ˆäºŒåˆ†å¾—å‡ºæ§½ä¸­é—´ä½æ˜¯ (0+4)/2=2ï¼Œ2 å·æ§½é‡Œæœ€å¤§çš„è®°å½•ä¸º 8ã€‚å› ä¸º 11 &gt; 8ï¼Œæ‰€ä»¥éœ€è¦ä» 2 å·æ§½åç»§ç»­æœç´¢è®°å½•ï¼›</li>
<li>å†ä½¿ç”¨äºŒåˆ†æœç´¢å‡º 2 å·å’Œ 4 å·æ§½çš„ä¸­é—´ä½æ˜¯ (2+4)/2= 3ï¼Œ3 å·æ§½é‡Œæœ€å¤§çš„è®°å½•ä¸º 12ã€‚å› ä¸º 11 &lt; 12ï¼Œæ‰€ä»¥ä¸»é”®ä¸º 11 çš„è®°å½•åœ¨ 3 å·æ§½é‡Œï¼›</li>
<li>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œ<strong>ã€Œæ§½å¯¹åº”çš„å€¼éƒ½æ˜¯è¿™ä¸ªç»„çš„ä¸»é”®æœ€å¤§çš„è®°å½•ï¼Œå¦‚ä½•æ‰¾åˆ°ç»„é‡Œæœ€å°çš„è®°å½•ã€</strong>ï¼Ÿæ¯”å¦‚æ§½ 3 å¯¹åº”æœ€å¤§ä¸»é”®æ˜¯ 12 çš„è®°å½•ï¼Œé‚£å¦‚ä½•æ‰¾åˆ°æœ€å°è®°å½• 9ã€‚è§£å†³åŠæ³•æ˜¯ï¼šé€šè¿‡æ§½ 3 æ‰¾åˆ° æ§½ 2 å¯¹åº”çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯ä¸»é”®ä¸º 8 çš„è®°å½•ã€‚ä¸»é”®ä¸º 8 çš„è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯æ§½ 3 å½“ä¸­ä¸»é”®æœ€å°çš„ 9 è®°å½•ï¼Œç„¶åå¼€å§‹å‘ä¸‹æœç´¢ 2 æ¬¡ï¼Œå®šä½åˆ°ä¸»é”®ä¸º 11 çš„è®°å½•ï¼Œå–å‡ºè¯¥æ¡è®°å½•çš„ä¿¡æ¯å³ä¸ºæˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾çš„å†…å®¹ã€‚</li>
</ul>
<p>çœ‹åˆ°ç¬¬ä¸‰æ­¥çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰çš„åŒå­¦ä¼šç–‘é—®ï¼Œå¦‚æœæŸä¸ªæ§½å†…çš„è®°å½•å¾ˆå¤šï¼Œç„¶åå› ä¸ºè®°å½•éƒ½æ˜¯å•å‘é“¾è¡¨ä¸²èµ·æ¥çš„ï¼Œé‚£è¿™æ ·åœ¨æ§½å†…æŸ¥æ‰¾æŸä¸ªè®°å½•çš„æ—¶é—´å¤æ‚åº¦ä¸å°±æ˜¯ O(n) äº†å—ï¼Ÿ</p>
<p>è¿™ç‚¹ä¸ç”¨æ‹…å¿ƒï¼ŒInnoDB å¯¹æ¯ä¸ªåˆ†ç»„ä¸­çš„è®°å½•æ¡æ•°éƒ½æ˜¯æœ‰è§„å®šçš„ï¼Œæ§½å†…çš„è®°å½•å°±åªæœ‰å‡ æ¡ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªåˆ†ç»„ä¸­çš„è®°å½•åªèƒ½æœ‰ 1 æ¡è®°å½•ï¼›</li>
<li>æœ€åä¸€ä¸ªåˆ†ç»„ä¸­çš„è®°å½•æ¡æ•°èŒƒå›´åªèƒ½åœ¨ 1-8 æ¡ä¹‹é—´ï¼›</li>
<li>å‰©ä¸‹çš„åˆ†ç»„ä¸­è®°å½•æ¡æ•°èŒƒå›´åªèƒ½åœ¨ 4-8 æ¡ä¹‹é—´ã€‚</li>
</ul>
<h2 id="B-æ ‘çš„æŸ¥è¯¢æ–¹å¼">B+æ ‘çš„æŸ¥è¯¢æ–¹å¼</h2>
<p>ä¸Šé¢æˆ‘ä»¬è¯´çš„éƒ½æ˜¯åœ¨ä¸€ä¸ªæ•°æ®é¡µå†…æŸ¥æ‰¾è®°å½•ï¼Œå› ä¸ºä¸€ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•æ˜¯æœ‰é™çš„ï¼Œä¸”ä¸»é”®å€¼æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥é€šè¿‡å¯¹æ‰€æœ‰è®°å½•è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå°†ç»„å·(æ§½å·)å­˜å‚¨åˆ°é¡µç›®å½•ï¼Œä½¿å…¶èµ·åˆ°ç´¢å¼•ä½œç”¨ï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾åˆ°æ–¹æ³•å¿«é€Ÿæ£€ç´¢åˆ°è®°å½•åœ¨å“ªä¸ªåˆ†ç»„ï¼Œæ¥é™ä½æ£€ç´¢çš„æ—¶é—´å¤æ‚åº¦ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬éœ€è¦å­˜å‚¨å¤§é‡çš„è®°å½•æ—¶ï¼Œå°±éœ€è¦å¤šä¸ªæ•°æ®é¡µï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦è€ƒè™‘å¦‚ä½•å»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œæ‰èƒ½æ–¹ä¾¿å®šä½è®°å½•æ‰€åœ¨çš„é¡µã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒInnoDB é‡‡ç”¨äº† B+ æ ‘çš„ç»“æ„æ¥å­˜å‚¨è®°å½•ã€‚ç£ç›˜çš„ I/O æ“ä½œæ¬¡æ•°å¯¹ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡è‡³å…³é‡è¦ï¼Œå› æ­¤åœ¨æ„é€ ç´¢å¼•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›´åŠ å€¾å‘äºé‡‡ç”¨çŸ®èƒ–çš„&quot;B+æ ‘&quot;ç»“æ„ï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§å‡å°‘ç£ç›˜çš„ I/O æ“ä½œæ¬¡æ•°ï¼Œè€Œä¸” B+æ ‘æ›´åŠ é€‚åˆè¿›è¡Œå…³é”®å­—çš„èŒƒå›´æŸ¥è¯¢</p>
<p>InnoDB ä¸­çš„ B+æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µï¼Œç»“æ„ç¤ºæ„å¦‚ä¸‹:</p>
<p><img src="/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/1745913438020.png" alt="1745913438020"></p>
<p>é€šè¿‡ä¸Šå›¾ï¼Œæˆ‘ä»¬çœ‹å‡º B+ æ ‘çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>åªæœ‰å¶å­èŠ‚ç‚¹ï¼ˆæœ€åº•å±‚çš„èŠ‚ç‚¹ï¼‰æ‰å­˜æ”¾äº†æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹ï¼ˆå…¶ä»–ä¸Šå±‚èŠ‚ï¼‰ä»…ç”¨æ¥å­˜æ”¾ç›®å½•é¡¹ä½œä¸ºç´¢å¼•ã€‚</li>
<li>éå¶å­èŠ‚ç‚¹åˆ†ä¸ºä¸åŒå±‚æ¬¡ï¼Œé€šè¿‡åˆ†å±‚æ¥é™ä½æ¯ä¸€å±‚çš„æœç´¢é‡ï¼›</li>
<li>æ‰€æœ‰èŠ‚ç‚¹æŒ‰ç…§ç´¢å¼•é”®å¤§å°æ’åºï¼Œæ„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œä¾¿äºèŒƒå›´æŸ¥è¯¢ï¼›</li>
</ul>
<p>æˆ‘ä»¬å†çœ‹çœ‹ B+ æ ‘å¦‚ä½•å®ç°å¿«é€ŸæŸ¥æ‰¾ä¸»é”®ä¸º 6 çš„è®°å½•ï¼Œä»¥ä¸Šå›¾ä¸ºä¾‹å­ï¼š</p>
<ul>
<li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°ç¬¦åˆé¡µå†…èŒƒå›´åŒ…å«æŸ¥è¯¢å€¼çš„é¡µï¼Œå› ä¸ºæŸ¥è¯¢çš„ä¸»é”®å€¼ä¸º 6ï¼Œåœ¨[1, 7) èŒƒå›´ä¹‹é—´ï¼Œæ‰€ä»¥åˆ°é¡µ 30 ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„ç›®å½•é¡¹ï¼›</li>
<li>åœ¨éå¶å­èŠ‚ç‚¹ï¼ˆé¡µ 30ï¼‰ä¸­ï¼Œç»§ç»­é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°ç¬¦åˆé¡µå†…èŒƒå›´åŒ…å«æŸ¥è¯¢å€¼çš„é¡µï¼Œä¸»é”®å€¼å¤§äº 5ï¼Œæ‰€ä»¥å°±åˆ°å¶å­èŠ‚ç‚¹ï¼ˆé¡µ 16ï¼‰æŸ¥æ‰¾è®°å½•ï¼›</li>
<li>æ¥ç€ï¼Œåœ¨å¶å­èŠ‚ç‚¹ï¼ˆé¡µ 16ï¼‰ä¸­ï¼Œé€šè¿‡æ§½æŸ¥æ‰¾è®°å½•æ—¶ï¼Œä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½è¦æŸ¥è¯¢çš„è®°å½•åœ¨å“ªä¸ªæ§½ï¼ˆå“ªä¸ªè®°å½•åˆ†ç»„ï¼‰ï¼Œå®šä½åˆ°æ§½åï¼Œå†éå†æ§½å†…çš„æ‰€æœ‰è®°å½•ï¼Œæ‰¾åˆ°ä¸»é”®ä¸º 6 çš„è®°å½•ã€‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®šä½è®°å½•æ‰€åœ¨å“ªä¸€ä¸ªé¡µæ—¶ï¼Œä¹Ÿæ˜¯é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°åŒ…å«è¯¥è®°å½•çš„é¡µã€‚å®šä½åˆ°è¯¥é¡µåï¼Œåˆä¼šåœ¨è¯¥é¡µå†…è¿›è¡ŒäºŒåˆ†æ³•å¿«é€Ÿå®šä½è®°å½•æ‰€åœ¨çš„åˆ†ç»„ï¼ˆæ§½å·ï¼‰ï¼Œæœ€ååœ¨åˆ†ç»„å†…è¿›è¡Œéå†æŸ¥æ‰¾ã€‚</p>
<h2 id="èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•">èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•</h2>
<p>å¦å¤–ï¼Œç´¢å¼•åˆå¯ä»¥åˆ†æˆèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰ï¼Œå®ƒä»¬åŒºåˆ«å°±åœ¨äºå¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä»€ä¹ˆæ•°æ®ï¼š</p>
<ul>
<li>èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼Œæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ï¼›</li>
<li>äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯å®é™…æ•°æ®ã€‚</li>
</ul>
<p>å› ä¸ºè¡¨çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹é‡Œï¼Œæ‰€ä»¥ InnoDB å­˜å‚¨å¼•æ“ä¸€å®šä¼šä¸ºè¡¨åˆ›å»ºä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸”ç”±äºæ•°æ®åœ¨ç‰©ç†ä¸Šåªä¼šä¿å­˜ä¸€ä»½ï¼Œæ‰€ä»¥èšç°‡ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ªã€‚</p>
<p>InnoDB åœ¨åˆ›å»ºèšç°‡ç´¢å¼•æ—¶ï¼Œä¼šæ ¹æ®ä¸åŒçš„åœºæ™¯é€‰æ‹©ä¸åŒçš„åˆ—ä½œä¸ºç´¢å¼•ï¼š</p>
<ul>
<li>å¦‚æœæœ‰ä¸»é”®ï¼Œé»˜è®¤ä¼šä½¿ç”¨ä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼›</li>
<li>å¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œå°±é€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å« NULL å€¼çš„å”¯ä¸€åˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼›</li>
<li>åœ¨ä¸Šé¢ä¸¤ä¸ªéƒ½æ²¡æœ‰çš„æƒ…å†µä¸‹ï¼ŒInnoDB å°†è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšå¼è‡ªå¢ id åˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼›</li>
</ul>
<p>ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œé‚£ä¸ºäº†å®ç°éä¸»é”®å­—æ®µçš„å¿«é€Ÿæœç´¢ï¼Œå°±å¼•å‡ºäº†äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•/è¾…åŠ©ç´¢å¼•ï¼‰ï¼Œå®ƒä¹Ÿæ˜¯åˆ©ç”¨äº† B+ æ ‘çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œä¸æ˜¯å®é™…æ•°æ®ã€‚</p>
<p>äºŒçº§ç´¢å¼•çš„ B+ æ ‘å¦‚ä¸‹å›¾ï¼Œæ•°æ®éƒ¨åˆ†ä¸ºä¸»é”®å€¼ï¼š</p>
<p><img src="/2025/04/28/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/InnoDB%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5/1745913985845.png" alt="1745913985845"></p>
<p>å› æ­¤ï¼Œ<strong>å¦‚æœæŸä¸ªæŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†äºŒçº§ç´¢å¼•ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ•°æ®ä¸æ˜¯ä¸»é”®å€¼ï¼Œè¿™æ—¶åœ¨äºŒçº§ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼åï¼Œéœ€è¦å»èšç°‡ç´¢å¼•ä¸­è·å¾—æ•°æ®è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«ä½œã€Œå›è¡¨ã€ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æŸ¥ä¸¤ä¸ª B+ æ ‘æ‰èƒ½æŸ¥åˆ°æ•°æ®ã€‚ä¸è¿‡ï¼Œå½“æŸ¥è¯¢çš„æ•°æ®æ˜¯ä¸»é”®å€¼æ—¶ï¼Œå› ä¸ºåªåœ¨äºŒçº§ç´¢å¼•å°±èƒ½æŸ¥è¯¢åˆ°ï¼Œä¸ç”¨å†å»èšç°‡ç´¢å¼•æŸ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«ä½œã€Œç´¢å¼•è¦†ç›–ã€ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦æŸ¥ä¸€ä¸ª B+ æ ‘å°±èƒ½æ‰¾åˆ°æ•°æ®ã€‚</strong></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>InnoDB çš„æ•°æ®æ˜¯æŒ‰ã€Œæ•°æ®é¡µã€ä¸ºå•ä½æ¥è¯»å†™çš„ï¼Œé»˜è®¤æ•°æ®é¡µå¤§å°ä¸º 16 KBã€‚æ¯ä¸ªæ•°æ®é¡µä¹‹é—´é€šè¿‡åŒå‘é“¾è¡¨çš„å½¢å¼ç»„ç»‡èµ·æ¥ï¼Œç‰©ç†ä¸Šä¸è¿ç»­ï¼Œä½†æ˜¯é€»è¾‘ä¸Šè¿ç»­ã€‚</p>
<p>æ•°æ®é¡µå†…åŒ…å«ç”¨æˆ·è®°å½•ï¼Œæ¯ä¸ªè®°å½•ä¹‹é—´ç”¨å•å‘é“¾è¡¨çš„æ–¹å¼ç»„ç»‡èµ·æ¥ï¼Œä¸ºäº†åŠ å¿«åœ¨æ•°æ®é¡µå†…é«˜æ•ˆæŸ¥è¯¢è®°å½•ï¼Œè®¾è®¡äº†ä¸€ä¸ªé¡µç›®å½•ï¼Œé¡µç›®å½•å­˜å‚¨å„ä¸ªæ§½ï¼ˆåˆ†ç»„ï¼‰ï¼Œä¸”ä¸»é”®å€¼æ˜¯æœ‰åºçš„ï¼Œäºæ˜¯å¯ä»¥é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•çš„æ–¹å¼è¿›è¡Œæ£€ç´¢ä»è€Œæé«˜æ•ˆç‡ã€‚</p>
<p>ä¸ºäº†é«˜æ•ˆæŸ¥è¯¢è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µï¼ŒInnoDB é‡‡ç”¨ b+ æ ‘ä½œä¸ºç´¢å¼•ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µã€‚</p>
<p>å¦‚æœå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å®é™…æ•°æ®çš„å°±æ˜¯èšç°‡ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼›å¦‚æœå¶å­èŠ‚ç‚¹å­˜å‚¨çš„ä¸æ˜¯å®é™…æ•°æ®ï¼Œè€Œæ˜¯ä¸»é”®å€¼åˆ™å°±æ˜¯äºŒçº§ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨ä¸­å¯ä»¥æœ‰å¤šä¸ªäºŒçº§ç´¢å¼•ã€‚</p>
<p>åœ¨ä½¿ç”¨äºŒçº§ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾æ•°æ®æ—¶ï¼Œå¦‚æœæŸ¥è¯¢çš„æ•°æ®èƒ½åœ¨äºŒçº§ç´¢å¼•æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±æ˜¯ã€Œç´¢å¼•è¦†ç›–ã€æ“ä½œï¼Œå¦‚æœæŸ¥è¯¢çš„æ•°æ®ä¸åœ¨äºŒçº§ç´¢å¼•é‡Œï¼Œå°±éœ€è¦å…ˆåœ¨äºŒçº§ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼ï¼Œéœ€è¦å»èšç°‡ç´¢å¼•ä¸­è·å¾—æ•°æ®è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«ä½œã€Œå›è¡¨ã€ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>ç´¢å¼•</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>MySQL</tag>
        <tag>InnoDB</tag>
        <tag>ç´¢å¼•</tag>
        <tag>æ•°æ®é¡µ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 101 - å¯¹ç§°äºŒå‰æ ‘ï¼ˆSymmetric Treeï¼‰</title>
    <url>/2025/04/28/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-101-Symmetric-Tree/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code>ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦è½´å¯¹ç§°ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼š">ç¤ºä¾‹ 1ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   2</span><br><span class="line"> / \ / \</span><br><span class="line">3  4 4  3</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥ï¼š<code>root = [1,2,2,3,4,4,3]</code><br>
è¾“å‡ºï¼š<code>true</code></p>
<h3 id="ç¤ºä¾‹-2ï¼š">ç¤ºä¾‹ 2ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  1</span><br><span class="line"> / \</span><br><span class="line">2   2</span><br><span class="line"> \   \</span><br><span class="line"> 3    3</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥ï¼š<code>root = [1,2,2,null,3,null,3]</code><br>
è¾“å‡ºï¼š<code>false</code></p>
<h3 id="æç¤ºï¼š">æç¤ºï¼š</h3>
<ul>
<li>æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ <code>[1, 1000]</code> å†…</li>
<li><code>-100 &lt;= Node.val &lt;= 100</code></li>
</ul>
<p><strong>è¿›é˜¶</strong>ï¼šä½ å¯ä»¥è¿ç”¨é€’å½’å’Œè¿­ä»£ä¸¤ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>å¯¹äºäºŒå‰æ ‘çš„å¯¹ç§°æ€§é—®é¢˜ï¼Œæœ¬è´¨ä¸Šæ˜¯åˆ¤æ–­äºŒå‰æ ‘çš„å·¦å­æ ‘å’Œå³å­æ ‘æ˜¯å¦äº’ä¸ºé•œåƒã€‚ä¸¤ä¸ªæ ‘äº’ä¸ºé•œåƒå½“ä¸”ä»…å½“ï¼š</p>
<ol>
<li>å®ƒä»¬çš„æ ¹èŠ‚ç‚¹çš„å€¼ç›¸ç­‰</li>
<li>æ¯ä¸ªæ ‘çš„å·¦å­æ ‘å’Œå¦ä¸€ä¸ªæ ‘çš„å³å­æ ‘äº’ä¸ºé•œåƒ</li>
<li>æ¯ä¸ªæ ‘çš„å³å­æ ‘å’Œå¦ä¸€ä¸ªæ ‘çš„å·¦å­æ ‘äº’ä¸ºé•œåƒ</li>
</ol>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è§£å†³ï¼š<strong>é€’å½’</strong>å’Œ<strong>è¿­ä»£</strong>ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šé€’å½’">æ–¹æ³•ä¸€ï¼šé€’å½’</h3>
<p>é€’å½’æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»¥é€’å½’çš„æ–¹å¼æ£€æŸ¥æ ‘çš„å¯¹ç§°æ€§ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼ŒåŒæ—¶éå†å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œè¿›è¡Œå¿…è¦çš„å¯¹ç§°æ¯”è¾ƒã€‚</p>
<p><strong>é€’å½’æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>å¦‚æœå·¦èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹éƒ½ä¸ºç©ºï¼Œè¿”å› <code>true</code></li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œè¿”å› <code>false</code></li>
<li>å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼ä¸ç›¸ç­‰ï¼Œè¿”å› <code>false</code></li>
<li>é€’å½’æ£€æŸ¥ï¼š
<ul>
<li>å·¦èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸å³èŠ‚ç‚¹çš„å³å­æ ‘æ˜¯å¦å¯¹ç§°</li>
<li>å·¦èŠ‚ç‚¹çš„å³å­æ ‘ä¸å³èŠ‚ç‚¹çš„å·¦å­æ ‘æ˜¯å¦å¯¹ç§°</li>
</ul>
</li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šè¿­ä»£ï¼ˆä½¿ç”¨é˜Ÿåˆ—ï¼‰">æ–¹æ³•äºŒï¼šè¿­ä»£ï¼ˆä½¿ç”¨é˜Ÿåˆ—ï¼‰</h3>
<p>è¿­ä»£æ–¹æ³•ä½¿ç”¨é˜Ÿåˆ—æ¥æ¨¡æ‹Ÿé€’å½’è¿‡ç¨‹ã€‚æˆ‘ä»¬å°†éœ€è¦æ¯”è¾ƒçš„èŠ‚ç‚¹å¯¹ä¾æ¬¡æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶åé€å¯¹å–å‡ºè¿›è¡Œæ¯”è¾ƒã€‚</p>
<p><strong>è¿­ä»£æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆå§‹åŒ–é˜Ÿåˆ—ï¼Œæ”¾å…¥æ ¹èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹</li>
<li>å½“é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼š
<ul>
<li>å–å‡ºä¸¤ä¸ªèŠ‚ç‚¹</li>
<li>å¦‚æœéƒ½ä¸ºç©ºï¼Œç»§ç»­ä¸‹ä¸€è½®å¾ªç¯</li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªä¸ºç©ºæˆ–å€¼ä¸ç›¸ç­‰ï¼Œè¿”å› <code>false</code></li>
<li>å°†å·¦èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹æ”¾å…¥é˜Ÿåˆ—</li>
<li>å°†å·¦èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹æ”¾å…¥é˜Ÿåˆ—</li>
</ul>
</li>
<li>é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè¿”å› <code>true</code></li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="é€’å½’å®ç°">é€’å½’å®ç°</h3>
<p>åœ¨é€’å½’å®ç°ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>dfsIsSymmetric</code>ï¼Œç”¨äºæ£€æŸ¥ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦å¯¹ç§°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSymmetric</span><span class="params">(root *TreeNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼šå¦‚æœæ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™æ ‘æ˜¯å¯¹ç§°çš„</span></span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨è¾…åŠ©å‡½æ•°æ£€æŸ¥å·¦å³å­æ ‘æ˜¯å¦å¯¹ç§°</span></span><br><span class="line">    <span class="keyword">return</span> dfsIsSymmetric(root.Left, root.Right)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsIsSymmetric</span><span class="params">(left, right *TreeNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹éƒ½ä¸ºç©ºï¼Œåˆ™å¯¹ç§°</span></span><br><span class="line">    <span class="keyword">if</span> left == <span class="literal">nil</span> &amp;&amp; right == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºè€Œå¦ä¸€ä¸ªä¸ä¸ºç©ºï¼Œåˆ™ä¸å¯¹ç§°</span></span><br><span class="line">    <span class="keyword">if</span> left == <span class="literal">nil</span> || right == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼ä¸ç›¸ç­‰ï¼Œåˆ™ä¸å¯¹ç§°</span></span><br><span class="line">    <span class="keyword">if</span> left.Val != right.Val &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// é€’å½’æ£€æŸ¥ï¼šå·¦çš„å·¦ä¸å³çš„å³å¯¹ç§°ï¼Œä¸”å·¦çš„å³ä¸å³çš„å·¦å¯¹ç§°</span></span><br><span class="line">    <span class="keyword">return</span> dfsIsSymmetric(left.Left, right.Right) &amp;&amp; dfsIsSymmetric(left.Right, right.Left)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿­ä»£å®ç°">è¿­ä»£å®ç°</h3>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨é˜Ÿåˆ—çš„è¿­ä»£å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSymmetric</span><span class="params">(root *TreeNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä½¿ç”¨é˜Ÿåˆ—è¿›è¡ŒBFS</span></span><br><span class="line">    queue := []*TreeNode&#123;root.Left, root.Right&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡å–å‡ºä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">        left := queue[<span class="number">0</span>]</span><br><span class="line">        right := queue[<span class="number">1</span>]</span><br><span class="line">        queue = queue[<span class="number">2</span>:]</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªèŠ‚ç‚¹éƒ½ä¸ºç©ºï¼Œå¯¹ç§°</span></span><br><span class="line">        <span class="keyword">if</span> left == <span class="literal">nil</span> &amp;&amp; right == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// ä¸€ä¸ªä¸ºç©ºï¼Œå¦ä¸€ä¸ªä¸ä¸ºç©ºï¼Œæˆ–å€¼ä¸ç›¸ç­‰ï¼Œä¸å¯¹ç§°</span></span><br><span class="line">        <span class="keyword">if</span> left == <span class="literal">nil</span> || right == <span class="literal">nil</span> || left.Val != right.Val &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å°†éœ€è¦æ¯”è¾ƒçš„èŠ‚ç‚¹å¯¹æ”¾å…¥é˜Ÿåˆ—ï¼šå·¦çš„å·¦ä¸å³çš„å³ï¼Œå·¦çš„å³ä¸å³çš„å·¦</span></span><br><span class="line">        queue = <span class="built_in">append</span>(queue, left.Left, right.Right)</span><br><span class="line">        queue = <span class="built_in">append</span>(queue, left.Right, right.Left)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>é€’å½’æ–¹æ³•</th>
<th>è¿­ä»£æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(h)ï¼Œhæ˜¯æ ‘çš„é«˜åº¦</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£</td>
<td>é¿å…é€’å½’æ ˆæº¢å‡ºé£é™©</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>å¯èƒ½å¯¼è‡´æ ˆæº¢å‡º</td>
<td>ä»£ç ç›¸å¯¹å¤æ‚</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šä¸¤ç§æ–¹æ³•éƒ½æ˜¯ O(n)ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚æˆ‘ä»¬éœ€è¦éå†æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œå¸¸æ•°çº§æ“ä½œã€‚</p>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>é€’å½’æ–¹æ³•ï¼šO(h)ï¼Œå…¶ä¸­ h æ˜¯æ ‘çš„é«˜åº¦ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆæ ‘æ˜¯ä¸€æ¡é“¾ï¼‰ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(n)ã€‚</li>
<li>è¿­ä»£æ–¹æ³•ï¼šO(n)ï¼Œé˜Ÿåˆ—ä¸­æœ€å¤šåŒ…å«æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>äºŒå‰æ ‘çš„é•œåƒç‰¹æ€§</strong>ï¼šç†è§£å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªæ ‘æ˜¯å¦äº’ä¸ºé•œåƒæ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®ã€‚</li>
<li><strong>é€’å½’ä¸è¿­ä»£çš„è½¬æ¢</strong>ï¼šè¿™é“é¢˜å±•ç¤ºäº†å¦‚ä½•å°†é€’å½’ç®—æ³•è½¬æ¢ä¸ºè¿­ä»£ç®—æ³•ï¼Œè¿™æ˜¯ä¸€ç§é‡è¦çš„æŠ€æœ¯ã€‚</li>
<li><strong>æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰ä¸å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰</strong>ï¼šé€’å½’å®ç°ä½¿ç”¨DFSï¼Œè€Œé˜Ÿåˆ—å®ç°ä½¿ç”¨BFSã€‚</li>
</ol>
<p>å¯¹äºåˆå­¦è€…ï¼Œå»ºè®®å…ˆç†è§£é€’å½’è§£æ³•ï¼Œå› ä¸ºå®ƒæ›´ç›´è§‚ã€‚æŒæ¡åï¼Œå†å°è¯•ç†è§£å¦‚ä½•ä½¿ç”¨é˜Ÿåˆ—çš„è¿­ä»£æ–¹æ³•å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚è¿™ç§è½¬æ¢æ€è·¯åœ¨è®¸å¤šæ ‘å’Œå›¾çš„é—®é¢˜ä¸­éƒ½éå¸¸æœ‰ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ ‘</category>
      </categories>
      <tags>
        <tag>äºŒå‰æ ‘</tag>
        <tag>é€’å½’</tag>
        <tag>è¿­ä»£</tag>
        <tag>æ·±åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>å¹¿åº¦ä¼˜å…ˆæœç´¢</tag>
        <tag>Easy</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 146 - LRU ç¼“å­˜</title>
    <url>/2025/04/27/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-146-LRU-Cache/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³ LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜çº¦æŸçš„æ•°æ®ç»“æ„ã€‚</p>
<p>å®ç° <code>LRUCache</code> ç±»ï¼š</p>
<ul>
<li><code>LRUCache(int capacity)</code> - ä»¥æ­£æ•´æ•°ä½œä¸ºå®¹é‡ capacity åˆå§‹åŒ– LRU ç¼“å­˜</li>
<li><code>int get(int key)</code> - å¦‚æœå…³é”®å­— key å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› -1ã€‚</li>
<li><code>void put(int key, int value)</code> - å¦‚æœå…³é”®å­— key å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ valueï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„ key-valueã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡ capacityï¼Œåˆ™åº”è¯¥é€å‡ºæœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚</li>
</ul>
<p>å‡½æ•° <code>get</code> å’Œ <code>put</code> å¿…é¡»ä»¥ <strong>O(1)</strong> çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥</span><br><span class="line">[&quot;LRUCache&quot;, &quot;put&quot;, &quot;put&quot;, &quot;get&quot;, &quot;put&quot;, &quot;get&quot;, &quot;put&quot;, &quot;get&quot;, &quot;get&quot;, &quot;get&quot;]</span><br><span class="line">[[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]</span><br><span class="line">è¾“å‡º</span><br><span class="line">[null, null, null, 1, null, -1, null, -1, 3, 4]</span><br><span class="line"></span><br><span class="line">è§£é‡Š</span><br><span class="line">LRUCache lRUCache = new LRUCache(2);  // ç¼“å­˜å®¹é‡ä¸º 2</span><br><span class="line">lRUCache.put(1, 1);                    // ç¼“å­˜æ˜¯ &#123;1=1&#125;</span><br><span class="line">lRUCache.put(2, 2);                    // ç¼“å­˜æ˜¯ &#123;1=1, 2=2&#125;</span><br><span class="line">lRUCache.get(1);                       // è¿”å› 1</span><br><span class="line">lRUCache.put(3, 3);                    // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 2 ä½œåºŸï¼Œç¼“å­˜æ˜¯ &#123;1=1, 3=3&#125;</span><br><span class="line">lRUCache.get(2);                       // è¿”å› -1 (æœªæ‰¾åˆ°)</span><br><span class="line">lRUCache.put(4, 4);                    // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 1 ä½œåºŸï¼Œç¼“å­˜æ˜¯ &#123;4=4, 3=3&#125;</span><br><span class="line">lRUCache.get(1);                       // è¿”å› -1 (æœªæ‰¾åˆ°)</span><br><span class="line">lRUCache.get(3);                       // è¿”å› 3</span><br><span class="line">lRUCache.get(4);                       // è¿”å› 4</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸ</strong>:</p>
<ul>
<li>1 &lt;= capacity &lt;= 3000</li>
<li>0 &lt;= key &lt;= 10000</li>
<li>0 &lt;= value &lt;= 10^5</li>
<li>æœ€å¤šè°ƒç”¨ 2 * 10^5 æ¬¡ get å’Œ put</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>LRU (Least Recently Used) ç¼“å­˜æ˜¯ä¸€ç§å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼Œå®ƒåŸºäº&quot;æœ€è¿‘æœ€å°‘ä½¿ç”¨&quot;çš„åŸåˆ™æ¥ç®¡ç†ç¼“å­˜ç©ºé—´ã€‚è¦å®ç° LRU ç¼“å­˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ï¼š</p>
<ol>
<li><strong>å“ˆå¸Œè¡¨</strong>ï¼šç”¨äº O(1) æ—¶é—´å¤æ‚åº¦æŸ¥æ‰¾é”®å€¼å¯¹</li>
<li><strong>åŒå‘é“¾è¡¨</strong>ï¼šç”¨äºç»´æŠ¤ç¼“å­˜é¡¹çš„ä½¿ç”¨é¡ºåº</li>
</ol>
<p><strong>å…³é”®æ€è·¯</strong>ï¼š</p>
<ul>
<li>åŒå‘é“¾è¡¨æŒ‰ç…§ä½¿ç”¨é¡ºåºå­˜å‚¨ç¼“å­˜é¡¹ï¼Œé“¾è¡¨å¤´éƒ¨æ˜¯æœ€è¿‘ä½¿ç”¨çš„ï¼Œå°¾éƒ¨æ˜¯æœ€ä¹…æœªä½¿ç”¨çš„</li>
<li>å“ˆå¸Œè¡¨ä»¥ key ä¸ºé”®ï¼Œé“¾è¡¨èŠ‚ç‚¹ä¸ºå€¼ï¼Œç”¨äºå¿«é€Ÿå®šä½é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</li>
<li>æ¯å½“ç¼“å­˜è¢«è®¿é—®ï¼ˆget æˆ– put æ“ä½œï¼‰ï¼Œå°†å¯¹åº”èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨</li>
<li>å½“ç¼“å­˜æ»¡æ—¶ï¼Œç§»é™¤é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹ï¼ˆæœ€ä¹…æœªä½¿ç”¨çš„é¡¹ï¼‰</li>
</ul>
<p>ä¸‹é¢æ˜¯ LRU ç¼“å­˜æ“ä½œçš„æµç¨‹å›¾ç¤ºæ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> åŒå‘é“¾è¡¨ï¼ˆä½¿ç”¨é¡ºåºä»å·¦åˆ°å³ï¼šæœ€è¿‘ä½¿ç”¨ â†’ æœ€ä¹…æœªä½¿ç”¨ï¼‰</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  HEAD â†” Node1 â†” Node2 â†” ... â†” NodeN â†” TAIL    â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">      â–²</span><br><span class="line">      â”‚</span><br><span class="line">      â”‚ å¿«é€Ÿå®šä½</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  HashMap  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>æˆ‘ä»¬ä½¿ç”¨ Golang å®ç° LRU ç¼“å­˜ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>å®šä¹‰åŒå‘é“¾è¡¨èŠ‚ç‚¹ç»“æ„ <code>DLinkedNode</code>ï¼ŒåŒ…å« keyã€value å’ŒæŒ‡å‘å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆ</li>
<li>å®šä¹‰ LRU ç¼“å­˜ç»“æ„ <code>LRUCache</code>ï¼ŒåŒ…å«å®¹é‡ã€å¤§å°ã€å“ˆå¸Œè¡¨å’ŒåŒå‘é“¾è¡¨çš„å¤´å°¾èŠ‚ç‚¹</li>
<li>å®ç° <code>Constructor</code> å‡½æ•°åˆå§‹åŒ– LRU ç¼“å­˜</li>
<li>å®ç° <code>Get</code> æ–¹æ³•æŒ‰é”®è·å–å€¼å¹¶æ›´æ–°ä½¿ç”¨é¡ºåº</li>
<li>å®ç° <code>Put</code> æ–¹æ³•æ·»åŠ æˆ–æ›´æ–°é”®å€¼å¯¹ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„é¡¹</li>
</ol>
<p>å…³é”®å®ç°ç»†èŠ‚ï¼š</p>
<ul>
<li>ä½¿ç”¨å“ˆå¸Œè¡¨ï¼ˆmapï¼‰å­˜å‚¨ key åˆ°èŠ‚ç‚¹çš„æ˜ å°„ï¼Œå®ç° O(1) æŸ¥æ‰¾</li>
<li>åŒå‘é“¾è¡¨ç”¨äºè¿½è¸ªå…ƒç´ çš„ä½¿ç”¨é¡ºåºï¼Œæ–°èŠ‚ç‚¹æˆ–è¢«è®¿é—®çš„èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨</li>
<li>åˆ›å»ºä¸¤ä¸ªä¼ªèŠ‚ç‚¹ï¼ˆhead å’Œ tailï¼‰ç®€åŒ–è¾¹ç•Œæƒ…å†µå¤„ç†</li>
<li>æ¯æ¬¡è®¿é—®èŠ‚ç‚¹ï¼ˆGet æˆ– Put æ“ä½œï¼‰æ—¶ï¼Œå°†èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨</li>
<li>å½“ç¼“å­˜æ»¡æ—¶ï¼Œç§»é™¤é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹ï¼ˆæœ€ä¹…æœªä½¿ç”¨çš„é¡¹ï¼‰</li>
</ul>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>ä¸‹é¢æ˜¯å®Œæ•´çš„ Golang å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> DLinkedNode <span class="keyword">struct</span> &#123;</span><br><span class="line">	key, value <span class="type">int</span></span><br><span class="line">	prev, next *DLinkedNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LRUCache <span class="keyword">struct</span> &#123;</span><br><span class="line">	capacity   <span class="type">int</span></span><br><span class="line">	size       <span class="type">int</span></span><br><span class="line">	cache      <span class="keyword">map</span>[<span class="type">int</span>]*DLinkedNode</span><br><span class="line">	head, tail *DLinkedNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(capacity <span class="type">int</span>)</span></span> LRUCache &#123;</span><br><span class="line">	tmp := LRUCache&#123;</span><br><span class="line">		capacity: capacity,</span><br><span class="line">		size:     <span class="number">0</span>,</span><br><span class="line">		cache:    <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]*DLinkedNode),</span><br><span class="line">		head:     &amp;DLinkedNode&#123;&#125;,</span><br><span class="line">		tail:     &amp;DLinkedNode&#123;&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	tmp.head.next = tmp.tail</span><br><span class="line">	tmp.tail.prev = tmp.head</span><br><span class="line">	<span class="keyword">return</span> tmp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *LRUCache)</span></span> Get(key <span class="type">int</span>) <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// æ‰¾ä¸åˆ°å°±è¿”å›-1</span></span><br><span class="line">	<span class="keyword">if</span> _, ok := this.cache[key]; !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ‰¾åˆ°å°±æŠŠè¿™ä¸ªcacheæ›´æ–°åˆ°é¦–éƒ¨</span></span><br><span class="line">	cur := this.cache[key]</span><br><span class="line">	cur.prev.next = cur.next</span><br><span class="line">	cur.next.prev = cur.prev</span><br><span class="line">	cur.next = this.head.next</span><br><span class="line">	cur.prev = this.head</span><br><span class="line">	this.head.next.prev = cur</span><br><span class="line">	this.head.next = cur</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> cur.value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *LRUCache)</span></span> Put(key <span class="type">int</span>, value <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="comment">// æœ‰å°±ç›´æ¥æ›´æ–°</span></span><br><span class="line">	<span class="keyword">if</span> _, ok := this.cache[key]; ok &#123;</span><br><span class="line">		cur := this.cache[key]</span><br><span class="line">		<span class="comment">// æ–­æ‰å’Œä¹‹å‰ä½ç½®çš„é“¾æ¥</span></span><br><span class="line">		cur.prev.next = cur.next</span><br><span class="line">		cur.next.prev = cur.prev</span><br><span class="line">		<span class="comment">// è¿ä¸Šæ–°çš„ä½ç½®</span></span><br><span class="line">		cur.next = this.head.next</span><br><span class="line">		cur.prev = this.head</span><br><span class="line">		this.head.next.prev = cur</span><br><span class="line">		this.head.next = cur</span><br><span class="line">		cur.value = value</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cur := &amp;DLinkedNode&#123;</span><br><span class="line">		key:   key,</span><br><span class="line">		value: value,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> this.size &gt;= this.capacity &#123;</span><br><span class="line">		lastElement := this.tail.prev</span><br><span class="line">		lastElement.prev.next = lastElement.next</span><br><span class="line">		lastElement.next.prev = lastElement.prev</span><br><span class="line">		<span class="built_in">delete</span>(this.cache, lastElement.key)</span><br><span class="line">		this.size--</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cur.next = this.head.next</span><br><span class="line">	cur.prev = this.head</span><br><span class="line">	this.head.next.prev = cur</span><br><span class="line">	this.head.next = cur</span><br><span class="line"></span><br><span class="line">	this.cache[key] = cur</span><br><span class="line">	this.size++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li><code>Get</code> æ“ä½œï¼šO(1)ï¼Œå“ˆå¸Œè¡¨æŸ¥æ‰¾æ˜¯ O(1)ï¼Œç§»åŠ¨èŠ‚ç‚¹åˆ°é“¾è¡¨å¤´éƒ¨ä¹Ÿæ˜¯ O(1)</li>
<li><code>Put</code> æ“ä½œï¼šO(1)ï¼Œå“ˆå¸Œè¡¨æŸ¥æ‰¾/æ’å…¥æ˜¯ O(1)ï¼Œé“¾è¡¨æ“ä½œä¹Ÿæ˜¯ O(1)</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(capacity)ï¼Œå­˜å‚¨ capacity ä¸ªé”®å€¼å¯¹éœ€è¦ O(capacity) çš„ç©ºé—´</p>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<p>é€šè¿‡å®ç° LRU ç¼“å­˜ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä»¥ä¸‹é‡è¦æ¦‚å¿µï¼š</p>
<ol>
<li><strong>æ•°æ®ç»“æ„ç»„åˆ</strong>ï¼šå“ˆå¸Œè¡¨å’ŒåŒå‘é“¾è¡¨çš„ç»„åˆå¯ä»¥åˆ›å»ºé«˜æ•ˆçš„ç¼“å­˜æœºåˆ¶</li>
<li><strong>ç¼“å­˜æ·˜æ±°ç­–ç•¥</strong>ï¼šLRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰æ˜¯ä¸€ç§å¸¸è§ä¸”æœ‰æ•ˆçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥</li>
<li><strong>åŒå‘é“¾è¡¨çš„åº”ç”¨</strong>ï¼šåŒå‘é“¾è¡¨é€‚åˆéœ€è¦é¢‘ç¹åœ¨ä»»æ„ä½ç½®æ’å…¥å’Œåˆ é™¤çš„åœºæ™¯</li>
<li><strong>è¾¹ç•Œæƒ…å†µå¤„ç†</strong>ï¼šä½¿ç”¨ä¼ªå¤´å°¾èŠ‚ç‚¹ï¼ˆdummy head/tailï¼‰å¯ä»¥ç®€åŒ–é“¾è¡¨æ“ä½œ</li>
</ol>
<p>LRU ç¼“å­˜åœ¨å®é™…åº”ç”¨ä¸­éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æµè§ˆå™¨çš„ç¼“å­˜ç®¡ç†</li>
<li>æ•°æ®åº“çš„ç¼“å­˜å±‚</li>
<li>æ“ä½œç³»ç»Ÿçš„é¡µé¢ç½®æ¢ç®—æ³•</li>
<li>åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼ˆå¦‚ Redisï¼‰ä¸­çš„æ·˜æ±°ç­–ç•¥</li>
</ul>
<p>è¿™ç§è®¾è®¡æ€æƒ³å’Œå®ç°æŠ€å·§åœ¨è®¸å¤šç³»ç»Ÿè®¾è®¡é—®é¢˜ä¸­éƒ½æœ‰åº”ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>å“ˆå¸Œ</tag>
        <tag>Medium</tag>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLç´¢å¼•ç®€ä»‹</title>
    <url>/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ">ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h2>
<p>ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ç”¨äºæé«˜æŸ¥è¯¢æ•ˆç‡çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ï¼Œå¸®åŠ©æ•°æ®åº“ç³»ç»Ÿå¿«é€Ÿå®šä½å’Œè®¿é—®æ•°æ®ã€‚åˆç†çš„ç´¢å¼•è®¾è®¡å¯ä»¥æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚</p>
<h2 id="ç´¢å¼•çš„åˆ†ç±»">ç´¢å¼•çš„åˆ†ç±»</h2>
<h3 id="æŒ‰æ•°æ®ç»“æ„åˆ†ç±»">æŒ‰æ•°æ®ç»“æ„åˆ†ç±»</h3>
<ul>
<li><strong>B+tree ç´¢å¼•</strong>ï¼šMySQL é»˜è®¤ç´¢å¼•ç±»å‹ï¼Œé€‚ç”¨äºèŒƒå›´æŸ¥è¯¢å’Œæ’åº</li>
<li><strong>Hash ç´¢å¼•</strong>ï¼šé€‚åˆç­‰å€¼æŸ¥è¯¢ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åº</li>
<li><strong>Full-text ç´¢å¼•</strong>ï¼šç”¨äºå…¨æ–‡æœç´¢ï¼Œæ”¯æŒå¤æ‚æ–‡æœ¬æŸ¥è¯¢</li>
</ul>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745568387988.png" alt="1745568387988"></p>
<h4 id="B-tree-ç´¢å¼•-InnoDB-é»˜è®¤ç´¢å¼•ç±»å‹">B+tree ç´¢å¼•(InnoDB é»˜è®¤ç´¢å¼•ç±»å‹)</h4>
<p>InnoDB æ˜¯åœ¨ MySQL 5.5 ä¹‹åæˆä¸ºé»˜è®¤çš„ MySQL å­˜å‚¨å¼•æ“ï¼ŒB+Tree ç´¢å¼•ç±»å‹ä¹Ÿæ˜¯ MySQL å­˜å‚¨å¼•æ“é‡‡ç”¨æœ€å¤šçš„ç´¢å¼•ç±»å‹ã€‚</p>
<p>åœ¨åˆ›å»ºè¡¨æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¼šæ ¹æ®ä¸åŒçš„åœºæ™¯é€‰æ‹©ä¸åŒçš„åˆ—ä½œä¸ºç´¢å¼•ï¼š</p>
<ul>
<li>å¦‚æœæœ‰ä¸»é”®ï¼Œé»˜è®¤ä¼šä½¿ç”¨ä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼ˆkeyï¼‰ï¼›</li>
<li>å¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œå°±é€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å« NULL å€¼çš„å”¯ä¸€åˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼ˆkeyï¼‰ï¼›</li>
<li>åœ¨ä¸Šé¢ä¸¤ä¸ªéƒ½æ²¡æœ‰çš„æƒ…å†µä¸‹ï¼ŒInnoDB å°†è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšå¼è‡ªå¢ id åˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼ˆkeyï¼‰ï¼›</li>
</ul>
<p>å…¶å®ƒç´¢å¼•éƒ½å±äºè¾…åŠ©ç´¢å¼•ï¼ˆSecondary Indexï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•æˆ–éèšç°‡ç´¢å¼•ã€‚<strong>åˆ›å»ºçš„ä¸»é”®ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•é»˜è®¤ä½¿ç”¨çš„æ˜¯ B+Tree ç´¢å¼•</strong>ã€‚</p>
<p>B+Tree æ˜¯ä¸€ç§å¤šå‰æ ‘ï¼Œå¶å­èŠ‚ç‚¹æ‰å­˜æ”¾æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜æ”¾ç´¢å¼•ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹é‡Œçš„æ•°æ®æ˜¯<strong>æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾</strong>çš„ã€‚æ¯ä¸€å±‚çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•å€¼éƒ½ä¼šå‡ºç°åœ¨ä¸‹å±‚å­èŠ‚ç‚¹çš„ç´¢å¼•å€¼ä¸­ï¼Œå› æ­¤åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼ŒåŒ…æ‹¬äº†æ‰€æœ‰çš„ç´¢å¼•å€¼ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½æŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå½¢æˆä¸€ä¸ªé“¾è¡¨ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå…ˆåˆ›å»ºä¸€å¼ å•†å“è¡¨ï¼Œid ä¸ºä¸»é”®ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `product`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `product_no` <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `price` <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">CHARACTER SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br></pre></td></tr></table></figure>
<p>å•†å“è¡¨é‡Œï¼Œæœ‰è¿™äº›è¡Œæ•°æ®ï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745570126359.png" alt="1745570126359"></p>
<p>ä¸»é”®ç´¢å¼•çš„ B+Tree å¦‚å›¾æ‰€ç¤º(å›¾ä¸­ç”»çš„å¶å­èŠ‚ç‚¹ç”¨å•å‘é“¾è¡¨è¿æ¥ï¼Œä½†æ˜¯æœ‰é—®é¢˜ï¼Œå®é™…ä¸Šå…¶å®æ˜¯ä¸€ä¸ª <code>&lt;font color=&quot;red&quot;&gt;</code>åŒå‘é“¾è¡¨ <code>&lt;/font&gt;</code>)ï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745570433361.png" alt="1745570433361"></p>
<h5 id="é€šè¿‡ä¸»é”®æŸ¥è¯¢æ•°æ®çš„è¿‡ç¨‹">é€šè¿‡ä¸»é”®æŸ¥è¯¢æ•°æ®çš„è¿‡ç¨‹</h5>
<p>æ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œäº†ä¸‹é¢è¿™æ¡ SQL è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ¡è¯­å¥ä½¿ç”¨äº†ä¸»é”®ç´¢å¼•æŸ¥è¯¢ id å·ä¸º 5 çš„å•†å“ã€‚æŸ¥è¯¢è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼ŒB+Tree ä¼šè‡ªé¡¶å‘ä¸‹é€å±‚è¿›è¡ŒæŸ¥æ‰¾ï¼š</p>
<ul>
<li>å°† 5 ä¸æ ¹èŠ‚ç‚¹çš„ç´¢å¼•æ•°æ® (1ï¼Œ10ï¼Œ20) æ¯”è¾ƒï¼Œ5 åœ¨ 1 å’Œ 10 ä¹‹é—´ï¼Œæ‰€ä»¥æ ¹æ® B+Tree çš„æœç´¢é€»è¾‘ï¼Œæ‰¾åˆ°ç¬¬äºŒå±‚çš„ç´¢å¼•æ•°æ® (1ï¼Œ4ï¼Œ7)ï¼›</li>
<li>åœ¨ç¬¬äºŒå±‚çš„ç´¢å¼•æ•°æ® (1ï¼Œ4ï¼Œ7) ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå› ä¸º 5 åœ¨ 4 å’Œ 7 ä¹‹é—´ï¼Œæ‰€ä»¥æ‰¾åˆ°ç¬¬ä¸‰å±‚çš„ç´¢å¼•æ•°æ®ï¼ˆ4ï¼Œ5ï¼Œ6ï¼‰ï¼›</li>
<li>åœ¨å¶å­èŠ‚ç‚¹çš„ç´¢å¼•æ•°æ®ï¼ˆ4ï¼Œ5ï¼Œ6ï¼‰ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†ç´¢å¼•å€¼ä¸º 5 çš„è¡Œæ•°æ®ã€‚</li>
</ul>
<p>æ•°æ®åº“çš„ç´¢å¼•å’Œæ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¯»å–ä¸€ä¸ªèŠ‚ç‚¹å½“ä½œä¸€æ¬¡ç£ç›˜ I/O æ“ä½œã€‚é‚£ä¹ˆä¸Šé¢çš„æ•´ä¸ªæŸ¥è¯¢è¿‡ç¨‹ä¸€å…±ç»å†äº† 3 ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œäº† 3 æ¬¡ I/O æ“ä½œã€‚</p>
<p>B+Tree å­˜å‚¨åƒä¸‡çº§çš„æ•°æ®åªéœ€è¦ 3-4 å±‚é«˜åº¦å°±å¯ä»¥æ»¡è¶³ï¼Œè¿™æ„å‘³ç€ä»åƒä¸‡çº§çš„è¡¨æŸ¥è¯¢ç›®æ ‡æ•°æ®æœ€å¤šéœ€è¦ 3-4 æ¬¡ç£ç›˜ I/Oï¼Œæ‰€ä»¥<strong>B+Tree ç›¸æ¯”äº B æ ‘å’ŒäºŒå‰æ ‘æ¥è¯´ï¼Œæœ€å¤§çš„ä¼˜åŠ¿åœ¨äºæŸ¥è¯¢æ•ˆç‡å¾ˆé«˜ï¼Œå› ä¸ºå³ä½¿åœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µï¼ŒæŸ¥è¯¢ä¸€ä¸ªæ•°æ®çš„ç£ç›˜ I/O ä¾ç„¶ç»´æŒåœ¨ 3-4 æ¬¡ã€‚</strong></p>
<h5 id="é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„è¿‡ç¨‹">é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„è¿‡ç¨‹</h5>
<blockquote>
<p>ä¸»é”®ç´¢å¼•çš„ B+Tree å’ŒäºŒçº§ç´¢å¼•çš„ B+Tree çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li>ä¸»é”®ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®</li>
<li>äºŒçº§ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼</li>
</ul>
</blockquote>
<p>å‡è®¾æˆ‘ä»¬å°†å…ˆå‰çš„å•†å“è¡¨çš„ <code>product_no</code> å­—æ®µåˆ›å»ºä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_product_no <span class="keyword">ON</span> product(product_no);</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼ŒäºŒçº§ç´¢å¼•çš„ B+Tree å¦‚å›¾æ‰€ç¤º(å›¾ä¸­ç”»çš„å¶å­èŠ‚ç‚¹ç”¨å•å‘é“¾è¡¨è¿æ¥ï¼Œä½†æ˜¯æœ‰é—®é¢˜ï¼Œå®é™…ä¸Šå…¶å®æ˜¯ä¸€ä¸ª <code>&lt;font color=&quot;red&quot;&gt;</code>åŒå‘é“¾è¡¨ <code>&lt;/font&gt;</code>)ï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745671468072.png" alt="1745671468072"></p>
<p>å…¶ä¸­éå¶å­èŠ‚ç‚¹çš„ <code>key</code>å€¼æ˜¯ <code>product_no</code>(å›¾ä¸­æ©™è‰²éƒ¨åˆ†),å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯ <code>ä¸»é”®å€¼</code>(å›¾ä¸­ç»¿è‰²éƒ¨åˆ†)</p>
<p>å¦‚æœæˆ‘ç”¨ <code>product_no</code>äºŒçº§ç´¢å¼•æŸ¥è¯¢ï¼Œå¦‚ä¸‹æŸ¥è¯¢è¯­å¥:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> product_no <span class="operator">=</span> <span class="string">&#x27;0002&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„è¯­å¥å¯ä»¥å…ˆæ£€æŸ¥äºŒçº§ç´¢å¼•ä¸­çš„ B+Tree çš„ç´¢å¼•å€¼ <code>product_no</code>ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œè·å–åˆ°ä¸»é”®å€¼ï¼Œç„¶åæ‹¿ç€ä¸»é”®å€¼å»ä¸»é”®ç´¢å¼•çš„ B+Tree ä¸­æŸ¥æ‰¾ï¼Œè·å–åˆ°å®Œæ•´çš„æ•°æ®è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹å°±å«åš<strong>å›è¡¨</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æŸ¥ä¸¤ä¸ª B+Tree æ‰èƒ½æŸ¥åˆ°æ•°æ®ï¼Œå¦‚å›¾æ‰€ç¤º(å›¾ä¸­ç”»çš„å¶å­èŠ‚ç‚¹ç”¨å•å‘é“¾è¡¨è¿æ¥ï¼Œä½†æ˜¯æœ‰é—®é¢˜ï¼Œå®é™…ä¸Šå…¶å®æ˜¯ä¸€ä¸ª <code>&lt;font color=&quot;red&quot;&gt;</code>åŒå‘é“¾è¡¨ <code>&lt;/font&gt;</code>)ã€‚</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745680784703.png" alt="1745680784703"></p>
<hr>
<p>ä¸è¿‡ï¼Œå¦‚æœæˆ‘æ‰§è¡Œçš„æŸ¥è¯¢è¯­å¥æ˜¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> product <span class="keyword">where</span> product_no <span class="operator">=</span> <span class="string">&#x27;0002&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œå› ä¸ºäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ï¼Œæ‰€ä»¥å…¶å®åªéœ€è¦æŸ¥ä¸€ä¸ª B+Tree å°±å¯ä»¥è·å–åˆ°æ•°æ®ï¼Œé‚£å°±å¯ä»¥é¿å…å›è¡¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åš<strong>è¦†ç›–ç´¢å¼•</strong>ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦æŸ¥ä¸€ä¸ª B+Tree å°±å¯ä»¥è·å–åˆ°æ•°æ®ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œæ¥é¿å…å›è¡¨ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œæ¯”å¦‚å¯¹ç»å¸¸éœ€è¦æŸ¥è¯¢çš„åˆ—å’ŒæŸ¥è¯¢æ¡ä»¶å»ºç«‹è”åˆç´¢å¼•ï¼Œå°±å¯ä»¥åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p>
</blockquote>
<h5 id="ä¸ºä»€ä¹ˆ-InnoDB-å­˜å‚¨å¼•æ“é€‰æ‹©ä½¿ç”¨-B-Tree-ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ">ä¸ºä»€ä¹ˆ InnoDB å­˜å‚¨å¼•æ“é€‰æ‹©ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ</h5>
<p>å‰é¢å·²ç»è®²äº† B+Tree çš„ç´¢å¼•åŸç†ï¼Œç°åœ¨å°±æ¥å›ç­”ä¸€ä¸‹ B+Tree ç›¸æ¯”äº B æ ‘ã€äºŒå‰æ ‘æˆ– Hash ç´¢å¼•ç»“æ„çš„ä¼˜åŠ¿åœ¨å“ªå„¿ï¼Ÿ</p>
<p><strong><em>1ã€B+Tree vs B Tree</em></strong></p>
<p>B+Tree åªåœ¨å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œè€Œ B æ ‘ çš„éå¶å­èŠ‚ç‚¹ä¹Ÿè¦å­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥ B+Tree çš„å•ä¸ªèŠ‚ç‚¹çš„æ•°æ®é‡æ›´å°ï¼Œåœ¨ç›¸åŒçš„ç£ç›˜ I/O æ¬¡æ•°ä¸‹ï¼Œå°±èƒ½æŸ¥è¯¢æ›´å¤šçš„èŠ‚ç‚¹ã€‚</p>
<p>å¦å¤–ï¼ŒB+Tree å¶å­èŠ‚ç‚¹é‡‡ç”¨çš„æ˜¯åŒé“¾è¡¨è¿æ¥ï¼Œé€‚åˆ MySQL ä¸­å¸¸è§çš„åŸºäºèŒƒå›´çš„é¡ºåºæŸ¥æ‰¾ï¼Œè€Œ B æ ‘æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p><strong><em>2ã€B+Tree vs äºŒå‰æ ‘</em></strong></p>
<p>å¯¹äºå­˜å‚¨äº† M æ¡æ•°æ®è®°å½•çš„ B+Treeï¼ˆå…¶å¶å­èŠ‚ç‚¹æ•°é‡ N ä¸ M ç›¸å…³ï¼‰ï¼Œå…¶æœç´¢å¤æ‚åº¦çº¦ä¸º <code>O(logdN)</code>ï¼Œå…¶ä¸­ d æ˜¯èŠ‚ç‚¹å…è®¸çš„æœ€å¤§å­èŠ‚ç‚¹ä¸ªæ•°ï¼ˆé˜¶æ•°ï¼‰ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œd å€¼é€šå¸¸è¿œå¤§äº 2ï¼ˆä¾‹å¦‚å¤§äº 100ï¼‰ã€‚è¿™ä¿è¯äº†å³ä½¿æ•°æ®é‡ M è¾¾åˆ°åƒä¸‡çº§åˆ«ï¼ŒB+Tree çš„é«˜åº¦ä¾ç„¶èƒ½ç»´æŒåœ¨ 3~4 å±‚å·¦å³ã€‚è¿™æ„å‘³ç€ä¸€æ¬¡æ•°æ®æŸ¥è¯¢æ“ä½œé€šå¸¸åªéœ€è¦ 3~4 æ¬¡ç£ç›˜ I/O å³å¯å®Œæˆã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¸€ä¸ªå­˜å‚¨ç›¸åŒ M æ¡æ•°æ®çš„å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œå…¶èŠ‚ç‚¹æ€»æ•°ä¹Ÿçº¦ä¸º Mï¼Œæœç´¢å¤æ‚åº¦ä¸º <code>O(logM)</code>ï¼ˆä»¥ 2 ä¸ºåº•ï¼‰ã€‚ç”±äºå…¶åˆ†æ”¯å› å­å›ºå®šä¸º 2ï¼Œæ ‘çš„é«˜åº¦ä¼šæ˜¾è‘—é«˜äº B+Treeï¼Œå¯¼è‡´æ£€ç´¢ç›®æ ‡æ•°æ®éœ€è¦ç»å†æ›´å¤šçš„ç£ç›˜ I/O æ¬¡æ•°ã€‚</p>
<p><strong><em>3, B+Tree vs Hash</em></strong></p>
<p>Hash åœ¨åšç­‰å€¼æŸ¥è¯¢çš„æ—¶å€™æ•ˆç‡è´¼å¿«ï¼Œæœç´¢å¤æ‚åº¦ä¸º O(1)ã€‚ä½†ä¹Ÿæœ‰å…¶å±€é™æ€§ï¼š</p>
<ul>
<li><strong>æ•°æ®é¡ºåºæ€§</strong>ï¼šå“ˆå¸Œè¡¨æ— æ³•æä¾›æ•°æ®çš„é¡ºåºè®¿é—®ï¼Œæ›´é€‚åˆåšç­‰å€¼çš„æŸ¥è¯¢ã€‚å¾ˆå¤šæŸ¥è¯¢ä¸ä»…éœ€è¦æ‰¾åˆ°ç‰¹å®šçš„é”®å€¼ï¼Œè¿˜éœ€è¦æ ¹æ®é”®å€¼æ’åºæ¥è¿”å›ç»“æœï¼Œæˆ–è€…æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚B+Tree å¯ä»¥å¾ˆå¥½åœ°æ”¯æŒï¼ŒHash è¡¨åˆ™æ— æ³•åšåˆ°ã€‚</li>
<li><strong>ç©ºé—´æ•ˆç‡</strong>ï¼šå¯èƒ½å¯¼è‡´ç©ºé—´åˆ©ç”¨æ•ˆç‡ä¸é«˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚æ•°æ®é‡å˜å¤§æ—¶å†²çªä¹Ÿä¼šå¢åŠ ã€‚</li>
<li><strong>éœ€è¦é‡æ–°æ„å»º</strong>ï¼šå“ˆå¸Œç´¢å¼•é€šå¸¸åªå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå½“æ•°æ®åº“é‡å¯æˆ–å‘ç”Ÿå´©æºƒæ—¶ï¼Œéœ€è¦é‡æ–°æ„å»ºã€‚</li>
</ul>
<p>å› æ­¤ï¼ŒB+Tree ç´¢å¼•è¦æ¯” Hash è¡¨ç´¢å¼•æœ‰ç€æ›´å¹¿æ³›çš„é€‚ç”¨åœºæ™¯ã€‚</p>
<h4 id="Full-text-ç´¢å¼•">Full-text ç´¢å¼•</h4>
<p>Full Text ç´¢å¼•ï¼ˆå…¨æ–‡ç´¢å¼•ï¼‰æ˜¯ MySQL ä¸­ä¸“é—¨ç”¨äºé«˜æ•ˆå¤„ç†å¤§æ–‡æœ¬å­—æ®µï¼ˆå¦‚æ–‡ç« ã€æè¿°ç­‰ï¼‰å†…å®¹æ£€ç´¢çš„ä¸€ç§ç´¢å¼•ç±»å‹ã€‚å®ƒä¸»è¦ç”¨äºåœ¨å¤§é‡æ–‡æœ¬æ•°æ®ä¸­è¿›è¡Œå¤æ‚çš„å…³é”®è¯æœç´¢ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…ã€ç›¸å…³æ€§æ’åºç­‰åŠŸèƒ½ï¼Œè¿œæ¯”ä¼ ç»Ÿçš„ LIKE è¯­å¥æ•ˆç‡é«˜ï¼Œå°¤å…¶é€‚åˆéœ€è¦å…¨æ–‡æ£€ç´¢çš„åœºæ™¯ï¼ˆå¦‚æœç´¢å¼•æ“ã€å•†å“æè¿°æœç´¢ç­‰ï¼‰ã€‚</p>
<h5 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h5>
<p>Full Text ç´¢å¼•é€šå¸¸åŸºäºå€’æ’ç´¢å¼•ï¼ˆinverted indexï¼‰å®ç°ã€‚å€’æ’ç´¢å¼•ä¼šå°†æ–‡æœ¬å†…å®¹åˆ†è¯åï¼Œå»ºç«‹&quot;å•è¯ â†’ æ–‡æ¡£ ID&quot;çš„æ˜ å°„å…³ç³»ï¼Œä»è€Œèƒ½å¿«é€Ÿå®šä½åŒ…å«æŸä¸ªå…³é”®è¯çš„æ‰€æœ‰è®°å½•ã€‚è¿™ç§ç»“æ„æå¤§æå‡äº†æ¨¡ç³ŠæŸ¥è¯¢å’Œå¤šå…³é”®è¯æ£€ç´¢çš„æ•ˆç‡ã€‚</p>
<h5 id="ä¸»è¦ç‰¹æ€§">ä¸»è¦ç‰¹æ€§</h5>
<ul>
<li>é€‚ç”¨äº <code>CHAR</code>ã€<code>VARCHAR</code>ã€<code>TEXT</code>ç­‰æ–‡æœ¬ç±»å‹å­—æ®µ</li>
<li>ä»…æ”¯æŒ InnoDB å’Œ MyISAM å­˜å‚¨å¼•æ“ï¼ˆMySQL 5.6 åŠä»¥ä¸Š InnoDB æ”¯æŒï¼‰</li>
<li>æ”¯æŒä¸‰ç§æ£€ç´¢æ¨¡å¼ï¼šè‡ªç„¶è¯­è¨€æ¨¡å¼ã€å¸ƒå°”æ¨¡å¼ã€æŸ¥è¯¢æ‰©å±•æ¨¡å¼</li>
<li>å…¸å‹ç”¨æ³•ï¼š<code>MATCH(column) AGAINST('keyword' IN NATURAL LANGUAGE MODE)</code></li>
</ul>
<h5 id="ç¤ºä¾‹">ç¤ºä¾‹</h5>
<p>åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> FULLTEXT INDEX idx_content <span class="keyword">ON</span> articles(content);</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å…¨æ–‡æ£€ç´¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(content) AGAINST(<span class="string">&#x27;æ•°æ®åº“ ç´¢å¼•&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h5 id="å‚è€ƒ">å‚è€ƒ</h5>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-search.html">MySQL å®˜æ–¹æ–‡æ¡£ï¼šå…¨æ–‡ç´¢å¼•</a></li>
<li><a href="https://blog.csdn.net/yangbindxj/article/details/122868100">CSDN: MySQL å…¨æ–‡ç´¢å¼•ç”¨é€”åŠåŸºæœ¬ä½¿ç”¨æ–¹æ³•ä»‹ç»</a></li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼ŒFull Text ç´¢å¼•è®© MySQL èƒ½å¤Ÿåƒæœç´¢å¼•æ“ä¸€æ ·é«˜æ•ˆåœ°åœ¨å¤§æ®µæ–‡æœ¬ä¸­æŸ¥æ‰¾å…³é”®è¯ï¼Œæ˜¯å¤„ç†å¤æ‚æ–‡æœ¬æ£€ç´¢çš„åˆ©å™¨ã€‚</p>
<h3 id="æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»">æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»</h3>
<ul>
<li><strong>èšé›†ç´¢å¼•</strong>ï¼šæ•°æ®å’Œä¸»é”®ç´¢å¼•å­˜å‚¨åœ¨ä¸€èµ·ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªï¼Œé€šå¸¸æ˜¯ä¸»é”®ã€‚èšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯æ•°æ®è¡Œã€‚</li>
<li><strong>äºŒçº§ç´¢å¼•</strong>ï¼šåˆç§°éèšé›†ç´¢å¼•ï¼Œå­˜å‚¨ç´¢å¼•é”®å’Œä¸»é”®å€¼ï¼Œé€šè¿‡ä¸»é”®å†æŸ¥æ‰¾æ•°æ®ï¼Œå¯ä»¥æœ‰å¤šä¸ªã€‚éèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯æ•°æ®è¡Œã€‚</li>
</ul>
<h3 id="æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»">æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»</h3>
<ul>
<li>
<p><strong>ä¸»é”®ç´¢å¼•</strong>ï¼šä¸»é”®ç´¢å¼•æ˜¯èšé›†ç´¢å¼•ï¼ˆClustered Indexï¼‰ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªï¼Œé€šå¸¸å¯¹åº”ä¸»é”®ã€‚å…¶å¶å­èŠ‚ç‚¹ç›´æ¥å­˜å‚¨å®Œæ•´çš„æ•°æ®è¡Œï¼ˆå³æ•°æ®å’Œç´¢å¼•åœ¨ä¸€èµ·ï¼‰ã€‚</p>
<p>åˆ›å»ºä¸»é”®ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `table_name` (</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å”¯ä¸€ç´¢å¼•</strong>ï¼šå”¯ä¸€ç´¢å¼•ä¹Ÿæ˜¯äºŒçº§ç´¢å¼•ï¼Œè¦æ±‚ç´¢å¼•åˆ—çš„å€¼å”¯ä¸€ã€‚å¶å­èŠ‚ç‚¹åŒæ ·å­˜å‚¨ç´¢å¼•é”®å’Œä¸»é”®å€¼ï¼Œé€šè¿‡ä¸»é”®å›è¡¨æŸ¥æ‰¾æ•°æ®ã€‚</p>
<p>åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `table_name` (</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `idx_name` (`column1`, `column2`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…å¦‚æœè¡¨å·²ç»å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> `table_name` <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> KEY `idx_name` (`column1`, `column2`);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>æ™®é€šç´¢å¼•</strong>ï¼šæ™®é€šç´¢å¼•å±äºäºŒçº§ç´¢å¼•ï¼ˆSecondary/Non-Clustered Indexï¼‰ï¼Œå¯ä»¥æœ‰å¤šä¸ªã€‚å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ç´¢å¼•é”®å’Œä¸»é”®å€¼ï¼ˆInnoDBï¼‰ï¼Œé€šè¿‡ä¸»é”®å›è¡¨æŸ¥æ‰¾å®Œæ•´æ•°æ®ã€‚</p>
<p>åˆ›å»ºæ™®é€šç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `table_name` (</span><br><span class="line">  ...</span><br><span class="line">  INDEX `idx_name` (`column1`, `column2`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…å¦‚æœè¡¨å·²ç»å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> `table_name` <span class="keyword">ADD</span> INDEX `idx_name` (`column1`, `column2`);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å‰ç¼€ç´¢å¼•</strong>ï¼šå‰ç¼€ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒçº§ç´¢å¼•ï¼Œé’ˆå¯¹å­—ç¬¦ä¸²ç±»å‹å­—æ®µï¼Œåªç´¢å¼•å­—æ®µçš„å‰ N ä¸ªå­—ç¬¦ã€‚å¶å­èŠ‚ç‚¹å­˜å‚¨å‰ç¼€ã€ä¸»é”®å€¼ï¼Œé€šè¿‡ä¸»é”®å›è¡¨æŸ¥æ‰¾æ•°æ®ã€‚</p>
<p>åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `table_name` (</span><br><span class="line">  ...</span><br><span class="line">  INDEX `idx_name` (`column_name`(N))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…å¦‚æœè¡¨å·²ç»å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> `table_name` <span class="keyword">ADD</span> INDEX `idx_name` (`column_name`(N));</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><strong>è¡¥å……è¯´æ˜</strong>ï¼š</p>
<ul>
<li>InnoDB å­˜å‚¨å¼•æ“ä¸‹ï¼Œåªæœ‰ä¸»é”®ç´¢å¼•æ˜¯èšé›†ç´¢å¼•ï¼Œå…¶ä»–ç´¢å¼•ï¼ˆæ™®é€šã€å”¯ä¸€ã€å‰ç¼€ï¼‰éƒ½æ˜¯äºŒçº§ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹éƒ½ä¸ç›´æ¥å­˜å‚¨å®Œæ•´æ•°æ®è¡Œï¼Œè€Œæ˜¯å­˜å‚¨ä¸»é”®å€¼ã€‚</li>
<li>äºŒçº§ç´¢å¼•æŸ¥æ‰¾æ•°æ®æ—¶éœ€è¦&quot;å›è¡¨&quot;ï¼Œå³å…ˆé€šè¿‡ç´¢å¼•å®šä½ä¸»é”®ï¼Œå†é€šè¿‡ä¸»é”®å®šä½æ•°æ®è¡Œã€‚</li>
</ul>
</blockquote>
<h3 id="æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»">æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»</h3>
<ul>
<li><strong>å•åˆ—ç´¢å¼•</strong>ï¼šä¸€ä¸ªç´¢å¼•åªåŒ…å«ä¸€ä¸ªåˆ—ã€‚</li>
<li><strong>è”åˆç´¢å¼•</strong>ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ã€‚</li>
</ul>
<h4 id="è”åˆç´¢å¼•">è”åˆç´¢å¼•</h4>
<p>é€šè¿‡å°†å¤šä¸ªå­—æ®µç»„åˆæˆä¸€ä¸ªç´¢å¼•ï¼Œè¯¥ç´¢å¼•å°±è¢«ç§°ä¸ºè”åˆç´¢å¼•ã€‚</p>
<p>æ¯”å¦‚ï¼Œå°†å•†å“è¡¨ä¸­çš„ product_no å’Œ name å­—æ®µç»„åˆæˆè”åˆç´¢å¼• <code>(product_no, name)</code>ï¼Œåˆ›å»ºè”åˆç´¢å¼•çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX index_product_no_name <span class="keyword">ON</span> product(product_no, name);</span><br></pre></td></tr></table></figure>
<p>è”åˆç´¢å¼• <code>(product_no, name)</code> çš„ B+Tree ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745724743165.png" alt="1745724743165"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè”åˆç´¢å¼•çš„éå¶å­èŠ‚ç‚¹ç”¨ä¸¤ä¸ªå­—æ®µçš„å€¼ä½œä¸º B+Tree çš„ key å€¼ã€‚å½“åœ¨è”åˆç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå…ˆæŒ‰ product_no å­—æ®µæ¯”è¾ƒï¼Œåœ¨ product_no ç›¸åŒçš„æƒ…å†µä¸‹å†æŒ‰ name å­—æ®µæ¯”è¾ƒã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè”åˆç´¢å¼•æŸ¥è¯¢çš„ B+Tree æ˜¯å…ˆæŒ‰ product_no è¿›è¡Œæ’åºï¼Œç„¶åå† product_no ç›¸åŒçš„æƒ…å†µå†æŒ‰ name å­—æ®µæ’åºã€‚</p>
<p>å› æ­¤ï¼Œä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå­˜åœ¨<strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong>ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ã€‚åœ¨ä½¿ç”¨è”åˆç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœä¸éµå¾ªã€Œæœ€å·¦åŒ¹é…åŸåˆ™ã€ï¼Œè”åˆç´¢å¼•ä¼šå¤±æ•ˆï¼Œè¿™æ ·å°±æ— æ³•åˆ©ç”¨åˆ°ç´¢å¼•å¿«é€ŸæŸ¥è¯¢çš„ç‰¹æ€§äº†ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¦‚æœåˆ›å»ºäº†ä¸€ä¸ª <code>(a, b, c)</code> è”åˆç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ä»¥ä¸‹è¿™å‡ ç§ï¼Œå°±å¯ä»¥åŒ¹é…ä¸Šè”åˆç´¢å¼•ï¼š</p>
<ul>
<li>where a=1.</li>
<li>where a=1 and b=2 and c=3.</li>
<li>where a=1 and b=2.</li>
<li>where a=1 and c=3.</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæœ‰æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œæ‰€ä»¥ a å­—æ®µåœ¨ where å­å¥çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ä»¥ä¸‹è¿™å‡ ç§ï¼Œå› ä¸ºä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œæ‰€ä»¥å°±æ— æ³•åŒ¹é…ä¸Šè”åˆç´¢å¼•ï¼Œè”åˆç´¢å¼•å°±ä¼šå¤±æ•ˆï¼š</p>
<ul>
<li>where b=2.</li>
<li>where c=3.</li>
<li>where b=2 and c=3.</li>
</ul>
<p>ä¸Šé¢è¿™äº›æŸ¥è¯¢æ¡ä»¶ä¹‹æ‰€ä»¥ä¼šå¤±æ•ˆï¼Œæ˜¯å› ä¸º <code>(a, b, c)</code> è”åˆç´¢å¼•ï¼Œæ˜¯å…ˆæŒ‰ a æ’åºï¼Œåœ¨ a ç›¸åŒçš„æƒ…å†µå†æŒ‰ b æ’åºï¼Œåœ¨ b ç›¸åŒçš„æƒ…å†µå†æŒ‰ c æ’åºã€‚æ‰€ä»¥ï¼Œ<strong>b å’Œ c æ˜¯å…¨å±€æ— åºï¼Œå±€éƒ¨ç›¸å¯¹æœ‰åºçš„</strong>ï¼Œè¿™æ ·åœ¨æ²¡æœ‰éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ— æ³•åˆ©ç”¨åˆ°ç´¢å¼•çš„ã€‚</p>
<p>æˆ‘è¿™é‡Œä¸¾è”åˆç´¢å¼•ï¼ˆaï¼Œbï¼‰çš„ä¾‹å­ï¼Œè¯¥è”åˆç´¢å¼•çš„ B+ Tree å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745756546799.png" alt="1745756546799"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œa æ˜¯å…¨å±€æœ‰åºçš„ï¼ˆ1, 2, 2, 3, 4, 5, 6, 7 ,8ï¼‰ï¼Œè€Œ b æ˜¯å…¨å±€æ˜¯æ— åºçš„ï¼ˆ12ï¼Œ7ï¼Œ8ï¼Œ2ï¼Œ3ï¼Œ8ï¼Œ10ï¼Œ5ï¼Œ2ï¼‰ã€‚å› æ­¤ï¼Œç›´æ¥æ‰§è¡Œ <code>where b = 2</code>è¿™ç§æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰åŠæ³•åˆ©ç”¨è”åˆç´¢å¼•çš„ï¼Œ<strong>åˆ©ç”¨ç´¢å¼•çš„å‰ææ˜¯ç´¢å¼•é‡Œçš„ key æ˜¯æœ‰åºçš„</strong>ã€‚</p>
<p>åªæœ‰åœ¨ a ç›¸åŒçš„æƒ…å†µæ‰ï¼Œb æ‰æ˜¯æœ‰åºçš„ï¼Œæ¯”å¦‚ a ç­‰äº 2 çš„æ—¶å€™ï¼Œb çš„å€¼ä¸ºï¼ˆ7ï¼Œ8ï¼‰ï¼Œè¿™æ—¶å°±æ˜¯æœ‰åºçš„ï¼Œè¿™ä¸ªæœ‰åºçŠ¶æ€æ˜¯å±€éƒ¨çš„ï¼Œå› æ­¤ï¼Œæ‰§è¡Œ <code>where a = 2 and b = 7</code>æ˜¯ a å’Œ b å­—æ®µèƒ½ç”¨åˆ°è”åˆç´¢å¼•çš„ï¼Œä¹Ÿå°±æ˜¯è”åˆç´¢å¼•ç”Ÿæ•ˆäº†ã€‚</p>
<p>è”åˆç´¢å¼•æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œ<strong>å¹¶ä¸æ˜¯æŸ¥è¯¢è¿‡ç¨‹ä½¿ç”¨äº†è”åˆç´¢å¼•æŸ¥è¯¢ï¼Œå°±ä»£è¡¨è”åˆç´¢å¼•ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢</strong>ï¼Œä¹Ÿå°±æ˜¯å¯èƒ½å­˜åœ¨éƒ¨åˆ†å­—æ®µç”¨åˆ°è”åˆç´¢å¼•çš„ B+Treeï¼Œéƒ¨åˆ†å­—æ®µæ²¡æœ‰ç”¨åˆ°è”åˆç´¢å¼•çš„ B+Tree çš„æƒ…å†µã€‚</p>
<p>è¿™ç§ç‰¹æ®Šæƒ…å†µå°±å‘ç”Ÿåœ¨èŒƒå›´æŸ¥è¯¢ã€‚è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°ã€ŒèŒƒå›´æŸ¥è¯¢ã€å°±ä¼šåœæ­¢åŒ¹é…ã€‚<strong>ä¹Ÿå°±æ˜¯èŒƒå›´æŸ¥è¯¢çš„å­—æ®µå¯ä»¥ç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†æ˜¯åœ¨èŒƒå›´æŸ¥è¯¢å­—æ®µçš„åé¢çš„å­—æ®µæ— æ³•ç”¨åˆ°è”åˆç´¢å¼•</strong>ã€‚</p>
<p>èŒƒå›´æŸ¥è¯¢æœ‰å¾ˆå¤šç§ï¼Œé‚£åˆ°åº•æ˜¯å“ªäº›èŒƒå›´æŸ¥è¯¢ä¼šå¯¼è‡´è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ä¼šåœæ­¢åŒ¹é…å‘¢ï¼Ÿ</p>
<p>æ¥ä¸‹æ¥ï¼Œä¸¾ä¾‹å‡ ä¸ªèŒƒå›´æŸ¥ä¾‹å­ã€‚</p>
<ul>
<li>
<p>Q1: <code>select * from t_table where a &gt; 1 and b = 2</code></p>
<p>ç”±äºè”åˆç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰æ˜¯å…ˆæŒ‰ç…§ a å­—æ®µçš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆ a &gt; 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»ï¼Œäºæ˜¯åœ¨è¿›è¡Œç´¢å¼•æ‰«æçš„æ—¶å€™ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆ a &gt; 1 æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆ a &gt; 1 æ¡ä»¶ä½ç½®ã€‚æ‰€ä»¥ a å­—æ®µå¯ä»¥åœ¨è”åˆç´¢å¼•çš„ B+Tree ä¸­è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚</p>
<p><strong>ä½†æ˜¯åœ¨ç¬¦åˆ a &gt; 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯æ— åºçš„</strong>ã€‚æ¯”å¦‚å‰é¢å›¾çš„è”åˆç´¢å¼•çš„ B+ Tree é‡Œï¼Œä¸‹é¢è¿™ä¸‰æ¡è®°å½•çš„ a å­—æ®µçš„å€¼éƒ½ç¬¦åˆ a &gt; 1 æŸ¥è¯¢æ¡ä»¶ï¼Œè€Œ b å­—æ®µçš„å€¼æ˜¯æ— åºçš„ï¼š</p>
<ul>
<li>a å­—æ®µå€¼ä¸º 5 çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ b å­—æ®µå€¼ä¸º 8ï¼›</li>
<li>a å­—æ®µå€¼ä¸º 6 çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ b å­—æ®µå€¼ä¸º 10ï¼›</li>
<li>a å­—æ®µå€¼ä¸º 7 çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ b å­—æ®µå€¼ä¸º 5ï¼›</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½æ ¹æ®æŸ¥è¯¢æ¡ä»¶ b = 2 æ¥è¿›ä¸€æ­¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ï¼ˆb å­—æ®µæ— æ³•åˆ©ç”¨è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢çš„æ„æ€ï¼‰ã€‚</p>
<p>æ‰€ä»¥åœ¨æ‰§è¡Œ Q1 è¿™æ¡æŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œå¯¹åº”çš„æ‰«æåŒºé—´æ˜¯ (2, + âˆ)ï¼Œå½¢æˆè¯¥æ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶æ˜¯ a &gt; 1ï¼Œä¸ b = 2 æ— å…³ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>è¿™æ¡æŸ¥è¯¢è¯­å¥åªæœ‰ a å­—æ®µç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ï¼Œè€Œ b å­—æ®µå¹¶æ²¡æœ‰ä½¿ç”¨åˆ°è”åˆç´¢å¼•</strong>ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œè®¡åˆ’ä¸­çš„ key_len çŸ¥é“è¿™ä¸€ç‚¹ï¼Œåœ¨ä½¿ç”¨è”åˆç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œé€šè¿‡ key_len æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¼˜åŒ–å™¨å…·ä½“ä½¿ç”¨äº†å¤šå°‘ä¸ªå­—æ®µçš„æœç´¢æ¡ä»¶æ¥å½¢æˆæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶ã€‚</p>
<p>ä¸¾ä¾‹ä¸ªä¾‹å­ï¼Œa å’Œ b éƒ½æ˜¯ int ç±»å‹ä¸”ä¸ä¸º NULL çš„å­—æ®µï¼Œé‚£ä¹ˆè¿™æ¡æŸ¥è¯¢è¯­å¥æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ° key_len ä¸º 4 å­—èŠ‚ï¼ˆå¦‚æœå­—æ®µå…è®¸ä¸º NULLï¼Œå°±åœ¨å­—æ®µç±»å‹å ç”¨çš„å­—èŠ‚æ•°ä¸ŠåŠ  1ï¼Œä¹Ÿå°±æ˜¯ 5 å­—èŠ‚ï¼‰ï¼Œè¯´æ˜åªæœ‰ a å­—æ®µç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ï¼Œè€Œä¸”å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿ b å­—æ®µæ²¡ç”¨åˆ°è”åˆç´¢å¼•ï¼Œkey ä¸º idx_a_bï¼Œè¯´æ˜è¿™æ¡æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº† idx_a_b è”åˆç´¢å¼•ã€‚</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745756736801.png" alt="1745756736801"></p>
<p>é€šè¿‡è¿™æ¡æŸ¥è¯¢è¯­å¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œa å­—æ®µä½¿ç”¨äº† &gt; è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œè”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™åœ¨é‡åˆ° a å­—æ®µçš„èŒƒå›´æŸ¥è¯¢ï¼ˆ &gt;ï¼‰åå°±åœæ­¢åŒ¹é…äº†ï¼Œå› æ­¤ b å­—æ®µå¹¶æ²¡æœ‰ä½¿ç”¨åˆ°è”åˆç´¢å¼•ã€‚</p>
</li>
<li>
<p>Q2: <code>select * from t_table where a &gt;= 1 and b = 2</code></p>
<p>Q2 å’Œ Q1 çš„æŸ¥è¯¢è¯­å¥å¾ˆåƒï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ a å­—æ®µçš„æŸ¥è¯¢æ¡ä»¶ã€Œå¤§äºç­‰äºã€ã€‚</p>
<p>ç”±äºè”åˆç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰æ˜¯å…ˆæŒ‰ç…§ a å­—æ®µçš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆ &gt;= 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»ï¼Œäºæ˜¯åœ¨è¿›è¡Œç´¢å¼•æ‰«æçš„æ—¶å€™ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆ &gt;= 1 æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆ a&gt;= 1 æ¡ä»¶ä½ç½®ã€‚æ‰€ä»¥ a å­—æ®µå¯ä»¥åœ¨è”åˆç´¢å¼•çš„ B+Tree ä¸­è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚</p>
<p>è™½ç„¶åœ¨ç¬¦åˆ a&gt;= 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯ã€Œæ— åºã€çš„ï¼Œ<strong>ä½†æ˜¯å¯¹äºç¬¦åˆ a = 1 çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯ã€Œæœ‰åºã€çš„</strong>ï¼ˆå› ä¸ºå¯¹äºè”åˆç´¢å¼•ï¼Œæ˜¯å…ˆæŒ‰ç…§ a å­—æ®µçš„å€¼æ’åºï¼Œç„¶ååœ¨ a å­—æ®µçš„å€¼ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå†æŒ‰ç…§ b å­—æ®µçš„å€¼è¿›è¡Œæ’åºï¼‰ã€‚</p>
<p>äºæ˜¯ï¼Œåœ¨ç¡®å®šéœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•çš„èŒƒå›´æ—¶ï¼Œå½“äºŒçº§ç´¢å¼•è®°å½•çš„ a å­—æ®µå€¼ä¸º 1 æ—¶ï¼Œå¯ä»¥é€šè¿‡ b = 2 æ¡ä»¶å‡å°‘éœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•è®°å½•èŒƒå›´ï¼ˆb å­—æ®µå¯ä»¥åˆ©ç”¨è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢çš„æ„æ€ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»ç¬¦åˆ a = 1 and b = 2 æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•å¼€å§‹æ‰«æï¼Œè€Œä¸éœ€è¦ä»ç¬¬ä¸€ä¸ª a å­—æ®µå€¼ä¸º 1 çš„è®°å½•å¼€å§‹æ‰«æã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>Q2 è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢</strong>ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œè®¡åˆ’ä¸­çš„ key_len çŸ¥é“è¿™ä¸€ç‚¹ã€‚æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ° key_len ä¸º 8 å­—èŠ‚ï¼Œè¯´æ˜ä¼˜åŒ–å™¨ä½¿ç”¨äº† 2 ä¸ªå­—æ®µçš„æŸ¥è¯¢æ¡ä»¶æ¥å½¢æˆæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745756833265.png" alt="1745756833265"></p>
<p>é€šè¿‡ Q2 æŸ¥è¯¢è¯­å¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè™½ç„¶ a å­—æ®µä½¿ç”¨äº† &gt;= è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™å¹¶æ²¡æœ‰åœ¨é‡åˆ° a å­—æ®µçš„èŒƒå›´æŸ¥è¯¢ï¼ˆ &gt;=ï¼‰åå°±åœæ­¢åŒ¹é…äº†ï¼Œb å­—æ®µè¿˜æ˜¯å¯ä»¥ç”¨åˆ°äº†è”åˆç´¢å¼•çš„ã€‚</p>
</li>
<li>
<p>Q3: <code>SELECT * FROM t_table WHERE a BETWEEN 2 AND 8 AND b = 2</code></p>
<p>Q3 æŸ¥è¯¢æ¡ä»¶ä¸­ <code>a BETWEEN 2 AND 8</code> çš„æ„æ€æ˜¯æŸ¥è¯¢ a å­—æ®µçš„å€¼åœ¨ 2 å’Œ 8 ä¹‹é—´çš„è®°å½•ã€‚ä¸åŒçš„æ•°æ®åº“å¯¹ BETWEEN â€¦ AND å¤„ç†æ–¹å¼æ˜¯æœ‰å·®å¼‚çš„ã€‚åœ¨ MySQL ä¸­ï¼ŒBETWEEN åŒ…å«äº† value1 å’Œ value2 è¾¹ç•Œå€¼ï¼Œç±»ä¼¼äº &gt;= and =&lt;ã€‚è€Œæœ‰çš„æ•°æ®åº“åˆ™ä¸åŒ…å« value1 å’Œ value2 è¾¹ç•Œå€¼ï¼ˆç±»ä¼¼äº &gt; and &lt;ï¼‰ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åªè®¨è®º MySQLã€‚ç”±äº MySQL çš„ BETWEEN åŒ…å« value1 å’Œ value2 è¾¹ç•Œå€¼ï¼Œæ‰€ä»¥ç±»ä¼¼äº Q2 æŸ¥è¯¢è¯­å¥ï¼Œå› æ­¤ <strong>Q3 è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢</strong>ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œè®¡åˆ’ä¸­çš„ key_len çŸ¥é“è¿™ä¸€ç‚¹ã€‚æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ° key_len ä¸º 8 å­—èŠ‚ï¼Œè¯´æ˜ä¼˜åŒ–å™¨ä½¿ç”¨äº† 2 ä¸ªå­—æ®µçš„æŸ¥è¯¢æ¡ä»¶æ¥å½¢æˆæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745757708547.png" alt="1745757708547"></p>
<p>é€šè¿‡ Q3 æŸ¥è¯¢è¯­å¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè™½ç„¶ a å­—æ®µä½¿ç”¨äº† BETWEEN è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™å¹¶æ²¡æœ‰åœ¨é‡åˆ° a å­—æ®µçš„èŒƒå›´æŸ¥è¯¢ï¼ˆBETWEENï¼‰åå°±åœæ­¢åŒ¹é…äº†ï¼Œb å­—æ®µè¿˜æ˜¯å¯ä»¥ç”¨åˆ°äº†è”åˆç´¢å¼•çš„ã€‚</p>
</li>
<li>
<p>Q4: <code>SELECT * FROM t_user WHERE name like 'j%' and age = 22</code></p>
<p>ç”±äºè”åˆç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰æ˜¯å…ˆæŒ‰ç…§ name å­—æ®µçš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥å‰ç¼€ä¸ºâ€™jâ€™çš„ name å­—æ®µçš„äºŒçº§ç´¢å¼•è®°å½•éƒ½æ˜¯ç›¸é‚»çš„ï¼Œäºæ˜¯åœ¨è¿›è¡Œç´¢å¼•æ‰«æçš„æ—¶å€™ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆå‰ç¼€ä¸ºâ€™jâ€™çš„ name å­—æ®µçš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•çš„ name å‰ç¼€ä¸ä¸ºâ€™jâ€™ä¸ºæ­¢ã€‚</p>
<p>æ‰€ä»¥ a å­—æ®µå¯ä»¥åœ¨è”åˆç´¢å¼•çš„ B+Tree ä¸­è¿›è¡Œç´¢å¼•æŸ¥è¯¢ï¼Œå½¢æˆçš„æ‰«æåŒºé—´æ˜¯[â€˜jâ€™,â€˜kâ€™)ã€‚æ³¨æ„ï¼Œj æ˜¯é—­åŒºé—´ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745758372073.png" alt="1745758372073"></p>
<p>è™½ç„¶åœ¨ç¬¦åˆå‰ç¼€ä¸ºâ€™jâ€™çš„ name å­—æ®µçš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œage å­—æ®µçš„å€¼æ˜¯ã€Œæ— åºã€çš„ï¼Œ<strong>ä½†æ˜¯å¯¹äºç¬¦åˆ name = j çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œage å­—æ®µçš„å€¼æ˜¯ã€Œæœ‰åºã€çš„</strong>ï¼ˆå› ä¸ºå¯¹äºè”åˆç´¢å¼•ï¼Œæ˜¯å…ˆæŒ‰ç…§ name å­—æ®µçš„å€¼æ’åºï¼Œç„¶ååœ¨ name å­—æ®µçš„å€¼ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå†æŒ‰ç…§ age å­—æ®µçš„å€¼è¿›è¡Œæ’åºï¼‰ã€‚</p>
<p>äºæ˜¯ï¼Œåœ¨ç¡®å®šéœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•çš„èŒƒå›´æ—¶ï¼Œå½“äºŒçº§ç´¢å¼•è®°å½•çš„ name å­—æ®µå€¼ä¸ºâ€™jâ€™æ—¶ï¼Œå¯ä»¥é€šè¿‡ age = 22 æ¡ä»¶å‡å°‘éœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•è®°å½•èŒƒå›´ï¼ˆage å­—æ®µå¯ä»¥åˆ©ç”¨è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢çš„æ„æ€ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»ç¬¦åˆ <code>name = 'j' and age = 22</code> æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•æ—¶å¼€å§‹æ‰«æï¼Œè€Œä¸éœ€è¦ä»ç¬¬ä¸€ä¸ª name ä¸º j çš„è®°å½•å¼€å§‹æ‰«æã€‚å¦‚ä¸‹å›¾çš„å³è¾¹ï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745758388661.png" alt="1745758388661"></p>
<p>æ‰€ä»¥ï¼Œ<strong>Q4 è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢</strong>ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œè®¡åˆ’ä¸­çš„ key_len çŸ¥é“è¿™ä¸€ç‚¹ã€‚æœ¬æ¬¡ä¾‹å­ä¸­ï¼š</p>
<ul>
<li>name å­—æ®µçš„ç±»å‹æ˜¯ varchar(30) ä¸”ä¸ä¸º NULLï¼Œæ•°æ®åº“è¡¨ä½¿ç”¨äº† utf8mb4 å­—ç¬¦é›†ï¼Œä¸€ä¸ªå­—ç¬¦é›†ä¸º utf8mb4 çš„å­—ç¬¦æ˜¯ 4 ä¸ªå­—èŠ‚ï¼Œå› æ­¤ name å­—æ®µçš„å®é™…æ•°æ®æœ€å¤šå ç”¨çš„å­˜å‚¨ç©ºé—´é•¿åº¦æ˜¯ 120 å­—èŠ‚ï¼ˆ30 x 4ï¼‰ï¼Œç„¶åå› ä¸º name æ˜¯å˜é•¿ç±»å‹çš„å­—æ®µï¼Œéœ€è¦å†åŠ  2ï¼Œä¹Ÿå°±æ˜¯ name çš„ key_len ä¸º 122ã€‚</li>
<li>age å­—æ®µçš„ç±»å‹æ˜¯ int ä¸”ä¸ä¸º NULLï¼Œkey_len ä¸º 4ã€‚</li>
</ul>
<blockquote>
<p>å¯èƒ½æœ‰çš„åŒå­¦å¯¹äºã€Œå› ä¸º name æ˜¯å˜é•¿ç±»å‹çš„å­—æ®µï¼Œéœ€è¦å†åŠ  2 å­—èŠ‚ã€è¿™å¥è¯æœ‰ç–‘é—®ã€‚ä¹‹å‰è¿™ç¯‡æ–‡ç« è¯´ã€Œå¦‚æœå˜é•¿å­—æ®µå…è®¸å­˜å‚¨çš„æœ€å¤§å­—èŠ‚æ•°å°äºç­‰äº 255 å­—èŠ‚ï¼Œå°±ä¼šç”¨ 1 å­—èŠ‚è¡¨ç¤ºå˜é•¿å­—æ®µçš„é•¿åº¦ã€ï¼Œè€Œè¿™é‡Œä¸ºä»€ä¹ˆæ˜¯ 2 å­—èŠ‚ï¼Ÿ</p>
<p>key_len çš„æ˜¾ç¤ºæ¯”è¾ƒç‰¹æ®Šï¼Œè¡Œæ ¼å¼æ˜¯ç”± InnoDB å­˜å‚¨å¼•æ“å®ç°çš„ï¼Œè€Œæ‰§è¡Œè®¡åˆ’æ˜¯åœ¨ server å±‚ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå»é—® InnoDB å­˜å‚¨å¼•æ“å¯å˜å­—æ®µçš„é•¿åº¦å ç”¨å¤šå°‘å­—èŠ‚ï¼Œè€Œæ˜¯ä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€éƒ½ä½¿ç”¨ 2 å­—èŠ‚è¡¨ç¤ºå¯å˜å­—æ®µçš„é•¿åº¦ã€‚æ¯•ç«Ÿ key_len çš„ç›®çš„åªæ˜¯ä¸ºäº†å‘Šè¯‰ä½ ç´¢å¼•æŸ¥è¯¢ä¸­ç”¨äº†å“ªäº›ç´¢å¼•å­—æ®µï¼Œè€Œä¸æ˜¯ä¸ºäº†å‡†ç¡®å‘Šè¯‰è¿™ä¸ªå­—æ®µå ç”¨å¤šå°‘å­—èŠ‚ç©ºé—´ã€‚</p>
</blockquote>
<p>Q4 æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ° key_len ä¸º 126 å­—èŠ‚ï¼Œname çš„ key_len ä¸º 122ï¼Œage çš„ key_len ä¸º 4ï¼Œè¯´æ˜ä¼˜åŒ–å™¨ä½¿ç”¨äº† 2 ä¸ªå­—æ®µçš„æŸ¥è¯¢æ¡ä»¶æ¥å½¢æˆæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯ name å’Œ age å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745759125926.png" alt="1745759125926"></p>
<p>é€šè¿‡ Q4 æŸ¥è¯¢è¯­å¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè™½ç„¶ name å­—æ®µä½¿ç”¨äº† like å‰ç¼€åŒ¹é…è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™å¹¶æ²¡æœ‰åœ¨é‡åˆ° name å­—æ®µçš„èŒƒå›´æŸ¥è¯¢ï¼ˆlike â€˜j%â€™ï¼‰åå°±åœæ­¢åŒ¹é…äº†ï¼Œage å­—æ®µè¿˜æ˜¯å¯ä»¥ç”¨åˆ°äº†è”åˆç´¢å¼•çš„ã€‚</p>
<p>ç»¼ä¸Šæ‰€ç¤ºï¼Œ<strong>è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ &gt;ã€&lt;ï¼‰çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯èŒƒå›´æŸ¥è¯¢çš„å­—æ®µå¯ä»¥ç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†æ˜¯åœ¨èŒƒå›´æŸ¥è¯¢å­—æ®µçš„åé¢çš„å­—æ®µæ— æ³•ç”¨åˆ°è”åˆç´¢å¼•ã€‚æ³¨æ„ï¼Œå¯¹äº &gt;=ã€&lt;=ã€BETWEENã€like å‰ç¼€åŒ¹é…çš„èŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸ä¼šåœæ­¢åŒ¹é…ï¼Œå‰é¢æˆ‘ä¹Ÿç”¨äº†å››ä¸ªä¾‹å­è¯´æ˜äº†</strong>ã€‚</p>
</li>
</ul>
<h4 id="ç´¢å¼•ä¸‹æ¨">ç´¢å¼•ä¸‹æ¨</h4>
<p>æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªè”åˆç´¢å¼• (a, b)ï¼Œç°åœ¨æ‰§è¡Œè¿™æ ·ä¸€æ¡ SQLï¼š<code>select * from table where a &gt; 1 and b = 2</code>ã€‚è¿™æ—¶å€™ï¼ŒMySQL ä¼šå…ˆç”¨ a &gt; 1 è¿™ä¸ªæ¡ä»¶åœ¨è”åˆç´¢å¼•çš„ B+Tree ä¸Šå®šä½åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ä¸»é”®ï¼ˆæ¯”å¦‚ ID=2ï¼‰ã€‚ä½†æ˜¯ï¼Œb = 2 è¿™ä¸ªæ¡ä»¶è¦æ€ä¹ˆåˆ¤æ–­å‘¢ï¼Ÿæ˜¯åœ¨ç´¢å¼•é‡Œåˆ¤æ–­ï¼Œè¿˜æ˜¯è¦å›è¡¨ï¼ˆåˆ°ä¸»é”®ç´¢å¼•ï¼‰å»åˆ¤æ–­ï¼Ÿ</p>
<ul>
<li>åœ¨ MySQL 5.6 ä¹‹å‰ï¼ŒMySQL åªèƒ½å…ˆé€šè¿‡ç´¢å¼•æ‰¾åˆ°æ‰€æœ‰ a &gt; 1 çš„ä¸»é”®å€¼ï¼Œç„¶åæ¯æ‰¾åˆ°ä¸€æ¡è®°å½•éƒ½è¦å›è¡¨ï¼ˆåˆ°ä¸»é”®ç´¢å¼•ï¼‰å»æŠŠæ•´è¡Œæ•°æ®å–å‡ºæ¥ï¼Œå†åˆ¤æ–­ b æ˜¯å¦ç­‰äº 2ã€‚è¿™æ ·å¦‚æœ a &gt; 1 çš„æ•°æ®å¾ˆå¤šï¼Œå›è¡¨æ¬¡æ•°å°±ä¼šå¾ˆå¤šï¼Œæ•ˆç‡æ¯”è¾ƒä½ã€‚</li>
<li>ä» MySQL 5.6 å¼€å§‹ï¼Œå¼•å…¥äº†<strong>ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–</strong>ï¼ˆIndex Condition Pushdownï¼Œç®€ç§° ICPï¼‰ã€‚æœ‰äº†è¿™ä¸ªä¼˜åŒ–åï¼ŒMySQL åœ¨éå†è”åˆç´¢å¼•çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ç´¢å¼•é‡Œåˆ¤æ–­ b = 2 è¿™ä¸ªæ¡ä»¶ã€‚åªæœ‰å½“ a &gt; 1 å¹¶ä¸” b = 2 éƒ½æ»¡è¶³æ—¶ï¼Œæ‰ä¼šå›è¡¨å–å‡ºæ•´è¡Œæ•°æ®ã€‚è¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘å›è¡¨çš„æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ul>
<p>ä½ å¯ä»¥åœ¨æ‰§è¡Œè®¡åˆ’ï¼ˆexplainï¼‰é‡Œçœ‹åˆ° Extra å­—æ®µæ˜¾ç¤º <code>Using index condition</code>ï¼Œè¿™å°±è¯´æ˜ MySQL ç”¨ä¸Šäº†ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ã€‚</p>
<h4 id="ç´¢å¼•åŒºåˆ†åº¦">ç´¢å¼•åŒºåˆ†åº¦</h4>
<p>å»ºç«‹è”åˆç´¢å¼•æ—¶çš„å­—æ®µé¡ºåºå¯¹ç´¢å¼•çš„æ•ˆç‡ä¹Ÿæœ‰å¾ˆå¤§å½±å“ã€‚è¶Šé å‰çš„å­—æ®µè¢«ç”¨äºç´¢å¼•è¿‡æ»¤çš„æ¦‚ç‡è¶Šé«˜ï¼Œå®é™…å¼€å‘å·¥ä½œä¸­å»ºç«‹ç´¢å¼•çš„æ—¶å€™ï¼Œè¦æŠŠåŒºåˆ†åº¦æçš„å­—æ®µæ’åœ¨å‰é¢ï¼Œè¿™æ ·åŒºåˆ†åº¦å¤§çš„å­—æ®µè¶Šæœ‰å¯èƒ½è¢«æ›´å¤šçš„ SQL ä½¿ç”¨åˆ°</p>
<blockquote>
<p>åŒºåˆ†åº¦ï¼šæŸä¸ªå­—æ®µ <code>column</code>ä¸åŒå€¼çš„ä¸ªæ•°é™¤ä»¥è¡¨çš„æ€»è¡Œæ•°ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹:</p>
<p>$$<br>
åŒºåˆ†åº¦=\frac{distinct(column)}{count(*)}<br>
$$</p>
<p>æ¯”å¦‚æ€§åˆ«çš„åŒºåˆ†åº¦å°±å¾ˆå°ï¼Œä¸é€‚åˆå»ºç«‹ç´¢å¼•æˆ–ä¸é€‚åˆæ’åœ¨è”åˆç´¢å¼•åˆ—çš„é å‰çš„ä½ç½®ï¼Œè€Œ <code>UUID</code>è¿™ç±»å­—æ®µå°±æ¯”è¾ƒé€‚åˆåšç´¢å¼•æˆ–æ’åœ¨è”åˆç´¢å¼•çš„é å‰çš„ä½ç½®</p>
<p>å› ä¸ºå¦‚æœç´¢å¼•çš„åŒºåˆ†åº¦å¾ˆå°ï¼Œå‡è®¾å­—æ®µçš„å€¼åˆ†å¸ƒå‡åŒ€ï¼Œé‚£ä¹ˆæ— è®ºæœç´¢å“ªä¸ªå€¼éƒ½å¯èƒ½å¾—åˆ°ä¸€åŠçš„æ•°æ®ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œè¿˜ä¸å¦‚ä¸è¦ç´¢å¼•ï¼Œå› ä¸º MySQL è¿˜æœ‰ä¸€ä¸ªæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨å‘ç°æŸä¸ªå€¼å‡ºç°åœ¨è¡¨çš„æ•°æ®è¡Œä¸­çš„ç™¾åˆ†æ¯”ï¼ˆæƒ¯ç”¨çš„ç™¾åˆ†æ¯”ç•Œçº¿æ˜¯&quot;30%&quot;ï¼‰å¾ˆé«˜çš„æ—¶å€™ï¼Œå®ƒä¸€èˆ¬ä¼šå¿½ç•¥ç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</p>
</blockquote>
<h4 id="è”åˆç´¢å¼•è¿›è¡Œæ’åº">è”åˆç´¢å¼•è¿›è¡Œæ’åº</h4>
<p>æ¯”å¦‚é’ˆå¯¹ä¸‹é¢è¿™ä¸ª SQL è¯­å¥:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">order</span> <span class="keyword">where</span> status <span class="operator">=</span> <span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> create_time <span class="keyword">asc</span></span><br></pre></td></tr></table></figure>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æ—¢æœ‰ç­›é€‰æ¡ä»¶ï¼ˆå¦‚ where status = 1ï¼‰ï¼Œåˆæœ‰æ’åºéœ€æ±‚ï¼ˆå¦‚ order by create_time ascï¼‰ï¼Œé‚£ä¹ˆåœ¨ä¸ºè¡¨è®¾è®¡ç´¢å¼•æ—¶ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘å»ºç«‹è”åˆç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¸º status å’Œ create_time ä¸¤ä¸ªå­—æ®µä¸€èµ·å»ºç«‹è”åˆç´¢å¼• (status, create_time)ã€‚</p>
<blockquote>
<p>è¿™é‡Œèƒ½ä¸èƒ½å»ºç«‹ä¸º (create_time, status) è”åˆç´¢å¼•ï¼Ÿ</p>
<p>ç­”: ä¸æ¨èè¿™æ ·åšï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>æ— æ³•æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•è¿›è¡Œè¿‡æ»¤</strong>ï¼šè”åˆç´¢å¼• <code>(create_time, status)</code> æ˜¯å…ˆæŒ‰ <code>create_time</code> æ’åºï¼Œå†æŒ‰ <code>status</code> æ’åºã€‚å¯¹äºæŸ¥è¯¢ <code>where status = 1</code>ï¼Œç”±äº <code>status</code> æ˜¯ç´¢å¼•çš„ç¬¬äºŒä¸ªå­—æ®µï¼Œä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼ŒMySQL æ— æ³•ç›´æ¥åˆ©ç”¨è¯¥ç´¢å¼•å¿«é€Ÿå®šä½ <code>status=1</code> çš„è®°å½•ï¼Œå¯èƒ½å¯¼è‡´éœ€è¦æ‰«æå¤§é‡ç´¢å¼•æ•°æ®ç”šè‡³å…¨è¡¨æ‰«æã€‚</li>
<li><strong>æ’åºä¼˜åŒ–å—é™</strong>ï¼šè™½ç„¶ç´¢å¼•çš„ç¬¬ä¸€åˆ—æ˜¯ <code>create_time</code>ï¼Œçœ‹ä¼¼èƒ½æ»¡è¶³ <code>order by create_time</code>ï¼Œä½†å‰ææ˜¯ <code>where</code> æ¡ä»¶èƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•ã€‚å¦‚æœ <code>where status = 1</code> æ— æ³•æœ‰æ•ˆè¿‡æ»¤ï¼Œé‚£ä¹ˆå³ä½¿ç´¢å¼•æœ¬èº«æŒ‰ <code>create_time</code> æœ‰åºï¼Œä¼˜åŒ–å™¨ä¹Ÿå¯èƒ½æ— æ³•é¿å…é¢å¤–çš„æ’åºæ“ä½œï¼ˆfilesortï¼‰ï¼Œå› ä¸ºéœ€è¦å…ˆç­›é€‰å‡º <code>status=1</code> çš„æ•°æ®ã€‚</li>
</ol>
<p>è€Œ <code>(status, create_time)</code> ç´¢å¼•åˆ™èƒ½å®Œç¾åŒ¹é…è¯¥æŸ¥è¯¢ï¼š</p>
<ul>
<li><code>where status = 1</code> å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„ç¬¬ä¸€åˆ—å¿«é€Ÿå®šä½æ•°æ®ã€‚</li>
<li>åœ¨ <code>status=1</code> çš„è®°å½•å†…éƒ¨ï¼Œæ•°æ®å·²æŒ‰ <code>create_time</code> æœ‰åºï¼Œ<code>order by create_time</code> å¯ä»¥ç›´æ¥åˆ©ç”¨ç´¢å¼•é¡ºåºï¼Œé¿å… filesortã€‚</li>
</ul>
</blockquote>
<p>è¿™æ ·åšçš„åŸå› æ˜¯ï¼šMySQL çš„è”åˆç´¢å¼•æœ¬èº«æ˜¯æœ‰åºçš„ï¼Œå…ˆæŒ‰ç…§ status æ’åºï¼Œå†æŒ‰ç…§ create_time æ’åºã€‚å½“æˆ‘ä»¬æ‰§è¡Œä¸Šè¿° SQL æ—¶ï¼ŒMySQL å¯ä»¥ç›´æ¥åˆ©ç”¨è”åˆç´¢å¼•ï¼Œå…ˆæ ¹æ® status è¿‡æ»¤æ•°æ®ï¼Œå†æŒ‰ç…§ create_time é¡ºåºè¿”å›ç»“æœï¼Œæ— éœ€é¢å¤–çš„æ’åºæ“ä½œã€‚</p>
<p>å¦‚æœåªä¸º status å•ç‹¬å»ºç´¢å¼•ï¼Œè™½ç„¶å¯ä»¥åŠ é€Ÿ status çš„è¿‡æ»¤ï¼Œä½†ç”±äº create_time æ²¡æœ‰å‚ä¸ç´¢å¼•ï¼ŒMySQL è¿˜éœ€è¦å¯¹ç­›é€‰åçš„ç»“æœè¿›è¡Œé¢å¤–çš„æ’åºï¼ˆå³ filesortï¼‰ï¼Œè¿™ä¼šå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p>å› æ­¤ï¼Œåˆç†è®¾è®¡è”åˆç´¢å¼•ï¼Œæ—¢èƒ½æ»¡è¶³ç­›é€‰æ¡ä»¶ï¼Œåˆèƒ½è¦†ç›–æ’åºå­—æ®µï¼Œå¯ä»¥å……åˆ†å‘æŒ¥ç´¢å¼•çš„æœ‰åºæ€§ï¼Œé¿å…ä¸å¿…è¦çš„æ–‡ä»¶æ’åºæ“ä½œï¼Œä»è€Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<h2 id="ç´¢å¼•çš„é€‚ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹">ç´¢å¼•çš„é€‚ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹</h2>
<p>è™½ç„¶ç´¢å¼•èƒ½æ˜¾è‘—<strong>æé«˜æŸ¥è¯¢é€Ÿåº¦</strong>ï¼Œä½†å¹¶éæ²¡æœ‰ä»£ä»·ã€‚åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼•éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>ç©ºé—´æˆæœ¬</strong>ï¼šç´¢å¼•éœ€è¦å ç”¨ç‰©ç†å­˜å‚¨ç©ºé—´ï¼Œç´¢å¼•è¶Šå¤šã€è¶Šå¤§ï¼Œå ç”¨çš„ç©ºé—´å°±è¶Šå¤šã€‚</li>
<li><strong>æ—¶é—´æˆæœ¬</strong>ï¼šåˆ›å»ºå’Œç»´æŠ¤ç´¢å¼•ï¼ˆå°¤å…¶æ˜¯åœ¨æ•°æ®é‡å¤§æ—¶ï¼‰éœ€è¦æ—¶é—´ã€‚</li>
<li><strong>ç»´æŠ¤æˆæœ¬</strong>ï¼šå¯¹è¡¨è¿›è¡Œ <code>INSERT</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>æ“ä½œæ—¶ï¼Œæ•°æ®åº“éœ€è¦<strong>åŒæ­¥æ›´æ–°ç´¢å¼•</strong>ä»¥ç»´æŒå…¶æœ‰åºæ€§ï¼ˆå¦‚ B+Tree çš„åŠ¨æ€ç»´æŠ¤ï¼‰ï¼Œè¿™ä¼š<strong>é™ä½æ•°æ®ä¿®æ”¹æ“ä½œçš„æ•ˆç‡</strong>ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œæ˜¯å¦åˆ›å»ºç´¢å¼•éœ€è¦æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯æƒè¡¡åˆ©å¼Šã€‚</p>
<h4 id="ä»€ä¹ˆæ—¶å€™å»ºè®®åˆ›å»ºç´¢å¼•ï¼Ÿ">ä»€ä¹ˆæ—¶å€™å»ºè®®åˆ›å»ºç´¢å¼•ï¼Ÿ</h4>
<ul>
<li><strong>å”¯ä¸€æ€§çº¦æŸçš„å­—æ®µ</strong>ï¼šå¦‚ä¸»é”®ã€å”¯ä¸€é”®ï¼ˆUNIQUE KEYï¼‰ï¼Œæ•°æ®åº“é€šå¸¸ä¼šè‡ªåŠ¨ä¸ºè¿™äº›çº¦æŸåˆ›å»ºç´¢å¼•ï¼Œä»¥ä¿è¯æ•°æ®çš„å”¯ä¸€æ€§å¹¶åŠ é€ŸæŸ¥æ‰¾ã€‚ä¾‹å¦‚å•†å“ç¼–ç ã€‚</li>
<li><strong>ç»å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</strong>ï¼šé¢‘ç¹å‡ºç°åœ¨ <code>WHERE</code> å­å¥ä¸­çš„å­—æ®µé€‚åˆåˆ›å»ºç´¢å¼•ï¼Œä»¥åŠ é€Ÿæ•°æ®ç­›é€‰ã€‚å¦‚æœæŸ¥è¯¢æ¡ä»¶æ¶‰åŠå¤šä¸ªå­—æ®µï¼Œå¯ä»¥è€ƒè™‘åˆ›å»º<strong>è”åˆç´¢å¼•</strong>ã€‚</li>
<li><strong>ç»å¸¸ç”¨äºæ’åºå’Œåˆ†ç»„çš„å­—æ®µ</strong>ï¼šé¢‘ç¹å‡ºç°åœ¨ <code>ORDER BY</code> æˆ– <code>GROUP BY</code> å­å¥ä¸­çš„å­—æ®µã€‚åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ï¼Œå¯ä»¥é¿å…é¢å¤–çš„æ’åºæ“ä½œï¼ˆfilesortï¼‰ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ul>
<h4 id="ä»€ä¹ˆæ—¶å€™ä¸å»ºè®®åˆ›å»ºç´¢å¼•ï¼ˆæˆ–éœ€è°¨æ…ï¼‰ï¼Ÿ">ä»€ä¹ˆæ—¶å€™ä¸å»ºè®®åˆ›å»ºç´¢å¼•ï¼ˆæˆ–éœ€è°¨æ…ï¼‰ï¼Ÿ</h4>
<ul>
<li><strong>ä¸ç”¨äºæŸ¥è¯¢ã€æ’åºã€åˆ†ç»„çš„å­—æ®µ</strong>ï¼šå¦‚æœä¸€ä¸ªå­—æ®µä»æœªæˆ–å¾ˆå°‘åœ¨ <code>WHERE</code>ã€<code>ORDER BY</code>ã€<code>GROUP BY</code> ä¸­ä½¿ç”¨ï¼Œé‚£ä¹ˆä¸ºå…¶åˆ›å»ºç´¢å¼•é€šå¸¸æ˜¯æµªè´¹ç©ºé—´å’Œç»´æŠ¤èµ„æºã€‚</li>
<li><strong>åŒºåˆ†åº¦ä½çš„å­—æ®µï¼ˆä½åŸºæ•°/ä½é€‰æ‹©æ€§ï¼‰</strong>ï¼šå­—æ®µä¸­åŒ…å«å¤§é‡é‡å¤å€¼æ—¶ï¼ˆå³<strong>åŒºåˆ†åº¦</strong>å¾ˆä½ï¼Œå¦‚æ€§åˆ«å­—æ®µï¼‰ã€‚å³ä½¿ä¸ºè¿™ç±»å­—æ®µåˆ›å»ºç´¢å¼•ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¹Ÿå¯èƒ½å› ä¸ºæ‰«æç´¢å¼•çš„æˆæœ¬æ¥è¿‘å…¨è¡¨æ‰«æè€Œé€‰æ‹©<strong>æ”¾å¼ƒä½¿ç”¨ç´¢å¼•</strong>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ€§åˆ«å­—æ®µçš„å€¼å‡åŒ€åˆ†å¸ƒï¼ŒæŸ¥è¯¢ <code>WHERE gender = 'male'</code> å¯èƒ½ä¼šåŒ¹é…æ¥è¿‘ä¸€åŠçš„æ•°æ®è¡Œï¼Œæ­¤æ—¶å…¨è¡¨æ‰«æå¯èƒ½æ›´ä¼˜ã€‚ï¼ˆè¿™ä¸å‰é¢æåˆ°çš„â€œç´¢å¼•åŒºåˆ†åº¦â€æ¦‚å¿µç›¸å…³ï¼‰</li>
<li><strong>æ•°æ®é‡è¿‡å°çš„è¡¨</strong>ï¼šå¯¹äºè¡Œæ•°å¾ˆå°‘çš„è¡¨ï¼Œå…¨è¡¨æ‰«æçš„é€Ÿåº¦å¯èƒ½å·²ç»è¶³å¤Ÿå¿«ï¼Œç”šè‡³æ¯”é€šè¿‡ç´¢å¼•æŸ¥æ‰¾æ›´å¿«ï¼Œæ­¤æ—¶åˆ›å»ºç´¢å¼•æ„ä¹‰ä¸å¤§ã€‚</li>
<li><strong>é¢‘ç¹æ›´æ–°çš„å­—æ®µ</strong>ï¼šç»å¸¸è¢«ä¿®æ”¹çš„å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œç”µå•†ç³»ç»Ÿä¸­çš„ç”¨æˆ·ä½™é¢å­—æ®µï¼Œé¢‘ç¹çš„æ›´æ–°ä¼šå¯¼è‡´ç´¢å¼•æ ‘é¢‘ç¹è°ƒæ•´ï¼Œä¸¥é‡å½±å“æ•°æ®åº“çš„å†™å…¥æ€§èƒ½ã€‚</li>
</ul>
<h2 id="ç´¢å¼•ä¼˜åŒ–æ–¹æ³•">ç´¢å¼•ä¼˜åŒ–æ–¹æ³•</h2>
<p>ç´¢å¼•ä¼˜åŒ–ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<ol>
<li>å‰ç¼€ç´¢å¼•ä¼˜åŒ–</li>
<li>è¦†ç›–ç´¢å¼•ä¼˜åŒ–</li>
<li>ä¸»é”®ç´¢å¼•æœ€å¥½ä½¿ç”¨è‡ªå¢ ID</li>
<li>ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º <code>NOT NULL</code></li>
<li>é˜²æ­¢ç´¢å¼•å¤±æ•ˆ</li>
</ol>
<h3 id="å‰ç¼€ç´¢å¼•ä¼˜åŒ–">å‰ç¼€ç´¢å¼•ä¼˜åŒ–</h3>
<p>å‰ç¼€ç´¢å¼•å…¶å®å°±æ˜¯ä½¿ç”¨æŸä¸ªå­—æ®µçš„å‰ç¼€éƒ¨åˆ†æ¥åˆ›å»ºç´¢å¼•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ•´ä¸ªå­—æ®µã€‚</p>
<p>ä½¿ç”¨å‰ç¼€ç´¢å¼•æ˜¯ä¸ºäº†å‡å°ç´¢å¼•å­—æ®µå¤§å°ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªç´¢å¼•é¡µä¸­å­˜å‚¨çš„ç´¢å¼•å€¼çš„æ•°é‡ï¼Œä»è€Œå‡å°‘ç´¢å¼•æ ‘çš„é«˜åº¦ï¼Œå‡å°‘ç£ç›˜ IOï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p>å‰ç¼€ç´¢å¼•çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li><code>order by</code> å’Œ <code>group by</code> æ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼šå› ä¸ºå‰ç¼€ç´¢å¼•åªåŒ…å«åŸå§‹åˆ—å€¼çš„ä¸€éƒ¨åˆ†ï¼ŒMySQL æ— æ³•ä½¿ç”¨å®ƒæ¥å®Œæˆéœ€è¦å®Œæ•´åˆ—å€¼çš„æ’åºæˆ–åˆ†ç»„æ“ä½œã€‚</li>
<li>æ— æ³•æŠŠå‰ç¼€ç´¢å¼•ç”¨ä½œè¦†ç›–ç´¢å¼•ï¼šå› ä¸ºå‰ç¼€ç´¢å¼•åªåŒ…å«åŸå§‹åˆ—å€¼çš„ä¸€éƒ¨åˆ†ï¼Œå½“æŸ¥è¯¢éœ€è¦è·å–å®Œæ•´çš„åˆ—å€¼æ—¶ï¼ŒMySQL æ— æ³•ä»…é€šè¿‡æ‰«æç´¢å¼•å°±æ»¡è¶³æŸ¥è¯¢éœ€æ±‚ï¼Œå¿…é¡»å›è¡¨æŸ¥è¯¢è·å–å®Œæ•´æ•°æ®ã€‚</li>
</ul>
<h3 id="è¦†ç›–ç´¢å¼•ä¼˜åŒ–">è¦†ç›–ç´¢å¼•ä¼˜åŒ–</h3>
<p>è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ SQL ä¸­ query çš„æ‰€æœ‰å­—æ®µåœ¨ç´¢å¼• B+Tree çš„å¶å­èŠ‚ç‚¹ä¸­éƒ½èƒ½æ‰¾åˆ°ï¼Œå› æ­¤ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬åªéœ€è¦æŸ¥è¯¢å•†å“çš„åç§°ã€ä»·æ ¼ï¼Œæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥é¿å…å›è¡¨æŸ¥è¯¢ï¼Ÿ</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª(name, price)çš„è”åˆç´¢å¼•</li>
<li>ç”±äºè”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ï¼ŒæŸ¥è¯¢æ—¶ä¼šä¼˜å…ˆä½¿ç”¨ name å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œç„¶åæ ¹æ® name å­—æ®µæ’åºï¼Œæœ€åæ ¹æ® price å­—æ®µæ’åº</li>
<li>ç”±äºè¦†ç›–ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›´æ¥åœ¨è”åˆç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­è·å– name å’Œ price å­—æ®µçš„å€¼</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥é¿å…å›è¡¨æŸ¥è¯¢ï¼Œå‡å°‘ç£ç›˜ IOï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<h3 id="ä¸»é”®ç´¢å¼•æœ€å¥½ä½¿ç”¨è‡ªå¢-ID">ä¸»é”®ç´¢å¼•æœ€å¥½ä½¿ç”¨è‡ªå¢ ID</h3>
<p>ä¸»é”®ç´¢å¼•æœ€å¥½ä½¿ç”¨è‡ªå¢ IDï¼Œå› ä¸ºè‡ªå¢ ID çš„æ’å…¥æ€§èƒ½æ¯”éšæœº ID çš„æ’å…¥æ€§èƒ½è¦å¥½ã€‚</p>
<p>InnoDB åˆ›å»ºä¸»é”®ç´¢å¼•çš„æ—¶å€™é»˜è®¤ä¸ºèšç°‡ç´¢å¼•ï¼Œæ•°æ®ä¼šè¢«å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼ŒåŒä¸€ä¸ªå¶å­èŠ‚ç‚¹ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåºæ’åºçš„ï¼Œå› æ­¤å½“æœ‰æ–°çš„æ•°æ®æ’å…¥çš„æ—¶å€™ï¼Œæ•°æ®åº“ä¼šæ ¹æ®ä¸»é”®å°†å…¶æ’å…¥åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ä¸­ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨è‡ªå¢ ID ä½œä¸ºä¸»é”®ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥çš„æ–°æ•°æ®éƒ½ä¼š<strong>æŒ‰é¡ºåº</strong>è¢«æ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„ä½ç½®ï¼Œ<strong>ä¸éœ€è¦ç§»åŠ¨å·²æœ‰æ•°æ®</strong>ï¼Œå½“é¡µé¢å†™æ»¡å°±ä¼šå¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µé¢ã€‚å› ä¸ºæ¯æ¬¡æ’å…¥ä¸€æ¡æ–°çºªå½•éƒ½æ˜¯<strong>è¿½åŠ æ“ä½œ</strong>ï¼Œä¸éœ€è¦ç§»åŠ¨æ•°æ®ï¼Œå› æ­¤<strong>æ’å…¥æ€§èƒ½å¾ˆé«˜</strong>ã€‚</p>
<p>ç›¸åï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨éè‡ªå¢ ID ä½œä¸ºä¸»é”®ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥çš„æ–°æ•°æ®éƒ½ä¼š<strong>éšæœº</strong>æ’å…¥åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„ä½ç½®ï¼Œå› æ­¤å¾ˆå¯èƒ½ä¼šæ’å…¥åˆ°ç°æœ‰æ•°æ®é¡µçš„æŸä¸ªä¸­é—´ä½ç½®ï¼Œå¯¼è‡´ä¸å¾—ä¸ç§»åŠ¨å…¶ä»–æ•°æ®æ¥æ»¡è¶³æ–°æ•°æ®çš„æ’å…¥ï¼Œç”šè‡³éœ€è¦è¿›è¡Œ<strong>é¡µåˆ†è£‚</strong>ï¼Œè¿˜è¦å°†æ•°æ®ä»æ—§é¡µç§»åŠ¨åˆ°æ–°é¡µï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹è¿˜æœ‰å¯èƒ½ä¼šå¸¦æ¥å¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´ç´¢å¼•ç»“æ„ä¸ç´§å‡‘ï¼Œä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æŸä¸ªæ•°æ®é¡µä¸­çš„æ•°æ®æ˜¯ 1ã€3ã€5ã€9ï¼Œä¸”æ•°æ®é¡µæ»¡äº†ï¼Œç°åœ¨å‡†å¤‡æ’å…¥ä¸€ä¸ªæ•°æ® 7ï¼Œåˆ™éœ€è¦æŠŠæ•°æ®é¡µåˆ†å‰²ä¸ºä¸¤ä¸ªæ•°æ®é¡µï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745832584071.png" alt="1745832584071"></p>
<p>å‡ºç°é¡µåˆ†è£‚æ—¶ï¼Œéœ€è¦å°†ä¸€ä¸ªé¡µçš„è®°å½•ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé¡µï¼Œæ€§èƒ½ä¼šå—åˆ°å½±å“ï¼ŒåŒæ—¶é¡µç©ºé—´çš„åˆ©ç”¨ç‡ä¸‹é™ï¼Œé€ æˆå­˜å‚¨ç©ºé—´çš„æµªè´¹ã€‚</p>
<p>è€Œå¦‚æœè®°å½•æ˜¯é¡ºåºæ’å…¥çš„ï¼Œä¾‹å¦‚æ’å…¥æ•°æ® 11ï¼Œåˆ™åªéœ€å¼€è¾Ÿæ–°çš„æ•°æ®é¡µï¼Œä¹Ÿå°±ä¸ä¼šå‘ç”Ÿé¡µåˆ†è£‚ï¼š</p>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745832605883.png" alt="1745832605883"></p>
<p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå»ºè®®ä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®ã€‚</p>
<p>å¦å¤–ï¼Œä¸»é”®å­—æ®µçš„é•¿åº¦ä¸è¦å¤ªå¤§ï¼Œå› ä¸º<strong>ä¸»é”®å­—æ®µé•¿åº¦è¶Šå°ï¼Œæ„å‘³ç€äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹è¶Šå°ï¼ˆäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ•°æ®æ˜¯ä¸»é”®å€¼ï¼‰ï¼Œè¿™æ ·äºŒçº§ç´¢å¼•å ç”¨çš„ç©ºé—´ä¹Ÿå°±è¶Šå°</strong>ã€‚</p>
<h3 id="ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º-NOT-NULL">ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º <code>NOT NULL</code></h3>
<p>ä¸ºäº†æ›´å¥½çš„åˆ©ç”¨ç´¢å¼•ï¼Œç´¢å¼•åˆ—è¦è®¾ç½®ä¸º NOT NULL çº¦æŸã€‚æœ‰ä¸¤ä¸ªåŸå› ï¼š</p>
<ul>
<li>ç¬¬ä¸€åŸå› ï¼šç´¢å¼•åˆ—å­˜åœ¨ NULL å°±ä¼šå¯¼è‡´ä¼˜åŒ–å™¨åœ¨åšç´¢å¼•é€‰æ‹©çš„æ—¶å€™æ›´åŠ å¤æ‚ï¼Œæ›´åŠ éš¾ä»¥ä¼˜åŒ–ï¼Œå› ä¸ºå¯ä¸º NULL çš„åˆ—ä¼šä½¿ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡å’Œå€¼æ¯”è¾ƒéƒ½æ›´å¤æ‚ï¼Œæ¯”å¦‚è¿›è¡Œç´¢å¼•ç»Ÿè®¡æ—¶ï¼Œcount ä¼šçœç•¥å€¼ä¸º NULL çš„è¡Œã€‚</li>
<li>ç¬¬äºŒä¸ªåŸå› ï¼šNULL å€¼æ˜¯ä¸€ä¸ªæ²¡æ„ä¹‰çš„å€¼ï¼Œä½†æ˜¯å®ƒä¼šå ç”¨ç‰©ç†ç©ºé—´ï¼Œæ‰€ä»¥ä¼šå¸¦æ¥çš„å­˜å‚¨ç©ºé—´çš„é—®é¢˜ï¼Œä¼šå¯¼è‡´æ›´å¤šçš„å­˜å‚¨ç©ºé—´å ç”¨ï¼Œå› ä¸º InnoDB é»˜è®¤è¡Œå­˜å‚¨æ ¼å¼ <code>COMPACT</code>ï¼Œä¼šç”¨è‡³å°‘ 1 å­—èŠ‚ç©ºé—´å­˜å‚¨ NULL å€¼åˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾çš„ç´«è‰²éƒ¨åˆ†ï¼š</li>
</ul>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745833140573.png" alt="1745833140573"></p>
<h3 id="é˜²æ­¢ç´¢å¼•å¤±æ•ˆ">é˜²æ­¢ç´¢å¼•å¤±æ•ˆ</h3>
<p>ç”¨ä¸Šäº†ç´¢å¼•å¹¶ä¸æ„å‘³ç€æŸ¥è¯¢çš„æ—¶å€™ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ¸…æ¥šä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¼šå¤±æ•ˆã€‚ä»è€Œé¿å…åœ¨å¼€å‘è¿‡ç¨‹ä¸­å†™å‡ºç´¢å¼•å®æ•ˆçš„æŸ¥è¯¢è¯­å¥ï¼Œå¦åˆ™è¿™æ ·çš„æŸ¥è¯¢æ•ˆç‡æ˜¯å¾ˆä½çš„ã€‚</p>
<blockquote>
<p>è¿™é‡Œç•™ä¸ªå‘ï¼Œåé¢å…¶ä»–æ–‡ç« ä¼šè¯¦ç»†ä»‹ç»ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ã€‚</p>
</blockquote>
<p>ç´¢å¼•å¤±æ•ˆä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p>
<ol>
<li>å½“æˆ‘ä»¬ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…çš„æ—¶å€™ï¼Œæ¯”å¦‚ <code>like '%hello'</code> æˆ–è€… <code>like '%hello%'</code>ï¼Œç´¢å¼•ä¼šå¤±æ•ˆï¼Œå¯¼è‡´å…¨è¡¨æ‰«æã€‚</li>
<li>å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•è¿›è¡Œäº†<strong>è®¡ç®—</strong>ã€<strong>å‡½æ•°</strong>ã€<strong>ç±»å‹è½¬æ¢</strong>ç­‰æ“ä½œï¼Œç´¢å¼•ä¼šå¤±æ•ˆï¼Œå¯¼è‡´å…¨è¡¨æ‰«æã€‚</li>
<li>è”åˆç´¢å¼•ä¸éµå®ˆæœ€å·¦åŒ¹é…åŸåˆ™ã€‚ä¹Ÿå°±æ˜¯æ²¡æœ‰ä»è”åˆç´¢å¼•çš„æœ€å·¦å­—æ®µå¼€å§‹åŒ¹é…ï¼Œç´¢å¼•ä¼šå¤±æ•ˆï¼Œå¯¼è‡´å…¨è¡¨æ‰«æã€‚</li>
<li>åœ¨ <code>WHERE</code>å­å¥ä¸­ï¼Œå¦‚æœåœ¨ <code>OR</code>å‰é¢çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œåœ¨ <code>OR</code>åé¢çš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œç´¢å¼•ä¼šå¤±æ•ˆï¼Œå¯¼è‡´å…¨è¡¨æ‰«æã€‚</li>
</ol>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šåœºæ™¯ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè¿™æ—¶å€™éœ€è¦æˆ‘ä»¬æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œé€šè¿‡æ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºçš„æ•°æ®æ¥åˆ¤æ–­æŸ¥è¯¢è¯­å¥æ˜¯å¦ç”¨åˆ°äº†ç´¢å¼•ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢å°±æ˜¯å…¨è¡¨æ‰«æçš„æ‰§è¡Œè®¡åˆ’çš„æŸ¥è¯¢è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">+</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745840451803.png" alt="1745840451803"></p>
<p>å¯¹äºæ‰§è¡Œè®¡åˆ’ï¼Œå‚æ•°ä¸»è¦æœ‰ï¼š</p>
<ul>
<li>
<p><code>possible_keys</code>ï¼šä¼˜åŒ–å™¨å¯èƒ½é€‰æ‹©ä½¿ç”¨çš„ç´¢å¼•åˆ—è¡¨ã€‚è¯¥å­—æ®µå­˜åœ¨çš„æ„ä¹‰åœ¨äºå±•ç¤ºæŸ¥è¯¢ä¸­<em>ç†è®ºä¸Šå¯ä»¥è¢«ä½¿ç”¨</em>çš„ç´¢å¼•ï¼ˆåŸºäº where æ¡ä»¶å’Œè¡¨ç»“æ„ï¼‰ï¼Œä½†æœ€ç»ˆæ˜¯å¦ä½¿ç”¨è¿˜è¦å–å†³äºä¼˜åŒ–å™¨å¯¹æ•°æ®åˆ†å¸ƒã€æŸ¥è¯¢æˆæœ¬ç­‰å› ç´ çš„åˆ¤æ–­ã€‚å½“è¯¥å­—æ®µä¸º NULL æ—¶è¡¨ç¤ºæ²¡æœ‰é€‚ç”¨çš„ç´¢å¼•ã€‚</p>
</li>
<li>
<p><code>key</code>ï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœæŸ¥è¯¢ä¸­æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œåˆ™è¯¥å­—æ®µä¸º NULLã€‚</p>
</li>
<li>
<p><code>key_len</code>ï¼šç´¢å¼•ä¸­ä½¿ç”¨çš„å­—æ®µé•¿åº¦ã€‚</p>
</li>
<li>
<p><code>rows</code>ï¼šè¿™ä¸ªå€¼è¡¨ç¤º MySQL æ ¹æ®è¡¨çš„ç»Ÿè®¡ä¿¡æ¯å’Œç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼Œ<strong>é¢„ä¼°éœ€è¦è¯»å–å¤šå°‘è¡Œæ•°æ®</strong>æ‰èƒ½æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç»“æœã€‚æ¯”å¦‚ <code>rows=1000</code>ï¼Œè¯´æ˜ MySQL è®¤ä¸ºå¤§çº¦éœ€è¦æ‰«æ 1000 è¡Œæ•°æ®ã€‚è¿™ä¸ªå€¼è¶Šå°ï¼Œè¯´æ˜æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ã€‚</p>
</li>
<li>
<p><code>filtered</code>ï¼šè¿™ä¸ªå€¼è¡¨ç¤º<strong>ç»è¿‡ WHERE æ¡ä»¶è¿‡æ»¤åï¼Œå‰©ä¸‹çš„è¡Œæ•°å æ€»æ‰«æè¡Œæ•°çš„ç™¾åˆ†æ¯”</strong>ã€‚æ¯”å¦‚ <code>filtered=10</code>ï¼Œè¡¨ç¤ºæœ€ç»ˆåªæœ‰ 10%çš„æ•°æ®èƒ½é€šè¿‡ WHERE æ¡ä»¶ã€‚å®ƒçš„è®¡ç®—å…¬å¼æ˜¯ï¼šfiltered = (æ»¡è¶³ WHERE æ¡ä»¶çš„è¡Œæ•° / rows) Ã— 100%ã€‚è¿™ä¸ªå€¼è¶Šé«˜ï¼Œè¯´æ˜è¿‡æ»¤æ•ˆæœè¶Šå¥½ï¼Œè¿”å›çš„æ•°æ®æ›´ç²¾ç¡®ã€‚</p>
</li>
<li>
<p><code>type</code>ï¼šè¡¨ç¤ºæ•°æ®æ‰«æçš„æ–¹å¼</p>
<p>å¸¸è§çš„æ•°æ®æ‰«ææ–¹å¼æœ‰(ä»ä¸Šåˆ°ä¸‹ï¼Œæ‰«ææ•ˆç‡ä»ä½åˆ°é«˜)ï¼š</p>
<ul>
<li><code>ALL</code>ï¼šå…¨è¡¨æ‰«æï¼Œæ•ˆç‡æœ€ä½ï¼Œéœ€è¦éå†æ•´å¼ è¡¨çš„æ‰€æœ‰è¡Œã€‚
<ul>
<li>ä¾‹å­ï¼š<code>SELECT * FROM users WHERE non_indexed_column = 'some_value';</code></li>
</ul>
</li>
<li><code>index</code>ï¼šå…¨ç´¢å¼•æ‰«æï¼Œéå†æ•´ä¸ªç´¢å¼•ï¼Œæ•ˆç‡æ¯”å…¨è¡¨æ‰«æé«˜ï¼Œä½†ä»éœ€æ‰«ææ‰€æœ‰ç´¢å¼•é¡¹ã€‚
<ul>
<li>ä¾‹å­ï¼š<code>SELECT indexed_column FROM users ORDER BY indexed_column;</code> (å½“åªéœ€è¦æ‰«æç´¢å¼•ï¼Œä¸éœ€è¦è®¿é—®æ•°æ®è¡Œæ—¶)</li>
</ul>
</li>
<li><code>range</code>ï¼šèŒƒå›´æ‰«æï¼Œåªæ‰«æç´¢å¼•ä¸­æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†èŒƒå›´ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚
<ul>
<li>ä¾‹å­ï¼š<code>SELECT * FROM users WHERE indexed_column &gt; 100;</code> æˆ– <code>SELECT * FROM users WHERE indexed_column BETWEEN 100 AND 200;</code></li>
</ul>
</li>
<li><code>ref</code>ï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æ‰«æï¼Œé€šè¿‡ç´¢å¼•æŸ¥æ‰¾åŒ¹é…æŸä¸ªå€¼çš„å¤šè¡Œï¼Œæ•ˆç‡è¾ƒé«˜ã€‚
<ul>
<li>ä¾‹å­ï¼š<code>SELECT * FROM users WHERE non_unique_indexed_column = 'some_value';</code></li>
</ul>
</li>
<li><code>eq_ref</code>ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æ‰«æï¼Œé€šå¸¸å‡ºç°åœ¨å¤šè¡¨è¿æ¥ä¸­ï¼Œå¯¹äºå‰ä¸€å¼ è¡¨çš„æ¯ä¸€è¡Œï¼Œåœ¨åä¸€å¼ è¡¨ä¸­åªèƒ½æ‰¾åˆ°ä¸€è¡Œã€‚æ•ˆç‡æ›´é«˜ã€‚
<ul>
<li>ä¾‹å­ï¼š<code>SELECT * FROM orders JOIN users ON orders.user_id = users.id WHERE orders.id = 123;</code> (å‡è®¾ <code>users.id</code> æ˜¯ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•)</li>
</ul>
</li>
<li><code>const</code>ï¼šå¸¸é‡æ‰«æï¼Œç›´æ¥é€šè¿‡ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å®šä½åˆ°ä¸€æ¡è®°å½•ï¼Œæ•ˆç‡æœ€é«˜ã€‚
<ul>
<li>ä¾‹å­ï¼š<code>SELECT * FROM users WHERE id = 123;</code> (å‡è®¾ <code>id</code> æ˜¯ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•)</li>
</ul>
</li>
</ul>
<blockquote>
<p>è¿™äº›æƒ…å†µé‡Œé¢ï¼Œ<code>ALL</code>æ˜¯æœ€åçš„æƒ…å†µï¼Œå› ä¸ºé‡‡ç”¨äº†å…¨è¡¨æ‰«æï¼Œéœ€è¦éå†æ•´å¼ è¡¨çš„æ‰€æœ‰è¡Œã€‚</p>
<p><code>index</code>å’Œ <code>ALL</code>çš„æƒ…å†µå…¶å®å·®ä¸å¤šï¼Œåªä¸è¿‡ index åªå¯¹ç´¢å¼•è¿›è¡Œå…¨æ‰«æï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¸å†éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œä½†æ˜¯ä»ç„¶éœ€è¦å¯¹ç´¢å¼•è¿›è¡Œæ‰«æã€‚</p>
<p><code>range</code> è¡¨ç¤ºé‡‡ç”¨äº†ç´¢å¼•èŒƒå›´æ‰«æï¼Œä¸€èˆ¬åœ¨ <code>where</code>å­å¥ä¸­ä½¿ç”¨ <code>&lt;</code>ã€<code>&gt;</code>ã€<code>between</code>ã€<code>in</code>ç­‰æ“ä½œç¬¦æ—¶ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œåªæ‰«æç´¢å¼•ä¸­æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†èŒƒå›´ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚<strong>ä»è¿™ä¸€çº§åˆ«å¼€å§‹ï¼Œç´¢å¼•çš„ä½œç”¨ä¼šè¶Šæ¥è¶Šæ˜æ˜¾</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å°½é‡è®© SQL æŸ¥è¯¢å¯ä»¥ä½¿ç”¨åˆ° range è¿™ä¸€çº§åˆ«åŠä»¥ä¸Šçš„ type è®¿é—®æ–¹å¼ã€‚</p>
<p><code>ref</code> ç±»å‹è¡¨ç¤ºé‡‡ç”¨äº†éå”¯ä¸€ç´¢å¼•ï¼Œæˆ–è€…æ˜¯å”¯ä¸€ç´¢å¼•çš„éå”¯ä¸€å‰ç¼€ï¼Œè¿”å›æ•°æ®å¯èƒ½æ˜¯å¤šè¡Œï¼Œå› ä¸ºè™½ç„¶ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†è¯¥ç´¢å¼•åˆ—çš„å€¼å¹¶ä¸å”¯ä¸€ï¼Œæœ‰é‡å¤ï¼Œè¿™æ ·çš„è¯å³ä½¿ä½¿ç”¨ç´¢å¼•å¿«é€ŸæŸ¥æ‰¾åˆ°äº†ç¬¬ä¸€æ¡æ•°æ®ï¼Œä»ç„¶ä¸èƒ½åœæ­¢ï¼Œè¦è¿›è¡Œç›®æ ‡é™„è¿‘çš„å°èŒƒå›´æ‰«æã€‚ä½†æ˜¯å®ƒçš„å¥½å¤„æ˜¯å®ƒå¹¶ä¸éœ€è¦æ‰«æå…¨è¡¨ï¼Œå› ä¸ºç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œå³ä½¿æœ‰é‡å¤å€¼ï¼Œä¹Ÿåªæ˜¯å‡ºç°åœ¨ç›®æ ‡é™„è¿‘ï¼Œæ‰€ä»¥å¯ä»¥å¿«é€Ÿå®šä½åˆ°ç›®æ ‡é™„è¿‘ï¼Œç„¶åè¿›è¡Œå°èŒƒå›´æ‰«æã€‚</p>
<p><code>eq_ref</code> ç±»å‹æ˜¯ä½¿ç”¨ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•æ—¶äº§å“çš„è®¿é—®æ–¹å¼ï¼Œé€šå¸¸ä½¿ç”¨åœ¨å¤šè¡¨è”æŸ¥ä¸­ã€‚æ¯”å¦‚å¯¹ä¸¤å¼ è¡¨è¿›è¡Œè”æŸ¥ï¼Œå…³è”æ¡ä»¶æ˜¯ä¸¤å¼ è¡¨çš„ <code>user_id</code>å­—æ®µï¼Œä¸” <code>user_id</code>å­—æ®µæ˜¯ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆå°±ä¼šé‡‡ç”¨ <code>eq_ref</code>ç±»å‹ã€‚</p>
<p><code>const</code> ç±»å‹è¡¨ç¤ºé€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ä¸å¸¸é‡å€¼è¿›è¡Œäº†æ¯”è¾ƒ</p>
</blockquote>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ <code>const</code>å’Œ <code>eq_ref</code>éƒ½ä½¿ç”¨äº†ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªç±»å‹æœ‰æ‰€åŒºåˆ«ï¼Œ<code>const</code>ç±»å‹è¡¨ç¤ºé€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ä¸å¸¸é‡å€¼è¿›è¡Œäº†æ¯”è¾ƒï¼Œè€Œ <code>eq_ref</code>ç±»å‹è¡¨ç¤ºé€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ä¸éå¸¸é‡å€¼è¿›è¡Œäº†æ¯”è¾ƒï¼ˆä¸€èˆ¬ä¸ºå…³è”æŸ¥è¯¢ï¼‰ã€‚</p>
</blockquote>
</li>
<li>
<p><code>extra</code>ï¼šè¡¨ç¤ºæŸ¥è¯¢çš„é¢å¤–ä¿¡æ¯</p>
<blockquote>
<p>è¿™é‡Œè¯´å‡ ä¸ªé‡è¦çš„ extra ä¿¡æ¯ï¼š</p>
<ul>
<li>
<p><code>Using filesort</code>ï¼šå½“æŸ¥è¯¢è¯­å¥ä¸­åŒ…å« <code>order by</code>ï¼Œè€Œä¸”æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œçš„æ—¶å€™ï¼Œè¿™æ—¶å€™å°±ä¸å¾—éƒ¨é€‰æ‹©ç›¸åº”çš„æ’åºç®—æ³•è¿›è¡Œï¼Œç”šè‡³å¯èƒ½ä¼šé€šè¿‡æ–‡ä»¶æ’åºçš„æ–¹å¼è¿›è¡Œï¼Œæ•ˆç‡å¾ˆä½</p>
<p>(æ–‡ä»¶æ’åºï¼šæ–‡ä»¶æ’åºæ˜¯ MySQL ä¸­çš„ä¸€ç§æ’åºæ–¹å¼ï¼Œå®ƒé€šè¿‡åˆ›å»ºä¸´æ—¶æ–‡ä»¶æ¥å­˜å‚¨æ’åºç»“æœï¼Œç„¶åå¯¹ä¸´æ—¶æ–‡ä»¶è¿›è¡Œæ’åºï¼Œæœ€åè¿”å›æ’åºåçš„ç»“æœã€‚æ–‡ä»¶æ’åºçš„æ•ˆç‡å¾ˆä½ï¼Œå› ä¸ºéœ€è¦åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œè€Œä¸”éœ€è¦è¯»å–å’Œå†™å…¥ç£ç›˜ï¼Œæ‰€ä»¥æ•ˆç‡å¾ˆä½ã€‚)</p>
</li>
<li>
<p><code>Using temporary</code>ï¼šä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼ŒMySQL åœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºçš„æ—¶å€™ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œå¸¸è§äº <code>order by</code>å’Œ <code>group by</code>æ“ä½œï¼Œæ•ˆç‡å¾ˆä½ã€‚</p>
</li>
<li>
<p><code>Using index</code>ï¼šè¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚ä¹Ÿå°±æ˜¯æ‰€éœ€çš„æ•°æ®åœ¨ç´¢å¼•ä¸­å°±å¯ä»¥å…¨éƒ¨è·å¾—ï¼Œä¸éœ€è¦å†å»è¡¨ä¸­è¯»å–æ•°æ®ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p><img src="/2025/04/25/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B/1745845148865.png" alt="1745845148865"></p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>ç´¢å¼•</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>ç´¢å¼•</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 138 - éšæœºé“¾è¡¨çš„å¤åˆ¶ (Copy List with Random Pointer)</title>
    <url>/2025/04/25/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-138-Copy-List-with-Random-Pointer/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ random ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚</p>
<p>æ„é€ è¿™ä¸ªé“¾è¡¨çš„æ·±æ‹·è´ã€‚æ·±æ‹·è´åº”è¯¥æ­£å¥½ç”± n ä¸ªå…¨æ–°èŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªæ–°èŠ‚ç‚¹çš„å€¼éƒ½è®¾ä¸ºå…¶å¯¹åº”çš„åŸèŠ‚ç‚¹çš„å€¼ã€‚æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆå’Œ random æŒ‡é’ˆä¹Ÿéƒ½åº”æŒ‡å‘å¤åˆ¶é“¾è¡¨ä¸­çš„æ–°èŠ‚ç‚¹ï¼Œå¹¶ä½¿åŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨ä¸­çš„è¿™äº›æŒ‡é’ˆèƒ½å¤Ÿè¡¨ç¤ºç›¸åŒçš„é“¾è¡¨çŠ¶æ€ã€‚å¤åˆ¶é“¾è¡¨ä¸­çš„æŒ‡é’ˆéƒ½ä¸åº”æŒ‡å‘åŸé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœåŸé“¾è¡¨ä¸­æœ‰ X å’Œ Y ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­ X.random --&gt; Y ã€‚é‚£ä¹ˆåœ¨å¤åˆ¶é“¾è¡¨ä¸­å¯¹åº”çš„ä¸¤ä¸ªèŠ‚ç‚¹ x å’Œ y ï¼ŒåŒæ ·æœ‰ x.random --&gt; y ã€‚</p>
<p>è¿”å›å¤åˆ¶é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p>
<p>ç”¨ä¸€ä¸ªç”± n ä¸ªèŠ‚ç‚¹ç»„æˆçš„é“¾è¡¨æ¥è¡¨ç¤ºè¾“å…¥/è¾“å‡ºä¸­çš„é“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹ç”¨ä¸€ä¸ª [val, random_index] è¡¨ç¤ºï¼š</p>
<ul>
<li>valï¼šä¸€ä¸ªè¡¨ç¤º Node.val çš„æ•´æ•°ã€‚</li>
<li>random_indexï¼šéšæœºæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ç´¢å¼•ï¼ˆèŒƒå›´ä» 0 åˆ° n-1ï¼‰ï¼›å¦‚æœä¸æŒ‡å‘ä»»ä½•èŠ‚ç‚¹ï¼Œåˆ™ä¸º null ã€‚</li>
</ul>
<p>ä½ çš„ä»£ç åªæ¥å—åŸé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ä½œä¸ºä¼ å…¥å‚æ•°ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<p><img src="/2025/04/25/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-138-Copy-List-with-Random-Pointer/1745570173396.png" alt="1745570173396"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [[7,null],[13,0],[11,4],[10,2],[1,0]]</span><br><span class="line">è¾“å‡ºï¼š[[7,null],[13,0],[11,4],[10,2],[1,0]]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<p><img src="/2025/04/25/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-138-Copy-List-with-Random-Pointer/1745570189622.png" alt="1745570189622"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [[1,1],[2,1]]</span><br><span class="line">è¾“å‡ºï¼š[[1,1],[2,1]]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3:</strong></p>
<p><img src="/2025/04/25/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-138-Copy-List-with-Random-Pointer/1745570225789.png" alt="1745570225789"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [[3,null],[3,0],[3,null]]</span><br><span class="line">è¾“å‡ºï¼š[[3,null],[3,0],[3,null]]</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>0 &lt;= n &lt;= 1000</li>
<li>-10^4 &lt;= Node.val &lt;= 10^4</li>
<li>Node.random ä¸º null æˆ–æŒ‡å‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚</li>
<li>èŠ‚ç‚¹æ•°ç›®ä¸è¶…è¿‡ 1000 ã€‚</li>
</ul>
<h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡å‡ ç§ä¸åŒçš„æ–¹æ³•è§£å†³ï¼Œä¸‹é¢ä»‹ç»ä¸‰ç§ä¸»è¦çš„è§£æ³•ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨æ˜ å°„-ä¸¤æ¬¡éå†">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨æ˜ å°„ + ä¸¤æ¬¡éå†</h3>
<p>æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨å»ºç«‹åŸèŠ‚ç‚¹åˆ°æ–°èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ã€‚</p>
<p><strong>å®ç°æ­¥éª¤ï¼š</strong></p>
<ol>
<li>ç¬¬ä¸€æ¬¡éå†ï¼šåˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹ï¼Œå¹¶å»ºç«‹åŸèŠ‚ç‚¹åˆ°æ–°èŠ‚ç‚¹çš„æ˜ å°„</li>
<li>ç¬¬äºŒæ¬¡éå†ï¼šæ ¹æ®æ˜ å°„å…³ç³»è®¾ç½®æ–°èŠ‚ç‚¹çš„ next å’Œ random æŒ‡é’ˆ</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyRandomList</span><span class="params">(head *Node)</span></span> *Node &#123;</span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºåŸå§‹èŠ‚ç‚¹åˆ°å¤åˆ¶èŠ‚ç‚¹çš„æ˜ å°„</span></span><br><span class="line">    nodeMap := <span class="built_in">make</span>(<span class="keyword">map</span>[*Node]*Node)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡éå†ï¼šåˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹</span></span><br><span class="line">    cur := head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        nodeMap[cur] = &amp;Node&#123;Val: cur.Val&#125;</span><br><span class="line">        cur = cur.Next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ¬¡éå†ï¼šè®¾ç½®æ–°èŠ‚ç‚¹çš„nextå’ŒrandomæŒ‡é’ˆ</span></span><br><span class="line">    cur = head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        nodeMap[cur].Next = nodeMap[cur.Next]</span><br><span class="line">        nodeMap[cur].Random = nodeMap[cur.Random]</span><br><span class="line">        cur = cur.Next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nodeMap[head]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šåŸåœ°ä¿®æ”¹-æ‹†åˆ†ï¼ˆO-1-ç©ºé—´è§£æ³•ï¼‰">æ–¹æ³•äºŒï¼šåŸåœ°ä¿®æ”¹ + æ‹†åˆ†ï¼ˆO(1)ç©ºé—´è§£æ³•ï¼‰</h3>
<p>è¿™ç§æ–¹æ³•ä¸ä½¿ç”¨é¢å¤–çš„å“ˆå¸Œè¡¨ï¼Œè€Œæ˜¯é€šè¿‡ä¿®æ”¹åŸé“¾è¡¨ç»“æ„æ¥å®ç°æ·±æ‹·è´ã€‚</p>
<p><strong>å®ç°æ­¥éª¤ï¼š</strong></p>
<ol>
<li>ç¬¬ä¸€æ­¥ï¼šåœ¨æ¯ä¸ªåŸèŠ‚ç‚¹åæ’å…¥å¯¹åº”çš„å¤åˆ¶èŠ‚ç‚¹ï¼Œå½¢æˆ A-&gt;Aâ€™-&gt;B-&gt;Bâ€™-&gt;â€¦ çš„é“¾è¡¨ç»“æ„</li>
<li>ç¬¬äºŒæ­¥ï¼šè®¾ç½®å¤åˆ¶èŠ‚ç‚¹çš„ random æŒ‡é’ˆï¼Œåˆ©ç”¨ cur.Random.Next æ¥è·å–å¯¹åº”çš„å¤åˆ¶èŠ‚ç‚¹</li>
<li>ç¬¬ä¸‰æ­¥ï¼šå°†äº¤é”™çš„é“¾è¡¨æ‹†åˆ†æˆåŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyRandomList</span><span class="params">(head *Node)</span></span> *Node &#123;</span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥ï¼šåœ¨æ¯ä¸ªåŸèŠ‚ç‚¹ååˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹</span></span><br><span class="line">    cur := head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        copyNode := &amp;Node&#123;</span><br><span class="line">            Val:  cur.Val,</span><br><span class="line">            Next: cur.Next,</span><br><span class="line">        &#125;</span><br><span class="line">        cur.Next = copyNode</span><br><span class="line">        cur = copyNode.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ­¥ï¼šè®¾ç½®æ–°èŠ‚ç‚¹çš„randomæŒ‡é’ˆ</span></span><br><span class="line">    cur = head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> cur.Random != <span class="literal">nil</span> &#123;</span><br><span class="line">            cur.Next.Random = cur.Random.Next</span><br><span class="line">        &#125;</span><br><span class="line">        cur = cur.Next.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸‰æ­¥ï¼šåˆ†ç¦»åŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨</span></span><br><span class="line">    cur = head</span><br><span class="line">    copyHead := head.Next</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        copyNode := cur.Next</span><br><span class="line">        cur.Next = copyNode.Next</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> copyNode.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">            copyNode.Next = copyNode.Next.Next</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        cur = cur.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> copyHead</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šé€’å½’-å“ˆå¸Œè¡¨">æ–¹æ³•ä¸‰ï¼šé€’å½’ + å“ˆå¸Œè¡¨</h3>
<p>è¿™ç§æ–¹æ³•ä½¿ç”¨é€’å½’å’Œå“ˆå¸Œè¡¨ç»“åˆçš„æ–¹å¼è§£å†³é—®é¢˜ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyRandomList</span><span class="params">(head *Node)</span></span> *Node &#123;</span><br><span class="line">    visited := <span class="built_in">make</span>(<span class="keyword">map</span>[*Node]*Node)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> deepCopy <span class="function"><span class="keyword">func</span><span class="params">(node *Node)</span></span> *Node</span><br><span class="line">    deepCopy = <span class="function"><span class="keyword">func</span><span class="params">(node *Node)</span></span> *Node &#123;</span><br><span class="line">        <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœå·²ç»åˆ›å»ºè¿‡è¯¥èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">copy</span>, ok := visited[node]; ok &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">copy</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">        <span class="built_in">copy</span> := &amp;Node&#123;Val: node.Val&#125;</span><br><span class="line">        visited[node] = <span class="built_in">copy</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€’å½’è®¾ç½®nextå’ŒrandomæŒ‡é’ˆ</span></span><br><span class="line">        <span class="built_in">copy</span>.Next = deepCopy(node.Next)</span><br><span class="line">        <span class="built_in">copy</span>.Random = deepCopy(node.Random)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">copy</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> deepCopy(head)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é”™è¯¯åˆ†æ">é”™è¯¯åˆ†æ</h2>
<h3 id="å¸¸è§é”™è¯¯ç‚¹å’Œæ˜“é”™æ¨¡å¼">å¸¸è§é”™è¯¯ç‚¹å’Œæ˜“é”™æ¨¡å¼</h3>
<p>åœ¨å®ç°æ–¹æ³•äºŒï¼ˆåŸåœ°ä¿®æ”¹ + æ‹†åˆ†ï¼‰æ—¶ï¼Œæœ‰å‡ ä¸ªå®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼š</p>
<h4 id="é”™è¯¯å®ç°">é”™è¯¯å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyRandomList</span><span class="params">(head *Node)</span></span> *Node &#123;</span><br><span class="line">    cur := head</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºäº¤é”™é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        copyNode := &amp;Node&#123;</span><br><span class="line">            Next: cur.Next,</span><br><span class="line">            Val:  cur.Val,</span><br><span class="line">        &#125;</span><br><span class="line">        cur.Next = copyNode</span><br><span class="line">        cur = copyNode.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ­¥ï¼šè®¾ç½®randomæŒ‡é’ˆ</span></span><br><span class="line">    cur = head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        cur.Next.Random = cur.Random.Next  <span class="comment">// é”™è¯¯ï¼šæ²¡æœ‰æ£€æŸ¥cur.Randomæ˜¯å¦ä¸ºnil</span></span><br><span class="line">        cur = cur.Next.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸‰æ­¥ï¼šæ‹†åˆ†é“¾è¡¨</span></span><br><span class="line">    cur = head</span><br><span class="line">    copy1 := cur.Next</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        tmpNext := cur.Next</span><br><span class="line">        cur.Next = tmpNext.Next</span><br><span class="line">        tmpNext.Next = cur.Next.Next  <span class="comment">// é”™è¯¯ï¼šæ²¡æœ‰æ£€æŸ¥cur.Nextæ˜¯å¦ä¸ºnil</span></span><br><span class="line">        cur = cur.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> copy1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="é”™è¯¯åˆ†æ-2">é”™è¯¯åˆ†æ</h4>
<p>ä¸Šè¿°å®ç°æœ‰ä¸‰ä¸ªä¸»è¦é—®é¢˜ï¼š</p>
<ol>
<li><strong>æ²¡æœ‰å¤„ç†ç©ºé“¾è¡¨</strong>ï¼šå½“ <code>head == nil</code> æ—¶ï¼Œåº”è¯¥ç›´æ¥è¿”å› <code>nil</code></li>
<li><strong>æ²¡æœ‰å¤„ç† Random æŒ‡é’ˆä¸ºç©º</strong>ï¼šåœ¨è®¾ç½® <code>cur.Next.Random</code> æ—¶ï¼Œå¦‚æœ <code>cur.Random</code> ä¸º <code>nil</code>ï¼Œä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸</li>
<li><strong>é“¾è¡¨æ‹†åˆ†å¤„ç†ä¸å½“</strong>ï¼šåœ¨æ‹†åˆ†é“¾è¡¨æœ€åé˜¶æ®µï¼Œæ²¡æœ‰æ­£ç¡®å¤„ç†å°¾èŠ‚ç‚¹çš„æƒ…å†µï¼Œå¯èƒ½å¯¼è‡´ <code>nil</code> æŒ‡é’ˆè§£å¼•ç”¨</li>
</ol>
<h4 id="ä¿®æ­£å®ç°">ä¿®æ­£å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyRandomList</span><span class="params">(head *Node)</span></span> *Node &#123;</span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºäº¤é”™é“¾è¡¨</span></span><br><span class="line">    cur := head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        copyNode := &amp;Node&#123;</span><br><span class="line">            Next: cur.Next,</span><br><span class="line">            Val:  cur.Val,</span><br><span class="line">        &#125;</span><br><span class="line">        cur.Next = copyNode</span><br><span class="line">        cur = copyNode.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ­¥ï¼šè®¾ç½®randomæŒ‡é’ˆ</span></span><br><span class="line">    cur = head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> cur.Random != <span class="literal">nil</span> &#123;</span><br><span class="line">            cur.Next.Random = cur.Random.Next</span><br><span class="line">        &#125;</span><br><span class="line">        cur = cur.Next.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸‰æ­¥ï¼šæ‹†åˆ†é“¾è¡¨</span></span><br><span class="line">    cur = head</span><br><span class="line">    copyHead := head.Next</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        copyNode := cur.Next</span><br><span class="line">        cur.Next = copyNode.Next</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> copyNode.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">            copyNode.Next = copyNode.Next.Next</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        cur = cur.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> copyHead</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
<th>ç©ºé—´å¤æ‚åº¦</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>æ¨èåº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>å“ˆå¸Œè¡¨æ˜ å°„</td>
<td>O(n)</td>
<td>O(n)</td>
<td>å®ç°ç®€å•ï¼Œç›´è§‚æ˜“æ‡‚</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
<tr>
<td>åŸåœ°ä¿®æ”¹ + æ‹†åˆ†</td>
<td>O(n)</td>
<td>O(1)</td>
<td>å¸¸æ•°ç©ºé—´å¤æ‚åº¦</td>
<td>å®ç°å¤æ‚ï¼Œæ˜“å‡ºé”™</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
<tr>
<td>é€’å½’ + å“ˆå¸Œè¡¨</td>
<td>O(n)</td>
<td>O(n)</td>
<td>ä»£ç ç²¾ç®€ï¼Œé€»è¾‘æ¸…æ™°</td>
<td>é€’å½’æ ˆå¯èƒ½å¯¼è‡´æ ˆæº¢å‡º</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®å­¦ä¹ ç‚¹">å…³é”®å­¦ä¹ ç‚¹</h2>
<ol>
<li><strong>é“¾è¡¨æ“ä½œçš„è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šåœ¨é“¾è¡¨é—®é¢˜ä¸­ï¼Œå§‹ç»ˆè¦è€ƒè™‘ç©ºé“¾è¡¨ã€å•èŠ‚ç‚¹é“¾è¡¨ç­‰è¾¹ç•Œæƒ…å†µ</li>
<li><strong>ç©ºæŒ‡é’ˆæ£€æŸ¥çš„é‡è¦æ€§</strong>ï¼šå¯¹å¯èƒ½ä¸ºç©ºçš„æŒ‡é’ˆè¿›è¡Œæ“ä½œå‰ï¼Œå¿…é¡»è¿›è¡Œéç©ºæ£€æŸ¥</li>
<li><strong>ä¸ä½¿ç”¨é¢å¤–ç©ºé—´çš„æŠ€å·§</strong>ï¼šå¦‚ä½•é€šè¿‡ä¿®æ”¹åŸæ•°æ®ç»“æ„æ¥é¿å…ä½¿ç”¨é¢å¤–ç©ºé—´</li>
<li><strong>æ·±æ‹·è´ä¸æµ…æ‹·è´çš„åŒºåˆ«</strong>ï¼šæ·±æ‹·è´éœ€è¦å¤åˆ¶æ‰€æœ‰ç›¸å…³è”çš„å¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ç›´æ¥å¼•ç”¨</li>
</ol>
<p>è¿™é“é¢˜æ˜¯é“¾è¡¨æ“ä½œçš„ç»å…¸é—®é¢˜ï¼ŒæŒæ¡å®ƒå¯¹ç†è§£æ›´å¤æ‚çš„é“¾è¡¨æ“ä½œæœ‰å¾ˆå¤§å¸®åŠ©ã€‚åŸåœ°ä¿®æ”¹çš„æ–¹æ³•è™½ç„¶å®ç°å¤æ‚ï¼Œä½†é€šè¿‡åœ¨åŸé“¾è¡¨ä¸Šå·§å¦™åœ°æ„å»ºä¿¡æ¯æ¥é™ä½ç©ºé—´å¤æ‚åº¦ï¼Œæ˜¯ä¸€ç§å€¼å¾—å­¦ä¹ çš„é«˜çº§æŠ€å·§ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>è¿­ä»£</tag>
        <tag>Hot100</tag>
        <tag>å“ˆå¸Œ</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLè¡Œæº¢å‡ºçš„å¤„ç†</title>
    <url>/2025/04/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%A1%8C%E6%BA%A2%E5%87%BA%E7%9A%84%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h2 id="è¡Œæº¢å‡º">è¡Œæº¢å‡º</h2>
<p>MYSQL ä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼Œä¸€é¡µçš„å¤§å°ä¸º 16KBã€‚</p>
<p>å¦‚æœä¸€ä¸ªå­—æ®µå­˜å‚¨çš„å†…å®¹è¶…è¿‡äº† 16KBï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µå°±ä¼šå‘ç”Ÿè¡Œæº¢å‡ºã€‚</p>
<blockquote>
<p>æ¯”å¦‚ä¹‹å‰è¯´è¿‡ VARCHAR ç±»å‹çš„æœ€å¤§é•¿åº¦æ˜¯ 65532ï¼ˆå…è®¸ä¸º NULLï¼‰ï¼Œé‚£ä¹ˆ Varchar çš„é•¿åº¦æ˜æ˜¾æ˜¯ä¼šè¶…è¿‡ä¸€é¡µçš„å¤§å°çš„ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿè¡Œæº¢å‡ºã€‚</p>
<p><a href="/2025/04/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Varchar%E6%9C%80%E5%A4%A7%E5%8F%96%E5%80%BC/">VARCHAR ç±»å‹æœ€å¤§å–å€¼</a></p>
</blockquote>
<h2 id="è¡Œæº¢å‡ºçš„å¤„ç†">è¡Œæº¢å‡ºçš„å¤„ç†</h2>
<h3 id="Compact-è¡Œæ ¼å¼">Compact è¡Œæ ¼å¼</h3>
<p>å½“åœ¨ä½¿ç”¨ Compact è¡Œæ ¼å¼æ—¶ï¼Œå¦‚æœå‘ç”Ÿè¡Œæº¢å‡ºï¼ŒMYSQL ä¼šä½¿ç”¨æº¢å‡ºé¡µæ¥å­˜å‚¨æº¢å‡ºçš„æ•°æ®ã€‚å®ƒä¼šåœ¨çœŸå®æ•°æ®å¤„åªä¼šå­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå‰©ä½™çš„æ•°æ®ä¼šå­˜å‚¨åœ¨æº¢å‡ºé¡µä¸­ã€‚ç„¶ååœ¨çœŸå®æ•°æ®å¤„çš„æœ€å 20 ä¸ªå­—èŠ‚å­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ï¼Œä»è€Œæ–¹ä¾¿å¿«é€Ÿå®šä½åˆ°æº¢å‡ºé¡µã€‚</p>
<p><img src="/2025/04/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%A1%8C%E6%BA%A2%E5%87%BA%E7%9A%84%E5%A4%84%E7%90%86/1745566523989.png" alt="1745566523989"></p>
<h3 id="Compressed-å’Œ-Dynamic-è¡Œæ ¼å¼">Compressed å’Œ Dynamic è¡Œæ ¼å¼</h3>
<p>Compressed å’Œ Dynamic è¡Œæ ¼å¼ä¸ Compact è¡Œæ ¼å¼ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨æº¢å‡ºçš„å¤„ç†ä¸Šæœ‰æ‰€ä¸åŒã€‚å®ƒä¸ä¼šåœ¨çœŸå®æ•°æ®å¤„å­˜å‚¨éƒ¨åˆ†æ•°æ®ï¼Œè€Œæ˜¯å®Œå…¨åªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ã€‚çœŸå®æ•°æ®å®Œå…¨å­˜å‚¨åœ¨æº¢å‡ºé¡µä¸­ã€‚</p>
<p><img src="/2025/04/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%A1%8C%E6%BA%A2%E5%87%BA%E7%9A%84%E5%A4%84%E7%90%86/1745566626788.png" alt="1745566626788"></p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>å­˜å‚¨åŸç†</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>MySQL</tag>
        <tag>è¡Œæº¢å‡º</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 25: K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨ï¼ˆReverse Nodes in k-Groupï¼‰</title>
    <url>/2025/04/24/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-25-Reverse-Nodes-in-k-Group/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ k ä¸ªèŠ‚ç‚¹ä¸€ç»„è¿›è¡Œç¿»è½¬ï¼Œè¯·ä½ è¿”å›ä¿®æ”¹åçš„é“¾è¡¨ã€‚</p>
<p>k æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå®ƒçš„å€¼å°äºæˆ–ç­‰äºé“¾è¡¨çš„é•¿åº¦ã€‚å¦‚æœèŠ‚ç‚¹æ€»æ•°ä¸æ˜¯ k çš„æ•´æ•°å€ï¼Œé‚£ä¹ˆè¯·å°†æœ€åå‰©ä½™çš„èŠ‚ç‚¹ä¿æŒåŸæœ‰é¡ºåºã€‚</p>
<p>ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: head = [1,2,3,4,5], k = 2</span><br><span class="line">è¾“å‡º: [2,1,4,3,5]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: head = [1,2,3,4,5], k = 3</span><br><span class="line">è¾“å‡º: [3,2,1,4,5]</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶:</strong></p>
<ul>
<li>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®ä¸º n</li>
<li>1 &lt;= k &lt;= n &lt;= 5000</li>
<li>0 &lt;= Node.val &lt;= 1000</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>æœ¬é¢˜è¦æ±‚æˆ‘ä»¬ä»¥ k ä¸ªèŠ‚ç‚¹ä¸ºä¸€ç»„è¿›è¡Œç¿»è½¬ï¼Œå¦‚æœæœ€åå‰©ä½™çš„èŠ‚ç‚¹ä¸è¶³ k ä¸ªï¼Œåˆ™ä¿æŒåŸæ ·ã€‚è¿™æ˜¯é“¾è¡¨æ“ä½œä¸­çš„ä¸€ä¸ªå…¸å‹é—®é¢˜ï¼Œä¸»è¦æ¶‰åŠé“¾è¡¨çš„ç¿»è½¬æ“ä½œã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<ol>
<li>ç¡®å®šæ¯ç»„ k ä¸ªèŠ‚ç‚¹çš„èŒƒå›´</li>
<li>ç¿»è½¬è¿™ k ä¸ªèŠ‚ç‚¹</li>
<li>å°†ç¿»è½¬åçš„ç»„ä¸å‰åéƒ¨åˆ†è¿æ¥èµ·æ¥</li>
<li>ç§»åŠ¨åˆ°ä¸‹ä¸€ç»„ç»§ç»­æ“ä½œ</li>
</ol>
<p>æˆ‘ä»¬ä½¿ç”¨è¿­ä»£çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä¸€ä¸ªå¾ªç¯æ¥å¤„ç†æ¯ç»„ k ä¸ªèŠ‚ç‚¹ã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="é”™è¯¯ç‰ˆæœ¬åˆ†æ">é”™è¯¯ç‰ˆæœ¬åˆ†æ</h3>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å‡ºé”™çš„ä»£ç ç‰ˆæœ¬ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseKGroup</span><span class="params">(head *ListNode, k <span class="type">int</span>)</span></span> *ListNode &#123;</span><br><span class="line">	<span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> || k == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> head</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dummyHead := &amp;ListNode&#123;</span><br><span class="line">		Next: head,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	first := dummyHead</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> prev, end *ListNode</span><br><span class="line">	cur := dummyHead.Next</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		end = first</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k; i++ &#123;</span><br><span class="line">			end = end.Next</span><br><span class="line">			<span class="keyword">if</span> end == <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> end == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		tmp := first.Next</span><br><span class="line">		cur = tmp.Next</span><br><span class="line">		prev = tmp</span><br><span class="line">		<span class="keyword">for</span> cur != <span class="literal">nil</span> &amp;&amp; cur != end.Next &#123;</span><br><span class="line">			tmp2 := cur.Next</span><br><span class="line">			cur.Next = prev</span><br><span class="line">			prev = cur</span><br><span class="line">			cur = tmp2</span><br><span class="line">		&#125;</span><br><span class="line">		first.Next = end</span><br><span class="line">		tmp.Next = cur</span><br><span class="line"></span><br><span class="line">		first = tmp</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dummyHead.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç‰ˆæœ¬çš„ä¸»è¦é—®é¢˜å‡ºç°åœ¨ç¿»è½¬é“¾è¡¨çš„å¾ªç¯æ¡ä»¶ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> cur != <span class="literal">nil</span> &amp;&amp; cur != end.Next &#123;</span><br><span class="line">    tmp2 := cur.Next</span><br><span class="line">    cur.Next = prev</span><br><span class="line">    prev = cur</span><br><span class="line">    cur = tmp2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯åŸå› </strong>: åœ¨ç¿»è½¬é“¾è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†èŠ‚ç‚¹çš„ <code>Next</code> æŒ‡é’ˆã€‚å½“æˆ‘ä»¬åœ¨å¾ªç¯ä¸­æ£€æŸ¥ <code>cur != end.Next</code> è¿™ä¸ªæ¡ä»¶æ—¶ï¼Œç”±äº <code>end</code> æ˜¯é“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶ <code>Next</code> æŒ‡é’ˆå¯èƒ½åœ¨å¾ªç¯è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼Œå¯¼è‡´å¾ªç¯ç»ˆæ­¢æ¡ä»¶ä¸ç¬¦åˆé¢„æœŸã€‚</p>
<h3 id="ä¿®å¤ç‰ˆæœ¬">ä¿®å¤ç‰ˆæœ¬</h3>
<p>ä¿®å¤åçš„ä»£ç ç‰ˆæœ¬ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseKGroup</span><span class="params">(head *ListNode, k <span class="type">int</span>)</span></span> *ListNode &#123;</span><br><span class="line">	<span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> || k == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> head</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dummyHead := &amp;ListNode&#123;</span><br><span class="line">		Next: head,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	first := dummyHead</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> prev, end *ListNode</span><br><span class="line">	cur := dummyHead.Next</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		end = first</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k; i++ &#123;</span><br><span class="line">			end = end.Next</span><br><span class="line">			<span class="keyword">if</span> end == <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> end == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		tmp := first.Next</span><br><span class="line">		cur = tmp.Next</span><br><span class="line">		prev = tmp</span><br><span class="line">		afterEnd := end.Next</span><br><span class="line">		<span class="keyword">for</span> cur != <span class="literal">nil</span> &amp;&amp; cur != afterEnd &#123;</span><br><span class="line">			tmp2 := cur.Next</span><br><span class="line">			cur.Next = prev</span><br><span class="line">			prev = cur</span><br><span class="line">			cur = tmp2</span><br><span class="line">		&#125;</span><br><span class="line">		first.Next = end</span><br><span class="line">		tmp.Next = cur</span><br><span class="line"></span><br><span class="line">		first = tmp</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dummyHead.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¿®å¤ç‚¹</strong>: é€šè¿‡åœ¨å¼€å§‹ç¿»è½¬å‰ä¿å­˜ <code>end.Next</code> åˆ° <code>afterEnd</code> å˜é‡ï¼Œæˆ‘ä»¬ç¡®ä¿äº†å¾ªç¯çš„ç»ˆæ­¢æ¡ä»¶ä¸ä¼šå—åˆ°é“¾è¡¨ç»“æ„å˜åŒ–çš„å½±å“ã€‚è¿™æ ·ï¼Œå³ä½¿åœ¨ç¿»è½¬è¿‡ç¨‹ä¸­ä¿®æ”¹äº†èŠ‚ç‚¹é—´çš„è¿æ¥å…³ç³»ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½æ­£ç¡®åœ°ç¡®å®šä½•æ—¶åœæ­¢ç¿»è½¬å½“å‰ç»„çš„èŠ‚ç‚¹ã€‚</p>
<h3 id="ä¼˜åŒ–ç‰ˆæœ¬">ä¼˜åŒ–ç‰ˆæœ¬</h3>
<p>è™½ç„¶ä¿®å¤åçš„ä»£ç èƒ½å¤Ÿæ­£ç¡®å·¥ä½œï¼Œä½†æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ä»£ç ï¼Œä½¿å…¶é€»è¾‘æ›´æ¸…æ™°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseKGroup</span><span class="params">(head *ListNode, k <span class="type">int</span>)</span></span> *ListNode &#123;</span><br><span class="line">	<span class="comment">// å¤„ç†ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line">	<span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> || k == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> head</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ›å»ºè™šæ‹Ÿå¤´èŠ‚ç‚¹ç®€åŒ–è¾¹ç•Œå¤„ç†</span></span><br><span class="line">	dummy := &amp;ListNode&#123;Next: head&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// groupPrev æŒ‡å‘å½“å‰å¾…ç¿»è½¬ç»„çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">	groupPrev := dummy</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æŒç»­å¤„ç†æ¯ç»„ k ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 1. æ£€æŸ¥å‰©ä½™èŠ‚ç‚¹æ˜¯å¦æœ‰ k ä¸ª</span></span><br><span class="line">		groupEnd := groupPrev</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k; i++ &#123;</span><br><span class="line">			groupEnd = groupEnd.Next</span><br><span class="line">			<span class="keyword">if</span> groupEnd == <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="comment">// å‰©ä½™èŠ‚ç‚¹ä¸è¶³ k ä¸ªï¼Œä¸å†ç¿»è½¬</span></span><br><span class="line">				<span class="keyword">return</span> dummy.Next</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 2. è·å–åˆ†ç»„çš„èµ·å§‹å’Œç»“æŸä½ç½®</span></span><br><span class="line">		groupStart := groupPrev.Next</span><br><span class="line">		groupNext := groupEnd.Next</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 3. ç¿»è½¬ k ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">		prev := groupNext  <span class="comment">// ç¿»è½¬åå°¾èŠ‚ç‚¹æŒ‡å‘çš„ä½ç½®</span></span><br><span class="line">		curr := groupStart</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// ç»å…¸é“¾è¡¨ç¿»è½¬ç®—æ³•</span></span><br><span class="line">		<span class="keyword">for</span> curr != groupNext &#123;</span><br><span class="line">			next := curr.Next</span><br><span class="line">			curr.Next = prev</span><br><span class="line">			prev = curr</span><br><span class="line">			curr = next</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 4. è¿æ¥ç¿»è½¬åçš„ç»„ä¸ä¹‹å‰çš„é“¾è¡¨</span></span><br><span class="line">		groupPrev.Next = groupEnd  <span class="comment">// å‰ä¸€ä¸ªèŠ‚ç‚¹è¿æ¥åˆ°ç¿»è½¬åçš„å¤´</span></span><br><span class="line">		groupStart.Next = groupNext  <span class="comment">// ç¿»è½¬åçš„å°¾è¿æ¥åˆ°ä¸‹ä¸€ç»„çš„å¼€å§‹</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 5. æ›´æ–° groupPrev ä¸ºä¸‹ä¸€ç»„çš„å‰èŠ‚ç‚¹</span></span><br><span class="line">		groupPrev = groupStart</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¼˜åŒ–ç‰ˆæœ¬ä¸­ï¼š</p>
<ol>
<li>ä½¿ç”¨äº†æ›´æœ‰æè¿°æ€§çš„å˜é‡åï¼ˆå¦‚ <code>groupStart</code>, <code>groupEnd</code>, <code>groupNext</code>, <code>groupPrev</code>ï¼‰</li>
<li>æ·»åŠ äº†æ¸…æ™°çš„æ³¨é‡Šï¼Œè§£é‡Šæ¯ä¸ªæ­¥éª¤çš„ç›®çš„</li>
<li>ç®€åŒ–äº†é“¾è¡¨ç¿»è½¬çš„å®ç°ï¼Œä½¿ç”¨æ ‡å‡†çš„ä¸‰æŒ‡é’ˆç¿»è½¬æ–¹æ³•</li>
<li>åˆ†ç¦»äº†ä¸åŒçš„é€»è¾‘éƒ¨åˆ†ï¼Œä½¿ä»£ç æ›´æ˜“ç†è§£</li>
<li>ç›´æ¥è¿”å› <code>dummy.Next</code> è€Œä¸æ˜¯ä½¿ç”¨ <code>break</code> å’Œé¢å¤–çš„æ§åˆ¶å˜é‡</li>
</ol>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n)ï¼Œå…¶ä¸­ n æ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚è™½ç„¶æœ‰åµŒå¥—å¾ªç¯ï¼Œä½†æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šè¢«è®¿é—®ä¸¤æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(1)ï¼Œåªä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–å˜é‡ï¼Œæ²¡æœ‰ä½¿ç”¨é¢å¤–çš„æ•°æ®ç»“æ„ã€‚</li>
</ul>
<h2 id="å…³é”®è¦ç‚¹">å…³é”®è¦ç‚¹</h2>
<ol>
<li>
<p><strong>é“¾è¡¨ä¿®æ”¹çš„æ³¨æ„ç‚¹</strong>: åœ¨ä¿®æ”¹é“¾è¡¨ç»“æ„æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„é‚£äº›ä¾èµ–äºé“¾è¡¨å½“å‰ç»“æ„çš„æ¡ä»¶åˆ¤æ–­ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å­¦åˆ°äº†åœ¨å¼€å§‹ä¿®æ”¹å‰ä¿å­˜å…³é”®èŠ‚ç‚¹å¼•ç”¨çš„é‡è¦æ€§ã€‚</p>
</li>
<li>
<p><strong>å˜é‡å‘½åçš„é‡è¦æ€§</strong>: ä¼˜åŒ–ç‰ˆä»£ç é€šè¿‡ä½¿ç”¨æ›´æœ‰æè¿°æ€§çš„å˜é‡åï¼Œæå¤§åœ°æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œä½¿äººæ›´å®¹æ˜“ç†è§£ç®—æ³•çš„é€»è¾‘ã€‚</p>
</li>
<li>
<p><strong>åˆ†ç»„å¤„ç†çš„æ€æƒ³</strong>: è¿™ç§æŒ‰ç»„å¤„ç†çš„æ€æƒ³åœ¨å¾ˆå¤šé“¾è¡¨å’Œæ•°ç»„é—®é¢˜ä¸­éƒ½å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å°†ä¸€ä¸ªå¤æ‚é—®é¢˜åˆ†è§£ä¸ºå¤„ç†å•ä¸ªç»„å’Œç»„ä¹‹é—´è¿æ¥çš„å­é—®é¢˜ã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªé—®é¢˜æ˜¯é“¾è¡¨æ“ä½œçš„å…¸å‹ä¾‹å­ï¼ŒæŒæ¡äº†è¿™é‡Œçš„ç¿»è½¬æŠ€å·§ï¼Œå¯ä»¥åº”ç”¨åˆ°å¾ˆå¤šå…¶ä»–çš„é“¾è¡¨é—®é¢˜ä¸­ï¼Œå¦‚é“¾è¡¨çš„éƒ¨åˆ†ç¿»è½¬ã€ä¸¤ä¸¤äº¤æ¢èŠ‚ç‚¹ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>é€’å½’</tag>
        <tag>è¿­ä»£</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Hard</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 24 - ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ (Swap Nodes in Pairs)</title>
    <url>/2025/04/24/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-24-Swap-Nodes-in-Pairs/</url>
    <content><![CDATA[<h2 id="Problem-Description">Problem Description</h2>
<p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œä¸¤ä¸¤äº¤æ¢å…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›äº¤æ¢åé“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚ä½ å¿…é¡»åœ¨ä¸ä¿®æ”¹èŠ‚ç‚¹å†…éƒ¨çš„å€¼çš„æƒ…å†µä¸‹å®Œæˆæœ¬é¢˜ï¼ˆå³ï¼Œåªèƒ½è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ï¼‰ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,2,3,4]</span><br><span class="line">è¾“å‡ºï¼š[2,1,4,3]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1]</span><br><span class="line">è¾“å‡ºï¼š[1]</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [0, 100] å†…</li>
<li>0 &lt;= Node.val &lt;= 100</li>
</ul>
<h2 id="Solution-Approach">Solution Approach</h2>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„é“¾è¡¨æ“ä½œé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸¤äº¤æ¢ç›¸é‚»èŠ‚ç‚¹ã€‚æœ‰ä¸¤ç§å¸¸è§çš„è§£å†³æ–¹æ³•ï¼šè¿­ä»£æ³•å’Œé€’å½’æ³•ã€‚</p>
<h3 id="è¿­ä»£æ³•">è¿­ä»£æ³•</h3>
<p>è¿­ä»£æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨ä¸‰ä¸ªæŒ‡é’ˆæ¥å®Œæˆç›¸é‚»èŠ‚ç‚¹çš„äº¤æ¢ã€‚æˆ‘ä»¬éœ€è¦ï¼š</p>
<ol>
<li>ä¸€ä¸ªå“‘èŠ‚ç‚¹ï¼ˆdummy nodeï¼‰ä½œä¸ºæ–°é“¾è¡¨çš„èµ·ç‚¹</li>
<li>ä¸€ä¸ªå‰ç½®æŒ‡é’ˆï¼ˆprevï¼‰æŒ‡å‘å·²å¤„ç†éƒ¨åˆ†çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</li>
<li>ä¸€ä¸ªå½“å‰æŒ‡é’ˆï¼ˆcurrï¼‰æŒ‡å‘å¾…å¤„ç†çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</li>
</ol>
<p><strong>å…³é”®æ­¥éª¤</strong>:</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå“‘èŠ‚ç‚¹æŒ‡å‘åŸé“¾è¡¨å¤´</li>
<li>åˆå§‹åŒ– prev ä¸ºå“‘èŠ‚ç‚¹ï¼Œcurr ä¸ºé“¾è¡¨å¤´</li>
<li>å½“ curr å’Œ curr.next éƒ½éç©ºæ—¶è¿›è¡Œäº¤æ¢ï¼š
<ul>
<li>ä¸´æ—¶ä¿å­˜ curr.next.next</li>
<li>è°ƒæ•´æŒ‡é’ˆå®Œæˆäº¤æ¢</li>
<li>ç§»åŠ¨ prev å’Œ curr æŒ‡é’ˆç»§ç»­å¤„ç†ä¸‹ä¸€å¯¹èŠ‚ç‚¹</li>
</ul>
</li>
<li>è¿”å›å“‘èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹</li>
</ol>
<p>ä»¥ç¤ºä¾‹ 1 ä¸ºä¾‹ï¼Œäº¤æ¢è¿‡ç¨‹å¯è§†åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dummy -&gt; 1 -&gt; 2 -&gt; 3 -&gt; 4</span><br><span class="line">prev    curr</span><br><span class="line"></span><br><span class="line">äº¤æ¢å</span><br><span class="line">dummy -&gt; 2 -&gt; 1 -&gt; 3 -&gt; 4</span><br><span class="line">          |    |</span><br><span class="line">          |    curr (æ–°çš„ curr)</span><br><span class="line">          |</span><br><span class="line">          prev (æ–°çš„ prev)</span><br><span class="line"></span><br><span class="line">ç»§ç»­äº¤æ¢</span><br><span class="line">dummy -&gt; 2 -&gt; 1 -&gt; 4 -&gt; 3</span><br><span class="line">                     |</span><br><span class="line">                     curr=nil (ç»“æŸ)</span><br></pre></td></tr></table></figure>
<h2 id="Code-Implementation">Code Implementation</h2>
<h3 id="1-è¿­ä»£è§£æ³•">1. è¿­ä»£è§£æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapPairs</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µï¼šç©ºé“¾è¡¨æˆ–åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºå“‘èŠ‚ç‚¹æŒ‡å‘é“¾è¡¨å¤´</span></span><br><span class="line">    dummyHead := &amp;ListNode&#123;</span><br><span class="line">        Next: head,</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æŒ‡é’ˆ</span></span><br><span class="line">    prev, curr := dummyHead, head</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å½“æœ‰ä¸€å¯¹èŠ‚ç‚¹å¯äº¤æ¢æ—¶è¿›è¡Œäº¤æ¢</span></span><br><span class="line">    <span class="keyword">for</span> curr != <span class="literal">nil</span> &amp;&amp; curr.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// ä¿å­˜ä¸‹ä¸€å¯¹èŠ‚ç‚¹çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">        nextPair := curr.Next.Next</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// äº¤æ¢å½“å‰ä¸€å¯¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// 1-&gt;2-&gt;3-&gt;4 å˜ä¸º 2-&gt;1-&gt;3-&gt;4</span></span><br><span class="line">        second := curr.Next     <span class="comment">// second = 2</span></span><br><span class="line">        second.Next = curr      <span class="comment">// 2-&gt;1</span></span><br><span class="line">        curr.Next = nextPair    <span class="comment">// 1-&gt;3</span></span><br><span class="line">        prev.Next = second      <span class="comment">// dummy-&gt;2</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç§»åŠ¨æŒ‡é’ˆï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€å¯¹èŠ‚ç‚¹</span></span><br><span class="line">        prev = curr             <span class="comment">// prev = 1</span></span><br><span class="line">        curr = nextPair         <span class="comment">// curr = 3</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dummyHead.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-é€’å½’è§£æ³•">2. é€’å½’è§£æ³•</h3>
<p>é€’å½’æ³•æ›´ç®€æ´ï¼Œä½†éœ€è¦ç†è§£é€’å½’æ€æƒ³ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapPairs</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="comment">// åŸºæœ¬æƒ…å†µï¼šç©ºé“¾è¡¨æˆ–åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜ç¬¬äºŒä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    second := head.Next</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€’å½’å¤„ç†å‰©ä½™éƒ¨åˆ†ï¼Œä»ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹å¼€å§‹</span></span><br><span class="line">    head.Next = swapPairs(second.Next)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// äº¤æ¢å‰ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    second.Next = head</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›æ–°çš„å¤´èŠ‚ç‚¹ï¼ˆåŸæ¥çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> second</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Complexity-Analysis">Complexity Analysis</h2>
<h3 id="è¿­ä»£æ³•-2">è¿­ä»£æ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n)ï¼Œå…¶ä¸­ n æ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚æˆ‘ä»¬éœ€è¦éå†ä¸€æ¬¡é“¾è¡¨ï¼Œæ¯æ¬¡å¤„ç†ä¸¤ä¸ªèŠ‚ç‚¹ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(1)ï¼Œåªä½¿ç”¨äº†å¸¸æ•°ä¸ªé¢å¤–å˜é‡ã€‚</li>
</ul>
<h3 id="é€’å½’æ³•">é€’å½’æ³•</h3>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n)ï¼ŒåŒæ ·éœ€è¦å¤„ç†æ¯ä¸ªèŠ‚ç‚¹ä¸€æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(n/2) â‰ˆ O(n)ï¼Œé€’å½’æ ˆçš„æ·±åº¦ä¸ºé“¾è¡¨é•¿åº¦çš„ä¸€åŠï¼ˆæ¯æ¬¡é€’å½’å¤„ç†ä¸¤ä¸ªèŠ‚ç‚¹ï¼‰ã€‚</li>
</ul>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è¿­ä»£æ³•</th>
<th>é€’å½’æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä»£ç å¤æ‚åº¦</td>
<td>ä¸­ç­‰</td>
<td>ç®€æ´</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>èŠ‚çœç©ºé—´</td>
<td>ä»£ç ç®€æ´æ˜“æ‡‚</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦å¤„ç†å¤šä¸ªæŒ‡é’ˆ</td>
<td>å¤§é“¾è¡¨å¯èƒ½å¯¼è‡´æ ˆæº¢å‡º</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="Key-Learnings">Key Learnings</h2>
<ol>
<li>
<p><strong>é“¾è¡¨æ“ä½œçš„å…³é”®åœ¨äºæŒ‡é’ˆç®¡ç†</strong>ï¼šåœ¨å¤„ç†é“¾è¡¨æ—¶ï¼Œåˆç†ä½¿ç”¨æŒ‡é’ˆå˜é‡å¯ä»¥æå¤§ç®€åŒ–æ“ä½œã€‚</p>
</li>
<li>
<p><strong>å“‘èŠ‚ç‚¹ï¼ˆDummy Nodeï¼‰çš„ä½¿ç”¨</strong>ï¼šåœ¨è®¸å¤šé“¾è¡¨é—®é¢˜ä¸­ï¼Œä½¿ç”¨å“‘èŠ‚ç‚¹å¯ä»¥ç»Ÿä¸€æ“ä½œï¼Œé¿å…å¤„ç†å¤´èŠ‚ç‚¹çš„ç‰¹æ®Šæƒ…å†µã€‚</p>
</li>
<li>
<p><strong>è¿­ä»£vsé€’å½’</strong>ï¼šé“¾è¡¨é—®é¢˜é€šå¸¸å¯ä»¥ç”¨è¿™ä¸¤ç§æ–¹æ³•è§£å†³ã€‚é€’å½’å¾€å¾€ä»£ç æ›´ç®€æ´ï¼Œä½†ç©ºé—´å¤æ‚åº¦æ›´é«˜ã€‚</p>
</li>
<li>
<p><strong>ç”»å›¾è¾…åŠ©ç†è§£</strong>ï¼šå¯¹äºå¤æ‚çš„é“¾è¡¨æ“ä½œï¼Œç”»å‡ºèŠ‚ç‚¹å’ŒæŒ‡é’ˆçš„å˜åŒ–è¿‡ç¨‹æœ‰åŠ©äºç†è§£å’Œè°ƒè¯•ã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªé—®é¢˜æ˜¯é“¾è¡¨æ“ä½œçš„åŸºç¡€ç»ƒä¹ ï¼ŒæŒæ¡å®ƒå¯¹ç†è§£æ›´å¤æ‚çš„é“¾è¡¨é—®é¢˜å¾ˆæœ‰å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>é€’å½’</tag>
        <tag>è¿­ä»£</tag>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysqlä¸­Varcharæœ€å¤§å–å€¼</title>
    <url>/2025/04/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Varchar%E6%9C%80%E5%A4%A7%E5%8F%96%E5%80%BC/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨çœ‹è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ Mysql çš„è®°å½•å­˜å‚¨æ–¹å¼ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/">Mysql è®°å½•å­˜å‚¨æ–¹å¼</a></p>
<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“ä¸€ä¸ªçŸ¥è¯†ç‚¹:MYSQL ä¸­è§„å®šï¼Œ<strong>é™¤äº† <code>Text</code>ã€<code>Blob</code>ç±»å‹ï¼Œå…¶ä»–ç±»å‹å…¶ä»–æ‰€æœ‰çš„åˆ—ï¼ˆä¸åŒ…æ‹¬éšè—åˆ—å’Œè®°å½•å¤´ä¿¡æ¯ï¼‰å ç”¨çš„å­—èŠ‚é•¿åº¦åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡ 65535 ä¸ªå­—èŠ‚</strong>ï¼Œè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œ65535 æ˜¯<font color="red">ä¸€è¡Œ</font>çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåˆ—çš„æœ€å¤§å­—èŠ‚æ•°ã€‚</p>
</blockquote>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œvarchar æœ€å¤§çš„é•¿åº¦å…¶å®æ˜¯è¾¾ä¸åˆ° <code>65535</code>çš„ï¼Œå› ä¸ºè¿™ä¸€è¡Œä¸­é™¤äº† <code>varchar</code>çš„çœŸå®æ•°æ®ï¼Œè¿˜åŒ…å«äº†<strong>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</strong>ã€<strong>NULL å€¼åˆ—è¡¨</strong>æ‰€å ç”¨çš„å­—èŠ‚æ•°</p>
<p>åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>varchar</code>ç±»å‹çš„æ—¶å€™,å®é™…ä¸Šåˆ›å»ºäº†ä¸‰ä¸ªéƒ¨åˆ†:</p>
<ol>
<li>çœŸå®æ•°æ®</li>
<li>çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°</li>
<li>NULL æ ‡è¯†(å¦‚æœä¸å…è®¸ä¸º NULLï¼Œåˆ™ä¸éœ€è¦)</li>
</ol>
<p>æ¯”å¦‚æˆ‘ä»¬åœ¨åˆ›å»ºä¸‹é¢çš„è¡¨çš„æ—¶å€™:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> test(</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">65532</span>) <span class="keyword">NULL</span></span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> <span class="keyword">CHARACTER SET</span> <span class="operator">=</span> ascii ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>
<p>å°±æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸Šé¢è¿™ä¸ªè¡¨çš„æ—¶å€™ï¼Œç”±äºå…è®¸ä¸º NULLï¼Œæ‰€ä»¥éœ€è¦ï¼ˆå› ä¸ºä¸æ»¡ 8 ä½ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå­—èŠ‚æ¥æ ‡è¯†ï¼‰ä¸€ä¸ªå­—èŠ‚æ¥æ ‡è¯†</p>
<p>ç´§æ¥ç€ï¼Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œéœ€è¦å ç”¨ 2 ä¸ªå­—èŠ‚æ¥æ ‡è¯†ï¼Œå› ä¸ºå®ƒçš„è§„åˆ™æ˜¯ï¼š</p>
<p>1.å¦‚æœå˜é•¿å­—æ®µå…è®¸å­˜å‚¨çš„æœ€å¤§å­—èŠ‚æ•°å°äºç­‰äº 255 å­—èŠ‚ï¼Œå°±ä¼šç”¨ 1 å­—èŠ‚è¡¨ç¤ºã€Œå˜é•¿å­—æ®µé•¿åº¦ã€ï¼› 2.å¦‚æœå˜é•¿å­—æ®µå…è®¸å­˜å‚¨çš„æœ€å¤§å­—èŠ‚æ•°å¤§äº 255 å­—èŠ‚ï¼Œå°±ä¼šç”¨ 2 å­—èŠ‚è¡¨ç¤ºã€Œå˜é•¿å­—æ®µé•¿åº¦ã€ï¼›</p>
<p>æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œé¢çš„ varchar(65532)ï¼Œæ‰€ä»¥éœ€è¦ç”¨ 2 ä¸ªå­—èŠ‚æ¥æ ‡è¯†ï¼Œæ‰€ä»¥è¿™ä¸€è¡Œæ€»å…±å ç”¨çš„å­—èŠ‚æ•°ä¸ºï¼š1+2+65532=65535ï¼Œæ­£å¥½è¾¾åˆ° 65535 çš„é™åˆ¶ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œvarchar åœ¨å¯ä»¥ä¸º NULL çš„æƒ…å†µä¸‹ï¼Œæœ€å¤§é•¿åº¦ä¸º 65532ã€‚</p>
<p>åœ¨ä¸å…è®¸ä¸º NULL çš„æƒ…å†µä¸‹ï¼Œç”±äºä¸éœ€è¦ NULL æ ‡è¯†å­—èŠ‚ï¼Œæ‰€ä»¥åªéœ€è¦ 2 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‚å› æ­¤å®é™…å¯å­˜å‚¨çš„æœ€å¤§æ•°æ®å­—èŠ‚æ•°ä¸º 65535 - 2 = 65533 å­—èŠ‚ï¼Œå³ <code>VARCHAR(65533)</code> è¾¾åˆ°ä¸Šé™ã€‚</p>
<hr>
<p>å¦‚æœæœ‰å¤šä¸ªå­—æ®µçš„è¯ï¼Œè¦ä¿è¯æ‰€æœ‰å­—æ®µçš„é•¿åº¦ + å˜é•¿å­—æ®µå­—èŠ‚æ•°åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° + NULL å€¼åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° &lt;= 65535ã€‚</p>
<p><img src="/2025/04/24/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Varchar%E6%9C%80%E5%A4%A7%E5%8F%96%E5%80%BC/1745466102232.png" alt="1745466102232"></p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>å­˜å‚¨åŸç†</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>è®°å½•å­˜å‚¨æ–¹å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 2 - ä¸¤æ•°ç›¸åŠ ï¼ˆAdd Two Numbersï¼‰</title>
    <url>/2025/04/23/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-2-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸¤ä¸ªéç©ºçš„é“¾è¡¨ï¼Œè¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å®ƒä»¬æ¯ä½æ•°å­—éƒ½æ˜¯æŒ‰ç…§é€†åºçš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ä¸€ä½æ•°å­—ã€‚</p>
<p>è¯·ä½ å°†ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œå¹¶ä»¥ç›¸åŒå½¢å¼è¿”å›ä¸€ä¸ªè¡¨ç¤ºå’Œçš„é“¾è¡¨ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼š">ç¤ºä¾‹ 1ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šl1 = [2,4,3], l2 = [5,6,4]</span><br><span class="line">è¾“å‡ºï¼š[7,0,8]</span><br><span class="line">è§£é‡Šï¼š342 + 465 = 807.</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2ï¼š">ç¤ºä¾‹ 2ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šl1 = [0], l2 = [0]</span><br><span class="line">è¾“å‡ºï¼š[0]</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-3ï¼š">ç¤ºä¾‹ 3ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šl1 = [9,9,9,9,9,9,9], l2 = [9,9,9,9]</span><br><span class="line">è¾“å‡ºï¼š[8,9,9,9,0,0,0,1]</span><br></pre></td></tr></table></figure>
<h3 id="æç¤ºï¼š">æç¤ºï¼š</h3>
<ul>
<li>æ¯ä¸ªé“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ [1, 100] å†…</li>
<li>0 &lt;= Node.val &lt;= 9</li>
<li>é¢˜ç›®æ•°æ®ä¿è¯åˆ—è¡¨è¡¨ç¤ºçš„æ•°å­—ä¸å«å‰å¯¼é›¶</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜è€ƒå¯Ÿçš„æ˜¯é“¾è¡¨æ“ä½œå’Œæ•°å­—åŠ æ³•ã€‚ç”±äºä¸¤ä¸ªé“¾è¡¨å·²ç»æ˜¯é€†åºå­˜å‚¨ï¼Œä¸æˆ‘ä»¬æ­£å¸¸ä»ä½ä½åˆ°é«˜ä½è¿›è¡ŒåŠ æ³•è®¡ç®—çš„é¡ºåºç›¸åŒï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¯¹ä¸¤ä¸ªé“¾è¡¨è¿›è¡Œéå†å¹¶ç›¸åŠ ã€‚ä¸»è¦éœ€è¦å¤„ç†çš„ç‚¹æ˜¯ï¼š</p>
<ol>
<li>ä¸¤ä¸ªæ•°å­—ç›¸åŠ å¯èƒ½äº§ç”Ÿè¿›ä½</li>
<li>ä¸¤ä¸ªé“¾è¡¨å¯èƒ½é•¿åº¦ä¸åŒ</li>
<li>æœ€é«˜ä½ç›¸åŠ åå¯èƒ½è¿˜æœ‰è¿›ä½ï¼Œéœ€è¦é¢å¤–å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹</li>
</ol>
<p>è§£é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>æ¨¡æ‹ŸåŠ æ³•è¿ç®—çš„è¿‡ç¨‹</strong>ï¼ŒæŒ‰ä½ç›¸åŠ å¹¶å¤„ç†è¿›ä½ã€‚</p>
<h2 id="åˆå§‹å®ç°åˆ†æï¼ˆæœ‰å¾…ä¼˜åŒ–çš„ä»£ç ï¼‰">åˆå§‹å®ç°åˆ†æï¼ˆæœ‰å¾…ä¼˜åŒ–çš„ä»£ç ï¼‰</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡ä½†æœ‰å¾…ä¼˜åŒ–çš„å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addTwoNumbers</span><span class="params">(l1 *ListNode, l2 *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">	oneFlag := <span class="literal">false</span></span><br><span class="line">	res := &amp;ListNode&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> prev *ListNode</span><br><span class="line">	cur := res</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> l1 != <span class="literal">nil</span> &amp;&amp; l2 != <span class="literal">nil</span> &#123;</span><br><span class="line">		tmp := l1.Val + l2.Val</span><br><span class="line">		<span class="keyword">if</span> oneFlag &#123;</span><br><span class="line">			tmp += <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">		cur.Val = tmp % <span class="number">10</span></span><br><span class="line">		<span class="keyword">if</span> tmp &gt;= <span class="number">10</span> &#123;</span><br><span class="line">			oneFlag = <span class="literal">true</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			oneFlag = <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">		cur.Next = &amp;ListNode&#123;&#125;</span><br><span class="line">		prev = cur</span><br><span class="line">		cur = cur.Next</span><br><span class="line">		l1 = l1.Next</span><br><span class="line">		l2 = l2.Next</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> l1 != <span class="literal">nil</span> &#123;</span><br><span class="line">		tmp := l1.Val</span><br><span class="line">		<span class="keyword">if</span> oneFlag &#123;</span><br><span class="line">			tmp += <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">		cur.Val = tmp % <span class="number">10</span></span><br><span class="line">		<span class="keyword">if</span> tmp &gt;= <span class="number">10</span> &#123;</span><br><span class="line">			oneFlag = <span class="literal">true</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			oneFlag = <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">		cur.Next = &amp;ListNode&#123;&#125;</span><br><span class="line">		prev = cur</span><br><span class="line">		cur = cur.Next</span><br><span class="line">		l1 = l1.Next</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> l2 != <span class="literal">nil</span> &#123;</span><br><span class="line">		tmp := l2.Val</span><br><span class="line">		<span class="keyword">if</span> oneFlag &#123;</span><br><span class="line">			tmp += <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">		cur.Val = tmp % <span class="number">10</span></span><br><span class="line">		<span class="keyword">if</span> tmp &gt;= <span class="number">10</span> &#123;</span><br><span class="line">			oneFlag = <span class="literal">true</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			oneFlag = <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">		cur.Next = &amp;ListNode&#123;&#125;</span><br><span class="line">		prev = cur</span><br><span class="line">		cur = cur.Next</span><br><span class="line">		l2 = l2.Next</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> oneFlag &#123;</span><br><span class="line">		cur.Val = <span class="number">1</span></span><br><span class="line">		prev = cur</span><br><span class="line">	&#125;</span><br><span class="line">	prev.Next = <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å­˜åœ¨çš„é—®é¢˜">å­˜åœ¨çš„é—®é¢˜</h3>
<p>è¿™æ®µä»£ç è™½ç„¶å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><strong>ä»£ç å†—ä½™</strong>ï¼šæœ‰ä¸‰ä¸ªå‡ ä¹ç›¸åŒçš„å¾ªç¯ï¼Œå¤„ç†é€»è¾‘é‡å¤</li>
<li><strong>æ•ˆç‡ä¸é«˜</strong>ï¼šæ¯æ¬¡å¾ªç¯éƒ½åˆ›å»ºäº†æ–°èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å¯èƒ½æ— ç”¨çš„èŠ‚ç‚¹</li>
<li><strong>å¯è¯»æ€§å·®</strong>ï¼šå˜é‡åä¸å¤Ÿç›´è§‚ï¼ˆå¦‚ <code>oneFlag</code> è¡¨ç¤ºè¿›ä½ï¼‰</li>
<li><strong>ä»£ç ç»“æ„</strong>ï¼šå¾ªç¯åçš„æ”¶å°¾å¤„ç†é€»è¾‘ä¸å¤Ÿæ¸…æ™°</li>
</ol>
<h2 id="ä¼˜åŒ–å®ç°">ä¼˜åŒ–å®ç°</h2>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç‚¹ä¼˜åŒ–ä»£ç ï¼š</p>
<ol>
<li>åˆå¹¶é‡å¤çš„ä¸‰ä¸ªå¾ªç¯ï¼Œä½¿ç”¨ä¸€ä¸ªå¾ªç¯å¤„ç†æ‰€æœ‰æƒ…å†µ</li>
<li>ä½¿ç”¨æ›´æ¸…æ™°çš„å˜é‡åï¼ˆå¦‚ <code>carry</code> ä»£æ›¿ <code>oneFlag</code>ï¼‰</li>
<li>åªåœ¨ç¡®å®éœ€è¦æ–°èŠ‚ç‚¹æ—¶æ‰åˆ›å»º</li>
<li>ç®€åŒ–è¿›ä½çš„å¤„ç†é€»è¾‘</li>
</ol>
<h3 id="ä¼˜åŒ–åçš„ä»£ç ">ä¼˜åŒ–åçš„ä»£ç </h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addTwoNumbers</span><span class="params">(l1 *ListNode, l2 *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">	<span class="comment">// åˆ›å»ºè™šæ‹Ÿå¤´èŠ‚ç‚¹ï¼Œç®€åŒ–æ“ä½œ</span></span><br><span class="line">	dummy := &amp;ListNode&#123;&#125;</span><br><span class="line">	current := dummy</span><br><span class="line">	carry := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// åªè¦æœ‰ä¸€ä¸ªé“¾è¡¨è¿˜æœ‰èŠ‚ç‚¹æˆ–è€…æœ‰è¿›ä½ï¼Œå°±ç»§ç»­å¾ªç¯</span></span><br><span class="line">	<span class="keyword">for</span> l1 != <span class="literal">nil</span> || l2 != <span class="literal">nil</span> || carry &gt; <span class="number">0</span> &#123;</span><br><span class="line">		sum := carry</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ·»åŠ å½“å‰èŠ‚ç‚¹çš„å€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</span></span><br><span class="line">		<span class="keyword">if</span> l1 != <span class="literal">nil</span> &#123;</span><br><span class="line">			sum += l1.Val</span><br><span class="line">			l1 = l1.Next</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> l2 != <span class="literal">nil</span> &#123;</span><br><span class="line">			sum += l2.Val</span><br><span class="line">			l2 = l2.Next</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// è®¡ç®—è¿›ä½å’Œå½“å‰ä½çš„å€¼</span></span><br><span class="line">		carry = sum / <span class="number">10</span></span><br><span class="line">		current.Next = &amp;ListNode&#123;Val: sum % <span class="number">10</span>&#125;</span><br><span class="line">		current = current.Next</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dummy.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¼˜åŒ–è¯´æ˜">ä¼˜åŒ–è¯´æ˜</h3>
<ol>
<li><strong>ä½¿ç”¨è™šæ‹Ÿå¤´èŠ‚ç‚¹ï¼ˆdummy headï¼‰</strong>ï¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿå¤´èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–é“¾è¡¨æ“ä½œï¼Œé¿å…å¤„ç†å¤´èŠ‚ç‚¹ä¸ºç©ºçš„ç‰¹æ®Šæƒ…å†µã€‚</li>
<li><strong>åˆå¹¶å¾ªç¯</strong>ï¼šå°†ä¸‰ä¸ªå¾ªç¯åˆå¹¶ä¸ºä¸€ä¸ªå¾ªç¯ï¼Œåªè¦æœ‰ä¸€ä¸ªé“¾è¡¨è¿˜æœ‰èŠ‚ç‚¹æˆ–è€…æœ‰è¿›ä½ï¼Œå°±ç»§ç»­å¾ªç¯ã€‚</li>
<li><strong>æ”¹è¿›å˜é‡å‘½å</strong>ï¼šä½¿ç”¨ <code>carry</code> ä»£æ›¿ <code>oneFlag</code>ï¼Œä½¿ä»£ç æ›´æ˜“ç†è§£ã€‚</li>
<li><strong>æŒ‰éœ€åˆ›å»ºèŠ‚ç‚¹</strong>ï¼šåªåœ¨ç¡®å®éœ€è¦æ·»åŠ æ–°èŠ‚ç‚¹æ—¶æ‰åˆ›å»ºï¼Œè€Œä¸æ˜¯æå‰åˆ›å»ºå¯èƒ½æ— ç”¨çš„èŠ‚ç‚¹ã€‚</li>
<li><strong>ç®€åŒ–è¿›ä½è®¡ç®—</strong>ï¼šä½¿ç”¨ <code>sum / 10</code> è®¡ç®—è¿›ä½ï¼Œ<code>sum % 10</code> è®¡ç®—å½“å‰ä½çš„å€¼ï¼Œä»£ç æ›´ç®€æ´æ¸…æ™°ã€‚</li>
</ol>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(max(n, m))ï¼Œå…¶ä¸­ n å’Œ m åˆ†åˆ«æ˜¯ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ã€‚æˆ‘ä»¬éœ€è¦éå†ä¸¤ä¸ªé“¾è¡¨çš„å…¨éƒ¨ä½ç½®ï¼Œè€Œå¤„ç†æ¯ä¸ªä½ç½®åªéœ€è¦ O(1) çš„æ—¶é—´ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(max(n, m))ï¼Œæ–°é“¾è¡¨çš„é•¿åº¦æœ€å¤šä¸º max(n, m) + 1ï¼ˆå½“æœ‰è¿›ä½æ—¶ï¼‰ã€‚ä¸è€ƒè™‘è¿”å›å€¼æ‰€å ç”¨çš„ç©ºé—´ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚</li>
</ul>
<h2 id="ä¼˜åŒ–å‰åå¯¹æ¯”">ä¼˜åŒ–å‰åå¯¹æ¯”</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>ä¼˜åŒ–å‰</th>
<th>ä¼˜åŒ–å</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä»£ç è¡Œæ•°</td>
<td>~50 è¡Œ</td>
<td>~20 è¡Œ</td>
</tr>
<tr>
<td>å¾ªç¯æ¬¡æ•°</td>
<td>3ä¸ªå¾ªç¯</td>
<td>1ä¸ªå¾ªç¯</td>
</tr>
<tr>
<td>å¯è¯»æ€§</td>
<td>è¾ƒå·®</td>
<td>è‰¯å¥½</td>
</tr>
<tr>
<td>å˜é‡å‘½å</td>
<td>ä¸ç›´è§‚</td>
<td>æ¸…æ™°æ˜äº†</td>
</tr>
<tr>
<td>èŠ‚ç‚¹åˆ›å»º</td>
<td>å¯èƒ½åˆ›å»ºæ— ç”¨èŠ‚ç‚¹</td>
<td>æŒ‰éœ€åˆ›å»º</td>
</tr>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(max(n, m))</td>
<td>O(max(n, m))</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(max(n, m))</td>
<td>O(max(n, m))</td>
</tr>
</tbody>
</table>
<h2 id="å­¦ä¹ è¦ç‚¹">å­¦ä¹ è¦ç‚¹</h2>
<ol>
<li><strong>ä»£ç ç®€åŒ–</strong>ï¼šé€šè¿‡åˆå¹¶ç›¸ä¼¼çš„é€»è¾‘ï¼Œå¯ä»¥å¤§å¹…å‡å°‘ä»£ç é‡ï¼Œæé«˜å¯è¯»æ€§ã€‚</li>
<li><strong>è™šæ‹Ÿå¤´èŠ‚ç‚¹æŠ€å·§</strong>ï¼šåœ¨å¤„ç†é“¾è¡¨é—®é¢˜æ—¶ï¼Œä½¿ç”¨è™šæ‹Ÿå¤´èŠ‚ç‚¹å¯ä»¥ç®€åŒ–è¾¹ç•Œæƒ…å†µçš„å¤„ç†ã€‚</li>
<li><strong>æ¡ä»¶åˆå¹¶</strong>ï¼šå°†å¤šä¸ªæ¡ä»¶åˆå¹¶åˆ°ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ã€‚</li>
<li><strong>å˜é‡å‘½å</strong>ï¼šä½¿ç”¨æ¸…æ™°çš„å˜é‡åå¯ä»¥æé«˜ä»£ç å¯è¯»æ€§ï¼Œå¦‚ä½¿ç”¨ <code>carry</code> è¡¨ç¤ºè¿›ä½ã€‚</li>
<li><strong>æŒ‰éœ€åˆ†é…å†…å­˜</strong>ï¼šåªåœ¨å¿…è¦æ—¶åˆ›å»ºæ–°çš„èŠ‚ç‚¹ï¼Œé¿å…æ— ç”¨çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ã€‚</li>
</ol>
<p>è¿™ç§é“¾è¡¨åŠ æ³•çš„æ¨¡å¼åœ¨å¤„ç†å¤§æ•°åŠ æ³•ç­‰é—®é¢˜æ—¶ä¹Ÿå¾ˆå¸¸è§ï¼ŒæŒæ¡è¿™ç§æ¨¡å¼å¯¹è§£å†³ç±»ä¼¼é—®é¢˜å¾ˆæœ‰å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Model Context Protocol (MCP) ä»‹ç»</title>
    <url>/2025/04/23/%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/AI%E5%B7%A5%E7%A8%8B/2025-04-23-Introduction-to-MCP/</url>
    <content><![CDATA[<h1>Model Context Protocol (MCP) ä»‹ç»</h1>
<h2 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦MCP">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦MCP</h2>
<p>å½“ä»Šçš„å¤§å‹è¯­è¨€æ¨¡å‹(LLM)è™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†åœ¨ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’æ—¶ä»é¢ä¸´è¯¸å¤šæŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>ä¸Šä¸‹æ–‡çª—å£é™åˆ¶</strong>ï¼šæ¨¡å‹èƒ½æ¥æ”¶çš„ä¿¡æ¯é‡æœ‰é™ï¼Œå¯¼è‡´å¤„ç†å¤§å‹ä»£ç åº“æˆ–æ•°æ®é›†å›°éš¾</li>
<li><strong>æ•°æ®éšç§é—®é¢˜</strong>ï¼šæ•æ„Ÿæ•°æ®éœ€è¦å‘é€åˆ°äº‘ç«¯å¤„ç†ï¼Œå¢åŠ äº†éšç§å’Œå®‰å…¨é£é™©</li>
<li><strong>å·¥å…·é›†æˆç¢ç‰‡åŒ–</strong>ï¼šæ¯ä¸ªLLMæä¾›å•†æœ‰ä¸åŒçš„å·¥å…·é›†æˆæ–¹å¼ï¼Œå¯¼è‡´å¼€å‘è€…éœ€ç»´æŠ¤å¤šå¥—ä»£ç </li>
<li><strong>æœ¬åœ°èµ„æºè®¿é—®å—é™</strong>ï¼šå¾ˆéš¾è®©LLMå®‰å…¨åœ°è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åº</li>
<li><strong>å¤šç³»ç»Ÿåä½œå›°éš¾</strong>ï¼šè®©LLMä¸å¤šä¸ªä¸åŒæœåŠ¡ååŒå·¥ä½œç¼ºä¹ç»Ÿä¸€æ ‡å‡†</li>
</ul>
<p>Model Context Protocol (MCP)æ­£æ˜¯ä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œè¯ç”Ÿçš„æŠ€æœ¯æ ‡å‡†ï¼Œå®ƒæä¾›äº†ä¸€ç§ç»Ÿä¸€ã€å®‰å…¨ã€çµæ´»çš„æ–¹å¼ï¼Œè®©è¯­è¨€æ¨¡å‹èƒ½å¤Ÿä¸å„ç§å¤–éƒ¨ç³»ç»Ÿå’Œèµ„æºè¿›è¡Œäº¤äº’ã€‚</p>
<h2 id="MCPæ˜¯ä»€ä¹ˆ">MCPæ˜¯ä»€ä¹ˆ</h2>
<p>Model Context Protocol (MCP) æ˜¯ä¸€ç§ç”¨äºæ„å»ºLLMï¼ˆå¤§å‹è¯­è¨€æ¨¡å‹ï¼‰åº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„åè®®ï¼Œå®ƒå…è®¸AIæ¨¡å‹ä¸å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·è¿›è¡Œäº¤äº’ã€‚</p>
<blockquote>
<p><strong>åè¯è§£é‡Š</strong>ï¼š</p>
<ul>
<li><strong>å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„</strong>ï¼šä¸€ç§è®¡ç®—æ¨¡å‹ï¼Œå…¶ä¸­ä¸€ä¸ªç¨‹åº(å®¢æˆ·ç«¯)è¯·æ±‚æœåŠ¡ï¼Œå¦ä¸€ä¸ªç¨‹åº(æœåŠ¡å™¨)æä¾›æœåŠ¡ã€‚å°±åƒé¤å…ä¸­é¡¾å®¢(å®¢æˆ·ç«¯)ç‚¹é¤ï¼Œå¨æˆ¿(æœåŠ¡å™¨)å‡†å¤‡é£Ÿç‰©ã€‚</li>
<li><strong>åè®®</strong>ï¼šä¸€å¥—è§„åˆ™ï¼Œå®šä¹‰äº†ç³»ç»Ÿé—´å¦‚ä½•äº¤æ¢ä¿¡æ¯ã€‚ç±»ä¼¼äºäººä»¬äº¤æµçš„è¯­è¨€å’Œç¤¼ä»ªè§„èŒƒã€‚</li>
<li><strong>API(åº”ç”¨ç¨‹åºæ¥å£)</strong>ï¼šè½¯ä»¶ç»„ä»¶ä¹‹é—´çš„è¿æ¥ç‚¹ï¼Œå…è®¸ä¸åŒç¨‹åºç›¸äº’é€šä¿¡ã€‚å°±åƒç”µæºæ’åº§æ˜¯ç”µå™¨ä¸ç”µç½‘çš„æ¥å£ã€‚</li>
</ul>
</blockquote>
<p>MCPçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ ‡å‡†åŒ–çš„åè®®ï¼Œè®©è¯­è¨€æ¨¡å‹èƒ½å¤Ÿå®‰å…¨ã€çµæ´»åœ°è®¿é—®å„ç§æœ¬åœ°å’Œè¿œç¨‹èµ„æºã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„APIæˆ–å‡½æ•°è°ƒç”¨ç³»ç»Ÿï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¶æ„æ¨¡å¼ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹å¾ï¼š</p>
<ol>
<li><strong>åè®®é©±åŠ¨</strong>: MCP å®šä¹‰äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„æ ‡å‡†åè®®ï¼Œä½¿ä¸åŒç»„ä»¶èƒ½å¤Ÿæ— ç¼åä½œ</li>
<li><strong>èµ„æºæŠ½è±¡</strong>: å°†å„ç§æ•°æ®æºã€å·¥å…·å’ŒæœåŠ¡æŠ½è±¡ä¸ºç»Ÿä¸€çš„èµ„æºæ¥å£</li>
<li><strong>åˆ†å¸ƒå¼è®¾è®¡</strong>: æ”¯æŒå¤šä¸ªæœåŠ¡å™¨å¹¶è¡Œæä¾›ä¸åŒåŠŸèƒ½ï¼Œå®ç°åŠŸèƒ½è§£è€¦</li>
<li><strong>å®‰å…¨éš”ç¦»</strong>: æ˜ç¡®çš„å®‰å…¨è¾¹ç•Œï¼Œæ•°æ®ä¿æŒåœ¨æœåŠ¡å™¨ç«¯ï¼Œåªæœ‰ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</li>
<li><strong>å¯ç»„åˆæ€§</strong>: ä¸åŒMCPæœåŠ¡å™¨å¯ä»¥ç»„åˆä½¿ç”¨ï¼Œå½¢æˆå¤æ‚çš„å·¥ä½œæµ</li>
</ol>
<h2 id="æ—¥å¸¸ä½¿ç”¨åœºæ™¯ï¼šMCPå¦‚ä½•æ”¹å˜æˆ‘ä»¬ä½¿ç”¨AIçš„æ–¹å¼">æ—¥å¸¸ä½¿ç”¨åœºæ™¯ï¼šMCPå¦‚ä½•æ”¹å˜æˆ‘ä»¬ä½¿ç”¨AIçš„æ–¹å¼</h2>
<h3 id="åœºæ™¯ä¸€ï¼šæœ¬åœ°æ–‡æ¡£åŠ©æ‰‹">åœºæ™¯ä¸€ï¼šæœ¬åœ°æ–‡æ¡£åŠ©æ‰‹</h3>
<p><strong>é—®é¢˜</strong>ï¼šç‹å…ˆç”Ÿæœ‰å¤§é‡å­˜å‚¨åœ¨æœ¬åœ°ç”µè„‘ä¸Šçš„å·¥ä½œæ–‡æ¡£ï¼Œä»–æƒ³è®©AIåŠ©æ‰‹å¸®å¿™æ•´ç†å’Œæ€»ç»“ï¼Œä½†åˆæ‹…å¿ƒæ–‡æ¡£å†…å®¹ä¸Šä¼ åˆ°äº‘ç«¯ä¼šæœ‰å®‰å…¨é£é™©ã€‚</p>
<p><strong>MCPè§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>ç‹å…ˆç”Ÿåœ¨ç”µè„‘ä¸Šå®‰è£…äº†æ”¯æŒMCPçš„Claude Desktopåº”ç”¨å’Œæ–‡ä»¶ç³»ç»ŸMCPæœåŠ¡å™¨</li>
<li>å½“ä»–è¯¢é—®&quot;å¸®æˆ‘æ€»ç»“æ‰€æœ‰2025å¹´ç¬¬ä¸€å­£åº¦çš„ä¼šè®®è®°å½•&quot;æ—¶</li>
<li>Claudeä¼šé€šè¿‡MCPæœåŠ¡å™¨å®‰å…¨åœ°æœç´¢æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</li>
<li>æ–‡æ¡£å†…å®¹ä¸ä¼šç¦»å¼€ç‹å…ˆç”Ÿçš„ç”µè„‘ï¼Œåªæœ‰æœç´¢ç»“æœè¿”å›ç»™Claude</li>
<li>Claudeæ ¹æ®è·å–çš„ä¼šè®®å†…å®¹ç”Ÿæˆæ€»ç»“æŠ¥å‘Š</li>
</ol>
<p>è¿™ä¸€è¿‡ç¨‹å¯¹ç‹å…ˆç”Ÿæ¥è¯´å®Œå…¨é€æ˜ï¼Œä»–åªéœ€æ­£å¸¸ä¸AIäº¤è°ˆï¼Œä½†æ‰€æœ‰æ•°æ®å¤„ç†éƒ½åœ¨æœ¬åœ°å®Œæˆï¼Œä¿è¯äº†ä¿¡æ¯å®‰å…¨ã€‚</p>
<h3 id="åœºæ™¯äºŒï¼šä»£ç å¼€å‘åŠ©æ‰‹">åœºæ™¯äºŒï¼šä»£ç å¼€å‘åŠ©æ‰‹</h3>
<p><strong>é—®é¢˜</strong>ï¼šå¼ å¥³å£«æ˜¯ä¸€åè½¯ä»¶å¼€å‘äººå‘˜ï¼Œä½¿ç”¨AIåŠ©æ‰‹ç¼–å†™ä»£ç ï¼Œä½†å‘ç°AIæ— æ³•è®¿é—®å¥¹çš„æœ¬åœ°ä»£ç åº“ã€è¿è¡Œæµ‹è¯•æˆ–æ‰§è¡ŒGitæ“ä½œã€‚</p>
<p><strong>MCPè§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>å¼ å¥³å£«åœ¨IDEä¸­ä½¿ç”¨æ”¯æŒMCPçš„AIç¼–ç åŠ©æ‰‹</li>
<li>IDEè¿è¡Œå¤šä¸ªMCPæœåŠ¡å™¨ï¼Œåˆ†åˆ«å¤„ç†ä»£ç è®¿é—®ã€æµ‹è¯•è¿è¡Œå’Œç‰ˆæœ¬æ§åˆ¶</li>
<li>å½“å¼ å¥³å£«è¦æ±‚&quot;æ ¹æ®å•å…ƒæµ‹è¯•ç»“æœä¿®å¤è¿™ä¸ªbug&quot;æ—¶</li>
<li>AIé€šè¿‡ä»£ç è®¿é—®MCPæœåŠ¡å™¨è¯»å–ç›¸å…³æ–‡ä»¶</li>
<li>é€šè¿‡æµ‹è¯•MCPæœåŠ¡å™¨è¿è¡Œæµ‹è¯•å¹¶è·å–ç»“æœ</li>
<li>åˆ†æé—®é¢˜å¹¶ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ</li>
<li>é€šè¿‡Git MCPæœåŠ¡å™¨åˆ›å»ºä¿®å¤åˆ†æ”¯å’Œæäº¤æ›´æ”¹</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹åœ¨å¼ å¥³å£«çš„æœ¬åœ°ç¯å¢ƒå®Œæˆï¼Œæ— éœ€å°†å®Œæ•´ä»£ç åº“ä¸Šä¼ åˆ°äº‘ç«¯ï¼ŒåŒæ—¶AIåŠ©æ‰‹èƒ½å¤Ÿä¸å¥¹çš„å¼€å‘å·¥å…·æµå®Œç¾é›†æˆã€‚</p>
<h2 id="è¯¦ç»†åè®®ç»“æ„">è¯¦ç»†åè®®ç»“æ„</h2>
<p>MCPåè®®ä¸»è¦åŒ…å«ä»¥ä¸‹å…³é”®ç»„ä»¶ï¼š</p>
<ul>
<li><strong>è¿æ¥ç®¡ç†</strong>: å»ºç«‹å’Œç»´æŠ¤å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥</li>
<li><strong>èµ„æºå‘ç°</strong>: å…è®¸å®¢æˆ·ç«¯å‘ç°æœåŠ¡å™¨æä¾›çš„èµ„æºå’ŒåŠŸèƒ½</li>
<li><strong>èµ„æºè¯·æ±‚</strong>: å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚ç‰¹å®šèµ„æº</li>
<li><strong>èµ„æºå“åº”</strong>: æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›ç»“æœ</li>
<li><strong>å…ƒæ•°æ®äº¤æ¢</strong>: äº¤æ¢æœ‰å…³èµ„æºå’ŒåŠŸèƒ½çš„å…ƒæ•°æ®</li>
<li><strong>å®‰å…¨æœºåˆ¶</strong>: ä¿æŠ¤ä¼ è¾“ä¸­çš„æ•°æ®å¹¶éªŒè¯è¯·æ±‚çš„åˆæ³•æ€§</li>
</ul>
<h2 id="åŸºæœ¬åŸç†ä¸æ¶æ„">åŸºæœ¬åŸç†ä¸æ¶æ„</h2>
<p>MCPé‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li><strong>MCPä¸»æœºï¼ˆHostsï¼‰</strong>ï¼šå¦‚Claude Desktopã€IDEæˆ–AIå·¥å…·ï¼Œå¸Œæœ›é€šè¿‡MCPè®¿é—®æ•°æ®çš„ç¨‹åº</li>
<li><strong>MCPå®¢æˆ·ç«¯ï¼ˆClientsï¼‰</strong>ï¼šç»´æŠ¤ä¸æœåŠ¡å™¨1:1è¿æ¥çš„åè®®å®¢æˆ·ç«¯ï¼Œè´Ÿè´£å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”</li>
<li><strong>MCPæœåŠ¡å™¨ï¼ˆServersï¼‰</strong>ï¼šé€šè¿‡æ ‡å‡†åŒ–çš„Model Context Protocolå…¬å¼€ç‰¹å®šåŠŸèƒ½çš„è½»é‡çº§ç¨‹åºï¼Œè´Ÿè´£å¤„ç†è¯·æ±‚å¹¶è¿”å›ç»“æœ</li>
<li><strong>æœ¬åœ°æ•°æ®æº</strong>ï¼šMCPæœåŠ¡å™¨å¯ä»¥å®‰å…¨è®¿é—®çš„è®¡ç®—æœºæ–‡ä»¶ã€æ•°æ®åº“å’ŒæœåŠ¡</li>
<li><strong>è¿œç¨‹æœåŠ¡</strong>ï¼šMCPæœåŠ¡å™¨å¯ä»¥è¿æ¥çš„å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚é€šè¿‡APIï¼‰</li>
</ul>
<p>è¿™ç§æ¶æ„å¯ä»¥é€šè¿‡ä»¥ä¸‹Mermaidå›¾è¡¨è¡¨ç¤ºï¼š</p>
<h2 id="MCPé€šä¿¡æµç¨‹">MCPé€šä¿¡æµç¨‹</h2>
<p>MCPé€šä¿¡è¿‡ç¨‹æ˜¯å¦‚ä½•å®ç°LLMä¸å„ç§èµ„æºäº¤äº’çš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„MCPé€šä¿¡æµç¨‹ï¼š</p>
<pre class="mermaid">sequenceDiagram
    participant User as ç”¨æˆ·
    participant LLM as è¯­è¨€æ¨¡å‹
    participant Host as ä¸»æœºåº”ç”¨
    participant Client as MCPå®¢æˆ·ç«¯
    participant Server as MCPæœåŠ¡å™¨
    participant DataSource as æ•°æ®æº
  
    User-&gt;&gt;Host: æå‡ºè¯·æ±‚
    Host-&gt;&gt;LLM: è½¬å‘ç”¨æˆ·è¯·æ±‚
    LLM--&gt;&gt;Host: éœ€è¦è®¿é—®å¤–éƒ¨èµ„æº
  
    Host-&gt;&gt;Client: èµ„æºè¯·æ±‚
    Client-&gt;&gt;Server: å‘é€MCPè¯·æ±‚
    Server-&gt;&gt;DataSource: æ•°æ®è®¿é—®
    DataSource--&gt;&gt;Server: è¿”å›æ•°æ®
    Server--&gt;&gt;Client: MCPå“åº”
    Client--&gt;&gt;Host: è¿”å›èµ„æº
  
    Host-&gt;&gt;LLM: æä¾›èµ„æº
    LLM--&gt;&gt;Host: åŸºäºèµ„æºçš„å“åº”
    Host-&gt;&gt;User: æ˜¾ç¤ºç»“æœ</pre>
<h2 id="èµ„æºæ¥å£è®¾è®¡">èµ„æºæ¥å£è®¾è®¡</h2>
<p>MCPå®šä¹‰äº†ä¸€å¥—èµ„æºæ¥å£ï¼Œä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿç»Ÿä¸€è®¿é—®å„ç§ä¸åŒç±»å‹çš„èµ„æºï¼š</p>
<pre class="mermaid">classDiagram
    class Resource {
        +String resourceId
        +String resourceType
        +Metadata metadata
        +request(parameters)
    }
  
    class FileResource {
        +String path
        +readContent()
        +writeContent(data)
    }
  
    class DatabaseResource {
        +String connectionString
        +query(sql)
        +update(sql)
    }
  
    class APIResource {
        +String endpoint
        +call(parameters)
    }
  
    Resource &lt;|-- FileResource
    Resource &lt;|-- DatabaseResource
    Resource &lt;|-- APIResource</pre>
<h2 id="MCPä¸Function-Callçš„åŒºåˆ«">MCPä¸Function Callçš„åŒºåˆ«</h2>
<p>MCPå’ŒFunction Calléƒ½æ˜¯æ‰©å±•LLMèƒ½åŠ›çš„æŠ€æœ¯ï¼Œä½†å®ƒä»¬åœ¨è®¾è®¡å’Œå®ç°ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼š</p>
<h3 id="Function-Call">Function Call</h3>
<p>Function Callï¼ˆå‡½æ•°è°ƒç”¨ï¼‰æ˜¯ä¸€ç§è®©LLMèƒ½å¤Ÿè°ƒç”¨é¢„å®šä¹‰å‡½æ•°çš„èƒ½åŠ›ï¼Œä¸»è¦ç‰¹ç‚¹ï¼š</p>
<ul>
<li>é€šå¸¸åœ¨å•ä¸€ç¯å¢ƒä¸­è¿è¡Œ</li>
<li>å‡½æ•°å®šä¹‰å¿…é¡»åµŒå…¥åˆ°æ¨¡å‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå ç”¨tokenç©ºé—´</li>
<li>å…¸å‹çš„å®ç°æ˜¯åœ¨LLMç”Ÿæˆå‡½æ•°è°ƒç”¨JSONåï¼Œç”±åº”ç”¨ç¨‹åºæ‰§è¡Œç›¸åº”å‡½æ•°</li>
<li>å®‰å…¨è¾¹ç•Œé€šå¸¸ç”±åº”ç”¨ç¨‹åºè‡ªèº«å®šä¹‰</li>
<li>é€šå¸¸éœ€è¦ä¸ºæ¯ä¸ªLLMæä¾›å•†å®ç°ä¸åŒçš„é›†æˆæ–¹å¼</li>
</ul>
<pre class="mermaid">sequenceDiagram
    participant User as ç”¨æˆ·
    participant App as åº”ç”¨ç¨‹åº
    participant LLM as è¯­è¨€æ¨¡å‹
    participant Functions as å‡½æ•°åº“
  
    User-&gt;&gt;App: æå‡ºè¯·æ±‚
    App-&gt;&gt;LLM: è¯·æ±‚(åŒ…å«å‡½æ•°å®šä¹‰)
    Note over App,LLM: å‡½æ•°å®šä¹‰å ç”¨ä¸Šä¸‹æ–‡ç©ºé—´
  
    LLM-&gt;&gt;App: å‡½æ•°è°ƒç”¨JSON
    App-&gt;&gt;Functions: æ‰§è¡Œå‡½æ•°
    Functions-&gt;&gt;App: è¿”å›ç»“æœ
    App-&gt;&gt;LLM: ç»“æœä½œä¸ºæ–°ä¸Šä¸‹æ–‡
    LLM-&gt;&gt;App: ç”Ÿæˆæœ€ç»ˆå“åº”
    App-&gt;&gt;User: æ˜¾ç¤ºç»“æœ</pre>
<h3 id="MCP">MCP</h3>
<p>MCPåˆ™æä¾›äº†ä¸€ä¸ªæ›´åŠ åˆ†å¸ƒå¼ã€æ ‡å‡†åŒ–çš„æ¶æ„ï¼š</p>
<ul>
<li>é‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œæ˜ç¡®åˆ†ç¦»è´£ä»»</li>
<li>å¤šä¸ªä¸“ç”¨æœåŠ¡å™¨å¯ä»¥å¹¶è¡Œæä¾›ä¸åŒåŠŸèƒ½ï¼Œæ”¯æŒæ¨ªå‘æ‰©å±•</li>
<li>é€šè¿‡æ ‡å‡†åè®®å®ç°äº’æ“ä½œæ€§ï¼Œä¸LLMæä¾›å•†æ— å…³</li>
<li>æ˜ç¡®çš„å®‰å…¨è¾¹ç•Œï¼Œæ•°æ®ä¿æŒåœ¨æœåŠ¡å™¨ç«¯</li>
<li>å¯ä»¥è·¨åº”ç”¨ç¨‹åºå’Œç¯å¢ƒé‡ç”¨ï¼Œæé«˜ä»£ç å¤ç”¨æ€§</li>
<li>èµ„æºåŠ¨æ€å‘ç°ï¼Œæ— éœ€é¢„å…ˆå®šä¹‰æ‰€æœ‰åŠŸèƒ½</li>
</ul>
<pre class="mermaid">sequenceDiagram
    participant User as ç”¨æˆ·
    participant Host as ä¸»æœºåº”ç”¨
    participant LLM as è¯­è¨€æ¨¡å‹
    participant Client as MCPå®¢æˆ·ç«¯
    participant ServerA as MCPæœåŠ¡å™¨A
    participant ServerB as MCPæœåŠ¡å™¨B
    participant DataA as æ•°æ®æºA
    participant DataB as æ•°æ®æºB
  
    User-&gt;&gt;Host: æå‡ºè¯·æ±‚
    Host-&gt;&gt;LLM: è½¬å‘è¯·æ±‚
  
    LLM-&gt;&gt;Host: éœ€è¦èµ„æºA
    Host-&gt;&gt;Client: è¯·æ±‚èµ„æºA
    Client-&gt;&gt;ServerA: MCPè¯·æ±‚
    ServerA-&gt;&gt;DataA: è®¿é—®æ•°æ®
    DataA--&gt;&gt;ServerA: è¿”å›æ•°æ®
    ServerA--&gt;&gt;Client: MCPå“åº”
    Client--&gt;&gt;Host: è¿”å›èµ„æºA
    Host-&gt;&gt;LLM: æä¾›èµ„æºA
  
    LLM-&gt;&gt;Host: éœ€è¦èµ„æºB
    Host-&gt;&gt;Client: è¯·æ±‚èµ„æºB
    Client-&gt;&gt;ServerB: MCPè¯·æ±‚
    ServerB-&gt;&gt;DataB: è®¿é—®æ•°æ®
    DataB--&gt;&gt;ServerB: è¿”å›æ•°æ®
    ServerB--&gt;&gt;Client: MCPå“åº”
    Client--&gt;&gt;Host: è¿”å›èµ„æºB
    Host-&gt;&gt;LLM: æä¾›èµ„æºB
  
    LLM-&gt;&gt;Host: ç”Ÿæˆæœ€ç»ˆå“åº”
    Host-&gt;&gt;User: æ˜¾ç¤ºç»“æœ</pre>
<h2 id="MCPçš„ä¼˜åŠ¿">MCPçš„ä¼˜åŠ¿</h2>
<p>MCPç›¸æ¯”ä¼ ç»ŸFunction Callå’Œå…¶ä»–å·¥å…·é›†æˆæ–¹æ³•æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>çµæ´»æ€§</strong>ï¼šå¯ä»¥è½»æ¾åˆ‡æ¢LLMæä¾›å•†å’Œä¾›åº”å•†ï¼Œæ— éœ€é‡å†™é›†æˆ</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šæ•°æ®ä¿æŒåœ¨æ‚¨çš„åŸºç¡€è®¾æ–½å†…ï¼Œæ˜ç¡®çš„å®‰å…¨è¾¹ç•Œ</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šå¯ä»¥æ ¹æ®éœ€è¦è¿æ¥å¤šä¸ªä¸“ç”¨æœåŠ¡å™¨ï¼Œæ”¯æŒå¤æ‚åŠŸèƒ½</li>
<li><strong>äº’æ“ä½œæ€§</strong>ï¼šæ ‡å‡†åŒ–åè®®ç¡®ä¿ä¸åŒç³»ç»Ÿé—´çš„å…¼å®¹ï¼Œé¿å…ä¾›åº”å•†é”å®š</li>
<li><strong>æœ¬åœ°è®¡ç®—</strong>ï¼šå¯ä»¥åœ¨æœ¬åœ°ç¯å¢ƒä¸­æ‰§è¡Œè®¡ç®—ï¼Œæ— éœ€å°†æ•æ„Ÿæ•°æ®å‘é€åˆ°äº‘ç«¯</li>
<li><strong>åˆ†å¸ƒå¼æ¶æ„</strong>ï¼šä¸åŒæœåŠ¡å¯ä»¥åœ¨ä¸åŒä½ç½®è¿è¡Œï¼Œæé«˜ç³»ç»Ÿå¼¹æ€§å’Œå¯ç”¨æ€§</li>
<li><strong>åŠ¨æ€å‘ç°</strong>ï¼šå®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€å‘ç°æœåŠ¡å™¨æä¾›çš„èµ„æºï¼Œæ— éœ€ç¡¬ç¼–ç </li>
<li><strong>éš”ç¦»æ€§</strong>ï¼šä¸åŒæœåŠ¡å™¨ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œä¸€ä¸ªæœåŠ¡å™¨çš„é—®é¢˜ä¸ä¼šå½±å“å…¶ä»–æœåŠ¡å™¨</li>
</ol>
<h2 id="å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</h2>
<p>MCPå¯ä»¥åº”ç”¨äºå¤šç§åœºæ™¯ï¼š</p>
<ul>
<li><strong>å¼€å‘ç¯å¢ƒé›†æˆ</strong>ï¼šåœ¨IDEä¸­é€šè¿‡MCPè®¿é—®æœ¬åœ°ä»£ç åº“ã€è¿è¡Œæµ‹è¯•ã€æ‰§è¡Œç‰ˆæœ¬æ§åˆ¶æ“ä½œ</li>
<li><strong>æ•°æ®åˆ†æ</strong>ï¼šå®‰å…¨è®¿é—®å’Œå¤„ç†æœ¬åœ°æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ•°æ®ï¼Œæ‰§è¡Œå¤æ‚åˆ†æ</li>
<li><strong>ä¼ä¸šåº”ç”¨</strong>ï¼šä¸å†…éƒ¨ç³»ç»Ÿå®‰å…¨é›†æˆï¼Œè®¿é—®ä¼ä¸šçŸ¥è¯†åº“ã€CRMç³»ç»Ÿã€ERPç³»ç»Ÿç­‰</li>
<li><strong>ä¸ªäººåŠ©æ‰‹</strong>ï¼šè®¿é—®ä¸ªäººæ–‡ä»¶å’Œåº”ç”¨ç¨‹åºï¼ŒåŒæ—¶ä¿æŒæ•°æ®éšç§ï¼Œå¦‚æ—¥å†ã€é‚®ä»¶ã€ç¬”è®°</li>
<li><strong>æ··åˆäº‘éƒ¨ç½²</strong>ï¼šåœ¨æœ¬åœ°å’Œäº‘ç«¯ä¹‹é—´æ— ç¼é›†æˆèµ„æºï¼Œå®ç°æ•°æ®å’ŒåŠŸèƒ½çš„æœ€ä½³åˆ†é…</li>
<li><strong>å¤šæ¨¡å‹åä½œ</strong>ï¼šå…è®¸å¤šä¸ªä¸åŒçš„LLMé€šè¿‡ç›¸åŒçš„æ¥å£è®¿é—®ç›¸åŒçš„èµ„æºï¼Œå®ç°æ¨¡å‹åä½œ</li>
</ul>
<h2 id="MCPå®ç°ç¤ºä¾‹">MCPå®ç°ç¤ºä¾‹</h2>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„MCPæœåŠ¡å™¨å®ç°ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæä¾›æ–‡ä»¶ç³»ç»Ÿè®¿é—®çš„MCPæœåŠ¡å™¨ï¼š</p>
<pre class="mermaid">flowchart TD
    A[åˆå§‹åŒ–MCPæœåŠ¡å™¨] --&gt; B{æ³¨å†Œèµ„æºå¤„ç†å™¨}
    B --&gt; C[æ–‡ä»¶è¯»å–å¤„ç†å™¨]
    B --&gt; D[æ–‡ä»¶å†™å…¥å¤„ç†å™¨]
    B --&gt; E[ç›®å½•åˆ—è¡¨å¤„ç†å™¨]
    C &amp; D &amp; E --&gt; F[å¯åŠ¨HTTPæœåŠ¡]
    F --&gt; G{å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚}
    G --&gt; H[è§£æè¯·æ±‚ç±»å‹]
    H --&gt; I{èµ„æºç±»å‹?}
    I --&gt;|è¯»å–æ–‡ä»¶| J[è°ƒç”¨æ–‡ä»¶è¯»å–å¤„ç†å™¨]
    I --&gt;|å†™å…¥æ–‡ä»¶| K[è°ƒç”¨æ–‡ä»¶å†™å…¥å¤„ç†å™¨]
    I --&gt;|åˆ—å‡ºç›®å½•| L[è°ƒç”¨ç›®å½•åˆ—è¡¨å¤„ç†å™¨]
    J &amp; K &amp; L --&gt; M[æ ¼å¼åŒ–å“åº”]
    M --&gt; N[è¿”å›ç»“æœç»™å®¢æˆ·ç«¯]</pre>
<h2 id="MCPçš„å‘å±•ç°çŠ¶">MCPçš„å‘å±•ç°çŠ¶</h2>
<p>MCPæ˜¯ä¸€é¡¹ç›¸å¯¹æ–°å…´çš„æŠ€æœ¯æ ‡å‡†ï¼Œç›®å‰æ­£å¤„äºå¿«é€Ÿå‘å±•é˜¶æ®µï¼š</p>
<ul>
<li><strong>æå‡ºä¸æ ‡å‡†åŒ–</strong>ï¼šç”±Anthropicå…¬å¸äº2023å¹´åº•æå‡ºå¹¶å¼€å§‹æ ‡å‡†åŒ–</li>
<li><strong>å½“å‰ç‰ˆæœ¬</strong>ï¼šæœ€æ–°çš„MCPè§„èŒƒç‰ˆæœ¬ä¸º2025-03-26ï¼Œæä¾›äº†å®Œæ•´çš„åè®®å®šä¹‰</li>
</ul>
<h3 id="æ”¯æŒMCPçš„å¹³å°å’Œå·¥å…·">æ”¯æŒMCPçš„å¹³å°å’Œå·¥å…·</h3>
<p>ç›®å‰å·²æœ‰å¤šä¸ªå¹³å°å’Œå·¥å…·æ”¯æŒMCPï¼š</p>
<ul>
<li><strong>Claude Desktop</strong>ï¼šAnthropicçš„æ¡Œé¢åº”ç”¨æ˜¯é¦–ä¸ªå¹¿æ³›æ”¯æŒMCPçš„å¹³å°ï¼Œå…è®¸ç”¨æˆ·è¿æ¥å„ç§MCPæœåŠ¡å™¨</li>
<li><strong>å„ç±»IDEæ’ä»¶</strong>ï¼šå¦‚Visual Studio Codeå’ŒJetBrainsç³»åˆ—IDEçš„æ’ä»¶å¼€å§‹æ”¯æŒMCPï¼Œæä¾›ä»£ç ç¼–è¾‘åŠ©æ‰‹åŠŸèƒ½</li>
<li><strong>å¼€å‘å·¥å…·åŒ…</strong>ï¼šæä¾›äº†Pythonã€TypeScriptã€Javaç­‰å¤šç§è¯­è¨€çš„SDKï¼Œæ–¹ä¾¿å¼€å‘è€…æ„å»ºMCPæœåŠ¡å™¨</li>
<li><strong>æ ·ä¾‹å®ç°</strong>ï¼šå®˜æ–¹æä¾›äº†æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“è¿æ¥ã€APIè°ƒç”¨ç­‰å¤šç§MCPæœåŠ¡å™¨ç¤ºä¾‹å®ç°</li>
</ul>
<h3 id="ç¤¾åŒºä¸ç”Ÿæ€ç³»ç»Ÿ">ç¤¾åŒºä¸ç”Ÿæ€ç³»ç»Ÿ</h3>
<p>MCPæ­£åœ¨å½¢æˆæ´»è·ƒçš„å¼€å‘è€…ç¤¾åŒºï¼š</p>
<ul>
<li><strong>GitHubç»„ç»‡</strong>ï¼šModelContextProtocolç»„ç»‡æ‰˜ç®¡äº†å®˜æ–¹è§„èŒƒå’ŒSDKä»£ç </li>
<li><strong>å¼€æºè´¡çŒ®</strong>ï¼šç¤¾åŒºå¼€å‘è€…ç§¯æè´¡çŒ®å„ç§MCPæœåŠ¡å™¨å®ç°å’Œå®¢æˆ·ç«¯é›†æˆ</li>
<li><strong>å•†ä¸šåº”ç”¨</strong>ï¼šä¸€äº›ä¼ä¸šå¼€å§‹å¼€å‘åŸºäºMCPçš„å•†ä¸šäº§å“å’ŒæœåŠ¡ï¼Œå°¤å…¶æ˜¯åœ¨ä¼ä¸šAIå’Œæ•°æ®åˆ†æé¢†åŸŸ</li>
</ul>
<p>è™½ç„¶MCPä»åœ¨å‘å±•ä¸­ï¼Œä½†å…¶å·²ç»æ˜¾ç¤ºå‡ºæˆä¸ºAIç³»ç»Ÿä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„é‡è¦æ ‡å‡†çš„æ½œåŠ›ã€‚éšç€æ›´å¤šå¹³å°å’Œå·¥å…·åŠ å…¥æ”¯æŒï¼ŒMCPçš„ç”Ÿæ€ç³»ç»Ÿæœ‰æœ›åœ¨æœªæ¥å‡ å¹´å†…è¿…é€Ÿæ‰©å¤§ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>Model Context Protocol (MCP) ä»£è¡¨äº†LLMå·¥å…·é›†æˆçš„ä¸€ç§æ–°æ–¹å‘ï¼Œå®ƒé€šè¿‡æ ‡å‡†åŒ–ã€åˆ†å¸ƒå¼æ¶æ„è§£å†³äº†è®¸å¤šä¼ ç»Ÿæ–¹æ³•çš„é™åˆ¶ã€‚é€šè¿‡å°†åŠŸèƒ½æ‹†åˆ†åˆ°ä¸“ç”¨æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¿æŒç»Ÿä¸€çš„åè®®æ¥å£ï¼ŒMCPä¸ºæ„å»ºæ›´å¼ºå¤§ã€æ›´å®‰å…¨ã€æ›´çµæ´»çš„AIåº”ç”¨ç¨‹åºæä¾›äº†åšå®çš„åŸºç¡€ã€‚</p>
<p>MCPçš„å‡ºç°æ ‡å¿—ç€AIå·¥å…·é›†æˆä»ç®€å•çš„å‡½æ•°è°ƒç”¨å‘æˆç†Ÿçš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„æ¼”è¿›ï¼Œä¸ºæ„å»ºä¸‹ä¸€ä»£AIåº”ç”¨æä¾›äº†æ›´å®Œå–„çš„åŸºç¡€è®¾æ–½æ”¯æŒã€‚éšç€LLMç»§ç»­èå…¥å„ç§åº”ç”¨ç¨‹åºå’Œå·¥ä½œæµç¨‹ï¼ŒMCPè¿™æ ·çš„æ ‡å‡†å°†å˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼Œå®ƒä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨ä¿æŒæ•°æ®å®‰å…¨çš„åŒæ—¶ï¼Œå……åˆ†å‘æŒ¥è¯­è¨€æ¨¡å‹çš„æ½œåŠ›ã€‚<br>
è¨€æ¨¡å‹çš„æ½œåŠ›ã€‚</p>
]]></content>
      <categories>
        <category>AIå·¥ç¨‹</category>
        <category>MCP</category>
      </categories>
      <tags>
        <tag>LLM</tag>
        <tag>MCP</tag>
        <tag>å·¥å…·é›†æˆ</tag>
        <tag>AIæ¶æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL é¡µç±»å‹è¯¦è§£</title>
    <url>/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/MySQL%E9%A1%B5%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h2 id="MySQL-é¡µçš„æ¦‚å¿µ">MySQL é¡µçš„æ¦‚å¿µ</h2>
<p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œé¡µ(Page)æ˜¯æ•°æ®å­˜å‚¨çš„åŸºæœ¬å•ä½ï¼Œé»˜è®¤å¤§å°ä¸º 16KBã€‚MySQL ä»¥é¡µä¸ºå•ä½è¿›è¡Œç£ç›˜ä¸å†…å­˜ä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œè¿™ç§è®¾è®¡å¯ä»¥æ˜¾è‘—å‡å°‘ I/O æ“ä½œæ¬¡æ•°ï¼Œæé«˜æ•°æ®åº“æ€§èƒ½ã€‚</p>
<h2 id="InnoDB-é¡µçš„é€šç”¨ç»“æ„">InnoDB é¡µçš„é€šç”¨ç»“æ„</h2>
<p>æ¯ä¸ª InnoDB é¡µéƒ½åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><strong>æ–‡ä»¶å¤´(File Header)</strong>: è®°å½•é¡µçš„æ§åˆ¶ä¿¡æ¯ï¼Œå  38 å­—èŠ‚</li>
<li><strong>é¡µå¤´(Page Header)</strong>: è®°å½•é¡µçš„çŠ¶æ€ä¿¡æ¯ï¼Œå  56 å­—èŠ‚</li>
<li><strong>ä¸»ä½“æ•°æ®åŒº(Body)</strong>: å­˜å‚¨å®é™…æ•°æ®</li>
<li><strong>æ–‡ä»¶å°¾(File Trailer)</strong>: ç”¨äºé¡µé¢å®Œæ•´æ€§æ£€æŸ¥ï¼Œå  8 å­—èŠ‚</li>
</ul>
<h2 id="MySQL-ä¸­çš„ä¸»è¦é¡µç±»å‹">MySQL ä¸­çš„ä¸»è¦é¡µç±»å‹</h2>
<h3 id="1-æ•°æ®é¡µ-B-tree-Node">1. æ•°æ®é¡µ(B-tree Node)</h3>
<p>æ•°æ®é¡µæ˜¯æœ€å¸¸è§çš„é¡µç±»å‹ï¼Œç”¨äºå­˜å‚¨è¡¨ä¸­çš„å®é™…æ•°æ®è®°å½•ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ B+æ ‘ç»“æ„ç»„ç»‡</li>
<li>åŒ…å«å¤šæ¡è®°å½•</li>
<li>è®°å½•æŒ‰ä¸»é”®é¡ºåºæ’åˆ—</li>
<li>å¶å­èŠ‚ç‚¹åŒ…å«å®Œæ•´çš„ç”¨æˆ·æ•°æ®</li>
<li>éå¶å­èŠ‚ç‚¹åªåŒ…å«ç´¢å¼•é”®å€¼å’ŒæŒ‡å‘å­é¡µçš„æŒ‡é’ˆ</li>
</ul>
<p>æ•°æ®é¡µç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+------------------+</span><br><span class="line">| File Header      |</span><br><span class="line">+------------------+</span><br><span class="line">| Page Header      |</span><br><span class="line">+------------------+</span><br><span class="line">| Infimum Record   |</span><br><span class="line">+------------------+</span><br><span class="line">| User Records     |</span><br><span class="line">+------------------+</span><br><span class="line">| Free Space       |</span><br><span class="line">+------------------+</span><br><span class="line">| Supremum Record  |</span><br><span class="line">+------------------+</span><br><span class="line">| Page Directory   |</span><br><span class="line">+------------------+</span><br><span class="line">| File Trailer     |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure>
<h3 id="2-ç´¢å¼•é¡µ-Index-Page">2. ç´¢å¼•é¡µ(Index Page)</h3>
<p>ç´¢å¼•é¡µä¸“é—¨ç”¨äºå­˜å‚¨ç´¢å¼•ä¿¡æ¯ï¼ŒåŠ é€Ÿæ•°æ®æ£€ç´¢ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ä¹Ÿä½¿ç”¨ B+æ ‘ç»“æ„</li>
<li>éèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼</li>
<li>éå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•é”®å€¼å’ŒæŒ‡å‘å­é¡µçš„æŒ‡é’ˆ</li>
</ul>
<h3 id="3-æ’¤é”€é¡µ-Undo-Log-Page">3. æ’¤é”€é¡µ(Undo Log Page)</h3>
<p>æ’¤é”€é¡µç”¨äºå­˜å‚¨æ’¤é”€æ—¥å¿—è®°å½•ï¼Œæ”¯æŒäº‹åŠ¡å›æ»šå’Œ MVCC(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>è®°å½•æ•°æ®ä¿®æ”¹å‰çš„çŠ¶æ€</li>
<li>æŒ‰äº‹åŠ¡åˆ†ç»„ç»„ç»‡</li>
<li>æ”¯æŒäº‹åŠ¡çš„åŸå­æ€§å’Œéš”ç¦»æ€§</li>
</ul>
<h3 id="4-ç³»ç»Ÿé¡µ-System-Page">4. ç³»ç»Ÿé¡µ(System Page)</h3>
<p>ç³»ç»Ÿé¡µç”¨äºå­˜å‚¨ InnoDB å†…éƒ¨ç³»ç»Ÿä¿¡æ¯ã€‚</p>
<p><strong>ä¸»è¦ç³»ç»Ÿé¡µ</strong>ï¼š</p>
<ul>
<li><strong>æ•°æ®å­—å…¸é¡µ</strong>: å­˜å‚¨è¡¨å®šä¹‰ç­‰å…ƒæ•°æ®</li>
<li><strong>åŒå†™ç¼“å†²é¡µ</strong>: ç”¨äºé˜²æ­¢éƒ¨åˆ†å†™å¤±æ•ˆ</li>
<li><strong>æ’å…¥ç¼“å†²ä½å›¾é¡µ</strong>: è®°å½•å“ªäº›ç´¢å¼•é¡µåŒ…å«æ’å…¥ç¼“å†²è®°å½•</li>
<li><strong>äº‹åŠ¡ç³»ç»Ÿé¡µ</strong>: å­˜å‚¨æ´»è·ƒäº‹åŠ¡ä¿¡æ¯</li>
</ul>
<h3 id="5-æº¢å‡ºé¡µ-Overflow-Page">5. æº¢å‡ºé¡µ(Overflow Page)</h3>
<p>å½“è®°å½•å¤ªé•¿æ— æ³•å®Œå…¨å­˜å‚¨åœ¨æ•°æ®é¡µä¸­æ—¶ï¼Œä½¿ç”¨æº¢å‡ºé¡µå­˜å‚¨é¢å¤–æ•°æ®ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ç”¨äºå­˜å‚¨å¤§å­—æ®µ(å¦‚ TEXT, BLOB)</li>
<li>é€šè¿‡æŒ‡é’ˆä»ä¸»æ•°æ®é¡µé“¾æ¥</li>
<li>å¯èƒ½æœ‰å¤šä¸ªè¿ç»­çš„æº¢å‡ºé¡µå½¢æˆé“¾è¡¨</li>
</ul>
<h3 id="6-å‹ç¼©é¡µ-Compressed-Page">6. å‹ç¼©é¡µ(Compressed Page)</h3>
<p>é’ˆå¯¹è¡¨å¯ç”¨å‹ç¼©ç‰¹æ€§æ—¶ä½¿ç”¨çš„ç‰¹æ®Šé¡µæ ¼å¼ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>èŠ‚çœç£ç›˜ç©ºé—´</li>
<li>æ”¯æŒ 1KB, 2KB, 4KB, 8KB ç­‰å¤šç§å‹ç¼©é¡µå¤§å°</li>
<li>åŒ…å«é¢å¤–çš„è§£å‹ç¼©ä¿¡æ¯</li>
</ul>
<h3 id="7-ä¸´æ—¶é¡µ-Temporary-Page">7. ä¸´æ—¶é¡µ(Temporary Page)</h3>
<p>ç”¨äºä¸´æ—¶è¡¨æˆ–æ’åºç­‰æ“ä½œçš„é¡µã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å­˜å‚¨åœ¨ä¸´æ—¶è¡¨ç©ºé—´</li>
<li>ä»…åœ¨ä¼šè¯æœŸé—´æœ‰æ•ˆ</li>
<li>ä¸å†™å…¥ redo æ—¥å¿—</li>
</ul>
<h3 id="8-ç¢ç‰‡é¡µ-Fragment-Page">8. ç¢ç‰‡é¡µ(Fragment Page)</h3>
<p>ç”¨äºç®¡ç†è¡¨ç©ºé—´ä¸­ç©ºé—²ç©ºé—´çš„é¡µã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>è®°å½•å¯ç”¨äºåˆ†é…çš„ç©ºé—²ç©ºé—´</li>
<li>é¿å…äº§ç”Ÿç¢ç‰‡</li>
<li>æé«˜ç©ºé—´åˆ©ç”¨ç‡</li>
</ul>
<h2 id="é¡µç±»å‹å¯¹æ€§èƒ½çš„å½±å“">é¡µç±»å‹å¯¹æ€§èƒ½çš„å½±å“</h2>
<p>ä¸åŒç±»å‹çš„é¡µåœ¨ MySQL æ€§èƒ½ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼š</p>
<ol>
<li><strong>æ•°æ®é¡µå’Œç´¢å¼•é¡µ</strong>: ç›´æ¥å½±å“æŸ¥è¯¢æ€§èƒ½ï¼Œç¼“å†²æ± ä¸­çš„è¿™äº›é¡µè¶Šå¤šï¼Œå‘½ä¸­ç‡è¶Šé«˜ï¼Œæ€§èƒ½è¶Šå¥½</li>
<li><strong>æ’¤é”€é¡µ</strong>: è¿‡å¤šçš„æ’¤é”€é¡µå¯èƒ½è¡¨æ˜æœ‰é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡ï¼Œå¯èƒ½å½±å“å¹¶å‘æ€§èƒ½</li>
<li><strong>å‹ç¼©é¡µ</strong>: å‡å°‘ I/O ä½†å¢åŠ  CPU å¼€é”€ï¼Œéœ€æƒè¡¡</li>
<li><strong>æº¢å‡ºé¡µ</strong>: è®¿é—®å¤§å­—æ®µæ—¶å¯èƒ½å¯¼è‡´é¢å¤– I/Oï¼Œå½±å“æ€§èƒ½</li>
</ol>
<h2 id="å¦‚ä½•æŸ¥çœ‹é¡µä¿¡æ¯">å¦‚ä½•æŸ¥çœ‹é¡µä¿¡æ¯</h2>
<p>å¯ä»¥ä½¿ç”¨ InnoDB ç›‘æ§å·¥å…·å’Œæ€§èƒ½æ¨¡å¼æŸ¥çœ‹é¡µçš„ä½¿ç”¨æƒ…å†µï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹InnoDB buffer poolä¸­çš„é¡µç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">SHOW</span> ENGINE INNODB STATUS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹è¡¨çš„é¡µä¿¡æ¯(MySQL 8.0+)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.INNODB_TABLES</span><br><span class="line"><span class="keyword">WHERE</span> NAME <span class="operator">=</span> <span class="string">&#x27;database_name/table_name&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹ç´¢å¼•çš„é¡µä¿¡æ¯</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.INNODB_INDEXES</span><br><span class="line"><span class="keyword">WHERE</span> TABLE_ID <span class="operator">=</span> xxx;</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>MySQL çš„é¡µæ˜¯å…¶å­˜å‚¨ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸åŒç±»å‹çš„é¡µååŒå·¥ä½œï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€ä¸€è‡´æ€§å’Œé«˜æ•ˆè®¿é—®ã€‚ç†è§£è¿™äº›é¡µç±»å‹æœ‰åŠ©äºä¼˜åŒ–æ•°æ®åº“è®¾è®¡å’Œæ€§èƒ½è°ƒä¼˜ã€‚å¯¹äºå¤§å‹æ•°æ®åº“ç³»ç»Ÿï¼Œä¼˜åŒ–é¡µçš„ä½¿ç”¨å’Œé…ç½®(å¦‚ç¼“å†²æ± å¤§å°ã€é¡µå‹ç¼©ç­‰)å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ã€‚</p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>å­˜å‚¨åŸç†</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>MySQL</tag>
        <tag>è®°å½•å­˜å‚¨æ–¹å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>MYSQL è®°å½•å­˜å‚¨æ–¹å¼</title>
    <url>/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="MYSQL-æ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½®">MYSQL æ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½®</h2>
<p>ä½¿ç”¨ <code>show variables like 'datadir';</code> å‘½ä»¤æŸ¥çœ‹æ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;datadir&#x27;</span>;</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| Variable_name | Value           |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| datadir       | /var/lib/mysql/ |</span><br><span class="line">+---------------+-----------------+</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚æˆ‘ä»¬çš„æ•°æ®åº“æ˜¯ <code>test</code>ï¼Œé‚£ä¹ˆæ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½®å°±æ˜¯ <code>/var/lib/mysql/test/</code>ã€‚</p>
<p>è¯¥ç›®å½•ä¸‹æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<ul>
<li><code>db.opt</code>ï¼šæ•°æ®åº“é€‰é¡¹æ–‡ä»¶ï¼Œè®°å½•äº†æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ ¡éªŒè§„åˆ™</li>
<li><code>test.frm</code>ï¼šè¡¨ç»“æ„æ–‡ä»¶ï¼Œè®°å½•äº†è¡¨çš„ç»“æ„</li>
<li><code>test.ibd</code>ï¼šè¡¨æ•°æ®æ–‡ä»¶ï¼Œè®°å½•äº†è¡¨çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ•°æ®é¡µå’Œç´¢å¼•é¡µï¼Œå®ƒä¹Ÿè¢«ç§°ä½œ <code>InnoDB</code> å­˜å‚¨å¼•æ“çš„ <code>è¡¨ç©ºé—´æ–‡ä»¶</code></li>
</ul>
<h2 id="è¡¨ç©ºé—´æ–‡ä»¶ç»“æ„">è¡¨ç©ºé—´æ–‡ä»¶ç»“æ„</h2>
<p>è¡¨ç©ºé—´ä¸»è¦ç”± <strong>æ®µ(segment)</strong>ã€<strong>åŒº(extent)</strong>ã€<strong>é¡µ(page)</strong>ã€<strong>è¡Œ(row)</strong> ç»„æˆã€‚</p>
<ul>
<li>
<p><strong>è¡Œ(row)</strong>ï¼šè¡Œæ˜¯è¡¨ç©ºé—´çš„æœ€å°å­˜å‚¨å•ä½ï¼Œæ˜¯ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­æ•°æ®å­˜å‚¨çš„åŸºæœ¬å•ä½ã€‚</p>
</li>
<li>
<p><strong>é¡µ(page)</strong>ï¼šé¡µæ˜¯ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­æ•°æ®å­˜å‚¨çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªé¡µé»˜è®¤å¤§å°ä¸º <code>16KB</code>,é¡µæ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†æ•°æ®ï¼Œå¦åˆ™ç›´æ¥ä»¥è¡Œæ¥å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆæ¯æ¬¡å­˜å–æ•°æ®éƒ½è¦è¿›è¡Œ <code>I/O</code> æ“ä½œï¼Œæ•ˆç‡ä½ä¸‹ã€‚æ¯æ¬¡æ•°æ®åº“çš„è¯»å†™æ“ä½œéƒ½æ˜¯ä»¥é¡µä¸ºå•ä½è¿›è¡Œçš„ã€‚é¡µçš„ç±»å‹æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æ•°æ®é¡µã€ç´¢å¼•é¡µã€å›æ»šé¡µã€æº¢å‡ºé¡µã€ä¸´æ—¶é¡µã€ç³»ç»Ÿé¡µã€äº‹åŠ¡æ•°æ®é¡µã€æ–‡ä»¶é¡µç­‰ï¼Œå…·ä½“å‚è€ƒ<a href="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/MySQL%E9%A1%B5%E7%B1%BB%E5%9E%8B/">MySQL é¡µç±»å‹</a>ã€‚</p>
</li>
<li>
<p><strong>åŒº(extent)</strong>ï¼šåŒºæ˜¯ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­æ•°æ®å­˜å‚¨çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªåŒºé»˜è®¤å¤§å°ä¸º <code>1MB</code>ï¼Œä¸€ä¸ªåŒºç”± <code>64</code> ä¸ªé¡µç»„æˆã€‚</p>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ <code>InnoDB</code> å­˜å‚¨å¼•æ“æ˜¯ <code>B+</code> æ ‘ç»“æ„ï¼Œ<code>B+</code> æ ‘ç»“æ„çš„æœ€åä¸€å±‚æ˜¯ä½¿ç”¨åŒå‘é“¾è¡¨è¿æ¥çš„ï¼Œé‚£ä¹ˆå¦‚æœé“¾è¡¨ä¸­ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®å¾ˆè¿œï¼Œé‚£ä¹ˆç£ç›˜æŸ¥è¯¢ä¼šå¸¦æ¥å¤§é‡çš„<strong>éšæœº I/O</strong>ï¼ˆè·Ÿç£ç›˜çš„æœºæ¢°è¿åŠ¨æœ‰å…³ï¼‰ï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p>å› æ­¤ <code>InnoDB</code> å­˜å‚¨å¼•æ“å¼•å…¥äº†åŒºçš„æ¦‚å¿µï¼Œä¸€ä¸ªåŒºç”± <code>64</code> ä¸ªé¡µç»„æˆï¼Œè¿™æ ·å°±å¯ä»¥å°†ç‰©ç†ä½ç½®ç›¸é‚»çš„é¡µæ”¾åˆ°ä¸€ä¸ªåŒºä¸­ï¼Œä»è€Œå‡å°‘ç£ç›˜çš„éšæœº <code>I/O</code> æ“ä½œï¼Œæé«˜<strong>é¡ºåº I/O</strong>çš„é¢‘ç‡ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>æ®µ(segment)</strong>ï¼šè¡¨ç©ºé—´æ˜¯ç”±å¤šä¸ªæ®µç»„æˆçš„ï¼Œæ®µæ˜¯ç”±å¤šä¸ªåŒºç»„æˆçš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ®µåˆ†ä¸ºæ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ã€‚</p>
<ul>
<li>æ•°æ®æ®µï¼šå­˜æ”¾ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­å¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆã€‚</li>
<li>ç´¢å¼•æ®µï¼šå­˜æ”¾ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­éå¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆã€‚</li>
<li>å›æ»šæ®µï¼šå­˜æ”¾ <code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­è¡¨çš„å›æ»šæ•°æ®çš„é›†åˆã€‚å°±æ˜¯äº‹åŠ¡éš”ç¦»éƒ¨åˆ†ï¼Œä½¿ç”¨ <code>MVCC</code> æœºåˆ¶ï¼Œå°±åˆ©ç”¨äº†å›æ»šæ®µæ¥å®ç°å¤šç‰ˆæœ¬æŸ¥è¯¢æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745323847902.png" alt="1745323847902"></p>
<h2 id="InnoDB-è¡Œæ ¼å¼">InnoDB è¡Œæ ¼å¼</h2>
<p>InnoDB æä¾›äº† <code>Compact</code>ã€<code>Redundant</code>ã€<code>Dynamic</code>ã€<code>Compressed</code> å››ç§è¡Œæ ¼å¼ï¼Œ5.1 ç‰ˆæœ¬åé»˜è®¤ä½¿ç”¨ <code>Compact</code> è¡Œæ ¼å¼ï¼Œ5.7 ç‰ˆæœ¬åé»˜è®¤ä½¿ç”¨ <code>Dynamic</code> è¡Œæ ¼å¼ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„ <code>Redundant</code> è¡Œæ ¼å¼æ˜¯ <code>InnoDB</code> æ—©æœŸç‰ˆæœ¬ä½¿ç”¨çš„è¡Œæ ¼å¼ï¼Œç°åœ¨å·²ç»ä¸å†ä½¿ç”¨ã€‚å› ä¸º Redundant ä¸æ˜¯ä¸€ç§ç´§å‡‘çš„è¡Œæ ¼å¼ï¼Œæ‰€ä»¥ç°åœ¨ä½¿ç”¨ <code>Compact</code> è¡Œæ ¼å¼ã€‚</p>
<p><code>Dynamic</code> å’Œ <code>Compressed</code> è¡Œæ ¼å¼éƒ½å’Œ <code>Compact</code> è¡Œæ ¼å¼ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ <code>Compact</code> è¡Œæ ¼å¼çš„ä¸€ç§ä¼˜åŒ–ã€‚</p>
</blockquote>
<h3 id="Compact-è¡Œæ ¼å¼">Compact è¡Œæ ¼å¼</h3>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/COMPACT-ROW.png" alt="1745324130903"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€æ¡å®Œæ•´çš„è®°å½•è¢«åˆ†ä¸ºäº†â€œè®°å½•çš„é¢å¤–ä¿¡æ¯â€å’Œâ€œè®°å½•çš„çœŸå®æ•°æ®â€ä¸¤éƒ¨åˆ†ã€‚</p>
<ul>
<li>
<p>â€œè®°å½•çš„é¢å¤–ä¿¡æ¯â€ï¼š</p>
<ul>
<li><code>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</code>ï¼šè¡¨ç¤ºè¯¥æ¡è®°å½•ä¸­å˜é•¿å­—æ®µçš„é•¿åº¦ã€‚</li>
<li><code>NULL å€¼åˆ—è¡¨</code>ï¼šè¡¨ç¤ºè¯¥æ¡è®°å½•ä¸­å“ªäº›å­—æ®µä¸º <code>NULL</code>ã€‚</li>
<li><code>è®°å½•å¤´ä¿¡æ¯</code>ï¼šè¡¨ç¤ºè¯¥æ¡è®°å½•çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è®°å½•çš„ç±»å‹ã€é•¿åº¦ã€æ˜¯å¦è¢«åˆ é™¤ç­‰ã€‚</li>
</ul>
</li>
<li>
<p>â€œè®°å½•çš„çœŸå®æ•°æ®â€ï¼š</p>
<ul>
<li><code>row_id</code>ï¼šè¡¨ç¤ºè¯¥æ¡è®°å½•çš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœè¡¨ä¸­æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œé‚£ä¹ˆ <code>InnoDB</code> ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª <code>row_id</code> ä½œä¸ºä¸»é”®ã€‚</li>
<li><code>äº‹åŠ¡ID</code>ï¼šè¡¨ç¤ºè¯¥æ¡è®°å½•çš„äº‹åŠ¡ IDã€‚</li>
<li><code>å›æ»šæŒ‡é’ˆ</code>ï¼šè¡¨ç¤ºè¯¥æ¡è®°å½•çš„å›æ»šæŒ‡é’ˆã€‚</li>
<li><code>åˆ—1...åˆ—N</code>ï¼šè¡¨ç¤ºè¯¥æ¡è®°å½•çš„åˆ—æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<h4 id="å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨">å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</h4>
<p>æ¯”å¦‚ <code>varchar</code>ã€<code>varbinary</code>ã€<code>text</code>ã€<code>blob</code> ç­‰è¿™ç§å±äºå˜é•¿å­—æ®µï¼Œå°±éœ€è¦æŠŠå®ƒçš„é•¿åº¦å­˜èµ·æ¥ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªåˆ—è¡¨æ¥è®°å½•æ¯ä¸ªå˜é•¿å­—æ®µçš„é•¿åº¦ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹çš„è¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `t_user` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `phone` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> <span class="keyword">CHARACTER SET</span> <span class="operator">=</span> ascii ROW_FORMAT <span class="operator">=</span> COMPACT;</span><br></pre></td></tr></table></figure>
<p>å‡è®¾è¿™é‡Œæœ‰ä¸‰æ¡è®°å½•:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>phone</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>123</td>
<td>18</td>
</tr>
<tr>
<td>2</td>
<td>bb</td>
<td>1234</td>
<td>NULL</td>
</tr>
<tr>
<td>3</td>
<td>ccc</td>
<td>NULL</td>
<td>NULL</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€æ¡è®°å½•ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>phone</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>123</td>
<td>18</td>
</tr>
</tbody>
</table>
<p><code>name</code> åˆ—çš„å€¼ä¸º aï¼ŒçœŸå®æ•°æ®å ç”¨ 1 å­—èŠ‚ï¼Œåå…­è¿›åˆ¶ä¸º 0x01ï¼Œ<code>phone</code> åˆ—çš„å€¼ä¸º 123ï¼ŒçœŸå®æ•°æ®å ç”¨ 3 å­—èŠ‚ï¼Œåå…­è¿›åˆ¶ä¸º 0x03ï¼Œ<code>age</code> å’Œ <code>id</code> åˆ—éƒ½æ˜¯å®šé•¿å­—æ®µï¼Œè¿™é‡Œä¸ç”¨è®°å½•é•¿åº¦ã€‚</p>
<p>è¿™äº›å˜é•¿å­—æ®µçš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¼šæŒ‰ç…§åˆ—çš„é¡ºåº<strong>é€†åºå­˜æ”¾</strong>ï¼ˆç­‰ä¸‹ä¼šè¯´ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼‰ï¼Œæ‰€ä»¥ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€é‡Œçš„å†…å®¹æ˜¯ã€Œ03 01ã€ï¼Œè€Œä¸æ˜¯ã€Œ01 03ã€ã€‚</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459344704.png" alt="1745459344704"></p>
<p>åŒæ ·çš„é“ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—å‡º<strong>ç¬¬äºŒæ¡è®°å½•</strong>çš„è¡Œæ ¼å¼ä¸­ï¼Œã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€é‡Œçš„å†…å®¹æ˜¯ã€Œ04 02ã€ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459442389.png" alt="1745459442389"></p>
<p><strong>ç¬¬ä¸‰æ¡è®°å½•</strong>ä¸­ phone åˆ—çš„å€¼æ˜¯ NULLï¼Œ<strong>NULL æ˜¯ä¸ä¼šå­˜æ”¾åœ¨è¡Œæ ¼å¼ä¸­è®°å½•çš„çœŸå®æ•°æ®éƒ¨åˆ†é‡Œçš„</strong>ï¼Œæ‰€ä»¥ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€é‡Œä¸éœ€è¦ä¿å­˜å€¼ä¸º NULL çš„å˜é•¿å­—æ®µçš„é•¿åº¦ã€‚</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459442389.png" alt="1745459442389"></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€çš„ä¿¡æ¯è¦æŒ‰ç…§é€†åºå­˜æ”¾ï¼Ÿ</p>
</blockquote>
<p>è¿™ä¸ªè®¾è®¡æ˜¯æœ‰æƒ³æ³•çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºã€Œè®°å½•å¤´ä¿¡æ¯ã€ä¸­æŒ‡å‘ä¸‹ä¸€ä¸ªè®°å½•çš„æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„ã€Œè®°å½•å¤´ä¿¡æ¯ã€å’Œã€ŒçœŸå®æ•°æ®ã€ä¹‹é—´çš„ä½ç½®ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‘å·¦è¯»å°±æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å°±æ˜¯çœŸå®æ•°æ®ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<p>ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€ä¸­çš„ä¿¡æ¯ä¹‹æ‰€ä»¥è¦é€†åºå­˜æ”¾ï¼Œæ˜¯å› ä¸ºè¿™æ ·å¯ä»¥<strong>ä½¿å¾—ä½ç½®é å‰çš„è®°å½•çš„çœŸå®æ•°æ®å’Œæ•°æ®å¯¹åº”çš„å­—æ®µé•¿åº¦ä¿¡æ¯å¯ä»¥åŒæ—¶åœ¨ä¸€ä¸ª CPU Cache Line ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æé«˜ CPU Cache çš„å‘½ä¸­ç‡</strong>ã€‚</p>
<p>åŒæ ·çš„é“ç†ï¼ŒNULL å€¼åˆ—è¡¨çš„ä¿¡æ¯ä¹Ÿéœ€è¦é€†åºå­˜æ”¾ã€‚</p>
<p>å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ CPU Cacheï¼Œå¯ä»¥çœ‹<a href="https://xiaolincoding.com/os/1_hardware/how_to_make_cpu_run_faster.html">è¿™ç¯‡æ–‡ç« </a>ï¼Œè¿™å±äºè®¡ç®—æœºç»„æˆçš„çŸ¥è¯†ã€‚</p>
<blockquote>
<p>æ¯ä¸ªæ•°æ®åº“è¡¨çš„è¡Œæ ¼å¼éƒ½æœ‰ã€Œå˜é•¿å­—æ®µå­—èŠ‚æ•°åˆ—è¡¨ã€å—ï¼Ÿ</p>
</blockquote>
<p>å…¶å®å˜é•¿å­—æ®µå­—èŠ‚æ•°åˆ—è¡¨ä¸æ˜¯å¿…é¡»çš„ã€‚</p>
<p><strong>å½“æ•°æ®è¡¨æ²¡æœ‰å˜é•¿å­—æ®µçš„æ—¶å€™ï¼Œæ¯”å¦‚å…¨éƒ¨éƒ½æ˜¯ int ç±»å‹çš„å­—æ®µï¼Œè¿™æ—¶å€™è¡¨é‡Œçš„è¡Œæ ¼å¼å°±ä¸ä¼šæœ‰ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€äº†</strong>ï¼Œå› ä¸ºæ²¡å¿…è¦ï¼Œä¸å¦‚å»æ‰ä»¥èŠ‚çœç©ºé—´ã€‚</p>
<p>æ‰€ä»¥ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€åªå‡ºç°åœ¨æ•°æ®è¡¨æœ‰å˜é•¿å­—æ®µçš„æ—¶å€™ã€‚</p>
<h4 id="2-NULL-å€¼åˆ—è¡¨">2. NULL å€¼åˆ—è¡¨</h4>
<p>è¡¨ä¸­çš„æŸäº›åˆ—å¯èƒ½ä¼šå­˜å‚¨ NULL å€¼ï¼Œå¦‚æœæŠŠè¿™äº› NULL å€¼éƒ½æ”¾åˆ°è®°å½•çš„çœŸå®æ•°æ®ä¸­ä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ï¼Œæ‰€ä»¥ Compact è¡Œæ ¼å¼æŠŠè¿™äº›å€¼ä¸º NULL çš„åˆ—å­˜å‚¨åˆ° NULL å€¼åˆ—è¡¨ä¸­ã€‚</p>
<p>å¦‚æœå­˜åœ¨å…è®¸ NULL å€¼çš„åˆ—ï¼Œåˆ™æ¯ä¸ªåˆ—å¯¹åº”ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆbitï¼‰ï¼ŒäºŒè¿›åˆ¶ä½æŒ‰ç…§åˆ—çš„é¡ºåºé€†åºæ’åˆ—ã€‚</p>
<ul>
<li>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º <code>1</code>æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸º NULLã€‚</li>
<li>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º <code>0</code>æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ä¸º NULLã€‚</li>
</ul>
<p>å¦å¤–ï¼ŒNULL å€¼åˆ—è¡¨å¿…é¡»ç”¨æ•´æ•°ä¸ªå­—èŠ‚çš„ä½è¡¨ç¤ºï¼ˆ1 å­—èŠ‚ 8 ä½ï¼‰ï¼Œå¦‚æœä½¿ç”¨çš„äºŒè¿›åˆ¶ä½ä¸ªæ•°ä¸è¶³æ•´æ•°ä¸ªå­—èŠ‚ï¼Œåˆ™åœ¨å­—èŠ‚çš„é«˜ä½è¡¥ <code>0</code>ã€‚</p>
<p>è¿˜æ˜¯ä»¥ t_user è¡¨çš„è¿™ä¸‰æ¡è®°å½•ä½œä¸ºä¾‹å­ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>phone</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>123</td>
<td>18</td>
</tr>
<tr>
<td>2</td>
<td>bb</td>
<td>1234</td>
<td>NULL</td>
</tr>
<tr>
<td>3</td>
<td>ccc</td>
<td>NULL</td>
<td>NULL</td>
</tr>
</tbody>
</table>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹çœ‹çœ‹è¿™ä¸‰æ¡è®°å½•çš„è¡Œæ ¼å¼ä¸­çš„ NULL å€¼åˆ—è¡¨æ˜¯æ€æ ·å­˜å‚¨çš„ã€‚</p>
<p>å…ˆæ¥çœ‹<strong>ç¬¬ä¸€æ¡è®°å½•</strong>ï¼Œç¬¬ä¸€æ¡è®°å½•æ‰€æœ‰åˆ—éƒ½æœ‰å€¼ï¼Œä¸å­˜åœ¨ NULL å€¼ï¼Œæ‰€ä»¥ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºæ˜¯é…±ç´«çš„ï¼š</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459724424.png" alt="1745459724424"></p>
<p>ä½†æ˜¯ InnoDB æ˜¯ç”¨æ•´æ•°å­—èŠ‚çš„äºŒè¿›åˆ¶ä½æ¥è¡¨ç¤º NULL å€¼åˆ—è¡¨çš„ï¼Œç°åœ¨ä¸è¶³ 8 ä½ï¼Œæ‰€ä»¥è¦åœ¨é«˜ä½è¡¥ 0ï¼Œæœ€ç»ˆç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºæ˜¯é…±ç´«çš„ï¼š</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459735372.png" alt="1745459735372"></p>
<p>æ‰€ä»¥ï¼Œå¯¹äºç¬¬ä¸€æ¡æ•°æ®ï¼ŒNULL å€¼åˆ—è¡¨ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ 0x00ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹<strong>ç¬¬äºŒæ¡è®°å½•</strong>ï¼Œç¬¬äºŒæ¡è®°å½• age åˆ—æ˜¯ NULL å€¼ï¼Œæ‰€ä»¥ï¼Œå¯¹äºç¬¬äºŒæ¡æ•°æ®ï¼ŒNULL å€¼åˆ—è¡¨ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ 0x04ã€‚</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459744703.png" alt="1745459744703"></p>
<p>æœ€å<strong>ç¬¬ä¸‰æ¡è®°å½•</strong>ï¼Œç¬¬ä¸‰æ¡è®°å½• phone åˆ— å’Œ age åˆ—æ˜¯ NULL å€¼ï¼Œæ‰€ä»¥ï¼Œå¯¹äºç¬¬ä¸‰æ¡æ•°æ®ï¼ŒNULL å€¼åˆ—è¡¨ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ 0x06ã€‚</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459751962.png" alt="1745459751962"></p>
<p>æˆ‘ä»¬æŠŠä¸‰æ¡è®°å½•çš„ NULL å€¼åˆ—è¡¨éƒ½å¡«å……å®Œæ¯•åï¼Œå®ƒä»¬çš„è¡Œæ ¼å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459765680.png" alt="1745459765680"></p>
<blockquote>
<p>æ¯ä¸ªæ•°æ®åº“è¡¨çš„è¡Œæ ¼å¼éƒ½æœ‰ã€ŒNULL å€¼åˆ—è¡¨ã€å—ï¼Ÿ</p>
</blockquote>
<p>NULL å€¼åˆ—è¡¨ä¹Ÿä¸æ˜¯å¿…é¡»çš„ã€‚</p>
<p><strong>å½“æ•°æ®è¡¨çš„å­—æ®µéƒ½å®šä¹‰æˆ NOT NULL çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¡¨é‡Œçš„è¡Œæ ¼å¼å°±ä¸ä¼šæœ‰ NULL å€¼åˆ—è¡¨äº†</strong>ã€‚</p>
<p>æ‰€ä»¥åœ¨è®¾è®¡æ•°æ®åº“è¡¨çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½æ˜¯å»ºè®®å°†å­—æ®µè®¾ç½®ä¸º NOT NULLï¼Œè¿™æ ·å¯ä»¥è‡³å°‘èŠ‚çœ 1 å­—èŠ‚çš„ç©ºé—´ï¼ˆNULL å€¼åˆ—è¡¨è‡³å°‘å ç”¨ 1 å­—èŠ‚ç©ºé—´ï¼‰ã€‚</p>
<blockquote>
<p>ã€ŒNULL å€¼åˆ—è¡¨ã€æ˜¯å›ºå®š 1 å­—èŠ‚ç©ºé—´å—ï¼Ÿå¦‚æœè¿™æ ·çš„è¯ï¼Œä¸€æ¡è®°å½•æœ‰ 9 ä¸ªå­—æ®µå€¼éƒ½æ˜¯ NULLï¼Œè¿™æ—¶å€™æ€ä¹ˆè¡¨ç¤ºï¼Ÿ</p>
</blockquote>
<p>ã€ŒNULL å€¼åˆ—è¡¨ã€çš„ç©ºé—´ä¸æ˜¯å›ºå®š 1 å­—èŠ‚çš„ã€‚</p>
<p>å½“ä¸€æ¡è®°å½•æœ‰ 9 ä¸ªå­—æ®µå€¼éƒ½æ˜¯ NULLï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»º 2 å­—èŠ‚ç©ºé—´çš„ã€ŒNULL å€¼åˆ—è¡¨ã€ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<h4 id="3-è®°å½•å¤´ä¿¡æ¯">3. è®°å½•å¤´ä¿¡æ¯</h4>
<p>è®°å½•å¤´ä¿¡æ¯ä¸­åŒ…å«çš„å†…å®¹å¾ˆå¤šï¼Œæˆ‘å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œè¿™é‡Œè¯´å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ï¼š</p>
<ul>
<li>delete_maskï¼šæ ‡è¯†æ­¤æ¡æ•°æ®æ˜¯å¦è¢«åˆ é™¤ã€‚ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬æ‰§è¡Œ detele åˆ é™¤è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šçœŸæ­£çš„åˆ é™¤è®°å½•ï¼Œåªæ˜¯å°†è¿™ä¸ªè®°å½•çš„ delete_mask æ ‡è®°ä¸º 1ã€‚</li>
<li>next_recordï¼šä¸‹ä¸€æ¡è®°å½•çš„ä½ç½®ã€‚ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œè®°å½•ä¸è®°å½•ä¹‹é—´æ˜¯é€šè¿‡é“¾è¡¨ç»„ç»‡çš„ã€‚åœ¨å‰é¢æˆ‘ä¹Ÿæåˆ°äº†ï¼ŒæŒ‡å‘çš„æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„ã€Œè®°å½•å¤´ä¿¡æ¯ã€å’Œã€ŒçœŸå®æ•°æ®ã€ä¹‹é—´çš„ä½ç½®ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‘å·¦è¯»å°±æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å°±æ˜¯çœŸå®æ•°æ®ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</li>
<li>record_typeï¼šè¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ0 è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ1 è¡¨ç¤º B+æ ‘éå¶å­èŠ‚ç‚¹è®°å½•ï¼Œ2 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ3 è¡¨ç¤ºæœ€å¤§è®°å½•</li>
</ul>
<h3 id="è®°å½•çš„çœŸå®æ•°æ®">è®°å½•çš„çœŸå®æ•°æ®</h3>
<p>è®°å½•çœŸå®æ•°æ®éƒ¨åˆ†é™¤äº†æˆ‘ä»¬å®šä¹‰çš„å­—æ®µï¼Œè¿˜æœ‰ä¸‰ä¸ªéšè—å­—æ®µï¼Œåˆ†åˆ«ä¸ºï¼šrow_idã€trx_idã€roll_pointerï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸‰ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆã€‚</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745459796350.png" alt="1745459796350"></p>
<ul>
<li>row_id</li>
</ul>
<p>å¦‚æœæˆ‘ä»¬å»ºè¡¨çš„æ—¶å€™æŒ‡å®šäº†ä¸»é”®æˆ–è€…å”¯ä¸€çº¦æŸåˆ—ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰ row_id éšè—å­—æ®µäº†ã€‚å¦‚æœæ—¢æ²¡æœ‰æŒ‡å®šä¸»é”®ï¼Œåˆæ²¡æœ‰å”¯ä¸€çº¦æŸï¼Œé‚£ä¹ˆ InnoDB å°±ä¼šä¸ºè®°å½•æ·»åŠ  row_id éšè—å­—æ®µã€‚row_id ä¸æ˜¯å¿…éœ€çš„ï¼Œå ç”¨ 6 ä¸ªå­—èŠ‚ã€‚</p>
<ul>
<li>trx_id</li>
</ul>
<p>äº‹åŠ¡ idï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°æ®æ˜¯ç”±å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ã€‚trx_id æ˜¯å¿…éœ€çš„ï¼Œå ç”¨ 6 ä¸ªå­—èŠ‚ã€‚</p>
<ul>
<li>roll_pointer</li>
</ul>
<p>è¿™æ¡è®°å½•ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æŒ‡é’ˆã€‚roll_pointer æ˜¯å¿…éœ€çš„ï¼Œå ç”¨ 7 ä¸ªå­—èŠ‚ã€‚</p>
<p>å¦‚æœä½ ç†Ÿæ‚‰ MVCC æœºåˆ¶ï¼Œä½ åº”è¯¥å°±æ¸…æ¥š trx_id å’Œ roll_pointer çš„ä½œç”¨äº†ï¼Œå¦‚æœä½ è¿˜ä¸çŸ¥é“ MVCC æœºåˆ¶ï¼Œå¯ä»¥çœ‹å®Œ<a href="/2025/05/06/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E4%BA%8B%E5%8A%A1/2025-05-06-MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">è¿™ç¯‡æ–‡ç« </a>ï¼Œä¸€å®šè¦æŒæ¡ï¼Œé¢è¯•ä¹Ÿå¾ˆç»å¸¸é—® MVCC æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<blockquote>
<p>Mysql ä¸­è§„å®šï¼Œ<strong>é™¤äº† <code>Text</code>ã€<code>Blob</code>ç±»å‹ï¼Œå…¶ä»–ç±»å‹å…¶ä»–æ‰€æœ‰çš„åˆ—ï¼ˆä¸åŒ…æ‹¬éšè—åˆ—å’Œè®°å½•å¤´ä¿¡æ¯ï¼‰å ç”¨çš„å­—èŠ‚é•¿åº¦åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡ 65535 ä¸ªå­—èŠ‚</strong>ï¼Œè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œ65535 æ˜¯ <code>&lt;font color=&quot;red&quot;&gt;</code>ä¸€è¡Œ <code>&lt;/font&gt;</code>çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåˆ—çš„æœ€å¤§å­—èŠ‚æ•°ã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ªå­—æ®µçš„è¯ï¼Œè¦ä¿è¯æ‰€æœ‰å­—æ®µçš„é•¿åº¦ + å˜é•¿å­—æ®µå­—èŠ‚æ•°åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° + NULL å€¼åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° &lt;= 65535ã€‚</p>
<p><img src="/2025/04/22/%E5%85%AB%E8%82%A1%E6%96%87/MYSQL/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/1745466102232.png" alt="1745466102232"></p>
</blockquote>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>MySQL</category>
        <category>å­˜å‚¨åŸç†</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>MySQL</tag>
        <tag>è®°å½•å­˜å‚¨æ–¹å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 142 - ç¯å½¢é“¾è¡¨ II (Linked List Cycle II)</title>
    <url>/2025/04/22/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-142-Linked-List-Cycle-II/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code>ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› <code>null</code>ã€‚</p>
<p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° <code>pos</code> æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ <code>pos</code> æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼š<code>pos</code> ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p>
<p><strong>ä¸å…è®¸ä¿®æ”¹é“¾è¡¨</strong>ã€‚</p>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1</span><br><span class="line">è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º 1 çš„é“¾è¡¨èŠ‚ç‚¹</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>
<p>é“¾è¡¨å¯è§†åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3 â†’ 2 â†’ 0 â†’ -4</span><br><span class="line">    â†‘     â†“</span><br><span class="line">    â† â† â† â†</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,2], pos = 0</span><br><span class="line">è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º 0 çš„é“¾è¡¨èŠ‚ç‚¹</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>
<p>é“¾è¡¨å¯è§†åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 â†’ 2</span><br><span class="line">â†‘   â†“</span><br><span class="line">â† â† â†</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1], pos = -1</span><br><span class="line">è¾“å‡ºï¼šè¿”å› null</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</span><br></pre></td></tr></table></figure>
<p>é“¾è¡¨å¯è§†åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 â†’ null</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶">çº¦æŸæ¡ä»¶</h3>
<ul>
<li>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´åœ¨èŒƒå›´ [0, 10^4] å†…</li>
<li>-10^5 &lt;= Node.val &lt;= 10^5</li>
<li>pos çš„å€¼ä¸º -1 æˆ–è€…é“¾è¡¨ä¸­çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•</li>
</ul>
<h3 id="è¿›é˜¶">è¿›é˜¶</h3>
<p>ä½ æ˜¯å¦å¯ä»¥ä½¿ç”¨ O(1) ç©ºé—´è§£å†³æ­¤é¢˜ï¼Ÿ</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šå¿«æ…¢æŒ‡é’ˆï¼ˆFloyd-åˆ¤åœˆç®—æ³•ï¼‰">æ–¹æ³•ä¸€ï¼šå¿«æ…¢æŒ‡é’ˆï¼ˆFloyd åˆ¤åœˆç®—æ³•ï¼‰</h3>
<p>æœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯æ˜¯ä½¿ç”¨<strong>å¿«æ…¢æŒ‡é’ˆ</strong>ï¼ˆä¹Ÿç§°ä¸º Floyd åˆ¤åœˆç®—æ³•æˆ–é¾Ÿå…”èµ›è·‘ç®—æ³•ï¼‰æ¥è§£å†³ã€‚è¿™æ˜¯ä¸€ç§<strong>æ£€æµ‹é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨ç¯</strong>å¹¶æ‰¾åˆ°ç¯å…¥å£ç‚¹çš„ç»å…¸ç®—æ³•ã€‚</p>
<h4 id="ç®—æ³•åˆ†æå’Œæ•°å­¦è¯æ˜">ç®—æ³•åˆ†æå’Œæ•°å­¦è¯æ˜</h4>
<p>è¿™ä¸ªç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ£€æµ‹ç¯çš„å­˜åœ¨</strong>ï¼šä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œå¦‚æœå®ƒä»¬ç›¸é‡ï¼Œåˆ™å­˜åœ¨ç¯</li>
<li><strong>å¯»æ‰¾ç¯çš„å…¥å£</strong>ï¼šé€šè¿‡æ•°å­¦å…³ç³»ç¡®å®šç¯çš„å…¥å£ç‚¹</li>
</ol>
<p>è®©æˆ‘ä»¬è¯¦ç»†è§£æè¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶è¿›è¡Œæ•°å­¦æ¨å¯¼ï¼š</p>
<p><strong>ç¬¬ä¸€é˜¶æ®µï¼šæ£€æµ‹ç¯çš„å­˜åœ¨</strong></p>
<ol>
<li>è®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆ <code>slow</code> å’Œ <code>fast</code>ï¼Œåˆå§‹æ—¶éƒ½æŒ‡å‘é“¾è¡¨å¤´èŠ‚ç‚¹ <code>head</code></li>
<li><code>slow</code> æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ 1 æ­¥ï¼Œ<code>fast</code> æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ 2 æ­¥</li>
<li>å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆæœ€ç»ˆä¼šåœ¨ç¯ä¸­æŸä¸ªèŠ‚ç‚¹ç›¸é‡</li>
<li>å¦‚æœ <code>fast</code> æŒ‡é’ˆåˆ°è¾¾äº†é“¾è¡¨æœ«å°¾ï¼ˆå³ <code>fast</code> æˆ– <code>fast.next</code> ä¸º <code>null</code>ï¼‰ï¼Œåˆ™é“¾è¡¨ä¸å­˜åœ¨ç¯</li>
</ol>
<p><strong>ç¬¬äºŒé˜¶æ®µï¼šå¯»æ‰¾ç¯çš„å…¥å£</strong></p>
<p>æ•°å­¦æ¨å¯¼æ˜¯è¿™ä¸ªç®—æ³•çš„å…³é”®ã€‚å‡è®¾ï¼š</p>
<ul>
<li>é“¾è¡¨å¤´åˆ°ç¯å…¥å£ç‚¹çš„è·ç¦»ä¸º <code>a</code> æ­¥</li>
<li>ç¯å…¥å£ç‚¹åˆ°ç›¸é‡ç‚¹çš„è·ç¦»ä¸º <code>b</code> æ­¥</li>
<li>ç›¸é‡ç‚¹å›åˆ°ç¯å…¥å£ç‚¹çš„è·ç¦»ä¸º <code>c</code> æ­¥</li>
</ul>
<p>é‚£ä¹ˆç¯çš„æ€»é•¿åº¦ä¸º <code>b + c</code> æ­¥ã€‚</p>
<h4 id="ç¯å½¢é“¾è¡¨ç¤ºæ„å›¾">ç¯å½¢é“¾è¡¨ç¤ºæ„å›¾</h4>
<h5 id="Mermaid-å›¾ç¤º">Mermaid å›¾ç¤º</h5>
<pre class="mermaid">graph LR
    Head((Head)) --&gt; A((A))
    A --&gt; B((B))
    B --&gt; C((C))
    C --&gt; D((D))
    D --&gt; E((E))
    E --&gt; F((F))
    F --&gt; C
  
    style C fill:#f96,stroke:#333
    style F fill:#69f,stroke:#333
  
    Head -.-&gt; |&quot;é“¾è¡¨å¤´&quot;|A
    C -.-&gt; |&quot;ç¯å…¥å£ç‚¹&quot;|C
    F -.-&gt; |&quot;ç›¸é‡ç‚¹&quot;|F
  
    A -.-&gt; |&quot;è·ç¦» a&quot;|C
    C -.-&gt; |&quot;è·ç¦» b&quot;|F
    F -.-&gt; |&quot;è·ç¦» c&quot;|C</pre>
<h5 id="çº¯æ–‡æœ¬å›¾ç¤º">çº¯æ–‡æœ¬å›¾ç¤º</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">                 ç¯å…¥å£</span><br><span class="line">                    â†“</span><br><span class="line">head â†’ A â†’ B â†’ C â†’ D â†’ E</span><br><span class="line">                â†‘       â†“</span><br><span class="line">                â†‘       â†“</span><br><span class="line">                â†‘       â†“</span><br><span class="line">                G â† F â† F â† ç›¸é‡ç‚¹</span><br><span class="line">              </span><br><span class="line">è·ç¦»æ ‡è®°:</span><br><span class="line">headåˆ°ç¯å…¥å£Cçš„è·ç¦»: a</span><br><span class="line">ç¯å…¥å£Cåˆ°ç›¸é‡ç‚¹Fçš„è·ç¦»: b</span><br><span class="line">ç›¸é‡ç‚¹Fè¿”å›ç¯å…¥å£Cçš„è·ç¦»: c</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ç§è¡¨ç¤ºæ–¹å¼:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">      a         b</span><br><span class="line">    +---+     +---+</span><br><span class="line">    â†“   â†“     â†“   â†“</span><br><span class="line">head â†’ â†’ â†’ â†’ â†’ â†’ â†’ +</span><br><span class="line">            â†‘     â†“</span><br><span class="line">            â†‘     â†“</span><br><span class="line">            â†‘     â†“</span><br><span class="line">            + â† â† +</span><br><span class="line">            â†‘</span><br><span class="line">            +</span><br><span class="line">            c</span><br></pre></td></tr></table></figure>
<p>å½“ <code>slow</code> å’Œ <code>fast</code> æŒ‡é’ˆç›¸é‡æ—¶ï¼š</p>
<ul>
<li><code>slow</code> èµ°äº† <code>a + b</code> æ­¥</li>
<li><code>fast</code> èµ°äº† <code>a + b + n(b + c)</code> æ­¥ï¼Œå…¶ä¸­ <code>n</code> æ˜¯ <code>fast</code> æŒ‡é’ˆåœ¨ç¯ä¸­ç»•çš„åœˆæ•°</li>
</ul>
<p>ç”±äº <code>fast</code> æŒ‡é’ˆèµ°çš„æ­¥æ•°æ˜¯ <code>slow</code> æŒ‡é’ˆçš„ 2 å€ï¼Œæ‰€ä»¥æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a + b + n(b + c) = 2(a + b)</span><br></pre></td></tr></table></figure>
<p>åŒ–ç®€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a + b + n(b + c) = 2a + 2b</span><br><span class="line">n(b + c) = a + b</span><br><span class="line">a = n(b + c) - b = (n-1)(b + c) + c</span><br></pre></td></tr></table></figure>
<p>å¯¹äº n=1 çš„æƒ…å†µï¼ˆå³ fast æŒ‡é’ˆç»•ç¯ä¸€åœˆå°±ä¸ slow ç›¸é‡ï¼‰ï¼Œæˆ‘ä»¬æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a = c</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç»“è®ºéå¸¸é‡è¦ï¼š<strong>ä»é“¾è¡¨å¤´åˆ°ç¯å…¥å£çš„è·ç¦»ï¼Œç­‰äºä»ç›¸é‡ç‚¹ç»§ç»­å‰è¿›åˆ°ç¯å…¥å£çš„è·ç¦»</strong>ã€‚</p>
<p>åŸºäºè¿™ä¸ªå‘ç°ï¼Œæˆ‘ä»¬çš„ç®—æ³•ç¬¬äºŒé˜¶æ®µä¸ºï¼š</p>
<ol>
<li>å°† <code>fast</code> æŒ‡é’ˆé‡æ–°æŒ‡å‘é“¾è¡¨å¤´èŠ‚ç‚¹</li>
<li>ä¿æŒ <code>slow</code> æŒ‡é’ˆåœ¨ç›¸é‡ç‚¹</li>
<li>è®©ä¸¤ä¸ªæŒ‡é’ˆæ¯æ¬¡éƒ½ç§»åŠ¨ 1 æ­¥</li>
<li>å®ƒä»¬æœ€ç»ˆä¼šåœ¨ç¯çš„å…¥å£ç‚¹ç›¸é‡</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„å·§å¦™ä¹‹å¤„åœ¨äºæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ç¯çš„é•¿åº¦æˆ–é“¾è¡¨çš„é•¿åº¦ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–çš„ç©ºé—´æ¥è®°å½•å·²è®¿é—®è¿‡çš„èŠ‚ç‚¹ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">detectCycle</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// é˜¶æ®µä¸€ï¼šæ£€æµ‹ç¯çš„å­˜åœ¨</span></span><br><span class="line">    slow, fast := head, head</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœåˆ°è¾¾é“¾è¡¨æœ«å°¾ï¼Œåˆ™æ— ç¯</span></span><br><span class="line">        <span class="keyword">if</span> fast == <span class="literal">nil</span> || fast.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¿«æŒ‡é’ˆç§»åŠ¨ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆç§»åŠ¨ä¸€æ­¥</span></span><br><span class="line">        fast = fast.Next.Next</span><br><span class="line">        slow = slow.Next</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¦‚æœä¸¤æŒ‡é’ˆç›¸é‡ï¼Œåˆ™å­˜åœ¨ç¯</span></span><br><span class="line">        <span class="keyword">if</span> slow == fast &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// é˜¶æ®µäºŒï¼šå¯»æ‰¾ç¯çš„å…¥å£</span></span><br><span class="line">    <span class="comment">// é‡ç½®å¿«æŒ‡é’ˆåˆ°é“¾è¡¨å¤´ï¼Œæ…¢æŒ‡é’ˆä¿æŒåœ¨ç›¸é‡ç‚¹</span></span><br><span class="line">    fast = head</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä¸¤ä¸ªæŒ‡é’ˆæ¯æ¬¡éƒ½ç§»åŠ¨ä¸€æ­¥</span></span><br><span class="line">    <span class="keyword">for</span> slow != fast &#123;</span><br><span class="line">        slow = slow.Next</span><br><span class="line">        fast = fast.Next</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å½“ä¸¤æŒ‡é’ˆå†æ¬¡ç›¸é‡æ—¶ï¼Œå°±æ˜¯ç¯çš„å…¥å£ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> fast</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œéœ€è¦éå†æ•´ä¸ªé“¾è¡¨ä¸€æ¬¡æ‰èƒ½ç¡®å®šæ˜¯å¦æœ‰ç¯ï¼Œç„¶åå†éå†éƒ¨åˆ†é“¾è¡¨æ‰¾åˆ°ç¯çš„å…¥å£ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)ï¼Œåªä½¿ç”¨äº†ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸éœ€è¦é¢å¤–çš„ç©ºé—´ã€‚</li>
</ul>
<h2 id="ä¸åŒæ–¹æ³•æ¯”è¾ƒ">ä¸åŒæ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å¿«æ…¢æŒ‡é’ˆæ³•</th>
<th>å“ˆå¸Œè¡¨æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç©ºé—´æ•ˆç‡é«˜</td>
<td>å®ç°ç®€å•ç›´è§‚</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>æ•°å­¦åˆ†æè¾ƒå¤æ‚</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>Floyd åˆ¤åœˆç®—æ³•</strong>æ˜¯è§£å†³é“¾è¡¨ç¯æ£€æµ‹é—®é¢˜çš„ç»å…¸ç®—æ³•ï¼Œå®ƒä¸ä»…å¯ä»¥æ£€æµ‹ç¯çš„å­˜åœ¨ï¼Œè¿˜èƒ½æ‰¾åˆ°ç¯çš„å…¥å£ç‚¹ã€‚</li>
<li>è¯¥ç®—æ³•çš„æ•°å­¦æ¨å¯¼å¾ˆå·§å¦™ï¼šä»é“¾è¡¨å¤´åˆ°ç¯å…¥å£çš„è·ç¦»ç­‰äºä»ç›¸é‡ç‚¹ç»§ç»­å‰è¿›åˆ°ç¯å…¥å£çš„è·ç¦»ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥ç”¨ O(1) çš„ç©ºé—´å¤æ‚åº¦è§£å†³æ­¤é—®é¢˜ï¼Œè¿™æ¯”ä½¿ç”¨å“ˆå¸Œè¡¨éœ€è¦ O(n) ç©ºé—´çš„æ–¹æ³•æ›´åŠ é«˜æ•ˆã€‚</li>
<li>è¿™ç§åŒæŒ‡é’ˆçš„æŠ€å·§åœ¨é“¾è¡¨é—®é¢˜ä¸­éå¸¸å¸¸è§ï¼ŒæŒæ¡è¿™ç§æ€æƒ³å¯ä»¥å¸®åŠ©è§£å†³è®¸å¤šç±»ä¼¼é—®é¢˜ï¼Œå¦‚å¯»æ‰¾é“¾è¡¨ä¸­ç‚¹ã€æ£€æµ‹ç¯ã€å¯»æ‰¾å€’æ•°ç¬¬ k ä¸ªèŠ‚ç‚¹ç­‰ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>é“¾è¡¨</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 234 - å›æ–‡é“¾è¡¨ï¼ˆPalindrome Linked Listï¼‰</title>
    <url>/2025/04/21/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-234-Palindrome-Linked-List/</url>
    <content><![CDATA[<h2 id="Problem-Description">Problem Description</h2>
<p>ç»™ä½ ä¸€ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code>ï¼Œè¯·ä½ åˆ¤æ–­è¯¥é“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ã€‚å¦‚æœæ˜¯ï¼Œè¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</p>
<p>å›æ–‡é“¾è¡¨æŒ‡çš„æ˜¯ä»å‰å¾€åè¯»å’Œä»åå¾€å‰è¯»æ˜¯ä¸€æ ·çš„é“¾è¡¨ã€‚ä¾‹å¦‚ï¼Œ<code>1-&gt;2-&gt;2-&gt;1</code> æ˜¯å›æ–‡é“¾è¡¨ï¼Œè€Œ <code>1-&gt;2</code> ä¸æ˜¯å›æ–‡é“¾è¡¨ã€‚</p>
<h3 id="Examples">Examples</h3>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,2,2,1]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure>
<p>å¯è§†åŒ–è¡¨ç¤º:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 -&gt; 2 -&gt; 2 -&gt; 1</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,2]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure>
<p>å¯è§†åŒ–è¡¨ç¤º:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 -&gt; 2</span><br></pre></td></tr></table></figure>
<h3 id="Constraints">Constraints</h3>
<ul>
<li>é“¾è¡¨ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [1, 10^5] å†…</li>
<li>0 &lt;= Node.val &lt;= 9</li>
</ul>
<p><strong>è¿›é˜¶</strong>ï¼šä½ èƒ½å¦ç”¨ O(n) æ—¶é—´å¤æ‚åº¦å’Œ O(1) ç©ºé—´å¤æ‚åº¦è§£å†³æ­¤é¢˜ï¼Ÿ</p>
<h2 id="Solution-Approach">Solution Approach</h2>
<p>å¯¹äºå›æ–‡é“¾è¡¨çš„åˆ¤æ–­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ol>
<li>é“¾è¡¨ä¸èƒ½åƒæ•°ç»„é‚£æ ·éšæœºè®¿é—®ï¼Œæ— æ³•ç›´æ¥ä»ä¸¤ç«¯åŒæ—¶å‘ä¸­é—´æ¯”è¾ƒ</li>
<li>ç›´è§‚æ€è·¯æ˜¯å°†é“¾è¡¨è½¬ä¸ºæ•°ç»„ï¼Œä½†è¿™éœ€è¦ O(n) é¢å¤–ç©ºé—´</li>
<li>æœ€ä¼˜è§£æ³•éœ€è¦æ‰¾åˆ°é“¾è¡¨ä¸­ç‚¹ï¼Œåè½¬ååŠéƒ¨åˆ†ï¼Œç„¶åæ¯”è¾ƒä¸¤åŠéƒ¨åˆ†</li>
</ol>
<p>ä»¥ä¸‹æˆ‘ä¼šä»‹ç»å¤šç§è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ï¼Œä»ç®€å•åˆ°ä¼˜åŒ–é€æ­¥è®²è§£ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šè½¬æ¢ä¸ºæ•°ç»„">æ–¹æ³•ä¸€ï¼šè½¬æ¢ä¸ºæ•°ç»„</h3>
<p>æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯å°†é“¾è¡¨èŠ‚ç‚¹å€¼å¤åˆ¶åˆ°æ•°ç»„ä¸­ï¼Œç„¶åä½¿ç”¨åŒæŒ‡é’ˆåˆ¤æ–­æ•°ç»„æ˜¯å¦å›æ–‡ã€‚</p>
<h4 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h4>
<ol>
<li>éå†é“¾è¡¨ï¼Œå°†æ‰€æœ‰èŠ‚ç‚¹å€¼å­˜å…¥æ•°ç»„</li>
<li>ä½¿ç”¨åŒæŒ‡é’ˆä»æ•°ç»„ä¸¤ç«¯å‘ä¸­é—´ç§»åŠ¨å¹¶æ¯”è¾ƒ</li>
</ol>
<h4 id="ä»£ç å®ç°">ä»£ç å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isPalindrome</span><span class="params">(head *ListNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// å°†é“¾è¡¨å€¼å¤åˆ¶åˆ°æ•°ç»„</span></span><br><span class="line">    vals := []<span class="type">int</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> node := head; node != <span class="literal">nil</span>; node = node.Next &#123;</span><br><span class="line">        vals = <span class="built_in">append</span>(vals, node.Val)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒæŒ‡é’ˆåˆ¤æ–­æ•°ç»„æ˜¯å¦å›æ–‡</span></span><br><span class="line">    <span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="built_in">len</span>(vals)<span class="number">-1</span>; i &lt; j; i, j = i+<span class="number">1</span>, j<span class="number">-1</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> vals[i] != vals[j] &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨æ ˆ">æ–¹æ³•äºŒï¼šä½¿ç”¨æ ˆ</h3>
<p>åˆ©ç”¨æ ˆçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†å‰åŠéƒ¨åˆ†èŠ‚ç‚¹å€¼å…¥æ ˆï¼Œç„¶åä¸ååŠéƒ¨åˆ†æ¯”è¾ƒã€‚</p>
<h4 id="å®ç°ç»†èŠ‚-2">å®ç°ç»†èŠ‚</h4>
<ol>
<li>ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨ä¸­ç‚¹</li>
<li>å°†å‰åŠéƒ¨åˆ†èŠ‚ç‚¹å€¼å…¥æ ˆ</li>
<li>æ¯”è¾ƒæ ˆä¸­å…ƒç´ ä¸ååŠéƒ¨åˆ†èŠ‚ç‚¹å€¼</li>
</ol>
<h4 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isPalindrome</span><span class="params">(head *ListNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹</span></span><br><span class="line">    slow, fast := head, head</span><br><span class="line">    stack := []<span class="type">int</span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å°†å‰åŠéƒ¨åˆ†å…¥æ ˆ</span></span><br><span class="line">    <span class="keyword">for</span> fast != <span class="literal">nil</span> &amp;&amp; fast.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">        stack = <span class="built_in">append</span>(stack, slow.Val)</span><br><span class="line">        slow = slow.Next</span><br><span class="line">        fast = fast.Next.Next</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å¦‚æœé“¾è¡¨é•¿åº¦ä¸ºå¥‡æ•°ï¼Œè·³è¿‡ä¸­é—´èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> fast != <span class="literal">nil</span> &#123;</span><br><span class="line">        slow = slow.Next</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ¯”è¾ƒæ ˆé¡¶å…ƒç´ ä¸ååŠéƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">for</span> slow != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(stack) == <span class="number">0</span> || stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] != slow.Val &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">        slow = slow.Next</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šåŸåœ°åè½¬ï¼ˆåŸå§‹å®ç°ï¼‰">æ–¹æ³•ä¸‰ï¼šåŸåœ°åè½¬ï¼ˆåŸå§‹å®ç°ï¼‰</h3>
<p>è¿™æ˜¯ç”¨æˆ·æä¾›çš„åŸå§‹è§£æ³•ï¼Œä½¿ç”¨ O(n) æ—¶é—´å’Œ O(1) ç©ºé—´ã€‚</p>
<h4 id="å®ç°ç»†èŠ‚-3">å®ç°ç»†èŠ‚</h4>
<ol>
<li>ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨ä¸­ç‚¹</li>
<li>åè½¬ååŠéƒ¨åˆ†é“¾è¡¨</li>
<li>æ¯”è¾ƒå‰åŠéƒ¨åˆ†å’Œåè½¬åçš„ååŠéƒ¨åˆ†</li>
</ol>
<h4 id="ä»£ç å®ç°ï¼ˆåŸå§‹ç‰ˆæœ¬ï¼‰">ä»£ç å®ç°ï¼ˆåŸå§‹ç‰ˆæœ¬ï¼‰</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isPalindrome</span><span class="params">(head *ListNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fast, slow := head, head</span><br><span class="line">    <span class="keyword">for</span> fast.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">        fast = fast.Next</span><br><span class="line">        <span class="keyword">if</span> fast.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        slow = slow.Next</span><br><span class="line">        fast = fast.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    head2 := slow.Next</span><br><span class="line">    slow.Next = <span class="literal">nil</span></span><br><span class="line">    head2 = reverseListTmp(head2)</span><br><span class="line"></span><br><span class="line">    cur1, cur2 := head, head2</span><br><span class="line">    <span class="keyword">for</span> cur2 != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> cur1.Val != cur2.Val &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        cur1 = cur1.Next</span><br><span class="line">        cur2 = cur2.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseListTmp</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cur, prev *ListNode</span><br><span class="line">    cur = head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        tmp := cur.Next</span><br><span class="line">        cur.Next = prev</span><br><span class="line">        prev = cur</span><br><span class="line">        cur = tmp</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> prev</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•å››ï¼šä¼˜åŒ–çš„åŸåœ°åè½¬ï¼ˆæœ€ä¼˜è§£ï¼‰">æ–¹æ³•å››ï¼šä¼˜åŒ–çš„åŸåœ°åè½¬ï¼ˆæœ€ä¼˜è§£ï¼‰</h3>
<p>åœ¨åŸå§‹å®ç°çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œä½¿ä»£ç æ›´åŠ å¥å£®å’Œæ˜“è¯»ã€‚</p>
<h4 id="å®ç°ç»†èŠ‚-4">å®ç°ç»†èŠ‚</h4>
<ol>
<li>æ›´æ¸…æ™°åœ°å¤„ç†è¾¹ç•Œæƒ…å†µ</li>
<li>ç®€åŒ–æ‰¾ä¸­ç‚¹çš„é€»è¾‘</li>
<li>æ˜ç¡®åŒºåˆ†å¥‡å¶é•¿åº¦é“¾è¡¨çš„å¤„ç†</li>
<li>æ¨¡å—åŒ–åŠŸèƒ½ï¼Œæé«˜ä»£ç å¯è¯»æ€§</li>
<li>æä¾›å¯é€‰çš„é“¾è¡¨æ¢å¤åŠŸèƒ½</li>
</ol>
<h4 id="ä»£ç å®ç°ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰">ä»£ç å®ç°ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ListNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    Val <span class="type">int</span></span><br><span class="line">    Next *ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isPalindrome</span><span class="params">(head *ListNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†è¾¹ç•Œæƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾é“¾è¡¨ä¸­ç‚¹</span></span><br><span class="line">    fast, slow := head, head</span><br><span class="line">    <span class="keyword">for</span> fast != <span class="literal">nil</span> &amp;&amp; fast.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">        slow = slow.Next</span><br><span class="line">        fast = fast.Next.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å¥‡æ•°é•¿åº¦é“¾è¡¨çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">var</span> secondHalf *ListNode</span><br><span class="line">    <span class="keyword">if</span> fast == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// å¶æ•°é•¿åº¦</span></span><br><span class="line">        secondHalf = slow</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¥‡æ•°é•¿åº¦ï¼Œä¸­é—´èŠ‚ç‚¹ä¸å‚ä¸æ¯”è¾ƒ</span></span><br><span class="line">        secondHalf = slow.Next</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ–­å¼€é“¾è¡¨</span></span><br><span class="line">    firstHalfEnd := slow</span><br><span class="line">    <span class="keyword">if</span> fast == <span class="literal">nil</span> &#123;</span><br><span class="line">        firstHalfEnd = findPredecessor(head, slow)</span><br><span class="line">    &#125;</span><br><span class="line">    firstHalfEnd.Next = <span class="literal">nil</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// åè½¬ååŠéƒ¨åˆ†</span></span><br><span class="line">    secondHalf = reverseList(secondHalf)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯”è¾ƒä¸¤åŠéƒ¨åˆ†</span></span><br><span class="line">    result := compareHalves(head, secondHalf)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å¯é€‰ï¼šæ¢å¤é“¾è¡¨ç»“æ„</span></span><br><span class="line">    <span class="comment">// firstHalfEnd.Next = reverseList(secondHalf)</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¾åˆ°å‰é©±èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findPredecessor</span><span class="params">(head, target *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="keyword">if</span> head == target &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    curr := head</span><br><span class="line">    <span class="keyword">for</span> curr != <span class="literal">nil</span> &amp;&amp; curr.Next != target &#123;</span><br><span class="line">        curr = curr.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> curr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯”è¾ƒä¸¤ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compareHalves</span><span class="params">(first, second *ListNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> first != <span class="literal">nil</span> &amp;&amp; second != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> first.Val != second.Val &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        first = first.Next</span><br><span class="line">        second = second.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åè½¬é“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseList</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="keyword">var</span> prev *ListNode</span><br><span class="line">    curr := head</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> curr != <span class="literal">nil</span> &#123;</span><br><span class="line">        next := curr.Next</span><br><span class="line">        curr.Next = prev</span><br><span class="line">        prev = curr</span><br><span class="line">        curr = next</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> prev</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äº”ï¼šé€’å½’è§£æ³•">æ–¹æ³•äº”ï¼šé€’å½’è§£æ³•</h3>
<p>é€’å½’æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†éœ€è¦ O(n) çš„æ ˆç©ºé—´ã€‚</p>
<h4 id="å®ç°ç»†èŠ‚-5">å®ç°ç»†èŠ‚</h4>
<ol>
<li>ä½¿ç”¨é€’å½’éå†åˆ°é“¾è¡¨æœ«å°¾</li>
<li>å›æº¯æ—¶ï¼Œä¸å‰é¢çš„èŠ‚ç‚¹æ¯”è¾ƒ</li>
</ol>
<h4 id="ä»£ç å®ç°-3">ä»£ç å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isPalindrome</span><span class="params">(head *ListNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    frontPointer := head</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">var</span> recursiveCheck <span class="function"><span class="keyword">func</span><span class="params">(*ListNode)</span></span> <span class="type">bool</span></span><br><span class="line">    recursiveCheck = <span class="function"><span class="keyword">func</span><span class="params">(currentNode *ListNode)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> currentNode != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> !recursiveCheck(currentNode.Next) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> frontPointer.Val != currentNode.Val &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            frontPointer = frontPointer.Next</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> recursiveCheck(head)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Comparison-of-Approaches">Comparison of Approaches</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æ–¹æ³•ä¸€ï¼šæ•°ç»„</th>
<th>æ–¹æ³•äºŒï¼šæ ˆ</th>
<th>æ–¹æ³•ä¸‰ï¼šåŸå§‹åè½¬</th>
<th>æ–¹æ³•å››ï¼šä¼˜åŒ–åè½¬</th>
<th>æ–¹æ³•äº”ï¼šé€’å½’</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(1)</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç®€å•</td>
<td>ç›´è§‚æ˜“æ‡‚</td>
<td>ç©ºé—´æ•ˆç‡é«˜</td>
<td>ä»£ç å¥å£®ï¼Œæ˜“äºç†è§£</td>
<td>ç®€æ´ä¼˜é›…</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>ç©ºé—´å¼€é”€å¤§</td>
<td>ç©ºé—´å¼€é”€å¤§</td>
<td>ä»£ç ç»“æ„ä¸å¤Ÿæ¸…æ™°</td>
<td>ç•¥å¾®å¤æ‚</td>
<td>ä½¿ç”¨äº†éšå¼æ ˆç©ºé—´</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="Complexity-Analysis">Complexity Analysis</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<p>æ‰€æœ‰æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n)ï¼Œå…¶ä¸­ n æ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦è‡³å°‘éå†ä¸€æ¬¡é“¾è¡¨ã€‚</p>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<ul>
<li>æ–¹æ³•ä¸€ï¼ˆæ•°ç»„ï¼‰ï¼šéœ€è¦ O(n) é¢å¤–ç©ºé—´å­˜å‚¨æ•°ç»„</li>
<li>æ–¹æ³•äºŒï¼ˆæ ˆï¼‰ï¼šéœ€è¦ O(n) é¢å¤–ç©ºé—´å­˜å‚¨æ ˆ</li>
<li>æ–¹æ³•ä¸‰å’Œæ–¹æ³•å››ï¼ˆåè½¬ï¼‰ï¼šåªéœ€è¦å‡ ä¸ªæŒ‡é’ˆå˜é‡ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)</li>
<li>æ–¹æ³•äº”ï¼ˆé€’å½’ï¼‰ï¼šç”±äºé€’å½’è°ƒç”¨æ ˆï¼Œéœ€è¦ O(n) ç©ºé—´</li>
</ul>
<h2 id="Key-Learnings">Key Learnings</h2>
<ol>
<li><strong>å¿«æ…¢æŒ‡é’ˆ</strong>ï¼šæ‰¾é“¾è¡¨ä¸­ç‚¹çš„æœ‰æ•ˆæŠ€æœ¯ï¼Œå¯¹äºé“¾è¡¨æ“ä½œå¾ˆå¸¸ç”¨</li>
<li><strong>åŸåœ°åè½¬</strong>ï¼šé“¾è¡¨åè½¬æ˜¯ä¸€ä¸ªé‡è¦çš„åŸºæœ¬æ“ä½œï¼Œå¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´å®Œæˆ</li>
<li><strong>ç©ºé—´ä¸æ—¶é—´æƒè¡¡</strong>ï¼šæ­¤é¢˜å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ç®—æ³•ä¼˜åŒ–å°†ç©ºé—´å¤æ‚åº¦ä» O(n) é™è‡³ O(1)</li>
<li><strong>ä»£ç æ¨¡å—åŒ–</strong>ï¼šå°†å¤æ‚åŠŸèƒ½æ‹†åˆ†ä¸ºå¤šä¸ªå‡½æ•°å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</li>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šé“¾è¡¨æ“ä½œä¸­éœ€è¦ç‰¹åˆ«æ³¨æ„ç©ºé“¾è¡¨ã€å•èŠ‚ç‚¹é“¾è¡¨ç­‰è¾¹ç•Œæ¡ä»¶</li>
</ol>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ–¹æ³•å››ï¼ˆä¼˜åŒ–çš„åŸåœ°åè½¬ï¼‰æ˜¯æœ€æ¨èçš„è§£æ³•ï¼Œå› ä¸ºå®ƒæ—¢æ»¡è¶³äº†è¿›é˜¶è¦æ±‚çš„ O(1) ç©ºé—´å¤æ‚åº¦ï¼Œåˆä¿æŒäº†ä»£ç çš„æ¸…æ™°æ€§å’Œå¥å£®æ€§ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé“¾è¡¨ç»“æ„åœ¨æ“ä½œåéœ€è¦ä¿æŒä¸å˜ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ é“¾è¡¨æ¢å¤æ­¥éª¤ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>Easy</tag>
        <tag>Hot100</tag>
        <tag>é“¾è¡¨</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 206 - åè½¬é“¾è¡¨ï¼ˆReverse Linked Listï¼‰</title>
    <url>/2025/04/21/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-206-Reverse-Linked-List/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code>ï¼Œè¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼š">ç¤ºä¾‹ 1ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,2,3,4,5]</span><br><span class="line">è¾“å‡ºï¼š[5,4,3,2,1]</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2ï¼š">ç¤ºä¾‹ 2ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,2]</span><br><span class="line">è¾“å‡ºï¼š[2,1]</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-3ï¼š">ç¤ºä¾‹ 3ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure>
<h3 id="çº¦æŸæ¡ä»¶ï¼š">çº¦æŸæ¡ä»¶ï¼š</h3>
<ul>
<li>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ [0, 5000]</li>
<li>-5000 &lt;= Node.val &lt;= 5000</li>
</ul>
<p><strong>è¿›é˜¶</strong>ï¼šé“¾è¡¨å¯ä»¥é€‰ç”¨è¿­ä»£æˆ–é€’å½’æ–¹å¼å®Œæˆåè½¬ã€‚ä½ èƒ½å¦ç”¨ä¸¤ç§æ–¹æ³•è§£å†³è¿™é“é¢˜ï¼Ÿ</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>åè½¬é“¾è¡¨æ˜¯ä¸€ä¸ªç»å…¸é—®é¢˜ï¼Œæœ‰ä¸¤ç§ä¸»è¦çš„è§£æ³•ï¼šè¿­ä»£æ³•å’Œé€’å½’æ³•ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šè¿­ä»£æ³•">æ–¹æ³•ä¸€ï¼šè¿­ä»£æ³•</h3>
<p>è¿­ä»£æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šéå†é“¾è¡¨ï¼Œå°†å½“å‰èŠ‚ç‚¹çš„ <code>next</code> æŒ‡é’ˆæ”¹ä¸ºæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç”±äºå•é“¾è¡¨åªèƒ½ä»å‰å¾€åéå†ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é¢å¤–çš„æŒ‡é’ˆæ¥è®°å½•å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p>åŸºæœ¬æ­¥éª¤ï¼š</p>
<ol>
<li>åˆå§‹åŒ–ä¸‰ä¸ªæŒ‡é’ˆï¼š<code>prev</code>ï¼ˆå‰ä¸€ä¸ªèŠ‚ç‚¹ï¼‰åˆå§‹ä¸º <code>nil</code>ï¼Œ<code>curr</code>ï¼ˆå½“å‰èŠ‚ç‚¹ï¼‰åˆå§‹ä¸º <code>head</code>ï¼Œ<code>next</code>ï¼ˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼‰åœ¨å¾ªç¯ä¸­èµ‹å€¼ã€‚</li>
<li>åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé˜²æ­¢é“¾è¡¨æ–­å¼€åæ— æ³•ç»§ç»­éå†ã€‚</li>
<li>å°†å½“å‰èŠ‚ç‚¹çš„ <code>next</code> æŒ‡é’ˆæŒ‡å‘ <code>prev</code>ã€‚</li>
<li>å°† <code>prev</code> å’Œ <code>curr</code> æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€æ­¥ã€‚</li>
<li>é‡å¤æ­¥éª¤ 2-4ï¼Œç›´åˆ° <code>curr</code> æŒ‡å‘ <code>nil</code>ï¼Œè¡¨ç¤ºå·²ç»éå†å®Œæ•´ä¸ªé“¾è¡¨ã€‚</li>
</ol>
<h3 id="æ–¹æ³•äºŒï¼šé€’å½’æ³•">æ–¹æ³•äºŒï¼šé€’å½’æ³•</h3>
<p>é€’å½’æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå‡è®¾é“¾è¡¨åé¢çš„éƒ¨åˆ†å·²ç»åè½¬å®Œæˆï¼Œæˆ‘ä»¬åªéœ€è¦å¤„ç†å½“å‰èŠ‚ç‚¹å’Œå­é—®é¢˜çš„å…³ç³»ã€‚</p>
<p>åŸºæœ¬æ€è·¯ï¼š</p>
<ol>
<li>ç»ˆæ­¢æ¡ä»¶ï¼šå½“é“¾è¡¨ä¸ºç©ºæˆ–åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œåè½¬åçš„ç»“æœå°±æ˜¯å®ƒæœ¬èº«ï¼Œç›´æ¥è¿”å›ã€‚</li>
<li>é€’å½’è°ƒç”¨ï¼šå¯¹é™¤äº†å¤´èŠ‚ç‚¹ä»¥å¤–çš„å…¶ä»–èŠ‚ç‚¹è¿›è¡Œåè½¬ï¼Œå¹¶å¾—åˆ°æ–°çš„å¤´èŠ‚ç‚¹ï¼ˆåè½¬åé“¾è¡¨çš„å¤´ï¼‰ã€‚</li>
<li>å¤„ç†å½“å‰èŠ‚ç‚¹ï¼šå°†å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ <code>next</code> æŒ‡å‘å½“å‰èŠ‚ç‚¹ï¼Œå¹¶å°†å½“å‰èŠ‚ç‚¹çš„ <code>next</code> è®¾ä¸º <code>nil</code>ã€‚</li>
<li>è¿”å›æ–°çš„å¤´èŠ‚ç‚¹ã€‚</li>
</ol>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<h3 id="é€’å½’å®ç°">é€’å½’å®ç°</h3>
<p>åœ¨é€’å½’æ–¹æ³•ä¸­ï¼Œå…³é”®åœ¨äºç†è§£å­é—®é¢˜çš„è¾¹ç•Œå’Œå¦‚ä½•å¤„ç†å½“å‰èŠ‚ç‚¹ä¸å­é—®é¢˜çš„å…³ç³»ã€‚</p>
<p>å½“æˆ‘ä»¬é€’å½’åœ°åè½¬ <code>head.Next</code> åŠå…¶åé¢çš„èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„å¤´èŠ‚ç‚¹ <code>newHead</code>ï¼Œå®ƒæ˜¯åŸé“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚æ­¤æ—¶ï¼Œé™¤äº† <code>head</code> èŠ‚ç‚¹å¤–ï¼Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²åè½¬å®Œæˆã€‚æˆ‘ä»¬åªéœ€è¦å°† <code>head.Next.Next</code> æŒ‡å‘ <code>head</code>ï¼ˆè®©åŸæ¥çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘è‡ªå·±ï¼‰ï¼Œç„¶åå°† <code>head.Next</code> è®¾ä¸º <code>nil</code>ï¼ˆæ–­å¼€åŸæ¥çš„è¿æ¥ï¼‰ï¼Œå°±å®Œæˆäº†æ•´ä¸ªé“¾è¡¨çš„åè½¬ã€‚</p>
<h3 id="è¿­ä»£å®ç°">è¿­ä»£å®ç°</h3>
<p>åœ¨è¿­ä»£æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°å¿ƒå¤„ç†æŒ‡é’ˆçš„ç§»åŠ¨ï¼Œç¡®ä¿ä¸ä¼šä¸¢å¤±é“¾è¡¨çš„ä»»ä½•éƒ¨åˆ†ã€‚ç‰¹åˆ«æ˜¯åœ¨åè½¬å½“å‰èŠ‚ç‚¹çš„ <code>next</code> æŒ‡é’ˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="é€’å½’è§£æ³•">é€’å½’è§£æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€’å½’</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseList</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">	<span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> head</span><br><span class="line">	&#125;</span><br><span class="line">	newHead := reverseList(head.Next)</span><br><span class="line"></span><br><span class="line">	head.Next.Next = head</span><br><span class="line">	head.Next = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> newHead</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿­ä»£è§£æ³•">è¿­ä»£è§£æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿­ä»£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseList</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> head</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> cur, prev *ListNode</span><br><span class="line">	prev = head</span><br><span class="line">	cur = head.Next</span><br><span class="line">	prev.Next = <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">		tmp := cur.Next</span><br><span class="line">		cur.Next = prev</span><br><span class="line">		prev = cur</span><br><span class="line">		cur = tmp</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> prev</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¼˜åŒ–å»ºè®®">ä¼˜åŒ–å»ºè®®</h2>
<p>å¯¹äºä¸Šè¿°è¿­ä»£è§£æ³•ï¼Œè™½ç„¶ç»“æœæ˜¯æ­£ç¡®çš„ï¼Œä½†æœ‰å‡ ç‚¹å¯ä»¥ä¼˜åŒ–ï¼š</p>
<ol>
<li><strong>åˆå§‹åŒ–æŒ‡é’ˆ</strong>ï¼šæ ‡å‡†çš„åšæ³•æ˜¯å°† <code>prev</code> åˆå§‹åŒ–ä¸º <code>nil</code>ï¼Œ<code>cur</code> åˆå§‹åŒ–ä¸º <code>head</code>ï¼Œè¿™æ ·å¯ä»¥æ›´ç®€æ´åœ°å¤„ç†å„ç§æƒ…å†µï¼ŒåŒ…æ‹¬ç©ºé“¾è¡¨å’Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾è¡¨ã€‚</li>
<li><strong>ç‰¹æ®Šæƒ…å†µå¤„ç†</strong>ï¼šè™½ç„¶ä»£ç ä¸­æœ‰å¯¹ <code>head == nil || head.Next == nil</code> çš„ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼Œä½†ä½¿ç”¨æ ‡å‡†çš„åˆå§‹åŒ–æ–¹å¼åï¼Œè¿™ä¸ªç‰¹æ®Šå¤„ç†æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºè¿­ä»£è¿‡ç¨‹ä¼šè‡ªç„¶åœ°å¤„ç†è¿™äº›æƒ…å†µã€‚</li>
<li><strong>ä»£ç ç®€åŒ–</strong>ï¼šå¯ä»¥å°†åˆå§‹åŒ–å’Œè¿­ä»£è¿‡ç¨‹ç®€åŒ–ï¼Œå‡å°‘ä¸å¿…è¦çš„æ­¥éª¤ã€‚</li>
</ol>
<p>ä¼˜åŒ–åçš„è¿­ä»£ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseList</span><span class="params">(head *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">	<span class="keyword">var</span> prev *ListNode</span><br><span class="line">	curr := head</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> curr != <span class="literal">nil</span> &#123;</span><br><span class="line">		next := curr.Next    <span class="comment">// ä¸´æ—¶ä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">		curr.Next = prev     <span class="comment">// åè½¬å½“å‰èŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">		prev = curr          <span class="comment">// ç§»åŠ¨ prev æŒ‡é’ˆ</span></span><br><span class="line">		curr = next          <span class="comment">// ç§»åŠ¨ curr æŒ‡é’ˆ</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> prev  <span class="comment">// prev ç°åœ¨æŒ‡å‘æ–°çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¼˜åŒ–ç‰ˆæœ¬çš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>ä»£ç æ›´ç®€æ´ï¼Œé€»è¾‘æ›´æ¸…æ™°</li>
<li>ä¸éœ€è¦ç‰¹æ®Šå¤„ç†ç©ºé“¾è¡¨æˆ–å•èŠ‚ç‚¹é“¾è¡¨çš„æƒ…å†µ</li>
<li>å˜é‡å‘½åæ›´è§„èŒƒï¼Œä½¿ç”¨ <code>curr</code> å’Œ <code>next</code> æ›´å®¹æ˜“ç†è§£</li>
</ul>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3>
<ul>
<li><strong>é€’å½’è§£æ³•</strong>ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚æˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªèŠ‚ç‚¹è°ƒç”¨ä¸€æ¬¡é€’å½’å‡½æ•°ã€‚</li>
<li><strong>è¿­ä»£è§£æ³•</strong>ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚æˆ‘ä»¬éœ€è¦éå†æ•´ä¸ªé“¾è¡¨ä¸€æ¬¡ã€‚</li>
</ul>
<h3 id="ç©ºé—´å¤æ‚åº¦">ç©ºé—´å¤æ‚åº¦</h3>
<ul>
<li><strong>é€’å½’è§£æ³•</strong>ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚ä¸»è¦æ˜¯ç”±äºé€’å½’è°ƒç”¨æ ˆçš„å¼€é”€ã€‚</li>
<li><strong>è¿­ä»£è§£æ³•</strong>ï¼šO(1)ï¼Œåªéœ€è¦å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ã€‚</li>
</ul>
<h2 id="ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒ">ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>é€’å½’è§£æ³•</th>
<th>è¿­ä»£è§£æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ä»£ç ç®€æ´ï¼Œæ€è·¯æ¸…æ™°</td>
<td>ç©ºé—´æ•ˆç‡é«˜</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>ç©ºé—´å¼€é”€å¤§ï¼Œå¯èƒ½æ ˆæº¢å‡º</td>
<td>ä»£ç ç¨å¤æ‚ï¼Œéœ€è¦å¤šä¸ªæŒ‡é’ˆ</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li>
<p><strong>æŒ‡é’ˆæ“ä½œ</strong>ï¼šé“¾è¡¨é—®é¢˜çš„æ ¸å¿ƒæ˜¯æŒ‡é’ˆæ“ä½œï¼Œéœ€è¦å°å¿ƒå¤„ç†æŒ‡é’ˆçš„ç§»åŠ¨å’Œæ›´æ–°ï¼Œé¿å…é“¾è¡¨æ–­è£‚æˆ–å½¢æˆç¯ã€‚</p>
</li>
<li>
<p><strong>è¿­ä»£ä¸é€’å½’</strong>ï¼šé“¾è¡¨é—®é¢˜é€šå¸¸å¯ä»¥ä½¿ç”¨è¿­ä»£å’Œé€’å½’ä¸¤ç§æ–¹å¼è§£å†³ï¼Œè¿­ä»£æ–¹æ³•é€šå¸¸æ›´é«˜æ•ˆï¼Œè€Œé€’å½’æ–¹æ³•åˆ™æ›´ç›´è§‚ã€‚</p>
</li>
<li>
<p><strong>æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨å¤šä¸ªæŒ‡é’ˆï¼ˆå¦‚ <code>prev</code>ã€<code>curr</code>ã€<code>next</code>ï¼‰å¯ä»¥æœ‰æ•ˆåœ°å¤„ç†é“¾è¡¨çš„åè½¬æ“ä½œ</li>
<li>åœ¨ä¿®æ”¹æŒ‡é’ˆå‰ï¼ŒåŠ¡å¿…å…ˆä¿å­˜å¿…è¦çš„å¼•ç”¨ï¼Œé˜²æ­¢é“¾è¡¨ä¸¢å¤±</li>
<li>å¯¹äºç‰¹æ®Šæƒ…å†µï¼ˆå¦‚ç©ºé“¾è¡¨ã€å•èŠ‚ç‚¹é“¾è¡¨ï¼‰ï¼Œå¯ä»¥å•ç‹¬å¤„ç†æˆ–è®¾è®¡ç®—æ³•ä½¿å…¶è‡ªç„¶åŒ…å«åœ¨ä¸€èˆ¬æƒ…å†µä¸­</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´æ•ˆç‡</strong>ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼˜å…ˆè€ƒè™‘è¿­ä»£è§£æ³•ï¼Œå› ä¸ºå®ƒçš„ç©ºé—´å¤æ‚åº¦æ›´ä½ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé•¿é“¾è¡¨ï¼Œå¯ä»¥é¿å…é€’å½’é€ æˆçš„æ ˆæº¢å‡ºé—®é¢˜ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>é€’å½’</tag>
        <tag>è¿­ä»£</tag>
        <tag>Easy</tag>
        <tag>Hot100</tag>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 160 - ç›¸äº¤é“¾è¡¨ï¼ˆIntersection of Two Linked Listsï¼‰</title>
    <url>/2025/04/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-160-Intersection-of-Two-Linked-Lists/</url>
    <content><![CDATA[<h2 id="Problem-Description">Problem Description</h2>
<p>ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ headA å’Œ headB ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸å­˜åœ¨ç›¸äº¤èŠ‚ç‚¹ï¼Œè¿”å› null ã€‚</p>
<p>å›¾ç¤ºä¸¤ä¸ªé“¾è¡¨åœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A:      a1 â†’ a2</span><br><span class="line">                â†˜</span><br><span class="line">                  c1 â†’ c2 â†’ c3</span><br><span class="line">                â†—          </span><br><span class="line">B: b1 â†’ b2 â†’ b3</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®æ•°æ®ä¿è¯æ•´ä¸ªé“¾å¼ç»“æ„ä¸­ä¸å­˜åœ¨ç¯ï¼Œå‡½æ•°è¿”å›ç»“æœåï¼Œé“¾è¡¨å¿…é¡»ä¿æŒå…¶åŸå§‹ç»“æ„ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼š">ç¤ºä¾‹ 1ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">        4 â†’ 1</span><br><span class="line">              â†˜</span><br><span class="line">                8 â†’ 4 â†’ 5</span><br><span class="line">              â†—          </span><br><span class="line">5 â†’ 6 â†’ 1</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥ï¼šintersectVal = 8, listA = [4,1,8,4,5], listB = [5,6,1,8,4,5], skipA = 2, skipB = 3<br>
è¾“å‡ºï¼šIntersected at â€˜8â€™<br>
è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚<br>
ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º [5,6,1,8,4,5]ã€‚<br>
åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚</p>
<h3 id="ç¤ºä¾‹-2ï¼š">ç¤ºä¾‹ 2ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 â†’ 9 â†’ 1</span><br><span class="line">          â†˜</span><br><span class="line">            2 â†’ 4</span><br><span class="line">          â†—   </span><br><span class="line">    3</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥ï¼šintersectVal = 2, listA = [1,9,1,2,4], listB = [3,2,4], skipA = 3, skipB = 1<br>
è¾“å‡ºï¼šIntersected at â€˜2â€™</p>
<h3 id="ç¤ºä¾‹-3ï¼š">ç¤ºä¾‹ 3ï¼š</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2 â†’ 6 â†’ 4</span><br><span class="line"></span><br><span class="line">1 â†’ 5</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥ï¼šintersectVal = 0, listA = [2,6,4], listB = [1,5], skipA = 3, skipB = 2<br>
è¾“å‡ºï¼šNo intersection</p>
<h3 id="çº¦æŸæ¡ä»¶ï¼š">çº¦æŸæ¡ä»¶ï¼š</h3>
<ul>
<li>listA ä¸­èŠ‚ç‚¹æ•°ç›®ä¸º m</li>
<li>listB ä¸­èŠ‚ç‚¹æ•°ç›®ä¸º n</li>
<li>1 &lt;= m, n &lt;= 3 * 10^4</li>
<li>1 &lt;= Node.val &lt;= 10^5</li>
<li>0 &lt;= skipA &lt;= m</li>
<li>0 &lt;= skipB &lt;= n</li>
<li>å¦‚æœ listA å’Œ listB æ²¡æœ‰äº¤ç‚¹ï¼ŒintersectVal ä¸º 0</li>
<li>å¦‚æœ listA å’Œ listB æœ‰äº¤ç‚¹ï¼ŒintersectVal == listA[skipA] == listB[skipB]</li>
</ul>
<p>è¿›é˜¶ï¼šä½ èƒ½å¦è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ O(m + n) ã€ä»…ç”¨ O(1) å†…å­˜çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</p>
<h2 id="Solution-Approach">Solution Approach</h2>
<p>è¿™ä¸ªé—®é¢˜æœ‰å‡ ç§è§£æ³•ï¼Œæˆ‘ä»¬å°†é€ä¸€ä»‹ç»ï¼Œå¹¶åˆ†æå„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨æ³•">æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨ç¬¬ä¸€ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œç„¶åéå†ç¬¬äºŒä¸ªé“¾è¡¨ï¼Œæ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦åœ¨å“ˆå¸Œè¡¨ä¸­å­˜åœ¨ã€‚</p>
<h4 id="å®ç°æ­¥éª¤ï¼š">å®ç°æ­¥éª¤ï¼š</h4>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼ˆGoä¸­å¯ä»¥ä½¿ç”¨mapï¼‰</li>
<li>å°†é“¾è¡¨Açš„æ‰€æœ‰èŠ‚ç‚¹æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­</li>
<li>éå†é“¾è¡¨Bï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦å·²ç»å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­</li>
<li>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œåˆ™è¿”å›è¯¥èŠ‚ç‚¹ä½œä¸ºäº¤ç‚¹</li>
<li>å¦‚æœéå†å®Œé“¾è¡¨Bä»æœªæ‰¾åˆ°åŒ¹é…èŠ‚ç‚¹ï¼Œåˆ™è¿”å›nil</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getIntersectionNode</span><span class="params">(headA, headB *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    nodeMap := <span class="built_in">make</span>(<span class="keyword">map</span>[*ListNode]<span class="type">bool</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å°†é“¾è¡¨Açš„æ‰€æœ‰èŠ‚ç‚¹æ·»åŠ åˆ°å“ˆå¸Œè¡¨</span></span><br><span class="line">    <span class="keyword">for</span> curr := headA; curr != <span class="literal">nil</span>; curr = curr.Next &#123;</span><br><span class="line">        nodeMap[curr] = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// éå†é“¾è¡¨Bï¼Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦åœ¨å“ˆå¸Œè¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> curr := headB; curr != <span class="literal">nil</span>; curr = curr.Next &#123;</span><br><span class="line">        <span class="keyword">if</span> nodeMap[curr] &#123;</span><br><span class="line">            <span class="keyword">return</span> curr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆæ³•ï¼ˆæœ€ä¼˜è§£ï¼‰">æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆæ³•ï¼ˆæœ€ä¼˜è§£ï¼‰</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ pA å’Œ pB åˆ†åˆ«éå†é“¾è¡¨ A å’Œé“¾è¡¨ Bã€‚å½“ä¸€ä¸ªæŒ‡é’ˆåˆ°è¾¾é“¾è¡¨æœ«å°¾æ—¶ï¼Œå°†å…¶é‡å®šå‘åˆ°å¦ä¸€ä¸ªé“¾è¡¨çš„å¤´éƒ¨ã€‚æœ€ç»ˆï¼Œä¸¤ä¸ªæŒ‡é’ˆä¼šåœ¨ç›¸äº¤ç‚¹ç›¸é‡ï¼Œæˆ–è€…åœ¨éå†å®Œä¸¤ä¸ªé“¾è¡¨ååŒæ—¶ä¸º nilã€‚</p>
<h4 id="é‡å®šå‘è¿‡ç¨‹çš„æ·±å…¥è§£é‡Š">é‡å®šå‘è¿‡ç¨‹çš„æ·±å…¥è§£é‡Š</h4>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦é‡å®šå‘ï¼Ÿ</strong></p>
<p>è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºä¸¤ä¸ªé“¾è¡¨å¯èƒ½é•¿åº¦ä¸åŒã€‚å¦‚æœä¸è¿›è¡Œé‡å®šå‘ï¼Œä¸¤ä¸ªæŒ‡é’ˆæ°¸è¿œä¸ä¼šåœ¨æ­£ç¡®çš„ä½ç½®ç›¸é‡ã€‚</p>
<p><strong>ç›´è§‚ç†è§£ï¼š</strong></p>
<p>æƒ³è±¡ä¸¤ä¸ªäººåœ¨ä¸¤æ¡ä¸åŒçš„é“è·¯ä¸Šè·‘æ­¥ï¼Œè¿™ä¸¤æ¡é“è·¯åœ¨æŸä¸€ç‚¹ç›¸äº¤ã€‚å¦‚æœä¸¤ä¸ªäººä»¥ç›¸åŒçš„é€Ÿåº¦è·‘æ­¥ï¼Œä½†èµ·ç‚¹ä¸åŒï¼Œä»–ä»¬å¯èƒ½æ°¸è¿œä¸ä¼šåœ¨ç›¸äº¤ç‚¹ç›¸é‡ã€‚é‡å®šå‘å°±åƒæ˜¯è®©ä¸€ä¸ªäººè·‘å®Œè‡ªå·±çš„è·¯åï¼Œç«‹å³ä»å¦ä¸€ä¸ªäººçš„èµ·ç‚¹å¼€å§‹è·‘ï¼Œè¿™æ ·ä»–ä»¬æœ€ç»ˆä¼šåœ¨ç›¸äº¤ç‚¹ç›¸é‡ã€‚</p>
<p><strong>æ•°å­¦è¯æ˜ï¼š</strong></p>
<p>è®¾é“¾è¡¨Açš„é•¿åº¦ä¸ºmï¼Œé“¾è¡¨Bçš„é•¿åº¦ä¸ºnï¼Œä»äº¤ç‚¹åˆ°æœ«å°¾çš„å…¬å…±éƒ¨åˆ†é•¿åº¦ä¸ºkã€‚</p>
<ul>
<li>é“¾è¡¨Aä¸­äº¤ç‚¹åˆ°æœ«å°¾çš„è·ç¦»ï¼šm-k</li>
<li>é“¾è¡¨Bä¸­äº¤ç‚¹åˆ°æœ«å°¾çš„è·ç¦»ï¼šn-k</li>
</ul>
<p>é‡å®šå‘åï¼Œä¸¤ä¸ªæŒ‡é’ˆèµ°è¿‡çš„æ€»è·¯å¾„ï¼š</p>
<ul>
<li>pA: m + (n-k) = m + n - k</li>
<li>pB: n + (m-k) = n + m - k</li>
</ul>
<p>æ‰€ä»¥ä¸¤ä¸ªæŒ‡é’ˆèµ°è¿‡çš„æ€»è·ç¦»æ˜¯ç›¸ç­‰çš„ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä»¬ä¼šåœ¨äº¤ç‚¹ç›¸é‡ã€‚</p>
<p><img src="/2025/04/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-160-Intersection-of-Two-Linked-Lists/1753799854872.png" alt="1753799854872"></p>
<p><strong>å…·ä½“ä¾‹å­æ¼”ç¤ºï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A: a1 â†’ a2 â†’ c1 â†’ c2 â†’ c3</span><br><span class="line">B: b1 â†’ b2 â†’ b3 â†’ c1 â†’ c2 â†’ c3</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­c1æ˜¯äº¤ç‚¹ã€‚</p>
<p><strong>æ­¥éª¤è¯¦è§£ï¼š</strong></p>
<ol>
<li>
<p><strong>åˆå§‹çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>pA = a1, pB = b1</li>
</ul>
</li>
<li>
<p><strong>ç¬¬ä¸€æ¬¡éå†</strong>ï¼š</p>
<ul>
<li>pA: a1 â†’ a2 â†’ c1 â†’ c2 â†’ c3 â†’ nil</li>
<li>pB: b1 â†’ b2 â†’ b3 â†’ c1 â†’ c2 â†’ c3 â†’ nil</li>
</ul>
</li>
<li>
<p><strong>é‡å®šå‘è¿‡ç¨‹</strong>ï¼š</p>
<ul>
<li>pAåˆ°è¾¾nilï¼Œé‡å®šå‘åˆ°b1</li>
<li>pBåˆ°è¾¾nilï¼Œé‡å®šå‘åˆ°a1</li>
</ul>
</li>
<li>
<p><strong>ç¬¬äºŒæ¬¡éå†</strong>ï¼š</p>
<ul>
<li>pA: b1 â†’ b2 â†’ b3 â†’ c1</li>
<li>pB: a1 â†’ a2 â†’ c1</li>
</ul>
</li>
<li>
<p><strong>ç›¸é‡</strong>ï¼šä¸¤ä¸ªæŒ‡é’ˆåœ¨c1ç›¸é‡ï¼</p>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆé‡å®šå‘æœ‰æ•ˆï¼Ÿ</strong></p>
<ol>
<li><strong>é•¿åº¦ç›¸åŒçš„æƒ…å†µ</strong>ï¼šé‡å®šå‘ç¡®ä¿ä¸¤ä¸ªæŒ‡é’ˆåœ¨ç›¸åŒçš„ç›¸å¯¹ä½ç½®å¼€å§‹æ¯”è¾ƒ</li>
<li><strong>é•¿åº¦ä¸åŒçš„æƒ…å†µ</strong>ï¼šé‡å®šå‘è®©è¾ƒçŸ­çš„é“¾è¡¨çš„æŒ‡é’ˆ&quot;ç­‰å¾…&quot;è¾ƒé•¿çš„é“¾è¡¨çš„æŒ‡é’ˆï¼Œç›´åˆ°å®ƒä»¬åœ¨ç›¸åŒçš„ç›¸å¯¹ä½ç½®</li>
<li><strong>æ²¡æœ‰äº¤ç‚¹çš„æƒ…å†µ</strong>ï¼šé‡å®šå‘ç¡®ä¿ä¸¤ä¸ªæŒ‡é’ˆéƒ½ä¼šéå†å®Œä¸¤ä¸ªé“¾è¡¨ï¼Œæœ€ç»ˆåŒæ—¶å˜ä¸ºnil</li>
</ol>
<p><strong>é‡å®šå‘çš„å·§å¦™ä¹‹å¤„ï¼š</strong></p>
<ul>
<li><strong>æ— éœ€é¢„è®¡ç®—é•¿åº¦</strong>ï¼šä¸éœ€è¦å…ˆéå†é“¾è¡¨è®¡ç®—é•¿åº¦</li>
<li><strong>ç©ºé—´å¤æ‚åº¦O(1)</strong>ï¼šåªéœ€è¦ä¸¤ä¸ªæŒ‡é’ˆ</li>
<li><strong>æ—¶é—´å¤æ‚åº¦O(m+n)</strong>ï¼šæ¯ä¸ªæŒ‡é’ˆæœ€å¤šéå†ä¸¤ä¸ªé“¾è¡¨å„ä¸€æ¬¡</li>
<li><strong>è‡ªåŠ¨å¤„ç†è¾¹ç•Œæƒ…å†µ</strong>ï¼šè‡ªç„¶åœ°å¤„ç†äº†ç©ºé“¾è¡¨ã€å•èŠ‚ç‚¹ç­‰ç‰¹æ®Šæƒ…å†µ</li>
</ul>
<h4 id="å®ç°æ­¥éª¤ï¼š-2">å®ç°æ­¥éª¤ï¼š</h4>
<ol>
<li>åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆ pA å’Œ pB åˆ†åˆ«æŒ‡å‘é“¾è¡¨ A å’Œé“¾è¡¨ B çš„å¤´èŠ‚ç‚¹</li>
<li>åŒæ—¶ç§»åŠ¨è¿™ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ¯æ¬¡ç§»åŠ¨ä¸€æ­¥</li>
<li>å½“ pA åˆ°è¾¾é“¾è¡¨ A çš„æœ«å°¾æ—¶ï¼Œå°†å…¶é‡å®šå‘åˆ°é“¾è¡¨ B çš„å¤´éƒ¨</li>
<li>å½“ pB åˆ°è¾¾é“¾è¡¨ B çš„æœ«å°¾æ—¶ï¼Œå°†å…¶é‡å®šå‘åˆ°é“¾è¡¨ A çš„å¤´éƒ¨</li>
<li>å¦‚æœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤ï¼ŒpA å’Œ pB æœ€ç»ˆä¼šåœ¨ç›¸äº¤ç‚¹ç›¸é‡</li>
<li>å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼ŒpA å’Œ pB æœ€ç»ˆéƒ½ä¼šå˜ä¸º nil</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getIntersectionNode</span><span class="params">(headA, headB *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="keyword">if</span> headA == <span class="literal">nil</span> || headB == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    pA, pB := headA, headB</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> pA != pB &#123;</span><br><span class="line">        <span class="comment">// å½“åˆ°è¾¾é“¾è¡¨æœ«å°¾æ—¶ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªé“¾è¡¨çš„å¤´éƒ¨</span></span><br><span class="line">        <span class="keyword">if</span> pA == <span class="literal">nil</span> &#123;</span><br><span class="line">            pA = headB</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pA = pA.Next</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span> pB == <span class="literal">nil</span> &#123;</span><br><span class="line">            pB = headA</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pB = pB.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> pA <span class="comment">// pA è¦ä¹ˆæ˜¯ç›¸äº¤ç‚¹ï¼Œè¦ä¹ˆæ˜¯ nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šè®¡ç®—é•¿åº¦å·®æ³•">æ–¹æ³•ä¸‰ï¼šè®¡ç®—é•¿åº¦å·®æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šè®¡ç®—ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ï¼Œç„¶åè®©è¾ƒé•¿çš„é“¾è¡¨å…ˆç§»åŠ¨å·®å€¼æ­¥æ•°ï¼Œä¹‹åä¸¤ä¸ªæŒ‡é’ˆåŒæ­¥å‰è¿›ï¼Œæœ€ç»ˆä¼šåœ¨ç›¸äº¤ç‚¹ç›¸é‡ã€‚</p>
<h4 id="å®ç°æ­¥éª¤ï¼š-3">å®ç°æ­¥éª¤ï¼š</h4>
<ol>
<li>åˆ†åˆ«è®¡ç®—é“¾è¡¨ A å’Œé“¾è¡¨ B çš„é•¿åº¦</li>
<li>è®¡ç®—ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦å·® diff</li>
<li>è®©è¾ƒé•¿çš„é“¾è¡¨çš„æŒ‡é’ˆå…ˆç§»åŠ¨ diff æ­¥</li>
<li>ç„¶åä¸¤ä¸ªæŒ‡é’ˆåŒæ­¥å‰è¿›ï¼Œæ¯æ¬¡éƒ½ç§»åŠ¨ä¸€æ­¥</li>
<li>æ£€æŸ¥ä¸¤ä¸ªæŒ‡é’ˆæ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è¿”å›è¯¥èŠ‚ç‚¹</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getIntersectionNode</span><span class="params">(headA, headB *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="comment">// è®¡ç®—é“¾è¡¨é•¿åº¦çš„è¾…åŠ©å‡½æ•°</span></span><br><span class="line">    getLength := <span class="function"><span class="keyword">func</span><span class="params">(head *ListNode)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        length := <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> curr := head; curr != <span class="literal">nil</span>; curr = curr.Next &#123;</span><br><span class="line">            length++</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> length</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    lenA, lenB := getLength(headA), getLength(headB)</span><br><span class="line">    pA, pB := headA, headB</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è®©è¾ƒé•¿çš„é“¾è¡¨å…ˆç§»åŠ¨å·®å€¼æ­¥æ•°</span></span><br><span class="line">    <span class="keyword">if</span> lenA &gt; lenB &#123;</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; lenA - lenB; i++ &#123;</span><br><span class="line">            pA = pA.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; lenB - lenA; i++ &#123;</span><br><span class="line">            pB = pB.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// åŒæ­¥å‰è¿›ï¼Œå¯»æ‰¾ç›¸äº¤ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> pA != pB &#123;</span><br><span class="line">        pA = pA.Next</span><br><span class="line">        pB = pB.Next</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> pA <span class="comment">// pA è¦ä¹ˆæ˜¯ç›¸äº¤ç‚¹ï¼Œè¦ä¹ˆæ˜¯ nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é”™è¯¯è§£æ³•åˆ†æ">é”™è¯¯è§£æ³•åˆ†æ</h2>
<p>æˆ‘ä¹‹å‰çš„è§£æ³•å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getIntersectionNode</span><span class="params">(headA, headB *ListNode)</span></span> *ListNode &#123;</span><br><span class="line">    <span class="keyword">if</span> headA == <span class="literal">nil</span> || headB == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fast, slow := headA, headB</span><br><span class="line">    <span class="keyword">for</span> fast != slow &#123;</span><br><span class="line">        <span class="keyword">if</span> fast == <span class="literal">nil</span> &#123;</span><br><span class="line">            fast = headB</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fast = fast.Next</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> fast == <span class="literal">nil</span> &#123;</span><br><span class="line">            fast = headB</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fast = fast.Next</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> slow == <span class="literal">nil</span> &#123;</span><br><span class="line">            slow = headA</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            slow = slow.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fast</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>ç®—æ³•æ€è·¯æ··æ·†</strong>ï¼šè¿™ä¸ªè§£æ³•ä¼¼ä¹æ··åˆäº†æ£€æµ‹ç¯å½¢é“¾è¡¨çš„å¿«æ…¢æŒ‡é’ˆæ³•å’Œæ£€æµ‹ç›¸äº¤é“¾è¡¨çš„åŒæŒ‡é’ˆæ³•ã€‚åœ¨ç›¸äº¤é“¾è¡¨é—®é¢˜ä¸­ï¼Œä¸åº”è¯¥ä½¿ç”¨ä¸åŒé€Ÿåº¦çš„æŒ‡é’ˆã€‚</li>
<li><strong>æŒ‡é’ˆç§»åŠ¨é€»è¾‘é”™è¯¯</strong>ï¼šfast æŒ‡é’ˆå°è¯•æ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ï¼Œè€Œ slow æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ã€‚è¿™ç§æ–¹å¼åœ¨æ²¡æœ‰ç¯çš„æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´æ— æ³•æ­£ç¡®æ‰¾åˆ°ç›¸äº¤ç‚¹ã€‚</li>
<li><strong>é‡ç½®é€»è¾‘é—®é¢˜</strong>ï¼šä»£ç ä¸­ fast æŒ‡é’ˆå¯èƒ½åœ¨åŒä¸€æ¬¡å¾ªç¯ä¸­è¢«é‡ç½®ä¸¤æ¬¡ï¼Œè¿™ä¸ç¬¦åˆç®—æ³•çš„è¦æ±‚ã€‚</li>
<li><strong>å¯èƒ½çš„æ— é™å¾ªç¯</strong>ï¼šå¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå¹¶ä¸”é•¿åº¦ä¸åŒï¼Œè¿™ç§å®ç°å¯èƒ½å¯¼è‡´æŒ‡é’ˆæ°¸è¿œä¸ä¼šç›¸ç­‰ï¼Œä»è€Œé™·å…¥æ— é™å¾ªç¯ã€‚</li>
</ol>
<h2 id="è§£æ³•æ¯”è¾ƒ">è§£æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>å“ˆå¸Œè¡¨æ³•</th>
<th>åŒæŒ‡é’ˆæ³•</th>
<th>é•¿åº¦å·®æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(m+n)</td>
<td>O(m+n)</td>
<td>O(m+n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(m)</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç®€å•ç›´è§‚ï¼Œå®¹æ˜“å®ç°</td>
<td>ç©ºé—´å¤æ‚åº¦æœ€ä¼˜ï¼Œä»£ç ç®€æ´</td>
<td>æ€è·¯æ¸…æ™°ï¼Œæ˜“äºç†è§£</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
<td>åˆæ¬¡ç†è§£å¯èƒ½æœ‰éš¾åº¦</td>
<td>ä»£ç ç•¥é•¿ï¼Œéœ€è¦è®¡ç®—é•¿åº¦</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
</tr>
</tbody>
</table>
<h2 id="Key-Learnings">Key Learnings</h2>
<ol>
<li><strong>åŒæŒ‡é’ˆæŠ€å·§</strong>ï¼šæ­¤é—®é¢˜å±•ç¤ºäº†åŒæŒ‡é’ˆåœ¨è§£å†³é“¾è¡¨é—®é¢˜ä¸­çš„å¼ºå¤§ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯æ–¹æ³•äºŒçš„è§£æ³•å·§å¦™ä¸”ä¼˜é›…ã€‚</li>
<li><strong>ç©ºé—´æ—¶é—´æƒè¡¡</strong>ï¼šå“ˆå¸Œè¡¨æ³•è™½ç„¶ç›´è§‚ï¼Œä½†éœ€è¦é¢å¤–ç©ºé—´ï¼›è€ŒåŒæŒ‡é’ˆæ³•å’Œé•¿åº¦å·®æ³•åªéœ€O(1)ç©ºé—´ï¼Œå±•ç¤ºäº†ç®—æ³•è®¾è®¡ä¸­ç©ºé—´ä¸æ—¶é—´çš„æƒè¡¡ã€‚</li>
<li><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†</strong>ï¼šåœ¨å¤„ç†é“¾è¡¨é—®é¢˜æ—¶ï¼Œæ€»æ˜¯éœ€è¦è€ƒè™‘ç©ºé“¾è¡¨ã€å•èŠ‚ç‚¹é“¾è¡¨ç­‰è¾¹ç•Œæƒ…å†µã€‚</li>
<li><strong>é—®é¢˜ç®€åŒ–</strong>ï¼šé€šè¿‡é‡å®šå‘æŒ‡é’ˆï¼ˆæ–¹æ³•äºŒï¼‰æˆ–æå‰ç§»åŠ¨ï¼ˆæ–¹æ³•ä¸‰ï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç®€åŒ–é—®é¢˜ï¼Œä½¿ä¸åŒé•¿åº¦çš„é“¾è¡¨åœ¨åŒæ­¥ç‚¹ç›¸é‡ã€‚</li>
<li><strong>é”™è¯¯åˆ†æ</strong>ï¼šç†è§£é”™è¯¯è§£æ³•çš„ç¼ºé™·èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´æ·±å…¥åœ°ç†è§£é—®é¢˜çš„æœ¬è´¨å’Œè§£å†³æ–¹æ¡ˆçš„è¦æ±‚ã€‚åœ¨æ­¤é—®é¢˜ä¸­ï¼Œä¸æ°å½“åœ°æ··ç”¨ç®—æ³•æ¨¡å¼ï¼ˆå¿«æ…¢æŒ‡é’ˆå’ŒåŒæŒ‡é’ˆï¼‰å¯¼è‡´äº†è§£æ³•çš„å¤±è´¥ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>é“¾è¡¨</category>
      </categories>
      <tags>
        <tag>Easy</tag>
        <tag>Hot100</tag>
        <tag>å“ˆå¸Œ</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>é“¾è¡¨</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 240 - æœç´¢äºŒç»´çŸ©é˜µ IIï¼ˆSearch a 2D Matrix IIï¼‰</title>
    <url>/2025/04/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-240-Search-a-2D-Matrix-II/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ m x n çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯¥çŸ©é˜µå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>æ¯è¡Œçš„å…ƒç´ ä»å·¦åˆ°å³å‡åºæ’åˆ—ã€‚</li>
<li>æ¯åˆ—çš„å…ƒç´ ä»ä¸Šåˆ°ä¸‹å‡åºæ’åˆ—ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<p>è¾“å…¥ï¼šmatrix =</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [1,  4,  7,  11, 15],</span><br><span class="line">  [2,  5,  8,  12, 19],</span><br><span class="line">  [3,  6,  9,  16, 22],</span><br><span class="line">  [10, 13, 14, 17, 24],</span><br><span class="line">  [18, 21, 23, 26, 30]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>target = 5</p>
<p>è¾“å‡ºï¼štrue</p>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<p>è¾“å…¥ï¼šmatrix =</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [1,  4,  7,  11, 15],</span><br><span class="line">  [2,  5,  8,  12, 19],</span><br><span class="line">  [3,  6,  9,  16, 22],</span><br><span class="line">  [10, 13, 14, 17, 24],</span><br><span class="line">  [18, 21, 23, 26, 30]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>target = 20</p>
<p>è¾“å‡ºï¼šfalse</p>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>m == matrix.length</li>
<li>n == matrix[i].length</li>
<li>1 &lt;= n, m &lt;= 300</li>
<li>-10^9 &lt;= matrix[i][j] &lt;= 10^9</li>
<li>æ¯è¡Œçš„æ‰€æœ‰å…ƒç´ ä»å·¦åˆ°å³å‡åºæ’åˆ—</li>
<li>æ¯åˆ—çš„æ‰€æœ‰å…ƒç´ ä»ä¸Šåˆ°ä¸‹å‡åºæ’åˆ—</li>
<li>-10^9 &lt;= target &lt;= 10^9</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜ç›®æä¾›äº†ä¸€ä¸ªç‰¹æ®Šæ€§è´¨çš„äºŒç»´çŸ©é˜µï¼Œè¦æ±‚æˆ‘ä»¬æŸ¥æ‰¾ä¸€ä¸ªç›®æ ‡å€¼ã€‚çŸ©é˜µçš„ç‰¹æ€§æ˜¯æ¯è¡Œä»å·¦åˆ°å³å‡åºï¼Œæ¯åˆ—ä»ä¸Šåˆ°ä¸‹å‡åºã€‚æ ¹æ®è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§è§£é¢˜æ€è·¯ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šè§’è½æœç´¢æ³•">æ–¹æ³•ä¸€ï¼šè§’è½æœç´¢æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>: åˆ©ç”¨çŸ©é˜µçš„æ’åºç‰¹æ€§ï¼Œä»å³ä¸Šè§’æˆ–å·¦ä¸‹è§’å¼€å§‹æœç´¢ï¼Œæ¯æ¬¡èƒ½å¤Ÿæ’é™¤ä¸€è¡Œæˆ–ä¸€åˆ—ã€‚</p>
<p>ä»å³ä¸Šè§’ï¼ˆæˆ–å·¦ä¸‹è§’ï¼‰å¼€å§‹æœç´¢çš„åŸç†ï¼š</p>
<ul>
<li>è‹¥å½“å‰å…ƒç´ ç­‰äºç›®æ ‡å€¼ï¼Œç›´æ¥è¿”å› true</li>
<li>è‹¥å½“å‰å…ƒç´ å¤§äºç›®æ ‡å€¼ï¼Œåˆ™å¯ä»¥æ’é™¤å½“å‰åˆ—ï¼ˆå› ä¸ºå½“å‰åˆ—ä¸‹æ–¹çš„å…ƒç´ æ›´å¤§ï¼‰</li>
<li>è‹¥å½“å‰å…ƒç´ å°äºç›®æ ‡å€¼ï¼Œåˆ™å¯ä»¥æ’é™¤å½“å‰è¡Œï¼ˆå› ä¸ºå½“å‰è¡Œå·¦ä¾§çš„å…ƒç´ æ›´å°ï¼‰</li>
</ul>
<p>è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(m + n)ï¼Œå…¶ä¸­ m æ˜¯è¡Œæ•°ï¼Œn æ˜¯åˆ—æ•°ï¼Œå› ä¸ºæ¯æ¬¡æ“ä½œéƒ½ä¼šæ’é™¤ä¸€è¡Œæˆ–ä¸€åˆ—ã€‚</p>
<h4 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h4>
<p>æˆ‘ä»¬ä»çŸ©é˜µçš„å³ä¸Šè§’å¼€å§‹æœç´¢ï¼š</p>
<ol>
<li>åˆå§‹åŒ–æŒ‡é’ˆä½ç½®ä¸ºå³ä¸Šè§’åæ ‡ (0, columns-1)</li>
<li>å½“æŒ‡é’ˆåœ¨çŸ©é˜µèŒƒå›´å†…æ—¶ï¼Œæ¯”è¾ƒå½“å‰å…ƒç´ ä¸ç›®æ ‡å€¼ï¼š
<ul>
<li>å¦‚æœç›¸ç­‰ï¼Œè¿”å› true</li>
<li>å¦‚æœå½“å‰å…ƒç´ å¤§äºç›®æ ‡å€¼ï¼Œåˆ™å‘å·¦ç§»åŠ¨ï¼ˆåˆ—ç´¢å¼•å‡ä¸€ï¼‰</li>
<li>å¦‚æœå½“å‰å…ƒç´ å°äºç›®æ ‡å€¼ï¼Œåˆ™å‘ä¸‹ç§»åŠ¨ï¼ˆè¡Œç´¢å¼•åŠ ä¸€ï¼‰</li>
</ul>
</li>
<li>å¦‚æœæœç´¢ç»“æŸåä»æœªæ‰¾åˆ°ç›®æ ‡å€¼ï¼Œè¿”å› false</li>
</ol>
<h4 id="ä»£ç å®ç°">ä»£ç å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrix</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çŸ©é˜µçš„è¡Œæ•°å’Œåˆ—æ•°</span></span><br><span class="line">    rows := <span class="built_in">len</span>(matrix)</span><br><span class="line">    <span class="keyword">if</span> rows == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    columns := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä»å³ä¸Šè§’å¼€å§‹æœç´¢</span></span><br><span class="line">    row, col := <span class="number">0</span>, columns<span class="number">-1</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å½“æŒ‡é’ˆåœ¨çŸ©é˜µèŒƒå›´å†…æ—¶ç»§ç»­æœç´¢</span></span><br><span class="line">    <span class="keyword">for</span> row &lt; rows &amp;&amp; col &gt;= <span class="number">0</span> &#123;</span><br><span class="line">        currentValue := matrix[row][col]</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span> currentValue == target &#123;</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°ç›®æ ‡å€¼</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> currentValue &gt; target &#123;</span><br><span class="line">            <span class="comment">// å½“å‰å€¼å¤§äºç›®æ ‡å€¼ï¼Œæ’é™¤å½“å‰åˆ—</span></span><br><span class="line">            col--</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å½“å‰å€¼å°äºç›®æ ‡å€¼ï¼Œæ’é™¤å½“å‰è¡Œ</span></span><br><span class="line">            row++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æœç´¢å®Œæ¯•æœªæ‰¾åˆ°ç›®æ ‡å€¼</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾æ³•">æ–¹æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>: ç”±äºæ¯ä¸€è¡Œéƒ½æ˜¯æ’åºçš„ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸€è¡Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚</p>
<h4 id="å®ç°ç»†èŠ‚-2">å®ç°ç»†èŠ‚</h4>
<ol>
<li>éå†çŸ©é˜µçš„æ¯ä¸€è¡Œ</li>
<li>å¯¹æ¯ä¸€è¡Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å¯»æ‰¾ç›®æ ‡å€¼</li>
<li>å¦‚æœåœ¨ä»»ä¸€è¡Œä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œè¿”å› true</li>
<li>å¦åˆ™ï¼Œè¿”å› false</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(m log n)ï¼Œå…¶ä¸­ m æ˜¯è¡Œæ•°ï¼Œn æ˜¯åˆ—æ•°ã€‚</p>
<h4 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrix</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çŸ©é˜µè¡Œæ•°</span></span><br><span class="line">    rows := <span class="built_in">len</span>(matrix)</span><br><span class="line">    <span class="keyword">if</span> rows == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å¯¹æ¯ä¸€è¡Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">for</span> _, row := <span class="keyword">range</span> matrix &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœåœ¨å½“å‰è¡Œæ‰¾åˆ°ç›®æ ‡å€¼ï¼Œè¿”å› true</span></span><br><span class="line">        <span class="keyword">if</span> binarySearch(row, target) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ‰€æœ‰è¡Œéƒ½æœç´¢å®Œæ¯•æœªæ‰¾åˆ°ç›®æ ‡å€¼</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒåˆ†æŸ¥æ‰¾è¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">binarySearch</span><span class="params">(nums []<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    left, right := <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">        mid := left + (right-left)/<span class="number">2</span></span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span> nums[mid] == target &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> nums[mid] &gt; target &#123;</span><br><span class="line">            right = mid - <span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šåˆ†æ²»æ³•">æ–¹æ³•ä¸‰ï¼šåˆ†æ²»æ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>: åˆ©ç”¨çŸ©é˜µçš„ç‰¹æ€§ï¼Œå°†çŸ©é˜µåˆ’åˆ†ä¸ºå››ä¸ªå­çŸ©é˜µï¼Œé€’å½’æœç´¢ã€‚</p>
<h4 id="å®ç°ç»†èŠ‚-3">å®ç°ç»†èŠ‚</h4>
<ol>
<li>æ‰¾åˆ°çŸ©é˜µä¸­å¿ƒç‚¹ (midRow, midCol)</li>
<li>å°†çŸ©é˜µåˆ†ä¸ºå››ä¸ªåŒºåŸŸï¼šå·¦ä¸Šã€å³ä¸Šã€å·¦ä¸‹ã€å³ä¸‹</li>
<li>æ¯”è¾ƒä¸­å¿ƒç‚¹çš„å€¼ä¸ç›®æ ‡å€¼ï¼š
<ul>
<li>å¦‚æœç­‰äºç›®æ ‡å€¼ï¼Œè¿”å› true</li>
<li>å¦‚æœå¤§äºç›®æ ‡å€¼ï¼Œåˆ™ç›®æ ‡å€¼å¯èƒ½åœ¨å·¦ä¸ŠåŒºåŸŸæˆ–å·¦ä¸‹åŒºåŸŸæˆ–å³ä¸ŠåŒºåŸŸ</li>
<li>å¦‚æœå°äºç›®æ ‡å€¼ï¼Œåˆ™ç›®æ ‡å€¼å¯èƒ½åœ¨å³ä¸‹åŒºåŸŸæˆ–å³ä¸ŠåŒºåŸŸæˆ–å·¦ä¸‹åŒºåŸŸ</li>
</ul>
</li>
<li>é€’å½’æœç´¢å¯èƒ½åŒ…å«ç›®æ ‡å€¼çš„å­çŸ©é˜µ</li>
</ol>
<p>è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦åœ¨æœ€åæƒ…å†µä¸‹å¯èƒ½æ¥è¿‘ O(m*n)ï¼Œä½†åœ¨å¹³å‡æƒ…å†µä¸‹è¡¨ç°è¾ƒå¥½ã€‚</p>
<h4 id="ä»£ç å®ç°-3">ä»£ç å®ç°</h4>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrix</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çŸ©é˜µçš„è¡Œæ•°å’Œåˆ—æ•°</span></span><br><span class="line">    rows := <span class="built_in">len</span>(matrix)</span><br><span class="line">    <span class="keyword">if</span> rows == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    columns := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è°ƒç”¨é€’å½’æœç´¢å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> searchMatrixRecursively(matrix, target, <span class="number">0</span>, <span class="number">0</span>, rows<span class="number">-1</span>, columns<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’æœç´¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchMatrixRecursively</span><span class="params">(matrix [][]<span class="type">int</span>, target <span class="type">int</span>, rowStart, colStart, rowEnd, colEnd <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// åŸºæœ¬æƒ…å†µï¼šè¶…å‡ºçŸ©é˜µèŒƒå›´</span></span><br><span class="line">    <span class="keyword">if</span> rowStart &gt; rowEnd || colStart &gt; colEnd &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// åŸºæœ¬æƒ…å†µï¼šçŸ©é˜µåªæœ‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> rowStart == rowEnd &amp;&amp; colStart == colEnd &#123;</span><br><span class="line">        <span class="keyword">return</span> matrix[rowStart][colStart] == target</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è®¡ç®—ä¸­å¿ƒç‚¹åæ ‡</span></span><br><span class="line">    rowMid := rowStart + (rowEnd-rowStart)/<span class="number">2</span></span><br><span class="line">    colMid := colStart + (colEnd-colStart)/<span class="number">2</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä¸­å¿ƒç‚¹å€¼</span></span><br><span class="line">    midValue := matrix[rowMid][colMid]</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å¦‚æœæ‰¾åˆ°ç›®æ ‡å€¼ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> midValue == target &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ ¹æ®ä¸­å¿ƒç‚¹å€¼ä¸ç›®æ ‡å€¼çš„å…³ç³»ï¼Œå†³å®šæœç´¢å“ªäº›å­çŸ©é˜µ</span></span><br><span class="line">    <span class="keyword">if</span> midValue &gt; target &#123;</span><br><span class="line">        <span class="comment">// æœç´¢å·¦ä¸ŠåŒºåŸŸï¼ˆè¡Œç»“æŸå’Œåˆ—ç»“æŸéƒ½æ˜¯ä¸­å¿ƒç‚¹ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> searchMatrixRecursively(matrix, target, rowStart, colStart, rowMid, colMid) ||</span><br><span class="line">               <span class="comment">// æœç´¢å³ä¸ŠåŒºåŸŸï¼ˆè¡Œä»å¼€å§‹åˆ°ä¸­å¿ƒï¼Œåˆ—ä»ä¸­å¿ƒ+1åˆ°ç»“æŸï¼‰</span></span><br><span class="line">               searchMatrixRecursively(matrix, target, rowStart, colMid+<span class="number">1</span>, rowMid, colEnd) ||</span><br><span class="line">               <span class="comment">// æœç´¢å·¦ä¸‹åŒºåŸŸï¼ˆè¡Œä»ä¸­å¿ƒ+1åˆ°ç»“æŸï¼Œåˆ—ä»å¼€å§‹åˆ°ä¸­å¿ƒï¼‰</span></span><br><span class="line">               searchMatrixRecursively(matrix, target, rowMid+<span class="number">1</span>, colStart, rowEnd, colMid)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æœç´¢å³ä¸‹åŒºåŸŸï¼ˆè¡Œå¼€å§‹å’Œåˆ—å¼€å§‹éƒ½æ˜¯ä¸­å¿ƒç‚¹+1ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> searchMatrixRecursively(matrix, target, rowMid+<span class="number">1</span>, colMid+<span class="number">1</span>, rowEnd, colEnd) ||</span><br><span class="line">               <span class="comment">// æœç´¢å³ä¸ŠåŒºåŸŸï¼ˆè¡Œä»å¼€å§‹åˆ°ä¸­å¿ƒï¼Œåˆ—ä»ä¸­å¿ƒ+1åˆ°ç»“æŸï¼‰</span></span><br><span class="line">               searchMatrixRecursively(matrix, target, rowStart, colMid+<span class="number">1</span>, rowMid, colEnd) ||</span><br><span class="line">               <span class="comment">// æœç´¢å·¦ä¸‹åŒºåŸŸï¼ˆè¡Œä»ä¸­å¿ƒ+1åˆ°ç»“æŸï¼Œåˆ—ä»å¼€å§‹åˆ°ä¸­å¿ƒï¼‰</span></span><br><span class="line">               searchMatrixRecursively(matrix, target, rowMid+<span class="number">1</span>, colStart, rowEnd, colMid)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
<th>ç©ºé—´å¤æ‚åº¦</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>è§’è½æœç´¢æ³•</td>
<td>O(m + n)</td>
<td>O(1)</td>
<td>éå¸¸é«˜æ•ˆï¼Œå®ç°ç®€å•</td>
<td>éœ€è¦ç†è§£ç‰¹å®šçš„æœç´¢ç­–ç•¥</td>
</tr>
<tr>
<td>äºŒåˆ†æŸ¥æ‰¾æ³•</td>
<td>O(m log n)</td>
<td>O(1)</td>
<td>æ˜“äºç†è§£ï¼ŒäºŒåˆ†æŸ¥æ‰¾æ˜¯å¸¸è§ç®—æ³•</td>
<td>å¯¹äºå¤§çŸ©é˜µï¼Œæ¯”è§’è½æœç´¢æ³•æ…¢</td>
</tr>
<tr>
<td>åˆ†æ²»æ³•</td>
<td>æœ€å O(m*n)</td>
<td>O(log(m*n))</td>
<td>é€‚ç”¨äºæ›´ä¸€èˆ¬çš„æœç´¢é—®é¢˜</td>
<td>å®ç°å¤æ‚ï¼Œé€’å½’è°ƒç”¨å¼€é”€å¤§</td>
</tr>
</tbody>
</table>
<p>ç»¼åˆè€ƒè™‘ï¼Œè§’è½æœç´¢æ³•ï¼ˆæ–¹æ³•ä¸€ï¼‰æ˜¯è§£å†³æ­¤é—®é¢˜æœ€é«˜æ•ˆçš„æ–¹æ³•ï¼Œå®ƒå……åˆ†åˆ©ç”¨äº†çŸ©é˜µçš„ç‰¹æ€§ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(m + n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚</p>
<h2 id="å…³é”®å­¦ä¹ ç‚¹">å…³é”®å­¦ä¹ ç‚¹</h2>
<ol>
<li><strong>åˆ©ç”¨æ•°æ®ç»“æ„ç‰¹æ€§</strong>ï¼šçŸ©é˜µçš„æ’åºç‰¹æ€§ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¾è®¡å‡º O(m+n) çš„ç®—æ³•ã€‚åœ¨è§£å†³é—®é¢˜æ—¶ï¼Œå……åˆ†ç†è§£å¹¶åˆ©ç”¨æ•°æ®çš„ç‰¹æ®Šæ€§è´¨å¾€å¾€èƒ½æ‰¾åˆ°æœ€ä¼˜è§£ã€‚</li>
<li><strong>æœç´¢ç©ºé—´ç¼©å‡</strong>ï¼šè§’è½æœç´¢æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ¯æ¬¡æ“ä½œéƒ½èƒ½æ’é™¤ä¸€è¡Œæˆ–ä¸€åˆ—ï¼Œæœ‰æ•ˆåœ°ç¼©å°æœç´¢ç©ºé—´ã€‚</li>
<li><strong>å¤šç§è§£æ³•æ€è€ƒ</strong>ï¼šåŒä¸€ä¸ªé—®é¢˜å¯ä»¥æœ‰å¤šç§è§£æ³•ï¼Œä»æš´åŠ›æ³•åˆ°ä¼˜åŒ–è§£æ³•ï¼Œé€šè¿‡æ¯”è¾ƒä¸åŒç®—æ³•çš„å¤æ‚åº¦ï¼Œå¯ä»¥æ‰¾åˆ°æœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆã€‚</li>
<li><strong>äºŒç»´ç©ºé—´çš„æœç´¢æŠ€å·§</strong>ï¼šå¯¹äºäºŒç»´ç©ºé—´çš„æœç´¢é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä»ç‰¹æ®Šç‚¹ï¼ˆå¦‚è§’è½ï¼‰å¼€å§‹ï¼Œåˆ©ç”¨æ’åºç‰¹æ€§å¼•å¯¼æœç´¢æ–¹å‘ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>åˆ†æ²»</tag>
        <tag>Medium</tag>
        <tag>æ•°ç»„</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
        <tag>çŸ©é˜µ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 2563 - ç»Ÿè®¡å…¬å¹³æ•°å¯¹çš„æ•°ç›®ï¼ˆCount the Number of Fair Pairsï¼‰</title>
    <url>/2025/04/20/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-2563-%E7%BB%9F%E8%AE%A1%E5%85%AC%E5%B9%B3%E6%95%B0%E5%AF%B9%E7%9A%84%E6%95%B0%E7%9B%AE/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹ã€é•¿åº¦ä¸º <code>n</code> çš„æ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸¤ä¸ªæ•´æ•° <code>lower</code> å’Œ <code>upper</code>ï¼Œè¿”å›å…¬å¹³æ•°å¯¹çš„æ•°ç›®ã€‚</p>
<p>å¦‚æœ <code>(i, j)</code> æ•°å¯¹æ»¡è¶³ä»¥ä¸‹æƒ…å†µï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€ä¸ªå…¬å¹³æ•°å¯¹ï¼š</p>
<ul>
<li><code>0 â‰¤ i &lt; j &lt; n</code> ä¸”</li>
<li><code>lower â‰¤ nums[i] + nums[j] â‰¤ upper</code></li>
</ul>
<h3 id="ç¤ºä¾‹-1">ç¤ºä¾‹ 1:</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [0,1,7,4,4,5], lower = 3, upper = 6</span><br><span class="line">è¾“å‡º: 6</span><br><span class="line">è§£é‡Š: å…±è®¡ 6 ä¸ªå…¬å¹³æ•°å¯¹: (0,3), (0,4), (0,5), (1,3), (1,4) å’Œ (1,5)ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹ 2:</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [1,7,9,2,5], lower = 11, upper = 11</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: åªæœ‰å•ä¸ªå…¬å¹³æ•°å¯¹: (2,3)ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="æç¤º">æç¤º:</h3>
<ul>
<li><code>1 â‰¤ nums.length â‰¤ 10^5</code></li>
<li><code>nums.length == n</code></li>
<li><code>-10^9 â‰¤ nums[i] â‰¤ 10^9</code></li>
<li><code>-10^9 â‰¤ lower â‰¤ upper â‰¤ 10^9</code></li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜ç›®è¦æ±‚ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„æ•°å¯¹æ•°é‡ï¼Œä¸»è¦éš¾ç‚¹åœ¨äºå¦‚ä½•é«˜æ•ˆåœ°æ‰¾å‡ºæ‰€æœ‰æ»¡è¶³ <code>lower â‰¤ nums[i] + nums[j] â‰¤ upper</code> çš„æ•°å¯¹ã€‚</p>
<p>ä¸€ä¸ªå¸¸è§çš„æ€è·¯æ˜¯ä½¿ç”¨åµŒå¥—å¾ªç¯æšä¸¾æ‰€æœ‰å¯èƒ½çš„æ•°å¯¹ï¼Œä½†è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(nÂ²)ï¼Œåœ¨æ•°ç»„é•¿åº¦è¾ƒå¤§æ—¶ä¼šè¶…æ—¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong>æ’åº + äºŒåˆ†æŸ¥æ‰¾</strong>æ¥ä¼˜åŒ–è§£æ³•ï¼š</p>
<ol>
<li>é¦–å…ˆå¯¹æ•°ç»„ <code>nums</code> è¿›è¡Œæ’åº</li>
<li>å¯¹äºæ¯ä¸ªå…ƒç´  <code>nums[j]</code>ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºæœ‰å¤šå°‘ä¸ªç´¢å¼• <code>i (i &lt; j)</code> æ»¡è¶³ï¼š
<ul>
<li><code>lower â‰¤ nums[i] + nums[j] â‰¤ upper</code></li>
<li>å³ <code>lower - nums[j] â‰¤ nums[i] â‰¤ upper - nums[j]</code></li>
</ul>
</li>
<li>ç”±äºæ•°ç»„å·²æ’åºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼š
<ul>
<li>æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ <code>nums[i] â‰¥ lower - nums[j]</code> çš„ä½ç½® <code>left</code></li>
<li>æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ <code>nums[i] &gt; upper - nums[j]</code> çš„ä½ç½® <code>right</code></li>
<li>åˆ™æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ä¸ªæ•°ä¸º <code>right - left</code></li>
</ul>
</li>
</ol>
<h3 id="å…·ä½“å®ç°æ­¥éª¤">å…·ä½“å®ç°æ­¥éª¤</h3>
<p>å®ç°è¿™ä¸ªè§£æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
<ol>
<li>å¯¹ <code>nums</code> æ•°ç»„æ’åº</li>
<li>åˆå§‹åŒ–è®¡æ•°å™¨ <code>res = 0</code></li>
<li>éå†æ•°ç»„ä¸­çš„æ¯ä¸ªä½ç½® <code>j</code>ï¼š
<ul>
<li>å¯¹äºå½“å‰å…ƒç´  <code>nums[j]</code>ï¼Œåœ¨ <code>nums[0...j-1]</code> ä¸­äºŒåˆ†æŸ¥æ‰¾ï¼š
<ul>
<li>æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äº <code>lower - nums[j]</code> çš„ä½ç½® <code>left</code></li>
<li>æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äº <code>upper - nums[j]</code> çš„ä½ç½® <code>right</code></li>
</ul>
</li>
<li>å°† <code>right - left</code> åŠ åˆ°ç»“æœ <code>res</code> ä¸Š</li>
</ul>
</li>
<li>è¿”å›æœ€ç»ˆçš„ <code>res</code></li>
</ol>
<p>åœ¨ Golang ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„ <code>sort.SearchInts</code> å‡½æ•°æ¥æ‰§è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚</p>
<p>ä½†å®é™…ä¸Šï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜éœ€è¦æ³¨æ„ï¼šåœ¨é¢˜ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾çš„æ˜¯ <code>nums[i] â‰¤ upper - nums[j]</code> çš„æœ€å³è¾¹ç•Œï¼Œè€Œ <code>sort.SearchInts</code> æ‰¾çš„æ˜¯ç¬¬ä¸€ä¸ª <code>&gt;=</code> ç›®æ ‡å€¼çš„ä½ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾çš„æ˜¯ <code>upper - nums[j] + 1</code>ï¼Œå³æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äº <code>upper - nums[j]</code> çš„ä½ç½®ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countFairPairs</span><span class="params">(nums []<span class="type">int</span>, lower <span class="type">int</span>, upper <span class="type">int</span>)</span></span> (res <span class="type">int64</span>) &#123;</span><br><span class="line">	sort.Ints(nums)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="built_in">len</span>(nums); j++ &#123;</span><br><span class="line">		right := sort.SearchInts(nums[:j], upper-nums[j]+<span class="number">1</span>)</span><br><span class="line">		left := sort.SearchInts(nums[:j], lower-nums[j])</span><br><span class="line">		res += <span class="type">int64</span>(right - left)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<p>è®©æˆ‘ä»¬ä»¥ç¤ºä¾‹ 1 ä¸ºä¾‹ï¼Œè·Ÿè¸ªä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nums = [0,1,7,4,4,5], lower = 3, upper = 6</span><br></pre></td></tr></table></figure>
<p>æ’åºåï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nums = [0,1,4,4,5,7]</span><br></pre></td></tr></table></figure>
<p>éå†æ¯ä¸ªä½ç½® jï¼š</p>
<ul>
<li>j = 0: æ²¡æœ‰æ¯” 0 æ›´å°çš„ç´¢å¼•ï¼Œè·³è¿‡</li>
<li>j = 1: nums[1] = 1
<ul>
<li>åœ¨ nums[0:1] = [0] ä¸­æŸ¥æ‰¾ â‰¥ lower-nums[1] = 3-1 = 2 çš„ä½ç½® left = 1</li>
<li>åœ¨ nums[0:1] = [0] ä¸­æŸ¥æ‰¾ â‰¥ upper-nums[1]+1 = 6-1+1 = 6 çš„ä½ç½® right = 1</li>
<li>æ·»åŠ  right-left = 1-1 = 0 å¯¹</li>
</ul>
</li>
<li>j = 2: nums[2] = 4
<ul>
<li>åœ¨ nums[0:2] = [0,1] ä¸­æŸ¥æ‰¾ â‰¥ lower-nums[2] = 3-4 = -1 çš„ä½ç½® left = 0</li>
<li>åœ¨ nums[0:2] = [0,1] ä¸­æŸ¥æ‰¾ â‰¥ upper-nums[2]+1 = 6-4+1 = 3 çš„ä½ç½® right = 2</li>
<li>æ·»åŠ  right-left = 2-0 = 2 å¯¹: (0,2), (1,2)</li>
</ul>
</li>
<li>j = 3: nums[3] = 4
<ul>
<li>åœ¨ nums[0:3] = [0,1,4] ä¸­æŸ¥æ‰¾ â‰¥ lower-nums[3] = 3-4 = -1 çš„ä½ç½® left = 0</li>
<li>åœ¨ nums[0:3] = [0,1,4] ä¸­æŸ¥æ‰¾ â‰¥ upper-nums[3]+1 = 6-4+1 = 3 çš„ä½ç½® right = 2</li>
<li>æ·»åŠ  right-left = 2-0 = 2 å¯¹: (0,3), (1,3)</li>
</ul>
</li>
<li>j = 4: nums[4] = 5
<ul>
<li>åœ¨ nums[0:4] = [0,1,4,4] ä¸­æŸ¥æ‰¾ â‰¥ lower-nums[4] = 3-5 = -2 çš„ä½ç½® left = 0</li>
<li>åœ¨ nums[0:4] = [0,1,4,4] ä¸­æŸ¥æ‰¾ â‰¥ upper-nums[4]+1 = 6-5+1 = 2 çš„ä½ç½® right = 2</li>
<li>æ·»åŠ  right-left = 2-0 = 2 å¯¹: (0,4), (1,4)</li>
</ul>
</li>
<li>j = 5: nums[5] = 7
<ul>
<li>åœ¨ nums[0:5] = [0,1,4,4,5] ä¸­æŸ¥æ‰¾ â‰¥ lower-nums[5] = 3-7 = -4 çš„ä½ç½® left = 0</li>
<li>åœ¨ nums[0:5] = [0,1,4,4,5] ä¸­æŸ¥æ‰¾ â‰¥ upper-nums[5]+1 = 6-7+1 = 0 çš„ä½ç½® right = 0</li>
<li>æ·»åŠ  right-left = 0-0 = 0 å¯¹</li>
</ul>
</li>
</ul>
<p>æœ€ç»ˆç»“æœ: 0 + 0 + 2 + 2 + 2 + 0 = 6 å¯¹ï¼Œç¬¦åˆé¢„æœŸã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n log n)</p>
<ul>
<li>æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º O(n log n)</li>
<li>éå†æ•°ç»„éœ€è¦ O(n)ï¼Œæ¯æ¬¡éå†ä¸­è¿›è¡Œä¸¤æ¬¡äºŒåˆ†æŸ¥æ‰¾ï¼Œæ¯æ¬¡äºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log n)</li>
<li>æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(n log n)</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(log n) æˆ– O(n)</p>
<ul>
<li>é™¤äº†è¾“å…¥æ•°ç»„å¤–ï¼Œæ’åºå¯èƒ½éœ€è¦ O(log n) çš„æ ˆç©ºé—´</li>
<li>å¦‚æœæ’åºç®—æ³•å°±åœ°è¿›è¡Œï¼Œåˆ™é¢å¤–ç©ºé—´å¤æ‚åº¦ä¸º O(log n)</li>
<li>å¦‚æœä½¿ç”¨é¢å¤–ç©ºé—´è¿›è¡Œæ’åºï¼Œåˆ™ç©ºé—´å¤æ‚åº¦ä¸º O(n)</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>æ’åº + äºŒåˆ†æŸ¥æ‰¾</strong>: è¿™æ˜¯è§£å†³åŒºé—´æŸ¥è¯¢é—®é¢˜çš„ä¸€ç§å¸¸è§æŠ€å·§ã€‚å…ˆå°†æ•°ç»„æ’åºï¼Œç„¶åé€šè¿‡äºŒåˆ†æŸ¥æ‰¾å¿«é€Ÿç¡®å®šç¬¦åˆæ¡ä»¶çš„å…ƒç´ èŒƒå›´ã€‚</li>
<li><strong>ç­‰ä»·è½¬æ¢</strong>: å°†æ¡ä»¶ <code>lower â‰¤ nums[i] + nums[j] â‰¤ upper</code> è½¬æ¢ä¸º <code>lower - nums[j] â‰¤ nums[i] â‰¤ upper - nums[j]</code>ï¼Œè¿™æ ·å¯ä»¥å¯¹å›ºå®šçš„ <code>nums[j]</code> æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ <code>nums[i]</code>ã€‚</li>
<li><strong>è¾¹ç•Œå¤„ç†</strong>: åœ¨ä½¿ç”¨æ ‡å‡†åº“çš„äºŒåˆ†æŸ¥æ‰¾å‡½æ•°æ—¶ï¼Œéœ€è¦æ­£ç¡®ç†è§£å‡½æ•°çš„è¡Œä¸ºå’Œè¾¹ç•Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œ<code>sort.SearchInts</code> è¿”å›çš„æ˜¯ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç›®æ ‡å€¼çš„ä½ç½®ï¼Œå¦‚æœæƒ³æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç›®æ ‡å€¼çš„ä½ç½®ï¼Œéœ€è¦åšç›¸åº”è°ƒæ•´ã€‚</li>
<li><strong>ç´¢å¼•èŒƒå›´æ§åˆ¶</strong>: åœ¨äºŒåˆ†æŸ¥æ‰¾ä¸­ï¼Œéœ€è¦æ˜ç¡®åœ¨å“ªä¸ªèŒƒå›´å†…æŸ¥æ‰¾ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬åªåœ¨ <code>nums[0:j]</code> èŒƒå›´å†…æŸ¥æ‰¾ï¼Œç¡®ä¿ <code>i &lt; j</code>ã€‚</li>
</ol>
<p>è¿™é“é¢˜æ˜¯å¯¹äºŒåˆ†æŸ¥æ‰¾å’Œæ’åºåº”ç”¨çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•é€šè¿‡é¢„å¤„ç†å’Œé«˜æ•ˆçš„æŸ¥æ‰¾ç®—æ³•å°†æ—¶é—´å¤æ‚åº¦ä» O(nÂ²) ä¼˜åŒ–åˆ° O(n log n)ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>æ’åº</tag>
        <tag>äºŒåˆ†æŸ¥æ‰¾</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 48 - æ—‹è½¬å›¾åƒï¼ˆRotate Imageï¼‰</title>
    <url>/2025/04/19/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-48-Rotate-Image/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ª n Ã— n çš„äºŒç»´çŸ©é˜µ <code>matrix</code> è¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚è¯·ä½ å°†å›¾åƒé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚</p>
<p>ä½ å¿…é¡»<strong>åŸåœ°</strong>æ—‹è½¬å›¾åƒï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦ç›´æ¥ä¿®æ”¹è¾“å…¥çš„äºŒç»´çŸ©é˜µã€‚<strong>è¯·ä¸è¦</strong>ä½¿ç”¨å¦ä¸€ä¸ªçŸ©é˜µæ¥æ—‹è½¬å›¾åƒã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix = [[1,2,3],[4,5,6],[7,8,9]]</span><br><span class="line">è¾“å‡ºï¼š[[7,4,1],[8,5,2],[9,6,3]]</span><br></pre></td></tr></table></figure>
<p>æ—‹è½¬å‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br></pre></td></tr></table></figure>
<p>æ—‹è½¬åï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">7 4 1</span><br><span class="line">8 5 2</span><br><span class="line">9 6 3</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix = [[5,1,9,11],[2,4,8,10],[13,3,6,7],[15,14,12,16]]</span><br><span class="line">è¾“å‡ºï¼š[[15,13,2,5],[14,3,4,1],[12,6,8,9],[16,7,10,11]]</span><br></pre></td></tr></table></figure>
<p>æ—‹è½¬å‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 5  1  9 11</span><br><span class="line"> 2  4  8 10</span><br><span class="line">13  3  6  7</span><br><span class="line">15 14 12 16</span><br></pre></td></tr></table></figure>
<p>æ—‹è½¬åï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">15 13  2  5</span><br><span class="line">14  3  4  1</span><br><span class="line">12  6  8  9</span><br><span class="line">16  7 10 11</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>n == matrix.length == matrix[i].length</li>
<li>1 &lt;= n &lt;= 20</li>
<li>-1000 &lt;= matrix[i][j] &lt;= 1000</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>æ—‹è½¬å›¾åƒæ˜¯ä¸€ä¸ªç»å…¸çš„çŸ©é˜µæ“ä½œé—®é¢˜ã€‚å…³é”®åœ¨äºï¼š<strong>å¦‚ä½•åœ¨ä¸ä½¿ç”¨é¢å¤–ç©ºé—´çš„æƒ…å†µä¸‹å®ŒæˆçŸ©é˜µçš„æ—‹è½¬</strong>ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ä¸€ä¸‹é¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦å¯¹çŸ©é˜µå…ƒç´ ä½ç½®çš„å½±å“ï¼š</p>
<ul>
<li>å¯¹äºä½ç½® (i, j) çš„å…ƒç´ ï¼Œæ—‹è½¬åå®ƒå°†ä½äº (j, n-1-i)</li>
</ul>
<p>è¿™ä¸ªè§„å¾‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç›´æ¥äº¤æ¢å…ƒç´ ï¼Œä½†ç›´æ¥è¿™æ ·æ“ä½œä¼šå¯¼è‡´è¦†ç›–å…¶ä»–å…ƒç´ ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨<strong>åˆ†è§£ä¸ºå¤šä¸ªç®€å•å˜æ¢</strong>çš„æ–¹æ³•ã€‚</p>
<h3 id="æ–¹æ³•ï¼šè½¬ç½®-æ°´å¹³ç¿»è½¬">æ–¹æ³•ï¼šè½¬ç½® + æ°´å¹³ç¿»è½¬</h3>
<p>è¿™ä¸ªæ–¹æ³•å°† 90 åº¦æ—‹è½¬åˆ†è§£ä¸ºä¸¤ä¸ªç®€å•çš„çŸ©é˜µæ“ä½œï¼š</p>
<ol>
<li><strong>çŸ©é˜µè½¬ç½®</strong>ï¼ˆæ²¿ä¸»å¯¹è§’çº¿ç¿»è½¬ï¼‰</li>
<li><strong>æ°´å¹³ç¿»è½¬</strong>ï¼ˆå·¦å³åˆ—äº¤æ¢ï¼‰</li>
</ol>
<h4 id="æ­¥éª¤è¯¦è§£ï¼š">æ­¥éª¤è¯¦è§£ï¼š</h4>
<ol>
<li>
<p><strong>çŸ©é˜µè½¬ç½®</strong>ï¼š</p>
<ul>
<li>éå†çŸ©é˜µçš„ä¸€åŠï¼ˆå¯¹è§’çº¿ä»¥ä¸‹éƒ¨åˆ†ï¼‰ï¼Œäº¤æ¢ matrix[i][j] å’Œ matrix[j][i]</li>
<li>è¿™ä¸€æ­¥å°†è¡Œå˜ä¸ºåˆ—ï¼Œåˆ—å˜ä¸ºè¡Œ</li>
</ul>
</li>
<li>
<p><strong>æ°´å¹³ç¿»è½¬</strong>ï¼š</p>
<ul>
<li>å¯¹æ¯ä¸€è¡Œè¿›è¡Œå·¦å³ç¿»è½¬</li>
<li>å°†ç¬¬ j åˆ—å’Œç¬¬ n-1-j åˆ—äº¤æ¢</li>
</ul>
</li>
</ol>
<p>è¿™ä¸¤æ­¥æ“ä½œç»„åˆèµ·æ¥ï¼Œæ­£å¥½ç­‰åŒäºå°†çŸ©é˜µé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p>åŸå§‹çŸ©é˜µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br></pre></td></tr></table></figure>
<p>è½¬ç½®åï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 4 7</span><br><span class="line">2 5 8</span><br><span class="line">3 6 9</span><br></pre></td></tr></table></figure>
<p>æ°´å¹³ç¿»è½¬åï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">7 4 1</span><br><span class="line">8 5 2</span><br><span class="line">9 6 3</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆç»“æœæ­£æ˜¯åŸçŸ©é˜µé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦åçš„ç»“æœã€‚</p>
<h2 id="å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</h2>
<p>å®ç°è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>åœ¨è½¬ç½®æ“ä½œä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦éå†çŸ©é˜µçš„ä¸€åŠï¼ˆä¸»å¯¹è§’çº¿ä»¥ä¸‹çš„éƒ¨åˆ†ï¼‰ï¼Œé¿å…é‡å¤äº¤æ¢</li>
<li>åœ¨æ°´å¹³ç¿»è½¬ä¸­ï¼Œåªéœ€è¦éå†æ¯è¡Œçš„å‰ä¸€åŠåˆ—</li>
<li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸåœ°è¿›è¡Œçš„ï¼Œä¸éœ€è¦é¢å¤–çš„ç©ºé—´</li>
</ol>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rotate</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// å…ˆæ²¿ç€ä¸»å¯¹è§’çº¿è¿›è¡Œå¯¹ç§°åè½¬</span></span><br><span class="line">	n := <span class="built_in">len</span>(matrix)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; i; j++ &#123;</span><br><span class="line">			matrix[i][j], matrix[j][i] = matrix[j][i], matrix[i][j]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç„¶åæ¯ä¸€è¡Œè¿›è¡Œæ°´å¹³ç¿»è½¬</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; n/<span class="number">2</span>; j++ &#123;</span><br><span class="line">			matrix[i][n<span class="number">-1</span>-j], matrix[i][j] = matrix[i][j], matrix[i][n<span class="number">-1</span>-j]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(nÂ²)ï¼Œå…¶ä¸­ n æ˜¯çŸ©é˜µçš„è¾¹é•¿ã€‚éœ€è¦éå†æ•´ä¸ªçŸ©é˜µä¸¤æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)ï¼Œåªä½¿ç”¨äº†å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ã€‚</li>
</ul>
<h2 id="å…¶ä»–å¯èƒ½çš„æ–¹æ³•">å…¶ä»–å¯èƒ½çš„æ–¹æ³•</h2>
<p>é™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§æ—‹è½¬æ–¹æ³•ï¼š<strong>å±‚å±‚æ—‹è½¬</strong>ã€‚</p>
<p>æ­¤æ–¹æ³•çš„æ€è·¯æ˜¯ï¼š</p>
<ol>
<li>å°†çŸ©é˜µçœ‹ä½œç”±å¤šä¸ªåŒå¿ƒæ–¹å½¢ç¯ç»„æˆ</li>
<li>å¯¹æ¯ä¸€å±‚çš„å››æ¡è¾¹ä¸Šçš„å…ƒç´ è¿›è¡Œæ—‹è½¬äº¤æ¢</li>
<li>ä»å¤–åˆ°å†…ä¾æ¬¡å¤„ç†æ¯ä¸€å±‚</li>
</ol>
<p>ä»£ç å®ç°ä¼šç¨å¾®å¤æ‚ä¸€äº›ï¼Œéœ€è¦å°å¿ƒå¤„ç†ç´¢å¼•ï¼Œä½†æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ä¸ä¸Šè¿°æ–¹æ³•ç›¸åŒã€‚</p>
<h2 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>è½¬ç½®+æ°´å¹³ç¿»è½¬</th>
<th>å±‚å±‚æ—‹è½¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(nÂ²)</td>
<td>O(nÂ²)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>å®ç°ç®€å•ï¼Œæ€è·¯æ¸…æ™°</td>
<td>ç›´è§‚å¯¹åº”æ—‹è½¬è¿‡ç¨‹</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>åˆ†è§£ä¸ºä¸¤æ­¥ä¸ç›´è§‚</td>
<td>ç´¢å¼•å¤„ç†å¤æ‚</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ol>
<li><strong>çŸ©é˜µæ“ä½œçš„åˆ†è§£æ€æƒ³</strong>ï¼šå°†å¤æ‚çš„çŸ©é˜µæ“ä½œåˆ†è§£ä¸ºç®€å•æ“ä½œçš„ç»„åˆ</li>
<li><strong>åŸåœ°ç®—æ³•çš„å®ç°æŠ€å·§</strong>ï¼šå¦‚ä½•é€šè¿‡å…ƒç´ äº¤æ¢å®ç°ç©ºé—´ä¼˜åŒ–</li>
<li><strong>çŸ©é˜µè½¬ç½®å’Œæ°´å¹³ç¿»è½¬</strong>ï¼šè¿™æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„çŸ©é˜µæ“ä½œï¼Œåœ¨å…¶ä»–é—®é¢˜ä¸­ä¹Ÿç»å¸¸ç”¨åˆ°</li>
</ol>
<p>å¯¹äºçŸ©é˜µæ—‹è½¬é—®é¢˜ï¼Œå…³é”®æ˜¯æ‰¾åˆ°å…ƒç´ å˜æ¢å‰åä½ç½®çš„å¯¹åº”å…³ç³»ï¼Œç„¶ååˆ©ç”¨è¿™ç§å…³ç³»è®¾è®¡é«˜æ•ˆçš„ç®—æ³•ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>æ•°ç»„</tag>
        <tag>çŸ©é˜µ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 54 - èºæ—‹çŸ©é˜µï¼ˆSpiral Matrixï¼‰è§£é¢˜æ€è·¯ä¸é”™è¯¯åˆ†æ</title>
    <url>/2025/04/19/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-54-Spiral-Matrix/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ª m è¡Œ n åˆ—çš„çŸ©é˜µ <code>matrix</code> ï¼Œè¯·æŒ‰ç…§ <strong>é¡ºæ—¶é’ˆèºæ—‹é¡ºåº</strong> ï¼Œè¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix = [[1,2,3],[4,5,6],[7,8,9]]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3,6,9,8,7,4,5]</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œèºæ—‹é¡ºåºéå†çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â†’ â†’ â†’</span><br><span class="line">â†‘   â†“</span><br><span class="line">â†‘ â† â†“</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix = [[1,2,3,4],[5,6,7,8],[9,10,11,12]]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3,4,8,12,11,10,9,5,6,7]</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œèºæ—‹éå†çš„è·¯å¾„æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â†’ â†’ â†’ â†’</span><br><span class="line">â†‘     â†“</span><br><span class="line">â†‘ â† â† â†“</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>m == matrix.length</li>
<li>n == matrix[i].length</li>
<li>1 &lt;= m, n &lt;= 10</li>
<li>-100 &lt;= matrix[i][j] &lt;= 100</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>èºæ—‹çŸ©é˜µæ˜¯ä¸€ä¸ªå…¸å‹çš„æ•°ç»„éå†é—®é¢˜ï¼Œæ ¸å¿ƒåœ¨äºå¦‚ä½•æ§åˆ¶éå†çš„æ–¹å‘å’Œè¾¹ç•Œã€‚æˆ‘ä»¬éœ€è¦æŒ‰ç…§é¡ºæ—¶é’ˆèºæ—‹çš„é¡ºåºï¼ˆå³ â†’ ä¸‹ â†’ å·¦ â†’ ä¸Šï¼‰ä¾æ¬¡è®¿é—®çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šæŒ‰å±‚æ¨¡æ‹Ÿï¼ˆè¾¹ç•Œæ³•ï¼‰">æ–¹æ³•ä¸€ï¼šæŒ‰å±‚æ¨¡æ‹Ÿï¼ˆè¾¹ç•Œæ³•ï¼‰</h3>
<p>è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å°†æ•´ä¸ªçŸ©é˜µçœ‹ä½œç”±å¤šä¸ª&quot;ç¯&quot;ï¼ˆå±‚ï¼‰ç»„æˆï¼Œä»å¤–åˆ°å†…ä¸€å±‚ä¸€å±‚åœ°å‰¥ç¦»éå†</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/doocs/leetcode/main/solution/0000-0099/0054.Spiral%20Matrix/images/spiral1.jpg" alt="èºæ—‹çŸ©é˜µéå†ç¤ºæ„å›¾"></p>
<h4 id="æ­¥éª¤è¯¦è§£ï¼š">æ­¥éª¤è¯¦è§£ï¼š</h4>
<ol>
<li>
<p><strong>åˆå§‹åŒ–å››ä¸ªè¾¹ç•Œ</strong>ï¼š</p>
<ul>
<li><code>left</code> = 0ï¼šå·¦è¾¹ç•Œ</li>
<li><code>right</code> = åˆ—æ•°-1ï¼šå³è¾¹ç•Œ</li>
<li><code>top</code> = 0ï¼šä¸Šè¾¹ç•Œ</li>
<li><code>bottom</code> = è¡Œæ•°-1ï¼šä¸‹è¾¹ç•Œ</li>
</ul>
</li>
<li>
<p><strong>å¾ªç¯éå†å„å±‚</strong>ï¼Œç›´åˆ° <code>left &gt; right</code> æˆ– <code>top &gt; bottom</code>ï¼š</p>
<p>a. <strong>ä»å·¦åˆ°å³</strong>éå†ä¸Šè¾¹ç•Œä¸Šçš„å…ƒç´ ï¼š</p>
<ul>
<li>éå† <code>matrix[top][j]</code>ï¼Œå…¶ä¸­ <code>j</code> ä» <code>left</code> åˆ° <code>right</code></li>
<li>éå†å®Œåï¼Œä¸Šè¾¹ç•Œä¸‹ç§»ï¼š<code>top++</code></li>
</ul>
<p>b. <strong>ä»ä¸Šåˆ°ä¸‹</strong>éå†å³è¾¹ç•Œä¸Šçš„å…ƒç´ ï¼š</p>
<ul>
<li>éå† <code>matrix[i][right]</code>ï¼Œå…¶ä¸­ <code>i</code> ä» <code>top</code> åˆ° <code>bottom</code></li>
<li>éå†å®Œåï¼Œå³è¾¹ç•Œå·¦ç§»ï¼š<code>right--</code></li>
</ul>
<p>c. <strong>æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è¡Œéœ€è¦éå†</strong>ï¼ˆé˜²æ­¢å•è¡Œæƒ…å†µé‡å¤éå†ï¼‰ï¼š</p>
<ul>
<li>å¦‚æœ <code>top &lt;= bottom</code>ï¼Œ<strong>ä»å³åˆ°å·¦</strong>éå†ä¸‹è¾¹ç•Œä¸Šçš„å…ƒç´ ï¼š</li>
<li>éå† <code>matrix[bottom][j]</code>ï¼Œå…¶ä¸­ <code>j</code> ä» <code>right</code> åˆ° <code>left</code></li>
<li>éå†å®Œåï¼Œä¸‹è¾¹ç•Œä¸Šç§»ï¼š<code>bottom--</code></li>
</ul>
<p>d. <strong>æ£€æŸ¥æ˜¯å¦è¿˜æœ‰åˆ—éœ€è¦éå†</strong>ï¼ˆé˜²æ­¢å•åˆ—æƒ…å†µé‡å¤éå†ï¼‰ï¼š</p>
<ul>
<li>å¦‚æœ <code>left &lt;= right</code>ï¼Œ<strong>ä»ä¸‹åˆ°ä¸Š</strong>éå†å·¦è¾¹ç•Œä¸Šçš„å…ƒç´ ï¼š</li>
<li>éå† <code>matrix[i][left]</code>ï¼Œå…¶ä¸­ <code>i</code> ä» <code>bottom</code> åˆ° <code>top</code></li>
<li>éå†å®Œåï¼Œå·¦è¾¹ç•Œå³ç§»ï¼š<code>left++</code></li>
</ul>
</li>
<li>
<p>é‡å¤ç¬¬ 2 æ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ éƒ½è¢«éå†å®Œã€‚</p>
</li>
</ol>
<h4 id="å…³é”®æ³¨æ„ç‚¹ï¼š">å…³é”®æ³¨æ„ç‚¹ï¼š</h4>
<ul>
<li>åœ¨æ¯ä¸€è½®éå†ä¸­ï¼Œè¾¹ç•Œä¼šæ”¶ç¼©ï¼Œå½¢æˆä¸€ä¸ªé€æ¸ç¼©å°çš„çŸ©å½¢</li>
<li>éœ€è¦ç‰¹åˆ«æ³¨æ„å•è¡Œæˆ–å•åˆ—çš„æƒ…å†µï¼Œé¿å…é‡å¤è®¿é—®å…ƒç´ </li>
</ul>
<h3 id="æ–¹æ³•äºŒï¼šæ–¹å‘æ•°ç»„æ³•">æ–¹æ³•äºŒï¼šæ–¹å‘æ•°ç»„æ³•</h3>
<p>è¿™ç§æ–¹æ³•ä½¿ç”¨æ–¹å‘æ•°ç»„æ¥æ¨¡æ‹Ÿèºæ—‹è¿‡ç¨‹ï¼Œå…³é”®åœ¨äºçŸ¥é“ä½•æ—¶æ”¹å˜æ–¹å‘ã€‚</p>
<h4 id="æ­¥éª¤è¯¦è§£ï¼š-2">æ­¥éª¤è¯¦è§£ï¼š</h4>
<ol>
<li>
<p><strong>å®šä¹‰æ–¹å‘æ•°ç»„</strong>ï¼šè¡¨ç¤ºå››ç§ç§»åŠ¨æ–¹å‘ï¼ˆå³ã€ä¸‹ã€å·¦ã€ä¸Šï¼‰</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">directions := [][]<span class="type">int</span>&#123;&#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>åˆ›å»ºè®¿é—®æ ‡è®°æ•°ç»„</strong>ï¼šé¿å…é‡å¤è®¿é—®</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">visited := <span class="built_in">make</span>([][]<span class="type">bool</span>, rows)</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> visited &#123;</span><br><span class="line">    visited[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, cols)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>éå†çŸ©é˜µ</strong>ï¼š</p>
<ul>
<li>ä»(0,0)å¼€å§‹ï¼ŒæŒ‰å½“å‰æ–¹å‘ç§»åŠ¨</li>
<li>è®°å½•å·²è®¿é—®çš„ä½ç½®</li>
<li>å½“éœ€è¦è½¬å‘æ—¶ï¼ˆå³ä¸‹ä¸€æ­¥ä¼šè¶Šç•Œæˆ–å·²è®¿é—®è¿‡ï¼‰ï¼Œé¡ºæ—¶é’ˆæ—‹è½¬æ–¹å‘</li>
</ul>
</li>
</ol>
<h2 id="æˆ‘çš„é”™è¯¯å®ç°åŠåˆ†æ">æˆ‘çš„é”™è¯¯å®ç°åŠåˆ†æ</h2>
<p>æˆ‘æœ€åˆçš„å®ç°é‡‡ç”¨äº†æ–¹å‘æ•°ç»„çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiralOrder</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    row := <span class="built_in">len</span>(matrix)</span><br><span class="line">    col := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    dirX, dirY := []<span class="type">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;, []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>&#125;</span><br><span class="line">    index := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    x, y, cnt := <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    res := <span class="built_in">make</span>([]<span class="type">int</span>, row*col)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> cnt &lt; row*col &#123;</span><br><span class="line">        res[cnt] = matrix[x][y]</span><br><span class="line">        nextX := x + dirX[index]</span><br><span class="line">        nextY := y + dirY[index]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> nextX &lt; <span class="number">0</span> || nextX &gt;= row || nextY &lt; <span class="number">0</span> || nextY &gt;= col &#123;</span><br><span class="line">            index = (index + <span class="number">1</span>) % <span class="number">4</span></span><br><span class="line">            nextX = x + dirX[index]</span><br><span class="line">            nextY = y + dirY[index]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        x = nextX</span><br><span class="line">        y = nextY</span><br><span class="line">        cnt++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åˆ†æï¼š">é”™è¯¯åˆ†æï¼š</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥åˆ†æè¿™æ®µä»£ç çš„é—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [1,2,3],</span><br><span class="line">  [4,5,6],</span><br><span class="line">  [7,8,9]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§ä»£ç çš„æ‰§è¡Œé€»è¾‘ï¼š</p>
<ol>
<li>é¦–å…ˆè®¿é—® (0,0)ï¼šå€¼ä¸º 1ï¼Œæ·»åŠ åˆ°ç»“æœ</li>
<li>æŒ‰ç…§å³æ–¹å‘ç§»åŠ¨åˆ° (0,1)ï¼šå€¼ä¸º 2ï¼Œæ·»åŠ åˆ°ç»“æœ</li>
<li>ç»§ç»­æŒ‰ç…§å³æ–¹å‘ç§»åŠ¨åˆ° (0,2)ï¼šå€¼ä¸º 3ï¼Œæ·»åŠ åˆ°ç»“æœ</li>
<li>ç»§ç»­æŒ‰ç…§å³æ–¹å‘å°è¯•ç§»åŠ¨åˆ° (0,3)ï¼Œä½†è¿™è¶…å‡ºäº†è¾¹ç•Œ</li>
<li>æ”¹å˜æ–¹å‘ä¸ºä¸‹ï¼Œç§»åŠ¨åˆ° (1,2)ï¼šå€¼ä¸º 6ï¼Œæ·»åŠ åˆ°ç»“æœ</li>
<li>ç»§ç»­æŒ‰ç…§ä¸‹æ–¹å‘ç§»åŠ¨åˆ° (2,2)ï¼šå€¼ä¸º 9ï¼Œæ·»åŠ åˆ°ç»“æœ</li>
<li>ç»§ç»­æŒ‰ç…§ä¸‹æ–¹å‘å°è¯•ç§»åŠ¨åˆ° (3,2)ï¼Œä½†è¿™è¶…å‡ºäº†è¾¹ç•Œ</li>
<li>æ”¹å˜æ–¹å‘ä¸ºå·¦ï¼Œç§»åŠ¨åˆ° (2,1)ï¼šå€¼ä¸º 8ï¼Œæ·»åŠ åˆ°ç»“æœ</li>
<li>ç»§ç»­æŒ‰ç…§å·¦æ–¹å‘ç§»åŠ¨åˆ° (2,0)ï¼šå€¼ä¸º 7ï¼Œæ·»åŠ åˆ°ç»“æœ</li>
<li>ç»§ç»­æŒ‰ç…§å·¦æ–¹å‘å°è¯•ç§»åŠ¨åˆ° (2,-1)ï¼Œä½†è¿™è¶…å‡ºäº†è¾¹ç•Œ</li>
<li>æ”¹å˜æ–¹å‘ä¸ºä¸Šï¼Œç§»åŠ¨åˆ° (1,0)ï¼šå€¼ä¸º 4ï¼Œæ·»åŠ åˆ°ç»“æœ - <strong>è¿™é‡Œå‡ºç°äº†é—®é¢˜ï¼</strong></li>
</ol>
<p>æˆ‘ä»¬å†æ¬¡è®¿é—®äº† (0,0)ï¼Œé€ æˆäº†æ­»å¾ªç¯ï¼å› ä¸ºä»£ç åªæ£€æŸ¥äº†è¾¹ç•Œæ¡ä»¶ï¼Œæ²¡æœ‰æ£€æŸ¥æ˜¯å¦å·²ç»è®¿é—®è¿‡è¯¥ä½ç½®ã€‚æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æ•°ç»„æ¥æ ‡è®°å·²è®¿é—®çš„ä½ç½®ã€‚</p>
<h2 id="æˆ‘çš„å¦ä¸€ä¸ªé”™è¯¯å®ç°åŠåˆ†æ">æˆ‘çš„å¦ä¸€ä¸ªé”™è¯¯å®ç°åŠåˆ†æ</h2>
<p>åœ¨å°è¯•å®ç°è¾¹ç•Œæ³•çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è¿˜çŠ¯äº†å¦ä¸€ä¸ªå¸¸è§é”™è¯¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiralOrder</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    row := <span class="built_in">len</span>(matrix)</span><br><span class="line">    col := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    res := <span class="built_in">make</span>([]<span class="type">int</span>, row*col)</span><br><span class="line">    cnt := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    left, right, top, bottom := <span class="number">0</span>, col<span class="number">-1</span>, <span class="number">0</span>, row<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> cnt &lt; row*col &#123;</span><br><span class="line">        <span class="comment">// å‘å³éå†</span></span><br><span class="line">        <span class="keyword">for</span> i := left; i &lt;= right; i++ &#123;</span><br><span class="line">            res[cnt] = matrix[top][i]</span><br><span class="line">            cnt++</span><br><span class="line">        &#125;</span><br><span class="line">        top++</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘ä¸‹éå†</span></span><br><span class="line">        <span class="keyword">for</span> i := top; i &lt;= bottom; i++ &#123;</span><br><span class="line">            res[cnt] = matrix[i][right]</span><br><span class="line">            cnt++</span><br><span class="line">        &#125;</span><br><span class="line">        right--</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å·¦éå†</span></span><br><span class="line">        <span class="keyword">for</span> i := right; i &gt;= left; i-- &#123;</span><br><span class="line">            res[cnt] = matrix[bottom][i]</span><br><span class="line">            cnt++</span><br><span class="line">        &#125;</span><br><span class="line">        bottom--</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘ä¸Šéå†</span></span><br><span class="line">        <span class="keyword">for</span> i := bottom; i &gt;= top; i-- &#123;</span><br><span class="line">            res[cnt] = matrix[i][left]</span><br><span class="line">            cnt++</span><br><span class="line">        &#125;</span><br><span class="line">        left++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯åˆ†æï¼š-2">é”™è¯¯åˆ†æï¼š</h3>
<p>è¿™æ®µä»£ç çš„ä¸»è¦é—®é¢˜æ˜¯<strong>ç¼ºå°‘è¾¹ç•Œæ£€æŸ¥</strong>ã€‚ä»¥çŸ©é˜µ <code>[[1,2,3],[4,5,6]]</code>ï¼ˆ2 è¡Œ 3 åˆ—ï¼‰ä¸ºä¾‹ï¼Œåˆ†ææ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>åˆå§‹çŠ¶æ€ï¼š<code>left=0, right=2, top=0, bottom=1, cnt=0</code></li>
<li>å‘å³éå†ï¼šæ·»åŠ  <code>[1,2,3]</code>ï¼Œ<code>cnt=3, top=1</code></li>
<li>å‘ä¸‹éå†ï¼šæ·»åŠ  <code>[6]</code>ï¼Œ<code>cnt=4, right=1</code></li>
<li>å‘å·¦éå†ï¼šæ·»åŠ  <code>[5,4]</code>ï¼Œ<code>cnt=6, bottom=0</code></li>
<li><strong>é—®é¢˜å‡ºç°</strong>ï¼šæ­¤æ—¶ <code>top=1, bottom=0</code>ï¼Œå·²ç»äº¤å‰ï¼Œä½†ä»£ç æ²¡æœ‰æ£€æŸ¥å°±ç»§ç»­æ‰§è¡Œå‘ä¸Šéå†</li>
</ol>
<p>å½“ <code>top &gt; bottom</code> æˆ– <code>left &gt; right</code> æ—¶ï¼Œè¯´æ˜å½“å‰å±‚å·²ç»éå†å®Œæ¯•ï¼Œåº”è¯¥ç»“æŸå¾ªç¯ã€‚ä½†è¿™ä¸ªå®ç°ä¸­ç¼ºå°‘äº†è¿™ä¸€å…³é”®æ£€æŸ¥ï¼Œå¯¼è‡´åœ¨å•è¡Œæˆ–å•åˆ—ç­‰ç‰¹æ®Šæƒ…å†µä¸‹ä¼šé‡å¤è®¿é—®å…ƒç´ ï¼Œç”šè‡³å¯èƒ½å‘ç”Ÿæ•°ç»„è¶Šç•Œã€‚</p>
<p>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå½“çŸ©é˜µåªæœ‰ä¸€è¡Œæˆ–ä¸€åˆ—æ—¶ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªæ–¹å‘çš„éå†åï¼Œç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ªæ–¹å‘çš„éå†å¯èƒ½ä¼šé‡å¤å¤„ç†å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªå•è¡ŒçŸ©é˜µ <code>[[1,2,3]]</code>ï¼š</p>
<ol>
<li>å‘å³éå†å <code>top</code> å¢åŠ ï¼Œæ­¤æ—¶ <code>top &gt; bottom</code></li>
<li>ä½†ä»£ç ä»ä¼šæ‰§è¡Œå‘ä¸‹ã€å‘å·¦å’Œå‘ä¸Šéå†ï¼Œå¯¼è‡´è¶Šç•Œæˆ–é‡å¤è®¿é—®</li>
</ol>
<h3 id="ä¿®å¤æ–¹æ³•ï¼š">ä¿®å¤æ–¹æ³•ï¼š</h3>
<p>åœ¨æ¯ä¸ªæ–¹å‘éå†åï¼Œéœ€è¦æ£€æŸ¥æ›´æ–°åçš„è¾¹ç•Œæ¡ä»¶æ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiralOrderFixed</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(matrix) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> []<span class="type">int</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    row := <span class="built_in">len</span>(matrix)</span><br><span class="line">    col := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    res := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, row*col)</span><br><span class="line">    left, right, top, bottom := <span class="number">0</span>, col<span class="number">-1</span>, <span class="number">0</span>, row<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &amp;&amp; top &lt;= bottom &#123;</span><br><span class="line">        <span class="comment">// å‘å³éå†</span></span><br><span class="line">        <span class="keyword">for</span> i := left; i &lt;= right; i++ &#123;</span><br><span class="line">            res = <span class="built_in">append</span>(res, matrix[top][i])</span><br><span class="line">        &#125;</span><br><span class="line">        top++</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘ä¸‹éå†ï¼ˆéœ€è¦å…ˆæ£€æŸ¥è¾¹ç•Œï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> top &lt;= bottom &#123;</span><br><span class="line">            <span class="keyword">for</span> i := top; i &lt;= bottom; i++ &#123;</span><br><span class="line">                res = <span class="built_in">append</span>(res, matrix[i][right])</span><br><span class="line">            &#125;</span><br><span class="line">            right--</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å·¦éå†ï¼ˆéœ€è¦å…ˆæ£€æŸ¥è¾¹ç•Œï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> left &lt;= right &amp;&amp; top &lt;= bottom &#123;</span><br><span class="line">            <span class="keyword">for</span> i := right; i &gt;= left; i-- &#123;</span><br><span class="line">                res = <span class="built_in">append</span>(res, matrix[bottom][i])</span><br><span class="line">            &#125;</span><br><span class="line">            bottom--</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘ä¸Šéå†ï¼ˆéœ€è¦å…ˆæ£€æŸ¥è¾¹ç•Œï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> left &lt;= right &amp;&amp; top &lt;= bottom &#123;</span><br><span class="line">            <span class="keyword">for</span> i := bottom; i &gt;= top; i-- &#123;</span><br><span class="line">                res = <span class="built_in">append</span>(res, matrix[i][left])</span><br><span class="line">            &#125;</span><br><span class="line">            left++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯çš„æ ¹æœ¬åŸå› ï¼š">é”™è¯¯çš„æ ¹æœ¬åŸå› ï¼š</h3>
<p>è¿™ä¸ªé”™è¯¯çš„æ ¹æœ¬åŸå› æ˜¯<strong>æ²¡æœ‰è€ƒè™‘è¾¹ç•Œæ¡ä»¶</strong>ã€‚åœ¨å¤„ç†çŸ©é˜µç±»é—®é¢˜æ—¶ï¼Œå°¤å…¶éœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li><strong>è¾¹ç•Œäº¤å‰æ£€æŸ¥</strong>ï¼šç¡®ä¿ç´¢å¼•è¾¹ç•Œï¼ˆå¦‚ <code>left &lt;= right</code> å’Œ <code>top &lt;= bottom</code>ï¼‰å§‹ç»ˆæœ‰æ•ˆ</li>
<li><strong>ç‰¹æ®Šæƒ…å†µå¤„ç†</strong>ï¼šçŸ©é˜µå¯èƒ½æ˜¯å•è¡Œã€å•åˆ—ã€ç”šè‡³ç©ºçŸ©é˜µ</li>
<li><strong>æ–¹å‘è½¬æ¢æ¡ä»¶</strong>ï¼šæ¯æ¬¡æ”¹å˜éå†æ–¹å‘å‰éœ€è¦éªŒè¯è¿˜æœ‰å…ƒç´ éœ€è¦éå†</li>
</ol>
<p>è¿™æ˜¯çŸ©é˜µéå†é—®é¢˜ä¸­æœ€å®¹æ˜“è¢«å¿½è§†çš„ç»†èŠ‚ï¼Œä¹Ÿæ˜¯å¯¼è‡´ä»£ç å‡ºé”™çš„å¸¸è§åŸå› ã€‚</p>
<h2 id="æ­£ç¡®å®ç°">æ­£ç¡®å®ç°</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šæŒ‰å±‚æ¨¡æ‹Ÿï¼ˆæ¨èï¼‰">æ–¹æ³•ä¸€ï¼šæŒ‰å±‚æ¨¡æ‹Ÿï¼ˆæ¨èï¼‰</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiralOrder</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    row := <span class="built_in">len</span>(matrix)</span><br><span class="line">    col := <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    res := <span class="built_in">make</span>([]<span class="type">int</span>, row*col)</span><br><span class="line">    cnt := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å››ä¸ªè¾¹ç•Œ</span></span><br><span class="line">    left, right, top, bottom := <span class="number">0</span>, col<span class="number">-1</span>, <span class="number">0</span>, row<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> left &lt;= right &amp;&amp; top &lt;= bottom &#123;</span><br><span class="line">        <span class="comment">// 1. ä»å·¦åˆ°å³éå†ä¸Šè¾¹ç•Œ</span></span><br><span class="line">        <span class="keyword">for</span> i := left; i &lt;= right; i++ &#123;</span><br><span class="line">            res[cnt] = matrix[top][i]</span><br><span class="line">            cnt++</span><br><span class="line">        &#125;</span><br><span class="line">        top++ <span class="comment">// ä¸Šè¾¹ç•Œä¸‹ç§»ä¸€è¡Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. ä»ä¸Šåˆ°ä¸‹éå†å³è¾¹ç•Œ</span></span><br><span class="line">        <span class="keyword">for</span> i := top; i &lt;= bottom; i++ &#123;</span><br><span class="line">            res[cnt] = matrix[i][right]</span><br><span class="line">            cnt++</span><br><span class="line">        &#125;</span><br><span class="line">        right-- <span class="comment">// å³è¾¹ç•Œå·¦ç§»ä¸€åˆ—</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. ä»å³åˆ°å·¦éå†ä¸‹è¾¹ç•Œï¼ˆéœ€è¦æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è¡Œè¦éå†ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> top &lt;= bottom &#123;</span><br><span class="line">            <span class="keyword">for</span> i := right; i &gt;= left; i-- &#123;</span><br><span class="line">                res[cnt] = matrix[bottom][i]</span><br><span class="line">                cnt++</span><br><span class="line">            &#125;</span><br><span class="line">            bottom-- <span class="comment">// ä¸‹è¾¹ç•Œä¸Šç§»ä¸€è¡Œ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. ä»ä¸‹åˆ°ä¸Šéå†å·¦è¾¹ç•Œï¼ˆéœ€è¦æ£€æŸ¥æ˜¯å¦è¿˜æœ‰åˆ—è¦éå†ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> left &lt;= right &#123;</span><br><span class="line">            <span class="keyword">for</span> i := bottom; i &gt;= top; i-- &#123;</span><br><span class="line">                res[cnt] = matrix[i][left]</span><br><span class="line">                cnt++</span><br><span class="line">            &#125;</span><br><span class="line">            left++ <span class="comment">// å·¦è¾¹ç•Œå³ç§»ä¸€åˆ—</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼š">æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼š</h4>
<p>å¯¹äºç¤ºä¾‹çŸ©é˜µ <code>[[1,2,3],[4,5,6],[7,8,9]]</code>ï¼š</p>
<p><strong>ç¬¬ä¸€è½®å¾ªç¯</strong>ï¼š</p>
<ul>
<li>åˆå§‹è¾¹ç•Œï¼š<code>left=0, right=2, top=0, bottom=2</code></li>
<li>ä»å·¦åˆ°å³ï¼šæ·»åŠ  <code>[1,2,3]</code>ï¼Œ<code>top</code> å˜ä¸º 1</li>
<li>ä»ä¸Šåˆ°ä¸‹ï¼šæ·»åŠ  <code>[6,9]</code>ï¼Œ<code>right</code> å˜ä¸º 1</li>
<li>ä»å³åˆ°å·¦ï¼šæ·»åŠ  <code>[8,7]</code>ï¼Œ<code>bottom</code> å˜ä¸º 1</li>
<li>ä»ä¸‹åˆ°ä¸Šï¼šæ·»åŠ  <code>[4]</code>ï¼Œ<code>left</code> å˜ä¸º 1</li>
</ul>
<p><strong>ç¬¬äºŒè½®å¾ªç¯</strong>ï¼š</p>
<ul>
<li>è¾¹ç•Œï¼š<code>left=1, right=1, top=1, bottom=1</code></li>
<li>ä»å·¦åˆ°å³ï¼šæ·»åŠ  <code>[5]</code></li>
<li>ç»“æŸå¾ªç¯ï¼Œå› ä¸ºæ‰€æœ‰å…ƒç´ éƒ½å·²è®¿é—®</li>
</ul>
<p>æœ€ç»ˆç»“æœï¼š<code>[1,2,3,6,9,8,7,4,5]</code></p>
<h3 id="æ–¹æ³•äºŒï¼šæ”¹è¿›çš„æ–¹å‘æ•°ç»„æ–¹æ³•">æ–¹æ³•äºŒï¼šæ”¹è¿›çš„æ–¹å‘æ•°ç»„æ–¹æ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiralOrder</span><span class="params">(matrix [][]<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    rows, cols := <span class="built_in">len</span>(matrix), <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">    total := rows * cols</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç»“æœæ•°ç»„</span></span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="type">int</span>, total)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºè®¿é—®æ ‡è®°æ•°ç»„</span></span><br><span class="line">    visited := <span class="built_in">make</span>([][]<span class="type">bool</span>, rows)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> visited &#123;</span><br><span class="line">        visited[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, cols)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰å››ä¸ªæ–¹å‘ï¼šå³ã€ä¸‹ã€å·¦ã€ä¸Š</span></span><br><span class="line">    directions := [][]<span class="type">int</span>&#123;&#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;&#125;</span><br><span class="line">    dirIndex := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    row, col := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; total; i++ &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ å½“å‰å…ƒç´ åˆ°ç»“æœ</span></span><br><span class="line">        result[i] = matrix[row][col]</span><br><span class="line">        <span class="comment">// æ ‡è®°å½“å‰ä½ç½®ä¸ºå·²è®¿é—®</span></span><br><span class="line">        visited[row][col] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—ä¸‹ä¸€ä¸ªä½ç½®</span></span><br><span class="line">        nextRow, nextCol := row + directions[dirIndex][<span class="number">0</span>], col + directions[dirIndex][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦æ”¹å˜æ–¹å‘</span></span><br><span class="line">        <span class="keyword">if</span> nextRow &lt; <span class="number">0</span> || nextRow &gt;= rows || nextCol &lt; <span class="number">0</span> || nextCol &gt;= cols || visited[nextRow][nextCol] &#123;</span><br><span class="line">            <span class="comment">// æ”¹å˜æ–¹å‘ï¼ˆé¡ºæ—¶é’ˆï¼‰</span></span><br><span class="line">            dirIndex = (dirIndex + <span class="number">1</span>) % <span class="number">4</span></span><br><span class="line">            nextRow, nextCol = row + directions[dirIndex][<span class="number">0</span>], col + directions[dirIndex][<span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        row, col = nextRow, nextCol</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼š-2">æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼š</h4>
<p>å¯¹äºåŒæ ·çš„ç¤ºä¾‹ï¼Œæ–¹æ³•äºŒçš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>ä» (0,0) å¼€å§‹ï¼Œæ ‡è®°ä¸ºå·²è®¿é—®ï¼Œæ·»åŠ å€¼ 1</li>
<li>å½“å‰æ–¹å‘ä¸ºå³ï¼Œä¸‹ä¸€æ­¥æ˜¯ (0,1)ï¼Œæœ‰æ•ˆä¸”æœªè®¿é—®ï¼Œç§»åŠ¨å¹¶æ·»åŠ å€¼ 2</li>
<li>ç»§ç»­å‘å³åˆ° (0,2)ï¼Œæ·»åŠ å€¼ 3</li>
<li>å°è¯•ç»§ç»­å‘å³åˆ° (0,3)ï¼Œè¶…å‡ºè¾¹ç•Œï¼Œæ–¹å‘æ”¹ä¸ºå‘ä¸‹ï¼Œç§»åŠ¨åˆ° (1,2)ï¼Œæ·»åŠ å€¼ 6</li>
<li>ç»§ç»­å‘ä¸‹åˆ° (2,2)ï¼Œæ·»åŠ å€¼ 9</li>
<li>å°è¯•ç»§ç»­å‘ä¸‹ï¼Œè¶…å‡ºè¾¹ç•Œï¼Œæ–¹å‘æ”¹ä¸ºå‘å·¦ï¼Œç§»åŠ¨åˆ° (2,1)ï¼Œæ·»åŠ å€¼ 8</li>
<li>ç»§ç»­å‘å·¦åˆ° (2,0)ï¼Œæ·»åŠ å€¼ 7</li>
<li>å°è¯•ç»§ç»­å‘å·¦ï¼Œè¶…å‡ºè¾¹ç•Œï¼Œæ–¹å‘æ”¹ä¸ºå‘ä¸Šï¼Œç§»åŠ¨åˆ° (1,0)ï¼Œæ·»åŠ å€¼ 4</li>
<li>å°è¯•ç»§ç»­å‘ä¸Šåˆ° (0,0)ï¼Œå·²ç»è®¿é—®è¿‡ï¼Œæ–¹å‘æ”¹ä¸ºå‘å³ï¼Œç§»åŠ¨åˆ° (1,1)ï¼Œæ·»åŠ å€¼ 5</li>
<li>æ‰€æœ‰å•å…ƒæ ¼éƒ½å·²è®¿é—®ï¼Œç»“æŸå¾ªç¯</li>
</ol>
<p>æœ€ç»ˆç»“æœï¼š<code>[1,2,3,6,9,8,7,4,5]</code></p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>æŒ‰å±‚æ¨¡æ‹Ÿï¼ˆè¾¹ç•Œæ³•ï¼‰</th>
<th>æ–¹å‘æ•°ç»„æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ€è·¯</td>
<td>å°†çŸ©é˜µåˆ†ä¸ºå¤šå±‚ï¼Œç”±å¤–å‘å†…éå†</td>
<td>ä½¿ç”¨æ–¹å‘æ•°ç»„æ§åˆ¶ç§»åŠ¨ï¼Œé‡åˆ°è¾¹ç•Œæˆ–å·²è®¿é—®ä½ç½®æ—¶è½¬å‘</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(1)ï¼ˆä¸è®¡ç®—ç»“æœæ•°ç»„ï¼‰</td>
<td>O(mÃ—n)ï¼ˆéœ€è¦è®¿é—®æ ‡è®°æ•°ç»„ï¼‰</td>
</tr>
<tr>
<td>æ˜“ç†è§£æ€§</td>
<td>æ›´ç›´è§‚ï¼Œæ˜“äºå¯è§†åŒ–</td>
<td>éœ€è¦ç†è§£æ–¹å‘å˜åŒ–é€»è¾‘</td>
</tr>
<tr>
<td>å®ç°å¤æ‚åº¦</td>
<td>éœ€è¦å¤„ç†è¾¹ç•Œæ¡ä»¶å’Œå•è¡Œ/å•åˆ—æƒ…å†µ</td>
<td>éœ€è¦ç»´æŠ¤è®¿é—®æ ‡è®°</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<p>å¯¹äºä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(mÃ—n)ï¼Œå…¶ä¸­ m å’Œ n åˆ†åˆ«æ˜¯çŸ©é˜µçš„è¡Œæ•°å’Œåˆ—æ•°ã€‚çŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½è¢«è®¿é—®ä¸€æ¬¡ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š
<ul>
<li>æŒ‰å±‚æ¨¡æ‹Ÿï¼šO(1)ï¼Œåªéœ€è¦å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ï¼ˆä¸è®¡ç®—ç»“æœæ•°ç»„ï¼‰ã€‚</li>
<li>æ–¹å‘æ•°ç»„æ–¹æ³•ï¼šO(mÃ—n)ï¼Œéœ€è¦ä¸€ä¸ªä¸çŸ©é˜µå¤§å°ç›¸åŒçš„è®¿é—®æ ‡è®°æ•°ç»„ã€‚</li>
</ul>
</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>èºæ—‹çŸ©é˜µé—®é¢˜æ˜¯ä¸€ä¸ªç»å…¸çš„çŸ©é˜µéå†é—®é¢˜ï¼Œæœ‰ä¸¤ç§ä¸»è¦è§£æ³•ï¼š</p>
<ol>
<li><strong>æŒ‰å±‚æ¨¡æ‹Ÿï¼ˆè¾¹ç•Œæ³•ï¼‰</strong>ï¼šé€šè¿‡æ§åˆ¶å››ä¸ªè¾¹ç•Œï¼ˆå·¦ã€å³ã€ä¸Šã€ä¸‹ï¼‰æ¥æ¨¡æ‹Ÿèºæ—‹éå†è¿‡ç¨‹ï¼Œç©ºé—´æ•ˆç‡é«˜ï¼Œæ€è·¯ç›´è§‚ã€‚</li>
<li><strong>æ–¹å‘æ•°ç»„æ³•</strong>ï¼šä½¿ç”¨æ–¹å‘æ•°ç»„å’Œå·²è®¿é—®æ ‡è®°æ¥æ§åˆ¶éå†æ–¹å‘ï¼Œéœ€è¦é¢å¤–ç©ºé—´ä½†æ€è·¯ä¹Ÿè¾ƒä¸ºæ¸…æ™°ã€‚</li>
</ol>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒæŒ‰å±‚æ¨¡æ‹Ÿçš„æ–¹æ³•é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒä¸éœ€è¦é¢å¤–çš„è®¿é—®æ ‡è®°æ•°ç»„ï¼Œç©ºé—´å¤æ‚åº¦æ›´ä½ï¼Œå¹¶ä¸”é€»è¾‘ä¹Ÿç›¸å¯¹ç›´è§‚ã€‚</p>
<p>è¿™é“é¢˜ç›®çš„æ ¸å¿ƒåœ¨äºç†è§£å¦‚ä½•æ§åˆ¶è¾¹ç•Œå’Œæ–¹å‘ï¼Œä»¥åŠå¦‚ä½•å¤„ç†éå†è¿‡ç¨‹ä¸­çš„è¾¹ç•Œæƒ…å†µã€‚è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®æ˜¯æ¸…æ™°åœ°å®šä¹‰çŠ¶æ€å˜é‡å¹¶æ­£ç¡®åœ°æ›´æ–°å®ƒä»¬ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>Medium</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>æ•°ç»„</tag>
        <tag>çŸ©é˜µ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 42 - æ¥é›¨æ°´ï¼ˆTrapping Rain Waterï¼‰</title>
    <url>/2025/04/18/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-42-trapping-rain-water/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®š n ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šheight = [0,1,0,2,1,0,1,3,2,1,2,1]</span><br><span class="line">è¾“å‡ºï¼š6</span><br><span class="line">è§£é‡Šï¼šä¸Šé¢æ˜¯ç”±æ•°ç»„ [0,1,0,2,1,0,1,3,2,1,2,1] è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šheight = [4,2,0,3,2,5]</span><br><span class="line">è¾“å‡ºï¼š9</span><br></pre></td></tr></table></figure>
<p>ç¤ºæ„å›¾ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">       #</span><br><span class="line">#      #</span><br><span class="line">#  #   #</span><br><span class="line">#  #   #</span><br><span class="line">####  ##</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>n == height.length</li>
<li>1 &lt;= n &lt;= 2 * 10^4</li>
<li>0 &lt;= height[i] &lt;= 10^5</li>
</ul>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>æ¥é›¨æ°´é—®é¢˜çš„æ ¸å¿ƒåœ¨äºç†è§£ï¼š<strong>å¯¹äºæ¯ä¸ªä½ç½®ï¼Œå®ƒèƒ½æ¥çš„é›¨æ°´é‡ç­‰äºè¯¥ä½ç½®å·¦å³ä¸¤ä¾§æœ€é«˜æŸ±å­çš„è¾ƒå°å€¼å‡å»è¯¥ä½ç½®çš„é«˜åº¦</strong>ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜æœ‰å¤šç§è§£æ³•ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸‰ç§ä¸»è¦æ–¹æ³•ï¼šåŠ¨æ€è§„åˆ’ã€åŒæŒ‡é’ˆå’Œå•è°ƒæ ˆã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’">æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé¢„å¤„ç†æ¯ä¸ªä½ç½®çš„å·¦ä¾§æœ€å¤§é«˜åº¦å’Œå³ä¾§æœ€å¤§é«˜åº¦ï¼Œç„¶åè®¡ç®—æ¯ä¸ªä½ç½®èƒ½æ¥çš„é›¨æ°´é‡ã€‚</p>
<h4 id="æ­¥éª¤è¯¦è§£ï¼š">æ­¥éª¤è¯¦è§£ï¼š</h4>
<ol>
<li>åˆ›å»ºä¸¤ä¸ªæ•°ç»„ <code>leftMax</code> å’Œ <code>rightMax</code>ï¼Œåˆ†åˆ«å­˜å‚¨æ¯ä¸ªä½ç½®çš„å·¦ä¾§æœ€å¤§é«˜åº¦å’Œå³ä¾§æœ€å¤§é«˜åº¦</li>
<li>ä»å·¦åˆ°å³éå†æ•°ç»„ï¼Œè®¡ç®—æ¯ä¸ªä½ç½®çš„å·¦ä¾§æœ€å¤§é«˜åº¦</li>
<li>ä»å³åˆ°å·¦éå†æ•°ç»„ï¼Œè®¡ç®—æ¯ä¸ªä½ç½®çš„å³ä¾§æœ€å¤§é«˜åº¦</li>
<li>å†æ¬¡éå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªä½ç½® iï¼Œè®¡ç®— min(leftMax[i], rightMax[i]) - height[i]ï¼Œç´¯åŠ å¾—åˆ°æ€»é›¨æ°´é‡</li>
</ol>
<p>è¿™ç§æ–¹æ³•ç›´è§‚æ˜“æ‡‚ï¼Œé€‚åˆåˆå­¦è€…ç†è§£é—®é¢˜ã€‚</p>
<h3 id="æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆæ³•">æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆæ³•</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨å·¦å³ä¸¤ä¸ªæŒ‡é’ˆä»ä¸¤ç«¯å‘ä¸­é—´ç§»åŠ¨ï¼ŒåŒæ—¶è®°å½•å·¦å³ä¸¤ä¾§é‡åˆ°çš„æœ€å¤§é«˜åº¦ï¼Œä¼˜åŒ–ç©ºé—´å¤æ‚åº¦ã€‚</p>
<h4 id="æ­¥éª¤è¯¦è§£ï¼š-2">æ­¥éª¤è¯¦è§£ï¼š</h4>
<ol>
<li>åˆå§‹åŒ–å·¦æŒ‡é’ˆ <code>left = 0</code> å’Œå³æŒ‡é’ˆ <code>right = n-1</code></li>
<li>è®°å½•å·¦ä¾§å’Œå³ä¾§çš„æœ€å¤§é«˜åº¦ <code>leftMax = 0</code> å’Œ <code>rightMax = 0</code></li>
<li>å½“å·¦æŒ‡é’ˆå°äºå³æŒ‡é’ˆæ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
<ul>
<li>å¦‚æœ height[left] &lt; height[right]ï¼š
<ul>
<li>å¦‚æœ height[left] &gt;= leftMaxï¼Œæ›´æ–° leftMax</li>
<li>å¦åˆ™ï¼Œç´¯åŠ  leftMax - height[left] åˆ°ç»“æœä¸­</li>
<li>å·¦æŒ‡é’ˆå‘å³ç§»åŠ¨</li>
</ul>
</li>
<li>å¦åˆ™ï¼š
<ul>
<li>å¦‚æœ height[right] &gt;= rightMaxï¼Œæ›´æ–° rightMax</li>
<li>å¦åˆ™ï¼Œç´¯åŠ  rightMax - height[right] åˆ°ç»“æœä¸­</li>
<li>å³æŒ‡é’ˆå‘å·¦ç§»åŠ¨</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>è¿™ç§æ–¹æ³•ä¼˜åŒ–äº†ç©ºé—´å¤æ‚åº¦ï¼Œåªéœ€è¦å¸¸æ•°é¢å¤–ç©ºé—´ã€‚</p>
<h3 id="æ–¹æ³•ä¸‰ï¼šå•è°ƒæ ˆ">æ–¹æ³•ä¸‰ï¼šå•è°ƒæ ˆ</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä½¿ç”¨å•è°ƒé€’å‡æ ˆæ¥æ‰¾åˆ°&quot;å‡¹&quot;å½¢åŒºåŸŸï¼Œè®¡ç®—èƒ½æ¥çš„é›¨æ°´é‡ã€‚</p>
<h4 id="æ­¥éª¤è¯¦è§£ï¼š-3">æ­¥éª¤è¯¦è§£ï¼š</h4>
<ol>
<li>ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡æ ˆï¼Œæ ˆä¸­å­˜å‚¨æŸ±å­çš„ä¸‹æ ‡</li>
<li>éå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªæŸ±å­ï¼š
<ul>
<li>å½“æ ˆä¸ä¸ºç©ºä¸”å½“å‰æŸ±å­é«˜åº¦å¤§äºæ ˆé¡¶æŸ±å­é«˜åº¦æ—¶ï¼š
<ul>
<li>å¼¹å‡ºæ ˆé¡¶å…ƒç´  topï¼ˆä½œä¸ºå‡¹æ§½çš„åº•éƒ¨ï¼‰</li>
<li>å¦‚æœæ ˆä¸ºç©ºï¼Œæ— æ³•å½¢æˆå‡¹æ§½ï¼Œç»§ç»­</li>
<li>è®¡ç®—å®½åº¦ï¼šå½“å‰ä¸‹æ ‡ - æ–°æ ˆé¡¶ä¸‹æ ‡ - 1</li>
<li>è®¡ç®—é«˜åº¦ï¼šmin(å½“å‰æŸ±å­é«˜åº¦, æ–°æ ˆé¡¶æŸ±å­é«˜åº¦) - åº•éƒ¨é«˜åº¦</li>
<li>ç´¯åŠ  å®½åº¦ Ã— é«˜åº¦ åˆ°ç»“æœä¸­</li>
</ul>
</li>
<li>å°†å½“å‰ä¸‹æ ‡å…¥æ ˆ</li>
</ul>
</li>
</ol>
<p>å•è°ƒæ ˆæ–¹æ³•é€‚åˆç†è§£é›¨æ°´ç§¯ç´¯çš„è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç†è§£&quot;å‡¹&quot;å½¢åŒºåŸŸçš„ç§¯æ°´è®¡ç®—ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’-2">æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">trap</span><span class="params">(height []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(height)</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¢„å¤„ç†å·¦å³æœ€å¤§é«˜åº¦</span></span><br><span class="line">    leftMax := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line">    rightMax := <span class="built_in">make</span>([]<span class="type">int</span>, n)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—æ¯ä¸ªä½ç½®çš„å·¦ä¾§æœ€å¤§é«˜åº¦</span></span><br><span class="line">    leftMax[<span class="number">0</span>] = height[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">        leftMax[i] = max(leftMax[i<span class="number">-1</span>], height[i])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—æ¯ä¸ªä½ç½®çš„å³ä¾§æœ€å¤§é«˜åº¦</span></span><br><span class="line">    rightMax[n<span class="number">-1</span>] = height[n<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">for</span> i := n<span class="number">-2</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        rightMax[i] = max(rightMax[i+<span class="number">1</span>], height[i])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—æ€»é›¨æ°´é‡</span></span><br><span class="line">    result := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        result += min(leftMax[i], rightMax[i]) - height[i]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &lt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆæ³•-2">æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆæ³•</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">trap</span><span class="params">(height []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    left, right := <span class="number">0</span>, <span class="built_in">len</span>(height)<span class="number">-1</span></span><br><span class="line">    leftMax, rightMax := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    result := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> left &lt; right &#123;</span><br><span class="line">        <span class="keyword">if</span> height[left] &lt; height[right] &#123;</span><br><span class="line">            <span class="keyword">if</span> height[left] &gt;= leftMax &#123;</span><br><span class="line">                leftMax = height[left]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result += leftMax - height[left]</span><br><span class="line">            &#125;</span><br><span class="line">            left++</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> height[right] &gt;= rightMax &#123;</span><br><span class="line">                rightMax = height[right]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result += rightMax - height[right]</span><br><span class="line">            &#125;</span><br><span class="line">            right--</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸‰ï¼šå•è°ƒæ ˆ-2">æ–¹æ³•ä¸‰ï¼šå•è°ƒæ ˆ</h3>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">trap</span><span class="params">(height []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(height)</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res := <span class="number">0</span></span><br><span class="line">    stack := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="comment">// å½“æ ˆä¸ä¸ºç©ºä¸”å½“å‰é«˜åº¦å¤§äºæ ˆé¡¶é«˜åº¦æ—¶ï¼Œå¯ä»¥å½¢æˆå‡¹æ§½</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &amp;&amp; height[i] &gt; height[stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]] &#123;</span><br><span class="line">            <span class="comment">// å¼¹å‡ºæ ˆé¡¶ï¼Œä½œä¸ºå‡¹æ§½åº•éƒ¨</span></span><br><span class="line">            top := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">            stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœæ ˆä¸ºç©ºï¼Œæ— æ³•å½¢æˆå‡¹æ§½</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(stack) &lt;= <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¡ç®—å‡¹æ§½çš„å®½åº¦å’Œé«˜åº¦</span></span><br><span class="line">            left := stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">            width := i - left - <span class="number">1</span></span><br><span class="line">            h := min(height[i], height[left]) - height[top]</span><br><span class="line">            res += width * h</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰ç´¢å¼•å…¥æ ˆ</span></span><br><span class="line">        stack = <span class="built_in">append</span>(stack, i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h2>
<p>ä»¥ç¤ºä¾‹ [0,1,0,2,1,0,1,3,2,1,2,1] åˆ†æåŒæŒ‡é’ˆæ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p><strong>åˆå§‹çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>left = 0, right = 11</li>
<li>leftMax = 0, rightMax = 0</li>
<li>result = 0</li>
</ul>
<p><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li>
<p>height[0] = 0 &lt; height[11] = 1</p>
<ul>
<li>leftMax = max(0, 0) = 0</li>
<li>result += 0 - 0 = 0</li>
<li>left = 1</li>
</ul>
</li>
<li>
<p>height[1] = 1 = height[11] = 1 (ç›¸ç­‰ï¼Œä»»é€‰ä¸€è¾¹)</p>
<ul>
<li>leftMax = max(0, 1) = 1</li>
<li>left = 2</li>
</ul>
</li>
<li>
<p>height[2] = 0 &lt; height[11] = 1</p>
<ul>
<li>result += 1 - 0 = 1</li>
<li>left = 3</li>
</ul>
</li>
<li>
<p>height[3] = 2 &gt; height[11] = 1</p>
<ul>
<li>rightMax = max(0, 1) = 1</li>
<li>result += 1 - 1 = 0</li>
<li>right = 10</li>
</ul>
</li>
<li>
<p>height[3] = 2 = height[10] = 2</p>
<ul>
<li>rightMax = max(1, 2) = 2</li>
<li>right = 9</li>
</ul>
</li>
</ol>
<p>â€¦ (ç»§ç»­æ‰§è¡Œç›´åˆ° left &gt;= right)</p>
<p><strong>æœ€ç»ˆç»“æœ</strong>ï¼šresult = 6</p>
<h2 id="æ–¹æ³•æ¯”è¾ƒ">æ–¹æ³•æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>åŠ¨æ€è§„åˆ’</th>
<th>åŒæŒ‡é’ˆæ³•</th>
<th>å•è°ƒæ ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>ç©ºé—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr>
<td>æ˜“ç†è§£æ€§</td>
<td>æœ€ç›´è§‚ï¼Œå®¹æ˜“ç†è§£</td>
<td>æŠ½è±¡ï¼Œéœ€è¦ç†è§£å·¦å³è¾¹ç•Œ</td>
<td>é€‚åˆç†è§£å‡¹æ§½ç§¯æ°´è¿‡ç¨‹</td>
</tr>
<tr>
<td>å®ç°å¤æ‚åº¦</td>
<td>ç®€å•</td>
<td>ä¸­ç­‰</td>
<td>è¾ƒå¤æ‚</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>æ€è·¯æ¸…æ™°</td>
<td>ç©ºé—´æ•ˆç‡æœ€é«˜</td>
<td>èƒ½å¤„ç†å¤šç§åœ°å½¢</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>éœ€è¦é¢å¤–ç©ºé—´</td>
<td>æ€è·¯ä¸å¤Ÿç›´è§‚</td>
<td>å®ç°å¤æ‚</td>
</tr>
<tr>
<td>æ¨èåº¦</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
</tr>
</tbody>
</table>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>åŠ¨æ€è§„åˆ’ï¼šO(n)ï¼Œéœ€è¦ä¸‰æ¬¡éå†æ•°ç»„</li>
<li>åŒæŒ‡é’ˆï¼šO(n)ï¼Œåªéœ€ä¸€æ¬¡éå†</li>
<li>å•è°ƒæ ˆï¼šO(n)ï¼Œæ¯ä¸ªå…ƒç´ æœ€å¤šå…¥æ ˆå‡ºæ ˆå„ä¸€æ¬¡</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š</p>
<ul>
<li>åŠ¨æ€è§„åˆ’ï¼šO(n)ï¼Œéœ€è¦ä¸¤ä¸ªé¢å¤–æ•°ç»„</li>
<li>åŒæŒ‡é’ˆï¼šO(1)ï¼Œåªä½¿ç”¨å¸¸æ•°é¢å¤–ç©ºé—´</li>
<li>å•è°ƒæ ˆï¼šO(n)ï¼Œæœ€åæƒ…å†µä¸‹æ ˆçš„å¤§å°ä¸º n</li>
</ul>
</li>
</ul>
<h2 id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h2>
<ol>
<li><strong>ç†è§£ç§¯æ°´æ¡ä»¶</strong>ï¼šå¯¹äºä½ç½® iï¼Œèƒ½æ¥çš„æ°´é‡å–å†³äº min(å·¦ä¾§æœ€é«˜ï¼Œå³ä¾§æœ€é«˜) - å½“å‰é«˜åº¦</li>
<li><strong>ä¼˜åŒ–æ€è·¯</strong>ï¼šä»ç©ºé—´ O(n) åˆ° O(1) çš„ä¼˜åŒ–æ˜¯æœ¬é¢˜çš„ä¸€ä¸ªäº®ç‚¹</li>
<li><strong>åŒæŒ‡é’ˆæŠ€å·§</strong>ï¼šåˆ©ç”¨åŒæŒ‡é’ˆé¿å…ä½¿ç”¨é¢å¤–ç©ºé—´ï¼Œæ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„é‡è¦æŠ€å·§</li>
</ol>
<h2 id="ç›¸å…³é¢˜ç›®">ç›¸å…³é¢˜ç›®</h2>
<ul>
<li>LeetCode 11: ç››æœ€å¤šæ°´çš„å®¹å™¨</li>
<li>LeetCode 407: æ¥é›¨æ°´ IIï¼ˆä¸‰ç»´ç‰ˆæœ¬ï¼‰</li>
<li>LeetCode 238: é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ï¼ˆç±»ä¼¼çš„é¢„å¤„ç†æ€æƒ³ï¼‰</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æ¥é›¨æ°´é—®é¢˜å±•ç¤ºäº†å¤šç§ç®—æ³•æ€æƒ³ï¼šåŠ¨æ€è§„åˆ’çš„é¢„å¤„ç†ã€åŒæŒ‡é’ˆçš„ç©ºé—´ä¼˜åŒ–ã€å•è°ƒæ ˆå¤„ç†ç‰¹å®šå½¢çŠ¶ã€‚é€šè¿‡åˆ†ææ¯ä¸ªä½ç½®èƒ½æ¥çš„é›¨æ°´é‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ•´ä½“çš„ç»“æœã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒåŒæŒ‡é’ˆæ³•å› å…¶ O(1) çš„ç©ºé—´å¤æ‚åº¦è€Œè¢«è®¤ä¸ºæ˜¯æœ€ä¼˜è§£ï¼Œä½†åŠ¨æ€è§„åˆ’æ³•æ›´æ˜“äºç†è§£å’Œå®ç°ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>åŠ¨æ€è§„åˆ’</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>Hard</tag>
        <tag>æ•°ç»„</tag>
        <tag>åŒæŒ‡é’ˆ</tag>
        <tag>å•è°ƒæ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 41 - ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°ï¼ˆFirst Missing Positiveï¼‰</title>
    <url>/2025/04/18/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-41-first-missing-positive/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™ä½ ä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­æ²¡æœ‰å‡ºç°çš„æœ€å°çš„æ­£æ•´æ•°ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,2,0]</span><br><span class="line">è¾“å‡ºï¼š3</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [3,4,-1,1]</span><br><span class="line">è¾“å‡ºï¼š2</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [7,8,9,11,12]</span><br><span class="line">è¾“å‡ºï¼š1</span><br></pre></td></tr></table></figure>
<p><strong>çº¦æŸæ¡ä»¶ï¼š</strong></p>
<ul>
<li>1 &lt;= nums.length &lt;= 5 * 10^5</li>
<li>-2^31 &lt;= nums[i] &lt;= 2^31 - 1</li>
</ul>
<p>è¯·ä½ å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) å¹¶ä¸”åªä½¿ç”¨å¸¸æ•°çº§åˆ«é¢å¤–ç©ºé—´çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™é“é¢˜çš„å…³é”®åœ¨äºç†è§£ä¸€ä¸ªé‡è¦çš„æ€§è´¨ï¼š<strong>å¦‚æœé•¿åº¦ä¸º n çš„æ•°ç»„åŒ…å«æ‰€æœ‰ 1 åˆ° n çš„æ•°å­—ï¼Œé‚£ä¹ˆç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°å°±æ˜¯ n+1ã€‚å¦‚æœå­˜åœ¨ç¼ºå¤±ï¼Œé‚£ä¹ˆç­”æ¡ˆä¸€å®šåœ¨ 1 åˆ° n+1 ä¹‹é—´ã€‚</strong></p>
<p>åŸºäºè¿™ä¸ªæ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°ç»„æœ¬èº«ä½œä¸ºå“ˆå¸Œè¡¨ï¼Œå®ç°åŸåœ°å“ˆå¸Œã€‚æ€è·¯æ˜¯å°†å€¼ x æ”¾åˆ°ç´¢å¼• x-1 çš„ä½ç½®ï¼Œè¿™æ ·å½“æˆ‘ä»¬å†æ¬¡éå†æ•°ç»„æ—¶ï¼Œç¬¬ä¸€ä¸ªä¸æ»¡è¶³ nums[i] == i+1 çš„ä½ç½®å°±æ˜¯ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°ã€‚</p>
<h3 id="åŸåœ°å“ˆå¸Œçš„æ ¸å¿ƒæ€æƒ³">åŸåœ°å“ˆå¸Œçš„æ ¸å¿ƒæ€æƒ³</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå®Œç¾çš„æ•°ç»„ï¼Œå…¶ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nums[0] = 1</span><br><span class="line">nums[1] = 2</span><br><span class="line">nums[2] = 3</span><br><span class="line">...</span><br><span class="line">nums[i] = i+1</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„æ•°ç»„ä¸­ï¼Œæ¯ä¸ªæ­£æ•°éƒ½åœ¨&quot;å®¶&quot;ï¼ˆæ­£ç¡®çš„ä½ç½®ï¼‰ã€‚å¯¹äºå€¼ xï¼Œå®ƒçš„&quot;å®¶&quot;æ˜¯ç´¢å¼• x-1ã€‚</p>
<p>å½“æ•°ç»„ä¸­æœ‰ç¼ºå¤±çš„æ­£æ•°æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡æŸ¥æ‰¾å“ªä¸ªä½ç½®ä¸Šçš„æ•°ä¸æ˜¯&quot;åº”è¯¥åœ¨é‚£é‡Œçš„æ•°&quot;æ¥æ‰¾åˆ°ç­”æ¡ˆã€‚</p>
<h3 id="ç®—æ³•æ­¥éª¤ï¼š">ç®—æ³•æ­¥éª¤ï¼š</h3>
<ol>
<li>
<p><strong>åŸåœ°å“ˆå¸Œæ’åº</strong>ï¼š</p>
<ul>
<li>éå†æ•°ç»„ï¼Œå°†æ¯ä¸ªåœ¨ [1, n] èŒƒå›´å†…çš„æ•°æ”¾åˆ°å…¶å¯¹åº”çš„ä½ç½®</li>
<li>å¯¹äºæ¯ä¸ªå…ƒç´  nums[i]ï¼Œå¦‚æœ 1 â‰¤ nums[i] â‰¤ n å¹¶ä¸” nums[i] â‰  nums[nums[i]-1]ï¼Œåˆ™äº¤æ¢ nums[i] å’Œ nums[nums[i]-1]</li>
<li>ç»§ç»­æ£€æŸ¥äº¤æ¢åçš„ nums[i]ï¼Œç›´åˆ°ä¸éœ€è¦äº¤æ¢ä¸ºæ­¢</li>
</ul>
</li>
<li>
<p><strong>æŸ¥æ‰¾ç¼ºå¤±çš„æœ€å°æ­£æ•°</strong>ï¼š</p>
<ul>
<li>å†æ¬¡éå†æ•°ç»„ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ nums[i] = i+1 çš„ä½ç½®</li>
<li>è¯¥ä½ç½®çš„ç´¢å¼• +1 å°±æ˜¯ç­”æ¡ˆ</li>
</ul>
</li>
</ol>
<h3 id="å›¾ç¤ºè¯´æ˜">å›¾ç¤ºè¯´æ˜</h3>
<p>å¯¹äºæ•°ç»„ [3,4,-1,1]ï¼ŒåŸåœ°å“ˆå¸Œè¿‡ç¨‹ï¼š</p>
<p>åˆå§‹çŠ¶æ€: [ 3, 4, -1, 1]<br>
â†“<br>
æ’åºè¿‡ç¨‹: [-1, 1, 3, 4]<br>
â†“ â†“<br>
æœ€ç»ˆçŠ¶æ€: [ 1, -1, 3, 4]<br>
â†“<br>
ç¼ºå¤±çš„æ˜¯ 2</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">firstMissingPositive</span><span class="params">(nums []<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€é˜¶æ®µï¼šå°†æ¯ä¸ªæ•°æ”¾åˆ°æ­£ç¡®çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="comment">// nums[i] åº”è¯¥æ”¾åœ¨ç´¢å¼• nums[i]-1 çš„ä½ç½®</span></span><br><span class="line">        <span class="comment">// åªå¤„ç†åœ¨ [1,n] èŒƒå›´å†…çš„å€¼ï¼Œä¸”ç›®æ ‡ä½ç½®æ²¡æœ‰æ­£ç¡®çš„å€¼</span></span><br><span class="line">        <span class="keyword">for</span> nums[i] &gt; <span class="number">0</span> &amp;&amp; nums[i] &lt;= n &amp;&amp; nums[nums[i]<span class="number">-1</span>] != nums[i] &#123;</span><br><span class="line">            <span class="comment">// äº¤æ¢ nums[i] å’Œ nums[nums[i]-1]</span></span><br><span class="line">            nums[i], nums[nums[i]<span class="number">-1</span>] = nums[nums[i]<span class="number">-1</span>], nums[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬äºŒé˜¶æ®µï¼šæ‰¾å‡ºç¬¬ä¸€ä¸ªä¸æ»¡è¶³ nums[i] == i+1 çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> nums[i] != i+<span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ•°ç»„åŒ…å«äº† 1 åˆ° n çš„æ‰€æœ‰æ•°ï¼Œåˆ™ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°æ˜¯ n+1</span></span><br><span class="line">    <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ">æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h2>
<p>ä»¥æ•°ç»„ <code>[3, 4, -1, 1]</code> ä¸ºä¾‹ï¼Œè¯¦ç»†åˆ†ææ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p><strong>ç¬¬ä¸€é˜¶æ®µï¼šåŸåœ°å“ˆå¸Œæ’åº</strong></p>
<ol>
<li>i=0, nums[0]=3
<ul>
<li>3 åº”è¯¥åœ¨ç´¢å¼• 2 çš„ä½ç½®</li>
<li>äº¤æ¢ nums[0] å’Œ nums[2]ï¼š[3, 4, -1, 1] â†’ [-1, 4, 3, 1]</li>
</ul>
</li>
<li>i=0, nums[0]=-1
<ul>
<li>-1 ä¸åœ¨èŒƒå›´ [1, n] å†…ï¼Œè·³è¿‡</li>
</ul>
</li>
<li>i=1, nums[1]=4
<ul>
<li>4 åº”è¯¥åœ¨ç´¢å¼• 3 çš„ä½ç½®</li>
<li>äº¤æ¢ nums[1] å’Œ nums[3]ï¼š[-1, 4, 3, 1] â†’ [-1, 1, 3, 4]</li>
</ul>
</li>
<li>i=1, nums[1]=1
<ul>
<li>1 åº”è¯¥åœ¨ç´¢å¼• 0 çš„ä½ç½®</li>
<li>äº¤æ¢ nums[1] å’Œ nums[0]ï¼š[-1, 1, 3, 4] â†’ [1, -1, 3, 4]</li>
</ul>
</li>
<li>i=1, nums[1]=-1
<ul>
<li>-1 ä¸åœ¨èŒƒå›´ [1, n] å†…ï¼Œè·³è¿‡</li>
</ul>
</li>
<li>i=2, nums[2]=3
<ul>
<li>3 å·²ç»åœ¨æ­£ç¡®çš„ä½ç½®ï¼ˆç´¢å¼• 2ï¼‰ï¼Œè·³è¿‡</li>
</ul>
</li>
<li>i=3, nums[3]=4
<ul>
<li>4 å·²ç»åœ¨æ­£ç¡®çš„ä½ç½®ï¼ˆç´¢å¼• 3ï¼‰ï¼Œè·³è¿‡</li>
</ul>
</li>
</ol>
<p>æ’åºå®Œæˆåçš„æ•°ç»„ï¼š[1, -1, 3, 4]</p>
<p><strong>ç¬¬äºŒé˜¶æ®µï¼šæŸ¥æ‰¾ç¼ºå¤±çš„æœ€å°æ­£æ•°</strong></p>
<ol>
<li>i=0, nums[0]=1 == 0+1 âœ“</li>
<li>i=1, nums[1]=-1 != 1+1 âœ—</li>
</ol>
<p>æ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„ä½ç½® i=1ï¼Œå› æ­¤ç­”æ¡ˆæ˜¯ 1+1 = 2ã€‚</p>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)
<ul>
<li>è™½ç„¶æœ‰åµŒå¥—å¾ªç¯ï¼Œä½†æ¯ä¸ªå…ƒç´ æœ€å¤šè¢«äº¤æ¢ä¸€æ¬¡åˆ°æ­£ç¡®ä½ç½®ï¼Œä¸€æ—¦åˆ°è¾¾æ­£ç¡®ä½ç½®å°±ä¸ä¼šå†ç§»åŠ¨</li>
<li>ç¬¬äºŒæ¬¡éå†æ˜¯çº¿æ€§çš„ O(n)</li>
</ul>
</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)
<ul>
<li>åŸåœ°ä¿®æ”¹æ•°ç»„ï¼Œä¸ä½¿ç”¨é¢å¤–ç©ºé—´</li>
</ul>
</li>
</ul>
<h2 id="å¸¸è§é”™è¯¯ä¸ä¼˜åŒ–">å¸¸è§é”™è¯¯ä¸ä¼˜åŒ–</h2>
<ol>
<li>
<p><strong>æ­»å¾ªç¯é—®é¢˜</strong>ï¼š</p>
<ul>
<li>åœ¨å†…å±‚å¾ªç¯çš„äº¤æ¢æ¡ä»¶ä¸­ï¼Œå¿…é¡»åŒ…å« <code>nums[nums[i]-1] != nums[i]</code></li>
<li>å¦åˆ™å½“ nums[i] ç­‰äº nums[nums[i]-1] æ—¶ä¼šé™·å…¥æ— é™äº¤æ¢çš„æ­»å¾ªç¯</li>
</ul>
</li>
<li>
<p><strong>æå‰è¿”å›é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä¸èƒ½åœ¨ç¬¬ä¸€é˜¶æ®µç»“æŸå‰åˆ¤æ–­ç»“æœï¼Œå¿…é¡»å®Œæˆæ•´ä¸ªæ’åºè¿‡ç¨‹</li>
<li>å› ä¸ºæ•°ç»„å¯èƒ½è¿˜æ²¡æœ‰å®Œå…¨æ’å¥½åº</li>
</ul>
</li>
<li>
<p><strong>è¾¹ç•Œå¤„ç†</strong>ï¼š</p>
<ul>
<li>æ³¨æ„å¤„ç†è´Ÿæ•°å’Œè¶…å‡ºæ•°ç»„é•¿åº¦çš„å€¼ï¼Œå®ƒä»¬ä¸éœ€è¦å‚ä¸äº¤æ¢</li>
</ul>
</li>
</ol>
<h2 id="ç›¸å…³é¢˜ç›®">ç›¸å…³é¢˜ç›®</h2>
<ul>
<li>LeetCode 268: ä¸¢å¤±çš„æ•°å­—</li>
<li>LeetCode 287: å¯»æ‰¾é‡å¤æ•°</li>
<li>LeetCode 448: æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°é—®é¢˜æ˜¯ä¸€ä¸ªç»å…¸çš„åŸåœ°å“ˆå¸Œé—®é¢˜ã€‚å…³é”®æ´å¯Ÿåœ¨äºï¼šå¯¹äºé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œç­”æ¡ˆä¸€å®šåœ¨ 1 åˆ° n+1 ä¹‹é—´ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°ç»„æœ¬èº«ä½œä¸ºå“ˆå¸Œè¡¨ï¼Œå°†å€¼ x æ”¾åœ¨ç´¢å¼• x-1 çš„ä½ç½®ä¸Šã€‚</p>
<p>è¿™ç§æ–¹æ³•çš„ç²¾å¦™ä¹‹å¤„åœ¨äºå®ƒæ—¢æ»¡è¶³äº† O(n) çš„æ—¶é—´å¤æ‚åº¦è¦æ±‚ï¼Œåˆæ»¡è¶³äº† O(1) çš„ç©ºé—´å¤æ‚åº¦è¦æ±‚ã€‚å®ƒå±•ç¤ºäº†å¦‚ä½•é€šè¿‡å·§å¦™åœ°åˆ©ç”¨é—®é¢˜çº¦æŸæ¥è®¾è®¡é«˜æ•ˆç®—æ³•çš„æ€æƒ³ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ•°ç»„ä¸å“ˆå¸Œ</category>
      </categories>
      <tags>
        <tag>Hot100</tag>
        <tag>å“ˆå¸Œ</tag>
        <tag>Hard</tag>
        <tag>âŒé”™é¢˜é›†</tag>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode 34 - åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</title>
    <url>/2024/07/30/%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/LeetCode-34-%E5%9C%A8%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E4%BD%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>ç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ <code>target</code>ã€‚æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</p>
<p>å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ <code>target</code>ï¼Œè¿”å› <code>[-1, -1]</code>ã€‚</p>
<p><strong>è¿›é˜¶ï¼š</strong> ä½ å¯ä»¥è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<ul>
<li><strong>è¾“å…¥:</strong> <code>nums = [5,7,7,8,8,10]</code>, <code>target = 8</code></li>
<li><strong>è¾“å‡º:</strong> <code>[3,4]</code></li>
</ul>
<p><strong>ç¤ºä¾‹ 2:</strong></p>
<ul>
<li><strong>è¾“å…¥:</strong> <code>nums = [5,7,7,8,8,10]</code>, <code>target = 6</code></li>
<li><strong>è¾“å‡º:</strong> <code>[-1,-1]</code></li>
</ul>
<p><strong>ç¤ºä¾‹ 3:</strong></p>
<ul>
<li><strong>è¾“å…¥:</strong> <code>nums = []</code>, <code>target = 0</code></li>
<li><strong>è¾“å‡º:</strong> <code>[-1,-1]</code></li>
</ul>
<p><strong>çº¦æŸæ¡ä»¶:</strong></p>
<ul>
<li><code>0 &lt;= nums.length &lt;= 10^5</code></li>
<li><code>-10^9 &lt;= nums[i] &lt;= 10^9</code></li>
<li><code>nums</code> æ˜¯ä¸€ä¸ªéé€’å‡æ•°ç»„</li>
<li><code>-10^9 &lt;= target &lt;= 10^9</code></li>
</ul>
<h2 id="æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šä¸ºä½•é€‰æ‹©ä¸¤æ¬¡äºŒåˆ†æœç´¢ï¼Ÿ">æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šä¸ºä½•é€‰æ‹©ä¸¤æ¬¡äºŒåˆ†æœç´¢ï¼Ÿ</h2>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜å¹¶æ»¡è¶³ O(log n) çš„æ—¶é—´å¤æ‚åº¦ï¼Œ<strong>äºŒåˆ†æœç´¢</strong>æ˜¯å”¯ä¸€å¯è¡Œçš„è·¯å¾„ã€‚ä½†æ ‡å‡†çš„äºŒåˆ†æœç´¢åªèƒ½åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œæˆ–è€…æ‰¾åˆ°å®ƒçš„ä»»æ„ä¸€ä¸ªä½ç½®ã€‚æˆ‘ä»¬çš„é—®é¢˜æ›´å¤æ‚ï¼šéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯èƒ½é‡å¤å‡ºç°çš„ç›®æ ‡å€¼çš„<strong>ç¡®åˆ‡å·¦å³è¾¹ç•Œ</strong>ã€‚</p>
<h4 id="æ–¹æ¡ˆä¸€ï¼šä¸€æ¬¡äºŒåˆ†æœç´¢-çº¿æ€§æ‰«æï¼ˆè¢«å¦å†³ï¼‰">æ–¹æ¡ˆä¸€ï¼šä¸€æ¬¡äºŒåˆ†æœç´¢ + çº¿æ€§æ‰«æï¼ˆè¢«å¦å†³ï¼‰</h4>
<p>ä¸€ä¸ªè‡ªç„¶è€Œç„¶çš„æƒ³æ³•æ˜¯ï¼š</p>
<ol>
<li>ç”¨ä¸€æ¬¡æ ‡å‡†çš„äºŒåˆ†æœç´¢æ‰¾åˆ° <code>target</code> çš„<strong>ä»»æ„ä¸€ä¸ª</strong>ä½ç½® <code>p</code>ã€‚</li>
<li>ä» <code>p</code> å¼€å§‹ï¼Œå‘å·¦çº¿æ€§æ‰«ææ‰¾åˆ°èµ·å§‹ä½ç½® <code>start</code>ã€‚</li>
<li>ä» <code>p</code> å¼€å§‹ï¼Œå‘å³çº¿æ€§æ‰«ææ‰¾åˆ°ç»“æŸä½ç½® <code>end</code>ã€‚</li>
</ol>
<p>è¿™ç§æ–¹æ³•åœ¨ <code>target</code> ä¸é‡å¤æˆ–é‡å¤æ¬¡æ•°å¾ˆå°‘æ—¶è¡¨ç°è‰¯å¥½ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘æœ€åæƒ…å†µï¼š<code>nums = [8, 8, 8, ..., 8]</code>ã€‚æ­¤æ—¶ï¼Œçº¿æ€§æ‰«æçš„å¤æ‚åº¦ä¼šé€€åŒ–åˆ° O(n)ï¼Œå¯¼è‡´æ•´ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å˜ä¸º O(log n + n) = O(n)ï¼Œä¸ç¬¦åˆé¢˜ç›®çš„è¿›é˜¶è¦æ±‚ã€‚</p>
<h4 id="æ–¹æ¡ˆäºŒï¼šä¸¤æ¬¡ç‹¬ç«‹çš„äºŒåˆ†æœç´¢ï¼ˆæœ€ç»ˆé€‰æ‹©ï¼‰">æ–¹æ¡ˆäºŒï¼šä¸¤æ¬¡ç‹¬ç«‹çš„äºŒåˆ†æœç´¢ï¼ˆæœ€ç»ˆé€‰æ‹©ï¼‰</h4>
<p>ä¸ºäº†ä¿è¯ O(log n) çš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æŸ¥æ‰¾è¾¹ç•Œçš„è¿‡ç¨‹ä¸­ä¹Ÿä½¿ç”¨å¯¹æ•°æ—¶é—´å¤æ‚åº¦çš„ç®—æ³•ã€‚è¿™å°±å¼•å‡ºäº†æœ€ç»ˆçš„è®¾è®¡ï¼š<strong>æ‰§è¡Œä¸¤æ¬¡ç‹¬ç«‹çš„ã€ç»è¿‡ç‰¹æ®Šæ”¹é€ çš„äºŒåˆ†æœç´¢</strong>ã€‚</p>
<ol>
<li><strong>ç¬¬ä¸€æ¬¡æœç´¢</strong>ï¼šä¸“é—¨è®¾è®¡ç”¨äºæŸ¥æ‰¾<strong>å·¦è¾¹ç•Œ</strong>ï¼ˆèµ·å§‹ä½ç½®ï¼‰ã€‚</li>
<li><strong>ç¬¬äºŒæ¬¡æœç´¢</strong>ï¼šä¸“é—¨è®¾è®¡ç”¨äºæŸ¥æ‰¾<strong>å³è¾¹ç•Œ</strong>ï¼ˆç»“æŸä½ç½®ï¼‰ã€‚</li>
</ol>
<p>è¿™ç§&quot;åˆ†è€Œæ²»ä¹‹&quot;çš„æ€æƒ³ï¼Œå°†ä¸€ä¸ªå¤æ‚é—®é¢˜ï¼ˆå¯»æ‰¾ä¸€ä¸ªåŒºé—´ï¼‰åˆ†è§£ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ã€æ›´ç®€å•çš„å­é—®é¢˜ï¼ˆåˆ†åˆ«å¯»æ‰¾å·¦ã€å³è¾¹ç•Œï¼‰ï¼Œæ¯æ¬¡æŸ¥æ‰¾éƒ½ä¿æŒ O(log n) çš„æ•ˆç‡ï¼Œä»è€Œç¡®ä¿æ€»ä½“å¤æ‚åº¦è¾¾æ ‡ã€‚</p>
<h2 id="è§£é¢˜æ€è·¯ä¸å®ç°ç»†èŠ‚">è§£é¢˜æ€è·¯ä¸å®ç°ç»†èŠ‚</h2>
<h3 id="ğŸš€-äºŒåˆ†æœç´¢çš„ç²¾é«“ï¼šå¾ªç¯ä¸å˜é‡ä¸è¾¹ç•Œæ”¶æ•›">ğŸš€ äºŒåˆ†æœç´¢çš„ç²¾é«“ï¼šå¾ªç¯ä¸å˜é‡ä¸è¾¹ç•Œæ”¶æ•›</h3>
<blockquote>
<p><strong>é‡ç‚¹æ ‡è®°ï¼š</strong><br>
è¿™é“é¢˜æ˜¯å­¦ä¹ äºŒåˆ†æœç´¢çš„ç»ä½³èŒƒä¾‹ã€‚å®ƒè€ƒå¯Ÿçš„ä¸æ˜¯ä½ æ˜¯å¦ä¼šå†™äºŒåˆ†æœç´¢ï¼Œè€Œæ˜¯ä½ æ˜¯å¦çœŸæ­£ç†è§£å…¶<strong>æ ¸å¿ƒåŸç†</strong>ï¼Œç‰¹åˆ«æ˜¯<strong>å¾ªç¯ä¸å˜é‡ (loop invariant)</strong> å’Œ<strong>è¾¹ç•Œæ”¶æ•›</strong>ã€‚</p>
<p><strong>å¾ªç¯ä¸å˜é‡</strong>æ˜¯æŒ‡åœ¨å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ä¹‹å‰å’Œä¹‹åéƒ½ä¿æŒä¸ºçœŸçš„ä¸€ä¸ªæ¡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„äºŒåˆ†æœç´¢ä¸­ï¼Œè¿™ä¸ªä¸å˜é‡å°±æ˜¯ <strong>â€œç›®æ ‡å€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¸€å®šåœ¨é—­åŒºé—´ <code>[left, right]</code> å†…â€</strong>ã€‚</p>
<ul>
<li>å¾ªç¯æ¡ä»¶ <code>while (left &lt;= right)</code> ä¿è¯äº†åªè¦è¿™ä¸ªåŒºé—´æœ‰æ•ˆï¼ˆ<code>left</code> ä¸å¤§äº <code>right</code>ï¼‰ï¼Œæˆ‘ä»¬å°±ç»§ç»­æœç´¢ã€‚å½“ <code>left &gt; right</code> æ—¶ï¼ŒåŒºé—´ <code>[left, right]</code> å˜ä¸ºç©ºï¼Œè¯´æ˜æœç´¢ç»“æŸã€‚</li>
<li>è¾¹ç•Œæ›´æ–° <code>left = mid + 1</code> æˆ– <code>right = mid - 1</code> çš„è®¾è®¡ï¼Œæ­£æ˜¯ä¸ºäº†åœ¨æ’é™¤ <code>mid</code> åï¼Œç»§ç»­ç»´æŒè¿™ä¸ªä¸å˜é‡ã€‚</li>
</ul>
<p>ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œä½ å°±èƒ½è‡ªä¿¡åœ°è°ƒæ•´è¾¹ç•Œæ›´æ–°é€»è¾‘ï¼Œä»¥æ»¡è¶³ä¸åŒçš„æŸ¥æ‰¾ç›®æ ‡ï¼ˆå·¦è¾¹ç•Œã€å³è¾¹ç•Œï¼Œæˆ–ç¬¬ä¸€ä¸ªå¤§äº/å°äºæŸå€¼çš„å…ƒç´ ï¼‰ã€‚</p>
</blockquote>
<h3 id="ç¬¬ä¸€æ¬¡æœç´¢ï¼šæŸ¥æ‰¾èµ·å§‹ä½ç½®ï¼ˆå·¦è¾¹ç•Œï¼‰">ç¬¬ä¸€æ¬¡æœç´¢ï¼šæŸ¥æ‰¾èµ·å§‹ä½ç½®ï¼ˆå·¦è¾¹ç•Œï¼‰</h3>
<p><strong>ç›®æ ‡</strong>ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ª<strong>å¤§äºæˆ–ç­‰äº</strong> <code>target</code> çš„ä½ç½®ã€‚</p>
<ul>
<li><strong><code>nums[mid] &lt; target</code></strong>: è¿™æ„å‘³ç€ <code>mid</code> ä»¥åŠå…¶å·¦è¾¹çš„æ‰€æœ‰å…ƒç´ éƒ½<strong>ç»å¯¹ä¸æ˜¯</strong>èµ·å§‹ä½ç½®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æœç´¢åŒºé—´çš„å·¦è¾¹ç•Œç§»åŠ¨åˆ° <code>mid</code> çš„å³è¾¹ï¼š<code>left = mid + 1</code>ã€‚</li>
<li><strong><code>nums[mid] &gt;= target</code></strong>: è¿™æ„å‘³ç€ <code>mid</code> <strong>å¯èƒ½æ˜¯</strong>èµ·å§‹ä½ç½®ï¼Œä½†å®ƒå·¦è¾¹å¯èƒ½è¿˜æœ‰æ›´æ—©çš„ <code>target</code>ã€‚æˆ‘ä»¬ä¸èƒ½æ’é™¤ <code>mid</code>ï¼Œä½†å¯ä»¥è‚¯å®šèµ·å§‹ä½ç½®<strong>ä¸ä¼šåœ¨ <code>mid</code> çš„å³è¾¹</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æœç´¢åŒºé—´çš„å³è¾¹ç•Œæ”¶ç¼©åˆ° <code>mid</code> çš„å·¦è¾¹ï¼š<code>right = mid - 1</code>ï¼Œå¹¶æœŸæœ›åœ¨ä¸‹ä¸€è½®æ‰¾åˆ°æ›´é å·¦çš„ä½ç½®ã€‚</li>
</ul>
<p><strong>æŒ‡é’ˆæ”¶æ•›è¿‡ç¨‹</strong>ï¼š<br>
å½“å¾ªç¯ç»“æŸæ—¶ï¼ˆ<code>left &gt; right</code>ï¼‰ï¼Œ<code>left</code> æŒ‡é’ˆå°†åœåœ¨è¿™æ ·ä¸€ä¸ªä½ç½®ï¼šå®ƒæ˜¯æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå€¼å¤§äºæˆ–ç­‰äº <code>target</code> çš„ç´¢å¼•ã€‚æˆ‘ä»¬åªéœ€åœ¨å¾ªç¯åæ£€æŸ¥ <code>nums[left]</code> æ˜¯å¦ç¡®å®ç­‰äº <code>target</code>ï¼Œå³å¯ç¡®è®¤æ˜¯å¦æ‰¾åˆ°äº†èµ·å§‹ä½ç½®ã€‚</p>
<h3 id="ç¬¬äºŒæ¬¡æœç´¢ï¼šæŸ¥æ‰¾ç»“æŸä½ç½®ï¼ˆå³è¾¹ç•Œï¼‰">ç¬¬äºŒæ¬¡æœç´¢ï¼šæŸ¥æ‰¾ç»“æŸä½ç½®ï¼ˆå³è¾¹ç•Œï¼‰</h3>
<p><strong>ç›®æ ‡</strong>ï¼šæ‰¾åˆ°æœ€åä¸€ä¸ª<strong>å°äºæˆ–ç­‰äº</strong> <code>target</code> çš„ä½ç½®ã€‚</p>
<ul>
<li><strong><code>nums[mid] &lt;= target</code></strong>: è¿™æ„å‘³ç€ <code>mid</code> <strong>å¯èƒ½æ˜¯</strong>ç»“æŸä½ç½®ï¼Œæˆ–è€…ç»“æŸä½ç½®åœ¨å®ƒçš„å³è¾¹ã€‚æˆ‘ä»¬ä¸èƒ½æ’é™¤ <code>mid</code>ï¼Œä½†å¯ä»¥è‚¯å®šç»“æŸä½ç½®<strong>ä¸ä¼šåœ¨ <code>mid</code> çš„å·¦è¾¹</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æœç´¢åŒºé—´çš„å·¦è¾¹ç•Œç§»åŠ¨åˆ° <code>mid</code> çš„å³è¾¹ï¼š<code>left = mid + 1</code>ï¼Œå¹¶æœŸæœ›åœ¨ä¸‹ä¸€è½®æ‰¾åˆ°æ›´é å³çš„ä½ç½®ã€‚</li>
<li><strong><code>nums[mid] &gt; target</code></strong>: è¿™æ„å‘³ç€ <code>mid</code> ä»¥åŠå…¶å³è¾¹çš„æ‰€æœ‰å…ƒç´ éƒ½<strong>ç»å¯¹ä¸æ˜¯</strong>ç»“æŸä½ç½®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æœç´¢åŒºé—´çš„å³è¾¹ç•Œæ”¶ç¼©åˆ° <code>mid</code> çš„å·¦è¾¹ï¼š<code>right = mid - 1</code>ã€‚</li>
</ul>
<p><strong>æŒ‡é’ˆæ”¶æ•›è¿‡ç¨‹</strong>ï¼š<br>
å½“å¾ªç¯ç»“æŸæ—¶ï¼ˆ<code>left &gt; right</code>ï¼‰ï¼Œ<code>right</code> æŒ‡é’ˆå°†åœåœ¨è¿™æ ·ä¸€ä¸ªä½ç½®ï¼šå®ƒæ˜¯æ•°ç»„ä¸­æœ€åä¸€ä¸ªå€¼å°äºæˆ–ç­‰äº <code>target</code> çš„ç´¢å¼•ã€‚è¿™ä¸ªä½ç½®å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç»“æŸä½ç½®ã€‚</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>è¿™æ˜¯ä½¿ç”¨ Go è¯­è¨€å®ç°çš„å®Œæ•´ä»£ç ï¼Œå…¶ä¸­åŒ…å«äº†ä¸¤æ¬¡äºŒåˆ†æœç´¢ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=34 lang=golang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [34] åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @lc code=start</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">searchRange</span><span class="params">(nums []<span class="type">int</span>, target <span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> start, end <span class="type">int</span></span><br><span class="line"></span><br><span class="line">	n := <span class="built_in">len</span>(nums)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> []<span class="type">int</span>&#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// --- ç¬¬ä¸€æ¬¡äºŒåˆ†æœç´¢ï¼šæŸ¥æ‰¾èµ·å§‹ä½ç½® ---</span></span><br><span class="line">	left, right := <span class="number">0</span>, n<span class="number">-1</span></span><br><span class="line">	<span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">		mid := left + (right-left)&gt;&gt;<span class="number">1</span> <span class="comment">// é˜²æ­¢æº¢å‡º</span></span><br><span class="line">		<span class="keyword">if</span> nums[mid] &lt; target &#123;</span><br><span class="line">			left = mid + <span class="number">1</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; <span class="comment">// nums[mid] &gt;= target</span></span><br><span class="line">			<span class="comment">// å³ä½¿æ‰¾åˆ° targetï¼Œä¹Ÿç»§ç»­å‘å·¦å¯»æ‰¾æ›´æ—©å‡ºç°çš„ä½ç½®</span></span><br><span class="line">			right = mid - <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¾ªç¯ç»“æŸåï¼Œleft æ˜¯ç¬¬ä¸€ä¸ª &gt;= target çš„ä½ç½®</span></span><br><span class="line">	<span class="comment">// æ£€æŸ¥å·¦è¾¹ç•Œæ˜¯å¦åˆæ³•</span></span><br><span class="line">	<span class="keyword">if</span> left &gt;= n || nums[left] != target &#123;</span><br><span class="line">		<span class="keyword">return</span> []<span class="type">int</span>&#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	start = left</span><br><span class="line"></span><br><span class="line">	<span class="comment">// --- ç¬¬äºŒæ¬¡äºŒåˆ†æœç´¢ï¼šæŸ¥æ‰¾ç»“æŸä½ç½® ---</span></span><br><span class="line">	left, right = <span class="number">0</span>, n<span class="number">-1</span></span><br><span class="line">	<span class="keyword">for</span> left &lt;= right &#123;</span><br><span class="line">		mid := left + (right-left)&gt;&gt;<span class="number">1</span> <span class="comment">// é˜²æ­¢æº¢å‡º</span></span><br><span class="line">		<span class="keyword">if</span> nums[mid] &lt;= target &#123;</span><br><span class="line">			<span class="comment">// å³ä½¿æ‰¾åˆ° targetï¼Œä¹Ÿç»§ç»­å‘å³å¯»æ‰¾æ›´æ™šå‡ºç°çš„ä½ç½®</span></span><br><span class="line">			left = mid + <span class="number">1</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; <span class="comment">// nums[mid] &gt; target</span></span><br><span class="line">			right = mid - <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å¾ªç¯ç»“æŸåï¼Œright æ˜¯æœ€åä¸€ä¸ª &lt;= target çš„ä½ç½®</span></span><br><span class="line">	end = right</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> []<span class="type">int</span>&#123;start, end&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @lc code=end</span></span><br></pre></td></tr></table></figure>
<h2 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2>
<ul>
<li>
<p><strong>æ—¶é—´å¤æ‚åº¦:</strong> O(log n)</p>
<ul>
<li>æˆ‘ä»¬æ‰§è¡Œäº†ä¸¤æ¬¡ç‹¬ç«‹çš„äºŒåˆ†æœç´¢ï¼Œæ¯æ¬¡çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(log n)ã€‚</li>
<li>å› æ­¤ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log n) + O(log n) = O(log n)ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç©ºé—´å¤æ‚åº¦:</strong> O(1)</p>
<ul>
<li>æˆ‘ä»¬åªä½¿ç”¨äº†æœ‰é™çš„å‡ ä¸ªå˜é‡ (<code>start</code>, <code>end</code>, <code>left</code>, <code>right</code>, <code>mid</code>, <code>n</code>)ï¼Œæ²¡æœ‰ä½¿ç”¨é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å…³é”®æ”¶è·">å…³é”®æ”¶è·</h2>
<ul>
<li><strong>åˆ†æ²»æ€æƒ³</strong>ï¼šå°†&quot;å¯»æ‰¾ä¸€ä¸ªåŒºé—´&quot;çš„å¤æ‚é—®é¢˜ï¼Œæ‹†åˆ†ä¸º&quot;å¯»æ‰¾å·¦è¾¹ç•Œ&quot;å’Œ&quot;å¯»æ‰¾å³è¾¹ç•Œ&quot;ä¸¤ä¸ªç‹¬ç«‹çš„ã€æ›´ç®€å•çš„é—®é¢˜ï¼Œæ˜¯è§£å†³å¤æ‚é—®é¢˜çš„æœ‰æ•ˆç­–ç•¥ã€‚</li>
<li><strong>ç†è§£å¾ªç¯ä¸å˜é‡</strong>ï¼šäºŒåˆ†æœç´¢çš„æ ¸å¿ƒæ˜¯ç»´æŠ¤&quot;ç›®æ ‡åœ¨ <code>[left, right]</code> åŒºé—´å†…&quot;è¿™ä¸ªä¸å˜é‡ã€‚ç†è§£è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å¸®åŠ©ä½ æ­£ç¡®åœ°è®¾è®¡å¾ªç¯æ¡ä»¶å’Œè¾¹ç•Œæ›´æ–°é€»è¾‘ã€‚</li>
<li><strong>è¾¹ç•Œè°ƒæ•´çš„è‰ºæœ¯</strong>ï¼šé€šè¿‡å¾®è°ƒ <code>if</code> æ¡ä»¶å’Œ <code>left</code>/<code>right</code> çš„æ›´æ–°æ–¹å¼ï¼ŒäºŒåˆ†æœç´¢å¯ä»¥å®ç°å¤šç§æŸ¥æ‰¾ç›®æ ‡ï¼ˆå¦‚ç¬¬ä¸€ä¸ªå¤§äºXçš„æ•°ï¼Œæœ€åä¸€ä¸ªå°äºXçš„æ•°ç­‰ï¼‰ï¼Œè¿™æ˜¯å…¶å¼ºå¤§çµæ´»æ€§çš„ä½“ç°ã€‚</li>
<li><strong>ä»£ç å¥å£®æ€§</strong>ï¼šè®¡ç®— <code>mid</code> æ—¶ä½¿ç”¨ <code>left + (right-left)&gt;&gt;1</code> è€Œä¸æ˜¯ <code>(left+right)&gt;&gt;1</code>ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢å½“ <code>left</code> å’Œ <code>right</code> éƒ½å¾ˆå¤§æ—¶å¯èƒ½å‘ç”Ÿçš„æ•´æ•°æº¢å‡ºé—®é¢˜ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•åˆ·é¢˜</category>
        <category>LeetCode</category>
        <category>æ¨¡æ‹Ÿ</category>
      </categories>
      <tags>
        <tag>LeetCode</tag>
        <tag>Medium</tag>
        <tag>é¢è¯•ç»å…¸150</tag>
        <tag>æ•°ç»„</tag>
        <tag>äºŒåˆ†æœç´¢</tag>
      </tags>
  </entry>
</search>
